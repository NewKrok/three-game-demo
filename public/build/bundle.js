var app=function(){"use strict";function e(){}function t(e,t){for(const n in t)e[n]=t[n];return e}function n(e){return e()}function i(){return Object.create(null)}function r(e){e.forEach(n)}function o(e){return"function"==typeof e}function a(e,t){return e!=e?t==t:e!==t||e&&"object"==typeof e||"function"==typeof e}let s,l;function p(e,t){return s||(s=document.createElement("a")),s.href=t,e===s.href}function u(t,...n){if(null==t)return e;const i=t.subscribe(...n);return i.unsubscribe?()=>i.unsubscribe():i}function h(e){let t;return u(e,(e=>t=e))(),t}function c(e,t,n){e.$$.on_destroy.push(u(t,n))}function _(e,t,n,i){if(e){const r=d(e,t,n,i);return e[0](r)}}function d(e,n,i,r){return e[1]&&r?t(i.ctx.slice(),e[1](r(n))):i.ctx}function m(e,t,n,i){if(e[2]&&i){const r=e[2](i(n));if(void 0===t.dirty)return r;if("object"==typeof r){const e=[],n=Math.max(t.dirty.length,r.length);for(let i=0;i<n;i+=1)e[i]=t.dirty[i]|r[i];return e}return t.dirty|r}return t.dirty}function P(e,t,n,i,r,o){if(r){const a=d(t,n,i,o);e.p(a,r)}}function f(e){if(e.ctx.length>32){const t=[],n=e.ctx.length/32;for(let e=0;e<n;e++)t[e]=-1;return t}return-1}function x(e){const t={};for(const n in e)"$"!==n[0]&&(t[n]=e[n]);return t}function y(e,t){const n={};t=new Set(t);for(const i in e)t.has(i)||"$"===i[0]||(n[i]=e[i]);return n}function v(e){return null==e?"":e}function g(e,t,n){return e.set(n),t}function b(t){return t&&o(t.destroy)?t.destroy:e}function z(e,t){e.appendChild(t)}function w(e,t,n){e.insertBefore(t,n||null)}function Z(e){e.parentNode.removeChild(e)}function E(e,t){for(let n=0;n<e.length;n+=1)e[n]&&e[n].d(t)}function M(e){return document.createElement(e)}function S(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}function C(e){return document.createTextNode(e)}function N(){return C(" ")}function A(){return C("")}function L(e,t,n,i){return e.addEventListener(t,n,i),()=>e.removeEventListener(t,n,i)}function B(e,t,n){null==n?e.removeAttribute(t):e.getAttribute(t)!==n&&e.setAttribute(t,n)}function T(e,t){const n=Object.getOwnPropertyDescriptors(e.__proto__);for(const i in t)null==t[i]?e.removeAttribute(i):"style"===i?e.style.cssText=t[i]:"__value"===i?e.value=e[i]=t[i]:n[i]&&n[i].set?e[i]=t[i]:B(e,i,t[i])}function V(e,t){for(const n in t)B(e,n,t[n])}function k(e,t){t=""+t,e.wholeText!==t&&(e.data=t)}function I(e,t,n,i){null===n?e.style.removeProperty(t):e.style.setProperty(t,n,i?"important":"")}function O(e){l=e}function R(){if(!l)throw new Error("Function called outside component initialization");return l}function H(e){R().$$.on_mount.push(e)}function F(e){R().$$.on_destroy.push(e)}function D(e,t){R().$$.context.set(e,t)}function G(e){return R().$$.context.get(e)}const U=[],j=[],W=[],q=[],J=Promise.resolve();let $=!1;function X(e){W.push(e)}const Y=new Set;let K=0;function Q(){const e=l;do{for(;K<U.length;){const e=U[K];K++,O(e),ee(e.$$)}for(O(null),U.length=0,K=0;j.length;)j.pop()();for(let e=0;e<W.length;e+=1){const t=W[e];Y.has(t)||(Y.add(t),t())}W.length=0}while(U.length);for(;q.length;)q.pop()();$=!1,Y.clear(),O(e)}function ee(e){if(null!==e.fragment){e.update(),r(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(X)}}const te=new Set;let ne;function ie(){ne={r:0,c:[],p:ne}}function re(){ne.r||r(ne.c),ne=ne.p}function oe(e,t){e&&e.i&&(te.delete(e),e.i(t))}function ae(e,t,n,i){if(e&&e.o){if(te.has(e))return;te.add(e),ne.c.push((()=>{te.delete(e),i&&(n&&e.d(1),i())})),e.o(t)}}const se="undefined"!=typeof window?window:"undefined"!=typeof globalThis?globalThis:global;function le(e,t){ae(e,1,1,(()=>{t.delete(e.key)}))}function pe(e,t,n,i,r,o,a,s,l,p,u,h){let c=e.length,_=o.length,d=c;const m={};for(;d--;)m[e[d].key]=d;const P=[],f=new Map,x=new Map;for(d=_;d--;){const e=h(r,o,d),s=n(e);let l=a.get(s);l?i&&l.p(e,t):(l=p(s,e),l.c()),f.set(s,P[d]=l),s in m&&x.set(s,Math.abs(d-m[s]))}const y=new Set,v=new Set;function g(e){oe(e,1),e.m(s,u),a.set(e.key,e),u=e.first,_--}for(;c&&_;){const t=P[_-1],n=e[c-1],i=t.key,r=n.key;t===n?(u=t.first,c--,_--):f.has(r)?!a.has(i)||y.has(i)?g(t):v.has(r)?c--:x.get(i)>x.get(r)?(v.add(i),g(t)):(y.add(r),c--):(l(n,a),c--)}for(;c--;){const t=e[c];f.has(t.key)||l(t,a)}for(;_;)g(P[_-1]);return P}function ue(e,t){const n={},i={},r={$$scope:1};let o=e.length;for(;o--;){const a=e[o],s=t[o];if(s){for(const e in a)e in s||(i[e]=1);for(const e in s)r[e]||(n[e]=s[e],r[e]=1);e[o]=s}else for(const e in a)r[e]=1}for(const e in i)e in n||(n[e]=void 0);return n}function he(e){return"object"==typeof e&&null!==e?e:{}}function ce(e){e&&e.c()}function _e(e,t,i,a){const{fragment:s,on_mount:l,on_destroy:p,after_update:u}=e.$$;s&&s.m(t,i),a||X((()=>{const t=l.map(n).filter(o);p?p.push(...t):r(t),e.$$.on_mount=[]})),u.forEach(X)}function de(e,t){const n=e.$$;null!==n.fragment&&(r(n.on_destroy),n.fragment&&n.fragment.d(t),n.on_destroy=n.fragment=null,n.ctx=[])}function me(t,n,o,a,s,p,u,h=[-1]){const c=l;O(t);const _=t.$$={fragment:null,ctx:null,props:p,update:e,not_equal:s,bound:i(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(n.context||(c?c.$$.context:[])),callbacks:i(),dirty:h,skip_bound:!1,root:n.target||c.$$.root};u&&u(_.root);let d=!1;if(_.ctx=o?o(t,n.props||{},((e,n,...i)=>{const r=i.length?i[0]:n;return _.ctx&&s(_.ctx[e],_.ctx[e]=r)&&(!_.skip_bound&&_.bound[e]&&_.bound[e](r),d&&function(e,t){-1===e.$$.dirty[0]&&(U.push(e),$||($=!0,J.then(Q)),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}(t,e)),n})):[],_.update(),d=!0,r(_.before_update),_.fragment=!!a&&a(_.ctx),n.target){if(n.hydrate){const e=function(e){return Array.from(e.childNodes)}(n.target);_.fragment&&_.fragment.l(e),e.forEach(Z)}else _.fragment&&_.fragment.c();n.intro&&oe(t.$$.fragment),_e(t,n.target,n.anchor,n.customElement),Q()}O(c)}class Pe{$destroy(){de(this,1),this.$destroy=e}$on(e,t){const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(t),()=>{const e=n.indexOf(t);-1!==e&&n.splice(e,1)}}$set(e){var t;this.$$set&&(t=e,0!==Object.keys(t).length)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const fe="MENU",xe="GAME",ye=[];function ve(t,n=e){let i;const r=new Set;function o(e){if(a(t,e)&&(t=e,i)){const e=!ye.length;for(const e of r)e[1](),ye.push(e,t);if(e){for(let e=0;e<ye.length;e+=2)ye[e][0](ye[e+1]);ye.length=0}}}return{set:o,update:function(e){o(e(t))},subscribe:function(a,s=e){const l=[a,s];return r.add(l),1===r.size&&(i=n(o)||e),a(t),()=>{r.delete(l),0===r.size&&(i(),i=null)}}}}const ge=ve(fe),be=ve(null),ze=ve(0),we=ve(0),Ze=ve(0),Ee=ve(0),Me=ve(0),Se=ve([]),Ce=ve(0),Ne=ve(0),Ae=ve([]),Le=ve([]),Be={world:null,playersUnit:null,isControlDisabled:!1,isPointerLockNeeded:!1,cycleData:{now:Date.now(),isPaused:!1},getRandomAvailablePoint:null};
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */var Te=function(e,t){return Te=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},Te(e,t)};function Ve(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}Te(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var ke=function(){return ke=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},ke.apply(this,arguments)};function Ie(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],i=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}
/**
     * @license
     * Copyright 2016 Google Inc.
     *
     * Permission is hereby granted, free of charge, to any person obtaining a copy
     * of this software and associated documentation files (the "Software"), to deal
     * in the Software without restriction, including without limitation the rights
     * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
     * copies of the Software, and to permit persons to whom the Software is
     * furnished to do so, subject to the following conditions:
     *
     * The above copyright notice and this permission notice shall be included in
     * all copies or substantial portions of the Software.
     *
     * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
     * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
     * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
     * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
     * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
     * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
     * THE SOFTWARE.
     */var Oe=function(){function e(e){void 0===e&&(e={}),this.adapter=e}return Object.defineProperty(e,"cssClasses",{get:function(){return{}},enumerable:!1,configurable:!0}),Object.defineProperty(e,"strings",{get:function(){return{}},enumerable:!1,configurable:!0}),Object.defineProperty(e,"numbers",{get:function(){return{}},enumerable:!1,configurable:!0}),Object.defineProperty(e,"defaultAdapter",{get:function(){return{}},enumerable:!1,configurable:!0}),e.prototype.init=function(){},e.prototype.destroy=function(){},e}(),Re="mdc-dom-focus-sentinel",He=function(){function e(e,t){void 0===t&&(t={}),this.root=e,this.options=t,this.elFocusedBeforeTrapFocus=null}return e.prototype.trapFocus=function(){var e=this.getFocusableElements(this.root);if(0===e.length)throw new Error("FocusTrap: Element must have at least one focusable child.");this.elFocusedBeforeTrapFocus=document.activeElement instanceof HTMLElement?document.activeElement:null,this.wrapTabFocus(this.root),this.options.skipInitialFocus||this.focusInitialElement(e,this.options.initialFocusEl)},e.prototype.releaseFocus=function(){[].slice.call(this.root.querySelectorAll("."+Re)).forEach((function(e){e.parentElement.removeChild(e)})),!this.options.skipRestoreFocus&&this.elFocusedBeforeTrapFocus&&this.elFocusedBeforeTrapFocus.focus()},e.prototype.wrapTabFocus=function(e){var t=this,n=this.createSentinel(),i=this.createSentinel();n.addEventListener("focus",(function(){var n=t.getFocusableElements(e);n.length>0&&n[n.length-1].focus()})),i.addEventListener("focus",(function(){var n=t.getFocusableElements(e);n.length>0&&n[0].focus()})),e.insertBefore(n,e.children[0]),e.appendChild(i)},e.prototype.focusInitialElement=function(e,t){var n=0;t&&(n=Math.max(e.indexOf(t),0)),e[n].focus()},e.prototype.getFocusableElements=function(e){return[].slice.call(e.querySelectorAll("[autofocus], [tabindex], a, input, textarea, select, button")).filter((function(e){var t="true"===e.getAttribute("aria-disabled")||null!=e.getAttribute("disabled")||null!=e.getAttribute("hidden")||"true"===e.getAttribute("aria-hidden"),n=e.tabIndex>=0&&e.getBoundingClientRect().width>0&&!e.classList.contains(Re)&&!t,i=!1;if(n){var r=getComputedStyle(e);i="none"===r.display||"hidden"===r.visibility}return n&&!i}))},e.prototype.createSentinel=function(){var e=document.createElement("div");return e.setAttribute("tabindex","0"),e.setAttribute("aria-hidden","true"),e.classList.add(Re),e},e}(),Fe=Object.freeze({__proto__:null,FocusTrap:He});
/**
     * @license
     * Copyright 2020 Google Inc.
     *
     * Permission is hereby granted, free of charge, to any person obtaining a copy
     * of this software and associated documentation files (the "Software"), to deal
     * in the Software without restriction, including without limitation the rights
     * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
     * copies of the Software, and to permit persons to whom the Software is
     * furnished to do so, subject to the following conditions:
     *
     * The above copyright notice and this permission notice shall be included in
     * all copies or substantial portions of the Software.
     *
     * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
     * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
     * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
     * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
     * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
     * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
     * THE SOFTWARE.
     */function De(e,t){return(e.matches||e.webkitMatchesSelector||e.msMatchesSelector).call(e,t)}var Ge,Ue,je=Object.freeze({__proto__:null,closest:
/**
     * @license
     * Copyright 2018 Google Inc.
     *
     * Permission is hereby granted, free of charge, to any person obtaining a copy
     * of this software and associated documentation files (the "Software"), to deal
     * in the Software without restriction, including without limitation the rights
     * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
     * copies of the Software, and to permit persons to whom the Software is
     * furnished to do so, subject to the following conditions:
     *
     * The above copyright notice and this permission notice shall be included in
     * all copies or substantial portions of the Software.
     *
     * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
     * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
     * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
     * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
     * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
     * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
     * THE SOFTWARE.
     */
function(e,t){if(e.closest)return e.closest(t);for(var n=e;n;){if(De(n,t))return n;n=n.parentElement}return null},matches:De,estimateScrollWidth:function(e){var t=e;if(null!==t.offsetParent)return t.scrollWidth;var n=t.cloneNode(!0);n.style.setProperty("position","absolute"),n.style.setProperty("transform","translate(-9999px, -9999px)"),document.documentElement.appendChild(n);var i=n.scrollWidth;return document.documentElement.removeChild(n),i}}),We=Object.freeze({__proto__:null,applyPassive:function(e){return void 0===e&&(e=window),!!function(e){void 0===e&&(e=window);var t=!1;try{var n={get passive(){return t=!0,!1}},i=function(){};e.document.addEventListener("test",i,n),e.document.removeEventListener("test",i,n)}catch(e){t=!1}return t}(e)&&{passive:!0}}}),qe={BG_FOCUSED:"mdc-ripple-upgraded--background-focused",FG_ACTIVATION:"mdc-ripple-upgraded--foreground-activation",FG_DEACTIVATION:"mdc-ripple-upgraded--foreground-deactivation",ROOT:"mdc-ripple-upgraded",UNBOUNDED:"mdc-ripple-upgraded--unbounded"},Je={VAR_FG_SCALE:"--mdc-ripple-fg-scale",VAR_FG_SIZE:"--mdc-ripple-fg-size",VAR_FG_TRANSLATE_END:"--mdc-ripple-fg-translate-end",VAR_FG_TRANSLATE_START:"--mdc-ripple-fg-translate-start",VAR_LEFT:"--mdc-ripple-left",VAR_TOP:"--mdc-ripple-top"},$e={DEACTIVATION_TIMEOUT_MS:225,FG_DEACTIVATION_MS:150,INITIAL_ORIGIN_SCALE:.6,PADDING:10,TAP_DELAY_MS:300},Xe=["touchstart","pointerdown","mousedown","keydown"],Ye=["touchend","pointerup","mouseup","contextmenu"],Ke=[],Qe=function(e){function t(n){var i=e.call(this,ke(ke({},t.defaultAdapter),n))||this;return i.activationAnimationHasEnded=!1,i.activationTimer=0,i.fgDeactivationRemovalTimer=0,i.fgScale="0",i.frame={width:0,height:0},i.initialSize=0,i.layoutFrame=0,i.maxRadius=0,i.unboundedCoords={left:0,top:0},i.activationState=i.defaultActivationState(),i.activationTimerCallback=function(){i.activationAnimationHasEnded=!0,i.runDeactivationUXLogicIfReady()},i.activateHandler=function(e){i.activateImpl(e)},i.deactivateHandler=function(){i.deactivateImpl()},i.focusHandler=function(){i.handleFocus()},i.blurHandler=function(){i.handleBlur()},i.resizeHandler=function(){i.layout()},i}return Ve(t,e),Object.defineProperty(t,"cssClasses",{get:function(){return qe},enumerable:!1,configurable:!0}),Object.defineProperty(t,"strings",{get:function(){return Je},enumerable:!1,configurable:!0}),Object.defineProperty(t,"numbers",{get:function(){return $e},enumerable:!1,configurable:!0}),Object.defineProperty(t,"defaultAdapter",{get:function(){return{addClass:function(){},browserSupportsCssVars:function(){return!0},computeBoundingRect:function(){return{top:0,right:0,bottom:0,left:0,width:0,height:0}},containsEventTarget:function(){return!0},deregisterDocumentInteractionHandler:function(){},deregisterInteractionHandler:function(){},deregisterResizeHandler:function(){},getWindowPageOffset:function(){return{x:0,y:0}},isSurfaceActive:function(){return!0},isSurfaceDisabled:function(){return!0},isUnbounded:function(){return!0},registerDocumentInteractionHandler:function(){},registerInteractionHandler:function(){},registerResizeHandler:function(){},removeClass:function(){},updateCssVariable:function(){}}},enumerable:!1,configurable:!0}),t.prototype.init=function(){var e=this,n=this.supportsPressRipple();if(this.registerRootHandlers(n),n){var i=t.cssClasses,r=i.ROOT,o=i.UNBOUNDED;requestAnimationFrame((function(){e.adapter.addClass(r),e.adapter.isUnbounded()&&(e.adapter.addClass(o),e.layoutInternal())}))}},t.prototype.destroy=function(){var e=this;if(this.supportsPressRipple()){this.activationTimer&&(clearTimeout(this.activationTimer),this.activationTimer=0,this.adapter.removeClass(t.cssClasses.FG_ACTIVATION)),this.fgDeactivationRemovalTimer&&(clearTimeout(this.fgDeactivationRemovalTimer),this.fgDeactivationRemovalTimer=0,this.adapter.removeClass(t.cssClasses.FG_DEACTIVATION));var n=t.cssClasses,i=n.ROOT,r=n.UNBOUNDED;requestAnimationFrame((function(){e.adapter.removeClass(i),e.adapter.removeClass(r),e.removeCssVars()}))}this.deregisterRootHandlers(),this.deregisterDeactivationHandlers()},t.prototype.activate=function(e){this.activateImpl(e)},t.prototype.deactivate=function(){this.deactivateImpl()},t.prototype.layout=function(){var e=this;this.layoutFrame&&cancelAnimationFrame(this.layoutFrame),this.layoutFrame=requestAnimationFrame((function(){e.layoutInternal(),e.layoutFrame=0}))},t.prototype.setUnbounded=function(e){var n=t.cssClasses.UNBOUNDED;e?this.adapter.addClass(n):this.adapter.removeClass(n)},t.prototype.handleFocus=function(){var e=this;requestAnimationFrame((function(){return e.adapter.addClass(t.cssClasses.BG_FOCUSED)}))},t.prototype.handleBlur=function(){var e=this;requestAnimationFrame((function(){return e.adapter.removeClass(t.cssClasses.BG_FOCUSED)}))},t.prototype.supportsPressRipple=function(){return this.adapter.browserSupportsCssVars()},t.prototype.defaultActivationState=function(){return{activationEvent:void 0,hasDeactivationUXRun:!1,isActivated:!1,isProgrammatic:!1,wasActivatedByPointer:!1,wasElementMadeActive:!1}},t.prototype.registerRootHandlers=function(e){var t,n;if(e){try{for(var i=Ie(Xe),r=i.next();!r.done;r=i.next()){var o=r.value;this.adapter.registerInteractionHandler(o,this.activateHandler)}}catch(e){t={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}this.adapter.isUnbounded()&&this.adapter.registerResizeHandler(this.resizeHandler)}this.adapter.registerInteractionHandler("focus",this.focusHandler),this.adapter.registerInteractionHandler("blur",this.blurHandler)},t.prototype.registerDeactivationHandlers=function(e){var t,n;if("keydown"===e.type)this.adapter.registerInteractionHandler("keyup",this.deactivateHandler);else try{for(var i=Ie(Ye),r=i.next();!r.done;r=i.next()){var o=r.value;this.adapter.registerDocumentInteractionHandler(o,this.deactivateHandler)}}catch(e){t={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}},t.prototype.deregisterRootHandlers=function(){var e,t;try{for(var n=Ie(Xe),i=n.next();!i.done;i=n.next()){var r=i.value;this.adapter.deregisterInteractionHandler(r,this.activateHandler)}}catch(t){e={error:t}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}this.adapter.deregisterInteractionHandler("focus",this.focusHandler),this.adapter.deregisterInteractionHandler("blur",this.blurHandler),this.adapter.isUnbounded()&&this.adapter.deregisterResizeHandler(this.resizeHandler)},t.prototype.deregisterDeactivationHandlers=function(){var e,t;this.adapter.deregisterInteractionHandler("keyup",this.deactivateHandler);try{for(var n=Ie(Ye),i=n.next();!i.done;i=n.next()){var r=i.value;this.adapter.deregisterDocumentInteractionHandler(r,this.deactivateHandler)}}catch(t){e={error:t}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}},t.prototype.removeCssVars=function(){var e=this,n=t.strings;Object.keys(n).forEach((function(t){0===t.indexOf("VAR_")&&e.adapter.updateCssVariable(n[t],null)}))},t.prototype.activateImpl=function(e){var t=this;if(!this.adapter.isSurfaceDisabled()){var n=this.activationState;if(!n.isActivated){var i=this.previousActivationEvent;i&&void 0!==e&&i.type!==e.type||(n.isActivated=!0,n.isProgrammatic=void 0===e,n.activationEvent=e,n.wasActivatedByPointer=!n.isProgrammatic&&void 0!==e&&("mousedown"===e.type||"touchstart"===e.type||"pointerdown"===e.type),void 0!==e&&Ke.length>0&&Ke.some((function(e){return t.adapter.containsEventTarget(e)}))?this.resetActivationState():(void 0!==e&&(Ke.push(e.target),this.registerDeactivationHandlers(e)),n.wasElementMadeActive=this.checkElementMadeActive(e),n.wasElementMadeActive&&this.animateActivation(),requestAnimationFrame((function(){Ke=[],n.wasElementMadeActive||void 0===e||" "!==e.key&&32!==e.keyCode||(n.wasElementMadeActive=t.checkElementMadeActive(e),n.wasElementMadeActive&&t.animateActivation()),n.wasElementMadeActive||(t.activationState=t.defaultActivationState())}))))}}},t.prototype.checkElementMadeActive=function(e){return void 0===e||"keydown"!==e.type||this.adapter.isSurfaceActive()},t.prototype.animateActivation=function(){var e=this,n=t.strings,i=n.VAR_FG_TRANSLATE_START,r=n.VAR_FG_TRANSLATE_END,o=t.cssClasses,a=o.FG_DEACTIVATION,s=o.FG_ACTIVATION,l=t.numbers.DEACTIVATION_TIMEOUT_MS;this.layoutInternal();var p="",u="";if(!this.adapter.isUnbounded()){var h=this.getFgTranslationCoordinates(),c=h.startPoint,_=h.endPoint;p=c.x+"px, "+c.y+"px",u=_.x+"px, "+_.y+"px"}this.adapter.updateCssVariable(i,p),this.adapter.updateCssVariable(r,u),clearTimeout(this.activationTimer),clearTimeout(this.fgDeactivationRemovalTimer),this.rmBoundedActivationClasses(),this.adapter.removeClass(a),this.adapter.computeBoundingRect(),this.adapter.addClass(s),this.activationTimer=setTimeout((function(){e.activationTimerCallback()}),l)},t.prototype.getFgTranslationCoordinates=function(){var e,t=this.activationState,n=t.activationEvent;return e=t.wasActivatedByPointer?function(e,t,n){if(!e)return{x:0,y:0};var i,r,o=t.x,a=t.y,s=o+n.left,l=a+n.top;if("touchstart"===e.type){var p=e;i=p.changedTouches[0].pageX-s,r=p.changedTouches[0].pageY-l}else{var u=e;i=u.pageX-s,r=u.pageY-l}return{x:i,y:r}}(n,this.adapter.getWindowPageOffset(),this.adapter.computeBoundingRect()):{x:this.frame.width/2,y:this.frame.height/2},{startPoint:e={x:e.x-this.initialSize/2,y:e.y-this.initialSize/2},endPoint:{x:this.frame.width/2-this.initialSize/2,y:this.frame.height/2-this.initialSize/2}}},t.prototype.runDeactivationUXLogicIfReady=function(){var e=this,n=t.cssClasses.FG_DEACTIVATION,i=this.activationState,r=i.hasDeactivationUXRun,o=i.isActivated;(r||!o)&&this.activationAnimationHasEnded&&(this.rmBoundedActivationClasses(),this.adapter.addClass(n),this.fgDeactivationRemovalTimer=setTimeout((function(){e.adapter.removeClass(n)}),$e.FG_DEACTIVATION_MS))},t.prototype.rmBoundedActivationClasses=function(){var e=t.cssClasses.FG_ACTIVATION;this.adapter.removeClass(e),this.activationAnimationHasEnded=!1,this.adapter.computeBoundingRect()},t.prototype.resetActivationState=function(){var e=this;this.previousActivationEvent=this.activationState.activationEvent,this.activationState=this.defaultActivationState(),setTimeout((function(){return e.previousActivationEvent=void 0}),t.numbers.TAP_DELAY_MS)},t.prototype.deactivateImpl=function(){var e=this,t=this.activationState;if(t.isActivated){var n=ke({},t);t.isProgrammatic?(requestAnimationFrame((function(){e.animateDeactivation(n)})),this.resetActivationState()):(this.deregisterDeactivationHandlers(),requestAnimationFrame((function(){e.activationState.hasDeactivationUXRun=!0,e.animateDeactivation(n),e.resetActivationState()})))}},t.prototype.animateDeactivation=function(e){var t=e.wasActivatedByPointer,n=e.wasElementMadeActive;(t||n)&&this.runDeactivationUXLogicIfReady()},t.prototype.layoutInternal=function(){this.frame=this.adapter.computeBoundingRect();var e=Math.max(this.frame.height,this.frame.width);this.maxRadius=this.adapter.isUnbounded()?e:Math.sqrt(Math.pow(this.frame.width,2)+Math.pow(this.frame.height,2))+t.numbers.PADDING;var n=Math.floor(e*t.numbers.INITIAL_ORIGIN_SCALE);this.adapter.isUnbounded()&&n%2!=0?this.initialSize=n-1:this.initialSize=n,this.fgScale=""+this.maxRadius/this.initialSize,this.updateLayoutCssVars()},t.prototype.updateLayoutCssVars=function(){var e=t.strings,n=e.VAR_FG_SIZE,i=e.VAR_LEFT,r=e.VAR_TOP,o=e.VAR_FG_SCALE;this.adapter.updateCssVariable(n,this.initialSize+"px"),this.adapter.updateCssVariable(o,this.fgScale),this.adapter.isUnbounded()&&(this.unboundedCoords={left:Math.round(this.frame.width/2-this.initialSize/2),top:Math.round(this.frame.height/2-this.initialSize/2)},this.adapter.updateCssVariable(i,this.unboundedCoords.left+"px"),this.adapter.updateCssVariable(r,this.unboundedCoords.top+"px"))},t}(Oe),et=function(){function e(){this.rafIDs=new Map}return e.prototype.request=function(e,t){var n=this;this.cancel(e);var i=requestAnimationFrame((function(i){n.rafIDs.delete(e),t(i)}));this.rafIDs.set(e,i)},e.prototype.cancel=function(e){var t=this.rafIDs.get(e);t&&(cancelAnimationFrame(t),this.rafIDs.delete(e))},e.prototype.cancelAll=function(){var e=this;this.rafIDs.forEach((function(t,n){e.cancel(n)}))},e.prototype.getQueue=function(){var e=[];return this.rafIDs.forEach((function(t,n){e.push(n)})),e},e}(),tt={CLOSING:"mdc-dialog--closing",OPEN:"mdc-dialog--open",OPENING:"mdc-dialog--opening",SCROLLABLE:"mdc-dialog--scrollable",SCROLL_LOCK:"mdc-dialog-scroll-lock",STACKED:"mdc-dialog--stacked",FULLSCREEN:"mdc-dialog--fullscreen",SCROLL_DIVIDER_HEADER:"mdc-dialog-scroll-divider-header",SCROLL_DIVIDER_FOOTER:"mdc-dialog-scroll-divider-footer",SURFACE_SCRIM_SHOWN:"mdc-dialog__surface-scrim--shown",SURFACE_SCRIM_SHOWING:"mdc-dialog__surface-scrim--showing",SURFACE_SCRIM_HIDING:"mdc-dialog__surface-scrim--hiding",SCRIM_HIDDEN:"mdc-dialog__scrim--hidden"},nt={ACTION_ATTRIBUTE:"data-mdc-dialog-action",BUTTON_DEFAULT_ATTRIBUTE:"data-mdc-dialog-button-default",BUTTON_SELECTOR:".mdc-dialog__button",CLOSED_EVENT:"MDCDialog:closed",CLOSE_ACTION:"close",CLOSING_EVENT:"MDCDialog:closing",CONTAINER_SELECTOR:".mdc-dialog__container",CONTENT_SELECTOR:".mdc-dialog__content",DESTROY_ACTION:"destroy",INITIAL_FOCUS_ATTRIBUTE:"data-mdc-dialog-initial-focus",OPENED_EVENT:"MDCDialog:opened",OPENING_EVENT:"MDCDialog:opening",SCRIM_SELECTOR:".mdc-dialog__scrim",SUPPRESS_DEFAULT_PRESS_SELECTOR:["textarea",".mdc-menu .mdc-list-item",".mdc-menu .mdc-deprecated-list-item"].join(", "),SURFACE_SELECTOR:".mdc-dialog__surface"},it={DIALOG_ANIMATION_CLOSE_TIME_MS:75,DIALOG_ANIMATION_OPEN_TIME_MS:150};
/**
     * @license
     * Copyright 2019 Google Inc.
     *
     * Permission is hereby granted, free of charge, to any person obtaining a copy
     * of this software and associated documentation files (the "Software"), to deal
     * in the Software without restriction, including without limitation the rights
     * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
     * copies of the Software, and to permit persons to whom the Software is
     * furnished to do so, subject to the following conditions:
     *
     * The above copyright notice and this permission notice shall be included in
     * all copies or substantial portions of the Software.
     *
     * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
     * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
     * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
     * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
     * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
     * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
     * THE SOFTWARE.
     */!function(e){e.POLL_SCROLL_POS="poll_scroll_position",e.POLL_LAYOUT_CHANGE="poll_layout_change"}(Ue||(Ue={}));var rt=function(e){function t(n){var i=e.call(this,ke(ke({},t.defaultAdapter),n))||this;return i.dialogOpen=!1,i.isFullscreen=!1,i.animationFrame=0,i.animationTimer=0,i.escapeKeyAction=nt.CLOSE_ACTION,i.scrimClickAction=nt.CLOSE_ACTION,i.autoStackButtons=!0,i.areButtonsStacked=!1,i.suppressDefaultPressSelector=nt.SUPPRESS_DEFAULT_PRESS_SELECTOR,i.animFrame=new et,i.contentScrollHandler=function(){i.handleScrollEvent()},i.windowResizeHandler=function(){i.layout()},i.windowOrientationChangeHandler=function(){i.layout()},i}return Ve(t,e),Object.defineProperty(t,"cssClasses",{get:function(){return tt},enumerable:!1,configurable:!0}),Object.defineProperty(t,"strings",{get:function(){return nt},enumerable:!1,configurable:!0}),Object.defineProperty(t,"numbers",{get:function(){return it},enumerable:!1,configurable:!0}),Object.defineProperty(t,"defaultAdapter",{get:function(){return{addBodyClass:function(){},addClass:function(){},areButtonsStacked:function(){return!1},clickDefaultButton:function(){},eventTargetMatches:function(){return!1},getActionFromEvent:function(){return""},getInitialFocusEl:function(){return null},hasClass:function(){return!1},isContentScrollable:function(){return!1},notifyClosed:function(){},notifyClosing:function(){},notifyOpened:function(){},notifyOpening:function(){},releaseFocus:function(){},removeBodyClass:function(){},removeClass:function(){},reverseButtons:function(){},trapFocus:function(){},registerContentEventHandler:function(){},deregisterContentEventHandler:function(){},isScrollableContentAtTop:function(){return!1},isScrollableContentAtBottom:function(){return!1},registerWindowEventHandler:function(){},deregisterWindowEventHandler:function(){}}},enumerable:!1,configurable:!0}),t.prototype.init=function(){this.adapter.hasClass(tt.STACKED)&&this.setAutoStackButtons(!1),this.isFullscreen=this.adapter.hasClass(tt.FULLSCREEN)},t.prototype.destroy=function(){this.animationTimer&&(clearTimeout(this.animationTimer),this.handleAnimationTimerEnd()),this.isFullscreen&&this.adapter.deregisterContentEventHandler("scroll",this.contentScrollHandler),this.animFrame.cancelAll(),this.adapter.deregisterWindowEventHandler("resize",this.windowResizeHandler),this.adapter.deregisterWindowEventHandler("orientationchange",this.windowOrientationChangeHandler)},t.prototype.open=function(e){var t=this;this.dialogOpen=!0,this.adapter.notifyOpening(),this.adapter.addClass(tt.OPENING),this.isFullscreen&&this.adapter.registerContentEventHandler("scroll",this.contentScrollHandler),e&&e.isAboveFullscreenDialog&&this.adapter.addClass(tt.SCRIM_HIDDEN),this.adapter.registerWindowEventHandler("resize",this.windowResizeHandler),this.adapter.registerWindowEventHandler("orientationchange",this.windowOrientationChangeHandler),this.runNextAnimationFrame((function(){t.adapter.addClass(tt.OPEN),t.adapter.addBodyClass(tt.SCROLL_LOCK),t.layout(),t.animationTimer=setTimeout((function(){t.handleAnimationTimerEnd(),t.adapter.trapFocus(t.adapter.getInitialFocusEl()),t.adapter.notifyOpened()}),it.DIALOG_ANIMATION_OPEN_TIME_MS)}))},t.prototype.close=function(e){var t=this;void 0===e&&(e=""),this.dialogOpen&&(this.dialogOpen=!1,this.adapter.notifyClosing(e),this.adapter.addClass(tt.CLOSING),this.adapter.removeClass(tt.OPEN),this.adapter.removeBodyClass(tt.SCROLL_LOCK),this.isFullscreen&&this.adapter.deregisterContentEventHandler("scroll",this.contentScrollHandler),this.adapter.deregisterWindowEventHandler("resize",this.windowResizeHandler),this.adapter.deregisterWindowEventHandler("orientationchange",this.windowOrientationChangeHandler),cancelAnimationFrame(this.animationFrame),this.animationFrame=0,clearTimeout(this.animationTimer),this.animationTimer=setTimeout((function(){t.adapter.releaseFocus(),t.handleAnimationTimerEnd(),t.adapter.notifyClosed(e)}),it.DIALOG_ANIMATION_CLOSE_TIME_MS))},t.prototype.showSurfaceScrim=function(){var e=this;this.adapter.addClass(tt.SURFACE_SCRIM_SHOWING),this.runNextAnimationFrame((function(){e.adapter.addClass(tt.SURFACE_SCRIM_SHOWN)}))},t.prototype.hideSurfaceScrim=function(){this.adapter.removeClass(tt.SURFACE_SCRIM_SHOWN),this.adapter.addClass(tt.SURFACE_SCRIM_HIDING)},t.prototype.handleSurfaceScrimTransitionEnd=function(){this.adapter.removeClass(tt.SURFACE_SCRIM_HIDING),this.adapter.removeClass(tt.SURFACE_SCRIM_SHOWING)},t.prototype.isOpen=function(){return this.dialogOpen},t.prototype.getEscapeKeyAction=function(){return this.escapeKeyAction},t.prototype.setEscapeKeyAction=function(e){this.escapeKeyAction=e},t.prototype.getScrimClickAction=function(){return this.scrimClickAction},t.prototype.setScrimClickAction=function(e){this.scrimClickAction=e},t.prototype.getAutoStackButtons=function(){return this.autoStackButtons},t.prototype.setAutoStackButtons=function(e){this.autoStackButtons=e},t.prototype.getSuppressDefaultPressSelector=function(){return this.suppressDefaultPressSelector},t.prototype.setSuppressDefaultPressSelector=function(e){this.suppressDefaultPressSelector=e},t.prototype.layout=function(){var e=this;this.animFrame.request(Ue.POLL_LAYOUT_CHANGE,(function(){e.layoutInternal()}))},t.prototype.handleClick=function(e){if(this.adapter.eventTargetMatches(e.target,nt.SCRIM_SELECTOR)&&""!==this.scrimClickAction)this.close(this.scrimClickAction);else{var t=this.adapter.getActionFromEvent(e);t&&this.close(t)}},t.prototype.handleKeydown=function(e){var t="Enter"===e.key||13===e.keyCode;if(t&&!this.adapter.getActionFromEvent(e)){var n=e.composedPath?e.composedPath()[0]:e.target,i=!this.suppressDefaultPressSelector||!this.adapter.eventTargetMatches(n,this.suppressDefaultPressSelector);t&&i&&this.adapter.clickDefaultButton()}},t.prototype.handleDocumentKeydown=function(e){("Escape"===e.key||27===e.keyCode)&&""!==this.escapeKeyAction&&this.close(this.escapeKeyAction)},t.prototype.handleScrollEvent=function(){var e=this;this.animFrame.request(Ue.POLL_SCROLL_POS,(function(){e.toggleScrollDividerHeader(),e.toggleScrollDividerFooter()}))},t.prototype.layoutInternal=function(){this.autoStackButtons&&this.detectStackedButtons(),this.toggleScrollableClasses()},t.prototype.handleAnimationTimerEnd=function(){this.animationTimer=0,this.adapter.removeClass(tt.OPENING),this.adapter.removeClass(tt.CLOSING)},t.prototype.runNextAnimationFrame=function(e){var t=this;cancelAnimationFrame(this.animationFrame),this.animationFrame=requestAnimationFrame((function(){t.animationFrame=0,clearTimeout(t.animationTimer),t.animationTimer=setTimeout(e,0)}))},t.prototype.detectStackedButtons=function(){this.adapter.removeClass(tt.STACKED);var e=this.adapter.areButtonsStacked();e&&this.adapter.addClass(tt.STACKED),e!==this.areButtonsStacked&&(this.adapter.reverseButtons(),this.areButtonsStacked=e)},t.prototype.toggleScrollableClasses=function(){this.adapter.removeClass(tt.SCROLLABLE),this.adapter.isContentScrollable()&&(this.adapter.addClass(tt.SCROLLABLE),this.isFullscreen&&(this.toggleScrollDividerHeader(),this.toggleScrollDividerFooter()))},t.prototype.toggleScrollDividerHeader=function(){this.adapter.isScrollableContentAtTop()?this.adapter.hasClass(tt.SCROLL_DIVIDER_HEADER)&&this.adapter.removeClass(tt.SCROLL_DIVIDER_HEADER):this.adapter.addClass(tt.SCROLL_DIVIDER_HEADER)},t.prototype.toggleScrollDividerFooter=function(){this.adapter.isScrollableContentAtBottom()?this.adapter.hasClass(tt.SCROLL_DIVIDER_FOOTER)&&this.adapter.removeClass(tt.SCROLL_DIVIDER_FOOTER):this.adapter.addClass(tt.SCROLL_DIVIDER_FOOTER)},t}(Oe);function ot(e){return Object.entries(e).filter((([e,t])=>""!==e&&t)).map((([e])=>e)).join(" ")}function at(e,t,n,i={bubbles:!0},r=!1){if("undefined"!=typeof Event&&e){const o=new CustomEvent(t,Object.assign(Object.assign({},i),{detail:n}));if(null==e||e.dispatchEvent(o),r&&t.startsWith("SMUI")){const r=new CustomEvent(t.replace(/^SMUI/g,(()=>"MDC")),Object.assign(Object.assign({},i),{detail:n}));null==e||e.dispatchEvent(r),r.defaultPrevented&&o.preventDefault()}return o}}function st(e,t){let n=Object.getOwnPropertyNames(e);const i={};for(let r=0;r<n.length;r++){const o=n[r],a=o.indexOf("$");-1!==a&&-1!==t.indexOf(o.substring(0,a+1))||-1===t.indexOf(o)&&(i[o]=e[o])}return i}const lt=/^[a-z]+(?::(?:preventDefault|stopPropagation|passive|nonpassive|capture|once|self))+$/,pt=/^[^$]+(?:\$(?:preventDefault|stopPropagation|passive|nonpassive|capture|once|self))+$/;function ut(e){let t,n=[];function i(t){!function(e,t){const n=e.$$.callbacks[t.type];n&&n.slice().forEach((e=>e.call(this,t)))}(e,t)}return e.$on=(e,i)=>{let r=e,o=()=>{};return t?o=t(r,i):n.push([r,i]),r.match(lt)&&console&&console.warn('Event modifiers in SMUI now use "$" instead of ":", so that all events can be bound with modifiers. Please update your event binding: ',r),()=>{o()}},e=>{const r=[],o={};t=(t,n)=>{let a=t,s=n,l=!1;const p=a.match(lt),u=a.match(pt),h=p||u;if(a.match(/^SMUI:\w+:/)){const e=a.split(":");let t="";for(let n=0;n<e.length;n++)t+=n===e.length-1?":"+e[n]:e[n].split("-").map((e=>e.slice(0,1).toUpperCase()+e.slice(1))).join("");console.warn(`The event ${a.split("$")[0]} has been renamed to ${t.split("$")[0]}.`),a=t}if(h){const e=a.split(p?":":"$");a=e[0];const t=Object.fromEntries(e.slice(1).map((e=>[e,!0])));t.passive&&(l=l||{},l.passive=!0),t.nonpassive&&(l=l||{},l.passive=!1),t.capture&&(l=l||{},l.capture=!0),t.once&&(l=l||{},l.once=!0),t.preventDefault&&(c=s,s=function(e){return e.preventDefault(),c.call(this,e)}),t.stopPropagation&&(s=function(e){return function(t){return t.stopPropagation(),e.call(this,t)}}(s))}var c;const _=L(e,a,s,l),d=()=>{_();const e=r.indexOf(d);e>-1&&r.splice(e,1)};return r.push(d),a in o||(o[a]=L(e,a,i)),d};for(let e=0;e<n.length;e++)t(n[e][0],n[e][1]);return{destroy:()=>{for(let e=0;e<r.length;e++)r[e]();for(let e of Object.entries(o))e[1]()}}}}function ht(e,t){let n=Object.getOwnPropertyNames(e);const i={};for(let r=0;r<n.length;r++){const o=n[r];o.substring(0,t.length)===t&&(i[o.substring(t.length)]=e[o])}return i}function ct(e,t){let n=[];if(t)for(let i=0;i<t.length;i++){const r=t[i],o=Array.isArray(r)?r[0]:r;Array.isArray(r)&&r.length>1?n.push(o(e,r[1])):n.push(o(e))}return{update(e){if((e&&e.length||0)!=n.length)throw new Error("You must not change the length of an actions array.");if(e)for(let t=0;t<e.length;t++){const i=n[t];if(i&&i.update){const n=e[t];Array.isArray(n)&&n.length>1?i.update(n[1]):i.update()}}},destroy(){for(let e=0;e<n.length;e++){const t=n[e];t&&t.destroy&&t.destroy()}}}}const{document:_t,window:dt}=se,mt=e=>({}),Pt=e=>({});function ft(t){let n,i,r;return{c(){n=M("div"),B(n,"class","mdc-dialog__surface-scrim")},m(e,o){w(e,n,o),i||(r=L(n,"transitionend",t[31]),i=!0)},p:e,d(e){e&&Z(n),i=!1,r()}}}function xt(e){let n,i,a,s,l,p,u,h,c,d,x,y,v,g,E;const S=e[27].default,C=_(S,e,e[26],null);let A=e[5]&&ft(e),V=[{class:p=ot({[e[7]]:!0,"mdc-dialog__surface":!0})},{role:"alertdialog"},{"aria-modal":"true"},ht(e[17],"surface$")],k={};for(let e=0;e<V.length;e+=1)k=t(k,V[e]);let I=[{class:u=ot({[e[6]]:!0,"mdc-dialog__container":!0})},ht(e[17],"container$")],O={};for(let e=0;e<I.length;e+=1)O=t(O,I[e]);let R=[{class:d=ot({[e[2]]:!0,"mdc-dialog":!0,"mdc-dialog--stacked":!e[4],"mdc-dialog--fullscreen":e[5],"smui-dialog--selection":e[3],...e[10]})},{role:"alertdialog"},{"aria-modal":"true"},st(e[17],["container$","surface$"])],H={};for(let e=0;e<R.length;e+=1)H=t(H,R[e]);const F=e[27].over,D=_(F,e,e[26],Pt);return{c(){n=N(),i=M("div"),a=M("div"),s=M("div"),C&&C.c(),l=N(),A&&A.c(),h=N(),c=M("div"),y=N(),D&&D.c(),T(s,k),T(a,O),B(c,"class","mdc-dialog__scrim"),T(i,H)},m(t,r){w(t,n,r),w(t,i,r),z(i,a),z(a,s),C&&C.m(s,null),z(s,l),A&&A.m(s,null),z(i,h),z(i,c),e[32](i),w(t,y,r),D&&D.m(t,r),v=!0,g||(E=[L(dt,"resize",e[28]),L(dt,"orientationchange",e[29]),L(_t.body,"keydown",e[30]),b(x=ct.call(null,i,e[1])),b(e[11].call(null,i)),L(i,"SMUIDialog:opening",e[14]),L(i,"SMUIDialog:opened",e[15]),L(i,"SMUIDialog:closed",e[16]),L(i,"click",e[33]),L(i,"keydown",e[34])],g=!0)},p(e,t){C&&C.p&&(!v||67108864&t[0])&&P(C,S,e,e[26],v?m(S,e[26],t,null):f(e[26]),null),e[5]?A?A.p(e,t):(A=ft(e),A.c(),A.m(s,null)):A&&(A.d(1),A=null),T(s,k=ue(V,[(!v||128&t[0]&&p!==(p=ot({[e[7]]:!0,"mdc-dialog__surface":!0})))&&{class:p},{role:"alertdialog"},{"aria-modal":"true"},131072&t[0]&&ht(e[17],"surface$")])),T(a,O=ue(I,[(!v||64&t[0]&&u!==(u=ot({[e[6]]:!0,"mdc-dialog__container":!0})))&&{class:u},131072&t[0]&&ht(e[17],"container$")])),T(i,H=ue(R,[(!v||1084&t[0]&&d!==(d=ot({[e[2]]:!0,"mdc-dialog":!0,"mdc-dialog--stacked":!e[4],"mdc-dialog--fullscreen":e[5],"smui-dialog--selection":e[3],...e[10]})))&&{class:d},{role:"alertdialog"},{"aria-modal":"true"},131072&t[0]&&st(e[17],["container$","surface$"])])),x&&o(x.update)&&2&t[0]&&x.update.call(null,e[1]),D&&D.p&&(!v||67108864&t[0])&&P(D,F,e,e[26],v?m(F,e[26],t,mt):f(e[26]),Pt)},i(e){v||(oe(C,e),oe(D,e),v=!0)},o(e){ae(C,e),ae(D,e),v=!1},d(t){t&&Z(n),t&&Z(i),C&&C.d(t),A&&A.d(),e[32](null),t&&Z(y),D&&D.d(t),g=!1,r(E)}}}function yt(e,n,i){const r=["use","class","open","selection","escapeKeyAction","scrimClickAction","autoStackButtons","fullscreen","container$class","surface$class","isOpen","setOpen","layout","getElement"];let o,a,s=y(n,r),{$$slots:l={},$$scope:p}=n;var u;const{FocusTrap:h}=Fe,{closest:_,matches:d}=je,m=ut(R());let P,f,v,{use:b=[]}=n,{class:z=""}=n,{open:w=!1}=n,{selection:Z=!1}=n,{escapeKeyAction:E="close"}=n,{scrimClickAction:M="close"}=n,{autoStackButtons:S=!0}=n,{fullscreen:C=!1}=n,{container$class:N=""}=n,{surface$class:A=""}=n,L={},B=ve(!1);c(e,B,(e=>i(38,a=e)));let T=G("SMUI:dialog:aboveFullscreen"),V=null!==(u=G("SMUI:dialog:aboveFullscreenShown"))&&void 0!==u?u:ve(!1);c(e,V,(e=>i(25,o=e)));let k,I=G("SMUI:addLayoutListener"),O=[];D("SMUI:dialog:actions:reversed",B),D("SMUI:addLayoutListener",(e=>(O.push(e),()=>{const t=O.indexOf(e);t>=0&&O.splice(t,1)}))),D("SMUI:dialog:selection",Z),D("SMUI:dialog:aboveFullscreen",T||C),D("SMUI:dialog:aboveFullscreenShown",V),I&&(k=I(Y));let U=o;function W(e){return e in L?L[e]:K().classList.contains(e)}function q(e){L[e]||i(10,L[e]=!0,L)}function J(e){e in L&&!L[e]||i(10,L[e]=!1,L)}function $(){return P.querySelector(".mdc-dialog__content")}function X(){return P.querySelector("[data-mdc-dialog-initial-focus]")}function Y(){return f.layout()}function K(){return P}return H((()=>{var e;return v=new h(P,{initialFocusEl:null!==(e=X())&&void 0!==e?e:void 0}),i(8,f=new rt({addBodyClass:e=>document.body.classList.add(e),addClass:q,areButtonsStacked:()=>{return e=[].slice.call(P.querySelectorAll(".mdc-dialog__button")),t=new Set,[].forEach.call(e,(function(e){return t.add(e.offsetTop)})),t.size>1;var e,t},clickDefaultButton:()=>{const e=P.querySelector("[data-mdc-dialog-button-default");e&&e.click()},eventTargetMatches:(e,t)=>!!e&&d(e,t),getActionFromEvent:e=>{if(!e.target)return"";const t=_(e.target,"[data-mdc-dialog-action]");return t&&t.getAttribute("data-mdc-dialog-action")},getInitialFocusEl:X,hasClass:W,isContentScrollable:()=>{return!!(e=$())&&e.scrollHeight>e.offsetHeight;
/**
     * @license
     * Copyright 2016 Google Inc.
     *
     * Permission is hereby granted, free of charge, to any person obtaining a copy
     * of this software and associated documentation files (the "Software"), to deal
     * in the Software without restriction, including without limitation the rights
     * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
     * copies of the Software, and to permit persons to whom the Software is
     * furnished to do so, subject to the following conditions:
     *
     * The above copyright notice and this permission notice shall be included in
     * all copies or substantial portions of the Software.
     *
     * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
     * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
     * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
     * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
     * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
     * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
     * THE SOFTWARE.
     */var e},notifyClosed:e=>{i(0,w=!1),at(K(),"SMUIDialog:closed",e?{action:e}:{},void 0,!0)},notifyClosing:e=>at(K(),"SMUIDialog:closing",e?{action:e}:{},void 0,!0),notifyOpened:()=>at(K(),"SMUIDialog:opened",{},void 0,!0),notifyOpening:()=>at(K(),"SMUIDialog:opening",{},void 0,!0),releaseFocus:()=>v.releaseFocus(),removeBodyClass:e=>document.body.classList.remove(e),removeClass:J,reverseButtons:()=>{g(B,a=!0,a)},trapFocus:()=>v.trapFocus(),registerContentEventHandler:(e,t)=>{const n=$();n instanceof HTMLElement&&n.addEventListener(e,t)},deregisterContentEventHandler:(e,t)=>{const n=$();n instanceof HTMLElement&&n.removeEventListener(e,t)},isScrollableContentAtTop:()=>{return!!(e=$())&&0===e.scrollTop;var e},isScrollableContentAtBottom:()=>{return!!(e=$())&&Math.ceil(e.scrollHeight-e.scrollTop)===e.clientHeight;var e},registerWindowEventHandler:(e,t)=>{window.addEventListener(e,t)},deregisterWindowEventHandler:(e,t)=>{window.removeEventListener(e,t)}})),f.init(),()=>{f.destroy()}})),F((()=>{k&&k()})),e.$$set=e=>{n=t(t({},n),x(e)),i(17,s=y(n,r)),"use"in e&&i(1,b=e.use),"class"in e&&i(2,z=e.class),"open"in e&&i(0,w=e.open),"selection"in e&&i(3,Z=e.selection),"escapeKeyAction"in e&&i(18,E=e.escapeKeyAction),"scrimClickAction"in e&&i(19,M=e.scrimClickAction),"autoStackButtons"in e&&i(4,S=e.autoStackButtons),"fullscreen"in e&&i(5,C=e.fullscreen),"container$class"in e&&i(6,N=e.container$class),"surface$class"in e&&i(7,A=e.surface$class),"$$scope"in e&&i(26,p=e.$$scope)},e.$$.update=()=>{262400&e.$$.dirty[0]&&f&&f.getEscapeKeyAction()!==E&&f.setEscapeKeyAction(E),524544&e.$$.dirty[0]&&f&&f.getScrimClickAction()!==M&&f.setScrimClickAction(M),272&e.$$.dirty[0]&&f&&f.getAutoStackButtons()!==S&&f.setAutoStackButtons(S),16&e.$$.dirty[0]&&(S||g(B,a=!0,a)),257&e.$$.dirty[0]&&f&&f.isOpen()!==w&&(w?f.open({isAboveFullscreenDialog:!!T}):f.close()),50331936&e.$$.dirty[0]&&C&&f&&U!==o&&(i(24,U=o),o?f.showSurfaceScrim():f.hideSurfaceScrim())},[w,b,z,Z,S,C,N,A,f,P,L,m,B,V,function(){T&&g(V,o=!0,o),requestAnimationFrame((()=>{O.forEach((e=>e()))}))},function(){O.forEach((e=>e()))},function(){T&&g(V,o=!1,o)},s,E,M,function(){return w},function(e){i(0,w=e)},Y,K,U,o,p,l,()=>w&&f&&f.layout(),()=>w&&f&&f.layout(),e=>w&&f&&f.handleDocumentKeydown(e),()=>f&&f.handleSurfaceScrimTransitionEnd(),function(e){j[e?"unshift":"push"]((()=>{P=e,i(9,P)}))},e=>f&&f.handleClick(e),e=>f&&f.handleKeydown(e)]}class vt extends Pe{constructor(e){super(),me(this,e,yt,xt,a,{use:1,class:2,open:0,selection:3,escapeKeyAction:18,scrimClickAction:19,autoStackButtons:4,fullscreen:5,container$class:6,surface$class:7,isOpen:20,setOpen:21,layout:22,getElement:23},null,[-1,-1])}get isOpen(){return this.$$.ctx[20]}get setOpen(){return this.$$.ctx[21]}get layout(){return this.$$.ctx[22]}get getElement(){return this.$$.ctx[23]}}function gt(e){let n,i,a,s,l;const p=e[6].default,u=_(p,e,e[5],null);let h=[e[3]],c={};for(let e=0;e<h.length;e+=1)c=t(c,h[e]);return{c(){n=M("div"),u&&u.c(),T(n,c)},m(t,r){w(t,n,r),u&&u.m(n,null),e[7](n),a=!0,s||(l=[b(i=ct.call(null,n,e[0])),b(e[2].call(null,n))],s=!0)},p(e,[t]){u&&u.p&&(!a||32&t)&&P(u,p,e,e[5],a?m(p,e[5],t,null):f(e[5]),null),T(n,c=ue(h,[8&t&&e[3]])),i&&o(i.update)&&1&t&&i.update.call(null,e[0])},i(e){a||(oe(u,e),a=!0)},o(e){ae(u,e),a=!1},d(t){t&&Z(n),u&&u.d(t),e[7](null),s=!1,r(l)}}}function bt(e,n,i){const r=["use","getElement"];let o=y(n,r),{$$slots:a={},$$scope:s}=n,{use:l=[]}=n;const p=ut(R());let u;return e.$$set=e=>{n=t(t({},n),x(e)),i(3,o=y(n,r)),"use"in e&&i(0,l=e.use),"$$scope"in e&&i(5,s=e.$$scope)},[l,u,p,o,function(){return u},s,a,function(e){j[e?"unshift":"push"]((()=>{u=e,i(1,u)}))}]}class zt extends Pe{constructor(e){super(),me(this,e,bt,gt,a,{use:0,getElement:4})}get getElement(){return this.$$.ctx[4]}}function wt(e){let t;const n=e[10].default,i=_(n,e,e[12],null);return{c(){i&&i.c()},m(e,n){i&&i.m(e,n),t=!0},p(e,r){i&&i.p&&(!t||4096&r)&&P(i,n,e,e[12],t?m(n,e[12],r,null):f(e[12]),null)},i(e){t||(oe(i,e),t=!0)},o(e){ae(i,e),t=!1},d(e){i&&i.d(e)}}}function Zt(e){let n,i,r;const o=[{use:[e[7],...e[0]]},{class:ot({[e[1]]:!0,[e[5]]:!0,...e[4]})},e[6],e[8]];var a=e[2];function s(e){let n={$$slots:{default:[wt]},$$scope:{ctx:e}};for(let e=0;e<o.length;e+=1)n=t(n,o[e]);return{props:n}}return a&&(n=new a(s(e)),e[11](n)),{c(){n&&ce(n.$$.fragment),i=A()},m(e,t){n&&_e(n,e,t),w(e,i,t),r=!0},p(e,[t]){const r=499&t?ue(o,[129&t&&{use:[e[7],...e[0]]},50&t&&{class:ot({[e[1]]:!0,[e[5]]:!0,...e[4]})},64&t&&he(e[6]),256&t&&he(e[8])]):{};if(4096&t&&(r.$$scope={dirty:t,ctx:e}),a!==(a=e[2])){if(n){ie();const e=n;ae(e.$$.fragment,1,0,(()=>{de(e,1)})),re()}a?(n=new a(s(e)),e[11](n),ce(n.$$.fragment),oe(n.$$.fragment,1),_e(n,i.parentNode,i)):n=null}else a&&n.$set(r)},i(e){r||(n&&oe(n.$$.fragment,e),r=!0)},o(e){n&&ae(n.$$.fragment,e),r=!1},d(t){e[11](null),t&&Z(i),n&&de(n,t)}}}const Et={component:zt,class:"",classMap:{},contexts:{},props:{}};function Mt(e,n,i){const r=["use","class","component","getElement"];let o,a=y(n,r),{$$slots:s={},$$scope:l}=n,{use:p=[]}=n,{class:u=""}=n;const h=Et.class,c={},_=[],d=Et.contexts,m=Et.props;let{component:P=Et.component}=n;Object.entries(Et.classMap).forEach((([e,t])=>{const n=G(t);n&&"subscribe"in n&&_.push(n.subscribe((t=>{i(4,c[e]=t,c)})))}));const f=ut(R());for(let e in d)d.hasOwnProperty(e)&&D(e,d[e]);return F((()=>{for(const e of _)e()})),e.$$set=e=>{n=t(t({},n),x(e)),i(8,a=y(n,r)),"use"in e&&i(0,p=e.use),"class"in e&&i(1,u=e.class),"component"in e&&i(2,P=e.component),"$$scope"in e&&i(12,l=e.$$scope)},[p,u,P,o,c,h,m,f,a,function(){return o.getElement()},s,function(e){j[e?"unshift":"push"]((()=>{o=e,i(3,o)}))},l]}class St extends Pe{constructor(e){super(),me(this,e,Mt,Zt,a,{use:0,class:1,component:2,getElement:9})}get getElement(){return this.$$.ctx[9]}}const Ct=Object.assign({},Et);function Nt(e){return new Proxy(St,{construct:function(t,n){return Object.assign(Et,Ct,e),new t(...n)},get:function(t,n){return Object.assign(Et,Ct,e),t[n]}})}function At(e){let n,i,a,s,l;const p=e[7].default,u=_(p,e,e[6],null);let h=[{href:e[1]},e[4]],c={};for(let e=0;e<h.length;e+=1)c=t(c,h[e]);return{c(){n=M("a"),u&&u.c(),T(n,c)},m(t,r){w(t,n,r),u&&u.m(n,null),e[8](n),a=!0,s||(l=[b(i=ct.call(null,n,e[0])),b(e[3].call(null,n))],s=!0)},p(e,[t]){u&&u.p&&(!a||64&t)&&P(u,p,e,e[6],a?m(p,e[6],t,null):f(e[6]),null),T(n,c=ue(h,[(!a||2&t)&&{href:e[1]},16&t&&e[4]])),i&&o(i.update)&&1&t&&i.update.call(null,e[0])},i(e){a||(oe(u,e),a=!0)},o(e){ae(u,e),a=!1},d(t){t&&Z(n),u&&u.d(t),e[8](null),s=!1,r(l)}}}function Lt(e,n,i){const r=["use","href","getElement"];let o=y(n,r),{$$slots:a={},$$scope:s}=n,{use:l=[]}=n,{href:p="javascript:void(0);"}=n;const u=ut(R());let h;return e.$$set=e=>{n=t(t({},n),x(e)),i(4,o=y(n,r)),"use"in e&&i(0,l=e.use),"href"in e&&i(1,p=e.href),"$$scope"in e&&i(6,s=e.$$scope)},[l,p,h,u,o,function(){return h},s,a,function(e){j[e?"unshift":"push"]((()=>{h=e,i(2,h)}))}]}function Bt(e){let n,i,a,s,l;const p=e[6].default,u=_(p,e,e[5],null);let h=[e[3]],c={};for(let e=0;e<h.length;e+=1)c=t(c,h[e]);return{c(){n=M("button"),u&&u.c(),T(n,c)},m(t,r){w(t,n,r),u&&u.m(n,null),n.autofocus&&n.focus(),e[7](n),a=!0,s||(l=[b(i=ct.call(null,n,e[0])),b(e[2].call(null,n))],s=!0)},p(e,[t]){u&&u.p&&(!a||32&t)&&P(u,p,e,e[5],a?m(p,e[5],t,null):f(e[5]),null),T(n,c=ue(h,[8&t&&e[3]])),i&&o(i.update)&&1&t&&i.update.call(null,e[0])},i(e){a||(oe(u,e),a=!0)},o(e){ae(u,e),a=!1},d(t){t&&Z(n),u&&u.d(t),e[7](null),s=!1,r(l)}}}function Tt(e,n,i){const r=["use","getElement"];let o=y(n,r),{$$slots:a={},$$scope:s}=n,{use:l=[]}=n;const p=ut(R());let u;return e.$$set=e=>{n=t(t({},n),x(e)),i(3,o=y(n,r)),"use"in e&&i(0,l=e.use),"$$scope"in e&&i(5,s=e.$$scope)},[l,u,p,o,function(){return u},s,a,function(e){j[e?"unshift":"push"]((()=>{u=e,i(1,u)}))}]}function Vt(e){let n,i,a,s,l;const p=e[6].default,u=_(p,e,e[5],null);let h=[e[3]],c={};for(let e=0;e<h.length;e+=1)c=t(c,h[e]);return{c(){n=M("h2"),u&&u.c(),T(n,c)},m(t,r){w(t,n,r),u&&u.m(n,null),e[7](n),a=!0,s||(l=[b(i=ct.call(null,n,e[0])),b(e[2].call(null,n))],s=!0)},p(e,[t]){u&&u.p&&(!a||32&t)&&P(u,p,e,e[5],a?m(p,e[5],t,null):f(e[5]),null),T(n,c=ue(h,[8&t&&e[3]])),i&&o(i.update)&&1&t&&i.update.call(null,e[0])},i(e){a||(oe(u,e),a=!0)},o(e){ae(u,e),a=!1},d(t){t&&Z(n),u&&u.d(t),e[7](null),s=!1,r(l)}}}function kt(e,n,i){const r=["use","getElement"];let o=y(n,r),{$$slots:a={},$$scope:s}=n,{use:l=[]}=n;const p=ut(R());let u;return e.$$set=e=>{n=t(t({},n),x(e)),i(3,o=y(n,r)),"use"in e&&i(0,l=e.use),"$$scope"in e&&i(5,s=e.$$scope)},[l,u,p,o,function(){return u},s,a,function(e){j[e?"unshift":"push"]((()=>{u=e,i(1,u)}))}]}function It(e){let n,i,a,s,l;const p=e[6].default,u=_(p,e,e[5],null);let h=[e[3]],c={};for(let e=0;e<h.length;e+=1)c=t(c,h[e]);return{c(){n=M("i"),u&&u.c(),T(n,c)},m(t,r){w(t,n,r),u&&u.m(n,null),e[7](n),a=!0,s||(l=[b(i=ct.call(null,n,e[0])),b(e[2].call(null,n))],s=!0)},p(e,[t]){u&&u.p&&(!a||32&t)&&P(u,p,e,e[5],a?m(p,e[5],t,null):f(e[5]),null),T(n,c=ue(h,[8&t&&e[3]])),i&&o(i.update)&&1&t&&i.update.call(null,e[0])},i(e){a||(oe(u,e),a=!0)},o(e){ae(u,e),a=!1},d(t){t&&Z(n),u&&u.d(t),e[7](null),s=!1,r(l)}}}function Ot(e,n,i){const r=["use","getElement"];let o=y(n,r),{$$slots:a={},$$scope:s}=n,{use:l=[]}=n;const p=ut(R());let u;return e.$$set=e=>{n=t(t({},n),x(e)),i(3,o=y(n,r)),"use"in e&&i(0,l=e.use),"$$scope"in e&&i(5,s=e.$$scope)},[l,u,p,o,function(){return u},s,a,function(e){j[e?"unshift":"push"]((()=>{u=e,i(1,u)}))}]}class Rt extends Pe{constructor(e){super(),me(this,e,Ot,It,a,{use:0,getElement:4})}get getElement(){return this.$$.ctx[4]}}function Ht(e){let n,i,a,s,l;const p=e[6].default,u=_(p,e,e[5],null);let h=[e[3]],c={};for(let e=0;e<h.length;e+=1)c=t(c,h[e]);return{c(){n=M("span"),u&&u.c(),T(n,c)},m(t,r){w(t,n,r),u&&u.m(n,null),e[7](n),a=!0,s||(l=[b(i=ct.call(null,n,e[0])),b(e[2].call(null,n))],s=!0)},p(e,[t]){u&&u.p&&(!a||32&t)&&P(u,p,e,e[5],a?m(p,e[5],t,null):f(e[5]),null),T(n,c=ue(h,[8&t&&e[3]])),i&&o(i.update)&&1&t&&i.update.call(null,e[0])},i(e){a||(oe(u,e),a=!0)},o(e){ae(u,e),a=!1},d(t){t&&Z(n),u&&u.d(t),e[7](null),s=!1,r(l)}}}function Ft(e,n,i){const r=["use","getElement"];let o=y(n,r),{$$slots:a={},$$scope:s}=n,{use:l=[]}=n;const p=ut(R());let u;return e.$$set=e=>{n=t(t({},n),x(e)),i(3,o=y(n,r)),"use"in e&&i(0,l=e.use),"$$scope"in e&&i(5,s=e.$$scope)},[l,u,p,o,function(){return u},s,a,function(e){j[e?"unshift":"push"]((()=>{u=e,i(1,u)}))}]}class Dt extends Pe{constructor(e){super(),me(this,e,Ft,Ht,a,{use:0,getElement:4})}get getElement(){return this.$$.ctx[4]}}function Gt(e){let n,i,a,s,l;const p=e[6].default,u=_(p,e,e[5],null);let h=[e[3]],c={};for(let e=0;e<h.length;e+=1)c=t(c,h[e]);return{c(){n=S("svg"),u&&u.c(),V(n,c)},m(t,r){w(t,n,r),u&&u.m(n,null),e[7](n),a=!0,s||(l=[b(i=ct.call(null,n,e[0])),b(e[2].call(null,n))],s=!0)},p(e,[t]){u&&u.p&&(!a||32&t)&&P(u,p,e,e[5],a?m(p,e[5],t,null):f(e[5]),null),V(n,c=ue(h,[8&t&&e[3]])),i&&o(i.update)&&1&t&&i.update.call(null,e[0])},i(e){a||(oe(u,e),a=!0)},o(e){ae(u,e),a=!1},d(t){t&&Z(n),u&&u.d(t),e[7](null),s=!1,r(l)}}}function Ut(e,n,i){const r=["use","getElement"];let o=y(n,r),{$$slots:a={},$$scope:s}=n,{use:l=[]}=n;const p=ut(R());let u;return e.$$set=e=>{n=t(t({},n),x(e)),i(3,o=y(n,r)),"use"in e&&i(0,l=e.use),"$$scope"in e&&i(5,s=e.$$scope)},[l,u,p,o,function(){return u},s,a,function(e){j[e?"unshift":"push"]((()=>{u=e,i(1,u)}))}]}class jt extends Pe{constructor(e){super(),me(this,e,Ut,Gt,a,{use:0,getElement:4})}get getElement(){return this.$$.ctx[4]}}const Wt=class extends Pe{constructor(e){super(),me(this,e,Lt,At,a,{use:0,href:1,getElement:5})}get getElement(){return this.$$.ctx[5]}},qt=class extends Pe{constructor(e){super(),me(this,e,Tt,Bt,a,{use:0,getElement:4})}get getElement(){return this.$$.ctx[4]}},Jt=zt;Nt({class:"mdc-dialog__header",component:Jt,contexts:{"SMUI:icon-button:context":"dialog:header"}});var $t=Nt({class:"mdc-dialog__title",component:class extends Pe{constructor(e){super(),me(this,e,kt,Vt,a,{use:0,getElement:4})}get getElement(){return this.$$.ctx[4]}}});Nt({class:"mdc-dialog__content",component:Jt});var Xt=Nt({class:"mdc-dialog__actions",component:Jt,classMap:{"smui-dialog__actions--reversed":"SMUI:dialog:actions:reversed"},contexts:{"SMUI:button:context":"dialog:action"}});const{applyPassive:Yt}=We,{matches:Kt}=je;function Qt(e,{ripple:t=!0,surface:n=!1,unbounded:i=!1,disabled:r=!1,color:o,active:a,rippleElement:s,eventTarget:l,activeTarget:p,addClass:u=(t=>e.classList.add(t)),removeClass:h=(t=>e.classList.remove(t)),addStyle:c=((t,n)=>e.style.setProperty(t,n)),initPromise:_=Promise.resolve()}={}){let d,m,P=G("SMUI:addLayoutListener"),f=a,x=l,y=p;function v(){n?(u("mdc-ripple-surface"),"primary"===o?(u("smui-ripple-surface--primary"),h("smui-ripple-surface--secondary")):"secondary"===o?(h("smui-ripple-surface--primary"),u("smui-ripple-surface--secondary")):(h("smui-ripple-surface--primary"),h("smui-ripple-surface--secondary"))):(h("mdc-ripple-surface"),h("smui-ripple-surface--primary"),h("smui-ripple-surface--secondary")),d&&f!==a&&(f=a,a?d.activate():!1===a&&d.deactivate()),t&&!d?(d=new Qe({addClass:u,browserSupportsCssVars:()=>function(e,t){void 0===t&&(t=!1);var n,i=window.CSS;if("boolean"==typeof Ge&&!t)return Ge;if(!i||"function"!=typeof i.supports)return!1;var r=i.supports("--css-vars","yes"),o=i.supports("(--css-vars: yes)")&&i.supports("color","#00000000");return n=r||o,t||(Ge=n),n}(),computeBoundingRect:()=>(s||e).getBoundingClientRect(),containsEventTarget:t=>e.contains(t),deregisterDocumentInteractionHandler:(e,t)=>document.documentElement.removeEventListener(e,t,Yt()),deregisterInteractionHandler:(t,n)=>(l||e).removeEventListener(t,n,Yt()),deregisterResizeHandler:e=>window.removeEventListener("resize",e),getWindowPageOffset:()=>({x:window.pageXOffset,y:window.pageYOffset}),isSurfaceActive:()=>null==a?Kt(p||e,":active"):a,isSurfaceDisabled:()=>!!r,isUnbounded:()=>!!i,registerDocumentInteractionHandler:(e,t)=>document.documentElement.addEventListener(e,t,Yt()),registerInteractionHandler:(t,n)=>(l||e).addEventListener(t,n,Yt()),registerResizeHandler:e=>window.addEventListener("resize",e),removeClass:h,updateCssVariable:c}),_.then((()=>{d&&(d.init(),d.setUnbounded(i))}))):d&&!t&&_.then((()=>{d&&(d.destroy(),d=void 0)})),!d||x===l&&y===p||(x=l,y=p,d.destroy(),requestAnimationFrame((()=>{d&&(d.init(),d.setUnbounded(i))}))),!t&&i&&u("mdc-ripple-upgraded--unbounded")}return v(),P&&(m=P((function(){d&&d.layout()}))),{update(d){({ripple:t,surface:n,unbounded:i,disabled:r,color:o,active:a,rippleElement:s,eventTarget:l,activeTarget:p,addClass:u,removeClass:h,addStyle:c,initPromise:_}=Object.assign({ripple:!0,surface:!1,unbounded:!1,disabled:!1,color:void 0,active:void 0,rippleElement:void 0,eventTarget:void 0,activeTarget:void 0,addClass:t=>e.classList.add(t),removeClass:t=>e.classList.remove(t),addStyle:(t,n)=>e.style.setProperty(t,n),initPromise:Promise.resolve()},d)),v()},destroy(){d&&(d.destroy(),d=void 0,h("mdc-ripple-surface"),h("smui-ripple-surface--primary"),h("smui-ripple-surface--secondary")),m&&m()}}}function en(e){let t;return{c(){t=M("div"),B(t,"class","mdc-button__touch")},m(e,n){w(e,t,n)},d(e){e&&Z(t)}}}function tn(e){let t,n,i,r;const o=e[27].default,a=_(o,e,e[29],null);let s=e[6]&&en();return{c(){t=M("div"),n=N(),a&&a.c(),s&&s.c(),i=A(),B(t,"class","mdc-button__ripple")},m(e,o){w(e,t,o),w(e,n,o),a&&a.m(e,o),s&&s.m(e,o),w(e,i,o),r=!0},p(e,t){a&&a.p&&(!r||536870912&t)&&P(a,o,e,e[29],r?m(o,e[29],t,null):f(e[29]),null),e[6]?s||(s=en(),s.c(),s.m(i.parentNode,i)):s&&(s.d(1),s=null)},i(e){r||(oe(a,e),r=!0)},o(e){ae(a,e),r=!1},d(e){e&&Z(t),e&&Z(n),a&&a.d(e),s&&s.d(e),e&&Z(i)}}}function nn(e){let n,i,r;const o=[{use:[[Qt,{ripple:e[3],unbounded:!1,color:e[4],disabled:!!e[22].disabled,addClass:e[18],removeClass:e[19],addStyle:e[20]}],e[16],...e[0]]},{class:ot({[e[1]]:!0,"mdc-button":!0,"mdc-button--raised":"raised"===e[5],"mdc-button--unelevated":"unelevated"===e[5],"mdc-button--outlined":"outlined"===e[5],"smui-button--color-secondary":"secondary"===e[4],"mdc-button--touch":e[6],"mdc-card__action":"card:action"===e[17],"mdc-card__action--button":"card:action"===e[17],"mdc-dialog__button":"dialog:action"===e[17],"mdc-top-app-bar__navigation-icon":"top-app-bar:navigation"===e[17],"mdc-top-app-bar__action-item":"top-app-bar:action"===e[17],"mdc-snackbar__action":"snackbar:actions"===e[17],"mdc-banner__secondary-action":"banner"===e[17]&&e[8],"mdc-banner__primary-action":"banner"===e[17]&&!e[8],"mdc-tooltip__action":"tooltip:rich-actions"===e[17],...e[11]})},{style:Object.entries(e[12]).map(rn).concat([e[2]]).join(" ")},e[15],e[14],e[13],{href:e[7]},e[22]];var a=e[9];function s(e){let n={$$slots:{default:[tn]},$$scope:{ctx:e}};for(let e=0;e<o.length;e+=1)n=t(n,o[e]);return{props:n}}return a&&(n=new a(s(e)),e[28](n),n.$on("click",e[21])),{c(){n&&ce(n.$$.fragment),i=A()},m(e,t){n&&_e(n,e,t),w(e,i,t),r=!0},p(e,[t]){const r=6289919&t?ue(o,[6094873&t&&{use:[[Qt,{ripple:e[3],unbounded:!1,color:e[4],disabled:!!e[22].disabled,addClass:e[18],removeClass:e[19],addStyle:e[20]}],e[16],...e[0]]},133490&t&&{class:ot({[e[1]]:!0,"mdc-button":!0,"mdc-button--raised":"raised"===e[5],"mdc-button--unelevated":"unelevated"===e[5],"mdc-button--outlined":"outlined"===e[5],"smui-button--color-secondary":"secondary"===e[4],"mdc-button--touch":e[6],"mdc-card__action":"card:action"===e[17],"mdc-card__action--button":"card:action"===e[17],"mdc-dialog__button":"dialog:action"===e[17],"mdc-top-app-bar__navigation-icon":"top-app-bar:navigation"===e[17],"mdc-top-app-bar__action-item":"top-app-bar:action"===e[17],"mdc-snackbar__action":"snackbar:actions"===e[17],"mdc-banner__secondary-action":"banner"===e[17]&&e[8],"mdc-banner__primary-action":"banner"===e[17]&&!e[8],"mdc-tooltip__action":"tooltip:rich-actions"===e[17],...e[11]})},4100&t&&{style:Object.entries(e[12]).map(rn).concat([e[2]]).join(" ")},32768&t&&he(e[15]),16384&t&&he(e[14]),8192&t&&he(e[13]),128&t&&{href:e[7]},4194304&t&&he(e[22])]):{};if(536870976&t&&(r.$$scope={dirty:t,ctx:e}),a!==(a=e[9])){if(n){ie();const e=n;ae(e.$$.fragment,1,0,(()=>{de(e,1)})),re()}a?(n=new a(s(e)),e[28](n),n.$on("click",e[21]),ce(n.$$.fragment),oe(n.$$.fragment,1),_e(n,i.parentNode,i)):n=null}else a&&n.$set(r)},i(e){r||(n&&oe(n.$$.fragment,e),r=!0)},o(e){n&&ae(n.$$.fragment,e),r=!1},d(t){e[28](null),t&&Z(i),n&&de(n,t)}}}const rn=([e,t])=>`${e}: ${t};`;function on(e,n,i){let r,o,a;const s=["use","class","style","ripple","color","variant","touch","href","action","defaultAction","secondary","component","getElement"];let l=y(n,s),{$$slots:p={},$$scope:u}=n;const h=ut(R());let c,{use:_=[]}=n,{class:d=""}=n,{style:m=""}=n,{ripple:P=!0}=n,{color:f="primary"}=n,{variant:v="text"}=n,{touch:g=!1}=n,{href:b}=n,{action:z="close"}=n,{defaultAction:w=!1}=n,{secondary:Z=!1}=n,E={},M={},S=G("SMUI:button:context"),{component:C=(null==b?qt:Wt)}=n,N=l.disabled;function A(){return c.getElement()}return D("SMUI:label:context","button"),D("SMUI:icon:context","button"),e.$$set=e=>{i(30,n=t(t({},n),x(e))),i(22,l=y(n,s)),"use"in e&&i(0,_=e.use),"class"in e&&i(1,d=e.class),"style"in e&&i(2,m=e.style),"ripple"in e&&i(3,P=e.ripple),"color"in e&&i(4,f=e.color),"variant"in e&&i(5,v=e.variant),"touch"in e&&i(6,g=e.touch),"href"in e&&i(7,b=e.href),"action"in e&&i(23,z=e.action),"defaultAction"in e&&i(24,w=e.defaultAction),"secondary"in e&&i(8,Z=e.secondary),"component"in e&&i(9,C=e.component),"$$scope"in e&&i(29,u=e.$$scope)},e.$$.update=()=>{i(15,r="dialog:action"===S&&null!=z?{"data-mdc-dialog-action":z}:{action:n.action}),i(14,o="dialog:action"===S&&w?{"data-mdc-dialog-button-default":""}:{default:n.default}),i(13,a="banner"===S?{}:{secondary:n.secondary}),N!==l.disabled&&(A().blur(),i(26,N=l.disabled))},n=x(n),[_,d,m,P,f,v,g,b,Z,C,c,E,M,a,o,r,h,S,function(e){E[e]||i(11,E[e]=!0,E)},function(e){e in E&&!E[e]||i(11,E[e]=!1,E)},function(e,t){M[e]!=t&&(""===t||null==t?(delete M[e],i(12,M)):i(12,M[e]=t,M))},function(){"banner"===S&&at(A(),Z?"SMUIBannerButton:secondaryActionClick":"SMUIBannerButton:primaryActionClick")},l,z,w,A,N,p,function(e){j[e?"unshift":"push"]((()=>{c=e,i(10,c)}))},u]}class an extends Pe{constructor(e){super(),me(this,e,on,nn,a,{use:0,class:1,style:2,ripple:3,color:4,variant:5,touch:6,href:7,action:23,defaultAction:24,secondary:8,component:9,getElement:25})}get getElement(){return this.$$.ctx[25]}}function sn(e){let t;const n=e[9].default,i=_(n,e,e[11],null);return{c(){i&&i.c()},m(e,n){i&&i.m(e,n),t=!0},p(e,r){i&&i.p&&(!t||2048&r)&&P(i,n,e,e[11],t?m(n,e[11],r,null):f(e[11]),null)},i(e){t||(oe(i,e),t=!0)},o(e){ae(i,e),t=!1},d(e){i&&i.d(e)}}}function ln(e){let n,i,r;const o=[{use:[e[4],...e[0]]},{class:ot({[e[1]]:!0,"mdc-button__label":"button"===e[5],"mdc-fab__label":"fab"===e[5],"mdc-tab__text-label":"tab"===e[5],"mdc-image-list__label":"image-list"===e[5],"mdc-snackbar__label":"snackbar"===e[5],"mdc-banner__text":"banner"===e[5],"mdc-segmented-button__label":"segmented-button"===e[5],"mdc-data-table__pagination-rows-per-page-label":"data-table:pagination"===e[5],"mdc-data-table__header-cell-label":"data-table:sortable-header-cell"===e[5]})},"snackbar"===e[5]?{"aria-atomic":"false"}:{},{tabindex:e[6]},e[7]];var a=e[2];function s(e){let n={$$slots:{default:[sn]},$$scope:{ctx:e}};for(let e=0;e<o.length;e+=1)n=t(n,o[e]);return{props:n}}return a&&(n=new a(s(e)),e[10](n)),{c(){n&&ce(n.$$.fragment),i=A()},m(e,t){n&&_e(n,e,t),w(e,i,t),r=!0},p(e,[t]){const r=243&t?ue(o,[17&t&&{use:[e[4],...e[0]]},34&t&&{class:ot({[e[1]]:!0,"mdc-button__label":"button"===e[5],"mdc-fab__label":"fab"===e[5],"mdc-tab__text-label":"tab"===e[5],"mdc-image-list__label":"image-list"===e[5],"mdc-snackbar__label":"snackbar"===e[5],"mdc-banner__text":"banner"===e[5],"mdc-segmented-button__label":"segmented-button"===e[5],"mdc-data-table__pagination-rows-per-page-label":"data-table:pagination"===e[5],"mdc-data-table__header-cell-label":"data-table:sortable-header-cell"===e[5]})},32&t&&he("snackbar"===e[5]?{"aria-atomic":"false"}:{}),64&t&&{tabindex:e[6]},128&t&&he(e[7])]):{};if(2048&t&&(r.$$scope={dirty:t,ctx:e}),a!==(a=e[2])){if(n){ie();const e=n;ae(e.$$.fragment,1,0,(()=>{de(e,1)})),re()}a?(n=new a(s(e)),e[10](n),ce(n.$$.fragment),oe(n.$$.fragment,1),_e(n,i.parentNode,i)):n=null}else a&&n.$set(r)},i(e){r||(n&&oe(n.$$.fragment,e),r=!0)},o(e){n&&ae(n.$$.fragment,e),r=!1},d(t){e[10](null),t&&Z(i),n&&de(n,t)}}}function pn(e,n,i){const r=["use","class","component","getElement"];let o=y(n,r),{$$slots:a={},$$scope:s}=n;const l=ut(R());let p,{use:u=[]}=n,{class:h=""}=n,{component:c=Dt}=n;const _=G("SMUI:label:context"),d=G("SMUI:label:tabindex");return e.$$set=e=>{n=t(t({},n),x(e)),i(7,o=y(n,r)),"use"in e&&i(0,u=e.use),"class"in e&&i(1,h=e.class),"component"in e&&i(2,c=e.component),"$$scope"in e&&i(11,s=e.$$scope)},[u,h,c,p,l,_,d,o,function(){return p.getElement()},a,function(e){j[e?"unshift":"push"]((()=>{p=e,i(3,p)}))},s]}function un(e){let t;const n=e[9].default,i=_(n,e,e[11],null);return{c(){i&&i.c()},m(e,n){i&&i.m(e,n),t=!0},p(e,r){i&&i.p&&(!t||2048&r)&&P(i,n,e,e[11],t?m(n,e[11],r,null):f(e[11]),null)},i(e){t||(oe(i,e),t=!0)},o(e){ae(i,e),t=!1},d(e){i&&i.d(e)}}}function hn(e){let n,i,r;const o=[{use:[e[5],...e[0]]},{class:ot({[e[1]]:!0,"mdc-button__icon":"button"===e[6],"mdc-fab__icon":"fab"===e[6],"mdc-icon-button__icon":"icon-button"===e[6],"mdc-icon-button__icon--on":"icon-button"===e[6]&&e[2],"mdc-tab__icon":"tab"===e[6],"mdc-banner__icon":"banner"===e[6],"mdc-segmented-button__icon":"segmented-button"===e[6]})},{"aria-hidden":"true"},e[3]===jt?{focusable:"false",tabindex:"-1"}:{},e[7]];var a=e[3];function s(e){let n={$$slots:{default:[un]},$$scope:{ctx:e}};for(let e=0;e<o.length;e+=1)n=t(n,o[e]);return{props:n}}return a&&(n=new a(s(e)),e[10](n)),{c(){n&&ce(n.$$.fragment),i=A()},m(e,t){n&&_e(n,e,t),w(e,i,t),r=!0},p(e,[t]){const r=239&t?ue(o,[33&t&&{use:[e[5],...e[0]]},70&t&&{class:ot({[e[1]]:!0,"mdc-button__icon":"button"===e[6],"mdc-fab__icon":"fab"===e[6],"mdc-icon-button__icon":"icon-button"===e[6],"mdc-icon-button__icon--on":"icon-button"===e[6]&&e[2],"mdc-tab__icon":"tab"===e[6],"mdc-banner__icon":"banner"===e[6],"mdc-segmented-button__icon":"segmented-button"===e[6]})},o[2],8&t&&he(e[3]===jt?{focusable:"false",tabindex:"-1"}:{}),128&t&&he(e[7])]):{};if(2048&t&&(r.$$scope={dirty:t,ctx:e}),a!==(a=e[3])){if(n){ie();const e=n;ae(e.$$.fragment,1,0,(()=>{de(e,1)})),re()}a?(n=new a(s(e)),e[10](n),ce(n.$$.fragment),oe(n.$$.fragment,1),_e(n,i.parentNode,i)):n=null}else a&&n.$set(r)},i(e){r||(n&&oe(n.$$.fragment,e),r=!0)},o(e){n&&ae(n.$$.fragment,e),r=!1},d(t){e[10](null),t&&Z(i),n&&de(n,t)}}}function cn(e,n,i){const r=["use","class","on","component","getElement"];let o=y(n,r),{$$slots:a={},$$scope:s}=n;const l=ut(R());let p,{use:u=[]}=n,{class:h=""}=n,{on:c=!1}=n,{component:_=Rt}=n;const d=G("SMUI:icon:context");return e.$$set=e=>{n=t(t({},n),x(e)),i(7,o=y(n,r)),"use"in e&&i(0,u=e.use),"class"in e&&i(1,h=e.class),"on"in e&&i(2,c=e.on),"component"in e&&i(3,_=e.component),"$$scope"in e&&i(11,s=e.$$scope)},[u,h,c,_,p,l,d,o,function(){return p.getElement()},a,function(e){j[e?"unshift":"push"]((()=>{p=e,i(4,p)}))},s]}const _n=class extends Pe{constructor(e){super(),me(this,e,pn,ln,a,{use:0,class:1,component:2,getElement:8})}get getElement(){return this.$$.ctx[8]}},dn=class extends Pe{constructor(e){super(),me(this,e,cn,hn,a,{use:0,class:1,on:2,component:3,getElement:8})}get getElement(){return this.$$.ctx[8]}};function mn(e){let t;return{c(){t=C("PAUSE MENU")},m(e,n){w(e,t,n)},d(e){e&&Z(t)}}}function Pn(e){let t;return{c(){t=C("code")},m(e,n){w(e,t,n)},d(e){e&&Z(t)}}}function fn(e){let t;return{c(){t=C("GitHub")},m(e,n){w(e,t,n)},d(e){e&&Z(t)}}}function xn(e){let t,n,i,r;return t=new dn({props:{class:"material-icons",$$slots:{default:[Pn]},$$scope:{ctx:e}}}),i=new _n({props:{$$slots:{default:[fn]},$$scope:{ctx:e}}}),{c(){ce(t.$$.fragment),n=N(),ce(i.$$.fragment)},m(e,o){_e(t,e,o),w(e,n,o),_e(i,e,o),r=!0},p(e,n){const r={};16&n&&(r.$$scope={dirty:n,ctx:e}),t.$set(r);const o={};16&n&&(o.$$scope={dirty:n,ctx:e}),i.$set(o)},i(e){r||(oe(t.$$.fragment,e),oe(i.$$.fragment,e),r=!0)},o(e){ae(t.$$.fragment,e),ae(i.$$.fragment,e),r=!1},d(e){de(t,e),e&&Z(n),de(i,e)}}}function yn(e){let t;return{c(){t=C("movie")},m(e,n){w(e,t,n)},d(e){e&&Z(t)}}}function vn(e){let t;return{c(){t=C("Youtube")},m(e,n){w(e,t,n)},d(e){e&&Z(t)}}}function gn(e){let t,n,i,r;return t=new dn({props:{class:"material-icons",$$slots:{default:[yn]},$$scope:{ctx:e}}}),i=new _n({props:{$$slots:{default:[vn]},$$scope:{ctx:e}}}),{c(){ce(t.$$.fragment),n=N(),ce(i.$$.fragment)},m(e,o){_e(t,e,o),w(e,n,o),_e(i,e,o),r=!0},p(e,n){const r={};16&n&&(r.$$scope={dirty:n,ctx:e}),t.$set(r);const o={};16&n&&(o.$$scope={dirty:n,ctx:e}),i.$set(o)},i(e){r||(oe(t.$$.fragment,e),oe(i.$$.fragment,e),r=!0)},o(e){ae(t.$$.fragment,e),ae(i.$$.fragment,e),r=!1},d(e){de(t,e),e&&Z(n),de(i,e)}}}function bn(e){let t;return{c(){t=C("logout")},m(e,n){w(e,t,n)},d(e){e&&Z(t)}}}function zn(e){let t;return{c(){t=C("Exit")},m(e,n){w(e,t,n)},d(e){e&&Z(t)}}}function wn(e){let t,n,i,r;return t=new dn({props:{class:"material-icons",$$slots:{default:[bn]},$$scope:{ctx:e}}}),i=new _n({props:{$$slots:{default:[zn]},$$scope:{ctx:e}}}),{c(){ce(t.$$.fragment),n=N(),ce(i.$$.fragment)},m(e,o){_e(t,e,o),w(e,n,o),_e(i,e,o),r=!0},p(e,n){const r={};16&n&&(r.$$scope={dirty:n,ctx:e}),t.$set(r);const o={};16&n&&(o.$$scope={dirty:n,ctx:e}),i.$set(o)},i(e){r||(oe(t.$$.fragment,e),oe(i.$$.fragment,e),r=!0)},o(e){ae(t.$$.fragment,e),ae(i.$$.fragment,e),r=!1},d(e){de(t,e),e&&Z(n),de(i,e)}}}function Zn(e){let t;return{c(){t=C("play_circle_outline")},m(e,n){w(e,t,n)},d(e){e&&Z(t)}}}function En(e){let t;return{c(){t=C("Resume")},m(e,n){w(e,t,n)},d(e){e&&Z(t)}}}function Mn(e){let t,n,i,r;return t=new dn({props:{class:"material-icons",$$slots:{default:[Zn]},$$scope:{ctx:e}}}),i=new _n({props:{$$slots:{default:[En]},$$scope:{ctx:e}}}),{c(){ce(t.$$.fragment),n=N(),ce(i.$$.fragment)},m(e,o){_e(t,e,o),w(e,n,o),_e(i,e,o),r=!0},p(e,n){const r={};16&n&&(r.$$scope={dirty:n,ctx:e}),t.$set(r);const o={};16&n&&(o.$$scope={dirty:n,ctx:e}),i.$set(o)},i(e){r||(oe(t.$$.fragment,e),oe(i.$$.fragment,e),r=!0)},o(e){ae(t.$$.fragment,e),ae(i.$$.fragment,e),r=!1},d(e){de(t,e),e&&Z(n),de(i,e)}}}function Sn(e){let t,n,i,r;return t=new an({props:{$$slots:{default:[wn]},$$scope:{ctx:e}}}),t.$on("click",e[2]),i=new an({props:{$$slots:{default:[Mn]},$$scope:{ctx:e}}}),i.$on("click",e[1]),{c(){ce(t.$$.fragment),n=N(),ce(i.$$.fragment)},m(e,o){_e(t,e,o),w(e,n,o),_e(i,e,o),r=!0},p(e,n){const r={};16&n&&(r.$$scope={dirty:n,ctx:e}),t.$set(r);const o={};16&n&&(o.$$scope={dirty:n,ctx:e}),i.$set(o)},i(e){r||(oe(t.$$.fragment,e),oe(i.$$.fragment,e),r=!0)},o(e){ae(t.$$.fragment,e),ae(i.$$.fragment,e),r=!1},d(e){de(t,e),e&&Z(n),de(i,e)}}}function Cn(e){let t,n,i,r,o,a,s,l;return t=new $t({props:{id:"simple-title",$$slots:{default:[mn]},$$scope:{ctx:e}}}),i=new an({props:{href:"https://github.com/NewKrok/three-tps-demo",target:"_blank",$$slots:{default:[xn]},$$scope:{ctx:e}}}),o=new an({props:{href:"https://www.youtube.com/channel/UC7Uc0QEWn69JCYPfjtwHT6g",target:"_blank",$$slots:{default:[gn]},$$scope:{ctx:e}}}),s=new Xt({props:{$$slots:{default:[Sn]},$$scope:{ctx:e}}}),{c(){ce(t.$$.fragment),n=N(),ce(i.$$.fragment),r=N(),ce(o.$$.fragment),a=N(),ce(s.$$.fragment)},m(e,p){_e(t,e,p),w(e,n,p),_e(i,e,p),w(e,r,p),_e(o,e,p),w(e,a,p),_e(s,e,p),l=!0},p(e,n){const r={};16&n&&(r.$$scope={dirty:n,ctx:e}),t.$set(r);const a={};16&n&&(a.$$scope={dirty:n,ctx:e}),i.$set(a);const l={};16&n&&(l.$$scope={dirty:n,ctx:e}),o.$set(l);const p={};16&n&&(p.$$scope={dirty:n,ctx:e}),s.$set(p)},i(e){l||(oe(t.$$.fragment,e),oe(i.$$.fragment,e),oe(o.$$.fragment,e),oe(s.$$.fragment,e),l=!0)},o(e){ae(t.$$.fragment,e),ae(i.$$.fragment,e),ae(o.$$.fragment,e),ae(s.$$.fragment,e),l=!1},d(e){de(t,e),e&&Z(n),de(i,e),e&&Z(r),de(o,e),e&&Z(a),de(s,e)}}}function Nn(e){let t,n,i;function r(t){e[3](t)}let o={scrimClickAction:"",escapeKeyAction:"","aria-labelledby":"simple-title","aria-describedby":"simple-content",$$slots:{default:[Cn]},$$scope:{ctx:e}};return void 0!==e[0]&&(o.open=e[0]),t=new vt({props:o}),j.push((()=>function(e,t,n){const i=e.$$.props.open;void 0!==i&&(e.$$.bound[i]=n,n(e.$$.ctx[i]))}(t,0,r))),{c(){ce(t.$$.fragment)},m(e,n){_e(t,e,n),i=!0},p(e,[i]){const r={};var o;16&i&&(r.$$scope={dirty:i,ctx:e}),!n&&1&i&&(n=!0,r.open=e[0],o=()=>n=!1,q.push(o)),t.$set(r)},i(e){i||(oe(t.$$.fragment,e),i=!0)},o(e){ae(t.$$.fragment,e),i=!1},d(e){de(t,e)}}}function An(e,t,n){let i=!1;window.tpsDemo.on.init((()=>{window.tpsDemo.game.world.on.pause((()=>{n(0,i=!0),document.exitPointerLock()})),window.tpsDemo.game.world.on.resume((()=>{n(0,i=!1)}))})),document.addEventListener("pointerlockchange",(()=>{null===document.pointerLockElement&&window.tpsDemo.game.world.pause()}));const r=()=>{window.tpsDemo.game.world.resume(),Be.isPointerLockNeeded&&window.tpsDemo.game.world.renderer.domElement.requestPointerLock()};return[i,r,()=>{r(),window.tpsDemo.game.world.dispose(),ge.set(fe)},function(e){i=e,n(0,i)}]}class Ln extends Pe{constructor(e){super(),me(this,e,An,Nn,a,{})}}function Bn(t){let n,i,r,o,a,s,l,u,h,c,_,d,m,P;return{c(){n=M("div"),i=M("div"),r=M("div"),o=M("div"),a=N(),s=M("img"),u=N(),h=M("div"),h.innerHTML='<div class="preloaderProgress svelte-1c1oc4x"></div>',c=N(),_=M("div"),d=M("h2"),d.textContent=`${t[0]}`,m=N(),P=M("div"),P.textContent=`${t[1]}`,B(o,"class","blur svelte-1c1oc4x"),p(s.src,l=t[2])||B(s,"src",l),B(s,"alt",""),B(s,"class","svelte-1c1oc4x"),B(r,"class","preview svelte-1c1oc4x"),B(r,"style",`background-image: url(${t[2]});`),B(h,"class","preloaderLine svelte-1c1oc4x"),B(d,"class","mdc-typography--headline6"),I(d,"margin","0"),B(P,"class","mdc-typography--body2"),B(_,"class","info svelte-1c1oc4x"),B(i,"class","container svelte-1c1oc4x"),B(n,"class","preloader svelte-1c1oc4x")},m(e,t){w(e,n,t),z(n,i),z(i,r),z(r,o),z(r,a),z(r,s),z(i,u),z(i,h),z(i,c),z(i,_),z(_,d),z(_,m),z(_,P)},p:e,i:e,o:e,d(e){e&&Z(n)}}}function Tn(e){const{name:t,description:n,preview:i}=h(be);return[t,n,i]}class Vn extends Pe{constructor(e){super(),me(this,e,Tn,Bn,a,{})
/**
     * @license
     * Copyright 2010-2022 Three.js Authors
     * SPDX-License-Identifier: MIT
     */}}const kn=1e3,In=1001,On=1002,Rn=1003,Hn=2300,Fn=2301,Dn=2302,Gn=3001,Un="srgb",jn="srgb-linear",Wn=7680,qn=35044;class Jn{addEventListener(e,t){void 0===this._listeners&&(this._listeners={});const n=this._listeners;void 0===n[e]&&(n[e]=[]),-1===n[e].indexOf(t)&&n[e].push(t)}hasEventListener(e,t){if(void 0===this._listeners)return!1;const n=this._listeners;return void 0!==n[e]&&-1!==n[e].indexOf(t)}removeEventListener(e,t){if(void 0===this._listeners)return;const n=this._listeners[e];if(void 0!==n){const e=n.indexOf(t);-1!==e&&n.splice(e,1)}}dispatchEvent(e){if(void 0===this._listeners)return;const t=this._listeners[e.type];if(void 0!==t){e.target=this;const n=t.slice(0);for(let t=0,i=n.length;t<i;t++)n[t].call(this,e);e.target=null}}}const $n=[];for(let e=0;e<256;e++)$n[e]=(e<16?"0":"")+e.toString(16);let Xn=1234567;const Yn=Math.PI/180,Kn=180/Math.PI;function Qn(){const e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,n=4294967295*Math.random()|0,i=4294967295*Math.random()|0;return($n[255&e]+$n[e>>8&255]+$n[e>>16&255]+$n[e>>24&255]+"-"+$n[255&t]+$n[t>>8&255]+"-"+$n[t>>16&15|64]+$n[t>>24&255]+"-"+$n[63&n|128]+$n[n>>8&255]+"-"+$n[n>>16&255]+$n[n>>24&255]+$n[255&i]+$n[i>>8&255]+$n[i>>16&255]+$n[i>>24&255]).toLowerCase()}function ei(e,t,n){return Math.max(t,Math.min(n,e))}function ti(e,t){return(e%t+t)%t}function ni(e,t,n){return(1-n)*e+n*t}function ii(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))}var ri=Object.freeze({__proto__:null,DEG2RAD:Yn,RAD2DEG:Kn,generateUUID:Qn,clamp:ei,euclideanModulo:ti,mapLinear:function(e,t,n,i,r){return i+(e-t)*(r-i)/(n-t)},inverseLerp:function(e,t,n){return e!==t?(n-e)/(t-e):0},lerp:ni,damp:function(e,t,n,i){return ni(e,t,1-Math.exp(-n*i))},pingpong:function(e,t=1){return t-Math.abs(ti(e,2*t)-t)},smoothstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t))*e*(3-2*e)},smootherstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t))*e*e*(e*(6*e-15)+10)},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},seededRandom:function(e){void 0!==e&&(Xn=e);let t=Xn+=1831565813;return t=Math.imul(t^t>>>15,1|t),t^=t+Math.imul(t^t>>>7,61|t),((t^t>>>14)>>>0)/4294967296},degToRad:function(e){return e*Yn},radToDeg:function(e){return e*Kn},isPowerOfTwo:function(e){return 0==(e&e-1)&&0!==e},ceilPowerOfTwo:ii,floorPowerOfTwo:function(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))},setQuaternionFromProperEuler:function(e,t,n,i,r){const o=Math.cos,a=Math.sin,s=o(n/2),l=a(n/2),p=o((t+i)/2),u=a((t+i)/2),h=o((t-i)/2),c=a((t-i)/2),_=o((i-t)/2),d=a((i-t)/2);switch(r){case"XYX":e.set(s*u,l*h,l*c,s*p);break;case"YZY":e.set(l*c,s*u,l*h,s*p);break;case"ZXZ":e.set(l*h,l*c,s*u,s*p);break;case"XZX":e.set(s*u,l*d,l*_,s*p);break;case"YXY":e.set(l*_,s*u,l*d,s*p);break;case"ZYZ":e.set(l*d,l*_,s*u,s*p);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+r)}},normalize:function(e,t){switch(t.constructor){case Float32Array:return e;case Uint16Array:return Math.round(65535*e);case Uint8Array:return Math.round(255*e);case Int16Array:return Math.round(32767*e);case Int8Array:return Math.round(127*e);default:throw new Error("Invalid component type.")}},denormalize:function(e,t){switch(t.constructor){case Float32Array:return e;case Uint16Array:return e/65535;case Uint8Array:return e/255;case Int16Array:return Math.max(e/32767,-1);case Int8Array:return Math.max(e/127,-1);default:throw new Error("Invalid component type.")}}});class oi{constructor(e=0,t=0){this.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e,t){return void 0!==t?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this)}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e,t){return void 0!==t?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this)}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,n=this.y,i=e.elements;return this.x=i[0]*t+i[3]*n+i[6],this.y=i[1]*t+i[4]*n+i[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y;return t*t+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t,n){return void 0!==n&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const n=Math.cos(t),i=Math.sin(t),r=this.x-e.x,o=this.y-e.y;return this.x=r*n-o*i+e.x,this.y=r*i+o*n+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class ai{constructor(){this.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}set(e,t,n,i,r,o,a,s,l){const p=this.elements;return p[0]=e,p[1]=i,p[2]=a,p[3]=t,p[4]=r,p[5]=s,p[6]=n,p[7]=o,p[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],this}extractBasis(e,t,n){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,i=t.elements,r=this.elements,o=n[0],a=n[3],s=n[6],l=n[1],p=n[4],u=n[7],h=n[2],c=n[5],_=n[8],d=i[0],m=i[3],P=i[6],f=i[1],x=i[4],y=i[7],v=i[2],g=i[5],b=i[8];return r[0]=o*d+a*f+s*v,r[3]=o*m+a*x+s*g,r[6]=o*P+a*y+s*b,r[1]=l*d+p*f+u*v,r[4]=l*m+p*x+u*g,r[7]=l*P+p*y+u*b,r[2]=h*d+c*f+_*v,r[5]=h*m+c*x+_*g,r[8]=h*P+c*y+_*b,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[1],i=e[2],r=e[3],o=e[4],a=e[5],s=e[6],l=e[7],p=e[8];return t*o*p-t*a*l-n*r*p+n*a*s+i*r*l-i*o*s}invert(){const e=this.elements,t=e[0],n=e[1],i=e[2],r=e[3],o=e[4],a=e[5],s=e[6],l=e[7],p=e[8],u=p*o-a*l,h=a*s-p*r,c=l*r-o*s,_=t*u+n*h+i*c;if(0===_)return this.set(0,0,0,0,0,0,0,0,0);const d=1/_;return e[0]=u*d,e[1]=(i*l-p*n)*d,e[2]=(a*n-i*o)*d,e[3]=h*d,e[4]=(p*t-i*s)*d,e[5]=(i*r-a*t)*d,e[6]=c*d,e[7]=(n*s-l*t)*d,e[8]=(o*t-n*r)*d,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,n,i,r,o,a){const s=Math.cos(r),l=Math.sin(r);return this.set(n*s,n*l,-n*(s*o+l*a)+o+e,-i*l,i*s,-i*(-l*o+s*a)+a+t,0,0,1),this}scale(e,t){const n=this.elements;return n[0]*=e,n[3]*=e,n[6]*=e,n[1]*=t,n[4]*=t,n[7]*=t,this}rotate(e){const t=Math.cos(e),n=Math.sin(e),i=this.elements,r=i[0],o=i[3],a=i[6],s=i[1],l=i[4],p=i[7];return i[0]=t*r+n*s,i[3]=t*o+n*l,i[6]=t*a+n*p,i[1]=-n*r+t*s,i[4]=-n*o+t*l,i[7]=-n*a+t*p,this}translate(e,t){const n=this.elements;return n[0]+=e*n[2],n[3]+=e*n[5],n[6]+=e*n[8],n[1]+=t*n[2],n[4]+=t*n[5],n[7]+=t*n[8],this}equals(e){const t=this.elements,n=e.elements;for(let e=0;e<9;e++)if(t[e]!==n[e])return!1;return!0}fromArray(e,t=0){for(let n=0;n<9;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e}clone(){return(new this.constructor).fromArray(this.elements)}}function si(e){return document.createElementNS("http://www.w3.org/1999/xhtml",e)}function li(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}function pi(e){return e<.0031308?12.92*e:1.055*Math.pow(e,.41666)-.055}const ui={[Un]:{[jn]:li},[jn]:{[Un]:pi}},hi={legacyMode:!0,get workingColorSpace(){return jn},set workingColorSpace(e){console.warn("THREE.ColorManagement: .workingColorSpace is readonly.")},convert:function(e,t,n){if(this.legacyMode||t===n||!t||!n)return e;if(ui[t]&&void 0!==ui[t][n]){const i=ui[t][n];return e.r=i(e.r),e.g=i(e.g),e.b=i(e.b),e}throw new Error("Unsupported color space conversion.")},fromWorkingColorSpace:function(e,t){return this.convert(e,this.workingColorSpace,t)},toWorkingColorSpace:function(e,t){return this.convert(e,t,this.workingColorSpace)}},ci={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},_i={r:0,g:0,b:0},di={h:0,s:0,l:0},mi={h:0,s:0,l:0};function Pi(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+6*(t-e)*(2/3-n):e}function fi(e,t){return t.r=e.r,t.g=e.g,t.b=e.b,t}class xi{constructor(e,t,n){return this.isColor=!0,this.r=1,this.g=1,this.b=1,void 0===t&&void 0===n?this.set(e):this.setRGB(e,t,n)}set(e){return e&&e.isColor?this.copy(e):"number"==typeof e?this.setHex(e):"string"==typeof e&&this.setStyle(e),this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t="srgb"){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,hi.toWorkingColorSpace(this,t),this}setRGB(e,t,n,i="srgb-linear"){return this.r=e,this.g=t,this.b=n,hi.toWorkingColorSpace(this,i),this}setHSL(e,t,n,i="srgb-linear"){if(e=ti(e,1),t=ei(t,0,1),n=ei(n,0,1),0===t)this.r=this.g=this.b=n;else{const i=n<=.5?n*(1+t):n+t-n*t,r=2*n-i;this.r=Pi(r,i,e+1/3),this.g=Pi(r,i,e),this.b=Pi(r,i,e-1/3)}return hi.toWorkingColorSpace(this,i),this}setStyle(e,t="srgb"){function n(t){void 0!==t&&parseFloat(t)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let i;if(i=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(e)){let e;const r=i[1],o=i[2];switch(r){case"rgb":case"rgba":if(e=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return this.r=Math.min(255,parseInt(e[1],10))/255,this.g=Math.min(255,parseInt(e[2],10))/255,this.b=Math.min(255,parseInt(e[3],10))/255,hi.toWorkingColorSpace(this,t),n(e[4]),this;if(e=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return this.r=Math.min(100,parseInt(e[1],10))/100,this.g=Math.min(100,parseInt(e[2],10))/100,this.b=Math.min(100,parseInt(e[3],10))/100,hi.toWorkingColorSpace(this,t),n(e[4]),this;break;case"hsl":case"hsla":if(e=/^\s*(\d*\.?\d+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o)){const i=parseFloat(e[1])/360,r=parseInt(e[2],10)/100,o=parseInt(e[3],10)/100;return n(e[4]),this.setHSL(i,r,o,t)}}}else if(i=/^\#([A-Fa-f\d]+)$/.exec(e)){const e=i[1],n=e.length;if(3===n)return this.r=parseInt(e.charAt(0)+e.charAt(0),16)/255,this.g=parseInt(e.charAt(1)+e.charAt(1),16)/255,this.b=parseInt(e.charAt(2)+e.charAt(2),16)/255,hi.toWorkingColorSpace(this,t),this;if(6===n)return this.r=parseInt(e.charAt(0)+e.charAt(1),16)/255,this.g=parseInt(e.charAt(2)+e.charAt(3),16)/255,this.b=parseInt(e.charAt(4)+e.charAt(5),16)/255,hi.toWorkingColorSpace(this,t),this}return e&&e.length>0?this.setColorName(e,t):this}setColorName(e,t="srgb"){const n=ci[e.toLowerCase()];return void 0!==n?this.setHex(n,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=li(e.r),this.g=li(e.g),this.b=li(e.b),this}copyLinearToSRGB(e){return this.r=pi(e.r),this.g=pi(e.g),this.b=pi(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e="srgb"){return hi.fromWorkingColorSpace(fi(this,_i),e),ei(255*_i.r,0,255)<<16^ei(255*_i.g,0,255)<<8^ei(255*_i.b,0,255)<<0}getHexString(e="srgb"){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t="srgb-linear"){hi.fromWorkingColorSpace(fi(this,_i),t);const n=_i.r,i=_i.g,r=_i.b,o=Math.max(n,i,r),a=Math.min(n,i,r);let s,l;const p=(a+o)/2;if(a===o)s=0,l=0;else{const e=o-a;switch(l=p<=.5?e/(o+a):e/(2-o-a),o){case n:s=(i-r)/e+(i<r?6:0);break;case i:s=(r-n)/e+2;break;case r:s=(n-i)/e+4}s/=6}return e.h=s,e.s=l,e.l=p,e}getRGB(e,t="srgb-linear"){return hi.fromWorkingColorSpace(fi(this,_i),t),e.r=_i.r,e.g=_i.g,e.b=_i.b,e}getStyle(e="srgb"){return hi.fromWorkingColorSpace(fi(this,_i),e),e!==Un?`color(${e} ${_i.r} ${_i.g} ${_i.b})`:`rgb(${255*_i.r|0},${255*_i.g|0},${255*_i.b|0})`}offsetHSL(e,t,n){return this.getHSL(di),di.h+=e,di.s+=t,di.l+=n,this.setHSL(di.h,di.s,di.l),this}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,n){return this.r=e.r+(t.r-e.r)*n,this.g=e.g+(t.g-e.g)*n,this.b=e.b+(t.b-e.b)*n,this}lerpHSL(e,t){this.getHSL(di),e.getHSL(mi);const n=ni(di.h,mi.h,t),i=ni(di.s,mi.s,t),r=ni(di.l,mi.l,t);return this.setHSL(n,i,r),this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),!0===e.normalized&&(this.r/=255,this.g/=255,this.b/=255),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}let yi;xi.NAMES=ci;class vi{constructor(e=null){this.isSource=!0,this.uuid=Qn(),this.data=e,this.version=0}set needsUpdate(e){!0===e&&this.version++}toJSON(e){const t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.images[this.uuid])return e.images[this.uuid];const n={uuid:this.uuid,url:""},i=this.data;if(null!==i){let e;if(Array.isArray(i)){e=[];for(let t=0,n=i.length;t<n;t++)i[t].isDataTexture?e.push(gi(i[t].image)):e.push(gi(i[t]))}else e=gi(i);n.url=e}return t||(e.images[this.uuid]=n),n}}function gi(e){return"undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap?class{static getDataURL(e){if(/^data:/i.test(e.src))return e.src;if("undefined"==typeof HTMLCanvasElement)return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{void 0===yi&&(yi=si("canvas")),yi.width=e.width,yi.height=e.height;const n=yi.getContext("2d");e instanceof ImageData?n.putImageData(e,0,0):n.drawImage(e,0,0,e.width,e.height),t=yi}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}static sRGBToLinear(e){if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap){const t=si("canvas");t.width=e.width,t.height=e.height;const n=t.getContext("2d");n.drawImage(e,0,0,e.width,e.height);const i=n.getImageData(0,0,e.width,e.height),r=i.data;for(let e=0;e<r.length;e++)r[e]=255*li(r[e]/255);return n.putImageData(i,0,0),t}if(e.data){const t=e.data.slice(0);for(let e=0;e<t.length;e++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[e]=Math.floor(255*li(t[e]/255)):t[e]=li(t[e]);return{data:t,width:e.width,height:e.height}}return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}.getDataURL(e):e.data?{data:Array.prototype.slice.call(e.data),width:e.width,height:e.height,type:e.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let bi=0;class zi extends Jn{constructor(e=zi.DEFAULT_IMAGE,t=zi.DEFAULT_MAPPING,n=1001,i=1001,r=1006,o=1008,a=1023,s=1009,l=1,p=3e3){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:bi++}),this.uuid=Qn(),this.name="",this.source=new vi(e),this.mipmaps=[],this.mapping=t,this.wrapS=n,this.wrapT=i,this.magFilter=r,this.minFilter=o,this.anisotropy=l,this.format=a,this.internalFormat=null,this.type=s,this.offset=new oi(0,0),this.repeat=new oi(1,1),this.center=new oi(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new ai,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=p,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(e){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return(new this.constructor).copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){const t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.textures[this.uuid])return e.textures[this.uuid];const n={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return"{}"!==JSON.stringify(this.userData)&&(n.userData=this.userData),t||(e.textures[this.uuid]=n),n}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(300!==this.mapping)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case kn:e.x=e.x-Math.floor(e.x);break;case In:e.x=e.x<0?0:1;break;case On:1===Math.abs(Math.floor(e.x)%2)?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||e.y>1)switch(this.wrapT){case kn:e.y=e.y-Math.floor(e.y);break;case In:e.y=e.y<0?0:1;break;case On:1===Math.abs(Math.floor(e.y)%2)?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){!0===e&&(this.version++,this.source.needsUpdate=!0)}}zi.DEFAULT_IMAGE=null,zi.DEFAULT_MAPPING=300;class wi{constructor(e=0,t=0,n=0,i=1){this.isVector4=!0,this.x=e,this.y=t,this.z=n,this.w=i}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,n,i){return this.x=e,this.y=t,this.z=n,this.w=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this}add(e,t){return void 0!==t?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this)}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e,t){return void 0!==t?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this)}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,n=this.y,i=this.z,r=this.w,o=e.elements;return this.x=o[0]*t+o[4]*n+o[8]*i+o[12]*r,this.y=o[1]*t+o[5]*n+o[9]*i+o[13]*r,this.z=o[2]*t+o[6]*n+o[10]*i+o[14]*r,this.w=o[3]*t+o[7]*n+o[11]*i+o[15]*r,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,n,i,r;const o=.01,a=.1,s=e.elements,l=s[0],p=s[4],u=s[8],h=s[1],c=s[5],_=s[9],d=s[2],m=s[6],P=s[10];if(Math.abs(p-h)<o&&Math.abs(u-d)<o&&Math.abs(_-m)<o){if(Math.abs(p+h)<a&&Math.abs(u+d)<a&&Math.abs(_+m)<a&&Math.abs(l+c+P-3)<a)return this.set(1,0,0,0),this;t=Math.PI;const e=(l+1)/2,s=(c+1)/2,f=(P+1)/2,x=(p+h)/4,y=(u+d)/4,v=(_+m)/4;return e>s&&e>f?e<o?(n=0,i=.707106781,r=.707106781):(n=Math.sqrt(e),i=x/n,r=y/n):s>f?s<o?(n=.707106781,i=0,r=.707106781):(i=Math.sqrt(s),n=x/i,r=v/i):f<o?(n=.707106781,i=.707106781,r=0):(r=Math.sqrt(f),n=y/r,i=v/r),this.set(n,i,r,t),this}let f=Math.sqrt((m-_)*(m-_)+(u-d)*(u-d)+(h-p)*(h-p));return Math.abs(f)<.001&&(f=1),this.x=(m-_)/f,this.y=(u-d)/f,this.z=(h-p)/f,this.w=Math.acos((l+c+P-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this.w=e.w+(t.w-e.w)*n,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t,n){return void 0!==n&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class Zi{constructor(e=0,t=0,n=0,i=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=n,this._w=i}static slerp(e,t,n,i){return console.warn("THREE.Quaternion: Static .slerp() has been deprecated. Use qm.slerpQuaternions( qa, qb, t ) instead."),n.slerpQuaternions(e,t,i)}static slerpFlat(e,t,n,i,r,o,a){let s=n[i+0],l=n[i+1],p=n[i+2],u=n[i+3];const h=r[o+0],c=r[o+1],_=r[o+2],d=r[o+3];if(0===a)return e[t+0]=s,e[t+1]=l,e[t+2]=p,void(e[t+3]=u);if(1===a)return e[t+0]=h,e[t+1]=c,e[t+2]=_,void(e[t+3]=d);if(u!==d||s!==h||l!==c||p!==_){let e=1-a;const t=s*h+l*c+p*_+u*d,n=t>=0?1:-1,i=1-t*t;if(i>Number.EPSILON){const r=Math.sqrt(i),o=Math.atan2(r,t*n);e=Math.sin(e*o)/r,a=Math.sin(a*o)/r}const r=a*n;if(s=s*e+h*r,l=l*e+c*r,p=p*e+_*r,u=u*e+d*r,e===1-a){const e=1/Math.sqrt(s*s+l*l+p*p+u*u);s*=e,l*=e,p*=e,u*=e}}e[t]=s,e[t+1]=l,e[t+2]=p,e[t+3]=u}static multiplyQuaternionsFlat(e,t,n,i,r,o){const a=n[i],s=n[i+1],l=n[i+2],p=n[i+3],u=r[o],h=r[o+1],c=r[o+2],_=r[o+3];return e[t]=a*_+p*u+s*c-l*h,e[t+1]=s*_+p*h+l*u-a*c,e[t+2]=l*_+p*c+a*h-s*u,e[t+3]=p*_-a*u-s*h-l*c,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,n,i){return this._x=e,this._y=t,this._z=n,this._w=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t){if(!e||!e.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");const n=e._x,i=e._y,r=e._z,o=e._order,a=Math.cos,s=Math.sin,l=a(n/2),p=a(i/2),u=a(r/2),h=s(n/2),c=s(i/2),_=s(r/2);switch(o){case"XYZ":this._x=h*p*u+l*c*_,this._y=l*c*u-h*p*_,this._z=l*p*_+h*c*u,this._w=l*p*u-h*c*_;break;case"YXZ":this._x=h*p*u+l*c*_,this._y=l*c*u-h*p*_,this._z=l*p*_-h*c*u,this._w=l*p*u+h*c*_;break;case"ZXY":this._x=h*p*u-l*c*_,this._y=l*c*u+h*p*_,this._z=l*p*_+h*c*u,this._w=l*p*u-h*c*_;break;case"ZYX":this._x=h*p*u-l*c*_,this._y=l*c*u+h*p*_,this._z=l*p*_-h*c*u,this._w=l*p*u+h*c*_;break;case"YZX":this._x=h*p*u+l*c*_,this._y=l*c*u+h*p*_,this._z=l*p*_-h*c*u,this._w=l*p*u-h*c*_;break;case"XZY":this._x=h*p*u-l*c*_,this._y=l*c*u-h*p*_,this._z=l*p*_+h*c*u,this._w=l*p*u+h*c*_;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+o)}return!1!==t&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const n=t/2,i=Math.sin(n);return this._x=e.x*i,this._y=e.y*i,this._z=e.z*i,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,n=t[0],i=t[4],r=t[8],o=t[1],a=t[5],s=t[9],l=t[2],p=t[6],u=t[10],h=n+a+u;if(h>0){const e=.5/Math.sqrt(h+1);this._w=.25/e,this._x=(p-s)*e,this._y=(r-l)*e,this._z=(o-i)*e}else if(n>a&&n>u){const e=2*Math.sqrt(1+n-a-u);this._w=(p-s)/e,this._x=.25*e,this._y=(i+o)/e,this._z=(r+l)/e}else if(a>u){const e=2*Math.sqrt(1+a-n-u);this._w=(r-l)/e,this._x=(i+o)/e,this._y=.25*e,this._z=(s+p)/e}else{const e=2*Math.sqrt(1+u-n-a);this._w=(o-i)/e,this._x=(r+l)/e,this._y=(s+p)/e,this._z=.25*e}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let n=e.dot(t)+1;return n<Number.EPSILON?(n=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=n):(this._x=0,this._y=-e.z,this._z=e.y,this._w=n)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=n),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(ei(this.dot(e),-1,1)))}rotateTowards(e,t){const n=this.angleTo(e);if(0===n)return this;const i=Math.min(1,t/n);return this.slerp(e,i),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e,t){return void 0!==t?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,t)):this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const n=e._x,i=e._y,r=e._z,o=e._w,a=t._x,s=t._y,l=t._z,p=t._w;return this._x=n*p+o*a+i*l-r*s,this._y=i*p+o*s+r*a-n*l,this._z=r*p+o*l+n*s-i*a,this._w=o*p-n*a-i*s-r*l,this._onChangeCallback(),this}slerp(e,t){if(0===t)return this;if(1===t)return this.copy(e);const n=this._x,i=this._y,r=this._z,o=this._w;let a=o*e._w+n*e._x+i*e._y+r*e._z;if(a<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,a=-a):this.copy(e),a>=1)return this._w=o,this._x=n,this._y=i,this._z=r,this;const s=1-a*a;if(s<=Number.EPSILON){const e=1-t;return this._w=e*o+t*this._w,this._x=e*n+t*this._x,this._y=e*i+t*this._y,this._z=e*r+t*this._z,this.normalize(),this._onChangeCallback(),this}const l=Math.sqrt(s),p=Math.atan2(l,a),u=Math.sin((1-t)*p)/l,h=Math.sin(t*p)/l;return this._w=o*u+this._w*h,this._x=n*u+this._x*h,this._y=i*u+this._y*h,this._z=r*u+this._z*h,this._onChangeCallback(),this}slerpQuaternions(e,t,n){return this.copy(e).slerp(t,n)}random(){const e=Math.random(),t=Math.sqrt(1-e),n=Math.sqrt(e),i=2*Math.PI*Math.random(),r=2*Math.PI*Math.random();return this.set(t*Math.cos(i),n*Math.sin(r),n*Math.cos(r),t*Math.sin(i))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class Ei{constructor(e=0,t=0,n=0){this.isVector3=!0,this.x=e,this.y=t,this.z=n}set(e,t,n){return void 0===n&&(n=this.z),this.x=e,this.y=t,this.z=n,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e,t){return void 0!==t?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e,t){return void 0!==t?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e,t){return void 0!==t?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return e&&e.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(Si.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(Si.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,n=this.y,i=this.z,r=e.elements;return this.x=r[0]*t+r[3]*n+r[6]*i,this.y=r[1]*t+r[4]*n+r[7]*i,this.z=r[2]*t+r[5]*n+r[8]*i,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,n=this.y,i=this.z,r=e.elements,o=1/(r[3]*t+r[7]*n+r[11]*i+r[15]);return this.x=(r[0]*t+r[4]*n+r[8]*i+r[12])*o,this.y=(r[1]*t+r[5]*n+r[9]*i+r[13])*o,this.z=(r[2]*t+r[6]*n+r[10]*i+r[14])*o,this}applyQuaternion(e){const t=this.x,n=this.y,i=this.z,r=e.x,o=e.y,a=e.z,s=e.w,l=s*t+o*i-a*n,p=s*n+a*t-r*i,u=s*i+r*n-o*t,h=-r*t-o*n-a*i;return this.x=l*s+h*-r+p*-a-u*-o,this.y=p*s+h*-o+u*-r-l*-a,this.z=u*s+h*-a+l*-o-p*-r,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,n=this.y,i=this.z,r=e.elements;return this.x=r[0]*t+r[4]*n+r[8]*i,this.y=r[1]*t+r[5]*n+r[9]*i,this.z=r[2]*t+r[6]*n+r[10]*i,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this}cross(e,t){return void 0!==t?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t)):this.crossVectors(this,e)}crossVectors(e,t){const n=e.x,i=e.y,r=e.z,o=t.x,a=t.y,s=t.z;return this.x=i*s-r*a,this.y=r*o-n*s,this.z=n*a-i*o,this}projectOnVector(e){const t=e.lengthSq();if(0===t)return this.set(0,0,0);const n=e.dot(this)/t;return this.copy(e).multiplyScalar(n)}projectOnPlane(e){return Mi.copy(this).projectOnVector(e),this.sub(Mi)}reflect(e){return this.sub(Mi.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(ei(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y,i=this.z-e.z;return t*t+n*n+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,n){const i=Math.sin(t)*e;return this.x=i*Math.sin(n),this.y=Math.cos(t)*e,this.z=i*Math.cos(n),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,n){return this.x=e*Math.sin(t),this.y=n,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),i=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=n,this.z=i,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,4*t)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,3*t)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t,n){return void 0!==n&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=2*(Math.random()-.5),t=Math.random()*Math.PI*2,n=Math.sqrt(1-e**2);return this.x=n*Math.cos(t),this.y=n*Math.sin(t),this.z=e,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const Mi=new Ei,Si=new Zi;class Ci{constructor(e=new Ei(1/0,1/0,1/0),t=new Ei(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){let t=1/0,n=1/0,i=1/0,r=-1/0,o=-1/0,a=-1/0;for(let s=0,l=e.length;s<l;s+=3){const l=e[s],p=e[s+1],u=e[s+2];l<t&&(t=l),p<n&&(n=p),u<i&&(i=u),l>r&&(r=l),p>o&&(o=p),u>a&&(a=u)}return this.min.set(t,n,i),this.max.set(r,o,a),this}setFromBufferAttribute(e){let t=1/0,n=1/0,i=1/0,r=-1/0,o=-1/0,a=-1/0;for(let s=0,l=e.count;s<l;s++){const l=e.getX(s),p=e.getY(s),u=e.getZ(s);l<t&&(t=l),p<n&&(n=p),u<i&&(i=u),l>r&&(r=l),p>o&&(o=p),u>a&&(a=u)}return this.min.set(t,n,i),this.max.set(r,o,a),this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const n=Ai.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return(new this.constructor).copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){e.updateWorldMatrix(!1,!1);const n=e.geometry;if(void 0!==n)if(t&&null!=n.attributes&&void 0!==n.attributes.position){const t=n.attributes.position;for(let n=0,i=t.count;n<i;n++)Ai.fromBufferAttribute(t,n).applyMatrix4(e.matrixWorld),this.expandByPoint(Ai)}else null===n.boundingBox&&n.computeBoundingBox(),Li.copy(n.boundingBox),Li.applyMatrix4(e.matrixWorld),this.union(Li);const i=e.children;for(let e=0,n=i.length;e<n;e++)this.expandByObject(i[e],t);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,Ai),Ai.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,n;return e.normal.x>0?(t=e.normal.x*this.min.x,n=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,n=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,n+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,n+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,n+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,n+=e.normal.z*this.min.z),t<=-e.constant&&n>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(Ri),Hi.subVectors(this.max,Ri),Bi.subVectors(e.a,Ri),Ti.subVectors(e.b,Ri),Vi.subVectors(e.c,Ri),ki.subVectors(Ti,Bi),Ii.subVectors(Vi,Ti),Oi.subVectors(Bi,Vi);let t=[0,-ki.z,ki.y,0,-Ii.z,Ii.y,0,-Oi.z,Oi.y,ki.z,0,-ki.x,Ii.z,0,-Ii.x,Oi.z,0,-Oi.x,-ki.y,ki.x,0,-Ii.y,Ii.x,0,-Oi.y,Oi.x,0];return!!Gi(t,Bi,Ti,Vi,Hi)&&(t=[1,0,0,0,1,0,0,0,1],!!Gi(t,Bi,Ti,Vi,Hi)&&(Fi.crossVectors(ki,Ii),t=[Fi.x,Fi.y,Fi.z],Gi(t,Bi,Ti,Vi,Hi)))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return Ai.copy(e).clamp(this.min,this.max).sub(e).length()}getBoundingSphere(e){return this.getCenter(e.center),e.radius=.5*this.getSize(Ai).length(),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()||(Ni[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),Ni[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),Ni[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),Ni[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),Ni[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),Ni[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),Ni[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),Ni[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(Ni)),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const Ni=[new Ei,new Ei,new Ei,new Ei,new Ei,new Ei,new Ei,new Ei],Ai=new Ei,Li=new Ci,Bi=new Ei,Ti=new Ei,Vi=new Ei,ki=new Ei,Ii=new Ei,Oi=new Ei,Ri=new Ei,Hi=new Ei,Fi=new Ei,Di=new Ei;function Gi(e,t,n,i,r){for(let o=0,a=e.length-3;o<=a;o+=3){Di.fromArray(e,o);const a=r.x*Math.abs(Di.x)+r.y*Math.abs(Di.y)+r.z*Math.abs(Di.z),s=t.dot(Di),l=n.dot(Di),p=i.dot(Di);if(Math.max(-Math.max(s,l,p),Math.min(s,l,p))>a)return!1}return!0}const Ui=new Ci,ji=new Ei,Wi=new Ei,qi=new Ei;class Ji{constructor(e=new Ei,t=-1){this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const n=this.center;void 0!==t?n.copy(t):Ui.setFromPoints(e).getCenter(n);let i=0;for(let t=0,r=e.length;t<r;t++)i=Math.max(i,n.distanceToSquared(e[t]));return this.radius=Math.sqrt(i),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const n=this.center.distanceToSquared(e);return t.copy(e),n>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){qi.subVectors(e,this.center);const t=qi.lengthSq();if(t>this.radius*this.radius){const e=Math.sqrt(t),n=.5*(e-this.radius);this.center.add(qi.multiplyScalar(n/e)),this.radius+=n}return this}union(e){return!0===this.center.equals(e.center)?Wi.set(0,0,1).multiplyScalar(e.radius):Wi.subVectors(e.center,this.center).normalize().multiplyScalar(e.radius),this.expandByPoint(ji.copy(e.center).add(Wi)),this.expandByPoint(ji.copy(e.center).sub(Wi)),this}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return(new this.constructor).copy(this)}}const $i=new Ei,Xi=new Ei,Yi=new Ei,Ki=new Ei,Qi=new Ei,er=new Ei,tr=new Ei;class nr{constructor(e=new Ei,t=new Ei(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.direction).multiplyScalar(e).add(this.origin)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,$i)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const n=t.dot(this.direction);return n<0?t.copy(this.origin):t.copy(this.direction).multiplyScalar(n).add(this.origin)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=$i.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):($i.copy(this.direction).multiplyScalar(t).add(this.origin),$i.distanceToSquared(e))}distanceSqToSegment(e,t,n,i){Xi.copy(e).add(t).multiplyScalar(.5),Yi.copy(t).sub(e).normalize(),Ki.copy(this.origin).sub(Xi);const r=.5*e.distanceTo(t),o=-this.direction.dot(Yi),a=Ki.dot(this.direction),s=-Ki.dot(Yi),l=Ki.lengthSq(),p=Math.abs(1-o*o);let u,h,c,_;if(p>0)if(u=o*s-a,h=o*a-s,_=r*p,u>=0)if(h>=-_)if(h<=_){const e=1/p;u*=e,h*=e,c=u*(u+o*h+2*a)+h*(o*u+h+2*s)+l}else h=r,u=Math.max(0,-(o*h+a)),c=-u*u+h*(h+2*s)+l;else h=-r,u=Math.max(0,-(o*h+a)),c=-u*u+h*(h+2*s)+l;else h<=-_?(u=Math.max(0,-(-o*r+a)),h=u>0?-r:Math.min(Math.max(-r,-s),r),c=-u*u+h*(h+2*s)+l):h<=_?(u=0,h=Math.min(Math.max(-r,-s),r),c=h*(h+2*s)+l):(u=Math.max(0,-(o*r+a)),h=u>0?r:Math.min(Math.max(-r,-s),r),c=-u*u+h*(h+2*s)+l);else h=o>0?-r:r,u=Math.max(0,-(o*h+a)),c=-u*u+h*(h+2*s)+l;return n&&n.copy(this.direction).multiplyScalar(u).add(this.origin),i&&i.copy(Yi).multiplyScalar(h).add(Xi),c}intersectSphere(e,t){$i.subVectors(e.center,this.origin);const n=$i.dot(this.direction),i=$i.dot($i)-n*n,r=e.radius*e.radius;if(i>r)return null;const o=Math.sqrt(r-i),a=n-o,s=n+o;return a<0&&s<0?null:a<0?this.at(s,t):this.at(a,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(0===t)return 0===e.distanceToPoint(this.origin)?0:null;const n=-(this.origin.dot(e.normal)+e.constant)/t;return n>=0?n:null}intersectPlane(e,t){const n=this.distanceToPlane(e);return null===n?null:this.at(n,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);return 0===t||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let n,i,r,o,a,s;const l=1/this.direction.x,p=1/this.direction.y,u=1/this.direction.z,h=this.origin;return l>=0?(n=(e.min.x-h.x)*l,i=(e.max.x-h.x)*l):(n=(e.max.x-h.x)*l,i=(e.min.x-h.x)*l),p>=0?(r=(e.min.y-h.y)*p,o=(e.max.y-h.y)*p):(r=(e.max.y-h.y)*p,o=(e.min.y-h.y)*p),n>o||r>i?null:((r>n||n!=n)&&(n=r),(o<i||i!=i)&&(i=o),u>=0?(a=(e.min.z-h.z)*u,s=(e.max.z-h.z)*u):(a=(e.max.z-h.z)*u,s=(e.min.z-h.z)*u),n>s||a>i?null:((a>n||n!=n)&&(n=a),(s<i||i!=i)&&(i=s),i<0?null:this.at(n>=0?n:i,t)))}intersectsBox(e){return null!==this.intersectBox(e,$i)}intersectTriangle(e,t,n,i,r){Qi.subVectors(t,e),er.subVectors(n,e),tr.crossVectors(Qi,er);let o,a=this.direction.dot(tr);if(a>0){if(i)return null;o=1}else{if(!(a<0))return null;o=-1,a=-a}Ki.subVectors(this.origin,e);const s=o*this.direction.dot(er.crossVectors(Ki,er));if(s<0)return null;const l=o*this.direction.dot(Qi.cross(Ki));if(l<0)return null;if(s+l>a)return null;const p=-o*Ki.dot(tr);return p<0?null:this.at(p/a,r)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return(new this.constructor).copy(this)}}class ir{constructor(){this.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}set(e,t,n,i,r,o,a,s,l,p,u,h,c,_,d,m){const P=this.elements;return P[0]=e,P[4]=t,P[8]=n,P[12]=i,P[1]=r,P[5]=o,P[9]=a,P[13]=s,P[2]=l,P[6]=p,P[10]=u,P[14]=h,P[3]=c,P[7]=_,P[11]=d,P[15]=m,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new ir).fromArray(this.elements)}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],this}copyPosition(e){const t=this.elements,n=e.elements;return t[12]=n[12],t[13]=n[13],t[14]=n[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,n){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}makeBasis(e,t,n){return this.set(e.x,t.x,n.x,0,e.y,t.y,n.y,0,e.z,t.z,n.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,n=e.elements,i=1/rr.setFromMatrixColumn(e,0).length(),r=1/rr.setFromMatrixColumn(e,1).length(),o=1/rr.setFromMatrixColumn(e,2).length();return t[0]=n[0]*i,t[1]=n[1]*i,t[2]=n[2]*i,t[3]=0,t[4]=n[4]*r,t[5]=n[5]*r,t[6]=n[6]*r,t[7]=0,t[8]=n[8]*o,t[9]=n[9]*o,t[10]=n[10]*o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){e&&e.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");const t=this.elements,n=e.x,i=e.y,r=e.z,o=Math.cos(n),a=Math.sin(n),s=Math.cos(i),l=Math.sin(i),p=Math.cos(r),u=Math.sin(r);if("XYZ"===e.order){const e=o*p,n=o*u,i=a*p,r=a*u;t[0]=s*p,t[4]=-s*u,t[8]=l,t[1]=n+i*l,t[5]=e-r*l,t[9]=-a*s,t[2]=r-e*l,t[6]=i+n*l,t[10]=o*s}else if("YXZ"===e.order){const e=s*p,n=s*u,i=l*p,r=l*u;t[0]=e+r*a,t[4]=i*a-n,t[8]=o*l,t[1]=o*u,t[5]=o*p,t[9]=-a,t[2]=n*a-i,t[6]=r+e*a,t[10]=o*s}else if("ZXY"===e.order){const e=s*p,n=s*u,i=l*p,r=l*u;t[0]=e-r*a,t[4]=-o*u,t[8]=i+n*a,t[1]=n+i*a,t[5]=o*p,t[9]=r-e*a,t[2]=-o*l,t[6]=a,t[10]=o*s}else if("ZYX"===e.order){const e=o*p,n=o*u,i=a*p,r=a*u;t[0]=s*p,t[4]=i*l-n,t[8]=e*l+r,t[1]=s*u,t[5]=r*l+e,t[9]=n*l-i,t[2]=-l,t[6]=a*s,t[10]=o*s}else if("YZX"===e.order){const e=o*s,n=o*l,i=a*s,r=a*l;t[0]=s*p,t[4]=r-e*u,t[8]=i*u+n,t[1]=u,t[5]=o*p,t[9]=-a*p,t[2]=-l*p,t[6]=n*u+i,t[10]=e-r*u}else if("XZY"===e.order){const e=o*s,n=o*l,i=a*s,r=a*l;t[0]=s*p,t[4]=-u,t[8]=l*p,t[1]=e*u+r,t[5]=o*p,t[9]=n*u-i,t[2]=i*u-n,t[6]=a*p,t[10]=r*u+e}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(ar,e,sr)}lookAt(e,t,n){const i=this.elements;return ur.subVectors(e,t),0===ur.lengthSq()&&(ur.z=1),ur.normalize(),lr.crossVectors(n,ur),0===lr.lengthSq()&&(1===Math.abs(n.z)?ur.x+=1e-4:ur.z+=1e-4,ur.normalize(),lr.crossVectors(n,ur)),lr.normalize(),pr.crossVectors(ur,lr),i[0]=lr.x,i[4]=pr.x,i[8]=ur.x,i[1]=lr.y,i[5]=pr.y,i[9]=ur.y,i[2]=lr.z,i[6]=pr.z,i[10]=ur.z,this}multiply(e,t){return void 0!==t?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,i=t.elements,r=this.elements,o=n[0],a=n[4],s=n[8],l=n[12],p=n[1],u=n[5],h=n[9],c=n[13],_=n[2],d=n[6],m=n[10],P=n[14],f=n[3],x=n[7],y=n[11],v=n[15],g=i[0],b=i[4],z=i[8],w=i[12],Z=i[1],E=i[5],M=i[9],S=i[13],C=i[2],N=i[6],A=i[10],L=i[14],B=i[3],T=i[7],V=i[11],k=i[15];return r[0]=o*g+a*Z+s*C+l*B,r[4]=o*b+a*E+s*N+l*T,r[8]=o*z+a*M+s*A+l*V,r[12]=o*w+a*S+s*L+l*k,r[1]=p*g+u*Z+h*C+c*B,r[5]=p*b+u*E+h*N+c*T,r[9]=p*z+u*M+h*A+c*V,r[13]=p*w+u*S+h*L+c*k,r[2]=_*g+d*Z+m*C+P*B,r[6]=_*b+d*E+m*N+P*T,r[10]=_*z+d*M+m*A+P*V,r[14]=_*w+d*S+m*L+P*k,r[3]=f*g+x*Z+y*C+v*B,r[7]=f*b+x*E+y*N+v*T,r[11]=f*z+x*M+y*A+v*V,r[15]=f*w+x*S+y*L+v*k,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[4],i=e[8],r=e[12],o=e[1],a=e[5],s=e[9],l=e[13],p=e[2],u=e[6],h=e[10],c=e[14];return e[3]*(+r*s*u-i*l*u-r*a*h+n*l*h+i*a*c-n*s*c)+e[7]*(+t*s*c-t*l*h+r*o*h-i*o*c+i*l*p-r*s*p)+e[11]*(+t*l*u-t*a*c-r*o*u+n*o*c+r*a*p-n*l*p)+e[15]*(-i*a*p-t*s*u+t*a*h+i*o*u-n*o*h+n*s*p)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,n){const i=this.elements;return e.isVector3?(i[12]=e.x,i[13]=e.y,i[14]=e.z):(i[12]=e,i[13]=t,i[14]=n),this}invert(){const e=this.elements,t=e[0],n=e[1],i=e[2],r=e[3],o=e[4],a=e[5],s=e[6],l=e[7],p=e[8],u=e[9],h=e[10],c=e[11],_=e[12],d=e[13],m=e[14],P=e[15],f=u*m*l-d*h*l+d*s*c-a*m*c-u*s*P+a*h*P,x=_*h*l-p*m*l-_*s*c+o*m*c+p*s*P-o*h*P,y=p*d*l-_*u*l+_*a*c-o*d*c-p*a*P+o*u*P,v=_*u*s-p*d*s-_*a*h+o*d*h+p*a*m-o*u*m,g=t*f+n*x+i*y+r*v;if(0===g)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const b=1/g;return e[0]=f*b,e[1]=(d*h*r-u*m*r-d*i*c+n*m*c+u*i*P-n*h*P)*b,e[2]=(a*m*r-d*s*r+d*i*l-n*m*l-a*i*P+n*s*P)*b,e[3]=(u*s*r-a*h*r-u*i*l+n*h*l+a*i*c-n*s*c)*b,e[4]=x*b,e[5]=(p*m*r-_*h*r+_*i*c-t*m*c-p*i*P+t*h*P)*b,e[6]=(_*s*r-o*m*r-_*i*l+t*m*l+o*i*P-t*s*P)*b,e[7]=(o*h*r-p*s*r+p*i*l-t*h*l-o*i*c+t*s*c)*b,e[8]=y*b,e[9]=(_*u*r-p*d*r-_*n*c+t*d*c+p*n*P-t*u*P)*b,e[10]=(o*d*r-_*a*r+_*n*l-t*d*l-o*n*P+t*a*P)*b,e[11]=(p*a*r-o*u*r-p*n*l+t*u*l+o*n*c-t*a*c)*b,e[12]=v*b,e[13]=(p*d*i-_*u*i+_*n*h-t*d*h-p*n*m+t*u*m)*b,e[14]=(_*a*i-o*d*i-_*n*s+t*d*s+o*n*m-t*a*m)*b,e[15]=(o*u*i-p*a*i+p*n*s-t*u*s-o*n*h+t*a*h)*b,this}scale(e){const t=this.elements,n=e.x,i=e.y,r=e.z;return t[0]*=n,t[4]*=i,t[8]*=r,t[1]*=n,t[5]*=i,t[9]*=r,t[2]*=n,t[6]*=i,t[10]*=r,t[3]*=n,t[7]*=i,t[11]*=r,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],i=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,n,i))}makeTranslation(e,t,n){return this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const n=Math.cos(t),i=Math.sin(t),r=1-n,o=e.x,a=e.y,s=e.z,l=r*o,p=r*a;return this.set(l*o+n,l*a-i*s,l*s+i*a,0,l*a+i*s,p*a+n,p*s-i*o,0,l*s-i*a,p*s+i*o,r*s*s+n,0,0,0,0,1),this}makeScale(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this}makeShear(e,t,n,i,r,o){return this.set(1,n,r,0,e,1,o,0,t,i,1,0,0,0,0,1),this}compose(e,t,n){const i=this.elements,r=t._x,o=t._y,a=t._z,s=t._w,l=r+r,p=o+o,u=a+a,h=r*l,c=r*p,_=r*u,d=o*p,m=o*u,P=a*u,f=s*l,x=s*p,y=s*u,v=n.x,g=n.y,b=n.z;return i[0]=(1-(d+P))*v,i[1]=(c+y)*v,i[2]=(_-x)*v,i[3]=0,i[4]=(c-y)*g,i[5]=(1-(h+P))*g,i[6]=(m+f)*g,i[7]=0,i[8]=(_+x)*b,i[9]=(m-f)*b,i[10]=(1-(h+d))*b,i[11]=0,i[12]=e.x,i[13]=e.y,i[14]=e.z,i[15]=1,this}decompose(e,t,n){const i=this.elements;let r=rr.set(i[0],i[1],i[2]).length();const o=rr.set(i[4],i[5],i[6]).length(),a=rr.set(i[8],i[9],i[10]).length();this.determinant()<0&&(r=-r),e.x=i[12],e.y=i[13],e.z=i[14],or.copy(this);const s=1/r,l=1/o,p=1/a;return or.elements[0]*=s,or.elements[1]*=s,or.elements[2]*=s,or.elements[4]*=l,or.elements[5]*=l,or.elements[6]*=l,or.elements[8]*=p,or.elements[9]*=p,or.elements[10]*=p,t.setFromRotationMatrix(or),n.x=r,n.y=o,n.z=a,this}makePerspective(e,t,n,i,r,o){void 0===o&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");const a=this.elements,s=2*r/(t-e),l=2*r/(n-i),p=(t+e)/(t-e),u=(n+i)/(n-i),h=-(o+r)/(o-r),c=-2*o*r/(o-r);return a[0]=s,a[4]=0,a[8]=p,a[12]=0,a[1]=0,a[5]=l,a[9]=u,a[13]=0,a[2]=0,a[6]=0,a[10]=h,a[14]=c,a[3]=0,a[7]=0,a[11]=-1,a[15]=0,this}makeOrthographic(e,t,n,i,r,o){const a=this.elements,s=1/(t-e),l=1/(n-i),p=1/(o-r),u=(t+e)*s,h=(n+i)*l,c=(o+r)*p;return a[0]=2*s,a[4]=0,a[8]=0,a[12]=-u,a[1]=0,a[5]=2*l,a[9]=0,a[13]=-h,a[2]=0,a[6]=0,a[10]=-2*p,a[14]=-c,a[3]=0,a[7]=0,a[11]=0,a[15]=1,this}equals(e){const t=this.elements,n=e.elements;for(let e=0;e<16;e++)if(t[e]!==n[e])return!1;return!0}fromArray(e,t=0){for(let n=0;n<16;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e}}const rr=new Ei,or=new ir,ar=new Ei(0,0,0),sr=new Ei(1,1,1),lr=new Ei,pr=new Ei,ur=new Ei,hr=new ir,cr=new Zi;class _r{constructor(e=0,t=0,n=0,i=_r.DefaultOrder){this.isEuler=!0,this._x=e,this._y=t,this._z=n,this._order=i}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,n,i=this._order){return this._x=e,this._y=t,this._z=n,this._order=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,n=!0){const i=e.elements,r=i[0],o=i[4],a=i[8],s=i[1],l=i[5],p=i[9],u=i[2],h=i[6],c=i[10];switch(t){case"XYZ":this._y=Math.asin(ei(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-p,c),this._z=Math.atan2(-o,r)):(this._x=Math.atan2(h,l),this._z=0);break;case"YXZ":this._x=Math.asin(-ei(p,-1,1)),Math.abs(p)<.9999999?(this._y=Math.atan2(a,c),this._z=Math.atan2(s,l)):(this._y=Math.atan2(-u,r),this._z=0);break;case"ZXY":this._x=Math.asin(ei(h,-1,1)),Math.abs(h)<.9999999?(this._y=Math.atan2(-u,c),this._z=Math.atan2(-o,l)):(this._y=0,this._z=Math.atan2(s,r));break;case"ZYX":this._y=Math.asin(-ei(u,-1,1)),Math.abs(u)<.9999999?(this._x=Math.atan2(h,c),this._z=Math.atan2(s,r)):(this._x=0,this._z=Math.atan2(-o,l));break;case"YZX":this._z=Math.asin(ei(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(-p,l),this._y=Math.atan2(-u,r)):(this._x=0,this._y=Math.atan2(a,c));break;case"XZY":this._z=Math.asin(-ei(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(h,l),this._y=Math.atan2(a,r)):(this._x=Math.atan2(-p,c),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,!0===n&&this._onChangeCallback(),this}setFromQuaternion(e,t,n){return hr.makeRotationFromQuaternion(e),this.setFromRotationMatrix(hr,t,n)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return cr.setFromEuler(this),this.setFromQuaternion(cr,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}toVector3(){console.error("THREE.Euler: .toVector3() has been removed. Use Vector3.setFromEuler() instead")}}_r.DefaultOrder="XYZ",_r.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];class dr{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return 0!=(this.mask&e.mask)}isEnabled(e){return 0!=(this.mask&(1<<e|0))}}let mr=0;const Pr=new Ei,fr=new Zi,xr=new ir,yr=new Ei,vr=new Ei,gr=new Ei,br=new Zi,zr=new Ei(1,0,0),wr=new Ei(0,1,0),Zr=new Ei(0,0,1),Er={type:"added"},Mr={type:"removed"};class Sr extends Jn{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:mr++}),this.uuid=Qn(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Sr.DefaultUp.clone();const e=new Ei,t=new _r,n=new Zi,i=new Ei(1,1,1);t._onChange((function(){n.setFromEuler(t,!1)})),n._onChange((function(){t.setFromQuaternion(n,void 0,!1)})),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:i},modelViewMatrix:{value:new ir},normalMatrix:{value:new ai}}),this.matrix=new ir,this.matrixWorld=new ir,this.matrixAutoUpdate=Sr.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new dr,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return fr.setFromAxisAngle(e,t),this.quaternion.multiply(fr),this}rotateOnWorldAxis(e,t){return fr.setFromAxisAngle(e,t),this.quaternion.premultiply(fr),this}rotateX(e){return this.rotateOnAxis(zr,e)}rotateY(e){return this.rotateOnAxis(wr,e)}rotateZ(e){return this.rotateOnAxis(Zr,e)}translateOnAxis(e,t){return Pr.copy(e).applyQuaternion(this.quaternion),this.position.add(Pr.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(zr,e)}translateY(e){return this.translateOnAxis(wr,e)}translateZ(e){return this.translateOnAxis(Zr,e)}localToWorld(e){return e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return e.applyMatrix4(xr.copy(this.matrixWorld).invert())}lookAt(e,t,n){e.isVector3?yr.copy(e):yr.set(e,t,n);const i=this.parent;this.updateWorldMatrix(!0,!1),vr.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?xr.lookAt(vr,yr,this.up):xr.lookAt(yr,vr,this.up),this.quaternion.setFromRotationMatrix(xr),i&&(xr.extractRotation(i.matrixWorld),fr.setFromRotationMatrix(xr),this.quaternion.premultiply(fr.invert()))}add(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(null!==e.parent&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(Er)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.remove(arguments[e]);return this}const t=this.children.indexOf(e);return-1!==t&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(Mr)),this}removeFromParent(){const e=this.parent;return null!==e&&e.remove(this),this}clear(){for(let e=0;e<this.children.length;e++){const t=this.children[e];t.parent=null,t.dispatchEvent(Mr)}return this.children.length=0,this}attach(e){return this.updateWorldMatrix(!0,!1),xr.copy(this.matrixWorld).invert(),null!==e.parent&&(e.parent.updateWorldMatrix(!0,!1),xr.multiply(e.parent.matrixWorld)),e.applyMatrix4(xr),this.add(e),e.updateWorldMatrix(!1,!0),this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let n=0,i=this.children.length;n<i;n++){const i=this.children[n].getObjectByProperty(e,t);if(void 0!==i)return i}}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(vr,e,gr),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(vr,br,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let n=0,i=t.length;n<i;n++)t[n].traverse(e)}traverseVisible(e){if(!1===this.visible)return;e(this);const t=this.children;for(let n=0,i=t.length;n<i;n++)t[n].traverseVisible(e)}traverseAncestors(e){const t=this.parent;null!==t&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let n=0,i=t.length;n<i;n++)t[n].updateMatrixWorld(e)}updateWorldMatrix(e,t){const n=this.parent;if(!0===e&&null!==n&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===t){const e=this.children;for(let t=0,n=e.length;t<n;t++)e[t].updateWorldMatrix(!1,!0)}}toJSON(e){const t=void 0===e||"string"==typeof e,n={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},n.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});const i={};function r(t,n){return void 0===t[n.uuid]&&(t[n.uuid]=n.toJSON(e)),n.uuid}if(i.uuid=this.uuid,i.type=this.type,""!==this.name&&(i.name=this.name),!0===this.castShadow&&(i.castShadow=!0),!0===this.receiveShadow&&(i.receiveShadow=!0),!1===this.visible&&(i.visible=!1),!1===this.frustumCulled&&(i.frustumCulled=!1),0!==this.renderOrder&&(i.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(i.userData=this.userData),i.layers=this.layers.mask,i.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(i.matrixAutoUpdate=!1),this.isInstancedMesh&&(i.type="InstancedMesh",i.count=this.count,i.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(i.instanceColor=this.instanceColor.toJSON())),this.isScene)this.background&&(this.background.isColor?i.background=this.background.toJSON():this.background.isTexture&&(i.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&(i.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){i.geometry=r(e.geometries,this.geometry);const t=this.geometry.parameters;if(void 0!==t&&void 0!==t.shapes){const n=t.shapes;if(Array.isArray(n))for(let t=0,i=n.length;t<i;t++){const i=n[t];r(e.shapes,i)}else r(e.shapes,n)}}if(this.isSkinnedMesh&&(i.bindMode=this.bindMode,i.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(r(e.skeletons,this.skeleton),i.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){const t=[];for(let n=0,i=this.material.length;n<i;n++)t.push(r(e.materials,this.material[n]));i.material=t}else i.material=r(e.materials,this.material);if(this.children.length>0){i.children=[];for(let t=0;t<this.children.length;t++)i.children.push(this.children[t].toJSON(e).object)}if(this.animations.length>0){i.animations=[];for(let t=0;t<this.animations.length;t++){const n=this.animations[t];i.animations.push(r(e.animations,n))}}if(t){const t=o(e.geometries),i=o(e.materials),r=o(e.textures),a=o(e.images),s=o(e.shapes),l=o(e.skeletons),p=o(e.animations),u=o(e.nodes);t.length>0&&(n.geometries=t),i.length>0&&(n.materials=i),r.length>0&&(n.textures=r),a.length>0&&(n.images=a),s.length>0&&(n.shapes=s),l.length>0&&(n.skeletons=l),p.length>0&&(n.animations=p),u.length>0&&(n.nodes=u)}return n.object=i,n;function o(e){const t=[];for(const n in e){const i=e[n];delete i.metadata,t.push(i)}return t}}clone(e){return(new this.constructor).copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),!0===t)for(let t=0;t<e.children.length;t++){const n=e.children[t];this.add(n.clone())}return this}}Sr.DefaultUp=new Ei(0,1,0),Sr.DefaultMatrixAutoUpdate=!0;const Cr=new Ei,Nr=new Ei,Ar=new Ei,Lr=new Ei,Br=new Ei,Tr=new Ei,Vr=new Ei,kr=new Ei,Ir=new Ei,Or=new Ei;class Rr{constructor(e=new Ei,t=new Ei,n=new Ei){this.a=e,this.b=t,this.c=n}static getNormal(e,t,n,i){i.subVectors(n,t),Cr.subVectors(e,t),i.cross(Cr);const r=i.lengthSq();return r>0?i.multiplyScalar(1/Math.sqrt(r)):i.set(0,0,0)}static getBarycoord(e,t,n,i,r){Cr.subVectors(i,t),Nr.subVectors(n,t),Ar.subVectors(e,t);const o=Cr.dot(Cr),a=Cr.dot(Nr),s=Cr.dot(Ar),l=Nr.dot(Nr),p=Nr.dot(Ar),u=o*l-a*a;if(0===u)return r.set(-2,-1,-1);const h=1/u,c=(l*s-a*p)*h,_=(o*p-a*s)*h;return r.set(1-c-_,_,c)}static containsPoint(e,t,n,i){return this.getBarycoord(e,t,n,i,Lr),Lr.x>=0&&Lr.y>=0&&Lr.x+Lr.y<=1}static getUV(e,t,n,i,r,o,a,s){return this.getBarycoord(e,t,n,i,Lr),s.set(0,0),s.addScaledVector(r,Lr.x),s.addScaledVector(o,Lr.y),s.addScaledVector(a,Lr.z),s}static isFrontFacing(e,t,n,i){return Cr.subVectors(n,t),Nr.subVectors(e,t),Cr.cross(Nr).dot(i)<0}set(e,t,n){return this.a.copy(e),this.b.copy(t),this.c.copy(n),this}setFromPointsAndIndices(e,t,n,i){return this.a.copy(e[t]),this.b.copy(e[n]),this.c.copy(e[i]),this}setFromAttributeAndIndices(e,t,n,i){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,n),this.c.fromBufferAttribute(e,i),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return Cr.subVectors(this.c,this.b),Nr.subVectors(this.a,this.b),.5*Cr.cross(Nr).length()}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return Rr.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return Rr.getBarycoord(e,this.a,this.b,this.c,t)}getUV(e,t,n,i,r){return Rr.getUV(e,this.a,this.b,this.c,t,n,i,r)}containsPoint(e){return Rr.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return Rr.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const n=this.a,i=this.b,r=this.c;let o,a;Br.subVectors(i,n),Tr.subVectors(r,n),kr.subVectors(e,n);const s=Br.dot(kr),l=Tr.dot(kr);if(s<=0&&l<=0)return t.copy(n);Ir.subVectors(e,i);const p=Br.dot(Ir),u=Tr.dot(Ir);if(p>=0&&u<=p)return t.copy(i);const h=s*u-p*l;if(h<=0&&s>=0&&p<=0)return o=s/(s-p),t.copy(n).addScaledVector(Br,o);Or.subVectors(e,r);const c=Br.dot(Or),_=Tr.dot(Or);if(_>=0&&c<=_)return t.copy(r);const d=c*l-s*_;if(d<=0&&l>=0&&_<=0)return a=l/(l-_),t.copy(n).addScaledVector(Tr,a);const m=p*_-c*u;if(m<=0&&u-p>=0&&c-_>=0)return Vr.subVectors(r,i),a=(u-p)/(u-p+(c-_)),t.copy(i).addScaledVector(Vr,a);const P=1/(m+d+h);return o=d*P,a=h*P,t.copy(n).addScaledVector(Br,o).addScaledVector(Tr,a)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}let Hr=0;class Fr extends Jn{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:Hr++}),this.uuid=Qn(),this.name="",this.type="Material",this.blending=1,this.side=0,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=204,this.blendDst=205,this.blendEquation=100,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=3,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=519,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=Wn,this.stencilZFail=Wn,this.stencilZPass=Wn,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(void 0!==e)for(const t in e){const n=e[t];if(void 0===n){console.warn("THREE.Material: '"+t+"' parameter is undefined.");continue}if("shading"===t){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===n;continue}const i=this[t];void 0!==i?i&&i.isColor?i.set(n):i&&i.isVector3&&n&&n.isVector3?i.copy(n):this[t]=n:console.warn("THREE."+this.type+": '"+t+"' is not a property of this material.")}}toJSON(e){const t=void 0===e||"string"==typeof e;t&&(e={textures:{},images:{}});const n={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function i(e){const t=[];for(const n in e){const i=e[n];delete i.metadata,t.push(i)}return t}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),void 0!==this.roughness&&(n.roughness=this.roughness),void 0!==this.metalness&&(n.metalness=this.metalness),void 0!==this.sheen&&(n.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(n.sheenColor=this.sheenColor.getHex()),void 0!==this.sheenRoughness&&(n.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),void 0!==this.specularIntensity&&(n.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(n.specularColor=this.specularColor.getHex()),void 0!==this.shininess&&(n.shininess=this.shininess),void 0!==this.clearcoat&&(n.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),void 0!==this.iridescence&&(n.iridescence=this.iridescence),void 0!==this.iridescenceIOR&&(n.iridescenceIOR=this.iridescenceIOR),void 0!==this.iridescenceThicknessRange&&(n.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(n.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(n.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(e).uuid,n.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(e).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(e).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(e).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(e).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(n.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(n.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(e).uuid,void 0!==this.combine&&(n.combine=this.combine)),void 0!==this.envMapIntensity&&(n.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(n.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(n.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(e).uuid),void 0!==this.transmission&&(n.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(n.transmissionMap=this.transmissionMap.toJSON(e).uuid),void 0!==this.thickness&&(n.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(n.thicknessMap=this.thicknessMap.toJSON(e).uuid),void 0!==this.attenuationDistance&&(n.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationColor&&(n.attenuationColor=this.attenuationColor.getHex()),void 0!==this.size&&(n.size=this.size),null!==this.shadowSide&&(n.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(n.sizeAttenuation=this.sizeAttenuation),1!==this.blending&&(n.blending=this.blending),0!==this.side&&(n.side=this.side),this.vertexColors&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),!0===this.transparent&&(n.transparent=this.transparent),n.depthFunc=this.depthFunc,n.depthTest=this.depthTest,n.depthWrite=this.depthWrite,n.colorWrite=this.colorWrite,n.stencilWrite=this.stencilWrite,n.stencilWriteMask=this.stencilWriteMask,n.stencilFunc=this.stencilFunc,n.stencilRef=this.stencilRef,n.stencilFuncMask=this.stencilFuncMask,n.stencilFail=this.stencilFail,n.stencilZFail=this.stencilZFail,n.stencilZPass=this.stencilZPass,void 0!==this.rotation&&0!==this.rotation&&(n.rotation=this.rotation),!0===this.polygonOffset&&(n.polygonOffset=!0),0!==this.polygonOffsetFactor&&(n.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(n.polygonOffsetUnits=this.polygonOffsetUnits),void 0!==this.linewidth&&1!==this.linewidth&&(n.linewidth=this.linewidth),void 0!==this.dashSize&&(n.dashSize=this.dashSize),void 0!==this.gapSize&&(n.gapSize=this.gapSize),void 0!==this.scale&&(n.scale=this.scale),!0===this.dithering&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),!0===this.alphaToCoverage&&(n.alphaToCoverage=this.alphaToCoverage),!0===this.premultipliedAlpha&&(n.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(n.wireframe=this.wireframe),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(n.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(n.wireframeLinejoin=this.wireframeLinejoin),!0===this.flatShading&&(n.flatShading=this.flatShading),!1===this.visible&&(n.visible=!1),!1===this.toneMapped&&(n.toneMapped=!1),!1===this.fog&&(n.fog=!1),"{}"!==JSON.stringify(this.userData)&&(n.userData=this.userData),t){const t=i(e.textures),r=i(e.images);t.length>0&&(n.textures=t),r.length>0&&(n.images=r)}return n}clone(){return(new this.constructor).copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let n=null;if(null!==t){const e=t.length;n=new Array(e);for(let i=0;i!==e;++i)n[i]=t[i].clone()}return this.clippingPlanes=n,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){!0===e&&this.version++}get vertexTangents(){return console.warn("THREE."+this.type+": .vertexTangents has been removed."),!1}set vertexTangents(e){console.warn("THREE."+this.type+": .vertexTangents has been removed.")}}Fr.fromType=function(){return null};class Dr extends Fr{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new xi(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const Gr=new Ei,Ur=new oi;class jr{constructor(e,t,n){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=e,this.itemSize=t,this.count=void 0!==e?e.length/t:0,this.normalized=!0===n,this.usage=qn,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this}copyAt(e,t,n){e*=this.itemSize,n*=t.itemSize;for(let i=0,r=this.itemSize;i<r;i++)this.array[e+i]=t.array[n+i];return this}copyArray(e){return this.array.set(e),this}copyColorsArray(e){const t=this.array;let n=0;for(let i=0,r=e.length;i<r;i++){let r=e[i];void 0===r&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",i),r=new xi),t[n++]=r.r,t[n++]=r.g,t[n++]=r.b}return this}copyVector2sArray(e){const t=this.array;let n=0;for(let i=0,r=e.length;i<r;i++){let r=e[i];void 0===r&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",i),r=new oi),t[n++]=r.x,t[n++]=r.y}return this}copyVector3sArray(e){const t=this.array;let n=0;for(let i=0,r=e.length;i<r;i++){let r=e[i];void 0===r&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",i),r=new Ei),t[n++]=r.x,t[n++]=r.y,t[n++]=r.z}return this}copyVector4sArray(e){const t=this.array;let n=0;for(let i=0,r=e.length;i<r;i++){let r=e[i];void 0===r&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",i),r=new wi),t[n++]=r.x,t[n++]=r.y,t[n++]=r.z,t[n++]=r.w}return this}applyMatrix3(e){if(2===this.itemSize)for(let t=0,n=this.count;t<n;t++)Ur.fromBufferAttribute(this,t),Ur.applyMatrix3(e),this.setXY(t,Ur.x,Ur.y);else if(3===this.itemSize)for(let t=0,n=this.count;t<n;t++)Gr.fromBufferAttribute(this,t),Gr.applyMatrix3(e),this.setXYZ(t,Gr.x,Gr.y,Gr.z);return this}applyMatrix4(e){for(let t=0,n=this.count;t<n;t++)Gr.fromBufferAttribute(this,t),Gr.applyMatrix4(e),this.setXYZ(t,Gr.x,Gr.y,Gr.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)Gr.fromBufferAttribute(this,t),Gr.applyNormalMatrix(e),this.setXYZ(t,Gr.x,Gr.y,Gr.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)Gr.fromBufferAttribute(this,t),Gr.transformDirection(e),this.setXYZ(t,Gr.x,Gr.y,Gr.z);return this}set(e,t=0){return this.array.set(e,t),this}getX(e){return this.array[e*this.itemSize]}setX(e,t){return this.array[e*this.itemSize]=t,this}getY(e){return this.array[e*this.itemSize+1]}setY(e,t){return this.array[e*this.itemSize+1]=t,this}getZ(e){return this.array[e*this.itemSize+2]}setZ(e,t){return this.array[e*this.itemSize+2]=t,this}getW(e){return this.array[e*this.itemSize+3]}setW(e,t){return this.array[e*this.itemSize+3]=t,this}setXY(e,t,n){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=n,this}setXYZ(e,t,n,i){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=i,this}setXYZW(e,t,n,i,r){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=i,this.array[e+3]=r,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized};return""!==this.name&&(e.name=this.name),this.usage!==qn&&(e.usage=this.usage),0===this.updateRange.offset&&-1===this.updateRange.count||(e.updateRange=this.updateRange),e}}class Wr extends jr{constructor(e,t,n){super(new Uint16Array(e),t,n)}}class qr extends jr{constructor(e,t,n){super(new Uint32Array(e),t,n)}}class Jr extends jr{constructor(e,t,n){super(new Float32Array(e),t,n)}}let $r=0;const Xr=new ir,Yr=new Sr,Kr=new Ei,Qr=new Ci,eo=new Ci,to=new Ei;class no extends Jn{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:$r++}),this.uuid=Qn(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(function(e){for(let t=e.length-1;t>=0;--t)if(e[t]>65535)return!0;return!1}(e)?qr:Wr)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return void 0!==this.attributes[e]}addGroup(e,t,n=0){this.groups.push({start:e,count:t,materialIndex:n})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;void 0!==t&&(t.applyMatrix4(e),t.needsUpdate=!0);const n=this.attributes.normal;if(void 0!==n){const t=(new ai).getNormalMatrix(e);n.applyNormalMatrix(t),n.needsUpdate=!0}const i=this.attributes.tangent;return void 0!==i&&(i.transformDirection(e),i.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}applyQuaternion(e){return Xr.makeRotationFromQuaternion(e),this.applyMatrix4(Xr),this}rotateX(e){return Xr.makeRotationX(e),this.applyMatrix4(Xr),this}rotateY(e){return Xr.makeRotationY(e),this.applyMatrix4(Xr),this}rotateZ(e){return Xr.makeRotationZ(e),this.applyMatrix4(Xr),this}translate(e,t,n){return Xr.makeTranslation(e,t,n),this.applyMatrix4(Xr),this}scale(e,t,n){return Xr.makeScale(e,t,n),this.applyMatrix4(Xr),this}lookAt(e){return Yr.lookAt(e),Yr.updateMatrix(),this.applyMatrix4(Yr.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(Kr).negate(),this.translate(Kr.x,Kr.y,Kr.z),this}setFromPoints(e){const t=[];for(let n=0,i=e.length;n<i;n++){const i=e[n];t.push(i.x,i.y,i.z||0)}return this.setAttribute("position",new Jr(t,3)),this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new Ci);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingBox.set(new Ei(-1/0,-1/0,-1/0),new Ei(1/0,1/0,1/0));if(void 0!==e){if(this.boundingBox.setFromBufferAttribute(e),t)for(let e=0,n=t.length;e<n;e++){const n=t[e];Qr.setFromBufferAttribute(n),this.morphTargetsRelative?(to.addVectors(this.boundingBox.min,Qr.min),this.boundingBox.expandByPoint(to),to.addVectors(this.boundingBox.max,Qr.max),this.boundingBox.expandByPoint(to)):(this.boundingBox.expandByPoint(Qr.min),this.boundingBox.expandByPoint(Qr.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new Ji);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingSphere.set(new Ei,1/0);if(e){const n=this.boundingSphere.center;if(Qr.setFromBufferAttribute(e),t)for(let e=0,n=t.length;e<n;e++){const n=t[e];eo.setFromBufferAttribute(n),this.morphTargetsRelative?(to.addVectors(Qr.min,eo.min),Qr.expandByPoint(to),to.addVectors(Qr.max,eo.max),Qr.expandByPoint(to)):(Qr.expandByPoint(eo.min),Qr.expandByPoint(eo.max))}Qr.getCenter(n);let i=0;for(let t=0,r=e.count;t<r;t++)to.fromBufferAttribute(e,t),i=Math.max(i,n.distanceToSquared(to));if(t)for(let r=0,o=t.length;r<o;r++){const o=t[r],a=this.morphTargetsRelative;for(let t=0,r=o.count;t<r;t++)to.fromBufferAttribute(o,t),a&&(Kr.fromBufferAttribute(e,t),to.add(Kr)),i=Math.max(i,n.distanceToSquared(to))}this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,t=this.attributes;if(null===e||void 0===t.position||void 0===t.normal||void 0===t.uv)return void console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");const n=e.array,i=t.position.array,r=t.normal.array,o=t.uv.array,a=i.length/3;!1===this.hasAttribute("tangent")&&this.setAttribute("tangent",new jr(new Float32Array(4*a),4));const s=this.getAttribute("tangent").array,l=[],p=[];for(let e=0;e<a;e++)l[e]=new Ei,p[e]=new Ei;const u=new Ei,h=new Ei,c=new Ei,_=new oi,d=new oi,m=new oi,P=new Ei,f=new Ei;function x(e,t,n){u.fromArray(i,3*e),h.fromArray(i,3*t),c.fromArray(i,3*n),_.fromArray(o,2*e),d.fromArray(o,2*t),m.fromArray(o,2*n),h.sub(u),c.sub(u),d.sub(_),m.sub(_);const r=1/(d.x*m.y-m.x*d.y);isFinite(r)&&(P.copy(h).multiplyScalar(m.y).addScaledVector(c,-d.y).multiplyScalar(r),f.copy(c).multiplyScalar(d.x).addScaledVector(h,-m.x).multiplyScalar(r),l[e].add(P),l[t].add(P),l[n].add(P),p[e].add(f),p[t].add(f),p[n].add(f))}let y=this.groups;0===y.length&&(y=[{start:0,count:n.length}]);for(let e=0,t=y.length;e<t;++e){const t=y[e],i=t.start;for(let e=i,r=i+t.count;e<r;e+=3)x(n[e+0],n[e+1],n[e+2])}const v=new Ei,g=new Ei,b=new Ei,z=new Ei;function w(e){b.fromArray(r,3*e),z.copy(b);const t=l[e];v.copy(t),v.sub(b.multiplyScalar(b.dot(t))).normalize(),g.crossVectors(z,t);const n=g.dot(p[e])<0?-1:1;s[4*e]=v.x,s[4*e+1]=v.y,s[4*e+2]=v.z,s[4*e+3]=n}for(let e=0,t=y.length;e<t;++e){const t=y[e],i=t.start;for(let e=i,r=i+t.count;e<r;e+=3)w(n[e+0]),w(n[e+1]),w(n[e+2])}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(void 0!==t){let n=this.getAttribute("normal");if(void 0===n)n=new jr(new Float32Array(3*t.count),3),this.setAttribute("normal",n);else for(let e=0,t=n.count;e<t;e++)n.setXYZ(e,0,0,0);const i=new Ei,r=new Ei,o=new Ei,a=new Ei,s=new Ei,l=new Ei,p=new Ei,u=new Ei;if(e)for(let h=0,c=e.count;h<c;h+=3){const c=e.getX(h+0),_=e.getX(h+1),d=e.getX(h+2);i.fromBufferAttribute(t,c),r.fromBufferAttribute(t,_),o.fromBufferAttribute(t,d),p.subVectors(o,r),u.subVectors(i,r),p.cross(u),a.fromBufferAttribute(n,c),s.fromBufferAttribute(n,_),l.fromBufferAttribute(n,d),a.add(p),s.add(p),l.add(p),n.setXYZ(c,a.x,a.y,a.z),n.setXYZ(_,s.x,s.y,s.z),n.setXYZ(d,l.x,l.y,l.z)}else for(let e=0,a=t.count;e<a;e+=3)i.fromBufferAttribute(t,e+0),r.fromBufferAttribute(t,e+1),o.fromBufferAttribute(t,e+2),p.subVectors(o,r),u.subVectors(i,r),p.cross(u),n.setXYZ(e+0,p.x,p.y,p.z),n.setXYZ(e+1,p.x,p.y,p.z),n.setXYZ(e+2,p.x,p.y,p.z);this.normalizeNormals(),n.needsUpdate=!0}}merge(e,t){if(!e||!e.isBufferGeometry)return void console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",e);void 0===t&&(t=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));const n=this.attributes;for(const i in n){if(void 0===e.attributes[i])continue;const r=n[i].array,o=e.attributes[i],a=o.array,s=o.itemSize*t,l=Math.min(a.length,r.length-s);for(let e=0,t=s;e<l;e++,t++)r[t]=a[e]}return this}normalizeNormals(){const e=this.attributes.normal;for(let t=0,n=e.count;t<n;t++)to.fromBufferAttribute(e,t),to.normalize(),e.setXYZ(t,to.x,to.y,to.z)}toNonIndexed(){function e(e,t){const n=e.array,i=e.itemSize,r=e.normalized,o=new n.constructor(t.length*i);let a=0,s=0;for(let r=0,l=t.length;r<l;r++){a=e.isInterleavedBufferAttribute?t[r]*e.data.stride+e.offset:t[r]*i;for(let e=0;e<i;e++)o[s++]=n[a++]}return new jr(o,i,r)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new no,n=this.index.array,i=this.attributes;for(const r in i){const o=e(i[r],n);t.setAttribute(r,o)}const r=this.morphAttributes;for(const i in r){const o=[],a=r[i];for(let t=0,i=a.length;t<i;t++){const i=e(a[t],n);o.push(i)}t.morphAttributes[i]=o}t.morphTargetsRelative=this.morphTargetsRelative;const o=this.groups;for(let e=0,n=o.length;e<n;e++){const n=o[e];t.addGroup(n.start,n.count,n.materialIndex)}return t}toJSON(){const e={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),void 0!==this.parameters){const t=this.parameters;for(const n in t)void 0!==t[n]&&(e[n]=t[n]);return e}e.data={attributes:{}};const t=this.index;null!==t&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const n=this.attributes;for(const t in n){const i=n[t];e.data.attributes[t]=i.toJSON(e.data)}const i={};let r=!1;for(const t in this.morphAttributes){const n=this.morphAttributes[t],o=[];for(let t=0,i=n.length;t<i;t++){const i=n[t];o.push(i.toJSON(e.data))}o.length>0&&(i[t]=o,r=!0)}r&&(e.data.morphAttributes=i,e.data.morphTargetsRelative=this.morphTargetsRelative);const o=this.groups;o.length>0&&(e.data.groups=JSON.parse(JSON.stringify(o)));const a=this.boundingSphere;return null!==a&&(e.data.boundingSphere={center:a.center.toArray(),radius:a.radius}),e}clone(){return(new this.constructor).copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const n=e.index;null!==n&&this.setIndex(n.clone(t));const i=e.attributes;for(const e in i){const n=i[e];this.setAttribute(e,n.clone(t))}const r=e.morphAttributes;for(const e in r){const n=[],i=r[e];for(let e=0,r=i.length;e<r;e++)n.push(i[e].clone(t));this.morphAttributes[e]=n}this.morphTargetsRelative=e.morphTargetsRelative;const o=e.groups;for(let e=0,t=o.length;e<t;e++){const t=o[e];this.addGroup(t.start,t.count,t.materialIndex)}const a=e.boundingBox;null!==a&&(this.boundingBox=a.clone());const s=e.boundingSphere;return null!==s&&(this.boundingSphere=s.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,void 0!==e.parameters&&(this.parameters=Object.assign({},e.parameters)),this}dispose(){this.dispatchEvent({type:"dispose"})}}const io=new ir,ro=new nr,oo=new Ji,ao=new Ei,so=new Ei,lo=new Ei,po=new Ei,uo=new Ei,ho=new Ei,co=new Ei,_o=new Ei,mo=new Ei,Po=new oi,fo=new oi,xo=new oi,yo=new Ei,vo=new Ei;class go extends Sr{constructor(e=new no,t=new Dr){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),void 0!==e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),void 0!==e.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=e.material,this.geometry=e.geometry,this}updateMorphTargets(){const e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){const n=e[t[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,t=n.length;e<t;e++){const t=n[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[t]=e}}}}raycast(e,t){const n=this.geometry,i=this.material,r=this.matrixWorld;if(void 0===i)return;if(null===n.boundingSphere&&n.computeBoundingSphere(),oo.copy(n.boundingSphere),oo.applyMatrix4(r),!1===e.ray.intersectsSphere(oo))return;if(io.copy(r).invert(),ro.copy(e.ray).applyMatrix4(io),null!==n.boundingBox&&!1===ro.intersectsBox(n.boundingBox))return;let o;const a=n.index,s=n.attributes.position,l=n.morphAttributes.position,p=n.morphTargetsRelative,u=n.attributes.uv,h=n.attributes.uv2,c=n.groups,_=n.drawRange;if(null!==a)if(Array.isArray(i))for(let n=0,r=c.length;n<r;n++){const r=c[n],d=i[r.materialIndex];for(let n=Math.max(r.start,_.start),i=Math.min(a.count,Math.min(r.start+r.count,_.start+_.count));n<i;n+=3){const i=a.getX(n),c=a.getX(n+1),_=a.getX(n+2);o=bo(this,d,e,ro,s,l,p,u,h,i,c,_),o&&(o.faceIndex=Math.floor(n/3),o.face.materialIndex=r.materialIndex,t.push(o))}}else for(let n=Math.max(0,_.start),r=Math.min(a.count,_.start+_.count);n<r;n+=3){const r=a.getX(n),c=a.getX(n+1),_=a.getX(n+2);o=bo(this,i,e,ro,s,l,p,u,h,r,c,_),o&&(o.faceIndex=Math.floor(n/3),t.push(o))}else if(void 0!==s)if(Array.isArray(i))for(let n=0,r=c.length;n<r;n++){const r=c[n],a=i[r.materialIndex];for(let n=Math.max(r.start,_.start),i=Math.min(s.count,Math.min(r.start+r.count,_.start+_.count));n<i;n+=3)o=bo(this,a,e,ro,s,l,p,u,h,n,n+1,n+2),o&&(o.faceIndex=Math.floor(n/3),o.face.materialIndex=r.materialIndex,t.push(o))}else for(let n=Math.max(0,_.start),r=Math.min(s.count,_.start+_.count);n<r;n+=3)o=bo(this,i,e,ro,s,l,p,u,h,n,n+1,n+2),o&&(o.faceIndex=Math.floor(n/3),t.push(o))}}function bo(e,t,n,i,r,o,a,s,l,p,u,h){ao.fromBufferAttribute(r,p),so.fromBufferAttribute(r,u),lo.fromBufferAttribute(r,h);const c=e.morphTargetInfluences;if(o&&c){co.set(0,0,0),_o.set(0,0,0),mo.set(0,0,0);for(let e=0,t=o.length;e<t;e++){const t=c[e],n=o[e];0!==t&&(po.fromBufferAttribute(n,p),uo.fromBufferAttribute(n,u),ho.fromBufferAttribute(n,h),a?(co.addScaledVector(po,t),_o.addScaledVector(uo,t),mo.addScaledVector(ho,t)):(co.addScaledVector(po.sub(ao),t),_o.addScaledVector(uo.sub(so),t),mo.addScaledVector(ho.sub(lo),t)))}ao.add(co),so.add(_o),lo.add(mo)}e.isSkinnedMesh&&(e.boneTransform(p,ao),e.boneTransform(u,so),e.boneTransform(h,lo));const _=function(e,t,n,i,r,o,a,s){let l;if(l=1===t.side?i.intersectTriangle(a,o,r,!0,s):i.intersectTriangle(r,o,a,2!==t.side,s),null===l)return null;vo.copy(s),vo.applyMatrix4(e.matrixWorld);const p=n.ray.origin.distanceTo(vo);return p<n.near||p>n.far?null:{distance:p,point:vo.clone(),object:e}}(e,t,n,i,ao,so,lo,yo);if(_){s&&(Po.fromBufferAttribute(s,p),fo.fromBufferAttribute(s,u),xo.fromBufferAttribute(s,h),_.uv=Rr.getUV(yo,ao,so,lo,Po,fo,xo,new oi)),l&&(Po.fromBufferAttribute(l,p),fo.fromBufferAttribute(l,u),xo.fromBufferAttribute(l,h),_.uv2=Rr.getUV(yo,ao,so,lo,Po,fo,xo,new oi));const e={a:p,b:u,c:h,normal:new Ei,materialIndex:0};Rr.getNormal(ao,so,lo,e.normal),_.face=e}return _}function zo(e){const t={};for(const n in e){t[n]={};for(const i in e[n]){const r=e[n][i];r&&(r.isColor||r.isMatrix3||r.isMatrix4||r.isVector2||r.isVector3||r.isVector4||r.isTexture||r.isQuaternion)?t[n][i]=r.clone():Array.isArray(r)?t[n][i]=r.slice():t[n][i]=r}}return t}function wo(e){const t={};for(let n=0;n<e.length;n++){const i=zo(e[n]);for(const e in i)t[e]=i[e]}return t}class Zo extends Fr{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==e&&(void 0!==e.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(e))}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=zo(e.uniforms),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const n in this.uniforms){const i=this.uniforms[n].value;i&&i.isTexture?t.uniforms[n]={type:"t",value:i.toJSON(e).uuid}:i&&i.isColor?t.uniforms[n]={type:"c",value:i.getHex()}:i&&i.isVector2?t.uniforms[n]={type:"v2",value:i.toArray()}:i&&i.isVector3?t.uniforms[n]={type:"v3",value:i.toArray()}:i&&i.isVector4?t.uniforms[n]={type:"v4",value:i.toArray()}:i&&i.isMatrix3?t.uniforms[n]={type:"m3",value:i.toArray()}:i&&i.isMatrix4?t.uniforms[n]={type:"m4",value:i.toArray()}:t.uniforms[n]={value:i}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader;const n={};for(const e in this.extensions)!0===this.extensions[e]&&(n[e]=!0);return Object.keys(n).length>0&&(t.extensions=n),t}}class Eo extends Sr{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new ir,this.projectionMatrix=new ir,this.projectionMatrixInverse=new ir}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return(new this.constructor).copy(this)}}class Mo extends Eo{constructor(e=50,t=1,n=.1,i=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=n,this.far=i,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=2*Kn*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(.5*Yn*this.fov);return.5*this.getFilmHeight()/e}getEffectiveFOV(){return 2*Kn*Math.atan(Math.tan(.5*Yn*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(e,t,n,i,r,o){this.aspect=e/t,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=i,this.view.width=r,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(.5*Yn*this.fov)/this.zoom,n=2*t,i=this.aspect*n,r=-.5*i;const o=this.view;if(null!==this.view&&this.view.enabled){const e=o.fullWidth,a=o.fullHeight;r+=o.offsetX*i/e,t-=o.offsetY*n/a,i*=o.width/e,n*=o.height/a}const a=this.filmOffset;0!==a&&(r+=e*a/this.getFilmWidth()),this.projectionMatrix.makePerspective(r,r+i,t,t-n,e,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,null!==this.view&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}const So=new Ei,Co=new Ei,No=new ai;class Ao{constructor(e=new Ei(1,0,0),t=0){this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,n,i){return this.normal.set(e,t,n),this.constant=i,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,n){const i=So.subVectors(n,t).cross(Co.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(i,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)}intersectLine(e,t){const n=e.delta(So),i=this.normal.dot(n);if(0===i)return 0===this.distanceToPoint(e.start)?t.copy(e.start):null;const r=-(e.start.dot(this.normal)+this.constant)/i;return r<0||r>1?null:t.copy(n).multiplyScalar(r).add(e.start)}intersectsLine(e){const t=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return t<0&&n>0||n<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const n=t||No.getNormalMatrix(e),i=this.coplanarPoint(So).applyMatrix4(e),r=this.normal.applyMatrix3(n).normalize();return this.constant=-i.dot(r),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return(new this.constructor).copy(this)}}const Lo=new Ji,Bo=new Ei;class To{constructor(e=new Ao,t=new Ao,n=new Ao,i=new Ao,r=new Ao,o=new Ao){this.planes=[e,t,n,i,r,o]}set(e,t,n,i,r,o){const a=this.planes;return a[0].copy(e),a[1].copy(t),a[2].copy(n),a[3].copy(i),a[4].copy(r),a[5].copy(o),this}copy(e){const t=this.planes;for(let n=0;n<6;n++)t[n].copy(e.planes[n]);return this}setFromProjectionMatrix(e){const t=this.planes,n=e.elements,i=n[0],r=n[1],o=n[2],a=n[3],s=n[4],l=n[5],p=n[6],u=n[7],h=n[8],c=n[9],_=n[10],d=n[11],m=n[12],P=n[13],f=n[14],x=n[15];return t[0].setComponents(a-i,u-s,d-h,x-m).normalize(),t[1].setComponents(a+i,u+s,d+h,x+m).normalize(),t[2].setComponents(a+r,u+l,d+c,x+P).normalize(),t[3].setComponents(a-r,u-l,d-c,x-P).normalize(),t[4].setComponents(a-o,u-p,d-_,x-f).normalize(),t[5].setComponents(a+o,u+p,d+_,x+f).normalize(),this}intersectsObject(e){const t=e.geometry;return null===t.boundingSphere&&t.computeBoundingSphere(),Lo.copy(t.boundingSphere).applyMatrix4(e.matrixWorld),this.intersectsSphere(Lo)}intersectsSprite(e){return Lo.center.set(0,0,0),Lo.radius=.7071067811865476,Lo.applyMatrix4(e.matrixWorld),this.intersectsSphere(Lo)}intersectsSphere(e){const t=this.planes,n=e.center,i=-e.radius;for(let e=0;e<6;e++)if(t[e].distanceToPoint(n)<i)return!1;return!0}intersectsBox(e){const t=this.planes;for(let n=0;n<6;n++){const i=t[n];if(Bo.x=i.normal.x>0?e.max.x:e.min.x,Bo.y=i.normal.y>0?e.max.y:e.min.y,Bo.z=i.normal.z>0?e.max.z:e.min.z,i.distanceToPoint(Bo)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let n=0;n<6;n++)if(t[n].distanceToPoint(e)<0)return!1;return!0}clone(){return(new this.constructor).copy(this)}}const Vo="#define STANDARD\nvarying vec3 vViewPosition;\n#ifdef USE_TRANSMISSION\n\tvarying vec3 vWorldPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n#ifdef USE_TRANSMISSION\n\tvWorldPosition = worldPosition.xyz;\n#endif\n}",ko="#define STANDARD\n#ifdef PHYSICAL\n\t#define IOR\n\t#define SPECULAR\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef IOR\n\tuniform float ior;\n#endif\n#ifdef SPECULAR\n\tuniform float specularIntensity;\n\tuniform vec3 specularColor;\n\t#ifdef USE_SPECULARINTENSITYMAP\n\t\tuniform sampler2D specularIntensityMap;\n\t#endif\n\t#ifdef USE_SPECULARCOLORMAP\n\t\tuniform sampler2D specularColorMap;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_IRIDESCENCE\n\tuniform float iridescence;\n\tuniform float iridescenceIOR;\n\tuniform float iridescenceThicknessMinimum;\n\tuniform float iridescenceThicknessMaximum;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheenColor;\n\tuniform float sheenRoughness;\n\t#ifdef USE_SHEENCOLORMAP\n\t\tuniform sampler2D sheenColorMap;\n\t#endif\n\t#ifdef USE_SHEENROUGHNESSMAP\n\t\tuniform sampler2D sheenRoughnessMap;\n\t#endif\n#endif\nvarying vec3 vViewPosition;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <bsdfs>\n#include <iridescence_fragment>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_physical_pars_fragment>\n#include <transmission_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <iridescence_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n\tvec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n\t#include <transmission_fragment>\n\tvec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\n\t#ifdef USE_SHEEN\n\t\tfloat sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );\n\t\toutgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );\n\t\tvec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );\n\t\toutgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;\n\t#endif\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",Io={common:{diffuse:{value:new xi(16777215)},opacity:{value:1},map:{value:null},uvTransform:{value:new ai},uv2Transform:{value:new ai},alphaMap:{value:null},alphaTest:{value:0}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new oi(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new xi(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new xi(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new ai}},sprite:{diffuse:{value:new xi(16777215)},opacity:{value:1},center:{value:new oi(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new ai}}},Oo={basic:{uniforms:wo([Io.common,Io.specularmap,Io.envmap,Io.aomap,Io.lightmap,Io.fog]),vertexShader:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinbase_vertex>\n\t\t#include <skinnormal_vertex>\n\t\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",fragmentShader:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\t\treflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}"},lambert:{uniforms:wo([Io.common,Io.specularmap,Io.envmap,Io.aomap,Io.lightmap,Io.emissivemap,Io.fog,Io.lights,{emissive:{value:new xi(0)}}]),vertexShader:"#define LAMBERT\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",fragmentShader:"uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;\n\t#else\n\t\treflectedLight.indirectDiffuse += vIndirectFront;\n\t#endif\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}"},phong:{uniforms:wo([Io.common,Io.specularmap,Io.envmap,Io.aomap,Io.lightmap,Io.emissivemap,Io.bumpmap,Io.normalmap,Io.displacementmap,Io.fog,Io.lights,{emissive:{value:new xi(0)},specular:{value:new xi(1118481)},shininess:{value:30}}]),vertexShader:"#define PHONG\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",fragmentShader:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}"},standard:{uniforms:wo([Io.common,Io.envmap,Io.aomap,Io.lightmap,Io.emissivemap,Io.bumpmap,Io.normalmap,Io.displacementmap,Io.roughnessmap,Io.metalnessmap,Io.fog,Io.lights,{emissive:{value:new xi(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Vo,fragmentShader:ko},toon:{uniforms:wo([Io.common,Io.aomap,Io.lightmap,Io.emissivemap,Io.bumpmap,Io.normalmap,Io.displacementmap,Io.gradientmap,Io.fog,Io.lights,{emissive:{value:new xi(0)}}]),vertexShader:"#define TOON\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",fragmentShader:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}"},matcap:{uniforms:wo([Io.common,Io.bumpmap,Io.normalmap,Io.displacementmap,Io.fog,{matcap:{value:null}}]),vertexShader:"#define MATCAP\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",fragmentShader:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t#else\n\t\tvec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}"},points:{uniforms:wo([Io.points,Io.fog]),vertexShader:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",fragmentShader:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}"},dashed:{uniforms:wo([Io.common,Io.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",fragmentShader:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}"},depth:{uniforms:wo([Io.common,Io.displacementmap]),vertexShader:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",fragmentShader:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#endif\n}"},normal:{uniforms:wo([Io.common,Io.bumpmap,Io.normalmap,Io.displacementmap,{opacity:{value:1}}]),vertexShader:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",fragmentShader:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n\t#ifdef OPAQUE\n\t\tgl_FragColor.a = 1.0;\n\t#endif\n}"},sprite:{uniforms:wo([Io.sprite,Io.fog]),vertexShader:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",fragmentShader:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}"},background:{uniforms:{uvTransform:{value:new ai},t2D:{value:null}},vertexShader:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",fragmentShader:"uniform sampler2D t2D;\nvarying vec2 vUv;\nvoid main() {\n\tgl_FragColor = texture2D( t2D, vUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\tgl_FragColor = vec4( mix( pow( gl_FragColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), gl_FragColor.rgb * 0.0773993808, vec3( lessThanEqual( gl_FragColor.rgb, vec3( 0.04045 ) ) ) ), gl_FragColor.w );\n\t#endif\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}"},cube:{uniforms:wo([Io.envmap,{opacity:{value:1}}]),vertexShader:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",fragmentShader:"#include <envmap_common_pars_fragment>\nuniform float opacity;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\tvec3 vReflect = vWorldDirection;\n\t#include <envmap_fragment>\n\tgl_FragColor = envColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}"},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",fragmentShader:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}"},distanceRGBA:{uniforms:wo([Io.common,Io.displacementmap,{referencePosition:{value:new Ei},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",fragmentShader:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}"},shadow:{uniforms:wo([Io.lights,Io.fog,{color:{value:new xi(0)},opacity:{value:1}}]),vertexShader:"#include <common>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",fragmentShader:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}"}};Oo.physical={uniforms:wo([Oo.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new oi(1,1)},clearcoatNormalMap:{value:null},iridescence:{value:0},iridescenceMap:{value:null},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},sheen:{value:0},sheenColor:{value:new xi(0)},sheenColorMap:{value:null},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},transmission:{value:0},transmissionMap:{value:null},transmissionSamplerSize:{value:new oi},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:0},attenuationColor:{value:new xi(0)},specularIntensity:{value:1},specularIntensityMap:{value:null},specularColor:{value:new xi(1,1,1)},specularColorMap:{value:null}}]),vertexShader:Vo,fragmentShader:ko};class Ro extends Eo{constructor(e=-1,t=1,n=1,i=-1,r=.1,o=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=n,this.bottom=i,this.near=r,this.far=o,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=null===e.view?null:Object.assign({},e.view),this}setViewOffset(e,t,n,i,r,o){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=i,this.view.width=r,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,i=(this.top+this.bottom)/2;let r=n-e,o=n+e,a=i+t,s=i-t;if(null!==this.view&&this.view.enabled){const e=(this.right-this.left)/this.view.fullWidth/this.zoom,t=(this.top-this.bottom)/this.view.fullHeight/this.zoom;r+=e*this.view.offsetX,o=r+e*this.view.width,a-=t*this.view.offsetY,s=a-t*this.view.height}this.projectionMatrix.makeOrthographic(r,o,a,s,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,null!==this.view&&(t.object.view=Object.assign({},this.view)),t}}new zi,new class extends zi{constructor(e=null,t=1,n=1,i=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:n,depth:i},this.magFilter=Rn,this.minFilter=Rn,this.wrapR=In,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}},new class extends zi{constructor(e=null,t=1,n=1,i=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:n,depth:i},this.magFilter=Rn,this.minFilter=Rn,this.wrapR=In,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}},new class extends zi{constructor(e,t,n,i,r,o,a,s,l,p){super(e=void 0!==e?e:[],t=void 0!==t?t:301,n,i,r,o,a,s,l,p),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}};class Ho extends Sr{constructor(){super(),this.isGroup=!0,this.type="Group"}}class Fo{constructor(e,t){this.isInterleavedBuffer=!0,this.array=e,this.stride=t,this.count=void 0!==e?e.length/t:0,this.usage=qn,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=Qn()}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,n){e*=this.stride,n*=t.stride;for(let i=0,r=this.stride;i<r;i++)this.array[e+i]=t.array[n+i];return this}set(e,t=0){return this.array.set(e,t),this}clone(e){void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=Qn()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),n=new this.constructor(t,this.stride);return n.setUsage(this.usage),n}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=Qn()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=Array.prototype.slice.call(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const Do=new Ei;class Go{constructor(e,t,n,i=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=e,this.itemSize=t,this.offset=n,this.normalized=!0===i}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,n=this.data.count;t<n;t++)Do.fromBufferAttribute(this,t),Do.applyMatrix4(e),this.setXYZ(t,Do.x,Do.y,Do.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)Do.fromBufferAttribute(this,t),Do.applyNormalMatrix(e),this.setXYZ(t,Do.x,Do.y,Do.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)Do.fromBufferAttribute(this,t),Do.transformDirection(e),this.setXYZ(t,Do.x,Do.y,Do.z);return this}setX(e,t){return this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){return this.data.array[e*this.data.stride+this.offset]}getY(e){return this.data.array[e*this.data.stride+this.offset+1]}getZ(e){return this.data.array[e*this.data.stride+this.offset+2]}getW(e){return this.data.array[e*this.data.stride+this.offset+3]}setXY(e,t,n){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=n,this}setXYZ(e,t,n,i){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=i,this}setXYZW(e,t,n,i,r){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=i,this.data.array[e+3]=r,this}clone(e){if(void 0===e){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interlaved buffer attribute will deinterleave buffer data.");const e=[];for(let t=0;t<this.count;t++){const n=t*this.data.stride+this.offset;for(let t=0;t<this.itemSize;t++)e.push(this.data.array[n+t])}return new jr(new this.array.constructor(e),this.itemSize,this.normalized)}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new Go(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(void 0===e){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interlaved buffer attribute will deinterleave buffer data.");const e=[];for(let t=0;t<this.count;t++){const n=t*this.data.stride+this.offset;for(let t=0;t<this.itemSize;t++)e.push(this.data.array[n+t])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:e,normalized:this.normalized}}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}const Uo=new Ei,jo=new wi,Wo=new wi,qo=new Ei,Jo=new ir;class $o extends go{constructor(e,t){super(e,t),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new ir,this.bindMatrixInverse=new ir}copy(e,t){return super.copy(e,t),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,this}bind(e,t){this.skeleton=e,void 0===t&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const e=new wi,t=this.geometry.attributes.skinWeight;for(let n=0,i=t.count;n<i;n++){e.fromBufferAttribute(t,n);const i=1/e.manhattanLength();i!==1/0?e.multiplyScalar(i):e.set(1,0,0,0),t.setXYZW(n,e.x,e.y,e.z,e.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),"attached"===this.bindMode?this.bindMatrixInverse.copy(this.matrixWorld).invert():"detached"===this.bindMode?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}boneTransform(e,t){const n=this.skeleton,i=this.geometry;jo.fromBufferAttribute(i.attributes.skinIndex,e),Wo.fromBufferAttribute(i.attributes.skinWeight,e),Uo.copy(t).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let e=0;e<4;e++){const i=Wo.getComponent(e);if(0!==i){const r=jo.getComponent(e);Jo.multiplyMatrices(n.bones[r].matrixWorld,n.boneInverses[r]),t.addScaledVector(qo.copy(Uo).applyMatrix4(Jo),i)}}return t.applyMatrix4(this.bindMatrixInverse)}}class Xo extends Sr{constructor(){super(),this.isBone=!0,this.type="Bone"}}class Yo extends zi{constructor(e=null,t=1,n=1,i,r,o,a,s,l=1003,p=1003,u,h){super(null,o,a,s,l,p,i,r,u,h),this.isDataTexture=!0,this.image={data:e,width:t,height:n},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const Ko=new ir,Qo=new ir;class ea{constructor(e=[],t=[]){this.uuid=Qn(),this.bones=e.slice(0),this.boneInverses=t,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.frame=-1,this.init()}init(){const e=this.bones,t=this.boneInverses;if(this.boneMatrices=new Float32Array(16*e.length),0===t.length)this.calculateInverses();else if(e.length!==t.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let e=0,t=this.bones.length;e<t;e++)this.boneInverses.push(new ir)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,t=this.bones.length;e<t;e++){const t=new ir;this.bones[e]&&t.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(t)}}pose(){for(let e=0,t=this.bones.length;e<t;e++){const t=this.bones[e];t&&t.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,t=this.bones.length;e<t;e++){const t=this.bones[e];t&&(t.parent&&t.parent.isBone?(t.matrix.copy(t.parent.matrixWorld).invert(),t.matrix.multiply(t.matrixWorld)):t.matrix.copy(t.matrixWorld),t.matrix.decompose(t.position,t.quaternion,t.scale))}}update(){const e=this.bones,t=this.boneInverses,n=this.boneMatrices,i=this.boneTexture;for(let i=0,r=e.length;i<r;i++){const r=e[i]?e[i].matrixWorld:Qo;Ko.multiplyMatrices(r,t[i]),Ko.toArray(n,16*i)}null!==i&&(i.needsUpdate=!0)}clone(){return new ea(this.bones,this.boneInverses)}computeBoneTexture(){let e=Math.sqrt(4*this.bones.length);e=ii(e),e=Math.max(e,4);const t=new Float32Array(e*e*4);t.set(this.boneMatrices);const n=new Yo(t,e,e,1023,1015);return n.needsUpdate=!0,this.boneMatrices=t,this.boneTexture=n,this.boneTextureSize=e,this}getBoneByName(e){for(let t=0,n=this.bones.length;t<n;t++){const n=this.bones[t];if(n.name===e)return n}}dispose(){null!==this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,t){this.uuid=e.uuid;for(let n=0,i=e.bones.length;n<i;n++){const i=e.bones[n];let r=t[i];void 0===r&&(console.warn("THREE.Skeleton: No bone found with UUID:",i),r=new Xo),this.bones.push(r),this.boneInverses.push((new ir).fromArray(e.boneInverses[n]))}return this.init(),this}toJSON(){const e={metadata:{version:4.5,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;const t=this.bones,n=this.boneInverses;for(let i=0,r=t.length;i<r;i++){const r=t[i];e.bones.push(r.uuid);const o=n[i];e.boneInverses.push(o.toArray())}return e}}class ta extends Fr{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new xi(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}}const na=new Ei,ia=new Ei,ra=new ir,oa=new nr,aa=new Ji;class sa extends Sr{constructor(e=new no,t=new ta){super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(null===e.index){const t=e.attributes.position,n=[0];for(let e=1,i=t.count;e<i;e++)na.fromBufferAttribute(t,e-1),ia.fromBufferAttribute(t,e),n[e]=n[e-1],n[e]+=na.distanceTo(ia);e.setAttribute("lineDistance",new Jr(n,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,t){const n=this.geometry,i=this.matrixWorld,r=e.params.Line.threshold,o=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),aa.copy(n.boundingSphere),aa.applyMatrix4(i),aa.radius+=r,!1===e.ray.intersectsSphere(aa))return;ra.copy(i).invert(),oa.copy(e.ray).applyMatrix4(ra);const a=r/((this.scale.x+this.scale.y+this.scale.z)/3),s=a*a,l=new Ei,p=new Ei,u=new Ei,h=new Ei,c=this.isLineSegments?2:1,_=n.index,d=n.attributes.position;if(null!==_)for(let n=Math.max(0,o.start),i=Math.min(_.count,o.start+o.count)-1;n<i;n+=c){const i=_.getX(n),r=_.getX(n+1);if(l.fromBufferAttribute(d,i),p.fromBufferAttribute(d,r),oa.distanceSqToSegment(l,p,h,u)>s)continue;h.applyMatrix4(this.matrixWorld);const o=e.ray.origin.distanceTo(h);o<e.near||o>e.far||t.push({distance:o,point:u.clone().applyMatrix4(this.matrixWorld),index:n,face:null,faceIndex:null,object:this})}else for(let n=Math.max(0,o.start),i=Math.min(d.count,o.start+o.count)-1;n<i;n+=c){if(l.fromBufferAttribute(d,n),p.fromBufferAttribute(d,n+1),oa.distanceSqToSegment(l,p,h,u)>s)continue;h.applyMatrix4(this.matrixWorld);const i=e.ray.origin.distanceTo(h);i<e.near||i>e.far||t.push({distance:i,point:u.clone().applyMatrix4(this.matrixWorld),index:n,face:null,faceIndex:null,object:this})}}updateMorphTargets(){const e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){const n=e[t[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,t=n.length;e<t;e++){const t=n[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[t]=e}}}}}const la=new Ei,pa=new Ei;class ua extends sa{constructor(e,t){super(e,t),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(null===e.index){const t=e.attributes.position,n=[];for(let e=0,i=t.count;e<i;e+=2)la.fromBufferAttribute(t,e),pa.fromBufferAttribute(t,e+1),n[e]=0===e?0:n[e-1],n[e+1]=n[e]+la.distanceTo(pa);e.setAttribute("lineDistance",new Jr(n,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class ha extends sa{constructor(e,t){super(e,t),this.isLineLoop=!0,this.type="LineLoop"}}class ca extends Fr{constructor(e){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new xi(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}const _a=new ir,da=new nr,ma=new Ji,Pa=new Ei;class fa extends Sr{constructor(e=new no,t=new ca){super(),this.isPoints=!0,this.type="Points",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=e.material,this.geometry=e.geometry,this}raycast(e,t){const n=this.geometry,i=this.matrixWorld,r=e.params.Points.threshold,o=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),ma.copy(n.boundingSphere),ma.applyMatrix4(i),ma.radius+=r,!1===e.ray.intersectsSphere(ma))return;_a.copy(i).invert(),da.copy(e.ray).applyMatrix4(_a);const a=r/((this.scale.x+this.scale.y+this.scale.z)/3),s=a*a,l=n.index,p=n.attributes.position;if(null!==l)for(let n=Math.max(0,o.start),r=Math.min(l.count,o.start+o.count);n<r;n++){const r=l.getX(n);Pa.fromBufferAttribute(p,r),xa(Pa,r,s,i,e,t,this)}else for(let n=Math.max(0,o.start),r=Math.min(p.count,o.start+o.count);n<r;n++)Pa.fromBufferAttribute(p,n),xa(Pa,n,s,i,e,t,this)}updateMorphTargets(){const e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){const n=e[t[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,t=n.length;e<t;e++){const t=n[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[t]=e}}}}}function xa(e,t,n,i,r,o,a){const s=da.distanceSqToPoint(e);if(s<n){const n=new Ei;da.closestPointToPoint(e,n),n.applyMatrix4(i);const l=r.ray.origin.distanceTo(n);if(l<r.near||l>r.far)return;o.push({distance:l,distanceToRay:Math.sqrt(s),point:n,index:t,face:null,object:a})}}new Ei,new Ei,new Ei,new Ei,new Rr;class ya extends Fr{constructor(e){super(),this.isMeshStandardMaterial=!0,this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new xi(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new xi(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new oi(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class va extends ya{constructor(e){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new oi(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return ei(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(e){this.ior=(1+.4*e)/(1-.4*e)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new xi(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=0,this.attenuationColor=new xi(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new xi(1,1,1),this.specularColorMap=null,this._sheen=0,this._clearcoat=0,this._iridescence=0,this._transmission=0,this.setValues(e)}get sheen(){return this._sheen}set sheen(e){this._sheen>0!=e>0&&this.version++,this._sheen=e}get clearcoat(){return this._clearcoat}set clearcoat(e){this._clearcoat>0!=e>0&&this.version++,this._clearcoat=e}get iridescence(){return this._iridescence}set iridescence(e){this._iridescence>0!=e>0&&this.version++,this._iridescence=e}get transmission(){return this._transmission}set transmission(e){this._transmission>0!=e>0&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.ior=e.ior,this.iridescence=e.iridescence,this.iridescenceMap=e.iridescenceMap,this.iridescenceIOR=e.iridescenceIOR,this.iridescenceThicknessRange=[...e.iridescenceThicknessRange],this.iridescenceThicknessMap=e.iridescenceThicknessMap,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}}class ga extends Fr{constructor(e){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new xi(16777215),this.specular=new xi(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new xi(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new oi(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class ba extends Fr{constructor(e){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new xi(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new xi(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const za={ShadowMaterial:class extends Fr{constructor(e){super(),this.isShadowMaterial=!0,this.type="ShadowMaterial",this.color=new xi(0),this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.fog=e.fog,this}},SpriteMaterial:class extends Fr{constructor(e){super(),this.isSpriteMaterial=!0,this.type="SpriteMaterial",this.color=new xi(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}},RawShaderMaterial:class extends Zo{constructor(e){super(e),this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"}},ShaderMaterial:Zo,PointsMaterial:ca,MeshPhysicalMaterial:va,MeshStandardMaterial:ya,MeshPhongMaterial:ga,MeshToonMaterial:class extends Fr{constructor(e){super(),this.isMeshToonMaterial=!0,this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new xi(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new xi(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new oi(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}},MeshNormalMaterial:class extends Fr{constructor(e){super(),this.isMeshNormalMaterial=!0,this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new oi(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this}},MeshLambertMaterial:ba,MeshDepthMaterial:class extends Fr{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=3200,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}},MeshDistanceMaterial:class extends Fr{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.referencePosition=new Ei,this.nearDistance=1,this.farDistance=1e3,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}},MeshBasicMaterial:Dr,MeshMatcapMaterial:class extends Fr{constructor(e){super(),this.isMeshMatcapMaterial=!0,this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new xi(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new oi(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.flatShading=e.flatShading,this.fog=e.fog,this}},LineDashedMaterial:class extends ta{constructor(e){super(),this.isLineDashedMaterial=!0,this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}copy(e){return super.copy(e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}},LineBasicMaterial:ta,Material:Fr};Fr.fromType=function(e){return new za[e]};const wa={arraySlice:function(e,t,n){return wa.isTypedArray(e)?new e.constructor(e.subarray(t,void 0!==n?n:e.length)):e.slice(t,n)},convertArray:function(e,t,n){return!e||!n&&e.constructor===t?e:"number"==typeof t.BYTES_PER_ELEMENT?new t(e):Array.prototype.slice.call(e)},isTypedArray:function(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)},getKeyframeOrder:function(e){const t=e.length,n=new Array(t);for(let e=0;e!==t;++e)n[e]=e;return n.sort((function(t,n){return e[t]-e[n]})),n},sortedArray:function(e,t,n){const i=e.length,r=new e.constructor(i);for(let o=0,a=0;a!==i;++o){const i=n[o]*t;for(let n=0;n!==t;++n)r[a++]=e[i+n]}return r},flattenJSON:function(e,t,n,i){let r=1,o=e[0];for(;void 0!==o&&void 0===o[i];)o=e[r++];if(void 0===o)return;let a=o[i];if(void 0!==a)if(Array.isArray(a))do{a=o[i],void 0!==a&&(t.push(o.time),n.push.apply(n,a)),o=e[r++]}while(void 0!==o);else if(void 0!==a.toArray)do{a=o[i],void 0!==a&&(t.push(o.time),a.toArray(n,n.length)),o=e[r++]}while(void 0!==o);else do{a=o[i],void 0!==a&&(t.push(o.time),n.push(a)),o=e[r++]}while(void 0!==o)},subclip:function(e,t,n,i,r=30){const o=e.clone();o.name=t;const a=[];for(let e=0;e<o.tracks.length;++e){const t=o.tracks[e],s=t.getValueSize(),l=[],p=[];for(let e=0;e<t.times.length;++e){const o=t.times[e]*r;if(!(o<n||o>=i)){l.push(t.times[e]);for(let n=0;n<s;++n)p.push(t.values[e*s+n])}}0!==l.length&&(t.times=wa.convertArray(l,t.times.constructor),t.values=wa.convertArray(p,t.values.constructor),a.push(t))}o.tracks=a;let s=1/0;for(let e=0;e<o.tracks.length;++e)s>o.tracks[e].times[0]&&(s=o.tracks[e].times[0]);for(let e=0;e<o.tracks.length;++e)o.tracks[e].shift(-1*s);return o.resetDuration(),o},makeClipAdditive:function(e,t=0,n=e,i=30){i<=0&&(i=30);const r=n.tracks.length,o=t/i;for(let t=0;t<r;++t){const i=n.tracks[t],r=i.ValueTypeName;if("bool"===r||"string"===r)continue;const a=e.tracks.find((function(e){return e.name===i.name&&e.ValueTypeName===r}));if(void 0===a)continue;let s=0;const l=i.getValueSize();i.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(s=l/3);let p=0;const u=a.getValueSize();a.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(p=u/3);const h=i.times.length-1;let c;if(o<=i.times[0]){const e=s,t=l-s;c=wa.arraySlice(i.values,e,t)}else if(o>=i.times[h]){const e=h*l+s,t=e+l-s;c=wa.arraySlice(i.values,e,t)}else{const e=i.createInterpolant(),t=s,n=l-s;e.evaluate(o),c=wa.arraySlice(e.resultBuffer,t,n)}"quaternion"===r&&(new Zi).fromArray(c).normalize().conjugate().toArray(c);const _=a.times.length;for(let e=0;e<_;++e){const t=e*u+p;if("quaternion"===r)Zi.multiplyQuaternionsFlat(a.values,t,c,0,a.values,t);else{const e=u-2*p;for(let n=0;n<e;++n)a.values[t+n]-=c[n]}}}return e.blendMode=2501,e}};class Za{constructor(e,t,n,i){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=void 0!==i?i:new t.constructor(n),this.sampleValues=t,this.valueSize=n,this.settings=null,this.DefaultSettings_={}}evaluate(e){const t=this.parameterPositions;let n=this._cachedIndex,i=t[n],r=t[n-1];e:{t:{let o;n:{i:if(!(e<i)){for(let o=n+2;;){if(void 0===i){if(e<r)break i;return n=t.length,this._cachedIndex=n,this.copySampleValue_(n-1)}if(n===o)break;if(r=i,i=t[++n],e<i)break t}o=t.length;break n}if(e>=r)break e;{const a=t[1];e<a&&(n=2,r=a);for(let o=n-2;;){if(void 0===r)return this._cachedIndex=0,this.copySampleValue_(0);if(n===o)break;if(i=r,r=t[--n-1],e>=r)break t}o=n,n=0}}for(;n<o;){const i=n+o>>>1;e<t[i]?o=i:n=i+1}if(i=t[n],r=t[n-1],void 0===r)return this._cachedIndex=0,this.copySampleValue_(0);if(void 0===i)return n=t.length,this._cachedIndex=n,this.copySampleValue_(n-1)}this._cachedIndex=n,this.intervalChanged_(n,r,i)}return this.interpolate_(n,r,e,i)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const t=this.resultBuffer,n=this.sampleValues,i=this.valueSize,r=e*i;for(let e=0;e!==i;++e)t[e]=n[r+e];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class Ea extends Za{constructor(e,t,n,i){super(e,t,n,i),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:2400,endingEnd:2400}}intervalChanged_(e,t,n){const i=this.parameterPositions;let r=e-2,o=e+1,a=i[r],s=i[o];if(void 0===a)switch(this.getSettings_().endingStart){case 2401:r=e,a=2*t-n;break;case 2402:r=i.length-2,a=t+i[r]-i[r+1];break;default:r=e,a=n}if(void 0===s)switch(this.getSettings_().endingEnd){case 2401:o=e,s=2*n-t;break;case 2402:o=1,s=n+i[1]-i[0];break;default:o=e-1,s=t}const l=.5*(n-t),p=this.valueSize;this._weightPrev=l/(t-a),this._weightNext=l/(s-n),this._offsetPrev=r*p,this._offsetNext=o*p}interpolate_(e,t,n,i){const r=this.resultBuffer,o=this.sampleValues,a=this.valueSize,s=e*a,l=s-a,p=this._offsetPrev,u=this._offsetNext,h=this._weightPrev,c=this._weightNext,_=(n-t)/(i-t),d=_*_,m=d*_,P=-h*m+2*h*d-h*_,f=(1+h)*m+(-1.5-2*h)*d+(-.5+h)*_+1,x=(-1-c)*m+(1.5+c)*d+.5*_,y=c*m-c*d;for(let e=0;e!==a;++e)r[e]=P*o[p+e]+f*o[l+e]+x*o[s+e]+y*o[u+e];return r}}class Ma extends Za{constructor(e,t,n,i){super(e,t,n,i)}interpolate_(e,t,n,i){const r=this.resultBuffer,o=this.sampleValues,a=this.valueSize,s=e*a,l=s-a,p=(n-t)/(i-t),u=1-p;for(let e=0;e!==a;++e)r[e]=o[l+e]*u+o[s+e]*p;return r}}class Sa extends Za{constructor(e,t,n,i){super(e,t,n,i)}interpolate_(e){return this.copySampleValue_(e-1)}}class Ca{constructor(e,t,n,i){if(void 0===e)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===t||0===t.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=wa.convertArray(t,this.TimeBufferType),this.values=wa.convertArray(n,this.ValueBufferType),this.setInterpolation(i||this.DefaultInterpolation)}static toJSON(e){const t=e.constructor;let n;if(t.toJSON!==this.toJSON)n=t.toJSON(e);else{n={name:e.name,times:wa.convertArray(e.times,Array),values:wa.convertArray(e.values,Array)};const t=e.getInterpolation();t!==e.DefaultInterpolation&&(n.interpolation=t)}return n.type=e.ValueTypeName,n}InterpolantFactoryMethodDiscrete(e){return new Sa(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new Ma(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new Ea(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case Hn:t=this.InterpolantFactoryMethodDiscrete;break;case Fn:t=this.InterpolantFactoryMethodLinear;break;case Dn:t=this.InterpolantFactoryMethodSmooth}if(void 0===t){const t="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(e===this.DefaultInterpolation)throw new Error(t);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",t),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return Hn;case this.InterpolantFactoryMethodLinear:return Fn;case this.InterpolantFactoryMethodSmooth:return Dn}}getValueSize(){return this.values.length/this.times.length}shift(e){if(0!==e){const t=this.times;for(let n=0,i=t.length;n!==i;++n)t[n]+=e}return this}scale(e){if(1!==e){const t=this.times;for(let n=0,i=t.length;n!==i;++n)t[n]*=e}return this}trim(e,t){const n=this.times,i=n.length;let r=0,o=i-1;for(;r!==i&&n[r]<e;)++r;for(;-1!==o&&n[o]>t;)--o;if(++o,0!==r||o!==i){r>=o&&(o=Math.max(o,1),r=o-1);const e=this.getValueSize();this.times=wa.arraySlice(n,r,o),this.values=wa.arraySlice(this.values,r*e,o*e)}return this}validate(){let e=!0;const t=this.getValueSize();t-Math.floor(t)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);const n=this.times,i=this.values,r=n.length;0===r&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let o=null;for(let t=0;t!==r;t++){const i=n[t];if("number"==typeof i&&isNaN(i)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,t,i),e=!1;break}if(null!==o&&o>i){console.error("THREE.KeyframeTrack: Out of order keys.",this,t,i,o),e=!1;break}o=i}if(void 0!==i&&wa.isTypedArray(i))for(let t=0,n=i.length;t!==n;++t){const n=i[t];if(isNaN(n)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,t,n),e=!1;break}}return e}optimize(){const e=wa.arraySlice(this.times),t=wa.arraySlice(this.values),n=this.getValueSize(),i=this.getInterpolation()===Dn,r=e.length-1;let o=1;for(let a=1;a<r;++a){let r=!1;const s=e[a];if(s!==e[a+1]&&(1!==a||s!==e[0]))if(i)r=!0;else{const e=a*n,i=e-n,o=e+n;for(let a=0;a!==n;++a){const n=t[e+a];if(n!==t[i+a]||n!==t[o+a]){r=!0;break}}}if(r){if(a!==o){e[o]=e[a];const i=a*n,r=o*n;for(let e=0;e!==n;++e)t[r+e]=t[i+e]}++o}}if(r>0){e[o]=e[r];for(let e=r*n,i=o*n,a=0;a!==n;++a)t[i+a]=t[e+a];++o}return o!==e.length?(this.times=wa.arraySlice(e,0,o),this.values=wa.arraySlice(t,0,o*n)):(this.times=e,this.values=t),this}clone(){const e=wa.arraySlice(this.times,0),t=wa.arraySlice(this.values,0),n=new(0,this.constructor)(this.name,e,t);return n.createInterpolant=this.createInterpolant,n}}Ca.prototype.TimeBufferType=Float32Array,Ca.prototype.ValueBufferType=Float32Array,Ca.prototype.DefaultInterpolation=Fn;class Na extends Ca{}Na.prototype.ValueTypeName="bool",Na.prototype.ValueBufferType=Array,Na.prototype.DefaultInterpolation=Hn,Na.prototype.InterpolantFactoryMethodLinear=void 0,Na.prototype.InterpolantFactoryMethodSmooth=void 0;class Aa extends Ca{}Aa.prototype.ValueTypeName="color";class La extends Ca{}La.prototype.ValueTypeName="number";class Ba extends Za{constructor(e,t,n,i){super(e,t,n,i)}interpolate_(e,t,n,i){const r=this.resultBuffer,o=this.sampleValues,a=this.valueSize,s=(n-t)/(i-t);let l=e*a;for(let e=l+a;l!==e;l+=4)Zi.slerpFlat(r,0,o,l-a,o,l,s);return r}}class Ta extends Ca{InterpolantFactoryMethodLinear(e){return new Ba(this.times,this.values,this.getValueSize(),e)}}Ta.prototype.ValueTypeName="quaternion",Ta.prototype.DefaultInterpolation=Fn,Ta.prototype.InterpolantFactoryMethodSmooth=void 0;class Va extends Ca{}Va.prototype.ValueTypeName="string",Va.prototype.ValueBufferType=Array,Va.prototype.DefaultInterpolation=Hn,Va.prototype.InterpolantFactoryMethodLinear=void 0,Va.prototype.InterpolantFactoryMethodSmooth=void 0;class ka extends Ca{}ka.prototype.ValueTypeName="vector";class Ia{constructor(e,t=-1,n,i=2500){this.name=e,this.tracks=n,this.duration=t,this.blendMode=i,this.uuid=Qn(),this.duration<0&&this.resetDuration()}static parse(e){const t=[],n=e.tracks,i=1/(e.fps||1);for(let e=0,r=n.length;e!==r;++e)t.push(Oa(n[e]).scale(i));const r=new this(e.name,e.duration,t,e.blendMode);return r.uuid=e.uuid,r}static toJSON(e){const t=[],n=e.tracks,i={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode};for(let e=0,i=n.length;e!==i;++e)t.push(Ca.toJSON(n[e]));return i}static CreateFromMorphTargetSequence(e,t,n,i){const r=t.length,o=[];for(let e=0;e<r;e++){let a=[],s=[];a.push((e+r-1)%r,e,(e+1)%r),s.push(0,1,0);const l=wa.getKeyframeOrder(a);a=wa.sortedArray(a,1,l),s=wa.sortedArray(s,1,l),i||0!==a[0]||(a.push(r),s.push(s[0])),o.push(new La(".morphTargetInfluences["+t[e].name+"]",a,s).scale(1/n))}return new this(e,-1,o)}static findByName(e,t){let n=e;if(!Array.isArray(e)){const t=e;n=t.geometry&&t.geometry.animations||t.animations}for(let e=0;e<n.length;e++)if(n[e].name===t)return n[e];return null}static CreateClipsFromMorphTargetSequences(e,t,n){const i={},r=/^([\w-]*?)([\d]+)$/;for(let t=0,n=e.length;t<n;t++){const n=e[t],o=n.name.match(r);if(o&&o.length>1){const e=o[1];let t=i[e];t||(i[e]=t=[]),t.push(n)}}const o=[];for(const e in i)o.push(this.CreateFromMorphTargetSequence(e,i[e],t,n));return o}static parseAnimation(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const n=function(e,t,n,i,r){if(0!==n.length){const o=[],a=[];wa.flattenJSON(n,o,a,i),0!==o.length&&r.push(new e(t,o,a))}},i=[],r=e.name||"default",o=e.fps||30,a=e.blendMode;let s=e.length||-1;const l=e.hierarchy||[];for(let e=0;e<l.length;e++){const r=l[e].keys;if(r&&0!==r.length)if(r[0].morphTargets){const e={};let t;for(t=0;t<r.length;t++)if(r[t].morphTargets)for(let n=0;n<r[t].morphTargets.length;n++)e[r[t].morphTargets[n]]=-1;for(const n in e){const e=[],o=[];for(let i=0;i!==r[t].morphTargets.length;++i){const i=r[t];e.push(i.time),o.push(i.morphTarget===n?1:0)}i.push(new La(".morphTargetInfluence["+n+"]",e,o))}s=e.length*o}else{const o=".bones["+t[e].name+"]";n(ka,o+".position",r,"pos",i),n(Ta,o+".quaternion",r,"rot",i),n(ka,o+".scale",r,"scl",i)}}return 0===i.length?null:new this(r,s,i,a)}resetDuration(){let e=0;for(let t=0,n=this.tracks.length;t!==n;++t){const n=this.tracks[t];e=Math.max(e,n.times[n.times.length-1])}return this.duration=e,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){const e=[];for(let t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function Oa(e){if(void 0===e.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const t=function(e){switch(e.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return La;case"vector":case"vector2":case"vector3":case"vector4":return ka;case"color":return Aa;case"quaternion":return Ta;case"bool":case"boolean":return Na;case"string":return Va}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+e)}(e.type);if(void 0===e.times){const t=[],n=[];wa.flattenJSON(e.keys,t,n,"value"),e.times=t,e.values=n}return void 0!==t.parse?t.parse(e):new t(e.name,e.times,e.values,e.interpolation)}const Ra={enabled:!1,files:{},add:function(e,t){!1!==this.enabled&&(this.files[e]=t)},get:function(e){if(!1!==this.enabled)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}},Ha=new class{constructor(e,t,n){const i=this;let r,o=!1,a=0,s=0;const l=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=n,this.itemStart=function(e){s++,!1===o&&void 0!==i.onStart&&i.onStart(e,a,s),o=!0},this.itemEnd=function(e){a++,void 0!==i.onProgress&&i.onProgress(e,a,s),a===s&&(o=!1,void 0!==i.onLoad&&i.onLoad())},this.itemError=function(e){void 0!==i.onError&&i.onError(e)},this.resolveURL=function(e){return r?r(e):e},this.setURLModifier=function(e){return r=e,this},this.addHandler=function(e,t){return l.push(e,t),this},this.removeHandler=function(e){const t=l.indexOf(e);return-1!==t&&l.splice(t,2),this},this.getHandler=function(e){for(let t=0,n=l.length;t<n;t+=2){const n=l[t],i=l[t+1];if(n.global&&(n.lastIndex=0),n.test(e))return i}return null}}};class Fa{constructor(e){this.manager=void 0!==e?e:Ha,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){const n=this;return new Promise((function(i,r){n.load(e,i,t,r)}))}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}}const Da={};class Ga extends Fa{constructor(e){super(e)}load(e,t,n,i){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const r=Ra.get(e);if(void 0!==r)return this.manager.itemStart(e),setTimeout((()=>{t&&t(r),this.manager.itemEnd(e)}),0),r;if(void 0!==Da[e])return void Da[e].push({onLoad:t,onProgress:n,onError:i});Da[e]=[],Da[e].push({onLoad:t,onProgress:n,onError:i});const o=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),a=this.mimeType,s=this.responseType;fetch(o).then((t=>{if(200===t.status||0===t.status){if(0===t.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),"undefined"==typeof ReadableStream||void 0===t.body||void 0===t.body.getReader)return t;const n=Da[e],i=t.body.getReader(),r=t.headers.get("Content-Length"),o=r?parseInt(r):0,a=0!==o;let s=0;const l=new ReadableStream({start(e){!function t(){i.read().then((({done:i,value:r})=>{if(i)e.close();else{s+=r.byteLength;const i=new ProgressEvent("progress",{lengthComputable:a,loaded:s,total:o});for(let e=0,t=n.length;e<t;e++){const t=n[e];t.onProgress&&t.onProgress(i)}e.enqueue(r),t()}}))}()}});return new Response(l)}throw Error(`fetch for "${t.url}" responded with ${t.status}: ${t.statusText}`)})).then((e=>{switch(s){case"arraybuffer":return e.arrayBuffer();case"blob":return e.blob();case"document":return e.text().then((e=>(new DOMParser).parseFromString(e,a)));case"json":return e.json();default:if(void 0===a)return e.text();{const t=/charset="?([^;"\s]*)"?/i.exec(a),n=t&&t[1]?t[1].toLowerCase():void 0,i=new TextDecoder(n);return e.arrayBuffer().then((e=>i.decode(e)))}}})).then((t=>{Ra.add(e,t);const n=Da[e];delete Da[e];for(let e=0,i=n.length;e<i;e++){const i=n[e];i.onLoad&&i.onLoad(t)}})).catch((t=>{const n=Da[e];if(void 0===n)throw this.manager.itemError(e),t;delete Da[e];for(let e=0,i=n.length;e<i;e++){const i=n[e];i.onError&&i.onError(t)}this.manager.itemError(e)})).finally((()=>{this.manager.itemEnd(e)})),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}}class Ua extends Fa{constructor(e){super(e)}load(e,t,n,i){void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const r=this,o=Ra.get(e);if(void 0!==o)return r.manager.itemStart(e),setTimeout((function(){t&&t(o),r.manager.itemEnd(e)}),0),o;const a=si("img");function s(){p(),Ra.add(e,this),t&&t(this),r.manager.itemEnd(e)}function l(t){p(),i&&i(t),r.manager.itemError(e),r.manager.itemEnd(e)}function p(){a.removeEventListener("load",s,!1),a.removeEventListener("error",l,!1)}return a.addEventListener("load",s,!1),a.addEventListener("error",l,!1),"data:"!==e.slice(0,5)&&void 0!==this.crossOrigin&&(a.crossOrigin=this.crossOrigin),r.manager.itemStart(e),a.src=e,a}}class ja extends Fa{constructor(e){super(e)}load(e,t,n,i){const r=new zi,o=new Ua(this.manager);return o.setCrossOrigin(this.crossOrigin),o.setPath(this.path),o.load(e,(function(e){r.image=e,r.needsUpdate=!0,void 0!==t&&t(r)}),n,i),r}}class Wa extends Sr{constructor(e,t=1){super(),this.isLight=!0,this.type="Light",this.color=new xi(e),this.intensity=t}dispose(){}copy(e,t){return super.copy(e,t),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,void 0!==this.groundColor&&(t.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(t.object.distance=this.distance),void 0!==this.angle&&(t.object.angle=this.angle),void 0!==this.decay&&(t.object.decay=this.decay),void 0!==this.penumbra&&(t.object.penumbra=this.penumbra),void 0!==this.shadow&&(t.object.shadow=this.shadow.toJSON()),t}}const qa=new ir,Ja=new Ei,$a=new Ei;class Xa{constructor(e){this.camera=e,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new oi(512,512),this.map=null,this.mapPass=null,this.matrix=new ir,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new To,this._frameExtents=new oi(1,1),this._viewportCount=1,this._viewports=[new wi(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const t=this.camera,n=this.matrix;Ja.setFromMatrixPosition(e.matrixWorld),t.position.copy(Ja),$a.setFromMatrixPosition(e.target.matrixWorld),t.lookAt($a),t.updateMatrixWorld(),qa.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(qa),n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(t.projectionMatrix),n.multiply(t.matrixWorldInverse)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return(new this.constructor).copy(this)}toJSON(){const e={};return 0!==this.bias&&(e.bias=this.bias),0!==this.normalBias&&(e.normalBias=this.normalBias),1!==this.radius&&(e.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class Ya extends Xa{constructor(){super(new Mo(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(e){const t=this.camera,n=2*Kn*e.angle*this.focus,i=this.mapSize.width/this.mapSize.height,r=e.distance||t.far;n===t.fov&&i===t.aspect&&r===t.far||(t.fov=n,t.aspect=i,t.far=r,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}class Ka extends Wa{constructor(e,t,n=0,i=Math.PI/3,r=0,o=1){super(e,t),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(Sr.DefaultUp),this.updateMatrix(),this.target=new Sr,this.distance=n,this.angle=i,this.penumbra=r,this.decay=o,this.shadow=new Ya}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}const Qa=new ir,es=new Ei,ts=new Ei;class ns extends Xa{constructor(){super(new Mo(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new oi(4,2),this._viewportCount=6,this._viewports=[new wi(2,1,1,1),new wi(0,1,1,1),new wi(3,1,1,1),new wi(1,1,1,1),new wi(3,0,1,1),new wi(1,0,1,1)],this._cubeDirections=[new Ei(1,0,0),new Ei(-1,0,0),new Ei(0,0,1),new Ei(0,0,-1),new Ei(0,1,0),new Ei(0,-1,0)],this._cubeUps=[new Ei(0,1,0),new Ei(0,1,0),new Ei(0,1,0),new Ei(0,1,0),new Ei(0,0,1),new Ei(0,0,-1)]}updateMatrices(e,t=0){const n=this.camera,i=this.matrix,r=e.distance||n.far;r!==n.far&&(n.far=r,n.updateProjectionMatrix()),es.setFromMatrixPosition(e.matrixWorld),n.position.copy(es),ts.copy(n.position),ts.add(this._cubeDirections[t]),n.up.copy(this._cubeUps[t]),n.lookAt(ts),n.updateMatrixWorld(),i.makeTranslation(-es.x,-es.y,-es.z),Qa.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Qa)}}class is extends Wa{constructor(e,t,n=0,i=1){super(e,t),this.isPointLight=!0,this.type="PointLight",this.distance=n,this.decay=i,this.shadow=new ns}get power(){return 4*this.intensity*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}class rs extends Xa{constructor(){super(new Ro(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class os extends Wa{constructor(e,t){super(e,t),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(Sr.DefaultUp),this.updateMatrix(),this.target=new Sr,this.shadow=new rs}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}class as extends Wa{constructor(e,t){super(e,t),this.isAmbientLight=!0,this.type="AmbientLight"}}class ss{static decodeText(e){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(e);let t="";for(let n=0,i=e.length;n<i;n++)t+=String.fromCharCode(e[n]);try{return decodeURIComponent(escape(t))}catch(e){return t}}static extractUrlBase(e){const t=e.lastIndexOf("/");return-1===t?"./":e.slice(0,t+1)}static resolveURL(e,t){return"string"!=typeof e||""===e?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e)}}class ls extends Fa{constructor(e){super(e),this.isImageBitmapLoader=!0,"undefined"==typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"==typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(e){return this.options=e,this}load(e,t,n,i){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const r=this,o=Ra.get(e);if(void 0!==o)return r.manager.itemStart(e),setTimeout((function(){t&&t(o),r.manager.itemEnd(e)}),0),o;const a={};a.credentials="anonymous"===this.crossOrigin?"same-origin":"include",a.headers=this.requestHeader,fetch(e,a).then((function(e){return e.blob()})).then((function(e){return createImageBitmap(e,Object.assign(r.options,{colorSpaceConversion:"none"}))})).then((function(n){Ra.add(e,n),t&&t(n),r.manager.itemEnd(e)})).catch((function(t){i&&i(t),r.manager.itemError(e),r.manager.itemEnd(e)})),r.manager.itemStart(e)}}let ps;class us extends Fa{constructor(e){super(e)}load(e,t,n,i){const r=this,o=new Ga(this.manager);o.setResponseType("arraybuffer"),o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,(function(n){try{const e=n.slice(0);(void 0===ps&&(ps=new(window.AudioContext||window.webkitAudioContext)),ps).decodeAudioData(e,(function(e){t(e)}))}catch(t){i?i(t):console.error(t),r.manager.itemError(e)}}),n,i)}}const hs=new RegExp("[\\[\\]\\.:\\/]","g"),cs="[^\\[\\]\\.:\\/]",_s="[^"+"\\[\\]\\.:\\/".replace("\\.","")+"]",ds=/((?:WC+[\/:])*)/.source.replace("WC",cs),ms=/(WCOD+)?/.source.replace("WCOD",_s),Ps=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",cs),fs=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",cs),xs=new RegExp("^"+ds+ms+Ps+fs+"$"),ys=["material","materials","bones"];class vs{constructor(e,t,n){this.path=t,this.parsedPath=n||vs.parseTrackName(t),this.node=vs.findNode(e,this.parsedPath.nodeName)||e,this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,t,n){return e&&e.isAnimationObjectGroup?new vs.Composite(e,t,n):new vs(e,t,n)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(hs,"")}static parseTrackName(e){const t=xs.exec(e);if(null===t)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const n={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},i=n.nodeName&&n.nodeName.lastIndexOf(".");if(void 0!==i&&-1!==i){const e=n.nodeName.substring(i+1);-1!==ys.indexOf(e)&&(n.nodeName=n.nodeName.substring(0,i),n.objectName=e)}if(null===n.propertyName||0===n.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return n}static findNode(e,t){if(void 0===t||""===t||"."===t||-1===t||t===e.name||t===e.uuid)return e;if(e.skeleton){const n=e.skeleton.getBoneByName(t);if(void 0!==n)return n}if(e.children){const n=function(e){for(let i=0;i<e.length;i++){const r=e[i];if(r.name===t||r.uuid===t)return r;const o=n(r.children);if(o)return o}return null},i=n(e.children);if(i)return i}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,t){e[t]=this.targetObject[this.propertyName]}_getValue_array(e,t){const n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)e[t++]=n[i]}_getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}_setValue_direct(e,t){this.targetObject[this.propertyName]=e[t]}_setValue_direct_setNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,t){const n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)n[i]=e[t++]}_setValue_array_setNeedsUpdate(e,t){const n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)n[i]=e[t++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,t){const n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)n[i]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}_setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)}_setValue_fromArray_setNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,t){this.bind(),this.getValue(e,t)}_setValue_unbound(e,t){this.bind(),this.setValue(e,t)}bind(){let e=this.node;const t=this.parsedPath,n=t.objectName,i=t.propertyName;let r=t.propertyIndex;if(e||(e=vs.findNode(this.rootNode,t.nodeName)||this.rootNode,this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e)return void console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");if(n){let i=t.objectIndex;switch(n){case"materials":if(!e.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!e.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);e=e.material.materials;break;case"bones":if(!e.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);e=e.skeleton.bones;for(let t=0;t<e.length;t++)if(e[t].name===i){i=t;break}break;default:if(void 0===e[n])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);e=e[n]}if(void 0!==i){if(void 0===e[i])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);e=e[i]}}const o=e[i];if(void 0===o){const n=t.nodeName;return void console.error("THREE.PropertyBinding: Trying to update property for track: "+n+"."+i+" but it wasn't found.",e)}let a=this.Versioning.None;this.targetObject=e,void 0!==e.needsUpdate?a=this.Versioning.NeedsUpdate:void 0!==e.matrixWorldNeedsUpdate&&(a=this.Versioning.MatrixWorldNeedsUpdate);let s=this.BindingType.Direct;if(void 0!==r){if("morphTargetInfluences"===i){if(!e.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!e.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==e.morphTargetDictionary[r]&&(r=e.morphTargetDictionary[r])}s=this.BindingType.ArrayElement,this.resolvedProperty=o,this.propertyIndex=r}else void 0!==o.fromArray&&void 0!==o.toArray?(s=this.BindingType.HasFromToArray,this.resolvedProperty=o):Array.isArray(o)?(s=this.BindingType.EntireArray,this.resolvedProperty=o):this.propertyName=i;this.getValue=this.GetterByBindingType[s],this.setValue=this.SetterByBindingTypeAndVersioning[s][a]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}vs.Composite=class{constructor(e,t,n){const i=n||vs.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,i)}getValue(e,t){this.bind();const n=this._targetGroup.nCachedObjects_,i=this._bindings[n];void 0!==i&&i.getValue(e,t)}setValue(e,t){const n=this._bindings;for(let i=this._targetGroup.nCachedObjects_,r=n.length;i!==r;++i)n[i].setValue(e,t)}bind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].bind()}unbind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].unbind()}},vs.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},vs.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},vs.prototype.GetterByBindingType=[vs.prototype._getValue_direct,vs.prototype._getValue_array,vs.prototype._getValue_arrayElement,vs.prototype._getValue_toArray],vs.prototype.SetterByBindingTypeAndVersioning=[[vs.prototype._setValue_direct,vs.prototype._setValue_direct_setNeedsUpdate,vs.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[vs.prototype._setValue_array,vs.prototype._setValue_array_setNeedsUpdate,vs.prototype._setValue_array_setMatrixWorldNeedsUpdate],[vs.prototype._setValue_arrayElement,vs.prototype._setValue_arrayElement_setNeedsUpdate,vs.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[vs.prototype._setValue_fromArray,vs.prototype._setValue_fromArray_setNeedsUpdate,vs.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];const gs=new Uint32Array(512),bs=new Uint32Array(512);for(let e=0;e<256;++e){const t=e-127;t<-27?(gs[e]=0,gs[256|e]=32768,bs[e]=24,bs[256|e]=24):t<-14?(gs[e]=1024>>-t-14,gs[256|e]=1024>>-t-14|32768,bs[e]=-t-1,bs[256|e]=-t-1):t<=15?(gs[e]=t+15<<10,gs[256|e]=t+15<<10|32768,bs[e]=13,bs[256|e]=13):t<128?(gs[e]=31744,gs[256|e]=64512,bs[e]=24,bs[256|e]=24):(gs[e]=31744,gs[256|e]=64512,bs[e]=13,bs[256|e]=13)}const zs=new Uint32Array(2048),ws=new Uint32Array(64),Zs=new Uint32Array(64);for(let e=1;e<1024;++e){let t=e<<13,n=0;for(;0==(8388608&t);)t<<=1,n-=8388608;t&=-8388609,n+=947912704,zs[e]=t|n}for(let e=1024;e<2048;++e)zs[e]=939524096+(e-1024<<13);for(let e=1;e<31;++e)ws[e]=e<<23;ws[31]=1199570944,ws[32]=2147483648;for(let e=33;e<63;++e)ws[e]=2147483648+(e-32<<23);ws[63]=3347054592;for(let e=1;e<64;++e)32!==e&&(Zs[e]=1024);"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:"141"}})),"undefined"!=typeof window&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__="141");
/*!
    fflate - fast JavaScript compression/decompression
    <https://101arrowz.github.io/fflate>
    Licensed under MIT. https://github.com/101arrowz/fflate/blob/master/LICENSE
    version 0.6.9
    */
var Es={},Ms=function(e){return URL.createObjectURL(new Blob([e],{type:"text/javascript"}))},Ss=function(e){return new Worker(e)};try{URL.revokeObjectURL(Ms(""))}catch(e){Ms=function(e){return"data:application/javascript;charset=UTF-8,"+encodeURI(e)},Ss=function(e){return new Worker(e,{type:"module"})}}var Cs=Uint8Array,Ns=Uint16Array,As=Uint32Array,Ls=new Cs([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Bs=new Cs([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Ts=new Cs([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Vs=function(e,t){for(var n=new Ns(31),i=0;i<31;++i)n[i]=t+=1<<e[i-1];var r=new As(n[30]);for(i=1;i<30;++i)for(var o=n[i];o<n[i+1];++o)r[o]=o-n[i]<<5|i;return[n,r]},ks=Vs(Ls,2),Is=ks[0],Os=ks[1];Is[28]=258,Os[258]=28;for(var Rs=Vs(Bs,0),Hs=Rs[0],Fs=Rs[1],Ds=new Ns(32768),Gs=0;Gs<32768;++Gs){var Us=(43690&Gs)>>>1|(21845&Gs)<<1;Us=(61680&(Us=(52428&Us)>>>2|(13107&Us)<<2))>>>4|(3855&Us)<<4,Ds[Gs]=((65280&Us)>>>8|(255&Us)<<8)>>>1}var js=function(e,t,n){for(var i=e.length,r=0,o=new Ns(t);r<i;++r)++o[e[r]-1];var a,s=new Ns(t);for(r=0;r<t;++r)s[r]=s[r-1]+o[r-1]<<1;if(n){a=new Ns(1<<t);var l=15-t;for(r=0;r<i;++r)if(e[r])for(var p=r<<4|e[r],u=t-e[r],h=s[e[r]-1]++<<u,c=h|(1<<u)-1;h<=c;++h)a[Ds[h]>>>l]=p}else for(a=new Ns(i),r=0;r<i;++r)e[r]&&(a[r]=Ds[s[e[r]-1]++]>>>15-e[r]);return a},Ws=new Cs(288);for(Gs=0;Gs<144;++Gs)Ws[Gs]=8;for(Gs=144;Gs<256;++Gs)Ws[Gs]=9;for(Gs=256;Gs<280;++Gs)Ws[Gs]=7;for(Gs=280;Gs<288;++Gs)Ws[Gs]=8;var qs=new Cs(32);for(Gs=0;Gs<32;++Gs)qs[Gs]=5;var Js=js(Ws,9,0),$s=js(Ws,9,1),Xs=js(qs,5,0),Ys=js(qs,5,1),Ks=function(e){for(var t=e[0],n=1;n<e.length;++n)e[n]>t&&(t=e[n]);return t},Qs=function(e,t,n){var i=t/8|0;return(e[i]|e[i+1]<<8)>>(7&t)&n},el=function(e,t){var n=t/8|0;return(e[n]|e[n+1]<<8|e[n+2]<<16)>>(7&t)},tl=function(e){return(e/8|0)+(7&e&&1)},nl=function(e,t,n){(null==t||t<0)&&(t=0),(null==n||n>e.length)&&(n=e.length);var i=new(e instanceof Ns?Ns:e instanceof As?As:Cs)(n-t);return i.set(e.subarray(t,n)),i},il=function(e,t,n){var i=e.length;if(!i||n&&!n.l&&i<5)return t||new Cs(0);var r=!t||n,o=!n||n.i;n||(n={}),t||(t=new Cs(3*i));var a=function(e){var n=t.length;if(e>n){var i=new Cs(Math.max(2*n,e));i.set(t),t=i}},s=n.f||0,l=n.p||0,p=n.b||0,u=n.l,h=n.d,c=n.m,_=n.n,d=8*i;do{if(!u){n.f=s=Qs(e,l,1);var m=Qs(e,l+1,3);if(l+=3,!m){var P=e[(M=tl(l)+4)-4]|e[M-3]<<8,f=M+P;if(f>i){if(o)throw"unexpected EOF";break}r&&a(p+P),t.set(e.subarray(M,f),p),n.b=p+=P,n.p=l=8*f;continue}if(1==m)u=$s,h=Ys,c=9,_=5;else{if(2!=m)throw"invalid block type";var x=Qs(e,l,31)+257,y=Qs(e,l+10,15)+4,v=x+Qs(e,l+5,31)+1;l+=14;for(var g=new Cs(v),b=new Cs(19),z=0;z<y;++z)b[Ts[z]]=Qs(e,l+3*z,7);l+=3*y;var w=Ks(b),Z=(1<<w)-1,E=js(b,w,1);for(z=0;z<v;){var M,S=E[Qs(e,l,Z)];if(l+=15&S,(M=S>>>4)<16)g[z++]=M;else{var C=0,N=0;for(16==M?(N=3+Qs(e,l,3),l+=2,C=g[z-1]):17==M?(N=3+Qs(e,l,7),l+=3):18==M&&(N=11+Qs(e,l,127),l+=7);N--;)g[z++]=C}}var A=g.subarray(0,x),L=g.subarray(x);c=Ks(A),_=Ks(L),u=js(A,c,1),h=js(L,_,1)}if(l>d){if(o)throw"unexpected EOF";break}}r&&a(p+131072);for(var B=(1<<c)-1,T=(1<<_)-1,V=l;;V=l){var k=(C=u[el(e,l)&B])>>>4;if((l+=15&C)>d){if(o)throw"unexpected EOF";break}if(!C)throw"invalid length/literal";if(k<256)t[p++]=k;else{if(256==k){V=l,u=null;break}var I=k-254;if(k>264){var O=Ls[z=k-257];I=Qs(e,l,(1<<O)-1)+Is[z],l+=O}var R=h[el(e,l)&T],H=R>>>4;if(!R)throw"invalid distance";if(l+=15&R,L=Hs[H],H>3&&(O=Bs[H],L+=el(e,l)&(1<<O)-1,l+=O),l>d){if(o)throw"unexpected EOF";break}r&&a(p+131072);for(var F=p+I;p<F;p+=4)t[p]=t[p-L],t[p+1]=t[p+1-L],t[p+2]=t[p+2-L],t[p+3]=t[p+3-L];p=F}}n.l=u,n.p=V,n.b=p,u&&(s=1,n.m=c,n.d=h,n.n=_)}while(!s);return p==t.length?t:nl(t,0,p)},rl=function(e,t,n){n<<=7&t;var i=t/8|0;e[i]|=n,e[i+1]|=n>>>8},ol=function(e,t,n){n<<=7&t;var i=t/8|0;e[i]|=n,e[i+1]|=n>>>8,e[i+2]|=n>>>16},al=function(e,t){for(var n=[],i=0;i<e.length;++i)e[i]&&n.push({s:i,f:e[i]});var r=n.length,o=n.slice();if(!r)return[_l,0];if(1==r){var a=new Cs(n[0].s+1);return a[n[0].s]=1,[a,1]}n.sort((function(e,t){return e.f-t.f})),n.push({s:-1,f:25001});var s=n[0],l=n[1],p=0,u=1,h=2;for(n[0]={s:-1,f:s.f+l.f,l:s,r:l};u!=r-1;)s=n[n[p].f<n[h].f?p++:h++],l=n[p!=u&&n[p].f<n[h].f?p++:h++],n[u++]={s:-1,f:s.f+l.f,l:s,r:l};var c=o[0].s;for(i=1;i<r;++i)o[i].s>c&&(c=o[i].s);var _=new Ns(c+1),d=sl(n[u-1],_,0);if(d>t){i=0;var m=0,P=d-t,f=1<<P;for(o.sort((function(e,t){return _[t.s]-_[e.s]||e.f-t.f}));i<r;++i){var x=o[i].s;if(!(_[x]>t))break;m+=f-(1<<d-_[x]),_[x]=t}for(m>>>=P;m>0;){var y=o[i].s;_[y]<t?m-=1<<t-_[y]++-1:++i}for(;i>=0&&m;--i){var v=o[i].s;_[v]==t&&(--_[v],++m)}d=t}return[new Cs(_),d]},sl=function(e,t,n){return-1==e.s?Math.max(sl(e.l,t,n+1),sl(e.r,t,n+1)):t[e.s]=n},ll=function(e){for(var t=e.length;t&&!e[--t];);for(var n=new Ns(++t),i=0,r=e[0],o=1,a=function(e){n[i++]=e},s=1;s<=t;++s)if(e[s]==r&&s!=t)++o;else{if(!r&&o>2){for(;o>138;o-=138)a(32754);o>2&&(a(o>10?o-11<<5|28690:o-3<<5|12305),o=0)}else if(o>3){for(a(r),--o;o>6;o-=6)a(8304);o>2&&(a(o-3<<5|8208),o=0)}for(;o--;)a(r);o=1,r=e[s]}return[n.subarray(0,i),t]},pl=function(e,t){for(var n=0,i=0;i<t.length;++i)n+=e[i]*t[i];return n},ul=function(e,t,n){var i=n.length,r=tl(t+2);e[r]=255&i,e[r+1]=i>>>8,e[r+2]=255^e[r],e[r+3]=255^e[r+1];for(var o=0;o<i;++o)e[r+o+4]=n[o];return 8*(r+4+i)},hl=function(e,t,n,i,r,o,a,s,l,p,u){rl(t,u++,n),++r[256];for(var h=al(r,15),c=h[0],_=h[1],d=al(o,15),m=d[0],P=d[1],f=ll(c),x=f[0],y=f[1],v=ll(m),g=v[0],b=v[1],z=new Ns(19),w=0;w<x.length;++w)z[31&x[w]]++;for(w=0;w<g.length;++w)z[31&g[w]]++;for(var Z=al(z,7),E=Z[0],M=Z[1],S=19;S>4&&!E[Ts[S-1]];--S);var C,N,A,L,B=p+5<<3,T=pl(r,Ws)+pl(o,qs)+a,V=pl(r,c)+pl(o,m)+a+14+3*S+pl(z,E)+(2*z[16]+3*z[17]+7*z[18]);if(B<=T&&B<=V)return ul(t,u,e.subarray(l,l+p));if(rl(t,u,1+(V<T)),u+=2,V<T){C=js(c,_,0),N=c,A=js(m,P,0),L=m;var k=js(E,M,0);for(rl(t,u,y-257),rl(t,u+5,b-1),rl(t,u+10,S-4),u+=14,w=0;w<S;++w)rl(t,u+3*w,E[Ts[w]]);u+=3*S;for(var I=[x,g],O=0;O<2;++O){var R=I[O];for(w=0;w<R.length;++w){var H=31&R[w];rl(t,u,k[H]),u+=E[H],H>15&&(rl(t,u,R[w]>>>5&127),u+=R[w]>>>12)}}}else C=Js,N=Ws,A=Xs,L=qs;for(w=0;w<s;++w)if(i[w]>255){H=i[w]>>>18&31,ol(t,u,C[H+257]),u+=N[H+257],H>7&&(rl(t,u,i[w]>>>23&31),u+=Ls[H]);var F=31&i[w];ol(t,u,A[F]),u+=L[F],F>3&&(ol(t,u,i[w]>>>5&8191),u+=Bs[F])}else ol(t,u,C[i[w]]),u+=N[i[w]];return ol(t,u,C[256]),u+N[256]},cl=new As([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),_l=new Cs(0),dl=function(e,t,n,i,r,o){var a=e.length,s=new Cs(i+a+5*(1+Math.ceil(a/7e3))+r),l=s.subarray(i,s.length-r),p=0;if(!t||a<8)for(var u=0;u<=a;u+=65535){var h=u+65535;h<a?p=ul(l,p,e.subarray(u,h)):(l[u]=o,p=ul(l,p,e.subarray(u,a)))}else{for(var c=cl[t-1],_=c>>>13,d=8191&c,m=(1<<n)-1,P=new Ns(32768),f=new Ns(m+1),x=Math.ceil(n/3),y=2*x,v=function(t){return(e[t]^e[t+1]<<x^e[t+2]<<y)&m},g=new As(25e3),b=new Ns(288),z=new Ns(32),w=0,Z=0,E=(u=0,0),M=0,S=0;u<a;++u){var C=v(u),N=32767&u,A=f[C];if(P[N]=A,f[C]=N,M<=u){var L=a-u;if((w>7e3||E>24576)&&L>423){p=hl(e,l,0,g,b,z,Z,E,S,u-S,p),E=w=Z=0,S=u;for(var B=0;B<286;++B)b[B]=0;for(B=0;B<30;++B)z[B]=0}var T=2,V=0,k=d,I=N-A&32767;if(L>2&&C==v(u-I))for(var O=Math.min(_,L)-1,R=Math.min(32767,u),H=Math.min(258,L);I<=R&&--k&&N!=A;){if(e[u+T]==e[u+T-I]){for(var F=0;F<H&&e[u+F]==e[u+F-I];++F);if(F>T){if(T=F,V=I,F>O)break;var D=Math.min(I,F-2),G=0;for(B=0;B<D;++B){var U=u-I+B+32768&32767,j=U-P[U]+32768&32767;j>G&&(G=j,A=U)}}}I+=(N=A)-(A=P[N])+32768&32767}if(V){g[E++]=268435456|Os[T]<<18|Fs[V];var W=31&Os[T],q=31&Fs[V];Z+=Ls[W]+Bs[q],++b[257+W],++z[q],M=u+T,++w}else g[E++]=e[u],++b[e[u]]}}p=hl(e,l,o,g,b,z,Z,E,S,u-S,p),!o&&7&p&&(p=ul(l,p+1,_l))}return nl(s,0,i+tl(p)+r)},ml=function(){for(var e=new As(256),t=0;t<256;++t){for(var n=t,i=9;--i;)n=(1&n&&3988292384)^n>>>1;e[t]=n}return e}(),Pl=function(){var e=-1;return{p:function(t){for(var n=e,i=0;i<t.length;++i)n=ml[255&n^t[i]]^n>>>8;e=n},d:function(){return~e}}},fl=function(){var e=1,t=0;return{p:function(n){for(var i=e,r=t,o=n.length,a=0;a!=o;){for(var s=Math.min(a+2655,o);a<s;++a)r+=i+=n[a];i=(65535&i)+15*(i>>16),r=(65535&r)+15*(r>>16)}e=i,t=r},d:function(){return(255&(e%=65521))<<24|e>>>8<<16|(255&(t%=65521))<<8|t>>>8}}},xl=function(e,t,n,i,r){return dl(e,null==t.level?6:t.level,null==t.mem?Math.ceil(1.5*Math.max(8,Math.min(13,Math.log(e.length)))):12+t.mem,n,i,!r)},yl=function(e,t){var n={};for(var i in e)n[i]=e[i];for(var i in t)n[i]=t[i];return n},vl=function(e,t,n){for(var i=e(),r=e.toString(),o=r.slice(r.indexOf("[")+1,r.lastIndexOf("]")).replace(/ /g,"").split(","),a=0;a<i.length;++a){var s=i[a],l=o[a];if("function"==typeof s){t+=";"+l+"=";var p=s.toString();if(s.prototype)if(-1!=p.indexOf("[native code]")){var u=p.indexOf(" ",8)+1;t+=p.slice(u,p.indexOf("(",u))}else for(var h in t+=p,s.prototype)t+=";"+l+".prototype."+h+"="+s.prototype[h].toString();else t+=p}else n[l]=s}return[t,n]},gl=[],bl=function(e,t,n,i){var r;if(!gl[n]){for(var o="",a={},s=e.length-1,l=0;l<s;++l)o=(r=vl(e[l],o,a))[0],a=r[1];gl[n]=vl(e[s],o,a)}var p=yl({},gl[n][1]);return function(e,t,n,i,r){var o=Ss(Es[t]||(Es[t]=Ms(e)));return o.onerror=function(e){return r(e.error,null)},o.onmessage=function(e){return r(null,e.data)},o.postMessage(n,i),o}(gl[n][0]+";onmessage=function(e){for(var k in e.data)self[k]=e.data[k];onmessage="+t.toString()+"}",n,p,function(e){var t=[];for(var n in e)(e[n]instanceof Cs||e[n]instanceof Ns||e[n]instanceof As)&&t.push((e[n]=new e[n].constructor(e[n])).buffer);return t}(p),i)},zl=function(){return[Cs,Ns,As,Ls,Bs,Ts,Is,Hs,$s,Ys,Ds,js,Ks,Qs,el,tl,nl,il,Kl,Cl,Nl]},wl=function(){return[Cs,Ns,As,Ls,Bs,Ts,Os,Fs,Js,Ws,Xs,qs,Ds,cl,_l,js,rl,ol,al,sl,ll,pl,ul,hl,tl,nl,dl,xl,Jl,Cl]},Zl=function(){return[Ol,Fl,Il,Pl,ml]},El=function(){return[Rl,Hl]},Ml=function(){return[Dl,Il,fl]},Sl=function(){return[Gl]},Cl=function(e){return postMessage(e,[e.buffer])},Nl=function(e){return e&&e.size&&new Cs(e.size)},Al=function(e,t,n,i,r,o){var a=bl(n,i,r,(function(e,t){a.terminate(),o(e,t)}));return a.postMessage([e,t],t.consume?[e.buffer]:[]),function(){a.terminate()}},Ll=function(e){return e.ondata=function(e,t){return postMessage([e,t],[e.buffer])},function(t){return e.push(t.data[0],t.data[1])}},Bl=function(e,t,n,i,r){var o,a=bl(e,i,r,(function(e,n){e?(a.terminate(),t.ondata.call(t,e)):(n[1]&&a.terminate(),t.ondata.call(t,e,n[0],n[1]))}));a.postMessage(n),t.push=function(e,n){if(o)throw"stream finished";if(!t.ondata)throw"no stream handler";a.postMessage([e,o=n],[e.buffer])},t.terminate=function(){a.terminate()}},Tl=function(e,t){return e[t]|e[t+1]<<8},Vl=function(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24)>>>0},kl=function(e,t){return Vl(e,t)+4294967296*Vl(e,t+4)},Il=function(e,t,n){for(;n;++t)e[t]=n,n>>>=8},Ol=function(e,t){var n=t.filename;if(e[0]=31,e[1]=139,e[2]=8,e[8]=t.level<2?4:9==t.level?2:0,e[9]=3,0!=t.mtime&&Il(e,4,Math.floor(new Date(t.mtime||Date.now())/1e3)),n){e[3]=8;for(var i=0;i<=n.length;++i)e[i+10]=n.charCodeAt(i)}},Rl=function(e){if(31!=e[0]||139!=e[1]||8!=e[2])throw"invalid gzip data";var t=e[3],n=10;4&t&&(n+=e[10]|2+(e[11]<<8));for(var i=(t>>3&1)+(t>>4&1);i>0;i-=!e[n++]);return n+(2&t)},Hl=function(e){var t=e.length;return(e[t-4]|e[t-3]<<8|e[t-2]<<16|e[t-1]<<24)>>>0},Fl=function(e){return 10+(e.filename&&e.filename.length+1||0)},Dl=function(e,t){var n=t.level,i=0==n?0:n<6?1:9==n?3:2;e[0]=120,e[1]=i<<6|(i?32-2*i:1)},Gl=function(e){if(8!=(15&e[0])||e[0]>>>4>7||(e[0]<<8|e[1])%31)throw"invalid zlib data";if(32&e[1])throw"invalid zlib data: preset dictionaries not supported"};function Ul(e,t){return t||"function"!=typeof e||(t=e,e={}),this.ondata=t,e}var jl=function(){function e(e,t){t||"function"!=typeof e||(t=e,e={}),this.ondata=t,this.o=e||{}}return e.prototype.p=function(e,t){this.ondata(xl(e,this.o,0,0,!t),t)},e.prototype.push=function(e,t){if(this.d)throw"stream finished";if(!this.ondata)throw"no stream handler";this.d=t,this.p(e,t||!1)},e}(),Wl=function(e,t){Bl([wl,function(){return[Ll,jl]}],this,Ul.call(this,e,t),(function(e){var t=new jl(e.data);onmessage=Ll(t)}),6)};function ql(e,t,n){if(n||(n=t,t={}),"function"!=typeof n)throw"no callback";return Al(e,t,[wl],(function(e){return Cl(Jl(e.data[0],e.data[1]))}),0,n)}function Jl(e,t){return xl(e,t||{},0,0)}var $l=function(){function e(e){this.s={},this.p=new Cs(0),this.ondata=e}return e.prototype.e=function(e){if(this.d)throw"stream finished";if(!this.ondata)throw"no stream handler";var t=this.p.length,n=new Cs(t+e.length);n.set(this.p),n.set(e,t),this.p=n},e.prototype.c=function(e){this.d=this.s.i=e||!1;var t=this.s.b,n=il(this.p,this.o,this.s);this.ondata(nl(n,t,this.s.b),this.d),this.o=nl(n,this.s.b-32768),this.s.b=this.o.length,this.p=nl(this.p,this.s.p/8|0),this.s.p&=7},e.prototype.push=function(e,t){this.e(e),this.c(t)},e}(),Xl=function(e){this.ondata=e,Bl([zl,function(){return[Ll,$l]}],this,0,(function(){var e=new $l;onmessage=Ll(e)}),7)};function Yl(e,t,n){if(n||(n=t,t={}),"function"!=typeof n)throw"no callback";return Al(e,t,[zl],(function(e){return Cl(Kl(e.data[0],Nl(e.data[1])))}),1,n)}function Kl(e,t){return il(e,t)}var Ql=function(){function e(e,t){this.c=Pl(),this.l=0,this.v=1,jl.call(this,e,t)}return e.prototype.push=function(e,t){jl.prototype.push.call(this,e,t)},e.prototype.p=function(e,t){this.c.p(e),this.l+=e.length;var n=xl(e,this.o,this.v&&Fl(this.o),t&&8,!t);this.v&&(Ol(n,this.o),this.v=0),t&&(Il(n,n.length-8,this.c.d()),Il(n,n.length-4,this.l)),this.ondata(n,t)},e}(),ep=function(e,t){Bl([wl,Zl,function(){return[Ll,jl,Ql]}],this,Ul.call(this,e,t),(function(e){var t=new Ql(e.data);onmessage=Ll(t)}),8)};function tp(e,t,n){if(n||(n=t,t={}),"function"!=typeof n)throw"no callback";return Al(e,t,[wl,Zl,function(){return[np]}],(function(e){return Cl(np(e.data[0],e.data[1]))}),2,n)}function np(e,t){t||(t={});var n=Pl(),i=e.length;n.p(e);var r=xl(e,t,Fl(t),8),o=r.length;return Ol(r,t),Il(r,o-8,n.d()),Il(r,o-4,i),r}var ip=function(){function e(e){this.v=1,$l.call(this,e)}return e.prototype.push=function(e,t){if($l.prototype.e.call(this,e),this.v){var n=this.p.length>3?Rl(this.p):4;if(n>=this.p.length&&!t)return;this.p=this.p.subarray(n),this.v=0}if(t){if(this.p.length<8)throw"invalid gzip stream";this.p=this.p.subarray(0,-8)}$l.prototype.c.call(this,t)},e}(),rp=function(e){this.ondata=e,Bl([zl,El,function(){return[Ll,$l,ip]}],this,0,(function(){var e=new ip;onmessage=Ll(e)}),9)};function op(e,t,n){if(n||(n=t,t={}),"function"!=typeof n)throw"no callback";return Al(e,t,[zl,El,function(){return[ap]}],(function(e){return Cl(ap(e.data[0]))}),3,n)}function ap(e,t){return il(e.subarray(Rl(e),-8),t||new Cs(Hl(e)))}var sp=function(){function e(e,t){this.c=fl(),this.v=1,jl.call(this,e,t)}return e.prototype.push=function(e,t){jl.prototype.push.call(this,e,t)},e.prototype.p=function(e,t){this.c.p(e);var n=xl(e,this.o,this.v&&2,t&&4,!t);this.v&&(Dl(n,this.o),this.v=0),t&&Il(n,n.length-4,this.c.d()),this.ondata(n,t)},e}(),lp=function(e,t){Bl([wl,Ml,function(){return[Ll,jl,sp]}],this,Ul.call(this,e,t),(function(e){var t=new sp(e.data);onmessage=Ll(t)}),10)};function pp(e,t){t||(t={});var n=fl();n.p(e);var i=xl(e,t,2,4);return Dl(i,t),Il(i,i.length-4,n.d()),i}var up=function(){function e(e){this.v=1,$l.call(this,e)}return e.prototype.push=function(e,t){if($l.prototype.e.call(this,e),this.v){if(this.p.length<2&&!t)return;this.p=this.p.subarray(2),this.v=0}if(t){if(this.p.length<4)throw"invalid zlib stream";this.p=this.p.subarray(0,-4)}$l.prototype.c.call(this,t)},e}(),hp=function(e){this.ondata=e,Bl([zl,Sl,function(){return[Ll,$l,up]}],this,0,(function(){var e=new up;onmessage=Ll(e)}),11)};function cp(e,t,n){if(n||(n=t,t={}),"function"!=typeof n)throw"no callback";return Al(e,t,[zl,Sl,function(){return[_p]}],(function(e){return Cl(_p(e.data[0],Nl(e.data[1])))}),5,n)}function _p(e,t){return il((Gl(e),e.subarray(2,-4)),t)}var dp=function(){function e(e){this.G=ip,this.I=$l,this.Z=up,this.ondata=e}return e.prototype.push=function(e,t){if(!this.ondata)throw"no stream handler";if(this.s)this.s.push(e,t);else{if(this.p&&this.p.length){var n=new Cs(this.p.length+e.length);n.set(this.p),n.set(e,this.p.length)}else this.p=e;if(this.p.length>2){var i=this,r=function(){i.ondata.apply(i,arguments)};this.s=31==this.p[0]&&139==this.p[1]&&8==this.p[2]?new this.G(r):8!=(15&this.p[0])||this.p[0]>>4>7||(this.p[0]<<8|this.p[1])%31?new this.I(r):new this.Z(r),this.s.push(this.p,t),this.p=null}}},e}(),mp=function(){function e(e){this.G=rp,this.I=Xl,this.Z=hp,this.ondata=e}return e.prototype.push=function(e,t){dp.prototype.push.call(this,e,t)},e}(),Pp=function(e,t,n,i){for(var r in e){var o=e[r],a=t+r;o instanceof Cs?n[a]=[o,i]:Array.isArray(o)?n[a]=[o[0],yl(i,o[1])]:Pp(o,a+"/",n,i)}},fp="undefined"!=typeof TextEncoder&&new TextEncoder,xp="undefined"!=typeof TextDecoder&&new TextDecoder,yp=0;try{xp.decode(_l,{stream:!0}),yp=1}catch(e){}var vp=function(e){for(var t="",n=0;;){var i=e[n++],r=(i>127)+(i>223)+(i>239);if(n+r>e.length)return[t,nl(e,n-1)];r?3==r?(i=((15&i)<<18|(63&e[n++])<<12|(63&e[n++])<<6|63&e[n++])-65536,t+=String.fromCharCode(55296|i>>10,56320|1023&i)):t+=1&r?String.fromCharCode((31&i)<<6|63&e[n++]):String.fromCharCode((15&i)<<12|(63&e[n++])<<6|63&e[n++]):t+=String.fromCharCode(i)}},gp=function(){function e(e){this.ondata=e,yp?this.t=new TextDecoder:this.p=_l}return e.prototype.push=function(e,t){if(!this.ondata)throw"no callback";if(t=!!t,this.t){if(this.ondata(this.t.decode(e,{stream:!0}),t),t){if(this.t.decode().length)throw"invalid utf-8 data";this.t=null}}else{if(!this.p)throw"stream finished";var n=new Cs(this.p.length+e.length);n.set(this.p),n.set(e,this.p.length);var i=vp(n),r=i[0],o=i[1];if(t){if(o.length)throw"invalid utf-8 data";this.p=null}else this.p=o;this.ondata(r,t)}},e}(),bp=function(){function e(e){this.ondata=e}return e.prototype.push=function(e,t){if(!this.ondata)throw"no callback";if(this.d)throw"stream finished";this.ondata(zp(e),this.d=t||!1)},e}();function zp(e,t){if(t){for(var n=new Cs(e.length),i=0;i<e.length;++i)n[i]=e.charCodeAt(i);return n}if(fp)return fp.encode(e);var r=e.length,o=new Cs(e.length+(e.length>>1)),a=0,s=function(e){o[a++]=e};for(i=0;i<r;++i){if(a+5>o.length){var l=new Cs(a+8+(r-i<<1));l.set(o),o=l}var p=e.charCodeAt(i);p<128||t?s(p):p<2048?(s(192|p>>6),s(128|63&p)):p>55295&&p<57344?(s(240|(p=65536+(1047552&p)|1023&e.charCodeAt(++i))>>18),s(128|p>>12&63),s(128|p>>6&63),s(128|63&p)):(s(224|p>>12),s(128|p>>6&63),s(128|63&p))}return nl(o,0,a)}function wp(e,t){if(t){for(var n="",i=0;i<e.length;i+=16384)n+=String.fromCharCode.apply(null,e.subarray(i,i+16384));return n}if(xp)return xp.decode(e);var r=vp(e),o=r[0];if(r[1].length)throw"invalid utf-8 data";return o}var Zp=function(e){return 1==e?3:e<6?2:9==e?1:0},Ep=function(e,t){return t+30+Tl(e,t+26)+Tl(e,t+28)},Mp=function(e,t,n){var i=Tl(e,t+28),r=wp(e.subarray(t+46,t+46+i),!(2048&Tl(e,t+8))),o=t+46+i,a=Vl(e,t+20),s=n&&4294967295==a?Sp(e,o):[a,Vl(e,t+24),Vl(e,t+42)],l=s[0],p=s[1],u=s[2];return[Tl(e,t+10),l,p,r,o+Tl(e,t+30)+Tl(e,t+32),u]},Sp=function(e,t){for(;1!=Tl(e,t);t+=4+Tl(e,t+2));return[kl(e,t+12),kl(e,t+4),kl(e,t+20)]},Cp=function(e){var t=0;if(e)for(var n in e){var i=e[n].length;if(i>65535)throw"extra field too long";t+=i+4}return t},Np=function(e,t,n,i,r,o,a,s){var l=i.length,p=n.extra,u=s&&s.length,h=Cp(p);Il(e,t,null!=a?33639248:67324752),t+=4,null!=a&&(e[t++]=20,e[t++]=n.os),e[t]=20,t+=2,e[t++]=n.flag<<1|(null==o&&8),e[t++]=r&&8,e[t++]=255&n.compression,e[t++]=n.compression>>8;var c=new Date(null==n.mtime?Date.now():n.mtime),_=c.getFullYear()-1980;if(_<0||_>119)throw"date not in range 1980-2099";if(Il(e,t,_<<25|c.getMonth()+1<<21|c.getDate()<<16|c.getHours()<<11|c.getMinutes()<<5|c.getSeconds()>>>1),t+=4,null!=o&&(Il(e,t,n.crc),Il(e,t+4,o),Il(e,t+8,n.size)),Il(e,t+12,l),Il(e,t+14,h),t+=16,null!=a&&(Il(e,t,u),Il(e,t+6,n.attrs),Il(e,t+10,a),t+=14),e.set(i,t),t+=l,h)for(var d in p){var m=p[d],P=m.length;Il(e,t,+d),Il(e,t+2,P),e.set(m,t+4),t+=4+P}return u&&(e.set(s,t),t+=u),t},Ap=function(e,t,n,i,r){Il(e,t,101010256),Il(e,t+8,n),Il(e,t+10,n),Il(e,t+12,i),Il(e,t+16,r)},Lp=function(){function e(e){this.filename=e,this.c=Pl(),this.size=0,this.compression=0}return e.prototype.process=function(e,t){this.ondata(null,e,t)},e.prototype.push=function(e,t){if(!this.ondata)throw"no callback - add to ZIP archive before pushing";this.c.p(e),this.size+=e.length,t&&(this.crc=this.c.d()),this.process(e,t||!1)},e}(),Bp=function(){function e(e,t){var n=this;t||(t={}),Lp.call(this,e),this.d=new jl(t,(function(e,t){n.ondata(null,e,t)})),this.compression=8,this.flag=Zp(t.level)}return e.prototype.process=function(e,t){try{this.d.push(e,t)}catch(e){this.ondata(e,null,t)}},e.prototype.push=function(e,t){Lp.prototype.push.call(this,e,t)},e}(),Tp=function(){function e(e,t){var n=this;t||(t={}),Lp.call(this,e),this.d=new Wl(t,(function(e,t,i){n.ondata(e,t,i)})),this.compression=8,this.flag=Zp(t.level),this.terminate=this.d.terminate}return e.prototype.process=function(e,t){this.d.push(e,t)},e.prototype.push=function(e,t){Lp.prototype.push.call(this,e,t)},e}(),Vp=function(){function e(e){this.ondata=e,this.u=[],this.d=1}return e.prototype.add=function(e){var t=this;if(2&this.d)throw"stream finished";var n=zp(e.filename),i=n.length,r=e.comment,o=r&&zp(r),a=i!=e.filename.length||o&&r.length!=o.length,s=i+Cp(e.extra)+30;if(i>65535)throw"filename too long";var l=new Cs(s);Np(l,0,e,n,a);var p=[l],u=function(){for(var e=0,n=p;e<n.length;e++){var i=n[e];t.ondata(null,i,!1)}p=[]},h=this.d;this.d=0;var c=this.u.length,_=yl(e,{f:n,u:a,o:o,t:function(){e.terminate&&e.terminate()},r:function(){if(u(),h){var e=t.u[c+1];e?e.r():t.d=1}h=1}}),d=0;e.ondata=function(n,i,r){if(n)t.ondata(n,i,r),t.terminate();else if(d+=i.length,p.push(i),r){var o=new Cs(16);Il(o,0,134695760),Il(o,4,e.crc),Il(o,8,d),Il(o,12,e.size),p.push(o),_.c=d,_.b=s+d+16,_.crc=e.crc,_.size=e.size,h&&_.r(),h=1}else h&&u()},this.u.push(_)},e.prototype.end=function(){var e=this;if(2&this.d){if(1&this.d)throw"stream finishing";throw"stream finished"}this.d?this.e():this.u.push({r:function(){1&e.d&&(e.u.splice(-1,1),e.e())},t:function(){}}),this.d=3},e.prototype.e=function(){for(var e=0,t=0,n=0,i=0,r=this.u;i<r.length;i++)n+=46+(l=r[i]).f.length+Cp(l.extra)+(l.o?l.o.length:0);for(var o=new Cs(n+22),a=0,s=this.u;a<s.length;a++){var l=s[a];Np(o,e,l,l.f,l.u,l.c,t,l.o),e+=46+l.f.length+Cp(l.extra)+(l.o?l.o.length:0),t+=l.b}Ap(o,e,this.u.length,n,t),this.ondata(null,o,!0),this.d=2},e.prototype.terminate=function(){for(var e=0,t=this.u;e<t.length;e++)t[e].t();this.d=2},e}(),kp=function(){function e(){}return e.prototype.push=function(e,t){this.ondata(null,e,t)},e.compression=0,e}(),Ip=function(){function e(){var e=this;this.i=new $l((function(t,n){e.ondata(null,t,n)}))}return e.prototype.push=function(e,t){try{this.i.push(e,t)}catch(n){this.ondata(n,e,t)}},e.compression=8,e}(),Op=function(){function e(e,t){var n=this;t<32e4?this.i=new $l((function(e,t){n.ondata(null,e,t)})):(this.i=new Xl((function(e,t,i){n.ondata(e,t,i)})),this.terminate=this.i.terminate)}return e.prototype.push=function(e,t){this.i.terminate&&(e=nl(e,0)),this.i.push(e,t)},e.compression=8,e}(),Rp=function(){function e(e){this.onfile=e,this.k=[],this.o={0:kp},this.p=_l}return e.prototype.push=function(e,t){var n=this;if(!this.onfile)throw"no callback";if(!this.p)throw"stream finished";if(this.c>0){var i=Math.min(this.c,e.length),r=e.subarray(0,i);if(this.c-=i,this.d?this.d.push(r,!this.c):this.k[0].push(r),(e=e.subarray(i)).length)return this.push(e,t)}else{var o=0,a=0,s=void 0,l=void 0;this.p.length?e.length?((l=new Cs(this.p.length+e.length)).set(this.p),l.set(e,this.p.length)):l=this.p:l=e;for(var p=l.length,u=this.c,h=u&&this.d,c=function(){var e,t=Vl(l,a);if(67324752==t){o=1,s=a,_.d=null,_.c=0;var i=Tl(l,a+6),r=Tl(l,a+8),h=2048&i,c=8&i,d=Tl(l,a+26),m=Tl(l,a+28);if(p>a+30+d+m){var P=[];_.k.unshift(P),o=2;var f,x=Vl(l,a+18),y=Vl(l,a+22),v=wp(l.subarray(a+30,a+=30+d),!h);4294967295==x?(e=c?[-2]:Sp(l,a),x=e[0],y=e[1]):c&&(x=-1),a+=m,_.c=x;var g={name:v,compression:r,start:function(){if(!g.ondata)throw"no callback";if(x){var e=n.o[r];if(!e)throw"unknown compression type "+r;(f=x<0?new e(v):new e(v,x,y)).ondata=function(e,t,n){g.ondata(e,t,n)};for(var t=0,i=P;t<i.length;t++){var o=i[t];f.push(o,!1)}n.k[0]==P&&n.c?n.d=f:f.push(_l,!0)}else g.ondata(null,_l,!0)},terminate:function(){f&&f.terminate&&f.terminate()}};x>=0&&(g.size=x,g.originalSize=y),_.onfile(g)}return"break"}if(u){if(134695760==t)return s=a+=12+(-2==u&&8),o=3,_.c=0,"break";if(33639248==t)return s=a-=4,o=3,_.c=0,"break"}},_=this;a<p-4&&"break"!==c();++a);if(this.p=_l,u<0){var d=o?l.subarray(0,s-12-(-2==u&&8)-(134695760==Vl(l,s-16)&&4)):l.subarray(0,a);h?h.push(d,!!o):this.k[+(2==o)].push(d)}if(2&o)return this.push(l.subarray(a),t);this.p=l.subarray(a)}if(t){if(this.c)throw"invalid zip file";this.p=null}},e.prototype.register=function(e){this.o[e.compression]=e},e}(),Hp=Object.freeze({__proto__:null,Deflate:jl,AsyncDeflate:Wl,deflate:ql,deflateSync:Jl,Inflate:$l,AsyncInflate:Xl,inflate:Yl,inflateSync:Kl,Gzip:Ql,AsyncGzip:ep,gzip:tp,gzipSync:np,Gunzip:ip,AsyncGunzip:rp,gunzip:op,gunzipSync:ap,Zlib:sp,AsyncZlib:lp,zlib:function(e,t,n){if(n||(n=t,t={}),"function"!=typeof n)throw"no callback";return Al(e,t,[wl,Ml,function(){return[pp]}],(function(e){return Cl(pp(e.data[0],e.data[1]))}),4,n)},zlibSync:pp,Unzlib:up,AsyncUnzlib:hp,unzlib:cp,unzlibSync:_p,compress:tp,AsyncCompress:ep,compressSync:np,Compress:Ql,Decompress:dp,AsyncDecompress:mp,decompress:function(e,t,n){if(n||(n=t,t={}),"function"!=typeof n)throw"no callback";return 31==e[0]&&139==e[1]&&8==e[2]?op(e,t,n):8!=(15&e[0])||e[0]>>4>7||(e[0]<<8|e[1])%31?Yl(e,t,n):cp(e,t,n)},decompressSync:function(e,t){return 31==e[0]&&139==e[1]&&8==e[2]?ap(e,t):8!=(15&e[0])||e[0]>>4>7||(e[0]<<8|e[1])%31?Kl(e,t):_p(e,t)},DecodeUTF8:gp,EncodeUTF8:bp,strToU8:zp,strFromU8:wp,ZipPassThrough:Lp,ZipDeflate:Bp,AsyncZipDeflate:Tp,Zip:Vp,zip:function(e,t,n){if(n||(n=t,t={}),"function"!=typeof n)throw"no callback";var i={};Pp(e,"",i,t);var r=Object.keys(i),o=r.length,a=0,s=0,l=o,p=new Array(o),u=[],h=function(){for(var e=0;e<u.length;++e)u[e]()},c=function(){var e=new Cs(s+22),t=a,i=s-a;s=0;for(var r=0;r<l;++r){var o=p[r];try{var u=o.c.length;Np(e,s,o,o.f,o.u,u);var h=30+o.f.length+Cp(o.extra),c=s+h;e.set(o.c,c),Np(e,a,o,o.f,o.u,u,s,o.m),a+=16+h+(o.m?o.m.length:0),s=c+u}catch(e){return n(e,null)}}Ap(e,a,p.length,i,t),n(null,e)};o||c();for(var _=function(e){var t=r[e],l=i[t],_=l[0],d=l[1],m=Pl(),P=_.length;m.p(_);var f=zp(t),x=f.length,y=d.comment,v=y&&zp(y),g=v&&v.length,b=Cp(d.extra),z=0==d.level?0:8,w=function(i,r){if(i)h(),n(i,null);else{var l=r.length;p[e]=yl(d,{size:P,crc:m.d(),c:r,f:f,m:v,u:x!=t.length||v&&y.length!=g,compression:z}),a+=30+x+b+l,s+=76+2*(x+b)+(g||0)+l,--o||c()}};if(x>65535&&w("filename too long",null),z)if(P<16e4)try{w(null,Jl(_,d))}catch(e){w(e,null)}else u.push(ql(_,d,w));else w(null,_)},d=0;d<l;++d)_(d);return h},zipSync:function(e,t){t||(t={});var n={},i=[];Pp(e,"",n,t);var r=0,o=0;for(var a in n){var s=n[a],l=s[0],p=s[1],u=0==p.level?0:8,h=(z=zp(a)).length,c=p.comment,_=c&&zp(c),d=_&&_.length,m=Cp(p.extra);if(h>65535)throw"filename too long";var P=u?Jl(l,p):l,f=P.length,x=Pl();x.p(l),i.push(yl(p,{size:l.length,crc:x.d(),c:P,f:z,m:_,u:h!=a.length||_&&c.length!=d,o:r,compression:u})),r+=30+h+m+f,o+=76+2*(h+m)+(d||0)+f}for(var y=new Cs(o+22),v=r,g=o-r,b=0;b<i.length;++b){var z=i[b];Np(y,z.o,z,z.f,z.u,z.c.length);var w=30+z.f.length+Cp(z.extra);y.set(z.c,z.o+w),Np(y,r,z,z.f,z.u,z.c.length,z.o,z.m),r+=16+w+(z.m?z.m.length:0)}return Ap(y,r,i.length,g,v),y},UnzipPassThrough:kp,UnzipInflate:Ip,AsyncUnzipInflate:Op,Unzip:Rp,unzip:function(e,t){if("function"!=typeof t)throw"no callback";for(var n=[],i=function(){for(var e=0;e<n.length;++e)n[e]()},r={},o=e.length-22;101010256!=Vl(e,o);--o)if(!o||e.length-o>65558)return void t("invalid zip file",null);var a=Tl(e,o+8);a||t(null,{});var s=a,l=Vl(e,o+16),p=4294967295==l;if(p){if(o=Vl(e,o-12),101075792!=Vl(e,o))return void t("invalid zip file",null);s=a=Vl(e,o+32),l=Vl(e,o+48)}for(var u=function(o){var s=Mp(e,l,p),u=s[0],h=s[1],c=s[2],_=s[3],d=s[4],m=s[5],P=Ep(e,m);l=d;var f=function(e,n){e?(i(),t(e,null)):(r[_]=n,--a||t(null,r))};if(u)if(8==u){var x=e.subarray(P,P+h);if(h<32e4)try{f(null,Kl(x,new Cs(c)))}catch(e){f(e,null)}else n.push(Yl(x,{size:c},f))}else f("unknown compression type "+u,null);else f(null,nl(e,P,P+h))},h=0;h<s;++h)u();return i},unzipSync:function(e){for(var t={},n=e.length-22;101010256!=Vl(e,n);--n)if(!n||e.length-n>65558)throw"invalid zip file";var i=Tl(e,n+8);if(!i)return{};var r=Vl(e,n+16),o=4294967295==r;if(o){if(n=Vl(e,n-12),101075792!=Vl(e,n))throw"invalid zip file";i=Vl(e,n+32),r=Vl(e,n+48)}for(var a=0;a<i;++a){var s=Mp(e,r,o),l=s[0],p=s[1],u=s[2],h=s[3],c=s[4],_=s[5],d=Ep(e,_);if(r=c,l){if(8!=l)throw"unknown compression type "+l;t[h]=Kl(e.subarray(d,d+p),new Cs(u))}else t[h]=nl(e,d,d+p)}return t}});function Fp(e,t,n){const i=n.length-e-1;if(t>=n[i])return i-1;if(t<=n[e])return e;let r=e,o=i,a=Math.floor((r+o)/2);for(;t<n[a]||t>=n[a+1];)t<n[a]?o=a:r=a,a=Math.floor((r+o)/2);return a}function Dp(e,t){let n=1;for(let t=2;t<=e;++t)n*=t;let i=1;for(let e=2;e<=t;++e)i*=e;for(let n=2;n<=e-t;++n)i*=n;return n/i}class Gp extends class{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(e,t){const n=this.getUtoTmapping(e);return this.getPoint(n,t)}getPoints(e=5){const t=[];for(let n=0;n<=e;n++)t.push(this.getPoint(n/e));return t}getSpacedPoints(e=5){const t=[];for(let n=0;n<=e;n++)t.push(this.getPointAt(n/e));return t}getLength(){const e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const t=[];let n,i=this.getPoint(0),r=0;t.push(0);for(let o=1;o<=e;o++)n=this.getPoint(o/e),r+=n.distanceTo(i),t.push(r),i=n;return this.cacheArcLengths=t,t}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,t){const n=this.getLengths();let i=0;const r=n.length;let o;o=t||e*n[r-1];let a,s=0,l=r-1;for(;s<=l;)if(i=Math.floor(s+(l-s)/2),a=n[i]-o,a<0)s=i+1;else{if(!(a>0)){l=i;break}l=i-1}if(i=l,n[i]===o)return i/(r-1);const p=n[i];return(i+(o-p)/(n[i+1]-p))/(r-1)}getTangent(e,t){const n=1e-4;let i=e-n,r=e+n;i<0&&(i=0),r>1&&(r=1);const o=this.getPoint(i),a=this.getPoint(r),s=t||(o.isVector2?new oi:new Ei);return s.copy(a).sub(o).normalize(),s}getTangentAt(e,t){const n=this.getUtoTmapping(e);return this.getTangent(n,t)}computeFrenetFrames(e,t){const n=new Ei,i=[],r=[],o=[],a=new Ei,s=new ir;for(let t=0;t<=e;t++){const n=t/e;i[t]=this.getTangentAt(n,new Ei)}r[0]=new Ei,o[0]=new Ei;let l=Number.MAX_VALUE;const p=Math.abs(i[0].x),u=Math.abs(i[0].y),h=Math.abs(i[0].z);p<=l&&(l=p,n.set(1,0,0)),u<=l&&(l=u,n.set(0,1,0)),h<=l&&n.set(0,0,1),a.crossVectors(i[0],n).normalize(),r[0].crossVectors(i[0],a),o[0].crossVectors(i[0],r[0]);for(let t=1;t<=e;t++){if(r[t]=r[t-1].clone(),o[t]=o[t-1].clone(),a.crossVectors(i[t-1],i[t]),a.length()>Number.EPSILON){a.normalize();const e=Math.acos(ei(i[t-1].dot(i[t]),-1,1));r[t].applyMatrix4(s.makeRotationAxis(a,e))}o[t].crossVectors(i[t],r[t])}if(!0===t){let t=Math.acos(ei(r[0].dot(r[e]),-1,1));t/=e,i[0].dot(a.crossVectors(r[0],r[e]))>0&&(t=-t);for(let n=1;n<=e;n++)r[n].applyMatrix4(s.makeRotationAxis(i[n],t*n)),o[n].crossVectors(i[n],r[n])}return{tangents:i,normals:r,binormals:o}}clone(){return(new this.constructor).copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){const e={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}{constructor(e,t,n,i,r){super(),this.degree=e,this.knots=t,this.controlPoints=[],this.startKnot=i||0,this.endKnot=r||this.knots.length-1;for(let e=0;e<n.length;++e){const t=n[e];this.controlPoints[e]=new wi(t.x,t.y,t.z,t.w)}}getPoint(e,t=new Ei){const n=t,i=this.knots[this.startKnot]+e*(this.knots[this.endKnot]-this.knots[this.startKnot]),r=function(e,t,n,i){const r=Fp(e,i,t),o=function(e,t,n,i){const r=[],o=[],a=[];r[0]=1;for(let s=1;s<=n;++s){o[s]=t-i[e+1-s],a[s]=i[e+s]-t;let n=0;for(let e=0;e<s;++e){const t=a[e+1],i=o[s-e],l=r[e]/(t+i);r[e]=n+t*l,n=i*l}r[s]=n}return r}(r,i,e,t),a=new wi(0,0,0,0);for(let t=0;t<=e;++t){const i=n[r-e+t],s=o[t],l=i.w*s;a.x+=i.x*l,a.y+=i.y*l,a.z+=i.z*l,a.w+=i.w*s}return a}(this.degree,this.knots,this.controlPoints,i);return 1!==r.w&&r.divideScalar(r.w),n.set(r.x,r.y,r.z)}getTangent(e,t=new Ei){const n=t,i=this.knots[0]+e*(this.knots[this.knots.length-1]-this.knots[0]),r=function(e,t,n,i,r){const o=function(e,t,n,i,r){const o=r<e?r:e,a=[],s=Fp(e,i,t),l=function(e,t,n,i,r){const o=[];for(let e=0;e<=n;++e)o[e]=0;const a=[];for(let e=0;e<=i;++e)a[e]=o.slice(0);const s=[];for(let e=0;e<=n;++e)s[e]=o.slice(0);s[0][0]=1;const l=o.slice(0),p=o.slice(0);for(let i=1;i<=n;++i){l[i]=t-r[e+1-i],p[i]=r[e+i]-t;let n=0;for(let e=0;e<i;++e){const t=p[e+1],r=l[i-e];s[i][e]=t+r;const o=s[e][i-1]/s[i][e];s[e][i]=n+t*o,n=r*o}s[i][i]=n}for(let e=0;e<=n;++e)a[0][e]=s[e][n];for(let e=0;e<=n;++e){let t=0,r=1;const l=[];for(let e=0;e<=n;++e)l[e]=o.slice(0);l[0][0]=1;for(let o=1;o<=i;++o){let i=0;const p=e-o,u=n-o;e>=o&&(l[r][0]=l[t][0]/s[u+1][p],i=l[r][0]*s[p][u]);const h=e-1<=u?o-1:n-e;for(let e=p>=-1?1:-p;e<=h;++e)l[r][e]=(l[t][e]-l[t][e-1])/s[u+1][p+e],i+=l[r][e]*s[p+e][u];e<=u&&(l[r][o]=-l[t][o-1]/s[u+1][e],i+=l[r][o]*s[e][u]),a[o][e]=i;const c=t;t=r,r=c}}let u=n;for(let e=1;e<=i;++e){for(let t=0;t<=n;++t)a[e][t]*=u;u*=n-e}return a}(s,i,e,o,t),p=[];for(let e=0;e<n.length;++e){const t=n[e].clone(),i=t.w;t.x*=i,t.y*=i,t.z*=i,p[e]=t}for(let t=0;t<=o;++t){const n=p[s-e].clone().multiplyScalar(l[t][0]);for(let i=1;i<=e;++i)n.add(p[s-e+i].clone().multiplyScalar(l[t][i]));a[t]=n}for(let e=o+1;e<=r+1;++e)a[e]=new wi(0,0,0);return a}(e,t,n,i,r);return function(e){const t=e.length,n=[],i=[];for(let r=0;r<t;++r){const t=e[r];n[r]=new Ei(t.x,t.y,t.z),i[r]=t.w}const r=[];for(let e=0;e<t;++e){const t=n[e].clone();for(let n=1;n<=e;++n)t.sub(r[e-n].clone().multiplyScalar(Dp(e,n)*i[n]));r[e]=t.divideScalar(i[0])}return r}(o)}(this.degree,this.knots,this.controlPoints,i,1);return n.copy(r[1]).normalize(),n}}let Up,jp,Wp;class qp extends Fa{constructor(e){super(e)}load(e,t,n,i){const r=this,o=""===r.path?ss.extractUrlBase(e):r.path,a=new Ga(this.manager);a.setPath(r.path),a.setResponseType("arraybuffer"),a.setRequestHeader(r.requestHeader),a.setWithCredentials(r.withCredentials),a.load(e,(function(n){try{t(r.parse(n,o))}catch(t){i?i(t):console.error(t),r.manager.itemError(e)}}),n,i)}parse(e,t){if(function(e){const t="Kaydara FBX Binary  \0";return e.byteLength>=t.length&&t===uu(e,0,t.length)}(e))Up=(new Kp).parse(e);else{const t=uu(e);if(!function(e){const t=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"];let n=0;function i(t){const i=e[t-1];return e=e.slice(n+t),n++,i}for(let e=0;e<t.length;++e)if(i(1)===t[e])return!1;return!0}(t))throw new Error("THREE.FBXLoader: Unknown format.");if(tu(t)<7e3)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+tu(t));Up=(new Yp).parse(t)}const n=new ja(this.manager).setPath(this.resourcePath||t).setCrossOrigin(this.crossOrigin);return new Jp(n,this.manager).parse(Up)}}class Jp{constructor(e,t){this.textureLoader=e,this.manager=t}parse(){jp=this.parseConnections();const e=this.parseImages(),t=this.parseTextures(e),n=this.parseMaterials(t),i=this.parseDeformers(),r=(new $p).parse(i);return this.parseScene(i,r,n),Wp}parseConnections(){const e=new Map;return"Connections"in Up&&Up.Connections.connections.forEach((function(t){const n=t[0],i=t[1],r=t[2];e.has(n)||e.set(n,{parents:[],children:[]});const o={ID:i,relationship:r};e.get(n).parents.push(o),e.has(i)||e.set(i,{parents:[],children:[]});const a={ID:n,relationship:r};e.get(i).children.push(a)})),e}parseImages(){const e={},t={};if("Video"in Up.Objects){const n=Up.Objects.Video;for(const i in n){const r=n[i];if(e[parseInt(i)]=r.RelativeFilename||r.Filename,"Content"in r){const e=r.Content instanceof ArrayBuffer&&r.Content.byteLength>0,o="string"==typeof r.Content&&""!==r.Content;if(e||o){const e=this.parseImage(n[i]);t[r.RelativeFilename||r.Filename]=e}}}}for(const n in e){const i=e[n];void 0!==t[i]?e[n]=t[i]:e[n]=e[n].split("\\").pop()}return e}parseImage(e){const t=e.Content,n=e.RelativeFilename||e.Filename,i=n.slice(n.lastIndexOf(".")+1).toLowerCase();let r;switch(i){case"bmp":r="image/bmp";break;case"jpg":case"jpeg":r="image/jpeg";break;case"png":r="image/png";break;case"tif":r="image/tiff";break;case"tga":null===this.manager.getHandler(".tga")&&console.warn("FBXLoader: TGA loader not found, skipping ",n),r="image/tga";break;default:return void console.warn('FBXLoader: Image type "'+i+'" is not supported.')}if("string"==typeof t)return"data:"+r+";base64,"+t;{const e=new Uint8Array(t);return window.URL.createObjectURL(new Blob([e],{type:r}))}}parseTextures(e){const t=new Map;if("Texture"in Up.Objects){const n=Up.Objects.Texture;for(const i in n){const r=this.parseTexture(n[i],e);t.set(parseInt(i),r)}}return t}parseTexture(e,t){const n=this.loadTexture(e,t);n.ID=e.id,n.name=e.attrName;const i=e.WrapModeU,r=e.WrapModeV,o=void 0!==i?i.value:0,a=void 0!==r?r.value:0;if(n.wrapS=0===o?kn:In,n.wrapT=0===a?kn:In,"Scaling"in e){const t=e.Scaling.value;n.repeat.x=t[0],n.repeat.y=t[1]}if("Translation"in e){const t=e.Translation.value;n.offset.x=t[0],n.offset.y=t[1]}return n}loadTexture(e,t){let n;const i=this.textureLoader.path,r=jp.get(e.id).children;let o;void 0!==r&&r.length>0&&void 0!==t[r[0].ID]&&(n=t[r[0].ID],0!==n.indexOf("blob:")&&0!==n.indexOf("data:")||this.textureLoader.setPath(void 0));const a=e.FileName.slice(-3).toLowerCase();if("tga"===a){const t=this.manager.getHandler(".tga");null===t?(console.warn("FBXLoader: TGA loader not found, creating placeholder texture for",e.RelativeFilename),o=new zi):(t.setPath(this.textureLoader.path),o=t.load(n))}else"psd"===a?(console.warn("FBXLoader: PSD textures are not supported, creating placeholder texture for",e.RelativeFilename),o=new zi):o=this.textureLoader.load(n);return this.textureLoader.setPath(i),o}parseMaterials(e){const t=new Map;if("Material"in Up.Objects){const n=Up.Objects.Material;for(const i in n){const r=this.parseMaterial(n[i],e);null!==r&&t.set(parseInt(i),r)}}return t}parseMaterial(e,t){const n=e.id,i=e.attrName;let r=e.ShadingModel;if("object"==typeof r&&(r=r.value),!jp.has(n))return null;const o=this.parseParameters(e,t,n);let a;switch(r.toLowerCase()){case"phong":a=new ga;break;case"lambert":a=new ba;break;default:console.warn('THREE.FBXLoader: unknown material type "%s". Defaulting to MeshPhongMaterial.',r),a=new ga}return a.setValues(o),a.name=i,a}parseParameters(e,t,n){const i={};e.BumpFactor&&(i.bumpScale=e.BumpFactor.value),e.Diffuse?i.color=(new xi).fromArray(e.Diffuse.value):!e.DiffuseColor||"Color"!==e.DiffuseColor.type&&"ColorRGB"!==e.DiffuseColor.type||(i.color=(new xi).fromArray(e.DiffuseColor.value)),e.DisplacementFactor&&(i.displacementScale=e.DisplacementFactor.value),e.Emissive?i.emissive=(new xi).fromArray(e.Emissive.value):!e.EmissiveColor||"Color"!==e.EmissiveColor.type&&"ColorRGB"!==e.EmissiveColor.type||(i.emissive=(new xi).fromArray(e.EmissiveColor.value)),e.EmissiveFactor&&(i.emissiveIntensity=parseFloat(e.EmissiveFactor.value)),e.Opacity&&(i.opacity=parseFloat(e.Opacity.value)),i.opacity<1&&(i.transparent=!0),e.ReflectionFactor&&(i.reflectivity=e.ReflectionFactor.value),e.Shininess&&(i.shininess=e.Shininess.value),e.Specular?i.specular=(new xi).fromArray(e.Specular.value):e.SpecularColor&&"Color"===e.SpecularColor.type&&(i.specular=(new xi).fromArray(e.SpecularColor.value));const r=this;return jp.get(n).children.forEach((function(e){const n=e.relationship;switch(n){case"Bump":i.bumpMap=r.getTexture(t,e.ID);break;case"Maya|TEX_ao_map":i.aoMap=r.getTexture(t,e.ID);break;case"DiffuseColor":case"Maya|TEX_color_map":i.map=r.getTexture(t,e.ID),void 0!==i.map&&(i.map.encoding=Gn);break;case"DisplacementColor":i.displacementMap=r.getTexture(t,e.ID);break;case"EmissiveColor":i.emissiveMap=r.getTexture(t,e.ID),void 0!==i.emissiveMap&&(i.emissiveMap.encoding=Gn);break;case"NormalMap":case"Maya|TEX_normal_map":i.normalMap=r.getTexture(t,e.ID);break;case"ReflectionColor":i.envMap=r.getTexture(t,e.ID),void 0!==i.envMap&&(i.envMap.mapping=303,i.envMap.encoding=Gn);break;case"SpecularColor":i.specularMap=r.getTexture(t,e.ID),void 0!==i.specularMap&&(i.specularMap.encoding=Gn);break;case"TransparentColor":case"TransparencyFactor":i.alphaMap=r.getTexture(t,e.ID),i.transparent=!0;break;default:console.warn("THREE.FBXLoader: %s map is not supported in three.js, skipping texture.",n)}})),i}getTexture(e,t){return"LayeredTexture"in Up.Objects&&t in Up.Objects.LayeredTexture&&(console.warn("THREE.FBXLoader: layered textures are not supported in three.js. Discarding all but first layer."),t=jp.get(t).children[0].ID),e.get(t)}parseDeformers(){const e={},t={};if("Deformer"in Up.Objects){const n=Up.Objects.Deformer;for(const i in n){const r=n[i],o=jp.get(parseInt(i));if("Skin"===r.attrType){const t=this.parseSkeleton(o,n);t.ID=i,o.parents.length>1&&console.warn("THREE.FBXLoader: skeleton attached to more than one geometry is not supported."),t.geometryID=o.parents[0].ID,e[i]=t}else if("BlendShape"===r.attrType){const e={id:i};e.rawTargets=this.parseMorphTargets(o,n),e.id=i,o.parents.length>1&&console.warn("THREE.FBXLoader: morph target attached to more than one geometry is not supported."),t[i]=e}}}return{skeletons:e,morphTargets:t}}parseSkeleton(e,t){const n=[];return e.children.forEach((function(e){const i=t[e.ID];if("Cluster"!==i.attrType)return;const r={ID:e.ID,indices:[],weights:[],transformLink:(new ir).fromArray(i.TransformLink.a)};"Indexes"in i&&(r.indices=i.Indexes.a,r.weights=i.Weights.a),n.push(r)})),{rawBones:n,bones:[]}}parseMorphTargets(e,t){const n=[];for(let i=0;i<e.children.length;i++){const r=e.children[i],o=t[r.ID],a={name:o.attrName,initialWeight:o.DeformPercent,id:o.id,fullWeights:o.FullWeights.a};if("BlendShapeChannel"!==o.attrType)return;a.geoID=jp.get(parseInt(r.ID)).children.filter((function(e){return void 0===e.relationship}))[0].ID,n.push(a)}return n}parseScene(e,t,n){Wp=new Ho;const i=this.parseModels(e.skeletons,t,n),r=Up.Objects.Model,o=this;i.forEach((function(e){const t=r[e.ID];o.setLookAtProperties(e,t),jp.get(e.ID).parents.forEach((function(t){const n=i.get(t.ID);void 0!==n&&n.add(e)})),null===e.parent&&Wp.add(e)})),this.bindSkeleton(e.skeletons,t,i),this.createAmbientLight(),Wp.traverse((function(e){if(e.userData.transformData){e.parent&&(e.userData.transformData.parentMatrix=e.parent.matrix,e.userData.transformData.parentMatrixWorld=e.parent.matrixWorld);const t=su(e.userData.transformData);e.applyMatrix4(t),e.updateWorldMatrix()}}));const a=(new Xp).parse();1===Wp.children.length&&Wp.children[0].isGroup&&(Wp.children[0].animations=a,Wp=Wp.children[0]),Wp.animations=a}parseModels(e,t,n){const i=new Map,r=Up.Objects.Model;for(const o in r){const a=parseInt(o),s=r[o],l=jp.get(a);let p=this.buildSkeleton(l,e,a,s.attrName);if(!p){switch(s.attrType){case"Camera":p=this.createCamera(l);break;case"Light":p=this.createLight(l);break;case"Mesh":p=this.createMesh(l,t,n);break;case"NurbsCurve":p=this.createCurve(l,t);break;case"LimbNode":case"Root":p=new Xo;break;default:p=new Ho}p.name=s.attrName?vs.sanitizeNodeName(s.attrName):"",p.ID=a}this.getTransformData(p,s),i.set(a,p)}return i}buildSkeleton(e,t,n,i){let r=null;return e.parents.forEach((function(e){for(const o in t){const a=t[o];a.rawBones.forEach((function(t,o){if(t.ID===e.ID){const e=r;r=new Xo,r.matrixWorld.copy(t.transformLink),r.name=i?vs.sanitizeNodeName(i):"",r.ID=n,a.bones[o]=r,null!==e&&r.add(e)}}))}})),r}createCamera(e){let t,n;if(e.children.forEach((function(e){const t=Up.Objects.NodeAttribute[e.ID];void 0!==t&&(n=t)})),void 0===n)t=new Sr;else{let e=0;void 0!==n.CameraProjectionType&&1===n.CameraProjectionType.value&&(e=1);let i=1;void 0!==n.NearPlane&&(i=n.NearPlane.value/1e3);let r=1e3;void 0!==n.FarPlane&&(r=n.FarPlane.value/1e3);let o=window.innerWidth,a=window.innerHeight;void 0!==n.AspectWidth&&void 0!==n.AspectHeight&&(o=n.AspectWidth.value,a=n.AspectHeight.value);const s=o/a;let l=45;void 0!==n.FieldOfView&&(l=n.FieldOfView.value);const p=n.FocalLength?n.FocalLength.value:null;switch(e){case 0:t=new Mo(l,s,i,r),null!==p&&t.setFocalLength(p);break;case 1:t=new Ro(-o/2,o/2,a/2,-a/2,i,r);break;default:console.warn("THREE.FBXLoader: Unknown camera type "+e+"."),t=new Sr}}return t}createLight(e){let t,n;if(e.children.forEach((function(e){const t=Up.Objects.NodeAttribute[e.ID];void 0!==t&&(n=t)})),void 0===n)t=new Sr;else{let e;e=void 0===n.LightType?0:n.LightType.value;let i=16777215;void 0!==n.Color&&(i=(new xi).fromArray(n.Color.value));let r=void 0===n.Intensity?1:n.Intensity.value/100;void 0!==n.CastLightOnObject&&0===n.CastLightOnObject.value&&(r=0);let o=0;void 0!==n.FarAttenuationEnd&&(o=void 0!==n.EnableFarAttenuation&&0===n.EnableFarAttenuation.value?0:n.FarAttenuationEnd.value);const a=1;switch(e){case 0:t=new is(i,r,o,a);break;case 1:t=new os(i,r);break;case 2:let e=Math.PI/3;void 0!==n.InnerAngle&&(e=ri.degToRad(n.InnerAngle.value));let s=0;void 0!==n.OuterAngle&&(s=ri.degToRad(n.OuterAngle.value),s=Math.max(s,1)),t=new Ka(i,r,o,e,s,a);break;default:console.warn("THREE.FBXLoader: Unknown light type "+n.LightType.value+", defaulting to a PointLight."),t=new is(i,r)}void 0!==n.CastShadows&&1===n.CastShadows.value&&(t.castShadow=!0)}return t}createMesh(e,t,n){let i,r=null,o=null;const a=[];return e.children.forEach((function(e){t.has(e.ID)&&(r=t.get(e.ID)),n.has(e.ID)&&a.push(n.get(e.ID))})),a.length>1?o=a:a.length>0?o=a[0]:(o=new ga({color:13421772}),a.push(o)),"color"in r.attributes&&a.forEach((function(e){e.vertexColors=!0})),r.FBX_Deformer?(i=new $o(r,o),i.normalizeSkinWeights()):i=new go(r,o),i}createCurve(e,t){const n=e.children.reduce((function(e,n){return t.has(n.ID)&&(e=t.get(n.ID)),e}),null),i=new ta({color:3342591,linewidth:1});return new sa(n,i)}getTransformData(e,t){const n={};"InheritType"in t&&(n.inheritType=parseInt(t.InheritType.value)),n.eulerOrder="RotationOrder"in t?lu(t.RotationOrder.value):"ZYX","Lcl_Translation"in t&&(n.translation=t.Lcl_Translation.value),"PreRotation"in t&&(n.preRotation=t.PreRotation.value),"Lcl_Rotation"in t&&(n.rotation=t.Lcl_Rotation.value),"PostRotation"in t&&(n.postRotation=t.PostRotation.value),"Lcl_Scaling"in t&&(n.scale=t.Lcl_Scaling.value),"ScalingOffset"in t&&(n.scalingOffset=t.ScalingOffset.value),"ScalingPivot"in t&&(n.scalingPivot=t.ScalingPivot.value),"RotationOffset"in t&&(n.rotationOffset=t.RotationOffset.value),"RotationPivot"in t&&(n.rotationPivot=t.RotationPivot.value),e.userData.transformData=n}setLookAtProperties(e,t){"LookAtProperty"in t&&jp.get(e.ID).children.forEach((function(t){if("LookAtProperty"===t.relationship){const n=Up.Objects.Model[t.ID];if("Lcl_Translation"in n){const t=n.Lcl_Translation.value;void 0!==e.target?(e.target.position.fromArray(t),Wp.add(e.target)):e.lookAt((new Ei).fromArray(t))}}}))}bindSkeleton(e,t,n){const i=this.parsePoseNodes();for(const r in e){const o=e[r];jp.get(parseInt(o.ID)).parents.forEach((function(e){if(t.has(e.ID)){const t=e.ID;jp.get(t).parents.forEach((function(e){n.has(e.ID)&&n.get(e.ID).bind(new ea(o.bones),i[e.ID])}))}}))}}parsePoseNodes(){const e={};if("Pose"in Up.Objects){const t=Up.Objects.Pose;for(const n in t)if("BindPose"===t[n].attrType&&t[n].NbPoseNodes>0){const i=t[n].PoseNode;Array.isArray(i)?i.forEach((function(t){e[t.Node]=(new ir).fromArray(t.Matrix.a)})):e[i.Node]=(new ir).fromArray(i.Matrix.a)}}return e}createAmbientLight(){if("GlobalSettings"in Up&&"AmbientColor"in Up.GlobalSettings){const e=Up.GlobalSettings.AmbientColor.value,t=e[0],n=e[1],i=e[2];if(0!==t||0!==n||0!==i){const e=new xi(t,n,i);Wp.add(new as(e,1))}}}}class $p{parse(e){const t=new Map;if("Geometry"in Up.Objects){const n=Up.Objects.Geometry;for(const i in n){const r=jp.get(parseInt(i)),o=this.parseGeometry(r,n[i],e);t.set(parseInt(i),o)}}return t}parseGeometry(e,t,n){switch(t.attrType){case"Mesh":return this.parseMeshGeometry(e,t,n);case"NurbsCurve":return this.parseNurbsGeometry(t)}}parseMeshGeometry(e,t,n){const i=n.skeletons,r=[],o=e.parents.map((function(e){return Up.Objects.Model[e.ID]}));if(0===o.length)return;const a=e.children.reduce((function(e,t){return void 0!==i[t.ID]&&(e=i[t.ID]),e}),null);e.children.forEach((function(e){void 0!==n.morphTargets[e.ID]&&r.push(n.morphTargets[e.ID])}));const s=o[0],l={};"RotationOrder"in s&&(l.eulerOrder=lu(s.RotationOrder.value)),"InheritType"in s&&(l.inheritType=parseInt(s.InheritType.value)),"GeometricTranslation"in s&&(l.translation=s.GeometricTranslation.value),"GeometricRotation"in s&&(l.rotation=s.GeometricRotation.value),"GeometricScaling"in s&&(l.scale=s.GeometricScaling.value);const p=su(l);return this.genGeometry(t,a,r,p)}genGeometry(e,t,n,i){const r=new no;e.attrName&&(r.name=e.attrName);const o=this.parseGeoNode(e,t),a=this.genBuffers(o),s=new Jr(a.vertex,3);if(s.applyMatrix4(i),r.setAttribute("position",s),a.colors.length>0&&r.setAttribute("color",new Jr(a.colors,3)),t&&(r.setAttribute("skinIndex",new Wr(a.weightsIndices,4)),r.setAttribute("skinWeight",new Jr(a.vertexWeights,4)),r.FBX_Deformer=t),a.normal.length>0){const e=(new ai).getNormalMatrix(i),t=new Jr(a.normal,3);t.applyNormalMatrix(e),r.setAttribute("normal",t)}if(a.uvs.forEach((function(e,t){let n="uv"+(t+1).toString();0===t&&(n="uv"),r.setAttribute(n,new Jr(a.uvs[t],2))})),o.material&&"AllSame"!==o.material.mappingType){let e=a.materialIndex[0],t=0;if(a.materialIndex.forEach((function(n,i){n!==e&&(r.addGroup(t,i-t,e),e=n,t=i)})),r.groups.length>0){const t=r.groups[r.groups.length-1],n=t.start+t.count;n!==a.materialIndex.length&&r.addGroup(n,a.materialIndex.length-n,e)}0===r.groups.length&&r.addGroup(0,a.materialIndex.length,a.materialIndex[0])}return this.addMorphTargets(r,e,n,i),r}parseGeoNode(e,t){const n={};if(n.vertexPositions=void 0!==e.Vertices?e.Vertices.a:[],n.vertexIndices=void 0!==e.PolygonVertexIndex?e.PolygonVertexIndex.a:[],e.LayerElementColor&&(n.color=this.parseVertexColors(e.LayerElementColor[0])),e.LayerElementMaterial&&(n.material=this.parseMaterialIndices(e.LayerElementMaterial[0])),e.LayerElementNormal&&(n.normal=this.parseNormals(e.LayerElementNormal[0])),e.LayerElementUV){n.uv=[];let t=0;for(;e.LayerElementUV[t];)e.LayerElementUV[t].UV&&n.uv.push(this.parseUVs(e.LayerElementUV[t])),t++}return n.weightTable={},null!==t&&(n.skeleton=t,t.rawBones.forEach((function(e,t){e.indices.forEach((function(i,r){void 0===n.weightTable[i]&&(n.weightTable[i]=[]),n.weightTable[i].push({id:t,weight:e.weights[r]})}))}))),n}genBuffers(e){const t={vertex:[],normal:[],colors:[],uvs:[],materialIndex:[],vertexWeights:[],weightsIndices:[]};let n=0,i=0,r=!1,o=[],a=[],s=[],l=[],p=[],u=[];const h=this;return e.vertexIndices.forEach((function(c,_){let d,m=!1;c<0&&(c^=-1,m=!0);let P=[],f=[];if(o.push(3*c,3*c+1,3*c+2),e.color){const t=ru(_,n,c,e.color);s.push(t[0],t[1],t[2])}if(e.skeleton){if(void 0!==e.weightTable[c]&&e.weightTable[c].forEach((function(e){f.push(e.weight),P.push(e.id)})),f.length>4){r||(console.warn("THREE.FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights."),r=!0);const e=[0,0,0,0],t=[0,0,0,0];f.forEach((function(n,i){let r=n,o=P[i];t.forEach((function(t,n,i){if(r>t){i[n]=r,r=t;const a=e[n];e[n]=o,o=a}}))})),P=e,f=t}for(;f.length<4;)f.push(0),P.push(0);for(let e=0;e<4;++e)p.push(f[e]),u.push(P[e])}if(e.normal){const t=ru(_,n,c,e.normal);a.push(t[0],t[1],t[2])}e.material&&"AllSame"!==e.material.mappingType&&(d=ru(_,n,c,e.material)[0]),e.uv&&e.uv.forEach((function(e,t){const i=ru(_,n,c,e);void 0===l[t]&&(l[t]=[]),l[t].push(i[0]),l[t].push(i[1])})),i++,m&&(h.genFace(t,e,o,d,a,s,l,p,u,i),n++,i=0,o=[],a=[],s=[],l=[],p=[],u=[])})),t}genFace(e,t,n,i,r,o,a,s,l,p){for(let u=2;u<p;u++)e.vertex.push(t.vertexPositions[n[0]]),e.vertex.push(t.vertexPositions[n[1]]),e.vertex.push(t.vertexPositions[n[2]]),e.vertex.push(t.vertexPositions[n[3*(u-1)]]),e.vertex.push(t.vertexPositions[n[3*(u-1)+1]]),e.vertex.push(t.vertexPositions[n[3*(u-1)+2]]),e.vertex.push(t.vertexPositions[n[3*u]]),e.vertex.push(t.vertexPositions[n[3*u+1]]),e.vertex.push(t.vertexPositions[n[3*u+2]]),t.skeleton&&(e.vertexWeights.push(s[0]),e.vertexWeights.push(s[1]),e.vertexWeights.push(s[2]),e.vertexWeights.push(s[3]),e.vertexWeights.push(s[4*(u-1)]),e.vertexWeights.push(s[4*(u-1)+1]),e.vertexWeights.push(s[4*(u-1)+2]),e.vertexWeights.push(s[4*(u-1)+3]),e.vertexWeights.push(s[4*u]),e.vertexWeights.push(s[4*u+1]),e.vertexWeights.push(s[4*u+2]),e.vertexWeights.push(s[4*u+3]),e.weightsIndices.push(l[0]),e.weightsIndices.push(l[1]),e.weightsIndices.push(l[2]),e.weightsIndices.push(l[3]),e.weightsIndices.push(l[4*(u-1)]),e.weightsIndices.push(l[4*(u-1)+1]),e.weightsIndices.push(l[4*(u-1)+2]),e.weightsIndices.push(l[4*(u-1)+3]),e.weightsIndices.push(l[4*u]),e.weightsIndices.push(l[4*u+1]),e.weightsIndices.push(l[4*u+2]),e.weightsIndices.push(l[4*u+3])),t.color&&(e.colors.push(o[0]),e.colors.push(o[1]),e.colors.push(o[2]),e.colors.push(o[3*(u-1)]),e.colors.push(o[3*(u-1)+1]),e.colors.push(o[3*(u-1)+2]),e.colors.push(o[3*u]),e.colors.push(o[3*u+1]),e.colors.push(o[3*u+2])),t.material&&"AllSame"!==t.material.mappingType&&(e.materialIndex.push(i),e.materialIndex.push(i),e.materialIndex.push(i)),t.normal&&(e.normal.push(r[0]),e.normal.push(r[1]),e.normal.push(r[2]),e.normal.push(r[3*(u-1)]),e.normal.push(r[3*(u-1)+1]),e.normal.push(r[3*(u-1)+2]),e.normal.push(r[3*u]),e.normal.push(r[3*u+1]),e.normal.push(r[3*u+2])),t.uv&&t.uv.forEach((function(t,n){void 0===e.uvs[n]&&(e.uvs[n]=[]),e.uvs[n].push(a[n][0]),e.uvs[n].push(a[n][1]),e.uvs[n].push(a[n][2*(u-1)]),e.uvs[n].push(a[n][2*(u-1)+1]),e.uvs[n].push(a[n][2*u]),e.uvs[n].push(a[n][2*u+1])}))}addMorphTargets(e,t,n,i){if(0===n.length)return;e.morphTargetsRelative=!0,e.morphAttributes.position=[];const r=this;n.forEach((function(n){n.rawTargets.forEach((function(n){const o=Up.Objects.Geometry[n.geoID];void 0!==o&&r.genMorphGeometry(e,t,o,i,n.name)}))}))}genMorphGeometry(e,t,n,i,r){const o=void 0!==t.PolygonVertexIndex?t.PolygonVertexIndex.a:[],a=void 0!==n.Vertices?n.Vertices.a:[],s=void 0!==n.Indexes?n.Indexes.a:[],l=3*e.attributes.position.count,p=new Float32Array(l);for(let e=0;e<s.length;e++){const t=3*s[e];p[t]=a[3*e],p[t+1]=a[3*e+1],p[t+2]=a[3*e+2]}const u={vertexIndices:o,vertexPositions:p},h=this.genBuffers(u),c=new Jr(h.vertex,3);c.name=r||n.attrName,c.applyMatrix4(i),e.morphAttributes.position.push(c)}parseNormals(e){const t=e.MappingInformationType,n=e.ReferenceInformationType,i=e.Normals.a;let r=[];return"IndexToDirect"===n&&("NormalIndex"in e?r=e.NormalIndex.a:"NormalsIndex"in e&&(r=e.NormalsIndex.a)),{dataSize:3,buffer:i,indices:r,mappingType:t,referenceType:n}}parseUVs(e){const t=e.MappingInformationType,n=e.ReferenceInformationType,i=e.UV.a;let r=[];return"IndexToDirect"===n&&(r=e.UVIndex.a),{dataSize:2,buffer:i,indices:r,mappingType:t,referenceType:n}}parseVertexColors(e){const t=e.MappingInformationType,n=e.ReferenceInformationType,i=e.Colors.a;let r=[];return"IndexToDirect"===n&&(r=e.ColorIndex.a),{dataSize:4,buffer:i,indices:r,mappingType:t,referenceType:n}}parseMaterialIndices(e){const t=e.MappingInformationType,n=e.ReferenceInformationType;if("NoMappingInformation"===t)return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:n};const i=e.Materials.a,r=[];for(let e=0;e<i.length;++e)r.push(e);return{dataSize:1,buffer:i,indices:r,mappingType:t,referenceType:n}}parseNurbsGeometry(e){if(void 0===Gp)return console.error("THREE.FBXLoader: The loader relies on NURBSCurve for any nurbs present in the model. Nurbs will show up as empty geometry."),new no;const t=parseInt(e.Order);if(isNaN(t))return console.error("THREE.FBXLoader: Invalid Order %s given for geometry ID: %s",e.Order,e.id),new no;const n=t-1,i=e.KnotVector.a,r=[],o=e.Points.a;for(let e=0,t=o.length;e<t;e+=4)r.push((new wi).fromArray(o,e));let a,s;if("Closed"===e.Form)r.push(r[0]);else if("Periodic"===e.Form){a=n,s=i.length-1-a;for(let e=0;e<n;++e)r.push(r[e])}const l=new Gp(n,i,r,a,s).getPoints(12*r.length);return(new no).setFromPoints(l)}}class Xp{parse(){const e=[],t=this.parseClips();if(void 0!==t)for(const n in t){const i=t[n],r=this.addClip(i);e.push(r)}return e}parseClips(){if(void 0===Up.Objects.AnimationCurve)return;const e=this.parseAnimationCurveNodes();this.parseAnimationCurves(e);const t=this.parseAnimationLayers(e);return this.parseAnimStacks(t)}parseAnimationCurveNodes(){const e=Up.Objects.AnimationCurveNode,t=new Map;for(const n in e){const i=e[n];if(null!==i.attrName.match(/S|R|T|DeformPercent/)){const e={id:i.id,attr:i.attrName,curves:{}};t.set(e.id,e)}}return t}parseAnimationCurves(e){const t=Up.Objects.AnimationCurve;for(const n in t){const i={id:t[n].id,times:t[n].KeyTime.a.map(nu),values:t[n].KeyValueFloat.a},r=jp.get(i.id);if(void 0!==r){const t=r.parents[0].ID,n=r.parents[0].relationship;n.match(/X/)?e.get(t).curves.x=i:n.match(/Y/)?e.get(t).curves.y=i:n.match(/Z/)?e.get(t).curves.z=i:n.match(/d|DeformPercent/)&&e.has(t)&&(e.get(t).curves.morph=i)}}}parseAnimationLayers(e){const t=Up.Objects.AnimationLayer,n=new Map;for(const i in t){const t=[],r=jp.get(parseInt(i));void 0!==r&&(r.children.forEach((function(n,i){if(e.has(n.ID)){const r=e.get(n.ID);if(void 0!==r.curves.x||void 0!==r.curves.y||void 0!==r.curves.z){if(void 0===t[i]){const e=jp.get(n.ID).parents.filter((function(e){return void 0!==e.relationship}))[0].ID;if(void 0!==e){const r=Up.Objects.Model[e.toString()];if(void 0===r)return void console.warn("THREE.FBXLoader: Encountered a unused curve.",n);const o={modelName:r.attrName?vs.sanitizeNodeName(r.attrName):"",ID:r.id,initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1]};Wp.traverse((function(e){e.ID===r.id&&(o.transform=e.matrix,e.userData.transformData&&(o.eulerOrder=e.userData.transformData.eulerOrder))})),o.transform||(o.transform=new ir),"PreRotation"in r&&(o.preRotation=r.PreRotation.value),"PostRotation"in r&&(o.postRotation=r.PostRotation.value),t[i]=o}}t[i]&&(t[i][r.attr]=r)}else if(void 0!==r.curves.morph){if(void 0===t[i]){const e=jp.get(n.ID).parents.filter((function(e){return void 0!==e.relationship}))[0].ID,r=jp.get(e).parents[0].ID,o=jp.get(r).parents[0].ID,a=jp.get(o).parents[0].ID,s=Up.Objects.Model[a],l={modelName:s.attrName?vs.sanitizeNodeName(s.attrName):"",morphName:Up.Objects.Deformer[e].attrName};t[i]=l}t[i][r.attr]=r}}})),n.set(parseInt(i),t))}return n}parseAnimStacks(e){const t=Up.Objects.AnimationStack,n={};for(const i in t){const r=jp.get(parseInt(i)).children;r.length>1&&console.warn("THREE.FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers.");const o=e.get(r[0].ID);n[i]={name:t[i].attrName,layer:o}}return n}addClip(e){let t=[];const n=this;return e.layer.forEach((function(e){t=t.concat(n.generateTracks(e))})),new Ia(e.name,-1,t)}generateTracks(e){const t=[];let n=new Ei,i=new Zi,r=new Ei;if(e.transform&&e.transform.decompose(n,i,r),n=n.toArray(),i=(new _r).setFromQuaternion(i,e.eulerOrder).toArray(),r=r.toArray(),void 0!==e.T&&Object.keys(e.T.curves).length>0){const i=this.generateVectorTrack(e.modelName,e.T.curves,n,"position");void 0!==i&&t.push(i)}if(void 0!==e.R&&Object.keys(e.R.curves).length>0){const n=this.generateRotationTrack(e.modelName,e.R.curves,i,e.preRotation,e.postRotation,e.eulerOrder);void 0!==n&&t.push(n)}if(void 0!==e.S&&Object.keys(e.S.curves).length>0){const n=this.generateVectorTrack(e.modelName,e.S.curves,r,"scale");void 0!==n&&t.push(n)}if(void 0!==e.DeformPercent){const n=this.generateMorphTrack(e);void 0!==n&&t.push(n)}return t}generateVectorTrack(e,t,n,i){const r=this.getTimesForAllAxes(t),o=this.getKeyframeTrackValues(r,t,n);return new ka(e+"."+i,r,o)}generateRotationTrack(e,t,n,i,r,o){void 0!==t.x&&(this.interpolateRotations(t.x),t.x.values=t.x.values.map(ri.degToRad)),void 0!==t.y&&(this.interpolateRotations(t.y),t.y.values=t.y.values.map(ri.degToRad)),void 0!==t.z&&(this.interpolateRotations(t.z),t.z.values=t.z.values.map(ri.degToRad));const a=this.getTimesForAllAxes(t),s=this.getKeyframeTrackValues(a,t,n);void 0!==i&&((i=i.map(ri.degToRad)).push(o),i=(new _r).fromArray(i),i=(new Zi).setFromEuler(i)),void 0!==r&&((r=r.map(ri.degToRad)).push(o),r=(new _r).fromArray(r),r=(new Zi).setFromEuler(r).invert());const l=new Zi,p=new _r,u=[];for(let e=0;e<s.length;e+=3)p.set(s[e],s[e+1],s[e+2],o),l.setFromEuler(p),void 0!==i&&l.premultiply(i),void 0!==r&&l.multiply(r),l.toArray(u,e/3*4);return new Ta(e+".quaternion",a,u)}generateMorphTrack(e){const t=e.DeformPercent.curves.morph,n=t.values.map((function(e){return e/100})),i=Wp.getObjectByName(e.modelName).morphTargetDictionary[e.morphName];return new La(e.modelName+".morphTargetInfluences["+i+"]",t.times,n)}getTimesForAllAxes(e){let t=[];if(void 0!==e.x&&(t=t.concat(e.x.times)),void 0!==e.y&&(t=t.concat(e.y.times)),void 0!==e.z&&(t=t.concat(e.z.times)),t=t.sort((function(e,t){return e-t})),t.length>1){let e=1,n=t[0];for(let i=1;i<t.length;i++){const r=t[i];r!==n&&(t[e]=r,n=r,e++)}t=t.slice(0,e)}return t}getKeyframeTrackValues(e,t,n){const i=n,r=[];let o=-1,a=-1,s=-1;return e.forEach((function(e){if(t.x&&(o=t.x.times.indexOf(e)),t.y&&(a=t.y.times.indexOf(e)),t.z&&(s=t.z.times.indexOf(e)),-1!==o){const e=t.x.values[o];r.push(e),i[0]=e}else r.push(i[0]);if(-1!==a){const e=t.y.values[a];r.push(e),i[1]=e}else r.push(i[1]);if(-1!==s){const e=t.z.values[s];r.push(e),i[2]=e}else r.push(i[2])})),r}interpolateRotations(e){for(let t=1;t<e.values.length;t++){const n=e.values[t-1],i=e.values[t]-n,r=Math.abs(i);if(r>=180){const o=r/180,a=i/o;let s=n+a;const l=e.times[t-1],p=(e.times[t]-l)/o;let u=l+p;const h=[],c=[];for(;u<e.times[t];)h.push(u),u+=p,c.push(s),s+=a;e.times=hu(e.times,t,h),e.values=hu(e.values,t,c)}}}}class Yp{getPrevNode(){return this.nodeStack[this.currentIndent-2]}getCurrentNode(){return this.nodeStack[this.currentIndent-1]}getCurrentProp(){return this.currentProp}pushStack(e){this.nodeStack.push(e),this.currentIndent+=1}popStack(){this.nodeStack.pop(),this.currentIndent-=1}setCurrentProp(e,t){this.currentProp=e,this.currentPropName=t}parse(e){this.currentIndent=0,this.allNodes=new eu,this.nodeStack=[],this.currentProp=[],this.currentPropName="";const t=this,n=e.split(/[\r\n]+/);return n.forEach((function(e,i){const r=e.match(/^[\s\t]*;/),o=e.match(/^[\s\t]*$/);if(r||o)return;const a=e.match("^\\t{"+t.currentIndent+"}(\\w+):(.*){",""),s=e.match("^\\t{"+t.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),l=e.match("^\\t{"+(t.currentIndent-1)+"}}");a?t.parseNodeBegin(e,a):s?t.parseNodeProperty(e,s,n[++i]):l?t.popStack():e.match(/^[^\s\t}]/)&&t.parseNodePropertyContinued(e)})),this.allNodes}parseNodeBegin(e,t){const n=t[1].trim().replace(/^"/,"").replace(/"$/,""),i=t[2].split(",").map((function(e){return e.trim().replace(/^"/,"").replace(/"$/,"")})),r={name:n},o=this.parseNodeAttr(i),a=this.getCurrentNode();0===this.currentIndent?this.allNodes.add(n,r):n in a?("PoseNode"===n?a.PoseNode.push(r):void 0!==a[n].id&&(a[n]={},a[n][a[n].id]=a[n]),""!==o.id&&(a[n][o.id]=r)):"number"==typeof o.id?(a[n]={},a[n][o.id]=r):"Properties70"!==n&&(a[n]="PoseNode"===n?[r]:r),"number"==typeof o.id&&(r.id=o.id),""!==o.name&&(r.attrName=o.name),""!==o.type&&(r.attrType=o.type),this.pushStack(r)}parseNodeAttr(e){let t=e[0];""!==e[0]&&(t=parseInt(e[0]),isNaN(t)&&(t=e[0]));let n="",i="";return e.length>1&&(n=e[1].replace(/^(\w+)::/,""),i=e[2]),{id:t,name:n,type:i}}parseNodeProperty(e,t,n){let i=t[1].replace(/^"/,"").replace(/"$/,"").trim(),r=t[2].replace(/^"/,"").replace(/"$/,"").trim();"Content"===i&&","===r&&(r=n.replace(/"/g,"").replace(/,$/,"").trim());const o=this.getCurrentNode();if("Properties70"!==o.name){if("C"===i){const e=r.split(",").slice(1),t=parseInt(e[0]),n=parseInt(e[1]);let a=r.split(",").slice(3);a=a.map((function(e){return e.trim().replace(/^"/,"")})),i="connections",r=[t,n],function(e,t){for(let n=0,i=e.length,r=t.length;n<r;n++,i++)e[i]=t[n]}(r,a),void 0===o[i]&&(o[i]=[])}"Node"===i&&(o.id=r),i in o&&Array.isArray(o[i])?o[i].push(r):"a"!==i?o[i]=r:o.a=r,this.setCurrentProp(o,i),"a"===i&&","!==r.slice(-1)&&(o.a=pu(r))}else this.parseNodeSpecialProperty(e,i,r)}parseNodePropertyContinued(e){const t=this.getCurrentNode();t.a+=e,","!==e.slice(-1)&&(t.a=pu(t.a))}parseNodeSpecialProperty(e,t,n){const i=n.split('",').map((function(e){return e.trim().replace(/^\"/,"").replace(/\s/,"_")})),r=i[0],o=i[1],a=i[2],s=i[3];let l=i[4];switch(o){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":l=parseFloat(l);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":l=pu(l)}this.getPrevNode()[r]={type:o,type2:a,flag:s,value:l},this.setCurrentProp(this.getPrevNode(),r)}}class Kp{parse(e){const t=new Qp(e);t.skip(23);const n=t.getUint32();if(n<6400)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+n);const i=new eu;for(;!this.endOfContent(t);){const e=this.parseNode(t,n);null!==e&&i.add(e.name,e)}return i}endOfContent(e){return e.size()%16==0?(e.getOffset()+160+16&-16)>=e.size():e.getOffset()+160+16>=e.size()}parseNode(e,t){const n={},i=t>=7500?e.getUint64():e.getUint32(),r=t>=7500?e.getUint64():e.getUint32();t>=7500?e.getUint64():e.getUint32();const o=e.getUint8(),a=e.getString(o);if(0===i)return null;const s=[];for(let t=0;t<r;t++)s.push(this.parseProperty(e));const l=s.length>0?s[0]:"",p=s.length>1?s[1]:"",u=s.length>2?s[2]:"";for(n.singleProperty=1===r&&e.getOffset()===i;i>e.getOffset();){const i=this.parseNode(e,t);null!==i&&this.parseSubNode(a,n,i)}return n.propertyList=s,"number"==typeof l&&(n.id=l),""!==p&&(n.attrName=p),""!==u&&(n.attrType=u),""!==a&&(n.name=a),n}parseSubNode(e,t,n){if(!0===n.singleProperty){const e=n.propertyList[0];Array.isArray(e)?(t[n.name]=n,n.a=e):t[n.name]=e}else if("Connections"===e&&"C"===n.name){const e=[];n.propertyList.forEach((function(t,n){0!==n&&e.push(t)})),void 0===t.connections&&(t.connections=[]),t.connections.push(e)}else if("Properties70"===n.name)Object.keys(n).forEach((function(e){t[e]=n[e]}));else if("Properties70"===e&&"P"===n.name){let e=n.propertyList[0],i=n.propertyList[1];const r=n.propertyList[2],o=n.propertyList[3];let a;0===e.indexOf("Lcl ")&&(e=e.replace("Lcl ","Lcl_")),0===i.indexOf("Lcl ")&&(i=i.replace("Lcl ","Lcl_")),a="Color"===i||"ColorRGB"===i||"Vector"===i||"Vector3D"===i||0===i.indexOf("Lcl_")?[n.propertyList[4],n.propertyList[5],n.propertyList[6]]:n.propertyList[4],t[e]={type:i,type2:r,flag:o,value:a}}else void 0===t[n.name]?"number"==typeof n.id?(t[n.name]={},t[n.name][n.id]=n):t[n.name]=n:"PoseNode"===n.name?(Array.isArray(t[n.name])||(t[n.name]=[t[n.name]]),t[n.name].push(n)):void 0===t[n.name][n.id]&&(t[n.name][n.id]=n)}parseProperty(e){const t=e.getString(1);let n;switch(t){case"C":return e.getBoolean();case"D":return e.getFloat64();case"F":return e.getFloat32();case"I":return e.getInt32();case"L":return e.getInt64();case"R":return n=e.getUint32(),e.getArrayBuffer(n);case"S":return n=e.getUint32(),e.getString(n);case"Y":return e.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":const i=e.getUint32(),r=e.getUint32(),o=e.getUint32();if(0===r)switch(t){case"b":case"c":return e.getBooleanArray(i);case"d":return e.getFloat64Array(i);case"f":return e.getFloat32Array(i);case"i":return e.getInt32Array(i);case"l":return e.getInt64Array(i)}void 0===Hp&&console.error("THREE.FBXLoader: External library fflate.min.js required.");const a=_p(new Uint8Array(e.getArrayBuffer(o))),s=new Qp(a.buffer);switch(t){case"b":case"c":return s.getBooleanArray(i);case"d":return s.getFloat64Array(i);case"f":return s.getFloat32Array(i);case"i":return s.getInt32Array(i);case"l":return s.getInt64Array(i)}break;default:throw new Error("THREE.FBXLoader: Unknown property type "+t)}}}class Qp{constructor(e,t){this.dv=new DataView(e),this.offset=0,this.littleEndian=void 0===t||t}getOffset(){return this.offset}size(){return this.dv.buffer.byteLength}skip(e){this.offset+=e}getBoolean(){return 1==(1&this.getUint8())}getBooleanArray(e){const t=[];for(let n=0;n<e;n++)t.push(this.getBoolean());return t}getUint8(){const e=this.dv.getUint8(this.offset);return this.offset+=1,e}getInt16(){const e=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,e}getInt32(){const e=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,e}getInt32Array(e){const t=[];for(let n=0;n<e;n++)t.push(this.getInt32());return t}getUint32(){const e=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,e}getInt64(){let e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),2147483648&t?(t=4294967295&~t,e=4294967295&~e,4294967295===e&&(t=t+1&4294967295),e=e+1&4294967295,-(4294967296*t+e)):4294967296*t+e}getInt64Array(e){const t=[];for(let n=0;n<e;n++)t.push(this.getInt64());return t}getUint64(){let e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),4294967296*t+e}getFloat32(){const e=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e}getFloat32Array(e){const t=[];for(let n=0;n<e;n++)t.push(this.getFloat32());return t}getFloat64(){const e=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e}getFloat64Array(e){const t=[];for(let n=0;n<e;n++)t.push(this.getFloat64());return t}getArrayBuffer(e){const t=this.dv.buffer.slice(this.offset,this.offset+e);return this.offset+=e,t}getString(e){let t=[];for(let n=0;n<e;n++)t[n]=this.getUint8();const n=t.indexOf(0);return n>=0&&(t=t.slice(0,n)),ss.decodeText(new Uint8Array(t))}}class eu{add(e,t){this[e]=t}}function tu(e){const t=e.match(/FBXVersion: (\d+)/);if(t)return parseInt(t[1]);throw new Error("THREE.FBXLoader: Cannot find the version number for the file given.")}function nu(e){return e/46186158e3}const iu=[];function ru(e,t,n,i){let r;switch(i.mappingType){case"ByPolygonVertex":r=e;break;case"ByPolygon":r=t;break;case"ByVertice":r=n;break;case"AllSame":r=i.indices[0];break;default:console.warn("THREE.FBXLoader: unknown attribute mapping type "+i.mappingType)}"IndexToDirect"===i.referenceType&&(r=i.indices[r]);const o=r*i.dataSize,a=o+i.dataSize;return function(e,t,n,i){for(let r=n,o=0;r<i;r++,o++)e[o]=t[r];return e}(iu,i.buffer,o,a)}const ou=new _r,au=new Ei;function su(e){const t=new ir,n=new ir,i=new ir,r=new ir,o=new ir,a=new ir,s=new ir,l=new ir,p=new ir,u=new ir,h=new ir,c=new ir,_=e.inheritType?e.inheritType:0;if(e.translation&&t.setPosition(au.fromArray(e.translation)),e.preRotation){const t=e.preRotation.map(ri.degToRad);t.push(e.eulerOrder),n.makeRotationFromEuler(ou.fromArray(t))}if(e.rotation){const t=e.rotation.map(ri.degToRad);t.push(e.eulerOrder),i.makeRotationFromEuler(ou.fromArray(t))}if(e.postRotation){const t=e.postRotation.map(ri.degToRad);t.push(e.eulerOrder),r.makeRotationFromEuler(ou.fromArray(t)),r.invert()}e.scale&&o.scale(au.fromArray(e.scale)),e.scalingOffset&&s.setPosition(au.fromArray(e.scalingOffset)),e.scalingPivot&&a.setPosition(au.fromArray(e.scalingPivot)),e.rotationOffset&&l.setPosition(au.fromArray(e.rotationOffset)),e.rotationPivot&&p.setPosition(au.fromArray(e.rotationPivot)),e.parentMatrixWorld&&(h.copy(e.parentMatrix),u.copy(e.parentMatrixWorld));const d=n.clone().multiply(i).multiply(r),m=new ir;m.extractRotation(u);const P=new ir;P.copyPosition(u);const f=P.clone().invert().multiply(u),x=m.clone().invert().multiply(f),y=o,v=new ir;if(0===_)v.copy(m).multiply(d).multiply(x).multiply(y);else if(1===_)v.copy(m).multiply(x).multiply(d).multiply(y);else{const e=(new ir).scale((new Ei).setFromMatrixScale(h)).clone().invert(),t=x.clone().multiply(e);v.copy(m).multiply(d).multiply(t).multiply(y)}const g=p.clone().invert(),b=a.clone().invert();let z=t.clone().multiply(l).multiply(p).multiply(n).multiply(i).multiply(r).multiply(g).multiply(s).multiply(a).multiply(o).multiply(b);const w=(new ir).copyPosition(z),Z=u.clone().multiply(w);return c.copyPosition(Z),z=c.clone().multiply(v),z.premultiply(u.invert()),z}function lu(e){const t=["ZYX","YZX","XZY","ZXY","YXZ","XYZ"];return 6===(e=e||0)?(console.warn("THREE.FBXLoader: unsupported Euler Order: Spherical XYZ. Animations and rotations may be incorrect."),t[0]):t[e]}function pu(e){return e.split(",").map((function(e){return parseFloat(e)}))}function uu(e,t,n){return void 0===t&&(t=0),void 0===n&&(n=e.byteLength),ss.decodeText(new Uint8Array(e,t,n))}function hu(e,t,n){return e.slice(0,t).concat(n).concat(e.slice(t))}function cu(){let e={};return{get:function(t){return e[t]},add:function(t,n){e[t]=n},remove:function(t){delete e[t]},removeAll:function(){e={}}}}const _u="KHR_binary_glTF",du="KHR_draco_mesh_compression",mu="KHR_lights_punctual",Pu="KHR_materials_clearcoat",fu="KHR_materials_ior",xu="KHR_materials_pbrSpecularGlossiness",yu="KHR_materials_sheen",vu="KHR_materials_specular",gu="KHR_materials_transmission",bu="KHR_materials_iridescence",zu="KHR_materials_unlit",wu="KHR_materials_volume",Zu="KHR_texture_basisu",Eu="KHR_texture_transform",Mu="KHR_mesh_quantization",Su="KHR_materials_emissive_strength",Cu="EXT_texture_webp",Nu="EXT_meshopt_compression";class Au{constructor(e){this.parser=e,this.name=mu,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,t=this.parser.json.nodes||[];for(let n=0,i=t.length;n<i;n++){const i=t[n];i.extensions&&i.extensions[this.name]&&void 0!==i.extensions[this.name].light&&e._addNodeRef(this.cache,i.extensions[this.name].light)}}_loadLight(e){const t=this.parser,n="light:"+e;let i=t.cache.get(n);if(i)return i;const r=t.json,o=((r.extensions&&r.extensions[this.name]||{}).lights||[])[e];let a;const s=new xi(16777215);void 0!==o.color&&s.fromArray(o.color);const l=void 0!==o.range?o.range:0;switch(o.type){case"directional":a=new os(s),a.target.position.set(0,0,-1),a.add(a.target);break;case"point":a=new is(s),a.distance=l;break;case"spot":a=new Ka(s),a.distance=l,o.spot=o.spot||{},o.spot.innerConeAngle=void 0!==o.spot.innerConeAngle?o.spot.innerConeAngle:0,o.spot.outerConeAngle=void 0!==o.spot.outerConeAngle?o.spot.outerConeAngle:Math.PI/4,a.angle=o.spot.outerConeAngle,a.penumbra=1-o.spot.innerConeAngle/o.spot.outerConeAngle,a.target.position.set(0,0,-1),a.add(a.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+o.type)}return a.position.set(0,0,0),a.decay=2,void 0!==o.intensity&&(a.intensity=o.intensity),a.name=t.createUniqueName(o.name||"light_"+e),i=Promise.resolve(a),t.cache.add(n,i),i}createNodeAttachment(e){const t=this,n=this.parser,i=n.json.nodes[e],r=(i.extensions&&i.extensions[this.name]||{}).light;return void 0===r?null:this._loadLight(r).then((function(e){return n._getNodeRef(t.cache,r,e)}))}}class Lu{constructor(){this.name=zu}getMaterialType(){return Dr}extendParams(e,t,n){const i=[];e.color=new xi(1,1,1),e.opacity=1;const r=t.pbrMetallicRoughness;if(r){if(Array.isArray(r.baseColorFactor)){const t=r.baseColorFactor;e.color.fromArray(t),e.opacity=t[3]}void 0!==r.baseColorTexture&&i.push(n.assignTexture(e,"map",r.baseColorTexture,Gn))}return Promise.all(i)}}class Bu{constructor(e){this.parser=e,this.name=Su}extendMaterialParams(e,t){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const i=n.extensions[this.name].emissiveStrength;return void 0!==i&&(t.emissiveIntensity=i),Promise.resolve()}}class Tu{constructor(e){this.parser=e,this.name=Pu}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?va:null}extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=[],o=i.extensions[this.name];if(void 0!==o.clearcoatFactor&&(t.clearcoat=o.clearcoatFactor),void 0!==o.clearcoatTexture&&r.push(n.assignTexture(t,"clearcoatMap",o.clearcoatTexture)),void 0!==o.clearcoatRoughnessFactor&&(t.clearcoatRoughness=o.clearcoatRoughnessFactor),void 0!==o.clearcoatRoughnessTexture&&r.push(n.assignTexture(t,"clearcoatRoughnessMap",o.clearcoatRoughnessTexture)),void 0!==o.clearcoatNormalTexture&&(r.push(n.assignTexture(t,"clearcoatNormalMap",o.clearcoatNormalTexture)),void 0!==o.clearcoatNormalTexture.scale)){const e=o.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new oi(e,e)}return Promise.all(r)}}class Vu{constructor(e){this.parser=e,this.name=bu}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?va:null}extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=[],o=i.extensions[this.name];return void 0!==o.iridescenceFactor&&(t.iridescence=o.iridescenceFactor),void 0!==o.iridescenceTexture&&r.push(n.assignTexture(t,"iridescenceMap",o.iridescenceTexture)),void 0!==o.iridescenceIor&&(t.iridescenceIOR=o.iridescenceIor),void 0===t.iridescenceThicknessRange&&(t.iridescenceThicknessRange=[100,400]),void 0!==o.iridescenceThicknessMinimum&&(t.iridescenceThicknessRange[0]=o.iridescenceThicknessMinimum),void 0!==o.iridescenceThicknessMaximum&&(t.iridescenceThicknessRange[1]=o.iridescenceThicknessMaximum),void 0!==o.iridescenceThicknessTexture&&r.push(n.assignTexture(t,"iridescenceThicknessMap",o.iridescenceThicknessTexture)),Promise.all(r)}}class ku{constructor(e){this.parser=e,this.name=yu}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?va:null}extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=[];t.sheenColor=new xi(0,0,0),t.sheenRoughness=0,t.sheen=1;const o=i.extensions[this.name];return void 0!==o.sheenColorFactor&&t.sheenColor.fromArray(o.sheenColorFactor),void 0!==o.sheenRoughnessFactor&&(t.sheenRoughness=o.sheenRoughnessFactor),void 0!==o.sheenColorTexture&&r.push(n.assignTexture(t,"sheenColorMap",o.sheenColorTexture,Gn)),void 0!==o.sheenRoughnessTexture&&r.push(n.assignTexture(t,"sheenRoughnessMap",o.sheenRoughnessTexture)),Promise.all(r)}}class Iu{constructor(e){this.parser=e,this.name=gu}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?va:null}extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=[],o=i.extensions[this.name];return void 0!==o.transmissionFactor&&(t.transmission=o.transmissionFactor),void 0!==o.transmissionTexture&&r.push(n.assignTexture(t,"transmissionMap",o.transmissionTexture)),Promise.all(r)}}class Ou{constructor(e){this.parser=e,this.name=wu}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?va:null}extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=[],o=i.extensions[this.name];t.thickness=void 0!==o.thicknessFactor?o.thicknessFactor:0,void 0!==o.thicknessTexture&&r.push(n.assignTexture(t,"thicknessMap",o.thicknessTexture)),t.attenuationDistance=o.attenuationDistance||0;const a=o.attenuationColor||[1,1,1];return t.attenuationColor=new xi(a[0],a[1],a[2]),Promise.all(r)}}class Ru{constructor(e){this.parser=e,this.name=fu}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?va:null}extendMaterialParams(e,t){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const i=n.extensions[this.name];return t.ior=void 0!==i.ior?i.ior:1.5,Promise.resolve()}}class Hu{constructor(e){this.parser=e,this.name=vu}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?va:null}extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=[],o=i.extensions[this.name];t.specularIntensity=void 0!==o.specularFactor?o.specularFactor:1,void 0!==o.specularTexture&&r.push(n.assignTexture(t,"specularIntensityMap",o.specularTexture));const a=o.specularColorFactor||[1,1,1];return t.specularColor=new xi(a[0],a[1],a[2]),void 0!==o.specularColorTexture&&r.push(n.assignTexture(t,"specularColorMap",o.specularColorTexture,Gn)),Promise.all(r)}}class Fu{constructor(e){this.parser=e,this.name=Zu}loadTexture(e){const t=this.parser,n=t.json,i=n.textures[e];if(!i.extensions||!i.extensions[this.name])return null;const r=i.extensions[this.name],o=t.options.ktx2Loader;if(!o){if(n.extensionsRequired&&n.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,r.source,o)}}class Du{constructor(e){this.parser=e,this.name=Cu,this.isSupported=null}loadTexture(e){const t=this.name,n=this.parser,i=n.json,r=i.textures[e];if(!r.extensions||!r.extensions[t])return null;const o=r.extensions[t],a=i.images[o.source];let s=n.textureLoader;if(a.uri){const e=n.options.manager.getHandler(a.uri);null!==e&&(s=e)}return this.detectSupport().then((function(r){if(r)return n.loadTextureImage(e,o.source,s);if(i.extensionsRequired&&i.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return n.loadTexture(e)}))}detectSupport(){return this.isSupported||(this.isSupported=new Promise((function(e){const t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(1===t.height)}}))),this.isSupported}}class Gu{constructor(e){this.name=Nu,this.parser=e}loadBufferView(e){const t=this.parser.json,n=t.bufferViews[e];if(n.extensions&&n.extensions[this.name]){const e=n.extensions[this.name],i=this.parser.getDependency("buffer",e.buffer),r=this.parser.options.meshoptDecoder;if(!r||!r.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return Promise.all([i,r.ready]).then((function(t){const n=e.byteOffset||0,i=e.byteLength||0,o=e.count,a=e.byteStride,s=new ArrayBuffer(o*a),l=new Uint8Array(t[0],n,i);return r.decodeGltfBuffer(new Uint8Array(s),o,a,l,e.mode,e.filter),s}))}return null}}const Uu="glTF";class ju{constructor(e){this.name=_u,this.content=null,this.body=null;const t=new DataView(e,0,12);if(this.header={magic:ss.decodeText(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==Uu)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const n=this.header.length-12,i=new DataView(e,12);let r=0;for(;r<n;){const t=i.getUint32(r,!0);r+=4;const n=i.getUint32(r,!0);if(r+=4,1313821514===n){const n=new Uint8Array(e,12+r,t);this.content=ss.decodeText(n)}else if(5130562===n){const n=12+r;this.body=e.slice(n,n+t)}r+=t}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class Wu{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=du,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){const n=this.json,i=this.dracoLoader,r=e.extensions[this.name].bufferView,o=e.extensions[this.name].attributes,a={},s={},l={};for(const e in o){const t=rh[e]||e.toLowerCase();a[t]=o[e]}for(const t in e.attributes){const i=rh[t]||t.toLowerCase();if(void 0!==o[t]){const r=n.accessors[e.attributes[t]],o=eh[r.componentType];l[i]=o,s[i]=!0===r.normalized}}return t.getDependency("bufferView",r).then((function(e){return new Promise((function(t){i.decodeDracoFile(e,(function(e){for(const t in e.attributes){const n=e.attributes[t],i=s[t];void 0!==i&&(n.normalized=i)}t(e)}),a,l)}))}))}}class qu{constructor(){this.name=Eu}extendTexture(e,t){return void 0!==t.texCoord&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),void 0===t.offset&&void 0===t.rotation&&void 0===t.scale||(e=e.clone(),void 0!==t.offset&&e.offset.fromArray(t.offset),void 0!==t.rotation&&(e.rotation=t.rotation),void 0!==t.scale&&e.repeat.fromArray(t.scale),e.needsUpdate=!0),e}}class Ju extends ya{constructor(e){super(),this.isGLTFSpecularGlossinessMaterial=!0;const t=["#ifdef USE_SPECULARMAP","\tuniform sampler2D specularMap;","#endif"].join("\n"),n=["#ifdef USE_GLOSSINESSMAP","\tuniform sampler2D glossinessMap;","#endif"].join("\n"),i=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","\tvec4 texelSpecular = texture2D( specularMap, vUv );","\t// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","\tspecularFactor *= texelSpecular.rgb;","#endif"].join("\n"),r=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","\tvec4 texelGlossiness = texture2D( glossinessMap, vUv );","\t// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","\tglossinessFactor *= texelGlossiness.a;","#endif"].join("\n"),o=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb * ( 1. - max( specularFactor.r, max( specularFactor.g, specularFactor.b ) ) );","vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );","material.roughness = max( 1.0 - glossinessFactor, 0.0525 ); // 0.0525 corresponds to the base mip of a 256 cubemap.","material.roughness += geometryRoughness;","material.roughness = min( material.roughness, 1.0 );","material.specularColor = specularFactor;"].join("\n"),a={specular:{value:(new xi).setHex(16777215)},glossiness:{value:1},specularMap:{value:null},glossinessMap:{value:null}};this._extraUniforms=a,this.onBeforeCompile=function(e){for(const t in a)e.uniforms[t]=a[t];e.fragmentShader=e.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>",t).replace("#include <metalnessmap_pars_fragment>",n).replace("#include <roughnessmap_fragment>",i).replace("#include <metalnessmap_fragment>",r).replace("#include <lights_physical_fragment>",o)},Object.defineProperties(this,{specular:{get:function(){return a.specular.value},set:function(e){a.specular.value=e}},specularMap:{get:function(){return a.specularMap.value},set:function(e){a.specularMap.value=e,e?this.defines.USE_SPECULARMAP="":delete this.defines.USE_SPECULARMAP}},glossiness:{get:function(){return a.glossiness.value},set:function(e){a.glossiness.value=e}},glossinessMap:{get:function(){return a.glossinessMap.value},set:function(e){a.glossinessMap.value=e,e?(this.defines.USE_GLOSSINESSMAP="",this.defines.USE_UV=""):(delete this.defines.USE_GLOSSINESSMAP,delete this.defines.USE_UV)}}}),delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this.setValues(e)}copy(e){return super.copy(e),this.specularMap=e.specularMap,this.specular.copy(e.specular),this.glossinessMap=e.glossinessMap,this.glossiness=e.glossiness,delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this}}class $u{constructor(){this.name=xu,this.specularGlossinessParams=["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","normalMapType","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity"]}getMaterialType(){return Ju}extendParams(e,t,n){const i=t.extensions[this.name];e.color=new xi(1,1,1),e.opacity=1;const r=[];if(Array.isArray(i.diffuseFactor)){const t=i.diffuseFactor;e.color.fromArray(t),e.opacity=t[3]}if(void 0!==i.diffuseTexture&&r.push(n.assignTexture(e,"map",i.diffuseTexture,Gn)),e.emissive=new xi(0,0,0),e.glossiness=void 0!==i.glossinessFactor?i.glossinessFactor:1,e.specular=new xi(1,1,1),Array.isArray(i.specularFactor)&&e.specular.fromArray(i.specularFactor),void 0!==i.specularGlossinessTexture){const t=i.specularGlossinessTexture;r.push(n.assignTexture(e,"glossinessMap",t)),r.push(n.assignTexture(e,"specularMap",t,Gn))}return Promise.all(r)}createMaterial(e){const t=new Ju(e);return t.fog=!0,t.color=e.color,t.map=void 0===e.map?null:e.map,t.lightMap=null,t.lightMapIntensity=1,t.aoMap=void 0===e.aoMap?null:e.aoMap,t.aoMapIntensity=1,t.emissive=e.emissive,t.emissiveIntensity=void 0===e.emissiveIntensity?1:e.emissiveIntensity,t.emissiveMap=void 0===e.emissiveMap?null:e.emissiveMap,t.bumpMap=void 0===e.bumpMap?null:e.bumpMap,t.bumpScale=1,t.normalMap=void 0===e.normalMap?null:e.normalMap,t.normalMapType=0,e.normalScale&&(t.normalScale=e.normalScale),t.displacementMap=null,t.displacementScale=1,t.displacementBias=0,t.specularMap=void 0===e.specularMap?null:e.specularMap,t.specular=e.specular,t.glossinessMap=void 0===e.glossinessMap?null:e.glossinessMap,t.glossiness=e.glossiness,t.alphaMap=null,t.envMap=void 0===e.envMap?null:e.envMap,t.envMapIntensity=1,t}}class Xu{constructor(){this.name=Mu}}class Yu extends Za{constructor(e,t,n,i){super(e,t,n,i)}copySampleValue_(e){const t=this.resultBuffer,n=this.sampleValues,i=this.valueSize,r=e*i*3+i;for(let e=0;e!==i;e++)t[e]=n[r+e];return t}}Yu.prototype.interpolate_=function(e,t,n,i){const r=this.resultBuffer,o=this.sampleValues,a=this.valueSize,s=2*a,l=3*a,p=i-t,u=(n-t)/p,h=u*u,c=h*u,_=e*l,d=_-l,m=-2*c+3*h,P=c-h,f=1-m,x=P-h+u;for(let e=0;e!==a;e++){const t=o[d+e+a],n=o[d+e+s]*p,i=o[_+e+a],l=o[_+e]*p;r[e]=f*t+x*n+m*i+P*l}return r};const Ku=new Zi;class Qu extends Yu{interpolate_(e,t,n,i){const r=super.interpolate_(e,t,n,i);return Ku.fromArray(r).normalize().toArray(r),r}}const eh={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},th={9728:Rn,9729:1006,9984:1004,9985:1007,9986:1005,9987:1008},nh={33071:In,33648:On,10497:kn},ih={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},rh={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},oh={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},ah={CUBICSPLINE:void 0,LINEAR:Fn,STEP:Hn};function sh(e,t,n){for(const i in n.extensions)void 0===e[i]&&(t.userData.gltfExtensions=t.userData.gltfExtensions||{},t.userData.gltfExtensions[i]=n.extensions[i])}function lh(e,t){void 0!==t.extras&&("object"==typeof t.extras?Object.assign(e.userData,t.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+t.extras))}function ph(e,t){if(e.updateMorphTargets(),void 0!==t.weights)for(let n=0,i=t.weights.length;n<i;n++)e.morphTargetInfluences[n]=t.weights[n];if(t.extras&&Array.isArray(t.extras.targetNames)){const n=t.extras.targetNames;if(e.morphTargetInfluences.length===n.length){e.morphTargetDictionary={};for(let t=0,i=n.length;t<i;t++)e.morphTargetDictionary[n[t]]=t}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function uh(e){const t=e.extensions&&e.extensions[du];let n;return n=t?"draco:"+t.bufferView+":"+t.indices+":"+hh(t.attributes):e.indices+":"+hh(e.attributes)+":"+e.mode,n}function hh(e){let t="";const n=Object.keys(e).sort();for(let i=0,r=n.length;i<r;i++)t+=n[i]+":"+e[n[i]]+";";return t}function ch(e){switch(e){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}class _h{constructor(e={},t={}){this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new cu,this.associations=new Map,this.primitiveCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};const n=!0===/^((?!chrome|android).)*safari/i.test(navigator.userAgent),i=navigator.userAgent.indexOf("Firefox")>-1,r=i?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1;"undefined"==typeof createImageBitmap||n||i&&r<98?this.textureLoader=new ja(this.options.manager):this.textureLoader=new ls(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new Ga(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){const n=this,i=this.json,r=this.extensions;this.cache.removeAll(),this._invokeAll((function(e){return e._markDefs&&e._markDefs()})),Promise.all(this._invokeAll((function(e){return e.beforeRoot&&e.beforeRoot()}))).then((function(){return Promise.all([n.getDependencies("scene"),n.getDependencies("animation"),n.getDependencies("camera")])})).then((function(t){const o={scene:t[0][i.scene||0],scenes:t[0],animations:t[1],cameras:t[2],asset:i.asset,parser:n,userData:{}};sh(r,o,i),lh(o,i),Promise.all(n._invokeAll((function(e){return e.afterRoot&&e.afterRoot(o)}))).then((function(){e(o)}))})).catch(t)}_markDefs(){const e=this.json.nodes||[],t=this.json.skins||[],n=this.json.meshes||[];for(let n=0,i=t.length;n<i;n++){const i=t[n].joints;for(let t=0,n=i.length;t<n;t++)e[i[t]].isBone=!0}for(let t=0,i=e.length;t<i;t++){const i=e[t];void 0!==i.mesh&&(this._addNodeRef(this.meshCache,i.mesh),void 0!==i.skin&&(n[i.mesh].isSkinnedMesh=!0)),void 0!==i.camera&&this._addNodeRef(this.cameraCache,i.camera)}}_addNodeRef(e,t){void 0!==t&&(void 0===e.refs[t]&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,n){if(e.refs[t]<=1)return n;const i=n.clone(),r=(e,t)=>{const n=this.associations.get(e);null!=n&&this.associations.set(t,n);for(const[n,i]of e.children.entries())r(i,t.children[n])};return r(n,i),i.name+="_instance_"+e.uses[t]++,i}_invokeOne(e){const t=Object.values(this.plugins);t.push(this);for(let n=0;n<t.length;n++){const i=e(t[n]);if(i)return i}return null}_invokeAll(e){const t=Object.values(this.plugins);t.unshift(this);const n=[];for(let i=0;i<t.length;i++){const r=e(t[i]);r&&n.push(r)}return n}getDependency(e,t){const n=e+":"+t;let i=this.cache.get(n);if(!i){switch(e){case"scene":i=this.loadScene(t);break;case"node":i=this.loadNode(t);break;case"mesh":i=this._invokeOne((function(e){return e.loadMesh&&e.loadMesh(t)}));break;case"accessor":i=this.loadAccessor(t);break;case"bufferView":i=this._invokeOne((function(e){return e.loadBufferView&&e.loadBufferView(t)}));break;case"buffer":i=this.loadBuffer(t);break;case"material":i=this._invokeOne((function(e){return e.loadMaterial&&e.loadMaterial(t)}));break;case"texture":i=this._invokeOne((function(e){return e.loadTexture&&e.loadTexture(t)}));break;case"skin":i=this.loadSkin(t);break;case"animation":i=this._invokeOne((function(e){return e.loadAnimation&&e.loadAnimation(t)}));break;case"camera":i=this.loadCamera(t);break;default:throw new Error("Unknown type: "+e)}this.cache.add(n,i)}return i}getDependencies(e){let t=this.cache.get(e);if(!t){const n=this,i=this.json[e+("mesh"===e?"es":"s")]||[];t=Promise.all(i.map((function(t,i){return n.getDependency(e,i)}))),this.cache.add(e,t)}return t}loadBuffer(e){const t=this.json.buffers[e],n=this.fileLoader;if(t.type&&"arraybuffer"!==t.type)throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(void 0===t.uri&&0===e)return Promise.resolve(this.extensions[_u].body);const i=this.options;return new Promise((function(e,r){n.load(ss.resolveURL(t.uri,i.path),e,void 0,(function(){r(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))}))}))}loadBufferView(e){const t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then((function(e){const n=t.byteLength||0,i=t.byteOffset||0;return e.slice(i,i+n)}))}loadAccessor(e){const t=this,n=this.json,i=this.json.accessors[e];if(void 0===i.bufferView&&void 0===i.sparse)return Promise.resolve(null);const r=[];return void 0!==i.bufferView?r.push(this.getDependency("bufferView",i.bufferView)):r.push(null),void 0!==i.sparse&&(r.push(this.getDependency("bufferView",i.sparse.indices.bufferView)),r.push(this.getDependency("bufferView",i.sparse.values.bufferView))),Promise.all(r).then((function(e){const r=e[0],o=ih[i.type],a=eh[i.componentType],s=a.BYTES_PER_ELEMENT,l=s*o,p=i.byteOffset||0,u=void 0!==i.bufferView?n.bufferViews[i.bufferView].byteStride:void 0,h=!0===i.normalized;let c,_;if(u&&u!==l){const e=Math.floor(p/u),n="InterleavedBuffer:"+i.bufferView+":"+i.componentType+":"+e+":"+i.count;let l=t.cache.get(n);l||(c=new a(r,e*u,i.count*u/s),l=new Fo(c,u/s),t.cache.add(n,l)),_=new Go(l,o,p%u/s,h)}else c=null===r?new a(i.count*o):new a(r,p,i.count*o),_=new jr(c,o,h);if(void 0!==i.sparse){const t=ih.SCALAR,n=eh[i.sparse.indices.componentType],s=i.sparse.indices.byteOffset||0,l=i.sparse.values.byteOffset||0,p=new n(e[1],s,i.sparse.count*t),u=new a(e[2],l,i.sparse.count*o);null!==r&&(_=new jr(_.array.slice(),_.itemSize,_.normalized));for(let e=0,t=p.length;e<t;e++){const t=p[e];if(_.setX(t,u[e*o]),o>=2&&_.setY(t,u[e*o+1]),o>=3&&_.setZ(t,u[e*o+2]),o>=4&&_.setW(t,u[e*o+3]),o>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return _}))}loadTexture(e){const t=this.json,n=this.options,i=t.textures[e].source,r=t.images[i];let o=this.textureLoader;if(r.uri){const e=n.manager.getHandler(r.uri);null!==e&&(o=e)}return this.loadTextureImage(e,i,o)}loadTextureImage(e,t,n){const i=this,r=this.json,o=r.textures[e],a=r.images[t],s=(a.uri||a.bufferView)+":"+o.sampler;if(this.textureCache[s])return this.textureCache[s];const l=this.loadImageSource(t,n).then((function(t){t.flipY=!1,o.name&&(t.name=o.name);const n=(r.samplers||{})[o.sampler]||{};return t.magFilter=th[n.magFilter]||1006,t.minFilter=th[n.minFilter]||1008,t.wrapS=nh[n.wrapS]||kn,t.wrapT=nh[n.wrapT]||kn,i.associations.set(t,{textures:e}),t})).catch((function(){return null}));return this.textureCache[s]=l,l}loadImageSource(e,t){const n=this.json,i=this.options;if(void 0!==this.sourceCache[e])return this.sourceCache[e].then((e=>e.clone()));const r=n.images[e],o=self.URL||self.webkitURL;let a=r.uri||"",s=!1;if(void 0!==r.bufferView)a=this.getDependency("bufferView",r.bufferView).then((function(e){s=!0;const t=new Blob([e],{type:r.mimeType});return a=o.createObjectURL(t),a}));else if(void 0===r.uri)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const l=Promise.resolve(a).then((function(e){return new Promise((function(n,r){let o=n;!0===t.isImageBitmapLoader&&(o=function(e){const t=new zi(e);t.needsUpdate=!0,n(t)}),t.load(ss.resolveURL(e,i.path),o,void 0,r)}))})).then((function(e){var t;return!0===s&&o.revokeObjectURL(a),e.userData.mimeType=r.mimeType||((t=r.uri).search(/\.jpe?g($|\?)/i)>0||0===t.search(/^data\:image\/jpeg/)?"image/jpeg":t.search(/\.webp($|\?)/i)>0||0===t.search(/^data\:image\/webp/)?"image/webp":"image/png"),e})).catch((function(e){throw console.error("THREE.GLTFLoader: Couldn't load texture",a),e}));return this.sourceCache[e]=l,l}assignTexture(e,t,n,i){const r=this;return this.getDependency("texture",n.index).then((function(o){if(void 0===n.texCoord||0==n.texCoord||"aoMap"===t&&1==n.texCoord||console.warn("THREE.GLTFLoader: Custom UV set "+n.texCoord+" for texture "+t+" not yet supported."),r.extensions[Eu]){const e=void 0!==n.extensions?n.extensions[Eu]:void 0;if(e){const t=r.associations.get(o);o=r.extensions[Eu].extendTexture(o,e),r.associations.set(o,t)}}return void 0!==i&&(o.encoding=i),e[t]=o,o}))}assignFinalMaterial(e){const t=e.geometry;let n=e.material;const i=void 0===t.attributes.tangent,r=void 0!==t.attributes.color,o=void 0===t.attributes.normal;if(e.isPoints){const e="PointsMaterial:"+n.uuid;let t=this.cache.get(e);t||(t=new ca,Fr.prototype.copy.call(t,n),t.color.copy(n.color),t.map=n.map,t.sizeAttenuation=!1,this.cache.add(e,t)),n=t}else if(e.isLine){const e="LineBasicMaterial:"+n.uuid;let t=this.cache.get(e);t||(t=new ta,Fr.prototype.copy.call(t,n),t.color.copy(n.color),this.cache.add(e,t)),n=t}if(i||r||o){let e="ClonedMaterial:"+n.uuid+":";n.isGLTFSpecularGlossinessMaterial&&(e+="specular-glossiness:"),i&&(e+="derivative-tangents:"),r&&(e+="vertex-colors:"),o&&(e+="flat-shading:");let t=this.cache.get(e);t||(t=n.clone(),r&&(t.vertexColors=!0),o&&(t.flatShading=!0),i&&(t.normalScale&&(t.normalScale.y*=-1),t.clearcoatNormalScale&&(t.clearcoatNormalScale.y*=-1)),this.cache.add(e,t),this.associations.set(t,this.associations.get(n))),n=t}n.aoMap&&void 0===t.attributes.uv2&&void 0!==t.attributes.uv&&t.setAttribute("uv2",t.attributes.uv),e.material=n}getMaterialType(){return ya}loadMaterial(e){const t=this,n=this.json,i=this.extensions,r=n.materials[e];let o;const a={},s=r.extensions||{},l=[];if(s[xu]){const e=i[xu];o=e.getMaterialType(),l.push(e.extendParams(a,r,t))}else if(s[zu]){const e=i[zu];o=e.getMaterialType(),l.push(e.extendParams(a,r,t))}else{const n=r.pbrMetallicRoughness||{};if(a.color=new xi(1,1,1),a.opacity=1,Array.isArray(n.baseColorFactor)){const e=n.baseColorFactor;a.color.fromArray(e),a.opacity=e[3]}void 0!==n.baseColorTexture&&l.push(t.assignTexture(a,"map",n.baseColorTexture,Gn)),a.metalness=void 0!==n.metallicFactor?n.metallicFactor:1,a.roughness=void 0!==n.roughnessFactor?n.roughnessFactor:1,void 0!==n.metallicRoughnessTexture&&(l.push(t.assignTexture(a,"metalnessMap",n.metallicRoughnessTexture)),l.push(t.assignTexture(a,"roughnessMap",n.metallicRoughnessTexture))),o=this._invokeOne((function(t){return t.getMaterialType&&t.getMaterialType(e)})),l.push(Promise.all(this._invokeAll((function(t){return t.extendMaterialParams&&t.extendMaterialParams(e,a)}))))}!0===r.doubleSided&&(a.side=2);const p=r.alphaMode||"OPAQUE";if("BLEND"===p?(a.transparent=!0,a.depthWrite=!1):(a.transparent=!1,"MASK"===p&&(a.alphaTest=void 0!==r.alphaCutoff?r.alphaCutoff:.5)),void 0!==r.normalTexture&&o!==Dr&&(l.push(t.assignTexture(a,"normalMap",r.normalTexture)),a.normalScale=new oi(1,1),void 0!==r.normalTexture.scale)){const e=r.normalTexture.scale;a.normalScale.set(e,e)}return void 0!==r.occlusionTexture&&o!==Dr&&(l.push(t.assignTexture(a,"aoMap",r.occlusionTexture)),void 0!==r.occlusionTexture.strength&&(a.aoMapIntensity=r.occlusionTexture.strength)),void 0!==r.emissiveFactor&&o!==Dr&&(a.emissive=(new xi).fromArray(r.emissiveFactor)),void 0!==r.emissiveTexture&&o!==Dr&&l.push(t.assignTexture(a,"emissiveMap",r.emissiveTexture,Gn)),Promise.all(l).then((function(){let n;return n=o===Ju?i[xu].createMaterial(a):new o(a),r.name&&(n.name=r.name),lh(n,r),t.associations.set(n,{materials:e}),r.extensions&&sh(i,n,r),n}))}createUniqueName(e){const t=vs.sanitizeNodeName(e||"");let n=t;for(let e=1;this.nodeNamesUsed[n];++e)n=t+"_"+e;return this.nodeNamesUsed[n]=!0,n}loadGeometries(e){const t=this,n=this.extensions,i=this.primitiveCache;function r(e){return n[du].decodePrimitive(e,t).then((function(n){return mh(n,e,t)}))}const o=[];for(let n=0,a=e.length;n<a;n++){const a=e[n],s=uh(a),l=i[s];if(l)o.push(l.promise);else{let e;e=a.extensions&&a.extensions[du]?r(a):mh(new no,a,t),i[s]={primitive:a,promise:e},o.push(e)}}return Promise.all(o)}loadMesh(e){const t=this,n=this.json,i=this.extensions,r=n.meshes[e],o=r.primitives,a=[];for(let e=0,t=o.length;e<t;e++){const t=void 0===o[e].material?(void 0===(s=this.cache).DefaultMaterial&&(s.DefaultMaterial=new ya({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:0})),s.DefaultMaterial):this.getDependency("material",o[e].material);a.push(t)}var s;return a.push(t.loadGeometries(o)),Promise.all(a).then((function(n){const a=n.slice(0,n.length-1),s=n[n.length-1],l=[];for(let n=0,p=s.length;n<p;n++){const p=s[n],u=o[n];let h;const c=a[n];if(4===u.mode||5===u.mode||6===u.mode||void 0===u.mode)h=!0===r.isSkinnedMesh?new $o(p,c):new go(p,c),!0!==h.isSkinnedMesh||h.geometry.attributes.skinWeight.normalized||h.normalizeSkinWeights(),5===u.mode?h.geometry=Ph(h.geometry,1):6===u.mode&&(h.geometry=Ph(h.geometry,2));else if(1===u.mode)h=new ua(p,c);else if(3===u.mode)h=new sa(p,c);else if(2===u.mode)h=new ha(p,c);else{if(0!==u.mode)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+u.mode);h=new fa(p,c)}Object.keys(h.geometry.morphAttributes).length>0&&ph(h,r),h.name=t.createUniqueName(r.name||"mesh_"+e),lh(h,r),u.extensions&&sh(i,h,u),t.assignFinalMaterial(h),l.push(h)}for(let n=0,i=l.length;n<i;n++)t.associations.set(l[n],{meshes:e,primitives:n});if(1===l.length)return l[0];const p=new Ho;t.associations.set(p,{meshes:e});for(let e=0,t=l.length;e<t;e++)p.add(l[e]);return p}))}loadCamera(e){let t;const n=this.json.cameras[e],i=n[n.type];if(i)return"perspective"===n.type?t=new Mo(ri.radToDeg(i.yfov),i.aspectRatio||1,i.znear||1,i.zfar||2e6):"orthographic"===n.type&&(t=new Ro(-i.xmag,i.xmag,i.ymag,-i.ymag,i.znear,i.zfar)),n.name&&(t.name=this.createUniqueName(n.name)),lh(t,n),Promise.resolve(t);console.warn("THREE.GLTFLoader: Missing camera parameters.")}loadSkin(e){const t=this.json.skins[e],n={joints:t.joints};return void 0===t.inverseBindMatrices?Promise.resolve(n):this.getDependency("accessor",t.inverseBindMatrices).then((function(e){return n.inverseBindMatrices=e,n}))}loadAnimation(e){const t=this.json.animations[e],n=[],i=[],r=[],o=[],a=[];for(let e=0,s=t.channels.length;e<s;e++){const s=t.channels[e],l=t.samplers[s.sampler],p=s.target,u=void 0!==p.node?p.node:p.id,h=void 0!==t.parameters?t.parameters[l.input]:l.input,c=void 0!==t.parameters?t.parameters[l.output]:l.output;n.push(this.getDependency("node",u)),i.push(this.getDependency("accessor",h)),r.push(this.getDependency("accessor",c)),o.push(l),a.push(p)}return Promise.all([Promise.all(n),Promise.all(i),Promise.all(r),Promise.all(o),Promise.all(a)]).then((function(n){const i=n[0],r=n[1],o=n[2],a=n[3],s=n[4],l=[];for(let e=0,t=i.length;e<t;e++){const t=i[e],n=r[e],p=o[e],u=a[e],h=s[e];if(void 0===t)continue;let c;switch(t.updateMatrix(),t.matrixAutoUpdate=!0,oh[h.path]){case oh.weights:c=La;break;case oh.rotation:c=Ta;break;default:c=ka}const _=t.name?t.name:t.uuid,d=void 0!==u.interpolation?ah[u.interpolation]:Fn,m=[];oh[h.path]===oh.weights?t.traverse((function(e){e.morphTargetInfluences&&m.push(e.name?e.name:e.uuid)})):m.push(_);let P=p.array;if(p.normalized){const e=ch(P.constructor),t=new Float32Array(P.length);for(let n=0,i=P.length;n<i;n++)t[n]=P[n]*e;P=t}for(let e=0,t=m.length;e<t;e++){const t=new c(m[e]+"."+oh[h.path],n.array,P,d);"CUBICSPLINE"===u.interpolation&&(t.createInterpolant=function(e){return new(this instanceof Ta?Qu:Yu)(this.times,this.values,this.getValueSize()/3,e)},t.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),l.push(t)}}const p=t.name?t.name:"animation_"+e;return new Ia(p,void 0,l)}))}createNodeMesh(e){const t=this.json,n=this,i=t.nodes[e];return void 0===i.mesh?null:n.getDependency("mesh",i.mesh).then((function(e){const t=n._getNodeRef(n.meshCache,i.mesh,e);return void 0!==i.weights&&t.traverse((function(e){if(e.isMesh)for(let t=0,n=i.weights.length;t<n;t++)e.morphTargetInfluences[t]=i.weights[t]})),t}))}loadNode(e){const t=this.json,n=this.extensions,i=this,r=t.nodes[e],o=r.name?i.createUniqueName(r.name):"";return function(){const t=[],n=i._invokeOne((function(t){return t.createNodeMesh&&t.createNodeMesh(e)}));return n&&t.push(n),void 0!==r.camera&&t.push(i.getDependency("camera",r.camera).then((function(e){return i._getNodeRef(i.cameraCache,r.camera,e)}))),i._invokeAll((function(t){return t.createNodeAttachment&&t.createNodeAttachment(e)})).forEach((function(e){t.push(e)})),Promise.all(t)}().then((function(t){let a;if(a=!0===r.isBone?new Xo:t.length>1?new Ho:1===t.length?t[0]:new Sr,a!==t[0])for(let e=0,n=t.length;e<n;e++)a.add(t[e]);if(r.name&&(a.userData.name=r.name,a.name=o),lh(a,r),r.extensions&&sh(n,a,r),void 0!==r.matrix){const e=new ir;e.fromArray(r.matrix),a.applyMatrix4(e)}else void 0!==r.translation&&a.position.fromArray(r.translation),void 0!==r.rotation&&a.quaternion.fromArray(r.rotation),void 0!==r.scale&&a.scale.fromArray(r.scale);return i.associations.has(a)||i.associations.set(a,{}),i.associations.get(a).nodes=e,a}))}loadScene(e){const t=this.json,n=this.extensions,i=this.json.scenes[e],r=this,o=new Ho;i.name&&(o.name=r.createUniqueName(i.name)),lh(o,i),i.extensions&&sh(n,o,i);const a=i.nodes||[],s=[];for(let e=0,n=a.length;e<n;e++)s.push(dh(a[e],o,t,r));return Promise.all(s).then((function(){return r.associations=(e=>{const t=new Map;for(const[e,n]of r.associations)(e instanceof Fr||e instanceof zi)&&t.set(e,n);return e.traverse((e=>{const n=r.associations.get(e);null!=n&&t.set(e,n)})),t})(o),o}))}}function dh(e,t,n,i){const r=n.nodes[e];return i.getDependency("node",e).then((function(e){if(void 0===r.skin)return e;let t;return i.getDependency("skin",r.skin).then((function(e){t=e;const n=[];for(let e=0,r=t.joints.length;e<r;e++)n.push(i.getDependency("node",t.joints[e]));return Promise.all(n)})).then((function(n){return e.traverse((function(e){if(!e.isMesh)return;const i=[],r=[];for(let e=0,o=n.length;e<o;e++){const o=n[e];if(o){i.push(o);const n=new ir;void 0!==t.inverseBindMatrices&&n.fromArray(t.inverseBindMatrices.array,16*e),r.push(n)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[e])}e.bind(new ea(i,r),e.matrixWorld)})),e}))})).then((function(e){t.add(e);const o=[];if(r.children){const t=r.children;for(let r=0,a=t.length;r<a;r++){const a=t[r];o.push(dh(a,e,n,i))}}return Promise.all(o)}))}function mh(e,t,n){const i=t.attributes,r=[];function o(t,i){return n.getDependency("accessor",t).then((function(t){e.setAttribute(i,t)}))}for(const t in i){const n=rh[t]||t.toLowerCase();n in e.attributes||r.push(o(i[t],n))}if(void 0!==t.indices&&!e.index){const i=n.getDependency("accessor",t.indices).then((function(t){e.setIndex(t)}));r.push(i)}return lh(e,t),function(e,t,n){const i=t.attributes,r=new Ci;if(void 0===i.POSITION)return;{const e=n.json.accessors[i.POSITION],t=e.min,o=e.max;if(void 0===t||void 0===o)return void console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");if(r.set(new Ei(t[0],t[1],t[2]),new Ei(o[0],o[1],o[2])),e.normalized){const t=ch(eh[e.componentType]);r.min.multiplyScalar(t),r.max.multiplyScalar(t)}}const o=t.targets;if(void 0!==o){const e=new Ei,t=new Ei;for(let i=0,r=o.length;i<r;i++){const r=o[i];if(void 0!==r.POSITION){const i=n.json.accessors[r.POSITION],o=i.min,a=i.max;if(void 0!==o&&void 0!==a){if(t.setX(Math.max(Math.abs(o[0]),Math.abs(a[0]))),t.setY(Math.max(Math.abs(o[1]),Math.abs(a[1]))),t.setZ(Math.max(Math.abs(o[2]),Math.abs(a[2]))),i.normalized){const e=ch(eh[i.componentType]);t.multiplyScalar(e)}e.max(t)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}r.expandByVector(e)}e.boundingBox=r;const a=new Ji;r.getCenter(a.center),a.radius=r.min.distanceTo(r.max)/2,e.boundingSphere=a}(e,t,n),Promise.all(r).then((function(){return void 0!==t.targets?function(e,t,n){let i=!1,r=!1,o=!1;for(let e=0,n=t.length;e<n;e++){const n=t[e];if(void 0!==n.POSITION&&(i=!0),void 0!==n.NORMAL&&(r=!0),void 0!==n.COLOR_0&&(o=!0),i&&r&&o)break}if(!i&&!r&&!o)return Promise.resolve(e);const a=[],s=[],l=[];for(let p=0,u=t.length;p<u;p++){const u=t[p];if(i){const t=void 0!==u.POSITION?n.getDependency("accessor",u.POSITION):e.attributes.position;a.push(t)}if(r){const t=void 0!==u.NORMAL?n.getDependency("accessor",u.NORMAL):e.attributes.normal;s.push(t)}if(o){const t=void 0!==u.COLOR_0?n.getDependency("accessor",u.COLOR_0):e.attributes.color;l.push(t)}}return Promise.all([Promise.all(a),Promise.all(s),Promise.all(l)]).then((function(t){const n=t[0],a=t[1],s=t[2];return i&&(e.morphAttributes.position=n),r&&(e.morphAttributes.normal=a),o&&(e.morphAttributes.color=s),e.morphTargetsRelative=!0,e}))}(e,t.targets,n):e}))}function Ph(e,t){let n=e.getIndex();if(null===n){const t=[],i=e.getAttribute("position");if(void 0===i)return console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),e;for(let e=0;e<i.count;e++)t.push(e);e.setIndex(t),n=e.getIndex()}const i=n.count-2,r=[];if(2===t)for(let e=1;e<=i;e++)r.push(n.getX(0)),r.push(n.getX(e)),r.push(n.getX(e+1));else for(let e=0;e<i;e++)e%2==0?(r.push(n.getX(e)),r.push(n.getX(e+1)),r.push(n.getX(e+2))):(r.push(n.getX(e+2)),r.push(n.getX(e+1)),r.push(n.getX(e)));r.length/3!==i&&console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const o=e.clone();return o.setIndex(r),o}const fh=new class extends Fa{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register((function(e){return new Tu(e)})),this.register((function(e){return new Fu(e)})),this.register((function(e){return new Du(e)})),this.register((function(e){return new ku(e)})),this.register((function(e){return new Iu(e)})),this.register((function(e){return new Ou(e)})),this.register((function(e){return new Ru(e)})),this.register((function(e){return new Bu(e)})),this.register((function(e){return new Hu(e)})),this.register((function(e){return new Vu(e)})),this.register((function(e){return new Au(e)})),this.register((function(e){return new Gu(e)}))}load(e,t,n,i){const r=this;let o;o=""!==this.resourcePath?this.resourcePath:""!==this.path?this.path:ss.extractUrlBase(e),this.manager.itemStart(e);const a=function(t){i?i(t):console.error(t),r.manager.itemError(e),r.manager.itemEnd(e)},s=new Ga(this.manager);s.setPath(this.path),s.setResponseType("arraybuffer"),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(e,(function(n){try{r.parse(n,o,(function(n){t(n),r.manager.itemEnd(e)}),a)}catch(e){a(e)}}),n,a)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return-1===this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.push(e),this}unregister(e){return-1!==this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,n,i){let r;const o={},a={};if("string"==typeof e)r=e;else if(ss.decodeText(new Uint8Array(e,0,4))===Uu){try{o[_u]=new ju(e)}catch(e){return void(i&&i(e))}r=o[_u].content}else r=ss.decodeText(new Uint8Array(e));const s=JSON.parse(r);if(void 0===s.asset||s.asset.version[0]<2)return void(i&&i(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported.")));const l=new _h(s,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});l.fileLoader.setRequestHeader(this.requestHeader);for(let e=0;e<this.pluginCallbacks.length;e++){const t=this.pluginCallbacks[e](l);a[t.name]=t,o[t.name]=!0}if(s.extensionsUsed)for(let e=0;e<s.extensionsUsed.length;++e){const t=s.extensionsUsed[e],n=s.extensionsRequired||[];switch(t){case zu:o[t]=new Lu;break;case xu:o[t]=new $u;break;case du:o[t]=new Wu(s,this.dracoLoader);break;case Eu:o[t]=new qu;break;case Mu:o[t]=new Xu;break;default:n.indexOf(t)>=0&&void 0===a[t]&&console.warn('THREE.GLTFLoader: Unknown extension "'+t+'".')}}l.setExtensions(o),l.setPlugins(a),l.parse(n,i)}parseAsync(e,t){const n=this;return new Promise((function(i,r){n.parse(e,t,i,r)}))}},xh=Array.from({length:3},(()=>({loader:new qp,isUsed:!1})));let yh=[];const vh=Array.from({length:3},(()=>({loader:new ja,isUsed:!1})));let gh=[];const bh=Array.from({length:3},(()=>({loader:new us,isUsed:!1})));let zh=[];const wh=(e,t,n)=>{const i=t.find((e=>!e.isUsed));i?(i.isUsed=!0,e(i.loader)):n.push((t=>{e(t.loader),t.isUsed=!0}))},Zh=(e,t,n)=>{const i=t.find((t=>t.loader===e));n.length>0?(n[0](i),n.shift()):i.isUsed=!1},Eh=({list:e,onElementLoaded:t,onComplete:n,onError:i})=>{if(e.length>0){const{url:r}=e[0];fh.load(r,(({scene:r,animations:o})=>{t({...e[0],gltfModel:{scene:r,animations:o}}),e.shift(),Eh({list:e,onElementLoaded:t,onComplete:n,onError:i})}))}else n()},Mh=(e,t)=>{const n=[],i=e=>{n.push(e),t()};return new Promise(((t,r)=>{if(e.length>0)for(;e.length>0;){const{url:o,id:a}=e[0],s=e[0];e.shift(),wh((e=>e.load(o,(r=>{i({...s,id:a,fbxModel:r}),Zh(e,xh,yh),xh.some((e=>e.isUsed))||t(n)}),null,(e=>r(Error(`Something wrong happened with an FBX model: ${a}, url: ${o}, error: ${e}`))))),xh,yh)}else t([])}))};function Sh(e){const t=new Map,n=new Map,i=e.clone();return Ch(e,i,(function(e,i){t.set(i,e),n.set(e,i)})),i.traverse((function(e){if(!e.isSkinnedMesh)return;const i=e,r=t.get(e),o=r.skeleton.bones;i.skeleton=r.skeleton.clone(),i.bindMatrix.copy(r.bindMatrix),i.skeleton.bones=o.map((function(e){return n.get(e)})),i.bind(i.skeleton,i.bindMatrix)})),i}function Ch(e,t,n){n(e,t);for(let i=0;i<e.children.length;i++)Ch(e.children[i],t.children[i],n)}const Nh=e=>{e.isMaterial?(e.map?.dispose(),e.map=null,e.dispose()):e.forEach(Nh)},Ah=e=>{const{isMesh:t,material:n,geometry:i}=e;t?(n&&(Nh(n),e.material=null),i&&(i.dispose(),e.geometry=null),e.parent?.remove(e)):e.children&&(e.children.forEach(Ah),e.parent?.remove(e))},Lh={},Bh=e=>{const t=Sh(Lh[e]);return t.animations=[...Lh[e].animations],t},Th={},Vh={},kh=e=>Vh[e],Ih={},Oh=e=>Ih[e],Rh={},Hh=({material:e=null,materialConfig:t={texture:{id:null},color:16777215,alphaTest:.5}})=>{e.map=t?.texture?.id?Oh(t?.texture.id):null,e.alphaTest=t?.alphaTest||.5,e.color=new xi(t?.color||16777215)},Fh=(e={materialType:null,texture:{id:null},color:16777215,alphaTest:.5})=>{let t=null;return e instanceof Array?t=e.map((e=>getMaterial(e))):e.materialType&&(t=new e.materialType({map:e?.texture?.id?Oh(e?.texture.id):null,alphaTest:e.alphaTest||.5,color:new xi(e?.color||16777215)})),t},Dh=({textures:e,gltfModels:t,fbxModels:n,fbxSkeletonAnimations:i,audio:r,onProgress:o})=>new Promise((a=>{const s=[],l=e.length+t.length+n.length+i.length+r.length;let p=0;const u=()=>{p++,o&&o(p/l)};((e,t)=>{const n=[],i=e=>{n.push(e),t()};return new Promise(((t,r)=>{if(e.length>0)for(;e.length>0;){const{url:o,id:a}=e[0];e.shift(),wh((e=>e.load(o,(r=>{r.wrapS=kn,r.wrapT=kn,i({id:a,texture:r}),Zh(e,vh,gh),vh.some((e=>e.isUsed))||t(n)}),null,(e=>r(Error(`Something wrong happened with a texture: ${a}, url: ${o}, error: ${e}`))))),vh,gh)}else t([])}))})(e,u).then((e=>{e.forEach((e=>{e.encoding=Gn,(({id:e,texture:t})=>{Ih[e]=t})(e)})),console.log(`Textures(${e.length}) are loaded...`),((e,t)=>{const n=[],i=e=>{n.push(e),t()};return new Promise(((t,r)=>{Eh({list:e,onElementLoaded:i,onComplete:()=>t(n),onError:e=>r(Error(`Something wrong happened: ${e}`))})}))})(t,u).then((e=>{e.forEach((e=>{const t=Fh(e.material);let n=0;e.gltfModel.scene.traverse((i=>{i.isMesh&&(i.castShadow=!0,i.receiveShadow=!0,i.material=t instanceof Array?t[n]:t||i.material,!t&&e.material&&Hh({material:i.material,materialConfig:e.material instanceof Array?e.material[n]:e.material}),n++)})),(({id:e,gltfModel:t})=>{Vh[e]=t})(e)})),console.log(`GLTF Models(${e.length}) are loaded...`),Mh(i,u).then((e=>{e.forEach((e=>{(({id:e,fbxModel:t})=>{Th[e]=t.animations[0]})(e)})),console.log(`FBX Skeleton Animations(${e.length}) are loaded...`),Mh(n,u).then((e=>{e.forEach((e=>{const t=Fh(e.material);let n=0;e.fbxModel.traverse((i=>{i.isMesh&&(i.castShadow=!0,i.receiveShadow=!0,i.material=t instanceof Array?t[n]:t||i.material,!t&&e.material&&Hh({material:i.material,materialConfig:e.material instanceof Array?e.material[n]:e.material}),n++)})),(({id:e,fbxModel:t})=>{Lh[e]=t})(e)})),s.fbxModels=[...e],console.log(`FBX Models(${e.length}) are loaded...`),((e,t)=>{const n=[],i=e=>{n.push(e),t()};return new Promise(((t,r)=>{if(e.length>0)for(;e.length>0;){const{url:o,id:a}=e[0];e.shift(),wh((e=>e.load(o,(r=>{i({id:a,audioBuffer:r}),Zh(e,bh,zh),bh.some((e=>e.isUsed))||t(n)}),null,(e=>r(Error(`Something wrong happened with an audio: ${a}, url: ${o}, error: ${e}`))))),bh,zh)}else t([])}))})(r,u).then((e=>{e.forEach((e=>(({id:e,audioBuffer:t})=>Rh[e]=t)(e))),console.log(`Audio files(${e.length}) are loaded...`),a(s)})).catch((e=>console.log(`Fatal error during Audio files preloader phase: ${e}`)))})).catch((e=>console.log(`Fatal error during FBX model preloader phase: ${e}`)))}))}))})).catch((e=>console.log(`Fatal error during texture preloader phase: ${e}`)))}))
/**
     * @license
     * Copyright 2010-2022 Three.js Authors
     * SPDX-License-Identifier: MIT
     */,Gh=100,Uh=301,jh=302,Wh=306,qh=1e3,Jh=1001,$h=1002,Xh=1003,Yh=1006,Kh=1008,Qh=1009,ec=1014,tc=1015,nc=1016,ic=1020,rc=1023,oc=1026,ac=1027,sc=33776,lc=33777,pc=33778,uc=33779,hc=2300,cc=2301,_c=2302,dc=2400,mc=2401,Pc=2402,fc=3e3,xc=3001,yc="srgb",vc="srgb-linear",gc=7680,bc="300 es",zc=1035;class wc{addEventListener(e,t){void 0===this._listeners&&(this._listeners={});const n=this._listeners;void 0===n[e]&&(n[e]=[]),-1===n[e].indexOf(t)&&n[e].push(t)}hasEventListener(e,t){if(void 0===this._listeners)return!1;const n=this._listeners;return void 0!==n[e]&&-1!==n[e].indexOf(t)}removeEventListener(e,t){if(void 0===this._listeners)return;const n=this._listeners[e];if(void 0!==n){const e=n.indexOf(t);-1!==e&&n.splice(e,1)}}dispatchEvent(e){if(void 0===this._listeners)return;const t=this._listeners[e.type];if(void 0!==t){e.target=this;const n=t.slice(0);for(let t=0,i=n.length;t<i;t++)n[t].call(this,e);e.target=null}}}const Zc=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let Ec=1234567;const Mc=Math.PI/180,Sc=180/Math.PI;function Cc(){const e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,n=4294967295*Math.random()|0,i=4294967295*Math.random()|0;return(Zc[255&e]+Zc[e>>8&255]+Zc[e>>16&255]+Zc[e>>24&255]+"-"+Zc[255&t]+Zc[t>>8&255]+"-"+Zc[t>>16&15|64]+Zc[t>>24&255]+"-"+Zc[63&n|128]+Zc[n>>8&255]+"-"+Zc[n>>16&255]+Zc[n>>24&255]+Zc[255&i]+Zc[i>>8&255]+Zc[i>>16&255]+Zc[i>>24&255]).toLowerCase()}function Nc(e,t,n){return Math.max(t,Math.min(n,e))}function Ac(e,t){return(e%t+t)%t}function Lc(e,t,n){return(1-n)*e+n*t}function Bc(e){return 0==(e&e-1)&&0!==e}function Tc(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))}function Vc(e,t){switch(t.constructor){case Float32Array:return e;case Uint16Array:return e/65535;case Uint8Array:return e/255;case Int16Array:return Math.max(e/32767,-1);case Int8Array:return Math.max(e/127,-1);default:throw new Error("Invalid component type.")}}function kc(e,t){switch(t.constructor){case Float32Array:return e;case Uint16Array:return Math.round(65535*e);case Uint8Array:return Math.round(255*e);case Int16Array:return Math.round(32767*e);case Int8Array:return Math.round(127*e);default:throw new Error("Invalid component type.")}}var Ic=Object.freeze({__proto__:null,DEG2RAD:Mc,RAD2DEG:Sc,generateUUID:Cc,clamp:Nc,euclideanModulo:Ac,mapLinear:function(e,t,n,i,r){return i+(e-t)*(r-i)/(n-t)},inverseLerp:function(e,t,n){return e!==t?(n-e)/(t-e):0},lerp:Lc,damp:function(e,t,n,i){return Lc(e,t,1-Math.exp(-n*i))},pingpong:function(e,t=1){return t-Math.abs(Ac(e,2*t)-t)},smoothstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t))*e*(3-2*e)},smootherstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t))*e*e*(e*(6*e-15)+10)},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},seededRandom:function(e){void 0!==e&&(Ec=e);let t=Ec+=1831565813;return t=Math.imul(t^t>>>15,1|t),t^=t+Math.imul(t^t>>>7,61|t),((t^t>>>14)>>>0)/4294967296},degToRad:function(e){return e*Mc},radToDeg:function(e){return e*Sc},isPowerOfTwo:Bc,ceilPowerOfTwo:function(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))},floorPowerOfTwo:Tc,setQuaternionFromProperEuler:function(e,t,n,i,r){const o=Math.cos,a=Math.sin,s=o(n/2),l=a(n/2),p=o((t+i)/2),u=a((t+i)/2),h=o((t-i)/2),c=a((t-i)/2),_=o((i-t)/2),d=a((i-t)/2);switch(r){case"XYX":e.set(s*u,l*h,l*c,s*p);break;case"YZY":e.set(l*c,s*u,l*h,s*p);break;case"ZXZ":e.set(l*h,l*c,s*u,s*p);break;case"XZX":e.set(s*u,l*d,l*_,s*p);break;case"YXY":e.set(l*_,s*u,l*d,s*p);break;case"ZYZ":e.set(l*d,l*_,s*u,s*p);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+r)}},normalize:kc,denormalize:Vc});class Oc{constructor(e=0,t=0){Oc.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,n=this.y,i=e.elements;return this.x=i[0]*t+i[3]*n+i[6],this.y=i[1]*t+i[4]*n+i[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y;return t*t+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const n=Math.cos(t),i=Math.sin(t),r=this.x-e.x,o=this.y-e.y;return this.x=r*n-o*i+e.x,this.y=r*i+o*n+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class Rc{constructor(){Rc.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1]}set(e,t,n,i,r,o,a,s,l){const p=this.elements;return p[0]=e,p[1]=i,p[2]=a,p[3]=t,p[4]=r,p[5]=s,p[6]=n,p[7]=o,p[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],this}extractBasis(e,t,n){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,i=t.elements,r=this.elements,o=n[0],a=n[3],s=n[6],l=n[1],p=n[4],u=n[7],h=n[2],c=n[5],_=n[8],d=i[0],m=i[3],P=i[6],f=i[1],x=i[4],y=i[7],v=i[2],g=i[5],b=i[8];return r[0]=o*d+a*f+s*v,r[3]=o*m+a*x+s*g,r[6]=o*P+a*y+s*b,r[1]=l*d+p*f+u*v,r[4]=l*m+p*x+u*g,r[7]=l*P+p*y+u*b,r[2]=h*d+c*f+_*v,r[5]=h*m+c*x+_*g,r[8]=h*P+c*y+_*b,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[1],i=e[2],r=e[3],o=e[4],a=e[5],s=e[6],l=e[7],p=e[8];return t*o*p-t*a*l-n*r*p+n*a*s+i*r*l-i*o*s}invert(){const e=this.elements,t=e[0],n=e[1],i=e[2],r=e[3],o=e[4],a=e[5],s=e[6],l=e[7],p=e[8],u=p*o-a*l,h=a*s-p*r,c=l*r-o*s,_=t*u+n*h+i*c;if(0===_)return this.set(0,0,0,0,0,0,0,0,0);const d=1/_;return e[0]=u*d,e[1]=(i*l-p*n)*d,e[2]=(a*n-i*o)*d,e[3]=h*d,e[4]=(p*t-i*s)*d,e[5]=(i*r-a*t)*d,e[6]=c*d,e[7]=(n*s-l*t)*d,e[8]=(o*t-n*r)*d,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,n,i,r,o,a){const s=Math.cos(r),l=Math.sin(r);return this.set(n*s,n*l,-n*(s*o+l*a)+o+e,-i*l,i*s,-i*(-l*o+s*a)+a+t,0,0,1),this}scale(e,t){const n=this.elements;return n[0]*=e,n[3]*=e,n[6]*=e,n[1]*=t,n[4]*=t,n[7]*=t,this}rotate(e){const t=Math.cos(e),n=Math.sin(e),i=this.elements,r=i[0],o=i[3],a=i[6],s=i[1],l=i[4],p=i[7];return i[0]=t*r+n*s,i[3]=t*o+n*l,i[6]=t*a+n*p,i[1]=-n*r+t*s,i[4]=-n*o+t*l,i[7]=-n*a+t*p,this}translate(e,t){const n=this.elements;return n[0]+=e*n[2],n[3]+=e*n[5],n[6]+=e*n[8],n[1]+=t*n[2],n[4]+=t*n[5],n[7]+=t*n[8],this}equals(e){const t=this.elements,n=e.elements;for(let e=0;e<9;e++)if(t[e]!==n[e])return!1;return!0}fromArray(e,t=0){for(let n=0;n<9;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e}clone(){return(new this.constructor).fromArray(this.elements)}}function Hc(e){for(let t=e.length-1;t>=0;--t)if(e[t]>=65535)return!0;return!1}function Fc(e){return document.createElementNS("http://www.w3.org/1999/xhtml",e)}function Dc(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}function Gc(e){return e<.0031308?12.92*e:1.055*Math.pow(e,.41666)-.055}const Uc={[yc]:{[vc]:Dc},[vc]:{[yc]:Gc}},jc={legacyMode:!0,get workingColorSpace(){return vc},set workingColorSpace(e){console.warn("THREE.ColorManagement: .workingColorSpace is readonly.")},convert:function(e,t,n){if(this.legacyMode||t===n||!t||!n)return e;if(Uc[t]&&void 0!==Uc[t][n]){const i=Uc[t][n];return e.r=i(e.r),e.g=i(e.g),e.b=i(e.b),e}throw new Error("Unsupported color space conversion.")},fromWorkingColorSpace:function(e,t){return this.convert(e,this.workingColorSpace,t)},toWorkingColorSpace:function(e,t){return this.convert(e,t,this.workingColorSpace)}},Wc={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},qc={r:0,g:0,b:0},Jc={h:0,s:0,l:0},$c={h:0,s:0,l:0};function Xc(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+6*(t-e)*(2/3-n):e}function Yc(e,t){return t.r=e.r,t.g=e.g,t.b=e.b,t}class Kc{constructor(e,t,n){return this.isColor=!0,this.r=1,this.g=1,this.b=1,void 0===t&&void 0===n?this.set(e):this.setRGB(e,t,n)}set(e){return e&&e.isColor?this.copy(e):"number"==typeof e?this.setHex(e):"string"==typeof e&&this.setStyle(e),this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t="srgb"){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,jc.toWorkingColorSpace(this,t),this}setRGB(e,t,n,i="srgb-linear"){return this.r=e,this.g=t,this.b=n,jc.toWorkingColorSpace(this,i),this}setHSL(e,t,n,i="srgb-linear"){if(e=Ac(e,1),t=Nc(t,0,1),n=Nc(n,0,1),0===t)this.r=this.g=this.b=n;else{const i=n<=.5?n*(1+t):n+t-n*t,r=2*n-i;this.r=Xc(r,i,e+1/3),this.g=Xc(r,i,e),this.b=Xc(r,i,e-1/3)}return jc.toWorkingColorSpace(this,i),this}setStyle(e,t="srgb"){function n(t){void 0!==t&&parseFloat(t)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let i;if(i=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(e)){let e;const r=i[1],o=i[2];switch(r){case"rgb":case"rgba":if(e=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return this.r=Math.min(255,parseInt(e[1],10))/255,this.g=Math.min(255,parseInt(e[2],10))/255,this.b=Math.min(255,parseInt(e[3],10))/255,jc.toWorkingColorSpace(this,t),n(e[4]),this;if(e=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return this.r=Math.min(100,parseInt(e[1],10))/100,this.g=Math.min(100,parseInt(e[2],10))/100,this.b=Math.min(100,parseInt(e[3],10))/100,jc.toWorkingColorSpace(this,t),n(e[4]),this;break;case"hsl":case"hsla":if(e=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o)){const i=parseFloat(e[1])/360,r=parseFloat(e[2])/100,o=parseFloat(e[3])/100;return n(e[4]),this.setHSL(i,r,o,t)}}}else if(i=/^\#([A-Fa-f\d]+)$/.exec(e)){const e=i[1],n=e.length;if(3===n)return this.r=parseInt(e.charAt(0)+e.charAt(0),16)/255,this.g=parseInt(e.charAt(1)+e.charAt(1),16)/255,this.b=parseInt(e.charAt(2)+e.charAt(2),16)/255,jc.toWorkingColorSpace(this,t),this;if(6===n)return this.r=parseInt(e.charAt(0)+e.charAt(1),16)/255,this.g=parseInt(e.charAt(2)+e.charAt(3),16)/255,this.b=parseInt(e.charAt(4)+e.charAt(5),16)/255,jc.toWorkingColorSpace(this,t),this}return e&&e.length>0?this.setColorName(e,t):this}setColorName(e,t="srgb"){const n=Wc[e.toLowerCase()];return void 0!==n?this.setHex(n,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=Dc(e.r),this.g=Dc(e.g),this.b=Dc(e.b),this}copyLinearToSRGB(e){return this.r=Gc(e.r),this.g=Gc(e.g),this.b=Gc(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e="srgb"){return jc.fromWorkingColorSpace(Yc(this,qc),e),Nc(255*qc.r,0,255)<<16^Nc(255*qc.g,0,255)<<8^Nc(255*qc.b,0,255)<<0}getHexString(e="srgb"){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t="srgb-linear"){jc.fromWorkingColorSpace(Yc(this,qc),t);const n=qc.r,i=qc.g,r=qc.b,o=Math.max(n,i,r),a=Math.min(n,i,r);let s,l;const p=(a+o)/2;if(a===o)s=0,l=0;else{const e=o-a;switch(l=p<=.5?e/(o+a):e/(2-o-a),o){case n:s=(i-r)/e+(i<r?6:0);break;case i:s=(r-n)/e+2;break;case r:s=(n-i)/e+4}s/=6}return e.h=s,e.s=l,e.l=p,e}getRGB(e,t="srgb-linear"){return jc.fromWorkingColorSpace(Yc(this,qc),t),e.r=qc.r,e.g=qc.g,e.b=qc.b,e}getStyle(e="srgb"){return jc.fromWorkingColorSpace(Yc(this,qc),e),e!==yc?`color(${e} ${qc.r} ${qc.g} ${qc.b})`:`rgb(${255*qc.r|0},${255*qc.g|0},${255*qc.b|0})`}offsetHSL(e,t,n){return this.getHSL(Jc),Jc.h+=e,Jc.s+=t,Jc.l+=n,this.setHSL(Jc.h,Jc.s,Jc.l),this}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,n){return this.r=e.r+(t.r-e.r)*n,this.g=e.g+(t.g-e.g)*n,this.b=e.b+(t.b-e.b)*n,this}lerpHSL(e,t){this.getHSL(Jc),e.getHSL($c);const n=Lc(Jc.h,$c.h,t),i=Lc(Jc.s,$c.s,t),r=Lc(Jc.l,$c.l,t);return this.setHSL(n,i,r),this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}let Qc;Kc.NAMES=Wc;class e_{static getDataURL(e){if(/^data:/i.test(e.src))return e.src;if("undefined"==typeof HTMLCanvasElement)return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{void 0===Qc&&(Qc=Fc("canvas")),Qc.width=e.width,Qc.height=e.height;const n=Qc.getContext("2d");e instanceof ImageData?n.putImageData(e,0,0):n.drawImage(e,0,0,e.width,e.height),t=Qc}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}static sRGBToLinear(e){if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap){const t=Fc("canvas");t.width=e.width,t.height=e.height;const n=t.getContext("2d");n.drawImage(e,0,0,e.width,e.height);const i=n.getImageData(0,0,e.width,e.height),r=i.data;for(let e=0;e<r.length;e++)r[e]=255*Dc(r[e]/255);return n.putImageData(i,0,0),t}if(e.data){const t=e.data.slice(0);for(let e=0;e<t.length;e++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[e]=Math.floor(255*Dc(t[e]/255)):t[e]=Dc(t[e]);return{data:t,width:e.width,height:e.height}}return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}class t_{constructor(e=null){this.isSource=!0,this.uuid=Cc(),this.data=e,this.version=0}set needsUpdate(e){!0===e&&this.version++}toJSON(e){const t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.images[this.uuid])return e.images[this.uuid];const n={uuid:this.uuid,url:""},i=this.data;if(null!==i){let e;if(Array.isArray(i)){e=[];for(let t=0,n=i.length;t<n;t++)i[t].isDataTexture?e.push(n_(i[t].image)):e.push(n_(i[t]))}else e=n_(i);n.url=e}return t||(e.images[this.uuid]=n),n}}function n_(e){return"undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap?e_.getDataURL(e):e.data?{data:Array.from(e.data),width:e.width,height:e.height,type:e.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let i_=0;class r_ extends wc{constructor(e=r_.DEFAULT_IMAGE,t=r_.DEFAULT_MAPPING,n=1001,i=1001,r=1006,o=1008,a=1023,s=1009,l=1,p=3e3){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:i_++}),this.uuid=Cc(),this.name="",this.source=new t_(e),this.mipmaps=[],this.mapping=t,this.wrapS=n,this.wrapT=i,this.magFilter=r,this.minFilter=o,this.anisotropy=l,this.format=a,this.internalFormat=null,this.type=s,this.offset=new Oc(0,0),this.repeat=new Oc(1,1),this.center=new Oc(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Rc,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=p,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(e){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return(new this.constructor).copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){const t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.textures[this.uuid])return e.textures[this.uuid];const n={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return"{}"!==JSON.stringify(this.userData)&&(n.userData=this.userData),t||(e.textures[this.uuid]=n),n}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(300!==this.mapping)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case qh:e.x=e.x-Math.floor(e.x);break;case Jh:e.x=e.x<0?0:1;break;case $h:1===Math.abs(Math.floor(e.x)%2)?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||e.y>1)switch(this.wrapT){case qh:e.y=e.y-Math.floor(e.y);break;case Jh:e.y=e.y<0?0:1;break;case $h:1===Math.abs(Math.floor(e.y)%2)?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){!0===e&&(this.version++,this.source.needsUpdate=!0)}}r_.DEFAULT_IMAGE=null,r_.DEFAULT_MAPPING=300;class o_{constructor(e=0,t=0,n=0,i=1){o_.prototype.isVector4=!0,this.x=e,this.y=t,this.z=n,this.w=i}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,n,i){return this.x=e,this.y=t,this.z=n,this.w=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,n=this.y,i=this.z,r=this.w,o=e.elements;return this.x=o[0]*t+o[4]*n+o[8]*i+o[12]*r,this.y=o[1]*t+o[5]*n+o[9]*i+o[13]*r,this.z=o[2]*t+o[6]*n+o[10]*i+o[14]*r,this.w=o[3]*t+o[7]*n+o[11]*i+o[15]*r,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,n,i,r;const o=.01,a=.1,s=e.elements,l=s[0],p=s[4],u=s[8],h=s[1],c=s[5],_=s[9],d=s[2],m=s[6],P=s[10];if(Math.abs(p-h)<o&&Math.abs(u-d)<o&&Math.abs(_-m)<o){if(Math.abs(p+h)<a&&Math.abs(u+d)<a&&Math.abs(_+m)<a&&Math.abs(l+c+P-3)<a)return this.set(1,0,0,0),this;t=Math.PI;const e=(l+1)/2,s=(c+1)/2,f=(P+1)/2,x=(p+h)/4,y=(u+d)/4,v=(_+m)/4;return e>s&&e>f?e<o?(n=0,i=.707106781,r=.707106781):(n=Math.sqrt(e),i=x/n,r=y/n):s>f?s<o?(n=.707106781,i=0,r=.707106781):(i=Math.sqrt(s),n=x/i,r=v/i):f<o?(n=.707106781,i=.707106781,r=0):(r=Math.sqrt(f),n=y/r,i=v/r),this.set(n,i,r,t),this}let f=Math.sqrt((m-_)*(m-_)+(u-d)*(u-d)+(h-p)*(h-p));return Math.abs(f)<.001&&(f=1),this.x=(m-_)/f,this.y=(u-d)/f,this.z=(h-p)/f,this.w=Math.acos((l+c+P-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this.w=e.w+(t.w-e.w)*n,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class a_ extends wc{constructor(e,t,n={}){super(),this.isWebGLRenderTarget=!0,this.width=e,this.height=t,this.depth=1,this.scissor=new o_(0,0,e,t),this.scissorTest=!1,this.viewport=new o_(0,0,e,t);const i={width:e,height:t,depth:1};this.texture=new r_(i,n.mapping,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.encoding),this.texture.isRenderTargetTexture=!0,this.texture.flipY=!1,this.texture.generateMipmaps=void 0!==n.generateMipmaps&&n.generateMipmaps,this.texture.internalFormat=void 0!==n.internalFormat?n.internalFormat:null,this.texture.minFilter=void 0!==n.minFilter?n.minFilter:Yh,this.depthBuffer=void 0===n.depthBuffer||n.depthBuffer,this.stencilBuffer=void 0!==n.stencilBuffer&&n.stencilBuffer,this.depthTexture=void 0!==n.depthTexture?n.depthTexture:null,this.samples=void 0!==n.samples?n.samples:0}setSize(e,t,n=1){this.width===e&&this.height===t&&this.depth===n||(this.width=e,this.height=t,this.depth=n,this.texture.image.width=e,this.texture.image.height=t,this.texture.image.depth=n,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return(new this.constructor).copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.texture.isRenderTargetTexture=!0;const t=Object.assign({},e.texture.image);return this.texture.source=new t_(t),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,null!==e.depthTexture&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class s_ extends r_{constructor(e=null,t=1,n=1,i=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:n,depth:i},this.magFilter=Xh,this.minFilter=Xh,this.wrapR=Jh,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class l_{constructor(e=0,t=0,n=0,i=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=n,this._w=i}static slerpFlat(e,t,n,i,r,o,a){let s=n[i+0],l=n[i+1],p=n[i+2],u=n[i+3];const h=r[o+0],c=r[o+1],_=r[o+2],d=r[o+3];if(0===a)return e[t+0]=s,e[t+1]=l,e[t+2]=p,void(e[t+3]=u);if(1===a)return e[t+0]=h,e[t+1]=c,e[t+2]=_,void(e[t+3]=d);if(u!==d||s!==h||l!==c||p!==_){let e=1-a;const t=s*h+l*c+p*_+u*d,n=t>=0?1:-1,i=1-t*t;if(i>Number.EPSILON){const r=Math.sqrt(i),o=Math.atan2(r,t*n);e=Math.sin(e*o)/r,a=Math.sin(a*o)/r}const r=a*n;if(s=s*e+h*r,l=l*e+c*r,p=p*e+_*r,u=u*e+d*r,e===1-a){const e=1/Math.sqrt(s*s+l*l+p*p+u*u);s*=e,l*=e,p*=e,u*=e}}e[t]=s,e[t+1]=l,e[t+2]=p,e[t+3]=u}static multiplyQuaternionsFlat(e,t,n,i,r,o){const a=n[i],s=n[i+1],l=n[i+2],p=n[i+3],u=r[o],h=r[o+1],c=r[o+2],_=r[o+3];return e[t]=a*_+p*u+s*c-l*h,e[t+1]=s*_+p*h+l*u-a*c,e[t+2]=l*_+p*c+a*h-s*u,e[t+3]=p*_-a*u-s*h-l*c,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,n,i){return this._x=e,this._y=t,this._z=n,this._w=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t){const n=e._x,i=e._y,r=e._z,o=e._order,a=Math.cos,s=Math.sin,l=a(n/2),p=a(i/2),u=a(r/2),h=s(n/2),c=s(i/2),_=s(r/2);switch(o){case"XYZ":this._x=h*p*u+l*c*_,this._y=l*c*u-h*p*_,this._z=l*p*_+h*c*u,this._w=l*p*u-h*c*_;break;case"YXZ":this._x=h*p*u+l*c*_,this._y=l*c*u-h*p*_,this._z=l*p*_-h*c*u,this._w=l*p*u+h*c*_;break;case"ZXY":this._x=h*p*u-l*c*_,this._y=l*c*u+h*p*_,this._z=l*p*_+h*c*u,this._w=l*p*u-h*c*_;break;case"ZYX":this._x=h*p*u-l*c*_,this._y=l*c*u+h*p*_,this._z=l*p*_-h*c*u,this._w=l*p*u+h*c*_;break;case"YZX":this._x=h*p*u+l*c*_,this._y=l*c*u+h*p*_,this._z=l*p*_-h*c*u,this._w=l*p*u-h*c*_;break;case"XZY":this._x=h*p*u-l*c*_,this._y=l*c*u-h*p*_,this._z=l*p*_+h*c*u,this._w=l*p*u+h*c*_;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+o)}return!1!==t&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const n=t/2,i=Math.sin(n);return this._x=e.x*i,this._y=e.y*i,this._z=e.z*i,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,n=t[0],i=t[4],r=t[8],o=t[1],a=t[5],s=t[9],l=t[2],p=t[6],u=t[10],h=n+a+u;if(h>0){const e=.5/Math.sqrt(h+1);this._w=.25/e,this._x=(p-s)*e,this._y=(r-l)*e,this._z=(o-i)*e}else if(n>a&&n>u){const e=2*Math.sqrt(1+n-a-u);this._w=(p-s)/e,this._x=.25*e,this._y=(i+o)/e,this._z=(r+l)/e}else if(a>u){const e=2*Math.sqrt(1+a-n-u);this._w=(r-l)/e,this._x=(i+o)/e,this._y=.25*e,this._z=(s+p)/e}else{const e=2*Math.sqrt(1+u-n-a);this._w=(o-i)/e,this._x=(r+l)/e,this._y=(s+p)/e,this._z=.25*e}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let n=e.dot(t)+1;return n<Number.EPSILON?(n=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=n):(this._x=0,this._y=-e.z,this._z=e.y,this._w=n)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=n),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(Nc(this.dot(e),-1,1)))}rotateTowards(e,t){const n=this.angleTo(e);if(0===n)return this;const i=Math.min(1,t/n);return this.slerp(e,i),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const n=e._x,i=e._y,r=e._z,o=e._w,a=t._x,s=t._y,l=t._z,p=t._w;return this._x=n*p+o*a+i*l-r*s,this._y=i*p+o*s+r*a-n*l,this._z=r*p+o*l+n*s-i*a,this._w=o*p-n*a-i*s-r*l,this._onChangeCallback(),this}slerp(e,t){if(0===t)return this;if(1===t)return this.copy(e);const n=this._x,i=this._y,r=this._z,o=this._w;let a=o*e._w+n*e._x+i*e._y+r*e._z;if(a<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,a=-a):this.copy(e),a>=1)return this._w=o,this._x=n,this._y=i,this._z=r,this;const s=1-a*a;if(s<=Number.EPSILON){const e=1-t;return this._w=e*o+t*this._w,this._x=e*n+t*this._x,this._y=e*i+t*this._y,this._z=e*r+t*this._z,this.normalize(),this._onChangeCallback(),this}const l=Math.sqrt(s),p=Math.atan2(l,a),u=Math.sin((1-t)*p)/l,h=Math.sin(t*p)/l;return this._w=o*u+this._w*h,this._x=n*u+this._x*h,this._y=i*u+this._y*h,this._z=r*u+this._z*h,this._onChangeCallback(),this}slerpQuaternions(e,t,n){return this.copy(e).slerp(t,n)}random(){const e=Math.random(),t=Math.sqrt(1-e),n=Math.sqrt(e),i=2*Math.PI*Math.random(),r=2*Math.PI*Math.random();return this.set(t*Math.cos(i),n*Math.sin(r),n*Math.cos(r),t*Math.sin(i))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class p_{constructor(e=0,t=0,n=0){p_.prototype.isVector3=!0,this.x=e,this.y=t,this.z=n}set(e,t,n){return void 0===n&&(n=this.z),this.x=e,this.y=t,this.z=n,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(h_.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(h_.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,n=this.y,i=this.z,r=e.elements;return this.x=r[0]*t+r[3]*n+r[6]*i,this.y=r[1]*t+r[4]*n+r[7]*i,this.z=r[2]*t+r[5]*n+r[8]*i,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,n=this.y,i=this.z,r=e.elements,o=1/(r[3]*t+r[7]*n+r[11]*i+r[15]);return this.x=(r[0]*t+r[4]*n+r[8]*i+r[12])*o,this.y=(r[1]*t+r[5]*n+r[9]*i+r[13])*o,this.z=(r[2]*t+r[6]*n+r[10]*i+r[14])*o,this}applyQuaternion(e){const t=this.x,n=this.y,i=this.z,r=e.x,o=e.y,a=e.z,s=e.w,l=s*t+o*i-a*n,p=s*n+a*t-r*i,u=s*i+r*n-o*t,h=-r*t-o*n-a*i;return this.x=l*s+h*-r+p*-a-u*-o,this.y=p*s+h*-o+u*-r-l*-a,this.z=u*s+h*-a+l*-o-p*-r,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,n=this.y,i=this.z,r=e.elements;return this.x=r[0]*t+r[4]*n+r[8]*i,this.y=r[1]*t+r[5]*n+r[9]*i,this.z=r[2]*t+r[6]*n+r[10]*i,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const n=e.x,i=e.y,r=e.z,o=t.x,a=t.y,s=t.z;return this.x=i*s-r*a,this.y=r*o-n*s,this.z=n*a-i*o,this}projectOnVector(e){const t=e.lengthSq();if(0===t)return this.set(0,0,0);const n=e.dot(this)/t;return this.copy(e).multiplyScalar(n)}projectOnPlane(e){return u_.copy(this).projectOnVector(e),this.sub(u_)}reflect(e){return this.sub(u_.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(Nc(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y,i=this.z-e.z;return t*t+n*n+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,n){const i=Math.sin(t)*e;return this.x=i*Math.sin(n),this.y=Math.cos(t)*e,this.z=i*Math.cos(n),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,n){return this.x=e*Math.sin(t),this.y=n,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),i=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=n,this.z=i,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,4*t)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,3*t)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=2*(Math.random()-.5),t=Math.random()*Math.PI*2,n=Math.sqrt(1-e**2);return this.x=n*Math.cos(t),this.y=n*Math.sin(t),this.z=e,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const u_=new p_,h_=new l_;class c_{constructor(e=new p_(1/0,1/0,1/0),t=new p_(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){let t=1/0,n=1/0,i=1/0,r=-1/0,o=-1/0,a=-1/0;for(let s=0,l=e.length;s<l;s+=3){const l=e[s],p=e[s+1],u=e[s+2];l<t&&(t=l),p<n&&(n=p),u<i&&(i=u),l>r&&(r=l),p>o&&(o=p),u>a&&(a=u)}return this.min.set(t,n,i),this.max.set(r,o,a),this}setFromBufferAttribute(e){let t=1/0,n=1/0,i=1/0,r=-1/0,o=-1/0,a=-1/0;for(let s=0,l=e.count;s<l;s++){const l=e.getX(s),p=e.getY(s),u=e.getZ(s);l<t&&(t=l),p<n&&(n=p),u<i&&(i=u),l>r&&(r=l),p>o&&(o=p),u>a&&(a=u)}return this.min.set(t,n,i),this.max.set(r,o,a),this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const n=d_.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return(new this.constructor).copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){e.updateWorldMatrix(!1,!1);const n=e.geometry;if(void 0!==n)if(t&&null!=n.attributes&&void 0!==n.attributes.position){const t=n.attributes.position;for(let n=0,i=t.count;n<i;n++)d_.fromBufferAttribute(t,n).applyMatrix4(e.matrixWorld),this.expandByPoint(d_)}else null===n.boundingBox&&n.computeBoundingBox(),m_.copy(n.boundingBox),m_.applyMatrix4(e.matrixWorld),this.union(m_);const i=e.children;for(let e=0,n=i.length;e<n;e++)this.expandByObject(i[e],t);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,d_),d_.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,n;return e.normal.x>0?(t=e.normal.x*this.min.x,n=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,n=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,n+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,n+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,n+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,n+=e.normal.z*this.min.z),t<=-e.constant&&n>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(b_),z_.subVectors(this.max,b_),P_.subVectors(e.a,b_),f_.subVectors(e.b,b_),x_.subVectors(e.c,b_),y_.subVectors(f_,P_),v_.subVectors(x_,f_),g_.subVectors(P_,x_);let t=[0,-y_.z,y_.y,0,-v_.z,v_.y,0,-g_.z,g_.y,y_.z,0,-y_.x,v_.z,0,-v_.x,g_.z,0,-g_.x,-y_.y,y_.x,0,-v_.y,v_.x,0,-g_.y,g_.x,0];return!!E_(t,P_,f_,x_,z_)&&(t=[1,0,0,0,1,0,0,0,1],!!E_(t,P_,f_,x_,z_)&&(w_.crossVectors(y_,v_),t=[w_.x,w_.y,w_.z],E_(t,P_,f_,x_,z_)))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return d_.copy(e).clamp(this.min,this.max).sub(e).length()}getBoundingSphere(e){return this.getCenter(e.center),e.radius=.5*this.getSize(d_).length(),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()||(__[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),__[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),__[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),__[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),__[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),__[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),__[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),__[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(__)),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const __=[new p_,new p_,new p_,new p_,new p_,new p_,new p_,new p_],d_=new p_,m_=new c_,P_=new p_,f_=new p_,x_=new p_,y_=new p_,v_=new p_,g_=new p_,b_=new p_,z_=new p_,w_=new p_,Z_=new p_;function E_(e,t,n,i,r){for(let o=0,a=e.length-3;o<=a;o+=3){Z_.fromArray(e,o);const a=r.x*Math.abs(Z_.x)+r.y*Math.abs(Z_.y)+r.z*Math.abs(Z_.z),s=t.dot(Z_),l=n.dot(Z_),p=i.dot(Z_);if(Math.max(-Math.max(s,l,p),Math.min(s,l,p))>a)return!1}return!0}const M_=new c_,S_=new p_,C_=new p_,N_=new p_;class A_{constructor(e=new p_,t=-1){this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const n=this.center;void 0!==t?n.copy(t):M_.setFromPoints(e).getCenter(n);let i=0;for(let t=0,r=e.length;t<r;t++)i=Math.max(i,n.distanceToSquared(e[t]));return this.radius=Math.sqrt(i),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const n=this.center.distanceToSquared(e);return t.copy(e),n>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){N_.subVectors(e,this.center);const t=N_.lengthSq();if(t>this.radius*this.radius){const e=Math.sqrt(t),n=.5*(e-this.radius);this.center.add(N_.multiplyScalar(n/e)),this.radius+=n}return this}union(e){return!0===this.center.equals(e.center)?C_.set(0,0,1).multiplyScalar(e.radius):C_.subVectors(e.center,this.center).normalize().multiplyScalar(e.radius),this.expandByPoint(S_.copy(e.center).add(C_)),this.expandByPoint(S_.copy(e.center).sub(C_)),this}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return(new this.constructor).copy(this)}}const L_=new p_,B_=new p_,T_=new p_,V_=new p_,k_=new p_,I_=new p_,O_=new p_;class R_{constructor(e=new p_,t=new p_(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.direction).multiplyScalar(e).add(this.origin)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,L_)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const n=t.dot(this.direction);return n<0?t.copy(this.origin):t.copy(this.direction).multiplyScalar(n).add(this.origin)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=L_.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(L_.copy(this.direction).multiplyScalar(t).add(this.origin),L_.distanceToSquared(e))}distanceSqToSegment(e,t,n,i){B_.copy(e).add(t).multiplyScalar(.5),T_.copy(t).sub(e).normalize(),V_.copy(this.origin).sub(B_);const r=.5*e.distanceTo(t),o=-this.direction.dot(T_),a=V_.dot(this.direction),s=-V_.dot(T_),l=V_.lengthSq(),p=Math.abs(1-o*o);let u,h,c,_;if(p>0)if(u=o*s-a,h=o*a-s,_=r*p,u>=0)if(h>=-_)if(h<=_){const e=1/p;u*=e,h*=e,c=u*(u+o*h+2*a)+h*(o*u+h+2*s)+l}else h=r,u=Math.max(0,-(o*h+a)),c=-u*u+h*(h+2*s)+l;else h=-r,u=Math.max(0,-(o*h+a)),c=-u*u+h*(h+2*s)+l;else h<=-_?(u=Math.max(0,-(-o*r+a)),h=u>0?-r:Math.min(Math.max(-r,-s),r),c=-u*u+h*(h+2*s)+l):h<=_?(u=0,h=Math.min(Math.max(-r,-s),r),c=h*(h+2*s)+l):(u=Math.max(0,-(o*r+a)),h=u>0?r:Math.min(Math.max(-r,-s),r),c=-u*u+h*(h+2*s)+l);else h=o>0?-r:r,u=Math.max(0,-(o*h+a)),c=-u*u+h*(h+2*s)+l;return n&&n.copy(this.direction).multiplyScalar(u).add(this.origin),i&&i.copy(T_).multiplyScalar(h).add(B_),c}intersectSphere(e,t){L_.subVectors(e.center,this.origin);const n=L_.dot(this.direction),i=L_.dot(L_)-n*n,r=e.radius*e.radius;if(i>r)return null;const o=Math.sqrt(r-i),a=n-o,s=n+o;return a<0&&s<0?null:a<0?this.at(s,t):this.at(a,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(0===t)return 0===e.distanceToPoint(this.origin)?0:null;const n=-(this.origin.dot(e.normal)+e.constant)/t;return n>=0?n:null}intersectPlane(e,t){const n=this.distanceToPlane(e);return null===n?null:this.at(n,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);return 0===t||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let n,i,r,o,a,s;const l=1/this.direction.x,p=1/this.direction.y,u=1/this.direction.z,h=this.origin;return l>=0?(n=(e.min.x-h.x)*l,i=(e.max.x-h.x)*l):(n=(e.max.x-h.x)*l,i=(e.min.x-h.x)*l),p>=0?(r=(e.min.y-h.y)*p,o=(e.max.y-h.y)*p):(r=(e.max.y-h.y)*p,o=(e.min.y-h.y)*p),n>o||r>i?null:((r>n||n!=n)&&(n=r),(o<i||i!=i)&&(i=o),u>=0?(a=(e.min.z-h.z)*u,s=(e.max.z-h.z)*u):(a=(e.max.z-h.z)*u,s=(e.min.z-h.z)*u),n>s||a>i?null:((a>n||n!=n)&&(n=a),(s<i||i!=i)&&(i=s),i<0?null:this.at(n>=0?n:i,t)))}intersectsBox(e){return null!==this.intersectBox(e,L_)}intersectTriangle(e,t,n,i,r){k_.subVectors(t,e),I_.subVectors(n,e),O_.crossVectors(k_,I_);let o,a=this.direction.dot(O_);if(a>0){if(i)return null;o=1}else{if(!(a<0))return null;o=-1,a=-a}V_.subVectors(this.origin,e);const s=o*this.direction.dot(I_.crossVectors(V_,I_));if(s<0)return null;const l=o*this.direction.dot(k_.cross(V_));if(l<0)return null;if(s+l>a)return null;const p=-o*V_.dot(O_);return p<0?null:this.at(p/a,r)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return(new this.constructor).copy(this)}}class H_{constructor(){H_.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}set(e,t,n,i,r,o,a,s,l,p,u,h,c,_,d,m){const P=this.elements;return P[0]=e,P[4]=t,P[8]=n,P[12]=i,P[1]=r,P[5]=o,P[9]=a,P[13]=s,P[2]=l,P[6]=p,P[10]=u,P[14]=h,P[3]=c,P[7]=_,P[11]=d,P[15]=m,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new H_).fromArray(this.elements)}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],this}copyPosition(e){const t=this.elements,n=e.elements;return t[12]=n[12],t[13]=n[13],t[14]=n[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,n){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}makeBasis(e,t,n){return this.set(e.x,t.x,n.x,0,e.y,t.y,n.y,0,e.z,t.z,n.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,n=e.elements,i=1/F_.setFromMatrixColumn(e,0).length(),r=1/F_.setFromMatrixColumn(e,1).length(),o=1/F_.setFromMatrixColumn(e,2).length();return t[0]=n[0]*i,t[1]=n[1]*i,t[2]=n[2]*i,t[3]=0,t[4]=n[4]*r,t[5]=n[5]*r,t[6]=n[6]*r,t[7]=0,t[8]=n[8]*o,t[9]=n[9]*o,t[10]=n[10]*o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){const t=this.elements,n=e.x,i=e.y,r=e.z,o=Math.cos(n),a=Math.sin(n),s=Math.cos(i),l=Math.sin(i),p=Math.cos(r),u=Math.sin(r);if("XYZ"===e.order){const e=o*p,n=o*u,i=a*p,r=a*u;t[0]=s*p,t[4]=-s*u,t[8]=l,t[1]=n+i*l,t[5]=e-r*l,t[9]=-a*s,t[2]=r-e*l,t[6]=i+n*l,t[10]=o*s}else if("YXZ"===e.order){const e=s*p,n=s*u,i=l*p,r=l*u;t[0]=e+r*a,t[4]=i*a-n,t[8]=o*l,t[1]=o*u,t[5]=o*p,t[9]=-a,t[2]=n*a-i,t[6]=r+e*a,t[10]=o*s}else if("ZXY"===e.order){const e=s*p,n=s*u,i=l*p,r=l*u;t[0]=e-r*a,t[4]=-o*u,t[8]=i+n*a,t[1]=n+i*a,t[5]=o*p,t[9]=r-e*a,t[2]=-o*l,t[6]=a,t[10]=o*s}else if("ZYX"===e.order){const e=o*p,n=o*u,i=a*p,r=a*u;t[0]=s*p,t[4]=i*l-n,t[8]=e*l+r,t[1]=s*u,t[5]=r*l+e,t[9]=n*l-i,t[2]=-l,t[6]=a*s,t[10]=o*s}else if("YZX"===e.order){const e=o*s,n=o*l,i=a*s,r=a*l;t[0]=s*p,t[4]=r-e*u,t[8]=i*u+n,t[1]=u,t[5]=o*p,t[9]=-a*p,t[2]=-l*p,t[6]=n*u+i,t[10]=e-r*u}else if("XZY"===e.order){const e=o*s,n=o*l,i=a*s,r=a*l;t[0]=s*p,t[4]=-u,t[8]=l*p,t[1]=e*u+r,t[5]=o*p,t[9]=n*u-i,t[2]=i*u-n,t[6]=a*p,t[10]=r*u+e}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(G_,e,U_)}lookAt(e,t,n){const i=this.elements;return q_.subVectors(e,t),0===q_.lengthSq()&&(q_.z=1),q_.normalize(),j_.crossVectors(n,q_),0===j_.lengthSq()&&(1===Math.abs(n.z)?q_.x+=1e-4:q_.z+=1e-4,q_.normalize(),j_.crossVectors(n,q_)),j_.normalize(),W_.crossVectors(q_,j_),i[0]=j_.x,i[4]=W_.x,i[8]=q_.x,i[1]=j_.y,i[5]=W_.y,i[9]=q_.y,i[2]=j_.z,i[6]=W_.z,i[10]=q_.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,i=t.elements,r=this.elements,o=n[0],a=n[4],s=n[8],l=n[12],p=n[1],u=n[5],h=n[9],c=n[13],_=n[2],d=n[6],m=n[10],P=n[14],f=n[3],x=n[7],y=n[11],v=n[15],g=i[0],b=i[4],z=i[8],w=i[12],Z=i[1],E=i[5],M=i[9],S=i[13],C=i[2],N=i[6],A=i[10],L=i[14],B=i[3],T=i[7],V=i[11],k=i[15];return r[0]=o*g+a*Z+s*C+l*B,r[4]=o*b+a*E+s*N+l*T,r[8]=o*z+a*M+s*A+l*V,r[12]=o*w+a*S+s*L+l*k,r[1]=p*g+u*Z+h*C+c*B,r[5]=p*b+u*E+h*N+c*T,r[9]=p*z+u*M+h*A+c*V,r[13]=p*w+u*S+h*L+c*k,r[2]=_*g+d*Z+m*C+P*B,r[6]=_*b+d*E+m*N+P*T,r[10]=_*z+d*M+m*A+P*V,r[14]=_*w+d*S+m*L+P*k,r[3]=f*g+x*Z+y*C+v*B,r[7]=f*b+x*E+y*N+v*T,r[11]=f*z+x*M+y*A+v*V,r[15]=f*w+x*S+y*L+v*k,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[4],i=e[8],r=e[12],o=e[1],a=e[5],s=e[9],l=e[13],p=e[2],u=e[6],h=e[10],c=e[14];return e[3]*(+r*s*u-i*l*u-r*a*h+n*l*h+i*a*c-n*s*c)+e[7]*(+t*s*c-t*l*h+r*o*h-i*o*c+i*l*p-r*s*p)+e[11]*(+t*l*u-t*a*c-r*o*u+n*o*c+r*a*p-n*l*p)+e[15]*(-i*a*p-t*s*u+t*a*h+i*o*u-n*o*h+n*s*p)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,n){const i=this.elements;return e.isVector3?(i[12]=e.x,i[13]=e.y,i[14]=e.z):(i[12]=e,i[13]=t,i[14]=n),this}invert(){const e=this.elements,t=e[0],n=e[1],i=e[2],r=e[3],o=e[4],a=e[5],s=e[6],l=e[7],p=e[8],u=e[9],h=e[10],c=e[11],_=e[12],d=e[13],m=e[14],P=e[15],f=u*m*l-d*h*l+d*s*c-a*m*c-u*s*P+a*h*P,x=_*h*l-p*m*l-_*s*c+o*m*c+p*s*P-o*h*P,y=p*d*l-_*u*l+_*a*c-o*d*c-p*a*P+o*u*P,v=_*u*s-p*d*s-_*a*h+o*d*h+p*a*m-o*u*m,g=t*f+n*x+i*y+r*v;if(0===g)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const b=1/g;return e[0]=f*b,e[1]=(d*h*r-u*m*r-d*i*c+n*m*c+u*i*P-n*h*P)*b,e[2]=(a*m*r-d*s*r+d*i*l-n*m*l-a*i*P+n*s*P)*b,e[3]=(u*s*r-a*h*r-u*i*l+n*h*l+a*i*c-n*s*c)*b,e[4]=x*b,e[5]=(p*m*r-_*h*r+_*i*c-t*m*c-p*i*P+t*h*P)*b,e[6]=(_*s*r-o*m*r-_*i*l+t*m*l+o*i*P-t*s*P)*b,e[7]=(o*h*r-p*s*r+p*i*l-t*h*l-o*i*c+t*s*c)*b,e[8]=y*b,e[9]=(_*u*r-p*d*r-_*n*c+t*d*c+p*n*P-t*u*P)*b,e[10]=(o*d*r-_*a*r+_*n*l-t*d*l-o*n*P+t*a*P)*b,e[11]=(p*a*r-o*u*r-p*n*l+t*u*l+o*n*c-t*a*c)*b,e[12]=v*b,e[13]=(p*d*i-_*u*i+_*n*h-t*d*h-p*n*m+t*u*m)*b,e[14]=(_*a*i-o*d*i-_*n*s+t*d*s+o*n*m-t*a*m)*b,e[15]=(o*u*i-p*a*i+p*n*s-t*u*s-o*n*h+t*a*h)*b,this}scale(e){const t=this.elements,n=e.x,i=e.y,r=e.z;return t[0]*=n,t[4]*=i,t[8]*=r,t[1]*=n,t[5]*=i,t[9]*=r,t[2]*=n,t[6]*=i,t[10]*=r,t[3]*=n,t[7]*=i,t[11]*=r,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],i=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,n,i))}makeTranslation(e,t,n){return this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const n=Math.cos(t),i=Math.sin(t),r=1-n,o=e.x,a=e.y,s=e.z,l=r*o,p=r*a;return this.set(l*o+n,l*a-i*s,l*s+i*a,0,l*a+i*s,p*a+n,p*s-i*o,0,l*s-i*a,p*s+i*o,r*s*s+n,0,0,0,0,1),this}makeScale(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this}makeShear(e,t,n,i,r,o){return this.set(1,n,r,0,e,1,o,0,t,i,1,0,0,0,0,1),this}compose(e,t,n){const i=this.elements,r=t._x,o=t._y,a=t._z,s=t._w,l=r+r,p=o+o,u=a+a,h=r*l,c=r*p,_=r*u,d=o*p,m=o*u,P=a*u,f=s*l,x=s*p,y=s*u,v=n.x,g=n.y,b=n.z;return i[0]=(1-(d+P))*v,i[1]=(c+y)*v,i[2]=(_-x)*v,i[3]=0,i[4]=(c-y)*g,i[5]=(1-(h+P))*g,i[6]=(m+f)*g,i[7]=0,i[8]=(_+x)*b,i[9]=(m-f)*b,i[10]=(1-(h+d))*b,i[11]=0,i[12]=e.x,i[13]=e.y,i[14]=e.z,i[15]=1,this}decompose(e,t,n){const i=this.elements;let r=F_.set(i[0],i[1],i[2]).length();const o=F_.set(i[4],i[5],i[6]).length(),a=F_.set(i[8],i[9],i[10]).length();this.determinant()<0&&(r=-r),e.x=i[12],e.y=i[13],e.z=i[14],D_.copy(this);const s=1/r,l=1/o,p=1/a;return D_.elements[0]*=s,D_.elements[1]*=s,D_.elements[2]*=s,D_.elements[4]*=l,D_.elements[5]*=l,D_.elements[6]*=l,D_.elements[8]*=p,D_.elements[9]*=p,D_.elements[10]*=p,t.setFromRotationMatrix(D_),n.x=r,n.y=o,n.z=a,this}makePerspective(e,t,n,i,r,o){const a=this.elements,s=2*r/(t-e),l=2*r/(n-i),p=(t+e)/(t-e),u=(n+i)/(n-i),h=-(o+r)/(o-r),c=-2*o*r/(o-r);return a[0]=s,a[4]=0,a[8]=p,a[12]=0,a[1]=0,a[5]=l,a[9]=u,a[13]=0,a[2]=0,a[6]=0,a[10]=h,a[14]=c,a[3]=0,a[7]=0,a[11]=-1,a[15]=0,this}makeOrthographic(e,t,n,i,r,o){const a=this.elements,s=1/(t-e),l=1/(n-i),p=1/(o-r),u=(t+e)*s,h=(n+i)*l,c=(o+r)*p;return a[0]=2*s,a[4]=0,a[8]=0,a[12]=-u,a[1]=0,a[5]=2*l,a[9]=0,a[13]=-h,a[2]=0,a[6]=0,a[10]=-2*p,a[14]=-c,a[3]=0,a[7]=0,a[11]=0,a[15]=1,this}equals(e){const t=this.elements,n=e.elements;for(let e=0;e<16;e++)if(t[e]!==n[e])return!1;return!0}fromArray(e,t=0){for(let n=0;n<16;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e}}const F_=new p_,D_=new H_,G_=new p_(0,0,0),U_=new p_(1,1,1),j_=new p_,W_=new p_,q_=new p_,J_=new H_,$_=new l_;class X_{constructor(e=0,t=0,n=0,i=X_.DefaultOrder){this.isEuler=!0,this._x=e,this._y=t,this._z=n,this._order=i}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,n,i=this._order){return this._x=e,this._y=t,this._z=n,this._order=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,n=!0){const i=e.elements,r=i[0],o=i[4],a=i[8],s=i[1],l=i[5],p=i[9],u=i[2],h=i[6],c=i[10];switch(t){case"XYZ":this._y=Math.asin(Nc(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-p,c),this._z=Math.atan2(-o,r)):(this._x=Math.atan2(h,l),this._z=0);break;case"YXZ":this._x=Math.asin(-Nc(p,-1,1)),Math.abs(p)<.9999999?(this._y=Math.atan2(a,c),this._z=Math.atan2(s,l)):(this._y=Math.atan2(-u,r),this._z=0);break;case"ZXY":this._x=Math.asin(Nc(h,-1,1)),Math.abs(h)<.9999999?(this._y=Math.atan2(-u,c),this._z=Math.atan2(-o,l)):(this._y=0,this._z=Math.atan2(s,r));break;case"ZYX":this._y=Math.asin(-Nc(u,-1,1)),Math.abs(u)<.9999999?(this._x=Math.atan2(h,c),this._z=Math.atan2(s,r)):(this._x=0,this._z=Math.atan2(-o,l));break;case"YZX":this._z=Math.asin(Nc(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(-p,l),this._y=Math.atan2(-u,r)):(this._x=0,this._y=Math.atan2(a,c));break;case"XZY":this._z=Math.asin(-Nc(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(h,l),this._y=Math.atan2(a,r)):(this._x=Math.atan2(-p,c),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,!0===n&&this._onChangeCallback(),this}setFromQuaternion(e,t,n){return J_.makeRotationFromQuaternion(e),this.setFromRotationMatrix(J_,t,n)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return $_.setFromEuler(this),this.setFromQuaternion($_,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}toVector3(){console.error("THREE.Euler: .toVector3() has been removed. Use Vector3.setFromEuler() instead")}}X_.DefaultOrder="XYZ",X_.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];class Y_{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return 0!=(this.mask&e.mask)}isEnabled(e){return 0!=(this.mask&(1<<e|0))}}let K_=0;const Q_=new p_,ed=new l_,td=new H_,nd=new p_,id=new p_,rd=new p_,od=new l_,ad=new p_(1,0,0),sd=new p_(0,1,0),ld=new p_(0,0,1),pd={type:"added"},ud={type:"removed"};class hd extends wc{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:K_++}),this.uuid=Cc(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=hd.DefaultUp.clone();const e=new p_,t=new X_,n=new l_,i=new p_(1,1,1);t._onChange((function(){n.setFromEuler(t,!1)})),n._onChange((function(){t.setFromQuaternion(n,void 0,!1)})),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:i},modelViewMatrix:{value:new H_},normalMatrix:{value:new Rc}}),this.matrix=new H_,this.matrixWorld=new H_,this.matrixAutoUpdate=hd.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.matrixWorldAutoUpdate=hd.DefaultMatrixWorldAutoUpdate,this.layers=new Y_,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return ed.setFromAxisAngle(e,t),this.quaternion.multiply(ed),this}rotateOnWorldAxis(e,t){return ed.setFromAxisAngle(e,t),this.quaternion.premultiply(ed),this}rotateX(e){return this.rotateOnAxis(ad,e)}rotateY(e){return this.rotateOnAxis(sd,e)}rotateZ(e){return this.rotateOnAxis(ld,e)}translateOnAxis(e,t){return Q_.copy(e).applyQuaternion(this.quaternion),this.position.add(Q_.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(ad,e)}translateY(e){return this.translateOnAxis(sd,e)}translateZ(e){return this.translateOnAxis(ld,e)}localToWorld(e){return e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return e.applyMatrix4(td.copy(this.matrixWorld).invert())}lookAt(e,t,n){e.isVector3?nd.copy(e):nd.set(e,t,n);const i=this.parent;this.updateWorldMatrix(!0,!1),id.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?td.lookAt(id,nd,this.up):td.lookAt(nd,id,this.up),this.quaternion.setFromRotationMatrix(td),i&&(td.extractRotation(i.matrixWorld),ed.setFromRotationMatrix(td),this.quaternion.premultiply(ed.invert()))}add(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(null!==e.parent&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(pd)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.remove(arguments[e]);return this}const t=this.children.indexOf(e);return-1!==t&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(ud)),this}removeFromParent(){const e=this.parent;return null!==e&&e.remove(this),this}clear(){for(let e=0;e<this.children.length;e++){const t=this.children[e];t.parent=null,t.dispatchEvent(ud)}return this.children.length=0,this}attach(e){return this.updateWorldMatrix(!0,!1),td.copy(this.matrixWorld).invert(),null!==e.parent&&(e.parent.updateWorldMatrix(!0,!1),td.multiply(e.parent.matrixWorld)),e.applyMatrix4(td),this.add(e),e.updateWorldMatrix(!1,!0),this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let n=0,i=this.children.length;n<i;n++){const i=this.children[n].getObjectByProperty(e,t);if(void 0!==i)return i}}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(id,e,rd),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(id,od,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let n=0,i=t.length;n<i;n++)t[n].traverse(e)}traverseVisible(e){if(!1===this.visible)return;e(this);const t=this.children;for(let n=0,i=t.length;n<i;n++)t[n].traverseVisible(e)}traverseAncestors(e){const t=this.parent;null!==t&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let n=0,i=t.length;n<i;n++){const i=t[n];!0!==i.matrixWorldAutoUpdate&&!0!==e||i.updateMatrixWorld(e)}}updateWorldMatrix(e,t){const n=this.parent;if(!0===e&&null!==n&&!0===n.matrixWorldAutoUpdate&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===t){const e=this.children;for(let t=0,n=e.length;t<n;t++){const n=e[t];!0===n.matrixWorldAutoUpdate&&n.updateWorldMatrix(!1,!0)}}}toJSON(e){const t=void 0===e||"string"==typeof e,n={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},n.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});const i={};function r(t,n){return void 0===t[n.uuid]&&(t[n.uuid]=n.toJSON(e)),n.uuid}if(i.uuid=this.uuid,i.type=this.type,""!==this.name&&(i.name=this.name),!0===this.castShadow&&(i.castShadow=!0),!0===this.receiveShadow&&(i.receiveShadow=!0),!1===this.visible&&(i.visible=!1),!1===this.frustumCulled&&(i.frustumCulled=!1),0!==this.renderOrder&&(i.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(i.userData=this.userData),i.layers=this.layers.mask,i.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(i.matrixAutoUpdate=!1),this.isInstancedMesh&&(i.type="InstancedMesh",i.count=this.count,i.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(i.instanceColor=this.instanceColor.toJSON())),this.isScene)this.background&&(this.background.isColor?i.background=this.background.toJSON():this.background.isTexture&&(i.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&!0!==this.environment.isRenderTargetTexture&&(i.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){i.geometry=r(e.geometries,this.geometry);const t=this.geometry.parameters;if(void 0!==t&&void 0!==t.shapes){const n=t.shapes;if(Array.isArray(n))for(let t=0,i=n.length;t<i;t++){const i=n[t];r(e.shapes,i)}else r(e.shapes,n)}}if(this.isSkinnedMesh&&(i.bindMode=this.bindMode,i.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(r(e.skeletons,this.skeleton),i.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){const t=[];for(let n=0,i=this.material.length;n<i;n++)t.push(r(e.materials,this.material[n]));i.material=t}else i.material=r(e.materials,this.material);if(this.children.length>0){i.children=[];for(let t=0;t<this.children.length;t++)i.children.push(this.children[t].toJSON(e).object)}if(this.animations.length>0){i.animations=[];for(let t=0;t<this.animations.length;t++){const n=this.animations[t];i.animations.push(r(e.animations,n))}}if(t){const t=o(e.geometries),i=o(e.materials),r=o(e.textures),a=o(e.images),s=o(e.shapes),l=o(e.skeletons),p=o(e.animations),u=o(e.nodes);t.length>0&&(n.geometries=t),i.length>0&&(n.materials=i),r.length>0&&(n.textures=r),a.length>0&&(n.images=a),s.length>0&&(n.shapes=s),l.length>0&&(n.skeletons=l),p.length>0&&(n.animations=p),u.length>0&&(n.nodes=u)}return n.object=i,n;function o(e){const t=[];for(const n in e){const i=e[n];delete i.metadata,t.push(i)}return t}}clone(e){return(new this.constructor).copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),!0===t)for(let t=0;t<e.children.length;t++){const n=e.children[t];this.add(n.clone())}return this}}hd.DefaultUp=new p_(0,1,0),hd.DefaultMatrixAutoUpdate=!0,hd.DefaultMatrixWorldAutoUpdate=!0;const cd=new p_,_d=new p_,dd=new p_,md=new p_,Pd=new p_,fd=new p_,xd=new p_,yd=new p_,vd=new p_,gd=new p_;class bd{constructor(e=new p_,t=new p_,n=new p_){this.a=e,this.b=t,this.c=n}static getNormal(e,t,n,i){i.subVectors(n,t),cd.subVectors(e,t),i.cross(cd);const r=i.lengthSq();return r>0?i.multiplyScalar(1/Math.sqrt(r)):i.set(0,0,0)}static getBarycoord(e,t,n,i,r){cd.subVectors(i,t),_d.subVectors(n,t),dd.subVectors(e,t);const o=cd.dot(cd),a=cd.dot(_d),s=cd.dot(dd),l=_d.dot(_d),p=_d.dot(dd),u=o*l-a*a;if(0===u)return r.set(-2,-1,-1);const h=1/u,c=(l*s-a*p)*h,_=(o*p-a*s)*h;return r.set(1-c-_,_,c)}static containsPoint(e,t,n,i){return this.getBarycoord(e,t,n,i,md),md.x>=0&&md.y>=0&&md.x+md.y<=1}static getUV(e,t,n,i,r,o,a,s){return this.getBarycoord(e,t,n,i,md),s.set(0,0),s.addScaledVector(r,md.x),s.addScaledVector(o,md.y),s.addScaledVector(a,md.z),s}static isFrontFacing(e,t,n,i){return cd.subVectors(n,t),_d.subVectors(e,t),cd.cross(_d).dot(i)<0}set(e,t,n){return this.a.copy(e),this.b.copy(t),this.c.copy(n),this}setFromPointsAndIndices(e,t,n,i){return this.a.copy(e[t]),this.b.copy(e[n]),this.c.copy(e[i]),this}setFromAttributeAndIndices(e,t,n,i){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,n),this.c.fromBufferAttribute(e,i),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return cd.subVectors(this.c,this.b),_d.subVectors(this.a,this.b),.5*cd.cross(_d).length()}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return bd.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return bd.getBarycoord(e,this.a,this.b,this.c,t)}getUV(e,t,n,i,r){return bd.getUV(e,this.a,this.b,this.c,t,n,i,r)}containsPoint(e){return bd.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return bd.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const n=this.a,i=this.b,r=this.c;let o,a;Pd.subVectors(i,n),fd.subVectors(r,n),yd.subVectors(e,n);const s=Pd.dot(yd),l=fd.dot(yd);if(s<=0&&l<=0)return t.copy(n);vd.subVectors(e,i);const p=Pd.dot(vd),u=fd.dot(vd);if(p>=0&&u<=p)return t.copy(i);const h=s*u-p*l;if(h<=0&&s>=0&&p<=0)return o=s/(s-p),t.copy(n).addScaledVector(Pd,o);gd.subVectors(e,r);const c=Pd.dot(gd),_=fd.dot(gd);if(_>=0&&c<=_)return t.copy(r);const d=c*l-s*_;if(d<=0&&l>=0&&_<=0)return a=l/(l-_),t.copy(n).addScaledVector(fd,a);const m=p*_-c*u;if(m<=0&&u-p>=0&&c-_>=0)return xd.subVectors(r,i),a=(u-p)/(u-p+(c-_)),t.copy(i).addScaledVector(xd,a);const P=1/(m+d+h);return o=d*P,a=h*P,t.copy(n).addScaledVector(Pd,o).addScaledVector(fd,a)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}let zd=0;class wd extends wc{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:zd++}),this.uuid=Cc(),this.name="",this.type="Material",this.blending=1,this.side=0,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=204,this.blendDst=205,this.blendEquation=Gh,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=3,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=519,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=gc,this.stencilZFail=gc,this.stencilZPass=gc,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(void 0!==e)for(const t in e){const n=e[t];if(void 0===n){console.warn("THREE.Material: '"+t+"' parameter is undefined.");continue}const i=this[t];void 0!==i?i&&i.isColor?i.set(n):i&&i.isVector3&&n&&n.isVector3?i.copy(n):this[t]=n:console.warn("THREE."+this.type+": '"+t+"' is not a property of this material.")}}toJSON(e){const t=void 0===e||"string"==typeof e;t&&(e={textures:{},images:{}});const n={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function i(e){const t=[];for(const n in e){const i=e[n];delete i.metadata,t.push(i)}return t}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),void 0!==this.roughness&&(n.roughness=this.roughness),void 0!==this.metalness&&(n.metalness=this.metalness),void 0!==this.sheen&&(n.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(n.sheenColor=this.sheenColor.getHex()),void 0!==this.sheenRoughness&&(n.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),void 0!==this.specularIntensity&&(n.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(n.specularColor=this.specularColor.getHex()),void 0!==this.shininess&&(n.shininess=this.shininess),void 0!==this.clearcoat&&(n.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),void 0!==this.iridescence&&(n.iridescence=this.iridescence),void 0!==this.iridescenceIOR&&(n.iridescenceIOR=this.iridescenceIOR),void 0!==this.iridescenceThicknessRange&&(n.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(n.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(n.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(e).uuid,n.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(e).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(e).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(e).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(e).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(n.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(n.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(e).uuid,void 0!==this.combine&&(n.combine=this.combine)),void 0!==this.envMapIntensity&&(n.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(n.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(n.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(e).uuid),void 0!==this.transmission&&(n.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(n.transmissionMap=this.transmissionMap.toJSON(e).uuid),void 0!==this.thickness&&(n.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(n.thicknessMap=this.thicknessMap.toJSON(e).uuid),void 0!==this.attenuationDistance&&(n.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationColor&&(n.attenuationColor=this.attenuationColor.getHex()),void 0!==this.size&&(n.size=this.size),null!==this.shadowSide&&(n.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(n.sizeAttenuation=this.sizeAttenuation),1!==this.blending&&(n.blending=this.blending),0!==this.side&&(n.side=this.side),this.vertexColors&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),!0===this.transparent&&(n.transparent=this.transparent),n.depthFunc=this.depthFunc,n.depthTest=this.depthTest,n.depthWrite=this.depthWrite,n.colorWrite=this.colorWrite,n.stencilWrite=this.stencilWrite,n.stencilWriteMask=this.stencilWriteMask,n.stencilFunc=this.stencilFunc,n.stencilRef=this.stencilRef,n.stencilFuncMask=this.stencilFuncMask,n.stencilFail=this.stencilFail,n.stencilZFail=this.stencilZFail,n.stencilZPass=this.stencilZPass,void 0!==this.rotation&&0!==this.rotation&&(n.rotation=this.rotation),!0===this.polygonOffset&&(n.polygonOffset=!0),0!==this.polygonOffsetFactor&&(n.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(n.polygonOffsetUnits=this.polygonOffsetUnits),void 0!==this.linewidth&&1!==this.linewidth&&(n.linewidth=this.linewidth),void 0!==this.dashSize&&(n.dashSize=this.dashSize),void 0!==this.gapSize&&(n.gapSize=this.gapSize),void 0!==this.scale&&(n.scale=this.scale),!0===this.dithering&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),!0===this.alphaToCoverage&&(n.alphaToCoverage=this.alphaToCoverage),!0===this.premultipliedAlpha&&(n.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(n.wireframe=this.wireframe),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(n.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(n.wireframeLinejoin=this.wireframeLinejoin),!0===this.flatShading&&(n.flatShading=this.flatShading),!1===this.visible&&(n.visible=!1),!1===this.toneMapped&&(n.toneMapped=!1),!1===this.fog&&(n.fog=!1),"{}"!==JSON.stringify(this.userData)&&(n.userData=this.userData),t){const t=i(e.textures),r=i(e.images);t.length>0&&(n.textures=t),r.length>0&&(n.images=r)}return n}clone(){return(new this.constructor).copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let n=null;if(null!==t){const e=t.length;n=new Array(e);for(let i=0;i!==e;++i)n[i]=t[i].clone()}return this.clippingPlanes=n,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){!0===e&&this.version++}}class Zd extends wd{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new Kc(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const Ed=new p_,Md=new Oc;class Sd{constructor(e,t,n){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=e,this.itemSize=t,this.count=void 0!==e?e.length/t:0,this.normalized=!0===n,this.usage=35044,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this}copyAt(e,t,n){e*=this.itemSize,n*=t.itemSize;for(let i=0,r=this.itemSize;i<r;i++)this.array[e+i]=t.array[n+i];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(2===this.itemSize)for(let t=0,n=this.count;t<n;t++)Md.fromBufferAttribute(this,t),Md.applyMatrix3(e),this.setXY(t,Md.x,Md.y);else if(3===this.itemSize)for(let t=0,n=this.count;t<n;t++)Ed.fromBufferAttribute(this,t),Ed.applyMatrix3(e),this.setXYZ(t,Ed.x,Ed.y,Ed.z);return this}applyMatrix4(e){for(let t=0,n=this.count;t<n;t++)Ed.fromBufferAttribute(this,t),Ed.applyMatrix4(e),this.setXYZ(t,Ed.x,Ed.y,Ed.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)Ed.fromBufferAttribute(this,t),Ed.applyNormalMatrix(e),this.setXYZ(t,Ed.x,Ed.y,Ed.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)Ed.fromBufferAttribute(this,t),Ed.transformDirection(e),this.setXYZ(t,Ed.x,Ed.y,Ed.z);return this}set(e,t=0){return this.array.set(e,t),this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=Vc(t,this.array)),t}setX(e,t){return this.normalized&&(t=kc(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=Vc(t,this.array)),t}setY(e,t){return this.normalized&&(t=kc(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=Vc(t,this.array)),t}setZ(e,t){return this.normalized&&(t=kc(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=Vc(t,this.array)),t}setW(e,t){return this.normalized&&(t=kc(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,n){return e*=this.itemSize,this.normalized&&(t=kc(t,this.array),n=kc(n,this.array)),this.array[e+0]=t,this.array[e+1]=n,this}setXYZ(e,t,n,i){return e*=this.itemSize,this.normalized&&(t=kc(t,this.array),n=kc(n,this.array),i=kc(i,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=i,this}setXYZW(e,t,n,i,r){return e*=this.itemSize,this.normalized&&(t=kc(t,this.array),n=kc(n,this.array),i=kc(i,this.array),r=kc(r,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=i,this.array[e+3]=r,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return""!==this.name&&(e.name=this.name),35044!==this.usage&&(e.usage=this.usage),0===this.updateRange.offset&&-1===this.updateRange.count||(e.updateRange=this.updateRange),e}copyColorsArray(){console.error("THREE.BufferAttribute: copyColorsArray() was removed in r144.")}copyVector2sArray(){console.error("THREE.BufferAttribute: copyVector2sArray() was removed in r144.")}copyVector3sArray(){console.error("THREE.BufferAttribute: copyVector3sArray() was removed in r144.")}copyVector4sArray(){console.error("THREE.BufferAttribute: copyVector4sArray() was removed in r144.")}}class Cd extends Sd{constructor(e,t,n){super(new Uint16Array(e),t,n)}}class Nd extends Sd{constructor(e,t,n){super(new Uint32Array(e),t,n)}}class Ad extends Sd{constructor(e,t,n){super(new Float32Array(e),t,n)}}let Ld=0;const Bd=new H_,Td=new hd,Vd=new p_,kd=new c_,Id=new c_,Od=new p_;class Rd extends wc{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:Ld++}),this.uuid=Cc(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(Hc(e)?Nd:Cd)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return void 0!==this.attributes[e]}addGroup(e,t,n=0){this.groups.push({start:e,count:t,materialIndex:n})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;void 0!==t&&(t.applyMatrix4(e),t.needsUpdate=!0);const n=this.attributes.normal;if(void 0!==n){const t=(new Rc).getNormalMatrix(e);n.applyNormalMatrix(t),n.needsUpdate=!0}const i=this.attributes.tangent;return void 0!==i&&(i.transformDirection(e),i.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}applyQuaternion(e){return Bd.makeRotationFromQuaternion(e),this.applyMatrix4(Bd),this}rotateX(e){return Bd.makeRotationX(e),this.applyMatrix4(Bd),this}rotateY(e){return Bd.makeRotationY(e),this.applyMatrix4(Bd),this}rotateZ(e){return Bd.makeRotationZ(e),this.applyMatrix4(Bd),this}translate(e,t,n){return Bd.makeTranslation(e,t,n),this.applyMatrix4(Bd),this}scale(e,t,n){return Bd.makeScale(e,t,n),this.applyMatrix4(Bd),this}lookAt(e){return Td.lookAt(e),Td.updateMatrix(),this.applyMatrix4(Td.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(Vd).negate(),this.translate(Vd.x,Vd.y,Vd.z),this}setFromPoints(e){const t=[];for(let n=0,i=e.length;n<i;n++){const i=e[n];t.push(i.x,i.y,i.z||0)}return this.setAttribute("position",new Ad(t,3)),this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new c_);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingBox.set(new p_(-1/0,-1/0,-1/0),new p_(1/0,1/0,1/0));if(void 0!==e){if(this.boundingBox.setFromBufferAttribute(e),t)for(let e=0,n=t.length;e<n;e++){const n=t[e];kd.setFromBufferAttribute(n),this.morphTargetsRelative?(Od.addVectors(this.boundingBox.min,kd.min),this.boundingBox.expandByPoint(Od),Od.addVectors(this.boundingBox.max,kd.max),this.boundingBox.expandByPoint(Od)):(this.boundingBox.expandByPoint(kd.min),this.boundingBox.expandByPoint(kd.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new A_);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingSphere.set(new p_,1/0);if(e){const n=this.boundingSphere.center;if(kd.setFromBufferAttribute(e),t)for(let e=0,n=t.length;e<n;e++){const n=t[e];Id.setFromBufferAttribute(n),this.morphTargetsRelative?(Od.addVectors(kd.min,Id.min),kd.expandByPoint(Od),Od.addVectors(kd.max,Id.max),kd.expandByPoint(Od)):(kd.expandByPoint(Id.min),kd.expandByPoint(Id.max))}kd.getCenter(n);let i=0;for(let t=0,r=e.count;t<r;t++)Od.fromBufferAttribute(e,t),i=Math.max(i,n.distanceToSquared(Od));if(t)for(let r=0,o=t.length;r<o;r++){const o=t[r],a=this.morphTargetsRelative;for(let t=0,r=o.count;t<r;t++)Od.fromBufferAttribute(o,t),a&&(Vd.fromBufferAttribute(e,t),Od.add(Vd)),i=Math.max(i,n.distanceToSquared(Od))}this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,t=this.attributes;if(null===e||void 0===t.position||void 0===t.normal||void 0===t.uv)return void console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");const n=e.array,i=t.position.array,r=t.normal.array,o=t.uv.array,a=i.length/3;!1===this.hasAttribute("tangent")&&this.setAttribute("tangent",new Sd(new Float32Array(4*a),4));const s=this.getAttribute("tangent").array,l=[],p=[];for(let e=0;e<a;e++)l[e]=new p_,p[e]=new p_;const u=new p_,h=new p_,c=new p_,_=new Oc,d=new Oc,m=new Oc,P=new p_,f=new p_;function x(e,t,n){u.fromArray(i,3*e),h.fromArray(i,3*t),c.fromArray(i,3*n),_.fromArray(o,2*e),d.fromArray(o,2*t),m.fromArray(o,2*n),h.sub(u),c.sub(u),d.sub(_),m.sub(_);const r=1/(d.x*m.y-m.x*d.y);isFinite(r)&&(P.copy(h).multiplyScalar(m.y).addScaledVector(c,-d.y).multiplyScalar(r),f.copy(c).multiplyScalar(d.x).addScaledVector(h,-m.x).multiplyScalar(r),l[e].add(P),l[t].add(P),l[n].add(P),p[e].add(f),p[t].add(f),p[n].add(f))}let y=this.groups;0===y.length&&(y=[{start:0,count:n.length}]);for(let e=0,t=y.length;e<t;++e){const t=y[e],i=t.start;for(let e=i,r=i+t.count;e<r;e+=3)x(n[e+0],n[e+1],n[e+2])}const v=new p_,g=new p_,b=new p_,z=new p_;function w(e){b.fromArray(r,3*e),z.copy(b);const t=l[e];v.copy(t),v.sub(b.multiplyScalar(b.dot(t))).normalize(),g.crossVectors(z,t);const n=g.dot(p[e])<0?-1:1;s[4*e]=v.x,s[4*e+1]=v.y,s[4*e+2]=v.z,s[4*e+3]=n}for(let e=0,t=y.length;e<t;++e){const t=y[e],i=t.start;for(let e=i,r=i+t.count;e<r;e+=3)w(n[e+0]),w(n[e+1]),w(n[e+2])}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(void 0!==t){let n=this.getAttribute("normal");if(void 0===n)n=new Sd(new Float32Array(3*t.count),3),this.setAttribute("normal",n);else for(let e=0,t=n.count;e<t;e++)n.setXYZ(e,0,0,0);const i=new p_,r=new p_,o=new p_,a=new p_,s=new p_,l=new p_,p=new p_,u=new p_;if(e)for(let h=0,c=e.count;h<c;h+=3){const c=e.getX(h+0),_=e.getX(h+1),d=e.getX(h+2);i.fromBufferAttribute(t,c),r.fromBufferAttribute(t,_),o.fromBufferAttribute(t,d),p.subVectors(o,r),u.subVectors(i,r),p.cross(u),a.fromBufferAttribute(n,c),s.fromBufferAttribute(n,_),l.fromBufferAttribute(n,d),a.add(p),s.add(p),l.add(p),n.setXYZ(c,a.x,a.y,a.z),n.setXYZ(_,s.x,s.y,s.z),n.setXYZ(d,l.x,l.y,l.z)}else for(let e=0,a=t.count;e<a;e+=3)i.fromBufferAttribute(t,e+0),r.fromBufferAttribute(t,e+1),o.fromBufferAttribute(t,e+2),p.subVectors(o,r),u.subVectors(i,r),p.cross(u),n.setXYZ(e+0,p.x,p.y,p.z),n.setXYZ(e+1,p.x,p.y,p.z),n.setXYZ(e+2,p.x,p.y,p.z);this.normalizeNormals(),n.needsUpdate=!0}}merge(){return console.error("THREE.BufferGeometry.merge() has been removed. Use THREE.BufferGeometryUtils.mergeBufferGeometries() instead."),this}normalizeNormals(){const e=this.attributes.normal;for(let t=0,n=e.count;t<n;t++)Od.fromBufferAttribute(e,t),Od.normalize(),e.setXYZ(t,Od.x,Od.y,Od.z)}toNonIndexed(){function e(e,t){const n=e.array,i=e.itemSize,r=e.normalized,o=new n.constructor(t.length*i);let a=0,s=0;for(let r=0,l=t.length;r<l;r++){a=e.isInterleavedBufferAttribute?t[r]*e.data.stride+e.offset:t[r]*i;for(let e=0;e<i;e++)o[s++]=n[a++]}return new Sd(o,i,r)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new Rd,n=this.index.array,i=this.attributes;for(const r in i){const o=e(i[r],n);t.setAttribute(r,o)}const r=this.morphAttributes;for(const i in r){const o=[],a=r[i];for(let t=0,i=a.length;t<i;t++){const i=e(a[t],n);o.push(i)}t.morphAttributes[i]=o}t.morphTargetsRelative=this.morphTargetsRelative;const o=this.groups;for(let e=0,n=o.length;e<n;e++){const n=o[e];t.addGroup(n.start,n.count,n.materialIndex)}return t}toJSON(){const e={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),void 0!==this.parameters){const t=this.parameters;for(const n in t)void 0!==t[n]&&(e[n]=t[n]);return e}e.data={attributes:{}};const t=this.index;null!==t&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const n=this.attributes;for(const t in n){const i=n[t];e.data.attributes[t]=i.toJSON(e.data)}const i={};let r=!1;for(const t in this.morphAttributes){const n=this.morphAttributes[t],o=[];for(let t=0,i=n.length;t<i;t++){const i=n[t];o.push(i.toJSON(e.data))}o.length>0&&(i[t]=o,r=!0)}r&&(e.data.morphAttributes=i,e.data.morphTargetsRelative=this.morphTargetsRelative);const o=this.groups;o.length>0&&(e.data.groups=JSON.parse(JSON.stringify(o)));const a=this.boundingSphere;return null!==a&&(e.data.boundingSphere={center:a.center.toArray(),radius:a.radius}),e}clone(){return(new this.constructor).copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const n=e.index;null!==n&&this.setIndex(n.clone(t));const i=e.attributes;for(const e in i){const n=i[e];this.setAttribute(e,n.clone(t))}const r=e.morphAttributes;for(const e in r){const n=[],i=r[e];for(let e=0,r=i.length;e<r;e++)n.push(i[e].clone(t));this.morphAttributes[e]=n}this.morphTargetsRelative=e.morphTargetsRelative;const o=e.groups;for(let e=0,t=o.length;e<t;e++){const t=o[e];this.addGroup(t.start,t.count,t.materialIndex)}const a=e.boundingBox;null!==a&&(this.boundingBox=a.clone());const s=e.boundingSphere;return null!==s&&(this.boundingSphere=s.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,void 0!==e.parameters&&(this.parameters=Object.assign({},e.parameters)),this}dispose(){this.dispatchEvent({type:"dispose"})}}const Hd=new H_,Fd=new R_,Dd=new A_,Gd=new p_,Ud=new p_,jd=new p_,Wd=new p_,qd=new p_,Jd=new p_,$d=new p_,Xd=new p_,Yd=new p_,Kd=new Oc,Qd=new Oc,em=new Oc,tm=new p_,nm=new p_;class im extends hd{constructor(e=new Rd,t=new Zd){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),void 0!==e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),void 0!==e.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=e.material,this.geometry=e.geometry,this}updateMorphTargets(){const e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){const n=e[t[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,t=n.length;e<t;e++){const t=n[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[t]=e}}}}raycast(e,t){const n=this.geometry,i=this.material,r=this.matrixWorld;if(void 0===i)return;if(null===n.boundingSphere&&n.computeBoundingSphere(),Dd.copy(n.boundingSphere),Dd.applyMatrix4(r),!1===e.ray.intersectsSphere(Dd))return;if(Hd.copy(r).invert(),Fd.copy(e.ray).applyMatrix4(Hd),null!==n.boundingBox&&!1===Fd.intersectsBox(n.boundingBox))return;let o;const a=n.index,s=n.attributes.position,l=n.morphAttributes.position,p=n.morphTargetsRelative,u=n.attributes.uv,h=n.attributes.uv2,c=n.groups,_=n.drawRange;if(null!==a)if(Array.isArray(i))for(let n=0,r=c.length;n<r;n++){const r=c[n],d=i[r.materialIndex];for(let n=Math.max(r.start,_.start),i=Math.min(a.count,Math.min(r.start+r.count,_.start+_.count));n<i;n+=3){const i=a.getX(n),c=a.getX(n+1),_=a.getX(n+2);o=rm(this,d,e,Fd,s,l,p,u,h,i,c,_),o&&(o.faceIndex=Math.floor(n/3),o.face.materialIndex=r.materialIndex,t.push(o))}}else for(let n=Math.max(0,_.start),r=Math.min(a.count,_.start+_.count);n<r;n+=3){const r=a.getX(n),c=a.getX(n+1),_=a.getX(n+2);o=rm(this,i,e,Fd,s,l,p,u,h,r,c,_),o&&(o.faceIndex=Math.floor(n/3),t.push(o))}else if(void 0!==s)if(Array.isArray(i))for(let n=0,r=c.length;n<r;n++){const r=c[n],a=i[r.materialIndex];for(let n=Math.max(r.start,_.start),i=Math.min(s.count,Math.min(r.start+r.count,_.start+_.count));n<i;n+=3)o=rm(this,a,e,Fd,s,l,p,u,h,n,n+1,n+2),o&&(o.faceIndex=Math.floor(n/3),o.face.materialIndex=r.materialIndex,t.push(o))}else for(let n=Math.max(0,_.start),r=Math.min(s.count,_.start+_.count);n<r;n+=3)o=rm(this,i,e,Fd,s,l,p,u,h,n,n+1,n+2),o&&(o.faceIndex=Math.floor(n/3),t.push(o))}}function rm(e,t,n,i,r,o,a,s,l,p,u,h){Gd.fromBufferAttribute(r,p),Ud.fromBufferAttribute(r,u),jd.fromBufferAttribute(r,h);const c=e.morphTargetInfluences;if(o&&c){$d.set(0,0,0),Xd.set(0,0,0),Yd.set(0,0,0);for(let e=0,t=o.length;e<t;e++){const t=c[e],n=o[e];0!==t&&(Wd.fromBufferAttribute(n,p),qd.fromBufferAttribute(n,u),Jd.fromBufferAttribute(n,h),a?($d.addScaledVector(Wd,t),Xd.addScaledVector(qd,t),Yd.addScaledVector(Jd,t)):($d.addScaledVector(Wd.sub(Gd),t),Xd.addScaledVector(qd.sub(Ud),t),Yd.addScaledVector(Jd.sub(jd),t)))}Gd.add($d),Ud.add(Xd),jd.add(Yd)}e.isSkinnedMesh&&(e.boneTransform(p,Gd),e.boneTransform(u,Ud),e.boneTransform(h,jd));const _=function(e,t,n,i,r,o,a,s){let l;if(l=1===t.side?i.intersectTriangle(a,o,r,!0,s):i.intersectTriangle(r,o,a,2!==t.side,s),null===l)return null;nm.copy(s),nm.applyMatrix4(e.matrixWorld);const p=n.ray.origin.distanceTo(nm);return p<n.near||p>n.far?null:{distance:p,point:nm.clone(),object:e}}(e,t,n,i,Gd,Ud,jd,tm);if(_){s&&(Kd.fromBufferAttribute(s,p),Qd.fromBufferAttribute(s,u),em.fromBufferAttribute(s,h),_.uv=bd.getUV(tm,Gd,Ud,jd,Kd,Qd,em,new Oc)),l&&(Kd.fromBufferAttribute(l,p),Qd.fromBufferAttribute(l,u),em.fromBufferAttribute(l,h),_.uv2=bd.getUV(tm,Gd,Ud,jd,Kd,Qd,em,new Oc));const e={a:p,b:u,c:h,normal:new p_,materialIndex:0};bd.getNormal(Gd,Ud,jd,e.normal),_.face=e}return _}class om extends Rd{constructor(e=1,t=1,n=1,i=1,r=1,o=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:n,widthSegments:i,heightSegments:r,depthSegments:o};const a=this;i=Math.floor(i),r=Math.floor(r),o=Math.floor(o);const s=[],l=[],p=[],u=[];let h=0,c=0;function _(e,t,n,i,r,o,_,d,m,P,f){const x=o/m,y=_/P,v=o/2,g=_/2,b=d/2,z=m+1,w=P+1;let Z=0,E=0;const M=new p_;for(let o=0;o<w;o++){const a=o*y-g;for(let s=0;s<z;s++){const h=s*x-v;M[e]=h*i,M[t]=a*r,M[n]=b,l.push(M.x,M.y,M.z),M[e]=0,M[t]=0,M[n]=d>0?1:-1,p.push(M.x,M.y,M.z),u.push(s/m),u.push(1-o/P),Z+=1}}for(let e=0;e<P;e++)for(let t=0;t<m;t++){const n=h+t+z*e,i=h+t+z*(e+1),r=h+(t+1)+z*(e+1),o=h+(t+1)+z*e;s.push(n,i,o),s.push(i,r,o),E+=6}a.addGroup(c,E,f),c+=E,h+=Z}_("z","y","x",-1,-1,n,t,e,o,r,0),_("z","y","x",1,-1,n,t,-e,o,r,1),_("x","z","y",1,1,e,n,t,i,o,2),_("x","z","y",1,-1,e,n,-t,i,o,3),_("x","y","z",1,-1,e,t,n,i,r,4),_("x","y","z",-1,-1,e,t,-n,i,r,5),this.setIndex(s),this.setAttribute("position",new Ad(l,3)),this.setAttribute("normal",new Ad(p,3)),this.setAttribute("uv",new Ad(u,2))}static fromJSON(e){return new om(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function am(e){const t={};for(const n in e){t[n]={};for(const i in e[n]){const r=e[n][i];r&&(r.isColor||r.isMatrix3||r.isMatrix4||r.isVector2||r.isVector3||r.isVector4||r.isTexture||r.isQuaternion)?t[n][i]=r.clone():Array.isArray(r)?t[n][i]=r.slice():t[n][i]=r}}return t}function sm(e){const t={};for(let n=0;n<e.length;n++){const i=am(e[n]);for(const e in i)t[e]=i[e]}return t}const lm={clone:am,merge:sm};class pm extends wd{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==e&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=am(e.uniforms),this.uniformsGroups=function(e){const t=[];for(let n=0;n<e.length;n++)t.push(e[n].clone());return t}(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const n in this.uniforms){const i=this.uniforms[n].value;i&&i.isTexture?t.uniforms[n]={type:"t",value:i.toJSON(e).uuid}:i&&i.isColor?t.uniforms[n]={type:"c",value:i.getHex()}:i&&i.isVector2?t.uniforms[n]={type:"v2",value:i.toArray()}:i&&i.isVector3?t.uniforms[n]={type:"v3",value:i.toArray()}:i&&i.isVector4?t.uniforms[n]={type:"v4",value:i.toArray()}:i&&i.isMatrix3?t.uniforms[n]={type:"m3",value:i.toArray()}:i&&i.isMatrix4?t.uniforms[n]={type:"m4",value:i.toArray()}:t.uniforms[n]={value:i}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader;const n={};for(const e in this.extensions)!0===this.extensions[e]&&(n[e]=!0);return Object.keys(n).length>0&&(t.extensions=n),t}}class um extends hd{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new H_,this.projectionMatrix=new H_,this.projectionMatrixInverse=new H_}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return(new this.constructor).copy(this)}}class hm extends um{constructor(e=50,t=1,n=.1,i=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=n,this.far=i,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=2*Sc*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(.5*Mc*this.fov);return.5*this.getFilmHeight()/e}getEffectiveFOV(){return 2*Sc*Math.atan(Math.tan(.5*Mc*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(e,t,n,i,r,o){this.aspect=e/t,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=i,this.view.width=r,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(.5*Mc*this.fov)/this.zoom,n=2*t,i=this.aspect*n,r=-.5*i;const o=this.view;if(null!==this.view&&this.view.enabled){const e=o.fullWidth,a=o.fullHeight;r+=o.offsetX*i/e,t-=o.offsetY*n/a,i*=o.width/e,n*=o.height/a}const a=this.filmOffset;0!==a&&(r+=e*a/this.getFilmWidth()),this.projectionMatrix.makePerspective(r,r+i,t,t-n,e,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,null!==this.view&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}const cm=90;class _m extends hd{constructor(e,t,n){super(),this.type="CubeCamera",this.renderTarget=n;const i=new hm(cm,1,e,t);i.layers=this.layers,i.up.set(0,-1,0),i.lookAt(new p_(1,0,0)),this.add(i);const r=new hm(cm,1,e,t);r.layers=this.layers,r.up.set(0,-1,0),r.lookAt(new p_(-1,0,0)),this.add(r);const o=new hm(cm,1,e,t);o.layers=this.layers,o.up.set(0,0,1),o.lookAt(new p_(0,1,0)),this.add(o);const a=new hm(cm,1,e,t);a.layers=this.layers,a.up.set(0,0,-1),a.lookAt(new p_(0,-1,0)),this.add(a);const s=new hm(cm,1,e,t);s.layers=this.layers,s.up.set(0,-1,0),s.lookAt(new p_(0,0,1)),this.add(s);const l=new hm(cm,1,e,t);l.layers=this.layers,l.up.set(0,-1,0),l.lookAt(new p_(0,0,-1)),this.add(l)}update(e,t){null===this.parent&&this.updateMatrixWorld();const n=this.renderTarget,[i,r,o,a,s,l]=this.children,p=e.getRenderTarget(),u=e.toneMapping,h=e.xr.enabled;e.toneMapping=0,e.xr.enabled=!1;const c=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,e.setRenderTarget(n,0),e.render(t,i),e.setRenderTarget(n,1),e.render(t,r),e.setRenderTarget(n,2),e.render(t,o),e.setRenderTarget(n,3),e.render(t,a),e.setRenderTarget(n,4),e.render(t,s),n.texture.generateMipmaps=c,e.setRenderTarget(n,5),e.render(t,l),e.setRenderTarget(p),e.toneMapping=u,e.xr.enabled=h,n.texture.needsPMREMUpdate=!0}}class dm extends r_{constructor(e,t,n,i,r,o,a,s,l,p){super(e=void 0!==e?e:[],t=void 0!==t?t:Uh,n,i,r,o,a,s,l,p),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class mm extends a_{constructor(e,t={}){super(e,e,t),this.isWebGLCubeRenderTarget=!0;const n={width:e,height:e,depth:1},i=[n,n,n,n,n,n];this.texture=new dm(i,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.encoding),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=void 0!==t.generateMipmaps&&t.generateMipmaps,this.texture.minFilter=void 0!==t.minFilter?t.minFilter:Yh}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.encoding=t.encoding,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const n={tEquirect:{value:null}},i="\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t\t#include <project_vertex>\n\n\t\t\t\t}\n\t\t\t",r="\n\n\t\t\t\tuniform sampler2D tEquirect;\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\t#include <common>\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t\t}\n\t\t\t",o=new om(5,5,5),a=new pm({name:"CubemapFromEquirect",uniforms:am(n),vertexShader:i,fragmentShader:r,side:1,blending:0});a.uniforms.tEquirect.value=t;const s=new im(o,a),l=t.minFilter;return t.minFilter===Kh&&(t.minFilter=Yh),new _m(1,10,this).update(e,s),t.minFilter=l,s.geometry.dispose(),s.material.dispose(),this}clear(e,t,n,i){const r=e.getRenderTarget();for(let r=0;r<6;r++)e.setRenderTarget(this,r),e.clear(t,n,i);e.setRenderTarget(r)}}const Pm=new p_,fm=new p_,xm=new Rc;class ym{constructor(e=new p_(1,0,0),t=0){this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,n,i){return this.normal.set(e,t,n),this.constant=i,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,n){const i=Pm.subVectors(n,t).cross(fm.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(i,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)}intersectLine(e,t){const n=e.delta(Pm),i=this.normal.dot(n);if(0===i)return 0===this.distanceToPoint(e.start)?t.copy(e.start):null;const r=-(e.start.dot(this.normal)+this.constant)/i;return r<0||r>1?null:t.copy(n).multiplyScalar(r).add(e.start)}intersectsLine(e){const t=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return t<0&&n>0||n<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const n=t||xm.getNormalMatrix(e),i=this.coplanarPoint(Pm).applyMatrix4(e),r=this.normal.applyMatrix3(n).normalize();return this.constant=-i.dot(r),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return(new this.constructor).copy(this)}}const vm=new A_,gm=new p_;class bm{constructor(e=new ym,t=new ym,n=new ym,i=new ym,r=new ym,o=new ym){this.planes=[e,t,n,i,r,o]}set(e,t,n,i,r,o){const a=this.planes;return a[0].copy(e),a[1].copy(t),a[2].copy(n),a[3].copy(i),a[4].copy(r),a[5].copy(o),this}copy(e){const t=this.planes;for(let n=0;n<6;n++)t[n].copy(e.planes[n]);return this}setFromProjectionMatrix(e){const t=this.planes,n=e.elements,i=n[0],r=n[1],o=n[2],a=n[3],s=n[4],l=n[5],p=n[6],u=n[7],h=n[8],c=n[9],_=n[10],d=n[11],m=n[12],P=n[13],f=n[14],x=n[15];return t[0].setComponents(a-i,u-s,d-h,x-m).normalize(),t[1].setComponents(a+i,u+s,d+h,x+m).normalize(),t[2].setComponents(a+r,u+l,d+c,x+P).normalize(),t[3].setComponents(a-r,u-l,d-c,x-P).normalize(),t[4].setComponents(a-o,u-p,d-_,x-f).normalize(),t[5].setComponents(a+o,u+p,d+_,x+f).normalize(),this}intersectsObject(e){const t=e.geometry;return null===t.boundingSphere&&t.computeBoundingSphere(),vm.copy(t.boundingSphere).applyMatrix4(e.matrixWorld),this.intersectsSphere(vm)}intersectsSprite(e){return vm.center.set(0,0,0),vm.radius=.7071067811865476,vm.applyMatrix4(e.matrixWorld),this.intersectsSphere(vm)}intersectsSphere(e){const t=this.planes,n=e.center,i=-e.radius;for(let e=0;e<6;e++)if(t[e].distanceToPoint(n)<i)return!1;return!0}intersectsBox(e){const t=this.planes;for(let n=0;n<6;n++){const i=t[n];if(gm.x=i.normal.x>0?e.max.x:e.min.x,gm.y=i.normal.y>0?e.max.y:e.min.y,gm.z=i.normal.z>0?e.max.z:e.min.z,i.distanceToPoint(gm)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let n=0;n<6;n++)if(t[n].distanceToPoint(e)<0)return!1;return!0}clone(){return(new this.constructor).copy(this)}}function zm(){let e=null,t=!1,n=null,i=null;function r(t,o){n(t,o),i=e.requestAnimationFrame(r)}return{start:function(){!0!==t&&null!==n&&(i=e.requestAnimationFrame(r),t=!0)},stop:function(){e.cancelAnimationFrame(i),t=!1},setAnimationLoop:function(e){n=e},setContext:function(t){e=t}}}function wm(e,t){const n=t.isWebGL2,i=new WeakMap;return{get:function(e){return e.isInterleavedBufferAttribute&&(e=e.data),i.get(e)},remove:function(t){t.isInterleavedBufferAttribute&&(t=t.data);const n=i.get(t);n&&(e.deleteBuffer(n.buffer),i.delete(t))},update:function(t,r){if(t.isGLBufferAttribute){const e=i.get(t);return void((!e||e.version<t.version)&&i.set(t,{buffer:t.buffer,type:t.type,bytesPerElement:t.elementSize,version:t.version}))}t.isInterleavedBufferAttribute&&(t=t.data);const o=i.get(t);void 0===o?i.set(t,function(t,i){const r=t.array,o=t.usage,a=e.createBuffer();let s;if(e.bindBuffer(i,a),e.bufferData(i,r,o),t.onUploadCallback(),r instanceof Float32Array)s=5126;else if(r instanceof Uint16Array)if(t.isFloat16BufferAttribute){if(!n)throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");s=5131}else s=5123;else if(r instanceof Int16Array)s=5122;else if(r instanceof Uint32Array)s=5125;else if(r instanceof Int32Array)s=5124;else if(r instanceof Int8Array)s=5120;else if(r instanceof Uint8Array)s=5121;else{if(!(r instanceof Uint8ClampedArray))throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+r);s=5121}return{buffer:a,type:s,bytesPerElement:r.BYTES_PER_ELEMENT,version:t.version}}(t,r)):o.version<t.version&&(function(t,i,r){const o=i.array,a=i.updateRange;e.bindBuffer(r,t),-1===a.count?e.bufferSubData(r,0,o):(n?e.bufferSubData(r,a.offset*o.BYTES_PER_ELEMENT,o,a.offset,a.count):e.bufferSubData(r,a.offset*o.BYTES_PER_ELEMENT,o.subarray(a.offset,a.offset+a.count)),a.count=-1)}(o.buffer,t,r),o.version=t.version)}}}class Zm extends Rd{constructor(e=1,t=1,n=1,i=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:n,heightSegments:i};const r=e/2,o=t/2,a=Math.floor(n),s=Math.floor(i),l=a+1,p=s+1,u=e/a,h=t/s,c=[],_=[],d=[],m=[];for(let e=0;e<p;e++){const t=e*h-o;for(let n=0;n<l;n++){const i=n*u-r;_.push(i,-t,0),d.push(0,0,1),m.push(n/a),m.push(1-e/s)}}for(let e=0;e<s;e++)for(let t=0;t<a;t++){const n=t+l*e,i=t+l*(e+1),r=t+1+l*(e+1),o=t+1+l*e;c.push(n,i,o),c.push(i,r,o)}this.setIndex(c),this.setAttribute("position",new Ad(_,3)),this.setAttribute("normal",new Ad(d,3)),this.setAttribute("uv",new Ad(m,2))}static fromJSON(e){return new Zm(e.width,e.height,e.widthSegments,e.heightSegments)}}const Em={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef USE_ALPHATEST\n\tif ( diffuseColor.a < alphaTest ) discard;\n#endif",alphatest_pars_fragment:"#ifdef USE_ALPHATEST\n\tuniform float alphaTest;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"vec3 transformed = vec3( position );",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"vec3 BRDF_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nfloat F_Schlick( const in float f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nvec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {\n    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );\n    float x2 = x * x;\n    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );\n    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );\n}\nfloat V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( f0, f90, dotVH );\n\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( V * D );\n}\n#ifdef USE_IRIDESCENCE\n\tvec3 BRDF_GGX_Iridescence( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float iridescence, const in vec3 iridescenceFresnel, const in float roughness ) {\n\t\tfloat alpha = pow2( roughness );\n\t\tvec3 halfDir = normalize( lightDir + viewDir );\n\t\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\t\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\t\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\t\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\t\tvec3 F = mix( F_Schlick( f0, f90, dotVH ), iridescenceFresnel, iridescence );\n\t\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\t\tfloat D = D_GGX( alpha, dotNH );\n\t\treturn F * ( V * D );\n\t}\n#endif\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, 1.0, dotVH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie( float roughness, float dotNH ) {\n\tfloat alpha = pow2( roughness );\n\tfloat invAlpha = 1.0 / alpha;\n\tfloat cos2h = dotNH * dotNH;\n\tfloat sin2h = max( 1.0 - cos2h, 0.0078125 );\n\treturn ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );\n}\nfloat V_Neubelt( float dotNV, float dotNL ) {\n\treturn saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );\n}\nvec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat D = D_Charlie( sheenRoughness, dotNH );\n\tfloat V = V_Neubelt( dotNV, dotNL );\n\treturn sheenColor * ( D * V );\n}\n#endif",iridescence_fragment:"#ifdef USE_IRIDESCENCE\n\tconst mat3 XYZ_TO_REC709 = mat3(\n\t\t 3.2404542, -0.9692660,  0.0556434,\n\t\t-1.5371385,  1.8760108, -0.2040259,\n\t\t-0.4985314,  0.0415560,  1.0572252\n\t);\n\tvec3 Fresnel0ToIor( vec3 fresnel0 ) {\n\t\tvec3 sqrtF0 = sqrt( fresnel0 );\n\t\treturn ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );\n\t}\n\tvec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );\n\t}\n\tfloat IorToFresnel0( float transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));\n\t}\n\tvec3 evalSensitivity( float OPD, vec3 shift ) {\n\t\tfloat phase = 2.0 * PI * OPD * 1.0e-9;\n\t\tvec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );\n\t\tvec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );\n\t\tvec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );\n\t\tvec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );\n\t\txyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );\n\t\txyz /= 1.0685e-7;\n\t\tvec3 rgb = XYZ_TO_REC709 * xyz;\n\t\treturn rgb;\n\t}\n\tvec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {\n\t\tvec3 I;\n\t\tfloat iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );\n\t\tfloat sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );\n\t\tfloat cosTheta2Sq = 1.0 - sinTheta2Sq;\n\t\tif ( cosTheta2Sq < 0.0 ) {\n\t\t\t return vec3( 1.0 );\n\t\t}\n\t\tfloat cosTheta2 = sqrt( cosTheta2Sq );\n\t\tfloat R0 = IorToFresnel0( iridescenceIOR, outsideIOR );\n\t\tfloat R12 = F_Schlick( R0, 1.0, cosTheta1 );\n\t\tfloat R21 = R12;\n\t\tfloat T121 = 1.0 - R12;\n\t\tfloat phi12 = 0.0;\n\t\tif ( iridescenceIOR < outsideIOR ) phi12 = PI;\n\t\tfloat phi21 = PI - phi12;\n\t\tvec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );\t\tvec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );\n\t\tvec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );\n\t\tvec3 phi23 = vec3( 0.0 );\n\t\tif ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;\n\t\tif ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;\n\t\tif ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;\n\t\tfloat OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;\n\t\tvec3 phi = vec3( phi21 ) + phi23;\n\t\tvec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );\n\t\tvec3 r123 = sqrt( R123 );\n\t\tvec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );\n\t\tvec3 C0 = R12 + Rs;\n\t\tI = C0;\n\t\tvec3 Cm = Rs - T121;\n\t\tfor ( int m = 1; m <= 2; ++ m ) {\n\t\t\tCm *= r123;\n\t\t\tvec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );\n\t\t\tI += Cm * Sm;\n\t\t}\n\t\treturn max( I, vec3( 0.0 ) );\n\t}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n\t\tvec3 vSigmaX = dFdx( surf_pos.xyz );\n\t\tvec3 vSigmaY = dFdy( surf_pos.xyz );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 ) * faceDirection;\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#pragma unroll_loop_end\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#if defined( USE_COLOR_ALPHA )\n\tdiffuseColor *= vColor;\n#elif defined( USE_COLOR )\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR )\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvarying vec3 vColor;\n#endif",color_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvColor = vec4( 1.0 );\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor *= color;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement( a ) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nvec3 pow2( const in vec3 x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }\nfloat average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract( sin( sn ) * c );\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal;\n#endif\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat luminance( const in vec3 rgb ) {\n\tconst vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );\n\treturn dot( weights, rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\tvec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tuv.x += filterInt * 3.0 * cubeUV_minTileSize;\n\t\tuv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );\n\t\tuv.x *= CUBEUV_TEXEL_WIDTH;\n\t\tuv.y *= CUBEUV_TEXEL_HEIGHT;\n\t\t#ifdef texture2DGradEXT\n\t\t\treturn texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;\n\t\t#else\n\t\t\treturn texture2D( envMap, uv ).rgb;\n\t\t#endif\n\t}\n\t#define cubeUV_r0 1.0\n\t#define cubeUV_v0 0.339\n\t#define cubeUV_m0 - 2.0\n\t#define cubeUV_r1 0.8\n\t#define cubeUV_v1 0.276\n\t#define cubeUV_m1 - 1.0\n\t#define cubeUV_r4 0.4\n\t#define cubeUV_v4 0.046\n\t#define cubeUV_m4 2.0\n\t#define cubeUV_r5 0.305\n\t#define cubeUV_v5 0.016\n\t#define cubeUV_m5 3.0\n\t#define cubeUV_r6 0.21\n\t#define cubeUV_v6 0.0038\n\t#define cubeUV_m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= cubeUV_r1 ) {\n\t\t\tmip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;\n\t\t} else if ( roughness >= cubeUV_r4 ) {\n\t\t\tmip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;\n\t\t} else if ( roughness >= cubeUV_r5 ) {\n\t\t\tmip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;\n\t\t} else if ( roughness >= cubeUV_r6 ) {\n\t\t\tmip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_INSTANCING\n\tmat3 m = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );\n\ttransformedNormal = m * transformedNormal;\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",encodings_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment:"vec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#if defined( USE_ENVMAP )\n\tvec3 getIBLIrradiance( const in vec3 normal ) {\n\t\t#if defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\n\t\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\tvec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {\n\t\t#if defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 reflectVec = reflect( - viewDir, normal );\n\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\n\t\t\treturn envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tvFogDepth = - mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float vFogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, vFogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float vFogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn vec3( texture2D( gradientMap, coord ).r );\n\t#else\n\t\tvec2 fw = fwidth( coord ) * 0.5;\n\t\treturn mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );\n\t#endif\n}",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\treflectedLight.indirectDiffuse += lightMapIrradiance;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_fragment:"LambertMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularStrength = specularStrength;",lights_lambert_pars_fragment:"varying vec3 vViewPosition;\nstruct LambertMaterial {\n\tvec3 diffuseColor;\n\tfloat specularStrength;\n};\nvoid RE_Direct_Lambert( const in IncidentLight directLight, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Lambert\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Lambert\n#define Material_LightProbeLOD( material )\t(0)",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {\n\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\treturn irradiance;\n}\nfloat getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\t#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\t\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\t\tif ( cutoffDistance > 0.0 ) {\n\t\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t\t}\n\t\treturn distanceFalloff;\n\t#else\n\t\tif ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\t\treturn pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t\t}\n\t\treturn 1.0;\n\t#endif\n}\nfloat getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {\n\treturn smoothstep( coneCosine, penumbraCosine, angleCosine );\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tlight.color = directionalLight.color;\n\t\tlight.direction = directionalLight.direction;\n\t\tlight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tlight.color = pointLight.color;\n\t\tlight.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );\n\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat angleCos = dot( light.direction, spotLight.direction );\n\t\tfloat spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\tif ( spotAttenuation > 0.0 ) {\n\t\t\tfloat lightDistance = length( lVector );\n\t\t\tlight.color = spotLight.color * spotAttenuation;\n\t\t\tlight.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t\t} else {\n\t\t\tlight.color = vec3( 0.0 );\n\t\t\tlight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {\n\t\tfloat dotNL = dot( normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon\n#define Material_LightProbeLOD( material )\t(0)",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;\nmaterial.roughness = min( material.roughness, 1.0 );\n#ifdef IOR\n\tmaterial.ior = ior;\n\t#ifdef SPECULAR\n\t\tfloat specularIntensityFactor = specularIntensity;\n\t\tvec3 specularColorFactor = specularColor;\n\t\t#ifdef USE_SPECULARINTENSITYMAP\n\t\t\tspecularIntensityFactor *= texture2D( specularIntensityMap, vUv ).a;\n\t\t#endif\n\t\t#ifdef USE_SPECULARCOLORMAP\n\t\t\tspecularColorFactor *= texture2D( specularColorMap, vUv ).rgb;\n\t\t#endif\n\t\tmaterial.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );\n\t#else\n\t\tfloat specularIntensityFactor = 1.0;\n\t\tvec3 specularColorFactor = vec3( 1.0 );\n\t\tmaterial.specularF90 = 1.0;\n\t#endif\n\tmaterial.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.specularF90 = 1.0;\n#endif\n#ifdef USE_CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\tmaterial.clearcoatF0 = vec3( 0.04 );\n\tmaterial.clearcoatF90 = 1.0;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_IRIDESCENCE\n\tmaterial.iridescence = iridescence;\n\tmaterial.iridescenceIOR = iridescenceIOR;\n\t#ifdef USE_IRIDESCENCEMAP\n\t\tmaterial.iridescence *= texture2D( iridescenceMap, vUv ).r;\n\t#endif\n\t#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\t\tmaterial.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vUv ).g + iridescenceThicknessMinimum;\n\t#else\n\t\tmaterial.iridescenceThickness = iridescenceThicknessMaximum;\n\t#endif\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheenColor;\n\t#ifdef USE_SHEENCOLORMAP\n\t\tmaterial.sheenColor *= texture2D( sheenColorMap, vUv ).rgb;\n\t#endif\n\tmaterial.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );\n\t#ifdef USE_SHEENROUGHNESSMAP\n\t\tmaterial.sheenRoughness *= texture2D( sheenRoughnessMap, vUv ).a;\n\t#endif\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat roughness;\n\tvec3 specularColor;\n\tfloat specularF90;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat clearcoat;\n\t\tfloat clearcoatRoughness;\n\t\tvec3 clearcoatF0;\n\t\tfloat clearcoatF90;\n\t#endif\n\t#ifdef USE_IRIDESCENCE\n\t\tfloat iridescence;\n\t\tfloat iridescenceIOR;\n\t\tfloat iridescenceThickness;\n\t\tvec3 iridescenceFresnel;\n\t\tvec3 iridescenceF0;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tvec3 sheenColor;\n\t\tfloat sheenRoughness;\n\t#endif\n\t#ifdef IOR\n\t\tfloat ior;\n\t#endif\n\t#ifdef USE_TRANSMISSION\n\t\tfloat transmission;\n\t\tfloat transmissionAlpha;\n\t\tfloat thickness;\n\t\tfloat attenuationDistance;\n\t\tvec3 attenuationColor;\n\t#endif\n};\nvec3 clearcoatSpecular = vec3( 0.0 );\nvec3 sheenSpecular = vec3( 0.0 );\nfloat IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat r2 = roughness * roughness;\n\tfloat a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;\n\tfloat b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;\n\tfloat DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );\n\treturn saturate( DG * RECIPROCAL_PI );\n}\nvec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;\n\treturn fab;\n}\nvec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\treturn specularColor * fab.x + specularF90 * fab.y;\n}\n#ifdef USE_IRIDESCENCE\nvoid computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#else\nvoid computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#endif\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\t#ifdef USE_IRIDESCENCE\n\t\tvec3 Fr = mix( specularColor, iridescenceF0, iridescence );\n\t#else\n\t\tvec3 Fr = specularColor;\n\t#endif\n\tvec3 FssEss = Fr * fab.x + specularF90 * fab.y;\n\tfloat Ess = fab.x + fab.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.roughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = dotNLcc * directLight.color;\n\t\tclearcoatSpecular += ccIrradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness );\n\t#endif\n\t#ifdef USE_IRIDESCENCE\n\t\treflectedLight.directSpecular += irradiance * BRDF_GGX_Iridescence( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness );\n\t#else\n\t\treflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness );\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecular += irradiance * material.sheenColor * IBLSheenBRDF( geometry.normal, geometry.viewDir, material.sheenRoughness );\n\t#endif\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\t#ifdef USE_IRIDESCENCE\n\t\tcomputeMultiscatteringIridescence( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );\n\t#else\n\t\tcomputeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );\n\t#endif\n\tvec3 totalScattering = singleScattering + multiScattering;\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );\n\treflectedLight.indirectSpecular += radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n#ifdef USE_CLEARCOAT\n\tgeometry.clearcoatNormal = clearcoatNormal;\n#endif\n#ifdef USE_IRIDESCENCE\n\tfloat dotNVi = saturate( dot( normal, geometry.viewDir ) );\n\tif ( material.iridescenceThickness == 0.0 ) {\n\t\tmaterial.iridescence = 0.0;\n\t} else {\n\t\tmaterial.iridescence = saturate( material.iridescence );\n\t}\n\tif ( material.iridescence > 0.0 ) {\n\t\tmaterial.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );\n\t\tmaterial.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );\n\t}\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointLightInfo( pointLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\tvec4 spotColor;\n\tvec3 spotLightCoord;\n\tbool inSpotLightMap;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotLightInfo( spotLight, geometry, directLight );\n\t\t#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX\n\t\t#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS\n\t\t#else\n\t\t#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#endif\n\t\t#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )\n\t\t\tspotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;\n\t\t\tinSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );\n\t\t\tspotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );\n\t\t\tdirectLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;\n\t\t#endif\n\t\t#undef SPOT_LIGHT_MAP_INDEX\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalLightInfo( directionalLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry.normal );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\t\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getIBLIrradiance( geometry.normal );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tradiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\t#else\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\t\tgl_Position.z *= gl_Position.w;\n\t\t}\n\t#endif\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 sampledDiffuseColor = texture2D( map, vUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\tsampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );\n\t#endif\n\tdiffuseColor *= sampledDiffuseColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n#endif\n#ifdef USE_MAP\n\tdiffuseColor *= texture2D( map, uv );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tuniform mat3 uvTransform;\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphcolor_vertex:"#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )\n\tvColor *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t#if defined( USE_COLOR_ALPHA )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];\n\t\t#elif defined( USE_COLOR )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];\n\t\t#endif\n\t}\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\t\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\t\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\t\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n\t#endif\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\tuniform float morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tuniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\t\tuniform sampler2DArray morphTargetsTexture;\n\t\tuniform ivec2 morphTargetsTextureSize;\n\t\tvec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {\n\t\t\tint texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;\n\t\t\tint y = texelIndex / morphTargetsTextureSize.x;\n\t\t\tint x = texelIndex - y * morphTargetsTextureSize.x;\n\t\t\tivec3 morphUV = ivec3( x, y, morphTargetIndex );\n\t\t\treturn texelFetch( morphTargetsTexture, morphUV, 0 );\n\t\t}\n\t#else\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\tuniform float morphTargetInfluences[ 8 ];\n\t\t#else\n\t\t\tuniform float morphTargetInfluences[ 4 ];\n\t\t#endif\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\t\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\t\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\t\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\t\t\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\t\t\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\t\t\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\t\t#endif\n\t#endif\n#endif",normal_fragment_begin:"float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\n#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\t#ifdef USE_TANGENT\n\t\tvec3 tangent = normalize( vTangent );\n\t\tvec3 bitangent = normalize( vBitangent );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\ttangent = tangent * faceDirection;\n\t\t\tbitangent = bitangent * faceDirection;\n\t\t#endif\n\t\t#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tmat3 vTBN = mat3( tangent, bitangent, normal );\n\t\t#endif\n\t#endif\n#endif\nvec3 geometryNormal = normal;",normal_fragment_maps:"#ifdef OBJECTSPACE_NORMALMAP\n\tnormal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( TANGENTSPACE_NORMALMAP )\n\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\t#ifdef USE_TANGENT\n\t\tnormal = normalize( vTBN * mapN );\n\t#else\n\t\tnormal = perturbNormal2Arb( - vViewPosition, normal, mapN, faceDirection );\n\t#endif\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );\n#endif",normal_pars_fragment:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_pars_vertex:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_vertex:"#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {\n\t\tvec3 q0 = dFdx( eye_pos.xyz );\n\t\tvec3 q1 = dFdy( eye_pos.xyz );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tvec3 N = surf_norm;\n\t\tvec3 q1perp = cross( q1, N );\n\t\tvec3 q0perp = cross( N, q0 );\n\t\tvec3 T = q1perp * st0.x + q0perp * st1.x;\n\t\tvec3 B = q1perp * st0.y + q0perp * st1.y;\n\t\tfloat det = max( dot( T, T ), dot( B, B ) );\n\t\tfloat scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );\n\t\treturn normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal = geometryNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\t#ifdef USE_TANGENT\n\t\tclearcoatNormal = normalize( vTBN * clearcoatMapN );\n\t#else\n\t\tclearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );\n\t#endif\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif",iridescence_pars_fragment:"#ifdef USE_IRIDESCENCEMAP\n\tuniform sampler2D iridescenceMap;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tuniform sampler2D iridescenceThicknessMap;\n#endif",output_fragment:"#ifdef OPAQUE\ndiffuseColor.a = 1.0;\n#endif\n#ifdef USE_TRANSMISSION\ndiffuseColor.a *= material.transmissionAlpha + 0.1;\n#endif\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#if NUM_SPOT_LIGHT_COORDS > 0\n  varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#if NUM_SPOT_LIGHT_MAPS > 0\n  uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",shadowmap_pars_vertex:"#if NUM_SPOT_LIGHT_COORDS > 0\n  uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];\n  varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#if defined( USE_SHADOWMAP ) || ( NUM_SPOT_LIGHT_COORDS > 0 )\n\t#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_COORDS > 0 || NUM_POINT_LIGHT_SHADOWS > 0\n\t\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\tvec4 shadowWorldPosition;\n\t#endif\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_COORDS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition;\n\t\t#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t\tshadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;\n\t\t#endif\n\t\tvSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\tuniform highp sampler2D boneTexture;\n\tuniform int boneTextureSize;\n\tmat4 getBoneMatrix( const in float i ) {\n\t\tfloat j = i * 4.0;\n\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\ty = dy * ( y + 0.5 );\n\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\treturn bone;\n\t}\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmission_fragment:"#ifdef USE_TRANSMISSION\n\tmaterial.transmission = transmission;\n\tmaterial.transmissionAlpha = 1.0;\n\tmaterial.thickness = thickness;\n\tmaterial.attenuationDistance = attenuationDistance;\n\tmaterial.attenuationColor = attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tmaterial.transmission *= texture2D( transmissionMap, vUv ).r;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tmaterial.thickness *= texture2D( thicknessMap, vUv ).g;\n\t#endif\n\tvec3 pos = vWorldPosition;\n\tvec3 v = normalize( cameraPosition - pos );\n\tvec3 n = inverseTransformDirection( normal, viewMatrix );\n\tvec4 transmission = getIBLVolumeRefraction(\n\t\tn, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,\n\t\tpos, modelMatrix, viewMatrix, projectionMatrix, material.ior, material.thickness,\n\t\tmaterial.attenuationColor, material.attenuationDistance );\n\tmaterial.transmissionAlpha = mix( material.transmissionAlpha, transmission.a, material.transmission );\n\ttotalDiffuse = mix( totalDiffuse, transmission.rgb, material.transmission );\n#endif",transmission_pars_fragment:"#ifdef USE_TRANSMISSION\n\tuniform float transmission;\n\tuniform float thickness;\n\tuniform float attenuationDistance;\n\tuniform vec3 attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tuniform sampler2D transmissionMap;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tuniform sampler2D thicknessMap;\n\t#endif\n\tuniform vec2 transmissionSamplerSize;\n\tuniform sampler2D transmissionSamplerMap;\n\tuniform mat4 modelMatrix;\n\tuniform mat4 projectionMatrix;\n\tvarying vec3 vWorldPosition;\n\tvec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {\n\t\tvec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );\n\t\tvec3 modelScale;\n\t\tmodelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );\n\t\tmodelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );\n\t\tmodelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );\n\t\treturn normalize( refractionVector ) * thickness * modelScale;\n\t}\n\tfloat applyIorToRoughness( const in float roughness, const in float ior ) {\n\t\treturn roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\n\t}\n\tvec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {\n\t\tfloat framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );\n\t\t#ifdef texture2DLodEXT\n\t\t\treturn texture2DLodEXT( transmissionSamplerMap, fragCoord.xy, framebufferLod );\n\t\t#else\n\t\t\treturn texture2D( transmissionSamplerMap, fragCoord.xy, framebufferLod );\n\t\t#endif\n\t}\n\tvec3 applyVolumeAttenuation( const in vec3 radiance, const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tif ( attenuationDistance == 0.0 ) {\n\t\t\treturn radiance;\n\t\t} else {\n\t\t\tvec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;\n\t\t\tvec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );\t\t\treturn transmittance * radiance;\n\t\t}\n\t}\n\tvec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,\n\t\tconst in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,\n\t\tconst in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,\n\t\tconst in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\n\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\trefractionCoords += 1.0;\n\t\trefractionCoords /= 2.0;\n\t\tvec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );\n\t\tvec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );\n\t\tvec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );\n\t\treturn vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );\n\t}\n#endif",uv_pars_fragment:"#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex:"#ifdef USE_UV\n\t#ifdef UVS_VERTEX_ONLY\n\t\tvec2 vUv;\n\t#else\n\t\tvarying vec2 vUv;\n\t#endif\n\tuniform mat3 uvTransform;\n#endif",uv_vertex:"#ifdef USE_UV\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n\tuniform mat3 uv2Transform;\n#endif",uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",background_frag:"uniform sampler2D t2D;\nvarying vec2 vUv;\nvoid main() {\n\tgl_FragColor = texture2D( t2D, vUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\tgl_FragColor = vec4( mix( pow( gl_FragColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), gl_FragColor.rgb * 0.0773993808, vec3( lessThanEqual( gl_FragColor.rgb, vec3( 0.04045 ) ) ) ), gl_FragColor.w );\n\t#endif\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",cube_frag:"#include <envmap_common_pars_fragment>\nuniform float opacity;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\tvec3 vReflect = vWorldDirection;\n\t#include <envmap_fragment>\n\tgl_FragColor = envColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#endif\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinbase_vertex>\n\t\t#include <skinnormal_vertex>\n\t\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\t\treflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"#define LAMBERT\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_lambert_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_lambert_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t#else\n\t\tvec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshnormal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",meshnormal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n\t#ifdef OPAQUE\n\t\tgl_FragColor.a = 1.0;\n\t#endif\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifdef USE_TRANSMISSION\n\tvarying vec3 vWorldPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n#ifdef USE_TRANSMISSION\n\tvWorldPosition = worldPosition.xyz;\n#endif\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define IOR\n\t#define SPECULAR\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef IOR\n\tuniform float ior;\n#endif\n#ifdef SPECULAR\n\tuniform float specularIntensity;\n\tuniform vec3 specularColor;\n\t#ifdef USE_SPECULARINTENSITYMAP\n\t\tuniform sampler2D specularIntensityMap;\n\t#endif\n\t#ifdef USE_SPECULARCOLORMAP\n\t\tuniform sampler2D specularColorMap;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_IRIDESCENCE\n\tuniform float iridescence;\n\tuniform float iridescenceIOR;\n\tuniform float iridescenceThicknessMinimum;\n\tuniform float iridescenceThicknessMaximum;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheenColor;\n\tuniform float sheenRoughness;\n\t#ifdef USE_SHEENCOLORMAP\n\t\tuniform sampler2D sheenColorMap;\n\t#endif\n\t#ifdef USE_SHEENROUGHNESSMAP\n\t\tuniform sampler2D sheenRoughnessMap;\n\t#endif\n#endif\nvarying vec3 vViewPosition;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <bsdfs>\n#include <iridescence_fragment>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_physical_pars_fragment>\n#include <transmission_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <iridescence_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n\tvec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n\t#include <transmission_fragment>\n\tvec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\n\t#ifdef USE_SHEEN\n\t\tfloat sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );\n\t\toutgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );\n\t\tvec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );\n\t\toutgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;\n\t#endif\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",shadow_vert:"#include <common>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}"},Mm={common:{diffuse:{value:new Kc(16777215)},opacity:{value:1},map:{value:null},uvTransform:{value:new Rc},uv2Transform:{value:new Rc},alphaMap:{value:null},alphaTest:{value:0}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new Oc(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Kc(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Kc(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new Rc}},sprite:{diffuse:{value:new Kc(16777215)},opacity:{value:1},center:{value:new Oc(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new Rc}}},Sm={basic:{uniforms:sm([Mm.common,Mm.specularmap,Mm.envmap,Mm.aomap,Mm.lightmap,Mm.fog]),vertexShader:Em.meshbasic_vert,fragmentShader:Em.meshbasic_frag},lambert:{uniforms:sm([Mm.common,Mm.specularmap,Mm.envmap,Mm.aomap,Mm.lightmap,Mm.emissivemap,Mm.bumpmap,Mm.normalmap,Mm.displacementmap,Mm.fog,Mm.lights,{emissive:{value:new Kc(0)}}]),vertexShader:Em.meshlambert_vert,fragmentShader:Em.meshlambert_frag},phong:{uniforms:sm([Mm.common,Mm.specularmap,Mm.envmap,Mm.aomap,Mm.lightmap,Mm.emissivemap,Mm.bumpmap,Mm.normalmap,Mm.displacementmap,Mm.fog,Mm.lights,{emissive:{value:new Kc(0)},specular:{value:new Kc(1118481)},shininess:{value:30}}]),vertexShader:Em.meshphong_vert,fragmentShader:Em.meshphong_frag},standard:{uniforms:sm([Mm.common,Mm.envmap,Mm.aomap,Mm.lightmap,Mm.emissivemap,Mm.bumpmap,Mm.normalmap,Mm.displacementmap,Mm.roughnessmap,Mm.metalnessmap,Mm.fog,Mm.lights,{emissive:{value:new Kc(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Em.meshphysical_vert,fragmentShader:Em.meshphysical_frag},toon:{uniforms:sm([Mm.common,Mm.aomap,Mm.lightmap,Mm.emissivemap,Mm.bumpmap,Mm.normalmap,Mm.displacementmap,Mm.gradientmap,Mm.fog,Mm.lights,{emissive:{value:new Kc(0)}}]),vertexShader:Em.meshtoon_vert,fragmentShader:Em.meshtoon_frag},matcap:{uniforms:sm([Mm.common,Mm.bumpmap,Mm.normalmap,Mm.displacementmap,Mm.fog,{matcap:{value:null}}]),vertexShader:Em.meshmatcap_vert,fragmentShader:Em.meshmatcap_frag},points:{uniforms:sm([Mm.points,Mm.fog]),vertexShader:Em.points_vert,fragmentShader:Em.points_frag},dashed:{uniforms:sm([Mm.common,Mm.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Em.linedashed_vert,fragmentShader:Em.linedashed_frag},depth:{uniforms:sm([Mm.common,Mm.displacementmap]),vertexShader:Em.depth_vert,fragmentShader:Em.depth_frag},normal:{uniforms:sm([Mm.common,Mm.bumpmap,Mm.normalmap,Mm.displacementmap,{opacity:{value:1}}]),vertexShader:Em.meshnormal_vert,fragmentShader:Em.meshnormal_frag},sprite:{uniforms:sm([Mm.sprite,Mm.fog]),vertexShader:Em.sprite_vert,fragmentShader:Em.sprite_frag},background:{uniforms:{uvTransform:{value:new Rc},t2D:{value:null}},vertexShader:Em.background_vert,fragmentShader:Em.background_frag},cube:{uniforms:sm([Mm.envmap,{opacity:{value:1}}]),vertexShader:Em.cube_vert,fragmentShader:Em.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Em.equirect_vert,fragmentShader:Em.equirect_frag},distanceRGBA:{uniforms:sm([Mm.common,Mm.displacementmap,{referencePosition:{value:new p_},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Em.distanceRGBA_vert,fragmentShader:Em.distanceRGBA_frag},shadow:{uniforms:sm([Mm.lights,Mm.fog,{color:{value:new Kc(0)},opacity:{value:1}}]),vertexShader:Em.shadow_vert,fragmentShader:Em.shadow_frag}};function Cm(e,t,n,i,r,o){const a=new Kc(0);let s,l,p=!0===r?0:1,u=null,h=0,c=null;function _(e,t){n.buffers.color.setClear(e.r,e.g,e.b,t,o)}return{getClearColor:function(){return a},setClearColor:function(e,t=1){a.set(e),p=t,_(a,p)},getClearAlpha:function(){return p},setClearAlpha:function(e){p=e,_(a,p)},render:function(n,r){let o=!1,d=!0===r.isScene?r.background:null;d&&d.isTexture&&(d=t.get(d));const m=e.xr,P=m.getSession&&m.getSession();P&&"additive"===P.environmentBlendMode&&(d=null),null===d?_(a,p):d&&d.isColor&&(_(d,1),o=!0),(e.autoClear||o)&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),d&&(d.isCubeTexture||d.mapping===Wh)?(void 0===l&&(l=new im(new om(1,1,1),new pm({name:"BackgroundCubeMaterial",uniforms:am(Sm.cube.uniforms),vertexShader:Sm.cube.vertexShader,fragmentShader:Sm.cube.fragmentShader,side:1,depthTest:!1,depthWrite:!1,fog:!1})),l.geometry.deleteAttribute("normal"),l.geometry.deleteAttribute("uv"),l.onBeforeRender=function(e,t,n){this.matrixWorld.copyPosition(n.matrixWorld)},Object.defineProperty(l.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),i.update(l)),l.material.uniforms.envMap.value=d,l.material.uniforms.flipEnvMap.value=d.isCubeTexture&&!1===d.isRenderTargetTexture?-1:1,u===d&&h===d.version&&c===e.toneMapping||(l.material.needsUpdate=!0,u=d,h=d.version,c=e.toneMapping),l.layers.enableAll(),n.unshift(l,l.geometry,l.material,0,0,null)):d&&d.isTexture&&(void 0===s&&(s=new im(new Zm(2,2),new pm({name:"BackgroundMaterial",uniforms:am(Sm.background.uniforms),vertexShader:Sm.background.vertexShader,fragmentShader:Sm.background.fragmentShader,side:0,depthTest:!1,depthWrite:!1,fog:!1})),s.geometry.deleteAttribute("normal"),Object.defineProperty(s.material,"map",{get:function(){return this.uniforms.t2D.value}}),i.update(s)),s.material.uniforms.t2D.value=d,!0===d.matrixAutoUpdate&&d.updateMatrix(),s.material.uniforms.uvTransform.value.copy(d.matrix),u===d&&h===d.version&&c===e.toneMapping||(s.material.needsUpdate=!0,u=d,h=d.version,c=e.toneMapping),s.layers.enableAll(),n.unshift(s,s.geometry,s.material,0,0,null))}}}function Nm(e,t,n,i){const r=e.getParameter(34921),o=i.isWebGL2?null:t.get("OES_vertex_array_object"),a=i.isWebGL2||null!==o,s={},l=_(null);let p=l,u=!1;function h(t){return i.isWebGL2?e.bindVertexArray(t):o.bindVertexArrayOES(t)}function c(t){return i.isWebGL2?e.deleteVertexArray(t):o.deleteVertexArrayOES(t)}function _(e){const t=[],n=[],i=[];for(let e=0;e<r;e++)t[e]=0,n[e]=0,i[e]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:t,enabledAttributes:n,attributeDivisors:i,object:e,attributes:{},index:null}}function d(){const e=p.newAttributes;for(let t=0,n=e.length;t<n;t++)e[t]=0}function m(e){P(e,0)}function P(n,r){const o=p.newAttributes,a=p.enabledAttributes,s=p.attributeDivisors;o[n]=1,0===a[n]&&(e.enableVertexAttribArray(n),a[n]=1),s[n]!==r&&((i.isWebGL2?e:t.get("ANGLE_instanced_arrays"))[i.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](n,r),s[n]=r)}function f(){const t=p.newAttributes,n=p.enabledAttributes;for(let i=0,r=n.length;i<r;i++)n[i]!==t[i]&&(e.disableVertexAttribArray(i),n[i]=0)}function x(t,n,r,o,a,s){!0!==i.isWebGL2||5124!==r&&5125!==r?e.vertexAttribPointer(t,n,r,o,a,s):e.vertexAttribIPointer(t,n,r,a,s)}function y(){v(),u=!0,p!==l&&(p=l,h(p.object))}function v(){l.geometry=null,l.program=null,l.wireframe=!1}return{setup:function(r,l,c,y,v){let g=!1;if(a){const t=function(t,n,r){const a=!0===r.wireframe;let l=s[t.id];void 0===l&&(l={},s[t.id]=l);let p=l[n.id];void 0===p&&(p={},l[n.id]=p);let u=p[a];return void 0===u&&(u=_(i.isWebGL2?e.createVertexArray():o.createVertexArrayOES()),p[a]=u),u}(y,c,l);p!==t&&(p=t,h(p.object)),g=function(e,t,n,i){const r=p.attributes,o=t.attributes;let a=0;const s=n.getAttributes();for(const t in s)if(s[t].location>=0){const n=r[t];let i=o[t];if(void 0===i&&("instanceMatrix"===t&&e.instanceMatrix&&(i=e.instanceMatrix),"instanceColor"===t&&e.instanceColor&&(i=e.instanceColor)),void 0===n)return!0;if(n.attribute!==i)return!0;if(i&&n.data!==i.data)return!0;a++}return p.attributesNum!==a||p.index!==i}(r,y,c,v),g&&function(e,t,n,i){const r={},o=t.attributes;let a=0;const s=n.getAttributes();for(const t in s)if(s[t].location>=0){let n=o[t];void 0===n&&("instanceMatrix"===t&&e.instanceMatrix&&(n=e.instanceMatrix),"instanceColor"===t&&e.instanceColor&&(n=e.instanceColor));const i={};i.attribute=n,n&&n.data&&(i.data=n.data),r[t]=i,a++}p.attributes=r,p.attributesNum=a,p.index=i}(r,y,c,v)}else{const e=!0===l.wireframe;p.geometry===y.id&&p.program===c.id&&p.wireframe===e||(p.geometry=y.id,p.program=c.id,p.wireframe=e,g=!0)}null!==v&&n.update(v,34963),(g||u)&&(u=!1,function(r,o,a,s){if(!1===i.isWebGL2&&(r.isInstancedMesh||s.isInstancedBufferGeometry)&&null===t.get("ANGLE_instanced_arrays"))return;d();const l=s.attributes,p=a.getAttributes(),u=o.defaultAttributeValues;for(const t in p){const i=p[t];if(i.location>=0){let o=l[t];if(void 0===o&&("instanceMatrix"===t&&r.instanceMatrix&&(o=r.instanceMatrix),"instanceColor"===t&&r.instanceColor&&(o=r.instanceColor)),void 0!==o){const t=o.normalized,a=o.itemSize,l=n.get(o);if(void 0===l)continue;const p=l.buffer,u=l.type,h=l.bytesPerElement;if(o.isInterleavedBufferAttribute){const n=o.data,l=n.stride,c=o.offset;if(n.isInstancedInterleavedBuffer){for(let e=0;e<i.locationSize;e++)P(i.location+e,n.meshPerAttribute);!0!==r.isInstancedMesh&&void 0===s._maxInstanceCount&&(s._maxInstanceCount=n.meshPerAttribute*n.count)}else for(let e=0;e<i.locationSize;e++)m(i.location+e);e.bindBuffer(34962,p);for(let e=0;e<i.locationSize;e++)x(i.location+e,a/i.locationSize,u,t,l*h,(c+a/i.locationSize*e)*h)}else{if(o.isInstancedBufferAttribute){for(let e=0;e<i.locationSize;e++)P(i.location+e,o.meshPerAttribute);!0!==r.isInstancedMesh&&void 0===s._maxInstanceCount&&(s._maxInstanceCount=o.meshPerAttribute*o.count)}else for(let e=0;e<i.locationSize;e++)m(i.location+e);e.bindBuffer(34962,p);for(let e=0;e<i.locationSize;e++)x(i.location+e,a/i.locationSize,u,t,a*h,a/i.locationSize*e*h)}}else if(void 0!==u){const n=u[t];if(void 0!==n)switch(n.length){case 2:e.vertexAttrib2fv(i.location,n);break;case 3:e.vertexAttrib3fv(i.location,n);break;case 4:e.vertexAttrib4fv(i.location,n);break;default:e.vertexAttrib1fv(i.location,n)}}}}f()}(r,l,c,y),null!==v&&e.bindBuffer(34963,n.get(v).buffer))},reset:y,resetDefaultState:v,dispose:function(){y();for(const e in s){const t=s[e];for(const e in t){const n=t[e];for(const e in n)c(n[e].object),delete n[e];delete t[e]}delete s[e]}},releaseStatesOfGeometry:function(e){if(void 0===s[e.id])return;const t=s[e.id];for(const e in t){const n=t[e];for(const e in n)c(n[e].object),delete n[e];delete t[e]}delete s[e.id]},releaseStatesOfProgram:function(e){for(const t in s){const n=s[t];if(void 0===n[e.id])continue;const i=n[e.id];for(const e in i)c(i[e].object),delete i[e];delete n[e.id]}},initAttributes:d,enableAttribute:m,disableUnusedAttributes:f}}function Am(e,t,n,i){const r=i.isWebGL2;let o;this.setMode=function(e){o=e},this.render=function(t,i){e.drawArrays(o,t,i),n.update(i,o,1)},this.renderInstances=function(i,a,s){if(0===s)return;let l,p;if(r)l=e,p="drawArraysInstanced";else if(l=t.get("ANGLE_instanced_arrays"),p="drawArraysInstancedANGLE",null===l)return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");l[p](o,i,a,s),n.update(a,o,s)}}function Lm(e,t,n){let i;function r(t){if("highp"===t){if(e.getShaderPrecisionFormat(35633,36338).precision>0&&e.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";t="mediump"}return"mediump"===t&&e.getShaderPrecisionFormat(35633,36337).precision>0&&e.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}const o="undefined"!=typeof WebGL2RenderingContext&&e instanceof WebGL2RenderingContext||"undefined"!=typeof WebGL2ComputeRenderingContext&&e instanceof WebGL2ComputeRenderingContext;let a=void 0!==n.precision?n.precision:"highp";const s=r(a);s!==a&&(console.warn("THREE.WebGLRenderer:",a,"not supported, using",s,"instead."),a=s);const l=o||t.has("WEBGL_draw_buffers"),p=!0===n.logarithmicDepthBuffer,u=e.getParameter(34930),h=e.getParameter(35660),c=e.getParameter(3379),_=e.getParameter(34076),d=e.getParameter(34921),m=e.getParameter(36347),P=e.getParameter(36348),f=e.getParameter(36349),x=h>0,y=o||t.has("OES_texture_float");return{isWebGL2:o,drawBuffers:l,getMaxAnisotropy:function(){if(void 0!==i)return i;if(!0===t.has("EXT_texture_filter_anisotropic")){const n=t.get("EXT_texture_filter_anisotropic");i=e.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else i=0;return i},getMaxPrecision:r,precision:a,logarithmicDepthBuffer:p,maxTextures:u,maxVertexTextures:h,maxTextureSize:c,maxCubemapSize:_,maxAttributes:d,maxVertexUniforms:m,maxVaryings:P,maxFragmentUniforms:f,vertexTextures:x,floatFragmentTextures:y,floatVertexTextures:x&&y,maxSamples:o?e.getParameter(36183):0}}function Bm(e){const t=this;let n=null,i=0,r=!1,o=!1;const a=new ym,s=new Rc,l={value:null,needsUpdate:!1};function p(){l.value!==n&&(l.value=n,l.needsUpdate=i>0),t.numPlanes=i,t.numIntersection=0}function u(e,n,i,r){const o=null!==e?e.length:0;let p=null;if(0!==o){if(p=l.value,!0!==r||null===p){const t=i+4*o,r=n.matrixWorldInverse;s.getNormalMatrix(r),(null===p||p.length<t)&&(p=new Float32Array(t));for(let t=0,n=i;t!==o;++t,n+=4)a.copy(e[t]).applyMatrix4(r,s),a.normal.toArray(p,n),p[n+3]=a.constant}l.value=p,l.needsUpdate=!0}return t.numPlanes=o,t.numIntersection=0,p}this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(e,t,o){const a=0!==e.length||t||0!==i||r;return r=t,n=u(e,o,0),i=e.length,a},this.beginShadows=function(){o=!0,u(null)},this.endShadows=function(){o=!1,p()},this.setState=function(t,a,s){const h=t.clippingPlanes,c=t.clipIntersection,_=t.clipShadows,d=e.get(t);if(!r||null===h||0===h.length||o&&!_)o?u(null):p();else{const e=o?0:i,t=4*e;let r=d.clippingState||null;l.value=r,r=u(h,a,t,s);for(let e=0;e!==t;++e)r[e]=n[e];d.clippingState=r,this.numIntersection=c?this.numPlanes:0,this.numPlanes+=e}}}function Tm(e){let t=new WeakMap;function n(e,t){return 303===t?e.mapping=Uh:304===t&&(e.mapping=jh),e}function i(e){const n=e.target;n.removeEventListener("dispose",i);const r=t.get(n);void 0!==r&&(t.delete(n),r.dispose())}return{get:function(r){if(r&&r.isTexture&&!1===r.isRenderTargetTexture){const o=r.mapping;if(303===o||304===o){if(t.has(r))return n(t.get(r).texture,r.mapping);{const o=r.image;if(o&&o.height>0){const a=new mm(o.height/2);return a.fromEquirectangularTexture(e,r),t.set(r,a),r.addEventListener("dispose",i),n(a.texture,r.mapping)}return null}}}return r},dispose:function(){t=new WeakMap}}}Sm.physical={uniforms:sm([Sm.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new Oc(1,1)},clearcoatNormalMap:{value:null},iridescence:{value:0},iridescenceMap:{value:null},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},sheen:{value:0},sheenColor:{value:new Kc(0)},sheenColorMap:{value:null},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},transmission:{value:0},transmissionMap:{value:null},transmissionSamplerSize:{value:new Oc},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:0},attenuationColor:{value:new Kc(0)},specularIntensity:{value:1},specularIntensityMap:{value:null},specularColor:{value:new Kc(1,1,1)},specularColorMap:{value:null}}]),vertexShader:Em.meshphysical_vert,fragmentShader:Em.meshphysical_frag};const Vm=[.125,.215,.35,.446,.526,.582],km=new class extends um{constructor(e=-1,t=1,n=1,i=-1,r=.1,o=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=n,this.bottom=i,this.near=r,this.far=o,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=null===e.view?null:Object.assign({},e.view),this}setViewOffset(e,t,n,i,r,o){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=i,this.view.width=r,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,i=(this.top+this.bottom)/2;let r=n-e,o=n+e,a=i+t,s=i-t;if(null!==this.view&&this.view.enabled){const e=(this.right-this.left)/this.view.fullWidth/this.zoom,t=(this.top-this.bottom)/this.view.fullHeight/this.zoom;r+=e*this.view.offsetX,o=r+e*this.view.width,a-=t*this.view.offsetY,s=a-t*this.view.height}this.projectionMatrix.makeOrthographic(r,o,a,s,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,null!==this.view&&(t.object.view=Object.assign({},this.view)),t}},Im=new Kc;let Om=null;const Rm=(1+Math.sqrt(5))/2,Hm=1/Rm,Fm=[new p_(1,1,1),new p_(-1,1,1),new p_(1,1,-1),new p_(-1,1,-1),new p_(0,Rm,Hm),new p_(0,Rm,-Hm),new p_(Hm,0,Rm),new p_(-Hm,0,Rm),new p_(Rm,Hm,0),new p_(-Rm,Hm,0)];class Dm{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,n=.1,i=100){Om=this._renderer.getRenderTarget(),this._setSize(256);const r=this._allocateTargets();return r.depthBuffer=!0,this._sceneToCubeUV(e,n,i,r),t>0&&this._blur(r,0,0,t),this._applyPMREM(r),this._cleanup(r),r}fromEquirectangular(e,t=null){return this._fromTexture(e,t)}fromCubemap(e,t=null){return this._fromTexture(e,t)}compileCubemapShader(){null===this._cubemapMaterial&&(this._cubemapMaterial=Wm(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){null===this._equirectMaterial&&(this._equirectMaterial=jm(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),null!==this._cubemapMaterial&&this._cubemapMaterial.dispose(),null!==this._equirectMaterial&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){null!==this._blurMaterial&&this._blurMaterial.dispose(),null!==this._pingPongRenderTarget&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(Om),e.scissorTest=!1,Um(e,0,0,e.width,e.height)}_fromTexture(e,t){e.mapping===Uh||e.mapping===jh?this._setSize(0===e.image.length?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),Om=this._renderer.getRenderTarget();const n=t||this._allocateTargets();return this._textureToCubeUV(e,n),this._applyPMREM(n),this._cleanup(n),n}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,n={magFilter:Yh,minFilter:Yh,generateMipmaps:!1,type:nc,format:rc,encoding:fc,depthBuffer:!1},i=Gm(e,t,n);if(null===this._pingPongRenderTarget||this._pingPongRenderTarget.width!==e){null!==this._pingPongRenderTarget&&this._dispose(),this._pingPongRenderTarget=Gm(e,t,n);const{_lodMax:i}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=function(e){const t=[],n=[],i=[];let r=e;const o=e-4+1+Vm.length;for(let a=0;a<o;a++){const o=Math.pow(2,r);n.push(o);let s=1/o;a>e-4?s=Vm[a-e+4-1]:0===a&&(s=0),i.push(s);const l=1/(o-2),p=-l,u=1+l,h=[p,p,u,p,u,u,p,p,u,u,p,u],c=6,_=6,d=3,m=2,P=1,f=new Float32Array(d*_*c),x=new Float32Array(m*_*c),y=new Float32Array(P*_*c);for(let e=0;e<c;e++){const t=e%3*2/3-1,n=e>2?0:-1,i=[t,n,0,t+2/3,n,0,t+2/3,n+1,0,t,n,0,t+2/3,n+1,0,t,n+1,0];f.set(i,d*_*e),x.set(h,m*_*e);const r=[e,e,e,e,e,e];y.set(r,P*_*e)}const v=new Rd;v.setAttribute("position",new Sd(f,d)),v.setAttribute("uv",new Sd(x,m)),v.setAttribute("faceIndex",new Sd(y,P)),t.push(v),r>4&&r--}return{lodPlanes:t,sizeLods:n,sigmas:i}}(i)),this._blurMaterial=function(e,t,n){const i=new Float32Array(20),r=new p_(0,1,0);return new pm({name:"SphericalGaussianBlur",defines:{n:20,CUBEUV_TEXEL_WIDTH:1/t,CUBEUV_TEXEL_HEIGHT:1/n,CUBEUV_MAX_MIP:`${e}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:i},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:r}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform int samples;\n\t\t\tuniform float weights[ n ];\n\t\t\tuniform bool latitudinal;\n\t\t\tuniform float dTheta;\n\t\t\tuniform float mipInt;\n\t\t\tuniform vec3 poleAxis;\n\n\t\t\t#define ENVMAP_TYPE_CUBE_UV\n\t\t\t#include <cube_uv_reflection_fragment>\n\n\t\t\tvec3 getSample( float theta, vec3 axis ) {\n\n\t\t\t\tfloat cosTheta = cos( theta );\n\t\t\t\t// Rodrigues' axis-angle rotation\n\t\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross( axis, vOutputDirection ) * sin( theta )\n\t\t\t\t\t+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n\n\t\t\t\treturn bilinearCubeUV( envMap, sampleDirection, mipInt );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n\n\t\t\t\tif ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n\n\t\t\t\t\taxis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n\n\t\t\t\t}\n\n\t\t\t\taxis = normalize( axis );\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n\n\t\t\t\tfor ( int i = 1; i < n; i++ ) {\n\n\t\t\t\t\tif ( i >= samples ) {\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfloat theta = dTheta * float( i );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n\n\t\t\t\t}\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}(i,e,t)}return i}_compileMaterial(e){const t=new im(this._lodPlanes[0],e);this._renderer.compile(t,km)}_sceneToCubeUV(e,t,n,i){const r=new hm(90,1,t,n),o=[1,-1,1,1,1,1],a=[1,1,1,-1,-1,-1],s=this._renderer,l=s.autoClear,p=s.toneMapping;s.getClearColor(Im),s.toneMapping=0,s.autoClear=!1;const u=new Zd({name:"PMREM.Background",side:1,depthWrite:!1,depthTest:!1}),h=new im(new om,u);let c=!1;const _=e.background;_?_.isColor&&(u.color.copy(_),e.background=null,c=!0):(u.color.copy(Im),c=!0);for(let t=0;t<6;t++){const n=t%3;0===n?(r.up.set(0,o[t],0),r.lookAt(a[t],0,0)):1===n?(r.up.set(0,0,o[t]),r.lookAt(0,a[t],0)):(r.up.set(0,o[t],0),r.lookAt(0,0,a[t]));const l=this._cubeSize;Um(i,n*l,t>2?l:0,l,l),s.setRenderTarget(i),c&&s.render(h,r),s.render(e,r)}h.geometry.dispose(),h.material.dispose(),s.toneMapping=p,s.autoClear=l,e.background=_}_textureToCubeUV(e,t){const n=this._renderer,i=e.mapping===Uh||e.mapping===jh;i?(null===this._cubemapMaterial&&(this._cubemapMaterial=Wm()),this._cubemapMaterial.uniforms.flipEnvMap.value=!1===e.isRenderTargetTexture?-1:1):null===this._equirectMaterial&&(this._equirectMaterial=jm());const r=i?this._cubemapMaterial:this._equirectMaterial,o=new im(this._lodPlanes[0],r);r.uniforms.envMap.value=e;const a=this._cubeSize;Um(t,0,0,3*a,2*a),n.setRenderTarget(t),n.render(o,km)}_applyPMREM(e){const t=this._renderer,n=t.autoClear;t.autoClear=!1;for(let t=1;t<this._lodPlanes.length;t++){const n=Math.sqrt(this._sigmas[t]*this._sigmas[t]-this._sigmas[t-1]*this._sigmas[t-1]),i=Fm[(t-1)%Fm.length];this._blur(e,t-1,t,n,i)}t.autoClear=n}_blur(e,t,n,i,r){const o=this._pingPongRenderTarget;this._halfBlur(e,o,t,n,i,"latitudinal",r),this._halfBlur(o,e,n,n,i,"longitudinal",r)}_halfBlur(e,t,n,i,r,o,a){const s=this._renderer,l=this._blurMaterial;"latitudinal"!==o&&"longitudinal"!==o&&console.error("blur direction must be either latitudinal or longitudinal!");const p=new im(this._lodPlanes[i],l),u=l.uniforms,h=this._sizeLods[n]-1,c=isFinite(r)?Math.PI/(2*h):2*Math.PI/39,_=r/c,d=isFinite(r)?1+Math.floor(3*_):20;d>20&&console.warn(`sigmaRadians, ${r}, is too large and will clip, as it requested ${d} samples when the maximum is set to 20`);const m=[];let P=0;for(let e=0;e<20;++e){const t=e/_,n=Math.exp(-t*t/2);m.push(n),0===e?P+=n:e<d&&(P+=2*n)}for(let e=0;e<m.length;e++)m[e]=m[e]/P;u.envMap.value=e.texture,u.samples.value=d,u.weights.value=m,u.latitudinal.value="latitudinal"===o,a&&(u.poleAxis.value=a);const{_lodMax:f}=this;u.dTheta.value=c,u.mipInt.value=f-n;const x=this._sizeLods[i];Um(t,3*x*(i>f-4?i-f+4:0),4*(this._cubeSize-x),3*x,2*x),s.setRenderTarget(t),s.render(p,km)}}function Gm(e,t,n){const i=new a_(e,t,n);return i.texture.mapping=Wh,i.texture.name="PMREM.cubeUv",i.scissorTest=!0,i}function Um(e,t,n,i,r){e.viewport.set(t,n,i,r),e.scissor.set(t,n,i,r)}function jm(){return new pm({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 outputDirection = normalize( vOutputDirection );\n\t\t\t\tvec2 uv = equirectUv( outputDirection );\n\n\t\t\t\tgl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}function Wm(){return new pm({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tuniform float flipEnvMap;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform samplerCube envMap;\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}function qm(e){let t=new WeakMap,n=null;function i(e){const n=e.target;n.removeEventListener("dispose",i);const r=t.get(n);void 0!==r&&(t.delete(n),r.dispose())}return{get:function(r){if(r&&r.isTexture){const o=r.mapping,a=303===o||304===o,s=o===Uh||o===jh;if(a||s){if(r.isRenderTargetTexture&&!0===r.needsPMREMUpdate){r.needsPMREMUpdate=!1;let i=t.get(r);return null===n&&(n=new Dm(e)),i=a?n.fromEquirectangular(r,i):n.fromCubemap(r,i),t.set(r,i),i.texture}if(t.has(r))return t.get(r).texture;{const o=r.image;if(a&&o&&o.height>0||s&&o&&function(e){let t=0;for(let n=0;n<6;n++)void 0!==e[n]&&t++;return 6===t}(o)){null===n&&(n=new Dm(e));const o=a?n.fromEquirectangular(r):n.fromCubemap(r);return t.set(r,o),r.addEventListener("dispose",i),o.texture}return null}}}return r},dispose:function(){t=new WeakMap,null!==n&&(n.dispose(),n=null)}}}function Jm(e){const t={};function n(n){if(void 0!==t[n])return t[n];let i;switch(n){case"WEBGL_depth_texture":i=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":i=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":i=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":i=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:i=e.getExtension(n)}return t[n]=i,i}return{has:function(e){return null!==n(e)},init:function(e){e.isWebGL2?n("EXT_color_buffer_float"):(n("WEBGL_depth_texture"),n("OES_texture_float"),n("OES_texture_half_float"),n("OES_texture_half_float_linear"),n("OES_standard_derivatives"),n("OES_element_index_uint"),n("OES_vertex_array_object"),n("ANGLE_instanced_arrays")),n("OES_texture_float_linear"),n("EXT_color_buffer_half_float"),n("WEBGL_multisampled_render_to_texture")},get:function(e){const t=n(e);return null===t&&console.warn("THREE.WebGLRenderer: "+e+" extension not supported."),t}}}function $m(e,t,n,i){const r={},o=new WeakMap;function a(e){const s=e.target;null!==s.index&&t.remove(s.index);for(const e in s.attributes)t.remove(s.attributes[e]);s.removeEventListener("dispose",a),delete r[s.id];const l=o.get(s);l&&(t.remove(l),o.delete(s)),i.releaseStatesOfGeometry(s),!0===s.isInstancedBufferGeometry&&delete s._maxInstanceCount,n.memory.geometries--}function s(e){const n=[],i=e.index,r=e.attributes.position;let a=0;if(null!==i){const e=i.array;a=i.version;for(let t=0,i=e.length;t<i;t+=3){const i=e[t+0],r=e[t+1],o=e[t+2];n.push(i,r,r,o,o,i)}}else{const e=r.array;a=r.version;for(let t=0,i=e.length/3-1;t<i;t+=3){const e=t+0,i=t+1,r=t+2;n.push(e,i,i,r,r,e)}}const s=new(Hc(n)?Nd:Cd)(n,1);s.version=a;const l=o.get(e);l&&t.remove(l),o.set(e,s)}return{get:function(e,t){return!0===r[t.id]||(t.addEventListener("dispose",a),r[t.id]=!0,n.memory.geometries++),t},update:function(e){const n=e.attributes;for(const e in n)t.update(n[e],34962);const i=e.morphAttributes;for(const e in i){const n=i[e];for(let e=0,i=n.length;e<i;e++)t.update(n[e],34962)}},getWireframeAttribute:function(e){const t=o.get(e);if(t){const n=e.index;null!==n&&t.version<n.version&&s(e)}else s(e);return o.get(e)}}}function Xm(e,t,n,i){const r=i.isWebGL2;let o,a,s;this.setMode=function(e){o=e},this.setIndex=function(e){a=e.type,s=e.bytesPerElement},this.render=function(t,i){e.drawElements(o,i,a,t*s),n.update(i,o,1)},this.renderInstances=function(i,l,p){if(0===p)return;let u,h;if(r)u=e,h="drawElementsInstanced";else if(u=t.get("ANGLE_instanced_arrays"),h="drawElementsInstancedANGLE",null===u)return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");u[h](o,l,a,i*s,p),n.update(l,o,p)}}function Ym(e){const t={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:t,programs:null,autoReset:!0,reset:function(){t.frame++,t.calls=0,t.triangles=0,t.points=0,t.lines=0},update:function(e,n,i){switch(t.calls++,n){case 4:t.triangles+=i*(e/3);break;case 1:t.lines+=i*(e/2);break;case 3:t.lines+=i*(e-1);break;case 2:t.lines+=i*e;break;case 0:t.points+=i*e;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",n)}}}}function Km(e,t){return e[0]-t[0]}function Qm(e,t){return Math.abs(t[1])-Math.abs(e[1])}function eP(e,t,n){const i={},r=new Float32Array(8),o=new WeakMap,a=new o_,s=[];for(let e=0;e<8;e++)s[e]=[e,0];return{update:function(l,p,u,h){const c=l.morphTargetInfluences;if(!0===t.isWebGL2){const i=p.morphAttributes.position||p.morphAttributes.normal||p.morphAttributes.color,r=void 0!==i?i.length:0;let s=o.get(p);if(void 0===s||s.count!==r){void 0!==s&&s.texture.dispose();const e=void 0!==p.morphAttributes.position,n=void 0!==p.morphAttributes.normal,i=void 0!==p.morphAttributes.color,l=p.morphAttributes.position||[],u=p.morphAttributes.normal||[],h=p.morphAttributes.color||[];let c=0;!0===e&&(c=1),!0===n&&(c=2),!0===i&&(c=3);let _=p.attributes.position.count*c,d=1;_>t.maxTextureSize&&(d=Math.ceil(_/t.maxTextureSize),_=t.maxTextureSize);const m=new Float32Array(_*d*4*r),P=new s_(m,_,d,r);P.type=tc,P.needsUpdate=!0;const f=4*c;for(let t=0;t<r;t++){const r=l[t],o=u[t],s=h[t],p=_*d*4*t;for(let t=0;t<r.count;t++){const l=t*f;!0===e&&(a.fromBufferAttribute(r,t),m[p+l+0]=a.x,m[p+l+1]=a.y,m[p+l+2]=a.z,m[p+l+3]=0),!0===n&&(a.fromBufferAttribute(o,t),m[p+l+4]=a.x,m[p+l+5]=a.y,m[p+l+6]=a.z,m[p+l+7]=0),!0===i&&(a.fromBufferAttribute(s,t),m[p+l+8]=a.x,m[p+l+9]=a.y,m[p+l+10]=a.z,m[p+l+11]=4===s.itemSize?a.w:1)}}function x(){P.dispose(),o.delete(p),p.removeEventListener("dispose",x)}s={count:r,texture:P,size:new Oc(_,d)},o.set(p,s),p.addEventListener("dispose",x)}let l=0;for(let e=0;e<c.length;e++)l+=c[e];const u=p.morphTargetsRelative?1:1-l;h.getUniforms().setValue(e,"morphTargetBaseInfluence",u),h.getUniforms().setValue(e,"morphTargetInfluences",c),h.getUniforms().setValue(e,"morphTargetsTexture",s.texture,n),h.getUniforms().setValue(e,"morphTargetsTextureSize",s.size)}else{const t=void 0===c?0:c.length;let n=i[p.id];if(void 0===n||n.length!==t){n=[];for(let e=0;e<t;e++)n[e]=[e,0];i[p.id]=n}for(let e=0;e<t;e++){const t=n[e];t[0]=e,t[1]=c[e]}n.sort(Qm);for(let e=0;e<8;e++)e<t&&n[e][1]?(s[e][0]=n[e][0],s[e][1]=n[e][1]):(s[e][0]=Number.MAX_SAFE_INTEGER,s[e][1]=0);s.sort(Km);const o=p.morphAttributes.position,a=p.morphAttributes.normal;let l=0;for(let e=0;e<8;e++){const t=s[e],n=t[0],i=t[1];n!==Number.MAX_SAFE_INTEGER&&i?(o&&p.getAttribute("morphTarget"+e)!==o[n]&&p.setAttribute("morphTarget"+e,o[n]),a&&p.getAttribute("morphNormal"+e)!==a[n]&&p.setAttribute("morphNormal"+e,a[n]),r[e]=i,l+=i):(o&&!0===p.hasAttribute("morphTarget"+e)&&p.deleteAttribute("morphTarget"+e),a&&!0===p.hasAttribute("morphNormal"+e)&&p.deleteAttribute("morphNormal"+e),r[e]=0)}const u=p.morphTargetsRelative?1:1-l;h.getUniforms().setValue(e,"morphTargetBaseInfluence",u),h.getUniforms().setValue(e,"morphTargetInfluences",r)}}}}function tP(e,t,n,i){let r=new WeakMap;function o(e){const t=e.target;t.removeEventListener("dispose",o),n.remove(t.instanceMatrix),null!==t.instanceColor&&n.remove(t.instanceColor)}return{update:function(e){const a=i.render.frame,s=e.geometry,l=t.get(e,s);return r.get(l)!==a&&(t.update(l),r.set(l,a)),e.isInstancedMesh&&(!1===e.hasEventListener("dispose",o)&&e.addEventListener("dispose",o),n.update(e.instanceMatrix,34962),null!==e.instanceColor&&n.update(e.instanceColor,34962)),l},dispose:function(){r=new WeakMap}}}const nP=new r_,iP=new s_,rP=new class extends r_{constructor(e=null,t=1,n=1,i=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:n,depth:i},this.magFilter=Xh,this.minFilter=Xh,this.wrapR=Jh,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}},oP=new dm,aP=[],sP=[],lP=new Float32Array(16),pP=new Float32Array(9),uP=new Float32Array(4);function hP(e,t,n){const i=e[0];if(i<=0||i>0)return e;const r=t*n;let o=aP[r];if(void 0===o&&(o=new Float32Array(r),aP[r]=o),0!==t){i.toArray(o,0);for(let i=1,r=0;i!==t;++i)r+=n,e[i].toArray(o,r)}return o}function cP(e,t){if(e.length!==t.length)return!1;for(let n=0,i=e.length;n<i;n++)if(e[n]!==t[n])return!1;return!0}function _P(e,t){for(let n=0,i=t.length;n<i;n++)e[n]=t[n]}function dP(e,t){let n=sP[t];void 0===n&&(n=new Int32Array(t),sP[t]=n);for(let i=0;i!==t;++i)n[i]=e.allocateTextureUnit();return n}function mP(e,t){const n=this.cache;n[0]!==t&&(e.uniform1f(this.addr,t),n[0]=t)}function PP(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y||(e.uniform2f(this.addr,t.x,t.y),n[0]=t.x,n[1]=t.y);else{if(cP(n,t))return;e.uniform2fv(this.addr,t),_P(n,t)}}function fP(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z||(e.uniform3f(this.addr,t.x,t.y,t.z),n[0]=t.x,n[1]=t.y,n[2]=t.z);else if(void 0!==t.r)n[0]===t.r&&n[1]===t.g&&n[2]===t.b||(e.uniform3f(this.addr,t.r,t.g,t.b),n[0]=t.r,n[1]=t.g,n[2]=t.b);else{if(cP(n,t))return;e.uniform3fv(this.addr,t),_P(n,t)}}function xP(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z&&n[3]===t.w||(e.uniform4f(this.addr,t.x,t.y,t.z,t.w),n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w);else{if(cP(n,t))return;e.uniform4fv(this.addr,t),_P(n,t)}}function yP(e,t){const n=this.cache,i=t.elements;if(void 0===i){if(cP(n,t))return;e.uniformMatrix2fv(this.addr,!1,t),_P(n,t)}else{if(cP(n,i))return;uP.set(i),e.uniformMatrix2fv(this.addr,!1,uP),_P(n,i)}}function vP(e,t){const n=this.cache,i=t.elements;if(void 0===i){if(cP(n,t))return;e.uniformMatrix3fv(this.addr,!1,t),_P(n,t)}else{if(cP(n,i))return;pP.set(i),e.uniformMatrix3fv(this.addr,!1,pP),_P(n,i)}}function gP(e,t){const n=this.cache,i=t.elements;if(void 0===i){if(cP(n,t))return;e.uniformMatrix4fv(this.addr,!1,t),_P(n,t)}else{if(cP(n,i))return;lP.set(i),e.uniformMatrix4fv(this.addr,!1,lP),_P(n,i)}}function bP(e,t){const n=this.cache;n[0]!==t&&(e.uniform1i(this.addr,t),n[0]=t)}function zP(e,t){const n=this.cache;cP(n,t)||(e.uniform2iv(this.addr,t),_P(n,t))}function wP(e,t){const n=this.cache;cP(n,t)||(e.uniform3iv(this.addr,t),_P(n,t))}function ZP(e,t){const n=this.cache;cP(n,t)||(e.uniform4iv(this.addr,t),_P(n,t))}function EP(e,t){const n=this.cache;n[0]!==t&&(e.uniform1ui(this.addr,t),n[0]=t)}function MP(e,t){const n=this.cache;cP(n,t)||(e.uniform2uiv(this.addr,t),_P(n,t))}function SP(e,t){const n=this.cache;cP(n,t)||(e.uniform3uiv(this.addr,t),_P(n,t))}function CP(e,t){const n=this.cache;cP(n,t)||(e.uniform4uiv(this.addr,t),_P(n,t))}function NP(e,t,n){const i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(e.uniform1i(this.addr,r),i[0]=r),n.setTexture2D(t||nP,r)}function AP(e,t,n){const i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(e.uniform1i(this.addr,r),i[0]=r),n.setTexture3D(t||rP,r)}function LP(e,t,n){const i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(e.uniform1i(this.addr,r),i[0]=r),n.setTextureCube(t||oP,r)}function BP(e,t,n){const i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(e.uniform1i(this.addr,r),i[0]=r),n.setTexture2DArray(t||iP,r)}function TP(e,t){e.uniform1fv(this.addr,t)}function VP(e,t){const n=hP(t,this.size,2);e.uniform2fv(this.addr,n)}function kP(e,t){const n=hP(t,this.size,3);e.uniform3fv(this.addr,n)}function IP(e,t){const n=hP(t,this.size,4);e.uniform4fv(this.addr,n)}function OP(e,t){const n=hP(t,this.size,4);e.uniformMatrix2fv(this.addr,!1,n)}function RP(e,t){const n=hP(t,this.size,9);e.uniformMatrix3fv(this.addr,!1,n)}function HP(e,t){const n=hP(t,this.size,16);e.uniformMatrix4fv(this.addr,!1,n)}function FP(e,t){e.uniform1iv(this.addr,t)}function DP(e,t){e.uniform2iv(this.addr,t)}function GP(e,t){e.uniform3iv(this.addr,t)}function UP(e,t){e.uniform4iv(this.addr,t)}function jP(e,t){e.uniform1uiv(this.addr,t)}function WP(e,t){e.uniform2uiv(this.addr,t)}function qP(e,t){e.uniform3uiv(this.addr,t)}function JP(e,t){e.uniform4uiv(this.addr,t)}function $P(e,t,n){const i=t.length,r=dP(n,i);e.uniform1iv(this.addr,r);for(let e=0;e!==i;++e)n.setTexture2D(t[e]||nP,r[e])}function XP(e,t,n){const i=t.length,r=dP(n,i);e.uniform1iv(this.addr,r);for(let e=0;e!==i;++e)n.setTexture3D(t[e]||rP,r[e])}function YP(e,t,n){const i=t.length,r=dP(n,i);e.uniform1iv(this.addr,r);for(let e=0;e!==i;++e)n.setTextureCube(t[e]||oP,r[e])}function KP(e,t,n){const i=t.length,r=dP(n,i);e.uniform1iv(this.addr,r);for(let e=0;e!==i;++e)n.setTexture2DArray(t[e]||iP,r[e])}class QP{constructor(e,t,n){this.id=e,this.addr=n,this.cache=[],this.setValue=function(e){switch(e){case 5126:return mP;case 35664:return PP;case 35665:return fP;case 35666:return xP;case 35674:return yP;case 35675:return vP;case 35676:return gP;case 5124:case 35670:return bP;case 35667:case 35671:return zP;case 35668:case 35672:return wP;case 35669:case 35673:return ZP;case 5125:return EP;case 36294:return MP;case 36295:return SP;case 36296:return CP;case 35678:case 36198:case 36298:case 36306:case 35682:return NP;case 35679:case 36299:case 36307:return AP;case 35680:case 36300:case 36308:case 36293:return LP;case 36289:case 36303:case 36311:case 36292:return BP}}(t.type)}}class ef{constructor(e,t,n){this.id=e,this.addr=n,this.cache=[],this.size=t.size,this.setValue=function(e){switch(e){case 5126:return TP;case 35664:return VP;case 35665:return kP;case 35666:return IP;case 35674:return OP;case 35675:return RP;case 35676:return HP;case 5124:case 35670:return FP;case 35667:case 35671:return DP;case 35668:case 35672:return GP;case 35669:case 35673:return UP;case 5125:return jP;case 36294:return WP;case 36295:return qP;case 36296:return JP;case 35678:case 36198:case 36298:case 36306:case 35682:return $P;case 35679:case 36299:case 36307:return XP;case 35680:case 36300:case 36308:case 36293:return YP;case 36289:case 36303:case 36311:case 36292:return KP}}(t.type)}}class tf{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,t,n){const i=this.seq;for(let r=0,o=i.length;r!==o;++r){const o=i[r];o.setValue(e,t[o.id],n)}}}const nf=/(\w+)(\])?(\[|\.)?/g;function rf(e,t){e.seq.push(t),e.map[t.id]=t}function of(e,t,n){const i=e.name,r=i.length;for(nf.lastIndex=0;;){const o=nf.exec(i),a=nf.lastIndex;let s=o[1];const l="]"===o[2],p=o[3];if(l&&(s|=0),void 0===p||"["===p&&a+2===r){rf(n,void 0===p?new QP(s,e,t):new ef(s,e,t));break}{let e=n.map[s];void 0===e&&(e=new tf(s),rf(n,e)),n=e}}}class af{constructor(e,t){this.seq=[],this.map={};const n=e.getProgramParameter(t,35718);for(let i=0;i<n;++i){const n=e.getActiveUniform(t,i);of(n,e.getUniformLocation(t,n.name),this)}}setValue(e,t,n,i){const r=this.map[t];void 0!==r&&r.setValue(e,n,i)}setOptional(e,t,n){const i=t[n];void 0!==i&&this.setValue(e,n,i)}static upload(e,t,n,i){for(let r=0,o=t.length;r!==o;++r){const o=t[r],a=n[o.id];!1!==a.needsUpdate&&o.setValue(e,a.value,i)}}static seqWithValue(e,t){const n=[];for(let i=0,r=e.length;i!==r;++i){const r=e[i];r.id in t&&n.push(r)}return n}}function sf(e,t,n){const i=e.createShader(t);return e.shaderSource(i,n),e.compileShader(i),i}let lf=0;function pf(e,t,n){const i=e.getShaderParameter(t,35713),r=e.getShaderInfoLog(t).trim();if(i&&""===r)return"";const o=/ERROR: 0:(\d+)/.exec(r);if(o){const i=parseInt(o[1]);return n.toUpperCase()+"\n\n"+r+"\n\n"+function(e,t){const n=e.split("\n"),i=[],r=Math.max(t-6,0),o=Math.min(t+6,n.length);for(let e=r;e<o;e++){const r=e+1;i.push(`${r===t?">":" "} ${r}: ${n[e]}`)}return i.join("\n")}(e.getShaderSource(t),i)}return r}function uf(e,t){const n=function(e){switch(e){case fc:return["Linear","( value )"];case xc:return["sRGB","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",e),["Linear","( value )"]}}(t);return"vec4 "+e+"( vec4 value ) { return LinearTo"+n[0]+n[1]+"; }"}function hf(e,t){let n;switch(t){case 1:n="Linear";break;case 2:n="Reinhard";break;case 3:n="OptimizedCineon";break;case 4:n="ACESFilmic";break;case 5:n="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",t),n="Linear"}return"vec3 "+e+"( vec3 color ) { return "+n+"ToneMapping( color ); }"}function cf(e){return""!==e}function _f(e,t){const n=t.numSpotLightShadows+t.numSpotLightMaps-t.numSpotLightShadowsWithMaps;return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,t.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,n).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,t.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function df(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}const mf=/^[ \t]*#include +<([\w\d./]+)>/gm;function Pf(e){return e.replace(mf,ff)}function ff(e,t){const n=Em[t];if(void 0===n)throw new Error("Can not resolve #include <"+t+">");return Pf(n)}const xf=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function yf(e){return e.replace(xf,vf)}function vf(e,t,n,i){let r="";for(let e=parseInt(t);e<parseInt(n);e++)r+=i.replace(/\[\s*i\s*\]/g,"[ "+e+" ]").replace(/UNROLLED_LOOP_INDEX/g,e);return r}function gf(e){let t="precision "+e.precision+" float;\nprecision "+e.precision+" int;";return"highp"===e.precision?t+="\n#define HIGH_PRECISION":"mediump"===e.precision?t+="\n#define MEDIUM_PRECISION":"lowp"===e.precision&&(t+="\n#define LOW_PRECISION"),t}function bf(e,t,n,i){const r=e.getContext(),o=n.defines;let a=n.vertexShader,s=n.fragmentShader;const l=function(e){let t="SHADOWMAP_TYPE_BASIC";return 1===e.shadowMapType?t="SHADOWMAP_TYPE_PCF":2===e.shadowMapType?t="SHADOWMAP_TYPE_PCF_SOFT":3===e.shadowMapType&&(t="SHADOWMAP_TYPE_VSM"),t}(n),p=function(e){let t="ENVMAP_TYPE_CUBE";if(e.envMap)switch(e.envMapMode){case Uh:case jh:t="ENVMAP_TYPE_CUBE";break;case Wh:t="ENVMAP_TYPE_CUBE_UV"}return t}(n),u=function(e){let t="ENVMAP_MODE_REFLECTION";return e.envMap&&e.envMapMode===jh&&(t="ENVMAP_MODE_REFRACTION"),t}(n),h=function(e){let t="ENVMAP_BLENDING_NONE";if(e.envMap)switch(e.combine){case 0:t="ENVMAP_BLENDING_MULTIPLY";break;case 1:t="ENVMAP_BLENDING_MIX";break;case 2:t="ENVMAP_BLENDING_ADD"}return t}(n),c=function(e){const t=e.envMapCubeUVHeight;if(null===t)return null;const n=Math.log2(t)-2,i=1/t;return{texelWidth:1/(3*Math.max(Math.pow(2,n),112)),texelHeight:i,maxMip:n}}(n),_=n.isWebGL2?"":function(e){return[e.extensionDerivatives||e.envMapCubeUVHeight||e.bumpMap||e.tangentSpaceNormalMap||e.clearcoatNormalMap||e.flatShading||"physical"===e.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(e.extensionFragDepth||e.logarithmicDepthBuffer)&&e.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",e.extensionDrawBuffers&&e.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(e.extensionShaderTextureLOD||e.envMap||e.transmission)&&e.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(cf).join("\n")}(n),d=function(e){const t=[];for(const n in e){const i=e[n];!1!==i&&t.push("#define "+n+" "+i)}return t.join("\n")}(o),m=r.createProgram();let P,f,x=n.glslVersion?"#version "+n.glslVersion+"\n":"";n.isRawShaderMaterial?(P=[d].filter(cf).join("\n"),P.length>0&&(P+="\n"),f=[_,d].filter(cf).join("\n"),f.length>0&&(f+="\n")):(P=[gf(n),"#define SHADER_NAME "+n.shaderName,d,n.instancing?"#define USE_INSTANCING":"",n.instancingColor?"#define USE_INSTANCING_COLOR":"",n.supportsVertexTextures?"#define VERTEX_TEXTURES":"",n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+u:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMap&&n.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",n.normalMap&&n.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",n.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",n.displacementMap&&n.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",n.specularColorMap?"#define USE_SPECULARCOLORMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.sheenColorMap?"#define USE_SHEENCOLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",n.vertexTangents?"#define USE_TANGENT":"",n.vertexColors?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUvs?"#define USE_UV":"",n.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",n.flatShading?"#define FLAT_SHADED":"",n.skinning?"#define USE_SKINNING":"",n.morphTargets?"#define USE_MORPHTARGETS":"",n.morphNormals&&!1===n.flatShading?"#define USE_MORPHNORMALS":"",n.morphColors&&n.isWebGL2?"#define USE_MORPHCOLORS":"",n.morphTargetsCount>0&&n.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",n.morphTargetsCount>0&&n.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+n.morphTextureStride:"",n.morphTargetsCount>0&&n.isWebGL2?"#define MORPHTARGETS_COUNT "+n.morphTargetsCount:"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+l:"",n.sizeAttenuation?"#define USE_SIZEATTENUATION":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","\tattribute vec4 color;","#elif defined( USE_COLOR )","\tattribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(cf).join("\n"),f=[_,gf(n),"#define SHADER_NAME "+n.shaderName,d,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.matcap?"#define USE_MATCAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+p:"",n.envMap?"#define "+u:"",n.envMap?"#define "+h:"",c?"#define CUBEUV_TEXEL_WIDTH "+c.texelWidth:"",c?"#define CUBEUV_TEXEL_HEIGHT "+c.texelHeight:"",c?"#define CUBEUV_MAX_MIP "+c.maxMip+".0":"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMap&&n.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",n.normalMap&&n.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",n.clearcoat?"#define USE_CLEARCOAT":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.iridescence?"#define USE_IRIDESCENCE":"",n.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",n.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",n.specularColorMap?"#define USE_SPECULARCOLORMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.alphaTest?"#define USE_ALPHATEST":"",n.sheen?"#define USE_SHEEN":"",n.sheenColorMap?"#define USE_SHEENCOLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",n.vertexTangents?"#define USE_TANGENT":"",n.vertexColors||n.instancingColor?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUvs?"#define USE_UV":"",n.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",n.gradientMap?"#define USE_GRADIENTMAP":"",n.flatShading?"#define FLAT_SHADED":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+l:"",n.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",n.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",0!==n.toneMapping?"#define TONE_MAPPING":"",0!==n.toneMapping?Em.tonemapping_pars_fragment:"",0!==n.toneMapping?hf("toneMapping",n.toneMapping):"",n.dithering?"#define DITHERING":"",n.opaque?"#define OPAQUE":"",Em.encodings_pars_fragment,uf("linearToOutputTexel",n.outputEncoding),n.useDepthPacking?"#define DEPTH_PACKING "+n.depthPacking:"","\n"].filter(cf).join("\n")),a=Pf(a),a=_f(a,n),a=df(a,n),s=Pf(s),s=_f(s,n),s=df(s,n),a=yf(a),s=yf(s),n.isWebGL2&&!0!==n.isRawShaderMaterial&&(x="#version 300 es\n",P=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+P,f=["#define varying in",n.glslVersion===bc?"":"layout(location = 0) out highp vec4 pc_fragColor;",n.glslVersion===bc?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+f);const y=x+f+s,v=sf(r,35633,x+P+a),g=sf(r,35632,y);if(r.attachShader(m,v),r.attachShader(m,g),void 0!==n.index0AttributeName?r.bindAttribLocation(m,0,n.index0AttributeName):!0===n.morphTargets&&r.bindAttribLocation(m,0,"position"),r.linkProgram(m),e.debug.checkShaderErrors){const e=r.getProgramInfoLog(m).trim(),t=r.getShaderInfoLog(v).trim(),n=r.getShaderInfoLog(g).trim();let i=!0,o=!0;if(!1===r.getProgramParameter(m,35714)){i=!1;const t=pf(r,v,"vertex"),n=pf(r,g,"fragment");console.error("THREE.WebGLProgram: Shader Error "+r.getError()+" - VALIDATE_STATUS "+r.getProgramParameter(m,35715)+"\n\nProgram Info Log: "+e+"\n"+t+"\n"+n)}else""!==e?console.warn("THREE.WebGLProgram: Program Info Log:",e):""!==t&&""!==n||(o=!1);o&&(this.diagnostics={runnable:i,programLog:e,vertexShader:{log:t,prefix:P},fragmentShader:{log:n,prefix:f}})}let b,z;return r.deleteShader(v),r.deleteShader(g),this.getUniforms=function(){return void 0===b&&(b=new af(r,m)),b},this.getAttributes=function(){return void 0===z&&(z=function(e,t){const n={},i=e.getProgramParameter(t,35721);for(let r=0;r<i;r++){const i=e.getActiveAttrib(t,r),o=i.name;let a=1;35674===i.type&&(a=2),35675===i.type&&(a=3),35676===i.type&&(a=4),n[o]={type:i.type,location:e.getAttribLocation(t,o),locationSize:a}}return n}(r,m)),z},this.destroy=function(){i.releaseStatesOfProgram(this),r.deleteProgram(m),this.program=void 0},this.name=n.shaderName,this.id=lf++,this.cacheKey=t,this.usedTimes=1,this.program=m,this.vertexShader=v,this.fragmentShader=g,this}let zf=0;class wf{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const t=e.vertexShader,n=e.fragmentShader,i=this._getShaderStage(t),r=this._getShaderStage(n),o=this._getShaderCacheForMaterial(e);return!1===o.has(i)&&(o.add(i),i.usedTimes++),!1===o.has(r)&&(o.add(r),r.usedTimes++),this}remove(e){const t=this.materialCache.get(e);for(const e of t)e.usedTimes--,0===e.usedTimes&&this.shaderCache.delete(e.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const t=this.materialCache;let n=t.get(e);return void 0===n&&(n=new Set,t.set(e,n)),n}_getShaderStage(e){const t=this.shaderCache;let n=t.get(e);return void 0===n&&(n=new Zf(e),t.set(e,n)),n}}class Zf{constructor(e){this.id=zf++,this.code=e,this.usedTimes=0}}function Ef(e,t,n,i,r,o,a){const s=new Y_,l=new wf,p=[],u=r.isWebGL2,h=r.logarithmicDepthBuffer,c=r.vertexTextures;let _=r.precision;const d={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};return{getParameters:function(o,s,p,m,P){const f=m.fog,x=P.geometry,y=o.isMeshStandardMaterial?m.environment:null,v=(o.isMeshStandardMaterial?n:t).get(o.envMap||y),g=v&&v.mapping===Wh?v.image.height:null,b=d[o.type];null!==o.precision&&(_=r.getMaxPrecision(o.precision),_!==o.precision&&console.warn("THREE.WebGLProgram.getParameters:",o.precision,"not supported, using",_,"instead."));const z=x.morphAttributes.position||x.morphAttributes.normal||x.morphAttributes.color,w=void 0!==z?z.length:0;let Z,E,M,S,C=0;if(void 0!==x.morphAttributes.position&&(C=1),void 0!==x.morphAttributes.normal&&(C=2),void 0!==x.morphAttributes.color&&(C=3),b){const e=Sm[b];Z=e.vertexShader,E=e.fragmentShader}else Z=o.vertexShader,E=o.fragmentShader,l.update(o),M=l.getVertexShaderID(o),S=l.getFragmentShaderID(o);const N=e.getRenderTarget(),A=o.alphaTest>0,L=o.clearcoat>0,B=o.iridescence>0;return{isWebGL2:u,shaderID:b,shaderName:o.type,vertexShader:Z,fragmentShader:E,defines:o.defines,customVertexShaderID:M,customFragmentShaderID:S,isRawShaderMaterial:!0===o.isRawShaderMaterial,glslVersion:o.glslVersion,precision:_,instancing:!0===P.isInstancedMesh,instancingColor:!0===P.isInstancedMesh&&null!==P.instanceColor,supportsVertexTextures:c,outputEncoding:null===N?e.outputEncoding:!0===N.isXRRenderTarget?N.texture.encoding:fc,map:!!o.map,matcap:!!o.matcap,envMap:!!v,envMapMode:v&&v.mapping,envMapCubeUVHeight:g,lightMap:!!o.lightMap,aoMap:!!o.aoMap,emissiveMap:!!o.emissiveMap,bumpMap:!!o.bumpMap,normalMap:!!o.normalMap,objectSpaceNormalMap:1===o.normalMapType,tangentSpaceNormalMap:0===o.normalMapType,decodeVideoTexture:!!o.map&&!0===o.map.isVideoTexture&&o.map.encoding===xc,clearcoat:L,clearcoatMap:L&&!!o.clearcoatMap,clearcoatRoughnessMap:L&&!!o.clearcoatRoughnessMap,clearcoatNormalMap:L&&!!o.clearcoatNormalMap,iridescence:B,iridescenceMap:B&&!!o.iridescenceMap,iridescenceThicknessMap:B&&!!o.iridescenceThicknessMap,displacementMap:!!o.displacementMap,roughnessMap:!!o.roughnessMap,metalnessMap:!!o.metalnessMap,specularMap:!!o.specularMap,specularIntensityMap:!!o.specularIntensityMap,specularColorMap:!!o.specularColorMap,opaque:!1===o.transparent&&1===o.blending,alphaMap:!!o.alphaMap,alphaTest:A,gradientMap:!!o.gradientMap,sheen:o.sheen>0,sheenColorMap:!!o.sheenColorMap,sheenRoughnessMap:!!o.sheenRoughnessMap,transmission:o.transmission>0,transmissionMap:!!o.transmissionMap,thicknessMap:!!o.thicknessMap,combine:o.combine,vertexTangents:!!o.normalMap&&!!x.attributes.tangent,vertexColors:o.vertexColors,vertexAlphas:!0===o.vertexColors&&!!x.attributes.color&&4===x.attributes.color.itemSize,vertexUvs:!!(o.map||o.bumpMap||o.normalMap||o.specularMap||o.alphaMap||o.emissiveMap||o.roughnessMap||o.metalnessMap||o.clearcoatMap||o.clearcoatRoughnessMap||o.clearcoatNormalMap||o.iridescenceMap||o.iridescenceThicknessMap||o.displacementMap||o.transmissionMap||o.thicknessMap||o.specularIntensityMap||o.specularColorMap||o.sheenColorMap||o.sheenRoughnessMap),uvsVertexOnly:!(o.map||o.bumpMap||o.normalMap||o.specularMap||o.alphaMap||o.emissiveMap||o.roughnessMap||o.metalnessMap||o.clearcoatNormalMap||o.iridescenceMap||o.iridescenceThicknessMap||o.transmission>0||o.transmissionMap||o.thicknessMap||o.specularIntensityMap||o.specularColorMap||o.sheen>0||o.sheenColorMap||o.sheenRoughnessMap||!o.displacementMap),fog:!!f,useFog:!0===o.fog,fogExp2:f&&f.isFogExp2,flatShading:!!o.flatShading,sizeAttenuation:o.sizeAttenuation,logarithmicDepthBuffer:h,skinning:!0===P.isSkinnedMesh,morphTargets:void 0!==x.morphAttributes.position,morphNormals:void 0!==x.morphAttributes.normal,morphColors:void 0!==x.morphAttributes.color,morphTargetsCount:w,morphTextureStride:C,numDirLights:s.directional.length,numPointLights:s.point.length,numSpotLights:s.spot.length,numSpotLightMaps:s.spotLightMap.length,numRectAreaLights:s.rectArea.length,numHemiLights:s.hemi.length,numDirLightShadows:s.directionalShadowMap.length,numPointLightShadows:s.pointShadowMap.length,numSpotLightShadows:s.spotShadowMap.length,numSpotLightShadowsWithMaps:s.numSpotLightShadowsWithMaps,numClippingPlanes:a.numPlanes,numClipIntersection:a.numIntersection,dithering:o.dithering,shadowMapEnabled:e.shadowMap.enabled&&p.length>0,shadowMapType:e.shadowMap.type,toneMapping:o.toneMapped?e.toneMapping:0,physicallyCorrectLights:e.physicallyCorrectLights,premultipliedAlpha:o.premultipliedAlpha,doubleSided:2===o.side,flipSided:1===o.side,useDepthPacking:!!o.depthPacking,depthPacking:o.depthPacking||0,index0AttributeName:o.index0AttributeName,extensionDerivatives:o.extensions&&o.extensions.derivatives,extensionFragDepth:o.extensions&&o.extensions.fragDepth,extensionDrawBuffers:o.extensions&&o.extensions.drawBuffers,extensionShaderTextureLOD:o.extensions&&o.extensions.shaderTextureLOD,rendererExtensionFragDepth:u||i.has("EXT_frag_depth"),rendererExtensionDrawBuffers:u||i.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:u||i.has("EXT_shader_texture_lod"),customProgramCacheKey:o.customProgramCacheKey()}},getProgramCacheKey:function(t){const n=[];if(t.shaderID?n.push(t.shaderID):(n.push(t.customVertexShaderID),n.push(t.customFragmentShaderID)),void 0!==t.defines)for(const e in t.defines)n.push(e),n.push(t.defines[e]);return!1===t.isRawShaderMaterial&&(function(e,t){e.push(t.precision),e.push(t.outputEncoding),e.push(t.envMapMode),e.push(t.envMapCubeUVHeight),e.push(t.combine),e.push(t.vertexUvs),e.push(t.fogExp2),e.push(t.sizeAttenuation),e.push(t.morphTargetsCount),e.push(t.morphAttributeCount),e.push(t.numDirLights),e.push(t.numPointLights),e.push(t.numSpotLights),e.push(t.numSpotLightMaps),e.push(t.numHemiLights),e.push(t.numRectAreaLights),e.push(t.numDirLightShadows),e.push(t.numPointLightShadows),e.push(t.numSpotLightShadows),e.push(t.numSpotLightShadowsWithMaps),e.push(t.shadowMapType),e.push(t.toneMapping),e.push(t.numClippingPlanes),e.push(t.numClipIntersection),e.push(t.depthPacking)}(n,t),function(e,t){s.disableAll(),t.isWebGL2&&s.enable(0),t.supportsVertexTextures&&s.enable(1),t.instancing&&s.enable(2),t.instancingColor&&s.enable(3),t.map&&s.enable(4),t.matcap&&s.enable(5),t.envMap&&s.enable(6),t.lightMap&&s.enable(7),t.aoMap&&s.enable(8),t.emissiveMap&&s.enable(9),t.bumpMap&&s.enable(10),t.normalMap&&s.enable(11),t.objectSpaceNormalMap&&s.enable(12),t.tangentSpaceNormalMap&&s.enable(13),t.clearcoat&&s.enable(14),t.clearcoatMap&&s.enable(15),t.clearcoatRoughnessMap&&s.enable(16),t.clearcoatNormalMap&&s.enable(17),t.iridescence&&s.enable(18),t.iridescenceMap&&s.enable(19),t.iridescenceThicknessMap&&s.enable(20),t.displacementMap&&s.enable(21),t.specularMap&&s.enable(22),t.roughnessMap&&s.enable(23),t.metalnessMap&&s.enable(24),t.gradientMap&&s.enable(25),t.alphaMap&&s.enable(26),t.alphaTest&&s.enable(27),t.vertexColors&&s.enable(28),t.vertexAlphas&&s.enable(29),t.vertexUvs&&s.enable(30),t.vertexTangents&&s.enable(31),t.uvsVertexOnly&&s.enable(32),e.push(s.mask),s.disableAll(),t.fog&&s.enable(0),t.useFog&&s.enable(1),t.flatShading&&s.enable(2),t.logarithmicDepthBuffer&&s.enable(3),t.skinning&&s.enable(4),t.morphTargets&&s.enable(5),t.morphNormals&&s.enable(6),t.morphColors&&s.enable(7),t.premultipliedAlpha&&s.enable(8),t.shadowMapEnabled&&s.enable(9),t.physicallyCorrectLights&&s.enable(10),t.doubleSided&&s.enable(11),t.flipSided&&s.enable(12),t.useDepthPacking&&s.enable(13),t.dithering&&s.enable(14),t.specularIntensityMap&&s.enable(15),t.specularColorMap&&s.enable(16),t.transmission&&s.enable(17),t.transmissionMap&&s.enable(18),t.thicknessMap&&s.enable(19),t.sheen&&s.enable(20),t.sheenColorMap&&s.enable(21),t.sheenRoughnessMap&&s.enable(22),t.decodeVideoTexture&&s.enable(23),t.opaque&&s.enable(24),e.push(s.mask)}(n,t),n.push(e.outputEncoding)),n.push(t.customProgramCacheKey),n.join()},getUniforms:function(e){const t=d[e.type];let n;if(t){const e=Sm[t];n=lm.clone(e.uniforms)}else n=e.uniforms;return n},acquireProgram:function(t,n){let i;for(let e=0,t=p.length;e<t;e++){const t=p[e];if(t.cacheKey===n){i=t,++i.usedTimes;break}}return void 0===i&&(i=new bf(e,n,t,o),p.push(i)),i},releaseProgram:function(e){if(0==--e.usedTimes){const t=p.indexOf(e);p[t]=p[p.length-1],p.pop(),e.destroy()}},releaseShaderCache:function(e){l.remove(e)},programs:p,dispose:function(){l.dispose()}}}function Mf(){let e=new WeakMap;return{get:function(t){let n=e.get(t);return void 0===n&&(n={},e.set(t,n)),n},remove:function(t){e.delete(t)},update:function(t,n,i){e.get(t)[n]=i},dispose:function(){e=new WeakMap}}}function Sf(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function Cf(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function Nf(){const e=[];let t=0;const n=[],i=[],r=[];function o(n,i,r,o,a,s){let l=e[t];return void 0===l?(l={id:n.id,object:n,geometry:i,material:r,groupOrder:o,renderOrder:n.renderOrder,z:a,group:s},e[t]=l):(l.id=n.id,l.object=n,l.geometry=i,l.material=r,l.groupOrder=o,l.renderOrder=n.renderOrder,l.z=a,l.group=s),t++,l}return{opaque:n,transmissive:i,transparent:r,init:function(){t=0,n.length=0,i.length=0,r.length=0},push:function(e,t,a,s,l,p){const u=o(e,t,a,s,l,p);a.transmission>0?i.push(u):!0===a.transparent?r.push(u):n.push(u)},unshift:function(e,t,a,s,l,p){const u=o(e,t,a,s,l,p);a.transmission>0?i.unshift(u):!0===a.transparent?r.unshift(u):n.unshift(u)},finish:function(){for(let n=t,i=e.length;n<i;n++){const t=e[n];if(null===t.id)break;t.id=null,t.object=null,t.geometry=null,t.material=null,t.group=null}},sort:function(e,t){n.length>1&&n.sort(e||Sf),i.length>1&&i.sort(t||Cf),r.length>1&&r.sort(t||Cf)}}}function Af(){let e=new WeakMap;return{get:function(t,n){const i=e.get(t);let r;return void 0===i?(r=new Nf,e.set(t,[r])):n>=i.length?(r=new Nf,i.push(r)):r=i[n],r},dispose:function(){e=new WeakMap}}}function Lf(){const e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];let n;switch(t.type){case"DirectionalLight":n={direction:new p_,color:new Kc};break;case"SpotLight":n={position:new p_,direction:new p_,color:new Kc,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":n={position:new p_,color:new Kc,distance:0,decay:0};break;case"HemisphereLight":n={direction:new p_,skyColor:new Kc,groundColor:new Kc};break;case"RectAreaLight":n={color:new Kc,position:new p_,halfWidth:new p_,halfHeight:new p_}}return e[t.id]=n,n}}}let Bf=0;function Tf(e,t){return(t.castShadow?2:0)-(e.castShadow?2:0)+(t.map?1:0)-(e.map?1:0)}function Vf(e,t){const n=new Lf,i=function(){const e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];let n;switch(t.type){case"DirectionalLight":case"SpotLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Oc};break;case"PointLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Oc,shadowCameraNear:1,shadowCameraFar:1e3}}return e[t.id]=n,n}}}(),r={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0};for(let e=0;e<9;e++)r.probe.push(new p_);const o=new p_,a=new H_,s=new H_;return{setup:function(o,a){let s=0,l=0,p=0;for(let e=0;e<9;e++)r.probe[e].set(0,0,0);let u=0,h=0,c=0,_=0,d=0,m=0,P=0,f=0,x=0,y=0;o.sort(Tf);const v=!0!==a?Math.PI:1;for(let e=0,t=o.length;e<t;e++){const t=o[e],a=t.color,g=t.intensity,b=t.distance,z=t.shadow&&t.shadow.map?t.shadow.map.texture:null;if(t.isAmbientLight)s+=a.r*g*v,l+=a.g*g*v,p+=a.b*g*v;else if(t.isLightProbe)for(let e=0;e<9;e++)r.probe[e].addScaledVector(t.sh.coefficients[e],g);else if(t.isDirectionalLight){const e=n.get(t);if(e.color.copy(t.color).multiplyScalar(t.intensity*v),t.castShadow){const e=t.shadow,n=i.get(t);n.shadowBias=e.bias,n.shadowNormalBias=e.normalBias,n.shadowRadius=e.radius,n.shadowMapSize=e.mapSize,r.directionalShadow[u]=n,r.directionalShadowMap[u]=z,r.directionalShadowMatrix[u]=t.shadow.matrix,m++}r.directional[u]=e,u++}else if(t.isSpotLight){const e=n.get(t);e.position.setFromMatrixPosition(t.matrixWorld),e.color.copy(a).multiplyScalar(g*v),e.distance=b,e.coneCos=Math.cos(t.angle),e.penumbraCos=Math.cos(t.angle*(1-t.penumbra)),e.decay=t.decay,r.spot[c]=e;const o=t.shadow;if(t.map&&(r.spotLightMap[x]=t.map,x++,o.updateMatrices(t),t.castShadow&&y++),r.spotLightMatrix[c]=o.matrix,t.castShadow){const e=i.get(t);e.shadowBias=o.bias,e.shadowNormalBias=o.normalBias,e.shadowRadius=o.radius,e.shadowMapSize=o.mapSize,r.spotShadow[c]=e,r.spotShadowMap[c]=z,f++}c++}else if(t.isRectAreaLight){const e=n.get(t);e.color.copy(a).multiplyScalar(g),e.halfWidth.set(.5*t.width,0,0),e.halfHeight.set(0,.5*t.height,0),r.rectArea[_]=e,_++}else if(t.isPointLight){const e=n.get(t);if(e.color.copy(t.color).multiplyScalar(t.intensity*v),e.distance=t.distance,e.decay=t.decay,t.castShadow){const e=t.shadow,n=i.get(t);n.shadowBias=e.bias,n.shadowNormalBias=e.normalBias,n.shadowRadius=e.radius,n.shadowMapSize=e.mapSize,n.shadowCameraNear=e.camera.near,n.shadowCameraFar=e.camera.far,r.pointShadow[h]=n,r.pointShadowMap[h]=z,r.pointShadowMatrix[h]=t.shadow.matrix,P++}r.point[h]=e,h++}else if(t.isHemisphereLight){const e=n.get(t);e.skyColor.copy(t.color).multiplyScalar(g*v),e.groundColor.copy(t.groundColor).multiplyScalar(g*v),r.hemi[d]=e,d++}}_>0&&(t.isWebGL2||!0===e.has("OES_texture_float_linear")?(r.rectAreaLTC1=Mm.LTC_FLOAT_1,r.rectAreaLTC2=Mm.LTC_FLOAT_2):!0===e.has("OES_texture_half_float_linear")?(r.rectAreaLTC1=Mm.LTC_HALF_1,r.rectAreaLTC2=Mm.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),r.ambient[0]=s,r.ambient[1]=l,r.ambient[2]=p;const g=r.hash;g.directionalLength===u&&g.pointLength===h&&g.spotLength===c&&g.rectAreaLength===_&&g.hemiLength===d&&g.numDirectionalShadows===m&&g.numPointShadows===P&&g.numSpotShadows===f&&g.numSpotMaps===x||(r.directional.length=u,r.spot.length=c,r.rectArea.length=_,r.point.length=h,r.hemi.length=d,r.directionalShadow.length=m,r.directionalShadowMap.length=m,r.pointShadow.length=P,r.pointShadowMap.length=P,r.spotShadow.length=f,r.spotShadowMap.length=f,r.directionalShadowMatrix.length=m,r.pointShadowMatrix.length=P,r.spotLightMatrix.length=f+x-y,r.spotLightMap.length=x,r.numSpotLightShadowsWithMaps=y,g.directionalLength=u,g.pointLength=h,g.spotLength=c,g.rectAreaLength=_,g.hemiLength=d,g.numDirectionalShadows=m,g.numPointShadows=P,g.numSpotShadows=f,g.numSpotMaps=x,r.version=Bf++)},setupView:function(e,t){let n=0,i=0,l=0,p=0,u=0;const h=t.matrixWorldInverse;for(let t=0,c=e.length;t<c;t++){const c=e[t];if(c.isDirectionalLight){const e=r.directional[n];e.direction.setFromMatrixPosition(c.matrixWorld),o.setFromMatrixPosition(c.target.matrixWorld),e.direction.sub(o),e.direction.transformDirection(h),n++}else if(c.isSpotLight){const e=r.spot[l];e.position.setFromMatrixPosition(c.matrixWorld),e.position.applyMatrix4(h),e.direction.setFromMatrixPosition(c.matrixWorld),o.setFromMatrixPosition(c.target.matrixWorld),e.direction.sub(o),e.direction.transformDirection(h),l++}else if(c.isRectAreaLight){const e=r.rectArea[p];e.position.setFromMatrixPosition(c.matrixWorld),e.position.applyMatrix4(h),s.identity(),a.copy(c.matrixWorld),a.premultiply(h),s.extractRotation(a),e.halfWidth.set(.5*c.width,0,0),e.halfHeight.set(0,.5*c.height,0),e.halfWidth.applyMatrix4(s),e.halfHeight.applyMatrix4(s),p++}else if(c.isPointLight){const e=r.point[i];e.position.setFromMatrixPosition(c.matrixWorld),e.position.applyMatrix4(h),i++}else if(c.isHemisphereLight){const e=r.hemi[u];e.direction.setFromMatrixPosition(c.matrixWorld),e.direction.transformDirection(h),u++}}},state:r}}function kf(e,t){const n=new Vf(e,t),i=[],r=[];return{init:function(){i.length=0,r.length=0},state:{lightsArray:i,shadowsArray:r,lights:n},setupLights:function(e){n.setup(i,e)},setupLightsView:function(e){n.setupView(i,e)},pushLight:function(e){i.push(e)},pushShadow:function(e){r.push(e)}}}function If(e,t){let n=new WeakMap;return{get:function(i,r=0){const o=n.get(i);let a;return void 0===o?(a=new kf(e,t),n.set(i,[a])):r>=o.length?(a=new kf(e,t),o.push(a)):a=o[r],a},dispose:function(){n=new WeakMap}}}class Of extends wd{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=3200,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class Rf extends wd{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.referencePosition=new p_,this.nearDistance=1,this.farDistance=1e3,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}function Hf(e,t,n){let i=new bm;const r=new Oc,o=new Oc,a=new o_,s=new Of({depthPacking:3201}),l=new Rf,p={},u=n.maxTextureSize,h={0:1,1:0,2:2},c=new pm({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new Oc},radius:{value:4}},vertexShader:"void main() {\n\tgl_Position = vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n\tconst float samples = float( VSM_SAMPLES );\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );\n\tfloat uvStart = samples <= 1.0 ? 0.0 : - 1.0;\n\tfor ( float i = 0.0; i < samples; i ++ ) {\n\t\tfloat uvOffset = uvStart + i * uvStride;\n\t\t#ifdef HORIZONTAL_PASS\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean / samples;\n\tsquared_mean = squared_mean / samples;\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}"}),_=c.clone();_.defines.HORIZONTAL_PASS=1;const d=new Rd;d.setAttribute("position",new Sd(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const m=new im(d,c),P=this;function f(n,i){const o=t.update(m);c.defines.VSM_SAMPLES!==n.blurSamples&&(c.defines.VSM_SAMPLES=n.blurSamples,_.defines.VSM_SAMPLES=n.blurSamples,c.needsUpdate=!0,_.needsUpdate=!0),null===n.mapPass&&(n.mapPass=new a_(r.x,r.y)),c.uniforms.shadow_pass.value=n.map.texture,c.uniforms.resolution.value=n.mapSize,c.uniforms.radius.value=n.radius,e.setRenderTarget(n.mapPass),e.clear(),e.renderBufferDirect(i,null,o,c,m,null),_.uniforms.shadow_pass.value=n.mapPass.texture,_.uniforms.resolution.value=n.mapSize,_.uniforms.radius.value=n.radius,e.setRenderTarget(n.map),e.clear(),e.renderBufferDirect(i,null,o,_,m,null)}function x(t,n,i,r,o,a){let u=null;const c=!0===i.isPointLight?t.customDistanceMaterial:t.customDepthMaterial;if(u=void 0!==c?c:!0===i.isPointLight?l:s,e.localClippingEnabled&&!0===n.clipShadows&&Array.isArray(n.clippingPlanes)&&0!==n.clippingPlanes.length||n.displacementMap&&0!==n.displacementScale||n.alphaMap&&n.alphaTest>0){const e=u.uuid,t=n.uuid;let i=p[e];void 0===i&&(i={},p[e]=i);let r=i[t];void 0===r&&(r=u.clone(),i[t]=r),u=r}return u.visible=n.visible,u.wireframe=n.wireframe,u.side=3===a?null!==n.shadowSide?n.shadowSide:n.side:null!==n.shadowSide?n.shadowSide:h[n.side],u.alphaMap=n.alphaMap,u.alphaTest=n.alphaTest,u.clipShadows=n.clipShadows,u.clippingPlanes=n.clippingPlanes,u.clipIntersection=n.clipIntersection,u.displacementMap=n.displacementMap,u.displacementScale=n.displacementScale,u.displacementBias=n.displacementBias,u.wireframeLinewidth=n.wireframeLinewidth,u.linewidth=n.linewidth,!0===i.isPointLight&&!0===u.isMeshDistanceMaterial&&(u.referencePosition.setFromMatrixPosition(i.matrixWorld),u.nearDistance=r,u.farDistance=o),u}function y(n,r,o,a,s){if(!1===n.visible)return;if(n.layers.test(r.layers)&&(n.isMesh||n.isLine||n.isPoints)&&(n.castShadow||n.receiveShadow&&3===s)&&(!n.frustumCulled||i.intersectsObject(n))){n.modelViewMatrix.multiplyMatrices(o.matrixWorldInverse,n.matrixWorld);const i=t.update(n),r=n.material;if(Array.isArray(r)){const t=i.groups;for(let l=0,p=t.length;l<p;l++){const p=t[l],u=r[p.materialIndex];if(u&&u.visible){const t=x(n,u,a,o.near,o.far,s);e.renderBufferDirect(o,null,i,t,n,p)}}}else if(r.visible){const t=x(n,r,a,o.near,o.far,s);e.renderBufferDirect(o,null,i,t,n,null)}}const l=n.children;for(let e=0,t=l.length;e<t;e++)y(l[e],r,o,a,s)}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=1,this.render=function(t,n,s){if(!1===P.enabled)return;if(!1===P.autoUpdate&&!1===P.needsUpdate)return;if(0===t.length)return;const l=e.getRenderTarget(),p=e.getActiveCubeFace(),h=e.getActiveMipmapLevel(),c=e.state;c.setBlending(0),c.buffers.color.setClear(1,1,1,1),c.buffers.depth.setTest(!0),c.setScissorTest(!1);for(let l=0,p=t.length;l<p;l++){const p=t[l],h=p.shadow;if(void 0===h){console.warn("THREE.WebGLShadowMap:",p,"has no shadow.");continue}if(!1===h.autoUpdate&&!1===h.needsUpdate)continue;r.copy(h.mapSize);const _=h.getFrameExtents();if(r.multiply(_),o.copy(h.mapSize),(r.x>u||r.y>u)&&(r.x>u&&(o.x=Math.floor(u/_.x),r.x=o.x*_.x,h.mapSize.x=o.x),r.y>u&&(o.y=Math.floor(u/_.y),r.y=o.y*_.y,h.mapSize.y=o.y)),null===h.map){const e=3!==this.type?{minFilter:Xh,magFilter:Xh}:{};h.map=new a_(r.x,r.y,e),h.map.texture.name=p.name+".shadowMap",h.camera.updateProjectionMatrix()}e.setRenderTarget(h.map),e.clear();const d=h.getViewportCount();for(let e=0;e<d;e++){const t=h.getViewport(e);a.set(o.x*t.x,o.y*t.y,o.x*t.z,o.y*t.w),c.viewport(a),h.updateMatrices(p,e),i=h.getFrustum(),y(n,s,h.camera,p,this.type)}!0!==h.isPointLightShadow&&3===this.type&&f(h,s),h.needsUpdate=!1}P.needsUpdate=!1,e.setRenderTarget(l,p,h)}}function Ff(e,t,n){const i=n.isWebGL2,r=new function(){let t=!1;const n=new o_;let i=null;const r=new o_(0,0,0,0);return{setMask:function(n){i===n||t||(e.colorMask(n,n,n,n),i=n)},setLocked:function(e){t=e},setClear:function(t,i,o,a,s){!0===s&&(t*=a,i*=a,o*=a),n.set(t,i,o,a),!1===r.equals(n)&&(e.clearColor(t,i,o,a),r.copy(n))},reset:function(){t=!1,i=null,r.set(-1,0,0,0)}}},o=new function(){let t=!1,n=null,i=null,r=null;return{setTest:function(e){e?H(2929):F(2929)},setMask:function(i){n===i||t||(e.depthMask(i),n=i)},setFunc:function(t){if(i!==t){if(t)switch(t){case 0:e.depthFunc(512);break;case 1:e.depthFunc(519);break;case 2:e.depthFunc(513);break;case 3:default:e.depthFunc(515);break;case 4:e.depthFunc(514);break;case 5:e.depthFunc(518);break;case 6:e.depthFunc(516);break;case 7:e.depthFunc(517)}else e.depthFunc(515);i=t}},setLocked:function(e){t=e},setClear:function(t){r!==t&&(e.clearDepth(t),r=t)},reset:function(){t=!1,n=null,i=null,r=null}}},a=new function(){let t=!1,n=null,i=null,r=null,o=null,a=null,s=null,l=null,p=null;return{setTest:function(e){t||(e?H(2960):F(2960))},setMask:function(i){n===i||t||(e.stencilMask(i),n=i)},setFunc:function(t,n,a){i===t&&r===n&&o===a||(e.stencilFunc(t,n,a),i=t,r=n,o=a)},setOp:function(t,n,i){a===t&&s===n&&l===i||(e.stencilOp(t,n,i),a=t,s=n,l=i)},setLocked:function(e){t=e},setClear:function(t){p!==t&&(e.clearStencil(t),p=t)},reset:function(){t=!1,n=null,i=null,r=null,o=null,a=null,s=null,l=null,p=null}}},s=new WeakMap,l=new WeakMap;let p={},u={},h=new WeakMap,c=[],_=null,d=!1,m=null,P=null,f=null,x=null,y=null,v=null,g=null,b=!1,z=null,w=null,Z=null,E=null,M=null;const S=e.getParameter(35661);let C=!1,N=0;const A=e.getParameter(7938);-1!==A.indexOf("WebGL")?(N=parseFloat(/^WebGL (\d)/.exec(A)[1]),C=N>=1):-1!==A.indexOf("OpenGL ES")&&(N=parseFloat(/^OpenGL ES (\d)/.exec(A)[1]),C=N>=2);let L=null,B={};const T=e.getParameter(3088),V=e.getParameter(2978),k=(new o_).fromArray(T),I=(new o_).fromArray(V);function O(t,n,i){const r=new Uint8Array(4),o=e.createTexture();e.bindTexture(t,o),e.texParameteri(t,10241,9728),e.texParameteri(t,10240,9728);for(let t=0;t<i;t++)e.texImage2D(n+t,0,6408,1,1,0,6408,5121,r);return o}const R={};function H(t){!0!==p[t]&&(e.enable(t),p[t]=!0)}function F(t){!1!==p[t]&&(e.disable(t),p[t]=!1)}R[3553]=O(3553,3553,1),R[34067]=O(34067,34069,6),r.setClear(0,0,0,1),o.setClear(1),a.setClear(0),H(2929),o.setFunc(3),j(!1),W(1),H(2884),U(0);const D={[Gh]:32774,101:32778,102:32779};if(i)D[103]=32775,D[104]=32776;else{const e=t.get("EXT_blend_minmax");null!==e&&(D[103]=e.MIN_EXT,D[104]=e.MAX_EXT)}const G={200:0,201:1,202:768,204:770,210:776,208:774,206:772,203:769,205:771,209:775,207:773};function U(t,n,i,r,o,a,s,l){if(0!==t){if(!1===d&&(H(3042),d=!0),5===t)o=o||n,a=a||i,s=s||r,n===P&&o===y||(e.blendEquationSeparate(D[n],D[o]),P=n,y=o),i===f&&r===x&&a===v&&s===g||(e.blendFuncSeparate(G[i],G[r],G[a],G[s]),f=i,x=r,v=a,g=s),m=t,b=null;else if(t!==m||l!==b){if(P===Gh&&y===Gh||(e.blendEquation(32774),P=Gh,y=Gh),l)switch(t){case 1:e.blendFuncSeparate(1,771,1,771);break;case 2:e.blendFunc(1,1);break;case 3:e.blendFuncSeparate(0,769,0,1);break;case 4:e.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}else switch(t){case 1:e.blendFuncSeparate(770,771,1,771);break;case 2:e.blendFunc(770,1);break;case 3:e.blendFuncSeparate(0,769,0,1);break;case 4:e.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}f=null,x=null,v=null,g=null,m=t,b=l}}else!0===d&&(F(3042),d=!1)}function j(t){z!==t&&(t?e.frontFace(2304):e.frontFace(2305),z=t)}function W(t){0!==t?(H(2884),t!==w&&(1===t?e.cullFace(1029):2===t?e.cullFace(1028):e.cullFace(1032))):F(2884),w=t}function q(t,n,i){t?(H(32823),E===n&&M===i||(e.polygonOffset(n,i),E=n,M=i)):F(32823)}function J(t){void 0===t&&(t=33984+S-1),L!==t&&(e.activeTexture(t),L=t)}return{buffers:{color:r,depth:o,stencil:a},enable:H,disable:F,bindFramebuffer:function(t,n){return u[t]!==n&&(e.bindFramebuffer(t,n),u[t]=n,i&&(36009===t&&(u[36160]=n),36160===t&&(u[36009]=n)),!0)},drawBuffers:function(i,r){let o=c,a=!1;if(i)if(o=h.get(r),void 0===o&&(o=[],h.set(r,o)),i.isWebGLMultipleRenderTargets){const e=i.texture;if(o.length!==e.length||36064!==o[0]){for(let t=0,n=e.length;t<n;t++)o[t]=36064+t;o.length=e.length,a=!0}}else 36064!==o[0]&&(o[0]=36064,a=!0);else 1029!==o[0]&&(o[0]=1029,a=!0);a&&(n.isWebGL2?e.drawBuffers(o):t.get("WEBGL_draw_buffers").drawBuffersWEBGL(o))},useProgram:function(t){return _!==t&&(e.useProgram(t),_=t,!0)},setBlending:U,setMaterial:function(e,t){2===e.side?F(2884):H(2884);let n=1===e.side;t&&(n=!n),j(n),1===e.blending&&!1===e.transparent?U(0):U(e.blending,e.blendEquation,e.blendSrc,e.blendDst,e.blendEquationAlpha,e.blendSrcAlpha,e.blendDstAlpha,e.premultipliedAlpha),o.setFunc(e.depthFunc),o.setTest(e.depthTest),o.setMask(e.depthWrite),r.setMask(e.colorWrite);const i=e.stencilWrite;a.setTest(i),i&&(a.setMask(e.stencilWriteMask),a.setFunc(e.stencilFunc,e.stencilRef,e.stencilFuncMask),a.setOp(e.stencilFail,e.stencilZFail,e.stencilZPass)),q(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits),!0===e.alphaToCoverage?H(32926):F(32926)},setFlipSided:j,setCullFace:W,setLineWidth:function(t){t!==Z&&(C&&e.lineWidth(t),Z=t)},setPolygonOffset:q,setScissorTest:function(e){e?H(3089):F(3089)},activeTexture:J,bindTexture:function(t,n){null===L&&J();let i=B[L];void 0===i&&(i={type:void 0,texture:void 0},B[L]=i),i.type===t&&i.texture===n||(e.bindTexture(t,n||R[t]),i.type=t,i.texture=n)},unbindTexture:function(){const t=B[L];void 0!==t&&void 0!==t.type&&(e.bindTexture(t.type,null),t.type=void 0,t.texture=void 0)},compressedTexImage2D:function(){try{e.compressedTexImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage2D:function(){try{e.texImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage3D:function(){try{e.texImage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},updateUBOMapping:function(t,n){let i=l.get(n);void 0===i&&(i=new WeakMap,l.set(n,i));let r=i.get(t);void 0===r&&(r=e.getUniformBlockIndex(n,t.name),i.set(t,r))},uniformBlockBinding:function(t,n){const i=l.get(n).get(t);s.get(t)!==i&&(e.uniformBlockBinding(n,i,t.__bindingPointIndex),s.set(t,i))},texStorage2D:function(){try{e.texStorage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texStorage3D:function(){try{e.texStorage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texSubImage2D:function(){try{e.texSubImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texSubImage3D:function(){try{e.texSubImage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},compressedTexSubImage2D:function(){try{e.compressedTexSubImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},scissor:function(t){!1===k.equals(t)&&(e.scissor(t.x,t.y,t.z,t.w),k.copy(t))},viewport:function(t){!1===I.equals(t)&&(e.viewport(t.x,t.y,t.z,t.w),I.copy(t))},reset:function(){e.disable(3042),e.disable(2884),e.disable(2929),e.disable(32823),e.disable(3089),e.disable(2960),e.disable(32926),e.blendEquation(32774),e.blendFunc(1,0),e.blendFuncSeparate(1,0,1,0),e.colorMask(!0,!0,!0,!0),e.clearColor(0,0,0,0),e.depthMask(!0),e.depthFunc(513),e.clearDepth(1),e.stencilMask(4294967295),e.stencilFunc(519,0,4294967295),e.stencilOp(7680,7680,7680),e.clearStencil(0),e.cullFace(1029),e.frontFace(2305),e.polygonOffset(0,0),e.activeTexture(33984),e.bindFramebuffer(36160,null),!0===i&&(e.bindFramebuffer(36009,null),e.bindFramebuffer(36008,null)),e.useProgram(null),e.lineWidth(1),e.scissor(0,0,e.canvas.width,e.canvas.height),e.viewport(0,0,e.canvas.width,e.canvas.height),p={},L=null,B={},u={},h=new WeakMap,c=[],_=null,d=!1,m=null,P=null,f=null,x=null,y=null,v=null,g=null,b=!1,z=null,w=null,Z=null,E=null,M=null,k.set(0,0,e.canvas.width,e.canvas.height),I.set(0,0,e.canvas.width,e.canvas.height),r.reset(),o.reset(),a.reset()}}}function Df(e,t,n,i,r,o,a){const s=r.isWebGL2,l=r.maxTextures,p=r.maxCubemapSize,u=r.maxTextureSize,h=r.maxSamples,c=t.has("WEBGL_multisampled_render_to_texture")?t.get("WEBGL_multisampled_render_to_texture"):null,_=/OculusBrowser/g.test(navigator.userAgent),d=new WeakMap;let m;const P=new WeakMap;let f=!1;try{f="undefined"!=typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(e){}function x(e,t){return f?new OffscreenCanvas(e,t):Fc("canvas")}function y(e,t,n,i){let r=1;if((e.width>i||e.height>i)&&(r=i/Math.max(e.width,e.height)),r<1||!0===t){if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap){const i=t?Tc:Math.floor,o=i(r*e.width),a=i(r*e.height);void 0===m&&(m=x(o,a));const s=n?x(o,a):m;return s.width=o,s.height=a,s.getContext("2d").drawImage(e,0,0,o,a),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+e.width+"x"+e.height+") to ("+o+"x"+a+")."),s}return"data"in e&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+e.width+"x"+e.height+")."),e}return e}function v(e){return Bc(e.width)&&Bc(e.height)}function g(e,t){return e.generateMipmaps&&t&&e.minFilter!==Xh&&e.minFilter!==Yh}function b(t){e.generateMipmap(t)}function z(n,i,r,o,a=!1){if(!1===s)return i;if(null!==n){if(void 0!==e[n])return e[n];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+n+"'")}let l=i;return 6403===i&&(5126===r&&(l=33326),5131===r&&(l=33325),5121===r&&(l=33321)),33319===i&&(5126===r&&(l=33328),5131===r&&(l=33327),5121===r&&(l=33323)),6408===i&&(5126===r&&(l=34836),5131===r&&(l=34842),5121===r&&(l=o===xc&&!1===a?35907:32856),32819===r&&(l=32854),32820===r&&(l=32855)),33325!==l&&33326!==l&&33327!==l&&33328!==l&&34842!==l&&34836!==l||t.get("EXT_color_buffer_float"),l}function w(e,t,n){return!0===g(e,n)||e.isFramebufferTexture&&e.minFilter!==Xh&&e.minFilter!==Yh?Math.log2(Math.max(t.width,t.height))+1:void 0!==e.mipmaps&&e.mipmaps.length>0?e.mipmaps.length:e.isCompressedTexture&&Array.isArray(e.image)?t.mipmaps.length:1}function Z(e){return e===Xh||1004===e||1005===e?9728:9729}function E(e){const t=e.target;t.removeEventListener("dispose",E),function(e){const t=i.get(e);if(void 0===t.__webglInit)return;const n=e.source,r=P.get(n);if(r){const i=r[t.__cacheKey];i.usedTimes--,0===i.usedTimes&&S(e),0===Object.keys(r).length&&P.delete(n)}i.remove(e)}(t),t.isVideoTexture&&d.delete(t)}function M(t){const n=t.target;n.removeEventListener("dispose",M),function(t){const n=t.texture,r=i.get(t),o=i.get(n);if(void 0!==o.__webglTexture&&(e.deleteTexture(o.__webglTexture),a.memory.textures--),t.depthTexture&&t.depthTexture.dispose(),t.isWebGLCubeRenderTarget)for(let t=0;t<6;t++)e.deleteFramebuffer(r.__webglFramebuffer[t]),r.__webglDepthbuffer&&e.deleteRenderbuffer(r.__webglDepthbuffer[t]);else{if(e.deleteFramebuffer(r.__webglFramebuffer),r.__webglDepthbuffer&&e.deleteRenderbuffer(r.__webglDepthbuffer),r.__webglMultisampledFramebuffer&&e.deleteFramebuffer(r.__webglMultisampledFramebuffer),r.__webglColorRenderbuffer)for(let t=0;t<r.__webglColorRenderbuffer.length;t++)r.__webglColorRenderbuffer[t]&&e.deleteRenderbuffer(r.__webglColorRenderbuffer[t]);r.__webglDepthRenderbuffer&&e.deleteRenderbuffer(r.__webglDepthRenderbuffer)}if(t.isWebGLMultipleRenderTargets)for(let t=0,r=n.length;t<r;t++){const r=i.get(n[t]);r.__webglTexture&&(e.deleteTexture(r.__webglTexture),a.memory.textures--),i.remove(n[t])}i.remove(n),i.remove(t)}(n)}function S(t){const n=i.get(t);e.deleteTexture(n.__webglTexture);const r=t.source;delete P.get(r)[n.__cacheKey],a.memory.textures--}let C=0;function N(e,t){const r=i.get(e);if(e.isVideoTexture&&function(e){const t=a.render.frame;d.get(e)!==t&&(d.set(e,t),e.update())}(e),!1===e.isRenderTargetTexture&&e.version>0&&r.__version!==e.version){const n=e.image;if(null===n)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else{if(!1!==n.complete)return void V(r,e,t);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}n.activeTexture(33984+t),n.bindTexture(3553,r.__webglTexture)}const A={[qh]:10497,[Jh]:33071,[$h]:33648},L={[Xh]:9728,1004:9984,1005:9986,[Yh]:9729,1007:9985,[Kh]:9987};function B(n,o,a){if(a?(e.texParameteri(n,10242,A[o.wrapS]),e.texParameteri(n,10243,A[o.wrapT]),32879!==n&&35866!==n||e.texParameteri(n,32882,A[o.wrapR]),e.texParameteri(n,10240,L[o.magFilter]),e.texParameteri(n,10241,L[o.minFilter])):(e.texParameteri(n,10242,33071),e.texParameteri(n,10243,33071),32879!==n&&35866!==n||e.texParameteri(n,32882,33071),o.wrapS===Jh&&o.wrapT===Jh||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),e.texParameteri(n,10240,Z(o.magFilter)),e.texParameteri(n,10241,Z(o.minFilter)),o.minFilter!==Xh&&o.minFilter!==Yh&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),!0===t.has("EXT_texture_filter_anisotropic")){const a=t.get("EXT_texture_filter_anisotropic");if(o.type===tc&&!1===t.has("OES_texture_float_linear"))return;if(!1===s&&o.type===nc&&!1===t.has("OES_texture_half_float_linear"))return;(o.anisotropy>1||i.get(o).__currentAnisotropy)&&(e.texParameterf(n,a.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(o.anisotropy,r.getMaxAnisotropy())),i.get(o).__currentAnisotropy=o.anisotropy)}}function T(t,n){let i=!1;void 0===t.__webglInit&&(t.__webglInit=!0,n.addEventListener("dispose",E));const r=n.source;let o=P.get(r);void 0===o&&(o={},P.set(r,o));const s=function(e){const t=[];return t.push(e.wrapS),t.push(e.wrapT),t.push(e.magFilter),t.push(e.minFilter),t.push(e.anisotropy),t.push(e.internalFormat),t.push(e.format),t.push(e.type),t.push(e.generateMipmaps),t.push(e.premultiplyAlpha),t.push(e.flipY),t.push(e.unpackAlignment),t.push(e.encoding),t.join()}(n);if(s!==t.__cacheKey){void 0===o[s]&&(o[s]={texture:e.createTexture(),usedTimes:0},a.memory.textures++,i=!0),o[s].usedTimes++;const r=o[t.__cacheKey];void 0!==r&&(o[t.__cacheKey].usedTimes--,0===r.usedTimes&&S(n)),t.__cacheKey=s,t.__webglTexture=o[s].texture}return i}function V(t,i,r){let a=3553;i.isDataArrayTexture&&(a=35866),i.isData3DTexture&&(a=32879);const l=T(t,i),p=i.source;if(n.activeTexture(33984+r),n.bindTexture(a,t.__webglTexture),p.version!==p.__currentVersion||!0===l){e.pixelStorei(37440,i.flipY),e.pixelStorei(37441,i.premultiplyAlpha),e.pixelStorei(3317,i.unpackAlignment),e.pixelStorei(37443,0);const t=function(e){return!s&&(e.wrapS!==Jh||e.wrapT!==Jh||e.minFilter!==Xh&&e.minFilter!==Yh)}(i)&&!1===v(i.image);let r=y(i.image,t,!1,u);r=F(i,r);const h=v(r)||s,c=o.convert(i.format,i.encoding);let _,d=o.convert(i.type),m=z(i.internalFormat,c,d,i.encoding,i.isVideoTexture);B(a,i,h);const P=i.mipmaps,f=s&&!0!==i.isVideoTexture,x=void 0===p.__currentVersion||!0===l,Z=w(i,r,h);if(i.isDepthTexture)m=6402,s?m=i.type===tc?36012:i.type===ec?33190:i.type===ic?35056:33189:i.type===tc&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),i.format===oc&&6402===m&&1012!==i.type&&i.type!==ec&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),i.type=ec,d=o.convert(i.type)),i.format===ac&&6402===m&&(m=34041,i.type!==ic&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),i.type=ic,d=o.convert(i.type))),x&&(f?n.texStorage2D(3553,1,m,r.width,r.height):n.texImage2D(3553,0,m,r.width,r.height,0,c,d,null));else if(i.isDataTexture)if(P.length>0&&h){f&&x&&n.texStorage2D(3553,Z,m,P[0].width,P[0].height);for(let e=0,t=P.length;e<t;e++)_=P[e],f?n.texSubImage2D(3553,e,0,0,_.width,_.height,c,d,_.data):n.texImage2D(3553,e,m,_.width,_.height,0,c,d,_.data);i.generateMipmaps=!1}else f?(x&&n.texStorage2D(3553,Z,m,r.width,r.height),n.texSubImage2D(3553,0,0,0,r.width,r.height,c,d,r.data)):n.texImage2D(3553,0,m,r.width,r.height,0,c,d,r.data);else if(i.isCompressedTexture){f&&x&&n.texStorage2D(3553,Z,m,P[0].width,P[0].height);for(let e=0,t=P.length;e<t;e++)_=P[e],i.format!==rc?null!==c?f?n.compressedTexSubImage2D(3553,e,0,0,_.width,_.height,c,_.data):n.compressedTexImage2D(3553,e,m,_.width,_.height,0,_.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):f?n.texSubImage2D(3553,e,0,0,_.width,_.height,c,d,_.data):n.texImage2D(3553,e,m,_.width,_.height,0,c,d,_.data)}else if(i.isDataArrayTexture)f?(x&&n.texStorage3D(35866,Z,m,r.width,r.height,r.depth),n.texSubImage3D(35866,0,0,0,0,r.width,r.height,r.depth,c,d,r.data)):n.texImage3D(35866,0,m,r.width,r.height,r.depth,0,c,d,r.data);else if(i.isData3DTexture)f?(x&&n.texStorage3D(32879,Z,m,r.width,r.height,r.depth),n.texSubImage3D(32879,0,0,0,0,r.width,r.height,r.depth,c,d,r.data)):n.texImage3D(32879,0,m,r.width,r.height,r.depth,0,c,d,r.data);else if(i.isFramebufferTexture){if(x)if(f)n.texStorage2D(3553,Z,m,r.width,r.height);else{let e=r.width,t=r.height;for(let i=0;i<Z;i++)n.texImage2D(3553,i,m,e,t,0,c,d,null),e>>=1,t>>=1}}else if(P.length>0&&h){f&&x&&n.texStorage2D(3553,Z,m,P[0].width,P[0].height);for(let e=0,t=P.length;e<t;e++)_=P[e],f?n.texSubImage2D(3553,e,0,0,c,d,_):n.texImage2D(3553,e,m,c,d,_);i.generateMipmaps=!1}else f?(x&&n.texStorage2D(3553,Z,m,r.width,r.height),n.texSubImage2D(3553,0,0,0,c,d,r)):n.texImage2D(3553,0,m,c,d,r);g(i,h)&&b(a),p.__currentVersion=p.version,i.onUpdate&&i.onUpdate(i)}t.__version=i.version}function k(t,r,a,s,l){const p=o.convert(a.format,a.encoding),u=o.convert(a.type),h=z(a.internalFormat,p,u,a.encoding);i.get(r).__hasExternalTextures||(32879===l||35866===l?n.texImage3D(l,0,h,r.width,r.height,r.depth,0,p,u,null):n.texImage2D(l,0,h,r.width,r.height,0,p,u,null)),n.bindFramebuffer(36160,t),H(r)?c.framebufferTexture2DMultisampleEXT(36160,s,l,i.get(a).__webglTexture,0,R(r)):e.framebufferTexture2D(36160,s,l,i.get(a).__webglTexture,0),n.bindFramebuffer(36160,null)}function I(t,n,i){if(e.bindRenderbuffer(36161,t),n.depthBuffer&&!n.stencilBuffer){let r=33189;if(i||H(n)){const t=n.depthTexture;t&&t.isDepthTexture&&(t.type===tc?r=36012:t.type===ec&&(r=33190));const i=R(n);H(n)?c.renderbufferStorageMultisampleEXT(36161,i,r,n.width,n.height):e.renderbufferStorageMultisample(36161,i,r,n.width,n.height)}else e.renderbufferStorage(36161,r,n.width,n.height);e.framebufferRenderbuffer(36160,36096,36161,t)}else if(n.depthBuffer&&n.stencilBuffer){const r=R(n);i&&!1===H(n)?e.renderbufferStorageMultisample(36161,r,35056,n.width,n.height):H(n)?c.renderbufferStorageMultisampleEXT(36161,r,35056,n.width,n.height):e.renderbufferStorage(36161,34041,n.width,n.height),e.framebufferRenderbuffer(36160,33306,36161,t)}else{const t=!0===n.isWebGLMultipleRenderTargets?n.texture:[n.texture];for(let r=0;r<t.length;r++){const a=t[r],s=o.convert(a.format,a.encoding),l=o.convert(a.type),p=z(a.internalFormat,s,l,a.encoding),u=R(n);i&&!1===H(n)?e.renderbufferStorageMultisample(36161,u,p,n.width,n.height):H(n)?c.renderbufferStorageMultisampleEXT(36161,u,p,n.width,n.height):e.renderbufferStorage(36161,p,n.width,n.height)}}e.bindRenderbuffer(36161,null)}function O(t){const r=i.get(t),o=!0===t.isWebGLCubeRenderTarget;if(t.depthTexture&&!r.__autoAllocateDepthBuffer){if(o)throw new Error("target.depthTexture not supported in Cube render targets");!function(t,r){if(r&&r.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(n.bindFramebuffer(36160,t),!r.depthTexture||!r.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");i.get(r.depthTexture).__webglTexture&&r.depthTexture.image.width===r.width&&r.depthTexture.image.height===r.height||(r.depthTexture.image.width=r.width,r.depthTexture.image.height=r.height,r.depthTexture.needsUpdate=!0),N(r.depthTexture,0);const o=i.get(r.depthTexture).__webglTexture,a=R(r);if(r.depthTexture.format===oc)H(r)?c.framebufferTexture2DMultisampleEXT(36160,36096,3553,o,0,a):e.framebufferTexture2D(36160,36096,3553,o,0);else{if(r.depthTexture.format!==ac)throw new Error("Unknown depthTexture format");H(r)?c.framebufferTexture2DMultisampleEXT(36160,33306,3553,o,0,a):e.framebufferTexture2D(36160,33306,3553,o,0)}}(r.__webglFramebuffer,t)}else if(o){r.__webglDepthbuffer=[];for(let i=0;i<6;i++)n.bindFramebuffer(36160,r.__webglFramebuffer[i]),r.__webglDepthbuffer[i]=e.createRenderbuffer(),I(r.__webglDepthbuffer[i],t,!1)}else n.bindFramebuffer(36160,r.__webglFramebuffer),r.__webglDepthbuffer=e.createRenderbuffer(),I(r.__webglDepthbuffer,t,!1);n.bindFramebuffer(36160,null)}function R(e){return Math.min(h,e.samples)}function H(e){const n=i.get(e);return s&&e.samples>0&&!0===t.has("WEBGL_multisampled_render_to_texture")&&!1!==n.__useRenderToTexture}function F(e,n){const i=e.encoding,r=e.format,o=e.type;return!0===e.isCompressedTexture||!0===e.isVideoTexture||e.format===zc||i!==fc&&(i===xc?!1===s?!0===t.has("EXT_sRGB")&&r===rc?(e.format=zc,e.minFilter=Yh,e.generateMipmaps=!1):n=e_.sRGBToLinear(n):r===rc&&o===Qh||console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture encoding:",i)),n}this.allocateTextureUnit=function(){const e=C;return e>=l&&console.warn("THREE.WebGLTextures: Trying to use "+e+" texture units while this GPU supports only "+l),C+=1,e},this.resetTextureUnits=function(){C=0},this.setTexture2D=N,this.setTexture2DArray=function(e,t){const r=i.get(e);e.version>0&&r.__version!==e.version?V(r,e,t):(n.activeTexture(33984+t),n.bindTexture(35866,r.__webglTexture))},this.setTexture3D=function(e,t){const r=i.get(e);e.version>0&&r.__version!==e.version?V(r,e,t):(n.activeTexture(33984+t),n.bindTexture(32879,r.__webglTexture))},this.setTextureCube=function(t,r){const a=i.get(t);t.version>0&&a.__version!==t.version?function(t,i,r){if(6!==i.image.length)return;const a=T(t,i),l=i.source;if(n.activeTexture(33984+r),n.bindTexture(34067,t.__webglTexture),l.version!==l.__currentVersion||!0===a){e.pixelStorei(37440,i.flipY),e.pixelStorei(37441,i.premultiplyAlpha),e.pixelStorei(3317,i.unpackAlignment),e.pixelStorei(37443,0);const t=i.isCompressedTexture||i.image[0].isCompressedTexture,r=i.image[0]&&i.image[0].isDataTexture,u=[];for(let e=0;e<6;e++)u[e]=t||r?r?i.image[e].image:i.image[e]:y(i.image[e],!1,!0,p),u[e]=F(i,u[e]);const h=u[0],c=v(h)||s,_=o.convert(i.format,i.encoding),d=o.convert(i.type),m=z(i.internalFormat,_,d,i.encoding),P=s&&!0!==i.isVideoTexture,f=void 0===l.__currentVersion||!0===a;let x,Z=w(i,h,c);if(B(34067,i,c),t){P&&f&&n.texStorage2D(34067,Z,m,h.width,h.height);for(let e=0;e<6;e++){x=u[e].mipmaps;for(let t=0;t<x.length;t++){const r=x[t];i.format!==rc?null!==_?P?n.compressedTexSubImage2D(34069+e,t,0,0,r.width,r.height,_,r.data):n.compressedTexImage2D(34069+e,t,m,r.width,r.height,0,r.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):P?n.texSubImage2D(34069+e,t,0,0,r.width,r.height,_,d,r.data):n.texImage2D(34069+e,t,m,r.width,r.height,0,_,d,r.data)}}}else{x=i.mipmaps,P&&f&&(x.length>0&&Z++,n.texStorage2D(34067,Z,m,u[0].width,u[0].height));for(let e=0;e<6;e++)if(r){P?n.texSubImage2D(34069+e,0,0,0,u[e].width,u[e].height,_,d,u[e].data):n.texImage2D(34069+e,0,m,u[e].width,u[e].height,0,_,d,u[e].data);for(let t=0;t<x.length;t++){const i=x[t].image[e].image;P?n.texSubImage2D(34069+e,t+1,0,0,i.width,i.height,_,d,i.data):n.texImage2D(34069+e,t+1,m,i.width,i.height,0,_,d,i.data)}}else{P?n.texSubImage2D(34069+e,0,0,0,_,d,u[e]):n.texImage2D(34069+e,0,m,_,d,u[e]);for(let t=0;t<x.length;t++){const i=x[t];P?n.texSubImage2D(34069+e,t+1,0,0,_,d,i.image[e]):n.texImage2D(34069+e,t+1,m,_,d,i.image[e])}}}g(i,c)&&b(34067),l.__currentVersion=l.version,i.onUpdate&&i.onUpdate(i)}t.__version=i.version}(a,t,r):(n.activeTexture(33984+r),n.bindTexture(34067,a.__webglTexture))},this.rebindTextures=function(e,t,n){const r=i.get(e);void 0!==t&&k(r.__webglFramebuffer,e,e.texture,36064,3553),void 0!==n&&O(e)},this.setupRenderTarget=function(t){const l=t.texture,p=i.get(t),u=i.get(l);t.addEventListener("dispose",M),!0!==t.isWebGLMultipleRenderTargets&&(void 0===u.__webglTexture&&(u.__webglTexture=e.createTexture()),u.__version=l.version,a.memory.textures++);const h=!0===t.isWebGLCubeRenderTarget,c=!0===t.isWebGLMultipleRenderTargets,_=v(t)||s;if(h){p.__webglFramebuffer=[];for(let t=0;t<6;t++)p.__webglFramebuffer[t]=e.createFramebuffer()}else{if(p.__webglFramebuffer=e.createFramebuffer(),c)if(r.drawBuffers){const n=t.texture;for(let t=0,r=n.length;t<r;t++){const r=i.get(n[t]);void 0===r.__webglTexture&&(r.__webglTexture=e.createTexture(),a.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");if(s&&t.samples>0&&!1===H(t)){const i=c?l:[l];p.__webglMultisampledFramebuffer=e.createFramebuffer(),p.__webglColorRenderbuffer=[],n.bindFramebuffer(36160,p.__webglMultisampledFramebuffer);for(let n=0;n<i.length;n++){const r=i[n];p.__webglColorRenderbuffer[n]=e.createRenderbuffer(),e.bindRenderbuffer(36161,p.__webglColorRenderbuffer[n]);const a=o.convert(r.format,r.encoding),s=o.convert(r.type),l=z(r.internalFormat,a,s,r.encoding),u=R(t);e.renderbufferStorageMultisample(36161,u,l,t.width,t.height),e.framebufferRenderbuffer(36160,36064+n,36161,p.__webglColorRenderbuffer[n])}e.bindRenderbuffer(36161,null),t.depthBuffer&&(p.__webglDepthRenderbuffer=e.createRenderbuffer(),I(p.__webglDepthRenderbuffer,t,!0)),n.bindFramebuffer(36160,null)}}if(h){n.bindTexture(34067,u.__webglTexture),B(34067,l,_);for(let e=0;e<6;e++)k(p.__webglFramebuffer[e],t,l,36064,34069+e);g(l,_)&&b(34067),n.unbindTexture()}else if(c){const e=t.texture;for(let r=0,o=e.length;r<o;r++){const o=e[r],a=i.get(o);n.bindTexture(3553,a.__webglTexture),B(3553,o,_),k(p.__webglFramebuffer,t,o,36064+r,3553),g(o,_)&&b(3553)}n.unbindTexture()}else{let e=3553;(t.isWebGL3DRenderTarget||t.isWebGLArrayRenderTarget)&&(s?e=t.isWebGL3DRenderTarget?32879:35866:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),n.bindTexture(e,u.__webglTexture),B(e,l,_),k(p.__webglFramebuffer,t,l,36064,e),g(l,_)&&b(e),n.unbindTexture()}t.depthBuffer&&O(t)},this.updateRenderTargetMipmap=function(e){const t=v(e)||s,r=!0===e.isWebGLMultipleRenderTargets?e.texture:[e.texture];for(let o=0,a=r.length;o<a;o++){const a=r[o];if(g(a,t)){const t=e.isWebGLCubeRenderTarget?34067:3553,r=i.get(a).__webglTexture;n.bindTexture(t,r),b(t),n.unbindTexture()}}},this.updateMultisampleRenderTarget=function(t){if(s&&t.samples>0&&!1===H(t)){const r=t.isWebGLMultipleRenderTargets?t.texture:[t.texture],o=t.width,a=t.height;let s=16384;const l=[],p=t.stencilBuffer?33306:36096,u=i.get(t),h=!0===t.isWebGLMultipleRenderTargets;if(h)for(let t=0;t<r.length;t++)n.bindFramebuffer(36160,u.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(36160,36064+t,36161,null),n.bindFramebuffer(36160,u.__webglFramebuffer),e.framebufferTexture2D(36009,36064+t,3553,null,0);n.bindFramebuffer(36008,u.__webglMultisampledFramebuffer),n.bindFramebuffer(36009,u.__webglFramebuffer);for(let n=0;n<r.length;n++){l.push(36064+n),t.depthBuffer&&l.push(p);const c=void 0!==u.__ignoreDepthValues&&u.__ignoreDepthValues;if(!1===c&&(t.depthBuffer&&(s|=256),t.stencilBuffer&&(s|=1024)),h&&e.framebufferRenderbuffer(36008,36064,36161,u.__webglColorRenderbuffer[n]),!0===c&&(e.invalidateFramebuffer(36008,[p]),e.invalidateFramebuffer(36009,[p])),h){const t=i.get(r[n]).__webglTexture;e.framebufferTexture2D(36009,36064,3553,t,0)}e.blitFramebuffer(0,0,o,a,0,0,o,a,s,9728),_&&e.invalidateFramebuffer(36008,l)}if(n.bindFramebuffer(36008,null),n.bindFramebuffer(36009,null),h)for(let t=0;t<r.length;t++){n.bindFramebuffer(36160,u.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(36160,36064+t,36161,u.__webglColorRenderbuffer[t]);const o=i.get(r[t]).__webglTexture;n.bindFramebuffer(36160,u.__webglFramebuffer),e.framebufferTexture2D(36009,36064+t,3553,o,0)}n.bindFramebuffer(36009,u.__webglMultisampledFramebuffer)}},this.setupDepthRenderbuffer=O,this.setupFrameBufferTexture=k,this.useMultisampledRTT=H}function Gf(e,t,n){const i=n.isWebGL2;return{convert:function(n,r=null){let o;if(n===Qh)return 5121;if(1017===n)return 32819;if(1018===n)return 32820;if(1010===n)return 5120;if(1011===n)return 5122;if(1012===n)return 5123;if(1013===n)return 5124;if(n===ec)return 5125;if(n===tc)return 5126;if(n===nc)return i?5131:(o=t.get("OES_texture_half_float"),null!==o?o.HALF_FLOAT_OES:null);if(1021===n)return 6406;if(n===rc)return 6408;if(1024===n)return 6409;if(1025===n)return 6410;if(n===oc)return 6402;if(n===ac)return 34041;if(1028===n)return 6403;if(1022===n)return console.warn("THREE.WebGLRenderer: THREE.RGBFormat has been removed. Use THREE.RGBAFormat instead. https://github.com/mrdoob/three.js/pull/23228"),6408;if(n===zc)return o=t.get("EXT_sRGB"),null!==o?o.SRGB_ALPHA_EXT:null;if(1029===n)return 36244;if(1030===n)return 33319;if(1031===n)return 33320;if(1033===n)return 36249;if(n===sc||n===lc||n===pc||n===uc)if(r===xc){if(o=t.get("WEBGL_compressed_texture_s3tc_srgb"),null===o)return null;if(n===sc)return o.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(n===lc)return o.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(n===pc)return o.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(n===uc)return o.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else{if(o=t.get("WEBGL_compressed_texture_s3tc"),null===o)return null;if(n===sc)return o.COMPRESSED_RGB_S3TC_DXT1_EXT;if(n===lc)return o.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(n===pc)return o.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(n===uc)return o.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(35840===n||35841===n||35842===n||35843===n){if(o=t.get("WEBGL_compressed_texture_pvrtc"),null===o)return null;if(35840===n)return o.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(35841===n)return o.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(35842===n)return o.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(35843===n)return o.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(36196===n)return o=t.get("WEBGL_compressed_texture_etc1"),null!==o?o.COMPRESSED_RGB_ETC1_WEBGL:null;if(37492===n||37496===n){if(o=t.get("WEBGL_compressed_texture_etc"),null===o)return null;if(37492===n)return r===xc?o.COMPRESSED_SRGB8_ETC2:o.COMPRESSED_RGB8_ETC2;if(37496===n)return r===xc?o.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:o.COMPRESSED_RGBA8_ETC2_EAC}if(37808===n||37809===n||37810===n||37811===n||37812===n||37813===n||37814===n||37815===n||37816===n||37817===n||37818===n||37819===n||37820===n||37821===n){if(o=t.get("WEBGL_compressed_texture_astc"),null===o)return null;if(37808===n)return r===xc?o.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:o.COMPRESSED_RGBA_ASTC_4x4_KHR;if(37809===n)return r===xc?o.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:o.COMPRESSED_RGBA_ASTC_5x4_KHR;if(37810===n)return r===xc?o.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:o.COMPRESSED_RGBA_ASTC_5x5_KHR;if(37811===n)return r===xc?o.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:o.COMPRESSED_RGBA_ASTC_6x5_KHR;if(37812===n)return r===xc?o.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:o.COMPRESSED_RGBA_ASTC_6x6_KHR;if(37813===n)return r===xc?o.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:o.COMPRESSED_RGBA_ASTC_8x5_KHR;if(37814===n)return r===xc?o.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:o.COMPRESSED_RGBA_ASTC_8x6_KHR;if(37815===n)return r===xc?o.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:o.COMPRESSED_RGBA_ASTC_8x8_KHR;if(37816===n)return r===xc?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:o.COMPRESSED_RGBA_ASTC_10x5_KHR;if(37817===n)return r===xc?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:o.COMPRESSED_RGBA_ASTC_10x6_KHR;if(37818===n)return r===xc?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:o.COMPRESSED_RGBA_ASTC_10x8_KHR;if(37819===n)return r===xc?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:o.COMPRESSED_RGBA_ASTC_10x10_KHR;if(37820===n)return r===xc?o.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:o.COMPRESSED_RGBA_ASTC_12x10_KHR;if(37821===n)return r===xc?o.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:o.COMPRESSED_RGBA_ASTC_12x12_KHR}if(36492===n){if(o=t.get("EXT_texture_compression_bptc"),null===o)return null;if(36492===n)return r===xc?o.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:o.COMPRESSED_RGBA_BPTC_UNORM_EXT}return n===ic?i?34042:(o=t.get("WEBGL_depth_texture"),null!==o?o.UNSIGNED_INT_24_8_WEBGL:null):void 0!==e[n]?e[n]:null}}}class Uf extends hm{constructor(e=[]){super(),this.isArrayCamera=!0,this.cameras=e}}class jf extends hd{constructor(){super(),this.isGroup=!0,this.type="Group"}}const Wf={type:"move"};class qf{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return null===this._hand&&(this._hand=new jf,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return null===this._targetRay&&(this._targetRay=new jf,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new p_,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new p_),this._targetRay}getGripSpace(){return null===this._grip&&(this._grip=new jf,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new p_,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new p_),this._grip}dispatchEvent(e){return null!==this._targetRay&&this._targetRay.dispatchEvent(e),null!==this._grip&&this._grip.dispatchEvent(e),null!==this._hand&&this._hand.dispatchEvent(e),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this}update(e,t,n){let i=null,r=null,o=null;const a=this._targetRay,s=this._grip,l=this._hand;if(e&&"visible-blurred"!==t.session.visibilityState){if(l&&e.hand){o=!0;for(const i of e.hand.values()){const e=t.getJointPose(i,n);if(void 0===l.joints[i.jointName]){const e=new jf;e.matrixAutoUpdate=!1,e.visible=!1,l.joints[i.jointName]=e,l.add(e)}const r=l.joints[i.jointName];null!==e&&(r.matrix.fromArray(e.transform.matrix),r.matrix.decompose(r.position,r.rotation,r.scale),r.jointRadius=e.radius),r.visible=null!==e}const i=l.joints["index-finger-tip"],r=l.joints["thumb-tip"],a=i.position.distanceTo(r.position),s=.02,p=.005;l.inputState.pinching&&a>s+p?(l.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!l.inputState.pinching&&a<=s-p&&(l.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else null!==s&&e.gripSpace&&(r=t.getPose(e.gripSpace,n),null!==r&&(s.matrix.fromArray(r.transform.matrix),s.matrix.decompose(s.position,s.rotation,s.scale),r.linearVelocity?(s.hasLinearVelocity=!0,s.linearVelocity.copy(r.linearVelocity)):s.hasLinearVelocity=!1,r.angularVelocity?(s.hasAngularVelocity=!0,s.angularVelocity.copy(r.angularVelocity)):s.hasAngularVelocity=!1));null!==a&&(i=t.getPose(e.targetRaySpace,n),null===i&&null!==r&&(i=r),null!==i&&(a.matrix.fromArray(i.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),i.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(i.linearVelocity)):a.hasLinearVelocity=!1,i.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(i.angularVelocity)):a.hasAngularVelocity=!1,this.dispatchEvent(Wf)))}return null!==a&&(a.visible=null!==i),null!==s&&(s.visible=null!==r),null!==l&&(l.visible=null!==o),this}}class Jf extends r_{constructor(e,t,n,i,r,o,a,s,l,p){if((p=void 0!==p?p:oc)!==oc&&p!==ac)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===n&&p===oc&&(n=ec),void 0===n&&p===ac&&(n=ic),super(null,i,r,o,a,s,p,n,l),this.isDepthTexture=!0,this.image={width:e,height:t},this.magFilter=void 0!==a?a:Xh,this.minFilter=void 0!==s?s:Xh,this.flipY=!1,this.generateMipmaps=!1}}class $f extends wc{constructor(e,t){super();const n=this;let i=null,r=1,o=null,a="local-floor",s=null,l=null,p=null,u=null,h=null,c=null;const _=t.getContextAttributes();let d=null,m=null;const P=[],f=[],x=new hm;x.layers.enable(1),x.viewport=new o_;const y=new hm;y.layers.enable(2),y.viewport=new o_;const v=[x,y],g=new Uf;g.layers.enable(1),g.layers.enable(2);let b=null,z=null;function w(e){const t=f.indexOf(e.inputSource);if(-1===t)return;const n=P[t];void 0!==n&&n.dispatchEvent({type:e.type,data:e.inputSource})}function Z(){i.removeEventListener("select",w),i.removeEventListener("selectstart",w),i.removeEventListener("selectend",w),i.removeEventListener("squeeze",w),i.removeEventListener("squeezestart",w),i.removeEventListener("squeezeend",w),i.removeEventListener("end",Z),i.removeEventListener("inputsourceschange",E);for(let e=0;e<P.length;e++){const t=f[e];null!==t&&(f[e]=null,P[e].disconnect(t))}b=null,z=null,e.setRenderTarget(d),h=null,u=null,p=null,i=null,m=null,A.stop(),n.isPresenting=!1,n.dispatchEvent({type:"sessionend"})}function E(e){for(let t=0;t<e.removed.length;t++){const n=e.removed[t],i=f.indexOf(n);i>=0&&(f[i]=null,P[i].dispatchEvent({type:"disconnected",data:n}))}for(let t=0;t<e.added.length;t++){const n=e.added[t];let i=f.indexOf(n);if(-1===i){for(let e=0;e<P.length;e++){if(e>=f.length){f.push(n),i=e;break}if(null===f[e]){f[e]=n,i=e;break}}if(-1===i)break}const r=P[i];r&&r.dispatchEvent({type:"connected",data:n})}}this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(e){let t=P[e];return void 0===t&&(t=new qf,P[e]=t),t.getTargetRaySpace()},this.getControllerGrip=function(e){let t=P[e];return void 0===t&&(t=new qf,P[e]=t),t.getGripSpace()},this.getHand=function(e){let t=P[e];return void 0===t&&(t=new qf,P[e]=t),t.getHandSpace()},this.setFramebufferScaleFactor=function(e){r=e,!0===n.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(e){a=e,!0===n.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return s||o},this.setReferenceSpace=function(e){s=e},this.getBaseLayer=function(){return null!==u?u:h},this.getBinding=function(){return p},this.getFrame=function(){return c},this.getSession=function(){return i},this.setSession=async function(l){if(i=l,null!==i){if(d=e.getRenderTarget(),i.addEventListener("select",w),i.addEventListener("selectstart",w),i.addEventListener("selectend",w),i.addEventListener("squeeze",w),i.addEventListener("squeezestart",w),i.addEventListener("squeezeend",w),i.addEventListener("end",Z),i.addEventListener("inputsourceschange",E),!0!==_.xrCompatible&&await t.makeXRCompatible(),void 0===i.renderState.layers||!1===e.capabilities.isWebGL2){const n={antialias:void 0!==i.renderState.layers||_.antialias,alpha:_.alpha,depth:_.depth,stencil:_.stencil,framebufferScaleFactor:r};h=new XRWebGLLayer(i,t,n),i.updateRenderState({baseLayer:h}),m=new a_(h.framebufferWidth,h.framebufferHeight,{format:rc,type:Qh,encoding:e.outputEncoding,stencilBuffer:_.stencil})}else{let n=null,o=null,a=null;_.depth&&(a=_.stencil?35056:33190,n=_.stencil?ac:oc,o=_.stencil?ic:ec);const s={colorFormat:32856,depthFormat:a,scaleFactor:r};p=new XRWebGLBinding(i,t),u=p.createProjectionLayer(s),i.updateRenderState({layers:[u]}),m=new a_(u.textureWidth,u.textureHeight,{format:rc,type:Qh,depthTexture:new Jf(u.textureWidth,u.textureHeight,o,void 0,void 0,void 0,void 0,void 0,void 0,n),stencilBuffer:_.stencil,encoding:e.outputEncoding,samples:_.antialias?4:0}),e.properties.get(m).__ignoreDepthValues=u.ignoreDepthValues}m.isXRRenderTarget=!0,this.setFoveation(1),s=null,o=await i.requestReferenceSpace(a),A.setContext(i),A.start(),n.isPresenting=!0,n.dispatchEvent({type:"sessionstart"})}};const M=new p_,S=new p_;function C(e,t){null===t?e.matrixWorld.copy(e.matrix):e.matrixWorld.multiplyMatrices(t.matrixWorld,e.matrix),e.matrixWorldInverse.copy(e.matrixWorld).invert()}this.updateCamera=function(e){if(null===i)return;g.near=y.near=x.near=e.near,g.far=y.far=x.far=e.far,b===g.near&&z===g.far||(i.updateRenderState({depthNear:g.near,depthFar:g.far}),b=g.near,z=g.far);const t=e.parent,n=g.cameras;C(g,t);for(let e=0;e<n.length;e++)C(n[e],t);g.matrixWorld.decompose(g.position,g.quaternion,g.scale),e.matrix.copy(g.matrix),e.matrix.decompose(e.position,e.quaternion,e.scale);const r=e.children;for(let e=0,t=r.length;e<t;e++)r[e].updateMatrixWorld(!0);2===n.length?function(e,t,n){M.setFromMatrixPosition(t.matrixWorld),S.setFromMatrixPosition(n.matrixWorld);const i=M.distanceTo(S),r=t.projectionMatrix.elements,o=n.projectionMatrix.elements,a=r[14]/(r[10]-1),s=r[14]/(r[10]+1),l=(r[9]+1)/r[5],p=(r[9]-1)/r[5],u=(r[8]-1)/r[0],h=(o[8]+1)/o[0],c=a*u,_=a*h,d=i/(-u+h),m=d*-u;t.matrixWorld.decompose(e.position,e.quaternion,e.scale),e.translateX(m),e.translateZ(d),e.matrixWorld.compose(e.position,e.quaternion,e.scale),e.matrixWorldInverse.copy(e.matrixWorld).invert();const P=a+d,f=s+d,x=c-m,y=_+(i-m),v=l*s/f*P,g=p*s/f*P;e.projectionMatrix.makePerspective(x,y,v,g,P,f)}(g,x,y):g.projectionMatrix.copy(x.projectionMatrix)},this.getCamera=function(){return g},this.getFoveation=function(){return null!==u?u.fixedFoveation:null!==h?h.fixedFoveation:void 0},this.setFoveation=function(e){null!==u&&(u.fixedFoveation=e),null!==h&&void 0!==h.fixedFoveation&&(h.fixedFoveation=e)};let N=null;const A=new zm;A.setAnimationLoop((function(t,n){if(l=n.getViewerPose(s||o),c=n,null!==l){const t=l.views;null!==h&&(e.setRenderTargetFramebuffer(m,h.framebuffer),e.setRenderTarget(m));let n=!1;t.length!==g.cameras.length&&(g.cameras.length=0,n=!0);for(let i=0;i<t.length;i++){const r=t[i];let o=null;if(null!==h)o=h.getViewport(r);else{const t=p.getViewSubImage(u,r);o=t.viewport,0===i&&(e.setRenderTargetTextures(m,t.colorTexture,u.ignoreDepthValues?void 0:t.depthStencilTexture),e.setRenderTarget(m))}let a=v[i];void 0===a&&(a=new hm,a.layers.enable(i),a.viewport=new o_,v[i]=a),a.matrix.fromArray(r.transform.matrix),a.projectionMatrix.fromArray(r.projectionMatrix),a.viewport.set(o.x,o.y,o.width,o.height),0===i&&g.matrix.copy(a.matrix),!0===n&&g.cameras.push(a)}}for(let e=0;e<P.length;e++){const t=f[e],i=P[e];null!==t&&void 0!==i&&i.update(t,n,s||o)}N&&N(t,n),c=null})),this.setAnimationLoop=function(e){N=e},this.dispose=function(){}}}function Xf(e,t){function n(n,i){n.opacity.value=i.opacity,i.color&&n.diffuse.value.copy(i.color),i.emissive&&n.emissive.value.copy(i.emissive).multiplyScalar(i.emissiveIntensity),i.map&&(n.map.value=i.map),i.alphaMap&&(n.alphaMap.value=i.alphaMap),i.bumpMap&&(n.bumpMap.value=i.bumpMap,n.bumpScale.value=i.bumpScale,1===i.side&&(n.bumpScale.value*=-1)),i.displacementMap&&(n.displacementMap.value=i.displacementMap,n.displacementScale.value=i.displacementScale,n.displacementBias.value=i.displacementBias),i.emissiveMap&&(n.emissiveMap.value=i.emissiveMap),i.normalMap&&(n.normalMap.value=i.normalMap,n.normalScale.value.copy(i.normalScale),1===i.side&&n.normalScale.value.negate()),i.specularMap&&(n.specularMap.value=i.specularMap),i.alphaTest>0&&(n.alphaTest.value=i.alphaTest);const r=t.get(i).envMap;if(r&&(n.envMap.value=r,n.flipEnvMap.value=r.isCubeTexture&&!1===r.isRenderTargetTexture?-1:1,n.reflectivity.value=i.reflectivity,n.ior.value=i.ior,n.refractionRatio.value=i.refractionRatio),i.lightMap){n.lightMap.value=i.lightMap;const t=!0!==e.physicallyCorrectLights?Math.PI:1;n.lightMapIntensity.value=i.lightMapIntensity*t}let o,a;i.aoMap&&(n.aoMap.value=i.aoMap,n.aoMapIntensity.value=i.aoMapIntensity),i.map?o=i.map:i.specularMap?o=i.specularMap:i.displacementMap?o=i.displacementMap:i.normalMap?o=i.normalMap:i.bumpMap?o=i.bumpMap:i.roughnessMap?o=i.roughnessMap:i.metalnessMap?o=i.metalnessMap:i.alphaMap?o=i.alphaMap:i.emissiveMap?o=i.emissiveMap:i.clearcoatMap?o=i.clearcoatMap:i.clearcoatNormalMap?o=i.clearcoatNormalMap:i.clearcoatRoughnessMap?o=i.clearcoatRoughnessMap:i.iridescenceMap?o=i.iridescenceMap:i.iridescenceThicknessMap?o=i.iridescenceThicknessMap:i.specularIntensityMap?o=i.specularIntensityMap:i.specularColorMap?o=i.specularColorMap:i.transmissionMap?o=i.transmissionMap:i.thicknessMap?o=i.thicknessMap:i.sheenColorMap?o=i.sheenColorMap:i.sheenRoughnessMap&&(o=i.sheenRoughnessMap),void 0!==o&&(o.isWebGLRenderTarget&&(o=o.texture),!0===o.matrixAutoUpdate&&o.updateMatrix(),n.uvTransform.value.copy(o.matrix)),i.aoMap?a=i.aoMap:i.lightMap&&(a=i.lightMap),void 0!==a&&(a.isWebGLRenderTarget&&(a=a.texture),!0===a.matrixAutoUpdate&&a.updateMatrix(),n.uv2Transform.value.copy(a.matrix))}return{refreshFogUniforms:function(e,t){e.fogColor.value.copy(t.color),t.isFog?(e.fogNear.value=t.near,e.fogFar.value=t.far):t.isFogExp2&&(e.fogDensity.value=t.density)},refreshMaterialUniforms:function(e,i,r,o,a){i.isMeshBasicMaterial||i.isMeshLambertMaterial?n(e,i):i.isMeshToonMaterial?(n(e,i),function(e,t){t.gradientMap&&(e.gradientMap.value=t.gradientMap)}(e,i)):i.isMeshPhongMaterial?(n(e,i),function(e,t){e.specular.value.copy(t.specular),e.shininess.value=Math.max(t.shininess,1e-4)}(e,i)):i.isMeshStandardMaterial?(n(e,i),function(e,n){e.roughness.value=n.roughness,e.metalness.value=n.metalness,n.roughnessMap&&(e.roughnessMap.value=n.roughnessMap),n.metalnessMap&&(e.metalnessMap.value=n.metalnessMap),t.get(n).envMap&&(e.envMapIntensity.value=n.envMapIntensity)}(e,i),i.isMeshPhysicalMaterial&&function(e,t,n){e.ior.value=t.ior,t.sheen>0&&(e.sheenColor.value.copy(t.sheenColor).multiplyScalar(t.sheen),e.sheenRoughness.value=t.sheenRoughness,t.sheenColorMap&&(e.sheenColorMap.value=t.sheenColorMap),t.sheenRoughnessMap&&(e.sheenRoughnessMap.value=t.sheenRoughnessMap)),t.clearcoat>0&&(e.clearcoat.value=t.clearcoat,e.clearcoatRoughness.value=t.clearcoatRoughness,t.clearcoatMap&&(e.clearcoatMap.value=t.clearcoatMap),t.clearcoatRoughnessMap&&(e.clearcoatRoughnessMap.value=t.clearcoatRoughnessMap),t.clearcoatNormalMap&&(e.clearcoatNormalScale.value.copy(t.clearcoatNormalScale),e.clearcoatNormalMap.value=t.clearcoatNormalMap,1===t.side&&e.clearcoatNormalScale.value.negate())),t.iridescence>0&&(e.iridescence.value=t.iridescence,e.iridescenceIOR.value=t.iridescenceIOR,e.iridescenceThicknessMinimum.value=t.iridescenceThicknessRange[0],e.iridescenceThicknessMaximum.value=t.iridescenceThicknessRange[1],t.iridescenceMap&&(e.iridescenceMap.value=t.iridescenceMap),t.iridescenceThicknessMap&&(e.iridescenceThicknessMap.value=t.iridescenceThicknessMap)),t.transmission>0&&(e.transmission.value=t.transmission,e.transmissionSamplerMap.value=n.texture,e.transmissionSamplerSize.value.set(n.width,n.height),t.transmissionMap&&(e.transmissionMap.value=t.transmissionMap),e.thickness.value=t.thickness,t.thicknessMap&&(e.thicknessMap.value=t.thicknessMap),e.attenuationDistance.value=t.attenuationDistance,e.attenuationColor.value.copy(t.attenuationColor)),e.specularIntensity.value=t.specularIntensity,e.specularColor.value.copy(t.specularColor),t.specularIntensityMap&&(e.specularIntensityMap.value=t.specularIntensityMap),t.specularColorMap&&(e.specularColorMap.value=t.specularColorMap)}(e,i,a)):i.isMeshMatcapMaterial?(n(e,i),function(e,t){t.matcap&&(e.matcap.value=t.matcap)}(e,i)):i.isMeshDepthMaterial?n(e,i):i.isMeshDistanceMaterial?(n(e,i),function(e,t){e.referencePosition.value.copy(t.referencePosition),e.nearDistance.value=t.nearDistance,e.farDistance.value=t.farDistance}(e,i)):i.isMeshNormalMaterial?n(e,i):i.isLineBasicMaterial?(function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity}(e,i),i.isLineDashedMaterial&&function(e,t){e.dashSize.value=t.dashSize,e.totalSize.value=t.dashSize+t.gapSize,e.scale.value=t.scale}(e,i)):i.isPointsMaterial?function(e,t,n,i){let r;e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.size.value=t.size*n,e.scale.value=.5*i,t.map&&(e.map.value=t.map),t.alphaMap&&(e.alphaMap.value=t.alphaMap),t.alphaTest>0&&(e.alphaTest.value=t.alphaTest),t.map?r=t.map:t.alphaMap&&(r=t.alphaMap),void 0!==r&&(!0===r.matrixAutoUpdate&&r.updateMatrix(),e.uvTransform.value.copy(r.matrix))}(e,i,r,o):i.isSpriteMaterial?function(e,t){let n;e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.rotation.value=t.rotation,t.map&&(e.map.value=t.map),t.alphaMap&&(e.alphaMap.value=t.alphaMap),t.alphaTest>0&&(e.alphaTest.value=t.alphaTest),t.map?n=t.map:t.alphaMap&&(n=t.alphaMap),void 0!==n&&(!0===n.matrixAutoUpdate&&n.updateMatrix(),e.uvTransform.value.copy(n.matrix))}(e,i):i.isShadowMaterial?(e.color.value.copy(i.color),e.opacity.value=i.opacity):i.isShaderMaterial&&(i.uniformsNeedUpdate=!1)}}}function Yf(e,t,n,i){let r={},o={},a=[];const s=n.isWebGL2?e.getParameter(35375):0;function l(e,t,n){const i=e.value;if(void 0===n[t])return n[t]="number"==typeof i?i:i.clone(),!0;if("number"==typeof i){if(n[t]!==i)return n[t]=i,!0}else{const e=n[t];if(!1===e.equals(i))return e.copy(i),!0}return!1}function p(e){const t=e.value,n={boundary:0,storage:0};return"number"==typeof t?(n.boundary=4,n.storage=4):t.isVector2?(n.boundary=8,n.storage=8):t.isVector3||t.isColor?(n.boundary=16,n.storage=12):t.isVector4?(n.boundary=16,n.storage=16):t.isMatrix3?(n.boundary=48,n.storage=48):t.isMatrix4?(n.boundary=64,n.storage=64):t.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",t),n}function u(t){const n=t.target;n.removeEventListener("dispose",u);const i=a.indexOf(n.__bindingPointIndex);a.splice(i,1),e.deleteBuffer(r[n.id]),delete r[n.id],delete o[n.id]}return{bind:function(e,t){const n=t.program;i.uniformBlockBinding(e,n)},update:function(n,h){let c=r[n.id];void 0===c&&(function(e){const t=e.uniforms;let n=0;let i=0;for(let e=0,r=t.length;e<r;e++){const r=t[e],o=p(r);if(r.__data=new Float32Array(o.storage/Float32Array.BYTES_PER_ELEMENT),r.__offset=n,e>0){i=n%16;const e=16-i;0!==i&&e-o.boundary<0&&(n+=16-i,r.__offset=n)}n+=o.storage}i=n%16,i>0&&(n+=16-i),e.__size=n,e.__cache={}}(n),c=function(t){const n=function(){for(let e=0;e<s;e++)if(-1===a.indexOf(e))return a.push(e),e;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}();t.__bindingPointIndex=n;const i=e.createBuffer(),r=t.__size,o=t.usage;return e.bindBuffer(35345,i),e.bufferData(35345,r,o),e.bindBuffer(35345,null),e.bindBufferBase(35345,n,i),i}(n),r[n.id]=c,n.addEventListener("dispose",u));const _=h.program;i.updateUBOMapping(n,_);const d=t.render.frame;o[n.id]!==d&&(function(t){const n=r[t.id],i=t.uniforms,o=t.__cache;e.bindBuffer(35345,n);for(let t=0,n=i.length;t<n;t++){const n=i[t];if(!0===l(n,t,o)){const t=n.value,i=n.__offset;"number"==typeof t?(n.__data[0]=t,e.bufferSubData(35345,i,n.__data)):(n.value.isMatrix3?(n.__data[0]=n.value.elements[0],n.__data[1]=n.value.elements[1],n.__data[2]=n.value.elements[2],n.__data[3]=n.value.elements[0],n.__data[4]=n.value.elements[3],n.__data[5]=n.value.elements[4],n.__data[6]=n.value.elements[5],n.__data[7]=n.value.elements[0],n.__data[8]=n.value.elements[6],n.__data[9]=n.value.elements[7],n.__data[10]=n.value.elements[8],n.__data[11]=n.value.elements[0]):t.toArray(n.__data),e.bufferSubData(35345,i,n.__data))}}e.bindBuffer(35345,null)}(n),o[n.id]=d)},dispose:function(){for(const t in r)e.deleteBuffer(r[t]);a=[],r={},o={}}}}function Kf(e={}){this.isWebGLRenderer=!0;const t=void 0!==e.canvas?e.canvas:function(){const e=Fc("canvas");return e.style.display="block",e}(),n=void 0!==e.context?e.context:null,i=void 0===e.depth||e.depth,r=void 0===e.stencil||e.stencil,o=void 0!==e.antialias&&e.antialias,a=void 0===e.premultipliedAlpha||e.premultipliedAlpha,s=void 0!==e.preserveDrawingBuffer&&e.preserveDrawingBuffer,l=void 0!==e.powerPreference?e.powerPreference:"default",p=void 0!==e.failIfMajorPerformanceCaveat&&e.failIfMajorPerformanceCaveat;let u;u=null!==n?n.getContextAttributes().alpha:void 0!==e.alpha&&e.alpha;let h=null,c=null;const _=[],d=[];this.domElement=t,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.outputEncoding=fc,this.physicallyCorrectLights=!1,this.toneMapping=0,this.toneMappingExposure=1,Object.defineProperties(this,{gammaFactor:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaFactor has been removed."),2},set:function(){console.warn("THREE.WebGLRenderer: .gammaFactor has been removed.")}}});const m=this;let P=!1,f=0,x=0,y=null,v=-1,g=null;const b=new o_,z=new o_;let w=null,Z=t.width,E=t.height,M=1,S=null,C=null;const N=new o_(0,0,Z,E),A=new o_(0,0,Z,E);let L=!1;const B=new bm;let T=!1,V=!1,k=null;const I=new H_,O=new Oc,R=new p_,H={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function F(){return null===y?M:1}let D,G,U,j,W,q,J,$,X,Y,K,Q,ee,te,ne,ie,re,oe,ae,se,le,pe,ue,he,ce=n;function _e(e,n){for(let i=0;i<e.length;i++){const r=e[i],o=t.getContext(r,n);if(null!==o)return o}return null}try{const e={alpha:!0,depth:i,stencil:r,antialias:o,premultipliedAlpha:a,preserveDrawingBuffer:s,powerPreference:l,failIfMajorPerformanceCaveat:p};if("setAttribute"in t&&t.setAttribute("data-engine","three.js r144"),t.addEventListener("webglcontextlost",Pe,!1),t.addEventListener("webglcontextrestored",fe,!1),t.addEventListener("webglcontextcreationerror",xe,!1),null===ce){const t=["webgl2","webgl","experimental-webgl"];if(!0===m.isWebGL1Renderer&&t.shift(),ce=_e(t,e),null===ce)throw _e(t)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}void 0===ce.getShaderPrecisionFormat&&(ce.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(e){throw console.error("THREE.WebGLRenderer: "+e.message),e}function de(){D=new Jm(ce),G=new Lm(ce,D,e),D.init(G),pe=new Gf(ce,D,G),U=new Ff(ce,D,G),j=new Ym,W=new Mf,q=new Df(ce,D,U,W,G,pe,j),J=new Tm(m),$=new qm(m),X=new wm(ce,G),ue=new Nm(ce,D,X,G),Y=new $m(ce,X,j,ue),K=new tP(ce,Y,X,j),ae=new eP(ce,G,q),ie=new Bm(W),Q=new Ef(m,J,$,D,G,ue,ie),ee=new Xf(m,W),te=new Af,ne=new If(D,G),oe=new Cm(m,J,U,K,u,a),re=new Hf(m,K,G),he=new Yf(ce,j,G,U),se=new Am(ce,D,j,G),le=new Xm(ce,D,j,G),j.programs=Q.programs,m.capabilities=G,m.extensions=D,m.properties=W,m.renderLists=te,m.shadowMap=re,m.state=U,m.info=j}de();const me=new $f(m,ce);function Pe(e){e.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),P=!0}function fe(){console.log("THREE.WebGLRenderer: Context Restored."),P=!1;const e=j.autoReset,t=re.enabled,n=re.autoUpdate,i=re.needsUpdate,r=re.type;de(),j.autoReset=e,re.enabled=t,re.autoUpdate=n,re.needsUpdate=i,re.type=r}function xe(e){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",e.statusMessage)}function ye(e){const t=e.target;t.removeEventListener("dispose",ye),function(e){(function(e){const t=W.get(e).programs;void 0!==t&&(t.forEach((function(e){Q.releaseProgram(e)})),e.isShaderMaterial&&Q.releaseShaderCache(e))})(e),W.remove(e)}(t)}this.xr=me,this.getContext=function(){return ce},this.getContextAttributes=function(){return ce.getContextAttributes()},this.forceContextLoss=function(){const e=D.get("WEBGL_lose_context");e&&e.loseContext()},this.forceContextRestore=function(){const e=D.get("WEBGL_lose_context");e&&e.restoreContext()},this.getPixelRatio=function(){return M},this.setPixelRatio=function(e){void 0!==e&&(M=e,this.setSize(Z,E,!1))},this.getSize=function(e){return e.set(Z,E)},this.setSize=function(e,n,i){me.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(Z=e,E=n,t.width=Math.floor(e*M),t.height=Math.floor(n*M),!1!==i&&(t.style.width=e+"px",t.style.height=n+"px"),this.setViewport(0,0,e,n))},this.getDrawingBufferSize=function(e){return e.set(Z*M,E*M).floor()},this.setDrawingBufferSize=function(e,n,i){Z=e,E=n,M=i,t.width=Math.floor(e*i),t.height=Math.floor(n*i),this.setViewport(0,0,e,n)},this.getCurrentViewport=function(e){return e.copy(b)},this.getViewport=function(e){return e.copy(N)},this.setViewport=function(e,t,n,i){e.isVector4?N.set(e.x,e.y,e.z,e.w):N.set(e,t,n,i),U.viewport(b.copy(N).multiplyScalar(M).floor())},this.getScissor=function(e){return e.copy(A)},this.setScissor=function(e,t,n,i){e.isVector4?A.set(e.x,e.y,e.z,e.w):A.set(e,t,n,i),U.scissor(z.copy(A).multiplyScalar(M).floor())},this.getScissorTest=function(){return L},this.setScissorTest=function(e){U.setScissorTest(L=e)},this.setOpaqueSort=function(e){S=e},this.setTransparentSort=function(e){C=e},this.getClearColor=function(e){return e.copy(oe.getClearColor())},this.setClearColor=function(){oe.setClearColor.apply(oe,arguments)},this.getClearAlpha=function(){return oe.getClearAlpha()},this.setClearAlpha=function(){oe.setClearAlpha.apply(oe,arguments)},this.clear=function(e=!0,t=!0,n=!0){let i=0;e&&(i|=16384),t&&(i|=256),n&&(i|=1024),ce.clear(i)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",Pe,!1),t.removeEventListener("webglcontextrestored",fe,!1),t.removeEventListener("webglcontextcreationerror",xe,!1),te.dispose(),ne.dispose(),W.dispose(),J.dispose(),$.dispose(),K.dispose(),ue.dispose(),he.dispose(),Q.dispose(),me.dispose(),me.removeEventListener("sessionstart",ge),me.removeEventListener("sessionend",be),k&&(k.dispose(),k=null),ze.stop()},this.renderBufferDirect=function(e,t,n,i,r,o){null===t&&(t=H);const a=r.isMesh&&r.matrixWorld.determinant()<0,s=function(e,t,n,i,r){!0!==t.isScene&&(t=H),q.resetTextureUnits();const o=t.fog,a=i.isMeshStandardMaterial?t.environment:null,s=null===y?m.outputEncoding:!0===y.isXRRenderTarget?y.texture.encoding:fc,l=(i.isMeshStandardMaterial?$:J).get(i.envMap||a),p=!0===i.vertexColors&&!!n.attributes.color&&4===n.attributes.color.itemSize,u=!!i.normalMap&&!!n.attributes.tangent,h=!!n.morphAttributes.position,_=!!n.morphAttributes.normal,d=!!n.morphAttributes.color,P=i.toneMapped?m.toneMapping:0,f=n.morphAttributes.position||n.morphAttributes.normal||n.morphAttributes.color,x=void 0!==f?f.length:0,b=W.get(i),z=c.state.lights;if(!0===T&&(!0===V||e!==g)){const t=e===g&&i.id===v;ie.setState(i,e,t)}let w=!1;i.version===b.__version?b.needsLights&&b.lightsStateVersion!==z.state.version||b.outputEncoding!==s||r.isInstancedMesh&&!1===b.instancing?w=!0:r.isInstancedMesh||!0!==b.instancing?r.isSkinnedMesh&&!1===b.skinning?w=!0:r.isSkinnedMesh||!0!==b.skinning?b.envMap!==l||!0===i.fog&&b.fog!==o?w=!0:void 0===b.numClippingPlanes||b.numClippingPlanes===ie.numPlanes&&b.numIntersection===ie.numIntersection?(b.vertexAlphas!==p||b.vertexTangents!==u||b.morphTargets!==h||b.morphNormals!==_||b.morphColors!==d||b.toneMapping!==P||!0===G.isWebGL2&&b.morphTargetsCount!==x)&&(w=!0):w=!0:w=!0:w=!0:(w=!0,b.__version=i.version);let Z=b.currentProgram;!0===w&&(Z=Se(i,t,r));let S=!1,C=!1,N=!1;const A=Z.getUniforms(),L=b.uniforms;if(U.useProgram(Z.program)&&(S=!0,C=!0,N=!0),i.id!==v&&(v=i.id,C=!0),S||g!==e){if(A.setValue(ce,"projectionMatrix",e.projectionMatrix),G.logarithmicDepthBuffer&&A.setValue(ce,"logDepthBufFC",2/(Math.log(e.far+1)/Math.LN2)),g!==e&&(g=e,C=!0,N=!0),i.isShaderMaterial||i.isMeshPhongMaterial||i.isMeshToonMaterial||i.isMeshStandardMaterial||i.envMap){const t=A.map.cameraPosition;void 0!==t&&t.setValue(ce,R.setFromMatrixPosition(e.matrixWorld))}(i.isMeshPhongMaterial||i.isMeshToonMaterial||i.isMeshLambertMaterial||i.isMeshBasicMaterial||i.isMeshStandardMaterial||i.isShaderMaterial)&&A.setValue(ce,"isOrthographic",!0===e.isOrthographicCamera),(i.isMeshPhongMaterial||i.isMeshToonMaterial||i.isMeshLambertMaterial||i.isMeshBasicMaterial||i.isMeshStandardMaterial||i.isShaderMaterial||i.isShadowMaterial||r.isSkinnedMesh)&&A.setValue(ce,"viewMatrix",e.matrixWorldInverse)}if(r.isSkinnedMesh){A.setOptional(ce,r,"bindMatrix"),A.setOptional(ce,r,"bindMatrixInverse");const e=r.skeleton;e&&(G.floatVertexTextures?(null===e.boneTexture&&e.computeBoneTexture(),A.setValue(ce,"boneTexture",e.boneTexture,q),A.setValue(ce,"boneTextureSize",e.boneTextureSize)):console.warn("THREE.WebGLRenderer: SkinnedMesh can only be used with WebGL 2. With WebGL 1 OES_texture_float and vertex textures support is required."))}const B=n.morphAttributes;var I,O;if((void 0!==B.position||void 0!==B.normal||void 0!==B.color&&!0===G.isWebGL2)&&ae.update(r,n,i,Z),(C||b.receiveShadow!==r.receiveShadow)&&(b.receiveShadow=r.receiveShadow,A.setValue(ce,"receiveShadow",r.receiveShadow)),i.isMeshGouraudMaterial&&null!==i.envMap&&(L.envMap.value=l,L.flipEnvMap.value=l.isCubeTexture&&!1===l.isRenderTargetTexture?-1:1),C&&(A.setValue(ce,"toneMappingExposure",m.toneMappingExposure),b.needsLights&&(O=N,(I=L).ambientLightColor.needsUpdate=O,I.lightProbe.needsUpdate=O,I.directionalLights.needsUpdate=O,I.directionalLightShadows.needsUpdate=O,I.pointLights.needsUpdate=O,I.pointLightShadows.needsUpdate=O,I.spotLights.needsUpdate=O,I.spotLightShadows.needsUpdate=O,I.rectAreaLights.needsUpdate=O,I.hemisphereLights.needsUpdate=O),o&&!0===i.fog&&ee.refreshFogUniforms(L,o),ee.refreshMaterialUniforms(L,i,M,E,k),af.upload(ce,b.uniformsList,L,q)),i.isShaderMaterial&&!0===i.uniformsNeedUpdate&&(af.upload(ce,b.uniformsList,L,q),i.uniformsNeedUpdate=!1),i.isSpriteMaterial&&A.setValue(ce,"center",r.center),A.setValue(ce,"modelViewMatrix",r.modelViewMatrix),A.setValue(ce,"normalMatrix",r.normalMatrix),A.setValue(ce,"modelMatrix",r.matrixWorld),i.isShaderMaterial||i.isRawShaderMaterial){const e=i.uniformsGroups;for(let t=0,n=e.length;t<n;t++)if(G.isWebGL2){const n=e[t];he.update(n,Z),he.bind(n,Z)}else console.warn("THREE.WebGLRenderer: Uniform Buffer Objects can only be used with WebGL 2.")}return Z}(e,t,n,i,r);U.setMaterial(i,a);let l=n.index;const p=n.attributes.position;if(null===l){if(void 0===p||0===p.count)return}else if(0===l.count)return;let u,h=1;!0===i.wireframe&&(l=Y.getWireframeAttribute(n),h=2),ue.setup(r,i,s,n,l);let _=se;null!==l&&(u=X.get(l),_=le,_.setIndex(u));const d=null!==l?l.count:p.count,P=n.drawRange.start*h,f=n.drawRange.count*h,x=null!==o?o.start*h:0,b=null!==o?o.count*h:1/0,z=Math.max(P,x),w=Math.min(d,P+f,x+b)-1,Z=Math.max(0,w-z+1);if(0!==Z){if(r.isMesh)!0===i.wireframe?(U.setLineWidth(i.wireframeLinewidth*F()),_.setMode(1)):_.setMode(4);else if(r.isLine){let e=i.linewidth;void 0===e&&(e=1),U.setLineWidth(e*F()),r.isLineSegments?_.setMode(1):r.isLineLoop?_.setMode(2):_.setMode(3)}else r.isPoints?_.setMode(0):r.isSprite&&_.setMode(4);if(r.isInstancedMesh)_.renderInstances(z,Z,r.count);else if(n.isInstancedBufferGeometry){const e=Math.min(n.instanceCount,n._maxInstanceCount);_.renderInstances(z,Z,e)}else _.render(z,Z)}},this.compile=function(e,t){function n(e,t,n){!0===e.transparent&&2===e.side?(e.side=1,e.needsUpdate=!0,Se(e,t,n),e.side=0,e.needsUpdate=!0,Se(e,t,n),e.side=2):Se(e,t,n)}c=ne.get(e),c.init(),d.push(c),e.traverseVisible((function(e){e.isLight&&e.layers.test(t.layers)&&(c.pushLight(e),e.castShadow&&c.pushShadow(e))})),c.setupLights(m.physicallyCorrectLights),e.traverse((function(t){const i=t.material;if(i)if(Array.isArray(i))for(let r=0;r<i.length;r++)n(i[r],e,t);else n(i,e,t)})),d.pop(),c=null};let ve=null;function ge(){ze.stop()}function be(){ze.start()}const ze=new zm;function we(e,t,n,i){if(!1===e.visible)return;if(e.layers.test(t.layers))if(e.isGroup)n=e.renderOrder;else if(e.isLOD)!0===e.autoUpdate&&e.update(t);else if(e.isLight)c.pushLight(e),e.castShadow&&c.pushShadow(e);else if(e.isSprite){if(!e.frustumCulled||B.intersectsSprite(e)){i&&R.setFromMatrixPosition(e.matrixWorld).applyMatrix4(I);const t=K.update(e),r=e.material;r.visible&&h.push(e,t,r,n,R.z,null)}}else if((e.isMesh||e.isLine||e.isPoints)&&(e.isSkinnedMesh&&e.skeleton.frame!==j.render.frame&&(e.skeleton.update(),e.skeleton.frame=j.render.frame),!e.frustumCulled||B.intersectsObject(e))){i&&R.setFromMatrixPosition(e.matrixWorld).applyMatrix4(I);const t=K.update(e),r=e.material;if(Array.isArray(r)){const i=t.groups;for(let o=0,a=i.length;o<a;o++){const a=i[o],s=r[a.materialIndex];s&&s.visible&&h.push(e,t,s,n,R.z,a)}}else r.visible&&h.push(e,t,r,n,R.z,null)}const r=e.children;for(let e=0,o=r.length;e<o;e++)we(r[e],t,n,i)}function Ze(e,t,n,i){const r=e.opaque,a=e.transmissive,s=e.transparent;c.setupLightsView(n),a.length>0&&function(e,t,n){const i=G.isWebGL2;null===k&&(k=new a_(1,1,{generateMipmaps:!0,type:D.has("EXT_color_buffer_half_float")?nc:Qh,minFilter:Kh,samples:i&&!0===o?4:0})),m.getDrawingBufferSize(O),i?k.setSize(O.x,O.y):k.setSize(Tc(O.x),Tc(O.y));const r=m.getRenderTarget();m.setRenderTarget(k),m.clear();const a=m.toneMapping;m.toneMapping=0,Ee(e,t,n),m.toneMapping=a,q.updateMultisampleRenderTarget(k),q.updateRenderTargetMipmap(k),m.setRenderTarget(r)}(r,t,n),i&&U.viewport(b.copy(i)),r.length>0&&Ee(r,t,n),a.length>0&&Ee(a,t,n),s.length>0&&Ee(s,t,n),U.buffers.depth.setTest(!0),U.buffers.depth.setMask(!0),U.buffers.color.setMask(!0),U.setPolygonOffset(!1)}function Ee(e,t,n){const i=!0===t.isScene?t.overrideMaterial:null;for(let r=0,o=e.length;r<o;r++){const o=e[r],a=o.object,s=o.geometry,l=null===i?o.material:i,p=o.group;a.layers.test(n.layers)&&Me(a,t,n,s,l,p)}}function Me(e,t,n,i,r,o){e.onBeforeRender(m,t,n,i,r,o),e.modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,e.matrixWorld),e.normalMatrix.getNormalMatrix(e.modelViewMatrix),r.onBeforeRender(m,t,n,i,e,o),!0===r.transparent&&2===r.side?(r.side=1,r.needsUpdate=!0,m.renderBufferDirect(n,t,i,r,e,o),r.side=0,r.needsUpdate=!0,m.renderBufferDirect(n,t,i,r,e,o),r.side=2):m.renderBufferDirect(n,t,i,r,e,o),e.onAfterRender(m,t,n,i,r,o)}function Se(e,t,n){!0!==t.isScene&&(t=H);const i=W.get(e),r=c.state.lights,o=c.state.shadowsArray,a=r.state.version,s=Q.getParameters(e,r.state,o,t,n),l=Q.getProgramCacheKey(s);let p=i.programs;i.environment=e.isMeshStandardMaterial?t.environment:null,i.fog=t.fog,i.envMap=(e.isMeshStandardMaterial?$:J).get(e.envMap||i.environment),void 0===p&&(e.addEventListener("dispose",ye),p=new Map,i.programs=p);let u=p.get(l);if(void 0!==u){if(i.currentProgram===u&&i.lightsStateVersion===a)return Ce(e,s),u}else s.uniforms=Q.getUniforms(e),e.onBuild(n,s,m),e.onBeforeCompile(s,m),u=Q.acquireProgram(s,l),p.set(l,u),i.uniforms=s.uniforms;const h=i.uniforms;(e.isShaderMaterial||e.isRawShaderMaterial)&&!0!==e.clipping||(h.clippingPlanes=ie.uniform),Ce(e,s),i.needsLights=function(e){return e.isMeshLambertMaterial||e.isMeshToonMaterial||e.isMeshPhongMaterial||e.isMeshStandardMaterial||e.isShadowMaterial||e.isShaderMaterial&&!0===e.lights}(e),i.lightsStateVersion=a,i.needsLights&&(h.ambientLightColor.value=r.state.ambient,h.lightProbe.value=r.state.probe,h.directionalLights.value=r.state.directional,h.directionalLightShadows.value=r.state.directionalShadow,h.spotLights.value=r.state.spot,h.spotLightShadows.value=r.state.spotShadow,h.rectAreaLights.value=r.state.rectArea,h.ltc_1.value=r.state.rectAreaLTC1,h.ltc_2.value=r.state.rectAreaLTC2,h.pointLights.value=r.state.point,h.pointLightShadows.value=r.state.pointShadow,h.hemisphereLights.value=r.state.hemi,h.directionalShadowMap.value=r.state.directionalShadowMap,h.directionalShadowMatrix.value=r.state.directionalShadowMatrix,h.spotShadowMap.value=r.state.spotShadowMap,h.spotLightMatrix.value=r.state.spotLightMatrix,h.spotLightMap.value=r.state.spotLightMap,h.pointShadowMap.value=r.state.pointShadowMap,h.pointShadowMatrix.value=r.state.pointShadowMatrix);const _=u.getUniforms(),d=af.seqWithValue(_.seq,h);return i.currentProgram=u,i.uniformsList=d,u}function Ce(e,t){const n=W.get(e);n.outputEncoding=t.outputEncoding,n.instancing=t.instancing,n.skinning=t.skinning,n.morphTargets=t.morphTargets,n.morphNormals=t.morphNormals,n.morphColors=t.morphColors,n.morphTargetsCount=t.morphTargetsCount,n.numClippingPlanes=t.numClippingPlanes,n.numIntersection=t.numClipIntersection,n.vertexAlphas=t.vertexAlphas,n.vertexTangents=t.vertexTangents,n.toneMapping=t.toneMapping}ze.setAnimationLoop((function(e){ve&&ve(e)})),"undefined"!=typeof self&&ze.setContext(self),this.setAnimationLoop=function(e){ve=e,me.setAnimationLoop(e),null===e?ze.stop():ze.start()},me.addEventListener("sessionstart",ge),me.addEventListener("sessionend",be),this.render=function(e,t){if(void 0!==t&&!0!==t.isCamera)return void console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");if(!0===P)return;!0===e.matrixWorldAutoUpdate&&e.updateMatrixWorld(),null===t.parent&&!0===t.matrixWorldAutoUpdate&&t.updateMatrixWorld(),!0===me.enabled&&!0===me.isPresenting&&(!0===me.cameraAutoUpdate&&me.updateCamera(t),t=me.getCamera()),!0===e.isScene&&e.onBeforeRender(m,e,t,y),c=ne.get(e,d.length),c.init(),d.push(c),I.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),B.setFromProjectionMatrix(I),V=this.localClippingEnabled,T=ie.init(this.clippingPlanes,V,t),h=te.get(e,_.length),h.init(),_.push(h),we(e,t,0,m.sortObjects),h.finish(),!0===m.sortObjects&&h.sort(S,C),!0===T&&ie.beginShadows();const n=c.state.shadowsArray;if(re.render(n,e,t),!0===T&&ie.endShadows(),!0===this.info.autoReset&&this.info.reset(),oe.render(h,e),c.setupLights(m.physicallyCorrectLights),t.isArrayCamera){const n=t.cameras;for(let t=0,i=n.length;t<i;t++){const i=n[t];Ze(h,e,i,i.viewport)}}else Ze(h,e,t);null!==y&&(q.updateMultisampleRenderTarget(y),q.updateRenderTargetMipmap(y)),!0===e.isScene&&e.onAfterRender(m,e,t),ue.resetDefaultState(),v=-1,g=null,d.pop(),c=d.length>0?d[d.length-1]:null,_.pop(),h=_.length>0?_[_.length-1]:null},this.getActiveCubeFace=function(){return f},this.getActiveMipmapLevel=function(){return x},this.getRenderTarget=function(){return y},this.setRenderTargetTextures=function(e,t,n){W.get(e.texture).__webglTexture=t,W.get(e.depthTexture).__webglTexture=n;const i=W.get(e);i.__hasExternalTextures=!0,i.__hasExternalTextures&&(i.__autoAllocateDepthBuffer=void 0===n,i.__autoAllocateDepthBuffer||!0===D.has("WEBGL_multisampled_render_to_texture")&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),i.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(e,t){const n=W.get(e);n.__webglFramebuffer=t,n.__useDefaultFramebuffer=void 0===t},this.setRenderTarget=function(e,t=0,n=0){y=e,f=t,x=n;let i=!0;if(e){const t=W.get(e);void 0!==t.__useDefaultFramebuffer?(U.bindFramebuffer(36160,null),i=!1):void 0===t.__webglFramebuffer?q.setupRenderTarget(e):t.__hasExternalTextures&&q.rebindTextures(e,W.get(e.texture).__webglTexture,W.get(e.depthTexture).__webglTexture)}let r=null,o=!1,a=!1;if(e){const n=e.texture;(n.isData3DTexture||n.isDataArrayTexture)&&(a=!0);const i=W.get(e).__webglFramebuffer;e.isWebGLCubeRenderTarget?(r=i[t],o=!0):r=G.isWebGL2&&e.samples>0&&!1===q.useMultisampledRTT(e)?W.get(e).__webglMultisampledFramebuffer:i,b.copy(e.viewport),z.copy(e.scissor),w=e.scissorTest}else b.copy(N).multiplyScalar(M).floor(),z.copy(A).multiplyScalar(M).floor(),w=L;if(U.bindFramebuffer(36160,r)&&G.drawBuffers&&i&&U.drawBuffers(e,r),U.viewport(b),U.scissor(z),U.setScissorTest(w),o){const i=W.get(e.texture);ce.framebufferTexture2D(36160,36064,34069+t,i.__webglTexture,n)}else if(a){const i=W.get(e.texture),r=t||0;ce.framebufferTextureLayer(36160,36064,i.__webglTexture,n||0,r)}v=-1},this.readRenderTargetPixels=function(e,t,n,i,r,o,a){if(!e||!e.isWebGLRenderTarget)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let s=W.get(e).__webglFramebuffer;if(e.isWebGLCubeRenderTarget&&void 0!==a&&(s=s[a]),s){U.bindFramebuffer(36160,s);try{const a=e.texture,s=a.format,l=a.type;if(s!==rc&&pe.convert(s)!==ce.getParameter(35739))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");const p=l===nc&&(D.has("EXT_color_buffer_half_float")||G.isWebGL2&&D.has("EXT_color_buffer_float"));if(!(l===Qh||pe.convert(l)===ce.getParameter(35738)||l===tc&&(G.isWebGL2||D.has("OES_texture_float")||D.has("WEBGL_color_buffer_float"))||p))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");t>=0&&t<=e.width-i&&n>=0&&n<=e.height-r&&ce.readPixels(t,n,i,r,pe.convert(s),pe.convert(l),o)}finally{const e=null!==y?W.get(y).__webglFramebuffer:null;U.bindFramebuffer(36160,e)}}},this.copyFramebufferToTexture=function(e,t,n=0){const i=Math.pow(2,-n),r=Math.floor(t.image.width*i),o=Math.floor(t.image.height*i);q.setTexture2D(t,0),ce.copyTexSubImage2D(3553,n,0,0,e.x,e.y,r,o),U.unbindTexture()},this.copyTextureToTexture=function(e,t,n,i=0){const r=t.image.width,o=t.image.height,a=pe.convert(n.format),s=pe.convert(n.type);q.setTexture2D(n,0),ce.pixelStorei(37440,n.flipY),ce.pixelStorei(37441,n.premultiplyAlpha),ce.pixelStorei(3317,n.unpackAlignment),t.isDataTexture?ce.texSubImage2D(3553,i,e.x,e.y,r,o,a,s,t.image.data):t.isCompressedTexture?ce.compressedTexSubImage2D(3553,i,e.x,e.y,t.mipmaps[0].width,t.mipmaps[0].height,a,t.mipmaps[0].data):ce.texSubImage2D(3553,i,e.x,e.y,a,s,t.image),0===i&&n.generateMipmaps&&ce.generateMipmap(3553),U.unbindTexture()},this.copyTextureToTexture3D=function(e,t,n,i,r=0){if(m.isWebGL1Renderer)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");const o=e.max.x-e.min.x+1,a=e.max.y-e.min.y+1,s=e.max.z-e.min.z+1,l=pe.convert(i.format),p=pe.convert(i.type);let u;if(i.isData3DTexture)q.setTexture3D(i,0),u=32879;else{if(!i.isDataArrayTexture)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");q.setTexture2DArray(i,0),u=35866}ce.pixelStorei(37440,i.flipY),ce.pixelStorei(37441,i.premultiplyAlpha),ce.pixelStorei(3317,i.unpackAlignment);const h=ce.getParameter(3314),c=ce.getParameter(32878),_=ce.getParameter(3316),d=ce.getParameter(3315),P=ce.getParameter(32877),f=n.isCompressedTexture?n.mipmaps[0]:n.image;ce.pixelStorei(3314,f.width),ce.pixelStorei(32878,f.height),ce.pixelStorei(3316,e.min.x),ce.pixelStorei(3315,e.min.y),ce.pixelStorei(32877,e.min.z),n.isDataTexture||n.isData3DTexture?ce.texSubImage3D(u,r,t.x,t.y,t.z,o,a,s,l,p,f.data):n.isCompressedTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),ce.compressedTexSubImage3D(u,r,t.x,t.y,t.z,o,a,s,l,f.data)):ce.texSubImage3D(u,r,t.x,t.y,t.z,o,a,s,l,p,f),ce.pixelStorei(3314,h),ce.pixelStorei(32878,c),ce.pixelStorei(3316,_),ce.pixelStorei(3315,d),ce.pixelStorei(32877,P),0===r&&i.generateMipmaps&&ce.generateMipmap(u),U.unbindTexture()},this.initTexture=function(e){e.isCubeTexture?q.setTextureCube(e,0):e.isData3DTexture?q.setTexture3D(e,0):e.isDataArrayTexture?q.setTexture2DArray(e,0):q.setTexture2D(e,0),U.unbindTexture()},this.resetState=function(){f=0,x=0,y=null,U.reset(),ue.reset()},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}(class extends Kf{}).prototype.isWebGL1Renderer=!0;class Qf extends hd{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),null!==e.background&&(this.background=e.background.clone()),null!==e.environment&&(this.environment=e.environment.clone()),null!==e.fog&&(this.fog=e.fog.clone()),null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return null!==this.fog&&(t.object.fog=this.fog.toJSON()),t}get autoUpdate(){return console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate}set autoUpdate(e){console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate=e}}class ex extends wd{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new Kc(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}}const tx=new p_,nx=new p_,ix=new H_,rx=new R_,ox=new A_;class ax extends hd{constructor(e=new Rd,t=new ex){super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(null===e.index){const t=e.attributes.position,n=[0];for(let e=1,i=t.count;e<i;e++)tx.fromBufferAttribute(t,e-1),nx.fromBufferAttribute(t,e),n[e]=n[e-1],n[e]+=tx.distanceTo(nx);e.setAttribute("lineDistance",new Ad(n,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,t){const n=this.geometry,i=this.matrixWorld,r=e.params.Line.threshold,o=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),ox.copy(n.boundingSphere),ox.applyMatrix4(i),ox.radius+=r,!1===e.ray.intersectsSphere(ox))return;ix.copy(i).invert(),rx.copy(e.ray).applyMatrix4(ix);const a=r/((this.scale.x+this.scale.y+this.scale.z)/3),s=a*a,l=new p_,p=new p_,u=new p_,h=new p_,c=this.isLineSegments?2:1,_=n.index,d=n.attributes.position;if(null!==_)for(let n=Math.max(0,o.start),i=Math.min(_.count,o.start+o.count)-1;n<i;n+=c){const i=_.getX(n),r=_.getX(n+1);if(l.fromBufferAttribute(d,i),p.fromBufferAttribute(d,r),rx.distanceSqToSegment(l,p,h,u)>s)continue;h.applyMatrix4(this.matrixWorld);const o=e.ray.origin.distanceTo(h);o<e.near||o>e.far||t.push({distance:o,point:u.clone().applyMatrix4(this.matrixWorld),index:n,face:null,faceIndex:null,object:this})}else for(let n=Math.max(0,o.start),i=Math.min(d.count,o.start+o.count)-1;n<i;n+=c){if(l.fromBufferAttribute(d,n),p.fromBufferAttribute(d,n+1),rx.distanceSqToSegment(l,p,h,u)>s)continue;h.applyMatrix4(this.matrixWorld);const i=e.ray.origin.distanceTo(h);i<e.near||i>e.far||t.push({distance:i,point:u.clone().applyMatrix4(this.matrixWorld),index:n,face:null,faceIndex:null,object:this})}}updateMorphTargets(){const e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){const n=e[t[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,t=n.length;e<t;e++){const t=n[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[t]=e}}}}}const sx=new p_,lx=new p_;class px extends ax{constructor(e,t){super(e,t),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(null===e.index){const t=e.attributes.position,n=[];for(let e=0,i=t.count;e<i;e+=2)sx.fromBufferAttribute(t,e),lx.fromBufferAttribute(t,e+1),n[e]=0===e?0:n[e-1],n[e+1]=n[e]+sx.distanceTo(lx);e.setAttribute("lineDistance",new Ad(n,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class ux extends Rd{constructor(e=[],t=[],n=1,i=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:n,detail:i};const r=[],o=[];function a(e,t,n,i){const r=i+1,o=[];for(let i=0;i<=r;i++){o[i]=[];const a=e.clone().lerp(n,i/r),s=t.clone().lerp(n,i/r),l=r-i;for(let e=0;e<=l;e++)o[i][e]=0===e&&i===r?a:a.clone().lerp(s,e/l)}for(let e=0;e<r;e++)for(let t=0;t<2*(r-e)-1;t++){const n=Math.floor(t/2);t%2==0?(s(o[e][n+1]),s(o[e+1][n]),s(o[e][n])):(s(o[e][n+1]),s(o[e+1][n+1]),s(o[e+1][n]))}}function s(e){r.push(e.x,e.y,e.z)}function l(t,n){const i=3*t;n.x=e[i+0],n.y=e[i+1],n.z=e[i+2]}function p(e,t,n,i){i<0&&1===e.x&&(o[t]=e.x-1),0===n.x&&0===n.z&&(o[t]=i/2/Math.PI+.5)}function u(e){return Math.atan2(e.z,-e.x)}!function(e){const n=new p_,i=new p_,r=new p_;for(let o=0;o<t.length;o+=3)l(t[o+0],n),l(t[o+1],i),l(t[o+2],r),a(n,i,r,e)}(i),function(e){const t=new p_;for(let n=0;n<r.length;n+=3)t.x=r[n+0],t.y=r[n+1],t.z=r[n+2],t.normalize().multiplyScalar(e),r[n+0]=t.x,r[n+1]=t.y,r[n+2]=t.z}(n),function(){const e=new p_;for(let n=0;n<r.length;n+=3){e.x=r[n+0],e.y=r[n+1],e.z=r[n+2];const i=u(e)/2/Math.PI+.5,a=(t=e,Math.atan2(-t.y,Math.sqrt(t.x*t.x+t.z*t.z))/Math.PI+.5);o.push(i,1-a)}var t;(function(){const e=new p_,t=new p_,n=new p_,i=new p_,a=new Oc,s=new Oc,l=new Oc;for(let h=0,c=0;h<r.length;h+=9,c+=6){e.set(r[h+0],r[h+1],r[h+2]),t.set(r[h+3],r[h+4],r[h+5]),n.set(r[h+6],r[h+7],r[h+8]),a.set(o[c+0],o[c+1]),s.set(o[c+2],o[c+3]),l.set(o[c+4],o[c+5]),i.copy(e).add(t).add(n).divideScalar(3);const _=u(i);p(a,c+0,e,_),p(s,c+2,t,_),p(l,c+4,n,_)}})(),function(){for(let e=0;e<o.length;e+=6){const t=o[e+0],n=o[e+2],i=o[e+4],r=Math.max(t,n,i),a=Math.min(t,n,i);r>.9&&a<.1&&(t<.2&&(o[e+0]+=1),n<.2&&(o[e+2]+=1),i<.2&&(o[e+4]+=1))}}()}(),this.setAttribute("position",new Ad(r,3)),this.setAttribute("normal",new Ad(r.slice(),3)),this.setAttribute("uv",new Ad(o,2)),0===i?this.computeVertexNormals():this.normalizeNormals()}static fromJSON(e){return new ux(e.vertices,e.indices,e.radius,e.details)}}class hx extends ux{constructor(e=1,t=0){const n=(1+Math.sqrt(5))/2;super([-1,n,0,1,n,0,-1,-n,0,1,-n,0,0,-1,n,0,1,n,0,-1,-n,0,1,-n,n,0,-1,n,0,1,-n,0,-1,-n,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],e,t),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new hx(e.radius,e.detail)}}class cx extends Rd{constructor(e=1,t=32,n=16,i=0,r=2*Math.PI,o=0,a=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:n,phiStart:i,phiLength:r,thetaStart:o,thetaLength:a},t=Math.max(3,Math.floor(t)),n=Math.max(2,Math.floor(n));const s=Math.min(o+a,Math.PI);let l=0;const p=[],u=new p_,h=new p_,c=[],_=[],d=[],m=[];for(let c=0;c<=n;c++){const P=[],f=c/n;let x=0;0==c&&0==o?x=.5/t:c==n&&s==Math.PI&&(x=-.5/t);for(let n=0;n<=t;n++){const s=n/t;u.x=-e*Math.cos(i+s*r)*Math.sin(o+f*a),u.y=e*Math.cos(o+f*a),u.z=e*Math.sin(i+s*r)*Math.sin(o+f*a),_.push(u.x,u.y,u.z),h.copy(u).normalize(),d.push(h.x,h.y,h.z),m.push(s+x,1-f),P.push(l++)}p.push(P)}for(let e=0;e<n;e++)for(let i=0;i<t;i++){const t=p[e][i+1],r=p[e][i],a=p[e+1][i],l=p[e+1][i+1];(0!==e||o>0)&&c.push(t,r,l),(e!==n-1||s<Math.PI)&&c.push(r,a,l)}this.setIndex(c),this.setAttribute("position",new Ad(_,3)),this.setAttribute("normal",new Ad(d,3)),this.setAttribute("uv",new Ad(m,2))}static fromJSON(e){return new cx(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}class _x extends wd{constructor(e){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new Kc(16777215),this.specular=new Kc(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Kc(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new Oc(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class dx extends wd{constructor(e){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new Kc(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Kc(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new Oc(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}function mx(e,t,n){return fx(e)?new e.constructor(e.subarray(t,void 0!==n?n:e.length)):e.slice(t,n)}function Px(e,t,n){return!e||!n&&e.constructor===t?e:"number"==typeof t.BYTES_PER_ELEMENT?new t(e):Array.prototype.slice.call(e)}function fx(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function xx(e){const t=e.length,n=new Array(t);for(let e=0;e!==t;++e)n[e]=e;return n.sort((function(t,n){return e[t]-e[n]})),n}function yx(e,t,n){const i=e.length,r=new e.constructor(i);for(let o=0,a=0;a!==i;++o){const i=n[o]*t;for(let n=0;n!==t;++n)r[a++]=e[i+n]}return r}function vx(e,t,n,i){let r=1,o=e[0];for(;void 0!==o&&void 0===o[i];)o=e[r++];if(void 0===o)return;let a=o[i];if(void 0!==a)if(Array.isArray(a))do{a=o[i],void 0!==a&&(t.push(o.time),n.push.apply(n,a)),o=e[r++]}while(void 0!==o);else if(void 0!==a.toArray)do{a=o[i],void 0!==a&&(t.push(o.time),a.toArray(n,n.length)),o=e[r++]}while(void 0!==o);else do{a=o[i],void 0!==a&&(t.push(o.time),n.push(a)),o=e[r++]}while(void 0!==o)}class gx{constructor(e,t,n,i){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=void 0!==i?i:new t.constructor(n),this.sampleValues=t,this.valueSize=n,this.settings=null,this.DefaultSettings_={}}evaluate(e){const t=this.parameterPositions;let n=this._cachedIndex,i=t[n],r=t[n-1];e:{t:{let o;n:{i:if(!(e<i)){for(let o=n+2;;){if(void 0===i){if(e<r)break i;return n=t.length,this._cachedIndex=n,this.copySampleValue_(n-1)}if(n===o)break;if(r=i,i=t[++n],e<i)break t}o=t.length;break n}if(e>=r)break e;{const a=t[1];e<a&&(n=2,r=a);for(let o=n-2;;){if(void 0===r)return this._cachedIndex=0,this.copySampleValue_(0);if(n===o)break;if(i=r,r=t[--n-1],e>=r)break t}o=n,n=0}}for(;n<o;){const i=n+o>>>1;e<t[i]?o=i:n=i+1}if(i=t[n],r=t[n-1],void 0===r)return this._cachedIndex=0,this.copySampleValue_(0);if(void 0===i)return n=t.length,this._cachedIndex=n,this.copySampleValue_(n-1)}this._cachedIndex=n,this.intervalChanged_(n,r,i)}return this.interpolate_(n,r,e,i)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const t=this.resultBuffer,n=this.sampleValues,i=this.valueSize,r=e*i;for(let e=0;e!==i;++e)t[e]=n[r+e];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class bx extends gx{constructor(e,t,n,i){super(e,t,n,i),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:dc,endingEnd:dc}}intervalChanged_(e,t,n){const i=this.parameterPositions;let r=e-2,o=e+1,a=i[r],s=i[o];if(void 0===a)switch(this.getSettings_().endingStart){case mc:r=e,a=2*t-n;break;case Pc:r=i.length-2,a=t+i[r]-i[r+1];break;default:r=e,a=n}if(void 0===s)switch(this.getSettings_().endingEnd){case mc:o=e,s=2*n-t;break;case Pc:o=1,s=n+i[1]-i[0];break;default:o=e-1,s=t}const l=.5*(n-t),p=this.valueSize;this._weightPrev=l/(t-a),this._weightNext=l/(s-n),this._offsetPrev=r*p,this._offsetNext=o*p}interpolate_(e,t,n,i){const r=this.resultBuffer,o=this.sampleValues,a=this.valueSize,s=e*a,l=s-a,p=this._offsetPrev,u=this._offsetNext,h=this._weightPrev,c=this._weightNext,_=(n-t)/(i-t),d=_*_,m=d*_,P=-h*m+2*h*d-h*_,f=(1+h)*m+(-1.5-2*h)*d+(-.5+h)*_+1,x=(-1-c)*m+(1.5+c)*d+.5*_,y=c*m-c*d;for(let e=0;e!==a;++e)r[e]=P*o[p+e]+f*o[l+e]+x*o[s+e]+y*o[u+e];return r}}class zx extends gx{constructor(e,t,n,i){super(e,t,n,i)}interpolate_(e,t,n,i){const r=this.resultBuffer,o=this.sampleValues,a=this.valueSize,s=e*a,l=s-a,p=(n-t)/(i-t),u=1-p;for(let e=0;e!==a;++e)r[e]=o[l+e]*u+o[s+e]*p;return r}}class wx extends gx{constructor(e,t,n,i){super(e,t,n,i)}interpolate_(e){return this.copySampleValue_(e-1)}}class Zx{constructor(e,t,n,i){if(void 0===e)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===t||0===t.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=Px(t,this.TimeBufferType),this.values=Px(n,this.ValueBufferType),this.setInterpolation(i||this.DefaultInterpolation)}static toJSON(e){const t=e.constructor;let n;if(t.toJSON!==this.toJSON)n=t.toJSON(e);else{n={name:e.name,times:Px(e.times,Array),values:Px(e.values,Array)};const t=e.getInterpolation();t!==e.DefaultInterpolation&&(n.interpolation=t)}return n.type=e.ValueTypeName,n}InterpolantFactoryMethodDiscrete(e){return new wx(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new zx(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new bx(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case hc:t=this.InterpolantFactoryMethodDiscrete;break;case cc:t=this.InterpolantFactoryMethodLinear;break;case _c:t=this.InterpolantFactoryMethodSmooth}if(void 0===t){const t="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(e===this.DefaultInterpolation)throw new Error(t);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",t),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return hc;case this.InterpolantFactoryMethodLinear:return cc;case this.InterpolantFactoryMethodSmooth:return _c}}getValueSize(){return this.values.length/this.times.length}shift(e){if(0!==e){const t=this.times;for(let n=0,i=t.length;n!==i;++n)t[n]+=e}return this}scale(e){if(1!==e){const t=this.times;for(let n=0,i=t.length;n!==i;++n)t[n]*=e}return this}trim(e,t){const n=this.times,i=n.length;let r=0,o=i-1;for(;r!==i&&n[r]<e;)++r;for(;-1!==o&&n[o]>t;)--o;if(++o,0!==r||o!==i){r>=o&&(o=Math.max(o,1),r=o-1);const e=this.getValueSize();this.times=mx(n,r,o),this.values=mx(this.values,r*e,o*e)}return this}validate(){let e=!0;const t=this.getValueSize();t-Math.floor(t)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);const n=this.times,i=this.values,r=n.length;0===r&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let o=null;for(let t=0;t!==r;t++){const i=n[t];if("number"==typeof i&&isNaN(i)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,t,i),e=!1;break}if(null!==o&&o>i){console.error("THREE.KeyframeTrack: Out of order keys.",this,t,i,o),e=!1;break}o=i}if(void 0!==i&&fx(i))for(let t=0,n=i.length;t!==n;++t){const n=i[t];if(isNaN(n)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,t,n),e=!1;break}}return e}optimize(){const e=mx(this.times),t=mx(this.values),n=this.getValueSize(),i=this.getInterpolation()===_c,r=e.length-1;let o=1;for(let a=1;a<r;++a){let r=!1;const s=e[a];if(s!==e[a+1]&&(1!==a||s!==e[0]))if(i)r=!0;else{const e=a*n,i=e-n,o=e+n;for(let a=0;a!==n;++a){const n=t[e+a];if(n!==t[i+a]||n!==t[o+a]){r=!0;break}}}if(r){if(a!==o){e[o]=e[a];const i=a*n,r=o*n;for(let e=0;e!==n;++e)t[r+e]=t[i+e]}++o}}if(r>0){e[o]=e[r];for(let e=r*n,i=o*n,a=0;a!==n;++a)t[i+a]=t[e+a];++o}return o!==e.length?(this.times=mx(e,0,o),this.values=mx(t,0,o*n)):(this.times=e,this.values=t),this}clone(){const e=mx(this.times,0),t=mx(this.values,0),n=new(0,this.constructor)(this.name,e,t);return n.createInterpolant=this.createInterpolant,n}}Zx.prototype.TimeBufferType=Float32Array,Zx.prototype.ValueBufferType=Float32Array,Zx.prototype.DefaultInterpolation=cc;class Ex extends Zx{}Ex.prototype.ValueTypeName="bool",Ex.prototype.ValueBufferType=Array,Ex.prototype.DefaultInterpolation=hc,Ex.prototype.InterpolantFactoryMethodLinear=void 0,Ex.prototype.InterpolantFactoryMethodSmooth=void 0;class Mx extends Zx{}Mx.prototype.ValueTypeName="color";class Sx extends Zx{}Sx.prototype.ValueTypeName="number";class Cx extends gx{constructor(e,t,n,i){super(e,t,n,i)}interpolate_(e,t,n,i){const r=this.resultBuffer,o=this.sampleValues,a=this.valueSize,s=(n-t)/(i-t);let l=e*a;for(let e=l+a;l!==e;l+=4)l_.slerpFlat(r,0,o,l-a,o,l,s);return r}}class Nx extends Zx{InterpolantFactoryMethodLinear(e){return new Cx(this.times,this.values,this.getValueSize(),e)}}Nx.prototype.ValueTypeName="quaternion",Nx.prototype.DefaultInterpolation=cc,Nx.prototype.InterpolantFactoryMethodSmooth=void 0;class Ax extends Zx{}Ax.prototype.ValueTypeName="string",Ax.prototype.ValueBufferType=Array,Ax.prototype.DefaultInterpolation=hc,Ax.prototype.InterpolantFactoryMethodLinear=void 0,Ax.prototype.InterpolantFactoryMethodSmooth=void 0;class Lx extends Zx{}Lx.prototype.ValueTypeName="vector";class Bx{constructor(e,t=-1,n,i=2500){this.name=e,this.tracks=n,this.duration=t,this.blendMode=i,this.uuid=Cc(),this.duration<0&&this.resetDuration()}static parse(e){const t=[],n=e.tracks,i=1/(e.fps||1);for(let e=0,r=n.length;e!==r;++e)t.push(Tx(n[e]).scale(i));const r=new this(e.name,e.duration,t,e.blendMode);return r.uuid=e.uuid,r}static toJSON(e){const t=[],n=e.tracks,i={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode};for(let e=0,i=n.length;e!==i;++e)t.push(Zx.toJSON(n[e]));return i}static CreateFromMorphTargetSequence(e,t,n,i){const r=t.length,o=[];for(let e=0;e<r;e++){let a=[],s=[];a.push((e+r-1)%r,e,(e+1)%r),s.push(0,1,0);const l=xx(a);a=yx(a,1,l),s=yx(s,1,l),i||0!==a[0]||(a.push(r),s.push(s[0])),o.push(new Sx(".morphTargetInfluences["+t[e].name+"]",a,s).scale(1/n))}return new this(e,-1,o)}static findByName(e,t){let n=e;if(!Array.isArray(e)){const t=e;n=t.geometry&&t.geometry.animations||t.animations}for(let e=0;e<n.length;e++)if(n[e].name===t)return n[e];return null}static CreateClipsFromMorphTargetSequences(e,t,n){const i={},r=/^([\w-]*?)([\d]+)$/;for(let t=0,n=e.length;t<n;t++){const n=e[t],o=n.name.match(r);if(o&&o.length>1){const e=o[1];let t=i[e];t||(i[e]=t=[]),t.push(n)}}const o=[];for(const e in i)o.push(this.CreateFromMorphTargetSequence(e,i[e],t,n));return o}static parseAnimation(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const n=function(e,t,n,i,r){if(0!==n.length){const o=[],a=[];vx(n,o,a,i),0!==o.length&&r.push(new e(t,o,a))}},i=[],r=e.name||"default",o=e.fps||30,a=e.blendMode;let s=e.length||-1;const l=e.hierarchy||[];for(let e=0;e<l.length;e++){const r=l[e].keys;if(r&&0!==r.length)if(r[0].morphTargets){const e={};let t;for(t=0;t<r.length;t++)if(r[t].morphTargets)for(let n=0;n<r[t].morphTargets.length;n++)e[r[t].morphTargets[n]]=-1;for(const n in e){const e=[],o=[];for(let i=0;i!==r[t].morphTargets.length;++i){const i=r[t];e.push(i.time),o.push(i.morphTarget===n?1:0)}i.push(new Sx(".morphTargetInfluence["+n+"]",e,o))}s=e.length*o}else{const o=".bones["+t[e].name+"]";n(Lx,o+".position",r,"pos",i),n(Nx,o+".quaternion",r,"rot",i),n(Lx,o+".scale",r,"scl",i)}}return 0===i.length?null:new this(r,s,i,a)}resetDuration(){let e=0;for(let t=0,n=this.tracks.length;t!==n;++t){const n=this.tracks[t];e=Math.max(e,n.times[n.times.length-1])}return this.duration=e,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){const e=[];for(let t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function Tx(e){if(void 0===e.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const t=function(e){switch(e.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return Sx;case"vector":case"vector2":case"vector3":case"vector4":return Lx;case"color":return Mx;case"quaternion":return Nx;case"bool":case"boolean":return Ex;case"string":return Ax}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+e)}(e.type);if(void 0===e.times){const t=[],n=[];vx(e.keys,t,n,"value"),e.times=t,e.values=n}return void 0!==t.parse?t.parse(e):new t(e.name,e.times,e.values,e.interpolation)}class Vx{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=kx(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const t=kx();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}function kx(){return("undefined"==typeof performance?Date:performance).now()}class Ix{constructor(e,t,n){let i,r,o;switch(this.binding=e,this.valueSize=n,t){case"quaternion":i=this._slerp,r=this._slerpAdditive,o=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*n),this._workIndex=5;break;case"string":case"bool":i=this._select,r=this._select,o=this._setAdditiveIdentityOther,this.buffer=new Array(5*n);break;default:i=this._lerp,r=this._lerpAdditive,o=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*n)}this._mixBufferRegion=i,this._mixBufferRegionAdditive=r,this._setIdentity=o,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(e,t){const n=this.buffer,i=this.valueSize,r=e*i+i;let o=this.cumulativeWeight;if(0===o){for(let e=0;e!==i;++e)n[r+e]=n[e];o=t}else{o+=t;const e=t/o;this._mixBufferRegion(n,r,0,e,i)}this.cumulativeWeight=o}accumulateAdditive(e){const t=this.buffer,n=this.valueSize,i=n*this._addIndex;0===this.cumulativeWeightAdditive&&this._setIdentity(),this._mixBufferRegionAdditive(t,i,0,e,n),this.cumulativeWeightAdditive+=e}apply(e){const t=this.valueSize,n=this.buffer,i=e*t+t,r=this.cumulativeWeight,o=this.cumulativeWeightAdditive,a=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,r<1){const e=t*this._origIndex;this._mixBufferRegion(n,i,e,1-r,t)}o>0&&this._mixBufferRegionAdditive(n,i,this._addIndex*t,1,t);for(let e=t,r=t+t;e!==r;++e)if(n[e]!==n[e+t]){a.setValue(n,i);break}}saveOriginalState(){const e=this.binding,t=this.buffer,n=this.valueSize,i=n*this._origIndex;e.getValue(t,i);for(let e=n,r=i;e!==r;++e)t[e]=t[i+e%n];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const e=3*this.valueSize;this.binding.setValue(this.buffer,e)}_setAdditiveIdentityNumeric(){const e=this._addIndex*this.valueSize,t=e+this.valueSize;for(let n=e;n<t;n++)this.buffer[n]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const e=this._origIndex*this.valueSize,t=this._addIndex*this.valueSize;for(let n=0;n<this.valueSize;n++)this.buffer[t+n]=this.buffer[e+n]}_select(e,t,n,i,r){if(i>=.5)for(let i=0;i!==r;++i)e[t+i]=e[n+i]}_slerp(e,t,n,i){l_.slerpFlat(e,t,e,t,e,n,i)}_slerpAdditive(e,t,n,i,r){const o=this._workIndex*r;l_.multiplyQuaternionsFlat(e,o,e,t,e,n),l_.slerpFlat(e,t,e,t,e,o,i)}_lerp(e,t,n,i,r){const o=1-i;for(let a=0;a!==r;++a){const r=t+a;e[r]=e[r]*o+e[n+a]*i}}_lerpAdditive(e,t,n,i,r){for(let o=0;o!==r;++o){const r=t+o;e[r]=e[r]+e[n+o]*i}}}const Ox=new RegExp("[\\[\\]\\.:\\/]","g"),Rx="[^\\[\\]\\.:\\/]",Hx="[^"+"\\[\\]\\.:\\/".replace("\\.","")+"]",Fx=new RegExp("^"+/((?:WC+[\/:])*)/.source.replace("WC",Rx)+/(WCOD+)?/.source.replace("WCOD",Hx)+/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",Rx)+/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",Rx)+"$"),Dx=["material","materials","bones","map"];class Gx{constructor(e,t,n){this.path=t,this.parsedPath=n||Gx.parseTrackName(t),this.node=Gx.findNode(e,this.parsedPath.nodeName)||e,this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,t,n){return e&&e.isAnimationObjectGroup?new Gx.Composite(e,t,n):new Gx(e,t,n)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(Ox,"")}static parseTrackName(e){const t=Fx.exec(e);if(null===t)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const n={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},i=n.nodeName&&n.nodeName.lastIndexOf(".");if(void 0!==i&&-1!==i){const e=n.nodeName.substring(i+1);-1!==Dx.indexOf(e)&&(n.nodeName=n.nodeName.substring(0,i),n.objectName=e)}if(null===n.propertyName||0===n.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return n}static findNode(e,t){if(void 0===t||""===t||"."===t||-1===t||t===e.name||t===e.uuid)return e;if(e.skeleton){const n=e.skeleton.getBoneByName(t);if(void 0!==n)return n}if(e.children){const n=function(e){for(let i=0;i<e.length;i++){const r=e[i];if(r.name===t||r.uuid===t)return r;const o=n(r.children);if(o)return o}return null},i=n(e.children);if(i)return i}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,t){e[t]=this.targetObject[this.propertyName]}_getValue_array(e,t){const n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)e[t++]=n[i]}_getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}_setValue_direct(e,t){this.targetObject[this.propertyName]=e[t]}_setValue_direct_setNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,t){const n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)n[i]=e[t++]}_setValue_array_setNeedsUpdate(e,t){const n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)n[i]=e[t++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,t){const n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)n[i]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}_setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)}_setValue_fromArray_setNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,t){this.bind(),this.getValue(e,t)}_setValue_unbound(e,t){this.bind(),this.setValue(e,t)}bind(){let e=this.node;const t=this.parsedPath,n=t.objectName,i=t.propertyName;let r=t.propertyIndex;if(e||(e=Gx.findNode(this.rootNode,t.nodeName)||this.rootNode,this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e)return void console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");if(n){let i=t.objectIndex;switch(n){case"materials":if(!e.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!e.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);e=e.material.materials;break;case"bones":if(!e.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);e=e.skeleton.bones;for(let t=0;t<e.length;t++)if(e[t].name===i){i=t;break}break;case"map":if(!e.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!e.material.map)return void console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);e=e.material.map;break;default:if(void 0===e[n])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);e=e[n]}if(void 0!==i){if(void 0===e[i])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);e=e[i]}}const o=e[i];if(void 0===o){const n=t.nodeName;return void console.error("THREE.PropertyBinding: Trying to update property for track: "+n+"."+i+" but it wasn't found.",e)}let a=this.Versioning.None;this.targetObject=e,void 0!==e.needsUpdate?a=this.Versioning.NeedsUpdate:void 0!==e.matrixWorldNeedsUpdate&&(a=this.Versioning.MatrixWorldNeedsUpdate);let s=this.BindingType.Direct;if(void 0!==r){if("morphTargetInfluences"===i){if(!e.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!e.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==e.morphTargetDictionary[r]&&(r=e.morphTargetDictionary[r])}s=this.BindingType.ArrayElement,this.resolvedProperty=o,this.propertyIndex=r}else void 0!==o.fromArray&&void 0!==o.toArray?(s=this.BindingType.HasFromToArray,this.resolvedProperty=o):Array.isArray(o)?(s=this.BindingType.EntireArray,this.resolvedProperty=o):this.propertyName=i;this.getValue=this.GetterByBindingType[s],this.setValue=this.SetterByBindingTypeAndVersioning[s][a]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}Gx.Composite=class{constructor(e,t,n){const i=n||Gx.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,i)}getValue(e,t){this.bind();const n=this._targetGroup.nCachedObjects_,i=this._bindings[n];void 0!==i&&i.getValue(e,t)}setValue(e,t){const n=this._bindings;for(let i=this._targetGroup.nCachedObjects_,r=n.length;i!==r;++i)n[i].setValue(e,t)}bind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].bind()}unbind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].unbind()}},Gx.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Gx.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},Gx.prototype.GetterByBindingType=[Gx.prototype._getValue_direct,Gx.prototype._getValue_array,Gx.prototype._getValue_arrayElement,Gx.prototype._getValue_toArray],Gx.prototype.SetterByBindingTypeAndVersioning=[[Gx.prototype._setValue_direct,Gx.prototype._setValue_direct_setNeedsUpdate,Gx.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[Gx.prototype._setValue_array,Gx.prototype._setValue_array_setNeedsUpdate,Gx.prototype._setValue_array_setMatrixWorldNeedsUpdate],[Gx.prototype._setValue_arrayElement,Gx.prototype._setValue_arrayElement_setNeedsUpdate,Gx.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[Gx.prototype._setValue_fromArray,Gx.prototype._setValue_fromArray_setNeedsUpdate,Gx.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class Ux{constructor(e,t,n=null,i=t.blendMode){this._mixer=e,this._clip=t,this._localRoot=n,this.blendMode=i;const r=t.tracks,o=r.length,a=new Array(o),s={endingStart:dc,endingEnd:dc};for(let e=0;e!==o;++e){const t=r[e].createInterpolant(null);a[e]=t,t.settings=s}this._interpolantSettings=s,this._interpolants=a,this._propertyBindings=new Array(o),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=2201,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(e){return this._startTime=e,this}setLoop(e,t){return this.loop=e,this.repetitions=t,this}setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}fadeOut(e){return this._scheduleFading(e,1,0)}crossFadeFrom(e,t,n){if(e.fadeOut(t),this.fadeIn(t),n){const n=this._clip.duration,i=e._clip.duration,r=i/n,o=n/i;e.warp(1,r,t),this.warp(o,1,t)}return this}crossFadeTo(e,t,n){return e.crossFadeFrom(this,t,n)}stopFading(){const e=this._weightInterpolant;return null!==e&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}halt(e){return this.warp(this._effectiveTimeScale,0,e)}warp(e,t,n){const i=this._mixer,r=i.time,o=this.timeScale;let a=this._timeScaleInterpolant;null===a&&(a=i._lendControlInterpolant(),this._timeScaleInterpolant=a);const s=a.parameterPositions,l=a.sampleValues;return s[0]=r,s[1]=r+n,l[0]=e/o,l[1]=t/o,this}stopWarping(){const e=this._timeScaleInterpolant;return null!==e&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(e,t,n,i){if(!this.enabled)return void this._updateWeight(e);const r=this._startTime;if(null!==r){const i=(e-r)*n;i<0||0===n?t=0:(this._startTime=null,t=n*i)}t*=this._updateTimeScale(e);const o=this._updateTime(t),a=this._updateWeight(e);if(a>0){const e=this._interpolants,t=this._propertyBindings;if(2501===this.blendMode)for(let n=0,i=e.length;n!==i;++n)e[n].evaluate(o),t[n].accumulateAdditive(a);else for(let n=0,r=e.length;n!==r;++n)e[n].evaluate(o),t[n].accumulate(i,a)}}_updateWeight(e){let t=0;if(this.enabled){t=this.weight;const n=this._weightInterpolant;if(null!==n){const i=n.evaluate(e)[0];t*=i,e>n.parameterPositions[1]&&(this.stopFading(),0===i&&(this.enabled=!1))}}return this._effectiveWeight=t,t}_updateTimeScale(e){let t=0;if(!this.paused){t=this.timeScale;const n=this._timeScaleInterpolant;null!==n&&(t*=n.evaluate(e)[0],e>n.parameterPositions[1]&&(this.stopWarping(),0===t?this.paused=!0:this.timeScale=t))}return this._effectiveTimeScale=t,t}_updateTime(e){const t=this._clip.duration,n=this.loop;let i=this.time+e,r=this._loopCount;const o=2202===n;if(0===e)return-1===r?i:o&&1==(1&r)?t-i:i;if(2200===n){-1===r&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(i>=t)i=t;else{if(!(i<0)){this.time=i;break e}i=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=i,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(-1===r&&(e>=0?(r=0,this._setEndings(!0,0===this.repetitions,o)):this._setEndings(0===this.repetitions,!0,o)),i>=t||i<0){const n=Math.floor(i/t);i-=t*n,r+=Math.abs(n);const a=this.repetitions-r;if(a<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,i=e>0?t:0,this.time=i,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(1===a){const t=e<0;this._setEndings(t,!t,o)}else this._setEndings(!1,!1,o);this._loopCount=r,this.time=i,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:n})}}else this.time=i;if(o&&1==(1&r))return t-i}return i}_setEndings(e,t,n){const i=this._interpolantSettings;n?(i.endingStart=mc,i.endingEnd=mc):(i.endingStart=e?this.zeroSlopeAtStart?mc:dc:Pc,i.endingEnd=t?this.zeroSlopeAtEnd?mc:dc:Pc)}_scheduleFading(e,t,n){const i=this._mixer,r=i.time;let o=this._weightInterpolant;null===o&&(o=i._lendControlInterpolant(),this._weightInterpolant=o);const a=o.parameterPositions,s=o.sampleValues;return a[0]=r,s[0]=t,a[1]=r+e,s[1]=n,this}}const jx=new Float32Array(1);class Wx extends wc{constructor(e){super(),this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(e,t){const n=e._localRoot||this._root,i=e._clip.tracks,r=i.length,o=e._propertyBindings,a=e._interpolants,s=n.uuid,l=this._bindingsByRootAndName;let p=l[s];void 0===p&&(p={},l[s]=p);for(let e=0;e!==r;++e){const r=i[e],l=r.name;let u=p[l];if(void 0!==u)++u.referenceCount,o[e]=u;else{if(u=o[e],void 0!==u){null===u._cacheIndex&&(++u.referenceCount,this._addInactiveBinding(u,s,l));continue}const i=t&&t._propertyBindings[e].binding.parsedPath;u=new Ix(Gx.create(n,l,i),r.ValueTypeName,r.getValueSize()),++u.referenceCount,this._addInactiveBinding(u,s,l),o[e]=u}a[e].resultBuffer=u.buffer}}_activateAction(e){if(!this._isActiveAction(e)){if(null===e._cacheIndex){const t=(e._localRoot||this._root).uuid,n=e._clip.uuid,i=this._actionsByClip[n];this._bindAction(e,i&&i.knownActions[0]),this._addInactiveAction(e,n,t)}const t=e._propertyBindings;for(let e=0,n=t.length;e!==n;++e){const n=t[e];0==n.useCount++&&(this._lendBinding(n),n.saveOriginalState())}this._lendAction(e)}}_deactivateAction(e){if(this._isActiveAction(e)){const t=e._propertyBindings;for(let e=0,n=t.length;e!==n;++e){const n=t[e];0==--n.useCount&&(n.restoreOriginalState(),this._takeBackBinding(n))}this._takeBackAction(e)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}_isActiveAction(e){const t=e._cacheIndex;return null!==t&&t<this._nActiveActions}_addInactiveAction(e,t,n){const i=this._actions,r=this._actionsByClip;let o=r[t];if(void 0===o)o={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,r[t]=o;else{const t=o.knownActions;e._byClipCacheIndex=t.length,t.push(e)}e._cacheIndex=i.length,i.push(e),o.actionByRoot[n]=e}_removeInactiveAction(e){const t=this._actions,n=t[t.length-1],i=e._cacheIndex;n._cacheIndex=i,t[i]=n,t.pop(),e._cacheIndex=null;const r=e._clip.uuid,o=this._actionsByClip,a=o[r],s=a.knownActions,l=s[s.length-1],p=e._byClipCacheIndex;l._byClipCacheIndex=p,s[p]=l,s.pop(),e._byClipCacheIndex=null,delete a.actionByRoot[(e._localRoot||this._root).uuid],0===s.length&&delete o[r],this._removeInactiveBindingsForAction(e)}_removeInactiveBindingsForAction(e){const t=e._propertyBindings;for(let e=0,n=t.length;e!==n;++e){const n=t[e];0==--n.referenceCount&&this._removeInactiveBinding(n)}}_lendAction(e){const t=this._actions,n=e._cacheIndex,i=this._nActiveActions++,r=t[i];e._cacheIndex=i,t[i]=e,r._cacheIndex=n,t[n]=r}_takeBackAction(e){const t=this._actions,n=e._cacheIndex,i=--this._nActiveActions,r=t[i];e._cacheIndex=i,t[i]=e,r._cacheIndex=n,t[n]=r}_addInactiveBinding(e,t,n){const i=this._bindingsByRootAndName,r=this._bindings;let o=i[t];void 0===o&&(o={},i[t]=o),o[n]=e,e._cacheIndex=r.length,r.push(e)}_removeInactiveBinding(e){const t=this._bindings,n=e.binding,i=n.rootNode.uuid,r=n.path,o=this._bindingsByRootAndName,a=o[i],s=t[t.length-1],l=e._cacheIndex;s._cacheIndex=l,t[l]=s,t.pop(),delete a[r],0===Object.keys(a).length&&delete o[i]}_lendBinding(e){const t=this._bindings,n=e._cacheIndex,i=this._nActiveBindings++,r=t[i];e._cacheIndex=i,t[i]=e,r._cacheIndex=n,t[n]=r}_takeBackBinding(e){const t=this._bindings,n=e._cacheIndex,i=--this._nActiveBindings,r=t[i];e._cacheIndex=i,t[i]=e,r._cacheIndex=n,t[n]=r}_lendControlInterpolant(){const e=this._controlInterpolants,t=this._nActiveControlInterpolants++;let n=e[t];return void 0===n&&(n=new zx(new Float32Array(2),new Float32Array(2),1,jx),n.__cacheIndex=t,e[t]=n),n}_takeBackControlInterpolant(e){const t=this._controlInterpolants,n=e.__cacheIndex,i=--this._nActiveControlInterpolants,r=t[i];e.__cacheIndex=i,t[i]=e,r.__cacheIndex=n,t[n]=r}clipAction(e,t,n){const i=t||this._root,r=i.uuid;let o="string"==typeof e?Bx.findByName(i,e):e;const a=null!==o?o.uuid:e,s=this._actionsByClip[a];let l=null;if(void 0===n&&(n=null!==o?o.blendMode:2500),void 0!==s){const e=s.actionByRoot[r];if(void 0!==e&&e.blendMode===n)return e;l=s.knownActions[0],null===o&&(o=l._clip)}if(null===o)return null;const p=new Ux(this,o,t,n);return this._bindAction(p,l),this._addInactiveAction(p,a,r),p}existingAction(e,t){const n=t||this._root,i=n.uuid,r="string"==typeof e?Bx.findByName(n,e):e,o=r?r.uuid:e,a=this._actionsByClip[o];return void 0!==a&&a.actionByRoot[i]||null}stopAllAction(){const e=this._actions;for(let t=this._nActiveActions-1;t>=0;--t)e[t].stop();return this}update(e){e*=this.timeScale;const t=this._actions,n=this._nActiveActions,i=this.time+=e,r=Math.sign(e),o=this._accuIndex^=1;for(let a=0;a!==n;++a)t[a]._update(i,e,r,o);const a=this._bindings,s=this._nActiveBindings;for(let e=0;e!==s;++e)a[e].apply(o);return this}setTime(e){this.time=0;for(let e=0;e<this._actions.length;e++)this._actions[e].time=0;return this.update(e)}getRoot(){return this._root}uncacheClip(e){const t=this._actions,n=e.uuid,i=this._actionsByClip,r=i[n];if(void 0!==r){const e=r.knownActions;for(let n=0,i=e.length;n!==i;++n){const i=e[n];this._deactivateAction(i);const r=i._cacheIndex,o=t[t.length-1];i._cacheIndex=null,i._byClipCacheIndex=null,o._cacheIndex=r,t[r]=o,t.pop(),this._removeInactiveBindingsForAction(i)}delete i[n]}}uncacheRoot(e){const t=e.uuid,n=this._actionsByClip;for(const e in n){const i=n[e].actionByRoot[t];void 0!==i&&(this._deactivateAction(i),this._removeInactiveAction(i))}const i=this._bindingsByRootAndName[t];if(void 0!==i)for(const e in i){const t=i[e];t.restoreOriginalState(),this._removeInactiveBinding(t)}}uncacheAction(e,t){const n=this.existingAction(e,t);null!==n&&(this._deactivateAction(n),this._removeInactiveAction(n))}}const qx=new p_,Jx=new p_;class $x{constructor(e=new p_,t=new p_){this.start=e,this.end=t}set(e,t){return this.start.copy(e),this.end.copy(t),this}copy(e){return this.start.copy(e.start),this.end.copy(e.end),this}getCenter(e){return e.addVectors(this.start,this.end).multiplyScalar(.5)}delta(e){return e.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(e,t){return this.delta(t).multiplyScalar(e).add(this.start)}closestPointToPointParameter(e,t){qx.subVectors(e,this.start),Jx.subVectors(this.end,this.start);const n=Jx.dot(Jx);let i=Jx.dot(qx)/n;return t&&(i=Nc(i,0,1)),i}closestPointToPoint(e,t,n){const i=this.closestPointToPointParameter(e,t);return this.delta(n).multiplyScalar(i).add(this.start)}applyMatrix4(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this}equals(e){return e.start.equals(this.start)&&e.end.equals(this.end)}clone(){return(new this.constructor).copy(this)}}class Xx extends px{constructor(e,t=16776960){const n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),i=new Rd;i.setIndex(new Sd(n,1)),i.setAttribute("position",new Ad([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),super(i,new ex({color:t,toneMapped:!1})),this.box=e,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(e){const t=this.box;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(e))}}class Yx extends px{constructor(e=1){const t=[0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e],n=new Rd;n.setAttribute("position",new Ad(t,3)),n.setAttribute("color",new Ad([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3)),super(n,new ex({vertexColors:!0,toneMapped:!1})),this.type="AxesHelper"}setColors(e,t,n){const i=new Kc,r=this.geometry.attributes.color.array;return i.set(e),i.toArray(r,0),i.toArray(r,3),i.set(t),i.toArray(r,6),i.toArray(r,9),i.set(n),i.toArray(r,12),i.toArray(r,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:"144"}})),"undefined"!=typeof window&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__="144");const Kx={NO_LIMIT:-1,CALL_1_PER_SECONDS:1e3,CALL_15_PER_SECONDS:1e3/15,CALL_30_PER_SECONDS:1e3/30,CALL_45_PER_SECONDS:1e3/45,CALL_60_PER_SECONDS:1e3/60,CALL_120_PER_SECONDS:1e3/120};let Qx={};const ey=(e,t,n={skippedProperties:[],applyToFirstObject:!1})=>{const i={};return Object.keys(e).forEach((r=>{n.skippedProperties&&n.skippedProperties.includes(r)||("object"==typeof e[r]&&e[r]&&t[r]&&!Array.isArray(e[r])?i[r]=ey(e[r],t[r],n):(i[r]=0===t[r]?0:!1!==t[r]&&(t[r]||e[r]),n.applyToFirstObject&&(e[r]=i[r])))})),i},ty=(e,t,n={skippedProperties:[],applyToFirstObject:!1})=>{const i={};return Array.from(new Set([...Object.keys(e||{}),...Object.keys(t||{})])).forEach((r=>{n.skippedProperties&&n.skippedProperties.includes(r)||("object"==typeof e[r]&&e[r]&&t[r]&&!Array.isArray(e[r])?i[r]=ty(e[r],t[r],n):(i[r]=0===t[r]?0:!1!==t[r]&&(t[r]||e[r]),n.applyToFirstObject&&(e[r]=i[r])))})),i},ny="MM:SS",iy="MM:SS.MS",ry=[{pattern:"HH",routine:({hours:e})=>String(e).padStart(2,"0")},{pattern:"MM",routine:({minutes:e})=>String(e).padStart(2,"0")},{pattern:"SS",routine:({seconds:e})=>String(e).padStart(2,"0")},{pattern:"MS",routine:({milliseconds:e})=>String(e).padStart(3,"0")}],oy=(e,t)=>{const n=Math.floor(e%1e3),i=Math.floor(e/1e3%60),r=Math.floor(Math.floor(e/1e3/60)%60),o={hours:Math.floor(Math.floor(e/1e3/60)/60%24),minutes:r,seconds:i,milliseconds:n};let a=t;return ry.forEach((({pattern:e,routine:t})=>a=a.replace(e,t(o)))),a};let ay=0;const sy=()=>ay++,ly=e=>{const t=[];let n={};const i=({id:e,config:i,create:r})=>{t.push({id:e,config:i,...r({...n,config:i,modules:t})})};return{init:t=>{n=t,e.forEach((e=>i(e)))},getModule:e=>"function"==typeof e?t.find(e):t.find((({id:t})=>t===e)),addModule:i,update:e=>t.forEach((t=>{if(t.update)if(t.config?.callLimit){const n=`@newkrok/reducer/${t.id}`,i=t.config?.forceCallCount&&t.config?.callLimit===Kx.NO_LIMIT?e.delta:t.config.callLimit/1e3;(({id:e,callback:t,callLimit:n,elapsed:i,callbackParam:r,forceCallCount:o=!1})=>{if(!i)return;Qx[e]||(Qx[e]={lastUpdate:-1,callCount:0});const a=()=>{r?t(r):t()};if(n!==Kx.NO_LIMIT)if(o){const t=Math.floor(i/(1e3*n));for(;-1===Qx[e].lastUpdate||t>Qx[e].callCount;)a(),Qx[e].lastUpdate+=n,Qx[e].callCount++;Qx[e].lastUpdate=i}else(-1===Qx[e].lastUpdate||i-Qx[e].lastUpdate>=n)&&(a(),Qx[e].lastUpdate=i);else a()})({id:n,callback:t.update,callbackParam:{...e,delta:i},callLimit:t.config.callLimit,forceCallCount:t.config.forceCallCount??!1,elapsed:1e3*e.elapsed})}else t.update(e)})),dispose:()=>t.forEach((e=>e.dispose?.()))}};var py=function(e,t,n){if(n||2===arguments.length)for(var i,r=0,o=t.length;r<o;r++)!i&&r in t||(i||(i=Array.prototype.slice.call(t,0,r)),i[r]=t[r]);return e.concat(i||Array.prototype.slice.call(t))},uy=function(e,t,n){this.name=e,this.version=t,this.os=n,this.type="browser"},hy=function(e){this.version=e,this.type="node",this.name="node",this.os=process.platform},cy=function(e,t,n,i){this.name=e,this.version=t,this.os=n,this.bot=i,this.type="bot-device"},_y=function(){this.type="bot",this.bot=!0,this.name="bot",this.version=null,this.os=null},dy=function(){this.type="react-native",this.name="react-native",this.version=null,this.os=null},my=/(nuhk|curl|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask\ Jeeves\/Teoma|ia_archiver)/,Py=[["aol",/AOLShield\/([0-9\._]+)/],["edge",/Edge\/([0-9\._]+)/],["edge-ios",/EdgiOS\/([0-9\._]+)/],["yandexbrowser",/YaBrowser\/([0-9\._]+)/],["kakaotalk",/KAKAOTALK\s([0-9\.]+)/],["samsung",/SamsungBrowser\/([0-9\.]+)/],["silk",/\bSilk\/([0-9._-]+)\b/],["miui",/MiuiBrowser\/([0-9\.]+)$/],["beaker",/BeakerBrowser\/([0-9\.]+)/],["edge-chromium",/EdgA?\/([0-9\.]+)/],["chromium-webview",/(?!Chrom.*OPR)wv\).*Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["phantomjs",/PhantomJS\/([0-9\.]+)(:?\s|$)/],["crios",/CriOS\/([0-9\.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["fxios",/FxiOS\/([0-9\.]+)/],["opera-mini",/Opera Mini.*Version\/([0-9\.]+)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["opera",/OPR\/([0-9\.]+)(:?\s|$)/],["pie",/^Microsoft Pocket Internet Explorer\/(\d+\.\d+)$/],["pie",/^Mozilla\/\d\.\d+\s\(compatible;\s(?:MSP?IE|MSInternet Explorer) (\d+\.\d+);.*Windows CE.*\)$/],["netfront",/^Mozilla\/\d\.\d+.*NetFront\/(\d.\d)/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/Version\/([0-9\._]+).*Mobile.*Safari.*/],["safari",/Version\/([0-9\._]+).*Safari/],["facebook",/FB[AS]V\/([0-9\.]+)/],["instagram",/Instagram\s([0-9\.]+)/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Mobile/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Gecko\)$/],["curl",/^curl\/([0-9\.]+)$/],["searchbot",/alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/]],fy=[["iOS",/iP(hone|od|ad)/],["Android OS",/Android/],["BlackBerry OS",/BlackBerry|BB10/],["Windows Mobile",/IEMobile/],["Amazon OS",/Kindle/],["Windows 3.11",/Win16/],["Windows 95",/(Windows 95)|(Win95)|(Windows_95)/],["Windows 98",/(Windows 98)|(Win98)/],["Windows 2000",/(Windows NT 5.0)|(Windows 2000)/],["Windows XP",/(Windows NT 5.1)|(Windows XP)/],["Windows Server 2003",/(Windows NT 5.2)/],["Windows Vista",/(Windows NT 6.0)/],["Windows 7",/(Windows NT 6.1)/],["Windows 8",/(Windows NT 6.2)/],["Windows 8.1",/(Windows NT 6.3)/],["Windows 10",/(Windows NT 10.0)/],["Windows ME",/Windows ME/],["Windows CE",/Windows CE|WinCE|Microsoft Pocket Internet Explorer/],["Open BSD",/OpenBSD/],["Sun OS",/SunOS/],["Chrome OS",/CrOS/],["Linux",/(Linux)|(X11)/],["Mac OS",/(Mac_PowerPC)|(Macintosh)/],["QNX",/QNX/],["BeOS",/BeOS/],["OS/2",/OS\/2/]];function xy(e){var t=function(e){return""!==e&&Py.reduce((function(t,n){var i=n[0],r=n[1];if(t)return t;var o=r.exec(e);return!!o&&[i,o]}),!1)}(e);if(!t)return null;var n=t[0],i=t[1];if("searchbot"===n)return new _y;var r=i[1]&&i[1].split(".").join("_").split("_").slice(0,3);r?r.length<3&&(r=py(py([],r,!0),function(e){for(var t=[],n=0;n<e;n++)t.push("0");return t}(3-r.length),!0)):r=[];var o=r.join("."),a=function(e){for(var t=0,n=fy.length;t<n;t++){var i=fy[t],r=i[0];if(i[1].exec(e))return r}return null}(e),s=my.exec(e);return s&&s[1]?new cy(n,o,a,s[1]):new uy(n,o,a)}const yy=()=>JSON.parse(JSON.stringify(vy)),vy={assetsConfig:{textures:[],fbxModels:[],fbxSkeletonAnimations:[],gltfModels:[],audio:[]},scene:{background:0},fog:null,skybox:{size:200,textures:[]},renderer:{antialias:!0,pixelRatio:1,clearColor:0,clearColorOpacity:1,outputEncoding:xc,physicallyCorrectLights:!1,toneMapping:4,toneMappingExposure:1,shadowMap:{enabled:!0,type:3}},entities:[],modules:[],staticModels:[],onProgress:null,onLoaded:null},gy=({target:e,worldConfig:t})=>{const n=ey(vy,t),i=new Vx;let r=[];const o=[],a=[],s=[],l=[],p=[];let u=new hm;const h={isPaused:!1,now:Date.now(),delta:0,elapsed:0,startTime:0},c=function(e){return e?xy(e):"undefined"==typeof document&&"undefined"!=typeof navigator&&"ReactNative"===navigator.product?new dy:"undefined"!=typeof navigator?xy(navigator.userAgent):"undefined"!=typeof process&&process.version?new hy(process.version.slice(1)):null}(),_=new Qf;_.background=new Kc(_.background);const d=ly(n.modules),m=new Kf({antialias:n.renderer.antialias});m.setPixelRatio(n.renderer.pixelRatio),m.setSize(window.innerWidth,window.innerHeight),m.setClearColor(n.renderer.clearColor,n.renderer.clearColorOpacity),m.outputEncoding=n.renderer.outputEncoding,m.physicallyCorrectLights=n.renderer.physicallyCorrectLights,m.toneMapping=n.renderer.toneMapping,m.toneMappingExposure=n.renderer.toneMappingExposure,m.shadowMap.enabled=n.renderer.shadowMap.enabled,m.shadowMap.type=n.renderer.shadowMap.type,e.appendChild(m.domElement),_.fog=n.fog,("function"==typeof n.entities?n.entities():n.entities).forEach((e=>_.add(e)));const P=()=>{h.isPaused||(h.startTime||(h.now=h.startTime=Date.now()),h.delta=Math.min(.05,i.getDelta()),h.elapsed+=1e3*h.delta,h.now=h.startTime+h.elapsed,d.update(h)),r.forEach((e=>e(h))),m.render(_,u),requestAnimationFrame(P)},f=()=>{u.aspect=window.innerWidth/window.innerHeight,u.updateProjectionMatrix(),m.setSize(window.innerWidth,window.innerHeight)};window.addEventListener("resize",f);const x=()=>{h.isPaused||(h.isPaused=!0,h.pauseStartTime=Date.now(),s.forEach((e=>e())))},y=()=>{h.isPaused&&(h.isPaused=!1,l.forEach((e=>e())))},v=()=>{document.hidden&&x()};document.addEventListener("visibilitychange",v);const g=new Promise(((e,i)=>{try{const{assetsConfig:i}=n,g=Object.keys(i).reduce(((e,t)=>(e[t]=[..."safari"!==c.name&&!c.os.toLowerCase().includes("ios")||"audio"!==t?i[t]:i[t].map((e=>({...e,url:e.url.replace(".ogg",".aac")})))],e)),{});Dh({...g,onProgress:n.onProgress}).then((()=>{const i={renderer:m,camera:u,scene:_,cycleData:h,pause:x,resume:y,setCamera:e=>u=e,getModule:d.getModule,addModule:d.addModule,dispose:()=>{window.removeEventListener("resize",f),window.removeEventListener("visibilitychange",v),Object.entries(Ih).forEach((([e,t])=>{t.dispose(),delete Ih[e]})),Object.entries(Lh).forEach((([e,t])=>{Ah(t),delete Lh[e]})),Object.entries(Vh).forEach((([e,t])=>{Ah(t.scene),delete Vh[e]})),Ah(_),d.dispose(),(m.info.memory.geometries||m.info.memory.textures)&&console.warn(`There is a memory leak in the app! Details: ${JSON.stringify(m.info)}`),m.dispose(),p.forEach((e=>e()))},getStaticModel:e=>("function"==typeof e?o.find(e):o.find((t=>t.id===e))).model,on:{update:e=>r.push(e),pause:e=>s.push(e),resume:e=>l.push(e),dispose:e=>p.push(e)},off:{update:e=>r.filter((t=>t!==e)),pause:e=>s=s.filter((t=>t!==e)),resume:e=>l=l.filter((t=>t!==e)),dispose:e=>p=p.filter((t=>t!==e))},userData:{}};d.init({world:i}),by({world:i,staticModels:o,destroyables:a,worldConfig:t}),n.onLoaded&&n.onLoaded(i),e(i),setTimeout(P,1)}))}catch(e){}}));return g},by=({world:e,staticModels:t,worldConfig:n})=>{const{scene:i}=e;if(n.skybox.textures.length>0){const e=n.skybox.textures.map((e=>new Zd({map:Oh(e),side:1}))),t=new om(n.skybox.size,n.skybox.size,n.skybox.size),r=new im(t,e);i.add(r)}n.staticModels.forEach((({id:e,modelId:n,position:r,rotation:o})=>{const a=kh(n);r&&a.scene.position.copy(r),o&&a.scene.rotation.set(o.x,o.y,o.z),i.add(a.scene),t.push({id:e,model:a})}))},zy="srgb",wy="srgb-linear",Zy=7680;class Ey{addEventListener(e,t){void 0===this._listeners&&(this._listeners={});const n=this._listeners;void 0===n[e]&&(n[e]=[]),-1===n[e].indexOf(t)&&n[e].push(t)}hasEventListener(e,t){if(void 0===this._listeners)return!1;const n=this._listeners;return void 0!==n[e]&&-1!==n[e].indexOf(t)}removeEventListener(e,t){if(void 0===this._listeners)return;const n=this._listeners[e];if(void 0!==n){const e=n.indexOf(t);-1!==e&&n.splice(e,1)}}dispatchEvent(e){if(void 0===this._listeners)return;const t=this._listeners[e.type];if(void 0!==t){e.target=this;const n=t.slice(0);for(let t=0,i=n.length;t<i;t++)n[t].call(this,e);e.target=null}}}const My=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];function Sy(){const e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,n=4294967295*Math.random()|0,i=4294967295*Math.random()|0;return(My[255&e]+My[e>>8&255]+My[e>>16&255]+My[e>>24&255]+"-"+My[255&t]+My[t>>8&255]+"-"+My[t>>16&15|64]+My[t>>24&255]+"-"+My[63&n|128]+My[n>>8&255]+"-"+My[n>>16&255]+My[n>>24&255]+My[255&i]+My[i>>8&255]+My[i>>16&255]+My[i>>24&255]).toLowerCase()}function Cy(e,t,n){return Math.max(t,Math.min(n,e))}function Ny(e,t,n){return(1-n)*e+n*t}function Ay(e,t){switch(t.constructor){case Float32Array:return e;case Uint16Array:return e/65535;case Uint8Array:return e/255;case Int16Array:return Math.max(e/32767,-1);case Int8Array:return Math.max(e/127,-1);default:throw new Error("Invalid component type.")}}function Ly(e,t){switch(t.constructor){case Float32Array:return e;case Uint16Array:return Math.round(65535*e);case Uint8Array:return Math.round(255*e);case Int16Array:return Math.round(32767*e);case Int8Array:return Math.round(127*e);default:throw new Error("Invalid component type.")}}class By{constructor(e=0,t=0){By.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,n=this.y,i=e.elements;return this.x=i[0]*t+i[3]*n+i[6],this.y=i[1]*t+i[4]*n+i[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y;return t*t+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const n=Math.cos(t),i=Math.sin(t),r=this.x-e.x,o=this.y-e.y;return this.x=r*n-o*i+e.x,this.y=r*i+o*n+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class Ty{constructor(){Ty.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1]}set(e,t,n,i,r,o,a,s,l){const p=this.elements;return p[0]=e,p[1]=i,p[2]=a,p[3]=t,p[4]=r,p[5]=s,p[6]=n,p[7]=o,p[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],this}extractBasis(e,t,n){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,i=t.elements,r=this.elements,o=n[0],a=n[3],s=n[6],l=n[1],p=n[4],u=n[7],h=n[2],c=n[5],_=n[8],d=i[0],m=i[3],P=i[6],f=i[1],x=i[4],y=i[7],v=i[2],g=i[5],b=i[8];return r[0]=o*d+a*f+s*v,r[3]=o*m+a*x+s*g,r[6]=o*P+a*y+s*b,r[1]=l*d+p*f+u*v,r[4]=l*m+p*x+u*g,r[7]=l*P+p*y+u*b,r[2]=h*d+c*f+_*v,r[5]=h*m+c*x+_*g,r[8]=h*P+c*y+_*b,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[1],i=e[2],r=e[3],o=e[4],a=e[5],s=e[6],l=e[7],p=e[8];return t*o*p-t*a*l-n*r*p+n*a*s+i*r*l-i*o*s}invert(){const e=this.elements,t=e[0],n=e[1],i=e[2],r=e[3],o=e[4],a=e[5],s=e[6],l=e[7],p=e[8],u=p*o-a*l,h=a*s-p*r,c=l*r-o*s,_=t*u+n*h+i*c;if(0===_)return this.set(0,0,0,0,0,0,0,0,0);const d=1/_;return e[0]=u*d,e[1]=(i*l-p*n)*d,e[2]=(a*n-i*o)*d,e[3]=h*d,e[4]=(p*t-i*s)*d,e[5]=(i*r-a*t)*d,e[6]=c*d,e[7]=(n*s-l*t)*d,e[8]=(o*t-n*r)*d,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,n,i,r,o,a){const s=Math.cos(r),l=Math.sin(r);return this.set(n*s,n*l,-n*(s*o+l*a)+o+e,-i*l,i*s,-i*(-l*o+s*a)+a+t,0,0,1),this}scale(e,t){const n=this.elements;return n[0]*=e,n[3]*=e,n[6]*=e,n[1]*=t,n[4]*=t,n[7]*=t,this}rotate(e){const t=Math.cos(e),n=Math.sin(e),i=this.elements,r=i[0],o=i[3],a=i[6],s=i[1],l=i[4],p=i[7];return i[0]=t*r+n*s,i[3]=t*o+n*l,i[6]=t*a+n*p,i[1]=-n*r+t*s,i[4]=-n*o+t*l,i[7]=-n*a+t*p,this}translate(e,t){const n=this.elements;return n[0]+=e*n[2],n[3]+=e*n[5],n[6]+=e*n[8],n[1]+=t*n[2],n[4]+=t*n[5],n[7]+=t*n[8],this}equals(e){const t=this.elements,n=e.elements;for(let e=0;e<9;e++)if(t[e]!==n[e])return!1;return!0}fromArray(e,t=0){for(let n=0;n<9;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e}clone(){return(new this.constructor).fromArray(this.elements)}}function Vy(e){return document.createElementNS("http://www.w3.org/1999/xhtml",e)}function ky(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}function Iy(e){return e<.0031308?12.92*e:1.055*Math.pow(e,.41666)-.055}const Oy={[zy]:{[wy]:ky},[wy]:{[zy]:Iy}},Ry={legacyMode:!0,get workingColorSpace(){return wy},set workingColorSpace(e){console.warn("THREE.ColorManagement: .workingColorSpace is readonly.")},convert:function(e,t,n){if(this.legacyMode||t===n||!t||!n)return e;if(Oy[t]&&void 0!==Oy[t][n]){const i=Oy[t][n];return e.r=i(e.r),e.g=i(e.g),e.b=i(e.b),e}throw new Error("Unsupported color space conversion.")},fromWorkingColorSpace:function(e,t){return this.convert(e,this.workingColorSpace,t)},toWorkingColorSpace:function(e,t){return this.convert(e,t,this.workingColorSpace)}},Hy={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Fy={r:0,g:0,b:0},Dy={h:0,s:0,l:0},Gy={h:0,s:0,l:0};function Uy(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+6*(t-e)*(2/3-n):e}function jy(e,t){return t.r=e.r,t.g=e.g,t.b=e.b,t}class Wy{constructor(e,t,n){return this.isColor=!0,this.r=1,this.g=1,this.b=1,void 0===t&&void 0===n?this.set(e):this.setRGB(e,t,n)}set(e){return e&&e.isColor?this.copy(e):"number"==typeof e?this.setHex(e):"string"==typeof e&&this.setStyle(e),this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t="srgb"){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,Ry.toWorkingColorSpace(this,t),this}setRGB(e,t,n,i="srgb-linear"){return this.r=e,this.g=t,this.b=n,Ry.toWorkingColorSpace(this,i),this}setHSL(e,t,n,i="srgb-linear"){if(e=(e%1+1)%1,t=Cy(t,0,1),n=Cy(n,0,1),0===t)this.r=this.g=this.b=n;else{const i=n<=.5?n*(1+t):n+t-n*t,r=2*n-i;this.r=Uy(r,i,e+1/3),this.g=Uy(r,i,e),this.b=Uy(r,i,e-1/3)}return Ry.toWorkingColorSpace(this,i),this}setStyle(e,t="srgb"){function n(t){void 0!==t&&parseFloat(t)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let i;if(i=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(e)){let e;const r=i[1],o=i[2];switch(r){case"rgb":case"rgba":if(e=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return this.r=Math.min(255,parseInt(e[1],10))/255,this.g=Math.min(255,parseInt(e[2],10))/255,this.b=Math.min(255,parseInt(e[3],10))/255,Ry.toWorkingColorSpace(this,t),n(e[4]),this;if(e=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return this.r=Math.min(100,parseInt(e[1],10))/100,this.g=Math.min(100,parseInt(e[2],10))/100,this.b=Math.min(100,parseInt(e[3],10))/100,Ry.toWorkingColorSpace(this,t),n(e[4]),this;break;case"hsl":case"hsla":if(e=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o)){const i=parseFloat(e[1])/360,r=parseFloat(e[2])/100,o=parseFloat(e[3])/100;return n(e[4]),this.setHSL(i,r,o,t)}}}else if(i=/^\#([A-Fa-f\d]+)$/.exec(e)){const e=i[1],n=e.length;if(3===n)return this.r=parseInt(e.charAt(0)+e.charAt(0),16)/255,this.g=parseInt(e.charAt(1)+e.charAt(1),16)/255,this.b=parseInt(e.charAt(2)+e.charAt(2),16)/255,Ry.toWorkingColorSpace(this,t),this;if(6===n)return this.r=parseInt(e.charAt(0)+e.charAt(1),16)/255,this.g=parseInt(e.charAt(2)+e.charAt(3),16)/255,this.b=parseInt(e.charAt(4)+e.charAt(5),16)/255,Ry.toWorkingColorSpace(this,t),this}return e&&e.length>0?this.setColorName(e,t):this}setColorName(e,t="srgb"){const n=Hy[e.toLowerCase()];return void 0!==n?this.setHex(n,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=ky(e.r),this.g=ky(e.g),this.b=ky(e.b),this}copyLinearToSRGB(e){return this.r=Iy(e.r),this.g=Iy(e.g),this.b=Iy(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e="srgb"){return Ry.fromWorkingColorSpace(jy(this,Fy),e),Cy(255*Fy.r,0,255)<<16^Cy(255*Fy.g,0,255)<<8^Cy(255*Fy.b,0,255)<<0}getHexString(e="srgb"){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t="srgb-linear"){Ry.fromWorkingColorSpace(jy(this,Fy),t);const n=Fy.r,i=Fy.g,r=Fy.b,o=Math.max(n,i,r),a=Math.min(n,i,r);let s,l;const p=(a+o)/2;if(a===o)s=0,l=0;else{const e=o-a;switch(l=p<=.5?e/(o+a):e/(2-o-a),o){case n:s=(i-r)/e+(i<r?6:0);break;case i:s=(r-n)/e+2;break;case r:s=(n-i)/e+4}s/=6}return e.h=s,e.s=l,e.l=p,e}getRGB(e,t="srgb-linear"){return Ry.fromWorkingColorSpace(jy(this,Fy),t),e.r=Fy.r,e.g=Fy.g,e.b=Fy.b,e}getStyle(e="srgb"){return Ry.fromWorkingColorSpace(jy(this,Fy),e),e!==zy?`color(${e} ${Fy.r} ${Fy.g} ${Fy.b})`:`rgb(${255*Fy.r|0},${255*Fy.g|0},${255*Fy.b|0})`}offsetHSL(e,t,n){return this.getHSL(Dy),Dy.h+=e,Dy.s+=t,Dy.l+=n,this.setHSL(Dy.h,Dy.s,Dy.l),this}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,n){return this.r=e.r+(t.r-e.r)*n,this.g=e.g+(t.g-e.g)*n,this.b=e.b+(t.b-e.b)*n,this}lerpHSL(e,t){this.getHSL(Dy),e.getHSL(Gy);const n=Ny(Dy.h,Gy.h,t),i=Ny(Dy.s,Gy.s,t),r=Ny(Dy.l,Gy.l,t);return this.setHSL(n,i,r),this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}let qy;Wy.NAMES=Hy;class Jy{constructor(e=null){this.isSource=!0,this.uuid=Sy(),this.data=e,this.version=0}set needsUpdate(e){!0===e&&this.version++}toJSON(e){const t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.images[this.uuid])return e.images[this.uuid];const n={uuid:this.uuid,url:""},i=this.data;if(null!==i){let e;if(Array.isArray(i)){e=[];for(let t=0,n=i.length;t<n;t++)i[t].isDataTexture?e.push($y(i[t].image)):e.push($y(i[t]))}else e=$y(i);n.url=e}return t||(e.images[this.uuid]=n),n}}function $y(e){return"undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap?class{static getDataURL(e){if(/^data:/i.test(e.src))return e.src;if("undefined"==typeof HTMLCanvasElement)return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{void 0===qy&&(qy=Vy("canvas")),qy.width=e.width,qy.height=e.height;const n=qy.getContext("2d");e instanceof ImageData?n.putImageData(e,0,0):n.drawImage(e,0,0,e.width,e.height),t=qy}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}static sRGBToLinear(e){if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap){const t=Vy("canvas");t.width=e.width,t.height=e.height;const n=t.getContext("2d");n.drawImage(e,0,0,e.width,e.height);const i=n.getImageData(0,0,e.width,e.height),r=i.data;for(let e=0;e<r.length;e++)r[e]=255*ky(r[e]/255);return n.putImageData(i,0,0),t}if(e.data){const t=e.data.slice(0);for(let e=0;e<t.length;e++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[e]=Math.floor(255*ky(t[e]/255)):t[e]=ky(t[e]);return{data:t,width:e.width,height:e.height}}return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}.getDataURL(e):e.data?{data:Array.from(e.data),width:e.width,height:e.height,type:e.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let Xy=0;class Yy extends Ey{constructor(e=Yy.DEFAULT_IMAGE,t=Yy.DEFAULT_MAPPING,n=1001,i=1001,r=1006,o=1008,a=1023,s=1009,l=1,p=3e3){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:Xy++}),this.uuid=Sy(),this.name="",this.source=new Jy(e),this.mipmaps=[],this.mapping=t,this.wrapS=n,this.wrapT=i,this.magFilter=r,this.minFilter=o,this.anisotropy=l,this.format=a,this.internalFormat=null,this.type=s,this.offset=new By(0,0),this.repeat=new By(1,1),this.center=new By(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Ty,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=p,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(e){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return(new this.constructor).copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){const t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.textures[this.uuid])return e.textures[this.uuid];const n={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return"{}"!==JSON.stringify(this.userData)&&(n.userData=this.userData),t||(e.textures[this.uuid]=n),n}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(300!==this.mapping)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case 1e3:e.x=e.x-Math.floor(e.x);break;case 1001:e.x=e.x<0?0:1;break;case 1002:1===Math.abs(Math.floor(e.x)%2)?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||e.y>1)switch(this.wrapT){case 1e3:e.y=e.y-Math.floor(e.y);break;case 1001:e.y=e.y<0?0:1;break;case 1002:1===Math.abs(Math.floor(e.y)%2)?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){!0===e&&(this.version++,this.source.needsUpdate=!0)}}Yy.DEFAULT_IMAGE=null,Yy.DEFAULT_MAPPING=300;class Ky{constructor(e=0,t=0,n=0,i=1){Ky.prototype.isVector4=!0,this.x=e,this.y=t,this.z=n,this.w=i}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,n,i){return this.x=e,this.y=t,this.z=n,this.w=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,n=this.y,i=this.z,r=this.w,o=e.elements;return this.x=o[0]*t+o[4]*n+o[8]*i+o[12]*r,this.y=o[1]*t+o[5]*n+o[9]*i+o[13]*r,this.z=o[2]*t+o[6]*n+o[10]*i+o[14]*r,this.w=o[3]*t+o[7]*n+o[11]*i+o[15]*r,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,n,i,r;const o=.01,a=.1,s=e.elements,l=s[0],p=s[4],u=s[8],h=s[1],c=s[5],_=s[9],d=s[2],m=s[6],P=s[10];if(Math.abs(p-h)<o&&Math.abs(u-d)<o&&Math.abs(_-m)<o){if(Math.abs(p+h)<a&&Math.abs(u+d)<a&&Math.abs(_+m)<a&&Math.abs(l+c+P-3)<a)return this.set(1,0,0,0),this;t=Math.PI;const e=(l+1)/2,s=(c+1)/2,f=(P+1)/2,x=(p+h)/4,y=(u+d)/4,v=(_+m)/4;return e>s&&e>f?e<o?(n=0,i=.707106781,r=.707106781):(n=Math.sqrt(e),i=x/n,r=y/n):s>f?s<o?(n=.707106781,i=0,r=.707106781):(i=Math.sqrt(s),n=x/i,r=v/i):f<o?(n=.707106781,i=.707106781,r=0):(r=Math.sqrt(f),n=y/r,i=v/r),this.set(n,i,r,t),this}let f=Math.sqrt((m-_)*(m-_)+(u-d)*(u-d)+(h-p)*(h-p));return Math.abs(f)<.001&&(f=1),this.x=(m-_)/f,this.y=(u-d)/f,this.z=(h-p)/f,this.w=Math.acos((l+c+P-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this.w=e.w+(t.w-e.w)*n,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class Qy{constructor(e=0,t=0,n=0,i=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=n,this._w=i}static slerpFlat(e,t,n,i,r,o,a){let s=n[i+0],l=n[i+1],p=n[i+2],u=n[i+3];const h=r[o+0],c=r[o+1],_=r[o+2],d=r[o+3];if(0===a)return e[t+0]=s,e[t+1]=l,e[t+2]=p,void(e[t+3]=u);if(1===a)return e[t+0]=h,e[t+1]=c,e[t+2]=_,void(e[t+3]=d);if(u!==d||s!==h||l!==c||p!==_){let e=1-a;const t=s*h+l*c+p*_+u*d,n=t>=0?1:-1,i=1-t*t;if(i>Number.EPSILON){const r=Math.sqrt(i),o=Math.atan2(r,t*n);e=Math.sin(e*o)/r,a=Math.sin(a*o)/r}const r=a*n;if(s=s*e+h*r,l=l*e+c*r,p=p*e+_*r,u=u*e+d*r,e===1-a){const e=1/Math.sqrt(s*s+l*l+p*p+u*u);s*=e,l*=e,p*=e,u*=e}}e[t]=s,e[t+1]=l,e[t+2]=p,e[t+3]=u}static multiplyQuaternionsFlat(e,t,n,i,r,o){const a=n[i],s=n[i+1],l=n[i+2],p=n[i+3],u=r[o],h=r[o+1],c=r[o+2],_=r[o+3];return e[t]=a*_+p*u+s*c-l*h,e[t+1]=s*_+p*h+l*u-a*c,e[t+2]=l*_+p*c+a*h-s*u,e[t+3]=p*_-a*u-s*h-l*c,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,n,i){return this._x=e,this._y=t,this._z=n,this._w=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t){const n=e._x,i=e._y,r=e._z,o=e._order,a=Math.cos,s=Math.sin,l=a(n/2),p=a(i/2),u=a(r/2),h=s(n/2),c=s(i/2),_=s(r/2);switch(o){case"XYZ":this._x=h*p*u+l*c*_,this._y=l*c*u-h*p*_,this._z=l*p*_+h*c*u,this._w=l*p*u-h*c*_;break;case"YXZ":this._x=h*p*u+l*c*_,this._y=l*c*u-h*p*_,this._z=l*p*_-h*c*u,this._w=l*p*u+h*c*_;break;case"ZXY":this._x=h*p*u-l*c*_,this._y=l*c*u+h*p*_,this._z=l*p*_+h*c*u,this._w=l*p*u-h*c*_;break;case"ZYX":this._x=h*p*u-l*c*_,this._y=l*c*u+h*p*_,this._z=l*p*_-h*c*u,this._w=l*p*u+h*c*_;break;case"YZX":this._x=h*p*u+l*c*_,this._y=l*c*u+h*p*_,this._z=l*p*_-h*c*u,this._w=l*p*u-h*c*_;break;case"XZY":this._x=h*p*u-l*c*_,this._y=l*c*u-h*p*_,this._z=l*p*_+h*c*u,this._w=l*p*u+h*c*_;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+o)}return!1!==t&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const n=t/2,i=Math.sin(n);return this._x=e.x*i,this._y=e.y*i,this._z=e.z*i,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,n=t[0],i=t[4],r=t[8],o=t[1],a=t[5],s=t[9],l=t[2],p=t[6],u=t[10],h=n+a+u;if(h>0){const e=.5/Math.sqrt(h+1);this._w=.25/e,this._x=(p-s)*e,this._y=(r-l)*e,this._z=(o-i)*e}else if(n>a&&n>u){const e=2*Math.sqrt(1+n-a-u);this._w=(p-s)/e,this._x=.25*e,this._y=(i+o)/e,this._z=(r+l)/e}else if(a>u){const e=2*Math.sqrt(1+a-n-u);this._w=(r-l)/e,this._x=(i+o)/e,this._y=.25*e,this._z=(s+p)/e}else{const e=2*Math.sqrt(1+u-n-a);this._w=(o-i)/e,this._x=(r+l)/e,this._y=(s+p)/e,this._z=.25*e}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let n=e.dot(t)+1;return n<Number.EPSILON?(n=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=n):(this._x=0,this._y=-e.z,this._z=e.y,this._w=n)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=n),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(Cy(this.dot(e),-1,1)))}rotateTowards(e,t){const n=this.angleTo(e);if(0===n)return this;const i=Math.min(1,t/n);return this.slerp(e,i),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const n=e._x,i=e._y,r=e._z,o=e._w,a=t._x,s=t._y,l=t._z,p=t._w;return this._x=n*p+o*a+i*l-r*s,this._y=i*p+o*s+r*a-n*l,this._z=r*p+o*l+n*s-i*a,this._w=o*p-n*a-i*s-r*l,this._onChangeCallback(),this}slerp(e,t){if(0===t)return this;if(1===t)return this.copy(e);const n=this._x,i=this._y,r=this._z,o=this._w;let a=o*e._w+n*e._x+i*e._y+r*e._z;if(a<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,a=-a):this.copy(e),a>=1)return this._w=o,this._x=n,this._y=i,this._z=r,this;const s=1-a*a;if(s<=Number.EPSILON){const e=1-t;return this._w=e*o+t*this._w,this._x=e*n+t*this._x,this._y=e*i+t*this._y,this._z=e*r+t*this._z,this.normalize(),this._onChangeCallback(),this}const l=Math.sqrt(s),p=Math.atan2(l,a),u=Math.sin((1-t)*p)/l,h=Math.sin(t*p)/l;return this._w=o*u+this._w*h,this._x=n*u+this._x*h,this._y=i*u+this._y*h,this._z=r*u+this._z*h,this._onChangeCallback(),this}slerpQuaternions(e,t,n){return this.copy(e).slerp(t,n)}random(){const e=Math.random(),t=Math.sqrt(1-e),n=Math.sqrt(e),i=2*Math.PI*Math.random(),r=2*Math.PI*Math.random();return this.set(t*Math.cos(i),n*Math.sin(r),n*Math.cos(r),t*Math.sin(i))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class ev{constructor(e=0,t=0,n=0){ev.prototype.isVector3=!0,this.x=e,this.y=t,this.z=n}set(e,t,n){return void 0===n&&(n=this.z),this.x=e,this.y=t,this.z=n,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(nv.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(nv.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,n=this.y,i=this.z,r=e.elements;return this.x=r[0]*t+r[3]*n+r[6]*i,this.y=r[1]*t+r[4]*n+r[7]*i,this.z=r[2]*t+r[5]*n+r[8]*i,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,n=this.y,i=this.z,r=e.elements,o=1/(r[3]*t+r[7]*n+r[11]*i+r[15]);return this.x=(r[0]*t+r[4]*n+r[8]*i+r[12])*o,this.y=(r[1]*t+r[5]*n+r[9]*i+r[13])*o,this.z=(r[2]*t+r[6]*n+r[10]*i+r[14])*o,this}applyQuaternion(e){const t=this.x,n=this.y,i=this.z,r=e.x,o=e.y,a=e.z,s=e.w,l=s*t+o*i-a*n,p=s*n+a*t-r*i,u=s*i+r*n-o*t,h=-r*t-o*n-a*i;return this.x=l*s+h*-r+p*-a-u*-o,this.y=p*s+h*-o+u*-r-l*-a,this.z=u*s+h*-a+l*-o-p*-r,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,n=this.y,i=this.z,r=e.elements;return this.x=r[0]*t+r[4]*n+r[8]*i,this.y=r[1]*t+r[5]*n+r[9]*i,this.z=r[2]*t+r[6]*n+r[10]*i,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const n=e.x,i=e.y,r=e.z,o=t.x,a=t.y,s=t.z;return this.x=i*s-r*a,this.y=r*o-n*s,this.z=n*a-i*o,this}projectOnVector(e){const t=e.lengthSq();if(0===t)return this.set(0,0,0);const n=e.dot(this)/t;return this.copy(e).multiplyScalar(n)}projectOnPlane(e){return tv.copy(this).projectOnVector(e),this.sub(tv)}reflect(e){return this.sub(tv.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(Cy(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y,i=this.z-e.z;return t*t+n*n+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,n){const i=Math.sin(t)*e;return this.x=i*Math.sin(n),this.y=Math.cos(t)*e,this.z=i*Math.cos(n),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,n){return this.x=e*Math.sin(t),this.y=n,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),i=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=n,this.z=i,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,4*t)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,3*t)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=2*(Math.random()-.5),t=Math.random()*Math.PI*2,n=Math.sqrt(1-e**2);return this.x=n*Math.cos(t),this.y=n*Math.sin(t),this.z=e,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const tv=new ev,nv=new Qy;class iv{constructor(e=new ev(1/0,1/0,1/0),t=new ev(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){let t=1/0,n=1/0,i=1/0,r=-1/0,o=-1/0,a=-1/0;for(let s=0,l=e.length;s<l;s+=3){const l=e[s],p=e[s+1],u=e[s+2];l<t&&(t=l),p<n&&(n=p),u<i&&(i=u),l>r&&(r=l),p>o&&(o=p),u>a&&(a=u)}return this.min.set(t,n,i),this.max.set(r,o,a),this}setFromBufferAttribute(e){let t=1/0,n=1/0,i=1/0,r=-1/0,o=-1/0,a=-1/0;for(let s=0,l=e.count;s<l;s++){const l=e.getX(s),p=e.getY(s),u=e.getZ(s);l<t&&(t=l),p<n&&(n=p),u<i&&(i=u),l>r&&(r=l),p>o&&(o=p),u>a&&(a=u)}return this.min.set(t,n,i),this.max.set(r,o,a),this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const n=ov.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return(new this.constructor).copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){e.updateWorldMatrix(!1,!1);const n=e.geometry;if(void 0!==n)if(t&&null!=n.attributes&&void 0!==n.attributes.position){const t=n.attributes.position;for(let n=0,i=t.count;n<i;n++)ov.fromBufferAttribute(t,n).applyMatrix4(e.matrixWorld),this.expandByPoint(ov)}else null===n.boundingBox&&n.computeBoundingBox(),av.copy(n.boundingBox),av.applyMatrix4(e.matrixWorld),this.union(av);const i=e.children;for(let e=0,n=i.length;e<n;e++)this.expandByObject(i[e],t);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,ov),ov.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,n;return e.normal.x>0?(t=e.normal.x*this.min.x,n=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,n=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,n+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,n+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,n+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,n+=e.normal.z*this.min.z),t<=-e.constant&&n>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(_v),dv.subVectors(this.max,_v),sv.subVectors(e.a,_v),lv.subVectors(e.b,_v),pv.subVectors(e.c,_v),uv.subVectors(lv,sv),hv.subVectors(pv,lv),cv.subVectors(sv,pv);let t=[0,-uv.z,uv.y,0,-hv.z,hv.y,0,-cv.z,cv.y,uv.z,0,-uv.x,hv.z,0,-hv.x,cv.z,0,-cv.x,-uv.y,uv.x,0,-hv.y,hv.x,0,-cv.y,cv.x,0];return!!fv(t,sv,lv,pv,dv)&&(t=[1,0,0,0,1,0,0,0,1],!!fv(t,sv,lv,pv,dv)&&(mv.crossVectors(uv,hv),t=[mv.x,mv.y,mv.z],fv(t,sv,lv,pv,dv)))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return ov.copy(e).clamp(this.min,this.max).sub(e).length()}getBoundingSphere(e){return this.getCenter(e.center),e.radius=.5*this.getSize(ov).length(),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()||(rv[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),rv[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),rv[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),rv[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),rv[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),rv[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),rv[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),rv[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(rv)),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const rv=[new ev,new ev,new ev,new ev,new ev,new ev,new ev,new ev],ov=new ev,av=new iv,sv=new ev,lv=new ev,pv=new ev,uv=new ev,hv=new ev,cv=new ev,_v=new ev,dv=new ev,mv=new ev,Pv=new ev;function fv(e,t,n,i,r){for(let o=0,a=e.length-3;o<=a;o+=3){Pv.fromArray(e,o);const a=r.x*Math.abs(Pv.x)+r.y*Math.abs(Pv.y)+r.z*Math.abs(Pv.z),s=t.dot(Pv),l=n.dot(Pv),p=i.dot(Pv);if(Math.max(-Math.max(s,l,p),Math.min(s,l,p))>a)return!1}return!0}const xv=new iv,yv=new ev,vv=new ev,gv=new ev;class bv{constructor(e=new ev,t=-1){this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const n=this.center;void 0!==t?n.copy(t):xv.setFromPoints(e).getCenter(n);let i=0;for(let t=0,r=e.length;t<r;t++)i=Math.max(i,n.distanceToSquared(e[t]));return this.radius=Math.sqrt(i),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const n=this.center.distanceToSquared(e);return t.copy(e),n>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;gv.subVectors(e,this.center);const t=gv.lengthSq();if(t>this.radius*this.radius){const e=Math.sqrt(t),n=.5*(e-this.radius);this.center.add(gv.multiplyScalar(n/e)),this.radius+=n}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(!0===this.center.equals(e.center)?vv.set(0,0,1).multiplyScalar(e.radius):vv.subVectors(e.center,this.center).normalize().multiplyScalar(e.radius),this.expandByPoint(yv.copy(e.center).add(vv)),this.expandByPoint(yv.copy(e.center).sub(vv)),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return(new this.constructor).copy(this)}}const zv=new ev,wv=new ev,Zv=new ev,Ev=new ev,Mv=new ev,Sv=new ev,Cv=new ev;class Nv{constructor(){Nv.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}set(e,t,n,i,r,o,a,s,l,p,u,h,c,_,d,m){const P=this.elements;return P[0]=e,P[4]=t,P[8]=n,P[12]=i,P[1]=r,P[5]=o,P[9]=a,P[13]=s,P[2]=l,P[6]=p,P[10]=u,P[14]=h,P[3]=c,P[7]=_,P[11]=d,P[15]=m,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new Nv).fromArray(this.elements)}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],this}copyPosition(e){const t=this.elements,n=e.elements;return t[12]=n[12],t[13]=n[13],t[14]=n[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,n){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}makeBasis(e,t,n){return this.set(e.x,t.x,n.x,0,e.y,t.y,n.y,0,e.z,t.z,n.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,n=e.elements,i=1/Av.setFromMatrixColumn(e,0).length(),r=1/Av.setFromMatrixColumn(e,1).length(),o=1/Av.setFromMatrixColumn(e,2).length();return t[0]=n[0]*i,t[1]=n[1]*i,t[2]=n[2]*i,t[3]=0,t[4]=n[4]*r,t[5]=n[5]*r,t[6]=n[6]*r,t[7]=0,t[8]=n[8]*o,t[9]=n[9]*o,t[10]=n[10]*o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){const t=this.elements,n=e.x,i=e.y,r=e.z,o=Math.cos(n),a=Math.sin(n),s=Math.cos(i),l=Math.sin(i),p=Math.cos(r),u=Math.sin(r);if("XYZ"===e.order){const e=o*p,n=o*u,i=a*p,r=a*u;t[0]=s*p,t[4]=-s*u,t[8]=l,t[1]=n+i*l,t[5]=e-r*l,t[9]=-a*s,t[2]=r-e*l,t[6]=i+n*l,t[10]=o*s}else if("YXZ"===e.order){const e=s*p,n=s*u,i=l*p,r=l*u;t[0]=e+r*a,t[4]=i*a-n,t[8]=o*l,t[1]=o*u,t[5]=o*p,t[9]=-a,t[2]=n*a-i,t[6]=r+e*a,t[10]=o*s}else if("ZXY"===e.order){const e=s*p,n=s*u,i=l*p,r=l*u;t[0]=e-r*a,t[4]=-o*u,t[8]=i+n*a,t[1]=n+i*a,t[5]=o*p,t[9]=r-e*a,t[2]=-o*l,t[6]=a,t[10]=o*s}else if("ZYX"===e.order){const e=o*p,n=o*u,i=a*p,r=a*u;t[0]=s*p,t[4]=i*l-n,t[8]=e*l+r,t[1]=s*u,t[5]=r*l+e,t[9]=n*l-i,t[2]=-l,t[6]=a*s,t[10]=o*s}else if("YZX"===e.order){const e=o*s,n=o*l,i=a*s,r=a*l;t[0]=s*p,t[4]=r-e*u,t[8]=i*u+n,t[1]=u,t[5]=o*p,t[9]=-a*p,t[2]=-l*p,t[6]=n*u+i,t[10]=e-r*u}else if("XZY"===e.order){const e=o*s,n=o*l,i=a*s,r=a*l;t[0]=s*p,t[4]=-u,t[8]=l*p,t[1]=e*u+r,t[5]=o*p,t[9]=n*u-i,t[2]=i*u-n,t[6]=a*p,t[10]=r*u+e}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(Bv,e,Tv)}lookAt(e,t,n){const i=this.elements;return Iv.subVectors(e,t),0===Iv.lengthSq()&&(Iv.z=1),Iv.normalize(),Vv.crossVectors(n,Iv),0===Vv.lengthSq()&&(1===Math.abs(n.z)?Iv.x+=1e-4:Iv.z+=1e-4,Iv.normalize(),Vv.crossVectors(n,Iv)),Vv.normalize(),kv.crossVectors(Iv,Vv),i[0]=Vv.x,i[4]=kv.x,i[8]=Iv.x,i[1]=Vv.y,i[5]=kv.y,i[9]=Iv.y,i[2]=Vv.z,i[6]=kv.z,i[10]=Iv.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,i=t.elements,r=this.elements,o=n[0],a=n[4],s=n[8],l=n[12],p=n[1],u=n[5],h=n[9],c=n[13],_=n[2],d=n[6],m=n[10],P=n[14],f=n[3],x=n[7],y=n[11],v=n[15],g=i[0],b=i[4],z=i[8],w=i[12],Z=i[1],E=i[5],M=i[9],S=i[13],C=i[2],N=i[6],A=i[10],L=i[14],B=i[3],T=i[7],V=i[11],k=i[15];return r[0]=o*g+a*Z+s*C+l*B,r[4]=o*b+a*E+s*N+l*T,r[8]=o*z+a*M+s*A+l*V,r[12]=o*w+a*S+s*L+l*k,r[1]=p*g+u*Z+h*C+c*B,r[5]=p*b+u*E+h*N+c*T,r[9]=p*z+u*M+h*A+c*V,r[13]=p*w+u*S+h*L+c*k,r[2]=_*g+d*Z+m*C+P*B,r[6]=_*b+d*E+m*N+P*T,r[10]=_*z+d*M+m*A+P*V,r[14]=_*w+d*S+m*L+P*k,r[3]=f*g+x*Z+y*C+v*B,r[7]=f*b+x*E+y*N+v*T,r[11]=f*z+x*M+y*A+v*V,r[15]=f*w+x*S+y*L+v*k,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[4],i=e[8],r=e[12],o=e[1],a=e[5],s=e[9],l=e[13],p=e[2],u=e[6],h=e[10],c=e[14];return e[3]*(+r*s*u-i*l*u-r*a*h+n*l*h+i*a*c-n*s*c)+e[7]*(+t*s*c-t*l*h+r*o*h-i*o*c+i*l*p-r*s*p)+e[11]*(+t*l*u-t*a*c-r*o*u+n*o*c+r*a*p-n*l*p)+e[15]*(-i*a*p-t*s*u+t*a*h+i*o*u-n*o*h+n*s*p)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,n){const i=this.elements;return e.isVector3?(i[12]=e.x,i[13]=e.y,i[14]=e.z):(i[12]=e,i[13]=t,i[14]=n),this}invert(){const e=this.elements,t=e[0],n=e[1],i=e[2],r=e[3],o=e[4],a=e[5],s=e[6],l=e[7],p=e[8],u=e[9],h=e[10],c=e[11],_=e[12],d=e[13],m=e[14],P=e[15],f=u*m*l-d*h*l+d*s*c-a*m*c-u*s*P+a*h*P,x=_*h*l-p*m*l-_*s*c+o*m*c+p*s*P-o*h*P,y=p*d*l-_*u*l+_*a*c-o*d*c-p*a*P+o*u*P,v=_*u*s-p*d*s-_*a*h+o*d*h+p*a*m-o*u*m,g=t*f+n*x+i*y+r*v;if(0===g)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const b=1/g;return e[0]=f*b,e[1]=(d*h*r-u*m*r-d*i*c+n*m*c+u*i*P-n*h*P)*b,e[2]=(a*m*r-d*s*r+d*i*l-n*m*l-a*i*P+n*s*P)*b,e[3]=(u*s*r-a*h*r-u*i*l+n*h*l+a*i*c-n*s*c)*b,e[4]=x*b,e[5]=(p*m*r-_*h*r+_*i*c-t*m*c-p*i*P+t*h*P)*b,e[6]=(_*s*r-o*m*r-_*i*l+t*m*l+o*i*P-t*s*P)*b,e[7]=(o*h*r-p*s*r+p*i*l-t*h*l-o*i*c+t*s*c)*b,e[8]=y*b,e[9]=(_*u*r-p*d*r-_*n*c+t*d*c+p*n*P-t*u*P)*b,e[10]=(o*d*r-_*a*r+_*n*l-t*d*l-o*n*P+t*a*P)*b,e[11]=(p*a*r-o*u*r-p*n*l+t*u*l+o*n*c-t*a*c)*b,e[12]=v*b,e[13]=(p*d*i-_*u*i+_*n*h-t*d*h-p*n*m+t*u*m)*b,e[14]=(_*a*i-o*d*i-_*n*s+t*d*s+o*n*m-t*a*m)*b,e[15]=(o*u*i-p*a*i+p*n*s-t*u*s-o*n*h+t*a*h)*b,this}scale(e){const t=this.elements,n=e.x,i=e.y,r=e.z;return t[0]*=n,t[4]*=i,t[8]*=r,t[1]*=n,t[5]*=i,t[9]*=r,t[2]*=n,t[6]*=i,t[10]*=r,t[3]*=n,t[7]*=i,t[11]*=r,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],i=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,n,i))}makeTranslation(e,t,n){return this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const n=Math.cos(t),i=Math.sin(t),r=1-n,o=e.x,a=e.y,s=e.z,l=r*o,p=r*a;return this.set(l*o+n,l*a-i*s,l*s+i*a,0,l*a+i*s,p*a+n,p*s-i*o,0,l*s-i*a,p*s+i*o,r*s*s+n,0,0,0,0,1),this}makeScale(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this}makeShear(e,t,n,i,r,o){return this.set(1,n,r,0,e,1,o,0,t,i,1,0,0,0,0,1),this}compose(e,t,n){const i=this.elements,r=t._x,o=t._y,a=t._z,s=t._w,l=r+r,p=o+o,u=a+a,h=r*l,c=r*p,_=r*u,d=o*p,m=o*u,P=a*u,f=s*l,x=s*p,y=s*u,v=n.x,g=n.y,b=n.z;return i[0]=(1-(d+P))*v,i[1]=(c+y)*v,i[2]=(_-x)*v,i[3]=0,i[4]=(c-y)*g,i[5]=(1-(h+P))*g,i[6]=(m+f)*g,i[7]=0,i[8]=(_+x)*b,i[9]=(m-f)*b,i[10]=(1-(h+d))*b,i[11]=0,i[12]=e.x,i[13]=e.y,i[14]=e.z,i[15]=1,this}decompose(e,t,n){const i=this.elements;let r=Av.set(i[0],i[1],i[2]).length();const o=Av.set(i[4],i[5],i[6]).length(),a=Av.set(i[8],i[9],i[10]).length();this.determinant()<0&&(r=-r),e.x=i[12],e.y=i[13],e.z=i[14],Lv.copy(this);const s=1/r,l=1/o,p=1/a;return Lv.elements[0]*=s,Lv.elements[1]*=s,Lv.elements[2]*=s,Lv.elements[4]*=l,Lv.elements[5]*=l,Lv.elements[6]*=l,Lv.elements[8]*=p,Lv.elements[9]*=p,Lv.elements[10]*=p,t.setFromRotationMatrix(Lv),n.x=r,n.y=o,n.z=a,this}makePerspective(e,t,n,i,r,o){const a=this.elements,s=2*r/(t-e),l=2*r/(n-i),p=(t+e)/(t-e),u=(n+i)/(n-i),h=-(o+r)/(o-r),c=-2*o*r/(o-r);return a[0]=s,a[4]=0,a[8]=p,a[12]=0,a[1]=0,a[5]=l,a[9]=u,a[13]=0,a[2]=0,a[6]=0,a[10]=h,a[14]=c,a[3]=0,a[7]=0,a[11]=-1,a[15]=0,this}makeOrthographic(e,t,n,i,r,o){const a=this.elements,s=1/(t-e),l=1/(n-i),p=1/(o-r),u=(t+e)*s,h=(n+i)*l,c=(o+r)*p;return a[0]=2*s,a[4]=0,a[8]=0,a[12]=-u,a[1]=0,a[5]=2*l,a[9]=0,a[13]=-h,a[2]=0,a[6]=0,a[10]=-2*p,a[14]=-c,a[3]=0,a[7]=0,a[11]=0,a[15]=1,this}equals(e){const t=this.elements,n=e.elements;for(let e=0;e<16;e++)if(t[e]!==n[e])return!1;return!0}fromArray(e,t=0){for(let n=0;n<16;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e}}const Av=new ev,Lv=new Nv,Bv=new ev(0,0,0),Tv=new ev(1,1,1),Vv=new ev,kv=new ev,Iv=new ev,Ov=new Nv,Rv=new Qy;class Hv{constructor(e=0,t=0,n=0,i=Hv.DefaultOrder){this.isEuler=!0,this._x=e,this._y=t,this._z=n,this._order=i}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,n,i=this._order){return this._x=e,this._y=t,this._z=n,this._order=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,n=!0){const i=e.elements,r=i[0],o=i[4],a=i[8],s=i[1],l=i[5],p=i[9],u=i[2],h=i[6],c=i[10];switch(t){case"XYZ":this._y=Math.asin(Cy(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-p,c),this._z=Math.atan2(-o,r)):(this._x=Math.atan2(h,l),this._z=0);break;case"YXZ":this._x=Math.asin(-Cy(p,-1,1)),Math.abs(p)<.9999999?(this._y=Math.atan2(a,c),this._z=Math.atan2(s,l)):(this._y=Math.atan2(-u,r),this._z=0);break;case"ZXY":this._x=Math.asin(Cy(h,-1,1)),Math.abs(h)<.9999999?(this._y=Math.atan2(-u,c),this._z=Math.atan2(-o,l)):(this._y=0,this._z=Math.atan2(s,r));break;case"ZYX":this._y=Math.asin(-Cy(u,-1,1)),Math.abs(u)<.9999999?(this._x=Math.atan2(h,c),this._z=Math.atan2(s,r)):(this._x=0,this._z=Math.atan2(-o,l));break;case"YZX":this._z=Math.asin(Cy(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(-p,l),this._y=Math.atan2(-u,r)):(this._x=0,this._y=Math.atan2(a,c));break;case"XZY":this._z=Math.asin(-Cy(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(h,l),this._y=Math.atan2(a,r)):(this._x=Math.atan2(-p,c),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,!0===n&&this._onChangeCallback(),this}setFromQuaternion(e,t,n){return Ov.makeRotationFromQuaternion(e),this.setFromRotationMatrix(Ov,t,n)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return Rv.setFromEuler(this),this.setFromQuaternion(Rv,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}toVector3(){console.error("THREE.Euler: .toVector3() has been removed. Use Vector3.setFromEuler() instead")}}Hv.DefaultOrder="XYZ",Hv.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];class Fv{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return 0!=(this.mask&e.mask)}isEnabled(e){return 0!=(this.mask&(1<<e|0))}}let Dv=0;const Gv=new ev,Uv=new Qy,jv=new Nv,Wv=new ev,qv=new ev,Jv=new ev,$v=new Qy,Xv=new ev(1,0,0),Yv=new ev(0,1,0),Kv=new ev(0,0,1),Qv={type:"added"},eg={type:"removed"};class tg extends Ey{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:Dv++}),this.uuid=Sy(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=tg.DefaultUp.clone();const e=new ev,t=new Hv,n=new Qy,i=new ev(1,1,1);t._onChange((function(){n.setFromEuler(t,!1)})),n._onChange((function(){t.setFromQuaternion(n,void 0,!1)})),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:i},modelViewMatrix:{value:new Nv},normalMatrix:{value:new Ty}}),this.matrix=new Nv,this.matrixWorld=new Nv,this.matrixAutoUpdate=tg.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.matrixWorldAutoUpdate=tg.DefaultMatrixWorldAutoUpdate,this.layers=new Fv,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return Uv.setFromAxisAngle(e,t),this.quaternion.multiply(Uv),this}rotateOnWorldAxis(e,t){return Uv.setFromAxisAngle(e,t),this.quaternion.premultiply(Uv),this}rotateX(e){return this.rotateOnAxis(Xv,e)}rotateY(e){return this.rotateOnAxis(Yv,e)}rotateZ(e){return this.rotateOnAxis(Kv,e)}translateOnAxis(e,t){return Gv.copy(e).applyQuaternion(this.quaternion),this.position.add(Gv.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(Xv,e)}translateY(e){return this.translateOnAxis(Yv,e)}translateZ(e){return this.translateOnAxis(Kv,e)}localToWorld(e){return e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return e.applyMatrix4(jv.copy(this.matrixWorld).invert())}lookAt(e,t,n){e.isVector3?Wv.copy(e):Wv.set(e,t,n);const i=this.parent;this.updateWorldMatrix(!0,!1),qv.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?jv.lookAt(qv,Wv,this.up):jv.lookAt(Wv,qv,this.up),this.quaternion.setFromRotationMatrix(jv),i&&(jv.extractRotation(i.matrixWorld),Uv.setFromRotationMatrix(jv),this.quaternion.premultiply(Uv.invert()))}add(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(null!==e.parent&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(Qv)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.remove(arguments[e]);return this}const t=this.children.indexOf(e);return-1!==t&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(eg)),this}removeFromParent(){const e=this.parent;return null!==e&&e.remove(this),this}clear(){for(let e=0;e<this.children.length;e++){const t=this.children[e];t.parent=null,t.dispatchEvent(eg)}return this.children.length=0,this}attach(e){return this.updateWorldMatrix(!0,!1),jv.copy(this.matrixWorld).invert(),null!==e.parent&&(e.parent.updateWorldMatrix(!0,!1),jv.multiply(e.parent.matrixWorld)),e.applyMatrix4(jv),this.add(e),e.updateWorldMatrix(!1,!0),this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let n=0,i=this.children.length;n<i;n++){const i=this.children[n].getObjectByProperty(e,t);if(void 0!==i)return i}}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(qv,e,Jv),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(qv,$v,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let n=0,i=t.length;n<i;n++)t[n].traverse(e)}traverseVisible(e){if(!1===this.visible)return;e(this);const t=this.children;for(let n=0,i=t.length;n<i;n++)t[n].traverseVisible(e)}traverseAncestors(e){const t=this.parent;null!==t&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let n=0,i=t.length;n<i;n++){const i=t[n];!0!==i.matrixWorldAutoUpdate&&!0!==e||i.updateMatrixWorld(e)}}updateWorldMatrix(e,t){const n=this.parent;if(!0===e&&null!==n&&!0===n.matrixWorldAutoUpdate&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===t){const e=this.children;for(let t=0,n=e.length;t<n;t++){const n=e[t];!0===n.matrixWorldAutoUpdate&&n.updateWorldMatrix(!1,!0)}}}toJSON(e){const t=void 0===e||"string"==typeof e,n={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},n.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});const i={};function r(t,n){return void 0===t[n.uuid]&&(t[n.uuid]=n.toJSON(e)),n.uuid}if(i.uuid=this.uuid,i.type=this.type,""!==this.name&&(i.name=this.name),!0===this.castShadow&&(i.castShadow=!0),!0===this.receiveShadow&&(i.receiveShadow=!0),!1===this.visible&&(i.visible=!1),!1===this.frustumCulled&&(i.frustumCulled=!1),0!==this.renderOrder&&(i.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(i.userData=this.userData),i.layers=this.layers.mask,i.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(i.matrixAutoUpdate=!1),this.isInstancedMesh&&(i.type="InstancedMesh",i.count=this.count,i.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(i.instanceColor=this.instanceColor.toJSON())),this.isScene)this.background&&(this.background.isColor?i.background=this.background.toJSON():this.background.isTexture&&(i.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&!0!==this.environment.isRenderTargetTexture&&(i.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){i.geometry=r(e.geometries,this.geometry);const t=this.geometry.parameters;if(void 0!==t&&void 0!==t.shapes){const n=t.shapes;if(Array.isArray(n))for(let t=0,i=n.length;t<i;t++){const i=n[t];r(e.shapes,i)}else r(e.shapes,n)}}if(this.isSkinnedMesh&&(i.bindMode=this.bindMode,i.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(r(e.skeletons,this.skeleton),i.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){const t=[];for(let n=0,i=this.material.length;n<i;n++)t.push(r(e.materials,this.material[n]));i.material=t}else i.material=r(e.materials,this.material);if(this.children.length>0){i.children=[];for(let t=0;t<this.children.length;t++)i.children.push(this.children[t].toJSON(e).object)}if(this.animations.length>0){i.animations=[];for(let t=0;t<this.animations.length;t++){const n=this.animations[t];i.animations.push(r(e.animations,n))}}if(t){const t=o(e.geometries),i=o(e.materials),r=o(e.textures),a=o(e.images),s=o(e.shapes),l=o(e.skeletons),p=o(e.animations),u=o(e.nodes);t.length>0&&(n.geometries=t),i.length>0&&(n.materials=i),r.length>0&&(n.textures=r),a.length>0&&(n.images=a),s.length>0&&(n.shapes=s),l.length>0&&(n.skeletons=l),p.length>0&&(n.animations=p),u.length>0&&(n.nodes=u)}return n.object=i,n;function o(e){const t=[];for(const n in e){const i=e[n];delete i.metadata,t.push(i)}return t}}clone(e){return(new this.constructor).copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),!0===t)for(let t=0;t<e.children.length;t++){const n=e.children[t];this.add(n.clone())}return this}}tg.DefaultUp=new ev(0,1,0),tg.DefaultMatrixAutoUpdate=!0,tg.DefaultMatrixWorldAutoUpdate=!0;const ng=new ev,ig=new ev,rg=new ev,og=new ev,ag=new ev,sg=new ev,lg=new ev,pg=new ev,ug=new ev,hg=new ev;class cg{constructor(e=new ev,t=new ev,n=new ev){this.a=e,this.b=t,this.c=n}static getNormal(e,t,n,i){i.subVectors(n,t),ng.subVectors(e,t),i.cross(ng);const r=i.lengthSq();return r>0?i.multiplyScalar(1/Math.sqrt(r)):i.set(0,0,0)}static getBarycoord(e,t,n,i,r){ng.subVectors(i,t),ig.subVectors(n,t),rg.subVectors(e,t);const o=ng.dot(ng),a=ng.dot(ig),s=ng.dot(rg),l=ig.dot(ig),p=ig.dot(rg),u=o*l-a*a;if(0===u)return r.set(-2,-1,-1);const h=1/u,c=(l*s-a*p)*h,_=(o*p-a*s)*h;return r.set(1-c-_,_,c)}static containsPoint(e,t,n,i){return this.getBarycoord(e,t,n,i,og),og.x>=0&&og.y>=0&&og.x+og.y<=1}static getUV(e,t,n,i,r,o,a,s){return this.getBarycoord(e,t,n,i,og),s.set(0,0),s.addScaledVector(r,og.x),s.addScaledVector(o,og.y),s.addScaledVector(a,og.z),s}static isFrontFacing(e,t,n,i){return ng.subVectors(n,t),ig.subVectors(e,t),ng.cross(ig).dot(i)<0}set(e,t,n){return this.a.copy(e),this.b.copy(t),this.c.copy(n),this}setFromPointsAndIndices(e,t,n,i){return this.a.copy(e[t]),this.b.copy(e[n]),this.c.copy(e[i]),this}setFromAttributeAndIndices(e,t,n,i){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,n),this.c.fromBufferAttribute(e,i),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return ng.subVectors(this.c,this.b),ig.subVectors(this.a,this.b),.5*ng.cross(ig).length()}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return cg.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return cg.getBarycoord(e,this.a,this.b,this.c,t)}getUV(e,t,n,i,r){return cg.getUV(e,this.a,this.b,this.c,t,n,i,r)}containsPoint(e){return cg.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return cg.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const n=this.a,i=this.b,r=this.c;let o,a;ag.subVectors(i,n),sg.subVectors(r,n),pg.subVectors(e,n);const s=ag.dot(pg),l=sg.dot(pg);if(s<=0&&l<=0)return t.copy(n);ug.subVectors(e,i);const p=ag.dot(ug),u=sg.dot(ug);if(p>=0&&u<=p)return t.copy(i);const h=s*u-p*l;if(h<=0&&s>=0&&p<=0)return o=s/(s-p),t.copy(n).addScaledVector(ag,o);hg.subVectors(e,r);const c=ag.dot(hg),_=sg.dot(hg);if(_>=0&&c<=_)return t.copy(r);const d=c*l-s*_;if(d<=0&&l>=0&&_<=0)return a=l/(l-_),t.copy(n).addScaledVector(sg,a);const m=p*_-c*u;if(m<=0&&u-p>=0&&c-_>=0)return lg.subVectors(r,i),a=(u-p)/(u-p+(c-_)),t.copy(i).addScaledVector(lg,a);const P=1/(m+d+h);return o=d*P,a=h*P,t.copy(n).addScaledVector(ag,o).addScaledVector(sg,a)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}let _g=0;class dg extends Ey{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:_g++}),this.uuid=Sy(),this.name="",this.type="Material",this.blending=1,this.side=0,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=204,this.blendDst=205,this.blendEquation=100,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=3,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=519,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=Zy,this.stencilZFail=Zy,this.stencilZPass=Zy,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(void 0!==e)for(const t in e){const n=e[t];if(void 0===n){console.warn("THREE.Material: '"+t+"' parameter is undefined.");continue}const i=this[t];void 0!==i?i&&i.isColor?i.set(n):i&&i.isVector3&&n&&n.isVector3?i.copy(n):this[t]=n:console.warn("THREE."+this.type+": '"+t+"' is not a property of this material.")}}toJSON(e){const t=void 0===e||"string"==typeof e;t&&(e={textures:{},images:{}});const n={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function i(e){const t=[];for(const n in e){const i=e[n];delete i.metadata,t.push(i)}return t}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),void 0!==this.roughness&&(n.roughness=this.roughness),void 0!==this.metalness&&(n.metalness=this.metalness),void 0!==this.sheen&&(n.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(n.sheenColor=this.sheenColor.getHex()),void 0!==this.sheenRoughness&&(n.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),void 0!==this.specularIntensity&&(n.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(n.specularColor=this.specularColor.getHex()),void 0!==this.shininess&&(n.shininess=this.shininess),void 0!==this.clearcoat&&(n.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),void 0!==this.iridescence&&(n.iridescence=this.iridescence),void 0!==this.iridescenceIOR&&(n.iridescenceIOR=this.iridescenceIOR),void 0!==this.iridescenceThicknessRange&&(n.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(n.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(n.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(e).uuid,n.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(e).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(e).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(e).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(e).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(n.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(n.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(e).uuid,void 0!==this.combine&&(n.combine=this.combine)),void 0!==this.envMapIntensity&&(n.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(n.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(n.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(e).uuid),void 0!==this.transmission&&(n.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(n.transmissionMap=this.transmissionMap.toJSON(e).uuid),void 0!==this.thickness&&(n.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(n.thicknessMap=this.thicknessMap.toJSON(e).uuid),void 0!==this.attenuationDistance&&(n.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationColor&&(n.attenuationColor=this.attenuationColor.getHex()),void 0!==this.size&&(n.size=this.size),null!==this.shadowSide&&(n.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(n.sizeAttenuation=this.sizeAttenuation),1!==this.blending&&(n.blending=this.blending),0!==this.side&&(n.side=this.side),this.vertexColors&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),!0===this.transparent&&(n.transparent=this.transparent),n.depthFunc=this.depthFunc,n.depthTest=this.depthTest,n.depthWrite=this.depthWrite,n.colorWrite=this.colorWrite,n.stencilWrite=this.stencilWrite,n.stencilWriteMask=this.stencilWriteMask,n.stencilFunc=this.stencilFunc,n.stencilRef=this.stencilRef,n.stencilFuncMask=this.stencilFuncMask,n.stencilFail=this.stencilFail,n.stencilZFail=this.stencilZFail,n.stencilZPass=this.stencilZPass,void 0!==this.rotation&&0!==this.rotation&&(n.rotation=this.rotation),!0===this.polygonOffset&&(n.polygonOffset=!0),0!==this.polygonOffsetFactor&&(n.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(n.polygonOffsetUnits=this.polygonOffsetUnits),void 0!==this.linewidth&&1!==this.linewidth&&(n.linewidth=this.linewidth),void 0!==this.dashSize&&(n.dashSize=this.dashSize),void 0!==this.gapSize&&(n.gapSize=this.gapSize),void 0!==this.scale&&(n.scale=this.scale),!0===this.dithering&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),!0===this.alphaToCoverage&&(n.alphaToCoverage=this.alphaToCoverage),!0===this.premultipliedAlpha&&(n.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(n.wireframe=this.wireframe),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(n.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(n.wireframeLinejoin=this.wireframeLinejoin),!0===this.flatShading&&(n.flatShading=this.flatShading),!1===this.visible&&(n.visible=!1),!1===this.toneMapped&&(n.toneMapped=!1),!1===this.fog&&(n.fog=!1),"{}"!==JSON.stringify(this.userData)&&(n.userData=this.userData),t){const t=i(e.textures),r=i(e.images);t.length>0&&(n.textures=t),r.length>0&&(n.images=r)}return n}clone(){return(new this.constructor).copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let n=null;if(null!==t){const e=t.length;n=new Array(e);for(let i=0;i!==e;++i)n[i]=t[i].clone()}return this.clippingPlanes=n,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){!0===e&&this.version++}}class mg extends dg{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new Wy(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const Pg=new ev,fg=new By;class xg{constructor(e,t,n){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=e,this.itemSize=t,this.count=void 0!==e?e.length/t:0,this.normalized=!0===n,this.usage=35044,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this}copyAt(e,t,n){e*=this.itemSize,n*=t.itemSize;for(let i=0,r=this.itemSize;i<r;i++)this.array[e+i]=t.array[n+i];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(2===this.itemSize)for(let t=0,n=this.count;t<n;t++)fg.fromBufferAttribute(this,t),fg.applyMatrix3(e),this.setXY(t,fg.x,fg.y);else if(3===this.itemSize)for(let t=0,n=this.count;t<n;t++)Pg.fromBufferAttribute(this,t),Pg.applyMatrix3(e),this.setXYZ(t,Pg.x,Pg.y,Pg.z);return this}applyMatrix4(e){for(let t=0,n=this.count;t<n;t++)Pg.fromBufferAttribute(this,t),Pg.applyMatrix4(e),this.setXYZ(t,Pg.x,Pg.y,Pg.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)Pg.fromBufferAttribute(this,t),Pg.applyNormalMatrix(e),this.setXYZ(t,Pg.x,Pg.y,Pg.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)Pg.fromBufferAttribute(this,t),Pg.transformDirection(e),this.setXYZ(t,Pg.x,Pg.y,Pg.z);return this}set(e,t=0){return this.array.set(e,t),this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=Ay(t,this.array)),t}setX(e,t){return this.normalized&&(t=Ly(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=Ay(t,this.array)),t}setY(e,t){return this.normalized&&(t=Ly(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=Ay(t,this.array)),t}setZ(e,t){return this.normalized&&(t=Ly(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=Ay(t,this.array)),t}setW(e,t){return this.normalized&&(t=Ly(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,n){return e*=this.itemSize,this.normalized&&(t=Ly(t,this.array),n=Ly(n,this.array)),this.array[e+0]=t,this.array[e+1]=n,this}setXYZ(e,t,n,i){return e*=this.itemSize,this.normalized&&(t=Ly(t,this.array),n=Ly(n,this.array),i=Ly(i,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=i,this}setXYZW(e,t,n,i,r){return e*=this.itemSize,this.normalized&&(t=Ly(t,this.array),n=Ly(n,this.array),i=Ly(i,this.array),r=Ly(r,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=i,this.array[e+3]=r,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return""!==this.name&&(e.name=this.name),35044!==this.usage&&(e.usage=this.usage),0===this.updateRange.offset&&-1===this.updateRange.count||(e.updateRange=this.updateRange),e}copyColorsArray(){console.error("THREE.BufferAttribute: copyColorsArray() was removed in r144.")}copyVector2sArray(){console.error("THREE.BufferAttribute: copyVector2sArray() was removed in r144.")}copyVector3sArray(){console.error("THREE.BufferAttribute: copyVector3sArray() was removed in r144.")}copyVector4sArray(){console.error("THREE.BufferAttribute: copyVector4sArray() was removed in r144.")}}class yg extends xg{constructor(e,t,n){super(new Uint16Array(e),t,n)}}class vg extends xg{constructor(e,t,n){super(new Uint32Array(e),t,n)}}class gg extends xg{constructor(e,t,n){super(new Float32Array(e),t,n)}}let bg=0;const zg=new Nv,wg=new tg,Zg=new ev,Eg=new iv,Mg=new iv,Sg=new ev;class Cg extends Ey{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:bg++}),this.uuid=Sy(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(function(e){for(let t=e.length-1;t>=0;--t)if(e[t]>=65535)return!0;return!1}(e)?vg:yg)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return void 0!==this.attributes[e]}addGroup(e,t,n=0){this.groups.push({start:e,count:t,materialIndex:n})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;void 0!==t&&(t.applyMatrix4(e),t.needsUpdate=!0);const n=this.attributes.normal;if(void 0!==n){const t=(new Ty).getNormalMatrix(e);n.applyNormalMatrix(t),n.needsUpdate=!0}const i=this.attributes.tangent;return void 0!==i&&(i.transformDirection(e),i.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}applyQuaternion(e){return zg.makeRotationFromQuaternion(e),this.applyMatrix4(zg),this}rotateX(e){return zg.makeRotationX(e),this.applyMatrix4(zg),this}rotateY(e){return zg.makeRotationY(e),this.applyMatrix4(zg),this}rotateZ(e){return zg.makeRotationZ(e),this.applyMatrix4(zg),this}translate(e,t,n){return zg.makeTranslation(e,t,n),this.applyMatrix4(zg),this}scale(e,t,n){return zg.makeScale(e,t,n),this.applyMatrix4(zg),this}lookAt(e){return wg.lookAt(e),wg.updateMatrix(),this.applyMatrix4(wg.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(Zg).negate(),this.translate(Zg.x,Zg.y,Zg.z),this}setFromPoints(e){const t=[];for(let n=0,i=e.length;n<i;n++){const i=e[n];t.push(i.x,i.y,i.z||0)}return this.setAttribute("position",new gg(t,3)),this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new iv);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingBox.set(new ev(-1/0,-1/0,-1/0),new ev(1/0,1/0,1/0));if(void 0!==e){if(this.boundingBox.setFromBufferAttribute(e),t)for(let e=0,n=t.length;e<n;e++){const n=t[e];Eg.setFromBufferAttribute(n),this.morphTargetsRelative?(Sg.addVectors(this.boundingBox.min,Eg.min),this.boundingBox.expandByPoint(Sg),Sg.addVectors(this.boundingBox.max,Eg.max),this.boundingBox.expandByPoint(Sg)):(this.boundingBox.expandByPoint(Eg.min),this.boundingBox.expandByPoint(Eg.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new bv);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingSphere.set(new ev,1/0);if(e){const n=this.boundingSphere.center;if(Eg.setFromBufferAttribute(e),t)for(let e=0,n=t.length;e<n;e++){const n=t[e];Mg.setFromBufferAttribute(n),this.morphTargetsRelative?(Sg.addVectors(Eg.min,Mg.min),Eg.expandByPoint(Sg),Sg.addVectors(Eg.max,Mg.max),Eg.expandByPoint(Sg)):(Eg.expandByPoint(Mg.min),Eg.expandByPoint(Mg.max))}Eg.getCenter(n);let i=0;for(let t=0,r=e.count;t<r;t++)Sg.fromBufferAttribute(e,t),i=Math.max(i,n.distanceToSquared(Sg));if(t)for(let r=0,o=t.length;r<o;r++){const o=t[r],a=this.morphTargetsRelative;for(let t=0,r=o.count;t<r;t++)Sg.fromBufferAttribute(o,t),a&&(Zg.fromBufferAttribute(e,t),Sg.add(Zg)),i=Math.max(i,n.distanceToSquared(Sg))}this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,t=this.attributes;if(null===e||void 0===t.position||void 0===t.normal||void 0===t.uv)return void console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");const n=e.array,i=t.position.array,r=t.normal.array,o=t.uv.array,a=i.length/3;!1===this.hasAttribute("tangent")&&this.setAttribute("tangent",new xg(new Float32Array(4*a),4));const s=this.getAttribute("tangent").array,l=[],p=[];for(let e=0;e<a;e++)l[e]=new ev,p[e]=new ev;const u=new ev,h=new ev,c=new ev,_=new By,d=new By,m=new By,P=new ev,f=new ev;function x(e,t,n){u.fromArray(i,3*e),h.fromArray(i,3*t),c.fromArray(i,3*n),_.fromArray(o,2*e),d.fromArray(o,2*t),m.fromArray(o,2*n),h.sub(u),c.sub(u),d.sub(_),m.sub(_);const r=1/(d.x*m.y-m.x*d.y);isFinite(r)&&(P.copy(h).multiplyScalar(m.y).addScaledVector(c,-d.y).multiplyScalar(r),f.copy(c).multiplyScalar(d.x).addScaledVector(h,-m.x).multiplyScalar(r),l[e].add(P),l[t].add(P),l[n].add(P),p[e].add(f),p[t].add(f),p[n].add(f))}let y=this.groups;0===y.length&&(y=[{start:0,count:n.length}]);for(let e=0,t=y.length;e<t;++e){const t=y[e],i=t.start;for(let e=i,r=i+t.count;e<r;e+=3)x(n[e+0],n[e+1],n[e+2])}const v=new ev,g=new ev,b=new ev,z=new ev;function w(e){b.fromArray(r,3*e),z.copy(b);const t=l[e];v.copy(t),v.sub(b.multiplyScalar(b.dot(t))).normalize(),g.crossVectors(z,t);const n=g.dot(p[e])<0?-1:1;s[4*e]=v.x,s[4*e+1]=v.y,s[4*e+2]=v.z,s[4*e+3]=n}for(let e=0,t=y.length;e<t;++e){const t=y[e],i=t.start;for(let e=i,r=i+t.count;e<r;e+=3)w(n[e+0]),w(n[e+1]),w(n[e+2])}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(void 0!==t){let n=this.getAttribute("normal");if(void 0===n)n=new xg(new Float32Array(3*t.count),3),this.setAttribute("normal",n);else for(let e=0,t=n.count;e<t;e++)n.setXYZ(e,0,0,0);const i=new ev,r=new ev,o=new ev,a=new ev,s=new ev,l=new ev,p=new ev,u=new ev;if(e)for(let h=0,c=e.count;h<c;h+=3){const c=e.getX(h+0),_=e.getX(h+1),d=e.getX(h+2);i.fromBufferAttribute(t,c),r.fromBufferAttribute(t,_),o.fromBufferAttribute(t,d),p.subVectors(o,r),u.subVectors(i,r),p.cross(u),a.fromBufferAttribute(n,c),s.fromBufferAttribute(n,_),l.fromBufferAttribute(n,d),a.add(p),s.add(p),l.add(p),n.setXYZ(c,a.x,a.y,a.z),n.setXYZ(_,s.x,s.y,s.z),n.setXYZ(d,l.x,l.y,l.z)}else for(let e=0,a=t.count;e<a;e+=3)i.fromBufferAttribute(t,e+0),r.fromBufferAttribute(t,e+1),o.fromBufferAttribute(t,e+2),p.subVectors(o,r),u.subVectors(i,r),p.cross(u),n.setXYZ(e+0,p.x,p.y,p.z),n.setXYZ(e+1,p.x,p.y,p.z),n.setXYZ(e+2,p.x,p.y,p.z);this.normalizeNormals(),n.needsUpdate=!0}}merge(){return console.error("THREE.BufferGeometry.merge() has been removed. Use THREE.BufferGeometryUtils.mergeBufferGeometries() instead."),this}normalizeNormals(){const e=this.attributes.normal;for(let t=0,n=e.count;t<n;t++)Sg.fromBufferAttribute(e,t),Sg.normalize(),e.setXYZ(t,Sg.x,Sg.y,Sg.z)}toNonIndexed(){function e(e,t){const n=e.array,i=e.itemSize,r=e.normalized,o=new n.constructor(t.length*i);let a=0,s=0;for(let r=0,l=t.length;r<l;r++){a=e.isInterleavedBufferAttribute?t[r]*e.data.stride+e.offset:t[r]*i;for(let e=0;e<i;e++)o[s++]=n[a++]}return new xg(o,i,r)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new Cg,n=this.index.array,i=this.attributes;for(const r in i){const o=e(i[r],n);t.setAttribute(r,o)}const r=this.morphAttributes;for(const i in r){const o=[],a=r[i];for(let t=0,i=a.length;t<i;t++){const i=e(a[t],n);o.push(i)}t.morphAttributes[i]=o}t.morphTargetsRelative=this.morphTargetsRelative;const o=this.groups;for(let e=0,n=o.length;e<n;e++){const n=o[e];t.addGroup(n.start,n.count,n.materialIndex)}return t}toJSON(){const e={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),void 0!==this.parameters){const t=this.parameters;for(const n in t)void 0!==t[n]&&(e[n]=t[n]);return e}e.data={attributes:{}};const t=this.index;null!==t&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const n=this.attributes;for(const t in n){const i=n[t];e.data.attributes[t]=i.toJSON(e.data)}const i={};let r=!1;for(const t in this.morphAttributes){const n=this.morphAttributes[t],o=[];for(let t=0,i=n.length;t<i;t++){const i=n[t];o.push(i.toJSON(e.data))}o.length>0&&(i[t]=o,r=!0)}r&&(e.data.morphAttributes=i,e.data.morphTargetsRelative=this.morphTargetsRelative);const o=this.groups;o.length>0&&(e.data.groups=JSON.parse(JSON.stringify(o)));const a=this.boundingSphere;return null!==a&&(e.data.boundingSphere={center:a.center.toArray(),radius:a.radius}),e}clone(){return(new this.constructor).copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const n=e.index;null!==n&&this.setIndex(n.clone(t));const i=e.attributes;for(const e in i){const n=i[e];this.setAttribute(e,n.clone(t))}const r=e.morphAttributes;for(const e in r){const n=[],i=r[e];for(let e=0,r=i.length;e<r;e++)n.push(i[e].clone(t));this.morphAttributes[e]=n}this.morphTargetsRelative=e.morphTargetsRelative;const o=e.groups;for(let e=0,t=o.length;e<t;e++){const t=o[e];this.addGroup(t.start,t.count,t.materialIndex)}const a=e.boundingBox;null!==a&&(this.boundingBox=a.clone());const s=e.boundingSphere;return null!==s&&(this.boundingSphere=s.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,void 0!==e.parameters&&(this.parameters=Object.assign({},e.parameters)),this}dispose(){this.dispatchEvent({type:"dispose"})}}const Ng=new Nv,Ag=new class{constructor(e=new ev,t=new ev(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.direction).multiplyScalar(e).add(this.origin)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,zv)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const n=t.dot(this.direction);return n<0?t.copy(this.origin):t.copy(this.direction).multiplyScalar(n).add(this.origin)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=zv.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(zv.copy(this.direction).multiplyScalar(t).add(this.origin),zv.distanceToSquared(e))}distanceSqToSegment(e,t,n,i){wv.copy(e).add(t).multiplyScalar(.5),Zv.copy(t).sub(e).normalize(),Ev.copy(this.origin).sub(wv);const r=.5*e.distanceTo(t),o=-this.direction.dot(Zv),a=Ev.dot(this.direction),s=-Ev.dot(Zv),l=Ev.lengthSq(),p=Math.abs(1-o*o);let u,h,c,_;if(p>0)if(u=o*s-a,h=o*a-s,_=r*p,u>=0)if(h>=-_)if(h<=_){const e=1/p;u*=e,h*=e,c=u*(u+o*h+2*a)+h*(o*u+h+2*s)+l}else h=r,u=Math.max(0,-(o*h+a)),c=-u*u+h*(h+2*s)+l;else h=-r,u=Math.max(0,-(o*h+a)),c=-u*u+h*(h+2*s)+l;else h<=-_?(u=Math.max(0,-(-o*r+a)),h=u>0?-r:Math.min(Math.max(-r,-s),r),c=-u*u+h*(h+2*s)+l):h<=_?(u=0,h=Math.min(Math.max(-r,-s),r),c=h*(h+2*s)+l):(u=Math.max(0,-(o*r+a)),h=u>0?r:Math.min(Math.max(-r,-s),r),c=-u*u+h*(h+2*s)+l);else h=o>0?-r:r,u=Math.max(0,-(o*h+a)),c=-u*u+h*(h+2*s)+l;return n&&n.copy(this.direction).multiplyScalar(u).add(this.origin),i&&i.copy(Zv).multiplyScalar(h).add(wv),c}intersectSphere(e,t){zv.subVectors(e.center,this.origin);const n=zv.dot(this.direction),i=zv.dot(zv)-n*n,r=e.radius*e.radius;if(i>r)return null;const o=Math.sqrt(r-i),a=n-o,s=n+o;return a<0&&s<0?null:a<0?this.at(s,t):this.at(a,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(0===t)return 0===e.distanceToPoint(this.origin)?0:null;const n=-(this.origin.dot(e.normal)+e.constant)/t;return n>=0?n:null}intersectPlane(e,t){const n=this.distanceToPlane(e);return null===n?null:this.at(n,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);return 0===t||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let n,i,r,o,a,s;const l=1/this.direction.x,p=1/this.direction.y,u=1/this.direction.z,h=this.origin;return l>=0?(n=(e.min.x-h.x)*l,i=(e.max.x-h.x)*l):(n=(e.max.x-h.x)*l,i=(e.min.x-h.x)*l),p>=0?(r=(e.min.y-h.y)*p,o=(e.max.y-h.y)*p):(r=(e.max.y-h.y)*p,o=(e.min.y-h.y)*p),n>o||r>i?null:((r>n||n!=n)&&(n=r),(o<i||i!=i)&&(i=o),u>=0?(a=(e.min.z-h.z)*u,s=(e.max.z-h.z)*u):(a=(e.max.z-h.z)*u,s=(e.min.z-h.z)*u),n>s||a>i?null:((a>n||n!=n)&&(n=a),(s<i||i!=i)&&(i=s),i<0?null:this.at(n>=0?n:i,t)))}intersectsBox(e){return null!==this.intersectBox(e,zv)}intersectTriangle(e,t,n,i,r){Mv.subVectors(t,e),Sv.subVectors(n,e),Cv.crossVectors(Mv,Sv);let o,a=this.direction.dot(Cv);if(a>0){if(i)return null;o=1}else{if(!(a<0))return null;o=-1,a=-a}Ev.subVectors(this.origin,e);const s=o*this.direction.dot(Sv.crossVectors(Ev,Sv));if(s<0)return null;const l=o*this.direction.dot(Mv.cross(Ev));if(l<0)return null;if(s+l>a)return null;const p=-o*Ev.dot(Cv);return p<0?null:this.at(p/a,r)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return(new this.constructor).copy(this)}},Lg=new bv,Bg=new ev,Tg=new ev,Vg=new ev,kg=new ev,Ig=new ev,Og=new ev,Rg=new ev,Hg=new ev,Fg=new ev,Dg=new By,Gg=new By,Ug=new By,jg=new ev,Wg=new ev;class qg extends tg{constructor(e=new Cg,t=new mg){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),void 0!==e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),void 0!==e.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=e.material,this.geometry=e.geometry,this}updateMorphTargets(){const e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){const n=e[t[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,t=n.length;e<t;e++){const t=n[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[t]=e}}}}raycast(e,t){const n=this.geometry,i=this.material,r=this.matrixWorld;if(void 0===i)return;if(null===n.boundingSphere&&n.computeBoundingSphere(),Lg.copy(n.boundingSphere),Lg.applyMatrix4(r),!1===e.ray.intersectsSphere(Lg))return;if(Ng.copy(r).invert(),Ag.copy(e.ray).applyMatrix4(Ng),null!==n.boundingBox&&!1===Ag.intersectsBox(n.boundingBox))return;let o;const a=n.index,s=n.attributes.position,l=n.morphAttributes.position,p=n.morphTargetsRelative,u=n.attributes.uv,h=n.attributes.uv2,c=n.groups,_=n.drawRange;if(null!==a)if(Array.isArray(i))for(let n=0,r=c.length;n<r;n++){const r=c[n],d=i[r.materialIndex];for(let n=Math.max(r.start,_.start),i=Math.min(a.count,Math.min(r.start+r.count,_.start+_.count));n<i;n+=3){const i=a.getX(n),c=a.getX(n+1),_=a.getX(n+2);o=Jg(this,d,e,Ag,s,l,p,u,h,i,c,_),o&&(o.faceIndex=Math.floor(n/3),o.face.materialIndex=r.materialIndex,t.push(o))}}else for(let n=Math.max(0,_.start),r=Math.min(a.count,_.start+_.count);n<r;n+=3){const r=a.getX(n),c=a.getX(n+1),_=a.getX(n+2);o=Jg(this,i,e,Ag,s,l,p,u,h,r,c,_),o&&(o.faceIndex=Math.floor(n/3),t.push(o))}else if(void 0!==s)if(Array.isArray(i))for(let n=0,r=c.length;n<r;n++){const r=c[n],a=i[r.materialIndex];for(let n=Math.max(r.start,_.start),i=Math.min(s.count,Math.min(r.start+r.count,_.start+_.count));n<i;n+=3)o=Jg(this,a,e,Ag,s,l,p,u,h,n,n+1,n+2),o&&(o.faceIndex=Math.floor(n/3),o.face.materialIndex=r.materialIndex,t.push(o))}else for(let n=Math.max(0,_.start),r=Math.min(s.count,_.start+_.count);n<r;n+=3)o=Jg(this,i,e,Ag,s,l,p,u,h,n,n+1,n+2),o&&(o.faceIndex=Math.floor(n/3),t.push(o))}}function Jg(e,t,n,i,r,o,a,s,l,p,u,h){Bg.fromBufferAttribute(r,p),Tg.fromBufferAttribute(r,u),Vg.fromBufferAttribute(r,h);const c=e.morphTargetInfluences;if(o&&c){Rg.set(0,0,0),Hg.set(0,0,0),Fg.set(0,0,0);for(let e=0,t=o.length;e<t;e++){const t=c[e],n=o[e];0!==t&&(kg.fromBufferAttribute(n,p),Ig.fromBufferAttribute(n,u),Og.fromBufferAttribute(n,h),a?(Rg.addScaledVector(kg,t),Hg.addScaledVector(Ig,t),Fg.addScaledVector(Og,t)):(Rg.addScaledVector(kg.sub(Bg),t),Hg.addScaledVector(Ig.sub(Tg),t),Fg.addScaledVector(Og.sub(Vg),t)))}Bg.add(Rg),Tg.add(Hg),Vg.add(Fg)}e.isSkinnedMesh&&(e.boneTransform(p,Bg),e.boneTransform(u,Tg),e.boneTransform(h,Vg));const _=function(e,t,n,i,r,o,a,s){let l;if(l=1===t.side?i.intersectTriangle(a,o,r,!0,s):i.intersectTriangle(r,o,a,2!==t.side,s),null===l)return null;Wg.copy(s),Wg.applyMatrix4(e.matrixWorld);const p=n.ray.origin.distanceTo(Wg);return p<n.near||p>n.far?null:{distance:p,point:Wg.clone(),object:e}}(e,t,n,i,Bg,Tg,Vg,jg);if(_){s&&(Dg.fromBufferAttribute(s,p),Gg.fromBufferAttribute(s,u),Ug.fromBufferAttribute(s,h),_.uv=cg.getUV(jg,Bg,Tg,Vg,Dg,Gg,Ug,new By)),l&&(Dg.fromBufferAttribute(l,p),Gg.fromBufferAttribute(l,u),Ug.fromBufferAttribute(l,h),_.uv2=cg.getUV(jg,Bg,Tg,Vg,Dg,Gg,Ug,new By));const e={a:p,b:u,c:h,normal:new ev,materialIndex:0};cg.getNormal(Bg,Tg,Vg,e.normal),_.face=e}return _}class $g extends tg{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new Nv,this.projectionMatrix=new Nv,this.projectionMatrixInverse=new Nv}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return(new this.constructor).copy(this)}}const Xg=new ev,Yg=new ev,Kg=new Ty;class Qg{constructor(e=new ev(1,0,0),t=0){this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,n,i){return this.normal.set(e,t,n),this.constant=i,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,n){const i=Xg.subVectors(n,t).cross(Yg.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(i,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)}intersectLine(e,t){const n=e.delta(Xg),i=this.normal.dot(n);if(0===i)return 0===this.distanceToPoint(e.start)?t.copy(e.start):null;const r=-(e.start.dot(this.normal)+this.constant)/i;return r<0||r>1?null:t.copy(n).multiplyScalar(r).add(e.start)}intersectsLine(e){const t=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return t<0&&n>0||n<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const n=t||Kg.getNormalMatrix(e),i=this.coplanarPoint(Xg).applyMatrix4(e),r=this.normal.applyMatrix3(n).normalize();return this.constant=-i.dot(r),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return(new this.constructor).copy(this)}}const eb=new bv,tb=new ev;class nb{constructor(e=new Qg,t=new Qg,n=new Qg,i=new Qg,r=new Qg,o=new Qg){this.planes=[e,t,n,i,r,o]}set(e,t,n,i,r,o){const a=this.planes;return a[0].copy(e),a[1].copy(t),a[2].copy(n),a[3].copy(i),a[4].copy(r),a[5].copy(o),this}copy(e){const t=this.planes;for(let n=0;n<6;n++)t[n].copy(e.planes[n]);return this}setFromProjectionMatrix(e){const t=this.planes,n=e.elements,i=n[0],r=n[1],o=n[2],a=n[3],s=n[4],l=n[5],p=n[6],u=n[7],h=n[8],c=n[9],_=n[10],d=n[11],m=n[12],P=n[13],f=n[14],x=n[15];return t[0].setComponents(a-i,u-s,d-h,x-m).normalize(),t[1].setComponents(a+i,u+s,d+h,x+m).normalize(),t[2].setComponents(a+r,u+l,d+c,x+P).normalize(),t[3].setComponents(a-r,u-l,d-c,x-P).normalize(),t[4].setComponents(a-o,u-p,d-_,x-f).normalize(),t[5].setComponents(a+o,u+p,d+_,x+f).normalize(),this}intersectsObject(e){const t=e.geometry;return null===t.boundingSphere&&t.computeBoundingSphere(),eb.copy(t.boundingSphere).applyMatrix4(e.matrixWorld),this.intersectsSphere(eb)}intersectsSprite(e){return eb.center.set(0,0,0),eb.radius=.7071067811865476,eb.applyMatrix4(e.matrixWorld),this.intersectsSphere(eb)}intersectsSphere(e){const t=this.planes,n=e.center,i=-e.radius;for(let e=0;e<6;e++)if(t[e].distanceToPoint(n)<i)return!1;return!0}intersectsBox(e){const t=this.planes;for(let n=0;n<6;n++){const i=t[n];if(tb.x=i.normal.x>0?e.max.x:e.min.x,tb.y=i.normal.y>0?e.max.y:e.min.y,tb.z=i.normal.z>0?e.max.z:e.min.z,i.distanceToPoint(tb)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let n=0;n<6;n++)if(t[n].distanceToPoint(e)<0)return!1;return!0}clone(){return(new this.constructor).copy(this)}}class ib extends Cg{constructor(e=1,t=1,n=1,i=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:n,heightSegments:i};const r=e/2,o=t/2,a=Math.floor(n),s=Math.floor(i),l=a+1,p=s+1,u=e/a,h=t/s,c=[],_=[],d=[],m=[];for(let e=0;e<p;e++){const t=e*h-o;for(let n=0;n<l;n++){const i=n*u-r;_.push(i,-t,0),d.push(0,0,1),m.push(n/a),m.push(1-e/s)}}for(let e=0;e<s;e++)for(let t=0;t<a;t++){const n=t+l*e,i=t+l*(e+1),r=t+1+l*(e+1),o=t+1+l*e;c.push(n,i,o),c.push(i,r,o)}this.setIndex(c),this.setAttribute("position",new gg(_,3)),this.setAttribute("normal",new gg(d,3)),this.setAttribute("uv",new gg(m,2))}static fromJSON(e){return new ib(e.width,e.height,e.widthSegments,e.heightSegments)}}class rb extends $g{constructor(e=-1,t=1,n=1,i=-1,r=.1,o=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=n,this.bottom=i,this.near=r,this.far=o,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=null===e.view?null:Object.assign({},e.view),this}setViewOffset(e,t,n,i,r,o){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=i,this.view.width=r,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,i=(this.top+this.bottom)/2;let r=n-e,o=n+e,a=i+t,s=i-t;if(null!==this.view&&this.view.enabled){const e=(this.right-this.left)/this.view.fullWidth/this.zoom,t=(this.top-this.bottom)/this.view.fullHeight/this.zoom;r+=e*this.view.offsetX,o=r+e*this.view.width,a-=t*this.view.offsetY,s=a-t*this.view.height}this.projectionMatrix.makeOrthographic(r,o,a,s,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,null!==this.view&&(t.object.view=Object.assign({},this.view)),t}}class ob{constructor(e,t=1,n=1e3){this.isFog=!0,this.name="",this.color=new Wy(e),this.near=t,this.far=n}clone(){return new ob(this.color,this.near,this.far)}toJSON(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}}class ab extends dg{constructor(e){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new Wy(16777215),this.specular=new Wy(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Wy(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new By(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class sb extends tg{constructor(e,t=1){super(),this.isLight=!0,this.type="Light",this.color=new Wy(e),this.intensity=t}dispose(){}copy(e,t){return super.copy(e,t),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,void 0!==this.groundColor&&(t.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(t.object.distance=this.distance),void 0!==this.angle&&(t.object.angle=this.angle),void 0!==this.decay&&(t.object.decay=this.decay),void 0!==this.penumbra&&(t.object.penumbra=this.penumbra),void 0!==this.shadow&&(t.object.shadow=this.shadow.toJSON()),t}}class lb extends sb{constructor(e,t,n){super(e,n),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(tg.DefaultUp),this.updateMatrix(),this.groundColor=new Wy(t)}copy(e,t){return super.copy(e,t),this.groundColor.copy(e.groundColor),this}}const pb=new Nv,ub=new ev,hb=new ev;class cb extends class{constructor(e){this.camera=e,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new By(512,512),this.map=null,this.mapPass=null,this.matrix=new Nv,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new nb,this._frameExtents=new By(1,1),this._viewportCount=1,this._viewports=[new Ky(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const t=this.camera,n=this.matrix;ub.setFromMatrixPosition(e.matrixWorld),t.position.copy(ub),hb.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(hb),t.updateMatrixWorld(),pb.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(pb),n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(pb)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return(new this.constructor).copy(this)}toJSON(){const e={};return 0!==this.bias&&(e.bias=this.bias),0!==this.normalBias&&(e.normalBias=this.normalBias),1!==this.radius&&(e.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}{constructor(){super(new rb(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class _b extends sb{constructor(e,t){super(e,t),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(tg.DefaultUp),this.updateMatrix(),this.target=new tg,this.shadow=new cb}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}"\\[\\]\\.:\\/".replace("\\.",""),"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:"145"}})),"undefined"!=typeof window&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__="145");const db={SKYBOX_1:"SKYBOX_1",SKYBOX_2:"SKYBOX_2",SKYBOX_3:"SKYBOX_3",SKYBOX_4:"SKYBOX_4",SKYBOX_5:"SKYBOX_5",SKYBOX_6:"SKYBOX_6",SMOKE:"SMOKE",POINT:"POINT",POLYGON_STARTER_01:"POLYGON_STARTER_01"},mb="CHARACTERS",Pb="WATER_GUN_01",fb="WATER_GUN_02",xb="WATER_PISTOL_01",yb="CHARACTERS_IDLE",vb="CHARACTERS_WALK",gb="CHARACTERS_WALK_BACKWARDS",bb="CHARACTERS_RUN",zb="CHARACTERS_RUN_BACKWARDS",wb="CHARACTERS_JUMP_LOOP",Zb="CHARACTERS_WALK_STRAFE_LEFT",Eb="CHARACTERS_WALK_STRAFE_RIGHT",Mb="CHARACTERS_RUN_STRAFE_LEFT",Sb="CHARACTERS_RUN_STRAFE_RIGHT",Cb="CHARACTERS_RIFLE_IDLE",Nb="CHARACTERS_RIFLE_WALK",Ab="CHARACTERS_RIFLE_WALK_BACKWARDS",Lb="CHARACTERS_RIFLE_RUN",Bb="CHARACTERS_RIFLE_RUN_BACKWARDS",Tb="CHARACTERS_RIFLE_JUMP_LOOP",Vb="CHARACTERS_RIFLE_STRAFE_LEFT",kb="CHARACTERS_RIFLE_STRAFE_RIGHT",Ib="CHARACTERS_PISTOL_IDLE",Ob="CHARACTERS_PISTOL_WALK",Rb="CHARACTERS_PISTOL_WALK_BACKWARDS",Hb="CHARACTERS_PISTOL_RUN",Fb="CHARACTERS_PISTOL_RUN_BACKWARDS",Db="CHARACTERS_PISTOL_STRAFE_LEFT",Gb="CHARACTERS_PISTOL_STRAFE_RIGHT",Ub="CHARACTERS_VICTORY",jb="CHARACTERS_DASH",Wb="LEVEL_GRAPHIC",qb="LEVEL_COLLISION",Jb="COIN",$b={textures:[{id:db.SKYBOX_1,url:"./assets/textures/skybox/left.webp"},{id:db.SKYBOX_2,url:"./assets/textures/skybox/right.webp"},{id:db.SKYBOX_3,url:"./assets/textures/skybox/up.webp"},{id:db.SKYBOX_4,url:"./assets/textures/skybox/down.webp"},{id:db.SKYBOX_5,url:"./assets/textures/skybox/front.webp"},{id:db.SKYBOX_6,url:"./assets/textures/skybox/back.webp"},{id:db.SMOKE,url:"./assets/textures/effects/smoke.webp"},{id:db.POINT,url:"./assets/textures/effects/point.webp"},{id:db.POLYGON_STARTER_01,url:"./assets/textures/polygon-starter-texture-01.webp"}],fbxModels:[{id:mb,url:"./assets/models/characters/model/characters.fbx",material:{materialType:ab}},{id:Pb,url:"./assets/models/weapons/sm-wep-water-gun-01.fbx",material:{texture:{id:db.POLYGON_STARTER_01}}},{id:fb,url:"./assets/models/weapons/sm-wep-water-gun-02.fbx",material:{texture:{id:db.POLYGON_STARTER_01}}},{id:xb,url:"./assets/models/weapons/sm-wep-water-pistol-01.fbx",material:{texture:{id:db.POLYGON_STARTER_01}}}],fbxSkeletonAnimations:[{id:yb,url:"./assets/models/characters/animations/idle.fbx"},{id:vb,url:"./assets/models/characters/animations/walk.fbx"},{id:gb,url:"./assets/models/characters/animations/walk-backwards.fbx"},{id:bb,url:"./assets/models/characters/animations/run.fbx"},{id:zb,url:"./assets/models/characters/animations/run-backwards.fbx"},{id:wb,url:"./assets/models/characters/animations/jump-loop.fbx"},{id:Zb,url:"./assets/models/characters/animations/walk-strafe-left.fbx"},{id:Eb,url:"./assets/models/characters/animations/walk-strafe-right.fbx"},{id:Mb,url:"./assets/models/characters/animations/run-strafe-left.fbx"},{id:Sb,url:"./assets/models/characters/animations/run-strafe-right.fbx"},{id:Cb,url:"./assets/models/characters/animations/rifle-idle.fbx"},{id:Nb,url:"./assets/models/characters/animations/rifle-walk.fbx"},{id:Ab,url:"./assets/models/characters/animations/rifle-walk-backwards.fbx"},{id:Lb,url:"./assets/models/characters/animations/rifle-run.fbx"},{id:Bb,url:"./assets/models/characters/animations/rifle-run-backwards.fbx"},{id:Tb,url:"./assets/models/characters/animations/rifle-jump-loop.fbx"},{id:Vb,url:"./assets/models/characters/animations/rifle-strafe-left.fbx"},{id:kb,url:"./assets/models/characters/animations/rifle-strafe-right.fbx"},{id:Ib,url:"./assets/models/characters/animations/pistol-idle.fbx"},{id:Ob,url:"./assets/models/characters/animations/pistol-walk.fbx"},{id:Rb,url:"./assets/models/characters/animations/pistol-walk-backwards.fbx"},{id:Hb,url:"./assets/models/characters/animations/pistol-run.fbx"},{id:Fb,url:"./assets/models/characters/animations/pistol-run-backwards.fbx"},{id:Db,url:"./assets/models/characters/animations/pistol-strafe-left.fbx"},{id:Gb,url:"./assets/models/characters/animations/pistol-strafe-right.fbx"},{id:Ub,url:"./assets/models/characters/animations/victory.fbx"},{id:jb,url:"./assets/models/characters/animations/dash.fbx"}],gltfModels:[{id:Wb,url:"./assets/models/world/arena-graphic.glb"},{id:qb,url:"./assets/models/world/arena-collision.glb"},{id:Jb,url:"./assets/models/collectibles/sm-polygon-prototype-icon-coin-01.glb",material:{color:16652161}}],audio:[{id:"GAME_BACKGROUND",url:"./assets/audio/music/game-theme.ogg"}]},Xb="SHOOTING",Yb="SHOOTING_2",Kb="BULLET",Qb="BULLET_EXPLOSION",ez="EXPLOSION_SMOKE",tz="EXPLOSION_FIRE",nz="DASH",iz="ACTIVATE_COIN",rz="COLLECT_COIN",oz="COLLECT_COIN_LARGE",az="TELEPORT_POINT",sz="TELEPORT_ACTIVATE",lz="CAR_SMOG",pz="DUST",uz="COLLECTIBLE_CIRCLE",hz="COLLECTIBLE_COLLECT",cz="SNAKE_EXPLOSION",_z="WHEEL_SMOKE",dz="WHEEL_SMOKE_SMALL",mz="SMOKE",Pz="INTENSE_SMOKE",fz={[Xb]:{looping:!1,duration:.1,startLifetime:{min:.3,max:.5},startSpeed:{min:6,max:12},startSize:{min:.2,max:.4},startRotation:{min:-360,max:360},startColor:{min:{r:.9098039215686274,g:.9019607843137255,b:.9372549019607843},max:{r:.4980392156862745,g:.4588235294117647,b:.7803921568627451}},gravity:.2,simulationSpace:"WORLD",maxParticles:15,emission:{rateOverTime:100},shape:{shape:"CONE",cone:{angle:2,radius:1e-4}},renderer:{blending:"THREE.NormalBlending"},sizeOverLifetime:{isActive:!0,bezierPoints:[{x:0,y:.3,percentage:0},{x:0,y:.8,percentage:.4},{x:1,y:1,percentage:1}]},opacityOverLifetime:{isActive:!0,bezierPoints:[{x:0,y:1,percentage:0},{x:0,y:.5,percentage:.5},{x:1,y:0,percentage:1}]},_editorData:{textureId:"POINT",simulation:{movements:"DISABLED",movementSpeed:1},showLocalAxes:!1,showWorldAxes:!1,terrain:{textureId:"WIREFRAME",movements:"DISABLED",movementSpeed:1}},map:db.POINT},[Yb]:{duration:.25,looping:!1,startLifetime:{min:.2,max:.5},startSpeed:{min:.8,max:5},startSize:{min:.1,min:.3},startColor:{min:{r:.9725490196078431,g:.050980392156862744,b:.050980392156862744},max:{r:.9921568627450981,g:.7803921568627451,b:.03137254901960784}},maxParticles:25,emission:{rateOverTime:50},shape:{shape:"CONE",sphere:{radius:.4,arc:180},cone:{angle:11.3007,radius:.1}},renderer:{blending:"THREE.NormalBlending"},sizeOverLifetime:{bezierPoints:[{x:0,y:1,percentage:0},{x:.1666,y:.8333},{x:.3666,y:.8566},{x:.5333,y:.6899,percentage:.5333},{x:.6999,y:.5232},{x:.8333,y:.5914},{x:1,y:.425,percentage:1}]},opacityOverLifetime:{isActive:!0,bezierPoints:[{x:0,y:1,percentage:0},{x:.1666,y:.8333},{x:.3333,y:.6666},{x:.5,y:.5,percentage:.5},{x:.6666,y:.3332},{x:.8333,y:.1665},{x:1,y:0,percentage:1}]},rotationOverLifetime:{min:-22.4,max:24.3},noise:{strength:.09,positionAmount:.191},_editorData:{textureId:"SQUARE",simulation:{movements:"DISABLED",movementSpeed:1,rotation:"DISABLED",rotationSpeed:1},showLocalAxes:!1,showWorldAxes:!1,frustumCulled:!0,terrain:{textureId:"WIREFRAME",movements:"DISABLED",movementSpeed:1,rotation:"DISABLED",rotationSpeed:1}},map:db.POINT},[Kb]:{startLifetime:{min:.05,max:.3},startSpeed:{min:0,max:0},startSize:{min:.5,max:.5},startOpacity:{min:.5,max:.5},startColor:{min:{r:.9098039215686274,g:.9019607843137255,b:.9372549019607843},max:{r:.4980392156862745,g:.4588235294117647,b:.7803921568627451}},simulationSpace:"WORLD",maxParticles:25,emission:{rateOverDistance:10},shape:{shape:"CONE",cone:{angle:8.1528,radius:1e-4}},renderer:{blending:"THREE.NormalBlending"},sizeOverLifetime:{isActive:!0,bezierPoints:[{x:0,y:1,percentage:0},{x:.1666,y:.8333},{x:.3333,y:.6666},{x:.5,y:.5,percentage:.5},{x:.6666,y:.3332},{x:.8333,y:.1665},{x:1,y:0,percentage:1}]},opacityOverLifetime:{isActive:!0,bezierPoints:[{x:0,y:1,percentage:0},{x:.1666,y:.8333},{x:.3333,y:.6666},{x:.5,y:.5,percentage:.5},{x:.6666,y:.3332},{x:.8333,y:.1665},{x:1,y:0,percentage:1}]},map:db.POINT},BULLET_EXPLOSION_SMOKE:{duration:.25,looping:!1,startLifetime:{min:.3,max:1},startSpeed:{min:.05,max:.3},startSize:{min:5,max:10},startRotation:{min:-360,max:360},startOpacity:{min:.3,max:.5},gravity:-.05,maxParticles:5,emission:{rateOverTime:20},shape:{sphere:{radius:1e-4}},renderer:{blending:"THREE.NormalBlending"},sizeOverLifetime:{isActive:!0,bezierPoints:[{x:0,y:0,percentage:0},{x:.3333,y:0},{x:.1666,y:1},{x:.5,y:1,percentage:.5},{x:.8333,y:1},{x:.6666,y:.5449},{x:1,y:.5449,percentage:1}]},opacityOverLifetime:{isActive:!0,bezierPoints:[{x:0,y:0,percentage:0},{x:0,y:1},{x:0,y:1},{x:.5,y:1,percentage:.5},{x:1,y:1},{x:1,y:1.0149},{x:1,y:.015,percentage:1}]},map:db.POINT,_editorData:{textureId:"CLOUD",simulation:{movements:"DISABLED"},showLocalAxes:!1,showWorldAxes:!1,terrain:{textureId:"WIREFRAME",movements:"DISABLED"}}},[Qb]:{duration:.2,looping:!1,startLifetime:{min:.3,max:.8},startSpeed:{max:1.5},startSize:{min:.2,max:.4},startColor:{min:{r:.9098039215686274,g:.9019607843137255,b:.9372549019607843},max:{r:.4980392156862745,g:.4588235294117647,b:.7803921568627451}},gravity:2,maxParticles:15,emission:{rateOverTime:40},shape:{sphere:{radius:.01,arc:180}},renderer:{blending:"THREE.NormalBlending"},sizeOverLifetime:{isActive:!0,bezierPoints:[{x:0,y:.7,percentage:0},{x:.1666,y:.5333},{x:.5633,y:1.0566},{x:.73,y:.89,percentage:.73},{x:.8966,y:.7233},{x:.8333,y:.1665},{x:1,y:0,percentage:1}]},opacityOverLifetime:{isActive:!0,bezierPoints:[{x:0,y:.7,percentage:0},{x:.18,y:.77},{x:.5633,y:1.0566},{x:.73,y:.89,percentage:.73},{x:.8966,y:.7233},{x:.8333,y:.1665},{x:1,y:0,percentage:1}]},_editorData:{textureId:"POINT",simulation:{movements:"DISABLED"},showLocalAxes:!1,showWorldAxes:!1,terrain:{textureId:"WIREFRAME",movements:"DISABLED"}},map:db.POINT},CRATE_EXPLOSION:{duration:.3,looping:!1,startLifetime:{min:.4,max:1},startSpeed:{min:2,max:7},startSize:{min:.5,max:4},startColor:{min:{r:.1,g:.1,b:.1},max:{r:.2,g:.2,b:.2}},gravity:.06,maxParticles:50,emission:{rateOverTime:200},shape:{sphere:{radius:.2939,arc:180}},sizeOverLifetime:{bezierPoints:[{x:0,y:0,percentage:0},{x:1,y:1,percentage:1}]},opacityOverLifetime:{isActive:!0,bezierPoints:[{x:0,y:.825,percentage:0},{x:.2033,y:.97},{x:.47,y:.985},{x:.7133,y:.965,percentage:.7133},{x:.9132,y:.9485},{x:.8333,y:.1665},{x:1,y:0,percentage:1}]},_editorData:{textureId:"POINT",simulation:{movements:"DISABLED"},showLocalAxes:!1,showWorldAxes:!1,terrain:{textureId:"WIREFRAME",movements:"DISABLED"}},textureSheetAnimation:{tiles:{x:2,y:2},timeMode:"FPS",fps:0,startFrame:{max:4}},map:db.GROUND_DEBRIS},[ez]:{duration:.5,looping:!1,startLifetime:{min:.3,max:1.5},startSpeed:{min:.11,max:.85},startSize:{min:8,max:15},startRotation:{min:-360,max:360},startColor:{min:{r:.1,g:.1,b:.1},max:{r:.2,g:.2,b:.2}},gravity:-.29,maxParticles:10,emission:{rateOverTime:500},shape:{sphere:{radius:.0315,arc:180}},renderer:{blending:"THREE.NormalBlending"},sizeOverLifetime:{isActive:!0,bezierPoints:[{x:0,y:0,percentage:0},{x:0,y:1},{x:0,y:1},{x:.5,y:1,percentage:.5},{x:1,y:1},{x:1,y:1},{x:1,y:0,percentage:1}]},opacityOverLifetime:{isActive:!0,bezierPoints:[{x:0,y:1,percentage:0},{x:.1666,y:.8333},{x:.3333,y:.6666},{x:.5,y:.5,percentage:.5},{x:.6666,y:.3332},{x:.8333,y:.1665},{x:1,y:0,percentage:1}]},rotationOverLifetime:{isActive:!0,min:-22.4,max:24.3},noise:{isActive:!0,useRandomOffset:!0,strength:.09,positionAmount:.191,rotationAmount:1.677},_editorData:{textureId:"CLOUD",simulation:{movements:"DISABLED",movementSpeed:1,rotation:"DISABLED",rotationSpeed:1},showLocalAxes:!1,showWorldAxes:!1,frustumCulled:!0,terrain:{textureId:"WIREFRAME",movements:"DISABLED",movementSpeed:1,rotation:"DISABLED",rotationSpeed:1}},map:db.POINT},[tz]:{duration:.4,looping:!1,startLifetime:{min:.2,max:.5},startSpeed:{min:.5,max:1},startSize:{min:2,max:6},startRotation:{min:-360,max:360},startOpacity:{min:1,max:1},startColor:{min:{r:.9725490196078431,g:.050980392156862744,b:.050980392156862744},max:{r:.9921568627450981,g:.7803921568627451,b:.03137254901960784}},gravity:-.004,maxParticles:10,emission:{rateOverTime:200},shape:{sphere:{radius:.2,arc:180}},renderer:{blending:"THREE.NormalBlending"},sizeOverLifetime:{isActive:!0,bezierPoints:[{x:0,y:0,percentage:0},{x:0,y:1},{x:0,y:1},{x:.5,y:1,percentage:.5},{x:1,y:1},{x:1,y:1},{x:1,y:0,percentage:1}]},opacityOverLifetime:{isActive:!0,bezierPoints:[{x:0,y:1,percentage:0},{x:.1666,y:.8333},{x:.3333,y:.6666},{x:.5,y:.5,percentage:.5},{x:.6666,y:.3332},{x:.8333,y:.1665},{x:1,y:0,percentage:1}]},rotationOverLifetime:{isActive:!0,min:-22.4,max:24.3},noise:{isActive:!0,useRandomOffset:!0,strength:.09,positionAmount:.191,rotationAmount:1.677},_editorData:{textureId:"CLOUD",simulation:{movements:"DISABLED"},showLocalAxes:!1,showWorldAxes:!1,terrain:{textureId:"WIREFRAME",movements:"DISABLED"}},map:db.POINT},[nz]:{transform:{position:{y:.8},rotation:{y:0}},duration:.36,looping:!1,startLifetime:{min:.01,max:.67},startSpeed:{min:0,max:0},simulationSpace:"WORLD",maxParticles:25,emission:{rateOverTime:100},shape:{shape:"RECTANGLE",rectangle:{scale:{x:.5,y:1.8}}},renderer:{blending:"THREE.AdditiveBlending"},startSize:{min:.2,max:.4},sizeOverLifetime:{bezierPoints:[{x:0,y:0,percentage:0},{x:1,y:1,percentage:1}]},opacityOverLifetime:{isActive:!0,bezierPoints:[{x:0,y:1,percentage:0},{x:.1666,y:.8333},{x:.3333,y:.6666},{x:.5,y:.5,percentage:.5},{x:.6666,y:.3332},{x:.8333,y:.1665},{x:1,y:0,percentage:1}]},_editorData:{textureId:"POINT",simulation:{movements:"DISABLED",movementSpeed:1.3},showLocalAxes:!1,showWorldAxes:!1,terrain:{textureId:"WIREFRAME",movements:"DISABLED",movementSpeed:1}},map:db.POINT},[iz]:{transform:{rotation:{x:-90}},duration:.4,looping:!1,startLifetime:{min:.2,max:.6},startSpeed:{min:.8,max:1.5},startSize:{min:.1,max:2},startColor:{min:{r:.596078431372549,g:.08235294117647059,b:.9372549019607843},max:{g:0,b:.8666666666666667}},gravity:-2,maxParticles:30,emission:{rateOverTime:100},shape:{sphere:{radius:.05,radiusThickness:.5},cone:{angle:17.5967,radius:.1}},renderer:{blending:"THREE.NormalBlending"},velocityOverLifetime:{isActive:!0,orbital:{x:{min:-25,max:25},y:{min:-25,max:25},z:{min:-5,max:5}}},sizeOverLifetime:{isActive:!0,bezierPoints:[{x:0,y:0,percentage:0},{x:.3333,y:0},{x:.1666,y:1},{x:.5,y:1,percentage:.5},{x:.8333,y:1},{x:.6666,y:0},{x:1,y:0,percentage:1}]},opacityOverLifetime:{isActive:!0,bezierPoints:[{x:0,y:0,percentage:0},{x:0,y:1},{x:0,y:1},{x:.5,y:1,percentage:.5},{x:1,y:1},{x:1,y:1},{x:1,y:0,percentage:1}]},_editorData:{textureId:"POINT",simulation:{movements:"DISABLED",movementSpeed:1,rotation:"DISABLED",rotationSpeed:1},showLocalAxes:!1,showWorldAxes:!1,frustumCulled:!0,terrain:{textureId:"WIREFRAME",movements:"DISABLED",movementSpeed:1,rotation:"DISABLED",rotationSpeed:1}},map:db.POINT},[rz]:{transform:{rotation:{x:-90}},duration:.2,looping:!1,startLifetime:{min:.3,max:.8},startSpeed:{min:.5},startSize:{min:.1,max:1.5},startColor:{min:{r:.596078431372549,g:.08235294117647059,b:.9372549019607843},max:{g:0,b:.8666666666666667}},maxParticles:30,emission:{rateOverTime:200},shape:{sphere:{radius:.4},cone:{angle:17.5967,radius:.1}},renderer:{blending:"THREE.NormalBlending"},velocityOverLifetime:{isActive:!0,orbital:{y:{max:5}}},sizeOverLifetime:{bezierPoints:[{x:0,y:0,percentage:0},{x:.3333,y:0},{x:.1666,y:1},{x:.5,y:1,percentage:.5},{x:.8333,y:1},{x:.6666,y:0},{x:1,y:0,percentage:1}]},opacityOverLifetime:{isActive:!0,bezierPoints:[{x:0,y:0,percentage:0},{x:0,y:1},{x:0,y:1},{x:.5,y:1,percentage:.5},{x:1,y:1},{x:1,y:1},{x:1,y:0,percentage:1}]},_editorData:{textureId:"POINT",simulation:{movements:"DISABLED",movementSpeed:1,rotation:"DISABLED",rotationSpeed:1},showLocalAxes:!1,showWorldAxes:!1,frustumCulled:!0,terrain:{textureId:"WIREFRAME",movements:"DISABLED",movementSpeed:1,rotation:"DISABLED",rotationSpeed:1}},map:db.POINT},[oz]:{transform:{rotation:{x:-90}},duration:.2,looping:!1,startLifetime:{min:.3,max:.8},startSpeed:{min:5,max:10},startSize:{min:1,max:10},startColor:{min:{r:.596078431372549,g:.08235294117647059,b:.9372549019607843},max:{g:0,b:.8666666666666667}},maxParticles:30,emission:{rateOverTime:200},shape:{sphere:{radius:.4},cone:{angle:17.5967,radius:.1}},renderer:{blending:"THREE.NormalBlending"},velocityOverLifetime:{isActive:!0,orbital:{y:{max:5}}},sizeOverLifetime:{bezierPoints:[{x:0,y:0,percentage:0},{x:.3333,y:0},{x:.1666,y:1},{x:.5,y:1,percentage:.5},{x:.8333,y:1},{x:.6666,y:0},{x:1,y:0,percentage:1}]},opacityOverLifetime:{isActive:!0,bezierPoints:[{x:0,y:0,percentage:0},{x:0,y:1},{x:0,y:1},{x:.5,y:1,percentage:.5},{x:1,y:1},{x:1,y:1},{x:1,y:0,percentage:1}]},_editorData:{textureId:"POINT",simulation:{movements:"DISABLED",movementSpeed:1,rotation:"DISABLED",rotationSpeed:1},showLocalAxes:!1,showWorldAxes:!1,frustumCulled:!0,terrain:{textureId:"WIREFRAME",movements:"DISABLED",movementSpeed:1,rotation:"DISABLED",rotationSpeed:1}},map:db.POINT},[az]:{transform:{rotation:{x:-90}},duration:1,startLifetime:{min:.8,max:.8},startSpeed:{min:0,max:0},startSize:{min:.2},startColor:{min:{r:.9137254901960784,g:.42745098039215684,b:.027450980392156862},max:{b:0}},gravity:-.64,maxParticles:15,emission:{rateOverTime:20},shape:{shape:"CIRCLE",circle:{radius:.75,radiusThickness:0}},velocityOverLifetime:{isActive:!0,orbital:{y:{min:-1,max:2}}},sizeOverLifetime:{bezierPoints:[{x:0,y:0,percentage:0},{x:1,y:1,percentage:1}]},opacityOverLifetime:{bezierPoints:[{x:0,y:0,percentage:0},{x:1,y:1,percentage:1}]},_editorData:{textureId:"POINT",simulation:{movements:"DISABLED",movementSpeed:1,rotation:"DISABLED",rotationSpeed:1},showLocalAxes:!1,showWorldAxes:!1,frustumCulled:!0,terrain:{textureId:"WIREFRAME",movements:"DISABLED",movementSpeed:1,rotation:"DISABLED",rotationSpeed:1}},map:db.POINT},[sz]:{transform:{rotation:{x:-90}},duration:1,looping:!1,startLifetime:{min:.8,max:.8},startSpeed:{min:0,max:0},startSize:{min:.2},startColor:{min:{r:.9137254901960784,g:.42745098039215684,b:.027450980392156862},max:{b:0}},gravity:-10,maxParticles:50,emission:{rateOverTime:80},shape:{shape:"CIRCLE",circle:{radius:.75,radiusThickness:0}},velocityOverLifetime:{isActive:!0,orbital:{x:{min:-1,max:1},y:{min:-5,max:2}}},sizeOverLifetime:{bezierPoints:[{x:0,y:0,percentage:0},{x:1,y:1,percentage:1}]},opacityOverLifetime:{bezierPoints:[{x:0,y:0,percentage:0},{x:1,y:1,percentage:1}]},_editorData:{textureId:"GRADIENT_POINT",simulation:{movements:"DISABLED",movementSpeed:1,rotation:"DISABLED",rotationSpeed:1},showLocalAxes:!1,showWorldAxes:!1,frustumCulled:!0,terrain:{textureId:"WIREFRAME",movements:"DISABLED",movementSpeed:1,rotation:"DISABLED",rotationSpeed:1}},map:db.POINT},[lz]:{duration:.36,startLifetime:{min:.3,max:.6},startSpeed:{min:.5,max:1.5},startSize:{min:2,max:3},gravity:-.64,maxParticles:10,emission:{rateOverTime:30},shape:{shape:"CONE",cone:{angle:16.8097,radius:.05}},renderer:{blending:"THREE.NormalBlending"},opacityOverLifetime:{isActive:!0,bezierPoints:[{x:0,y:1,percentage:0},{x:.1666,y:.6333},{x:.3333,y:.4666},{x:.5,y:.3,percentage:.5},{x:.6666,y:.1332},{x:.8333,y:.0665},{x:1,y:0,percentage:1}]},noise:{isActive:!0,strength:.1,positionAmount:.278},_editorData:{textureId:"CLOUD",simulation:{movements:"CIRCLE",movementSpeed:3.9,rotation:"FOLLOW_THE_MOVEMENT",rotationSpeed:0},showLocalAxes:!0,showWorldAxes:!1,frustumCulled:!0,terrain:{textureId:"WIREFRAME",movements:"DISABLED",movementSpeed:1,rotation:"DISABLED",rotationSpeed:1}},map:db.SMOKE},[pz]:{transform:{position:{y:1},scale:{x:80,z:52}},startLifetime:{min:1,max:4},startSpeed:{min:0,max:0},startSize:{min:.8,max:1.5},startRotation:{min:-360,max:360},startColor:{max:{r:.8392156862745098,g:.9098039215686274,b:.611764705882353}},maxParticles:200,emission:{rateOverTime:50},shape:{shape:"BOX",sphere:{radius:2.9127},rectangle:{scale:{x:7.682,y:7.504}}},renderer:{blending:"THREE.NormalBlending"},sizeOverLifetime:{isActive:!0,bezierPoints:[{x:0,y:0,percentage:0},{x:0,y:1},{x:0,y:1},{x:.5,y:1,percentage:.5},{x:1,y:1},{x:1,y:1},{x:1,y:0,percentage:1}]},opacityOverLifetime:{isActive:!0,bezierPoints:[{x:0,y:0,percentage:0},{x:.3333,y:0},{x:.1666,y:1},{x:.5,y:1,percentage:.5},{x:.8333,y:1},{x:.6666,y:0},{x:1,y:0,percentage:1}]},rotationOverLifetime:{isActive:!0,min:-170.2,max:231.9},noise:{isActive:!0,useRandomOffset:!0,strength:.05,frequency:.206,positionAmount:-.072},_editorData:{textureId:"GRADIENT_POINT",simulation:{movements:"DISABLED",movementSpeed:1,rotation:"DISABLED",rotationSpeed:1},showLocalAxes:!1,showWorldAxes:!1,frustumCulled:!0,terrain:{textureId:"WIREFRAME",movements:"DISABLED",movementSpeed:1,rotation:"DISABLED",rotationSpeed:1}},map:db.POINT},[uz]:{transform:{rotation:{x:-90}},startLifetime:{min:.4,max:1.22},startSpeed:{min:.39,max:.66},startSize:{min:.8,max:1.5},startColor:{min:{r:.5803921568627451,g:.9372549019607843,b:.1450980392156863},max:{r:.6901960784313725,g:.9921568627450981,b:.38823529411764707}},maxParticles:10,emission:{rateOverTime:15},shape:{shape:"CIRCLE",sphere:{radius:.5,radiusThickness:0},circle:{radius:.5,radiusThickness:0}},renderer:{blending:"THREE.NormalBlending"},velocityOverLifetime:{orbital:{x:{min:-2,max:2},y:{min:-2,max:2},z:{min:-2,max:2}}},sizeOverLifetime:{bezierPoints:[{x:0,y:0,percentage:0},{x:.1666,y:.1665},{x:.3333,y:.3332},{x:.5,y:.5,percentage:.5},{x:.6666,y:.6666},{x:.8333,y:.8333},{x:1,y:1,percentage:1}]},opacityOverLifetime:{isActive:!0,bezierPoints:[{x:0,y:1,percentage:0},{x:.1666,y:.8333},{x:.6533,y:.9566},{x:.82,y:.79,percentage:.82},{x:.9866,y:.6233},{x:.8333,y:.1665},{x:1,y:0,percentage:1}]},noise:{strength:.97,positionAmount:.191},textureSheetAnimation:{timeMode:"FPS",fps:0},_editorData:{textureId:"POINT",simulation:{movements:"DISABLED",movementSpeed:1,rotation:"DISABLED",rotationSpeed:1},showLocalAxes:!0,showWorldAxes:!0,frustumCulled:!0,terrain:{textureId:"WIREFRAME",movements:"DISABLED",movementSpeed:1,rotation:"DISABLED",rotationSpeed:1}},map:db.POINT},[hz]:{transform:{rotation:{x:-90}},duration:.3,looping:!1,startLifetime:{min:.67,max:1.77},startSpeed:{min:1.21,max:2.85},startSize:{min:1.29,max:2.2},startRotation:{min:-360,max:360},startColor:{min:{r:.5803921568627451,g:.9372549019607843,b:.1450980392156863},max:{r:.6901960784313725,g:.9921568627450981,b:.38823529411764707}},gravity:5.5,maxParticles:10,emission:{rateOverTime:30},shape:{shape:"CONE",cone:{angle:47.5024,radius:.5562}},sizeOverLifetime:{bezierPoints:[{x:0,y:0,percentage:0},{x:1,y:1,percentage:1}]},opacityOverLifetime:{isActive:!0,bezierPoints:[{x:0,y:1,percentage:0},{x:.1666,y:.8333},{x:.6366,y:1.0466},{x:.8033,y:.88,percentage:.8033},{x:.9699,y:.7133},{x:.8333,y:.1665},{x:1,y:0,percentage:1}]},rotationOverLifetime:{isActive:!0,min:-342.5,max:299},textureSheetAnimation:{timeMode:"FPS",fps:0,startFrame:{max:10}},_editorData:{textureId:"POINT",simulation:{movements:"DISABLED",movementSpeed:1,rotation:"DISABLED",rotationSpeed:1},showLocalAxes:!1,showWorldAxes:!1,frustumCulled:!0,terrain:{textureId:"WIREFRAME",movements:"DISABLED",movementSpeed:1,rotation:"DISABLED",rotationSpeed:1}},map:db.POINT},[cz]:{duration:.2,looping:!1,startLifetime:{min:.12,max:.6},startSpeed:{min:.5,max:1.5},startSize:{min:2,max:6.5},startRotation:{min:-360,max:360},startColor:{min:{r:.11764705882352941,g:.4196078431372549,b:.12549019607843137},max:{r:.9921568627450981,g:.9607843137254902,b:.050980392156862744}},gravity:-.5,maxParticles:30,emission:{rateOverTime:500},shape:{sphere:{radius:.4,arc:180}},renderer:{blending:"THREE.NormalBlending"},sizeOverLifetime:{isActive:!0,bezierPoints:[{x:0,y:0,percentage:0},{x:0,y:1},{x:0,y:1},{x:.5,y:1,percentage:.5},{x:1,y:1},{x:1,y:1},{x:1,y:0,percentage:1}]},opacityOverLifetime:{isActive:!0,bezierPoints:[{x:0,y:1,percentage:0},{x:.1666,y:.8333},{x:.3333,y:.6666},{x:.5,y:.5,percentage:.5},{x:.6666,y:.3332},{x:.8333,y:.1665},{x:1,y:0,percentage:1}]},rotationOverLifetime:{isActive:!0,min:-22.4,max:24.3},noise:{isActive:!0,useRandomOffset:!0,strength:.09,positionAmount:.191,rotationAmount:1.677},_editorData:{textureId:"POINT",simulation:{movements:"DISABLED",movementSpeed:1,rotation:"DISABLED",rotationSpeed:1},showLocalAxes:!1,showWorldAxes:!1,frustumCulled:!0,terrain:{textureId:"WIREFRAME",movements:"DISABLED",movementSpeed:1,rotation:"DISABLED",rotationSpeed:1}},map:db.POINT},[_z]:{duration:.36,startLifetime:{min:.3,max:.7},startSpeed:{min:.93,max:1.76},startSize:{min:34.19,max:42.42},gravity:-.64,simulationSpace:"WORLD",maxParticles:30,emission:{rateOverTime:0,rateOverDistance:10},shape:{shape:"CONE",cone:{angle:16.8097,radius:.1},rectangle:{scale:{x:.5,y:1.8}}},renderer:{blending:"THREE.NormalBlending"},sizeOverLifetime:{isActive:!0,bezierPoints:[{x:0,y:.245,percentage:0},{x:.1666,y:.4116},{x:.3766,y:.2182},{x:.5433,y:.385,percentage:.5433},{x:.7099,y:.5516},{x:.8333,y:.8333},{x:1,y:1,percentage:1}]},opacityOverLifetime:{isActive:!0,bezierPoints:[{x:0,y:1,percentage:0},{x:.1666,y:.8333},{x:.3333,y:.6666},{x:.5,y:.5,percentage:.5},{x:.6666,y:.3332},{x:.8333,y:.1665},{x:1,y:0,percentage:1}]},noise:{isActive:!0,strength:.3,positionAmount:.278},_editorData:{textureId:"CLOUD",simulation:{movements:"PROJECTILE_STRAIGHT",movementSpeed:3.9,rotation:"FOLLOW_THE_MOVEMENT",rotationSpeed:0},showLocalAxes:!0,showWorldAxes:!1,frustumCulled:!0,terrain:{textureId:"WIREFRAME",movements:"DISABLED",movementSpeed:1,rotation:"DISABLED",rotationSpeed:1}},map:db.POINT},[dz]:{duration:.36,startLifetime:{min:.3,max:1},startSpeed:{min:.3,max:.9},startSize:{min:4,max:9},gravity:-.64,simulationSpace:"WORLD",maxParticles:20,emission:{rateOverTime:0,rateOverDistance:4},shape:{shape:"CONE",cone:{angle:16.8097,radius:.1}},renderer:{blending:"THREE.NormalBlending"},sizeOverLifetime:{isActive:!0,bezierPoints:[{x:0,y:.245,percentage:0},{x:.1666,y:.4116},{x:.3766,y:.2182},{x:.5433,y:.385,percentage:.5433},{x:.7099,y:.5516},{x:.8333,y:.8333},{x:1,y:1,percentage:1}]},opacityOverLifetime:{isActive:!0,bezierPoints:[{x:0,y:1,percentage:0},{x:.1666,y:.8333},{x:.3333,y:.6666},{x:.5,y:.5,percentage:.5},{x:.6666,y:.3332},{x:.8333,y:.1665},{x:1,y:0,percentage:1}]},noise:{isActive:!0,strength:.3,positionAmount:.278},_editorData:{textureId:"CLOUD",simulation:{movements:"PROJECTILE_STRAIGHT",movementSpeed:3.9,rotation:"FOLLOW_THE_MOVEMENT",rotationSpeed:0},showLocalAxes:!0,showWorldAxes:!1,frustumCulled:!0,terrain:{textureId:"WIREFRAME",movements:"DISABLED",movementSpeed:1,rotation:"DISABLED",rotationSpeed:1}},map:db.POINT},[mz]:{transform:{rotation:{x:-90}},startLifetime:{min:4.23,max:7.25},startSpeed:{min:.11,max:.39},startSize:{min:7.68,max:13.17},startRotation:{min:-360,max:360},startColor:{min:{r:.3215686274509804,g:.3215686274509804,b:.3215686274509804},max:{r:.12941176470588237,g:.12941176470588237,b:.12941176470588237}},startOpacity:{min:.296,max:.461},simulationSpace:"WORLD",maxParticles:12,emission:{rateOverTime:4},shape:{shape:"CONE",sphere:{radius:.4687},cone:{angle:0,radius:.3813}},renderer:{blending:"THREE.NormalBlending"},sizeOverLifetime:{isActive:!0,bezierPoints:[{x:0,y:.625,percentage:0},{x:.2666,y:.845},{x:.3596,y:.4551},{x:.5066,y:.49,percentage:.5066},{x:.6966,y:.5349},{x:.6366,y:.99},{x:1,y:1,percentage:1}]},opacityOverLifetime:{isActive:!0,bezierPoints:[{x:0,y:.0799,percentage:0},{x:.0666,y:.85},{x:.1674,y:1.0337},{x:.5,y:1,percentage:.5},{x:.9933,y:.95},{x:.9966,y:.96},{x:1,y:0,percentage:1}]},rotationOverLifetime:{isActive:!0,min:-22.4,max:24.3},noise:{isActive:!0,useRandomOffset:!0,strength:.09,positionAmount:.191,rotationAmount:1.677},_editorData:{textureId:"POINT",simulation:{movements:"DISABLED",movementSpeed:1,rotation:"DISABLED",rotationSpeed:1},showLocalAxes:!1,showWorldAxes:!1,frustumCulled:!0,terrain:{textureId:"TERRAIN_DIRT",movements:"DISABLED",movementSpeed:1,rotation:"DISABLED",rotationSpeed:1}},map:db.POINT},[Pz]:{transform:{rotation:{x:-90}},startLifetime:{min:.94,max:2.31},startSpeed:{min:.11,max:1.21},startSize:{min:7.68,max:13.17},startRotation:{min:-360,max:360},startColor:{min:{r:.3215686274509804,g:.3215686274509804,b:.3215686274509804},max:{r:.12941176470588237,g:.12941176470588237,b:.12941176470588237}},startOpacity:{min:.57,max:.698},simulationSpace:"WORLD",maxParticles:12,emission:{rateOverTime:15},shape:{shape:"CONE",sphere:{radius:.4687},cone:{angle:0,radius:.3813}},renderer:{blending:"THREE.NormalBlending"},sizeOverLifetime:{isActive:!0,bezierPoints:[{x:0,y:.625,percentage:0},{x:.2666,y:.845},{x:.3596,y:.4551},{x:.5066,y:.49,percentage:.5066},{x:.6966,y:.5349},{x:.6366,y:.99},{x:1,y:1,percentage:1}]},opacityOverLifetime:{isActive:!0,bezierPoints:[{x:0,y:.0799,percentage:0},{x:.0666,y:.85},{x:.1674,y:1.0337},{x:.5,y:1,percentage:.5},{x:.9933,y:.95},{x:.9966,y:.96},{x:1,y:0,percentage:1}]},rotationOverLifetime:{isActive:!0,min:-22.4,max:24.3},noise:{isActive:!0,useRandomOffset:!0,strength:.09,positionAmount:.191,rotationAmount:1.677},_editorData:{textureId:"POINT",simulation:{movements:"DISABLED",movementSpeed:1,rotation:"DISABLED",rotationSpeed:1},showLocalAxes:!1,showWorldAxes:!1,frustumCulled:!0,terrain:{textureId:"TERRAIN_DIRT",movements:"DISABLED",movementSpeed:1,rotation:"DISABLED",rotationSpeed:1}},map:db.POINT}},xz="srgb",yz="srgb-linear",vz=7680;class gz{addEventListener(e,t){void 0===this._listeners&&(this._listeners={});const n=this._listeners;void 0===n[e]&&(n[e]=[]),-1===n[e].indexOf(t)&&n[e].push(t)}hasEventListener(e,t){if(void 0===this._listeners)return!1;const n=this._listeners;return void 0!==n[e]&&-1!==n[e].indexOf(t)}removeEventListener(e,t){if(void 0===this._listeners)return;const n=this._listeners[e];if(void 0!==n){const e=n.indexOf(t);-1!==e&&n.splice(e,1)}}dispatchEvent(e){if(void 0===this._listeners)return;const t=this._listeners[e.type];if(void 0!==t){e.target=this;const n=t.slice(0);for(let t=0,i=n.length;t<i;t++)n[t].call(this,e);e.target=null}}}const bz=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let zz=1234567;const wz=Math.PI/180,Zz=180/Math.PI;function Ez(){const e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,n=4294967295*Math.random()|0,i=4294967295*Math.random()|0;return(bz[255&e]+bz[e>>8&255]+bz[e>>16&255]+bz[e>>24&255]+"-"+bz[255&t]+bz[t>>8&255]+"-"+bz[t>>16&15|64]+bz[t>>24&255]+"-"+bz[63&n|128]+bz[n>>8&255]+"-"+bz[n>>16&255]+bz[n>>24&255]+bz[255&i]+bz[i>>8&255]+bz[i>>16&255]+bz[i>>24&255]).toLowerCase()}function Mz(e,t,n){return Math.max(t,Math.min(n,e))}function Sz(e,t){return(e%t+t)%t}function Cz(e,t,n){return(1-n)*e+n*t}function Nz(e,t){switch(t.constructor){case Float32Array:return e;case Uint16Array:return e/65535;case Uint8Array:return e/255;case Int16Array:return Math.max(e/32767,-1);case Int8Array:return Math.max(e/127,-1);default:throw new Error("Invalid component type.")}}function Az(e,t){switch(t.constructor){case Float32Array:return e;case Uint16Array:return Math.round(65535*e);case Uint8Array:return Math.round(255*e);case Int16Array:return Math.round(32767*e);case Int8Array:return Math.round(127*e);default:throw new Error("Invalid component type.")}}var Lz=Object.freeze({__proto__:null,DEG2RAD:wz,RAD2DEG:Zz,generateUUID:Ez,clamp:Mz,euclideanModulo:Sz,mapLinear:function(e,t,n,i,r){return i+(e-t)*(r-i)/(n-t)},inverseLerp:function(e,t,n){return e!==t?(n-e)/(t-e):0},lerp:Cz,damp:function(e,t,n,i){return Cz(e,t,1-Math.exp(-n*i))},pingpong:function(e,t=1){return t-Math.abs(Sz(e,2*t)-t)},smoothstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t))*e*(3-2*e)},smootherstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t))*e*e*(e*(6*e-15)+10)},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},seededRandom:function(e){void 0!==e&&(zz=e);let t=zz+=1831565813;return t=Math.imul(t^t>>>15,1|t),t^=t+Math.imul(t^t>>>7,61|t),((t^t>>>14)>>>0)/4294967296},degToRad:function(e){return e*wz},radToDeg:function(e){return e*Zz},isPowerOfTwo:function(e){return 0==(e&e-1)&&0!==e},ceilPowerOfTwo:function(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))},floorPowerOfTwo:function(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))},setQuaternionFromProperEuler:function(e,t,n,i,r){const o=Math.cos,a=Math.sin,s=o(n/2),l=a(n/2),p=o((t+i)/2),u=a((t+i)/2),h=o((t-i)/2),c=a((t-i)/2),_=o((i-t)/2),d=a((i-t)/2);switch(r){case"XYX":e.set(s*u,l*h,l*c,s*p);break;case"YZY":e.set(l*c,s*u,l*h,s*p);break;case"ZXZ":e.set(l*h,l*c,s*u,s*p);break;case"XZX":e.set(s*u,l*d,l*_,s*p);break;case"YXY":e.set(l*_,s*u,l*d,s*p);break;case"ZYZ":e.set(l*d,l*_,s*u,s*p);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+r)}},normalize:Az,denormalize:Nz});class Bz{constructor(e=0,t=0){Bz.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,n=this.y,i=e.elements;return this.x=i[0]*t+i[3]*n+i[6],this.y=i[1]*t+i[4]*n+i[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y;return t*t+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const n=Math.cos(t),i=Math.sin(t),r=this.x-e.x,o=this.y-e.y;return this.x=r*n-o*i+e.x,this.y=r*i+o*n+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class Tz{constructor(){Tz.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1]}set(e,t,n,i,r,o,a,s,l){const p=this.elements;return p[0]=e,p[1]=i,p[2]=a,p[3]=t,p[4]=r,p[5]=s,p[6]=n,p[7]=o,p[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],this}extractBasis(e,t,n){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,i=t.elements,r=this.elements,o=n[0],a=n[3],s=n[6],l=n[1],p=n[4],u=n[7],h=n[2],c=n[5],_=n[8],d=i[0],m=i[3],P=i[6],f=i[1],x=i[4],y=i[7],v=i[2],g=i[5],b=i[8];return r[0]=o*d+a*f+s*v,r[3]=o*m+a*x+s*g,r[6]=o*P+a*y+s*b,r[1]=l*d+p*f+u*v,r[4]=l*m+p*x+u*g,r[7]=l*P+p*y+u*b,r[2]=h*d+c*f+_*v,r[5]=h*m+c*x+_*g,r[8]=h*P+c*y+_*b,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[1],i=e[2],r=e[3],o=e[4],a=e[5],s=e[6],l=e[7],p=e[8];return t*o*p-t*a*l-n*r*p+n*a*s+i*r*l-i*o*s}invert(){const e=this.elements,t=e[0],n=e[1],i=e[2],r=e[3],o=e[4],a=e[5],s=e[6],l=e[7],p=e[8],u=p*o-a*l,h=a*s-p*r,c=l*r-o*s,_=t*u+n*h+i*c;if(0===_)return this.set(0,0,0,0,0,0,0,0,0);const d=1/_;return e[0]=u*d,e[1]=(i*l-p*n)*d,e[2]=(a*n-i*o)*d,e[3]=h*d,e[4]=(p*t-i*s)*d,e[5]=(i*r-a*t)*d,e[6]=c*d,e[7]=(n*s-l*t)*d,e[8]=(o*t-n*r)*d,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,n,i,r,o,a){const s=Math.cos(r),l=Math.sin(r);return this.set(n*s,n*l,-n*(s*o+l*a)+o+e,-i*l,i*s,-i*(-l*o+s*a)+a+t,0,0,1),this}scale(e,t){const n=this.elements;return n[0]*=e,n[3]*=e,n[6]*=e,n[1]*=t,n[4]*=t,n[7]*=t,this}rotate(e){const t=Math.cos(e),n=Math.sin(e),i=this.elements,r=i[0],o=i[3],a=i[6],s=i[1],l=i[4],p=i[7];return i[0]=t*r+n*s,i[3]=t*o+n*l,i[6]=t*a+n*p,i[1]=-n*r+t*s,i[4]=-n*o+t*l,i[7]=-n*a+t*p,this}translate(e,t){const n=this.elements;return n[0]+=e*n[2],n[3]+=e*n[5],n[6]+=e*n[8],n[1]+=t*n[2],n[4]+=t*n[5],n[7]+=t*n[8],this}equals(e){const t=this.elements,n=e.elements;for(let e=0;e<9;e++)if(t[e]!==n[e])return!1;return!0}fromArray(e,t=0){for(let n=0;n<9;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e}clone(){return(new this.constructor).fromArray(this.elements)}}function Vz(e){return document.createElementNS("http://www.w3.org/1999/xhtml",e)}function kz(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}function Iz(e){return e<.0031308?12.92*e:1.055*Math.pow(e,.41666)-.055}const Oz={[xz]:{[yz]:kz},[yz]:{[xz]:Iz}},Rz={legacyMode:!0,get workingColorSpace(){return yz},set workingColorSpace(e){console.warn("THREE.ColorManagement: .workingColorSpace is readonly.")},convert:function(e,t,n){if(this.legacyMode||t===n||!t||!n)return e;if(Oz[t]&&void 0!==Oz[t][n]){const i=Oz[t][n];return e.r=i(e.r),e.g=i(e.g),e.b=i(e.b),e}throw new Error("Unsupported color space conversion.")},fromWorkingColorSpace:function(e,t){return this.convert(e,this.workingColorSpace,t)},toWorkingColorSpace:function(e,t){return this.convert(e,t,this.workingColorSpace)}},Hz={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Fz={r:0,g:0,b:0},Dz={h:0,s:0,l:0},Gz={h:0,s:0,l:0};function Uz(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+6*(t-e)*(2/3-n):e}function jz(e,t){return t.r=e.r,t.g=e.g,t.b=e.b,t}class Wz{constructor(e,t,n){return this.isColor=!0,this.r=1,this.g=1,this.b=1,void 0===t&&void 0===n?this.set(e):this.setRGB(e,t,n)}set(e){return e&&e.isColor?this.copy(e):"number"==typeof e?this.setHex(e):"string"==typeof e&&this.setStyle(e),this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t="srgb"){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,Rz.toWorkingColorSpace(this,t),this}setRGB(e,t,n,i="srgb-linear"){return this.r=e,this.g=t,this.b=n,Rz.toWorkingColorSpace(this,i),this}setHSL(e,t,n,i="srgb-linear"){if(e=Sz(e,1),t=Mz(t,0,1),n=Mz(n,0,1),0===t)this.r=this.g=this.b=n;else{const i=n<=.5?n*(1+t):n+t-n*t,r=2*n-i;this.r=Uz(r,i,e+1/3),this.g=Uz(r,i,e),this.b=Uz(r,i,e-1/3)}return Rz.toWorkingColorSpace(this,i),this}setStyle(e,t="srgb"){function n(t){void 0!==t&&parseFloat(t)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let i;if(i=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(e)){let e;const r=i[1],o=i[2];switch(r){case"rgb":case"rgba":if(e=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return this.r=Math.min(255,parseInt(e[1],10))/255,this.g=Math.min(255,parseInt(e[2],10))/255,this.b=Math.min(255,parseInt(e[3],10))/255,Rz.toWorkingColorSpace(this,t),n(e[4]),this;if(e=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return this.r=Math.min(100,parseInt(e[1],10))/100,this.g=Math.min(100,parseInt(e[2],10))/100,this.b=Math.min(100,parseInt(e[3],10))/100,Rz.toWorkingColorSpace(this,t),n(e[4]),this;break;case"hsl":case"hsla":if(e=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o)){const i=parseFloat(e[1])/360,r=parseFloat(e[2])/100,o=parseFloat(e[3])/100;return n(e[4]),this.setHSL(i,r,o,t)}}}else if(i=/^\#([A-Fa-f\d]+)$/.exec(e)){const e=i[1],n=e.length;if(3===n)return this.r=parseInt(e.charAt(0)+e.charAt(0),16)/255,this.g=parseInt(e.charAt(1)+e.charAt(1),16)/255,this.b=parseInt(e.charAt(2)+e.charAt(2),16)/255,Rz.toWorkingColorSpace(this,t),this;if(6===n)return this.r=parseInt(e.charAt(0)+e.charAt(1),16)/255,this.g=parseInt(e.charAt(2)+e.charAt(3),16)/255,this.b=parseInt(e.charAt(4)+e.charAt(5),16)/255,Rz.toWorkingColorSpace(this,t),this}return e&&e.length>0?this.setColorName(e,t):this}setColorName(e,t="srgb"){const n=Hz[e.toLowerCase()];return void 0!==n?this.setHex(n,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=kz(e.r),this.g=kz(e.g),this.b=kz(e.b),this}copyLinearToSRGB(e){return this.r=Iz(e.r),this.g=Iz(e.g),this.b=Iz(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e="srgb"){return Rz.fromWorkingColorSpace(jz(this,Fz),e),Mz(255*Fz.r,0,255)<<16^Mz(255*Fz.g,0,255)<<8^Mz(255*Fz.b,0,255)<<0}getHexString(e="srgb"){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t="srgb-linear"){Rz.fromWorkingColorSpace(jz(this,Fz),t);const n=Fz.r,i=Fz.g,r=Fz.b,o=Math.max(n,i,r),a=Math.min(n,i,r);let s,l;const p=(a+o)/2;if(a===o)s=0,l=0;else{const e=o-a;switch(l=p<=.5?e/(o+a):e/(2-o-a),o){case n:s=(i-r)/e+(i<r?6:0);break;case i:s=(r-n)/e+2;break;case r:s=(n-i)/e+4}s/=6}return e.h=s,e.s=l,e.l=p,e}getRGB(e,t="srgb-linear"){return Rz.fromWorkingColorSpace(jz(this,Fz),t),e.r=Fz.r,e.g=Fz.g,e.b=Fz.b,e}getStyle(e="srgb"){return Rz.fromWorkingColorSpace(jz(this,Fz),e),e!==xz?`color(${e} ${Fz.r} ${Fz.g} ${Fz.b})`:`rgb(${255*Fz.r|0},${255*Fz.g|0},${255*Fz.b|0})`}offsetHSL(e,t,n){return this.getHSL(Dz),Dz.h+=e,Dz.s+=t,Dz.l+=n,this.setHSL(Dz.h,Dz.s,Dz.l),this}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,n){return this.r=e.r+(t.r-e.r)*n,this.g=e.g+(t.g-e.g)*n,this.b=e.b+(t.b-e.b)*n,this}lerpHSL(e,t){this.getHSL(Dz),e.getHSL(Gz);const n=Cz(Dz.h,Gz.h,t),i=Cz(Dz.s,Gz.s,t),r=Cz(Dz.l,Gz.l,t);return this.setHSL(n,i,r),this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}let qz;Wz.NAMES=Hz;class Jz{constructor(e=null){this.isSource=!0,this.uuid=Ez(),this.data=e,this.version=0}set needsUpdate(e){!0===e&&this.version++}toJSON(e){const t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.images[this.uuid])return e.images[this.uuid];const n={uuid:this.uuid,url:""},i=this.data;if(null!==i){let e;if(Array.isArray(i)){e=[];for(let t=0,n=i.length;t<n;t++)i[t].isDataTexture?e.push($z(i[t].image)):e.push($z(i[t]))}else e=$z(i);n.url=e}return t||(e.images[this.uuid]=n),n}}function $z(e){return"undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap?class{static getDataURL(e){if(/^data:/i.test(e.src))return e.src;if("undefined"==typeof HTMLCanvasElement)return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{void 0===qz&&(qz=Vz("canvas")),qz.width=e.width,qz.height=e.height;const n=qz.getContext("2d");e instanceof ImageData?n.putImageData(e,0,0):n.drawImage(e,0,0,e.width,e.height),t=qz}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}static sRGBToLinear(e){if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap){const t=Vz("canvas");t.width=e.width,t.height=e.height;const n=t.getContext("2d");n.drawImage(e,0,0,e.width,e.height);const i=n.getImageData(0,0,e.width,e.height),r=i.data;for(let e=0;e<r.length;e++)r[e]=255*kz(r[e]/255);return n.putImageData(i,0,0),t}if(e.data){const t=e.data.slice(0);for(let e=0;e<t.length;e++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[e]=Math.floor(255*kz(t[e]/255)):t[e]=kz(t[e]);return{data:t,width:e.width,height:e.height}}return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}.getDataURL(e):e.data?{data:Array.from(e.data),width:e.width,height:e.height,type:e.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let Xz=0;class Yz extends gz{constructor(e=Yz.DEFAULT_IMAGE,t=Yz.DEFAULT_MAPPING,n=1001,i=1001,r=1006,o=1008,a=1023,s=1009,l=1,p=3e3){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:Xz++}),this.uuid=Ez(),this.name="",this.source=new Jz(e),this.mipmaps=[],this.mapping=t,this.wrapS=n,this.wrapT=i,this.magFilter=r,this.minFilter=o,this.anisotropy=l,this.format=a,this.internalFormat=null,this.type=s,this.offset=new Bz(0,0),this.repeat=new Bz(1,1),this.center=new Bz(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Tz,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=p,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(e){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return(new this.constructor).copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){const t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.textures[this.uuid])return e.textures[this.uuid];const n={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return"{}"!==JSON.stringify(this.userData)&&(n.userData=this.userData),t||(e.textures[this.uuid]=n),n}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(300!==this.mapping)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case 1e3:e.x=e.x-Math.floor(e.x);break;case 1001:e.x=e.x<0?0:1;break;case 1002:1===Math.abs(Math.floor(e.x)%2)?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||e.y>1)switch(this.wrapT){case 1e3:e.y=e.y-Math.floor(e.y);break;case 1001:e.y=e.y<0?0:1;break;case 1002:1===Math.abs(Math.floor(e.y)%2)?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){!0===e&&(this.version++,this.source.needsUpdate=!0)}}Yz.DEFAULT_IMAGE=null,Yz.DEFAULT_MAPPING=300;class Kz{constructor(e=0,t=0,n=0,i=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=n,this._w=i}static slerpFlat(e,t,n,i,r,o,a){let s=n[i+0],l=n[i+1],p=n[i+2],u=n[i+3];const h=r[o+0],c=r[o+1],_=r[o+2],d=r[o+3];if(0===a)return e[t+0]=s,e[t+1]=l,e[t+2]=p,void(e[t+3]=u);if(1===a)return e[t+0]=h,e[t+1]=c,e[t+2]=_,void(e[t+3]=d);if(u!==d||s!==h||l!==c||p!==_){let e=1-a;const t=s*h+l*c+p*_+u*d,n=t>=0?1:-1,i=1-t*t;if(i>Number.EPSILON){const r=Math.sqrt(i),o=Math.atan2(r,t*n);e=Math.sin(e*o)/r,a=Math.sin(a*o)/r}const r=a*n;if(s=s*e+h*r,l=l*e+c*r,p=p*e+_*r,u=u*e+d*r,e===1-a){const e=1/Math.sqrt(s*s+l*l+p*p+u*u);s*=e,l*=e,p*=e,u*=e}}e[t]=s,e[t+1]=l,e[t+2]=p,e[t+3]=u}static multiplyQuaternionsFlat(e,t,n,i,r,o){const a=n[i],s=n[i+1],l=n[i+2],p=n[i+3],u=r[o],h=r[o+1],c=r[o+2],_=r[o+3];return e[t]=a*_+p*u+s*c-l*h,e[t+1]=s*_+p*h+l*u-a*c,e[t+2]=l*_+p*c+a*h-s*u,e[t+3]=p*_-a*u-s*h-l*c,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,n,i){return this._x=e,this._y=t,this._z=n,this._w=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t){const n=e._x,i=e._y,r=e._z,o=e._order,a=Math.cos,s=Math.sin,l=a(n/2),p=a(i/2),u=a(r/2),h=s(n/2),c=s(i/2),_=s(r/2);switch(o){case"XYZ":this._x=h*p*u+l*c*_,this._y=l*c*u-h*p*_,this._z=l*p*_+h*c*u,this._w=l*p*u-h*c*_;break;case"YXZ":this._x=h*p*u+l*c*_,this._y=l*c*u-h*p*_,this._z=l*p*_-h*c*u,this._w=l*p*u+h*c*_;break;case"ZXY":this._x=h*p*u-l*c*_,this._y=l*c*u+h*p*_,this._z=l*p*_+h*c*u,this._w=l*p*u-h*c*_;break;case"ZYX":this._x=h*p*u-l*c*_,this._y=l*c*u+h*p*_,this._z=l*p*_-h*c*u,this._w=l*p*u+h*c*_;break;case"YZX":this._x=h*p*u+l*c*_,this._y=l*c*u+h*p*_,this._z=l*p*_-h*c*u,this._w=l*p*u-h*c*_;break;case"XZY":this._x=h*p*u-l*c*_,this._y=l*c*u-h*p*_,this._z=l*p*_+h*c*u,this._w=l*p*u+h*c*_;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+o)}return!1!==t&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const n=t/2,i=Math.sin(n);return this._x=e.x*i,this._y=e.y*i,this._z=e.z*i,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,n=t[0],i=t[4],r=t[8],o=t[1],a=t[5],s=t[9],l=t[2],p=t[6],u=t[10],h=n+a+u;if(h>0){const e=.5/Math.sqrt(h+1);this._w=.25/e,this._x=(p-s)*e,this._y=(r-l)*e,this._z=(o-i)*e}else if(n>a&&n>u){const e=2*Math.sqrt(1+n-a-u);this._w=(p-s)/e,this._x=.25*e,this._y=(i+o)/e,this._z=(r+l)/e}else if(a>u){const e=2*Math.sqrt(1+a-n-u);this._w=(r-l)/e,this._x=(i+o)/e,this._y=.25*e,this._z=(s+p)/e}else{const e=2*Math.sqrt(1+u-n-a);this._w=(o-i)/e,this._x=(r+l)/e,this._y=(s+p)/e,this._z=.25*e}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let n=e.dot(t)+1;return n<Number.EPSILON?(n=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=n):(this._x=0,this._y=-e.z,this._z=e.y,this._w=n)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=n),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(Mz(this.dot(e),-1,1)))}rotateTowards(e,t){const n=this.angleTo(e);if(0===n)return this;const i=Math.min(1,t/n);return this.slerp(e,i),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const n=e._x,i=e._y,r=e._z,o=e._w,a=t._x,s=t._y,l=t._z,p=t._w;return this._x=n*p+o*a+i*l-r*s,this._y=i*p+o*s+r*a-n*l,this._z=r*p+o*l+n*s-i*a,this._w=o*p-n*a-i*s-r*l,this._onChangeCallback(),this}slerp(e,t){if(0===t)return this;if(1===t)return this.copy(e);const n=this._x,i=this._y,r=this._z,o=this._w;let a=o*e._w+n*e._x+i*e._y+r*e._z;if(a<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,a=-a):this.copy(e),a>=1)return this._w=o,this._x=n,this._y=i,this._z=r,this;const s=1-a*a;if(s<=Number.EPSILON){const e=1-t;return this._w=e*o+t*this._w,this._x=e*n+t*this._x,this._y=e*i+t*this._y,this._z=e*r+t*this._z,this.normalize(),this._onChangeCallback(),this}const l=Math.sqrt(s),p=Math.atan2(l,a),u=Math.sin((1-t)*p)/l,h=Math.sin(t*p)/l;return this._w=o*u+this._w*h,this._x=n*u+this._x*h,this._y=i*u+this._y*h,this._z=r*u+this._z*h,this._onChangeCallback(),this}slerpQuaternions(e,t,n){return this.copy(e).slerp(t,n)}random(){const e=Math.random(),t=Math.sqrt(1-e),n=Math.sqrt(e),i=2*Math.PI*Math.random(),r=2*Math.PI*Math.random();return this.set(t*Math.cos(i),n*Math.sin(r),n*Math.cos(r),t*Math.sin(i))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class Qz{constructor(e=0,t=0,n=0){Qz.prototype.isVector3=!0,this.x=e,this.y=t,this.z=n}set(e,t,n){return void 0===n&&(n=this.z),this.x=e,this.y=t,this.z=n,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(tw.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(tw.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,n=this.y,i=this.z,r=e.elements;return this.x=r[0]*t+r[3]*n+r[6]*i,this.y=r[1]*t+r[4]*n+r[7]*i,this.z=r[2]*t+r[5]*n+r[8]*i,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,n=this.y,i=this.z,r=e.elements,o=1/(r[3]*t+r[7]*n+r[11]*i+r[15]);return this.x=(r[0]*t+r[4]*n+r[8]*i+r[12])*o,this.y=(r[1]*t+r[5]*n+r[9]*i+r[13])*o,this.z=(r[2]*t+r[6]*n+r[10]*i+r[14])*o,this}applyQuaternion(e){const t=this.x,n=this.y,i=this.z,r=e.x,o=e.y,a=e.z,s=e.w,l=s*t+o*i-a*n,p=s*n+a*t-r*i,u=s*i+r*n-o*t,h=-r*t-o*n-a*i;return this.x=l*s+h*-r+p*-a-u*-o,this.y=p*s+h*-o+u*-r-l*-a,this.z=u*s+h*-a+l*-o-p*-r,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,n=this.y,i=this.z,r=e.elements;return this.x=r[0]*t+r[4]*n+r[8]*i,this.y=r[1]*t+r[5]*n+r[9]*i,this.z=r[2]*t+r[6]*n+r[10]*i,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const n=e.x,i=e.y,r=e.z,o=t.x,a=t.y,s=t.z;return this.x=i*s-r*a,this.y=r*o-n*s,this.z=n*a-i*o,this}projectOnVector(e){const t=e.lengthSq();if(0===t)return this.set(0,0,0);const n=e.dot(this)/t;return this.copy(e).multiplyScalar(n)}projectOnPlane(e){return ew.copy(this).projectOnVector(e),this.sub(ew)}reflect(e){return this.sub(ew.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(Mz(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y,i=this.z-e.z;return t*t+n*n+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,n){const i=Math.sin(t)*e;return this.x=i*Math.sin(n),this.y=Math.cos(t)*e,this.z=i*Math.cos(n),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,n){return this.x=e*Math.sin(t),this.y=n,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),i=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=n,this.z=i,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,4*t)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,3*t)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=2*(Math.random()-.5),t=Math.random()*Math.PI*2,n=Math.sqrt(1-e**2);return this.x=n*Math.cos(t),this.y=n*Math.sin(t),this.z=e,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const ew=new Qz,tw=new Kz;class nw{constructor(e=new Qz(1/0,1/0,1/0),t=new Qz(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){let t=1/0,n=1/0,i=1/0,r=-1/0,o=-1/0,a=-1/0;for(let s=0,l=e.length;s<l;s+=3){const l=e[s],p=e[s+1],u=e[s+2];l<t&&(t=l),p<n&&(n=p),u<i&&(i=u),l>r&&(r=l),p>o&&(o=p),u>a&&(a=u)}return this.min.set(t,n,i),this.max.set(r,o,a),this}setFromBufferAttribute(e){let t=1/0,n=1/0,i=1/0,r=-1/0,o=-1/0,a=-1/0;for(let s=0,l=e.count;s<l;s++){const l=e.getX(s),p=e.getY(s),u=e.getZ(s);l<t&&(t=l),p<n&&(n=p),u<i&&(i=u),l>r&&(r=l),p>o&&(o=p),u>a&&(a=u)}return this.min.set(t,n,i),this.max.set(r,o,a),this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const n=rw.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return(new this.constructor).copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){e.updateWorldMatrix(!1,!1);const n=e.geometry;if(void 0!==n)if(t&&null!=n.attributes&&void 0!==n.attributes.position){const t=n.attributes.position;for(let n=0,i=t.count;n<i;n++)rw.fromBufferAttribute(t,n).applyMatrix4(e.matrixWorld),this.expandByPoint(rw)}else null===n.boundingBox&&n.computeBoundingBox(),ow.copy(n.boundingBox),ow.applyMatrix4(e.matrixWorld),this.union(ow);const i=e.children;for(let e=0,n=i.length;e<n;e++)this.expandByObject(i[e],t);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,rw),rw.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,n;return e.normal.x>0?(t=e.normal.x*this.min.x,n=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,n=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,n+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,n+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,n+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,n+=e.normal.z*this.min.z),t<=-e.constant&&n>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(cw),_w.subVectors(this.max,cw),aw.subVectors(e.a,cw),sw.subVectors(e.b,cw),lw.subVectors(e.c,cw),pw.subVectors(sw,aw),uw.subVectors(lw,sw),hw.subVectors(aw,lw);let t=[0,-pw.z,pw.y,0,-uw.z,uw.y,0,-hw.z,hw.y,pw.z,0,-pw.x,uw.z,0,-uw.x,hw.z,0,-hw.x,-pw.y,pw.x,0,-uw.y,uw.x,0,-hw.y,hw.x,0];return!!Pw(t,aw,sw,lw,_w)&&(t=[1,0,0,0,1,0,0,0,1],!!Pw(t,aw,sw,lw,_w)&&(dw.crossVectors(pw,uw),t=[dw.x,dw.y,dw.z],Pw(t,aw,sw,lw,_w)))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return rw.copy(e).clamp(this.min,this.max).sub(e).length()}getBoundingSphere(e){return this.getCenter(e.center),e.radius=.5*this.getSize(rw).length(),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()||(iw[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),iw[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),iw[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),iw[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),iw[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),iw[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),iw[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),iw[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(iw)),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const iw=[new Qz,new Qz,new Qz,new Qz,new Qz,new Qz,new Qz,new Qz],rw=new Qz,ow=new nw,aw=new Qz,sw=new Qz,lw=new Qz,pw=new Qz,uw=new Qz,hw=new Qz,cw=new Qz,_w=new Qz,dw=new Qz,mw=new Qz;function Pw(e,t,n,i,r){for(let o=0,a=e.length-3;o<=a;o+=3){mw.fromArray(e,o);const a=r.x*Math.abs(mw.x)+r.y*Math.abs(mw.y)+r.z*Math.abs(mw.z),s=t.dot(mw),l=n.dot(mw),p=i.dot(mw);if(Math.max(-Math.max(s,l,p),Math.min(s,l,p))>a)return!1}return!0}const fw=new nw,xw=new Qz,yw=new Qz,vw=new Qz;class gw{constructor(e=new Qz,t=-1){this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const n=this.center;void 0!==t?n.copy(t):fw.setFromPoints(e).getCenter(n);let i=0;for(let t=0,r=e.length;t<r;t++)i=Math.max(i,n.distanceToSquared(e[t]));return this.radius=Math.sqrt(i),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const n=this.center.distanceToSquared(e);return t.copy(e),n>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){vw.subVectors(e,this.center);const t=vw.lengthSq();if(t>this.radius*this.radius){const e=Math.sqrt(t),n=.5*(e-this.radius);this.center.add(vw.multiplyScalar(n/e)),this.radius+=n}return this}union(e){return!0===this.center.equals(e.center)?yw.set(0,0,1).multiplyScalar(e.radius):yw.subVectors(e.center,this.center).normalize().multiplyScalar(e.radius),this.expandByPoint(xw.copy(e.center).add(yw)),this.expandByPoint(xw.copy(e.center).sub(yw)),this}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return(new this.constructor).copy(this)}}const bw=new Qz,zw=new Qz,ww=new Qz,Zw=new Qz,Ew=new Qz,Mw=new Qz,Sw=new Qz;class Cw{constructor(){Cw.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}set(e,t,n,i,r,o,a,s,l,p,u,h,c,_,d,m){const P=this.elements;return P[0]=e,P[4]=t,P[8]=n,P[12]=i,P[1]=r,P[5]=o,P[9]=a,P[13]=s,P[2]=l,P[6]=p,P[10]=u,P[14]=h,P[3]=c,P[7]=_,P[11]=d,P[15]=m,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new Cw).fromArray(this.elements)}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],this}copyPosition(e){const t=this.elements,n=e.elements;return t[12]=n[12],t[13]=n[13],t[14]=n[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,n){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}makeBasis(e,t,n){return this.set(e.x,t.x,n.x,0,e.y,t.y,n.y,0,e.z,t.z,n.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,n=e.elements,i=1/Nw.setFromMatrixColumn(e,0).length(),r=1/Nw.setFromMatrixColumn(e,1).length(),o=1/Nw.setFromMatrixColumn(e,2).length();return t[0]=n[0]*i,t[1]=n[1]*i,t[2]=n[2]*i,t[3]=0,t[4]=n[4]*r,t[5]=n[5]*r,t[6]=n[6]*r,t[7]=0,t[8]=n[8]*o,t[9]=n[9]*o,t[10]=n[10]*o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){const t=this.elements,n=e.x,i=e.y,r=e.z,o=Math.cos(n),a=Math.sin(n),s=Math.cos(i),l=Math.sin(i),p=Math.cos(r),u=Math.sin(r);if("XYZ"===e.order){const e=o*p,n=o*u,i=a*p,r=a*u;t[0]=s*p,t[4]=-s*u,t[8]=l,t[1]=n+i*l,t[5]=e-r*l,t[9]=-a*s,t[2]=r-e*l,t[6]=i+n*l,t[10]=o*s}else if("YXZ"===e.order){const e=s*p,n=s*u,i=l*p,r=l*u;t[0]=e+r*a,t[4]=i*a-n,t[8]=o*l,t[1]=o*u,t[5]=o*p,t[9]=-a,t[2]=n*a-i,t[6]=r+e*a,t[10]=o*s}else if("ZXY"===e.order){const e=s*p,n=s*u,i=l*p,r=l*u;t[0]=e-r*a,t[4]=-o*u,t[8]=i+n*a,t[1]=n+i*a,t[5]=o*p,t[9]=r-e*a,t[2]=-o*l,t[6]=a,t[10]=o*s}else if("ZYX"===e.order){const e=o*p,n=o*u,i=a*p,r=a*u;t[0]=s*p,t[4]=i*l-n,t[8]=e*l+r,t[1]=s*u,t[5]=r*l+e,t[9]=n*l-i,t[2]=-l,t[6]=a*s,t[10]=o*s}else if("YZX"===e.order){const e=o*s,n=o*l,i=a*s,r=a*l;t[0]=s*p,t[4]=r-e*u,t[8]=i*u+n,t[1]=u,t[5]=o*p,t[9]=-a*p,t[2]=-l*p,t[6]=n*u+i,t[10]=e-r*u}else if("XZY"===e.order){const e=o*s,n=o*l,i=a*s,r=a*l;t[0]=s*p,t[4]=-u,t[8]=l*p,t[1]=e*u+r,t[5]=o*p,t[9]=n*u-i,t[2]=i*u-n,t[6]=a*p,t[10]=r*u+e}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(Lw,e,Bw)}lookAt(e,t,n){const i=this.elements;return kw.subVectors(e,t),0===kw.lengthSq()&&(kw.z=1),kw.normalize(),Tw.crossVectors(n,kw),0===Tw.lengthSq()&&(1===Math.abs(n.z)?kw.x+=1e-4:kw.z+=1e-4,kw.normalize(),Tw.crossVectors(n,kw)),Tw.normalize(),Vw.crossVectors(kw,Tw),i[0]=Tw.x,i[4]=Vw.x,i[8]=kw.x,i[1]=Tw.y,i[5]=Vw.y,i[9]=kw.y,i[2]=Tw.z,i[6]=Vw.z,i[10]=kw.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,i=t.elements,r=this.elements,o=n[0],a=n[4],s=n[8],l=n[12],p=n[1],u=n[5],h=n[9],c=n[13],_=n[2],d=n[6],m=n[10],P=n[14],f=n[3],x=n[7],y=n[11],v=n[15],g=i[0],b=i[4],z=i[8],w=i[12],Z=i[1],E=i[5],M=i[9],S=i[13],C=i[2],N=i[6],A=i[10],L=i[14],B=i[3],T=i[7],V=i[11],k=i[15];return r[0]=o*g+a*Z+s*C+l*B,r[4]=o*b+a*E+s*N+l*T,r[8]=o*z+a*M+s*A+l*V,r[12]=o*w+a*S+s*L+l*k,r[1]=p*g+u*Z+h*C+c*B,r[5]=p*b+u*E+h*N+c*T,r[9]=p*z+u*M+h*A+c*V,r[13]=p*w+u*S+h*L+c*k,r[2]=_*g+d*Z+m*C+P*B,r[6]=_*b+d*E+m*N+P*T,r[10]=_*z+d*M+m*A+P*V,r[14]=_*w+d*S+m*L+P*k,r[3]=f*g+x*Z+y*C+v*B,r[7]=f*b+x*E+y*N+v*T,r[11]=f*z+x*M+y*A+v*V,r[15]=f*w+x*S+y*L+v*k,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[4],i=e[8],r=e[12],o=e[1],a=e[5],s=e[9],l=e[13],p=e[2],u=e[6],h=e[10],c=e[14];return e[3]*(+r*s*u-i*l*u-r*a*h+n*l*h+i*a*c-n*s*c)+e[7]*(+t*s*c-t*l*h+r*o*h-i*o*c+i*l*p-r*s*p)+e[11]*(+t*l*u-t*a*c-r*o*u+n*o*c+r*a*p-n*l*p)+e[15]*(-i*a*p-t*s*u+t*a*h+i*o*u-n*o*h+n*s*p)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,n){const i=this.elements;return e.isVector3?(i[12]=e.x,i[13]=e.y,i[14]=e.z):(i[12]=e,i[13]=t,i[14]=n),this}invert(){const e=this.elements,t=e[0],n=e[1],i=e[2],r=e[3],o=e[4],a=e[5],s=e[6],l=e[7],p=e[8],u=e[9],h=e[10],c=e[11],_=e[12],d=e[13],m=e[14],P=e[15],f=u*m*l-d*h*l+d*s*c-a*m*c-u*s*P+a*h*P,x=_*h*l-p*m*l-_*s*c+o*m*c+p*s*P-o*h*P,y=p*d*l-_*u*l+_*a*c-o*d*c-p*a*P+o*u*P,v=_*u*s-p*d*s-_*a*h+o*d*h+p*a*m-o*u*m,g=t*f+n*x+i*y+r*v;if(0===g)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const b=1/g;return e[0]=f*b,e[1]=(d*h*r-u*m*r-d*i*c+n*m*c+u*i*P-n*h*P)*b,e[2]=(a*m*r-d*s*r+d*i*l-n*m*l-a*i*P+n*s*P)*b,e[3]=(u*s*r-a*h*r-u*i*l+n*h*l+a*i*c-n*s*c)*b,e[4]=x*b,e[5]=(p*m*r-_*h*r+_*i*c-t*m*c-p*i*P+t*h*P)*b,e[6]=(_*s*r-o*m*r-_*i*l+t*m*l+o*i*P-t*s*P)*b,e[7]=(o*h*r-p*s*r+p*i*l-t*h*l-o*i*c+t*s*c)*b,e[8]=y*b,e[9]=(_*u*r-p*d*r-_*n*c+t*d*c+p*n*P-t*u*P)*b,e[10]=(o*d*r-_*a*r+_*n*l-t*d*l-o*n*P+t*a*P)*b,e[11]=(p*a*r-o*u*r-p*n*l+t*u*l+o*n*c-t*a*c)*b,e[12]=v*b,e[13]=(p*d*i-_*u*i+_*n*h-t*d*h-p*n*m+t*u*m)*b,e[14]=(_*a*i-o*d*i-_*n*s+t*d*s+o*n*m-t*a*m)*b,e[15]=(o*u*i-p*a*i+p*n*s-t*u*s-o*n*h+t*a*h)*b,this}scale(e){const t=this.elements,n=e.x,i=e.y,r=e.z;return t[0]*=n,t[4]*=i,t[8]*=r,t[1]*=n,t[5]*=i,t[9]*=r,t[2]*=n,t[6]*=i,t[10]*=r,t[3]*=n,t[7]*=i,t[11]*=r,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],i=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,n,i))}makeTranslation(e,t,n){return this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const n=Math.cos(t),i=Math.sin(t),r=1-n,o=e.x,a=e.y,s=e.z,l=r*o,p=r*a;return this.set(l*o+n,l*a-i*s,l*s+i*a,0,l*a+i*s,p*a+n,p*s-i*o,0,l*s-i*a,p*s+i*o,r*s*s+n,0,0,0,0,1),this}makeScale(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this}makeShear(e,t,n,i,r,o){return this.set(1,n,r,0,e,1,o,0,t,i,1,0,0,0,0,1),this}compose(e,t,n){const i=this.elements,r=t._x,o=t._y,a=t._z,s=t._w,l=r+r,p=o+o,u=a+a,h=r*l,c=r*p,_=r*u,d=o*p,m=o*u,P=a*u,f=s*l,x=s*p,y=s*u,v=n.x,g=n.y,b=n.z;return i[0]=(1-(d+P))*v,i[1]=(c+y)*v,i[2]=(_-x)*v,i[3]=0,i[4]=(c-y)*g,i[5]=(1-(h+P))*g,i[6]=(m+f)*g,i[7]=0,i[8]=(_+x)*b,i[9]=(m-f)*b,i[10]=(1-(h+d))*b,i[11]=0,i[12]=e.x,i[13]=e.y,i[14]=e.z,i[15]=1,this}decompose(e,t,n){const i=this.elements;let r=Nw.set(i[0],i[1],i[2]).length();const o=Nw.set(i[4],i[5],i[6]).length(),a=Nw.set(i[8],i[9],i[10]).length();this.determinant()<0&&(r=-r),e.x=i[12],e.y=i[13],e.z=i[14],Aw.copy(this);const s=1/r,l=1/o,p=1/a;return Aw.elements[0]*=s,Aw.elements[1]*=s,Aw.elements[2]*=s,Aw.elements[4]*=l,Aw.elements[5]*=l,Aw.elements[6]*=l,Aw.elements[8]*=p,Aw.elements[9]*=p,Aw.elements[10]*=p,t.setFromRotationMatrix(Aw),n.x=r,n.y=o,n.z=a,this}makePerspective(e,t,n,i,r,o){const a=this.elements,s=2*r/(t-e),l=2*r/(n-i),p=(t+e)/(t-e),u=(n+i)/(n-i),h=-(o+r)/(o-r),c=-2*o*r/(o-r);return a[0]=s,a[4]=0,a[8]=p,a[12]=0,a[1]=0,a[5]=l,a[9]=u,a[13]=0,a[2]=0,a[6]=0,a[10]=h,a[14]=c,a[3]=0,a[7]=0,a[11]=-1,a[15]=0,this}makeOrthographic(e,t,n,i,r,o){const a=this.elements,s=1/(t-e),l=1/(n-i),p=1/(o-r),u=(t+e)*s,h=(n+i)*l,c=(o+r)*p;return a[0]=2*s,a[4]=0,a[8]=0,a[12]=-u,a[1]=0,a[5]=2*l,a[9]=0,a[13]=-h,a[2]=0,a[6]=0,a[10]=-2*p,a[14]=-c,a[3]=0,a[7]=0,a[11]=0,a[15]=1,this}equals(e){const t=this.elements,n=e.elements;for(let e=0;e<16;e++)if(t[e]!==n[e])return!1;return!0}fromArray(e,t=0){for(let n=0;n<16;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e}}const Nw=new Qz,Aw=new Cw,Lw=new Qz(0,0,0),Bw=new Qz(1,1,1),Tw=new Qz,Vw=new Qz,kw=new Qz,Iw=new Cw,Ow=new Kz;class Rw{constructor(e=0,t=0,n=0,i=Rw.DefaultOrder){this.isEuler=!0,this._x=e,this._y=t,this._z=n,this._order=i}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,n,i=this._order){return this._x=e,this._y=t,this._z=n,this._order=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,n=!0){const i=e.elements,r=i[0],o=i[4],a=i[8],s=i[1],l=i[5],p=i[9],u=i[2],h=i[6],c=i[10];switch(t){case"XYZ":this._y=Math.asin(Mz(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-p,c),this._z=Math.atan2(-o,r)):(this._x=Math.atan2(h,l),this._z=0);break;case"YXZ":this._x=Math.asin(-Mz(p,-1,1)),Math.abs(p)<.9999999?(this._y=Math.atan2(a,c),this._z=Math.atan2(s,l)):(this._y=Math.atan2(-u,r),this._z=0);break;case"ZXY":this._x=Math.asin(Mz(h,-1,1)),Math.abs(h)<.9999999?(this._y=Math.atan2(-u,c),this._z=Math.atan2(-o,l)):(this._y=0,this._z=Math.atan2(s,r));break;case"ZYX":this._y=Math.asin(-Mz(u,-1,1)),Math.abs(u)<.9999999?(this._x=Math.atan2(h,c),this._z=Math.atan2(s,r)):(this._x=0,this._z=Math.atan2(-o,l));break;case"YZX":this._z=Math.asin(Mz(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(-p,l),this._y=Math.atan2(-u,r)):(this._x=0,this._y=Math.atan2(a,c));break;case"XZY":this._z=Math.asin(-Mz(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(h,l),this._y=Math.atan2(a,r)):(this._x=Math.atan2(-p,c),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,!0===n&&this._onChangeCallback(),this}setFromQuaternion(e,t,n){return Iw.makeRotationFromQuaternion(e),this.setFromRotationMatrix(Iw,t,n)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return Ow.setFromEuler(this),this.setFromQuaternion(Ow,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}toVector3(){console.error("THREE.Euler: .toVector3() has been removed. Use Vector3.setFromEuler() instead")}}Rw.DefaultOrder="XYZ",Rw.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];class Hw{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return 0!=(this.mask&e.mask)}isEnabled(e){return 0!=(this.mask&(1<<e|0))}}let Fw=0;const Dw=new Qz,Gw=new Kz,Uw=new Cw,jw=new Qz,Ww=new Qz,qw=new Qz,Jw=new Kz,$w=new Qz(1,0,0),Xw=new Qz(0,1,0),Yw=new Qz(0,0,1),Kw={type:"added"},Qw={type:"removed"};class eZ extends gz{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:Fw++}),this.uuid=Ez(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=eZ.DefaultUp.clone();const e=new Qz,t=new Rw,n=new Kz,i=new Qz(1,1,1);t._onChange((function(){n.setFromEuler(t,!1)})),n._onChange((function(){t.setFromQuaternion(n,void 0,!1)})),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:i},modelViewMatrix:{value:new Cw},normalMatrix:{value:new Tz}}),this.matrix=new Cw,this.matrixWorld=new Cw,this.matrixAutoUpdate=eZ.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.matrixWorldAutoUpdate=eZ.DefaultMatrixWorldAutoUpdate,this.layers=new Hw,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return Gw.setFromAxisAngle(e,t),this.quaternion.multiply(Gw),this}rotateOnWorldAxis(e,t){return Gw.setFromAxisAngle(e,t),this.quaternion.premultiply(Gw),this}rotateX(e){return this.rotateOnAxis($w,e)}rotateY(e){return this.rotateOnAxis(Xw,e)}rotateZ(e){return this.rotateOnAxis(Yw,e)}translateOnAxis(e,t){return Dw.copy(e).applyQuaternion(this.quaternion),this.position.add(Dw.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis($w,e)}translateY(e){return this.translateOnAxis(Xw,e)}translateZ(e){return this.translateOnAxis(Yw,e)}localToWorld(e){return e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return e.applyMatrix4(Uw.copy(this.matrixWorld).invert())}lookAt(e,t,n){e.isVector3?jw.copy(e):jw.set(e,t,n);const i=this.parent;this.updateWorldMatrix(!0,!1),Ww.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Uw.lookAt(Ww,jw,this.up):Uw.lookAt(jw,Ww,this.up),this.quaternion.setFromRotationMatrix(Uw),i&&(Uw.extractRotation(i.matrixWorld),Gw.setFromRotationMatrix(Uw),this.quaternion.premultiply(Gw.invert()))}add(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(null!==e.parent&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(Kw)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.remove(arguments[e]);return this}const t=this.children.indexOf(e);return-1!==t&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(Qw)),this}removeFromParent(){const e=this.parent;return null!==e&&e.remove(this),this}clear(){for(let e=0;e<this.children.length;e++){const t=this.children[e];t.parent=null,t.dispatchEvent(Qw)}return this.children.length=0,this}attach(e){return this.updateWorldMatrix(!0,!1),Uw.copy(this.matrixWorld).invert(),null!==e.parent&&(e.parent.updateWorldMatrix(!0,!1),Uw.multiply(e.parent.matrixWorld)),e.applyMatrix4(Uw),this.add(e),e.updateWorldMatrix(!1,!0),this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let n=0,i=this.children.length;n<i;n++){const i=this.children[n].getObjectByProperty(e,t);if(void 0!==i)return i}}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Ww,e,qw),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Ww,Jw,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let n=0,i=t.length;n<i;n++)t[n].traverse(e)}traverseVisible(e){if(!1===this.visible)return;e(this);const t=this.children;for(let n=0,i=t.length;n<i;n++)t[n].traverseVisible(e)}traverseAncestors(e){const t=this.parent;null!==t&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let n=0,i=t.length;n<i;n++){const i=t[n];!0!==i.matrixWorldAutoUpdate&&!0!==e||i.updateMatrixWorld(e)}}updateWorldMatrix(e,t){const n=this.parent;if(!0===e&&null!==n&&!0===n.matrixWorldAutoUpdate&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===t){const e=this.children;for(let t=0,n=e.length;t<n;t++){const n=e[t];!0===n.matrixWorldAutoUpdate&&n.updateWorldMatrix(!1,!0)}}}toJSON(e){const t=void 0===e||"string"==typeof e,n={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},n.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});const i={};function r(t,n){return void 0===t[n.uuid]&&(t[n.uuid]=n.toJSON(e)),n.uuid}if(i.uuid=this.uuid,i.type=this.type,""!==this.name&&(i.name=this.name),!0===this.castShadow&&(i.castShadow=!0),!0===this.receiveShadow&&(i.receiveShadow=!0),!1===this.visible&&(i.visible=!1),!1===this.frustumCulled&&(i.frustumCulled=!1),0!==this.renderOrder&&(i.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(i.userData=this.userData),i.layers=this.layers.mask,i.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(i.matrixAutoUpdate=!1),this.isInstancedMesh&&(i.type="InstancedMesh",i.count=this.count,i.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(i.instanceColor=this.instanceColor.toJSON())),this.isScene)this.background&&(this.background.isColor?i.background=this.background.toJSON():this.background.isTexture&&(i.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&!0!==this.environment.isRenderTargetTexture&&(i.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){i.geometry=r(e.geometries,this.geometry);const t=this.geometry.parameters;if(void 0!==t&&void 0!==t.shapes){const n=t.shapes;if(Array.isArray(n))for(let t=0,i=n.length;t<i;t++){const i=n[t];r(e.shapes,i)}else r(e.shapes,n)}}if(this.isSkinnedMesh&&(i.bindMode=this.bindMode,i.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(r(e.skeletons,this.skeleton),i.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){const t=[];for(let n=0,i=this.material.length;n<i;n++)t.push(r(e.materials,this.material[n]));i.material=t}else i.material=r(e.materials,this.material);if(this.children.length>0){i.children=[];for(let t=0;t<this.children.length;t++)i.children.push(this.children[t].toJSON(e).object)}if(this.animations.length>0){i.animations=[];for(let t=0;t<this.animations.length;t++){const n=this.animations[t];i.animations.push(r(e.animations,n))}}if(t){const t=o(e.geometries),i=o(e.materials),r=o(e.textures),a=o(e.images),s=o(e.shapes),l=o(e.skeletons),p=o(e.animations),u=o(e.nodes);t.length>0&&(n.geometries=t),i.length>0&&(n.materials=i),r.length>0&&(n.textures=r),a.length>0&&(n.images=a),s.length>0&&(n.shapes=s),l.length>0&&(n.skeletons=l),p.length>0&&(n.animations=p),u.length>0&&(n.nodes=u)}return n.object=i,n;function o(e){const t=[];for(const n in e){const i=e[n];delete i.metadata,t.push(i)}return t}}clone(e){return(new this.constructor).copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),!0===t)for(let t=0;t<e.children.length;t++){const n=e.children[t];this.add(n.clone())}return this}}eZ.DefaultUp=new Qz(0,1,0),eZ.DefaultMatrixAutoUpdate=!0,eZ.DefaultMatrixWorldAutoUpdate=!0;let tZ=0;class nZ extends gz{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:tZ++}),this.uuid=Ez(),this.name="",this.type="Material",this.blending=1,this.side=0,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=204,this.blendDst=205,this.blendEquation=100,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=3,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=519,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=vz,this.stencilZFail=vz,this.stencilZPass=vz,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(void 0!==e)for(const t in e){const n=e[t];if(void 0===n){console.warn("THREE.Material: '"+t+"' parameter is undefined.");continue}const i=this[t];void 0!==i?i&&i.isColor?i.set(n):i&&i.isVector3&&n&&n.isVector3?i.copy(n):this[t]=n:console.warn("THREE."+this.type+": '"+t+"' is not a property of this material.")}}toJSON(e){const t=void 0===e||"string"==typeof e;t&&(e={textures:{},images:{}});const n={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function i(e){const t=[];for(const n in e){const i=e[n];delete i.metadata,t.push(i)}return t}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),void 0!==this.roughness&&(n.roughness=this.roughness),void 0!==this.metalness&&(n.metalness=this.metalness),void 0!==this.sheen&&(n.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(n.sheenColor=this.sheenColor.getHex()),void 0!==this.sheenRoughness&&(n.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),void 0!==this.specularIntensity&&(n.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(n.specularColor=this.specularColor.getHex()),void 0!==this.shininess&&(n.shininess=this.shininess),void 0!==this.clearcoat&&(n.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),void 0!==this.iridescence&&(n.iridescence=this.iridescence),void 0!==this.iridescenceIOR&&(n.iridescenceIOR=this.iridescenceIOR),void 0!==this.iridescenceThicknessRange&&(n.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(n.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(n.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(e).uuid,n.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(e).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(e).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(e).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(e).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(n.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(n.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(e).uuid,void 0!==this.combine&&(n.combine=this.combine)),void 0!==this.envMapIntensity&&(n.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(n.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(n.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(e).uuid),void 0!==this.transmission&&(n.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(n.transmissionMap=this.transmissionMap.toJSON(e).uuid),void 0!==this.thickness&&(n.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(n.thicknessMap=this.thicknessMap.toJSON(e).uuid),void 0!==this.attenuationDistance&&(n.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationColor&&(n.attenuationColor=this.attenuationColor.getHex()),void 0!==this.size&&(n.size=this.size),null!==this.shadowSide&&(n.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(n.sizeAttenuation=this.sizeAttenuation),1!==this.blending&&(n.blending=this.blending),0!==this.side&&(n.side=this.side),this.vertexColors&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),!0===this.transparent&&(n.transparent=this.transparent),n.depthFunc=this.depthFunc,n.depthTest=this.depthTest,n.depthWrite=this.depthWrite,n.colorWrite=this.colorWrite,n.stencilWrite=this.stencilWrite,n.stencilWriteMask=this.stencilWriteMask,n.stencilFunc=this.stencilFunc,n.stencilRef=this.stencilRef,n.stencilFuncMask=this.stencilFuncMask,n.stencilFail=this.stencilFail,n.stencilZFail=this.stencilZFail,n.stencilZPass=this.stencilZPass,void 0!==this.rotation&&0!==this.rotation&&(n.rotation=this.rotation),!0===this.polygonOffset&&(n.polygonOffset=!0),0!==this.polygonOffsetFactor&&(n.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(n.polygonOffsetUnits=this.polygonOffsetUnits),void 0!==this.linewidth&&1!==this.linewidth&&(n.linewidth=this.linewidth),void 0!==this.dashSize&&(n.dashSize=this.dashSize),void 0!==this.gapSize&&(n.gapSize=this.gapSize),void 0!==this.scale&&(n.scale=this.scale),!0===this.dithering&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),!0===this.alphaToCoverage&&(n.alphaToCoverage=this.alphaToCoverage),!0===this.premultipliedAlpha&&(n.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(n.wireframe=this.wireframe),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(n.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(n.wireframeLinejoin=this.wireframeLinejoin),!0===this.flatShading&&(n.flatShading=this.flatShading),!1===this.visible&&(n.visible=!1),!1===this.toneMapped&&(n.toneMapped=!1),!1===this.fog&&(n.fog=!1),"{}"!==JSON.stringify(this.userData)&&(n.userData=this.userData),t){const t=i(e.textures),r=i(e.images);t.length>0&&(n.textures=t),r.length>0&&(n.images=r)}return n}clone(){return(new this.constructor).copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let n=null;if(null!==t){const e=t.length;n=new Array(e);for(let i=0;i!==e;++i)n[i]=t[i].clone()}return this.clippingPlanes=n,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){!0===e&&this.version++}}const iZ=new Qz,rZ=new Bz;class oZ{constructor(e,t,n){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=e,this.itemSize=t,this.count=void 0!==e?e.length/t:0,this.normalized=!0===n,this.usage=35044,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this}copyAt(e,t,n){e*=this.itemSize,n*=t.itemSize;for(let i=0,r=this.itemSize;i<r;i++)this.array[e+i]=t.array[n+i];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(2===this.itemSize)for(let t=0,n=this.count;t<n;t++)rZ.fromBufferAttribute(this,t),rZ.applyMatrix3(e),this.setXY(t,rZ.x,rZ.y);else if(3===this.itemSize)for(let t=0,n=this.count;t<n;t++)iZ.fromBufferAttribute(this,t),iZ.applyMatrix3(e),this.setXYZ(t,iZ.x,iZ.y,iZ.z);return this}applyMatrix4(e){for(let t=0,n=this.count;t<n;t++)iZ.fromBufferAttribute(this,t),iZ.applyMatrix4(e),this.setXYZ(t,iZ.x,iZ.y,iZ.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)iZ.fromBufferAttribute(this,t),iZ.applyNormalMatrix(e),this.setXYZ(t,iZ.x,iZ.y,iZ.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)iZ.fromBufferAttribute(this,t),iZ.transformDirection(e),this.setXYZ(t,iZ.x,iZ.y,iZ.z);return this}set(e,t=0){return this.array.set(e,t),this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=Nz(t,this.array)),t}setX(e,t){return this.normalized&&(t=Az(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=Nz(t,this.array)),t}setY(e,t){return this.normalized&&(t=Az(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=Nz(t,this.array)),t}setZ(e,t){return this.normalized&&(t=Az(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=Nz(t,this.array)),t}setW(e,t){return this.normalized&&(t=Az(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,n){return e*=this.itemSize,this.normalized&&(t=Az(t,this.array),n=Az(n,this.array)),this.array[e+0]=t,this.array[e+1]=n,this}setXYZ(e,t,n,i){return e*=this.itemSize,this.normalized&&(t=Az(t,this.array),n=Az(n,this.array),i=Az(i,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=i,this}setXYZW(e,t,n,i,r){return e*=this.itemSize,this.normalized&&(t=Az(t,this.array),n=Az(n,this.array),i=Az(i,this.array),r=Az(r,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=i,this.array[e+3]=r,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return""!==this.name&&(e.name=this.name),35044!==this.usage&&(e.usage=this.usage),0===this.updateRange.offset&&-1===this.updateRange.count||(e.updateRange=this.updateRange),e}copyColorsArray(){console.error("THREE.BufferAttribute: copyColorsArray() was removed in r144.")}copyVector2sArray(){console.error("THREE.BufferAttribute: copyVector2sArray() was removed in r144.")}copyVector3sArray(){console.error("THREE.BufferAttribute: copyVector3sArray() was removed in r144.")}copyVector4sArray(){console.error("THREE.BufferAttribute: copyVector4sArray() was removed in r144.")}}class aZ extends oZ{constructor(e,t,n){super(new Uint16Array(e),t,n)}}class sZ extends oZ{constructor(e,t,n){super(new Uint32Array(e),t,n)}}class lZ extends oZ{constructor(e,t,n){super(new Float32Array(e),t,n)}}let pZ=0;const uZ=new Cw,hZ=new eZ,cZ=new Qz,_Z=new nw,dZ=new nw,mZ=new Qz;class PZ extends gz{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:pZ++}),this.uuid=Ez(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(function(e){for(let t=e.length-1;t>=0;--t)if(e[t]>=65535)return!0;return!1}(e)?sZ:aZ)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return void 0!==this.attributes[e]}addGroup(e,t,n=0){this.groups.push({start:e,count:t,materialIndex:n})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;void 0!==t&&(t.applyMatrix4(e),t.needsUpdate=!0);const n=this.attributes.normal;if(void 0!==n){const t=(new Tz).getNormalMatrix(e);n.applyNormalMatrix(t),n.needsUpdate=!0}const i=this.attributes.tangent;return void 0!==i&&(i.transformDirection(e),i.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}applyQuaternion(e){return uZ.makeRotationFromQuaternion(e),this.applyMatrix4(uZ),this}rotateX(e){return uZ.makeRotationX(e),this.applyMatrix4(uZ),this}rotateY(e){return uZ.makeRotationY(e),this.applyMatrix4(uZ),this}rotateZ(e){return uZ.makeRotationZ(e),this.applyMatrix4(uZ),this}translate(e,t,n){return uZ.makeTranslation(e,t,n),this.applyMatrix4(uZ),this}scale(e,t,n){return uZ.makeScale(e,t,n),this.applyMatrix4(uZ),this}lookAt(e){return hZ.lookAt(e),hZ.updateMatrix(),this.applyMatrix4(hZ.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(cZ).negate(),this.translate(cZ.x,cZ.y,cZ.z),this}setFromPoints(e){const t=[];for(let n=0,i=e.length;n<i;n++){const i=e[n];t.push(i.x,i.y,i.z||0)}return this.setAttribute("position",new lZ(t,3)),this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new nw);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingBox.set(new Qz(-1/0,-1/0,-1/0),new Qz(1/0,1/0,1/0));if(void 0!==e){if(this.boundingBox.setFromBufferAttribute(e),t)for(let e=0,n=t.length;e<n;e++){const n=t[e];_Z.setFromBufferAttribute(n),this.morphTargetsRelative?(mZ.addVectors(this.boundingBox.min,_Z.min),this.boundingBox.expandByPoint(mZ),mZ.addVectors(this.boundingBox.max,_Z.max),this.boundingBox.expandByPoint(mZ)):(this.boundingBox.expandByPoint(_Z.min),this.boundingBox.expandByPoint(_Z.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new gw);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingSphere.set(new Qz,1/0);if(e){const n=this.boundingSphere.center;if(_Z.setFromBufferAttribute(e),t)for(let e=0,n=t.length;e<n;e++){const n=t[e];dZ.setFromBufferAttribute(n),this.morphTargetsRelative?(mZ.addVectors(_Z.min,dZ.min),_Z.expandByPoint(mZ),mZ.addVectors(_Z.max,dZ.max),_Z.expandByPoint(mZ)):(_Z.expandByPoint(dZ.min),_Z.expandByPoint(dZ.max))}_Z.getCenter(n);let i=0;for(let t=0,r=e.count;t<r;t++)mZ.fromBufferAttribute(e,t),i=Math.max(i,n.distanceToSquared(mZ));if(t)for(let r=0,o=t.length;r<o;r++){const o=t[r],a=this.morphTargetsRelative;for(let t=0,r=o.count;t<r;t++)mZ.fromBufferAttribute(o,t),a&&(cZ.fromBufferAttribute(e,t),mZ.add(cZ)),i=Math.max(i,n.distanceToSquared(mZ))}this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,t=this.attributes;if(null===e||void 0===t.position||void 0===t.normal||void 0===t.uv)return void console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");const n=e.array,i=t.position.array,r=t.normal.array,o=t.uv.array,a=i.length/3;!1===this.hasAttribute("tangent")&&this.setAttribute("tangent",new oZ(new Float32Array(4*a),4));const s=this.getAttribute("tangent").array,l=[],p=[];for(let e=0;e<a;e++)l[e]=new Qz,p[e]=new Qz;const u=new Qz,h=new Qz,c=new Qz,_=new Bz,d=new Bz,m=new Bz,P=new Qz,f=new Qz;function x(e,t,n){u.fromArray(i,3*e),h.fromArray(i,3*t),c.fromArray(i,3*n),_.fromArray(o,2*e),d.fromArray(o,2*t),m.fromArray(o,2*n),h.sub(u),c.sub(u),d.sub(_),m.sub(_);const r=1/(d.x*m.y-m.x*d.y);isFinite(r)&&(P.copy(h).multiplyScalar(m.y).addScaledVector(c,-d.y).multiplyScalar(r),f.copy(c).multiplyScalar(d.x).addScaledVector(h,-m.x).multiplyScalar(r),l[e].add(P),l[t].add(P),l[n].add(P),p[e].add(f),p[t].add(f),p[n].add(f))}let y=this.groups;0===y.length&&(y=[{start:0,count:n.length}]);for(let e=0,t=y.length;e<t;++e){const t=y[e],i=t.start;for(let e=i,r=i+t.count;e<r;e+=3)x(n[e+0],n[e+1],n[e+2])}const v=new Qz,g=new Qz,b=new Qz,z=new Qz;function w(e){b.fromArray(r,3*e),z.copy(b);const t=l[e];v.copy(t),v.sub(b.multiplyScalar(b.dot(t))).normalize(),g.crossVectors(z,t);const n=g.dot(p[e])<0?-1:1;s[4*e]=v.x,s[4*e+1]=v.y,s[4*e+2]=v.z,s[4*e+3]=n}for(let e=0,t=y.length;e<t;++e){const t=y[e],i=t.start;for(let e=i,r=i+t.count;e<r;e+=3)w(n[e+0]),w(n[e+1]),w(n[e+2])}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(void 0!==t){let n=this.getAttribute("normal");if(void 0===n)n=new oZ(new Float32Array(3*t.count),3),this.setAttribute("normal",n);else for(let e=0,t=n.count;e<t;e++)n.setXYZ(e,0,0,0);const i=new Qz,r=new Qz,o=new Qz,a=new Qz,s=new Qz,l=new Qz,p=new Qz,u=new Qz;if(e)for(let h=0,c=e.count;h<c;h+=3){const c=e.getX(h+0),_=e.getX(h+1),d=e.getX(h+2);i.fromBufferAttribute(t,c),r.fromBufferAttribute(t,_),o.fromBufferAttribute(t,d),p.subVectors(o,r),u.subVectors(i,r),p.cross(u),a.fromBufferAttribute(n,c),s.fromBufferAttribute(n,_),l.fromBufferAttribute(n,d),a.add(p),s.add(p),l.add(p),n.setXYZ(c,a.x,a.y,a.z),n.setXYZ(_,s.x,s.y,s.z),n.setXYZ(d,l.x,l.y,l.z)}else for(let e=0,a=t.count;e<a;e+=3)i.fromBufferAttribute(t,e+0),r.fromBufferAttribute(t,e+1),o.fromBufferAttribute(t,e+2),p.subVectors(o,r),u.subVectors(i,r),p.cross(u),n.setXYZ(e+0,p.x,p.y,p.z),n.setXYZ(e+1,p.x,p.y,p.z),n.setXYZ(e+2,p.x,p.y,p.z);this.normalizeNormals(),n.needsUpdate=!0}}merge(){return console.error("THREE.BufferGeometry.merge() has been removed. Use THREE.BufferGeometryUtils.mergeBufferGeometries() instead."),this}normalizeNormals(){const e=this.attributes.normal;for(let t=0,n=e.count;t<n;t++)mZ.fromBufferAttribute(e,t),mZ.normalize(),e.setXYZ(t,mZ.x,mZ.y,mZ.z)}toNonIndexed(){function e(e,t){const n=e.array,i=e.itemSize,r=e.normalized,o=new n.constructor(t.length*i);let a=0,s=0;for(let r=0,l=t.length;r<l;r++){a=e.isInterleavedBufferAttribute?t[r]*e.data.stride+e.offset:t[r]*i;for(let e=0;e<i;e++)o[s++]=n[a++]}return new oZ(o,i,r)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new PZ,n=this.index.array,i=this.attributes;for(const r in i){const o=e(i[r],n);t.setAttribute(r,o)}const r=this.morphAttributes;for(const i in r){const o=[],a=r[i];for(let t=0,i=a.length;t<i;t++){const i=e(a[t],n);o.push(i)}t.morphAttributes[i]=o}t.morphTargetsRelative=this.morphTargetsRelative;const o=this.groups;for(let e=0,n=o.length;e<n;e++){const n=o[e];t.addGroup(n.start,n.count,n.materialIndex)}return t}toJSON(){const e={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),void 0!==this.parameters){const t=this.parameters;for(const n in t)void 0!==t[n]&&(e[n]=t[n]);return e}e.data={attributes:{}};const t=this.index;null!==t&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const n=this.attributes;for(const t in n){const i=n[t];e.data.attributes[t]=i.toJSON(e.data)}const i={};let r=!1;for(const t in this.morphAttributes){const n=this.morphAttributes[t],o=[];for(let t=0,i=n.length;t<i;t++){const i=n[t];o.push(i.toJSON(e.data))}o.length>0&&(i[t]=o,r=!0)}r&&(e.data.morphAttributes=i,e.data.morphTargetsRelative=this.morphTargetsRelative);const o=this.groups;o.length>0&&(e.data.groups=JSON.parse(JSON.stringify(o)));const a=this.boundingSphere;return null!==a&&(e.data.boundingSphere={center:a.center.toArray(),radius:a.radius}),e}clone(){return(new this.constructor).copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const n=e.index;null!==n&&this.setIndex(n.clone(t));const i=e.attributes;for(const e in i){const n=i[e];this.setAttribute(e,n.clone(t))}const r=e.morphAttributes;for(const e in r){const n=[],i=r[e];for(let e=0,r=i.length;e<r;e++)n.push(i[e].clone(t));this.morphAttributes[e]=n}this.morphTargetsRelative=e.morphTargetsRelative;const o=e.groups;for(let e=0,t=o.length;e<t;e++){const t=o[e];this.addGroup(t.start,t.count,t.materialIndex)}const a=e.boundingBox;null!==a&&(this.boundingBox=a.clone());const s=e.boundingSphere;return null!==s&&(this.boundingSphere=s.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,void 0!==e.parameters&&(this.parameters=Object.assign({},e.parameters)),this}dispose(){this.dispatchEvent({type:"dispose"})}}class fZ extends nZ{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==e&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=function(e){const t={};for(const n in e){t[n]={};for(const i in e[n]){const r=e[n][i];r&&(r.isColor||r.isMatrix3||r.isMatrix4||r.isVector2||r.isVector3||r.isVector4||r.isTexture||r.isQuaternion)?t[n][i]=r.clone():Array.isArray(r)?t[n][i]=r.slice():t[n][i]=r}}return t}(e.uniforms),this.uniformsGroups=function(e){const t=[];for(let n=0;n<e.length;n++)t.push(e[n].clone());return t}(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const n in this.uniforms){const i=this.uniforms[n].value;i&&i.isTexture?t.uniforms[n]={type:"t",value:i.toJSON(e).uuid}:i&&i.isColor?t.uniforms[n]={type:"c",value:i.getHex()}:i&&i.isVector2?t.uniforms[n]={type:"v2",value:i.toArray()}:i&&i.isVector3?t.uniforms[n]={type:"v3",value:i.toArray()}:i&&i.isVector4?t.uniforms[n]={type:"v4",value:i.toArray()}:i&&i.isMatrix3?t.uniforms[n]={type:"m3",value:i.toArray()}:i&&i.isMatrix4?t.uniforms[n]={type:"m4",value:i.toArray()}:t.uniforms[n]={value:i}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader;const n={};for(const e in this.extensions)!0===this.extensions[e]&&(n[e]=!0);return Object.keys(n).length>0&&(t.extensions=n),t}}class xZ extends nZ{constructor(e){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new Wz(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}const yZ=new Cw,vZ=new class{constructor(e=new Qz,t=new Qz(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.direction).multiplyScalar(e).add(this.origin)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,bw)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const n=t.dot(this.direction);return n<0?t.copy(this.origin):t.copy(this.direction).multiplyScalar(n).add(this.origin)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=bw.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(bw.copy(this.direction).multiplyScalar(t).add(this.origin),bw.distanceToSquared(e))}distanceSqToSegment(e,t,n,i){zw.copy(e).add(t).multiplyScalar(.5),ww.copy(t).sub(e).normalize(),Zw.copy(this.origin).sub(zw);const r=.5*e.distanceTo(t),o=-this.direction.dot(ww),a=Zw.dot(this.direction),s=-Zw.dot(ww),l=Zw.lengthSq(),p=Math.abs(1-o*o);let u,h,c,_;if(p>0)if(u=o*s-a,h=o*a-s,_=r*p,u>=0)if(h>=-_)if(h<=_){const e=1/p;u*=e,h*=e,c=u*(u+o*h+2*a)+h*(o*u+h+2*s)+l}else h=r,u=Math.max(0,-(o*h+a)),c=-u*u+h*(h+2*s)+l;else h=-r,u=Math.max(0,-(o*h+a)),c=-u*u+h*(h+2*s)+l;else h<=-_?(u=Math.max(0,-(-o*r+a)),h=u>0?-r:Math.min(Math.max(-r,-s),r),c=-u*u+h*(h+2*s)+l):h<=_?(u=0,h=Math.min(Math.max(-r,-s),r),c=h*(h+2*s)+l):(u=Math.max(0,-(o*r+a)),h=u>0?r:Math.min(Math.max(-r,-s),r),c=-u*u+h*(h+2*s)+l);else h=o>0?-r:r,u=Math.max(0,-(o*h+a)),c=-u*u+h*(h+2*s)+l;return n&&n.copy(this.direction).multiplyScalar(u).add(this.origin),i&&i.copy(ww).multiplyScalar(h).add(zw),c}intersectSphere(e,t){bw.subVectors(e.center,this.origin);const n=bw.dot(this.direction),i=bw.dot(bw)-n*n,r=e.radius*e.radius;if(i>r)return null;const o=Math.sqrt(r-i),a=n-o,s=n+o;return a<0&&s<0?null:a<0?this.at(s,t):this.at(a,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(0===t)return 0===e.distanceToPoint(this.origin)?0:null;const n=-(this.origin.dot(e.normal)+e.constant)/t;return n>=0?n:null}intersectPlane(e,t){const n=this.distanceToPlane(e);return null===n?null:this.at(n,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);return 0===t||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let n,i,r,o,a,s;const l=1/this.direction.x,p=1/this.direction.y,u=1/this.direction.z,h=this.origin;return l>=0?(n=(e.min.x-h.x)*l,i=(e.max.x-h.x)*l):(n=(e.max.x-h.x)*l,i=(e.min.x-h.x)*l),p>=0?(r=(e.min.y-h.y)*p,o=(e.max.y-h.y)*p):(r=(e.max.y-h.y)*p,o=(e.min.y-h.y)*p),n>o||r>i?null:((r>n||n!=n)&&(n=r),(o<i||i!=i)&&(i=o),u>=0?(a=(e.min.z-h.z)*u,s=(e.max.z-h.z)*u):(a=(e.max.z-h.z)*u,s=(e.min.z-h.z)*u),n>s||a>i?null:((a>n||n!=n)&&(n=a),(s<i||i!=i)&&(i=s),i<0?null:this.at(n>=0?n:i,t)))}intersectsBox(e){return null!==this.intersectBox(e,bw)}intersectTriangle(e,t,n,i,r){Ew.subVectors(t,e),Mw.subVectors(n,e),Sw.crossVectors(Ew,Mw);let o,a=this.direction.dot(Sw);if(a>0){if(i)return null;o=1}else{if(!(a<0))return null;o=-1,a=-a}Zw.subVectors(this.origin,e);const s=o*this.direction.dot(Mw.crossVectors(Zw,Mw));if(s<0)return null;const l=o*this.direction.dot(Ew.cross(Zw));if(l<0)return null;if(s+l>a)return null;const p=-o*Zw.dot(Sw);return p<0?null:this.at(p/a,r)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return(new this.constructor).copy(this)}},gZ=new gw,bZ=new Qz;class zZ extends eZ{constructor(e=new PZ,t=new xZ){super(),this.isPoints=!0,this.type="Points",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=e.material,this.geometry=e.geometry,this}raycast(e,t){const n=this.geometry,i=this.matrixWorld,r=e.params.Points.threshold,o=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),gZ.copy(n.boundingSphere),gZ.applyMatrix4(i),gZ.radius+=r,!1===e.ray.intersectsSphere(gZ))return;yZ.copy(i).invert(),vZ.copy(e.ray).applyMatrix4(yZ);const a=r/((this.scale.x+this.scale.y+this.scale.z)/3),s=a*a,l=n.index,p=n.attributes.position;if(null!==l)for(let n=Math.max(0,o.start),r=Math.min(l.count,o.start+o.count);n<r;n++){const r=l.getX(n);bZ.fromBufferAttribute(p,r),wZ(bZ,r,s,i,e,t,this)}else for(let n=Math.max(0,o.start),r=Math.min(p.count,o.start+o.count);n<r;n++)bZ.fromBufferAttribute(p,n),wZ(bZ,n,s,i,e,t,this)}updateMorphTargets(){const e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){const n=e[t[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,t=n.length;e<t;e++){const t=n[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[t]=e}}}}}function wZ(e,t,n,i,r,o,a){const s=vZ.distanceSqToPoint(e);if(s<n){const n=new Qz;vZ.closestPointToPoint(e,n),n.applyMatrix4(i);const l=r.ray.origin.distanceTo(n);if(l<r.near||l>r.far)return;o.push({distance:l,distanceToRay:Math.sqrt(s),point:n,index:t,face:null,object:a})}}"\\[\\]\\.:\\/".replace("\\.",""),"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:"144"}})),"undefined"!=typeof window&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__="144");const ZZ="WORLD",EZ="SPHERE",MZ="VOLUME";var SZ,CZ,NZ=(SZ=function(e){var t=e.exports={Linear:{None:function(e){return e}},Quadratic:{In:function(e){return e*e},Out:function(e){return e*(2-e)},InOut:function(e){return(e*=2)<1?.5*e*e:-.5*(--e*(e-2)-1)}},Cubic:{In:function(e){return e*e*e},Out:function(e){return--e*e*e+1},InOut:function(e){return(e*=2)<1?.5*e*e*e:.5*((e-=2)*e*e+2)}},Quartic:{In:function(e){return e*e*e*e},Out:function(e){return 1- --e*e*e*e},InOut:function(e){return(e*=2)<1?.5*e*e*e*e:-.5*((e-=2)*e*e*e-2)}},Quintic:{In:function(e){return e*e*e*e*e},Out:function(e){return--e*e*e*e*e+1},InOut:function(e){return(e*=2)<1?.5*e*e*e*e*e:.5*((e-=2)*e*e*e*e+2)}},Sinusoidal:{In:function(e){return 1-Math.cos(e*Math.PI/2)},Out:function(e){return Math.sin(e*Math.PI/2)},InOut:function(e){return.5*(1-Math.cos(Math.PI*e))}},Exponential:{In:function(e){return 0===e?0:Math.pow(1024,e-1)},Out:function(e){return 1===e?1:1-Math.pow(2,-10*e)},InOut:function(e){return 0===e?0:1===e?1:(e*=2)<1?.5*Math.pow(1024,e-1):.5*(2-Math.pow(2,-10*(e-1)))}},Circular:{In:function(e){return 1-Math.sqrt(1-e*e)},Out:function(e){return Math.sqrt(1- --e*e)},InOut:function(e){return(e*=2)<1?-.5*(Math.sqrt(1-e*e)-1):.5*(Math.sqrt(1-(e-=2)*e)+1)}},Elastic:{In:function(e){var t,n=.1;return 0===e?0:1===e?1:(!n||n<1?(n=1,t=.1):t=.4*Math.asin(1/n)/(2*Math.PI),-n*Math.pow(2,10*(e-=1))*Math.sin((e-t)*(2*Math.PI)/.4))},Out:function(e){var t,n=.1;return 0===e?0:1===e?1:(!n||n<1?(n=1,t=.1):t=.4*Math.asin(1/n)/(2*Math.PI),n*Math.pow(2,-10*e)*Math.sin((e-t)*(2*Math.PI)/.4)+1)},InOut:function(e){var t,n=.1;return 0===e?0:1===e?1:(!n||n<1?(n=1,t=.1):t=.4*Math.asin(1/n)/(2*Math.PI),(e*=2)<1?n*Math.pow(2,10*(e-=1))*Math.sin((e-t)*(2*Math.PI)/.4)*-.5:n*Math.pow(2,-10*(e-=1))*Math.sin((e-t)*(2*Math.PI)/.4)*.5+1)}},Back:{In:function(e){var t=1.70158;return e*e*((t+1)*e-t)},Out:function(e){var t=1.70158;return--e*e*((t+1)*e+t)+1},InOut:function(e){var t=2.5949095;return(e*=2)<1?e*e*((t+1)*e-t)*.5:.5*((e-=2)*e*((t+1)*e+t)+2)}},Bounce:{In:function(e){return 1-t.Bounce.Out(1-e)},Out:function(e){return e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375},InOut:function(e){return e<.5?.5*t.Bounce.In(2*e):.5*t.Bounce.Out(2*e-1)+.5}}}},SZ(CZ={exports:{}}),CZ.exports);const AZ="BEZIER",LZ={LINEAR:NZ.Linear.None,QUADRATIC_IN:NZ.Quadratic.In,QUADRATIC_OUT:NZ.Quadratic.Out,QUADRATIC_IN_OUT:NZ.Quadratic.InOut,CUBIC_IN:NZ.Cubic.In,CUBIC_OUT:NZ.Cubic.Out,CUBIC_IN_OUT:NZ.Cubic.InOut,QUARTIC_IN:NZ.Quartic.In,QUARTIC_OUT:NZ.Quartic.Out,QUARTIC_IN_OUT:NZ.Quartic.InOut,QUINTIC_IN:NZ.Quintic.In,QUINTIC_OUT:NZ.Quintic.Out,QUINTIC_IN_OUT:NZ.Quintic.InOut,SINUSOIDAL_IN:NZ.Sinusoidal.In,SINUSOIDAL_OUT:NZ.Sinusoidal.Out,SINUSOIDAL_IN_OUT:NZ.Sinusoidal.InOut,EXPONENTIAL_IN:NZ.Exponential.In,EXPONENTIAL_OUT:NZ.Exponential.Out,EXPONENTIAL_IN_OUT:NZ.Exponential.InOut,CIRCULAR_IN:NZ.Circular.In,CIRCULAR_OUT:NZ.Circular.Out,CIRCULAR_IN_OUT:NZ.Circular.InOut,ELASTIC_IN:NZ.Elastic.In,ELASTIC_OUT:NZ.Elastic.Out,ELASTIC_IN_OUT:NZ.Elastic.InOut,BACK_IN:NZ.Back.In,BACK_OUT:NZ.Back.Out,BACK_IN_OUT:NZ.Back.InOut,BOUNCE_IN:NZ.Bounce.In,BOUNCE_OUT:NZ.Bounce.Out,BOUNCE_IN_OUT:NZ.Bounce.InOut},BZ=100,TZ=1e3,VZ=1001,kZ=1002,IZ=1003,OZ=1006,RZ=1012,HZ=1014,FZ=1015,DZ=1016,GZ=1020,UZ=1022,jZ=1023,WZ=1026,qZ=1027,JZ=2300,$Z=2301,XZ=2302,YZ=2400,KZ=2401,QZ=2402,eE=3e3,tE=7680,nE=35044,iE=35048,rE="300 es";class oE{addEventListener(e,t){void 0===this._listeners&&(this._listeners={});const n=this._listeners;void 0===n[e]&&(n[e]=[]),-1===n[e].indexOf(t)&&n[e].push(t)}hasEventListener(e,t){if(void 0===this._listeners)return!1;const n=this._listeners;return void 0!==n[e]&&-1!==n[e].indexOf(t)}removeEventListener(e,t){if(void 0===this._listeners)return;const n=this._listeners[e];if(void 0!==n){const e=n.indexOf(t);-1!==e&&n.splice(e,1)}}dispatchEvent(e){if(void 0===this._listeners)return;const t=this._listeners[e.type];if(void 0!==t){e.target=this;const n=t.slice(0);for(let t=0,i=n.length;t<i;t++)n[t].call(this,e);e.target=null}}}const aE=[];for(let e=0;e<256;e++)aE[e]=(e<16?"0":"")+e.toString(16);const sE=Math.PI/180,lE=180/Math.PI;function pE(){const e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,n=4294967295*Math.random()|0,i=4294967295*Math.random()|0;return(aE[255&e]+aE[e>>8&255]+aE[e>>16&255]+aE[e>>24&255]+"-"+aE[255&t]+aE[t>>8&255]+"-"+aE[t>>16&15|64]+aE[t>>24&255]+"-"+aE[63&n|128]+aE[n>>8&255]+"-"+aE[n>>16&255]+aE[n>>24&255]+aE[255&i]+aE[i>>8&255]+aE[i>>16&255]+aE[i>>24&255]).toUpperCase()}function uE(e,t,n){return Math.max(t,Math.min(n,e))}function hE(e,t,n){return(1-n)*e+n*t}function cE(e){return 0==(e&e-1)&&0!==e}function _E(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))}class dE{constructor(e=0,t=0){this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e,t){return void 0!==t?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this)}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e,t){return void 0!==t?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this)}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,n=this.y,i=e.elements;return this.x=i[0]*t+i[3]*n+i[6],this.y=i[1]*t+i[4]*n+i[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y;return t*t+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t,n){return void 0!==n&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const n=Math.cos(t),i=Math.sin(t),r=this.x-e.x,o=this.y-e.y;return this.x=r*n-o*i+e.x,this.y=r*i+o*n+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}}dE.prototype.isVector2=!0;class mE{constructor(){this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}set(e,t,n,i,r,o,a,s,l){const p=this.elements;return p[0]=e,p[1]=i,p[2]=a,p[3]=t,p[4]=r,p[5]=s,p[6]=n,p[7]=o,p[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],this}extractBasis(e,t,n){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,i=t.elements,r=this.elements,o=n[0],a=n[3],s=n[6],l=n[1],p=n[4],u=n[7],h=n[2],c=n[5],_=n[8],d=i[0],m=i[3],P=i[6],f=i[1],x=i[4],y=i[7],v=i[2],g=i[5],b=i[8];return r[0]=o*d+a*f+s*v,r[3]=o*m+a*x+s*g,r[6]=o*P+a*y+s*b,r[1]=l*d+p*f+u*v,r[4]=l*m+p*x+u*g,r[7]=l*P+p*y+u*b,r[2]=h*d+c*f+_*v,r[5]=h*m+c*x+_*g,r[8]=h*P+c*y+_*b,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[1],i=e[2],r=e[3],o=e[4],a=e[5],s=e[6],l=e[7],p=e[8];return t*o*p-t*a*l-n*r*p+n*a*s+i*r*l-i*o*s}invert(){const e=this.elements,t=e[0],n=e[1],i=e[2],r=e[3],o=e[4],a=e[5],s=e[6],l=e[7],p=e[8],u=p*o-a*l,h=a*s-p*r,c=l*r-o*s,_=t*u+n*h+i*c;if(0===_)return this.set(0,0,0,0,0,0,0,0,0);const d=1/_;return e[0]=u*d,e[1]=(i*l-p*n)*d,e[2]=(a*n-i*o)*d,e[3]=h*d,e[4]=(p*t-i*s)*d,e[5]=(i*r-a*t)*d,e[6]=c*d,e[7]=(n*s-l*t)*d,e[8]=(o*t-n*r)*d,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,n,i,r,o,a){const s=Math.cos(r),l=Math.sin(r);return this.set(n*s,n*l,-n*(s*o+l*a)+o+e,-i*l,i*s,-i*(-l*o+s*a)+a+t,0,0,1),this}scale(e,t){const n=this.elements;return n[0]*=e,n[3]*=e,n[6]*=e,n[1]*=t,n[4]*=t,n[7]*=t,this}rotate(e){const t=Math.cos(e),n=Math.sin(e),i=this.elements,r=i[0],o=i[3],a=i[6],s=i[1],l=i[4],p=i[7];return i[0]=t*r+n*s,i[3]=t*o+n*l,i[6]=t*a+n*p,i[1]=-n*r+t*s,i[4]=-n*o+t*l,i[7]=-n*a+t*p,this}translate(e,t){const n=this.elements;return n[0]+=e*n[2],n[3]+=e*n[5],n[6]+=e*n[8],n[1]+=t*n[2],n[4]+=t*n[5],n[7]+=t*n[8],this}equals(e){const t=this.elements,n=e.elements;for(let e=0;e<9;e++)if(t[e]!==n[e])return!1;return!0}fromArray(e,t=0){for(let n=0;n<9;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e}clone(){return(new this.constructor).fromArray(this.elements)}}let PE;mE.prototype.isMatrix3=!0;class fE{static getDataURL(e){if(/^data:/i.test(e.src))return e.src;if("undefined"==typeof HTMLCanvasElement)return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{void 0===PE&&(PE=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")),PE.width=e.width,PE.height=e.height;const n=PE.getContext("2d");e instanceof ImageData?n.putImageData(e,0,0):n.drawImage(e,0,0,e.width,e.height),t=PE}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}}let xE=0;class yE extends oE{constructor(e=yE.DEFAULT_IMAGE,t=yE.DEFAULT_MAPPING,n=1001,i=1001,r=1006,o=1008,a=1023,s=1009,l=1,p=3e3){super(),Object.defineProperty(this,"id",{value:xE++}),this.uuid=pE(),this.name="",this.image=e,this.mipmaps=[],this.mapping=t,this.wrapS=n,this.wrapT=i,this.magFilter=r,this.minFilter=o,this.anisotropy=l,this.format=a,this.internalFormat=null,this.type=s,this.offset=new dE(0,0),this.repeat=new dE(1,1),this.center=new dE(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new mE,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=p,this.version=0,this.onUpdate=null}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return(new this.constructor).copy(this)}copy(e){return this.name=e.name,this.image=e.image,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this}toJSON(e){const t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.textures[this.uuid])return e.textures[this.uuid];const n={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};if(void 0!==this.image){const i=this.image;if(void 0===i.uuid&&(i.uuid=pE()),!t&&void 0===e.images[i.uuid]){let t;if(Array.isArray(i)){t=[];for(let e=0,n=i.length;e<n;e++)i[e].isDataTexture?t.push(vE(i[e].image)):t.push(vE(i[e]))}else t=vE(i);e.images[i.uuid]={uuid:i.uuid,url:t}}n.image=i.uuid}return t||(e.textures[this.uuid]=n),n}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(300!==this.mapping)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case TZ:e.x=e.x-Math.floor(e.x);break;case VZ:e.x=e.x<0?0:1;break;case kZ:1===Math.abs(Math.floor(e.x)%2)?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||e.y>1)switch(this.wrapT){case TZ:e.y=e.y-Math.floor(e.y);break;case VZ:e.y=e.y<0?0:1;break;case kZ:1===Math.abs(Math.floor(e.y)%2)?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){!0===e&&this.version++}}function vE(e){return"undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap?fE.getDataURL(e):e.data?{data:Array.prototype.slice.call(e.data),width:e.width,height:e.height,type:e.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}yE.DEFAULT_IMAGE=void 0,yE.DEFAULT_MAPPING=300,yE.prototype.isTexture=!0;class gE{constructor(e=0,t=0,n=0,i=1){this.x=e,this.y=t,this.z=n,this.w=i}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,n,i){return this.x=e,this.y=t,this.z=n,this.w=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this}add(e,t){return void 0!==t?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this)}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e,t){return void 0!==t?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this)}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,n=this.y,i=this.z,r=this.w,o=e.elements;return this.x=o[0]*t+o[4]*n+o[8]*i+o[12]*r,this.y=o[1]*t+o[5]*n+o[9]*i+o[13]*r,this.z=o[2]*t+o[6]*n+o[10]*i+o[14]*r,this.w=o[3]*t+o[7]*n+o[11]*i+o[15]*r,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,n,i,r;const o=.01,a=.1,s=e.elements,l=s[0],p=s[4],u=s[8],h=s[1],c=s[5],_=s[9],d=s[2],m=s[6],P=s[10];if(Math.abs(p-h)<o&&Math.abs(u-d)<o&&Math.abs(_-m)<o){if(Math.abs(p+h)<a&&Math.abs(u+d)<a&&Math.abs(_+m)<a&&Math.abs(l+c+P-3)<a)return this.set(1,0,0,0),this;t=Math.PI;const e=(l+1)/2,s=(c+1)/2,f=(P+1)/2,x=(p+h)/4,y=(u+d)/4,v=(_+m)/4;return e>s&&e>f?e<o?(n=0,i=.707106781,r=.707106781):(n=Math.sqrt(e),i=x/n,r=y/n):s>f?s<o?(n=.707106781,i=0,r=.707106781):(i=Math.sqrt(s),n=x/i,r=v/i):f<o?(n=.707106781,i=.707106781,r=0):(r=Math.sqrt(f),n=y/r,i=v/r),this.set(n,i,r,t),this}let f=Math.sqrt((m-_)*(m-_)+(u-d)*(u-d)+(h-p)*(h-p));return Math.abs(f)<.001&&(f=1),this.x=(m-_)/f,this.y=(u-d)/f,this.z=(h-p)/f,this.w=Math.acos((l+c+P-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this.w=e.w+(t.w-e.w)*n,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t,n){return void 0!==n&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}}gE.prototype.isVector4=!0;class bE extends oE{constructor(e,t,n){super(),this.width=e,this.height=t,this.depth=1,this.scissor=new gE(0,0,e,t),this.scissorTest=!1,this.viewport=new gE(0,0,e,t),n=n||{},this.texture=new yE(void 0,n.mapping,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.encoding),this.texture.image={},this.texture.image.width=e,this.texture.image.height=t,this.texture.image.depth=1,this.texture.generateMipmaps=void 0!==n.generateMipmaps&&n.generateMipmaps,this.texture.minFilter=void 0!==n.minFilter?n.minFilter:OZ,this.depthBuffer=void 0===n.depthBuffer||n.depthBuffer,this.stencilBuffer=void 0!==n.stencilBuffer&&n.stencilBuffer,this.depthTexture=void 0!==n.depthTexture?n.depthTexture:null}setTexture(e){e.image={width:this.width,height:this.height,depth:this.depth},this.texture=e}setSize(e,t,n=1){this.width===e&&this.height===t&&this.depth===n||(this.width=e,this.height=t,this.depth=n,this.texture.image.width=e,this.texture.image.height=t,this.texture.image.depth=n,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return(new this.constructor).copy(this)}copy(e){return this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.depthTexture=e.depthTexture,this}dispose(){this.dispatchEvent({type:"dispose"})}}bE.prototype.isWebGLRenderTarget=!0,class extends bE{constructor(e,t,n){super(e,t,n),this.samples=4}copy(e){return super.copy.call(this,e),this.samples=e.samples,this}}.prototype.isWebGLMultisampleRenderTarget=!0;class zE{constructor(e=0,t=0,n=0,i=1){this._x=e,this._y=t,this._z=n,this._w=i}static slerp(e,t,n,i){return console.warn("THREE.Quaternion: Static .slerp() has been deprecated. Use qm.slerpQuaternions( qa, qb, t ) instead."),n.slerpQuaternions(e,t,i)}static slerpFlat(e,t,n,i,r,o,a){let s=n[i+0],l=n[i+1],p=n[i+2],u=n[i+3];const h=r[o+0],c=r[o+1],_=r[o+2],d=r[o+3];if(0===a)return e[t+0]=s,e[t+1]=l,e[t+2]=p,void(e[t+3]=u);if(1===a)return e[t+0]=h,e[t+1]=c,e[t+2]=_,void(e[t+3]=d);if(u!==d||s!==h||l!==c||p!==_){let e=1-a;const t=s*h+l*c+p*_+u*d,n=t>=0?1:-1,i=1-t*t;if(i>Number.EPSILON){const r=Math.sqrt(i),o=Math.atan2(r,t*n);e=Math.sin(e*o)/r,a=Math.sin(a*o)/r}const r=a*n;if(s=s*e+h*r,l=l*e+c*r,p=p*e+_*r,u=u*e+d*r,e===1-a){const e=1/Math.sqrt(s*s+l*l+p*p+u*u);s*=e,l*=e,p*=e,u*=e}}e[t]=s,e[t+1]=l,e[t+2]=p,e[t+3]=u}static multiplyQuaternionsFlat(e,t,n,i,r,o){const a=n[i],s=n[i+1],l=n[i+2],p=n[i+3],u=r[o],h=r[o+1],c=r[o+2],_=r[o+3];return e[t]=a*_+p*u+s*c-l*h,e[t+1]=s*_+p*h+l*u-a*c,e[t+2]=l*_+p*c+a*h-s*u,e[t+3]=p*_-a*u-s*h-l*c,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,n,i){return this._x=e,this._y=t,this._z=n,this._w=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t){if(!e||!e.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");const n=e._x,i=e._y,r=e._z,o=e._order,a=Math.cos,s=Math.sin,l=a(n/2),p=a(i/2),u=a(r/2),h=s(n/2),c=s(i/2),_=s(r/2);switch(o){case"XYZ":this._x=h*p*u+l*c*_,this._y=l*c*u-h*p*_,this._z=l*p*_+h*c*u,this._w=l*p*u-h*c*_;break;case"YXZ":this._x=h*p*u+l*c*_,this._y=l*c*u-h*p*_,this._z=l*p*_-h*c*u,this._w=l*p*u+h*c*_;break;case"ZXY":this._x=h*p*u-l*c*_,this._y=l*c*u+h*p*_,this._z=l*p*_+h*c*u,this._w=l*p*u-h*c*_;break;case"ZYX":this._x=h*p*u-l*c*_,this._y=l*c*u+h*p*_,this._z=l*p*_-h*c*u,this._w=l*p*u+h*c*_;break;case"YZX":this._x=h*p*u+l*c*_,this._y=l*c*u+h*p*_,this._z=l*p*_-h*c*u,this._w=l*p*u-h*c*_;break;case"XZY":this._x=h*p*u-l*c*_,this._y=l*c*u-h*p*_,this._z=l*p*_+h*c*u,this._w=l*p*u+h*c*_;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+o)}return!1!==t&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const n=t/2,i=Math.sin(n);return this._x=e.x*i,this._y=e.y*i,this._z=e.z*i,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,n=t[0],i=t[4],r=t[8],o=t[1],a=t[5],s=t[9],l=t[2],p=t[6],u=t[10],h=n+a+u;if(h>0){const e=.5/Math.sqrt(h+1);this._w=.25/e,this._x=(p-s)*e,this._y=(r-l)*e,this._z=(o-i)*e}else if(n>a&&n>u){const e=2*Math.sqrt(1+n-a-u);this._w=(p-s)/e,this._x=.25*e,this._y=(i+o)/e,this._z=(r+l)/e}else if(a>u){const e=2*Math.sqrt(1+a-n-u);this._w=(r-l)/e,this._x=(i+o)/e,this._y=.25*e,this._z=(s+p)/e}else{const e=2*Math.sqrt(1+u-n-a);this._w=(o-i)/e,this._x=(r+l)/e,this._y=(s+p)/e,this._z=.25*e}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let n=e.dot(t)+1;return n<Number.EPSILON?(n=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=n):(this._x=0,this._y=-e.z,this._z=e.y,this._w=n)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=n),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(uE(this.dot(e),-1,1)))}rotateTowards(e,t){const n=this.angleTo(e);if(0===n)return this;const i=Math.min(1,t/n);return this.slerp(e,i),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e,t){return void 0!==t?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,t)):this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const n=e._x,i=e._y,r=e._z,o=e._w,a=t._x,s=t._y,l=t._z,p=t._w;return this._x=n*p+o*a+i*l-r*s,this._y=i*p+o*s+r*a-n*l,this._z=r*p+o*l+n*s-i*a,this._w=o*p-n*a-i*s-r*l,this._onChangeCallback(),this}slerp(e,t){if(0===t)return this;if(1===t)return this.copy(e);const n=this._x,i=this._y,r=this._z,o=this._w;let a=o*e._w+n*e._x+i*e._y+r*e._z;if(a<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,a=-a):this.copy(e),a>=1)return this._w=o,this._x=n,this._y=i,this._z=r,this;const s=1-a*a;if(s<=Number.EPSILON){const e=1-t;return this._w=e*o+t*this._w,this._x=e*n+t*this._x,this._y=e*i+t*this._y,this._z=e*r+t*this._z,this.normalize(),this._onChangeCallback(),this}const l=Math.sqrt(s),p=Math.atan2(l,a),u=Math.sin((1-t)*p)/l,h=Math.sin(t*p)/l;return this._w=o*u+this._w*h,this._x=n*u+this._x*h,this._y=i*u+this._y*h,this._z=r*u+this._z*h,this._onChangeCallback(),this}slerpQuaternions(e,t,n){this.copy(e).slerp(t,n)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}}zE.prototype.isQuaternion=!0;class wE{constructor(e=0,t=0,n=0){this.x=e,this.y=t,this.z=n}set(e,t,n){return void 0===n&&(n=this.z),this.x=e,this.y=t,this.z=n,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e,t){return void 0!==t?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e,t){return void 0!==t?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e,t){return void 0!==t?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return e&&e.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(EE.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(EE.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,n=this.y,i=this.z,r=e.elements;return this.x=r[0]*t+r[3]*n+r[6]*i,this.y=r[1]*t+r[4]*n+r[7]*i,this.z=r[2]*t+r[5]*n+r[8]*i,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,n=this.y,i=this.z,r=e.elements,o=1/(r[3]*t+r[7]*n+r[11]*i+r[15]);return this.x=(r[0]*t+r[4]*n+r[8]*i+r[12])*o,this.y=(r[1]*t+r[5]*n+r[9]*i+r[13])*o,this.z=(r[2]*t+r[6]*n+r[10]*i+r[14])*o,this}applyQuaternion(e){const t=this.x,n=this.y,i=this.z,r=e.x,o=e.y,a=e.z,s=e.w,l=s*t+o*i-a*n,p=s*n+a*t-r*i,u=s*i+r*n-o*t,h=-r*t-o*n-a*i;return this.x=l*s+h*-r+p*-a-u*-o,this.y=p*s+h*-o+u*-r-l*-a,this.z=u*s+h*-a+l*-o-p*-r,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,n=this.y,i=this.z,r=e.elements;return this.x=r[0]*t+r[4]*n+r[8]*i,this.y=r[1]*t+r[5]*n+r[9]*i,this.z=r[2]*t+r[6]*n+r[10]*i,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this}cross(e,t){return void 0!==t?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t)):this.crossVectors(this,e)}crossVectors(e,t){const n=e.x,i=e.y,r=e.z,o=t.x,a=t.y,s=t.z;return this.x=i*s-r*a,this.y=r*o-n*s,this.z=n*a-i*o,this}projectOnVector(e){const t=e.lengthSq();if(0===t)return this.set(0,0,0);const n=e.dot(this)/t;return this.copy(e).multiplyScalar(n)}projectOnPlane(e){return ZE.copy(this).projectOnVector(e),this.sub(ZE)}reflect(e){return this.sub(ZE.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(uE(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y,i=this.z-e.z;return t*t+n*n+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,n){const i=Math.sin(t)*e;return this.x=i*Math.sin(n),this.y=Math.cos(t)*e,this.z=i*Math.cos(n),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,n){return this.x=e*Math.sin(t),this.y=n,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),i=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=n,this.z=i,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,4*t)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,3*t)}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t,n){return void 0!==n&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}}wE.prototype.isVector3=!0;const ZE=new wE,EE=new zE;class ME{constructor(e=new wE(1/0,1/0,1/0),t=new wE(-1/0,-1/0,-1/0)){this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){let t=1/0,n=1/0,i=1/0,r=-1/0,o=-1/0,a=-1/0;for(let s=0,l=e.length;s<l;s+=3){const l=e[s],p=e[s+1],u=e[s+2];l<t&&(t=l),p<n&&(n=p),u<i&&(i=u),l>r&&(r=l),p>o&&(o=p),u>a&&(a=u)}return this.min.set(t,n,i),this.max.set(r,o,a),this}setFromBufferAttribute(e){let t=1/0,n=1/0,i=1/0,r=-1/0,o=-1/0,a=-1/0;for(let s=0,l=e.count;s<l;s++){const l=e.getX(s),p=e.getY(s),u=e.getZ(s);l<t&&(t=l),p<n&&(n=p),u<i&&(i=u),l>r&&(r=l),p>o&&(o=p),u>a&&(a=u)}return this.min.set(t,n,i),this.max.set(r,o,a),this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const n=CE.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}setFromObject(e){return this.makeEmpty(),this.expandByObject(e)}clone(){return(new this.constructor).copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return void 0===e&&(console.warn("THREE.Box3: .getCenter() target is now required"),e=new wE),this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return void 0===e&&(console.warn("THREE.Box3: .getSize() target is now required"),e=new wE),this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e){e.updateWorldMatrix(!1,!1);const t=e.geometry;void 0!==t&&(null===t.boundingBox&&t.computeBoundingBox(),NE.copy(t.boundingBox),NE.applyMatrix4(e.matrixWorld),this.union(NE));const n=e.children;for(let e=0,t=n.length;e<t;e++)this.expandByObject(n[e]);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return void 0===t&&(console.warn("THREE.Box3: .getParameter() target is now required"),t=new wE),t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,CE),CE.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,n;return e.normal.x>0?(t=e.normal.x*this.min.x,n=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,n=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,n+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,n+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,n+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,n+=e.normal.z*this.min.z),t<=-e.constant&&n>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(IE),OE.subVectors(this.max,IE),AE.subVectors(e.a,IE),LE.subVectors(e.b,IE),BE.subVectors(e.c,IE),TE.subVectors(LE,AE),VE.subVectors(BE,LE),kE.subVectors(AE,BE);let t=[0,-TE.z,TE.y,0,-VE.z,VE.y,0,-kE.z,kE.y,TE.z,0,-TE.x,VE.z,0,-VE.x,kE.z,0,-kE.x,-TE.y,TE.x,0,-VE.y,VE.x,0,-kE.y,kE.x,0];return!!FE(t,AE,LE,BE,OE)&&(t=[1,0,0,0,1,0,0,0,1],!!FE(t,AE,LE,BE,OE)&&(RE.crossVectors(TE,VE),t=[RE.x,RE.y,RE.z],FE(t,AE,LE,BE,OE)))}clampPoint(e,t){return void 0===t&&(console.warn("THREE.Box3: .clampPoint() target is now required"),t=new wE),t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return CE.copy(e).clamp(this.min,this.max).sub(e).length()}getBoundingSphere(e){return void 0===e&&console.error("THREE.Box3: .getBoundingSphere() target is now required"),this.getCenter(e.center),e.radius=.5*this.getSize(CE).length(),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()||(SE[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),SE[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),SE[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),SE[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),SE[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),SE[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),SE[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),SE[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(SE)),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}ME.prototype.isBox3=!0;const SE=[new wE,new wE,new wE,new wE,new wE,new wE,new wE,new wE],CE=new wE,NE=new ME,AE=new wE,LE=new wE,BE=new wE,TE=new wE,VE=new wE,kE=new wE,IE=new wE,OE=new wE,RE=new wE,HE=new wE;function FE(e,t,n,i,r){for(let o=0,a=e.length-3;o<=a;o+=3){HE.fromArray(e,o);const a=r.x*Math.abs(HE.x)+r.y*Math.abs(HE.y)+r.z*Math.abs(HE.z),s=t.dot(HE),l=n.dot(HE),p=i.dot(HE);if(Math.max(-Math.max(s,l,p),Math.min(s,l,p))>a)return!1}return!0}const DE=new ME,GE=new wE,UE=new wE,jE=new wE;class WE{constructor(e=new wE,t=-1){this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const n=this.center;void 0!==t?n.copy(t):DE.setFromPoints(e).getCenter(n);let i=0;for(let t=0,r=e.length;t<r;t++)i=Math.max(i,n.distanceToSquared(e[t]));return this.radius=Math.sqrt(i),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const n=this.center.distanceToSquared(e);return void 0===t&&(console.warn("THREE.Sphere: .clampPoint() target is now required"),t=new wE),t.copy(e),n>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return void 0===e&&(console.warn("THREE.Sphere: .getBoundingBox() target is now required"),e=new ME),this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){jE.subVectors(e,this.center);const t=jE.lengthSq();if(t>this.radius*this.radius){const e=Math.sqrt(t),n=.5*(e-this.radius);this.center.add(jE.multiplyScalar(n/e)),this.radius+=n}return this}union(e){return UE.subVectors(e.center,this.center).normalize().multiplyScalar(e.radius),this.expandByPoint(GE.copy(e.center).add(UE)),this.expandByPoint(GE.copy(e.center).sub(UE)),this}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return(new this.constructor).copy(this)}}const qE=new wE,JE=new wE,$E=new wE,XE=new wE,YE=new wE,KE=new wE,QE=new wE;class eM{constructor(e=new wE,t=new wE(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return void 0===t&&(console.warn("THREE.Ray: .at() target is now required"),t=new wE),t.copy(this.direction).multiplyScalar(e).add(this.origin)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,qE)),this}closestPointToPoint(e,t){void 0===t&&(console.warn("THREE.Ray: .closestPointToPoint() target is now required"),t=new wE),t.subVectors(e,this.origin);const n=t.dot(this.direction);return n<0?t.copy(this.origin):t.copy(this.direction).multiplyScalar(n).add(this.origin)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=qE.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(qE.copy(this.direction).multiplyScalar(t).add(this.origin),qE.distanceToSquared(e))}distanceSqToSegment(e,t,n,i){JE.copy(e).add(t).multiplyScalar(.5),$E.copy(t).sub(e).normalize(),XE.copy(this.origin).sub(JE);const r=.5*e.distanceTo(t),o=-this.direction.dot($E),a=XE.dot(this.direction),s=-XE.dot($E),l=XE.lengthSq(),p=Math.abs(1-o*o);let u,h,c,_;if(p>0)if(u=o*s-a,h=o*a-s,_=r*p,u>=0)if(h>=-_)if(h<=_){const e=1/p;u*=e,h*=e,c=u*(u+o*h+2*a)+h*(o*u+h+2*s)+l}else h=r,u=Math.max(0,-(o*h+a)),c=-u*u+h*(h+2*s)+l;else h=-r,u=Math.max(0,-(o*h+a)),c=-u*u+h*(h+2*s)+l;else h<=-_?(u=Math.max(0,-(-o*r+a)),h=u>0?-r:Math.min(Math.max(-r,-s),r),c=-u*u+h*(h+2*s)+l):h<=_?(u=0,h=Math.min(Math.max(-r,-s),r),c=h*(h+2*s)+l):(u=Math.max(0,-(o*r+a)),h=u>0?r:Math.min(Math.max(-r,-s),r),c=-u*u+h*(h+2*s)+l);else h=o>0?-r:r,u=Math.max(0,-(o*h+a)),c=-u*u+h*(h+2*s)+l;return n&&n.copy(this.direction).multiplyScalar(u).add(this.origin),i&&i.copy($E).multiplyScalar(h).add(JE),c}intersectSphere(e,t){qE.subVectors(e.center,this.origin);const n=qE.dot(this.direction),i=qE.dot(qE)-n*n,r=e.radius*e.radius;if(i>r)return null;const o=Math.sqrt(r-i),a=n-o,s=n+o;return a<0&&s<0?null:a<0?this.at(s,t):this.at(a,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(0===t)return 0===e.distanceToPoint(this.origin)?0:null;const n=-(this.origin.dot(e.normal)+e.constant)/t;return n>=0?n:null}intersectPlane(e,t){const n=this.distanceToPlane(e);return null===n?null:this.at(n,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);return 0===t||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let n,i,r,o,a,s;const l=1/this.direction.x,p=1/this.direction.y,u=1/this.direction.z,h=this.origin;return l>=0?(n=(e.min.x-h.x)*l,i=(e.max.x-h.x)*l):(n=(e.max.x-h.x)*l,i=(e.min.x-h.x)*l),p>=0?(r=(e.min.y-h.y)*p,o=(e.max.y-h.y)*p):(r=(e.max.y-h.y)*p,o=(e.min.y-h.y)*p),n>o||r>i?null:((r>n||n!=n)&&(n=r),(o<i||i!=i)&&(i=o),u>=0?(a=(e.min.z-h.z)*u,s=(e.max.z-h.z)*u):(a=(e.max.z-h.z)*u,s=(e.min.z-h.z)*u),n>s||a>i?null:((a>n||n!=n)&&(n=a),(s<i||i!=i)&&(i=s),i<0?null:this.at(n>=0?n:i,t)))}intersectsBox(e){return null!==this.intersectBox(e,qE)}intersectTriangle(e,t,n,i,r){YE.subVectors(t,e),KE.subVectors(n,e),QE.crossVectors(YE,KE);let o,a=this.direction.dot(QE);if(a>0){if(i)return null;o=1}else{if(!(a<0))return null;o=-1,a=-a}XE.subVectors(this.origin,e);const s=o*this.direction.dot(KE.crossVectors(XE,KE));if(s<0)return null;const l=o*this.direction.dot(YE.cross(XE));if(l<0)return null;if(s+l>a)return null;const p=-o*XE.dot(QE);return p<0?null:this.at(p/a,r)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return(new this.constructor).copy(this)}}class tM{constructor(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}set(e,t,n,i,r,o,a,s,l,p,u,h,c,_,d,m){const P=this.elements;return P[0]=e,P[4]=t,P[8]=n,P[12]=i,P[1]=r,P[5]=o,P[9]=a,P[13]=s,P[2]=l,P[6]=p,P[10]=u,P[14]=h,P[3]=c,P[7]=_,P[11]=d,P[15]=m,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new tM).fromArray(this.elements)}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],this}copyPosition(e){const t=this.elements,n=e.elements;return t[12]=n[12],t[13]=n[13],t[14]=n[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,n){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}makeBasis(e,t,n){return this.set(e.x,t.x,n.x,0,e.y,t.y,n.y,0,e.z,t.z,n.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,n=e.elements,i=1/nM.setFromMatrixColumn(e,0).length(),r=1/nM.setFromMatrixColumn(e,1).length(),o=1/nM.setFromMatrixColumn(e,2).length();return t[0]=n[0]*i,t[1]=n[1]*i,t[2]=n[2]*i,t[3]=0,t[4]=n[4]*r,t[5]=n[5]*r,t[6]=n[6]*r,t[7]=0,t[8]=n[8]*o,t[9]=n[9]*o,t[10]=n[10]*o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){e&&e.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");const t=this.elements,n=e.x,i=e.y,r=e.z,o=Math.cos(n),a=Math.sin(n),s=Math.cos(i),l=Math.sin(i),p=Math.cos(r),u=Math.sin(r);if("XYZ"===e.order){const e=o*p,n=o*u,i=a*p,r=a*u;t[0]=s*p,t[4]=-s*u,t[8]=l,t[1]=n+i*l,t[5]=e-r*l,t[9]=-a*s,t[2]=r-e*l,t[6]=i+n*l,t[10]=o*s}else if("YXZ"===e.order){const e=s*p,n=s*u,i=l*p,r=l*u;t[0]=e+r*a,t[4]=i*a-n,t[8]=o*l,t[1]=o*u,t[5]=o*p,t[9]=-a,t[2]=n*a-i,t[6]=r+e*a,t[10]=o*s}else if("ZXY"===e.order){const e=s*p,n=s*u,i=l*p,r=l*u;t[0]=e-r*a,t[4]=-o*u,t[8]=i+n*a,t[1]=n+i*a,t[5]=o*p,t[9]=r-e*a,t[2]=-o*l,t[6]=a,t[10]=o*s}else if("ZYX"===e.order){const e=o*p,n=o*u,i=a*p,r=a*u;t[0]=s*p,t[4]=i*l-n,t[8]=e*l+r,t[1]=s*u,t[5]=r*l+e,t[9]=n*l-i,t[2]=-l,t[6]=a*s,t[10]=o*s}else if("YZX"===e.order){const e=o*s,n=o*l,i=a*s,r=a*l;t[0]=s*p,t[4]=r-e*u,t[8]=i*u+n,t[1]=u,t[5]=o*p,t[9]=-a*p,t[2]=-l*p,t[6]=n*u+i,t[10]=e-r*u}else if("XZY"===e.order){const e=o*s,n=o*l,i=a*s,r=a*l;t[0]=s*p,t[4]=-u,t[8]=l*p,t[1]=e*u+r,t[5]=o*p,t[9]=n*u-i,t[2]=i*u-n,t[6]=a*p,t[10]=r*u+e}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(rM,e,oM)}lookAt(e,t,n){const i=this.elements;return lM.subVectors(e,t),0===lM.lengthSq()&&(lM.z=1),lM.normalize(),aM.crossVectors(n,lM),0===aM.lengthSq()&&(1===Math.abs(n.z)?lM.x+=1e-4:lM.z+=1e-4,lM.normalize(),aM.crossVectors(n,lM)),aM.normalize(),sM.crossVectors(lM,aM),i[0]=aM.x,i[4]=sM.x,i[8]=lM.x,i[1]=aM.y,i[5]=sM.y,i[9]=lM.y,i[2]=aM.z,i[6]=sM.z,i[10]=lM.z,this}multiply(e,t){return void 0!==t?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,i=t.elements,r=this.elements,o=n[0],a=n[4],s=n[8],l=n[12],p=n[1],u=n[5],h=n[9],c=n[13],_=n[2],d=n[6],m=n[10],P=n[14],f=n[3],x=n[7],y=n[11],v=n[15],g=i[0],b=i[4],z=i[8],w=i[12],Z=i[1],E=i[5],M=i[9],S=i[13],C=i[2],N=i[6],A=i[10],L=i[14],B=i[3],T=i[7],V=i[11],k=i[15];return r[0]=o*g+a*Z+s*C+l*B,r[4]=o*b+a*E+s*N+l*T,r[8]=o*z+a*M+s*A+l*V,r[12]=o*w+a*S+s*L+l*k,r[1]=p*g+u*Z+h*C+c*B,r[5]=p*b+u*E+h*N+c*T,r[9]=p*z+u*M+h*A+c*V,r[13]=p*w+u*S+h*L+c*k,r[2]=_*g+d*Z+m*C+P*B,r[6]=_*b+d*E+m*N+P*T,r[10]=_*z+d*M+m*A+P*V,r[14]=_*w+d*S+m*L+P*k,r[3]=f*g+x*Z+y*C+v*B,r[7]=f*b+x*E+y*N+v*T,r[11]=f*z+x*M+y*A+v*V,r[15]=f*w+x*S+y*L+v*k,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[4],i=e[8],r=e[12],o=e[1],a=e[5],s=e[9],l=e[13],p=e[2],u=e[6],h=e[10],c=e[14];return e[3]*(+r*s*u-i*l*u-r*a*h+n*l*h+i*a*c-n*s*c)+e[7]*(+t*s*c-t*l*h+r*o*h-i*o*c+i*l*p-r*s*p)+e[11]*(+t*l*u-t*a*c-r*o*u+n*o*c+r*a*p-n*l*p)+e[15]*(-i*a*p-t*s*u+t*a*h+i*o*u-n*o*h+n*s*p)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,n){const i=this.elements;return e.isVector3?(i[12]=e.x,i[13]=e.y,i[14]=e.z):(i[12]=e,i[13]=t,i[14]=n),this}invert(){const e=this.elements,t=e[0],n=e[1],i=e[2],r=e[3],o=e[4],a=e[5],s=e[6],l=e[7],p=e[8],u=e[9],h=e[10],c=e[11],_=e[12],d=e[13],m=e[14],P=e[15],f=u*m*l-d*h*l+d*s*c-a*m*c-u*s*P+a*h*P,x=_*h*l-p*m*l-_*s*c+o*m*c+p*s*P-o*h*P,y=p*d*l-_*u*l+_*a*c-o*d*c-p*a*P+o*u*P,v=_*u*s-p*d*s-_*a*h+o*d*h+p*a*m-o*u*m,g=t*f+n*x+i*y+r*v;if(0===g)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const b=1/g;return e[0]=f*b,e[1]=(d*h*r-u*m*r-d*i*c+n*m*c+u*i*P-n*h*P)*b,e[2]=(a*m*r-d*s*r+d*i*l-n*m*l-a*i*P+n*s*P)*b,e[3]=(u*s*r-a*h*r-u*i*l+n*h*l+a*i*c-n*s*c)*b,e[4]=x*b,e[5]=(p*m*r-_*h*r+_*i*c-t*m*c-p*i*P+t*h*P)*b,e[6]=(_*s*r-o*m*r-_*i*l+t*m*l+o*i*P-t*s*P)*b,e[7]=(o*h*r-p*s*r+p*i*l-t*h*l-o*i*c+t*s*c)*b,e[8]=y*b,e[9]=(_*u*r-p*d*r-_*n*c+t*d*c+p*n*P-t*u*P)*b,e[10]=(o*d*r-_*a*r+_*n*l-t*d*l-o*n*P+t*a*P)*b,e[11]=(p*a*r-o*u*r-p*n*l+t*u*l+o*n*c-t*a*c)*b,e[12]=v*b,e[13]=(p*d*i-_*u*i+_*n*h-t*d*h-p*n*m+t*u*m)*b,e[14]=(_*a*i-o*d*i-_*n*s+t*d*s+o*n*m-t*a*m)*b,e[15]=(o*u*i-p*a*i+p*n*s-t*u*s-o*n*h+t*a*h)*b,this}scale(e){const t=this.elements,n=e.x,i=e.y,r=e.z;return t[0]*=n,t[4]*=i,t[8]*=r,t[1]*=n,t[5]*=i,t[9]*=r,t[2]*=n,t[6]*=i,t[10]*=r,t[3]*=n,t[7]*=i,t[11]*=r,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],i=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,n,i))}makeTranslation(e,t,n){return this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const n=Math.cos(t),i=Math.sin(t),r=1-n,o=e.x,a=e.y,s=e.z,l=r*o,p=r*a;return this.set(l*o+n,l*a-i*s,l*s+i*a,0,l*a+i*s,p*a+n,p*s-i*o,0,l*s-i*a,p*s+i*o,r*s*s+n,0,0,0,0,1),this}makeScale(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this}makeShear(e,t,n){return this.set(1,t,n,0,e,1,n,0,e,t,1,0,0,0,0,1),this}compose(e,t,n){const i=this.elements,r=t._x,o=t._y,a=t._z,s=t._w,l=r+r,p=o+o,u=a+a,h=r*l,c=r*p,_=r*u,d=o*p,m=o*u,P=a*u,f=s*l,x=s*p,y=s*u,v=n.x,g=n.y,b=n.z;return i[0]=(1-(d+P))*v,i[1]=(c+y)*v,i[2]=(_-x)*v,i[3]=0,i[4]=(c-y)*g,i[5]=(1-(h+P))*g,i[6]=(m+f)*g,i[7]=0,i[8]=(_+x)*b,i[9]=(m-f)*b,i[10]=(1-(h+d))*b,i[11]=0,i[12]=e.x,i[13]=e.y,i[14]=e.z,i[15]=1,this}decompose(e,t,n){const i=this.elements;let r=nM.set(i[0],i[1],i[2]).length();const o=nM.set(i[4],i[5],i[6]).length(),a=nM.set(i[8],i[9],i[10]).length();this.determinant()<0&&(r=-r),e.x=i[12],e.y=i[13],e.z=i[14],iM.copy(this);const s=1/r,l=1/o,p=1/a;return iM.elements[0]*=s,iM.elements[1]*=s,iM.elements[2]*=s,iM.elements[4]*=l,iM.elements[5]*=l,iM.elements[6]*=l,iM.elements[8]*=p,iM.elements[9]*=p,iM.elements[10]*=p,t.setFromRotationMatrix(iM),n.x=r,n.y=o,n.z=a,this}makePerspective(e,t,n,i,r,o){void 0===o&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");const a=this.elements,s=2*r/(t-e),l=2*r/(n-i),p=(t+e)/(t-e),u=(n+i)/(n-i),h=-(o+r)/(o-r),c=-2*o*r/(o-r);return a[0]=s,a[4]=0,a[8]=p,a[12]=0,a[1]=0,a[5]=l,a[9]=u,a[13]=0,a[2]=0,a[6]=0,a[10]=h,a[14]=c,a[3]=0,a[7]=0,a[11]=-1,a[15]=0,this}makeOrthographic(e,t,n,i,r,o){const a=this.elements,s=1/(t-e),l=1/(n-i),p=1/(o-r),u=(t+e)*s,h=(n+i)*l,c=(o+r)*p;return a[0]=2*s,a[4]=0,a[8]=0,a[12]=-u,a[1]=0,a[5]=2*l,a[9]=0,a[13]=-h,a[2]=0,a[6]=0,a[10]=-2*p,a[14]=-c,a[3]=0,a[7]=0,a[11]=0,a[15]=1,this}equals(e){const t=this.elements,n=e.elements;for(let e=0;e<16;e++)if(t[e]!==n[e])return!1;return!0}fromArray(e,t=0){for(let n=0;n<16;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e}}tM.prototype.isMatrix4=!0;const nM=new wE,iM=new tM,rM=new wE(0,0,0),oM=new wE(1,1,1),aM=new wE,sM=new wE,lM=new wE,pM=new tM,uM=new zE;class hM{constructor(e=0,t=0,n=0,i=hM.DefaultOrder){this._x=e,this._y=t,this._z=n,this._order=i}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,n,i){return this._x=e,this._y=t,this._z=n,this._order=i||this._order,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t,n){const i=e.elements,r=i[0],o=i[4],a=i[8],s=i[1],l=i[5],p=i[9],u=i[2],h=i[6],c=i[10];switch(t=t||this._order){case"XYZ":this._y=Math.asin(uE(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-p,c),this._z=Math.atan2(-o,r)):(this._x=Math.atan2(h,l),this._z=0);break;case"YXZ":this._x=Math.asin(-uE(p,-1,1)),Math.abs(p)<.9999999?(this._y=Math.atan2(a,c),this._z=Math.atan2(s,l)):(this._y=Math.atan2(-u,r),this._z=0);break;case"ZXY":this._x=Math.asin(uE(h,-1,1)),Math.abs(h)<.9999999?(this._y=Math.atan2(-u,c),this._z=Math.atan2(-o,l)):(this._y=0,this._z=Math.atan2(s,r));break;case"ZYX":this._y=Math.asin(-uE(u,-1,1)),Math.abs(u)<.9999999?(this._x=Math.atan2(h,c),this._z=Math.atan2(s,r)):(this._x=0,this._z=Math.atan2(-o,l));break;case"YZX":this._z=Math.asin(uE(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(-p,l),this._y=Math.atan2(-u,r)):(this._x=0,this._y=Math.atan2(a,c));break;case"XZY":this._z=Math.asin(-uE(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(h,l),this._y=Math.atan2(a,r)):(this._x=Math.atan2(-p,c),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,!1!==n&&this._onChangeCallback(),this}setFromQuaternion(e,t,n){return pM.makeRotationFromQuaternion(e),this.setFromRotationMatrix(pM,t,n)}setFromVector3(e,t){return this.set(e.x,e.y,e.z,t||this._order)}reorder(e){return uM.setFromEuler(this),this.setFromQuaternion(uM,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}toVector3(e){return e?e.set(this._x,this._y,this._z):new wE(this._x,this._y,this._z)}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}}hM.prototype.isEuler=!0,hM.DefaultOrder="XYZ",hM.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];class cM{constructor(){this.mask=1}set(e){this.mask=1<<e|0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return 0!=(this.mask&e.mask)}}let _M=0;const dM=new wE,mM=new zE,PM=new tM,fM=new wE,xM=new wE,yM=new wE,vM=new zE,gM=new wE(1,0,0),bM=new wE(0,1,0),zM=new wE(0,0,1),wM={type:"added"},ZM={type:"removed"};class EM extends oE{constructor(){super(),Object.defineProperty(this,"id",{value:_M++}),this.uuid=pE(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=EM.DefaultUp.clone();const e=new wE,t=new hM,n=new zE,i=new wE(1,1,1);t._onChange((function(){n.setFromEuler(t,!1)})),n._onChange((function(){t.setFromQuaternion(n,void 0,!1)})),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:i},modelViewMatrix:{value:new tM},normalMatrix:{value:new mE}}),this.matrix=new tM,this.matrixWorld=new tM,this.matrixAutoUpdate=EM.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new cM,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return mM.setFromAxisAngle(e,t),this.quaternion.multiply(mM),this}rotateOnWorldAxis(e,t){return mM.setFromAxisAngle(e,t),this.quaternion.premultiply(mM),this}rotateX(e){return this.rotateOnAxis(gM,e)}rotateY(e){return this.rotateOnAxis(bM,e)}rotateZ(e){return this.rotateOnAxis(zM,e)}translateOnAxis(e,t){return dM.copy(e).applyQuaternion(this.quaternion),this.position.add(dM.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(gM,e)}translateY(e){return this.translateOnAxis(bM,e)}translateZ(e){return this.translateOnAxis(zM,e)}localToWorld(e){return e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return e.applyMatrix4(PM.copy(this.matrixWorld).invert())}lookAt(e,t,n){e.isVector3?fM.copy(e):fM.set(e,t,n);const i=this.parent;this.updateWorldMatrix(!0,!1),xM.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?PM.lookAt(xM,fM,this.up):PM.lookAt(fM,xM,this.up),this.quaternion.setFromRotationMatrix(PM),i&&(PM.extractRotation(i.matrixWorld),mM.setFromRotationMatrix(PM),this.quaternion.premultiply(mM.invert()))}add(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(null!==e.parent&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(wM)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.remove(arguments[e]);return this}const t=this.children.indexOf(e);return-1!==t&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(ZM)),this}clear(){for(let e=0;e<this.children.length;e++){const t=this.children[e];t.parent=null,t.dispatchEvent(ZM)}return this.children.length=0,this}attach(e){return this.updateWorldMatrix(!0,!1),PM.copy(this.matrixWorld).invert(),null!==e.parent&&(e.parent.updateWorldMatrix(!0,!1),PM.multiply(e.parent.matrixWorld)),e.applyMatrix4(PM),this.add(e),e.updateWorldMatrix(!1,!0),this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let n=0,i=this.children.length;n<i;n++){const i=this.children[n].getObjectByProperty(e,t);if(void 0!==i)return i}}getWorldPosition(e){return void 0===e&&(console.warn("THREE.Object3D: .getWorldPosition() target is now required"),e=new wE),this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return void 0===e&&(console.warn("THREE.Object3D: .getWorldQuaternion() target is now required"),e=new zE),this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(xM,e,yM),e}getWorldScale(e){return void 0===e&&(console.warn("THREE.Object3D: .getWorldScale() target is now required"),e=new wE),this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(xM,vM,e),e}getWorldDirection(e){void 0===e&&(console.warn("THREE.Object3D: .getWorldDirection() target is now required"),e=new wE),this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let n=0,i=t.length;n<i;n++)t[n].traverse(e)}traverseVisible(e){if(!1===this.visible)return;e(this);const t=this.children;for(let n=0,i=t.length;n<i;n++)t[n].traverseVisible(e)}traverseAncestors(e){const t=this.parent;null!==t&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let n=0,i=t.length;n<i;n++)t[n].updateMatrixWorld(e)}updateWorldMatrix(e,t){const n=this.parent;if(!0===e&&null!==n&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===t){const e=this.children;for(let t=0,n=e.length;t<n;t++)e[t].updateWorldMatrix(!1,!0)}}toJSON(e){const t=void 0===e||"string"==typeof e,n={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{}},n.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});const i={};function r(t,n){return void 0===t[n.uuid]&&(t[n.uuid]=n.toJSON(e)),n.uuid}if(i.uuid=this.uuid,i.type=this.type,""!==this.name&&(i.name=this.name),!0===this.castShadow&&(i.castShadow=!0),!0===this.receiveShadow&&(i.receiveShadow=!0),!1===this.visible&&(i.visible=!1),!1===this.frustumCulled&&(i.frustumCulled=!1),0!==this.renderOrder&&(i.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(i.userData=this.userData),i.layers=this.layers.mask,i.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(i.matrixAutoUpdate=!1),this.isInstancedMesh&&(i.type="InstancedMesh",i.count=this.count,i.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(i.instanceColor=this.instanceColor.toJSON())),this.isMesh||this.isLine||this.isPoints){i.geometry=r(e.geometries,this.geometry);const t=this.geometry.parameters;if(void 0!==t&&void 0!==t.shapes){const n=t.shapes;if(Array.isArray(n))for(let t=0,i=n.length;t<i;t++){const i=n[t];r(e.shapes,i)}else r(e.shapes,n)}}if(this.isSkinnedMesh&&(i.bindMode=this.bindMode,i.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(r(e.skeletons,this.skeleton),i.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){const t=[];for(let n=0,i=this.material.length;n<i;n++)t.push(r(e.materials,this.material[n]));i.material=t}else i.material=r(e.materials,this.material);if(this.children.length>0){i.children=[];for(let t=0;t<this.children.length;t++)i.children.push(this.children[t].toJSON(e).object)}if(this.animations.length>0){i.animations=[];for(let t=0;t<this.animations.length;t++){const n=this.animations[t];i.animations.push(r(e.animations,n))}}if(t){const t=o(e.geometries),i=o(e.materials),r=o(e.textures),a=o(e.images),s=o(e.shapes),l=o(e.skeletons),p=o(e.animations);t.length>0&&(n.geometries=t),i.length>0&&(n.materials=i),r.length>0&&(n.textures=r),a.length>0&&(n.images=a),s.length>0&&(n.shapes=s),l.length>0&&(n.skeletons=l),p.length>0&&(n.animations=p)}return n.object=i,n;function o(e){const t=[];for(const n in e){const i=e[n];delete i.metadata,t.push(i)}return t}}clone(e){return(new this.constructor).copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),!0===t)for(let t=0;t<e.children.length;t++){const n=e.children[t];this.add(n.clone())}return this}}EM.DefaultUp=new wE(0,1,0),EM.DefaultMatrixAutoUpdate=!0,EM.prototype.isObject3D=!0;const MM=new wE,SM=new wE,CM=new mE;class NM{constructor(e=new wE(1,0,0),t=0){this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,n,i){return this.normal.set(e,t,n),this.constant=i,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,n){const i=MM.subVectors(n,t).cross(SM.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(i,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return void 0===t&&(console.warn("THREE.Plane: .projectPoint() target is now required"),t=new wE),t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)}intersectLine(e,t){void 0===t&&(console.warn("THREE.Plane: .intersectLine() target is now required"),t=new wE);const n=e.delta(MM),i=this.normal.dot(n);if(0===i)return 0===this.distanceToPoint(e.start)?t.copy(e.start):null;const r=-(e.start.dot(this.normal)+this.constant)/i;return r<0||r>1?null:t.copy(n).multiplyScalar(r).add(e.start)}intersectsLine(e){const t=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return t<0&&n>0||n<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return void 0===e&&(console.warn("THREE.Plane: .coplanarPoint() target is now required"),e=new wE),e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const n=t||CM.getNormalMatrix(e),i=this.coplanarPoint(MM).applyMatrix4(e),r=this.normal.applyMatrix3(n).normalize();return this.constant=-i.dot(r),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return(new this.constructor).copy(this)}}NM.prototype.isPlane=!0;const AM=new wE,LM=new wE,BM=new wE,TM=new wE,VM=new wE,kM=new wE,IM=new wE,OM=new wE,RM=new wE,HM=new wE;class FM{constructor(e=new wE,t=new wE,n=new wE){this.a=e,this.b=t,this.c=n}static getNormal(e,t,n,i){void 0===i&&(console.warn("THREE.Triangle: .getNormal() target is now required"),i=new wE),i.subVectors(n,t),AM.subVectors(e,t),i.cross(AM);const r=i.lengthSq();return r>0?i.multiplyScalar(1/Math.sqrt(r)):i.set(0,0,0)}static getBarycoord(e,t,n,i,r){AM.subVectors(i,t),LM.subVectors(n,t),BM.subVectors(e,t);const o=AM.dot(AM),a=AM.dot(LM),s=AM.dot(BM),l=LM.dot(LM),p=LM.dot(BM),u=o*l-a*a;if(void 0===r&&(console.warn("THREE.Triangle: .getBarycoord() target is now required"),r=new wE),0===u)return r.set(-2,-1,-1);const h=1/u,c=(l*s-a*p)*h,_=(o*p-a*s)*h;return r.set(1-c-_,_,c)}static containsPoint(e,t,n,i){return this.getBarycoord(e,t,n,i,TM),TM.x>=0&&TM.y>=0&&TM.x+TM.y<=1}static getUV(e,t,n,i,r,o,a,s){return this.getBarycoord(e,t,n,i,TM),s.set(0,0),s.addScaledVector(r,TM.x),s.addScaledVector(o,TM.y),s.addScaledVector(a,TM.z),s}static isFrontFacing(e,t,n,i){return AM.subVectors(n,t),LM.subVectors(e,t),AM.cross(LM).dot(i)<0}set(e,t,n){return this.a.copy(e),this.b.copy(t),this.c.copy(n),this}setFromPointsAndIndices(e,t,n,i){return this.a.copy(e[t]),this.b.copy(e[n]),this.c.copy(e[i]),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return AM.subVectors(this.c,this.b),LM.subVectors(this.a,this.b),.5*AM.cross(LM).length()}getMidpoint(e){return void 0===e&&(console.warn("THREE.Triangle: .getMidpoint() target is now required"),e=new wE),e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return FM.getNormal(this.a,this.b,this.c,e)}getPlane(e){return void 0===e&&(console.warn("THREE.Triangle: .getPlane() target is now required"),e=new NM),e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return FM.getBarycoord(e,this.a,this.b,this.c,t)}getUV(e,t,n,i,r){return FM.getUV(e,this.a,this.b,this.c,t,n,i,r)}containsPoint(e){return FM.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return FM.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){void 0===t&&(console.warn("THREE.Triangle: .closestPointToPoint() target is now required"),t=new wE);const n=this.a,i=this.b,r=this.c;let o,a;VM.subVectors(i,n),kM.subVectors(r,n),OM.subVectors(e,n);const s=VM.dot(OM),l=kM.dot(OM);if(s<=0&&l<=0)return t.copy(n);RM.subVectors(e,i);const p=VM.dot(RM),u=kM.dot(RM);if(p>=0&&u<=p)return t.copy(i);const h=s*u-p*l;if(h<=0&&s>=0&&p<=0)return o=s/(s-p),t.copy(n).addScaledVector(VM,o);HM.subVectors(e,r);const c=VM.dot(HM),_=kM.dot(HM);if(_>=0&&c<=_)return t.copy(r);const d=c*l-s*_;if(d<=0&&l>=0&&_<=0)return a=l/(l-_),t.copy(n).addScaledVector(kM,a);const m=p*_-c*u;if(m<=0&&u-p>=0&&c-_>=0)return IM.subVectors(r,i),a=(u-p)/(u-p+(c-_)),t.copy(i).addScaledVector(IM,a);const P=1/(m+d+h);return o=d*P,a=h*P,t.copy(n).addScaledVector(VM,o).addScaledVector(kM,a)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}let DM=0;function GM(){Object.defineProperty(this,"id",{value:DM++}),this.uuid=pE(),this.name="",this.type="Material",this.fog=!0,this.blending=1,this.side=0,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=204,this.blendDst=205,this.blendEquation=BZ,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=3,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=519,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=tE,this.stencilZFail=tE,this.stencilZPass=tE,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaTest=0,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0}GM.prototype=Object.assign(Object.create(oE.prototype),{constructor:GM,isMaterial:!0,onBuild:function(){},onBeforeCompile:function(){},customProgramCacheKey:function(){return this.onBeforeCompile.toString()},setValues:function(e){if(void 0!==e)for(const t in e){const n=e[t];if(void 0===n){console.warn("THREE.Material: '"+t+"' parameter is undefined.");continue}if("shading"===t){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===n;continue}const i=this[t];void 0!==i?i&&i.isColor?i.set(n):i&&i.isVector3&&n&&n.isVector3?i.copy(n):this[t]=n:console.warn("THREE."+this.type+": '"+t+"' is not a property of this material.")}},toJSON:function(e){const t=void 0===e||"string"==typeof e;t&&(e={textures:{},images:{}});const n={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function i(e){const t=[];for(const n in e){const i=e[n];delete i.metadata,t.push(i)}return t}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),void 0!==this.roughness&&(n.roughness=this.roughness),void 0!==this.metalness&&(n.metalness=this.metalness),this.sheen&&this.sheen.isColor&&(n.sheen=this.sheen.getHex()),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),void 0!==this.shininess&&(n.shininess=this.shininess),void 0!==this.clearcoat&&(n.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(e).uuid,n.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(e).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(e).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(e).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(e).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(e).uuid,void 0!==this.combine&&(n.combine=this.combine)),void 0!==this.envMapIntensity&&(n.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(n.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(n.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(e).uuid),void 0!==this.size&&(n.size=this.size),null!==this.shadowSide&&(n.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(n.sizeAttenuation=this.sizeAttenuation),1!==this.blending&&(n.blending=this.blending),0!==this.side&&(n.side=this.side),this.vertexColors&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),!0===this.transparent&&(n.transparent=this.transparent),n.depthFunc=this.depthFunc,n.depthTest=this.depthTest,n.depthWrite=this.depthWrite,n.colorWrite=this.colorWrite,n.stencilWrite=this.stencilWrite,n.stencilWriteMask=this.stencilWriteMask,n.stencilFunc=this.stencilFunc,n.stencilRef=this.stencilRef,n.stencilFuncMask=this.stencilFuncMask,n.stencilFail=this.stencilFail,n.stencilZFail=this.stencilZFail,n.stencilZPass=this.stencilZPass,this.rotation&&0!==this.rotation&&(n.rotation=this.rotation),!0===this.polygonOffset&&(n.polygonOffset=!0),0!==this.polygonOffsetFactor&&(n.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(n.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth&&1!==this.linewidth&&(n.linewidth=this.linewidth),void 0!==this.dashSize&&(n.dashSize=this.dashSize),void 0!==this.gapSize&&(n.gapSize=this.gapSize),void 0!==this.scale&&(n.scale=this.scale),!0===this.dithering&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),!0===this.alphaToCoverage&&(n.alphaToCoverage=this.alphaToCoverage),!0===this.premultipliedAlpha&&(n.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(n.wireframe=this.wireframe),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(n.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(n.wireframeLinejoin=this.wireframeLinejoin),!0===this.morphTargets&&(n.morphTargets=!0),!0===this.morphNormals&&(n.morphNormals=!0),!0===this.skinning&&(n.skinning=!0),!0===this.flatShading&&(n.flatShading=this.flatShading),!1===this.visible&&(n.visible=!1),!1===this.toneMapped&&(n.toneMapped=!1),"{}"!==JSON.stringify(this.userData)&&(n.userData=this.userData),t){const t=i(e.textures),r=i(e.images);t.length>0&&(n.textures=t),r.length>0&&(n.images=r)}return n},clone:function(){return(new this.constructor).copy(this)},copy:function(e){this.name=e.name,this.fog=e.fog,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let n=null;if(null!==t){const e=t.length;n=new Array(e);for(let i=0;i!==e;++i)n[i]=t[i].clone()}return this.clippingPlanes=n,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Object.defineProperty(GM.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}});const UM={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},jM={h:0,s:0,l:0},WM={h:0,s:0,l:0};function qM(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+6*(t-e)*(2/3-n):e}function JM(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}function $M(e){return e<.0031308?12.92*e:1.055*Math.pow(e,.41666)-.055}class XM{constructor(e,t,n){return void 0===t&&void 0===n?this.set(e):this.setRGB(e,t,n)}set(e){return e&&e.isColor?this.copy(e):"number"==typeof e?this.setHex(e):"string"==typeof e&&this.setStyle(e),this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,this}setRGB(e,t,n){return this.r=e,this.g=t,this.b=n,this}setHSL(e,t,n){if(e=(e%1+1)%1,t=uE(t,0,1),n=uE(n,0,1),0===t)this.r=this.g=this.b=n;else{const i=n<=.5?n*(1+t):n+t-n*t,r=2*n-i;this.r=qM(r,i,e+1/3),this.g=qM(r,i,e),this.b=qM(r,i,e-1/3)}return this}setStyle(e){function t(t){void 0!==t&&parseFloat(t)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let n;if(n=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(e)){let e;const i=n[1],r=n[2];switch(i){case"rgb":case"rgba":if(e=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(r))return this.r=Math.min(255,parseInt(e[1],10))/255,this.g=Math.min(255,parseInt(e[2],10))/255,this.b=Math.min(255,parseInt(e[3],10))/255,t(e[4]),this;if(e=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(r))return this.r=Math.min(100,parseInt(e[1],10))/100,this.g=Math.min(100,parseInt(e[2],10))/100,this.b=Math.min(100,parseInt(e[3],10))/100,t(e[4]),this;break;case"hsl":case"hsla":if(e=/^\s*(\d*\.?\d+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(r)){const n=parseFloat(e[1])/360,i=parseInt(e[2],10)/100,r=parseInt(e[3],10)/100;return t(e[4]),this.setHSL(n,i,r)}}}else if(n=/^\#([A-Fa-f\d]+)$/.exec(e)){const e=n[1],t=e.length;if(3===t)return this.r=parseInt(e.charAt(0)+e.charAt(0),16)/255,this.g=parseInt(e.charAt(1)+e.charAt(1),16)/255,this.b=parseInt(e.charAt(2)+e.charAt(2),16)/255,this;if(6===t)return this.r=parseInt(e.charAt(0)+e.charAt(1),16)/255,this.g=parseInt(e.charAt(2)+e.charAt(3),16)/255,this.b=parseInt(e.charAt(4)+e.charAt(5),16)/255,this}return e&&e.length>0?this.setColorName(e):this}setColorName(e){const t=UM[e.toLowerCase()];return void 0!==t?this.setHex(t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copyGammaToLinear(e,t=2){return this.r=Math.pow(e.r,t),this.g=Math.pow(e.g,t),this.b=Math.pow(e.b,t),this}copyLinearToGamma(e,t=2){const n=t>0?1/t:1;return this.r=Math.pow(e.r,n),this.g=Math.pow(e.g,n),this.b=Math.pow(e.b,n),this}convertGammaToLinear(e){return this.copyGammaToLinear(this,e),this}convertLinearToGamma(e){return this.copyLinearToGamma(this,e),this}copySRGBToLinear(e){return this.r=JM(e.r),this.g=JM(e.g),this.b=JM(e.b),this}copyLinearToSRGB(e){return this.r=$M(e.r),this.g=$M(e.g),this.b=$M(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0}getHexString(){return("000000"+this.getHex().toString(16)).slice(-6)}getHSL(e){void 0===e&&(console.warn("THREE.Color: .getHSL() target is now required"),e={h:0,s:0,l:0});const t=this.r,n=this.g,i=this.b,r=Math.max(t,n,i),o=Math.min(t,n,i);let a,s;const l=(o+r)/2;if(o===r)a=0,s=0;else{const e=r-o;switch(s=l<=.5?e/(r+o):e/(2-r-o),r){case t:a=(n-i)/e+(n<i?6:0);break;case n:a=(i-t)/e+2;break;case i:a=(t-n)/e+4}a/=6}return e.h=a,e.s=s,e.l=l,e}getStyle(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"}offsetHSL(e,t,n){return this.getHSL(jM),jM.h+=e,jM.s+=t,jM.l+=n,this.setHSL(jM.h,jM.s,jM.l),this}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,n){return this.r=e.r+(t.r-e.r)*n,this.g=e.g+(t.g-e.g)*n,this.b=e.b+(t.b-e.b)*n,this}lerpHSL(e,t){this.getHSL(jM),e.getHSL(WM);const n=hE(jM.h,WM.h,t),i=hE(jM.s,WM.s,t),r=hE(jM.l,WM.l,t);return this.setHSL(n,i,r),this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),!0===e.normalized&&(this.r/=255,this.g/=255,this.b/=255),this}toJSON(){return this.getHex()}}XM.NAMES=UM,XM.prototype.isColor=!0,XM.prototype.r=1,XM.prototype.g=1,XM.prototype.b=1;class YM extends GM{constructor(e){super(),this.type="MeshBasicMaterial",this.color=new XM(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this}}YM.prototype.isMeshBasicMaterial=!0;const KM=new wE,QM=new dE;class eS{constructor(e,t,n){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=e,this.itemSize=t,this.count=void 0!==e?e.length/t:0,this.normalized=!0===n,this.usage=nE,this.updateRange={offset:0,count:-1},this.version=0,this.onUploadCallback=function(){}}set needsUpdate(e){!0===e&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this}copyAt(e,t,n){e*=this.itemSize,n*=t.itemSize;for(let i=0,r=this.itemSize;i<r;i++)this.array[e+i]=t.array[n+i];return this}copyArray(e){return this.array.set(e),this}copyColorsArray(e){const t=this.array;let n=0;for(let i=0,r=e.length;i<r;i++){let r=e[i];void 0===r&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",i),r=new XM),t[n++]=r.r,t[n++]=r.g,t[n++]=r.b}return this}copyVector2sArray(e){const t=this.array;let n=0;for(let i=0,r=e.length;i<r;i++){let r=e[i];void 0===r&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",i),r=new dE),t[n++]=r.x,t[n++]=r.y}return this}copyVector3sArray(e){const t=this.array;let n=0;for(let i=0,r=e.length;i<r;i++){let r=e[i];void 0===r&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",i),r=new wE),t[n++]=r.x,t[n++]=r.y,t[n++]=r.z}return this}copyVector4sArray(e){const t=this.array;let n=0;for(let i=0,r=e.length;i<r;i++){let r=e[i];void 0===r&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",i),r=new gE),t[n++]=r.x,t[n++]=r.y,t[n++]=r.z,t[n++]=r.w}return this}applyMatrix3(e){if(2===this.itemSize)for(let t=0,n=this.count;t<n;t++)QM.fromBufferAttribute(this,t),QM.applyMatrix3(e),this.setXY(t,QM.x,QM.y);else if(3===this.itemSize)for(let t=0,n=this.count;t<n;t++)KM.fromBufferAttribute(this,t),KM.applyMatrix3(e),this.setXYZ(t,KM.x,KM.y,KM.z);return this}applyMatrix4(e){for(let t=0,n=this.count;t<n;t++)KM.x=this.getX(t),KM.y=this.getY(t),KM.z=this.getZ(t),KM.applyMatrix4(e),this.setXYZ(t,KM.x,KM.y,KM.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)KM.x=this.getX(t),KM.y=this.getY(t),KM.z=this.getZ(t),KM.applyNormalMatrix(e),this.setXYZ(t,KM.x,KM.y,KM.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)KM.x=this.getX(t),KM.y=this.getY(t),KM.z=this.getZ(t),KM.transformDirection(e),this.setXYZ(t,KM.x,KM.y,KM.z);return this}set(e,t=0){return this.array.set(e,t),this}getX(e){return this.array[e*this.itemSize]}setX(e,t){return this.array[e*this.itemSize]=t,this}getY(e){return this.array[e*this.itemSize+1]}setY(e,t){return this.array[e*this.itemSize+1]=t,this}getZ(e){return this.array[e*this.itemSize+2]}setZ(e,t){return this.array[e*this.itemSize+2]=t,this}getW(e){return this.array[e*this.itemSize+3]}setW(e,t){return this.array[e*this.itemSize+3]=t,this}setXY(e,t,n){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=n,this}setXYZ(e,t,n,i){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=i,this}setXYZW(e,t,n,i,r){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=i,this.array[e+3]=r,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized};return""!==this.name&&(e.name=this.name),this.usage!==nE&&(e.usage=this.usage),0===this.updateRange.offset&&-1===this.updateRange.count||(e.updateRange=this.updateRange),e}}eS.prototype.isBufferAttribute=!0;class tS extends eS{constructor(e,t,n){super(new Uint16Array(e),t,n)}}class nS extends eS{constructor(e,t,n){super(new Uint32Array(e),t,n)}}(class extends eS{constructor(e,t,n){super(new Uint16Array(e),t,n)}}).prototype.isFloat16BufferAttribute=!0;class iS extends eS{constructor(e,t,n){super(new Float32Array(e),t,n)}}function rS(e){if(0===e.length)return-1/0;let t=e[0];for(let n=1,i=e.length;n<i;++n)e[n]>t&&(t=e[n]);return t}let oS=0;const aS=new tM,sS=new EM,lS=new wE,pS=new ME,uS=new ME,hS=new wE;class cS extends oE{constructor(){super(),Object.defineProperty(this,"id",{value:oS++}),this.uuid=pE(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(rS(e)>65535?nS:tS)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return void 0!==this.attributes[e]}addGroup(e,t,n=0){this.groups.push({start:e,count:t,materialIndex:n})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;void 0!==t&&(t.applyMatrix4(e),t.needsUpdate=!0);const n=this.attributes.normal;if(void 0!==n){const t=(new mE).getNormalMatrix(e);n.applyNormalMatrix(t),n.needsUpdate=!0}const i=this.attributes.tangent;return void 0!==i&&(i.transformDirection(e),i.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}rotateX(e){return aS.makeRotationX(e),this.applyMatrix4(aS),this}rotateY(e){return aS.makeRotationY(e),this.applyMatrix4(aS),this}rotateZ(e){return aS.makeRotationZ(e),this.applyMatrix4(aS),this}translate(e,t,n){return aS.makeTranslation(e,t,n),this.applyMatrix4(aS),this}scale(e,t,n){return aS.makeScale(e,t,n),this.applyMatrix4(aS),this}lookAt(e){return sS.lookAt(e),sS.updateMatrix(),this.applyMatrix4(sS.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(lS).negate(),this.translate(lS.x,lS.y,lS.z),this}setFromPoints(e){const t=[];for(let n=0,i=e.length;n<i;n++){const i=e[n];t.push(i.x,i.y,i.z||0)}return this.setAttribute("position",new iS(t,3)),this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new ME);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingBox.set(new wE(-1/0,-1/0,-1/0),new wE(1/0,1/0,1/0));if(void 0!==e){if(this.boundingBox.setFromBufferAttribute(e),t)for(let e=0,n=t.length;e<n;e++){const n=t[e];pS.setFromBufferAttribute(n),this.morphTargetsRelative?(hS.addVectors(this.boundingBox.min,pS.min),this.boundingBox.expandByPoint(hS),hS.addVectors(this.boundingBox.max,pS.max),this.boundingBox.expandByPoint(hS)):(this.boundingBox.expandByPoint(pS.min),this.boundingBox.expandByPoint(pS.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new WE);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingSphere.set(new wE,1/0);if(e){const n=this.boundingSphere.center;if(pS.setFromBufferAttribute(e),t)for(let e=0,n=t.length;e<n;e++){const n=t[e];uS.setFromBufferAttribute(n),this.morphTargetsRelative?(hS.addVectors(pS.min,uS.min),pS.expandByPoint(hS),hS.addVectors(pS.max,uS.max),pS.expandByPoint(hS)):(pS.expandByPoint(uS.min),pS.expandByPoint(uS.max))}pS.getCenter(n);let i=0;for(let t=0,r=e.count;t<r;t++)hS.fromBufferAttribute(e,t),i=Math.max(i,n.distanceToSquared(hS));if(t)for(let r=0,o=t.length;r<o;r++){const o=t[r],a=this.morphTargetsRelative;for(let t=0,r=o.count;t<r;t++)hS.fromBufferAttribute(o,t),a&&(lS.fromBufferAttribute(e,t),hS.add(lS)),i=Math.max(i,n.distanceToSquared(hS))}this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeFaceNormals(){}computeTangents(){const e=this.index,t=this.attributes;if(null===e||void 0===t.position||void 0===t.normal||void 0===t.uv)return void console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");const n=e.array,i=t.position.array,r=t.normal.array,o=t.uv.array,a=i.length/3;void 0===t.tangent&&this.setAttribute("tangent",new eS(new Float32Array(4*a),4));const s=t.tangent.array,l=[],p=[];for(let e=0;e<a;e++)l[e]=new wE,p[e]=new wE;const u=new wE,h=new wE,c=new wE,_=new dE,d=new dE,m=new dE,P=new wE,f=new wE;function x(e,t,n){u.fromArray(i,3*e),h.fromArray(i,3*t),c.fromArray(i,3*n),_.fromArray(o,2*e),d.fromArray(o,2*t),m.fromArray(o,2*n),h.sub(u),c.sub(u),d.sub(_),m.sub(_);const r=1/(d.x*m.y-m.x*d.y);isFinite(r)&&(P.copy(h).multiplyScalar(m.y).addScaledVector(c,-d.y).multiplyScalar(r),f.copy(c).multiplyScalar(d.x).addScaledVector(h,-m.x).multiplyScalar(r),l[e].add(P),l[t].add(P),l[n].add(P),p[e].add(f),p[t].add(f),p[n].add(f))}let y=this.groups;0===y.length&&(y=[{start:0,count:n.length}]);for(let e=0,t=y.length;e<t;++e){const t=y[e],i=t.start;for(let e=i,r=i+t.count;e<r;e+=3)x(n[e+0],n[e+1],n[e+2])}const v=new wE,g=new wE,b=new wE,z=new wE;function w(e){b.fromArray(r,3*e),z.copy(b);const t=l[e];v.copy(t),v.sub(b.multiplyScalar(b.dot(t))).normalize(),g.crossVectors(z,t);const n=g.dot(p[e])<0?-1:1;s[4*e]=v.x,s[4*e+1]=v.y,s[4*e+2]=v.z,s[4*e+3]=n}for(let e=0,t=y.length;e<t;++e){const t=y[e],i=t.start;for(let e=i,r=i+t.count;e<r;e+=3)w(n[e+0]),w(n[e+1]),w(n[e+2])}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(void 0!==t){let n=this.getAttribute("normal");if(void 0===n)n=new eS(new Float32Array(3*t.count),3),this.setAttribute("normal",n);else for(let e=0,t=n.count;e<t;e++)n.setXYZ(e,0,0,0);const i=new wE,r=new wE,o=new wE,a=new wE,s=new wE,l=new wE,p=new wE,u=new wE;if(e)for(let h=0,c=e.count;h<c;h+=3){const c=e.getX(h+0),_=e.getX(h+1),d=e.getX(h+2);i.fromBufferAttribute(t,c),r.fromBufferAttribute(t,_),o.fromBufferAttribute(t,d),p.subVectors(o,r),u.subVectors(i,r),p.cross(u),a.fromBufferAttribute(n,c),s.fromBufferAttribute(n,_),l.fromBufferAttribute(n,d),a.add(p),s.add(p),l.add(p),n.setXYZ(c,a.x,a.y,a.z),n.setXYZ(_,s.x,s.y,s.z),n.setXYZ(d,l.x,l.y,l.z)}else for(let e=0,a=t.count;e<a;e+=3)i.fromBufferAttribute(t,e+0),r.fromBufferAttribute(t,e+1),o.fromBufferAttribute(t,e+2),p.subVectors(o,r),u.subVectors(i,r),p.cross(u),n.setXYZ(e+0,p.x,p.y,p.z),n.setXYZ(e+1,p.x,p.y,p.z),n.setXYZ(e+2,p.x,p.y,p.z);this.normalizeNormals(),n.needsUpdate=!0}}merge(e,t){if(!e||!e.isBufferGeometry)return void console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",e);void 0===t&&(t=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));const n=this.attributes;for(const i in n){if(void 0===e.attributes[i])continue;const r=n[i].array,o=e.attributes[i],a=o.array,s=o.itemSize*t,l=Math.min(a.length,r.length-s);for(let e=0,t=s;e<l;e++,t++)r[t]=a[e]}return this}normalizeNormals(){const e=this.attributes.normal;for(let t=0,n=e.count;t<n;t++)hS.fromBufferAttribute(e,t),hS.normalize(),e.setXYZ(t,hS.x,hS.y,hS.z)}toNonIndexed(){function e(e,t){const n=e.array,i=e.itemSize,r=e.normalized,o=new n.constructor(t.length*i);let a=0,s=0;for(let e=0,r=t.length;e<r;e++){a=t[e]*i;for(let e=0;e<i;e++)o[s++]=n[a++]}return new eS(o,i,r)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new cS,n=this.index.array,i=this.attributes;for(const r in i){const o=e(i[r],n);t.setAttribute(r,o)}const r=this.morphAttributes;for(const i in r){const o=[],a=r[i];for(let t=0,i=a.length;t<i;t++){const i=e(a[t],n);o.push(i)}t.morphAttributes[i]=o}t.morphTargetsRelative=this.morphTargetsRelative;const o=this.groups;for(let e=0,n=o.length;e<n;e++){const n=o[e];t.addGroup(n.start,n.count,n.materialIndex)}return t}toJSON(){const e={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),void 0!==this.parameters){const t=this.parameters;for(const n in t)void 0!==t[n]&&(e[n]=t[n]);return e}e.data={attributes:{}};const t=this.index;null!==t&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const n=this.attributes;for(const t in n){const i=n[t];e.data.attributes[t]=i.toJSON(e.data)}const i={};let r=!1;for(const t in this.morphAttributes){const n=this.morphAttributes[t],o=[];for(let t=0,i=n.length;t<i;t++){const i=n[t];o.push(i.toJSON(e.data))}o.length>0&&(i[t]=o,r=!0)}r&&(e.data.morphAttributes=i,e.data.morphTargetsRelative=this.morphTargetsRelative);const o=this.groups;o.length>0&&(e.data.groups=JSON.parse(JSON.stringify(o)));const a=this.boundingSphere;return null!==a&&(e.data.boundingSphere={center:a.center.toArray(),radius:a.radius}),e}clone(){return(new cS).copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const n=e.index;null!==n&&this.setIndex(n.clone(t));const i=e.attributes;for(const e in i){const n=i[e];this.setAttribute(e,n.clone(t))}const r=e.morphAttributes;for(const e in r){const n=[],i=r[e];for(let e=0,r=i.length;e<r;e++)n.push(i[e].clone(t));this.morphAttributes[e]=n}this.morphTargetsRelative=e.morphTargetsRelative;const o=e.groups;for(let e=0,t=o.length;e<t;e++){const t=o[e];this.addGroup(t.start,t.count,t.materialIndex)}const a=e.boundingBox;null!==a&&(this.boundingBox=a.clone());const s=e.boundingSphere;return null!==s&&(this.boundingSphere=s.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}cS.prototype.isBufferGeometry=!0;const _S=new tM,dS=new eM,mS=new WE,PS=new wE,fS=new wE,xS=new wE,yS=new wE,vS=new wE,gS=new wE,bS=new wE,zS=new wE,wS=new wE,ZS=new dE,ES=new dE,MS=new dE,SS=new wE,CS=new wE;class NS extends EM{constructor(e=new cS,t=new YM){super(),this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e){return super.copy(e),void 0!==e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),void 0!==e.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=e.material,this.geometry=e.geometry,this}updateMorphTargets(){const e=this.geometry;if(e.isBufferGeometry){const t=e.morphAttributes,n=Object.keys(t);if(n.length>0){const e=t[n[0]];if(void 0!==e){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let t=0,n=e.length;t<n;t++){const n=e[t].name||String(t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=t}}}}else{const t=e.morphTargets;void 0!==t&&t.length>0&&console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}raycast(e,t){const n=this.geometry,i=this.material,r=this.matrixWorld;if(void 0===i)return;if(null===n.boundingSphere&&n.computeBoundingSphere(),mS.copy(n.boundingSphere),mS.applyMatrix4(r),!1===e.ray.intersectsSphere(mS))return;if(_S.copy(r).invert(),dS.copy(e.ray).applyMatrix4(_S),null!==n.boundingBox&&!1===dS.intersectsBox(n.boundingBox))return;let o;if(n.isBufferGeometry){const r=n.index,a=n.attributes.position,s=n.morphAttributes.position,l=n.morphTargetsRelative,p=n.attributes.uv,u=n.attributes.uv2,h=n.groups,c=n.drawRange;if(null!==r)if(Array.isArray(i))for(let n=0,_=h.length;n<_;n++){const _=h[n],d=i[_.materialIndex];for(let n=Math.max(_.start,c.start),i=Math.min(_.start+_.count,c.start+c.count);n<i;n+=3){const i=r.getX(n),h=r.getX(n+1),c=r.getX(n+2);o=AS(this,d,e,dS,a,s,l,p,u,i,h,c),o&&(o.faceIndex=Math.floor(n/3),o.face.materialIndex=_.materialIndex,t.push(o))}}else for(let n=Math.max(0,c.start),h=Math.min(r.count,c.start+c.count);n<h;n+=3){const h=r.getX(n),c=r.getX(n+1),_=r.getX(n+2);o=AS(this,i,e,dS,a,s,l,p,u,h,c,_),o&&(o.faceIndex=Math.floor(n/3),t.push(o))}else if(void 0!==a)if(Array.isArray(i))for(let n=0,r=h.length;n<r;n++){const r=h[n],_=i[r.materialIndex];for(let n=Math.max(r.start,c.start),i=Math.min(r.start+r.count,c.start+c.count);n<i;n+=3)o=AS(this,_,e,dS,a,s,l,p,u,n,n+1,n+2),o&&(o.faceIndex=Math.floor(n/3),o.face.materialIndex=r.materialIndex,t.push(o))}else for(let n=Math.max(0,c.start),r=Math.min(a.count,c.start+c.count);n<r;n+=3)o=AS(this,i,e,dS,a,s,l,p,u,n,n+1,n+2),o&&(o.faceIndex=Math.floor(n/3),t.push(o))}else n.isGeometry&&console.error("THREE.Mesh.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}function AS(e,t,n,i,r,o,a,s,l,p,u,h){PS.fromBufferAttribute(r,p),fS.fromBufferAttribute(r,u),xS.fromBufferAttribute(r,h);const c=e.morphTargetInfluences;if(t.morphTargets&&o&&c){bS.set(0,0,0),zS.set(0,0,0),wS.set(0,0,0);for(let e=0,t=o.length;e<t;e++){const t=c[e],n=o[e];0!==t&&(yS.fromBufferAttribute(n,p),vS.fromBufferAttribute(n,u),gS.fromBufferAttribute(n,h),a?(bS.addScaledVector(yS,t),zS.addScaledVector(vS,t),wS.addScaledVector(gS,t)):(bS.addScaledVector(yS.sub(PS),t),zS.addScaledVector(vS.sub(fS),t),wS.addScaledVector(gS.sub(xS),t)))}PS.add(bS),fS.add(zS),xS.add(wS)}e.isSkinnedMesh&&t.skinning&&(e.boneTransform(p,PS),e.boneTransform(u,fS),e.boneTransform(h,xS));const _=function(e,t,n,i,r,o,a,s){let l;if(l=1===t.side?i.intersectTriangle(a,o,r,!0,s):i.intersectTriangle(r,o,a,2!==t.side,s),null===l)return null;CS.copy(s),CS.applyMatrix4(e.matrixWorld);const p=n.ray.origin.distanceTo(CS);return p<n.near||p>n.far?null:{distance:p,point:CS.clone(),object:e}}(e,t,n,i,PS,fS,xS,SS);if(_){s&&(ZS.fromBufferAttribute(s,p),ES.fromBufferAttribute(s,u),MS.fromBufferAttribute(s,h),_.uv=FM.getUV(SS,PS,fS,xS,ZS,ES,MS,new dE)),l&&(ZS.fromBufferAttribute(l,p),ES.fromBufferAttribute(l,u),MS.fromBufferAttribute(l,h),_.uv2=FM.getUV(SS,PS,fS,xS,ZS,ES,MS,new dE));const e={a:p,b:u,c:h,normal:new wE,materialIndex:0};FM.getNormal(PS,fS,xS,e.normal),_.face=e}return _}NS.prototype.isMesh=!0;class LS extends cS{constructor(e=1,t=1,n=1,i=1,r=1,o=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:n,widthSegments:i,heightSegments:r,depthSegments:o};const a=this;i=Math.floor(i),r=Math.floor(r),o=Math.floor(o);const s=[],l=[],p=[],u=[];let h=0,c=0;function _(e,t,n,i,r,o,_,d,m,P,f){const x=o/m,y=_/P,v=o/2,g=_/2,b=d/2,z=m+1,w=P+1;let Z=0,E=0;const M=new wE;for(let o=0;o<w;o++){const a=o*y-g;for(let s=0;s<z;s++){const h=s*x-v;M[e]=h*i,M[t]=a*r,M[n]=b,l.push(M.x,M.y,M.z),M[e]=0,M[t]=0,M[n]=d>0?1:-1,p.push(M.x,M.y,M.z),u.push(s/m),u.push(1-o/P),Z+=1}}for(let e=0;e<P;e++)for(let t=0;t<m;t++){const n=h+t+z*e,i=h+t+z*(e+1),r=h+(t+1)+z*(e+1),o=h+(t+1)+z*e;s.push(n,i,o),s.push(i,r,o),E+=6}a.addGroup(c,E,f),c+=E,h+=Z}_("z","y","x",-1,-1,n,t,e,o,r,0),_("z","y","x",1,-1,n,t,-e,o,r,1),_("x","z","y",1,1,e,n,t,i,o,2),_("x","z","y",1,-1,e,n,-t,i,o,3),_("x","y","z",1,-1,e,t,n,i,r,4),_("x","y","z",-1,-1,e,t,-n,i,r,5),this.setIndex(s),this.setAttribute("position",new iS(l,3)),this.setAttribute("normal",new iS(p,3)),this.setAttribute("uv",new iS(u,2))}}function BS(e){const t={};for(const n in e){t[n]={};for(const i in e[n]){const r=e[n][i];r&&(r.isColor||r.isMatrix3||r.isMatrix4||r.isVector2||r.isVector3||r.isVector4||r.isTexture||r.isQuaternion)?t[n][i]=r.clone():Array.isArray(r)?t[n][i]=r.slice():t[n][i]=r}}return t}function TS(e){const t={};for(let n=0;n<e.length;n++){const i=BS(e[n]);for(const e in i)t[e]=i[e]}return t}const VS={clone:BS,merge:TS};class kS extends GM{constructor(e){super(),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==e&&(void 0!==e.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(e))}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=BS(e.uniforms),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.lights=e.lights,this.clipping=e.clipping,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const n in this.uniforms){const i=this.uniforms[n].value;i&&i.isTexture?t.uniforms[n]={type:"t",value:i.toJSON(e).uuid}:i&&i.isColor?t.uniforms[n]={type:"c",value:i.getHex()}:i&&i.isVector2?t.uniforms[n]={type:"v2",value:i.toArray()}:i&&i.isVector3?t.uniforms[n]={type:"v3",value:i.toArray()}:i&&i.isVector4?t.uniforms[n]={type:"v4",value:i.toArray()}:i&&i.isMatrix3?t.uniforms[n]={type:"m3",value:i.toArray()}:i&&i.isMatrix4?t.uniforms[n]={type:"m4",value:i.toArray()}:t.uniforms[n]={value:i}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader;const n={};for(const e in this.extensions)!0===this.extensions[e]&&(n[e]=!0);return Object.keys(n).length>0&&(t.extensions=n),t}}kS.prototype.isShaderMaterial=!0;class IS extends EM{constructor(){super(),this.type="Camera",this.matrixWorldInverse=new tM,this.projectionMatrix=new tM,this.projectionMatrixInverse=new tM}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this}getWorldDirection(e){void 0===e&&(console.warn("THREE.Camera: .getWorldDirection() target is now required"),e=new wE),this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return(new this.constructor).copy(this)}}IS.prototype.isCamera=!0;class OS extends IS{constructor(e=50,t=1,n=.1,i=2e3){super(),this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=n,this.far=i,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=2*lE*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(.5*sE*this.fov);return.5*this.getFilmHeight()/e}getEffectiveFOV(){return 2*lE*Math.atan(Math.tan(.5*sE*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(e,t,n,i,r,o){this.aspect=e/t,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=i,this.view.width=r,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(.5*sE*this.fov)/this.zoom,n=2*t,i=this.aspect*n,r=-.5*i;const o=this.view;if(null!==this.view&&this.view.enabled){const e=o.fullWidth,a=o.fullHeight;r+=o.offsetX*i/e,t-=o.offsetY*n/a,i*=o.width/e,n*=o.height/a}const a=this.filmOffset;0!==a&&(r+=e*a/this.getFilmWidth()),this.projectionMatrix.makePerspective(r,r+i,t,t-n,e,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,null!==this.view&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}OS.prototype.isPerspectiveCamera=!0;const RS=90;class HS extends EM{constructor(e,t,n){if(super(),this.type="CubeCamera",!0!==n.isWebGLCubeRenderTarget)return void console.error("THREE.CubeCamera: The constructor now expects an instance of WebGLCubeRenderTarget as third parameter.");this.renderTarget=n;const i=new OS(RS,1,e,t);i.layers=this.layers,i.up.set(0,-1,0),i.lookAt(new wE(1,0,0)),this.add(i);const r=new OS(RS,1,e,t);r.layers=this.layers,r.up.set(0,-1,0),r.lookAt(new wE(-1,0,0)),this.add(r);const o=new OS(RS,1,e,t);o.layers=this.layers,o.up.set(0,0,1),o.lookAt(new wE(0,1,0)),this.add(o);const a=new OS(RS,1,e,t);a.layers=this.layers,a.up.set(0,0,-1),a.lookAt(new wE(0,-1,0)),this.add(a);const s=new OS(RS,1,e,t);s.layers=this.layers,s.up.set(0,-1,0),s.lookAt(new wE(0,0,1)),this.add(s);const l=new OS(RS,1,e,t);l.layers=this.layers,l.up.set(0,-1,0),l.lookAt(new wE(0,0,-1)),this.add(l)}update(e,t){null===this.parent&&this.updateMatrixWorld();const n=this.renderTarget,[i,r,o,a,s,l]=this.children,p=e.xr.enabled,u=e.getRenderTarget();e.xr.enabled=!1;const h=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,e.setRenderTarget(n,0),e.render(t,i),e.setRenderTarget(n,1),e.render(t,r),e.setRenderTarget(n,2),e.render(t,o),e.setRenderTarget(n,3),e.render(t,a),e.setRenderTarget(n,4),e.render(t,s),n.texture.generateMipmaps=h,e.setRenderTarget(n,5),e.render(t,l),e.setRenderTarget(u),e.xr.enabled=p}}class FS extends yE{constructor(e,t,n,i,r,o,a,s,l,p){super(e=void 0!==e?e:[],t=void 0!==t?t:301,n,i,r,o,a=void 0!==a?a:UZ,s,l,p),this._needsFlipEnvMap=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}FS.prototype.isCubeTexture=!0;class DS extends bE{constructor(e,t,n){Number.isInteger(t)&&(console.warn("THREE.WebGLCubeRenderTarget: constructor signature is now WebGLCubeRenderTarget( size, options )"),t=n),super(e,e,t),t=t||{},this.texture=new FS(void 0,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.encoding),this.texture.generateMipmaps=void 0!==t.generateMipmaps&&t.generateMipmaps,this.texture.minFilter=void 0!==t.minFilter?t.minFilter:OZ,this.texture._needsFlipEnvMap=!1}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.format=jZ,this.texture.encoding=t.encoding,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const n={tEquirect:{value:null}},i="\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t\t#include <project_vertex>\n\n\t\t\t\t}\n\t\t\t",r="\n\n\t\t\t\tuniform sampler2D tEquirect;\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\t#include <common>\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t\t}\n\t\t\t",o=new LS(5,5,5),a=new kS({name:"CubemapFromEquirect",uniforms:BS(n),vertexShader:i,fragmentShader:r,side:1,blending:0});a.uniforms.tEquirect.value=t;const s=new NS(o,a),l=t.minFilter;return 1008===t.minFilter&&(t.minFilter=OZ),new HS(1,10,this).update(e,s),t.minFilter=l,s.geometry.dispose(),s.material.dispose(),this}clear(e,t,n,i){const r=e.getRenderTarget();for(let r=0;r<6;r++)e.setRenderTarget(this,r),e.clear(t,n,i);e.setRenderTarget(r)}}DS.prototype.isWebGLCubeRenderTarget=!0;class GS extends yE{constructor(e,t,n,i,r,o,a,s,l,p,u,h){super(null,o,a,s,l,p,i,r,u,h),this.image={data:e||null,width:t||1,height:n||1},this.magFilter=void 0!==l?l:IZ,this.minFilter=void 0!==p?p:IZ,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}}GS.prototype.isDataTexture=!0;const US=new WE,jS=new wE;class WS{constructor(e=new NM,t=new NM,n=new NM,i=new NM,r=new NM,o=new NM){this.planes=[e,t,n,i,r,o]}set(e,t,n,i,r,o){const a=this.planes;return a[0].copy(e),a[1].copy(t),a[2].copy(n),a[3].copy(i),a[4].copy(r),a[5].copy(o),this}copy(e){const t=this.planes;for(let n=0;n<6;n++)t[n].copy(e.planes[n]);return this}setFromProjectionMatrix(e){const t=this.planes,n=e.elements,i=n[0],r=n[1],o=n[2],a=n[3],s=n[4],l=n[5],p=n[6],u=n[7],h=n[8],c=n[9],_=n[10],d=n[11],m=n[12],P=n[13],f=n[14],x=n[15];return t[0].setComponents(a-i,u-s,d-h,x-m).normalize(),t[1].setComponents(a+i,u+s,d+h,x+m).normalize(),t[2].setComponents(a+r,u+l,d+c,x+P).normalize(),t[3].setComponents(a-r,u-l,d-c,x-P).normalize(),t[4].setComponents(a-o,u-p,d-_,x-f).normalize(),t[5].setComponents(a+o,u+p,d+_,x+f).normalize(),this}intersectsObject(e){const t=e.geometry;return null===t.boundingSphere&&t.computeBoundingSphere(),US.copy(t.boundingSphere).applyMatrix4(e.matrixWorld),this.intersectsSphere(US)}intersectsSprite(e){return US.center.set(0,0,0),US.radius=.7071067811865476,US.applyMatrix4(e.matrixWorld),this.intersectsSphere(US)}intersectsSphere(e){const t=this.planes,n=e.center,i=-e.radius;for(let e=0;e<6;e++)if(t[e].distanceToPoint(n)<i)return!1;return!0}intersectsBox(e){const t=this.planes;for(let n=0;n<6;n++){const i=t[n];if(jS.x=i.normal.x>0?e.max.x:e.min.x,jS.y=i.normal.y>0?e.max.y:e.min.y,jS.z=i.normal.z>0?e.max.z:e.min.z,i.distanceToPoint(jS)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let n=0;n<6;n++)if(t[n].distanceToPoint(e)<0)return!1;return!0}clone(){return(new this.constructor).copy(this)}}function qS(){let e=null,t=!1,n=null,i=null;function r(t,o){n(t,o),i=e.requestAnimationFrame(r)}return{start:function(){!0!==t&&null!==n&&(i=e.requestAnimationFrame(r),t=!0)},stop:function(){e.cancelAnimationFrame(i),t=!1},setAnimationLoop:function(e){n=e},setContext:function(t){e=t}}}function JS(e,t){const n=t.isWebGL2,i=new WeakMap;return{get:function(e){return e.isInterleavedBufferAttribute&&(e=e.data),i.get(e)},remove:function(t){t.isInterleavedBufferAttribute&&(t=t.data);const n=i.get(t);n&&(e.deleteBuffer(n.buffer),i.delete(t))},update:function(t,r){if(t.isGLBufferAttribute){const e=i.get(t);return void((!e||e.version<t.version)&&i.set(t,{buffer:t.buffer,type:t.type,bytesPerElement:t.elementSize,version:t.version}))}t.isInterleavedBufferAttribute&&(t=t.data);const o=i.get(t);void 0===o?i.set(t,function(t,i){const r=t.array,o=t.usage,a=e.createBuffer();e.bindBuffer(i,a),e.bufferData(i,r,o),t.onUploadCallback();let s=5126;return r instanceof Float32Array?s=5126:r instanceof Float64Array?console.warn("THREE.WebGLAttributes: Unsupported data buffer format: Float64Array."):r instanceof Uint16Array?t.isFloat16BufferAttribute?n?s=5131:console.warn("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2."):s=5123:r instanceof Int16Array?s=5122:r instanceof Uint32Array?s=5125:r instanceof Int32Array?s=5124:r instanceof Int8Array?s=5120:r instanceof Uint8Array&&(s=5121),{buffer:a,type:s,bytesPerElement:r.BYTES_PER_ELEMENT,version:t.version}}(t,r)):o.version<t.version&&(function(t,i,r){const o=i.array,a=i.updateRange;e.bindBuffer(r,t),-1===a.count?e.bufferSubData(r,0,o):(n?e.bufferSubData(r,a.offset*o.BYTES_PER_ELEMENT,o,a.offset,a.count):e.bufferSubData(r,a.offset*o.BYTES_PER_ELEMENT,o.subarray(a.offset,a.offset+a.count)),a.count=-1)}(o.buffer,t,r),o.version=t.version)}}}class $S extends cS{constructor(e=1,t=1,n=1,i=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:n,heightSegments:i};const r=e/2,o=t/2,a=Math.floor(n),s=Math.floor(i),l=a+1,p=s+1,u=e/a,h=t/s,c=[],_=[],d=[],m=[];for(let e=0;e<p;e++){const t=e*h-o;for(let n=0;n<l;n++){const i=n*u-r;_.push(i,-t,0),d.push(0,0,1),m.push(n/a),m.push(1-e/s)}}for(let e=0;e<s;e++)for(let t=0;t<a;t++){const n=t+l*e,i=t+l*(e+1),r=t+1+l*(e+1),o=t+1+l*e;c.push(n,i,o),c.push(i,r,o)}this.setIndex(c),this.setAttribute("position",new iS(_,3)),this.setAttribute("normal",new iS(d,3)),this.setAttribute("uv",new iS(m,2))}}const XS={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef ALPHATEST\n\tif ( diffuseColor.a < ALPHATEST ) discard;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"vec3 transformed = vec3( position );",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"vec2 integrateSpecularBRDF( const in float dotNV, const in float roughness ) {\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\treturn vec2( -1.04, 1.04 ) * a004 + r.zw;\n}\nfloat punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\tif( cutoffDistance > 0.0 ) {\n\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t}\n\treturn distanceFalloff;\n#else\n\tif( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\treturn pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t}\n\treturn 1.0;\n#endif\n}\nvec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );\n\treturn ( 1.0 - specularColor ) * fresnel + specularColor;\n}\nvec3 F_Schlick_RoughnessDependent( const in vec3 F0, const in float dotNV, const in float roughness ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotNV - 6.98316 ) * dotNV );\n\tvec3 Fr = max( vec3( 1.0 - roughness ), F0 ) - F0;\n\treturn Fr * fresnel + F0;\n}\nfloat G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\tfloat gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\treturn 1.0 / ( gl * gv );\n}\nfloat G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( incidentLight.direction + viewDir );\n\tfloat dotNL = saturate( dot( normal, incidentLight.direction ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( G * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\nvec3 BRDF_Specular_GGX_Environment( const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\n\treturn specularColor * brdf.x + brdf.y;\n}\nvoid BRDF_Specular_Multiscattering_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tvec3 F = F_Schlick_RoughnessDependent( specularColor, dotNV, roughness );\n\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\n\tvec3 FssEss = F * brdf.x + brdf.y;\n\tfloat Ess = brdf.x + brdf.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\nfloat GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {\n\treturn ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );\n}\nfloat BlinnExponentToGGXRoughness( const in float blinnExponent ) {\n\treturn sqrt( 2.0 / ( blinnExponent + 2.0 ) );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie(float roughness, float NoH) {\n\tfloat invAlpha = 1.0 / roughness;\n\tfloat cos2h = NoH * NoH;\n\tfloat sin2h = max(1.0 - cos2h, 0.0078125);\treturn (2.0 + invAlpha) * pow(sin2h, invAlpha * 0.5) / (2.0 * PI);\n}\nfloat V_Neubelt(float NoV, float NoL) {\n\treturn saturate(1.0 / (4.0 * (NoL + NoV - NoL * NoV)));\n}\nvec3 BRDF_Specular_Sheen( const in float roughness, const in vec3 L, const in GeometricContext geometry, vec3 specularColor ) {\n\tvec3 N = geometry.normal;\n\tvec3 V = geometry.viewDir;\n\tvec3 H = normalize( V + L );\n\tfloat dotNH = saturate( dot( N, H ) );\n\treturn specularColor * D_Charlie( roughness, dotNH ) * V_Neubelt( dot(N, V), dot(N, L) );\n}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n\t\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n\t\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 ) * faceDirection;\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#pragma unroll_loop_end\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#if defined( USE_COLOR_ALPHA )\n\tdiffuseColor *= vColor;\n#elif defined( USE_COLOR )\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR )\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvarying vec3 vColor;\n#endif",color_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvColor = vec4( 1.0 );\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor *= color;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement(a) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract(sin(sn) * c);\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat max3( vec3 v ) { return max( max( v.x, v.y ), v.z ); }\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n#ifdef CLEARCOAT\n\tvec3 clearcoatNormal;\n#endif\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\tfloat distance = dot( planeNormal, point - pointOnPlane );\n\treturn - distance * planeNormal + point;\n}\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn sign( dot( point - pointOnPlane, planeNormal ) );\n}\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat linearToRelativeLuminance( const in vec3 color ) {\n\tvec3 weights = vec3( 0.2126, 0.7152, 0.0722 );\n\treturn dot( weights, color.rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_maxMipLevel 8.0\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_maxTileSize 256.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\tfloat texelSize = 1.0 / ( 3.0 * cubeUV_maxTileSize );\n\t\tvec2 uv = getUV( direction, face ) * ( faceSize - 1.0 );\n\t\tvec2 f = fract( uv );\n\t\tuv += 0.5 - f;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tif ( mipInt < cubeUV_maxMipLevel ) {\n\t\t\tuv.y += 2.0 * cubeUV_maxTileSize;\n\t\t}\n\t\tuv.y += filterInt * 2.0 * cubeUV_minTileSize;\n\t\tuv.x += 3.0 * max( 0.0, cubeUV_maxTileSize - 2.0 * faceSize );\n\t\tuv *= texelSize;\n\t\tvec3 tl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tuv.x += texelSize;\n\t\tvec3 tr = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tuv.y += texelSize;\n\t\tvec3 br = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tuv.x -= texelSize;\n\t\tvec3 bl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tvec3 tm = mix( tl, tr, f.x );\n\t\tvec3 bm = mix( bl, br, f.x );\n\t\treturn mix( tm, bm, f.y );\n\t}\n\t#define r0 1.0\n\t#define v0 0.339\n\t#define m0 - 2.0\n\t#define r1 0.8\n\t#define v1 0.276\n\t#define m1 - 1.0\n\t#define r4 0.4\n\t#define v4 0.046\n\t#define m4 2.0\n\t#define r5 0.305\n\t#define v5 0.016\n\t#define m5 3.0\n\t#define r6 0.21\n\t#define v6 0.0038\n\t#define m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= r1 ) {\n\t\t\tmip = ( r0 - roughness ) * ( m1 - m0 ) / ( r0 - r1 ) + m0;\n\t\t} else if ( roughness >= r4 ) {\n\t\t\tmip = ( r1 - roughness ) * ( m4 - m1 ) / ( r1 - r4 ) + m1;\n\t\t} else if ( roughness >= r5 ) {\n\t\t\tmip = ( r4 - roughness ) * ( m5 - m4 ) / ( r4 - r5 ) + m4;\n\t\t} else if ( roughness >= r6 ) {\n\t\t\tmip = ( r5 - roughness ) * ( m6 - m5 ) / ( r5 - r6 ) + m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), m0, cubeUV_maxMipLevel );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_INSTANCING\n\tmat3 m = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );\n\ttransformedNormal = m * transformedNormal;\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",encodings_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment:"\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( gammaFactor ) ), value.a );\n}\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( 1.0 / gammaFactor ) ), value.a );\n}\nvec4 sRGBToLinear( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}\nvec4 RGBEToLinear( in vec4 value ) {\n\treturn vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\n}\nvec4 LinearToRGBE( in vec4 value ) {\n\tfloat maxComponent = max( max( value.r, value.g ), value.b );\n\tfloat fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\n\treturn vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\n}\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * value.a * maxRange, 1.0 );\n}\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat M = clamp( maxRGB / maxRange, 0.0, 1.0 );\n\tM = ceil( M * 255.0 ) / 255.0;\n\treturn vec4( value.rgb / ( M * maxRange ), M );\n}\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\n}\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat D = max( maxRange / maxRGB, 1.0 );\n\tD = clamp( floor( D ) / 255.0, 0.0, 1.0 );\n\treturn vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\n}\nconst mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\nvec4 LinearToLogLuv( in vec4 value ) {\n\tvec3 Xp_Y_XYZp = cLogLuvM * value.rgb;\n\tXp_Y_XYZp = max( Xp_Y_XYZp, vec3( 1e-6, 1e-6, 1e-6 ) );\n\tvec4 vResult;\n\tvResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\n\tfloat Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\n\tvResult.w = fract( Le );\n\tvResult.z = ( Le - ( floor( vResult.w * 255.0 ) ) / 255.0 ) / 255.0;\n\treturn vResult;\n}\nconst mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\nvec4 LogLuvToLinear( in vec4 value ) {\n\tfloat Le = value.z * 255.0 + value.w;\n\tvec3 Xp_Y_XYZp;\n\tXp_Y_XYZp.y = exp2( ( Le - 127.0 ) / 2.0 );\n\tXp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\n\tXp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\n\tvec3 vRGB = cLogLuvInverseM * Xp_Y_XYZp.rgb;\n\treturn vec4( max( vRGB, 0.0 ), 1.0 );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifndef ENVMAP_TYPE_CUBE_UV\n\t\tenvColor = envMapTexelToLinear( envColor );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\tuniform int maxMipLevel;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#if defined( USE_ENVMAP )\n\t#ifdef ENVMAP_MODE_REFRACTION\n\t\tuniform float refractionRatio;\n\t#endif\n\tvec3 getLightProbeIndirectIrradiance( const in GeometricContext geometry, const in int maxMIPLevel ) {\n\t\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\n\t\t#else\n\t\t\tvec4 envMapColor = vec4( 0.0 );\n\t\t#endif\n\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t}\n\tfloat getSpecularMIPLevel( const in float roughness, const in int maxMIPLevel ) {\n\t\tfloat maxMIPLevelScalar = float( maxMIPLevel );\n\t\tfloat sigma = PI * roughness * roughness / ( 1.0 + roughness );\n\t\tfloat desiredMIPLevel = maxMIPLevelScalar + log2( sigma );\n\t\treturn clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );\n\t}\n\tvec3 getLightProbeIndirectRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in int maxMIPLevel ) {\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( -viewDir, normal );\n\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( -viewDir, normal, refractionRatio );\n\t\t#endif\n\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\tfloat specularMIPLevel = getSpecularMIPLevel( roughness, maxMIPLevel );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\n\t\t#endif\n\t\treturn envMapColor.rgb * envMapIntensity;\n\t}\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tfogDepth = - mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float fogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * fogDepth * fogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, fogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float fogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn texture2D( gradientMap, coord ).rgb;\n\t#else\n\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\t#endif\n}",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\treflectedLight.indirectDiffuse += PI * lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_vertex:"vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\nvIndirectFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n\tvIndirectBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\nvIndirectFront += getAmbientLightIrradiance( ambientLightColor );\nvIndirectFront += getLightProbeIrradiance( lightProbe, geometry );\n#ifdef DOUBLE_SIDED\n\tvIndirectBack += getAmbientLightIrradiance( ambientLightColor );\n\tvIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry );\n#endif\n#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in GeometricContext geometry ) {\n\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treturn irradiance;\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tdirectLight.color = directionalLight.color;\n\t\tdirectLight.direction = directionalLight.direction;\n\t\tdirectLight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tdirectLight.color = pointLight.color;\n\t\tdirectLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );\n\t\tdirectLight.visible = ( directLight.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tfloat angleCos = dot( directLight.direction, spotLight.direction );\n\t\tif ( angleCos > spotLight.coneCos ) {\n\t\t\tfloat spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\t\tdirectLight.color = spotLight.color;\n\t\t\tdirectLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tdirectLight.visible = true;\n\t\t} else {\n\t\t\tdirectLight.color = vec3( 0.0 );\n\t\t\tdirectLight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {\n\t\tfloat dotNL = dot( geometry.normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tirradiance *= PI;\n\t\t#endif\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon\n#define Material_LightProbeLOD( material )\t(0)",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.specularRoughness = max( roughnessFactor, 0.0525 );material.specularRoughness += geometryRoughness;\nmaterial.specularRoughness = min( material.specularRoughness, 1.0 );\n#ifdef REFLECTIVITY\n\tmaterial.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ), diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor.rgb, metalnessFactor );\n#endif\n#ifdef CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheen;\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat specularRoughness;\n\tvec3 specularColor;\n#ifdef CLEARCOAT\n\tfloat clearcoat;\n\tfloat clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tvec3 sheenColor;\n#endif\n};\n#define MAXIMUM_SPECULAR_COEFFICIENT 0.16\n#define DEFAULT_SPECULAR_COEFFICIENT 0.04\nfloat clearcoatDHRApprox( const in float roughness, const in float dotNL ) {\n\treturn DEFAULT_SPECULAR_COEFFICIENT + ( 1.0 - DEFAULT_SPECULAR_COEFFICIENT ) * ( pow( 1.0 - dotNL, 5.0 ) * pow( 1.0 - roughness, 2.0 ) );\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.specularRoughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\t#ifdef CLEARCOAT\n\t\tfloat ccDotNL = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = ccDotNL * directLight.color;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tccIrradiance *= PI;\n\t\t#endif\n\t\tfloat clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );\n\t\treflectedLight.directSpecular += ccIrradiance * material.clearcoat * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );\n\t#else\n\t\tfloat clearcoatDHR = 0.0;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\treflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_Sheen(\n\t\t\tmaterial.specularRoughness,\n\t\t\tdirectLight.direction,\n\t\t\tgeometry,\n\t\t\tmaterial.sheenColor\n\t\t);\n\t#else\n\t\treflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.normal, material.specularColor, material.specularRoughness);\n\t#endif\n\treflectedLight.directDiffuse += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef CLEARCOAT\n\t\tfloat ccDotNV = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular += clearcoatRadiance * material.clearcoat * BRDF_Specular_GGX_Environment( geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );\n\t\tfloat ccDotNL = ccDotNV;\n\t\tfloat clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );\n\t#else\n\t\tfloat clearcoatDHR = 0.0;\n\t#endif\n\tfloat clearcoatInv = 1.0 - clearcoatDHR;\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\tBRDF_Specular_Multiscattering_Environment( geometry, material.specularColor, material.specularRoughness, singleScattering, multiScattering );\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );\n\treflectedLight.indirectSpecular += clearcoatInv * radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n#ifdef CLEARCOAT\n\tgeometry.clearcoatNormal = clearcoatNormal;\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointDirectLightIrradiance( pointLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotDirectLightIrradiance( spotLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\t\tvec3 lightMapIrradiance = lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tlightMapIrradiance *= PI;\n\t\t#endif\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getLightProbeIndirectIrradiance( geometry, maxMipLevel );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tradiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.normal, material.specularRoughness, maxMipLevel );\n\t#ifdef CLEARCOAT\n\t\tclearcoatRadiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness, maxMipLevel );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\t#else\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\t\tgl_Position.z *= gl_Position.w;\n\t\t}\n\t#endif\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 texelColor = texture2D( map, vUv );\n\ttexelColor = mapTexelToLinear( texelColor );\n\tdiffuseColor *= texelColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n#endif\n#ifdef USE_MAP\n\tvec4 mapTexel = texture2D( map, uv );\n\tdiffuseColor *= mapTexelToLinear( mapTexel );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tuniform mat3 uvTransform;\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\tuniform float morphTargetBaseInfluence;\n\t#ifndef USE_MORPHNORMALS\n\t\tuniform float morphTargetInfluences[ 8 ];\n\t#else\n\t\tuniform float morphTargetInfluences[ 4 ];\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\t#ifndef USE_MORPHNORMALS\n\t\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\t\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\t\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\t\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\t#endif\n#endif",normal_fragment_begin:"float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\n#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\t#ifdef USE_TANGENT\n\t\tvec3 tangent = normalize( vTangent );\n\t\tvec3 bitangent = normalize( vBitangent );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\ttangent = tangent * faceDirection;\n\t\t\tbitangent = bitangent * faceDirection;\n\t\t#endif\n\t\t#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tmat3 vTBN = mat3( tangent, bitangent, normal );\n\t\t#endif\n\t#endif\n#endif\nvec3 geometryNormal = normal;",normal_fragment_maps:"#ifdef OBJECTSPACE_NORMALMAP\n\tnormal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( TANGENTSPACE_NORMALMAP )\n\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\t#ifdef USE_TANGENT\n\t\tnormal = normalize( vTBN * mapN );\n\t#else\n\t\tnormal = perturbNormal2Arb( -vViewPosition, normal, mapN, faceDirection );\n\t#endif\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd(), faceDirection );\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {\n\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tvec3 N = surf_norm;\n\t\tvec3 q1perp = cross( q1, N );\n\t\tvec3 q0perp = cross( N, q0 );\n\t\tvec3 T = q1perp * st0.x + q0perp * st1.x;\n\t\tvec3 B = q1perp * st0.y + q0perp * st1.y;\n\t\tfloat det = max( dot( T, T ), dot( B, B ) );\n\t\tfloat scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );\n\t\treturn normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef CLEARCOAT\n\tvec3 clearcoatNormal = geometryNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\t#ifdef USE_TANGENT\n\t\tclearcoatNormal = normalize( vTBN * clearcoatMapN );\n\t#else\n\t\tclearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );\n\t#endif\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ));\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w);\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn (( near + viewZ ) * far ) / (( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0\n\t\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\tvec4 shadowWorldPosition;\n\t#endif\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\t#ifdef BONE_TEXTURE\n\t\tuniform highp sampler2D boneTexture;\n\t\tuniform int boneTextureSize;\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\t\ty = dy * ( y + 0.5 );\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\t\treturn bone;\n\t\t}\n\t#else\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\t\t}\n\t#endif\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmissionmap_fragment:"#ifdef USE_TRANSMISSIONMAP\n\ttotalTransmission *= texture2D( transmissionMap, vUv ).r;\n#endif",transmissionmap_pars_fragment:"#ifdef USE_TRANSMISSIONMAP\n\tuniform sampler2D transmissionMap;\n#endif",uv_pars_fragment:"#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex:"#ifdef USE_UV\n\t#ifdef UVS_VERTEX_ONLY\n\t\tvec2 vUv;\n\t#else\n\t\tvarying vec2 vUv;\n\t#endif\n\tuniform mat3 uvTransform;\n#endif",uv_vertex:"#ifdef USE_UV\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n\tuniform mat3 uv2Transform;\n#endif",uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP )\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_frag:"uniform sampler2D t2D;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",cube_frag:"#include <envmap_common_pars_fragment>\nuniform float opacity;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\tvec3 vReflect = vWorldDirection;\n\t#include <envmap_fragment>\n\tgl_FragColor = envColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#endif\n}",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tvec4 texColor = texture2D( tEquirect, sampleUV );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\n\t\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\t\treflectedLight.indirectDiffuse += lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_ENVMAP\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;\n\t#else\n\t\treflectedLight.indirectDiffuse += vIndirectFront;\n\t#endif\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t\tmatcapColor = matcapTexelToLinear( matcapColor );\n\t#else\n\t\tvec4 matcapColor = vec4( 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#ifndef FLAT_SHADED\n\t\tvNormal = normalize( transformedNormal );\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define REFLECTIVITY\n\t#define CLEARCOAT\n\t#define TRANSMISSION\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef TRANSMISSION\n\tuniform float transmission;\n#endif\n#ifdef REFLECTIVITY\n\tuniform float reflectivity;\n#endif\n#ifdef CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheen;\n#endif\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <transmissionmap_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <lights_physical_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#ifdef TRANSMISSION\n\t\tfloat totalTransmission = transmission;\n\t#endif\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <transmissionmap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#ifdef TRANSMISSION\n\t\tdiffuseColor.a *= mix( saturate( 1. - totalTransmission + linearToRelativeLuminance( reflectedLight.directSpecular + reflectedLight.indirectSpecular ) ), 1.0, metalness );\n\t#endif\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",normal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n}",normal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",shadow_vert:"#include <common>\n#include <fog_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}"},YS={common:{diffuse:{value:new XM(15658734)},opacity:{value:1},map:{value:null},uvTransform:{value:new mE},uv2Transform:{value:new mE},alphaMap:{value:null}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},refractionRatio:{value:.98},maxMipLevel:{value:0}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new dE(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new XM(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new XM(15658734)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},uvTransform:{value:new mE}},sprite:{diffuse:{value:new XM(15658734)},opacity:{value:1},center:{value:new dE(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},uvTransform:{value:new mE}}},KS={basic:{uniforms:TS([YS.common,YS.specularmap,YS.envmap,YS.aomap,YS.lightmap,YS.fog]),vertexShader:XS.meshbasic_vert,fragmentShader:XS.meshbasic_frag},lambert:{uniforms:TS([YS.common,YS.specularmap,YS.envmap,YS.aomap,YS.lightmap,YS.emissivemap,YS.fog,YS.lights,{emissive:{value:new XM(0)}}]),vertexShader:XS.meshlambert_vert,fragmentShader:XS.meshlambert_frag},phong:{uniforms:TS([YS.common,YS.specularmap,YS.envmap,YS.aomap,YS.lightmap,YS.emissivemap,YS.bumpmap,YS.normalmap,YS.displacementmap,YS.fog,YS.lights,{emissive:{value:new XM(0)},specular:{value:new XM(1118481)},shininess:{value:30}}]),vertexShader:XS.meshphong_vert,fragmentShader:XS.meshphong_frag},standard:{uniforms:TS([YS.common,YS.envmap,YS.aomap,YS.lightmap,YS.emissivemap,YS.bumpmap,YS.normalmap,YS.displacementmap,YS.roughnessmap,YS.metalnessmap,YS.fog,YS.lights,{emissive:{value:new XM(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:XS.meshphysical_vert,fragmentShader:XS.meshphysical_frag},toon:{uniforms:TS([YS.common,YS.aomap,YS.lightmap,YS.emissivemap,YS.bumpmap,YS.normalmap,YS.displacementmap,YS.gradientmap,YS.fog,YS.lights,{emissive:{value:new XM(0)}}]),vertexShader:XS.meshtoon_vert,fragmentShader:XS.meshtoon_frag},matcap:{uniforms:TS([YS.common,YS.bumpmap,YS.normalmap,YS.displacementmap,YS.fog,{matcap:{value:null}}]),vertexShader:XS.meshmatcap_vert,fragmentShader:XS.meshmatcap_frag},points:{uniforms:TS([YS.points,YS.fog]),vertexShader:XS.points_vert,fragmentShader:XS.points_frag},dashed:{uniforms:TS([YS.common,YS.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:XS.linedashed_vert,fragmentShader:XS.linedashed_frag},depth:{uniforms:TS([YS.common,YS.displacementmap]),vertexShader:XS.depth_vert,fragmentShader:XS.depth_frag},normal:{uniforms:TS([YS.common,YS.bumpmap,YS.normalmap,YS.displacementmap,{opacity:{value:1}}]),vertexShader:XS.normal_vert,fragmentShader:XS.normal_frag},sprite:{uniforms:TS([YS.sprite,YS.fog]),vertexShader:XS.sprite_vert,fragmentShader:XS.sprite_frag},background:{uniforms:{uvTransform:{value:new mE},t2D:{value:null}},vertexShader:XS.background_vert,fragmentShader:XS.background_frag},cube:{uniforms:TS([YS.envmap,{opacity:{value:1}}]),vertexShader:XS.cube_vert,fragmentShader:XS.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:XS.equirect_vert,fragmentShader:XS.equirect_frag},distanceRGBA:{uniforms:TS([YS.common,YS.displacementmap,{referencePosition:{value:new wE},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:XS.distanceRGBA_vert,fragmentShader:XS.distanceRGBA_frag},shadow:{uniforms:TS([YS.lights,YS.fog,{color:{value:new XM(0)},opacity:{value:1}}]),vertexShader:XS.shadow_vert,fragmentShader:XS.shadow_frag}};function QS(e,t,n,i,r){const o=new XM(0);let a,s,l=0,p=null,u=0,h=null;function c(e,t){n.buffers.color.setClear(e.r,e.g,e.b,t,r)}return{getClearColor:function(){return o},setClearColor:function(e,t=1){o.set(e),l=t,c(o,l)},getClearAlpha:function(){return l},setClearAlpha:function(e){l=e,c(o,l)},render:function(n,r,_,d){let m=!0===r.isScene?r.background:null;m&&m.isTexture&&(m=t.get(m));const P=e.xr,f=P.getSession&&P.getSession();f&&"additive"===f.environmentBlendMode&&(m=null),null===m?c(o,l):m&&m.isColor&&(c(m,1),d=!0),(e.autoClear||d)&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),m&&(m.isCubeTexture||306===m.mapping)?(void 0===s&&(s=new NS(new LS(1,1,1),new kS({name:"BackgroundCubeMaterial",uniforms:BS(KS.cube.uniforms),vertexShader:KS.cube.vertexShader,fragmentShader:KS.cube.fragmentShader,side:1,depthTest:!1,depthWrite:!1,fog:!1})),s.geometry.deleteAttribute("normal"),s.geometry.deleteAttribute("uv"),s.onBeforeRender=function(e,t,n){this.matrixWorld.copyPosition(n.matrixWorld)},Object.defineProperty(s.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),i.update(s)),s.material.uniforms.envMap.value=m,s.material.uniforms.flipEnvMap.value=m.isCubeTexture&&m._needsFlipEnvMap?-1:1,p===m&&u===m.version&&h===e.toneMapping||(s.material.needsUpdate=!0,p=m,u=m.version,h=e.toneMapping),n.unshift(s,s.geometry,s.material,0,0,null)):m&&m.isTexture&&(void 0===a&&(a=new NS(new $S(2,2),new kS({name:"BackgroundMaterial",uniforms:BS(KS.background.uniforms),vertexShader:KS.background.vertexShader,fragmentShader:KS.background.fragmentShader,side:0,depthTest:!1,depthWrite:!1,fog:!1})),a.geometry.deleteAttribute("normal"),Object.defineProperty(a.material,"map",{get:function(){return this.uniforms.t2D.value}}),i.update(a)),a.material.uniforms.t2D.value=m,!0===m.matrixAutoUpdate&&m.updateMatrix(),a.material.uniforms.uvTransform.value.copy(m.matrix),p===m&&u===m.version&&h===e.toneMapping||(a.material.needsUpdate=!0,p=m,u=m.version,h=e.toneMapping),n.unshift(a,a.geometry,a.material,0,0,null))}}}function eC(e,t,n,i){const r=e.getParameter(34921),o=i.isWebGL2?null:t.get("OES_vertex_array_object"),a=i.isWebGL2||null!==o,s={},l=c(null);let p=l;function u(t){return i.isWebGL2?e.bindVertexArray(t):o.bindVertexArrayOES(t)}function h(t){return i.isWebGL2?e.deleteVertexArray(t):o.deleteVertexArrayOES(t)}function c(e){const t=[],n=[],i=[];for(let e=0;e<r;e++)t[e]=0,n[e]=0,i[e]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:t,enabledAttributes:n,attributeDivisors:i,object:e,attributes:{},index:null}}function _(){const e=p.newAttributes;for(let t=0,n=e.length;t<n;t++)e[t]=0}function d(e){m(e,0)}function m(n,r){const o=p.newAttributes,a=p.enabledAttributes,s=p.attributeDivisors;o[n]=1,0===a[n]&&(e.enableVertexAttribArray(n),a[n]=1),s[n]!==r&&((i.isWebGL2?e:t.get("ANGLE_instanced_arrays"))[i.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](n,r),s[n]=r)}function P(){const t=p.newAttributes,n=p.enabledAttributes;for(let i=0,r=n.length;i<r;i++)n[i]!==t[i]&&(e.disableVertexAttribArray(i),n[i]=0)}function f(t,n,r,o,a,s){!0!==i.isWebGL2||5124!==r&&5125!==r?e.vertexAttribPointer(t,n,r,o,a,s):e.vertexAttribIPointer(t,n,r,a,s)}function x(){y(),p!==l&&(p=l,u(p.object))}function y(){l.geometry=null,l.program=null,l.wireframe=!1}return{setup:function(r,l,h,x,y){let v=!1;if(a){const t=function(t,n,r){const a=!0===r.wireframe;let l=s[t.id];void 0===l&&(l={},s[t.id]=l);let p=l[n.id];void 0===p&&(p={},l[n.id]=p);let u=p[a];return void 0===u&&(u=c(i.isWebGL2?e.createVertexArray():o.createVertexArrayOES()),p[a]=u),u}(x,h,l);p!==t&&(p=t,u(p.object)),v=function(e,t){const n=p.attributes,i=e.attributes;let r=0;for(const e in i){const t=n[e],o=i[e];if(void 0===t)return!0;if(t.attribute!==o)return!0;if(t.data!==o.data)return!0;r++}return p.attributesNum!==r||p.index!==t}(x,y),v&&function(e,t){const n={},i=e.attributes;let r=0;for(const e in i){const t=i[e],o={};o.attribute=t,t.data&&(o.data=t.data),n[e]=o,r++}p.attributes=n,p.attributesNum=r,p.index=t}(x,y)}else{const e=!0===l.wireframe;p.geometry===x.id&&p.program===h.id&&p.wireframe===e||(p.geometry=x.id,p.program=h.id,p.wireframe=e,v=!0)}!0===r.isInstancedMesh&&(v=!0),null!==y&&n.update(y,34963),v&&(function(r,o,a,s){if(!1===i.isWebGL2&&(r.isInstancedMesh||s.isInstancedBufferGeometry)&&null===t.get("ANGLE_instanced_arrays"))return;_();const l=s.attributes,p=a.getAttributes(),u=o.defaultAttributeValues;for(const t in p){const i=p[t];if(i>=0){const o=l[t];if(void 0!==o){const t=o.normalized,r=o.itemSize,a=n.get(o);if(void 0===a)continue;const l=a.buffer,p=a.type,u=a.bytesPerElement;if(o.isInterleavedBufferAttribute){const n=o.data,a=n.stride,h=o.offset;n&&n.isInstancedInterleavedBuffer?(m(i,n.meshPerAttribute),void 0===s._maxInstanceCount&&(s._maxInstanceCount=n.meshPerAttribute*n.count)):d(i),e.bindBuffer(34962,l),f(i,r,p,t,a*u,h*u)}else o.isInstancedBufferAttribute?(m(i,o.meshPerAttribute),void 0===s._maxInstanceCount&&(s._maxInstanceCount=o.meshPerAttribute*o.count)):d(i),e.bindBuffer(34962,l),f(i,r,p,t,0,0)}else if("instanceMatrix"===t){const t=n.get(r.instanceMatrix);if(void 0===t)continue;const o=t.buffer,a=t.type;m(i+0,1),m(i+1,1),m(i+2,1),m(i+3,1),e.bindBuffer(34962,o),e.vertexAttribPointer(i+0,4,a,!1,64,0),e.vertexAttribPointer(i+1,4,a,!1,64,16),e.vertexAttribPointer(i+2,4,a,!1,64,32),e.vertexAttribPointer(i+3,4,a,!1,64,48)}else if("instanceColor"===t){const t=n.get(r.instanceColor);if(void 0===t)continue;const o=t.buffer,a=t.type;m(i,1),e.bindBuffer(34962,o),e.vertexAttribPointer(i,3,a,!1,12,0)}else if(void 0!==u){const n=u[t];if(void 0!==n)switch(n.length){case 2:e.vertexAttrib2fv(i,n);break;case 3:e.vertexAttrib3fv(i,n);break;case 4:e.vertexAttrib4fv(i,n);break;default:e.vertexAttrib1fv(i,n)}}}}P()}(r,l,h,x),null!==y&&e.bindBuffer(34963,n.get(y).buffer))},reset:x,resetDefaultState:y,dispose:function(){x();for(const e in s){const t=s[e];for(const e in t){const n=t[e];for(const e in n)h(n[e].object),delete n[e];delete t[e]}delete s[e]}},releaseStatesOfGeometry:function(e){if(void 0===s[e.id])return;const t=s[e.id];for(const e in t){const n=t[e];for(const e in n)h(n[e].object),delete n[e];delete t[e]}delete s[e.id]},releaseStatesOfProgram:function(e){for(const t in s){const n=s[t];if(void 0===n[e.id])continue;const i=n[e.id];for(const e in i)h(i[e].object),delete i[e];delete n[e.id]}},initAttributes:_,enableAttribute:d,disableUnusedAttributes:P}}function tC(e,t,n,i){const r=i.isWebGL2;let o;this.setMode=function(e){o=e},this.render=function(t,i){e.drawArrays(o,t,i),n.update(i,o,1)},this.renderInstances=function(i,a,s){if(0===s)return;let l,p;if(r)l=e,p="drawArraysInstanced";else if(l=t.get("ANGLE_instanced_arrays"),p="drawArraysInstancedANGLE",null===l)return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");l[p](o,i,a,s),n.update(a,o,s)}}function nC(e,t,n){let i;function r(t){if("highp"===t){if(e.getShaderPrecisionFormat(35633,36338).precision>0&&e.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";t="mediump"}return"mediump"===t&&e.getShaderPrecisionFormat(35633,36337).precision>0&&e.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}const o="undefined"!=typeof WebGL2RenderingContext&&e instanceof WebGL2RenderingContext||"undefined"!=typeof WebGL2ComputeRenderingContext&&e instanceof WebGL2ComputeRenderingContext;let a=void 0!==n.precision?n.precision:"highp";const s=r(a);s!==a&&(console.warn("THREE.WebGLRenderer:",a,"not supported, using",s,"instead."),a=s);const l=!0===n.logarithmicDepthBuffer,p=e.getParameter(34930),u=e.getParameter(35660),h=e.getParameter(3379),c=e.getParameter(34076),_=e.getParameter(34921),d=e.getParameter(36347),m=e.getParameter(36348),P=e.getParameter(36349),f=u>0,x=o||t.has("OES_texture_float");return{isWebGL2:o,getMaxAnisotropy:function(){if(void 0!==i)return i;if(!0===t.has("EXT_texture_filter_anisotropic")){const n=t.get("EXT_texture_filter_anisotropic");i=e.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else i=0;return i},getMaxPrecision:r,precision:a,logarithmicDepthBuffer:l,maxTextures:p,maxVertexTextures:u,maxTextureSize:h,maxCubemapSize:c,maxAttributes:_,maxVertexUniforms:d,maxVaryings:m,maxFragmentUniforms:P,vertexTextures:f,floatFragmentTextures:x,floatVertexTextures:f&&x,maxSamples:o?e.getParameter(36183):0}}function iC(e){const t=this;let n=null,i=0,r=!1,o=!1;const a=new NM,s=new mE,l={value:null,needsUpdate:!1};function p(){l.value!==n&&(l.value=n,l.needsUpdate=i>0),t.numPlanes=i,t.numIntersection=0}function u(e,n,i,r){const o=null!==e?e.length:0;let p=null;if(0!==o){if(p=l.value,!0!==r||null===p){const t=i+4*o,r=n.matrixWorldInverse;s.getNormalMatrix(r),(null===p||p.length<t)&&(p=new Float32Array(t));for(let t=0,n=i;t!==o;++t,n+=4)a.copy(e[t]).applyMatrix4(r,s),a.normal.toArray(p,n),p[n+3]=a.constant}l.value=p,l.needsUpdate=!0}return t.numPlanes=o,t.numIntersection=0,p}this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(e,t,o){const a=0!==e.length||t||0!==i||r;return r=t,n=u(e,o,0),i=e.length,a},this.beginShadows=function(){o=!0,u(null)},this.endShadows=function(){o=!1,p()},this.setState=function(t,a,s){const h=t.clippingPlanes,c=t.clipIntersection,_=t.clipShadows,d=e.get(t);if(!r||null===h||0===h.length||o&&!_)o?u(null):p();else{const e=o?0:i,t=4*e;let r=d.clippingState||null;l.value=r,r=u(h,a,t,s);for(let e=0;e!==t;++e)r[e]=n[e];d.clippingState=r,this.numIntersection=c?this.numPlanes:0,this.numPlanes+=e}}}function rC(e){let t=new WeakMap;function n(e,t){return 303===t?e.mapping=301:304===t&&(e.mapping=302),e}function i(e){const n=e.target;n.removeEventListener("dispose",i);const r=t.get(n);void 0!==r&&(t.delete(n),r.dispose())}return{get:function(r){if(r&&r.isTexture){const o=r.mapping;if(303===o||304===o){if(t.has(r))return n(t.get(r).texture,r.mapping);{const o=r.image;if(o&&o.height>0){const a=e.getRenderTarget(),s=new DS(o.height/2);return s.fromEquirectangularTexture(e,r),t.set(r,s),e.setRenderTarget(a),r.addEventListener("dispose",i),n(s.texture,r.mapping)}return null}}}return r},dispose:function(){t=new WeakMap}}}function oC(e){const t={};function n(n){if(void 0!==t[n])return t[n];let i;switch(n){case"WEBGL_depth_texture":i=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":i=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":i=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":i=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:i=e.getExtension(n)}return t[n]=i,i}return{has:function(e){return null!==n(e)},init:function(e){e.isWebGL2?n("EXT_color_buffer_float"):(n("WEBGL_depth_texture"),n("OES_texture_float"),n("OES_texture_half_float"),n("OES_texture_half_float_linear"),n("OES_standard_derivatives"),n("OES_element_index_uint"),n("OES_vertex_array_object"),n("ANGLE_instanced_arrays")),n("OES_texture_float_linear"),n("EXT_color_buffer_half_float")},get:function(e){const t=n(e);return null===t&&console.warn("THREE.WebGLRenderer: "+e+" extension not supported."),t}}}function aC(e,t,n,i){const r={},o=new WeakMap;function a(e){const s=e.target;null!==s.index&&t.remove(s.index);for(const e in s.attributes)t.remove(s.attributes[e]);s.removeEventListener("dispose",a),delete r[s.id];const l=o.get(s);l&&(t.remove(l),o.delete(s)),i.releaseStatesOfGeometry(s),!0===s.isInstancedBufferGeometry&&delete s._maxInstanceCount,n.memory.geometries--}function s(e){const n=[],i=e.index,r=e.attributes.position;let a=0;if(null!==i){const e=i.array;a=i.version;for(let t=0,i=e.length;t<i;t+=3){const i=e[t+0],r=e[t+1],o=e[t+2];n.push(i,r,r,o,o,i)}}else{const e=r.array;a=r.version;for(let t=0,i=e.length/3-1;t<i;t+=3){const e=t+0,i=t+1,r=t+2;n.push(e,i,i,r,r,e)}}const s=new(rS(n)>65535?nS:tS)(n,1);s.version=a;const l=o.get(e);l&&t.remove(l),o.set(e,s)}return{get:function(e,t){return!0===r[t.id]||(t.addEventListener("dispose",a),r[t.id]=!0,n.memory.geometries++),t},update:function(e){const n=e.attributes;for(const e in n)t.update(n[e],34962);const i=e.morphAttributes;for(const e in i){const n=i[e];for(let e=0,i=n.length;e<i;e++)t.update(n[e],34962)}},getWireframeAttribute:function(e){const t=o.get(e);if(t){const n=e.index;null!==n&&t.version<n.version&&s(e)}else s(e);return o.get(e)}}}function sC(e,t,n,i){const r=i.isWebGL2;let o,a,s;this.setMode=function(e){o=e},this.setIndex=function(e){a=e.type,s=e.bytesPerElement},this.render=function(t,i){e.drawElements(o,i,a,t*s),n.update(i,o,1)},this.renderInstances=function(i,l,p){if(0===p)return;let u,h;if(r)u=e,h="drawElementsInstanced";else if(u=t.get("ANGLE_instanced_arrays"),h="drawElementsInstancedANGLE",null===u)return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");u[h](o,l,a,i*s,p),n.update(l,o,p)}}function lC(e){const t={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:t,programs:null,autoReset:!0,reset:function(){t.frame++,t.calls=0,t.triangles=0,t.points=0,t.lines=0},update:function(e,n,i){switch(t.calls++,n){case 4:t.triangles+=i*(e/3);break;case 1:t.lines+=i*(e/2);break;case 3:t.lines+=i*(e-1);break;case 2:t.lines+=i*e;break;case 0:t.points+=i*e;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",n)}}}}function pC(e,t){return e[0]-t[0]}function uC(e,t){return Math.abs(t[1])-Math.abs(e[1])}function hC(e){const t={},n=new Float32Array(8),i=[];for(let e=0;e<8;e++)i[e]=[e,0];return{update:function(r,o,a,s){const l=r.morphTargetInfluences,p=void 0===l?0:l.length;let u=t[o.id];if(void 0===u){u=[];for(let e=0;e<p;e++)u[e]=[e,0];t[o.id]=u}for(let e=0;e<p;e++){const t=u[e];t[0]=e,t[1]=l[e]}u.sort(uC);for(let e=0;e<8;e++)e<p&&u[e][1]?(i[e][0]=u[e][0],i[e][1]=u[e][1]):(i[e][0]=Number.MAX_SAFE_INTEGER,i[e][1]=0);i.sort(pC);const h=a.morphTargets&&o.morphAttributes.position,c=a.morphNormals&&o.morphAttributes.normal;let _=0;for(let e=0;e<8;e++){const t=i[e],r=t[0],a=t[1];r!==Number.MAX_SAFE_INTEGER&&a?(h&&o.getAttribute("morphTarget"+e)!==h[r]&&o.setAttribute("morphTarget"+e,h[r]),c&&o.getAttribute("morphNormal"+e)!==c[r]&&o.setAttribute("morphNormal"+e,c[r]),n[e]=a,_+=a):(h&&!0===o.hasAttribute("morphTarget"+e)&&o.deleteAttribute("morphTarget"+e),c&&!0===o.hasAttribute("morphNormal"+e)&&o.deleteAttribute("morphNormal"+e),n[e]=0)}const d=o.morphTargetsRelative?1:1-_;s.getUniforms().setValue(e,"morphTargetBaseInfluence",d),s.getUniforms().setValue(e,"morphTargetInfluences",n)}}}function cC(e,t,n,i){let r=new WeakMap;function o(e){const t=e.target;t.removeEventListener("dispose",o),n.remove(t.instanceMatrix),null!==t.instanceColor&&n.remove(t.instanceColor)}return{update:function(e){const a=i.render.frame,s=e.geometry,l=t.get(e,s);return r.get(l)!==a&&(t.update(l),r.set(l,a)),e.isInstancedMesh&&(!1===e.hasEventListener("dispose",o)&&e.addEventListener("dispose",o),n.update(e.instanceMatrix,34962),null!==e.instanceColor&&n.update(e.instanceColor,34962)),l},dispose:function(){r=new WeakMap}}}KS.physical={uniforms:TS([KS.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new dE(1,1)},clearcoatNormalMap:{value:null},sheen:{value:new XM(0)},transmission:{value:0},transmissionMap:{value:null}}]),vertexShader:XS.meshphysical_vert,fragmentShader:XS.meshphysical_frag};class _C extends yE{constructor(e=null,t=1,n=1,i=1){super(null),this.image={data:e,width:t,height:n,depth:i},this.magFilter=IZ,this.minFilter=IZ,this.wrapR=VZ,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}}_C.prototype.isDataTexture2DArray=!0;class dC extends yE{constructor(e=null,t=1,n=1,i=1){super(null),this.image={data:e,width:t,height:n,depth:i},this.magFilter=IZ,this.minFilter=IZ,this.wrapR=VZ,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}}dC.prototype.isDataTexture3D=!0;const mC=new yE,PC=new _C,fC=new dC,xC=new FS,yC=[],vC=[],gC=new Float32Array(16),bC=new Float32Array(9),zC=new Float32Array(4);function wC(e,t,n){const i=e[0];if(i<=0||i>0)return e;const r=t*n;let o=yC[r];if(void 0===o&&(o=new Float32Array(r),yC[r]=o),0!==t){i.toArray(o,0);for(let i=1,r=0;i!==t;++i)r+=n,e[i].toArray(o,r)}return o}function ZC(e,t){if(e.length!==t.length)return!1;for(let n=0,i=e.length;n<i;n++)if(e[n]!==t[n])return!1;return!0}function EC(e,t){for(let n=0,i=t.length;n<i;n++)e[n]=t[n]}function MC(e,t){let n=vC[t];void 0===n&&(n=new Int32Array(t),vC[t]=n);for(let i=0;i!==t;++i)n[i]=e.allocateTextureUnit();return n}function SC(e,t){const n=this.cache;n[0]!==t&&(e.uniform1f(this.addr,t),n[0]=t)}function CC(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y||(e.uniform2f(this.addr,t.x,t.y),n[0]=t.x,n[1]=t.y);else{if(ZC(n,t))return;e.uniform2fv(this.addr,t),EC(n,t)}}function NC(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z||(e.uniform3f(this.addr,t.x,t.y,t.z),n[0]=t.x,n[1]=t.y,n[2]=t.z);else if(void 0!==t.r)n[0]===t.r&&n[1]===t.g&&n[2]===t.b||(e.uniform3f(this.addr,t.r,t.g,t.b),n[0]=t.r,n[1]=t.g,n[2]=t.b);else{if(ZC(n,t))return;e.uniform3fv(this.addr,t),EC(n,t)}}function AC(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z&&n[3]===t.w||(e.uniform4f(this.addr,t.x,t.y,t.z,t.w),n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w);else{if(ZC(n,t))return;e.uniform4fv(this.addr,t),EC(n,t)}}function LC(e,t){const n=this.cache,i=t.elements;if(void 0===i){if(ZC(n,t))return;e.uniformMatrix2fv(this.addr,!1,t),EC(n,t)}else{if(ZC(n,i))return;zC.set(i),e.uniformMatrix2fv(this.addr,!1,zC),EC(n,i)}}function BC(e,t){const n=this.cache,i=t.elements;if(void 0===i){if(ZC(n,t))return;e.uniformMatrix3fv(this.addr,!1,t),EC(n,t)}else{if(ZC(n,i))return;bC.set(i),e.uniformMatrix3fv(this.addr,!1,bC),EC(n,i)}}function TC(e,t){const n=this.cache,i=t.elements;if(void 0===i){if(ZC(n,t))return;e.uniformMatrix4fv(this.addr,!1,t),EC(n,t)}else{if(ZC(n,i))return;gC.set(i),e.uniformMatrix4fv(this.addr,!1,gC),EC(n,i)}}function VC(e,t){const n=this.cache;n[0]!==t&&(e.uniform1i(this.addr,t),n[0]=t)}function kC(e,t){const n=this.cache;ZC(n,t)||(e.uniform2iv(this.addr,t),EC(n,t))}function IC(e,t){const n=this.cache;ZC(n,t)||(e.uniform3iv(this.addr,t),EC(n,t))}function OC(e,t){const n=this.cache;ZC(n,t)||(e.uniform4iv(this.addr,t),EC(n,t))}function RC(e,t){const n=this.cache;n[0]!==t&&(e.uniform1ui(this.addr,t),n[0]=t)}function HC(e,t){const n=this.cache;ZC(n,t)||(e.uniform2uiv(this.addr,t),EC(n,t))}function FC(e,t){const n=this.cache;ZC(n,t)||(e.uniform3uiv(this.addr,t),EC(n,t))}function DC(e,t){const n=this.cache;ZC(n,t)||(e.uniform4uiv(this.addr,t),EC(n,t))}function GC(e,t,n){const i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(e.uniform1i(this.addr,r),i[0]=r),n.safeSetTexture2D(t||mC,r)}function UC(e,t,n){const i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(e.uniform1i(this.addr,r),i[0]=r),n.setTexture3D(t||fC,r)}function jC(e,t,n){const i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(e.uniform1i(this.addr,r),i[0]=r),n.safeSetTextureCube(t||xC,r)}function WC(e,t,n){const i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(e.uniform1i(this.addr,r),i[0]=r),n.setTexture2DArray(t||PC,r)}function qC(e,t){e.uniform1fv(this.addr,t)}function JC(e,t){const n=wC(t,this.size,2);e.uniform2fv(this.addr,n)}function $C(e,t){const n=wC(t,this.size,3);e.uniform3fv(this.addr,n)}function XC(e,t){const n=wC(t,this.size,4);e.uniform4fv(this.addr,n)}function YC(e,t){const n=wC(t,this.size,4);e.uniformMatrix2fv(this.addr,!1,n)}function KC(e,t){const n=wC(t,this.size,9);e.uniformMatrix3fv(this.addr,!1,n)}function QC(e,t){const n=wC(t,this.size,16);e.uniformMatrix4fv(this.addr,!1,n)}function eN(e,t){e.uniform1iv(this.addr,t)}function tN(e,t){e.uniform2iv(this.addr,t)}function nN(e,t){e.uniform3iv(this.addr,t)}function iN(e,t){e.uniform4iv(this.addr,t)}function rN(e,t){e.uniform1uiv(this.addr,t)}function oN(e,t){e.uniform2uiv(this.addr,t)}function aN(e,t){e.uniform3uiv(this.addr,t)}function sN(e,t){e.uniform4uiv(this.addr,t)}function lN(e,t,n){const i=t.length,r=MC(n,i);e.uniform1iv(this.addr,r);for(let e=0;e!==i;++e)n.safeSetTexture2D(t[e]||mC,r[e])}function pN(e,t,n){const i=t.length,r=MC(n,i);e.uniform1iv(this.addr,r);for(let e=0;e!==i;++e)n.safeSetTextureCube(t[e]||xC,r[e])}function uN(e,t,n){this.id=e,this.addr=n,this.cache=[],this.setValue=function(e){switch(e){case 5126:return SC;case 35664:return CC;case 35665:return NC;case 35666:return AC;case 35674:return LC;case 35675:return BC;case 35676:return TC;case 5124:case 35670:return VC;case 35667:case 35671:return kC;case 35668:case 35672:return IC;case 35669:case 35673:return OC;case 5125:return RC;case 36294:return HC;case 36295:return FC;case 36296:return DC;case 35678:case 36198:case 36298:case 36306:case 35682:return GC;case 35679:case 36299:case 36307:return UC;case 35680:case 36300:case 36308:case 36293:return jC;case 36289:case 36303:case 36311:case 36292:return WC}}(t.type)}function hN(e,t,n){this.id=e,this.addr=n,this.cache=[],this.size=t.size,this.setValue=function(e){switch(e){case 5126:return qC;case 35664:return JC;case 35665:return $C;case 35666:return XC;case 35674:return YC;case 35675:return KC;case 35676:return QC;case 5124:case 35670:return eN;case 35667:case 35671:return tN;case 35668:case 35672:return nN;case 35669:case 35673:return iN;case 5125:return rN;case 36294:return oN;case 36295:return aN;case 36296:return sN;case 35678:case 36198:case 36298:case 36306:case 35682:return lN;case 35680:case 36300:case 36308:case 36293:return pN}}(t.type)}function cN(e){this.id=e,this.seq=[],this.map={}}hN.prototype.updateCache=function(e){const t=this.cache;e instanceof Float32Array&&t.length!==e.length&&(this.cache=new Float32Array(e.length)),EC(t,e)},cN.prototype.setValue=function(e,t,n){const i=this.seq;for(let r=0,o=i.length;r!==o;++r){const o=i[r];o.setValue(e,t[o.id],n)}};const _N=/(\w+)(\])?(\[|\.)?/g;function dN(e,t){e.seq.push(t),e.map[t.id]=t}function mN(e,t,n){const i=e.name,r=i.length;for(_N.lastIndex=0;;){const o=_N.exec(i),a=_N.lastIndex;let s=o[1];const l="]"===o[2],p=o[3];if(l&&(s|=0),void 0===p||"["===p&&a+2===r){dN(n,void 0===p?new uN(s,e,t):new hN(s,e,t));break}{let e=n.map[s];void 0===e&&(e=new cN(s),dN(n,e)),n=e}}}function PN(e,t){this.seq=[],this.map={};const n=e.getProgramParameter(t,35718);for(let i=0;i<n;++i){const n=e.getActiveUniform(t,i);mN(n,e.getUniformLocation(t,n.name),this)}}function fN(e,t,n){const i=e.createShader(t);return e.shaderSource(i,n),e.compileShader(i),i}PN.prototype.setValue=function(e,t,n,i){const r=this.map[t];void 0!==r&&r.setValue(e,n,i)},PN.prototype.setOptional=function(e,t,n){const i=t[n];void 0!==i&&this.setValue(e,n,i)},PN.upload=function(e,t,n,i){for(let r=0,o=t.length;r!==o;++r){const o=t[r],a=n[o.id];!1!==a.needsUpdate&&o.setValue(e,a.value,i)}},PN.seqWithValue=function(e,t){const n=[];for(let i=0,r=e.length;i!==r;++i){const r=e[i];r.id in t&&n.push(r)}return n};let xN=0;function yN(e){switch(e){case eE:return["Linear","( value )"];case 3001:return["sRGB","( value )"];case 3002:return["RGBE","( value )"];case 3004:return["RGBM","( value, 7.0 )"];case 3005:return["RGBM","( value, 16.0 )"];case 3006:return["RGBD","( value, 256.0 )"];case 3007:return["Gamma","( value, float( GAMMA_FACTOR ) )"];case 3003:return["LogLuv","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",e),["Linear","( value )"]}}function vN(e,t,n){const i=e.getShaderParameter(t,35713),r=e.getShaderInfoLog(t).trim();return i&&""===r?"":"THREE.WebGLShader: gl.getShaderInfoLog() "+n+"\n"+r+function(e){const t=e.split("\n");for(let e=0;e<t.length;e++)t[e]=e+1+": "+t[e];return t.join("\n")}(e.getShaderSource(t))}function gN(e,t){const n=yN(t);return"vec4 "+e+"( vec4 value ) { return "+n[0]+"ToLinear"+n[1]+"; }"}function bN(e,t){const n=yN(t);return"vec4 "+e+"( vec4 value ) { return LinearTo"+n[0]+n[1]+"; }"}function zN(e,t){let n;switch(t){case 1:n="Linear";break;case 2:n="Reinhard";break;case 3:n="OptimizedCineon";break;case 4:n="ACESFilmic";break;case 5:n="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",t),n="Linear"}return"vec3 "+e+"( vec3 color ) { return "+n+"ToneMapping( color ); }"}function wN(e){return""!==e}function ZN(e,t){return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function EN(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}const MN=/^[ \t]*#include +<([\w\d./]+)>/gm;function SN(e){return e.replace(MN,CN)}function CN(e,t){const n=XS[t];if(void 0===n)throw new Error("Can not resolve #include <"+t+">");return SN(n)}const NN=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,AN=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function LN(e){return e.replace(AN,TN).replace(NN,BN)}function BN(e,t,n,i){return console.warn("WebGLProgram: #pragma unroll_loop shader syntax is deprecated. Please use #pragma unroll_loop_start syntax instead."),TN(e,t,n,i)}function TN(e,t,n,i){let r="";for(let e=parseInt(t);e<parseInt(n);e++)r+=i.replace(/\[\s*i\s*\]/g,"[ "+e+" ]").replace(/UNROLLED_LOOP_INDEX/g,e);return r}function VN(e){let t="precision "+e.precision+" float;\nprecision "+e.precision+" int;";return"highp"===e.precision?t+="\n#define HIGH_PRECISION":"mediump"===e.precision?t+="\n#define MEDIUM_PRECISION":"lowp"===e.precision&&(t+="\n#define LOW_PRECISION"),t}function kN(e,t,n,i){const r=e.getContext(),o=n.defines;let a=n.vertexShader,s=n.fragmentShader;const l=function(e){let t="SHADOWMAP_TYPE_BASIC";return 1===e.shadowMapType?t="SHADOWMAP_TYPE_PCF":2===e.shadowMapType?t="SHADOWMAP_TYPE_PCF_SOFT":3===e.shadowMapType&&(t="SHADOWMAP_TYPE_VSM"),t}(n),p=function(e){let t="ENVMAP_TYPE_CUBE";if(e.envMap)switch(e.envMapMode){case 301:case 302:t="ENVMAP_TYPE_CUBE";break;case 306:case 307:t="ENVMAP_TYPE_CUBE_UV"}return t}(n),u=function(e){let t="ENVMAP_MODE_REFLECTION";if(e.envMap)switch(e.envMapMode){case 302:case 307:t="ENVMAP_MODE_REFRACTION"}return t}(n),h=function(e){let t="ENVMAP_BLENDING_NONE";if(e.envMap)switch(e.combine){case 0:t="ENVMAP_BLENDING_MULTIPLY";break;case 1:t="ENVMAP_BLENDING_MIX";break;case 2:t="ENVMAP_BLENDING_ADD"}return t}(n),c=e.gammaFactor>0?e.gammaFactor:1,_=n.isWebGL2?"":function(e){return[e.extensionDerivatives||e.envMapCubeUV||e.bumpMap||e.tangentSpaceNormalMap||e.clearcoatNormalMap||e.flatShading||"physical"===e.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(e.extensionFragDepth||e.logarithmicDepthBuffer)&&e.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",e.extensionDrawBuffers&&e.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(e.extensionShaderTextureLOD||e.envMap)&&e.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(wN).join("\n")}(n),d=function(e){const t=[];for(const n in e){const i=e[n];!1!==i&&t.push("#define "+n+" "+i)}return t.join("\n")}(o),m=r.createProgram();let P,f,x=n.glslVersion?"#version "+n.glslVersion+"\n":"";n.isRawShaderMaterial?(P=[d].filter(wN).join("\n"),P.length>0&&(P+="\n"),f=[_,d].filter(wN).join("\n"),f.length>0&&(f+="\n")):(P=[VN(n),"#define SHADER_NAME "+n.shaderName,d,n.instancing?"#define USE_INSTANCING":"",n.instancingColor?"#define USE_INSTANCING_COLOR":"",n.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+c,"#define MAX_BONES "+n.maxBones,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+u:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMap&&n.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",n.normalMap&&n.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.displacementMap&&n.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.vertexTangents?"#define USE_TANGENT":"",n.vertexColors?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUvs?"#define USE_UV":"",n.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",n.flatShading?"#define FLAT_SHADED":"",n.skinning?"#define USE_SKINNING":"",n.useVertexTexture?"#define BONE_TEXTURE":"",n.morphTargets?"#define USE_MORPHTARGETS":"",n.morphNormals&&!1===n.flatShading?"#define USE_MORPHNORMALS":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+l:"",n.sizeAttenuation?"#define USE_SIZEATTENUATION":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","\tattribute vec4 color;","#elif defined( USE_COLOR )","\tattribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(wN).join("\n"),f=[_,VN(n),"#define SHADER_NAME "+n.shaderName,d,n.alphaTest?"#define ALPHATEST "+n.alphaTest+(n.alphaTest%1?"":".0"):"","#define GAMMA_FACTOR "+c,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.matcap?"#define USE_MATCAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+p:"",n.envMap?"#define "+u:"",n.envMap?"#define "+h:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMap&&n.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",n.normalMap&&n.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.sheen?"#define USE_SHEEN":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.vertexTangents?"#define USE_TANGENT":"",n.vertexColors||n.instancingColor?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUvs?"#define USE_UV":"",n.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",n.gradientMap?"#define USE_GRADIENTMAP":"",n.flatShading?"#define FLAT_SHADED":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+l:"",n.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",n.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"",(n.extensionShaderTextureLOD||n.envMap)&&n.rendererExtensionShaderTextureLod?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",0!==n.toneMapping?"#define TONE_MAPPING":"",0!==n.toneMapping?XS.tonemapping_pars_fragment:"",0!==n.toneMapping?zN("toneMapping",n.toneMapping):"",n.dithering?"#define DITHERING":"",XS.encodings_pars_fragment,n.map?gN("mapTexelToLinear",n.mapEncoding):"",n.matcap?gN("matcapTexelToLinear",n.matcapEncoding):"",n.envMap?gN("envMapTexelToLinear",n.envMapEncoding):"",n.emissiveMap?gN("emissiveMapTexelToLinear",n.emissiveMapEncoding):"",n.lightMap?gN("lightMapTexelToLinear",n.lightMapEncoding):"",bN("linearToOutputTexel",n.outputEncoding),n.depthPacking?"#define DEPTH_PACKING "+n.depthPacking:"","\n"].filter(wN).join("\n")),a=SN(a),a=ZN(a,n),a=EN(a,n),s=SN(s),s=ZN(s,n),s=EN(s,n),a=LN(a),s=LN(s),n.isWebGL2&&!0!==n.isRawShaderMaterial&&(x="#version 300 es\n",P=["#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+P,f=["#define varying in",n.glslVersion===rE?"":"out highp vec4 pc_fragColor;",n.glslVersion===rE?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+f);const y=x+f+s,v=fN(r,35633,x+P+a),g=fN(r,35632,y);if(r.attachShader(m,v),r.attachShader(m,g),void 0!==n.index0AttributeName?r.bindAttribLocation(m,0,n.index0AttributeName):!0===n.morphTargets&&r.bindAttribLocation(m,0,"position"),r.linkProgram(m),e.debug.checkShaderErrors){const e=r.getProgramInfoLog(m).trim(),t=r.getShaderInfoLog(v).trim(),n=r.getShaderInfoLog(g).trim();let i=!0,o=!0;if(!1===r.getProgramParameter(m,35714)){i=!1;const t=vN(r,v,"vertex"),n=vN(r,g,"fragment");console.error("THREE.WebGLProgram: shader error: ",r.getError(),"35715",r.getProgramParameter(m,35715),"gl.getProgramInfoLog",e,t,n)}else""!==e?console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",e):""!==t&&""!==n||(o=!1);o&&(this.diagnostics={runnable:i,programLog:e,vertexShader:{log:t,prefix:P},fragmentShader:{log:n,prefix:f}})}let b,z;return r.deleteShader(v),r.deleteShader(g),this.getUniforms=function(){return void 0===b&&(b=new PN(r,m)),b},this.getAttributes=function(){return void 0===z&&(z=function(e,t){const n={},i=e.getProgramParameter(t,35721);for(let r=0;r<i;r++){const i=e.getActiveAttrib(t,r).name;n[i]=e.getAttribLocation(t,i)}return n}(r,m)),z},this.destroy=function(){i.releaseStatesOfProgram(this),r.deleteProgram(m),this.program=void 0},this.name=n.shaderName,this.id=xN++,this.cacheKey=t,this.usedTimes=1,this.program=m,this.vertexShader=v,this.fragmentShader=g,this}function IN(e,t,n,i,r,o){const a=[],s=i.isWebGL2,l=i.logarithmicDepthBuffer,p=i.floatVertexTextures,u=i.maxVertexUniforms,h=i.vertexTextures;let c=i.precision;const _={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"},d=["precision","isWebGL2","supportsVertexTextures","outputEncoding","instancing","instancingColor","map","mapEncoding","matcap","matcapEncoding","envMap","envMapMode","envMapEncoding","envMapCubeUV","lightMap","lightMapEncoding","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","objectSpaceNormalMap","tangentSpaceNormalMap","clearcoatMap","clearcoatRoughnessMap","clearcoatNormalMap","displacementMap","specularMap","roughnessMap","metalnessMap","gradientMap","alphaMap","combine","vertexColors","vertexAlphas","vertexTangents","vertexUvs","uvsVertexOnly","fog","useFog","fogExp2","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","numRectAreaLights","numDirLightShadows","numPointLightShadows","numSpotLightShadows","shadowMapEnabled","shadowMapType","toneMapping","physicallyCorrectLights","alphaTest","doubleSided","flipSided","numClippingPlanes","numClipIntersection","depthPacking","dithering","sheen","transmissionMap"];function m(e){let t;return e&&e.isTexture?t=e.encoding:e&&e.isWebGLRenderTarget?(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),t=e.texture.encoding):t=eE,t}return{getParameters:function(r,a,d,P,f){const x=P.fog,y=r.isMeshStandardMaterial?P.environment:null,v=t.get(r.envMap||y),g=_[r.type],b=f.isSkinnedMesh?function(e){const t=e.skeleton.bones;if(p)return 1024;{const e=u,n=Math.floor((e-20)/4),i=Math.min(n,t.length);return i<t.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+t.length+" bones. This GPU supports "+i+"."),0):i}}(f):0;let z,w;if(null!==r.precision&&(c=i.getMaxPrecision(r.precision),c!==r.precision&&console.warn("THREE.WebGLProgram.getParameters:",r.precision,"not supported, using",c,"instead.")),g){const e=KS[g];z=e.vertexShader,w=e.fragmentShader}else z=r.vertexShader,w=r.fragmentShader;const Z=e.getRenderTarget();return{isWebGL2:s,shaderID:g,shaderName:r.type,vertexShader:z,fragmentShader:w,defines:r.defines,isRawShaderMaterial:!0===r.isRawShaderMaterial,glslVersion:r.glslVersion,precision:c,instancing:!0===f.isInstancedMesh,instancingColor:!0===f.isInstancedMesh&&null!==f.instanceColor,supportsVertexTextures:h,outputEncoding:null!==Z?m(Z.texture):e.outputEncoding,map:!!r.map,mapEncoding:m(r.map),matcap:!!r.matcap,matcapEncoding:m(r.matcap),envMap:!!v,envMapMode:v&&v.mapping,envMapEncoding:m(v),envMapCubeUV:!!v&&(306===v.mapping||307===v.mapping),lightMap:!!r.lightMap,lightMapEncoding:m(r.lightMap),aoMap:!!r.aoMap,emissiveMap:!!r.emissiveMap,emissiveMapEncoding:m(r.emissiveMap),bumpMap:!!r.bumpMap,normalMap:!!r.normalMap,objectSpaceNormalMap:1===r.normalMapType,tangentSpaceNormalMap:0===r.normalMapType,clearcoatMap:!!r.clearcoatMap,clearcoatRoughnessMap:!!r.clearcoatRoughnessMap,clearcoatNormalMap:!!r.clearcoatNormalMap,displacementMap:!!r.displacementMap,roughnessMap:!!r.roughnessMap,metalnessMap:!!r.metalnessMap,specularMap:!!r.specularMap,alphaMap:!!r.alphaMap,gradientMap:!!r.gradientMap,sheen:!!r.sheen,transmissionMap:!!r.transmissionMap,combine:r.combine,vertexTangents:r.normalMap&&r.vertexTangents,vertexColors:r.vertexColors,vertexAlphas:!0===r.vertexColors&&f.geometry&&f.geometry.attributes.color&&4===f.geometry.attributes.color.itemSize,vertexUvs:!!(r.map||r.bumpMap||r.normalMap||r.specularMap||r.alphaMap||r.emissiveMap||r.roughnessMap||r.metalnessMap||r.clearcoatMap||r.clearcoatRoughnessMap||r.clearcoatNormalMap||r.displacementMap||r.transmissionMap),uvsVertexOnly:!(r.map||r.bumpMap||r.normalMap||r.specularMap||r.alphaMap||r.emissiveMap||r.roughnessMap||r.metalnessMap||r.clearcoatNormalMap||r.transmissionMap||!r.displacementMap),fog:!!x,useFog:r.fog,fogExp2:x&&x.isFogExp2,flatShading:!!r.flatShading,sizeAttenuation:r.sizeAttenuation,logarithmicDepthBuffer:l,skinning:r.skinning&&b>0,maxBones:b,useVertexTexture:p,morphTargets:r.morphTargets,morphNormals:r.morphNormals,numDirLights:a.directional.length,numPointLights:a.point.length,numSpotLights:a.spot.length,numRectAreaLights:a.rectArea.length,numHemiLights:a.hemi.length,numDirLightShadows:a.directionalShadowMap.length,numPointLightShadows:a.pointShadowMap.length,numSpotLightShadows:a.spotShadowMap.length,numClippingPlanes:o.numPlanes,numClipIntersection:o.numIntersection,dithering:r.dithering,shadowMapEnabled:e.shadowMap.enabled&&d.length>0,shadowMapType:e.shadowMap.type,toneMapping:r.toneMapped?e.toneMapping:0,physicallyCorrectLights:e.physicallyCorrectLights,premultipliedAlpha:r.premultipliedAlpha,alphaTest:r.alphaTest,doubleSided:2===r.side,flipSided:1===r.side,depthPacking:void 0!==r.depthPacking&&r.depthPacking,index0AttributeName:r.index0AttributeName,extensionDerivatives:r.extensions&&r.extensions.derivatives,extensionFragDepth:r.extensions&&r.extensions.fragDepth,extensionDrawBuffers:r.extensions&&r.extensions.drawBuffers,extensionShaderTextureLOD:r.extensions&&r.extensions.shaderTextureLOD,rendererExtensionFragDepth:s||n.has("EXT_frag_depth"),rendererExtensionDrawBuffers:s||n.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:s||n.has("EXT_shader_texture_lod"),customProgramCacheKey:r.customProgramCacheKey()}},getProgramCacheKey:function(t){const n=[];if(t.shaderID?n.push(t.shaderID):(n.push(t.fragmentShader),n.push(t.vertexShader)),void 0!==t.defines)for(const e in t.defines)n.push(e),n.push(t.defines[e]);if(!1===t.isRawShaderMaterial){for(let e=0;e<d.length;e++)n.push(t[d[e]]);n.push(e.outputEncoding),n.push(e.gammaFactor)}return n.push(t.customProgramCacheKey),n.join()},getUniforms:function(e){const t=_[e.type];let n;if(t){const e=KS[t];n=VS.clone(e.uniforms)}else n=e.uniforms;return n},acquireProgram:function(t,n){let i;for(let e=0,t=a.length;e<t;e++){const t=a[e];if(t.cacheKey===n){i=t,++i.usedTimes;break}}return void 0===i&&(i=new kN(e,n,t,r),a.push(i)),i},releaseProgram:function(e){if(0==--e.usedTimes){const t=a.indexOf(e);a[t]=a[a.length-1],a.pop(),e.destroy()}},programs:a}}function ON(){let e=new WeakMap;return{get:function(t){let n=e.get(t);return void 0===n&&(n={},e.set(t,n)),n},remove:function(t){e.delete(t)},update:function(t,n,i){e.get(t)[n]=i},dispose:function(){e=new WeakMap}}}function RN(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.program!==t.program?e.program.id-t.program.id:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function HN(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function FN(e){const t=[];let n=0;const i=[],r=[],o={id:-1};function a(i,r,a,s,l,p){let u=t[n];const h=e.get(a);return void 0===u?(u={id:i.id,object:i,geometry:r,material:a,program:h.program||o,groupOrder:s,renderOrder:i.renderOrder,z:l,group:p},t[n]=u):(u.id=i.id,u.object=i,u.geometry=r,u.material=a,u.program=h.program||o,u.groupOrder=s,u.renderOrder=i.renderOrder,u.z=l,u.group=p),n++,u}return{opaque:i,transparent:r,init:function(){n=0,i.length=0,r.length=0},push:function(e,t,n,o,s,l){const p=a(e,t,n,o,s,l);(!0===n.transparent?r:i).push(p)},unshift:function(e,t,n,o,s,l){const p=a(e,t,n,o,s,l);(!0===n.transparent?r:i).unshift(p)},finish:function(){for(let e=n,i=t.length;e<i;e++){const n=t[e];if(null===n.id)break;n.id=null,n.object=null,n.geometry=null,n.material=null,n.program=null,n.group=null}},sort:function(e,t){i.length>1&&i.sort(e||RN),r.length>1&&r.sort(t||HN)}}}function DN(e){let t=new WeakMap;return{get:function(n,i){let r;return!1===t.has(n)?(r=new FN(e),t.set(n,[r])):i>=t.get(n).length?(r=new FN(e),t.get(n).push(r)):r=t.get(n)[i],r},dispose:function(){t=new WeakMap}}}function GN(){const e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];let n;switch(t.type){case"DirectionalLight":n={direction:new wE,color:new XM};break;case"SpotLight":n={position:new wE,direction:new wE,color:new XM,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":n={position:new wE,color:new XM,distance:0,decay:0};break;case"HemisphereLight":n={direction:new wE,skyColor:new XM,groundColor:new XM};break;case"RectAreaLight":n={color:new XM,position:new wE,halfWidth:new wE,halfHeight:new wE}}return e[t.id]=n,n}}}let UN=0;function jN(e,t){return(t.castShadow?1:0)-(e.castShadow?1:0)}function WN(e,t){const n=new GN,i=function(){const e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];let n;switch(t.type){case"DirectionalLight":case"SpotLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new dE};break;case"PointLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new dE,shadowCameraNear:1,shadowCameraFar:1e3}}return e[t.id]=n,n}}}(),r={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadow:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]};for(let e=0;e<9;e++)r.probe.push(new wE);const o=new wE,a=new tM,s=new tM;return{setup:function(o){let a=0,s=0,l=0;for(let e=0;e<9;e++)r.probe[e].set(0,0,0);let p=0,u=0,h=0,c=0,_=0,d=0,m=0,P=0;o.sort(jN);for(let e=0,t=o.length;e<t;e++){const t=o[e],f=t.color,x=t.intensity,y=t.distance,v=t.shadow&&t.shadow.map?t.shadow.map.texture:null;if(t.isAmbientLight)a+=f.r*x,s+=f.g*x,l+=f.b*x;else if(t.isLightProbe)for(let e=0;e<9;e++)r.probe[e].addScaledVector(t.sh.coefficients[e],x);else if(t.isDirectionalLight){const e=n.get(t);if(e.color.copy(t.color).multiplyScalar(t.intensity),t.castShadow){const e=t.shadow,n=i.get(t);n.shadowBias=e.bias,n.shadowNormalBias=e.normalBias,n.shadowRadius=e.radius,n.shadowMapSize=e.mapSize,r.directionalShadow[p]=n,r.directionalShadowMap[p]=v,r.directionalShadowMatrix[p]=t.shadow.matrix,d++}r.directional[p]=e,p++}else if(t.isSpotLight){const e=n.get(t);if(e.position.setFromMatrixPosition(t.matrixWorld),e.color.copy(f).multiplyScalar(x),e.distance=y,e.coneCos=Math.cos(t.angle),e.penumbraCos=Math.cos(t.angle*(1-t.penumbra)),e.decay=t.decay,t.castShadow){const e=t.shadow,n=i.get(t);n.shadowBias=e.bias,n.shadowNormalBias=e.normalBias,n.shadowRadius=e.radius,n.shadowMapSize=e.mapSize,r.spotShadow[h]=n,r.spotShadowMap[h]=v,r.spotShadowMatrix[h]=t.shadow.matrix,P++}r.spot[h]=e,h++}else if(t.isRectAreaLight){const e=n.get(t);e.color.copy(f).multiplyScalar(x),e.halfWidth.set(.5*t.width,0,0),e.halfHeight.set(0,.5*t.height,0),r.rectArea[c]=e,c++}else if(t.isPointLight){const e=n.get(t);if(e.color.copy(t.color).multiplyScalar(t.intensity),e.distance=t.distance,e.decay=t.decay,t.castShadow){const e=t.shadow,n=i.get(t);n.shadowBias=e.bias,n.shadowNormalBias=e.normalBias,n.shadowRadius=e.radius,n.shadowMapSize=e.mapSize,n.shadowCameraNear=e.camera.near,n.shadowCameraFar=e.camera.far,r.pointShadow[u]=n,r.pointShadowMap[u]=v,r.pointShadowMatrix[u]=t.shadow.matrix,m++}r.point[u]=e,u++}else if(t.isHemisphereLight){const e=n.get(t);e.skyColor.copy(t.color).multiplyScalar(x),e.groundColor.copy(t.groundColor).multiplyScalar(x),r.hemi[_]=e,_++}}c>0&&(t.isWebGL2||!0===e.has("OES_texture_float_linear")?(r.rectAreaLTC1=YS.LTC_FLOAT_1,r.rectAreaLTC2=YS.LTC_FLOAT_2):!0===e.has("OES_texture_half_float_linear")?(r.rectAreaLTC1=YS.LTC_HALF_1,r.rectAreaLTC2=YS.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),r.ambient[0]=a,r.ambient[1]=s,r.ambient[2]=l;const f=r.hash;f.directionalLength===p&&f.pointLength===u&&f.spotLength===h&&f.rectAreaLength===c&&f.hemiLength===_&&f.numDirectionalShadows===d&&f.numPointShadows===m&&f.numSpotShadows===P||(r.directional.length=p,r.spot.length=h,r.rectArea.length=c,r.point.length=u,r.hemi.length=_,r.directionalShadow.length=d,r.directionalShadowMap.length=d,r.pointShadow.length=m,r.pointShadowMap.length=m,r.spotShadow.length=P,r.spotShadowMap.length=P,r.directionalShadowMatrix.length=d,r.pointShadowMatrix.length=m,r.spotShadowMatrix.length=P,f.directionalLength=p,f.pointLength=u,f.spotLength=h,f.rectAreaLength=c,f.hemiLength=_,f.numDirectionalShadows=d,f.numPointShadows=m,f.numSpotShadows=P,r.version=UN++)},setupView:function(e,t){let n=0,i=0,l=0,p=0,u=0;const h=t.matrixWorldInverse;for(let t=0,c=e.length;t<c;t++){const c=e[t];if(c.isDirectionalLight){const e=r.directional[n];e.direction.setFromMatrixPosition(c.matrixWorld),o.setFromMatrixPosition(c.target.matrixWorld),e.direction.sub(o),e.direction.transformDirection(h),n++}else if(c.isSpotLight){const e=r.spot[l];e.position.setFromMatrixPosition(c.matrixWorld),e.position.applyMatrix4(h),e.direction.setFromMatrixPosition(c.matrixWorld),o.setFromMatrixPosition(c.target.matrixWorld),e.direction.sub(o),e.direction.transformDirection(h),l++}else if(c.isRectAreaLight){const e=r.rectArea[p];e.position.setFromMatrixPosition(c.matrixWorld),e.position.applyMatrix4(h),s.identity(),a.copy(c.matrixWorld),a.premultiply(h),s.extractRotation(a),e.halfWidth.set(.5*c.width,0,0),e.halfHeight.set(0,.5*c.height,0),e.halfWidth.applyMatrix4(s),e.halfHeight.applyMatrix4(s),p++}else if(c.isPointLight){const e=r.point[i];e.position.setFromMatrixPosition(c.matrixWorld),e.position.applyMatrix4(h),i++}else if(c.isHemisphereLight){const e=r.hemi[u];e.direction.setFromMatrixPosition(c.matrixWorld),e.direction.transformDirection(h),e.direction.normalize(),u++}}},state:r}}function qN(e,t){const n=new WN(e,t),i=[],r=[];return{init:function(){i.length=0,r.length=0},state:{lightsArray:i,shadowsArray:r,lights:n},setupLights:function(){n.setup(i)},setupLightsView:function(e){n.setupView(i,e)},pushLight:function(e){i.push(e)},pushShadow:function(e){r.push(e)}}}function JN(e,t){let n=new WeakMap;return{get:function(i,r=0){let o;return!1===n.has(i)?(o=new qN(e,t),n.set(i,[o])):r>=n.get(i).length?(o=new qN(e,t),n.get(i).push(o)):o=n.get(i)[r],o},dispose:function(){n=new WeakMap}}}class $N extends GM{constructor(e){super(),this.type="MeshDepthMaterial",this.depthPacking=3200,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}$N.prototype.isMeshDepthMaterial=!0;class XN extends GM{constructor(e){super(),this.type="MeshDistanceMaterial",this.referencePosition=new wE,this.nearDistance=1,this.farDistance=1e3,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.setValues(e)}copy(e){return super.copy(e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}function YN(e,t,n){let i=new WS;const r=new dE,o=new dE,a=new gE,s=[],l=[],p={},u=n.maxTextureSize,h={0:1,1:0,2:2},c=new kS({defines:{SAMPLE_RATE:2/8,HALF_SAMPLE_RATE:1/8},uniforms:{shadow_pass:{value:null},resolution:{value:new dE},radius:{value:4}},vertexShader:"void main() {\n\tgl_Position = vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy ) / resolution ) );\n\tfor ( float i = -1.0; i < 1.0 ; i += SAMPLE_RATE) {\n\t\t#ifdef HORIZONTAL_PASS\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( i, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, i ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean * HALF_SAMPLE_RATE;\n\tsquared_mean = squared_mean * HALF_SAMPLE_RATE;\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}"}),_=c.clone();_.defines.HORIZONTAL_PASS=1;const d=new cS;d.setAttribute("position",new eS(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const m=new NS(d,c),P=this;function f(n,i){const r=t.update(m);c.uniforms.shadow_pass.value=n.map.texture,c.uniforms.resolution.value=n.mapSize,c.uniforms.radius.value=n.radius,e.setRenderTarget(n.mapPass),e.clear(),e.renderBufferDirect(i,null,r,c,m,null),_.uniforms.shadow_pass.value=n.mapPass.texture,_.uniforms.resolution.value=n.mapSize,_.uniforms.radius.value=n.radius,e.setRenderTarget(n.map),e.clear(),e.renderBufferDirect(i,null,r,_,m,null)}function x(e,t,n){const i=e<<0|t<<1|n<<2;let r=s[i];return void 0===r&&(r=new $N({depthPacking:3201,morphTargets:e,skinning:t}),s[i]=r),r}function y(e,t,n){const i=e<<0|t<<1|n<<2;let r=l[i];return void 0===r&&(r=new XN({morphTargets:e,skinning:t}),l[i]=r),r}function v(t,n,i,r,o,a,s){let l=null,u=x,c=t.customDepthMaterial;if(!0===r.isPointLight&&(u=y,c=t.customDistanceMaterial),void 0===c){let e=!1;!0===i.morphTargets&&(e=n.morphAttributes&&n.morphAttributes.position&&n.morphAttributes.position.length>0);let r=!1;!0===t.isSkinnedMesh&&(!0===i.skinning?r=!0:console.warn("THREE.WebGLShadowMap: THREE.SkinnedMesh with material.skinning set to false:",t)),l=u(e,r,!0===t.isInstancedMesh)}else l=c;if(e.localClippingEnabled&&!0===i.clipShadows&&0!==i.clippingPlanes.length){const e=l.uuid,t=i.uuid;let n=p[e];void 0===n&&(n={},p[e]=n);let r=n[t];void 0===r&&(r=l.clone(),n[t]=r),l=r}return l.visible=i.visible,l.wireframe=i.wireframe,l.side=3===s?null!==i.shadowSide?i.shadowSide:i.side:null!==i.shadowSide?i.shadowSide:h[i.side],l.clipShadows=i.clipShadows,l.clippingPlanes=i.clippingPlanes,l.clipIntersection=i.clipIntersection,l.wireframeLinewidth=i.wireframeLinewidth,l.linewidth=i.linewidth,!0===r.isPointLight&&!0===l.isMeshDistanceMaterial&&(l.referencePosition.setFromMatrixPosition(r.matrixWorld),l.nearDistance=o,l.farDistance=a),l}function g(n,r,o,a,s){if(!1===n.visible)return;if(n.layers.test(r.layers)&&(n.isMesh||n.isLine||n.isPoints)&&(n.castShadow||n.receiveShadow&&3===s)&&(!n.frustumCulled||i.intersectsObject(n))){n.modelViewMatrix.multiplyMatrices(o.matrixWorldInverse,n.matrixWorld);const i=t.update(n),r=n.material;if(Array.isArray(r)){const t=i.groups;for(let l=0,p=t.length;l<p;l++){const p=t[l],u=r[p.materialIndex];if(u&&u.visible){const t=v(n,i,u,a,o.near,o.far,s);e.renderBufferDirect(o,null,i,t,n,p)}}}else if(r.visible){const t=v(n,i,r,a,o.near,o.far,s);e.renderBufferDirect(o,null,i,t,n,null)}}const l=n.children;for(let e=0,t=l.length;e<t;e++)g(l[e],r,o,a,s)}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=1,this.render=function(t,n,s){if(!1===P.enabled)return;if(!1===P.autoUpdate&&!1===P.needsUpdate)return;if(0===t.length)return;const l=e.getRenderTarget(),p=e.getActiveCubeFace(),h=e.getActiveMipmapLevel(),c=e.state;c.setBlending(0),c.buffers.color.setClear(1,1,1,1),c.buffers.depth.setTest(!0),c.setScissorTest(!1);for(let l=0,p=t.length;l<p;l++){const p=t[l],h=p.shadow;if(void 0===h){console.warn("THREE.WebGLShadowMap:",p,"has no shadow.");continue}if(!1===h.autoUpdate&&!1===h.needsUpdate)continue;r.copy(h.mapSize);const _=h.getFrameExtents();if(r.multiply(_),o.copy(h.mapSize),(r.x>u||r.y>u)&&(r.x>u&&(o.x=Math.floor(u/_.x),r.x=o.x*_.x,h.mapSize.x=o.x),r.y>u&&(o.y=Math.floor(u/_.y),r.y=o.y*_.y,h.mapSize.y=o.y)),null===h.map&&!h.isPointLightShadow&&3===this.type){const e={minFilter:OZ,magFilter:OZ,format:jZ};h.map=new bE(r.x,r.y,e),h.map.texture.name=p.name+".shadowMap",h.mapPass=new bE(r.x,r.y,e),h.camera.updateProjectionMatrix()}if(null===h.map){const e={minFilter:IZ,magFilter:IZ,format:jZ};h.map=new bE(r.x,r.y,e),h.map.texture.name=p.name+".shadowMap",h.camera.updateProjectionMatrix()}e.setRenderTarget(h.map),e.clear();const d=h.getViewportCount();for(let e=0;e<d;e++){const t=h.getViewport(e);a.set(o.x*t.x,o.y*t.y,o.x*t.z,o.y*t.w),c.viewport(a),h.updateMatrices(p,e),i=h.getFrustum(),g(n,s,h.camera,p,this.type)}h.isPointLightShadow||3!==this.type||f(h,s),h.needsUpdate=!1}P.needsUpdate=!1,e.setRenderTarget(l,p,h)}}function KN(e,t,n){const i=n.isWebGL2,r=new function(){let t=!1;const n=new gE;let i=null;const r=new gE(0,0,0,0);return{setMask:function(n){i===n||t||(e.colorMask(n,n,n,n),i=n)},setLocked:function(e){t=e},setClear:function(t,i,o,a,s){!0===s&&(t*=a,i*=a,o*=a),n.set(t,i,o,a),!1===r.equals(n)&&(e.clearColor(t,i,o,a),r.copy(n))},reset:function(){t=!1,i=null,r.set(-1,0,0,0)}}},o=new function(){let t=!1,n=null,i=null,r=null;return{setTest:function(e){e?V(2929):k(2929)},setMask:function(i){n===i||t||(e.depthMask(i),n=i)},setFunc:function(t){if(i!==t){if(t)switch(t){case 0:e.depthFunc(512);break;case 1:e.depthFunc(519);break;case 2:e.depthFunc(513);break;case 3:default:e.depthFunc(515);break;case 4:e.depthFunc(514);break;case 5:e.depthFunc(518);break;case 6:e.depthFunc(516);break;case 7:e.depthFunc(517)}else e.depthFunc(515);i=t}},setLocked:function(e){t=e},setClear:function(t){r!==t&&(e.clearDepth(t),r=t)},reset:function(){t=!1,n=null,i=null,r=null}}},a=new function(){let t=!1,n=null,i=null,r=null,o=null,a=null,s=null,l=null,p=null;return{setTest:function(e){t||(e?V(2960):k(2960))},setMask:function(i){n===i||t||(e.stencilMask(i),n=i)},setFunc:function(t,n,a){i===t&&r===n&&o===a||(e.stencilFunc(t,n,a),i=t,r=n,o=a)},setOp:function(t,n,i){a===t&&s===n&&l===i||(e.stencilOp(t,n,i),a=t,s=n,l=i)},setLocked:function(e){t=e},setClear:function(t){p!==t&&(e.clearStencil(t),p=t)},reset:function(){t=!1,n=null,i=null,r=null,o=null,a=null,s=null,l=null,p=null}}};let s={},l=null,p={},u=null,h=!1,c=null,_=null,d=null,m=null,P=null,f=null,x=null,y=!1,v=null,g=null,b=null,z=null,w=null;const Z=e.getParameter(35661);let E=!1,M=0;const S=e.getParameter(7938);-1!==S.indexOf("WebGL")?(M=parseFloat(/^WebGL (\d)/.exec(S)[1]),E=M>=1):-1!==S.indexOf("OpenGL ES")&&(M=parseFloat(/^OpenGL ES (\d)/.exec(S)[1]),E=M>=2);let C=null,N={};const A=new gE(0,0,e.canvas.width,e.canvas.height),L=new gE(0,0,e.canvas.width,e.canvas.height);function B(t,n,i){const r=new Uint8Array(4),o=e.createTexture();e.bindTexture(t,o),e.texParameteri(t,10241,9728),e.texParameteri(t,10240,9728);for(let t=0;t<i;t++)e.texImage2D(n+t,0,6408,1,1,0,6408,5121,r);return o}const T={};function V(t){!0!==s[t]&&(e.enable(t),s[t]=!0)}function k(t){!1!==s[t]&&(e.disable(t),s[t]=!1)}T[3553]=B(3553,3553,1),T[34067]=B(34067,34069,6),r.setClear(0,0,0,1),o.setClear(1),a.setClear(0),V(2929),o.setFunc(3),H(!1),F(1),V(2884),R(0);const I={[BZ]:32774,101:32778,102:32779};if(i)I[103]=32775,I[104]=32776;else{const e=t.get("EXT_blend_minmax");null!==e&&(I[103]=e.MIN_EXT,I[104]=e.MAX_EXT)}const O={200:0,201:1,202:768,204:770,210:776,208:774,206:772,203:769,205:771,209:775,207:773};function R(t,n,i,r,o,a,s,l){if(0!==t){if(!1===h&&(V(3042),h=!0),5===t)o=o||n,a=a||i,s=s||r,n===_&&o===P||(e.blendEquationSeparate(I[n],I[o]),_=n,P=o),i===d&&r===m&&a===f&&s===x||(e.blendFuncSeparate(O[i],O[r],O[a],O[s]),d=i,m=r,f=a,x=s),c=t,y=null;else if(t!==c||l!==y){if(_===BZ&&P===BZ||(e.blendEquation(32774),_=BZ,P=BZ),l)switch(t){case 1:e.blendFuncSeparate(1,771,1,771);break;case 2:e.blendFunc(1,1);break;case 3:e.blendFuncSeparate(0,0,769,771);break;case 4:e.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}else switch(t){case 1:e.blendFuncSeparate(770,771,1,771);break;case 2:e.blendFunc(770,1);break;case 3:e.blendFunc(0,769);break;case 4:e.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}d=null,m=null,f=null,x=null,c=t,y=l}}else!0===h&&(k(3042),h=!1)}function H(t){v!==t&&(t?e.frontFace(2304):e.frontFace(2305),v=t)}function F(t){0!==t?(V(2884),t!==g&&(1===t?e.cullFace(1029):2===t?e.cullFace(1028):e.cullFace(1032))):k(2884),g=t}function D(t,n,i){t?(V(32823),z===n&&w===i||(e.polygonOffset(n,i),z=n,w=i)):k(32823)}function G(t){void 0===t&&(t=33984+Z-1),C!==t&&(e.activeTexture(t),C=t)}return{buffers:{color:r,depth:o,stencil:a},enable:V,disable:k,bindFramebuffer:function(t,n){null===n&&null!==l&&(n=l),p[t]!==n&&(e.bindFramebuffer(t,n),p[t]=n,i&&(36009===t&&(p[36160]=n),36160===t&&(p[36009]=n)))},bindXRFramebuffer:function(t){t!==l&&(e.bindFramebuffer(36160,t),l=t)},useProgram:function(t){return u!==t&&(e.useProgram(t),u=t,!0)},setBlending:R,setMaterial:function(e,t){2===e.side?k(2884):V(2884);let n=1===e.side;t&&(n=!n),H(n),1===e.blending&&!1===e.transparent?R(0):R(e.blending,e.blendEquation,e.blendSrc,e.blendDst,e.blendEquationAlpha,e.blendSrcAlpha,e.blendDstAlpha,e.premultipliedAlpha),o.setFunc(e.depthFunc),o.setTest(e.depthTest),o.setMask(e.depthWrite),r.setMask(e.colorWrite);const i=e.stencilWrite;a.setTest(i),i&&(a.setMask(e.stencilWriteMask),a.setFunc(e.stencilFunc,e.stencilRef,e.stencilFuncMask),a.setOp(e.stencilFail,e.stencilZFail,e.stencilZPass)),D(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits),!0===e.alphaToCoverage?V(32926):k(32926)},setFlipSided:H,setCullFace:F,setLineWidth:function(t){t!==b&&(E&&e.lineWidth(t),b=t)},setPolygonOffset:D,setScissorTest:function(e){e?V(3089):k(3089)},activeTexture:G,bindTexture:function(t,n){null===C&&G();let i=N[C];void 0===i&&(i={type:void 0,texture:void 0},N[C]=i),i.type===t&&i.texture===n||(e.bindTexture(t,n||T[t]),i.type=t,i.texture=n)},unbindTexture:function(){const t=N[C];void 0!==t&&void 0!==t.type&&(e.bindTexture(t.type,null),t.type=void 0,t.texture=void 0)},compressedTexImage2D:function(){try{e.compressedTexImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage2D:function(){try{e.texImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage3D:function(){try{e.texImage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},scissor:function(t){!1===A.equals(t)&&(e.scissor(t.x,t.y,t.z,t.w),A.copy(t))},viewport:function(t){!1===L.equals(t)&&(e.viewport(t.x,t.y,t.z,t.w),L.copy(t))},reset:function(){e.disable(3042),e.disable(2884),e.disable(2929),e.disable(32823),e.disable(3089),e.disable(2960),e.disable(32926),e.blendEquation(32774),e.blendFunc(1,0),e.blendFuncSeparate(1,0,1,0),e.colorMask(!0,!0,!0,!0),e.clearColor(0,0,0,0),e.depthMask(!0),e.depthFunc(513),e.clearDepth(1),e.stencilMask(4294967295),e.stencilFunc(519,0,4294967295),e.stencilOp(7680,7680,7680),e.clearStencil(0),e.cullFace(1029),e.frontFace(2305),e.polygonOffset(0,0),e.activeTexture(33984),e.bindFramebuffer(36160,null),!0===i&&(e.bindFramebuffer(36009,null),e.bindFramebuffer(36008,null)),e.useProgram(null),e.lineWidth(1),e.scissor(0,0,e.canvas.width,e.canvas.height),e.viewport(0,0,e.canvas.width,e.canvas.height),s={},C=null,N={},l=null,p={},u=null,h=!1,c=null,_=null,d=null,m=null,P=null,f=null,x=null,y=!1,v=null,g=null,b=null,z=null,w=null,A.set(0,0,e.canvas.width,e.canvas.height),L.set(0,0,e.canvas.width,e.canvas.height),r.reset(),o.reset(),a.reset()}}}function QN(e,t,n,i,r,o,a){const s=r.isWebGL2,l=r.maxTextures,p=r.maxCubemapSize,u=r.maxTextureSize,h=r.maxSamples,c=new WeakMap;let _,d=!1;try{d="undefined"!=typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(e){}function m(e,t){return d?new OffscreenCanvas(e,t):document.createElementNS("http://www.w3.org/1999/xhtml","canvas")}function P(e,t,n,i){let r=1;if((e.width>i||e.height>i)&&(r=i/Math.max(e.width,e.height)),r<1||!0===t){if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap){const i=t?_E:Math.floor,o=i(r*e.width),a=i(r*e.height);void 0===_&&(_=m(o,a));const s=n?m(o,a):_;return s.width=o,s.height=a,s.getContext("2d").drawImage(e,0,0,o,a),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+e.width+"x"+e.height+") to ("+o+"x"+a+")."),s}return"data"in e&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+e.width+"x"+e.height+")."),e}return e}function f(e){return cE(e.width)&&cE(e.height)}function x(e,t){return e.generateMipmaps&&t&&e.minFilter!==IZ&&e.minFilter!==OZ}function y(t,n,r,o){e.generateMipmap(t),i.get(n).__maxMipLevel=Math.log2(Math.max(r,o))}function v(n,i,r){if(!1===s)return i;if(null!==n){if(void 0!==e[n])return e[n];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+n+"'")}let o=i;return 6403===i&&(5126===r&&(o=33326),5131===r&&(o=33325),5121===r&&(o=33321)),6407===i&&(5126===r&&(o=34837),5131===r&&(o=34843),5121===r&&(o=32849)),6408===i&&(5126===r&&(o=34836),5131===r&&(o=34842),5121===r&&(o=32856)),33325!==o&&33326!==o&&34842!==o&&34836!==o||t.get("EXT_color_buffer_float"),o}function g(e){return e===IZ||1004===e||1005===e?9728:9729}function b(t){const n=t.target;n.removeEventListener("dispose",b),function(t){const n=i.get(t);void 0!==n.__webglInit&&(e.deleteTexture(n.__webglTexture),i.remove(t))}(n),n.isVideoTexture&&c.delete(n),a.memory.textures--}function z(t){const n=t.target;n.removeEventListener("dispose",z),function(t){const n=t.texture,r=i.get(t),o=i.get(n);if(t){if(void 0!==o.__webglTexture&&e.deleteTexture(o.__webglTexture),t.depthTexture&&t.depthTexture.dispose(),t.isWebGLCubeRenderTarget)for(let t=0;t<6;t++)e.deleteFramebuffer(r.__webglFramebuffer[t]),r.__webglDepthbuffer&&e.deleteRenderbuffer(r.__webglDepthbuffer[t]);else e.deleteFramebuffer(r.__webglFramebuffer),r.__webglDepthbuffer&&e.deleteRenderbuffer(r.__webglDepthbuffer),r.__webglMultisampledFramebuffer&&e.deleteFramebuffer(r.__webglMultisampledFramebuffer),r.__webglColorRenderbuffer&&e.deleteRenderbuffer(r.__webglColorRenderbuffer),r.__webglDepthRenderbuffer&&e.deleteRenderbuffer(r.__webglDepthRenderbuffer);i.remove(n),i.remove(t)}}(n),a.memory.textures--}let w=0;function Z(e,t){const r=i.get(e);if(e.isVideoTexture&&function(e){const t=a.render.frame;c.get(e)!==t&&(c.set(e,t),e.update())}(e),e.version>0&&r.__version!==e.version){const n=e.image;if(void 0===n)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined");else{if(!1!==n.complete)return void A(r,e,t);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}n.activeTexture(33984+t),n.bindTexture(3553,r.__webglTexture)}function E(t,r){const a=i.get(t);t.version>0&&a.__version!==t.version?function(t,i,r){if(6!==i.image.length)return;N(t,i),n.activeTexture(33984+r),n.bindTexture(34067,t.__webglTexture),e.pixelStorei(37440,i.flipY),e.pixelStorei(37441,i.premultiplyAlpha),e.pixelStorei(3317,i.unpackAlignment),e.pixelStorei(37443,0);const a=i&&(i.isCompressedTexture||i.image[0].isCompressedTexture),l=i.image[0]&&i.image[0].isDataTexture,u=[];for(let e=0;e<6;e++)u[e]=a||l?l?i.image[e].image:i.image[e]:P(i.image[e],!1,!0,p);const h=u[0],c=f(h)||s,_=o.convert(i.format),d=o.convert(i.type),m=v(i.internalFormat,_,d);let g;if(C(34067,i,c),a){for(let e=0;e<6;e++){g=u[e].mipmaps;for(let t=0;t<g.length;t++){const r=g[t];i.format!==jZ&&i.format!==UZ?null!==_?n.compressedTexImage2D(34069+e,t,m,r.width,r.height,0,r.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):n.texImage2D(34069+e,t,m,r.width,r.height,0,_,d,r.data)}}t.__maxMipLevel=g.length-1}else{g=i.mipmaps;for(let e=0;e<6;e++)if(l){n.texImage2D(34069+e,0,m,u[e].width,u[e].height,0,_,d,u[e].data);for(let t=0;t<g.length;t++){const i=g[t].image[e].image;n.texImage2D(34069+e,t+1,m,i.width,i.height,0,_,d,i.data)}}else{n.texImage2D(34069+e,0,m,_,d,u[e]);for(let t=0;t<g.length;t++){const i=g[t];n.texImage2D(34069+e,t+1,m,_,d,i.image[e])}}t.__maxMipLevel=g.length}x(i,c)&&y(34067,i,h.width,h.height),t.__version=i.version,i.onUpdate&&i.onUpdate(i)}(a,t,r):(n.activeTexture(33984+r),n.bindTexture(34067,a.__webglTexture))}const M={[TZ]:10497,[VZ]:33071,[kZ]:33648},S={[IZ]:9728,1004:9984,1005:9986,[OZ]:9729,1007:9985,1008:9987};function C(n,o,a){if(a?(e.texParameteri(n,10242,M[o.wrapS]),e.texParameteri(n,10243,M[o.wrapT]),32879!==n&&35866!==n||e.texParameteri(n,32882,M[o.wrapR]),e.texParameteri(n,10240,S[o.magFilter]),e.texParameteri(n,10241,S[o.minFilter])):(e.texParameteri(n,10242,33071),e.texParameteri(n,10243,33071),32879!==n&&35866!==n||e.texParameteri(n,32882,33071),o.wrapS===VZ&&o.wrapT===VZ||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),e.texParameteri(n,10240,g(o.magFilter)),e.texParameteri(n,10241,g(o.minFilter)),o.minFilter!==IZ&&o.minFilter!==OZ&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),!0===t.has("EXT_texture_filter_anisotropic")){const a=t.get("EXT_texture_filter_anisotropic");if(o.type===FZ&&!1===t.has("OES_texture_float_linear"))return;if(!1===s&&o.type===DZ&&!1===t.has("OES_texture_half_float_linear"))return;(o.anisotropy>1||i.get(o).__currentAnisotropy)&&(e.texParameterf(n,a.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(o.anisotropy,r.getMaxAnisotropy())),i.get(o).__currentAnisotropy=o.anisotropy)}}function N(t,n){void 0===t.__webglInit&&(t.__webglInit=!0,n.addEventListener("dispose",b),t.__webglTexture=e.createTexture(),a.memory.textures++)}function A(t,i,r){let a=3553;i.isDataTexture2DArray&&(a=35866),i.isDataTexture3D&&(a=32879),N(t,i),n.activeTexture(33984+r),n.bindTexture(a,t.__webglTexture),e.pixelStorei(37440,i.flipY),e.pixelStorei(37441,i.premultiplyAlpha),e.pixelStorei(3317,i.unpackAlignment),e.pixelStorei(37443,0);const l=function(e){return!s&&(e.wrapS!==VZ||e.wrapT!==VZ||e.minFilter!==IZ&&e.minFilter!==OZ)}(i)&&!1===f(i.image),p=P(i.image,l,!1,u),h=f(p)||s,c=o.convert(i.format);let _,d=o.convert(i.type),m=v(i.internalFormat,c,d);C(a,i,h);const g=i.mipmaps;if(i.isDepthTexture)m=6402,s?m=i.type===FZ?36012:i.type===HZ?33190:i.type===GZ?35056:33189:i.type===FZ&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),i.format===WZ&&6402===m&&i.type!==RZ&&i.type!==HZ&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),i.type=RZ,d=o.convert(i.type)),i.format===qZ&&6402===m&&(m=34041,i.type!==GZ&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),i.type=GZ,d=o.convert(i.type))),n.texImage2D(3553,0,m,p.width,p.height,0,c,d,null);else if(i.isDataTexture)if(g.length>0&&h){for(let e=0,t=g.length;e<t;e++)_=g[e],n.texImage2D(3553,e,m,_.width,_.height,0,c,d,_.data);i.generateMipmaps=!1,t.__maxMipLevel=g.length-1}else n.texImage2D(3553,0,m,p.width,p.height,0,c,d,p.data),t.__maxMipLevel=0;else if(i.isCompressedTexture){for(let e=0,t=g.length;e<t;e++)_=g[e],i.format!==jZ&&i.format!==UZ?null!==c?n.compressedTexImage2D(3553,e,m,_.width,_.height,0,_.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):n.texImage2D(3553,e,m,_.width,_.height,0,c,d,_.data);t.__maxMipLevel=g.length-1}else if(i.isDataTexture2DArray)n.texImage3D(35866,0,m,p.width,p.height,p.depth,0,c,d,p.data),t.__maxMipLevel=0;else if(i.isDataTexture3D)n.texImage3D(32879,0,m,p.width,p.height,p.depth,0,c,d,p.data),t.__maxMipLevel=0;else if(g.length>0&&h){for(let e=0,t=g.length;e<t;e++)_=g[e],n.texImage2D(3553,e,m,c,d,_);i.generateMipmaps=!1,t.__maxMipLevel=g.length-1}else n.texImage2D(3553,0,m,c,d,p),t.__maxMipLevel=0;x(i,h)&&y(a,i,p.width,p.height),t.__version=i.version,i.onUpdate&&i.onUpdate(i)}function L(t,r,a,s){const l=r.texture,p=o.convert(l.format),u=o.convert(l.type),h=v(l.internalFormat,p,u);32879===s||35866===s?n.texImage3D(s,0,h,r.width,r.height,r.depth,0,p,u,null):n.texImage2D(s,0,h,r.width,r.height,0,p,u,null),n.bindFramebuffer(36160,t),e.framebufferTexture2D(36160,a,s,i.get(l).__webglTexture,0),n.bindFramebuffer(36160,null)}function B(t,n,i){if(e.bindRenderbuffer(36161,t),n.depthBuffer&&!n.stencilBuffer){let r=33189;if(i){const t=n.depthTexture;t&&t.isDepthTexture&&(t.type===FZ?r=36012:t.type===HZ&&(r=33190));const i=T(n);e.renderbufferStorageMultisample(36161,i,r,n.width,n.height)}else e.renderbufferStorage(36161,r,n.width,n.height);e.framebufferRenderbuffer(36160,36096,36161,t)}else if(n.depthBuffer&&n.stencilBuffer){if(i){const t=T(n);e.renderbufferStorageMultisample(36161,t,35056,n.width,n.height)}else e.renderbufferStorage(36161,34041,n.width,n.height);e.framebufferRenderbuffer(36160,33306,36161,t)}else{const t=n.texture,r=o.convert(t.format),a=o.convert(t.type),s=v(t.internalFormat,r,a);if(i){const t=T(n);e.renderbufferStorageMultisample(36161,t,s,n.width,n.height)}else e.renderbufferStorage(36161,s,n.width,n.height)}e.bindRenderbuffer(36161,null)}function T(e){return s&&e.isWebGLMultisampleRenderTarget?Math.min(h,e.samples):0}let V=!1,k=!1;this.allocateTextureUnit=function(){const e=w;return e>=l&&console.warn("THREE.WebGLTextures: Trying to use "+e+" texture units while this GPU supports only "+l),w+=1,e},this.resetTextureUnits=function(){w=0},this.setTexture2D=Z,this.setTexture2DArray=function(e,t){const r=i.get(e);e.version>0&&r.__version!==e.version?A(r,e,t):(n.activeTexture(33984+t),n.bindTexture(35866,r.__webglTexture))},this.setTexture3D=function(e,t){const r=i.get(e);e.version>0&&r.__version!==e.version?A(r,e,t):(n.activeTexture(33984+t),n.bindTexture(32879,r.__webglTexture))},this.setTextureCube=E,this.setupRenderTarget=function(t){const r=t.texture,l=i.get(t),p=i.get(r);t.addEventListener("dispose",z),p.__webglTexture=e.createTexture(),p.__version=r.version,a.memory.textures++;const u=!0===t.isWebGLCubeRenderTarget,h=!0===t.isWebGLMultisampleRenderTarget,c=r.isDataTexture3D||r.isDataTexture2DArray,_=f(t)||s;if(!s||r.format!==UZ||r.type!==FZ&&r.type!==DZ||(r.format=jZ,console.warn("THREE.WebGLRenderer: Rendering to textures with RGB format is not supported. Using RGBA format instead.")),u){l.__webglFramebuffer=[];for(let t=0;t<6;t++)l.__webglFramebuffer[t]=e.createFramebuffer()}else if(l.__webglFramebuffer=e.createFramebuffer(),h)if(s){l.__webglMultisampledFramebuffer=e.createFramebuffer(),l.__webglColorRenderbuffer=e.createRenderbuffer(),e.bindRenderbuffer(36161,l.__webglColorRenderbuffer);const i=o.convert(r.format),a=o.convert(r.type),s=v(r.internalFormat,i,a),p=T(t);e.renderbufferStorageMultisample(36161,p,s,t.width,t.height),n.bindFramebuffer(36160,l.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(36160,36064,36161,l.__webglColorRenderbuffer),e.bindRenderbuffer(36161,null),t.depthBuffer&&(l.__webglDepthRenderbuffer=e.createRenderbuffer(),B(l.__webglDepthRenderbuffer,t,!0)),n.bindFramebuffer(36160,null)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.");if(u){n.bindTexture(34067,p.__webglTexture),C(34067,r,_);for(let e=0;e<6;e++)L(l.__webglFramebuffer[e],t,36064,34069+e);x(r,_)&&y(34067,r,t.width,t.height),n.bindTexture(34067,null)}else{let e=3553;c&&(s?e=r.isDataTexture3D?32879:35866:console.warn("THREE.DataTexture3D and THREE.DataTexture2DArray only supported with WebGL2.")),n.bindTexture(e,p.__webglTexture),C(e,r,_),L(l.__webglFramebuffer,t,36064,e),x(r,_)&&y(3553,r,t.width,t.height),n.bindTexture(3553,null)}t.depthBuffer&&function(t){const r=i.get(t),o=!0===t.isWebGLCubeRenderTarget;if(t.depthTexture){if(o)throw new Error("target.depthTexture not supported in Cube render targets");!function(t,r){if(r&&r.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(n.bindFramebuffer(36160,t),!r.depthTexture||!r.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");i.get(r.depthTexture).__webglTexture&&r.depthTexture.image.width===r.width&&r.depthTexture.image.height===r.height||(r.depthTexture.image.width=r.width,r.depthTexture.image.height=r.height,r.depthTexture.needsUpdate=!0),Z(r.depthTexture,0);const o=i.get(r.depthTexture).__webglTexture;if(r.depthTexture.format===WZ)e.framebufferTexture2D(36160,36096,3553,o,0);else{if(r.depthTexture.format!==qZ)throw new Error("Unknown depthTexture format");e.framebufferTexture2D(36160,33306,3553,o,0)}}(r.__webglFramebuffer,t)}else if(o){r.__webglDepthbuffer=[];for(let i=0;i<6;i++)n.bindFramebuffer(36160,r.__webglFramebuffer[i]),r.__webglDepthbuffer[i]=e.createRenderbuffer(),B(r.__webglDepthbuffer[i],t,!1)}else n.bindFramebuffer(36160,r.__webglFramebuffer),r.__webglDepthbuffer=e.createRenderbuffer(),B(r.__webglDepthbuffer,t,!1);n.bindFramebuffer(36160,null)}(t)},this.updateRenderTargetMipmap=function(e){const t=e.texture;if(x(t,f(e)||s)){const r=e.isWebGLCubeRenderTarget?34067:3553,o=i.get(t).__webglTexture;n.bindTexture(r,o),y(r,t,e.width,e.height),n.bindTexture(r,null)}},this.updateMultisampleRenderTarget=function(t){if(t.isWebGLMultisampleRenderTarget)if(s){const r=t.width,o=t.height;let a=16384;t.depthBuffer&&(a|=256),t.stencilBuffer&&(a|=1024);const s=i.get(t);n.bindFramebuffer(36008,s.__webglMultisampledFramebuffer),n.bindFramebuffer(36009,s.__webglFramebuffer),e.blitFramebuffer(0,0,r,o,0,0,r,o,a,9728),n.bindFramebuffer(36008,null),n.bindFramebuffer(36009,s.__webglMultisampledFramebuffer)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.")},this.safeSetTexture2D=function(e,t){e&&e.isWebGLRenderTarget&&(!1===V&&(console.warn("THREE.WebGLTextures.safeSetTexture2D: don't use render targets as textures. Use their .texture property instead."),V=!0),e=e.texture),Z(e,t)},this.safeSetTextureCube=function(e,t){e&&e.isWebGLCubeRenderTarget&&(!1===k&&(console.warn("THREE.WebGLTextures.safeSetTextureCube: don't use cube render targets as textures. Use their .texture property instead."),k=!0),e=e.texture),E(e,t)}}function eA(e,t,n){const i=n.isWebGL2;return{convert:function(e){let n;if(1009===e)return 5121;if(1017===e)return 32819;if(1018===e)return 32820;if(1019===e)return 33635;if(1010===e)return 5120;if(1011===e)return 5122;if(e===RZ)return 5123;if(1013===e)return 5124;if(e===HZ)return 5125;if(e===FZ)return 5126;if(e===DZ)return i?5131:(n=t.get("OES_texture_half_float"),null!==n?n.HALF_FLOAT_OES:null);if(1021===e)return 6406;if(e===UZ)return 6407;if(e===jZ)return 6408;if(1024===e)return 6409;if(1025===e)return 6410;if(e===WZ)return 6402;if(e===qZ)return 34041;if(1028===e)return 6403;if(1029===e)return 36244;if(1030===e)return 33319;if(1031===e)return 33320;if(1032===e)return 36248;if(1033===e)return 36249;if(33776===e||33777===e||33778===e||33779===e){if(n=t.get("WEBGL_compressed_texture_s3tc"),null===n)return null;if(33776===e)return n.COMPRESSED_RGB_S3TC_DXT1_EXT;if(33777===e)return n.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(33778===e)return n.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(33779===e)return n.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(35840===e||35841===e||35842===e||35843===e){if(n=t.get("WEBGL_compressed_texture_pvrtc"),null===n)return null;if(35840===e)return n.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(35841===e)return n.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(35842===e)return n.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(35843===e)return n.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(36196===e)return n=t.get("WEBGL_compressed_texture_etc1"),null!==n?n.COMPRESSED_RGB_ETC1_WEBGL:null;if((37492===e||37496===e)&&(n=t.get("WEBGL_compressed_texture_etc"),null!==n)){if(37492===e)return n.COMPRESSED_RGB8_ETC2;if(37496===e)return n.COMPRESSED_RGBA8_ETC2_EAC}return 37808===e||37809===e||37810===e||37811===e||37812===e||37813===e||37814===e||37815===e||37816===e||37817===e||37818===e||37819===e||37820===e||37821===e||37840===e||37841===e||37842===e||37843===e||37844===e||37845===e||37846===e||37847===e||37848===e||37849===e||37850===e||37851===e||37852===e||37853===e?(n=t.get("WEBGL_compressed_texture_astc"),null!==n?e:null):36492===e?(n=t.get("EXT_texture_compression_bptc"),null!==n?e:null):e===GZ?i?34042:(n=t.get("WEBGL_depth_texture"),null!==n?n.UNSIGNED_INT_24_8_WEBGL:null):void 0}}}XN.prototype.isMeshDistanceMaterial=!0;class tA extends OS{constructor(e=[]){super(),this.cameras=e}}tA.prototype.isArrayCamera=!0;class nA extends EM{constructor(){super(),this.type="Group"}}nA.prototype.isGroup=!0;const iA={type:"move"};class rA{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return null===this._hand&&(this._hand=new nA,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return null===this._targetRay&&(this._targetRay=new nA,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new wE,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new wE),this._targetRay}getGripSpace(){return null===this._grip&&(this._grip=new nA,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new wE,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new wE),this._grip}dispatchEvent(e){return null!==this._targetRay&&this._targetRay.dispatchEvent(e),null!==this._grip&&this._grip.dispatchEvent(e),null!==this._hand&&this._hand.dispatchEvent(e),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this}update(e,t,n){let i=null,r=null,o=null;const a=this._targetRay,s=this._grip,l=this._hand;if(e&&"visible-blurred"!==t.session.visibilityState)if(null!==a&&(i=t.getPose(e.targetRaySpace,n),null!==i&&(a.matrix.fromArray(i.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),i.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(i.linearVelocity)):a.hasLinearVelocity=!1,i.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(i.angularVelocity)):a.hasAngularVelocity=!1,this.dispatchEvent(iA))),l&&e.hand){o=!0;for(const i of e.hand.values()){const e=t.getJointPose(i,n);if(void 0===l.joints[i.jointName]){const e=new nA;e.matrixAutoUpdate=!1,e.visible=!1,l.joints[i.jointName]=e,l.add(e)}const r=l.joints[i.jointName];null!==e&&(r.matrix.fromArray(e.transform.matrix),r.matrix.decompose(r.position,r.rotation,r.scale),r.jointRadius=e.radius),r.visible=null!==e}const i=l.joints["index-finger-tip"],r=l.joints["thumb-tip"],a=i.position.distanceTo(r.position),s=.02,p=.005;l.inputState.pinching&&a>s+p?(l.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!l.inputState.pinching&&a<=s-p&&(l.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else null!==s&&e.gripSpace&&(r=t.getPose(e.gripSpace,n),null!==r&&(s.matrix.fromArray(r.transform.matrix),s.matrix.decompose(s.position,s.rotation,s.scale),r.linearVelocity?(s.hasLinearVelocity=!0,s.linearVelocity.copy(r.linearVelocity)):s.hasLinearVelocity=!1,r.angularVelocity?(s.hasAngularVelocity=!0,s.angularVelocity.copy(r.angularVelocity)):s.hasAngularVelocity=!1));return null!==a&&(a.visible=null!==i),null!==s&&(s.visible=null!==r),null!==l&&(l.visible=null!==o),this}}class oA extends oE{constructor(e,t){super();const n=this,i=e.state;let r=null,o=1,a=null,s="local-floor",l=null;const p=[],u=new Map,h=new OS;h.layers.enable(1),h.viewport=new gE;const c=new OS;c.layers.enable(2),c.viewport=new gE;const _=[h,c],d=new tA;d.layers.enable(1),d.layers.enable(2);let m=null,P=null;function f(e){const t=u.get(e.inputSource);t&&t.dispatchEvent({type:e.type,data:e.inputSource})}function x(){u.forEach((function(e,t){e.disconnect(t)})),u.clear(),m=null,P=null,i.bindXRFramebuffer(null),e.setRenderTarget(e.getRenderTarget()),w.stop(),n.isPresenting=!1,n.dispatchEvent({type:"sessionend"})}function y(e){const t=r.inputSources;for(let e=0;e<p.length;e++)u.set(t[e],p[e]);for(let t=0;t<e.removed.length;t++){const n=e.removed[t],i=u.get(n);i&&(i.dispatchEvent({type:"disconnected",data:n}),u.delete(n))}for(let t=0;t<e.added.length;t++){const n=e.added[t],i=u.get(n);i&&i.dispatchEvent({type:"connected",data:n})}}this.enabled=!1,this.isPresenting=!1,this.getController=function(e){let t=p[e];return void 0===t&&(t=new rA,p[e]=t),t.getTargetRaySpace()},this.getControllerGrip=function(e){let t=p[e];return void 0===t&&(t=new rA,p[e]=t),t.getGripSpace()},this.getHand=function(e){let t=p[e];return void 0===t&&(t=new rA,p[e]=t),t.getHandSpace()},this.setFramebufferScaleFactor=function(e){o=e,!0===n.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(e){s=e,!0===n.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return a},this.getSession=function(){return r},this.setSession=async function(e){if(r=e,null!==r){r.addEventListener("select",f),r.addEventListener("selectstart",f),r.addEventListener("selectend",f),r.addEventListener("squeeze",f),r.addEventListener("squeezestart",f),r.addEventListener("squeezeend",f),r.addEventListener("end",x),r.addEventListener("inputsourceschange",y);const e=t.getContextAttributes();!0!==e.xrCompatible&&await t.makeXRCompatible();const i={antialias:e.antialias,alpha:e.alpha,depth:e.depth,stencil:e.stencil,framebufferScaleFactor:o},l=new XRWebGLLayer(r,t,i);r.updateRenderState({baseLayer:l}),a=await r.requestReferenceSpace(s),w.setContext(r),w.start(),n.isPresenting=!0,n.dispatchEvent({type:"sessionstart"})}};const v=new wE,g=new wE;function b(e,t){null===t?e.matrixWorld.copy(e.matrix):e.matrixWorld.multiplyMatrices(t.matrixWorld,e.matrix),e.matrixWorldInverse.copy(e.matrixWorld).invert()}this.getCamera=function(e){d.near=c.near=h.near=e.near,d.far=c.far=h.far=e.far,m===d.near&&P===d.far||(r.updateRenderState({depthNear:d.near,depthFar:d.far}),m=d.near,P=d.far);const t=e.parent,n=d.cameras;b(d,t);for(let e=0;e<n.length;e++)b(n[e],t);e.matrixWorld.copy(d.matrixWorld),e.matrix.copy(d.matrix),e.matrix.decompose(e.position,e.quaternion,e.scale);const i=e.children;for(let e=0,t=i.length;e<t;e++)i[e].updateMatrixWorld(!0);return 2===n.length?function(e,t,n){v.setFromMatrixPosition(t.matrixWorld),g.setFromMatrixPosition(n.matrixWorld);const i=v.distanceTo(g),r=t.projectionMatrix.elements,o=n.projectionMatrix.elements,a=r[14]/(r[10]-1),s=r[14]/(r[10]+1),l=(r[9]+1)/r[5],p=(r[9]-1)/r[5],u=(r[8]-1)/r[0],h=(o[8]+1)/o[0],c=a*u,_=a*h,d=i/(-u+h),m=d*-u;t.matrixWorld.decompose(e.position,e.quaternion,e.scale),e.translateX(m),e.translateZ(d),e.matrixWorld.compose(e.position,e.quaternion,e.scale),e.matrixWorldInverse.copy(e.matrixWorld).invert();const P=a+d,f=s+d,x=c-m,y=_+(i-m),b=l*s/f*P,z=p*s/f*P;e.projectionMatrix.makePerspective(x,y,b,z,P,f)}(d,h,c):d.projectionMatrix.copy(h.projectionMatrix),d};let z=null;const w=new qS;w.setAnimationLoop((function(e,t){if(l=t.getViewerPose(a),null!==l){const e=l.views,t=r.renderState.baseLayer;i.bindXRFramebuffer(t.framebuffer);let n=!1;e.length!==d.cameras.length&&(d.cameras.length=0,n=!0);for(let i=0;i<e.length;i++){const r=e[i],o=t.getViewport(r),a=_[i];a.matrix.fromArray(r.transform.matrix),a.projectionMatrix.fromArray(r.projectionMatrix),a.viewport.set(o.x,o.y,o.width,o.height),0===i&&d.matrix.copy(a.matrix),!0===n&&d.cameras.push(a)}}const n=r.inputSources;for(let e=0;e<p.length;e++){const i=p[e],r=n[e];i.update(r,t,a)}z&&z(e,t)})),this.setAnimationLoop=function(e){z=e},this.dispose=function(){}}}function aA(e){function t(t,n){t.opacity.value=n.opacity,n.color&&t.diffuse.value.copy(n.color),n.emissive&&t.emissive.value.copy(n.emissive).multiplyScalar(n.emissiveIntensity),n.map&&(t.map.value=n.map),n.alphaMap&&(t.alphaMap.value=n.alphaMap),n.specularMap&&(t.specularMap.value=n.specularMap);const i=e.get(n).envMap;if(i){t.envMap.value=i,t.flipEnvMap.value=i.isCubeTexture&&i._needsFlipEnvMap?-1:1,t.reflectivity.value=n.reflectivity,t.refractionRatio.value=n.refractionRatio;const r=e.get(i).__maxMipLevel;void 0!==r&&(t.maxMipLevel.value=r)}let r,o;n.lightMap&&(t.lightMap.value=n.lightMap,t.lightMapIntensity.value=n.lightMapIntensity),n.aoMap&&(t.aoMap.value=n.aoMap,t.aoMapIntensity.value=n.aoMapIntensity),n.map?r=n.map:n.specularMap?r=n.specularMap:n.displacementMap?r=n.displacementMap:n.normalMap?r=n.normalMap:n.bumpMap?r=n.bumpMap:n.roughnessMap?r=n.roughnessMap:n.metalnessMap?r=n.metalnessMap:n.alphaMap?r=n.alphaMap:n.emissiveMap?r=n.emissiveMap:n.clearcoatMap?r=n.clearcoatMap:n.clearcoatNormalMap?r=n.clearcoatNormalMap:n.clearcoatRoughnessMap&&(r=n.clearcoatRoughnessMap),void 0!==r&&(r.isWebGLRenderTarget&&(r=r.texture),!0===r.matrixAutoUpdate&&r.updateMatrix(),t.uvTransform.value.copy(r.matrix)),n.aoMap?o=n.aoMap:n.lightMap&&(o=n.lightMap),void 0!==o&&(o.isWebGLRenderTarget&&(o=o.texture),!0===o.matrixAutoUpdate&&o.updateMatrix(),t.uv2Transform.value.copy(o.matrix))}function n(t,n){t.roughness.value=n.roughness,t.metalness.value=n.metalness,n.roughnessMap&&(t.roughnessMap.value=n.roughnessMap),n.metalnessMap&&(t.metalnessMap.value=n.metalnessMap),n.emissiveMap&&(t.emissiveMap.value=n.emissiveMap),n.bumpMap&&(t.bumpMap.value=n.bumpMap,t.bumpScale.value=n.bumpScale,1===n.side&&(t.bumpScale.value*=-1)),n.normalMap&&(t.normalMap.value=n.normalMap,t.normalScale.value.copy(n.normalScale),1===n.side&&t.normalScale.value.negate()),n.displacementMap&&(t.displacementMap.value=n.displacementMap,t.displacementScale.value=n.displacementScale,t.displacementBias.value=n.displacementBias),e.get(n).envMap&&(t.envMapIntensity.value=n.envMapIntensity)}return{refreshFogUniforms:function(e,t){e.fogColor.value.copy(t.color),t.isFog?(e.fogNear.value=t.near,e.fogFar.value=t.far):t.isFogExp2&&(e.fogDensity.value=t.density)},refreshMaterialUniforms:function(e,i,r,o){i.isMeshBasicMaterial?t(e,i):i.isMeshLambertMaterial?(t(e,i),function(e,t){t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap)}(e,i)):i.isMeshToonMaterial?(t(e,i),function(e,t){t.gradientMap&&(e.gradientMap.value=t.gradientMap),t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap),t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,1===t.side&&(e.bumpScale.value*=-1)),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),1===t.side&&e.normalScale.value.negate()),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,i)):i.isMeshPhongMaterial?(t(e,i),function(e,t){e.specular.value.copy(t.specular),e.shininess.value=Math.max(t.shininess,1e-4),t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap),t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,1===t.side&&(e.bumpScale.value*=-1)),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),1===t.side&&e.normalScale.value.negate()),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,i)):i.isMeshStandardMaterial?(t(e,i),i.isMeshPhysicalMaterial?function(e,t){n(e,t),e.reflectivity.value=t.reflectivity,e.clearcoat.value=t.clearcoat,e.clearcoatRoughness.value=t.clearcoatRoughness,t.sheen&&e.sheen.value.copy(t.sheen),t.clearcoatMap&&(e.clearcoatMap.value=t.clearcoatMap),t.clearcoatRoughnessMap&&(e.clearcoatRoughnessMap.value=t.clearcoatRoughnessMap),t.clearcoatNormalMap&&(e.clearcoatNormalScale.value.copy(t.clearcoatNormalScale),e.clearcoatNormalMap.value=t.clearcoatNormalMap,1===t.side&&e.clearcoatNormalScale.value.negate()),e.transmission.value=t.transmission,t.transmissionMap&&(e.transmissionMap.value=t.transmissionMap)}(e,i):n(e,i)):i.isMeshMatcapMaterial?(t(e,i),function(e,t){t.matcap&&(e.matcap.value=t.matcap),t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,1===t.side&&(e.bumpScale.value*=-1)),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),1===t.side&&e.normalScale.value.negate()),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,i)):i.isMeshDepthMaterial?(t(e,i),function(e,t){t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,i)):i.isMeshDistanceMaterial?(t(e,i),function(e,t){t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias),e.referencePosition.value.copy(t.referencePosition),e.nearDistance.value=t.nearDistance,e.farDistance.value=t.farDistance}(e,i)):i.isMeshNormalMaterial?(t(e,i),function(e,t){t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,1===t.side&&(e.bumpScale.value*=-1)),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),1===t.side&&e.normalScale.value.negate()),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,i)):i.isLineBasicMaterial?(function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity}(e,i),i.isLineDashedMaterial&&function(e,t){e.dashSize.value=t.dashSize,e.totalSize.value=t.dashSize+t.gapSize,e.scale.value=t.scale}(e,i)):i.isPointsMaterial?function(e,t,n,i){let r;e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.size.value=t.size*n,e.scale.value=.5*i,t.map&&(e.map.value=t.map),t.alphaMap&&(e.alphaMap.value=t.alphaMap),t.map?r=t.map:t.alphaMap&&(r=t.alphaMap),void 0!==r&&(!0===r.matrixAutoUpdate&&r.updateMatrix(),e.uvTransform.value.copy(r.matrix))}(e,i,r,o):i.isSpriteMaterial?function(e,t){let n;e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.rotation.value=t.rotation,t.map&&(e.map.value=t.map),t.alphaMap&&(e.alphaMap.value=t.alphaMap),t.map?n=t.map:t.alphaMap&&(n=t.alphaMap),void 0!==n&&(!0===n.matrixAutoUpdate&&n.updateMatrix(),e.uvTransform.value.copy(n.matrix))}(e,i):i.isShadowMaterial?(e.color.value.copy(i.color),e.opacity.value=i.opacity):i.isShaderMaterial&&(i.uniformsNeedUpdate=!1)}}}function sA(e){const t=void 0!==(e=e||{}).canvas?e.canvas:function(){const e=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");return e.style.display="block",e}(),n=void 0!==e.context?e.context:null,i=void 0!==e.alpha&&e.alpha,r=void 0===e.depth||e.depth,o=void 0===e.stencil||e.stencil,a=void 0!==e.antialias&&e.antialias,s=void 0===e.premultipliedAlpha||e.premultipliedAlpha,l=void 0!==e.preserveDrawingBuffer&&e.preserveDrawingBuffer,p=void 0!==e.powerPreference?e.powerPreference:"default",u=void 0!==e.failIfMajorPerformanceCaveat&&e.failIfMajorPerformanceCaveat;let h=null,c=null;const _=[],d=[];this.domElement=t,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.outputEncoding=eE,this.physicallyCorrectLights=!1,this.toneMapping=0,this.toneMappingExposure=1;const m=this;let P=!1,f=0,x=0,y=null,v=-1,g=null;const b=new gE,z=new gE;let w=null,Z=t.width,E=t.height,M=1,S=null,C=null;const N=new gE(0,0,Z,E),A=new gE(0,0,Z,E);let L=!1;const B=new WS;let T=!1,V=!1;const k=new tM,I=new wE,O={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function R(){return null===y?M:1}let H,F,D,G,U,j,W,q,J,$,X,Y,K,Q,ee,te,ne,ie,re,oe,ae,se,le=n;function pe(e,n){for(let i=0;i<e.length;i++){const r=e[i],o=t.getContext(r,n);if(null!==o)return o}return null}try{const e={alpha:i,depth:r,stencil:o,antialias:a,premultipliedAlpha:s,preserveDrawingBuffer:l,powerPreference:p,failIfMajorPerformanceCaveat:u};if(t.addEventListener("webglcontextlost",ce,!1),t.addEventListener("webglcontextrestored",_e,!1),null===le){const t=["webgl2","webgl","experimental-webgl"];if(!0===m.isWebGL1Renderer&&t.shift(),le=pe(t,e),null===le)throw pe(t)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}void 0===le.getShaderPrecisionFormat&&(le.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(e){throw console.error("THREE.WebGLRenderer: "+e.message),e}function ue(){H=new oC(le),F=new nC(le,H,e),H.init(F),ae=new eA(le,H,F),D=new KN(le,H,F),G=new lC(le),U=new ON,j=new QN(le,H,D,U,F,ae,G),W=new rC(m),q=new JS(le,F),se=new eC(le,H,q,F),J=new aC(le,q,G,se),$=new cC(le,J,q,G),ie=new hC(le),ee=new iC(U),X=new IN(m,W,H,F,se,ee),Y=new aA(U),K=new DN(U),Q=new JN(H,F),ne=new QS(m,W,D,$,s),te=new YN(m,$,F),re=new tC(le,H,G,F),oe=new sC(le,H,G,F),G.programs=X.programs,m.capabilities=F,m.extensions=H,m.properties=U,m.renderLists=K,m.shadowMap=te,m.state=D,m.info=G}ue();const he=new oA(m,le);function ce(e){e.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),P=!0}function _e(){console.log("THREE.WebGLRenderer: Context Restored."),P=!1;const e=G.autoReset,t=te.enabled,n=te.autoUpdate,i=te.needsUpdate,r=te.type;ue(),G.autoReset=e,te.enabled=t,te.autoUpdate=n,te.needsUpdate=i,te.type=r}function de(e){const t=e.target;t.removeEventListener("dispose",de),function(e){(function(e){const t=U.get(e).programs;void 0!==t&&t.forEach((function(e){X.releaseProgram(e)}))})(e),U.remove(e)}(t)}this.xr=he,this.getContext=function(){return le},this.getContextAttributes=function(){return le.getContextAttributes()},this.forceContextLoss=function(){const e=H.get("WEBGL_lose_context");e&&e.loseContext()},this.forceContextRestore=function(){const e=H.get("WEBGL_lose_context");e&&e.restoreContext()},this.getPixelRatio=function(){return M},this.setPixelRatio=function(e){void 0!==e&&(M=e,this.setSize(Z,E,!1))},this.getSize=function(e){return void 0===e&&(console.warn("WebGLRenderer: .getsize() now requires a Vector2 as an argument"),e=new dE),e.set(Z,E)},this.setSize=function(e,n,i){he.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(Z=e,E=n,t.width=Math.floor(e*M),t.height=Math.floor(n*M),!1!==i&&(t.style.width=e+"px",t.style.height=n+"px"),this.setViewport(0,0,e,n))},this.getDrawingBufferSize=function(e){return void 0===e&&(console.warn("WebGLRenderer: .getdrawingBufferSize() now requires a Vector2 as an argument"),e=new dE),e.set(Z*M,E*M).floor()},this.setDrawingBufferSize=function(e,n,i){Z=e,E=n,M=i,t.width=Math.floor(e*i),t.height=Math.floor(n*i),this.setViewport(0,0,e,n)},this.getCurrentViewport=function(e){return void 0===e&&(console.warn("WebGLRenderer: .getCurrentViewport() now requires a Vector4 as an argument"),e=new gE),e.copy(b)},this.getViewport=function(e){return e.copy(N)},this.setViewport=function(e,t,n,i){e.isVector4?N.set(e.x,e.y,e.z,e.w):N.set(e,t,n,i),D.viewport(b.copy(N).multiplyScalar(M).floor())},this.getScissor=function(e){return e.copy(A)},this.setScissor=function(e,t,n,i){e.isVector4?A.set(e.x,e.y,e.z,e.w):A.set(e,t,n,i),D.scissor(z.copy(A).multiplyScalar(M).floor())},this.getScissorTest=function(){return L},this.setScissorTest=function(e){D.setScissorTest(L=e)},this.setOpaqueSort=function(e){S=e},this.setTransparentSort=function(e){C=e},this.getClearColor=function(e){return void 0===e&&(console.warn("WebGLRenderer: .getClearColor() now requires a Color as an argument"),e=new XM),e.copy(ne.getClearColor())},this.setClearColor=function(){ne.setClearColor.apply(ne,arguments)},this.getClearAlpha=function(){return ne.getClearAlpha()},this.setClearAlpha=function(){ne.setClearAlpha.apply(ne,arguments)},this.clear=function(e,t,n){let i=0;(void 0===e||e)&&(i|=16384),(void 0===t||t)&&(i|=256),(void 0===n||n)&&(i|=1024),le.clear(i)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",ce,!1),t.removeEventListener("webglcontextrestored",_e,!1),K.dispose(),Q.dispose(),U.dispose(),W.dispose(),$.dispose(),se.dispose(),he.dispose(),he.removeEventListener("sessionstart",Pe),he.removeEventListener("sessionend",fe),xe.stop()},this.renderBufferImmediate=function(e,t){se.initAttributes();const n=U.get(e);e.hasPositions&&!n.position&&(n.position=le.createBuffer()),e.hasNormals&&!n.normal&&(n.normal=le.createBuffer()),e.hasUvs&&!n.uv&&(n.uv=le.createBuffer()),e.hasColors&&!n.color&&(n.color=le.createBuffer());const i=t.getAttributes();e.hasPositions&&(le.bindBuffer(34962,n.position),le.bufferData(34962,e.positionArray,35048),se.enableAttribute(i.position),le.vertexAttribPointer(i.position,3,5126,!1,0,0)),e.hasNormals&&(le.bindBuffer(34962,n.normal),le.bufferData(34962,e.normalArray,35048),se.enableAttribute(i.normal),le.vertexAttribPointer(i.normal,3,5126,!1,0,0)),e.hasUvs&&(le.bindBuffer(34962,n.uv),le.bufferData(34962,e.uvArray,35048),se.enableAttribute(i.uv),le.vertexAttribPointer(i.uv,2,5126,!1,0,0)),e.hasColors&&(le.bindBuffer(34962,n.color),le.bufferData(34962,e.colorArray,35048),se.enableAttribute(i.color),le.vertexAttribPointer(i.color,3,5126,!1,0,0)),se.disableUnusedAttributes(),le.drawArrays(4,0,e.count),e.count=0},this.renderBufferDirect=function(e,t,n,i,r,o){null===t&&(t=O);const a=r.isMesh&&r.matrixWorld.determinant()<0,s=we(e,t,i,r);D.setMaterial(i,a);let l=n.index;const p=n.attributes.position;if(null===l){if(void 0===p||0===p.count)return}else if(0===l.count)return;let u,h=1;!0===i.wireframe&&(l=J.getWireframeAttribute(n),h=2),(i.morphTargets||i.morphNormals)&&ie.update(r,n,i,s),se.setup(r,i,s,n,l);let c=re;null!==l&&(u=q.get(l),c=oe,c.setIndex(u));const _=null!==l?l.count:p.count,d=n.drawRange.start*h,m=n.drawRange.count*h,P=null!==o?o.start*h:0,f=null!==o?o.count*h:1/0,x=Math.max(d,P),y=Math.min(_,d+m,P+f)-1,v=Math.max(0,y-x+1);if(0!==v){if(r.isMesh)!0===i.wireframe?(D.setLineWidth(i.wireframeLinewidth*R()),c.setMode(1)):c.setMode(4);else if(r.isLine){let e=i.linewidth;void 0===e&&(e=1),D.setLineWidth(e*R()),r.isLineSegments?c.setMode(1):r.isLineLoop?c.setMode(2):c.setMode(3)}else r.isPoints?c.setMode(0):r.isSprite&&c.setMode(4);if(r.isInstancedMesh)c.renderInstances(x,v,r.count);else if(n.isInstancedBufferGeometry){const e=Math.min(n.instanceCount,n._maxInstanceCount);c.renderInstances(x,v,e)}else c.render(x,v)}},this.compile=function(e,t){c=Q.get(e),c.init(),e.traverseVisible((function(e){e.isLight&&e.layers.test(t.layers)&&(c.pushLight(e),e.castShadow&&c.pushShadow(e))})),c.setupLights(),e.traverse((function(t){const n=t.material;if(n)if(Array.isArray(n))for(let i=0;i<n.length;i++)be(n[i],e,t);else be(n,e,t)}))};let me=null;function Pe(){xe.stop()}function fe(){xe.start()}const xe=new qS;function ye(e,t,n,i){if(!1===e.visible)return;if(e.layers.test(t.layers))if(e.isGroup)n=e.renderOrder;else if(e.isLOD)!0===e.autoUpdate&&e.update(t);else if(e.isLight)c.pushLight(e),e.castShadow&&c.pushShadow(e);else if(e.isSprite){if(!e.frustumCulled||B.intersectsSprite(e)){i&&I.setFromMatrixPosition(e.matrixWorld).applyMatrix4(k);const t=$.update(e),r=e.material;r.visible&&h.push(e,t,r,n,I.z,null)}}else if(e.isImmediateRenderObject)i&&I.setFromMatrixPosition(e.matrixWorld).applyMatrix4(k),h.push(e,null,e.material,n,I.z,null);else if((e.isMesh||e.isLine||e.isPoints)&&(e.isSkinnedMesh&&e.skeleton.frame!==G.render.frame&&(e.skeleton.update(),e.skeleton.frame=G.render.frame),!e.frustumCulled||B.intersectsObject(e))){i&&I.setFromMatrixPosition(e.matrixWorld).applyMatrix4(k);const t=$.update(e),r=e.material;if(Array.isArray(r)){const i=t.groups;for(let o=0,a=i.length;o<a;o++){const a=i[o],s=r[a.materialIndex];s&&s.visible&&h.push(e,t,s,n,I.z,a)}}else r.visible&&h.push(e,t,r,n,I.z,null)}const r=e.children;for(let e=0,o=r.length;e<o;e++)ye(r[e],t,n,i)}function ve(e,t,n){const i=!0===t.isScene?t.overrideMaterial:null;for(let r=0,o=e.length;r<o;r++){const o=e[r],a=o.object,s=o.geometry,l=null===i?o.material:i,p=o.group;if(n.isArrayCamera){const e=n.cameras;for(let n=0,i=e.length;n<i;n++){const i=e[n];a.layers.test(i.layers)&&(D.viewport(b.copy(i.viewport)),c.setupLightsView(i),ge(a,t,i,s,l,p))}}else ge(a,t,n,s,l,p)}}function ge(e,t,n,i,r,o){if(e.onBeforeRender(m,t,n,i,r,o),e.modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,e.matrixWorld),e.normalMatrix.getNormalMatrix(e.modelViewMatrix),e.isImmediateRenderObject){const i=we(n,t,r,e);D.setMaterial(r),se.reset(),function(e,t){e.render((function(e){m.renderBufferImmediate(e,t)}))}(e,i)}else m.renderBufferDirect(n,t,i,r,e,o);e.onAfterRender(m,t,n,i,r,o)}function be(e,t,n){!0!==t.isScene&&(t=O);const i=U.get(e),r=c.state.lights,o=c.state.shadowsArray,a=r.state.version,s=X.getParameters(e,r.state,o,t,n),l=X.getProgramCacheKey(s);let p=i.programs;i.environment=e.isMeshStandardMaterial?t.environment:null,i.fog=t.fog,i.envMap=W.get(e.envMap||i.environment),void 0===p&&(e.addEventListener("dispose",de),p=new Map,i.programs=p);let u=p.get(l);if(void 0!==u){if(i.currentProgram===u&&i.lightsStateVersion===a)return ze(e,s),u}else s.uniforms=X.getUniforms(e),e.onBuild(s,m),e.onBeforeCompile(s,m),u=X.acquireProgram(s,l),p.set(l,u),i.uniforms=s.uniforms;const h=i.uniforms;(e.isShaderMaterial||e.isRawShaderMaterial)&&!0!==e.clipping||(h.clippingPlanes=ee.uniform),ze(e,s),i.needsLights=function(e){return e.isMeshLambertMaterial||e.isMeshToonMaterial||e.isMeshPhongMaterial||e.isMeshStandardMaterial||e.isShadowMaterial||e.isShaderMaterial&&!0===e.lights}(e),i.lightsStateVersion=a,i.needsLights&&(h.ambientLightColor.value=r.state.ambient,h.lightProbe.value=r.state.probe,h.directionalLights.value=r.state.directional,h.directionalLightShadows.value=r.state.directionalShadow,h.spotLights.value=r.state.spot,h.spotLightShadows.value=r.state.spotShadow,h.rectAreaLights.value=r.state.rectArea,h.ltc_1.value=r.state.rectAreaLTC1,h.ltc_2.value=r.state.rectAreaLTC2,h.pointLights.value=r.state.point,h.pointLightShadows.value=r.state.pointShadow,h.hemisphereLights.value=r.state.hemi,h.directionalShadowMap.value=r.state.directionalShadowMap,h.directionalShadowMatrix.value=r.state.directionalShadowMatrix,h.spotShadowMap.value=r.state.spotShadowMap,h.spotShadowMatrix.value=r.state.spotShadowMatrix,h.pointShadowMap.value=r.state.pointShadowMap,h.pointShadowMatrix.value=r.state.pointShadowMatrix);const _=u.getUniforms(),d=PN.seqWithValue(_.seq,h);return i.currentProgram=u,i.uniformsList=d,u}function ze(e,t){const n=U.get(e);n.outputEncoding=t.outputEncoding,n.instancing=t.instancing,n.numClippingPlanes=t.numClippingPlanes,n.numIntersection=t.numClipIntersection,n.vertexAlphas=t.vertexAlphas}function we(e,t,n,i){!0!==t.isScene&&(t=O),j.resetTextureUnits();const r=t.fog,o=n.isMeshStandardMaterial?t.environment:null,a=null===y?m.outputEncoding:y.texture.encoding,s=W.get(n.envMap||o),l=!0===n.vertexColors&&i.geometry&&i.geometry.attributes.color&&4===i.geometry.attributes.color.itemSize,p=U.get(n),u=c.state.lights;if(!0===T&&(!0===V||e!==g)){const t=e===g&&n.id===v;ee.setState(n,e,t)}let h=!1;n.version===p.__version?p.needsLights&&p.lightsStateVersion!==u.state.version||p.outputEncoding!==a||i.isInstancedMesh&&!1===p.instancing?h=!0:i.isInstancedMesh||!0!==p.instancing?p.envMap!==s||n.fog&&p.fog!==r?h=!0:void 0===p.numClippingPlanes||p.numClippingPlanes===ee.numPlanes&&p.numIntersection===ee.numIntersection?p.vertexAlphas!==l&&(h=!0):h=!0:h=!0:(h=!0,p.__version=n.version);let _=p.currentProgram;!0===h&&(_=be(n,t,i));let d=!1,P=!1,f=!1;const x=_.getUniforms(),b=p.uniforms;if(D.useProgram(_.program)&&(d=!0,P=!0,f=!0),n.id!==v&&(v=n.id,P=!0),d||g!==e){if(x.setValue(le,"projectionMatrix",e.projectionMatrix),F.logarithmicDepthBuffer&&x.setValue(le,"logDepthBufFC",2/(Math.log(e.far+1)/Math.LN2)),g!==e&&(g=e,P=!0,f=!0),n.isShaderMaterial||n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshStandardMaterial||n.envMap){const t=x.map.cameraPosition;void 0!==t&&t.setValue(le,I.setFromMatrixPosition(e.matrixWorld))}(n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshLambertMaterial||n.isMeshBasicMaterial||n.isMeshStandardMaterial||n.isShaderMaterial)&&x.setValue(le,"isOrthographic",!0===e.isOrthographicCamera),(n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshLambertMaterial||n.isMeshBasicMaterial||n.isMeshStandardMaterial||n.isShaderMaterial||n.isShadowMaterial||n.skinning)&&x.setValue(le,"viewMatrix",e.matrixWorldInverse)}if(n.skinning){x.setOptional(le,i,"bindMatrix"),x.setOptional(le,i,"bindMatrixInverse");const e=i.skeleton;if(e){const t=e.bones;if(F.floatVertexTextures){if(null===e.boneTexture){let n=Math.sqrt(4*t.length);z=n,n=Math.pow(2,Math.ceil(Math.log(z)/Math.LN2)),n=Math.max(n,4);const i=new Float32Array(n*n*4);i.set(e.boneMatrices);const r=new GS(i,n,n,jZ,FZ);e.boneMatrices=i,e.boneTexture=r,e.boneTextureSize=n}x.setValue(le,"boneTexture",e.boneTexture,j),x.setValue(le,"boneTextureSize",e.boneTextureSize)}else x.setOptional(le,e,"boneMatrices")}}var z;return(P||p.receiveShadow!==i.receiveShadow)&&(p.receiveShadow=i.receiveShadow,x.setValue(le,"receiveShadow",i.receiveShadow)),P&&(x.setValue(le,"toneMappingExposure",m.toneMappingExposure),p.needsLights&&function(e,t){e.ambientLightColor.needsUpdate=t,e.lightProbe.needsUpdate=t,e.directionalLights.needsUpdate=t,e.directionalLightShadows.needsUpdate=t,e.pointLights.needsUpdate=t,e.pointLightShadows.needsUpdate=t,e.spotLights.needsUpdate=t,e.spotLightShadows.needsUpdate=t,e.rectAreaLights.needsUpdate=t,e.hemisphereLights.needsUpdate=t}(b,f),r&&n.fog&&Y.refreshFogUniforms(b,r),Y.refreshMaterialUniforms(b,n,M,E),PN.upload(le,p.uniformsList,b,j)),n.isShaderMaterial&&!0===n.uniformsNeedUpdate&&(PN.upload(le,p.uniformsList,b,j),n.uniformsNeedUpdate=!1),n.isSpriteMaterial&&x.setValue(le,"center",i.center),x.setValue(le,"modelViewMatrix",i.modelViewMatrix),x.setValue(le,"normalMatrix",i.normalMatrix),x.setValue(le,"modelMatrix",i.matrixWorld),_}xe.setAnimationLoop((function(e){me&&me(e)})),"undefined"!=typeof window&&xe.setContext(window),this.setAnimationLoop=function(e){me=e,he.setAnimationLoop(e),null===e?xe.stop():xe.start()},he.addEventListener("sessionstart",Pe),he.addEventListener("sessionend",fe),this.render=function(e,t){let n,i;if(void 0!==arguments[2]&&(console.warn("THREE.WebGLRenderer.render(): the renderTarget argument has been removed. Use .setRenderTarget() instead."),n=arguments[2]),void 0!==arguments[3]&&(console.warn("THREE.WebGLRenderer.render(): the forceClear argument has been removed. Use .clear() instead."),i=arguments[3]),void 0!==t&&!0!==t.isCamera)return void console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");if(!0===P)return;!0===e.autoUpdate&&e.updateMatrixWorld(),null===t.parent&&t.updateMatrixWorld(),!0===he.enabled&&!0===he.isPresenting&&(t=he.getCamera(t)),!0===e.isScene&&e.onBeforeRender(m,e,t,n||y),c=Q.get(e,d.length),c.init(),d.push(c),k.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),B.setFromProjectionMatrix(k),V=this.localClippingEnabled,T=ee.init(this.clippingPlanes,V,t),h=K.get(e,_.length),h.init(),_.push(h),ye(e,t,0,m.sortObjects),h.finish(),!0===m.sortObjects&&h.sort(S,C),!0===T&&ee.beginShadows();const r=c.state.shadowsArray;te.render(r,e,t),c.setupLights(),c.setupLightsView(t),!0===T&&ee.endShadows(),!0===this.info.autoReset&&this.info.reset(),void 0!==n&&this.setRenderTarget(n),ne.render(h,e,t,i);const o=h.opaque,a=h.transparent;o.length>0&&ve(o,e,t),a.length>0&&ve(a,e,t),null!==y&&(j.updateRenderTargetMipmap(y),j.updateMultisampleRenderTarget(y)),!0===e.isScene&&e.onAfterRender(m,e,t),D.buffers.depth.setTest(!0),D.buffers.depth.setMask(!0),D.buffers.color.setMask(!0),D.setPolygonOffset(!1),se.resetDefaultState(),v=-1,g=null,d.pop(),c=d.length>0?d[d.length-1]:null,_.pop(),h=_.length>0?_[_.length-1]:null},this.getActiveCubeFace=function(){return f},this.getActiveMipmapLevel=function(){return x},this.getRenderTarget=function(){return y},this.setRenderTarget=function(e,t=0,n=0){y=e,f=t,x=n,e&&void 0===U.get(e).__webglFramebuffer&&j.setupRenderTarget(e);let i=null,r=!1,o=!1;if(e){const n=e.texture;(n.isDataTexture3D||n.isDataTexture2DArray)&&(o=!0);const a=U.get(e).__webglFramebuffer;e.isWebGLCubeRenderTarget?(i=a[t],r=!0):i=e.isWebGLMultisampleRenderTarget?U.get(e).__webglMultisampledFramebuffer:a,b.copy(e.viewport),z.copy(e.scissor),w=e.scissorTest}else b.copy(N).multiplyScalar(M).floor(),z.copy(A).multiplyScalar(M).floor(),w=L;if(D.bindFramebuffer(36160,i),D.viewport(b),D.scissor(z),D.setScissorTest(w),r){const i=U.get(e.texture);le.framebufferTexture2D(36160,36064,34069+t,i.__webglTexture,n)}else if(o){const i=U.get(e.texture),r=t||0;le.framebufferTextureLayer(36160,36064,i.__webglTexture,n||0,r)}},this.readRenderTargetPixels=function(e,t,n,i,r,o,a){if(!e||!e.isWebGLRenderTarget)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let s=U.get(e).__webglFramebuffer;if(e.isWebGLCubeRenderTarget&&void 0!==a&&(s=s[a]),s){D.bindFramebuffer(36160,s);try{const a=e.texture,s=a.format,l=a.type;if(s!==jZ&&ae.convert(s)!==le.getParameter(35739))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");const p=l===DZ&&(H.has("EXT_color_buffer_half_float")||F.isWebGL2&&H.has("EXT_color_buffer_float"));if(!(1009===l||ae.convert(l)===le.getParameter(35738)||l===FZ&&(F.isWebGL2||H.has("OES_texture_float")||H.has("WEBGL_color_buffer_float"))||p))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");36053===le.checkFramebufferStatus(36160)?t>=0&&t<=e.width-i&&n>=0&&n<=e.height-r&&le.readPixels(t,n,i,r,ae.convert(s),ae.convert(l),o):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{const e=null!==y?U.get(y).__webglFramebuffer:null;D.bindFramebuffer(36160,e)}}},this.copyFramebufferToTexture=function(e,t,n=0){const i=Math.pow(2,-n),r=Math.floor(t.image.width*i),o=Math.floor(t.image.height*i),a=ae.convert(t.format);j.setTexture2D(t,0),le.copyTexImage2D(3553,n,a,e.x,e.y,r,o,0),D.unbindTexture()},this.copyTextureToTexture=function(e,t,n,i=0){const r=t.image.width,o=t.image.height,a=ae.convert(n.format),s=ae.convert(n.type);j.setTexture2D(n,0),le.pixelStorei(37440,n.flipY),le.pixelStorei(37441,n.premultiplyAlpha),le.pixelStorei(3317,n.unpackAlignment),t.isDataTexture?le.texSubImage2D(3553,i,e.x,e.y,r,o,a,s,t.image.data):t.isCompressedTexture?le.compressedTexSubImage2D(3553,i,e.x,e.y,t.mipmaps[0].width,t.mipmaps[0].height,a,t.mipmaps[0].data):le.texSubImage2D(3553,i,e.x,e.y,a,s,t.image),0===i&&n.generateMipmaps&&le.generateMipmap(3553),D.unbindTexture()},this.copyTextureToTexture3D=function(e,t,n,i,r=0){if(m.isWebGL1Renderer)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");const{width:o,height:a,data:s}=n.image,l=ae.convert(i.format),p=ae.convert(i.type);let u;if(i.isDataTexture3D)j.setTexture3D(i,0),u=32879;else{if(!i.isDataTexture2DArray)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");j.setTexture2DArray(i,0),u=35866}le.pixelStorei(37440,i.flipY),le.pixelStorei(37441,i.premultiplyAlpha),le.pixelStorei(3317,i.unpackAlignment);const h=le.getParameter(3314),c=le.getParameter(32878),_=le.getParameter(3316),d=le.getParameter(3315),P=le.getParameter(32877);le.pixelStorei(3314,o),le.pixelStorei(32878,a),le.pixelStorei(3316,e.min.x),le.pixelStorei(3315,e.min.y),le.pixelStorei(32877,e.min.z),le.texSubImage3D(u,r,t.x,t.y,t.z,e.max.x-e.min.x+1,e.max.y-e.min.y+1,e.max.z-e.min.z+1,l,p,s),le.pixelStorei(3314,h),le.pixelStorei(32878,c),le.pixelStorei(3316,_),le.pixelStorei(3315,d),le.pixelStorei(32877,P),0===r&&i.generateMipmaps&&le.generateMipmap(u),D.unbindTexture()},this.initTexture=function(e){j.setTexture2D(e,0),D.unbindTexture()},this.resetState=function(){f=0,x=0,y=null,D.reset(),se.reset()},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}(class extends sA{}).prototype.isWebGL1Renderer=!0;class lA extends EM{constructor(){super(),this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),null!==e.background&&(this.background=e.background.clone()),null!==e.environment&&(this.environment=e.environment.clone()),null!==e.fog&&(this.fog=e.fog.clone()),null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone()),this.autoUpdate=e.autoUpdate,this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return null!==this.background&&(t.object.background=this.background.toJSON(e)),null!==this.environment&&(t.object.environment=this.environment.toJSON(e)),null!==this.fog&&(t.object.fog=this.fog.toJSON()),t}}lA.prototype.isScene=!0;class pA{constructor(e,t){this.array=e,this.stride=t,this.count=void 0!==e?e.length/t:0,this.usage=nE,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=pE(),this.onUploadCallback=function(){}}set needsUpdate(e){!0===e&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,n){e*=this.stride,n*=t.stride;for(let i=0,r=this.stride;i<r;i++)this.array[e+i]=t.array[n+i];return this}set(e,t=0){return this.array.set(e,t),this}clone(e){void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=pE()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),n=new pA(t,this.stride);return n.setUsage(this.usage),n}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=pE()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=Array.prototype.slice.call(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}pA.prototype.isInterleavedBuffer=!0;const uA=new wE;class hA{constructor(e,t,n,i){this.name="",this.data=e,this.itemSize=t,this.offset=n,this.normalized=!0===i}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,n=this.data.count;t<n;t++)uA.x=this.getX(t),uA.y=this.getY(t),uA.z=this.getZ(t),uA.applyMatrix4(e),this.setXYZ(t,uA.x,uA.y,uA.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)uA.x=this.getX(t),uA.y=this.getY(t),uA.z=this.getZ(t),uA.applyNormalMatrix(e),this.setXYZ(t,uA.x,uA.y,uA.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)uA.x=this.getX(t),uA.y=this.getY(t),uA.z=this.getZ(t),uA.transformDirection(e),this.setXYZ(t,uA.x,uA.y,uA.z);return this}setX(e,t){return this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){return this.data.array[e*this.data.stride+this.offset]}getY(e){return this.data.array[e*this.data.stride+this.offset+1]}getZ(e){return this.data.array[e*this.data.stride+this.offset+2]}getW(e){return this.data.array[e*this.data.stride+this.offset+3]}setXY(e,t,n){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=n,this}setXYZ(e,t,n,i){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=i,this}setXYZW(e,t,n,i,r){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=i,this.data.array[e+3]=r,this}clone(e){if(void 0===e){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interlaved buffer attribute will deinterleave buffer data.");const e=[];for(let t=0;t<this.count;t++){const n=t*this.data.stride+this.offset;for(let t=0;t<this.itemSize;t++)e.push(this.data.array[n+t])}return new eS(new this.array.constructor(e),this.itemSize,this.normalized)}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new hA(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(void 0===e){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interlaved buffer attribute will deinterleave buffer data.");const e=[];for(let t=0;t<this.count;t++){const n=t*this.data.stride+this.offset;for(let t=0;t<this.itemSize;t++)e.push(this.data.array[n+t])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:e,normalized:this.normalized}}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}hA.prototype.isInterleavedBufferAttribute=!0;class cA extends GM{constructor(e){super(),this.type="SpriteMaterial",this.color=new XM(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this}}let _A;cA.prototype.isSpriteMaterial=!0;const dA=new wE,mA=new wE,PA=new wE,fA=new dE,xA=new dE,yA=new tM,vA=new wE,gA=new wE,bA=new wE,zA=new dE,wA=new dE,ZA=new dE;function EA(e,t,n,i,r,o){fA.subVectors(e,n).addScalar(.5).multiply(i),void 0!==r?(xA.x=o*fA.x-r*fA.y,xA.y=r*fA.x+o*fA.y):xA.copy(fA),e.copy(t),e.x+=xA.x,e.y+=xA.y,e.applyMatrix4(yA)}(class extends EM{constructor(e){if(super(),this.type="Sprite",void 0===_A){_A=new cS;const e=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),t=new pA(e,5);_A.setIndex([0,1,2,0,2,3]),_A.setAttribute("position",new hA(t,3,0,!1)),_A.setAttribute("uv",new hA(t,2,3,!1))}this.geometry=_A,this.material=void 0!==e?e:new cA,this.center=new dE(.5,.5)}raycast(e,t){null===e.camera&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),mA.setFromMatrixScale(this.matrixWorld),yA.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),PA.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&mA.multiplyScalar(-PA.z);const n=this.material.rotation;let i,r;0!==n&&(r=Math.cos(n),i=Math.sin(n));const o=this.center;EA(vA.set(-.5,-.5,0),PA,o,mA,i,r),EA(gA.set(.5,-.5,0),PA,o,mA,i,r),EA(bA.set(.5,.5,0),PA,o,mA,i,r),zA.set(0,0),wA.set(1,0),ZA.set(1,1);let a=e.ray.intersectTriangle(vA,gA,bA,!1,dA);if(null===a&&(EA(gA.set(-.5,.5,0),PA,o,mA,i,r),wA.set(0,1),a=e.ray.intersectTriangle(vA,bA,gA,!1,dA),null===a))return;const s=e.ray.origin.distanceTo(dA);s<e.near||s>e.far||t.push({distance:s,point:dA.clone(),uv:FM.getUV(dA,vA,gA,bA,zA,wA,ZA,new dE),face:null,object:this})}copy(e){return super.copy(e),void 0!==e.center&&this.center.copy(e.center),this.material=e.material,this}}).prototype.isSprite=!0;const MA=new wE,SA=new gE,CA=new gE,NA=new wE,AA=new tM;class LA extends NS{constructor(e,t){super(e,t),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new tM,this.bindMatrixInverse=new tM}copy(e){return super.copy(e),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,this}bind(e,t){this.skeleton=e,void 0===t&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const e=new gE,t=this.geometry.attributes.skinWeight;for(let n=0,i=t.count;n<i;n++){e.x=t.getX(n),e.y=t.getY(n),e.z=t.getZ(n),e.w=t.getW(n);const i=1/e.manhattanLength();i!==1/0?e.multiplyScalar(i):e.set(1,0,0,0),t.setXYZW(n,e.x,e.y,e.z,e.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),"attached"===this.bindMode?this.bindMatrixInverse.copy(this.matrixWorld).invert():"detached"===this.bindMode?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}boneTransform(e,t){const n=this.skeleton,i=this.geometry;SA.fromBufferAttribute(i.attributes.skinIndex,e),CA.fromBufferAttribute(i.attributes.skinWeight,e),MA.fromBufferAttribute(i.attributes.position,e).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let e=0;e<4;e++){const i=CA.getComponent(e);if(0!==i){const r=SA.getComponent(e);AA.multiplyMatrices(n.bones[r].matrixWorld,n.boneInverses[r]),t.addScaledVector(NA.copy(MA).applyMatrix4(AA),i)}}return t.applyMatrix4(this.bindMatrixInverse)}}LA.prototype.isSkinnedMesh=!0,class extends EM{constructor(){super(),this.type="Bone"}}.prototype.isBone=!0;const BA=new tM,TA=new tM,VA=[],kA=new NS;(class extends NS{constructor(e,t,n){super(e,t),this.instanceMatrix=new eS(new Float32Array(16*n),16),this.instanceColor=null,this.count=n,this.frustumCulled=!1}copy(e){return super.copy(e),this.instanceMatrix.copy(e.instanceMatrix),null!==e.instanceColor&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,this}getColorAt(e,t){t.fromArray(this.instanceColor.array,3*e)}getMatrixAt(e,t){t.fromArray(this.instanceMatrix.array,16*e)}raycast(e,t){const n=this.matrixWorld,i=this.count;if(kA.geometry=this.geometry,kA.material=this.material,void 0!==kA.material)for(let r=0;r<i;r++){this.getMatrixAt(r,BA),TA.multiplyMatrices(n,BA),kA.matrixWorld=TA,kA.raycast(e,VA);for(let e=0,n=VA.length;e<n;e++){const n=VA[e];n.instanceId=r,n.object=this,t.push(n)}VA.length=0}}setColorAt(e,t){null===this.instanceColor&&(this.instanceColor=new eS(new Float32Array(3*this.count),3)),t.toArray(this.instanceColor.array,3*e)}setMatrixAt(e,t){t.toArray(this.instanceMatrix.array,16*e)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}}).prototype.isInstancedMesh=!0;class IA extends GM{constructor(e){super(),this.type="LineBasicMaterial",this.color=new XM(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.morphTargets=!1,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.morphTargets=e.morphTargets,this}}IA.prototype.isLineBasicMaterial=!0;const OA=new wE,RA=new wE,HA=new tM,FA=new eM,DA=new WE;class GA extends EM{constructor(e=new cS,t=new IA){super(),this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e){return super.copy(e),this.material=e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(e.isBufferGeometry)if(null===e.index){const t=e.attributes.position,n=[0];for(let e=1,i=t.count;e<i;e++)OA.fromBufferAttribute(t,e-1),RA.fromBufferAttribute(t,e),n[e]=n[e-1],n[e]+=OA.distanceTo(RA);e.setAttribute("lineDistance",new iS(n,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else e.isGeometry&&console.error("THREE.Line.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}raycast(e,t){const n=this.geometry,i=this.matrixWorld,r=e.params.Line.threshold,o=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),DA.copy(n.boundingSphere),DA.applyMatrix4(i),DA.radius+=r,!1===e.ray.intersectsSphere(DA))return;HA.copy(i).invert(),FA.copy(e.ray).applyMatrix4(HA);const a=r/((this.scale.x+this.scale.y+this.scale.z)/3),s=a*a,l=new wE,p=new wE,u=new wE,h=new wE,c=this.isLineSegments?2:1;if(n.isBufferGeometry){const i=n.index,r=n.attributes.position;if(null!==i)for(let n=Math.max(0,o.start),a=Math.min(i.count,o.start+o.count)-1;n<a;n+=c){const o=i.getX(n),a=i.getX(n+1);if(l.fromBufferAttribute(r,o),p.fromBufferAttribute(r,a),FA.distanceSqToSegment(l,p,h,u)>s)continue;h.applyMatrix4(this.matrixWorld);const c=e.ray.origin.distanceTo(h);c<e.near||c>e.far||t.push({distance:c,point:u.clone().applyMatrix4(this.matrixWorld),index:n,face:null,faceIndex:null,object:this})}else for(let n=Math.max(0,o.start),i=Math.min(r.count,o.start+o.count)-1;n<i;n+=c){if(l.fromBufferAttribute(r,n),p.fromBufferAttribute(r,n+1),FA.distanceSqToSegment(l,p,h,u)>s)continue;h.applyMatrix4(this.matrixWorld);const i=e.ray.origin.distanceTo(h);i<e.near||i>e.far||t.push({distance:i,point:u.clone().applyMatrix4(this.matrixWorld),index:n,face:null,faceIndex:null,object:this})}}else n.isGeometry&&console.error("THREE.Line.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}updateMorphTargets(){const e=this.geometry;if(e.isBufferGeometry){const t=e.morphAttributes,n=Object.keys(t);if(n.length>0){const e=t[n[0]];if(void 0!==e){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let t=0,n=e.length;t<n;t++){const n=e[t].name||String(t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=t}}}}else{const t=e.morphTargets;void 0!==t&&t.length>0&&console.error("THREE.Line.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}GA.prototype.isLine=!0;const UA=new wE,jA=new wE;class WA extends GA{constructor(e,t){super(e,t),this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(e.isBufferGeometry)if(null===e.index){const t=e.attributes.position,n=[];for(let e=0,i=t.count;e<i;e+=2)UA.fromBufferAttribute(t,e),jA.fromBufferAttribute(t,e+1),n[e]=0===e?0:n[e-1],n[e+1]=n[e]+UA.distanceTo(jA);e.setAttribute("lineDistance",new iS(n,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else e.isGeometry&&console.error("THREE.LineSegments.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}}WA.prototype.isLineSegments=!0,class extends GA{constructor(e,t){super(e,t),this.type="LineLoop"}}.prototype.isLineLoop=!0;class qA extends GM{constructor(e){super(),this.type="PointsMaterial",this.color=new XM(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.morphTargets=!1,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.morphTargets=e.morphTargets,this}}qA.prototype.isPointsMaterial=!0;const JA=new tM,$A=new eM,XA=new WE,YA=new wE;function KA(e,t,n,i,r,o,a){const s=$A.distanceSqToPoint(e);if(s<n){const n=new wE;$A.closestPointToPoint(e,n),n.applyMatrix4(i);const l=r.ray.origin.distanceTo(n);if(l<r.near||l>r.far)return;o.push({distance:l,distanceToRay:Math.sqrt(s),point:n,index:t,face:null,object:a})}}(class extends EM{constructor(e=new cS,t=new qA){super(),this.type="Points",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e){return super.copy(e),this.material=e.material,this.geometry=e.geometry,this}raycast(e,t){const n=this.geometry,i=this.matrixWorld,r=e.params.Points.threshold,o=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),XA.copy(n.boundingSphere),XA.applyMatrix4(i),XA.radius+=r,!1===e.ray.intersectsSphere(XA))return;JA.copy(i).invert(),$A.copy(e.ray).applyMatrix4(JA);const a=r/((this.scale.x+this.scale.y+this.scale.z)/3),s=a*a;if(n.isBufferGeometry){const r=n.index,a=n.attributes.position;if(null!==r)for(let n=Math.max(0,o.start),l=Math.min(r.count,o.start+o.count);n<l;n++){const o=r.getX(n);YA.fromBufferAttribute(a,o),KA(YA,o,s,i,e,t,this)}else for(let n=Math.max(0,o.start),r=Math.min(a.count,o.start+o.count);n<r;n++)YA.fromBufferAttribute(a,n),KA(YA,n,s,i,e,t,this)}else console.error("THREE.Points.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}updateMorphTargets(){const e=this.geometry;if(e.isBufferGeometry){const t=e.morphAttributes,n=Object.keys(t);if(n.length>0){const e=t[n[0]];if(void 0!==e){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let t=0,n=e.length;t<n;t++){const n=e[t].name||String(t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=t}}}}else{const t=e.morphTargets;void 0!==t&&t.length>0&&console.error("THREE.Points.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}).prototype.isPoints=!0,class extends yE{constructor(e,t,n,i,r,o,a,s,l){super(e,t,n,i,r,o,a,s,l),this.format=void 0!==a?a:UZ,this.minFilter=void 0!==o?o:OZ,this.magFilter=void 0!==r?r:OZ,this.generateMipmaps=!1;const p=this;"requestVideoFrameCallback"in e&&e.requestVideoFrameCallback((function t(){p.needsUpdate=!0,e.requestVideoFrameCallback(t)}))}clone(){return new this.constructor(this.image).copy(this)}update(){const e=this.image;!1=="requestVideoFrameCallback"in e&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}.prototype.isVideoTexture=!0,class extends yE{constructor(e,t,n,i,r,o,a,s,l,p,u,h){super(null,o,a,s,l,p,i,r,u,h),this.image={width:t,height:n},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}}.prototype.isCompressedTexture=!0,class extends yE{constructor(e,t,n,i,r,o,a,s,l){super(e,t,n,i,r,o,a,s,l),this.needsUpdate=!0}}.prototype.isCanvasTexture=!0,class extends yE{constructor(e,t,n,i,r,o,a,s,l,p){if((p=void 0!==p?p:WZ)!==WZ&&p!==qZ)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===n&&p===WZ&&(n=RZ),void 0===n&&p===qZ&&(n=GZ),super(null,i,r,o,a,s,p,n,l),this.image={width:e,height:t},this.magFilter=void 0!==a?a:IZ,this.minFilter=void 0!==s?s:IZ,this.flipY=!1,this.generateMipmaps=!1}}.prototype.isDepthTexture=!0,new wE,new wE,new wE,new FM;function QA(e,t,n,i,r){let o,a;if(r===function(e,t,n,i){let r=0;for(let o=t,a=n-i;o<n;o+=i)r+=(e[a]-e[o])*(e[o+1]+e[a+1]),a=o;return r}(e,t,n,i)>0)for(o=t;o<n;o+=i)a=vL(o,e[o],e[o+1],a);else for(o=n-i;o>=t;o-=i)a=vL(o,e[o],e[o+1],a);return a&&dL(a,a.next)&&(gL(a),a=a.next),a}function eL(e,t){if(!e)return e;t||(t=e);let n,i=e;do{if(n=!1,i.steiner||!dL(i,i.next)&&0!==_L(i.prev,i,i.next))i=i.next;else{if(gL(i),i=t=i.prev,i===i.next)break;n=!0}}while(n||i!==t);return t}function tL(e,t,n,i,r,o,a){if(!e)return;!a&&o&&function(e,t,n,i){let r=e;do{null===r.z&&(r.z=pL(r.x,r.y,t,n,i)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==e);r.prevZ.nextZ=null,r.prevZ=null,function(e){let t,n,i,r,o,a,s,l,p=1;do{for(n=e,e=null,o=null,a=0;n;){for(a++,i=n,s=0,t=0;t<p&&(s++,i=i.nextZ,i);t++);for(l=p;s>0||l>0&&i;)0!==s&&(0===l||!i||n.z<=i.z)?(r=n,n=n.nextZ,s--):(r=i,i=i.nextZ,l--),o?o.nextZ=r:e=r,r.prevZ=o,o=r;n=i}o.nextZ=null,p*=2}while(a>1)}(r)}(e,i,r,o);let s,l,p=e;for(;e.prev!==e.next;)if(s=e.prev,l=e.next,o?iL(e,i,r,o):nL(e))t.push(s.i/n),t.push(e.i/n),t.push(l.i/n),gL(e),e=l.next,p=l.next;else if((e=l)===p){a?1===a?tL(e=rL(eL(e),t,n),t,n,i,r,o,2):2===a&&oL(e,t,n,i,r,o):tL(eL(e),t,n,i,r,o,1);break}}function nL(e){const t=e.prev,n=e,i=e.next;if(_L(t,n,i)>=0)return!1;let r=e.next.next;for(;r!==e.prev;){if(hL(t.x,t.y,n.x,n.y,i.x,i.y,r.x,r.y)&&_L(r.prev,r,r.next)>=0)return!1;r=r.next}return!0}function iL(e,t,n,i){const r=e.prev,o=e,a=e.next;if(_L(r,o,a)>=0)return!1;const s=r.x<o.x?r.x<a.x?r.x:a.x:o.x<a.x?o.x:a.x,l=r.y<o.y?r.y<a.y?r.y:a.y:o.y<a.y?o.y:a.y,p=r.x>o.x?r.x>a.x?r.x:a.x:o.x>a.x?o.x:a.x,u=r.y>o.y?r.y>a.y?r.y:a.y:o.y>a.y?o.y:a.y,h=pL(s,l,t,n,i),c=pL(p,u,t,n,i);let _=e.prevZ,d=e.nextZ;for(;_&&_.z>=h&&d&&d.z<=c;){if(_!==e.prev&&_!==e.next&&hL(r.x,r.y,o.x,o.y,a.x,a.y,_.x,_.y)&&_L(_.prev,_,_.next)>=0)return!1;if(_=_.prevZ,d!==e.prev&&d!==e.next&&hL(r.x,r.y,o.x,o.y,a.x,a.y,d.x,d.y)&&_L(d.prev,d,d.next)>=0)return!1;d=d.nextZ}for(;_&&_.z>=h;){if(_!==e.prev&&_!==e.next&&hL(r.x,r.y,o.x,o.y,a.x,a.y,_.x,_.y)&&_L(_.prev,_,_.next)>=0)return!1;_=_.prevZ}for(;d&&d.z<=c;){if(d!==e.prev&&d!==e.next&&hL(r.x,r.y,o.x,o.y,a.x,a.y,d.x,d.y)&&_L(d.prev,d,d.next)>=0)return!1;d=d.nextZ}return!0}function rL(e,t,n){let i=e;do{const r=i.prev,o=i.next.next;!dL(r,o)&&mL(r,i,i.next,o)&&xL(r,o)&&xL(o,r)&&(t.push(r.i/n),t.push(i.i/n),t.push(o.i/n),gL(i),gL(i.next),i=e=o),i=i.next}while(i!==e);return eL(i)}function oL(e,t,n,i,r,o){let a=e;do{let e=a.next.next;for(;e!==a.prev;){if(a.i!==e.i&&cL(a,e)){let s=yL(a,e);return a=eL(a,a.next),s=eL(s,s.next),tL(a,t,n,i,r,o),void tL(s,t,n,i,r,o)}e=e.next}a=a.next}while(a!==e)}function aL(e,t){return e.x-t.x}function sL(e,t){if(t=function(e,t){let n=t;const i=e.x,r=e.y;let o,a=-1/0;do{if(r<=n.y&&r>=n.next.y&&n.next.y!==n.y){const e=n.x+(r-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(e<=i&&e>a){if(a=e,e===i){if(r===n.y)return n;if(r===n.next.y)return n.next}o=n.x<n.next.x?n:n.next}}n=n.next}while(n!==t);if(!o)return null;if(i===a)return o;const s=o,l=o.x,p=o.y;let u,h=1/0;n=o;do{i>=n.x&&n.x>=l&&i!==n.x&&hL(r<p?i:a,r,l,p,r<p?a:i,r,n.x,n.y)&&(u=Math.abs(r-n.y)/(i-n.x),xL(n,e)&&(u<h||u===h&&(n.x>o.x||n.x===o.x&&lL(o,n)))&&(o=n,h=u)),n=n.next}while(n!==s);return o}(e,t),t){const n=yL(t,e);eL(t,t.next),eL(n,n.next)}}function lL(e,t){return _L(e.prev,e,t.prev)<0&&_L(t.next,e,e.next)<0}function pL(e,t,n,i,r){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*r)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)*r)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function uL(e){let t=e,n=e;do{(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next}while(t!==e);return n}function hL(e,t,n,i,r,o,a,s){return(r-a)*(t-s)-(e-a)*(o-s)>=0&&(e-a)*(i-s)-(n-a)*(t-s)>=0&&(n-a)*(o-s)-(r-a)*(i-s)>=0}function cL(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){let n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&mL(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}(e,t)&&(xL(e,t)&&xL(t,e)&&function(e,t){let n=e,i=!1;const r=(e.x+t.x)/2,o=(e.y+t.y)/2;do{n.y>o!=n.next.y>o&&n.next.y!==n.y&&r<(n.next.x-n.x)*(o-n.y)/(n.next.y-n.y)+n.x&&(i=!i),n=n.next}while(n!==e);return i}(e,t)&&(_L(e.prev,e,t.prev)||_L(e,t.prev,t))||dL(e,t)&&_L(e.prev,e,e.next)>0&&_L(t.prev,t,t.next)>0)}function _L(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function dL(e,t){return e.x===t.x&&e.y===t.y}function mL(e,t,n,i){const r=fL(_L(e,t,n)),o=fL(_L(e,t,i)),a=fL(_L(n,i,e)),s=fL(_L(n,i,t));return r!==o&&a!==s||!(0!==r||!PL(e,n,t))||!(0!==o||!PL(e,i,t))||!(0!==a||!PL(n,e,i))||!(0!==s||!PL(n,t,i))}function PL(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}function fL(e){return e>0?1:e<0?-1:0}function xL(e,t){return _L(e.prev,e,e.next)<0?_L(e,t,e.next)>=0&&_L(e,e.prev,t)>=0:_L(e,t,e.prev)<0||_L(e,e.next,t)<0}function yL(e,t){const n=new bL(e.i,e.x,e.y),i=new bL(t.i,t.x,t.y),r=e.next,o=t.prev;return e.next=t,t.prev=e,n.next=r,r.prev=n,i.next=n,n.prev=i,o.next=i,i.prev=o,i}function vL(e,t,n,i){const r=new bL(e,t,n);return i?(r.next=i.next,r.prev=i,i.next.prev=r,i.next=r):(r.prev=r,r.next=r),r}function gL(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function bL(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}class zL{static area(e){const t=e.length;let n=0;for(let i=t-1,r=0;r<t;i=r++)n+=e[i].x*e[r].y-e[r].x*e[i].y;return.5*n}static isClockWise(e){return zL.area(e)<0}static triangulateShape(e,t){const n=[],i=[],r=[];wL(e),ZL(n,e);let o=e.length;t.forEach(wL);for(let e=0;e<t.length;e++)i.push(o),o+=t[e].length,ZL(n,t[e]);const a=function(e,t,n){n=n||2;const i=t&&t.length,r=i?t[0]*n:e.length;let o=QA(e,0,r,n,!0);const a=[];if(!o||o.next===o.prev)return a;let s,l,p,u,h,c,_;if(i&&(o=function(e,t,n,i){const r=[];let o,a,s,l,p;for(o=0,a=t.length;o<a;o++)s=t[o]*i,l=o<a-1?t[o+1]*i:e.length,p=QA(e,s,l,i,!1),p===p.next&&(p.steiner=!0),r.push(uL(p));for(r.sort(aL),o=0;o<r.length;o++)sL(r[o],n),n=eL(n,n.next);return n}(e,t,o,n)),e.length>80*n){s=p=e[0],l=u=e[1];for(let t=n;t<r;t+=n)h=e[t],c=e[t+1],h<s&&(s=h),c<l&&(l=c),h>p&&(p=h),c>u&&(u=c);_=Math.max(p-s,u-l),_=0!==_?1/_:0}return tL(o,a,n,s,l,_),a}(n,i);for(let e=0;e<a.length;e+=3)r.push(a.slice(e,e+3));return r}}function wL(e){const t=e.length;t>2&&e[t-1].equals(e[0])&&e.pop()}function ZL(e,t){for(let n=0;n<t.length;n++)e.push(t[n].x),e.push(t[n].y)}class EL extends cS{constructor(e,t){super(),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:t},e=Array.isArray(e)?e:[e];const n=this,i=[],r=[];for(let t=0,n=e.length;t<n;t++)o(e[t]);function o(e){const o=[],a=void 0!==t.curveSegments?t.curveSegments:12,s=void 0!==t.steps?t.steps:1;let l=void 0!==t.depth?t.depth:100,p=void 0===t.bevelEnabled||t.bevelEnabled,u=void 0!==t.bevelThickness?t.bevelThickness:6,h=void 0!==t.bevelSize?t.bevelSize:u-2,c=void 0!==t.bevelOffset?t.bevelOffset:0,_=void 0!==t.bevelSegments?t.bevelSegments:3;const d=t.extrudePath,m=void 0!==t.UVGenerator?t.UVGenerator:ML;void 0!==t.amount&&(console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth."),l=t.amount);let P,f,x,y,v,g=!1;d&&(P=d.getSpacedPoints(s),g=!0,p=!1,f=d.computeFrenetFrames(s,!1),x=new wE,y=new wE,v=new wE),p||(_=0,u=0,h=0,c=0);const b=e.extractPoints(a);let z=b.shape;const w=b.holes;if(!zL.isClockWise(z)){z=z.reverse();for(let e=0,t=w.length;e<t;e++){const t=w[e];zL.isClockWise(t)&&(w[e]=t.reverse())}}const Z=zL.triangulateShape(z,w),E=z;for(let e=0,t=w.length;e<t;e++){const t=w[e];z=z.concat(t)}function M(e,t,n){return t||console.error("THREE.ExtrudeGeometry: vec does not exist"),t.clone().multiplyScalar(n).add(e)}const S=z.length,C=Z.length;function N(e,t,n){let i,r,o;const a=e.x-t.x,s=e.y-t.y,l=n.x-e.x,p=n.y-e.y,u=a*a+s*s,h=a*p-s*l;if(Math.abs(h)>Number.EPSILON){const h=Math.sqrt(u),c=Math.sqrt(l*l+p*p),_=t.x-s/h,d=t.y+a/h,m=((n.x-p/c-_)*p-(n.y+l/c-d)*l)/(a*p-s*l);i=_+a*m-e.x,r=d+s*m-e.y;const P=i*i+r*r;if(P<=2)return new dE(i,r);o=Math.sqrt(P/2)}else{let e=!1;a>Number.EPSILON?l>Number.EPSILON&&(e=!0):a<-Number.EPSILON?l<-Number.EPSILON&&(e=!0):Math.sign(s)===Math.sign(p)&&(e=!0),e?(i=-s,r=a,o=Math.sqrt(u)):(i=a,r=s,o=Math.sqrt(u/2))}return new dE(i/o,r/o)}const A=[];for(let e=0,t=E.length,n=t-1,i=e+1;e<t;e++,n++,i++)n===t&&(n=0),i===t&&(i=0),A[e]=N(E[e],E[n],E[i]);const L=[];let B,T=A.concat();for(let e=0,t=w.length;e<t;e++){const t=w[e];B=[];for(let e=0,n=t.length,i=n-1,r=e+1;e<n;e++,i++,r++)i===n&&(i=0),r===n&&(r=0),B[e]=N(t[e],t[i],t[r]);L.push(B),T=T.concat(B)}for(let e=0;e<_;e++){const t=e/_,n=u*Math.cos(t*Math.PI/2),i=h*Math.sin(t*Math.PI/2)+c;for(let e=0,t=E.length;e<t;e++){const t=M(E[e],A[e],i);I(t.x,t.y,-n)}for(let e=0,t=w.length;e<t;e++){const t=w[e];B=L[e];for(let e=0,r=t.length;e<r;e++){const r=M(t[e],B[e],i);I(r.x,r.y,-n)}}}const V=h+c;for(let e=0;e<S;e++){const t=p?M(z[e],T[e],V):z[e];g?(y.copy(f.normals[0]).multiplyScalar(t.x),x.copy(f.binormals[0]).multiplyScalar(t.y),v.copy(P[0]).add(y).add(x),I(v.x,v.y,v.z)):I(t.x,t.y,0)}for(let e=1;e<=s;e++)for(let t=0;t<S;t++){const n=p?M(z[t],T[t],V):z[t];g?(y.copy(f.normals[e]).multiplyScalar(n.x),x.copy(f.binormals[e]).multiplyScalar(n.y),v.copy(P[e]).add(y).add(x),I(v.x,v.y,v.z)):I(n.x,n.y,l/s*e)}for(let e=_-1;e>=0;e--){const t=e/_,n=u*Math.cos(t*Math.PI/2),i=h*Math.sin(t*Math.PI/2)+c;for(let e=0,t=E.length;e<t;e++){const t=M(E[e],A[e],i);I(t.x,t.y,l+n)}for(let e=0,t=w.length;e<t;e++){const t=w[e];B=L[e];for(let e=0,r=t.length;e<r;e++){const r=M(t[e],B[e],i);g?I(r.x,r.y+P[s-1].y,P[s-1].x+n):I(r.x,r.y,l+n)}}}function k(e,t){let n=e.length;for(;--n>=0;){const i=n;let r=n-1;r<0&&(r=e.length-1);for(let e=0,n=s+2*_;e<n;e++){const n=S*e,o=S*(e+1);R(t+i+n,t+r+n,t+r+o,t+i+o)}}}function I(e,t,n){o.push(e),o.push(t),o.push(n)}function O(e,t,r){H(e),H(t),H(r);const o=i.length/3,a=m.generateTopUV(n,i,o-3,o-2,o-1);F(a[0]),F(a[1]),F(a[2])}function R(e,t,r,o){H(e),H(t),H(o),H(t),H(r),H(o);const a=i.length/3,s=m.generateSideWallUV(n,i,a-6,a-3,a-2,a-1);F(s[0]),F(s[1]),F(s[3]),F(s[1]),F(s[2]),F(s[3])}function H(e){i.push(o[3*e+0]),i.push(o[3*e+1]),i.push(o[3*e+2])}function F(e){r.push(e.x),r.push(e.y)}!function(){const e=i.length/3;if(p){let e=0,t=S*e;for(let e=0;e<C;e++){const n=Z[e];O(n[2]+t,n[1]+t,n[0]+t)}e=s+2*_,t=S*e;for(let e=0;e<C;e++){const n=Z[e];O(n[0]+t,n[1]+t,n[2]+t)}}else{for(let e=0;e<C;e++){const t=Z[e];O(t[2],t[1],t[0])}for(let e=0;e<C;e++){const t=Z[e];O(t[0]+S*s,t[1]+S*s,t[2]+S*s)}}n.addGroup(e,i.length/3-e,0)}(),function(){const e=i.length/3;let t=0;k(E,t),t+=E.length;for(let e=0,n=w.length;e<n;e++){const n=w[e];k(n,t),t+=n.length}n.addGroup(e,i.length/3-e,1)}()}this.setAttribute("position",new iS(i,3)),this.setAttribute("uv",new iS(r,2)),this.computeVertexNormals()}toJSON(){const e=cS.prototype.toJSON.call(this);return function(e,t,n){if(n.shapes=[],Array.isArray(e))for(let t=0,i=e.length;t<i;t++){const i=e[t];n.shapes.push(i.uuid)}else n.shapes.push(e.uuid);return void 0!==t.extrudePath&&(n.options.extrudePath=t.extrudePath.toJSON()),n}(this.parameters.shapes,this.parameters.options,e)}}const ML={generateTopUV:function(e,t,n,i,r){const o=t[3*n],a=t[3*n+1],s=t[3*i],l=t[3*i+1],p=t[3*r],u=t[3*r+1];return[new dE(o,a),new dE(s,l),new dE(p,u)]},generateSideWallUV:function(e,t,n,i,r,o){const a=t[3*n],s=t[3*n+1],l=t[3*n+2],p=t[3*i],u=t[3*i+1],h=t[3*i+2],c=t[3*r],_=t[3*r+1],d=t[3*r+2],m=t[3*o],P=t[3*o+1],f=t[3*o+2];return Math.abs(s-u)<.01?[new dE(a,1-l),new dE(p,1-h),new dE(c,1-d),new dE(m,1-f)]:[new dE(s,1-l),new dE(u,1-h),new dE(_,1-d),new dE(P,1-f)]}};class SL extends cS{constructor(e,t=12){super(),this.type="ShapeGeometry",this.parameters={shapes:e,curveSegments:t};const n=[],i=[],r=[],o=[];let a=0,s=0;if(!1===Array.isArray(e))l(e);else for(let t=0;t<e.length;t++)l(e[t]),this.addGroup(a,s,t),a+=s,s=0;function l(e){const a=i.length/3,l=e.extractPoints(t);let p=l.shape;const u=l.holes;!1===zL.isClockWise(p)&&(p=p.reverse());for(let e=0,t=u.length;e<t;e++){const t=u[e];!0===zL.isClockWise(t)&&(u[e]=t.reverse())}const h=zL.triangulateShape(p,u);for(let e=0,t=u.length;e<t;e++){const t=u[e];p=p.concat(t)}for(let e=0,t=p.length;e<t;e++){const t=p[e];i.push(t.x,t.y,0),r.push(0,0,1),o.push(t.x,t.y)}for(let e=0,t=h.length;e<t;e++){const t=h[e],i=t[0]+a,r=t[1]+a,o=t[2]+a;n.push(i,r,o),s+=3}}this.setIndex(n),this.setAttribute("position",new iS(i,3)),this.setAttribute("normal",new iS(r,3)),this.setAttribute("uv",new iS(o,2))}toJSON(){const e=cS.prototype.toJSON.call(this);return function(e,t){if(t.shapes=[],Array.isArray(e))for(let n=0,i=e.length;n<i;n++){const i=e[n];t.shapes.push(i.uuid)}else t.shapes.push(e.uuid);return t}(this.parameters.shapes,e)}}(class extends GM{constructor(e){super(),this.type="ShadowMaterial",this.color=new XM(0),this.transparent=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this}}).prototype.isShadowMaterial=!0,class extends kS{constructor(e){super(e),this.type="RawShaderMaterial"}}.prototype.isRawShaderMaterial=!0;class CL extends GM{constructor(e){super(),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new XM(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new XM(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new dE(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.flatShading=!1,this.vertexTangents=!1,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.flatShading=e.flatShading,this.vertexTangents=e.vertexTangents,this}}CL.prototype.isMeshStandardMaterial=!0,class extends CL{constructor(e){super(),this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoat=0,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new dE(1,1),this.clearcoatNormalMap=null,this.reflectivity=.5,Object.defineProperty(this,"ior",{get:function(){return(1+.4*this.reflectivity)/(1-.4*this.reflectivity)},set:function(e){this.reflectivity=uE(2.5*(e-1)/(e+1),0,1)}}),this.sheen=null,this.transmission=0,this.transmissionMap=null,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.reflectivity=e.reflectivity,e.sheen?this.sheen=(this.sheen||new XM).copy(e.sheen):this.sheen=null,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this}}.prototype.isMeshPhysicalMaterial=!0,class extends GM{constructor(e){super(),this.type="MeshPhongMaterial",this.color=new XM(16777215),this.specular=new XM(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new XM(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new dE(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.flatShading=e.flatShading,this}}.prototype.isMeshPhongMaterial=!0,class extends GM{constructor(e){super(),this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new XM(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new XM(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new dE(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this}}.prototype.isMeshToonMaterial=!0,class extends GM{constructor(e){super(),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new dE(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.flatShading=e.flatShading,this}}.prototype.isMeshNormalMaterial=!0,class extends GM{constructor(e){super(),this.type="MeshLambertMaterial",this.color=new XM(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new XM(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this}}.prototype.isMeshLambertMaterial=!0,class extends GM{constructor(e){super(),this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new XM(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new dE(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.flatShading=e.flatShading,this}}.prototype.isMeshMatcapMaterial=!0,class extends IA{constructor(e){super(),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}copy(e){return super.copy(e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}}.prototype.isLineDashedMaterial=!0;const NL={arraySlice:function(e,t,n){return NL.isTypedArray(e)?new e.constructor(e.subarray(t,void 0!==n?n:e.length)):e.slice(t,n)},convertArray:function(e,t,n){return!e||!n&&e.constructor===t?e:"number"==typeof t.BYTES_PER_ELEMENT?new t(e):Array.prototype.slice.call(e)},isTypedArray:function(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)},getKeyframeOrder:function(e){const t=e.length,n=new Array(t);for(let e=0;e!==t;++e)n[e]=e;return n.sort((function(t,n){return e[t]-e[n]})),n},sortedArray:function(e,t,n){const i=e.length,r=new e.constructor(i);for(let o=0,a=0;a!==i;++o){const i=n[o]*t;for(let n=0;n!==t;++n)r[a++]=e[i+n]}return r},flattenJSON:function(e,t,n,i){let r=1,o=e[0];for(;void 0!==o&&void 0===o[i];)o=e[r++];if(void 0===o)return;let a=o[i];if(void 0!==a)if(Array.isArray(a))do{a=o[i],void 0!==a&&(t.push(o.time),n.push.apply(n,a)),o=e[r++]}while(void 0!==o);else if(void 0!==a.toArray)do{a=o[i],void 0!==a&&(t.push(o.time),a.toArray(n,n.length)),o=e[r++]}while(void 0!==o);else do{a=o[i],void 0!==a&&(t.push(o.time),n.push(a)),o=e[r++]}while(void 0!==o)},subclip:function(e,t,n,i,r=30){const o=e.clone();o.name=t;const a=[];for(let e=0;e<o.tracks.length;++e){const t=o.tracks[e],s=t.getValueSize(),l=[],p=[];for(let e=0;e<t.times.length;++e){const o=t.times[e]*r;if(!(o<n||o>=i)){l.push(t.times[e]);for(let n=0;n<s;++n)p.push(t.values[e*s+n])}}0!==l.length&&(t.times=NL.convertArray(l,t.times.constructor),t.values=NL.convertArray(p,t.values.constructor),a.push(t))}o.tracks=a;let s=1/0;for(let e=0;e<o.tracks.length;++e)s>o.tracks[e].times[0]&&(s=o.tracks[e].times[0]);for(let e=0;e<o.tracks.length;++e)o.tracks[e].shift(-1*s);return o.resetDuration(),o},makeClipAdditive:function(e,t=0,n=e,i=30){i<=0&&(i=30);const r=n.tracks.length,o=t/i;for(let t=0;t<r;++t){const i=n.tracks[t],r=i.ValueTypeName;if("bool"===r||"string"===r)continue;const a=e.tracks.find((function(e){return e.name===i.name&&e.ValueTypeName===r}));if(void 0===a)continue;let s=0;const l=i.getValueSize();i.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(s=l/3);let p=0;const u=a.getValueSize();a.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(p=u/3);const h=i.times.length-1;let c;if(o<=i.times[0]){const e=s,t=l-s;c=NL.arraySlice(i.values,e,t)}else if(o>=i.times[h]){const e=h*l+s,t=e+l-s;c=NL.arraySlice(i.values,e,t)}else{const e=i.createInterpolant(),t=s,n=l-s;e.evaluate(o),c=NL.arraySlice(e.resultBuffer,t,n)}"quaternion"===r&&(new zE).fromArray(c).normalize().conjugate().toArray(c);const _=a.times.length;for(let e=0;e<_;++e){const t=e*u+p;if("quaternion"===r)zE.multiplyQuaternionsFlat(a.values,t,c,0,a.values,t);else{const e=u-2*p;for(let n=0;n<e;++n)a.values[t+n]-=c[n]}}}return e.blendMode=2501,e}};class AL{constructor(e,t,n,i){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=void 0!==i?i:new t.constructor(n),this.sampleValues=t,this.valueSize=n,this.settings=null,this.DefaultSettings_={}}evaluate(e){const t=this.parameterPositions;let n=this._cachedIndex,i=t[n],r=t[n-1];e:{t:{let o;n:{i:if(!(e<i)){for(let o=n+2;;){if(void 0===i){if(e<r)break i;return n=t.length,this._cachedIndex=n,this.afterEnd_(n-1,e,r)}if(n===o)break;if(r=i,i=t[++n],e<i)break t}o=t.length;break n}if(e>=r)break e;{const a=t[1];e<a&&(n=2,r=a);for(let o=n-2;;){if(void 0===r)return this._cachedIndex=0,this.beforeStart_(0,e,i);if(n===o)break;if(i=r,r=t[--n-1],e>=r)break t}o=n,n=0}}for(;n<o;){const i=n+o>>>1;e<t[i]?o=i:n=i+1}if(i=t[n],r=t[n-1],void 0===r)return this._cachedIndex=0,this.beforeStart_(0,e,i);if(void 0===i)return n=t.length,this._cachedIndex=n,this.afterEnd_(n-1,r,e)}this._cachedIndex=n,this.intervalChanged_(n,r,i)}return this.interpolate_(n,r,e,i)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const t=this.resultBuffer,n=this.sampleValues,i=this.valueSize,r=e*i;for(let e=0;e!==i;++e)t[e]=n[r+e];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}AL.prototype.beforeStart_=AL.prototype.copySampleValue_,AL.prototype.afterEnd_=AL.prototype.copySampleValue_;class LL extends AL{constructor(e,t,n,i){super(e,t,n,i),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:YZ,endingEnd:YZ}}intervalChanged_(e,t,n){const i=this.parameterPositions;let r=e-2,o=e+1,a=i[r],s=i[o];if(void 0===a)switch(this.getSettings_().endingStart){case KZ:r=e,a=2*t-n;break;case QZ:r=i.length-2,a=t+i[r]-i[r+1];break;default:r=e,a=n}if(void 0===s)switch(this.getSettings_().endingEnd){case KZ:o=e,s=2*n-t;break;case QZ:o=1,s=n+i[1]-i[0];break;default:o=e-1,s=t}const l=.5*(n-t),p=this.valueSize;this._weightPrev=l/(t-a),this._weightNext=l/(s-n),this._offsetPrev=r*p,this._offsetNext=o*p}interpolate_(e,t,n,i){const r=this.resultBuffer,o=this.sampleValues,a=this.valueSize,s=e*a,l=s-a,p=this._offsetPrev,u=this._offsetNext,h=this._weightPrev,c=this._weightNext,_=(n-t)/(i-t),d=_*_,m=d*_,P=-h*m+2*h*d-h*_,f=(1+h)*m+(-1.5-2*h)*d+(-.5+h)*_+1,x=(-1-c)*m+(1.5+c)*d+.5*_,y=c*m-c*d;for(let e=0;e!==a;++e)r[e]=P*o[p+e]+f*o[l+e]+x*o[s+e]+y*o[u+e];return r}}class BL extends AL{constructor(e,t,n,i){super(e,t,n,i)}interpolate_(e,t,n,i){const r=this.resultBuffer,o=this.sampleValues,a=this.valueSize,s=e*a,l=s-a,p=(n-t)/(i-t),u=1-p;for(let e=0;e!==a;++e)r[e]=o[l+e]*u+o[s+e]*p;return r}}class TL extends AL{constructor(e,t,n,i){super(e,t,n,i)}interpolate_(e){return this.copySampleValue_(e-1)}}class VL{constructor(e,t,n,i){if(void 0===e)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===t||0===t.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=NL.convertArray(t,this.TimeBufferType),this.values=NL.convertArray(n,this.ValueBufferType),this.setInterpolation(i||this.DefaultInterpolation)}static toJSON(e){const t=e.constructor;let n;if(t.toJSON!==this.toJSON)n=t.toJSON(e);else{n={name:e.name,times:NL.convertArray(e.times,Array),values:NL.convertArray(e.values,Array)};const t=e.getInterpolation();t!==e.DefaultInterpolation&&(n.interpolation=t)}return n.type=e.ValueTypeName,n}InterpolantFactoryMethodDiscrete(e){return new TL(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new BL(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new LL(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case JZ:t=this.InterpolantFactoryMethodDiscrete;break;case $Z:t=this.InterpolantFactoryMethodLinear;break;case XZ:t=this.InterpolantFactoryMethodSmooth}if(void 0===t){const t="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(e===this.DefaultInterpolation)throw new Error(t);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",t),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return JZ;case this.InterpolantFactoryMethodLinear:return $Z;case this.InterpolantFactoryMethodSmooth:return XZ}}getValueSize(){return this.values.length/this.times.length}shift(e){if(0!==e){const t=this.times;for(let n=0,i=t.length;n!==i;++n)t[n]+=e}return this}scale(e){if(1!==e){const t=this.times;for(let n=0,i=t.length;n!==i;++n)t[n]*=e}return this}trim(e,t){const n=this.times,i=n.length;let r=0,o=i-1;for(;r!==i&&n[r]<e;)++r;for(;-1!==o&&n[o]>t;)--o;if(++o,0!==r||o!==i){r>=o&&(o=Math.max(o,1),r=o-1);const e=this.getValueSize();this.times=NL.arraySlice(n,r,o),this.values=NL.arraySlice(this.values,r*e,o*e)}return this}validate(){let e=!0;const t=this.getValueSize();t-Math.floor(t)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);const n=this.times,i=this.values,r=n.length;0===r&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let o=null;for(let t=0;t!==r;t++){const i=n[t];if("number"==typeof i&&isNaN(i)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,t,i),e=!1;break}if(null!==o&&o>i){console.error("THREE.KeyframeTrack: Out of order keys.",this,t,i,o),e=!1;break}o=i}if(void 0!==i&&NL.isTypedArray(i))for(let t=0,n=i.length;t!==n;++t){const n=i[t];if(isNaN(n)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,t,n),e=!1;break}}return e}optimize(){const e=NL.arraySlice(this.times),t=NL.arraySlice(this.values),n=this.getValueSize(),i=this.getInterpolation()===XZ,r=e.length-1;let o=1;for(let a=1;a<r;++a){let r=!1;const s=e[a];if(s!==e[a+1]&&(1!==a||s!==e[0]))if(i)r=!0;else{const e=a*n,i=e-n,o=e+n;for(let a=0;a!==n;++a){const n=t[e+a];if(n!==t[i+a]||n!==t[o+a]){r=!0;break}}}if(r){if(a!==o){e[o]=e[a];const i=a*n,r=o*n;for(let e=0;e!==n;++e)t[r+e]=t[i+e]}++o}}if(r>0){e[o]=e[r];for(let e=r*n,i=o*n,a=0;a!==n;++a)t[i+a]=t[e+a];++o}return o!==e.length?(this.times=NL.arraySlice(e,0,o),this.values=NL.arraySlice(t,0,o*n)):(this.times=e,this.values=t),this}clone(){const e=NL.arraySlice(this.times,0),t=NL.arraySlice(this.values,0),n=new(0,this.constructor)(this.name,e,t);return n.createInterpolant=this.createInterpolant,n}}VL.prototype.TimeBufferType=Float32Array,VL.prototype.ValueBufferType=Float32Array,VL.prototype.DefaultInterpolation=$Z;class kL extends VL{}kL.prototype.ValueTypeName="bool",kL.prototype.ValueBufferType=Array,kL.prototype.DefaultInterpolation=JZ,kL.prototype.InterpolantFactoryMethodLinear=void 0,kL.prototype.InterpolantFactoryMethodSmooth=void 0;class IL extends VL{}IL.prototype.ValueTypeName="color";class OL extends VL{}OL.prototype.ValueTypeName="number";class RL extends AL{constructor(e,t,n,i){super(e,t,n,i)}interpolate_(e,t,n,i){const r=this.resultBuffer,o=this.sampleValues,a=this.valueSize,s=(n-t)/(i-t);let l=e*a;for(let e=l+a;l!==e;l+=4)zE.slerpFlat(r,0,o,l-a,o,l,s);return r}}class HL extends VL{InterpolantFactoryMethodLinear(e){return new RL(this.times,this.values,this.getValueSize(),e)}}HL.prototype.ValueTypeName="quaternion",HL.prototype.DefaultInterpolation=$Z,HL.prototype.InterpolantFactoryMethodSmooth=void 0;class FL extends VL{}FL.prototype.ValueTypeName="string",FL.prototype.ValueBufferType=Array,FL.prototype.DefaultInterpolation=JZ,FL.prototype.InterpolantFactoryMethodLinear=void 0,FL.prototype.InterpolantFactoryMethodSmooth=void 0;class DL extends VL{}DL.prototype.ValueTypeName="vector";class GL{constructor(e,t=-1,n,i=2500){this.name=e,this.tracks=n,this.duration=t,this.blendMode=i,this.uuid=pE(),this.duration<0&&this.resetDuration()}static parse(e){const t=[],n=e.tracks,i=1/(e.fps||1);for(let e=0,r=n.length;e!==r;++e)t.push(UL(n[e]).scale(i));const r=new this(e.name,e.duration,t,e.blendMode);return r.uuid=e.uuid,r}static toJSON(e){const t=[],n=e.tracks,i={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode};for(let e=0,i=n.length;e!==i;++e)t.push(VL.toJSON(n[e]));return i}static CreateFromMorphTargetSequence(e,t,n,i){const r=t.length,o=[];for(let e=0;e<r;e++){let a=[],s=[];a.push((e+r-1)%r,e,(e+1)%r),s.push(0,1,0);const l=NL.getKeyframeOrder(a);a=NL.sortedArray(a,1,l),s=NL.sortedArray(s,1,l),i||0!==a[0]||(a.push(r),s.push(s[0])),o.push(new OL(".morphTargetInfluences["+t[e].name+"]",a,s).scale(1/n))}return new this(e,-1,o)}static findByName(e,t){let n=e;if(!Array.isArray(e)){const t=e;n=t.geometry&&t.geometry.animations||t.animations}for(let e=0;e<n.length;e++)if(n[e].name===t)return n[e];return null}static CreateClipsFromMorphTargetSequences(e,t,n){const i={},r=/^([\w-]*?)([\d]+)$/;for(let t=0,n=e.length;t<n;t++){const n=e[t],o=n.name.match(r);if(o&&o.length>1){const e=o[1];let t=i[e];t||(i[e]=t=[]),t.push(n)}}const o=[];for(const e in i)o.push(this.CreateFromMorphTargetSequence(e,i[e],t,n));return o}static parseAnimation(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const n=function(e,t,n,i,r){if(0!==n.length){const o=[],a=[];NL.flattenJSON(n,o,a,i),0!==o.length&&r.push(new e(t,o,a))}},i=[],r=e.name||"default",o=e.fps||30,a=e.blendMode;let s=e.length||-1;const l=e.hierarchy||[];for(let e=0;e<l.length;e++){const r=l[e].keys;if(r&&0!==r.length)if(r[0].morphTargets){const e={};let t;for(t=0;t<r.length;t++)if(r[t].morphTargets)for(let n=0;n<r[t].morphTargets.length;n++)e[r[t].morphTargets[n]]=-1;for(const n in e){const e=[],o=[];for(let i=0;i!==r[t].morphTargets.length;++i){const i=r[t];e.push(i.time),o.push(i.morphTarget===n?1:0)}i.push(new OL(".morphTargetInfluence["+n+"]",e,o))}s=e.length*(o||1)}else{const o=".bones["+t[e].name+"]";n(DL,o+".position",r,"pos",i),n(HL,o+".quaternion",r,"rot",i),n(DL,o+".scale",r,"scl",i)}}return 0===i.length?null:new this(r,s,i,a)}resetDuration(){let e=0;for(let t=0,n=this.tracks.length;t!==n;++t){const n=this.tracks[t];e=Math.max(e,n.times[n.times.length-1])}return this.duration=e,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){const e=[];for(let t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function UL(e){if(void 0===e.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const t=function(e){switch(e.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return OL;case"vector":case"vector2":case"vector3":case"vector4":return DL;case"color":return IL;case"quaternion":return HL;case"bool":case"boolean":return kL;case"string":return FL}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+e)}(e.type);if(void 0===e.times){const t=[],n=[];NL.flattenJSON(e.keys,t,n,"value"),e.times=t,e.values=n}return void 0!==t.parse?t.parse(e):new t(e.name,e.times,e.values,e.interpolation)}const jL={enabled:!1,files:{},add:function(e,t){!1!==this.enabled&&(this.files[e]=t)},get:function(e){if(!1!==this.enabled)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}},WL=new class{constructor(e,t,n){const i=this;let r,o=!1,a=0,s=0;const l=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=n,this.itemStart=function(e){s++,!1===o&&void 0!==i.onStart&&i.onStart(e,a,s),o=!0},this.itemEnd=function(e){a++,void 0!==i.onProgress&&i.onProgress(e,a,s),a===s&&(o=!1,void 0!==i.onLoad&&i.onLoad())},this.itemError=function(e){void 0!==i.onError&&i.onError(e)},this.resolveURL=function(e){return r?r(e):e},this.setURLModifier=function(e){return r=e,this},this.addHandler=function(e,t){return l.push(e,t),this},this.removeHandler=function(e){const t=l.indexOf(e);return-1!==t&&l.splice(t,2),this},this.getHandler=function(e){for(let t=0,n=l.length;t<n;t+=2){const n=l[t],i=l[t+1];if(n.global&&(n.lastIndex=0),n.test(e))return i}return null}}};class qL{constructor(e){this.manager=void 0!==e?e:WL,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){const n=this;return new Promise((function(i,r){n.load(e,i,t,r)}))}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}}const JL={};class $L extends qL{constructor(e){super(e)}load(e,t,n,i){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const r=this,o=jL.get(e);if(void 0!==o)return r.manager.itemStart(e),setTimeout((function(){t&&t(o),r.manager.itemEnd(e)}),0),o;if(void 0!==JL[e])return void JL[e].push({onLoad:t,onProgress:n,onError:i});const a=e.match(/^data:(.*?)(;base64)?,(.*)$/);let s;if(a){const n=a[1],o=!!a[2];let s=a[3];s=decodeURIComponent(s),o&&(s=atob(s));try{let i;const o=(this.responseType||"").toLowerCase();switch(o){case"arraybuffer":case"blob":const e=new Uint8Array(s.length);for(let t=0;t<s.length;t++)e[t]=s.charCodeAt(t);i="blob"===o?new Blob([e.buffer],{type:n}):e.buffer;break;case"document":const t=new DOMParser;i=t.parseFromString(s,n);break;case"json":i=JSON.parse(s);break;default:i=s}setTimeout((function(){t&&t(i),r.manager.itemEnd(e)}),0)}catch(t){setTimeout((function(){i&&i(t),r.manager.itemError(e),r.manager.itemEnd(e)}),0)}}else{JL[e]=[],JL[e].push({onLoad:t,onProgress:n,onError:i}),s=new XMLHttpRequest,s.open("GET",e,!0),s.addEventListener("load",(function(t){const n=this.response,i=JL[e];if(delete JL[e],200===this.status||0===this.status){0===this.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),jL.add(e,n);for(let e=0,t=i.length;e<t;e++){const t=i[e];t.onLoad&&t.onLoad(n)}r.manager.itemEnd(e)}else{for(let e=0,n=i.length;e<n;e++){const n=i[e];n.onError&&n.onError(t)}r.manager.itemError(e),r.manager.itemEnd(e)}}),!1),s.addEventListener("progress",(function(t){const n=JL[e];for(let e=0,i=n.length;e<i;e++){const i=n[e];i.onProgress&&i.onProgress(t)}}),!1),s.addEventListener("error",(function(t){const n=JL[e];delete JL[e];for(let e=0,i=n.length;e<i;e++){const i=n[e];i.onError&&i.onError(t)}r.manager.itemError(e),r.manager.itemEnd(e)}),!1),s.addEventListener("abort",(function(t){const n=JL[e];delete JL[e];for(let e=0,i=n.length;e<i;e++){const i=n[e];i.onError&&i.onError(t)}r.manager.itemError(e),r.manager.itemEnd(e)}),!1),void 0!==this.responseType&&(s.responseType=this.responseType),void 0!==this.withCredentials&&(s.withCredentials=this.withCredentials),s.overrideMimeType&&s.overrideMimeType(void 0!==this.mimeType?this.mimeType:"text/plain");for(const e in this.requestHeader)s.setRequestHeader(e,this.requestHeader[e]);s.send(null)}return r.manager.itemStart(e),s}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}}class XL extends qL{constructor(e){super(e)}load(e,t,n,i){void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const r=this,o=jL.get(e);if(void 0!==o)return r.manager.itemStart(e),setTimeout((function(){t&&t(o),r.manager.itemEnd(e)}),0),o;const a=document.createElementNS("http://www.w3.org/1999/xhtml","img");function s(){a.removeEventListener("load",s,!1),a.removeEventListener("error",l,!1),jL.add(e,this),t&&t(this),r.manager.itemEnd(e)}function l(t){a.removeEventListener("load",s,!1),a.removeEventListener("error",l,!1),i&&i(t),r.manager.itemError(e),r.manager.itemEnd(e)}return a.addEventListener("load",s,!1),a.addEventListener("error",l,!1),"data:"!==e.substr(0,5)&&void 0!==this.crossOrigin&&(a.crossOrigin=this.crossOrigin),r.manager.itemStart(e),a.src=e,a}}class YL extends qL{constructor(e){super(e)}load(e,t,n,i){const r=new FS,o=new XL(this.manager);o.setCrossOrigin(this.crossOrigin),o.setPath(this.path);let a=0;function s(n){o.load(e[n],(function(e){r.images[n]=e,a++,6===a&&(r.needsUpdate=!0,t&&t(r))}),void 0,i)}for(let t=0;t<e.length;++t)s(t);return r}}class KL extends qL{constructor(e){super(e)}load(e,t,n,i){const r=new yE,o=new XL(this.manager);return o.setCrossOrigin(this.crossOrigin),o.setPath(this.path),o.load(e,(function(n){r.image=n;const i=e.search(/\.jpe?g($|\?)/i)>0||0===e.search(/^data\:image\/jpeg/);r.format=i?UZ:jZ,r.needsUpdate=!0,void 0!==t&&t(r)}),n,i),r}}class QL{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(e,t){const n=this.getUtoTmapping(e);return this.getPoint(n,t)}getPoints(e=5){const t=[];for(let n=0;n<=e;n++)t.push(this.getPoint(n/e));return t}getSpacedPoints(e=5){const t=[];for(let n=0;n<=e;n++)t.push(this.getPointAt(n/e));return t}getLength(){const e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const t=[];let n,i=this.getPoint(0),r=0;t.push(0);for(let o=1;o<=e;o++)n=this.getPoint(o/e),r+=n.distanceTo(i),t.push(r),i=n;return this.cacheArcLengths=t,t}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,t){const n=this.getLengths();let i=0;const r=n.length;let o;o=t||e*n[r-1];let a,s=0,l=r-1;for(;s<=l;)if(i=Math.floor(s+(l-s)/2),a=n[i]-o,a<0)s=i+1;else{if(!(a>0)){l=i;break}l=i-1}if(i=l,n[i]===o)return i/(r-1);const p=n[i];return(i+(o-p)/(n[i+1]-p))/(r-1)}getTangent(e,t){const n=1e-4;let i=e-n,r=e+n;i<0&&(i=0),r>1&&(r=1);const o=this.getPoint(i),a=this.getPoint(r),s=t||(o.isVector2?new dE:new wE);return s.copy(a).sub(o).normalize(),s}getTangentAt(e,t){const n=this.getUtoTmapping(e);return this.getTangent(n,t)}computeFrenetFrames(e,t){const n=new wE,i=[],r=[],o=[],a=new wE,s=new tM;for(let t=0;t<=e;t++){const n=t/e;i[t]=this.getTangentAt(n,new wE),i[t].normalize()}r[0]=new wE,o[0]=new wE;let l=Number.MAX_VALUE;const p=Math.abs(i[0].x),u=Math.abs(i[0].y),h=Math.abs(i[0].z);p<=l&&(l=p,n.set(1,0,0)),u<=l&&(l=u,n.set(0,1,0)),h<=l&&n.set(0,0,1),a.crossVectors(i[0],n).normalize(),r[0].crossVectors(i[0],a),o[0].crossVectors(i[0],r[0]);for(let t=1;t<=e;t++){if(r[t]=r[t-1].clone(),o[t]=o[t-1].clone(),a.crossVectors(i[t-1],i[t]),a.length()>Number.EPSILON){a.normalize();const e=Math.acos(uE(i[t-1].dot(i[t]),-1,1));r[t].applyMatrix4(s.makeRotationAxis(a,e))}o[t].crossVectors(i[t],r[t])}if(!0===t){let t=Math.acos(uE(r[0].dot(r[e]),-1,1));t/=e,i[0].dot(a.crossVectors(r[0],r[e]))>0&&(t=-t);for(let n=1;n<=e;n++)r[n].applyMatrix4(s.makeRotationAxis(i[n],t*n)),o[n].crossVectors(i[n],r[n])}return{tangents:i,normals:r,binormals:o}}clone(){return(new this.constructor).copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){const e={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}class eB extends QL{constructor(e=0,t=0,n=1,i=1,r=0,o=2*Math.PI,a=!1,s=0){super(),this.type="EllipseCurve",this.aX=e,this.aY=t,this.xRadius=n,this.yRadius=i,this.aStartAngle=r,this.aEndAngle=o,this.aClockwise=a,this.aRotation=s}getPoint(e,t){const n=t||new dE,i=2*Math.PI;let r=this.aEndAngle-this.aStartAngle;const o=Math.abs(r)<Number.EPSILON;for(;r<0;)r+=i;for(;r>i;)r-=i;r<Number.EPSILON&&(r=o?0:i),!0!==this.aClockwise||o||(r===i?r=-i:r-=i);const a=this.aStartAngle+e*r;let s=this.aX+this.xRadius*Math.cos(a),l=this.aY+this.yRadius*Math.sin(a);if(0!==this.aRotation){const e=Math.cos(this.aRotation),t=Math.sin(this.aRotation),n=s-this.aX,i=l-this.aY;s=n*e-i*t+this.aX,l=n*t+i*e+this.aY}return n.set(s,l)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){const e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}}eB.prototype.isEllipseCurve=!0;class tB extends eB{constructor(e,t,n,i,r,o){super(e,t,n,n,i,r,o),this.type="ArcCurve"}}function nB(){let e=0,t=0,n=0,i=0;function r(r,o,a,s){e=r,t=a,n=-3*r+3*o-2*a-s,i=2*r-2*o+a+s}return{initCatmullRom:function(e,t,n,i,o){r(t,n,o*(n-e),o*(i-t))},initNonuniformCatmullRom:function(e,t,n,i,o,a,s){let l=(t-e)/o-(n-e)/(o+a)+(n-t)/a,p=(n-t)/a-(i-t)/(a+s)+(i-n)/s;l*=a,p*=a,r(t,n,l,p)},calc:function(r){const o=r*r;return e+t*r+n*o+i*(o*r)}}}tB.prototype.isArcCurve=!0;const iB=new wE,rB=new nB,oB=new nB,aB=new nB;class sB extends QL{constructor(e=[],t=!1,n="centripetal",i=.5){super(),this.type="CatmullRomCurve3",this.points=e,this.closed=t,this.curveType=n,this.tension=i}getPoint(e,t=new wE){const n=t,i=this.points,r=i.length,o=(r-(this.closed?0:1))*e;let a,s,l=Math.floor(o),p=o-l;this.closed?l+=l>0?0:(Math.floor(Math.abs(l)/r)+1)*r:0===p&&l===r-1&&(l=r-2,p=1),this.closed||l>0?a=i[(l-1)%r]:(iB.subVectors(i[0],i[1]).add(i[0]),a=iB);const u=i[l%r],h=i[(l+1)%r];if(this.closed||l+2<r?s=i[(l+2)%r]:(iB.subVectors(i[r-1],i[r-2]).add(i[r-1]),s=iB),"centripetal"===this.curveType||"chordal"===this.curveType){const e="chordal"===this.curveType?.5:.25;let t=Math.pow(a.distanceToSquared(u),e),n=Math.pow(u.distanceToSquared(h),e),i=Math.pow(h.distanceToSquared(s),e);n<1e-4&&(n=1),t<1e-4&&(t=n),i<1e-4&&(i=n),rB.initNonuniformCatmullRom(a.x,u.x,h.x,s.x,t,n,i),oB.initNonuniformCatmullRom(a.y,u.y,h.y,s.y,t,n,i),aB.initNonuniformCatmullRom(a.z,u.z,h.z,s.z,t,n,i)}else"catmullrom"===this.curveType&&(rB.initCatmullRom(a.x,u.x,h.x,s.x,this.tension),oB.initCatmullRom(a.y,u.y,h.y,s.y,this.tension),aB.initCatmullRom(a.z,u.z,h.z,s.z,this.tension));return n.set(rB.calc(p),oB.calc(p),aB.calc(p)),n}copy(e){super.copy(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const n=e.points[t];this.points.push(n.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,n=this.points.length;t<n;t++){const n=this.points[t];e.points.push(n.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const n=e.points[t];this.points.push((new wE).fromArray(n))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}}function lB(e,t,n,i,r){const o=.5*(i-t),a=.5*(r-n),s=e*e;return(2*n-2*i+o+a)*(e*s)+(-3*n+3*i-2*o-a)*s+o*e+n}function pB(e,t,n,i){return function(e,t){const n=1-e;return n*n*t}(e,t)+function(e,t){return 2*(1-e)*e*t}(e,n)+function(e,t){return e*e*t}(e,i)}function uB(e,t,n,i,r){return function(e,t){const n=1-e;return n*n*n*t}(e,t)+function(e,t){const n=1-e;return 3*n*n*e*t}(e,n)+function(e,t){return 3*(1-e)*e*e*t}(e,i)+function(e,t){return e*e*e*t}(e,r)}sB.prototype.isCatmullRomCurve3=!0;class hB extends QL{constructor(e=new dE,t=new dE,n=new dE,i=new dE){super(),this.type="CubicBezierCurve",this.v0=e,this.v1=t,this.v2=n,this.v3=i}getPoint(e,t=new dE){const n=t,i=this.v0,r=this.v1,o=this.v2,a=this.v3;return n.set(uB(e,i.x,r.x,o.x,a.x),uB(e,i.y,r.y,o.y,a.y)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}hB.prototype.isCubicBezierCurve=!0;class cB extends QL{constructor(e=new wE,t=new wE,n=new wE,i=new wE){super(),this.type="CubicBezierCurve3",this.v0=e,this.v1=t,this.v2=n,this.v3=i}getPoint(e,t=new wE){const n=t,i=this.v0,r=this.v1,o=this.v2,a=this.v3;return n.set(uB(e,i.x,r.x,o.x,a.x),uB(e,i.y,r.y,o.y,a.y),uB(e,i.z,r.z,o.z,a.z)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}cB.prototype.isCubicBezierCurve3=!0;class _B extends QL{constructor(e=new dE,t=new dE){super(),this.type="LineCurve",this.v1=e,this.v2=t}getPoint(e,t=new dE){const n=t;return 1===e?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t){const n=t||new dE;return n.copy(this.v2).sub(this.v1).normalize(),n}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}_B.prototype.isLineCurve=!0;class dB extends QL{constructor(e=new dE,t=new dE,n=new dE){super(),this.type="QuadraticBezierCurve",this.v0=e,this.v1=t,this.v2=n}getPoint(e,t=new dE){const n=t,i=this.v0,r=this.v1,o=this.v2;return n.set(pB(e,i.x,r.x,o.x),pB(e,i.y,r.y,o.y)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}dB.prototype.isQuadraticBezierCurve=!0;class mB extends QL{constructor(e=new wE,t=new wE,n=new wE){super(),this.type="QuadraticBezierCurve3",this.v0=e,this.v1=t,this.v2=n}getPoint(e,t=new wE){const n=t,i=this.v0,r=this.v1,o=this.v2;return n.set(pB(e,i.x,r.x,o.x),pB(e,i.y,r.y,o.y),pB(e,i.z,r.z,o.z)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}mB.prototype.isQuadraticBezierCurve3=!0;class PB extends QL{constructor(e=[]){super(),this.type="SplineCurve",this.points=e}getPoint(e,t=new dE){const n=t,i=this.points,r=(i.length-1)*e,o=Math.floor(r),a=r-o,s=i[0===o?o:o-1],l=i[o],p=i[o>i.length-2?i.length-1:o+1],u=i[o>i.length-3?i.length-1:o+2];return n.set(lB(a,s.x,l.x,p.x,u.x),lB(a,s.y,l.y,p.y,u.y)),n}copy(e){super.copy(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const n=e.points[t];this.points.push(n.clone())}return this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,n=this.points.length;t<n;t++){const n=this.points[t];e.points.push(n.toArray())}return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const n=e.points[t];this.points.push((new dE).fromArray(n))}return this}}PB.prototype.isSplineCurve=!0;var fB=Object.freeze({__proto__:null,ArcCurve:tB,CatmullRomCurve3:sB,CubicBezierCurve:hB,CubicBezierCurve3:cB,EllipseCurve:eB,LineCurve:_B,LineCurve3:class extends QL{constructor(e=new wE,t=new wE){super(),this.type="LineCurve3",this.isLineCurve3=!0,this.v1=e,this.v2=t}getPoint(e,t=new wE){const n=t;return 1===e?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n}getPointAt(e,t){return this.getPoint(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}},QuadraticBezierCurve:dB,QuadraticBezierCurve3:mB,SplineCurve:PB});class xB extends QL{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){const e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new _B(t,e))}getPoint(e){const t=e*this.getLength(),n=this.getCurveLengths();let i=0;for(;i<n.length;){if(n[i]>=t){const e=n[i]-t,r=this.curves[i],o=r.getLength(),a=0===o?0:1-e/o;return r.getPointAt(a)}i++}return null}getLength(){const e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const e=[];let t=0;for(let n=0,i=this.curves.length;n<i;n++)t+=this.curves[n].getLength(),e.push(t);return this.cacheLengths=e,e}getSpacedPoints(e=40){const t=[];for(let n=0;n<=e;n++)t.push(this.getPoint(n/e));return this.autoClose&&t.push(t[0]),t}getPoints(e=12){const t=[];let n;for(let i=0,r=this.curves;i<r.length;i++){const o=r[i],a=o&&o.isEllipseCurve?2*e:o&&(o.isLineCurve||o.isLineCurve3)?1:o&&o.isSplineCurve?e*o.points.length:e,s=o.getPoints(a);for(let e=0;e<s.length;e++){const i=s[e];n&&n.equals(i)||(t.push(i),n=i)}}return this.autoClose&&t.length>1&&!t[t.length-1].equals(t[0])&&t.push(t[0]),t}copy(e){super.copy(e),this.curves=[];for(let t=0,n=e.curves.length;t<n;t++){const n=e.curves[t];this.curves.push(n.clone())}return this.autoClose=e.autoClose,this}toJSON(){const e=super.toJSON();e.autoClose=this.autoClose,e.curves=[];for(let t=0,n=this.curves.length;t<n;t++){const n=this.curves[t];e.curves.push(n.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.autoClose=e.autoClose,this.curves=[];for(let t=0,n=e.curves.length;t<n;t++){const n=e.curves[t];this.curves.push((new fB[n.type]).fromJSON(n))}return this}}class yB extends xB{constructor(e){super(),this.type="Path",this.currentPoint=new dE,e&&this.setFromPoints(e)}setFromPoints(e){this.moveTo(e[0].x,e[0].y);for(let t=1,n=e.length;t<n;t++)this.lineTo(e[t].x,e[t].y);return this}moveTo(e,t){return this.currentPoint.set(e,t),this}lineTo(e,t){const n=new _B(this.currentPoint.clone(),new dE(e,t));return this.curves.push(n),this.currentPoint.set(e,t),this}quadraticCurveTo(e,t,n,i){const r=new dB(this.currentPoint.clone(),new dE(e,t),new dE(n,i));return this.curves.push(r),this.currentPoint.set(n,i),this}bezierCurveTo(e,t,n,i,r,o){const a=new hB(this.currentPoint.clone(),new dE(e,t),new dE(n,i),new dE(r,o));return this.curves.push(a),this.currentPoint.set(r,o),this}splineThru(e){const t=[this.currentPoint.clone()].concat(e),n=new PB(t);return this.curves.push(n),this.currentPoint.copy(e[e.length-1]),this}arc(e,t,n,i,r,o){const a=this.currentPoint.x,s=this.currentPoint.y;return this.absarc(e+a,t+s,n,i,r,o),this}absarc(e,t,n,i,r,o){return this.absellipse(e,t,n,n,i,r,o),this}ellipse(e,t,n,i,r,o,a,s){const l=this.currentPoint.x,p=this.currentPoint.y;return this.absellipse(e+l,t+p,n,i,r,o,a,s),this}absellipse(e,t,n,i,r,o,a,s){const l=new eB(e,t,n,i,r,o,a,s);if(this.curves.length>0){const e=l.getPoint(0);e.equals(this.currentPoint)||this.lineTo(e.x,e.y)}this.curves.push(l);const p=l.getPoint(1);return this.currentPoint.copy(p),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}toJSON(){const e=super.toJSON();return e.currentPoint=this.currentPoint.toArray(),e}fromJSON(e){return super.fromJSON(e),this.currentPoint.fromArray(e.currentPoint),this}}class vB extends yB{constructor(e){super(e),this.uuid=pE(),this.type="Shape",this.holes=[]}getPointsHoles(e){const t=[];for(let n=0,i=this.holes.length;n<i;n++)t[n]=this.holes[n].getPoints(e);return t}extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}copy(e){super.copy(e),this.holes=[];for(let t=0,n=e.holes.length;t<n;t++){const n=e.holes[t];this.holes.push(n.clone())}return this}toJSON(){const e=super.toJSON();e.uuid=this.uuid,e.holes=[];for(let t=0,n=this.holes.length;t<n;t++){const n=this.holes[t];e.holes.push(n.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.uuid=e.uuid,this.holes=[];for(let t=0,n=e.holes.length;t<n;t++){const n=e.holes[t];this.holes.push((new yB).fromJSON(n))}return this}}class gB extends EM{constructor(e,t=1){super(),this.type="Light",this.color=new XM(e),this.intensity=t}dispose(){}copy(e){return super.copy(e),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,void 0!==this.groundColor&&(t.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(t.object.distance=this.distance),void 0!==this.angle&&(t.object.angle=this.angle),void 0!==this.decay&&(t.object.decay=this.decay),void 0!==this.penumbra&&(t.object.penumbra=this.penumbra),void 0!==this.shadow&&(t.object.shadow=this.shadow.toJSON()),t}}gB.prototype.isLight=!0,class extends gB{constructor(e,t,n){super(e,n),this.type="HemisphereLight",this.position.copy(EM.DefaultUp),this.updateMatrix(),this.groundColor=new XM(t)}copy(e){return gB.prototype.copy.call(this,e),this.groundColor.copy(e.groundColor),this}}.prototype.isHemisphereLight=!0;const bB=new tM,zB=new wE,wB=new wE;class ZB{constructor(e){this.camera=e,this.bias=0,this.normalBias=0,this.radius=1,this.mapSize=new dE(512,512),this.map=null,this.mapPass=null,this.matrix=new tM,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new WS,this._frameExtents=new dE(1,1),this._viewportCount=1,this._viewports=[new gE(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const t=this.camera,n=this.matrix;zB.setFromMatrixPosition(e.matrixWorld),t.position.copy(zB),wB.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(wB),t.updateMatrixWorld(),bB.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(bB),n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(t.projectionMatrix),n.multiply(t.matrixWorldInverse)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return(new this.constructor).copy(this)}toJSON(){const e={};return 0!==this.bias&&(e.bias=this.bias),0!==this.normalBias&&(e.normalBias=this.normalBias),1!==this.radius&&(e.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class EB extends ZB{constructor(){super(new OS(50,1,.5,500)),this.focus=1}updateMatrices(e){const t=this.camera,n=2*lE*e.angle*this.focus,i=this.mapSize.width/this.mapSize.height,r=e.distance||t.far;n===t.fov&&i===t.aspect&&r===t.far||(t.fov=n,t.aspect=i,t.far=r,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}EB.prototype.isSpotLightShadow=!0,class extends gB{constructor(e,t,n=0,i=Math.PI/3,r=0,o=1){super(e,t),this.type="SpotLight",this.position.copy(EM.DefaultUp),this.updateMatrix(),this.target=new EM,this.distance=n,this.angle=i,this.penumbra=r,this.decay=o,this.shadow=new EB}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}.prototype.isSpotLight=!0;const MB=new tM,SB=new wE,CB=new wE;class NB extends ZB{constructor(){super(new OS(90,1,.5,500)),this._frameExtents=new dE(4,2),this._viewportCount=6,this._viewports=[new gE(2,1,1,1),new gE(0,1,1,1),new gE(3,1,1,1),new gE(1,1,1,1),new gE(3,0,1,1),new gE(1,0,1,1)],this._cubeDirections=[new wE(1,0,0),new wE(-1,0,0),new wE(0,0,1),new wE(0,0,-1),new wE(0,1,0),new wE(0,-1,0)],this._cubeUps=[new wE(0,1,0),new wE(0,1,0),new wE(0,1,0),new wE(0,1,0),new wE(0,0,1),new wE(0,0,-1)]}updateMatrices(e,t=0){const n=this.camera,i=this.matrix,r=e.distance||n.far;r!==n.far&&(n.far=r,n.updateProjectionMatrix()),SB.setFromMatrixPosition(e.matrixWorld),n.position.copy(SB),CB.copy(n.position),CB.add(this._cubeDirections[t]),n.up.copy(this._cubeUps[t]),n.lookAt(CB),n.updateMatrixWorld(),i.makeTranslation(-SB.x,-SB.y,-SB.z),MB.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(MB)}}NB.prototype.isPointLightShadow=!0,class extends gB{constructor(e,t,n=0,i=1){super(e,t),this.type="PointLight",this.distance=n,this.decay=i,this.shadow=new NB}get power(){return 4*this.intensity*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}.prototype.isPointLight=!0;class AB extends IS{constructor(e=-1,t=1,n=1,i=-1,r=.1,o=2e3){super(),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=n,this.bottom=i,this.near=r,this.far=o,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=null===e.view?null:Object.assign({},e.view),this}setViewOffset(e,t,n,i,r,o){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=i,this.view.width=r,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,i=(this.top+this.bottom)/2;let r=n-e,o=n+e,a=i+t,s=i-t;if(null!==this.view&&this.view.enabled){const e=(this.right-this.left)/this.view.fullWidth/this.zoom,t=(this.top-this.bottom)/this.view.fullHeight/this.zoom;r+=e*this.view.offsetX,o=r+e*this.view.width,a-=t*this.view.offsetY,s=a-t*this.view.height}this.projectionMatrix.makeOrthographic(r,o,a,s,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,null!==this.view&&(t.object.view=Object.assign({},this.view)),t}}AB.prototype.isOrthographicCamera=!0;class LB extends ZB{constructor(){super(new AB(-5,5,5,-5,.5,500))}}LB.prototype.isDirectionalLightShadow=!0,class extends gB{constructor(e,t){super(e,t),this.type="DirectionalLight",this.position.copy(EM.DefaultUp),this.updateMatrix(),this.target=new EM,this.shadow=new LB}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}.prototype.isDirectionalLight=!0,class extends gB{constructor(e,t){super(e,t),this.type="AmbientLight"}}.prototype.isAmbientLight=!0,class extends gB{constructor(e,t,n=10,i=10){super(e,t),this.type="RectAreaLight",this.width=n,this.height=i}copy(e){return super.copy(e),this.width=e.width,this.height=e.height,this}toJSON(e){const t=super.toJSON(e);return t.object.width=this.width,t.object.height=this.height,t}}.prototype.isRectAreaLight=!0;class BB{constructor(){this.coefficients=[];for(let e=0;e<9;e++)this.coefficients.push(new wE)}set(e){for(let t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this}zero(){for(let e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}getAt(e,t){const n=e.x,i=e.y,r=e.z,o=this.coefficients;return t.copy(o[0]).multiplyScalar(.282095),t.addScaledVector(o[1],.488603*i),t.addScaledVector(o[2],.488603*r),t.addScaledVector(o[3],.488603*n),t.addScaledVector(o[4],n*i*1.092548),t.addScaledVector(o[5],i*r*1.092548),t.addScaledVector(o[6],.315392*(3*r*r-1)),t.addScaledVector(o[7],n*r*1.092548),t.addScaledVector(o[8],.546274*(n*n-i*i)),t}getIrradianceAt(e,t){const n=e.x,i=e.y,r=e.z,o=this.coefficients;return t.copy(o[0]).multiplyScalar(.886227),t.addScaledVector(o[1],1.023328*i),t.addScaledVector(o[2],1.023328*r),t.addScaledVector(o[3],1.023328*n),t.addScaledVector(o[4],.858086*n*i),t.addScaledVector(o[5],.858086*i*r),t.addScaledVector(o[6],.743125*r*r-.247708),t.addScaledVector(o[7],.858086*n*r),t.addScaledVector(o[8],.429043*(n*n-i*i)),t}add(e){for(let t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this}addScaledSH(e,t){for(let n=0;n<9;n++)this.coefficients[n].addScaledVector(e.coefficients[n],t);return this}scale(e){for(let t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this}lerp(e,t){for(let n=0;n<9;n++)this.coefficients[n].lerp(e.coefficients[n],t);return this}equals(e){for(let t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0}copy(e){return this.set(e.coefficients)}clone(){return(new this.constructor).copy(this)}fromArray(e,t=0){const n=this.coefficients;for(let i=0;i<9;i++)n[i].fromArray(e,t+3*i);return this}toArray(e=[],t=0){const n=this.coefficients;for(let i=0;i<9;i++)n[i].toArray(e,t+3*i);return e}static getBasisAt(e,t){const n=e.x,i=e.y,r=e.z;t[0]=.282095,t[1]=.488603*i,t[2]=.488603*r,t[3]=.488603*n,t[4]=1.092548*n*i,t[5]=1.092548*i*r,t[6]=.315392*(3*r*r-1),t[7]=1.092548*n*r,t[8]=.546274*(n*n-i*i)}}BB.prototype.isSphericalHarmonics3=!0;class TB extends gB{constructor(e=new BB,t=1){super(void 0,t),this.sh=e}copy(e){return super.copy(e),this.sh.copy(e.sh),this}fromJSON(e){return this.intensity=e.intensity,this.sh.fromArray(e.sh),this}toJSON(e){const t=super.toJSON(e);return t.object.sh=this.sh.toArray(),t}}let VB;TB.prototype.isLightProbe=!0,class extends cS{constructor(){super(),this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(e){return super.copy(e),this.instanceCount=e.instanceCount,this}clone(){return(new this.constructor).copy(this)}toJSON(){const e=super.toJSON(this);return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}}.prototype.isInstancedBufferGeometry=!0,class extends eS{constructor(e,t,n,i){"number"==typeof n&&(i=n,n=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument.")),super(e,t,n),this.meshPerAttribute=i||1}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}.prototype.isInstancedBufferAttribute=!0,class extends qL{constructor(e){super(e),"undefined"==typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"==typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(e){return this.options=e,this}load(e,t,n,i){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const r=this,o=jL.get(e);if(void 0!==o)return r.manager.itemStart(e),setTimeout((function(){t&&t(o),r.manager.itemEnd(e)}),0),o;const a={};a.credentials="anonymous"===this.crossOrigin?"same-origin":"include",a.headers=this.requestHeader,fetch(e,a).then((function(e){return e.blob()})).then((function(e){return createImageBitmap(e,Object.assign(r.options,{colorSpaceConversion:"none"}))})).then((function(n){jL.add(e,n),t&&t(n),r.manager.itemEnd(e)})).catch((function(t){i&&i(t),r.manager.itemError(e),r.manager.itemEnd(e)})),r.manager.itemStart(e)}}.prototype.isImageBitmapLoader=!0;class kB extends qL{constructor(e){super(e)}load(e,t,n,i){const r=this,o=new $L(this.manager);o.setResponseType("arraybuffer"),o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,(function(n){try{const e=n.slice(0);(void 0===VB&&(VB=new(window.AudioContext||window.webkitAudioContext)),VB).decodeAudioData(e,(function(e){t(e)}))}catch(t){i?i(t):console.error(t),r.manager.itemError(e)}}),n,i)}}(class extends TB{constructor(e,t,n=1){super(void 0,n);const i=(new XM).set(e),r=(new XM).set(t),o=new wE(i.r,i.g,i.b),a=new wE(r.r,r.g,r.b),s=Math.sqrt(Math.PI),l=s*Math.sqrt(.75);this.sh.coefficients[0].copy(o).add(a).multiplyScalar(s),this.sh.coefficients[1].copy(o).sub(a).multiplyScalar(l)}}).prototype.isHemisphereLightProbe=!0,class extends TB{constructor(e,t=1){super(void 0,t);const n=(new XM).set(e);this.sh.coefficients[0].set(n.r,n.g,n.b).multiplyScalar(2*Math.sqrt(Math.PI))}}.prototype.isAmbientLightProbe=!0;class IB{constructor(e,t,n){let i,r,o;switch(this.binding=e,this.valueSize=n,t){case"quaternion":i=this._slerp,r=this._slerpAdditive,o=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*n),this._workIndex=5;break;case"string":case"bool":i=this._select,r=this._select,o=this._setAdditiveIdentityOther,this.buffer=new Array(5*n);break;default:i=this._lerp,r=this._lerpAdditive,o=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*n)}this._mixBufferRegion=i,this._mixBufferRegionAdditive=r,this._setIdentity=o,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(e,t){const n=this.buffer,i=this.valueSize,r=e*i+i;let o=this.cumulativeWeight;if(0===o){for(let e=0;e!==i;++e)n[r+e]=n[e];o=t}else{o+=t;const e=t/o;this._mixBufferRegion(n,r,0,e,i)}this.cumulativeWeight=o}accumulateAdditive(e){const t=this.buffer,n=this.valueSize,i=n*this._addIndex;0===this.cumulativeWeightAdditive&&this._setIdentity(),this._mixBufferRegionAdditive(t,i,0,e,n),this.cumulativeWeightAdditive+=e}apply(e){const t=this.valueSize,n=this.buffer,i=e*t+t,r=this.cumulativeWeight,o=this.cumulativeWeightAdditive,a=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,r<1){const e=t*this._origIndex;this._mixBufferRegion(n,i,e,1-r,t)}o>0&&this._mixBufferRegionAdditive(n,i,this._addIndex*t,1,t);for(let e=t,r=t+t;e!==r;++e)if(n[e]!==n[e+t]){a.setValue(n,i);break}}saveOriginalState(){const e=this.binding,t=this.buffer,n=this.valueSize,i=n*this._origIndex;e.getValue(t,i);for(let e=n,r=i;e!==r;++e)t[e]=t[i+e%n];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const e=3*this.valueSize;this.binding.setValue(this.buffer,e)}_setAdditiveIdentityNumeric(){const e=this._addIndex*this.valueSize,t=e+this.valueSize;for(let n=e;n<t;n++)this.buffer[n]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const e=this._origIndex*this.valueSize,t=this._addIndex*this.valueSize;for(let n=0;n<this.valueSize;n++)this.buffer[t+n]=this.buffer[e+n]}_select(e,t,n,i,r){if(i>=.5)for(let i=0;i!==r;++i)e[t+i]=e[n+i]}_slerp(e,t,n,i){zE.slerpFlat(e,t,e,t,e,n,i)}_slerpAdditive(e,t,n,i,r){const o=this._workIndex*r;zE.multiplyQuaternionsFlat(e,o,e,t,e,n),zE.slerpFlat(e,t,e,t,e,o,i)}_lerp(e,t,n,i,r){const o=1-i;for(let a=0;a!==r;++a){const r=t+a;e[r]=e[r]*o+e[n+a]*i}}_lerpAdditive(e,t,n,i,r){for(let o=0;o!==r;++o){const r=t+o;e[r]=e[r]+e[n+o]*i}}}const OB=new RegExp("[\\[\\]\\.:\\/]","g"),RB="[^\\[\\]\\.:\\/]",HB="[^"+"\\[\\]\\.:\\/".replace("\\.","")+"]",FB=/((?:WC+[\/:])*)/.source.replace("WC",RB),DB=/(WCOD+)?/.source.replace("WCOD",HB),GB=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",RB),UB=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",RB),jB=new RegExp("^"+FB+DB+GB+UB+"$"),WB=["material","materials","bones"];class qB{constructor(e,t,n){this.path=t,this.parsedPath=n||qB.parseTrackName(t),this.node=qB.findNode(e,this.parsedPath.nodeName)||e,this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,t,n){return e&&e.isAnimationObjectGroup?new qB.Composite(e,t,n):new qB(e,t,n)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(OB,"")}static parseTrackName(e){const t=jB.exec(e);if(!t)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const n={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},i=n.nodeName&&n.nodeName.lastIndexOf(".");if(void 0!==i&&-1!==i){const e=n.nodeName.substring(i+1);-1!==WB.indexOf(e)&&(n.nodeName=n.nodeName.substring(0,i),n.objectName=e)}if(null===n.propertyName||0===n.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return n}static findNode(e,t){if(!t||""===t||"."===t||-1===t||t===e.name||t===e.uuid)return e;if(e.skeleton){const n=e.skeleton.getBoneByName(t);if(void 0!==n)return n}if(e.children){const n=function(e){for(let i=0;i<e.length;i++){const r=e[i];if(r.name===t||r.uuid===t)return r;const o=n(r.children);if(o)return o}return null},i=n(e.children);if(i)return i}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,t){e[t]=this.node[this.propertyName]}_getValue_array(e,t){const n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)e[t++]=n[i]}_getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}_setValue_direct(e,t){this.targetObject[this.propertyName]=e[t]}_setValue_direct_setNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,t){const n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)n[i]=e[t++]}_setValue_array_setNeedsUpdate(e,t){const n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)n[i]=e[t++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,t){const n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)n[i]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}_setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)}_setValue_fromArray_setNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,t){this.bind(),this.getValue(e,t)}_setValue_unbound(e,t){this.bind(),this.setValue(e,t)}bind(){let e=this.node;const t=this.parsedPath,n=t.objectName,i=t.propertyName;let r=t.propertyIndex;if(e||(e=qB.findNode(this.rootNode,t.nodeName)||this.rootNode,this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e)return void console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");if(n){let i=t.objectIndex;switch(n){case"materials":if(!e.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!e.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);e=e.material.materials;break;case"bones":if(!e.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);e=e.skeleton.bones;for(let t=0;t<e.length;t++)if(e[t].name===i){i=t;break}break;default:if(void 0===e[n])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);e=e[n]}if(void 0!==i){if(void 0===e[i])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);e=e[i]}}const o=e[i];if(void 0===o){const n=t.nodeName;return void console.error("THREE.PropertyBinding: Trying to update property for track: "+n+"."+i+" but it wasn't found.",e)}let a=this.Versioning.None;this.targetObject=e,void 0!==e.needsUpdate?a=this.Versioning.NeedsUpdate:void 0!==e.matrixWorldNeedsUpdate&&(a=this.Versioning.MatrixWorldNeedsUpdate);let s=this.BindingType.Direct;if(void 0!==r){if("morphTargetInfluences"===i){if(!e.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!e.geometry.isBufferGeometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences on THREE.Geometry. Use THREE.BufferGeometry instead.",this);if(!e.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==e.morphTargetDictionary[r]&&(r=e.morphTargetDictionary[r])}s=this.BindingType.ArrayElement,this.resolvedProperty=o,this.propertyIndex=r}else void 0!==o.fromArray&&void 0!==o.toArray?(s=this.BindingType.HasFromToArray,this.resolvedProperty=o):Array.isArray(o)?(s=this.BindingType.EntireArray,this.resolvedProperty=o):this.propertyName=i;this.getValue=this.GetterByBindingType[s],this.setValue=this.SetterByBindingTypeAndVersioning[s][a]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}qB.Composite=class{constructor(e,t,n){const i=n||qB.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,i)}getValue(e,t){this.bind();const n=this._targetGroup.nCachedObjects_,i=this._bindings[n];void 0!==i&&i.getValue(e,t)}setValue(e,t){const n=this._bindings;for(let i=this._targetGroup.nCachedObjects_,r=n.length;i!==r;++i)n[i].setValue(e,t)}bind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].bind()}unbind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].unbind()}},qB.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},qB.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},qB.prototype.GetterByBindingType=[qB.prototype._getValue_direct,qB.prototype._getValue_array,qB.prototype._getValue_arrayElement,qB.prototype._getValue_toArray],qB.prototype.SetterByBindingTypeAndVersioning=[[qB.prototype._setValue_direct,qB.prototype._setValue_direct_setNeedsUpdate,qB.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[qB.prototype._setValue_array,qB.prototype._setValue_array_setNeedsUpdate,qB.prototype._setValue_array_setMatrixWorldNeedsUpdate],[qB.prototype._setValue_arrayElement,qB.prototype._setValue_arrayElement_setNeedsUpdate,qB.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[qB.prototype._setValue_fromArray,qB.prototype._setValue_fromArray_setNeedsUpdate,qB.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class JB{constructor(e,t,n=null,i=t.blendMode){this._mixer=e,this._clip=t,this._localRoot=n,this.blendMode=i;const r=t.tracks,o=r.length,a=new Array(o),s={endingStart:YZ,endingEnd:YZ};for(let e=0;e!==o;++e){const t=r[e].createInterpolant(null);a[e]=t,t.settings=s}this._interpolantSettings=s,this._interpolants=a,this._propertyBindings=new Array(o),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=2201,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(e){return this._startTime=e,this}setLoop(e,t){return this.loop=e,this.repetitions=t,this}setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}fadeOut(e){return this._scheduleFading(e,1,0)}crossFadeFrom(e,t,n){if(e.fadeOut(t),this.fadeIn(t),n){const n=this._clip.duration,i=e._clip.duration,r=i/n,o=n/i;e.warp(1,r,t),this.warp(o,1,t)}return this}crossFadeTo(e,t,n){return e.crossFadeFrom(this,t,n)}stopFading(){const e=this._weightInterpolant;return null!==e&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}halt(e){return this.warp(this._effectiveTimeScale,0,e)}warp(e,t,n){const i=this._mixer,r=i.time,o=this.timeScale;let a=this._timeScaleInterpolant;null===a&&(a=i._lendControlInterpolant(),this._timeScaleInterpolant=a);const s=a.parameterPositions,l=a.sampleValues;return s[0]=r,s[1]=r+n,l[0]=e/o,l[1]=t/o,this}stopWarping(){const e=this._timeScaleInterpolant;return null!==e&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(e,t,n,i){if(!this.enabled)return void this._updateWeight(e);const r=this._startTime;if(null!==r){const i=(e-r)*n;if(i<0||0===n)return;this._startTime=null,t=n*i}t*=this._updateTimeScale(e);const o=this._updateTime(t),a=this._updateWeight(e);if(a>0){const e=this._interpolants,t=this._propertyBindings;if(2501===this.blendMode)for(let n=0,i=e.length;n!==i;++n)e[n].evaluate(o),t[n].accumulateAdditive(a);else for(let n=0,r=e.length;n!==r;++n)e[n].evaluate(o),t[n].accumulate(i,a)}}_updateWeight(e){let t=0;if(this.enabled){t=this.weight;const n=this._weightInterpolant;if(null!==n){const i=n.evaluate(e)[0];t*=i,e>n.parameterPositions[1]&&(this.stopFading(),0===i&&(this.enabled=!1))}}return this._effectiveWeight=t,t}_updateTimeScale(e){let t=0;if(!this.paused){t=this.timeScale;const n=this._timeScaleInterpolant;null!==n&&(t*=n.evaluate(e)[0],e>n.parameterPositions[1]&&(this.stopWarping(),0===t?this.paused=!0:this.timeScale=t))}return this._effectiveTimeScale=t,t}_updateTime(e){const t=this._clip.duration,n=this.loop;let i=this.time+e,r=this._loopCount;const o=2202===n;if(0===e)return-1===r?i:o&&1==(1&r)?t-i:i;if(2200===n){-1===r&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(i>=t)i=t;else{if(!(i<0)){this.time=i;break e}i=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=i,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(-1===r&&(e>=0?(r=0,this._setEndings(!0,0===this.repetitions,o)):this._setEndings(0===this.repetitions,!0,o)),i>=t||i<0){const n=Math.floor(i/t);i-=t*n,r+=Math.abs(n);const a=this.repetitions-r;if(a<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,i=e>0?t:0,this.time=i,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(1===a){const t=e<0;this._setEndings(t,!t,o)}else this._setEndings(!1,!1,o);this._loopCount=r,this.time=i,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:n})}}else this.time=i;if(o&&1==(1&r))return t-i}return i}_setEndings(e,t,n){const i=this._interpolantSettings;n?(i.endingStart=KZ,i.endingEnd=KZ):(i.endingStart=e?this.zeroSlopeAtStart?KZ:YZ:QZ,i.endingEnd=t?this.zeroSlopeAtEnd?KZ:YZ:QZ)}_scheduleFading(e,t,n){const i=this._mixer,r=i.time;let o=this._weightInterpolant;null===o&&(o=i._lendControlInterpolant(),this._weightInterpolant=o);const a=o.parameterPositions,s=o.sampleValues;return a[0]=r,s[0]=t,a[1]=r+e,s[1]=n,this}}(class extends oE{constructor(e){super(),this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(e,t){const n=e._localRoot||this._root,i=e._clip.tracks,r=i.length,o=e._propertyBindings,a=e._interpolants,s=n.uuid,l=this._bindingsByRootAndName;let p=l[s];void 0===p&&(p={},l[s]=p);for(let e=0;e!==r;++e){const r=i[e],l=r.name;let u=p[l];if(void 0!==u)o[e]=u;else{if(u=o[e],void 0!==u){null===u._cacheIndex&&(++u.referenceCount,this._addInactiveBinding(u,s,l));continue}const i=t&&t._propertyBindings[e].binding.parsedPath;u=new IB(qB.create(n,l,i),r.ValueTypeName,r.getValueSize()),++u.referenceCount,this._addInactiveBinding(u,s,l),o[e]=u}a[e].resultBuffer=u.buffer}}_activateAction(e){if(!this._isActiveAction(e)){if(null===e._cacheIndex){const t=(e._localRoot||this._root).uuid,n=e._clip.uuid,i=this._actionsByClip[n];this._bindAction(e,i&&i.knownActions[0]),this._addInactiveAction(e,n,t)}const t=e._propertyBindings;for(let e=0,n=t.length;e!==n;++e){const n=t[e];0==n.useCount++&&(this._lendBinding(n),n.saveOriginalState())}this._lendAction(e)}}_deactivateAction(e){if(this._isActiveAction(e)){const t=e._propertyBindings;for(let e=0,n=t.length;e!==n;++e){const n=t[e];0==--n.useCount&&(n.restoreOriginalState(),this._takeBackBinding(n))}this._takeBackAction(e)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}_isActiveAction(e){const t=e._cacheIndex;return null!==t&&t<this._nActiveActions}_addInactiveAction(e,t,n){const i=this._actions,r=this._actionsByClip;let o=r[t];if(void 0===o)o={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,r[t]=o;else{const t=o.knownActions;e._byClipCacheIndex=t.length,t.push(e)}e._cacheIndex=i.length,i.push(e),o.actionByRoot[n]=e}_removeInactiveAction(e){const t=this._actions,n=t[t.length-1],i=e._cacheIndex;n._cacheIndex=i,t[i]=n,t.pop(),e._cacheIndex=null;const r=e._clip.uuid,o=this._actionsByClip,a=o[r],s=a.knownActions,l=s[s.length-1],p=e._byClipCacheIndex;l._byClipCacheIndex=p,s[p]=l,s.pop(),e._byClipCacheIndex=null,delete a.actionByRoot[(e._localRoot||this._root).uuid],0===s.length&&delete o[r],this._removeInactiveBindingsForAction(e)}_removeInactiveBindingsForAction(e){const t=e._propertyBindings;for(let e=0,n=t.length;e!==n;++e){const n=t[e];0==--n.referenceCount&&this._removeInactiveBinding(n)}}_lendAction(e){const t=this._actions,n=e._cacheIndex,i=this._nActiveActions++,r=t[i];e._cacheIndex=i,t[i]=e,r._cacheIndex=n,t[n]=r}_takeBackAction(e){const t=this._actions,n=e._cacheIndex,i=--this._nActiveActions,r=t[i];e._cacheIndex=i,t[i]=e,r._cacheIndex=n,t[n]=r}_addInactiveBinding(e,t,n){const i=this._bindingsByRootAndName,r=this._bindings;let o=i[t];void 0===o&&(o={},i[t]=o),o[n]=e,e._cacheIndex=r.length,r.push(e)}_removeInactiveBinding(e){const t=this._bindings,n=e.binding,i=n.rootNode.uuid,r=n.path,o=this._bindingsByRootAndName,a=o[i],s=t[t.length-1],l=e._cacheIndex;s._cacheIndex=l,t[l]=s,t.pop(),delete a[r],0===Object.keys(a).length&&delete o[i]}_lendBinding(e){const t=this._bindings,n=e._cacheIndex,i=this._nActiveBindings++,r=t[i];e._cacheIndex=i,t[i]=e,r._cacheIndex=n,t[n]=r}_takeBackBinding(e){const t=this._bindings,n=e._cacheIndex,i=--this._nActiveBindings,r=t[i];e._cacheIndex=i,t[i]=e,r._cacheIndex=n,t[n]=r}_lendControlInterpolant(){const e=this._controlInterpolants,t=this._nActiveControlInterpolants++;let n=e[t];return void 0===n&&(n=new BL(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer),n.__cacheIndex=t,e[t]=n),n}_takeBackControlInterpolant(e){const t=this._controlInterpolants,n=e.__cacheIndex,i=--this._nActiveControlInterpolants,r=t[i];e.__cacheIndex=i,t[i]=e,r.__cacheIndex=n,t[n]=r}clipAction(e,t,n){const i=t||this._root,r=i.uuid;let o="string"==typeof e?GL.findByName(i,e):e;const a=null!==o?o.uuid:e,s=this._actionsByClip[a];let l=null;if(void 0===n&&(n=null!==o?o.blendMode:2500),void 0!==s){const e=s.actionByRoot[r];if(void 0!==e&&e.blendMode===n)return e;l=s.knownActions[0],null===o&&(o=l._clip)}if(null===o)return null;const p=new JB(this,o,t,n);return this._bindAction(p,l),this._addInactiveAction(p,a,r),p}existingAction(e,t){const n=t||this._root,i=n.uuid,r="string"==typeof e?GL.findByName(n,e):e,o=r?r.uuid:e,a=this._actionsByClip[o];return void 0!==a&&a.actionByRoot[i]||null}stopAllAction(){const e=this._actions;for(let t=this._nActiveActions-1;t>=0;--t)e[t].stop();return this}update(e){e*=this.timeScale;const t=this._actions,n=this._nActiveActions,i=this.time+=e,r=Math.sign(e),o=this._accuIndex^=1;for(let a=0;a!==n;++a)t[a]._update(i,e,r,o);const a=this._bindings,s=this._nActiveBindings;for(let e=0;e!==s;++e)a[e].apply(o);return this}setTime(e){this.time=0;for(let e=0;e<this._actions.length;e++)this._actions[e].time=0;return this.update(e)}getRoot(){return this._root}uncacheClip(e){const t=this._actions,n=e.uuid,i=this._actionsByClip,r=i[n];if(void 0!==r){const e=r.knownActions;for(let n=0,i=e.length;n!==i;++n){const i=e[n];this._deactivateAction(i);const r=i._cacheIndex,o=t[t.length-1];i._cacheIndex=null,i._byClipCacheIndex=null,o._cacheIndex=r,t[r]=o,t.pop(),this._removeInactiveBindingsForAction(i)}delete i[n]}}uncacheRoot(e){const t=e.uuid,n=this._actionsByClip;for(const e in n){const i=n[e].actionByRoot[t];void 0!==i&&(this._deactivateAction(i),this._removeInactiveAction(i))}const i=this._bindingsByRootAndName[t];if(void 0!==i)for(const e in i){const t=i[e];t.restoreOriginalState(),this._removeInactiveBinding(t)}}uncacheAction(e,t){const n=this.existingAction(e,t);null!==n&&(this._deactivateAction(n),this._removeInactiveAction(n))}}).prototype._controlInterpolantsResultBuffer=new Float32Array(1),class extends pA{constructor(e,t,n=1){super(e,t),this.meshPerAttribute=n||1}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}clone(e){const t=super.clone(e);return t.meshPerAttribute=this.meshPerAttribute,t}toJSON(e){const t=super.toJSON(e);return t.isInstancedInterleavedBuffer=!0,t.meshPerAttribute=this.meshPerAttribute,t}}.prototype.isInstancedInterleavedBuffer=!0,class extends EM{constructor(e){super(),this.material=e,this.render=function(){},this.hasPositions=!1,this.hasNormals=!1,this.hasColors=!1,this.hasUvs=!1,this.positionArray=null,this.normalArray=null,this.colorArray=null,this.uvArray=null,this.count=0}}.prototype.isImmediateRenderObject=!0;const $B=new wE,XB=new tM,YB=new tM;function KB(e){const t=[];e&&e.isBone&&t.push(e);for(let n=0;n<e.children.length;n++)t.push.apply(t,KB(e.children[n]));return t}const QB=new Float32Array(1);new Int32Array(QB.buffer);const eT=new YM({side:1,depthWrite:!1,depthTest:!1});new NS(new LS,eT),QL.create=function(e,t){return console.log("THREE.Curve.create() has been deprecated"),e.prototype=Object.create(QL.prototype),e.prototype.constructor=e,e.prototype.getPoint=t,e},yB.prototype.fromPoints=function(e){return console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(e)},class extends WA{constructor(e=10,t=10,n=4473924,i=8947848){n=new XM(n),i=new XM(i);const r=t/2,o=e/t,a=e/2,s=[],l=[];for(let e=0,p=0,u=-a;e<=t;e++,u+=o){s.push(-a,0,u,a,0,u),s.push(u,0,-a,u,0,a);const t=e===r?n:i;t.toArray(l,p),p+=3,t.toArray(l,p),p+=3,t.toArray(l,p),p+=3,t.toArray(l,p),p+=3}const p=new cS;p.setAttribute("position",new iS(s,3)),p.setAttribute("color",new iS(l,3)),super(p,new IA({vertexColors:!0,toneMapped:!1})),this.type="GridHelper"}}.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")},class extends WA{constructor(e){const t=KB(e),n=new cS,i=[],r=[],o=new XM(0,0,1),a=new XM(0,1,0);for(let e=0;e<t.length;e++){const n=t[e];n.parent&&n.parent.isBone&&(i.push(0,0,0),i.push(0,0,0),r.push(o.r,o.g,o.b),r.push(a.r,a.g,a.b))}n.setAttribute("position",new iS(i,3)),n.setAttribute("color",new iS(r,3)),super(n,new IA({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0})),this.type="SkeletonHelper",this.isSkeletonHelper=!0,this.root=e,this.bones=t,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(e){const t=this.bones,n=this.geometry,i=n.getAttribute("position");YB.copy(this.root.matrixWorld).invert();for(let e=0,n=0;e<t.length;e++){const r=t[e];r.parent&&r.parent.isBone&&(XB.multiplyMatrices(YB,r.matrixWorld),$B.setFromMatrixPosition(XB),i.setXYZ(n,$B.x,$B.y,$B.z),XB.multiplyMatrices(YB,r.parent.matrixWorld),$B.setFromMatrixPosition(XB),i.setXYZ(n+1,$B.x,$B.y,$B.z),n+=2)}n.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(e)}}.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")},qL.prototype.extractUrlBase=function(e){return console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead."),class{static decodeText(e){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(e);let t="";for(let n=0,i=e.length;n<i;n++)t+=String.fromCharCode(e[n]);try{return decodeURIComponent(escape(t))}catch(e){return t}}static extractUrlBase(e){const t=e.lastIndexOf("/");return-1===t?"./":e.substr(0,t+1)}}.extractUrlBase(e)},qL.Handlers={add:function(){console.error("THREE.Loader: Handlers.add() has been removed. Use LoadingManager.addHandler() instead.")},get:function(){console.error("THREE.Loader: Handlers.get() has been removed. Use LoadingManager.getHandler() instead.")}},ME.prototype.center=function(e){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(e)},ME.prototype.empty=function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()},ME.prototype.isIntersectionBox=function(e){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},ME.prototype.isIntersectionSphere=function(e){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(e)},ME.prototype.size=function(e){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(e)},WE.prototype.empty=function(){return console.warn("THREE.Sphere: .empty() has been renamed to .isEmpty()."),this.isEmpty()},WS.prototype.setFromMatrix=function(e){return console.warn("THREE.Frustum: .setFromMatrix() has been renamed to .setFromProjectionMatrix()."),this.setFromProjectionMatrix(e)},mE.prototype.flattenToArrayOffset=function(e,t){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(e,t)},mE.prototype.multiplyVector3=function(e){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},mE.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")},mE.prototype.applyToBufferAttribute=function(e){return console.warn("THREE.Matrix3: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},mE.prototype.applyToVector3Array=function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")},mE.prototype.getInverse=function(e){return console.warn("THREE.Matrix3: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(e).invert()},tM.prototype.extractPosition=function(e){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(e)},tM.prototype.flattenToArrayOffset=function(e,t){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(e,t)},tM.prototype.getPosition=function(){return console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),(new wE).setFromMatrixColumn(this,3)},tM.prototype.setRotationFromQuaternion=function(e){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(e)},tM.prototype.multiplyToArray=function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")},tM.prototype.multiplyVector3=function(e){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},tM.prototype.multiplyVector4=function(e){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},tM.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")},tM.prototype.rotateAxis=function(e){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),e.transformDirection(this)},tM.prototype.crossVector=function(e){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},tM.prototype.translate=function(){console.error("THREE.Matrix4: .translate() has been removed.")},tM.prototype.rotateX=function(){console.error("THREE.Matrix4: .rotateX() has been removed.")},tM.prototype.rotateY=function(){console.error("THREE.Matrix4: .rotateY() has been removed.")},tM.prototype.rotateZ=function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")},tM.prototype.rotateByAxis=function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},tM.prototype.applyToBufferAttribute=function(e){return console.warn("THREE.Matrix4: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},tM.prototype.applyToVector3Array=function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")},tM.prototype.makeFrustum=function(e,t,n,i,r,o){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(e,t,i,n,r,o)},tM.prototype.getInverse=function(e){return console.warn("THREE.Matrix4: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(e).invert()},NM.prototype.isIntersectionLine=function(e){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(e)},zE.prototype.multiplyVector3=function(e){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),e.applyQuaternion(this)},zE.prototype.inverse=function(){return console.warn("THREE.Quaternion: .inverse() has been renamed to invert()."),this.invert()},eM.prototype.isIntersectionBox=function(e){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},eM.prototype.isIntersectionPlane=function(e){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(e)},eM.prototype.isIntersectionSphere=function(e){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(e)},FM.prototype.area=function(){return console.warn("THREE.Triangle: .area() has been renamed to .getArea()."),this.getArea()},FM.prototype.barycoordFromPoint=function(e,t){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),this.getBarycoord(e,t)},FM.prototype.midpoint=function(e){return console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint()."),this.getMidpoint(e)},FM.prototypenormal=function(e){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),this.getNormal(e)},FM.prototype.plane=function(e){return console.warn("THREE.Triangle: .plane() has been renamed to .getPlane()."),this.getPlane(e)},FM.barycoordFromPoint=function(e,t,n,i,r){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),FM.getBarycoord(e,t,n,i,r)},FM.normal=function(e,t,n,i){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),FM.getNormal(e,t,n,i)},vB.prototype.extractAllPoints=function(e){return console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(e)},vB.prototype.extrude=function(e){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new EL(this,e)},vB.prototype.makeGeometry=function(e){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new SL(this,e)},dE.prototype.fromAttribute=function(e,t,n){return console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,n)},dE.prototype.distanceToManhattan=function(e){return console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(e)},dE.prototype.lengthManhattan=function(){return console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},wE.prototype.setEulerFromRotationMatrix=function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},wE.prototype.setEulerFromQuaternion=function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},wE.prototype.getPositionFromMatrix=function(e){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(e)},wE.prototype.getScaleFromMatrix=function(e){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(e)},wE.prototype.getColumnFromMatrix=function(e,t){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(t,e)},wE.prototype.applyProjection=function(e){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(e)},wE.prototype.fromAttribute=function(e,t,n){return console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,n)},wE.prototype.distanceToManhattan=function(e){return console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(e)},wE.prototype.lengthManhattan=function(){return console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},gE.prototype.fromAttribute=function(e,t,n){return console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,n)},gE.prototype.lengthManhattan=function(){return console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},EM.prototype.getChildByName=function(e){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(e)},EM.prototype.renderDepth=function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},EM.prototype.translate=function(e,t){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(t,e)},EM.prototype.getWorldRotation=function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")},EM.prototype.applyMatrix=function(e){return console.warn("THREE.Object3D: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(e)},Object.defineProperties(EM.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(e){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=e}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}}),NS.prototype.setDrawMode=function(){console.error("THREE.Mesh: .setDrawMode() has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")},Object.defineProperties(NS.prototype,{drawMode:{get:function(){return console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode."),0},set:function(){console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}}),LA.prototype.initBones=function(){console.error("THREE.SkinnedMesh: initBones() has been removed.")},OS.prototype.setLens=function(e,t){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),void 0!==t&&(this.filmGauge=t),this.setFocalLength(e)},Object.defineProperties(gB.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(e){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=e}},shadowCameraLeft:{set:function(e){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=e}},shadowCameraRight:{set:function(e){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=e}},shadowCameraTop:{set:function(e){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=e}},shadowCameraBottom:{set:function(e){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=e}},shadowCameraNear:{set:function(e){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=e}},shadowCameraFar:{set:function(e){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=e}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(e){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=e}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(e){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=e}},shadowMapHeight:{set:function(e){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=e}}}),Object.defineProperties(eS.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}},dynamic:{get:function(){return console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.usage===iE},set:function(){console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.setUsage(iE)}}}),eS.prototype.setDynamic=function(e){return console.warn("THREE.BufferAttribute: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===e?iE:nE),this},eS.prototype.copyIndicesArray=function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")},eS.prototype.setArray=function(){console.error("THREE.BufferAttribute: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")},cS.prototype.addIndex=function(e){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(e)},cS.prototype.addAttribute=function(e,t){return console.warn("THREE.BufferGeometry: .addAttribute() has been renamed to .setAttribute()."),t&&t.isBufferAttribute||t&&t.isInterleavedBufferAttribute?"index"===e?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(t),this):this.setAttribute(e,t):(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.setAttribute(e,new eS(arguments[1],arguments[2])))},cS.prototype.addDrawCall=function(e,t,n){void 0!==n&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(e,t)},cS.prototype.clearDrawCalls=function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()},cS.prototype.computeOffsets=function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")},cS.prototype.removeAttribute=function(e){return console.warn("THREE.BufferGeometry: .removeAttribute() has been renamed to .deleteAttribute()."),this.deleteAttribute(e)},cS.prototype.applyMatrix=function(e){return console.warn("THREE.BufferGeometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(e)},Object.defineProperties(cS.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}}),pA.prototype.setDynamic=function(e){return console.warn("THREE.InterleavedBuffer: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===e?iE:nE),this},pA.prototype.setArray=function(){console.error("THREE.InterleavedBuffer: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")},EL.prototype.getArrays=function(){console.error("THREE.ExtrudeGeometry: .getArrays() has been removed.")},EL.prototype.addShapeList=function(){console.error("THREE.ExtrudeGeometry: .addShapeList() has been removed.")},EL.prototype.addShape=function(){console.error("THREE.ExtrudeGeometry: .addShape() has been removed.")},lA.prototype.dispose=function(){console.error("THREE.Scene: .dispose() has been removed.")},Object.defineProperties(GM.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},overdraw:{get:function(){console.warn("THREE.Material: .overdraw has been removed.")},set:function(){console.warn("THREE.Material: .overdraw has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new XM}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(e){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===e}},stencilMask:{get:function(){return console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask},set:function(e){console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask=e}}}),Object.defineProperties(kS.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(e){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=e}}}),sA.prototype.clearTarget=function(e,t,n,i){console.warn("THREE.WebGLRenderer: .clearTarget() has been deprecated. Use .setRenderTarget() and .clear() instead."),this.setRenderTarget(e),this.clear(t,n,i)},sA.prototype.animate=function(e){console.warn("THREE.WebGLRenderer: .animate() is now .setAnimationLoop()."),this.setAnimationLoop(e)},sA.prototype.getCurrentRenderTarget=function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()},sA.prototype.getMaxAnisotropy=function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()},sA.prototype.getPrecision=function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision},sA.prototype.resetGLState=function(){return console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()},sA.prototype.supportsFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")},sA.prototype.supportsHalfFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")},sA.prototype.supportsStandardDerivatives=function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")},sA.prototype.supportsCompressedTextureS3TC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")},sA.prototype.supportsCompressedTexturePVRTC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")},sA.prototype.supportsBlendMinMax=function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")},sA.prototype.supportsVertexTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures},sA.prototype.supportsInstancedArrays=function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")},sA.prototype.enableScissorTest=function(e){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(e)},sA.prototype.initMaterial=function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},sA.prototype.addPrePlugin=function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},sA.prototype.addPostPlugin=function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},sA.prototype.updateShadowMap=function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")},sA.prototype.setFaceCulling=function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")},sA.prototype.allocTextureUnit=function(){console.warn("THREE.WebGLRenderer: .allocTextureUnit() has been removed.")},sA.prototype.setTexture=function(){console.warn("THREE.WebGLRenderer: .setTexture() has been removed.")},sA.prototype.setTexture2D=function(){console.warn("THREE.WebGLRenderer: .setTexture2D() has been removed.")},sA.prototype.setTextureCube=function(){console.warn("THREE.WebGLRenderer: .setTextureCube() has been removed.")},sA.prototype.getActiveMipMapLevel=function(){return console.warn("THREE.WebGLRenderer: .getActiveMipMapLevel() is now .getActiveMipmapLevel()."),this.getActiveMipmapLevel()},Object.defineProperties(sA.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=e}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=e}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}},context:{get:function(){return console.warn("THREE.WebGLRenderer: .context has been removed. Use .getContext() instead."),this.getContext()}},vr:{get:function(){return console.warn("THREE.WebGLRenderer: .vr has been renamed to .xr"),this.xr}},gammaInput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead."),!1},set:function(){console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead.")}},gammaOutput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),!1},set:function(e){console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),this.outputEncoding=!0===e?3001:eE}},toneMappingWhitePoint:{get:function(){return console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed."),1},set:function(){console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed.")}}}),Object.defineProperties(YN.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}}),Object.defineProperties(bE.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(e){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=e}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(e){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=e}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(e){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=e}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(e){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=e}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(e){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=e}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(e){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=e}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(e){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=e}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(e){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=e}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(e){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=e}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(e){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=e}}}),class extends EM{constructor(e){super(),this.type="Audio",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this}setMediaElementSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this}setMediaStreamSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this}setBuffer(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this}play(e=0){if(!0===this.isPlaying)return void console.warn("THREE.Audio: Audio is already playing.");if(!1===this.hasPlaybackControl)return void console.warn("THREE.Audio: this Audio has no playback control.");this._startedAt=this.context.currentTime+e;const t=this.context.createBufferSource();return t.buffer=this.buffer,t.loop=this.loop,t.loopStart=this.loopStart,t.loopEnd=this.loopEnd,t.onended=this.onEnded.bind(this),t.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=t,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,!0===this.loop&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")}stop(){if(!1!==this.hasPlaybackControl)return this._progress=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}getFilters(){return this.filters}setFilters(e){return e||(e=[]),!0===this._connected?(this.disconnect(),this.filters=e.slice(),this.connect()):this.filters=e.slice(),this}setDetune(e){if(this.detune=e,void 0!==this.source.detune)return!0===this.isPlaying&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(e){return this.setFilters(e?[e]:[])}setPlaybackRate(e){if(!1!==this.hasPlaybackControl)return this.playbackRate=e,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("THREE.Audio: this Audio has no playback control.")}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(e){if(!1!==this.hasPlaybackControl)return this.loop=e,!0===this.isPlaying&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")}setLoopStart(e){return this.loopStart=e,this}setLoopEnd(e){return this.loopEnd=e,this}getVolume(){return this.gain.gain.value}setVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}}.prototype.load=function(e){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");const t=this;return(new kB).load(e,(function(e){t.setBuffer(e)})),this},HS.prototype.updateCubeMap=function(e,t){return console.warn("THREE.CubeCamera: .updateCubeMap() is now .update()."),this.update(e,t)},HS.prototype.clear=function(e,t,n,i){return console.warn("THREE.CubeCamera: .clear() is now .renderTarget.clear()."),this.renderTarget.clear(e,t,n,i)},fE.crossOrigin=void 0,fE.loadTexture=function(e,t,n,i){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");const r=new KL;r.setCrossOrigin(this.crossOrigin);const o=r.load(e,n,void 0,i);return t&&(o.mapping=t),o},fE.loadTextureCube=function(e,t,n,i){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");const r=new YL;r.setCrossOrigin(this.crossOrigin);const o=r.load(e,n,void 0,i);return t&&(o.mapping=t),o},fE.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},fE.loadCompressedTextureCube=function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:"128"}})),"undefined"!=typeof window&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__="128");var tT=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180];class nT{constructor(e){const t=[new wE(1,1,0),new wE(-1,1,0),new wE(1,-1,0),new wE(-1,-1,0),new wE(1,0,1),new wE(-1,0,1),new wE(1,0,-1),new wE(-1,0,-1),new wE(0,1,1),new wE(0,-1,1),new wE(0,1,-1),new wE(0,-1,-1)];var n=new Array(512),i=new Array(512);e||(e=1),e*=65536,(e=Math.floor(e))<256&&(e|=e<<8);for(var r=0;r<256;r++){var o;o=1&r?tT[r]^255&e:tT[r]^e>>8&255,n[r]=n[r+256]=o,i[r]=i[r+256]=t[o%12]}this._seed=e,this._offsetMatrix=[new wE(0,0,0),new wE(0,0,1),new wE(0,1,0),new wE(0,1,1),new wE(1,0,0),new wE(1,0,1),new wE(1,1,0),new wE(1,1,1)],this.shaderChunk={defines:"",header:'#define GLSLIFY 1\n// From https://github.com/hughsk/glsl-noise/blob/master/periodic/2d.glsl\n\n//\n// GLSL textureless classic 2D noise "cnoise",\n// with an RSL-style periodic variant "pnoise".\n// Author:  Stefan Gustavson (stefan.gustavson@liu.se)\n// Version: 2011-08-22\n//\n// Many thanks to Ian McEwan of Ashima Arts for the\n// ideas for permutation and gradient selection.\n//\n// Copyright (c) 2011 Stefan Gustavson. All rights reserved.\n// Distributed under the MIT license. See LICENSE file.\n// https://github.com/ashima/webgl-noise\n//\n\nvec4 mod289(vec4 x) { return x - floor(x * (1.0 / 289.0)) * 289.0; }\n\nvec4 permute(vec4 x) { return mod289(((x * 34.0) + 1.0) * x); }\n\nvec4 taylorInvSqrt(vec4 r) { return 1.79284291400159 - 0.85373472095314 * r; }\n\nvec2 fade(vec2 t) { return t * t * t * (t * (t * 6.0 - 15.0) + 10.0); }\n\nfloat map(float value, float min1, float max1, float min2, float max2) {\n  return min2 + (value - min1) * (max2 - min2) / (max1 - min1);\n}\n\n// Classic Perlin noise, periodic variant\nfloat perlin(vec2 P) {\n\n  vec2 rep = vec2(255.0, 255.0);\n\n  vec4 Pi = floor(P.xyxy) + vec4(0.0, 0.0, 1.0, 1.0);\n  vec4 Pf = fract(P.xyxy) - vec4(0.0, 0.0, 1.0, 1.0);\n  Pi = mod(Pi, rep.xyxy); // To create noise with explicit period\n  Pi = mod289(Pi);        // To avoid truncation effects in permutation\n  vec4 ix = Pi.xzxz;\n  vec4 iy = Pi.yyww;\n  vec4 fx = Pf.xzxz;\n  vec4 fy = Pf.yyww;\n\n  vec4 i = permute(permute(ix) + iy);\n\n  vec4 gx = fract(i * (1.0 / 41.0)) * 2.0 - 1.0;\n  vec4 gy = abs(gx) - 0.5;\n  vec4 tx = floor(gx + 0.5);\n  gx = gx - tx;\n\n  vec2 g00 = vec2(gx.x, gy.x);\n  vec2 g10 = vec2(gx.y, gy.y);\n  vec2 g01 = vec2(gx.z, gy.z);\n  vec2 g11 = vec2(gx.w, gy.w);\n\n  vec4 norm = taylorInvSqrt(\n      vec4(dot(g00, g00), dot(g01, g01), dot(g10, g10), dot(g11, g11)));\n  g00 *= norm.x;\n  g01 *= norm.y;\n  g10 *= norm.z;\n  g11 *= norm.w;\n\n  float n00 = dot(g00, vec2(fx.x, fy.x));\n  float n10 = dot(g10, vec2(fx.y, fy.y));\n  float n01 = dot(g01, vec2(fx.z, fy.z));\n  float n11 = dot(g11, vec2(fx.w, fy.w));\n\n  vec2 fade_xy = fade(Pf.xy);\n  vec2 n_x = mix(vec2(n00, n01), vec2(n10, n11), fade_xy.x);\n  float n_xy = mix(n_x.x, n_x.y, fade_xy.y);\n  return map(2.3 * n_xy, -1.0, 1.0, 0.0, 1.0);\n}\n\nfloat fbm(vec2 pos, vec4 props) {\n  float persistance = props.x;\n  float lacunarity = props.y;\n  float redistribution = props.z;\n  int octaves = int(props.w);\n\n  float result = 0.0;\n  float amplitude = 1.0;\n  float frequency = 1.0;\n  float maximum = amplitude;\n\n  for (int i = 0; i < 2; i++) {\n\n    vec2 p = pos.xy * frequency;\n\n    float noiseVal = perlin(p);\n    result += noiseVal * amplitude;\n\n    frequency *= lacunarity;\n    amplitude *= persistance;\n    maximum += amplitude;\n  }\n\n  float redistributed = pow(result, redistribution);\n  return redistributed / maximum;\n}\n',main:"",uniforms:[{three_noise_seed:this._seed}]},this.perm=n,this.gradP=i}_fade(e){return e*e*e*(e*(6*e-15)+10)}_lerp(e,t,n){return(1-n)*e+n*t}_gradient(e){return e instanceof wE?e.x+this.perm[e.y+this.perm[e.z]]:e.x+this.perm[e.y]}static map(e,t,n,i,r){return(e-t)*(r-i)/(n-t)+i}get2(e){void 0!==e.z&&(e=new dE(e.x,e.y));const t=new dE(Math.floor(e.x),Math.floor(e.y));e.sub(t),t.x&=255,t.y&=255;const n=[];for(let i=0;i<4;i++){const r=this._offsetMatrix[2*i],o=new dE(r.x,r.y),a=this.gradP[this._gradient((new dE).addVectors(t,o))],s=new dE(a.x,a.y),l=(new dE).subVectors(e,o);n.push(s.dot(l))}const i=this._fade(e.x),r=this._fade(e.y);return this._lerp(this._lerp(n[0],n[2],i),this._lerp(n[1],n[3],i),r)}get3(e){if(void 0===e.z)throw"Input to Perlin::get3() must be of type THREE.Vector3";const t=new wE(Math.floor(e.x),Math.floor(e.y),Math.floor(e.z));e.sub(t),t.x&=255,t.y&=255,t.z&=255;const n=[];for(let i=0;i<8;i++){const r=this._offsetMatrix[i],o=this.gradP[this._gradient((new wE).addVectors(t,r))],a=(new wE).subVectors(e,r);n.push(o.dot(a))}const i=this._fade(e.x),r=this._fade(e.y),o=this._fade(e.z);return this._lerp(this._lerp(this._lerp(n[0],n[4],i),this._lerp(n[1],n[5],i),o),this._lerp(this._lerp(n[2],n[6],i),this._lerp(n[3],n[7],i),o),r)}}class iT{constructor(e){const{seed:t,scale:n,persistance:i,lacunarity:r,octaves:o,redistribution:a}=e;this._noise=new nT(t),this._scale=n||1,this._persistance=i||.5,this._lacunarity=r||2,this._octaves=o||6,this._redistribution=a||1}get2(e){let t=0,n=1,i=1,r=n,o=this._noise.get2.bind(this._noise);for(let a=0;a<this._octaves;a++)t+=o(new dE(e.x*this._scale*i,e.y*this._scale*i))*n,i*=this._lacunarity,n*=this._persistance,r+=n;return Math.pow(t,this._redistribution)/r}get3(e){let t=0,n=1,i=1,r=n,o=this._noise.get3.bind(this._noise);for(let a=0;a<this._octaves;a++)t+=o(new wE(e.x*this._scale*i,e.y*this._scale*i,e.z*this._scale*i))*n,i*=this._lacunarity,n*=this._persistance,r+=n;return Math.pow(t,this._redistribution)/r}}const rT=new Qz,oT=new Kz,aT=new Qz,sT=new Qz,lT=new Kz,pT=new Qz;class uT extends eZ{constructor(){super()}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(null!==this.parent?(this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorld.decompose(sT,lT,pT),this.matrix.decompose(rT,oT,aT),this.matrixWorld.compose(sT,oT,pT)):this.matrixWorld.copy(this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);for(let t=0,n=this.children.length;t<n;t++)this.children[t].updateMatrixWorld(e)}}const hT=Lz.radToDeg(1),cT=new Qz(0,0,0),_T=new Rw,dT=[{key:"opacityOverLifetime",attributeKeys:["colorA"],startValueKeys:["startOpacity"]},{key:"sizeOverLifetime",attributeKeys:["size"],startValueKeys:["startSize"]}],mT=({delta:e,noise:t,startValues:n,lifetimeValues:i,hasOrbitalVelocity:r,orbitalVelocityData:o,normalizedConfig:a,attributes:s,particleLifetime:l,particleLifetimePercentage:p,particleIndex:u,forceUpdate:h=!1})=>{if(r){const t=3*u,n=s.position.array,{speed:i,positionOffset:r}=o[u];n[t]-=r.x,n[t+1]-=r.y,n[t+2]-=r.z,_T.set(i.x*hT*e,i.z*hT*e,i.y*hT*e),r.applyEuler(_T),n[t]+=r.x,n[t+1]+=r.y,n[t+2]+=r.z,s.position.needsUpdate=!0}if(dT.forEach((({key:e,attributeKeys:t,startValueKeys:i})=>{const r=a[e];if(r.isActive){const e=("function"==typeof(o=r.curveFunction)?o:LZ[o])(p);t.forEach(((t,r)=>{s[t].array[u]=n[i[r]][u]*e,s[t].needsUpdate=!0}))}else h&&t.forEach(((e,t)=>{s[e].array[u]=n[i[t]][u],s[e].needsUpdate=!0}));var o;
/**
     * @license
     * Copyright 2010-2021 Three.js Authors
     * SPDX-License-Identifier: MIT
     */})),i.rotationOverLifetime&&(s.rotation.array[u]+=i.rotationOverLifetime[u]*e*.02,s.rotation.needsUpdate=!0),t.isActive){const{sampler:e,strength:n,offsets:i,positionAmount:r,rotationAmount:o,sizeAmount:a}=t,l=3*u,h=s.position.array;let c;const _=10*(p+(i?i[u]:0))*n,d=.15*n;cT.set(_,0,0),c=e.get3(cT),h[l]+=c*d*r,0!==o&&(s.rotation.array[u]+=c*d*o,s.rotation.needsUpdate=!0),0!==a&&(s.size.array[u]+=c*d*a,s.size.needsUpdate=!0),cT.set(_,_,0),c=e.get3(cT),h[l+1]+=c*d*r,cT.set(_,_,_),c=e.get3(cT),h[l+2]+=c*d*r,s.position.needsUpdate=!0}},PT=(e,t)=>{let n=1;for(let i=1;i<=t;i++)n*=(e+1-i)/i;return n};let fT=[];const xT={"THREE.NoBlending":0,"THREE.NormalBlending":1,"THREE.AdditiveBlending":2,"THREE.SubtractiveBlending":3,"THREE.MultiplyBlending":4},yT={transform:{position:{x:0,y:0,z:0},rotation:{x:0,y:0,z:0},scale:{x:1,y:1,z:1}},duration:5,looping:!0,startDelay:{min:0,max:0},startLifetime:{min:2,max:2},startSpeed:{min:1,max:1},startSize:{min:1,max:1},startRotation:{min:0,max:0},startColor:{min:{r:1,g:1,b:1},max:{r:1,g:1,b:1}},startOpacity:{min:1,max:1},gravity:0,simulationSpace:"LOCAL",maxParticles:100,emission:{rateOverTime:10,rateOverDistance:0},shape:{shape:EZ,sphere:{radius:1,radiusThickness:1,arc:360},cone:{angle:25,radius:1,radiusThickness:1,arc:360},circle:{radius:1,radiusThickness:1,arc:360},rectangle:{rotation:{x:0,y:0},scale:{x:1,y:1}},box:{scale:{x:1,y:1,z:1},emitFrom:MZ}},map:null,renderer:{blending:1,discardBackgroundColor:!1,backgroundColorTolerance:1,backgroundColor:{r:1,g:1,b:1},transparent:!0,depthTest:!0,depthWrite:!1},velocityOverLifetime:{isActive:!1,linear:{x:{min:0,max:0},y:{min:0,max:0},z:{min:0,max:0}},orbital:{x:{min:0,max:0},y:{min:0,max:0},z:{min:0,max:0}}},sizeOverLifetime:{isActive:!1,curveFunction:AZ,bezierPoints:[{x:0,y:0,percentage:0},{x:1,y:1,percentage:1}]},opacityOverLifetime:{isActive:!1,curveFunction:AZ,bezierPoints:[{x:0,y:0,percentage:0},{x:1,y:1,percentage:1}]},rotationOverLifetime:{isActive:!1,min:0,max:0},noise:{isActive:!1,useRandomOffset:!1,strength:1,frequency:.5,octaves:1,positionAmount:1,rotationAmount:0,sizeAmount:0},textureSheetAnimation:{tiles:new Bz(1,1),timeMode:"LIFETIME",fps:10,startFrame:{min:0,max:0}}},vT=({shape:e,sphere:t,cone:n,circle:i,rectangle:r,box:o},a,s,l,p,u)=>{switch(e){case EZ:((e,t,n,i,{radius:r,radiusThickness:o,arc:a})=>{const s=Math.random()*(a/360),l=Math.random(),p=Math.random(),u=2*Math.PI*s,h=Math.acos(2*l-1),c=Math.sin(h),_=c*Math.cos(u),d=c*Math.sin(u),m=Math.cos(h),P=1-o;e.x=r*P*_+r*o*p*_,e.y=r*P*d+r*o*p*d,e.z=r*P*m+r*o*p*m,e.applyQuaternion(t);const f=Lz.randFloat(i.min,i.max),x=1/e.length();n.set(e.x*x*f,e.y*x*f,e.z*x*f),n.applyQuaternion(t)})(s,l,p,a,t);break;case"CONE":((e,t,n,i,{radius:r,radiusThickness:o,arc:a,angle:s=90})=>{const l=2*Math.PI*Math.random()*(a/360),p=Math.random(),u=Math.cos(l),h=Math.sin(l),c=1-o;e.x=r*c*u+r*o*p*u,e.y=r*c*h+r*o*p*h,e.z=0,e.applyQuaternion(t);const _=e.length(),d=Math.abs(_/r*Lz.degToRad(s)),m=Math.sin(d),P=Lz.randFloat(i.min,i.max),f=1/_;n.set(e.x*m*f*P,e.y*m*f*P,Math.cos(d)*P),n.applyQuaternion(t)})(s,l,p,a,n);break;case"CIRCLE":((e,t,n,i,{radius:r,radiusThickness:o,arc:a})=>{const s=2*Math.PI*Math.random()*(a/360),l=Math.random(),p=Math.cos(s),u=Math.sin(s),h=1-o;e.x=r*h*p+r*o*l*p,e.y=r*h*u+r*o*l*u,e.z=0,e.applyQuaternion(t);const c=Lz.randFloat(i.min,i.max),_=1/e.length();n.set(e.x*_*c,e.y*_*c,0),n.applyQuaternion(t)})(s,l,p,a,i);break;case"RECTANGLE":((e,t,n,i,{rotation:r,scale:o})=>{const a=Math.random()*o.x-o.x/2,s=Math.random()*o.y-o.y/2,l=Lz.degToRad(r.x),p=Lz.degToRad(r.y);e.x=a*Math.cos(p),e.y=s*Math.cos(l),e.z=a*Math.sin(p)-s*Math.sin(l),e.applyQuaternion(t);const u=Lz.randFloat(i.min,i.max);n.set(0,0,u),n.applyQuaternion(t)})(s,l,p,a,r);break;case"BOX":((e,t,n,i,{scale:r,emitFrom:o})=>{switch(o){case MZ:e.x=Math.random()*r.x-r.x/2,e.y=Math.random()*r.y-r.y/2,e.z=Math.random()*r.z-r.z/2;break;case"SHELL":const t=Math.floor(6*Math.random()),n=t%3,i=[];i[n]=t>2?1:0,i[(n+1)%3]=Math.random(),i[(n+2)%3]=Math.random(),e.x=i[0]*r.x-r.x/2,e.y=i[1]*r.y-r.y/2,e.z=i[2]*r.z-r.z/2;break;case"EDGE":const o=Math.floor(6*Math.random()),a=o%3,s=Math.floor(4*Math.random()),l=[];l[a]=o>2?1:0,l[(a+1)%3]=s<2?Math.random():s-2,l[(a+2)%3]=s<2?s:Math.random(),e.x=l[0]*r.x-r.x/2,e.y=l[1]*r.y-r.y/2,e.z=l[2]*r.z-r.z/2}e.applyQuaternion(t);const a=Lz.randFloat(i.min,i.max);n.set(0,0,a),n.applyQuaternion(t)})(s,l,p,a,o)}u.isActive&&(0===u.linear.x.min&&0===u.linear.x.max||(p.x+=Lz.randFloat(u.linear.x.min,u.linear.x.max)),0===u.linear.y.min&&0===u.linear.y.max||(p.y+=Lz.randFloat(u.linear.y.min,u.linear.y.max)),0===u.linear.z.min&&0===u.linear.z.max||(p.z+=Lz.randFloat(u.linear.z.min,u.linear.z.max)))},gT=e=>{fT=fT.filter((({particleSystem:t,wrapper:n})=>t!==e&&n!==e&&e.instance!==e||(t.geometry.dispose(),t.material.dispose(),t.parent&&t.parent.remove(t),!1)))},bT=(e=yT,t)=>{const n=t||Date.now(),i={distanceFromLastEmitByDistance:0,lastWorldPosition:new Qz(-99999),currentWorldPosition:new Qz(-99999),worldPositionChange:new Qz,worldQuaternion:new Kz,wrapperQuaternion:new Kz,lastWorldQuaternion:new Kz(-99999),worldEuler:new Rw,gravityVelocity:new Qz(0,0,0),startValues:{},hasOrbitalVelocity:!1,orbitalVelocityData:[],lifetimeValues:{},creationTimes:[],noise:null,isEnabled:!0},r=ey(yT,e);["sizeOverLifetime","opacityOverLifetime"].forEach((e=>{var t;r[e].isActive&&r[e].curveFunction===AZ&&r[e].bezierPoints&&(r[e].curveFunction=(t=r[e].bezierPoints,e=>{if(e<0)return t[0];if(e>1)return t[t.length-1];let n=0,i=t.length-1;t.find(((t,r)=>{const o=e<t.percentage;return o?i=r:void 0!==t.percentage&&(n=r),o}));const r=i-n,o=(e-t[n].percentage)/(t[i].percentage-t[n].percentage);let a=0;for(let e=0;e<=r;e++){const i=t[n+e];a+=PT(r,e)*Math.pow(1-o,r-e)*Math.pow(o,e)*i.y}return a}))}));const{transform:o,duration:a,looping:s,startDelay:l,startLifetime:p,startSpeed:u,startSize:h,startRotation:c,startColor:_,startOpacity:d,gravity:m,simulationSpace:P,maxParticles:f,emission:x,shape:y,map:v,renderer:g,noise:b,velocityOverLifetime:z,onUpdate:w,onComplete:Z,textureSheetAnimation:E}=r;"string"==typeof g.blending&&(g.blending=xT[g.blending]);const M=Array.from({length:f},(()=>new Qz)),S=Array.from({length:f},(()=>new Qz));i.creationTimes=Array.from({length:f},(()=>0)),i.hasOrbitalVelocity=r.velocityOverLifetime.isActive&&(0!==r.velocityOverLifetime.orbital.x.min||0!==r.velocityOverLifetime.orbital.x.max||0!==r.velocityOverLifetime.orbital.y.min||0!==r.velocityOverLifetime.orbital.y.max||0!==r.velocityOverLifetime.orbital.z.min||0!==r.velocityOverLifetime.orbital.z.max),i.hasOrbitalVelocity&&(i.orbitalVelocityData=Array.from({length:f},(()=>({speed:new Qz,positionOffset:new Qz})))),["startSize","startOpacity"].forEach((e=>{i.startValues[e]=Array.from({length:f},(()=>Lz.randFloat(r[e].min,r[e].max)))})),["rotationOverLifetime"].forEach((e=>{r[e].isActive&&(i.lifetimeValues[e]=Array.from({length:f},(()=>Lz.randFloat(r[e].min,r[e].max))))})),i.noise={isActive:b.isActive,strength:b.strength,positionAmount:b.positionAmount,rotationAmount:b.rotationAmount,sizeAmount:b.sizeAmount,sampler:b.isActive?new iT({seed:Math.random(),scale:b.frequency,octaves:b.octaves}):null,offsets:b.useRandomOffset?Array.from({length:f},(()=>100*Math.random())):null};const C=new fZ({uniforms:{elapsed:{value:0},map:{value:v},tiles:{value:E.tiles},fps:{value:E.fps},useFPSForFrameIndex:{value:"FPS"===E.timeMode},backgroundColor:{value:g.backgroundColor},discardBackgroundColor:{value:g.discardBackgroundColor},backgroundColorTolerance:{value:g.backgroundColorTolerance}},vertexShader:"\n  attribute float size;\n  attribute float colorR;\n  attribute float colorG;\n  attribute float colorB;\n  attribute float colorA;\n  attribute float lifetime;\n  attribute float startLifetime;\n  attribute float rotation;\n  attribute float startFrame;\n\n  varying mat4 vPosition;\n  varying vec4 vColor;\n  varying float vLifetime;\n  varying float vStartLifetime;\n  varying float vRotation;\n  varying float vStartFrame;\n\n  void main()\n  {\n    vColor = vec4(colorR, colorG, colorB, colorA);\n    vLifetime = lifetime;\n    vStartLifetime = startLifetime;\n    vRotation = rotation;\n    vStartFrame = startFrame;\n\n    vec4 mvPosition = modelViewMatrix * vec4(position, 1.0);\n    gl_PointSize = size * (100.0 / length(mvPosition.xyz));\n    gl_Position = projectionMatrix * mvPosition;\n  }\n",fragmentShader:"\n  uniform sampler2D map;\n  uniform float elapsed;\n  uniform float fps;\n  uniform bool useFPSForFrameIndex;\n  uniform vec2 tiles;\n  uniform bool discardBackgroundColor;\n  uniform vec3 backgroundColor;\n  uniform float backgroundColorTolerance;\n\n  varying vec4 vColor;\n  varying float vLifetime;\n  varying float vStartLifetime;\n  varying float vRotation;\n  varying float vStartFrame;\n\n  void main()\n  {\n    gl_FragColor = vColor;\n    float mid = 0.5;\n\n    float frameIndex = round(vStartFrame) + (\n      useFPSForFrameIndex == true\n        ? fps == 0.0\n            ? 0.0\n            : max((vLifetime / 1000.0) * fps, 0.0)\n        : max(min(floor(min(vLifetime / vStartLifetime, 1.0) * (tiles.x * tiles.y)), tiles.x * tiles.y - 1.0), 0.0)\n    );\n        \n    float spriteXIndex = floor(mod(frameIndex, tiles.x));\n    float spriteYIndex = floor(mod(frameIndex / tiles.x, tiles.y));\n\n    vec2 frameUV = vec2(\n      gl_PointCoord.x / tiles.x + spriteXIndex / tiles.x,\n      gl_PointCoord.y / tiles.y + spriteYIndex / tiles.y);\n\n    vec2 center = vec2(0.5, 0.5);\n    vec2 centeredPoint = gl_PointCoord - center;\n\n    mat2 rotation = mat2(\n      cos(vRotation), sin(vRotation),\n      -sin(vRotation), cos(vRotation)\n    );\n\n    centeredPoint = rotation * centeredPoint;\n    vec2 centeredMiddlePoint = vec2(\n      centeredPoint.x + center.x,\n      centeredPoint.y + center.y\n    );\n\n    float dist = distance(centeredMiddlePoint, center);\n    if (dist > 0.5) discard;\n\n    vec2 uvPoint = vec2(\n      centeredMiddlePoint.x / tiles.x + spriteXIndex / tiles.x,\n      centeredMiddlePoint.y / tiles.y + spriteYIndex / tiles.y\n    );\n\n    vec4 rotatedTexture = texture2D(map, uvPoint);\n\n    gl_FragColor = gl_FragColor * rotatedTexture;\n\n    if (discardBackgroundColor && abs(length(rotatedTexture.rgb - backgroundColor.rgb)) < backgroundColorTolerance ) discard;\n  }\n",transparent:g.transparent,blending:g.blending,depthTest:g.depthTest,depthWrite:g.depthWrite}),N=new PZ;for(let e=0;e<f;e++)vT(y,u,M[e],i.wrapperQuaternion,S[e],z);N.setFromPoints(Array.from({length:f},((e,t)=>({...M[t]}))));const A=(e,t)=>{(({geometry:e,propertyName:t,maxParticles:n,factory:i})=>{e.setAttribute(t,new oZ(new Float32Array(Array.from({length:n},"function"==typeof i?i:()=>i)),1))})({geometry:N,propertyName:e,maxParticles:f,factory:t})};A("isActive",!1),A("lifetime",0),A("startLifetime",(()=>Lz.randFloat(p.min,p.max))),A("startFrame",(()=>Lz.randInt(E.startFrame.min,E.startFrame.max))),A("opacity",0),A("rotation",(()=>Lz.degToRad(Lz.randFloat(c.min,c.max)))),A("size",((e,t)=>i.startValues.startSize[t])),A("rotation",0);const L=Math.random();A("colorR",(()=>_.min.r+L*(_.max.r-_.min.r))),A("colorG",(()=>_.min.g+L*(_.max.g-_.min.g))),A("colorB",(()=>_.min.b+L*(_.max.b-_.min.b))),A("colorA",0);let B=new zZ(N,C);B.sortParticles=!0,B.position.copy(o.position),B.rotation.x=Lz.degToRad(o.rotation.x),B.rotation.y=Lz.degToRad(o.rotation.y),B.rotation.z=Lz.degToRad(o.rotation.z),B.scale.copy(o.scale);const T=n+1e3*Lz.randFloat(l.min,l.max);let V;return r.simulationSpace===ZZ&&(V=new uT,V.add(B)),fT.push({particleSystem:B,wrapper:V,generalData:i,onUpdate:w,onComplete:Z,creationTime:T,lastEmissionTime:T,duration:a,looping:s,simulationSpace:P,gravity:m,emission:x,normalizedConfig:r,iterationCount:0,velocities:S,deactivateParticle:e=>{N.attributes.isActive.array[e]=!1,N.attributes.colorA.array[e]=0,N.attributes.colorA.needsUpdate=!0},activateParticle:({particleIndex:e,activationTime:t,position:n})=>{N.attributes.isActive.array[e]=!0,i.creationTimes[e]=t,i.noise.offsets&&(i.noise.offsets[e]=100*Math.random());const o=Math.random();N.attributes.colorR.array[e]=_.min.r+o*(_.max.r-_.min.r),N.attributes.colorR.needsUpdate=!0,N.attributes.colorG.array[e]=_.min.g+o*(_.max.g-_.min.g),N.attributes.colorG.needsUpdate=!0,N.attributes.colorB.array[e]=_.min.b+o*(_.max.b-_.min.b),N.attributes.colorB.needsUpdate=!0,N.attributes.startFrame.array[e]=Lz.randInt(E.startFrame.min,E.startFrame.max),N.attributes.startFrame.needsUpdate=!0,N.attributes.startLifetime.array[e]=1e3*Lz.randFloat(p.min,p.max),N.attributes.startLifetime.needsUpdate=!0,i.startValues.startSize[e]=Lz.randFloat(h.min,h.max),i.startValues.startOpacity[e]=Lz.randFloat(d.min,d.max),N.attributes.rotation.array[e]=Lz.degToRad(Lz.randFloat(c.min,c.max)),r.rotationOverLifetime.isActive&&(i.lifetimeValues.rotationOverLifetime[e]=Lz.randFloat(r.rotationOverLifetime.min,r.rotationOverLifetime.max)),N.attributes.rotation.needsUpdate=!0,N.attributes.colorB.needsUpdate=!0,vT(y,u,M[e],i.wrapperQuaternion,S[e],z);const a=Math.floor(3*e);N.attributes.position.array[a]=(n?n.x:0)+M[e].x,N.attributes.position.array[a+1]=(n?n.y:0)+M[e].y,N.attributes.position.array[a+2]=(n?n.z:0)+M[e].z,N.attributes.position.needsUpdate=!0,i.hasOrbitalVelocity&&(i.orbitalVelocityData[e].speed.set(Lz.randFloat(r.velocityOverLifetime.orbital.x.min,r.velocityOverLifetime.orbital.x.max)*(Math.PI/180),Lz.randFloat(r.velocityOverLifetime.orbital.y.min,r.velocityOverLifetime.orbital.y.max)*(Math.PI/180),Lz.randFloat(r.velocityOverLifetime.orbital.z.min,r.velocityOverLifetime.orbital.z.max)*(Math.PI/180)),i.orbitalVelocityData[e].positionOffset.set(M[e].x,M[e].y,M[e].z)),N.attributes.lifetime.array[e]=0,N.attributes.lifetime.needsUpdate=!0,mT({delta:0,elapsed:0,noise:i.noise,startValues:i.startValues,lifetimeValues:i.lifetimeValues,hasOrbitalVelocity:i.hasOrbitalVelocity,orbitalVelocityData:i.orbitalVelocityData,normalizedConfig:r,attributes:B.geometry.attributes,particleLifetime:0,particleLifetimePercentage:0,particleIndex:e,forceUpdate:!0})}}),{instance:V||B,resumeEmitter:()=>i.isEnabled=!0,pauseEmitter:()=>i.isEnabled=!1,dispose:()=>gT(B)}};window.tpsDemo={on:{},game:{world:{},ability:{}}};const zT=[];window.tpsDemo.on.init=e=>zT.push(e);function wT(e,t,n){const i=e.slice();return i[5]=t[n],i}function ZT(e){let t,n;return t=new Vn({}),{c(){ce(t.$$.fragment)},m(e,i){_e(t,e,i),n=!0},i(e){n||(oe(t.$$.fragment,e),n=!0)},o(e){ae(t.$$.fragment,e),n=!1},d(e){de(t,e)}}}function ET(e){let t,n,i;var r=e[5];return r&&(t=new r({})),{c(){t&&ce(t.$$.fragment),n=A()},m(e,r){t&&_e(t,e,r),w(e,n,r),i=!0},p(e,i){if(r!==(r=e[5])){if(t){ie();const e=t;ae(e.$$.fragment,1,0,(()=>{de(e,1)})),re()}r?(t=new r({}),ce(t.$$.fragment),oe(t.$$.fragment,1),_e(t,n.parentNode,n)):t=null}},i(e){i||(t&&oe(t.$$.fragment,e),i=!0)},o(e){t&&ae(t.$$.fragment,e),i=!1},d(e){e&&Z(n),t&&de(t,e)}}}function MT(e){let t,n,i,r,o,a,s,l,u,h,c=!e[0]&&ZT(),_=e[1],d=[];for(let t=0;t<_.length;t+=1)d[t]=ET(wT(e,_,t));const m=e=>ae(d[e],1,1,(()=>{d[e]=null}));return u=new Ln({}),{c(){c&&c.c(),t=N(),n=M("div"),i=M("div"),r=M("img"),a=N(),s=M("div");for(let e=0;e<d.length;e+=1)d[e].c();l=N(),ce(u.$$.fragment),B(r,"alt","crosshair"),p(r.src,o="assets/images/crosshair.png")||B(r,"src","assets/images/crosshair.png"),B(r,"class","crosshair svelte-1ueuazj"),B(s,"class","topContainer svelte-1ueuazj"),B(i,"id","three-tps-demo"),B(n,"class","wrapper svelte-1ueuazj")},m(e,o){c&&c.m(e,o),w(e,t,o),w(e,n,o),z(n,i),z(i,r),z(i,a),z(i,s);for(let e=0;e<d.length;e+=1)d[e].m(s,null);z(i,l),_e(u,i,null),h=!0},p(e,[n]){if(e[0]?c&&(ie(),ae(c,1,1,(()=>{c=null})),re()):c?1&n&&oe(c,1):(c=ZT(),c.c(),oe(c,1),c.m(t.parentNode,t)),2&n){let t;for(_=e[1],t=0;t<_.length;t+=1){const i=wT(e,_,t);d[t]?(d[t].p(i,n),oe(d[t],1)):(d[t]=ET(i),d[t].c(),oe(d[t],1),d[t].m(s,null))}for(ie(),t=_.length;t<d.length;t+=1)m(t);re()}},i(e){if(!h){oe(c);for(let e=0;e<_.length;e+=1)oe(d[e]);oe(u.$$.fragment,e),h=!0}},o(e){ae(c),d=d.filter(Boolean);for(let e=0;e<d.length;e+=1)ae(d[e]);ae(u.$$.fragment,e),h=!1},d(e){c&&c.d(e),e&&Z(t),e&&Z(n),E(d,e),de(u)}}}function ST(e,t,n){let i=!1;const{components:r,worldConfig:o,isPointerLockNeeded:a}=h(be)||{};return window.tpsDemo.on.init((()=>{setTimeout((()=>{n(0,i=!0)}),1e3)})),Be.isPointerLockNeeded=a,H((()=>{((e,t)=>{const n=document.querySelector(e);n.querySelector(".crosshair").style.visibility="hidden",gy({target:n,worldConfig:t}).then((e=>{Object.keys(fz).forEach((e=>{fz[e].map=Oh(fz[e].map)})),window.tpsDemo.game.world=e,zT.forEach((e=>e())),Be.isPointerLockNeeded&&(n.onclick=()=>{n.requestPointerLock(),n.onclick=null}),e.on.update((e=>{e.isPaused||(({now:e,delta:t,elapsed:n})=>{fT.forEach((i=>{const{onUpdate:r,generalData:o,onComplete:a,particleSystem:s,wrapper:l,creationTime:p,lastEmissionTime:u,duration:h,looping:c,emission:_,normalizedConfig:d,iterationCount:m,velocities:P,deactivateParticle:f,activateParticle:x,simulationSpace:y,gravity:v}=i,{lastWorldPosition:g,currentWorldPosition:b,worldPositionChange:z,lastWorldQuaternion:w,worldQuaternion:Z,worldEuler:E,gravityVelocity:M,isEnabled:S}=o;l&&o.wrapperQuaternion.copy(l.parent.quaternion);const C={...g},N=e-p;if(s.material.uniforms.elapsed.value=n,s.getWorldPosition(b),-99999!==g.x&&z.set(b.x-g.x,b.y-g.y,b.z-g.z),o.distanceFromLastEmitByDistance+=z.length(),s.getWorldPosition(g),s.getWorldQuaternion(Z),-99999!==w.x&&w.x==Z.x&&w.y==Z.y&&w.z==Z.z||(E.setFromQuaternion(Z),w.copy(Z),M.set(g.x,g.y+v,g.z),s.worldToLocal(M)),o.creationTimes.forEach(((i,r)=>{if(s.geometry.attributes.isActive.array[r]){const a=e-i;if(a>s.geometry.attributes.startLifetime.array[r])f(r);else{const e=P[r];if(e.x-=M.x*t,e.y-=M.y*t,e.z-=M.z*t,0!==v||0!==e.x||0!==e.y||0!==e.z||0!==z.x||0!==z.y||0!==z.z){const n=3*r,i=s.geometry.attributes.position.array;y===ZZ&&(i[n]-=z.x,i[n+1]-=z.y,i[n+2]-=z.z),i[n]+=e.x*t,i[n+1]+=e.y*t,i[n+2]+=e.z*t,s.geometry.attributes.position.needsUpdate=!0}s.geometry.attributes.lifetime.array[r]=a,s.geometry.attributes.lifetime.needsUpdate=!0;const i=a/s.geometry.attributes.startLifetime.array[r];mT({delta:t,elapsed:n,noise:o.noise,startValues:o.startValues,lifetimeValues:o.lifetimeValues,hasOrbitalVelocity:o.hasOrbitalVelocity,orbitalVelocityData:o.orbitalVelocityData,normalizedConfig:d,attributes:s.geometry.attributes,particleLifetime:a,particleLifetimePercentage:i,particleIndex:r})}}})),S&&(c||N<1e3*h)){const a=e-u,l=Math.floor(_.rateOverTime*(a/1e3)),p=_.rateOverDistance>0&&o.distanceFromLastEmitByDistance>0?Math.floor(o.distanceFromLastEmitByDistance/(1/_.rateOverDistance)):0,h=p>0?{x:(b.x-C.x)/p,y:(b.y-C.y)/p,z:(b.z-C.z)/p}:null,c=l+p;if(_.rateOverDistance>0&&p>=1&&(o.distanceFromLastEmitByDistance=0),c>0){let t=0;for(let n=0;n<c;n++){let n=-1;if(s.geometry.attributes.isActive.array.find(((e,t)=>!e&&(n=t,!0))),-1!==n&&n<s.geometry.attributes.isActive.array.length){let r;t<p&&(r=t<p?{x:h.x*t,y:h.y*t,z:h.z*t}:null,t++),x({particleIndex:n,activationTime:e,position:r}),i.lastEmissionTime=e}}}r&&r({particleSystem:s,delta:t,elapsed:n,lifetime:N,iterationCount:m+1})}else a&&a({particleSystem:s})}))})(e),Be.cycleData={...e}}))})).catch((e=>console.log(`Ops! ${e.stack}`)))})("#three-tps-demo",o)})),[i,r]}class CT extends Pe{constructor(e){super(),me(this,e,ST,MT,a,{})}}function NT(e){let t,n;const i=e[1].default,r=_(i,e,e[0],null);return{c(){t=M("div"),r&&r.c(),B(t,"class","wrapper svelte-e95431")},m(e,i){w(e,t,i),r&&r.m(t,null),n=!0},p(e,[t]){r&&r.p&&(!n||1&t)&&P(r,i,e,e[0],n?m(i,e[0],t,null):f(e[0]),null)},i(e){n||(oe(r,e),n=!0)},o(e){ae(r,e),n=!1},d(e){e&&Z(t),r&&r.d(e)}}}function AT(e,t,n){let{$$slots:i={},$$scope:r}=t;return e.$$set=e=>{"$$scope"in e&&n(0,r=e.$$scope)},[r,i]}class LT extends Pe{constructor(e){super(),me(this,e,AT,NT,a,{})}}function BT(e){let t,n,i,r,o,a;return{c(){t=M("div"),n=M("img"),r=N(),o=M("div"),a=C(e[1]),B(n,"alt","tank"),p(n.src,i=e[0])||B(n,"src",i),B(n,"class","svelte-5rwjjl"),B(o,"class","info svelte-5rwjjl"),B(t,"class","wrapper svelte-5rwjjl")},m(e,i){w(e,t,i),z(t,n),z(t,r),z(t,o),z(o,a)},p(e,t){1&t&&!p(n.src,i=e[0])&&B(n,"src",i),2&t&&k(a,e[1])},d(e){e&&Z(t)}}}function TT(e){let t,n;return t=new LT({props:{$$slots:{default:[BT]},$$scope:{ctx:e}}}),{c(){ce(t.$$.fragment)},m(e,i){_e(t,e,i),n=!0},p(e,[n]){const i={};7&n&&(i.$$scope={dirty:n,ctx:e}),t.$set(i)},i(e){n||(oe(t.$$.fragment,e),n=!0)},o(e){ae(t.$$.fragment,e),n=!1},d(e){de(t,e)}}}function VT(e,t,n){let{imgUrl:i}=t,{count:r}=t;return e.$$set=e=>{"imgUrl"in e&&n(0,i=e.imgUrl),"count"in e&&n(1,r=e.count)},[i,r]}class kT extends Pe{constructor(e){super(),me(this,e,VT,TT,a,{imgUrl:0,count:1})}}function IT(e){let t,n;return t=new kT({props:{imgUrl:"./assets/images/tank-green.webp",count:e[0]}}),{c(){ce(t.$$.fragment)},m(e,i){_e(t,e,i),n=!0},p(e,[n]){const i={};1&n&&(i.count=e[0]),t.$set(i)},i(e){n||(oe(t.$$.fragment,e),n=!0)},o(e){ae(t.$$.fragment,e),n=!1},d(e){de(t,e)}}}function OT(e,t,n){let i;return Ee.subscribe((e=>{n(0,i=e)})),[i]}function RT(e){let t,n;return t=new kT({props:{imgUrl:"./assets/images/tank-red.webp",count:e[0]}}),{c(){ce(t.$$.fragment)},m(e,i){_e(t,e,i),n=!0},p(e,[n]){const i={};1&n&&(i.count=e[0]),t.$set(i)},i(e){n||(oe(t.$$.fragment,e),n=!0)},o(e){ae(t.$$.fragment,e),n=!1},d(e){de(t,e)}}}function HT(e,t,n){let i;return Ze.subscribe((e=>{n(0,i=e)})),[i]}function FT(e){let t,n,i,r,o,a;return{c(){t=M("div"),n=M("img"),r=N(),o=M("div"),a=C(e[0]),B(n,"alt","life"),p(n.src,i="./assets/images/life.webp")||B(n,"src","./assets/images/life.webp"),B(n,"class","svelte-5rwjjl"),B(o,"class","info svelte-5rwjjl"),B(t,"class","wrapper svelte-5rwjjl")},m(e,i){w(e,t,i),z(t,n),z(t,r),z(t,o),z(o,a)},p(e,t){1&t&&k(a,e[0])},d(e){e&&Z(t)}}}function DT(e){let t,n;return t=new LT({props:{$$slots:{default:[FT]},$$scope:{ctx:e}}}),{c(){ce(t.$$.fragment)},m(e,i){_e(t,e,i),n=!0},p(e,[n]){const i={};3&n&&(i.$$scope={dirty:n,ctx:e}),t.$set(i)},i(e){n||(oe(t.$$.fragment,e),n=!0)},o(e){ae(t.$$.fragment,e),n=!1},d(e){de(t,e)}}}function GT(e,t,n){let i;return Me.subscribe((e=>{n(0,i=e)})),[i]}const UT="FLIP";function jT(e,t,n){const i=e.slice();return i[1]=t[n],i}function WT(e){let t,n,i,r,o,a,s,l=e[1].type+"",p=e[1].isBackFlip||e[1].isBackWheelie?"BACK":"FRONT",u=e[1].type===UT?`x${e[1].count}`:Math.floor(e[1].duration/100)/10+"s";return{c(){t=M("div"),n=C(l),i=N(),r=C(p),o=N(),a=C(u),s=N(),B(t,"class","info svelte-1ranjyd")},m(e,l){w(e,t,l),z(t,n),z(t,i),z(t,r),z(t,o),z(t,a),w(e,s,l)},p(e,t){1&t&&l!==(l=e[1].type+"")&&k(n,l),1&t&&p!==(p=e[1].isBackFlip||e[1].isBackWheelie?"BACK":"FRONT")&&k(r,p),1&t&&u!==(u=e[1].type===UT?`x${e[1].count}`:Math.floor(e[1].duration/100)/10+"s")&&k(a,u)},d(e){e&&Z(t),e&&Z(s)}}}function qT(e){let t,n;return t=new LT({props:{$$slots:{default:[WT]},$$scope:{ctx:e}}}),{c(){ce(t.$$.fragment)},m(e,i){_e(t,e,i),n=!0},p(e,n){const i={};17&n&&(i.$$scope={dirty:n,ctx:e}),t.$set(i)},i(e){n||(oe(t.$$.fragment,e),n=!0)},o(e){ae(t.$$.fragment,e),n=!1},d(e){de(t,e)}}}function JT(e){let t,n,i=e[0],r=[];for(let t=0;t<i.length;t+=1)r[t]=qT(jT(e,i,t));const o=e=>ae(r[e],1,1,(()=>{r[e]=null}));return{c(){t=M("div");for(let e=0;e<r.length;e+=1)r[e].c();B(t,"class","wrapper svelte-1ranjyd")},m(e,i){w(e,t,i);for(let e=0;e<r.length;e+=1)r[e].m(t,null);n=!0},p(e,[n]){if(1&n){let a;for(i=e[0],a=0;a<i.length;a+=1){const o=jT(e,i,a);r[a]?(r[a].p(o,n),oe(r[a],1)):(r[a]=qT(o),r[a].c(),oe(r[a],1),r[a].m(t,null))}for(ie(),a=i.length;a<r.length;a+=1)o(a);re()}},i(e){if(!n){for(let e=0;e<i.length;e+=1)oe(r[e]);n=!0}},o(e){r=r.filter(Boolean);for(let e=0;e<r.length;e+=1)ae(r[e]);n=!1},d(e){e&&Z(t),E(r,e)}}}function $T(e,t,n){let i;return Le.subscribe((e=>{n(0,i=e)})),[i]}function XT(e,t,n){const i=e.slice();return i[1]=t[n].name,i[2]=t[n].value,i[3]=t[n].selected,i[4]=t[n].isActive,i[6]=n,i}function YT(e){let t,n,i,r,o,a,s,l,p,u,h=e[6]+1+"",c=e[1]+"",_=e[2]+"";return{c(){t=M("div"),n=M("div"),i=C(h),r=C(". "),o=C(c),a=N(),s=M("div"),l=C(_),p=N(),B(n,"class","label svelte-8iizqa"),B(s,"class","entryContent"),B(t,"class",u=v(`entry ${!e[4]&&"deactivated"} ${e[3]&&"selected"}`)+" svelte-8iizqa")},m(e,u){w(e,t,u),z(t,n),z(n,i),z(n,r),z(n,o),z(t,a),z(t,s),z(s,l),z(t,p)},p(e,n){1&n&&c!==(c=e[1]+"")&&k(o,c),1&n&&_!==(_=e[2]+"")&&k(l,_),1&n&&u!==(u=v(`entry ${!e[4]&&"deactivated"} ${e[3]&&"selected"}`)+" svelte-8iizqa")&&B(t,"class",u)},d(e){e&&Z(t)}}}function KT(e){let t,n=e[0],i=[];for(let t=0;t<n.length;t+=1)i[t]=YT(XT(e,n,t));return{c(){t=M("div");for(let e=0;e<i.length;e+=1)i[e].c();B(t,"class","content svelte-8iizqa")},m(e,n){w(e,t,n);for(let e=0;e<i.length;e+=1)i[e].m(t,null)},p(e,r){if(1&r){let o;for(n=e[0],o=0;o<n.length;o+=1){const a=XT(e,n,o);i[o]?i[o].p(a,r):(i[o]=YT(a),i[o].c(),i[o].m(t,null))}for(;o<i.length;o+=1)i[o].d(1);i.length=n.length}},d(e){e&&Z(t),E(i,e)}}}function QT(e){let t,n,i;return n=new LT({props:{$$slots:{default:[KT]},$$scope:{ctx:e}}}),{c(){t=M("div"),ce(n.$$.fragment),B(t,"class","wrapper svelte-8iizqa")},m(e,r){w(e,t,r),_e(n,t,null),i=!0},p(e,[t]){const i={};129&t&&(i.$$scope={dirty:t,ctx:e}),n.$set(i)},i(e){i||(oe(n.$$.fragment,e),i=!0)},o(e){ae(n.$$.fragment,e),i=!1},d(e){e&&Z(t),de(n)}}}function eV(e,t,n){let i;return Ae.subscribe((e=>{n(0,i=e.sort(((e,t)=>t.value-e.value)))})),[i]}function tV(e){let t,n=oy(e[0],ny)+"";return{c(){t=C(n)},m(e,n){w(e,t,n)},p(e,i){1&i&&n!==(n=oy(e[0],ny)+"")&&k(t,n)},d(e){e&&Z(t)}}}function nV(e){let t,n,i;return n=new LT({props:{$$slots:{default:[tV]},$$scope:{ctx:e}}}),{c(){t=M("div"),ce(n.$$.fragment),B(t,"class","wrapper svelte-11q6bt2")},m(e,r){w(e,t,r),_e(n,t,null),i=!0},p(e,[t]){const i={};3&t&&(i.$$scope={dirty:t,ctx:e}),n.$set(i)},i(e){i||(oe(n.$$.fragment,e),i=!0)},o(e){ae(n.$$.fragment,e),i=!1},d(e){e&&Z(t),de(n)}}}function iV(e,t,n){let i=0;return H((()=>{const e=setInterval((()=>{n(0,i=Be.cycleData?.elapsed||0)}),1e3);return()=>{clearInterval(e)}})),[i]}class rV extends Pe{constructor(e){super(),me(this,e,iV,nV,a,{})}}const oV="PISTOL_SHOOT",aV="RIFLE_SHOOT",sV="HEAVY_SHOOT",lV="DASH",pV=({miss:e,count:t},{world:n,caster:i})=>{const r=i.getSelectedTool(),o=i.getRegisteredObject("projectileStart").object.getWorldPosition(new ev);for(let i=0;i<t;i++){const t=r.object.getWorldDirection(new ev);t.add(new ev(Math.random()*(2*e)-e,Math.random()*(2*e)-e,Math.random()*(2*e)-e)),r?.on?.activate({world:n,position:o,direction:t})}},uV={[oV]:{isReactivationNeeded:!0,castingTime:0,cooldownTime:500,on:{cast:e=>pV({miss:.01,count:1},e)}},[aV]:{isReactivationNeeded:!1,castingTime:0,cooldownTime:200,on:{cast:e=>pV({miss:.04,count:1},e)}},[sV]:{isReactivationNeeded:!1,castingTime:500,cooldownTime:1e3,on:{cast:e=>pV({miss:.02,count:4},e)}},[lV]:{isReactivationNeeded:!0,castingTime:0,cooldownTime:2e3,on:{cast:({world:e,caster:t})=>{window.tpsDemo.game.ability[lV]();const n=t.onGround?45:20,i=new ev;t.model.getWorldDirection(i),t.velocity.copy(i.multiply(new ev(n,0,n))),t.userData.isDashInProgress=!0,setTimeout((()=>t.userData.isDashInProgress=!1),400);const r=bT(fz[nz],e.cycleData.now),o=1/t.model.scale.x;r.instance.scale.set(o,o,o),r.instance.position.y*=o,t.model.add(r.instance),setTimeout(r.dispose,1e3)}}}};function hV(t){let n,i,r,o;return{c(){n=M("div"),i=S("svg"),r=S("circle"),B(r,"id","bar"),B(r,"r","25%"),B(r,"cx","50%"),B(r,"cy","50%"),B(r,"style",o=`stroke-dasharray: ${t[0]} 100; transition-duration: ${t[1]||200}ms`),B(r,"class","svelte-1oha6tq"),B(i,"viewBox","0 0 64 64"),B(i,"id","svg"),B(i,"width","100%"),B(i,"height","100%"),B(i,"version","1.1"),B(i,"xmlns","http://www.w3.org/2000/svg"),B(n,"class","wrapper svelte-1oha6tq")},m(e,t){w(e,n,t),z(n,i),z(i,r)},p(e,[t]){3&t&&o!==(o=`stroke-dasharray: ${e[0]} 100; transition-duration: ${e[1]||200}ms`)&&B(r,"style",o)},i:e,o:e,d(e){e&&Z(n)}}}function cV(e,t,n){let{percentage:i=0}=t,{transitionTime:r=0}=t;return e.$$set=e=>{"percentage"in e&&n(0,i=e.percentage),"transitionTime"in e&&n(1,r=e.transitionTime)},[i,r]}class _V extends Pe{constructor(e){super(),me(this,e,cV,hV,a,{percentage:0,transitionTime:1})}}function dV(e){let t,n;return t=new _V({props:{percentage:e[4],transitionTime:e[3]}}),{c(){ce(t.$$.fragment)},m(e,i){_e(t,e,i),n=!0},p(e,n){const i={};16&n&&(i.percentage=e[4]),8&n&&(i.transitionTime=e[3]),t.$set(i)},i(e){n||(oe(t.$$.fragment,e),n=!0)},o(e){ae(t.$$.fragment,e),n=!1},d(e){de(t,e)}}}function mV(e){let t,n,i,r,o,a,s,l,u=e[3]&&dV(e);return{c(){t=M("img"),i=N(),r=M("div"),o=C(e[2]),a=N(),u&&u.c(),s=A(),B(t,"alt",e[0]),p(t.src,n=e[1])||B(t,"src",n),B(t,"class","svelte-o5536z"),B(r,"class","key svelte-o5536z")},m(e,n){w(e,t,n),w(e,i,n),w(e,r,n),z(r,o),w(e,a,n),u&&u.m(e,n),w(e,s,n),l=!0},p(e,i){(!l||1&i)&&B(t,"alt",e[0]),(!l||2&i&&!p(t.src,n=e[1]))&&B(t,"src",n),(!l||4&i)&&k(o,e[2]),e[3]?u?(u.p(e,i),8&i&&oe(u,1)):(u=dV(e),u.c(),oe(u,1),u.m(s.parentNode,s)):u&&(ie(),ae(u,1,1,(()=>{u=null})),re())},i(e){l||(oe(u),l=!0)},o(e){ae(u),l=!1},d(e){e&&Z(t),e&&Z(i),e&&Z(r),e&&Z(a),u&&u.d(e),e&&Z(s)}}}function PV(e){let t,n,i;return n=new LT({props:{$$slots:{default:[mV]},$$scope:{ctx:e}}}),{c(){t=M("div"),ce(n.$$.fragment),B(t,"class","tool svelte-o5536z")},m(e,r){w(e,t,r),_e(n,t,null),i=!0},p(e,[t]){const i={};287&t&&(i.$$scope={dirty:t,ctx:e}),n.$set(i)},i(e){i||(oe(n.$$.fragment,e),i=!0)},o(e){ae(n.$$.fragment,e),i=!1},d(e){e&&Z(t),de(n)}}}function fV(e,t,n){let{id:i}=t,{name:r}=t,{cooldownTime:o}=t,{img:a}=t,{key:s}=t,l=0,p=0,u=null;return window.tpsDemo.game.ability[i]=()=>{u&&clearTimeout(u),n(3,l=1),n(4,p=0),setTimeout((()=>{n(4,p=100),n(3,l=o)}),10),u=setTimeout((()=>{n(3,l=0)}),o)},e.$$set=e=>{"id"in e&&n(5,i=e.id),"name"in e&&n(0,r=e.name),"cooldownTime"in e&&n(6,o=e.cooldownTime),"img"in e&&n(1,a=e.img),"key"in e&&n(2,s=e.key)},[r,a,s,l,p,i,o]}class xV extends Pe{constructor(e){super(),me(this,e,fV,PV,a,{id:5,name:0,cooldownTime:6,img:1,key:2})}}function yV(e,t,n){const i=e.slice();return i[2]=t[n],i}function vV(e,n){let i,r,o;const a=[n[2]];let s={};for(let e=0;e<a.length;e+=1)s=t(s,a[e]);return r=new xV({props:s}),{key:e,first:null,c(){i=A(),ce(r.$$.fragment),this.first=i},m(e,t){w(e,i,t),_e(r,e,t),o=!0},p(e,t){n=e;const i=1&t?ue(a,[he(n[2])]):{};r.$set(i)},i(e){o||(oe(r.$$.fragment,e),o=!0)},o(e){ae(r.$$.fragment,e),o=!1},d(e){e&&Z(i),de(r,e)}}}function gV(e){let t,n,i=[],r=new Map,o=e[0];const a=e=>e[2].name;for(let t=0;t<o.length;t+=1){let n=yV(e,o,t),s=a(n);r.set(s,i[t]=vV(s,n))}return{c(){t=M("div");for(let e=0;e<i.length;e+=1)i[e].c();B(t,"class","list svelte-gjyo2t")},m(e,r){w(e,t,r);for(let e=0;e<i.length;e+=1)i[e].m(t,null);n=!0},p(e,[n]){1&n&&(o=e[0],ie(),i=pe(i,n,a,1,e,o,r,t,le,vV,null,yV),re())},i(e){if(!n){for(let e=0;e<o.length;e+=1)oe(i[e]);n=!0}},o(e){for(let e=0;e<i.length;e+=1)ae(i[e]);n=!1},d(e){e&&Z(t);for(let e=0;e<i.length;e+=1)i[e].d()}}}function bV(e){const t=["cooldownTime"];return[[{...Object.entries(uV[lV]).reduce(((e,[n,i])=>({...e,...t.includes(n)?{[n]:i}:{}})),{}),id:lV,name:"Dash",img:"./assets/images/abilities/dash.png",key:"Q"}]]}class zV extends Pe{constructor(e){super(),me(this,e,bV,gV,a,{})}}const wV="SKYBOX_1",ZV="SKYBOX_2",EV="SKYBOX_3",MV="SKYBOX_4",SV="SKYBOX_5",CV="SKYBOX_6",NV="CHARACTERS",AV="CHARACTERS_IDLE",LV="CHARACTERS_WALK",BV="CHARACTERS_WALK_BACKWARDS",TV="CHARACTERS_RUN",VV="CHARACTERS_RUN_BACKWARDS",kV="CHARACTERS_JUMP_LOOP",IV="CHARACTERS_WALK_STRAFE_LEFT",OV="CHARACTERS_WALK_STRAFE_RIGHT",RV="CHARACTERS_RUN_STRAFE_LEFT",HV="CHARACTERS_RUN_STRAFE_RIGHT",FV="CHARACTERS_VICTORY",DV="CHARACTERS_DASH",GV="LEVEL_GRAPHIC",UV="LEVEL_COLLISION",jV="COIN",WV={textures:[{id:wV,url:"./assets/textures/skybox/left.webp"},{id:ZV,url:"./assets/textures/skybox/right.webp"},{id:EV,url:"./assets/textures/skybox/up.webp"},{id:MV,url:"./assets/textures/skybox/down.webp"},{id:SV,url:"./assets/textures/skybox/front.webp"},{id:CV,url:"./assets/textures/skybox/back.webp"},{id:"POINT",url:"./assets/textures/effects/point.webp"}],fbxModels:[{id:NV,url:"./assets/models/characters/model/characters.fbx",material:{materialType:ab}}],fbxSkeletonAnimations:[{id:AV,url:"./assets/models/characters/animations/idle.fbx"},{id:LV,url:"./assets/models/characters/animations/walk.fbx"},{id:BV,url:"./assets/models/characters/animations/walk-backwards.fbx"},{id:TV,url:"./assets/models/characters/animations/run.fbx"},{id:VV,url:"./assets/models/characters/animations/run-backwards.fbx"},{id:kV,url:"./assets/models/characters/animations/jump-loop.fbx"},{id:IV,url:"./assets/models/characters/animations/walk-strafe-left.fbx"},{id:OV,url:"./assets/models/characters/animations/walk-strafe-right.fbx"},{id:RV,url:"./assets/models/characters/animations/run-strafe-left.fbx"},{id:HV,url:"./assets/models/characters/animations/run-strafe-right.fbx"},{id:FV,url:"./assets/models/characters/animations/victory.fbx"},{id:DV,url:"./assets/models/characters/animations/dash.fbx"}],gltfModels:[{id:GV,url:"./assets/models/world/the-collector-graphic.glb"},{id:UV,url:"./assets/models/world/the-collector-collision.glb"},{id:jV,url:"./assets/models/collectibles/sm-polygon-prototype-icon-coin-01.glb",material:{color:16652161}}],audio:[{id:"GAME_BACKGROUND",url:"./assets/audio/music/game-theme.ogg"}]},qV="IDLE",JV="WALK",$V="WALK_BACKWARDS",XV="RUN",YV="RUN_BACKWARDS",KV="JUMP_LOOP",QV="WALK_STRAFE_RIGHT",ek="WALK_STRAFE_LEFT",tk="RUN_STRAFE_RIGHT",nk="RUN_STRAFE_LEFT",ik="RIFLE_IDLE",rk="RIFLE_WALK",ok="RIFLE_WALK_BACKWARDS",ak="RIFLE_RUN",sk="RIFLE_RUN_BACKWARDS",lk="RIFLE_JUMP_LOOP",pk="RIFLE_STRAFE_RIGHT",uk="RIFLE_STRAFE_LEFT",hk="PISTOL_IDLE",ck="PISTOL_WALK",_k="PISTOL_WALK_BACKWARDS",dk="PISTOL_RUN",mk="PISTOL_RUN_BACKWARDS",Pk="PISTOL_STRAFE_RIGHT",fk="PISTOL_STRAFE_LEFT",xk="PISTOL",yk="RIFLE",vk={name:"Basic Unit",modules:[],fbxModelId:null,model:{fbx:{id:null},scale:{x:1,y:1,z:1},traverseCallback:null,debug:{showSockets:!0}},height:1.8,radius:.33,speed:25,speedModifier:null,jumpForce:12,sockets:[],animationConfig:{},animations:{},name:"Humanoid Unit",animationConfig:{createCache:({velocity:e,getSelectedTool:t})=>{const n=e.clone();n.y=0;const i=n.length(),r=t()?.type;return{horizontalVelocity:i,usePistol:r===xk,useRifle:r===yk}},rules:[{condition:({onGround:e,inAirTime:t,isJumpTriggered:n,cache:{usePistol:i,useRifle:r}})=>(!e&&t>200||n)&&(i||r),animation:lk,transitionTime:.2,loop:!0},{condition:({onGround:e,inAirTime:t,isJumpTriggered:n})=>!e&&t>200||n,animation:KV,transitionTime:.2,loop:!0},{condition:({userData:{useAim:e},cache:{horizontalVelocity:t,useRifle:n}})=>e&&Math.abs(t)<.3&&n,animation:ik,transitionTime:.2,loop:!0},{condition:({userData:{useAim:e},cache:{horizontalVelocity:t,usePistol:n}})=>e&&Math.abs(t)<.3&&n,animation:hk,transitionTime:.2,loop:!0},{condition:({userData:{useAim:e},cache:{horizontalVelocity:t,selectedToolType:n}})=>(!e||!n)&&Math.abs(t)<.5,animation:qV,transitionTime:.2,loop:!0},{condition:({userData:{useAim:e,isStrafing:t,strafingDirection:n},cache:{useRifle:i}})=>t&&e&&1===n&&i,animation:uk,transitionTime:.2,loop:!0},{condition:({userData:{useAim:e,isStrafing:t,strafingDirection:n},cache:{usePistol:i}})=>t&&e&&1===n&&i,animation:fk,transitionTime:.2,loop:!0},{condition:({cache:{horizontalVelocity:e,isStrafing:t,strafingDirection:n}})=>t&&1===n&&e>4,animation:nk,transitionTime:.2,loop:!0},{condition:({userData:{isStrafing:e,strafingDirection:t}})=>e&&1===t,animation:ek,transitionTime:.2,loop:!0},{condition:({userData:{useAim:e,isStrafing:t,strafingDirection:n},cache:{usePistol:i,useRifle:r}})=>t&&e&&1!==n&&(i||r),animation:pk,transitionTime:.2,loop:!0},{condition:({userData:{useAim:e,isStrafing:t,strafingDirection:n},cache:{usePistol:i}})=>t&&e&&1!==n&&i,animation:Pk,transitionTime:.2,loop:!0},{condition:({cache:{horizontalVelocity:e,isStrafing:t,strafingDirection:n}})=>t&&1!==n&&e>4,animation:tk,transitionTime:.2,loop:!0},{condition:({userData:{isStrafing:e,strafingDirection:t}})=>e&&1!==t,animation:QV,transitionTime:.2,loop:!0},{condition:({userData:{useAim:e,moveBack:t},cache:{horizontalVelocity:n,useRifle:i}})=>e&&n>4&&t&&i,animation:sk,transitionTime:.2,loop:!0},{condition:({userData:{useAim:e,moveBack:t},cache:{horizontalVelocity:n,usePistol:i}})=>e&&n>4&&t&&i,animation:mk,transitionTime:.2,loop:!0},{condition:({userData:{useAim:e,moveBack:t},cache:{horizontalVelocity:n}})=>e&&n>4&&t,animation:YV,transitionTime:.2,loop:!0},{condition:({userData:{useAim:e,moveBack:t},cache:{horizontalVelocity:n,useRifle:i}})=>e&&n>1&&t&&i,animation:ok,transitionTime:.2,loop:!0},{condition:({userData:{useAim:e,moveBack:t},cache:{horizontalVelocity:n,usePistol:i}})=>e&&n>1&&t&&i,animation:_k,transitionTime:.2,loop:!0},{condition:({userData:{useAim:e,moveBack:t},cache:{horizontalVelocity:n}})=>e&&n>1&&t,animation:$V,transitionTime:.2,loop:!0},{condition:({userData:{useAim:e},cache:{horizontalVelocity:t,useRifle:n}})=>e&&t>4&&n,animation:ak,transitionTime:.2,loop:!0},{condition:({userData:{useAim:e},cache:{horizontalVelocity:t,usePistol:n}})=>e&&t>4&&n,animation:dk,transitionTime:.2,loop:!0},{condition:({cache:{horizontalVelocity:e}})=>e>4,animation:XV,transitionTime:.2,loop:!0},{condition:({userData:{useAim:e},cache:{useRifle:t}})=>e&&t,animation:rk,transitionTime:.2,loop:!0},{condition:({userData:{useAim:e},cache:{usePistol:t}})=>e&&t,animation:ck,transitionTime:.2,loop:!0},{condition:()=>!0,animation:JV,transitionTime:.2,loop:!0}]}},gk="OCTREE",bk="PROJECTILES",zk="COLLECTIBLES",wk="REGION",Zk="VERLET_INTEGRATION",Ek="OCTREE_CAR",Mk="UNITS",Sk="PLAYER_CONTROLLER",Ck="THIRD_PERSON_CAMERA",Nk="NAPE",Ak="NAPE_CAR",Lk="AIMING",Bk="ABILITIES",Tk="TPS_MOVEMENT",Vk={id:Bk,create:({world:e,unit:t,config:n})=>{const i=Object.keys(n).reduce(((e,t)=>({...e,[t]:{lastActivationTime:0,lastCastingTime:0,isCasted:!1,isActive:!1,isDisabled:!1}})),{});return{activate:t=>{Object.keys(i).forEach((e=>i[e].isActive=!1));const n=i[t];n.lastActivationTime=e.cycleData.now,n.isActive=!0},deactivate:e=>i[e].isActive=!1,enableAbility:e=>i[e].isDisabled=!1,disableAbility:e=>i[e].isDisabled=!0,update:({now:r})=>{Object.keys(i).forEach((o=>{const a=i[o],s=n[o];a.isActive&&!a.isDisabled&&!a.isCasted&&r-a.lastActivationTime>=s.castingTime?(a.isCasted=!0,a.lastCastingTime=r,s.on.cast({world:e,caster:t})):a.isCasted&&r-a.lastCastingTime>=s.cooldownTime&&(a.isCasted=!1,s.isReactivationNeeded?a.isActive=!1:a.lastActivationTime=r)}))}}},config:{}},kk="SPINE",Ik="LEFT_ELBOW",Ok="LEFT_HAND",Rk="RIGHT_HAND",Hk={id:Lk,create:({world:e,unit:t})=>{const n=new p_,i=new p_,r=new p_,o=new p_,a=new p_,s=new R_,{worldOctree:l}=e.getModule(gk),p=t.getSocket(Ok),u=t.getSocket(Rk),h=t.getSocket(Ik),c=t.getSocket(kk);let _,d,m;return{setLeftHandOffset:e=>n.copy(e),update:()=>{if(_)if(t.userData.useAim&&t.getSelectedTool()?.type){const e=_.getWorldPosition(new p_),t=_.getWorldDirection(new p_);s.origin.copy(e),s.direction.copy(t);const P=l.rayIntersect(s);i.copy(P?.position||e.add(t.setLength(15))),d||(d=p.parent.parent,m=p.parent.position.clone()),u.parent.add(p.parent),o.lerp(i,.1),c.parent.lookAt(o),c.parent.rotateY(Math.PI/2-.5),r.lerp(i,.2),u.parent.lookAt(r),u.parent.rotateX(Math.PI/2),p.parent.position.copy(n),p.parent.rotation.set(Math.PI/2,-Math.PI/4,Math.PI/2),p.parent.updateWorldMatrix(!0,!1),a.set(0,0,0),p.parent.localToWorld(a),h.parent.lookAt(a),h.parent.updateWorldMatrix(!0,!1),h.parent.rotateZ(-Math.PI/2),h.parent.rotateX(Math.PI/2)}else d&&(d.add(p.parent),p.parent.position.copy(m),m=null,d=null);else _=e.userData.tpsCamera?.instance}}},config:{}},Fk="CHARACTERS_VICTORY",Dk="CHARACTERS_DASH",Gk="MALE_CHARACTER",Uk={[qV]:AV,[JV]:LV,[$V]:BV,[XV]:TV,[YV]:VV,[KV]:kV,[ek]:IV,[QV]:OV,[nk]:RV,[tk]:HV,[Fk]:FV,[Dk]:DV},jk=ty(vk,{modules:[Hk,{...Vk,config:uV}],model:{fbx:{id:NV},scale:new ev(.0095,.0095,.0095),debug:{showSockets:!1}},animationConfig:{rules:[{condition:({userData:e})=>e?.showVictoryAnimation,animation:Fk,transitionTime:.2,loop:!1},{condition:({userData:e})=>e?.isDashInProgress,animation:Dk,transitionTime:.2,loop:!1},...vk.animationConfig.rules]},animations:Uk,speed:25,speedModifier:e=>(e.onGround?e.config.speed:8)*(e.userData.useSprint?2:1)}),Wk={[Gk]:ey(jk,{name:"male-character",model:{traverseCallback:e=>{e.isMesh&&e.name.includes("Female")&&(e.visible=!1)}}}),FEMALE_CHARACTER:ey(jk,{name:"female-character",model:{traverseCallback:e=>{e.isMesh&&e.name.includes("Male")&&(e.visible=!1)}}})},qk={};let Jk="ongamepadconnected"in window;const $k=({gamepad:e})=>{qk[e.index]=e};function Xk({gamepad:e}){delete qk[e.index]}const Yk={ActionBottom:0,ActionLeft:2,ActionRight:1,ActionTop:3,LeftTrigger:6,RightTrigger:7,Options:9,LeftAxisButton:10,RightAxisButton:11,Up:12,Down:13,Left:14,Right:15,LeftAxisX:100,LeftAxisY:101,RightAxisX:102,RightAxisY:103},Kk=e=>{const t={pressed:!1,value:0};return Object.keys(qk).find((n=>{const i=qk[n];let r=!1,o=0;if([Yk.LeftAxisX,Yk.LeftAxisY,Yk.RightAxisX,Yk.RightAxisY].includes(e)){const t=e-100,n=i.axes[t];r=Kk(t===Yk.LeftAxisX||t===Yk.LeftAxisY?Yk.LeftAxisButton:Yk.RightAxisButton).pressed,o=Math.floor(10*Math.abs(n))/10*(n<0?-1:1)}else{const t=i.buttons[e];r=1===t,o=t,"object"==typeof o&&(r=o.pressed,o=o.value)}return t.pressed=r,t.value=o,r})),t},Qk={...Array.from({length:10}).reduce(((e,t,n)=>{const i=String.fromCharCode(48+n);return{...e,[i]:i}}),{}),...Array.from({length:26}).reduce(((e,t,n)=>{const i=String.fromCharCode(65+n);return{...e,[i]:i.toLowerCase()}}),{}),ARROW_UP:"ArrowUp",ARROW_DOWN:"ArrowDown",ARROW_LEFT:"ArrowLeft",ARROW_RIGHT:"ArrowRight",SHIFT:"Shift",CONTROL:"Control",ALT:"Alt",TAB:"Tab",SPACE:" ",ESCAPE:"Escape"},eI={PAUSE:"PAUSE",FORWARD:"FORWARD",BACKWARD:"BACKWARD",LEFT:"LEFT",RIGHT:"RIGHT",JUMP:"JUMP",SPRINT:"SPRINT",TOOL_ACTION:"TOOL_ACTION",CHOOSE_NEXT_TOOL:"CHOOSE_NEXT_TOOL",CHOOSE_PREV_TOOL:"CHOOSE_PREV_TOOL",...Array.from({length:10}).reduce(((e,t,n)=>({...e,[`CHOOSE_TOOL_${n}`]:`CHOOSE_TOOL_${n}`})),{})},tI={actionConfig:[{actionId:eI.PAUSE,enableDuringPause:!0,keys:[Qk.P],gamepadButtons:[Yk.Options]},{actionId:eI.FORWARD,listenForDeactivation:!0,keys:[Qk.W,Qk.ARROW_UP],gamepadButtons:[Yk.Up],axis:Yk.LeftAxisY,axisValidator:e=>e<-.1,axisValueModifier:e=>-1*e},{actionId:eI.BACKWARD,listenForDeactivation:!0,keys:[Qk.S,Qk.ARROW_DOWN],gamepadButtons:[Yk.Down],axis:Yk.LeftAxisY,axisValidator:e=>e>.1},{actionId:eI.LEFT,listenForDeactivation:!0,keys:[Qk.A,Qk.ARROW_LEFT],gamepadButtons:[Yk.Left],axis:Yk.LeftAxisX,axisValidator:e=>e<-.1,axisValueModifier:e=>-1*e},{actionId:eI.RIGHT,listenForDeactivation:!0,keys:[Qk.D,Qk.ARROW_RIGHT],gamepadButtons:[Yk.Right],axis:Yk.LeftAxisX,axisValidator:e=>e>.1},{actionId:eI.JUMP,keys:[Qk.SPACE],gamepadButtons:[Yk.ActionBottom]}],handlers:[{actionId:eI.PAUSE,callback:({world:e})=>{e.cycleData.isPaused?e.resume():e.pause()}},{actionId:eI.JUMP,callback:({target:e})=>{e.onGround&&e.jump()}}]},nI={actionConfig:[{actionId:eI.PAUSE,enableDuringPause:!0,keys:[Qk.P],gamepadButtons:[Yk.Options]},{actionId:eI.FORWARD,listenForDeactivation:!0,keys:[Qk.W,Qk.ARROW_UP],gamepadButtons:[Yk.Up],axis:Yk.LeftAxisY,axisValidator:e=>e<-.1,axisValueModifier:e=>-1*e},{actionId:eI.BACKWARD,listenForDeactivation:!0,keys:[Qk.S,Qk.ARROW_DOWN],gamepadButtons:[Yk.Down],axis:Yk.LeftAxisY,axisValidator:e=>e>.1},{actionId:eI.LEFT,listenForDeactivation:!0,keys:[Qk.A,Qk.ARROW_LEFT],gamepadButtons:[Yk.Left],axis:Yk.LeftAxisX,axisValidator:e=>e<-.1,axisValueModifier:e=>-1*e},{actionId:eI.RIGHT,listenForDeactivation:!0,keys:[Qk.D,Qk.ARROW_RIGHT],gamepadButtons:[Yk.Right],axis:Yk.LeftAxisX,axisValidator:e=>e>.1}],handlers:[{actionId:eI.PAUSE,callback:({world:e})=>{e.cycleData.isPaused?e.resume():e.pause()}},{actionId:eI.FORWARD,callback:({target:e})=>{e.accelerate()}},{actionId:eI.BACKWARD,callback:({target:e})=>{e.reverse()}},{actionId:eI.LEFT,callback:({target:e})=>{e.rotateLeft()}},{actionId:eI.RIGHT,callback:({target:e})=>{e.rotateRight()}}]},iI="LEFT_BUTTON",rI="MIDDLE_BUTTON",oI="RIGHT_BUTTON",aI="SCROLL_UP",sI="SCROLL_DOWN",lI="CAMERA",pI="AIM",uI={actionConfig:[...tI.actionConfig,{actionId:lI,customTrigger:e=>{document.addEventListener("mousemove",(({movementX:t,movementY:n})=>{e({x:t/350,y:n/350})}))},gamepadButtons:[Yk.LeftAxisX,Yk.LeftAxisY]},{actionId:pI,mouse:[oI],gamepadButtons:[Yk.LeftTrigger]}],handlers:[...tI.handlers,{actionId:eI.FORWARD,callback:({target:e,value:t})=>{e.getModule(Tk).setForwardValue(t)}},{actionId:eI.BACKWARD,callback:({target:e,value:t})=>{e.getModule(Tk).setBackwardValue(t)}},{actionId:eI.LEFT,callback:({target:e,value:t})=>{e.getModule(Tk).setLeftValue(t)}},{actionId:eI.RIGHT,callback:({target:e,value:t})=>{e.getModule(Tk).setRightValue(t)}},{actionId:lI,callback:({world:{userData:e},value:{x:t,y:n}})=>{e.tpsCamera&&e.tpsCamera.rotate({x:t,y:n})}},{actionId:pI,callback:({target:e,world:{userData:t}})=>{if(e.userData.useAim=!e.userData.useAim,!t.tpsCamera)return;const n=t.tpsCamera;e.userData.useAim?(n.setMaxDistance(1),n.setPositionOffset(new p_(.5,1.5,0)),n.setYBoundaries({min:1,max:2.6})):(n.setMaxDistance(3),n.setPositionOffset(new p_(0,1.6,0)),n.setYBoundaries({max:2.7}))}}]},hI="DASH",cI="CHANGE_CAMERA_DISTANCE";let _I=0;const dI=[3,4,2],mI={actionConfig:[...uI.actionConfig,{actionId:eI.SPRINT,listenForDeactivation:!0,keys:[Qk.SHIFT],gamepadButtons:[Yk.LeftAxisButton]},{actionId:hI,keys:[Qk.Q],gamepadButtons:[Yk.ActionRight]},{actionId:cI,keys:[Qk.C]}],handlers:[...uI.handlers,{actionId:eI.SPRINT,callback:({target:e,value:t})=>{e.userData.useSprint=t}},{actionId:hI,callback:({target:e,value:t})=>{const n=e.getModule(Bk);1===t&&n.activate(lV)}},{actionId:pI,callback:({target:e,world:t})=>{!e.userData.useAim&&t.userData.tpsCamera&&t.userData.tpsCamera.setMaxDistance(t.userData.maxCameraDistance||dI[0])}},{actionId:cI,callback:({world:e,target:t})=>{_I++,_I===dI.length&&(_I=0),e.userData.maxCameraDistance=dI[_I],!t.userData.useAim&&e.userData.tpsCamera&&e.userData.tpsCamera.setMaxDistance(e.userData.maxCameraDistance)}}]};function PI(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function fI(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}
/*!
     * GSAP 3.10.4
     * https://greensock.com
     *
     * @license Copyright 2008-2022, GreenSock. All rights reserved.
     * Subject to the terms at https://greensock.com/standard-license or for
     * Club GreenSock members, the agreement issued with that membership.
     * @author: Jack Doyle, jack@greensock.com
    */var xI,yI,vI,gI,bI,zI,wI,ZI,EI,MI,SI,CI,NI,AI={autoSleep:120,force3D:"auto",nullTargetWarn:1,units:{lineHeight:""}},LI={duration:.5,overwrite:!1,delay:0},BI=1e8,TI=1e-8,VI=2*Math.PI,kI=VI/4,II=0,OI=Math.sqrt,RI=Math.cos,HI=Math.sin,FI=function(e){return"string"==typeof e},DI=function(e){return"function"==typeof e},GI=function(e){return"number"==typeof e},UI=function(e){return void 0===e},jI=function(e){return"object"==typeof e},WI=function(e){return!1!==e},qI=function(){return"undefined"!=typeof window},JI=function(e){return DI(e)||FI(e)},$I="function"==typeof ArrayBuffer&&ArrayBuffer.isView||function(){},XI=Array.isArray,YI=/(?:-?\.?\d|\.)+/gi,KI=/[-+=.]*\d+[.e\-+]*\d*[e\-+]*\d*/g,QI=/[-+=.]*\d+[.e-]*\d*[a-z%]*/g,eO=/[-+=.]*\d+\.?\d*(?:e-|e\+)?\d*/gi,tO=/[+-]=-?[.\d]+/,nO=/[^,'"\[\]\s]+/gi,iO=/^[+\-=e\s\d]*\d+[.\d]*([a-z]*|%)\s*$/i,rO={},oO={},aO=function(e){return(oO=LO(e,rO))&&gH},sO=function(e,t){return console.warn("Invalid property",e,"set to",t,"Missing plugin? gsap.registerPlugin()")},lO=function(e,t){return!t&&console.warn(e)},pO=function(e,t){return e&&(rO[e]=t)&&oO&&(oO[e]=t)||rO},uO=function(){return 0},hO={},cO=[],_O={},dO={},mO={},PO=30,fO=[],xO="",yO=function(e){var t,n,i=e[0];if(jI(i)||DI(i)||(e=[e]),!(t=(i._gsap||{}).harness)){for(n=fO.length;n--&&!fO[n].targetTest(i););t=fO[n]}for(n=e.length;n--;)e[n]&&(e[n]._gsap||(e[n]._gsap=new UR(e[n],t)))||e.splice(n,1);return e},vO=function(e){return e._gsap||yO(pR(e))[0]._gsap},gO=function(e,t,n){return(n=e[t])&&DI(n)?e[t]():UI(n)&&e.getAttribute&&e.getAttribute(t)||n},bO=function(e,t){return(e=e.split(",")).forEach(t)||e},zO=function(e){return Math.round(1e5*e)/1e5||0},wO=function(e){return Math.round(1e7*e)/1e7||0},ZO=function(e,t){var n=t.charAt(0),i=parseFloat(t.substr(2));return e=parseFloat(e),"+"===n?e+i:"-"===n?e-i:"*"===n?e*i:e/i},EO=function(e,t){for(var n=t.length,i=0;e.indexOf(t[i])<0&&++i<n;);return i<n},MO=function(){var e,t,n=cO.length,i=cO.slice(0);for(_O={},cO.length=0,e=0;e<n;e++)(t=i[e])&&t._lazy&&(t.render(t._lazy[0],t._lazy[1],!0)._lazy=0)},SO=function(e,t,n,i){cO.length&&MO(),e.render(t,n,i),cO.length&&MO()},CO=function(e){var t=parseFloat(e);return(t||0===t)&&(e+"").match(nO).length<2?t:FI(e)?e.trim():e},NO=function(e){return e},AO=function(e,t){for(var n in t)n in e||(e[n]=t[n]);return e},LO=function(e,t){for(var n in t)e[n]=t[n];return e},BO=function e(t,n){for(var i in n)"__proto__"!==i&&"constructor"!==i&&"prototype"!==i&&(t[i]=jI(n[i])?e(t[i]||(t[i]={}),n[i]):n[i]);return t},TO=function(e,t){var n,i={};for(n in e)n in t||(i[n]=e[n]);return i},VO=function(e){var t,n=e.parent||yI,i=e.keyframes?(t=XI(e.keyframes),function(e,n){for(var i in n)i in e||"duration"===i&&t||"ease"===i||(e[i]=n[i])}):AO;if(WI(e.inherit))for(;n;)i(e,n.vars.defaults),n=n.parent||n._dp;return e},kO=function(e,t,n,i,r){void 0===n&&(n="_first"),void 0===i&&(i="_last");var o,a=e[i];if(r)for(o=t[r];a&&a[r]>o;)a=a._prev;return a?(t._next=a._next,a._next=t):(t._next=e[n],e[n]=t),t._next?t._next._prev=t:e[i]=t,t._prev=a,t.parent=t._dp=e,t},IO=function(e,t,n,i){void 0===n&&(n="_first"),void 0===i&&(i="_last");var r=t._prev,o=t._next;r?r._next=o:e[n]===t&&(e[n]=o),o?o._prev=r:e[i]===t&&(e[i]=r),t._next=t._prev=t.parent=null},OO=function(e,t){e.parent&&(!t||e.parent.autoRemoveChildren)&&e.parent.remove(e),e._act=0},RO=function(e,t){if(e&&(!t||t._end>e._dur||t._start<0))for(var n=e;n;)n._dirty=1,n=n.parent;return e},HO=function(e){for(var t=e.parent;t&&t.parent;)t._dirty=1,t.totalDuration(),t=t.parent;return e},FO=function e(t){return!t||t._ts&&e(t.parent)},DO=function(e){return e._repeat?GO(e._tTime,e=e.duration()+e._rDelay)*e:0},GO=function(e,t){var n=Math.floor(e/=t);return e&&n===e?n-1:n},UO=function(e,t){return(e-t._start)*t._ts+(t._ts>=0?0:t._dirty?t.totalDuration():t._tDur)},jO=function(e){return e._end=wO(e._start+(e._tDur/Math.abs(e._ts||e._rts||TI)||0))},WO=function(e,t){var n=e._dp;return n&&n.smoothChildTiming&&e._ts&&(e._start=wO(n._time-(e._ts>0?t/e._ts:((e._dirty?e.totalDuration():e._tDur)-t)/-e._ts)),jO(e),n._dirty||RO(n,e)),e},qO=function(e,t){var n;if((t._time||t._initted&&!t._dur)&&(n=UO(e.rawTime(),t),(!t._dur||oR(0,t.totalDuration(),n)-t._tTime>TI)&&t.render(n,!0)),RO(e,t)._dp&&e._initted&&e._time>=e._dur&&e._ts){if(e._dur<e.duration())for(n=e;n._dp;)n.rawTime()>=0&&n.totalTime(n._tTime),n=n._dp;e._zTime=-1e-8}},JO=function(e,t,n,i){return t.parent&&OO(t),t._start=wO((GI(n)?n:n||e!==yI?nR(e,n,t):e._time)+t._delay),t._end=wO(t._start+(t.totalDuration()/Math.abs(t.timeScale())||0)),kO(e,t,"_first","_last",e._sort?"_start":0),KO(t)||(e._recent=t),i||qO(e,t),e},$O=function(e,t){return(rO.ScrollTrigger||sO("scrollTrigger",t))&&rO.ScrollTrigger.create(t,e)},XO=function(e,t,n,i){return KR(e,t),e._initted?!n&&e._pt&&(e._dur&&!1!==e.vars.lazy||!e._dur&&e.vars.lazy)&&wI!==AR.frame?(cO.push(e),e._lazy=[t,i],1):void 0:1},YO=function e(t){var n=t.parent;return n&&n._ts&&n._initted&&!n._lock&&(n.rawTime()<0||e(n))},KO=function(e){var t=e.data;return"isFromStart"===t||"isStart"===t},QO=function(e,t,n,i){var r=e._repeat,o=wO(t)||0,a=e._tTime/e._tDur;return a&&!i&&(e._time*=o/e._dur),e._dur=o,e._tDur=r?r<0?1e10:wO(o*(r+1)+e._rDelay*r):o,a>0&&!i?WO(e,e._tTime=e._tDur*a):e.parent&&jO(e),n||RO(e.parent,e),e},eR=function(e){return e instanceof WR?RO(e):QO(e,e._dur)},tR={_start:0,endTime:uO,totalDuration:uO},nR=function e(t,n,i){var r,o,a,s=t.labels,l=t._recent||tR,p=t.duration()>=BI?l.endTime(!1):t._dur;return FI(n)&&(isNaN(n)||n in s)?(o=n.charAt(0),a="%"===n.substr(-1),r=n.indexOf("="),"<"===o||">"===o?(r>=0&&(n=n.replace(/=/,"")),("<"===o?l._start:l.endTime(l._repeat>=0))+(parseFloat(n.substr(1))||0)*(a?(r<0?l:i).totalDuration()/100:1)):r<0?(n in s||(s[n]=p),s[n]):(o=parseFloat(n.charAt(r-1)+n.substr(r+1)),a&&i&&(o=o/100*(XI(i)?i[0]:i).totalDuration()),r>1?e(t,n.substr(0,r-1),i)+o:p+o)):null==n?p:+n},iR=function(e,t,n){var i,r,o=GI(t[1]),a=(o?2:1)+(e<2?0:1),s=t[a];if(o&&(s.duration=t[1]),s.parent=n,e){for(i=s,r=n;r&&!("immediateRender"in i);)i=r.vars.defaults||{},r=WI(r.vars.inherit)&&r.parent;s.immediateRender=WI(i.immediateRender),e<2?s.runBackwards=1:s.startAt=t[a-1]}return new iH(t[0],s,t[a+1])},rR=function(e,t){return e||0===e?t(e):t},oR=function(e,t,n){return n<e?e:n>t?t:n},aR=function(e,t){return FI(e)&&(t=iO.exec(e))?t[1]:""},sR=[].slice,lR=function(e,t){return e&&jI(e)&&"length"in e&&(!t&&!e.length||e.length-1 in e&&jI(e[0]))&&!e.nodeType&&e!==vI},pR=function(e,t,n){return!FI(e)||n||!gI&&LR()?XI(e)?function(e,t,n){return void 0===n&&(n=[]),e.forEach((function(e){var i;return FI(e)&&!t||lR(e,1)?(i=n).push.apply(i,pR(e)):n.push(e)}))||n}(e,n):lR(e)?sR.call(e,0):e?[e]:[]:sR.call((t||bI).querySelectorAll(e),0)},uR=function(e){return e.sort((function(){return.5-Math.random()}))},hR=function(e){if(DI(e))return e;var t=jI(e)?e:{each:e},n=RR(t.ease),i=t.from||0,r=parseFloat(t.base)||0,o={},a=i>0&&i<1,s=isNaN(i)||a,l=t.axis,p=i,u=i;return FI(i)?p=u={center:.5,edges:.5,end:1}[i]||0:!a&&s&&(p=i[0],u=i[1]),function(e,a,h){var c,_,d,m,P,f,x,y,v,g=(h||t).length,b=o[g];if(!b){if(!(v="auto"===t.grid?0:(t.grid||[1,BI])[1])){for(x=-1e8;x<(x=h[v++].getBoundingClientRect().left)&&v<g;);v--}for(b=o[g]=[],c=s?Math.min(v,g)*p-.5:i%v,_=v===BI?0:s?g*u/v-.5:i/v|0,x=0,y=BI,f=0;f<g;f++)d=f%v-c,m=_-(f/v|0),b[f]=P=l?Math.abs("y"===l?m:d):OI(d*d+m*m),P>x&&(x=P),P<y&&(y=P);"random"===i&&uR(b),b.max=x-y,b.min=y,b.v=g=(parseFloat(t.amount)||parseFloat(t.each)*(v>g?g-1:l?"y"===l?g/v:v:Math.max(v,g/v))||0)*("edges"===i?-1:1),b.b=g<0?r-g:r,b.u=aR(t.amount||t.each)||0,n=n&&g<0?IR(n):n}return g=(b[e]-b.min)/b.max||0,wO(b.b+(n?n(g):g)*b.v)+b.u}},cR=function(e){var t=Math.pow(10,((e+"").split(".")[1]||"").length);return function(n){var i=Math.round(parseFloat(n)/e)*e*t;return(i-i%1)/t+(GI(n)?0:aR(n))}},_R=function(e,t){var n,i,r=XI(e);return!r&&jI(e)&&(n=r=e.radius||BI,e.values?(e=pR(e.values),(i=!GI(e[0]))&&(n*=n)):e=cR(e.increment)),rR(t,r?DI(e)?function(t){return i=e(t),Math.abs(i-t)<=n?i:t}:function(t){for(var r,o,a=parseFloat(i?t.x:t),s=parseFloat(i?t.y:0),l=BI,p=0,u=e.length;u--;)(r=i?(r=e[u].x-a)*r+(o=e[u].y-s)*o:Math.abs(e[u]-a))<l&&(l=r,p=u);return p=!n||l<=n?e[p]:t,i||p===t||GI(t)?p:p+aR(t)}:cR(e))},dR=function(e,t,n,i){return rR(XI(e)?!t:!0===n?!!(n=0):!i,(function(){return XI(e)?e[~~(Math.random()*e.length)]:(n=n||1e-5)&&(i=n<1?Math.pow(10,(n+"").length-2):1)&&Math.floor(Math.round((e-n/2+Math.random()*(t-e+.99*n))/n)*n*i)/i}))},mR=function(e,t,n){return rR(n,(function(n){return e[~~t(n)]}))},PR=function(e){for(var t,n,i,r,o=0,a="";~(t=e.indexOf("random(",o));)i=e.indexOf(")",t),r="["===e.charAt(t+7),n=e.substr(t+7,i-t-7).match(r?nO:YI),a+=e.substr(o,t-o)+dR(r?n:+n[0],r?0:+n[1],+n[2]||1e-5),o=i+1;return a+e.substr(o,e.length-o)},fR=function(e,t,n,i,r){var o=t-e,a=i-n;return rR(r,(function(t){return n+((t-e)/o*a||0)}))},xR=function(e,t,n){var i,r,o,a=e.labels,s=BI;for(i in a)(r=a[i]-t)<0==!!n&&r&&s>(r=Math.abs(r))&&(o=i,s=r);return o},yR=function(e,t,n){var i,r,o=e.vars,a=o[t];if(a)return i=o[t+"Params"],r=o.callbackScope||e,n&&cO.length&&MO(),i?a.apply(r,i):a.call(r)},vR=function(e){return OO(e),e.scrollTrigger&&e.scrollTrigger.kill(!1),e.progress()<1&&yR(e,"onInterrupt"),e},gR=function(e){var t=(e=!e.name&&e.default||e).name,n=DI(e),i=t&&!n&&e.init?function(){this._props=[]}:e,r={init:uO,render:cH,add:XR,kill:dH,modifier:_H,rawVars:0},o={targetTest:0,get:0,getSetter:lH,aliases:{},register:0};if(LR(),e!==i){if(dO[t])return;AO(i,AO(TO(e,r),o)),LO(i.prototype,LO(r,TO(e,o))),dO[i.prop=t]=i,e.targetTest&&(fO.push(i),hO[t]=1),t=("css"===t?"CSS":t.charAt(0).toUpperCase()+t.substr(1))+"Plugin"}pO(t,i),e.register&&e.register(gH,i,fH)},bR=255,zR={aqua:[0,bR,bR],lime:[0,bR,0],silver:[192,192,192],black:[0,0,0],maroon:[128,0,0],teal:[0,128,128],blue:[0,0,bR],navy:[0,0,128],white:[bR,bR,bR],olive:[128,128,0],yellow:[bR,bR,0],orange:[bR,165,0],gray:[128,128,128],purple:[128,0,128],green:[0,128,0],red:[bR,0,0],pink:[bR,192,203],cyan:[0,bR,bR],transparent:[bR,bR,bR,0]},wR=function(e,t,n){return(6*(e+=e<0?1:e>1?-1:0)<1?t+(n-t)*e*6:e<.5?n:3*e<2?t+(n-t)*(2/3-e)*6:t)*bR+.5|0},ZR=function(e,t,n){var i,r,o,a,s,l,p,u,h,c,_=e?GI(e)?[e>>16,e>>8&bR,e&bR]:0:zR.black;if(!_){if(","===e.substr(-1)&&(e=e.substr(0,e.length-1)),zR[e])_=zR[e];else if("#"===e.charAt(0)){if(e.length<6&&(i=e.charAt(1),r=e.charAt(2),o=e.charAt(3),e="#"+i+i+r+r+o+o+(5===e.length?e.charAt(4)+e.charAt(4):"")),9===e.length)return[(_=parseInt(e.substr(1,6),16))>>16,_>>8&bR,_&bR,parseInt(e.substr(7),16)/255];_=[(e=parseInt(e.substr(1),16))>>16,e>>8&bR,e&bR]}else if("hsl"===e.substr(0,3))if(_=c=e.match(YI),t){if(~e.indexOf("="))return _=e.match(KI),n&&_.length<4&&(_[3]=1),_}else a=+_[0]%360/360,s=+_[1]/100,i=2*(l=+_[2]/100)-(r=l<=.5?l*(s+1):l+s-l*s),_.length>3&&(_[3]*=1),_[0]=wR(a+1/3,i,r),_[1]=wR(a,i,r),_[2]=wR(a-1/3,i,r);else _=e.match(YI)||zR.transparent;_=_.map(Number)}return t&&!c&&(i=_[0]/bR,r=_[1]/bR,o=_[2]/bR,l=((p=Math.max(i,r,o))+(u=Math.min(i,r,o)))/2,p===u?a=s=0:(h=p-u,s=l>.5?h/(2-p-u):h/(p+u),a=p===i?(r-o)/h+(r<o?6:0):p===r?(o-i)/h+2:(i-r)/h+4,a*=60),_[0]=~~(a+.5),_[1]=~~(100*s+.5),_[2]=~~(100*l+.5)),n&&_.length<4&&(_[3]=1),_},ER=function(e){var t=[],n=[],i=-1;return e.split(SR).forEach((function(e){var r=e.match(QI)||[];t.push.apply(t,r),n.push(i+=r.length+1)})),t.c=n,t},MR=function(e,t,n){var i,r,o,a,s="",l=(e+s).match(SR),p=t?"hsla(":"rgba(",u=0;if(!l)return e;if(l=l.map((function(e){return(e=ZR(e,t,1))&&p+(t?e[0]+","+e[1]+"%,"+e[2]+"%,"+e[3]:e.join(","))+")"})),n&&(o=ER(e),(i=n.c).join(s)!==o.c.join(s)))for(a=(r=e.replace(SR,"1").split(QI)).length-1;u<a;u++)s+=r[u]+(~i.indexOf(u)?l.shift()||p+"0,0,0,0)":(o.length?o:l.length?l:n).shift());if(!r)for(a=(r=e.split(SR)).length-1;u<a;u++)s+=r[u]+l[u];return s+r[a]},SR=function(){var e,t="(?:\\b(?:(?:rgb|rgba|hsl|hsla)\\(.+?\\))|\\B#(?:[0-9a-f]{3,4}){1,2}\\b";for(e in zR)t+="|"+e+"\\b";return new RegExp(t+")","gi")}(),CR=/hsl[a]?\(/,NR=function(e){var t,n=e.join(" ");if(SR.lastIndex=0,SR.test(n))return t=CR.test(n),e[1]=MR(e[1],t),e[0]=MR(e[0],t,ER(e[1])),!0},AR=function(){var e,t,n,i,r,o,a=Date.now,s=500,l=33,p=a(),u=p,h=1e3/240,c=h,_=[],d=function n(d){var m,P,f,x,y=a()-u,v=!0===d;if(y>s&&(p+=y-l),((m=(f=(u+=y)-p)-c)>0||v)&&(x=++i.frame,r=f-1e3*i.time,i.time=f/=1e3,c+=m+(m>=h?4:h-m),P=1),v||(e=t(n)),P)for(o=0;o<_.length;o++)_[o](f,r,x,d)};return i={time:0,frame:0,tick:function(){d(!0)},deltaRatio:function(e){return r/(1e3/(e||60))},wake:function(){zI&&(!gI&&qI()&&(vI=gI=window,bI=vI.document||{},rO.gsap=gH,(vI.gsapVersions||(vI.gsapVersions=[])).push(gH.version),aO(oO||vI.GreenSockGlobals||!vI.gsap&&vI||{}),n=vI.requestAnimationFrame),e&&i.sleep(),t=n||function(e){return setTimeout(e,c-1e3*i.time+1|0)},EI=1,d(2))},sleep:function(){(n?vI.cancelAnimationFrame:clearTimeout)(e),EI=0,t=uO},lagSmoothing:function(e,t){s=e||1e8,l=Math.min(t,s,0)},fps:function(e){h=1e3/(e||240),c=1e3*i.time+h},add:function(e,t,n){var r=t?function(t,n,o,a){e(t,n,o,a),i.remove(r)}:e;return i.remove(e),_[n?"unshift":"push"](r),LR(),r},remove:function(e,t){~(t=_.indexOf(e))&&_.splice(t,1)&&o>=t&&o--},_listeners:_},i}(),LR=function(){return!EI&&AR.wake()},BR={},TR=/^[\d.\-M][\d.\-,\s]/,VR=/["']/g,kR=function(e){for(var t,n,i,r={},o=e.substr(1,e.length-3).split(":"),a=o[0],s=1,l=o.length;s<l;s++)n=o[s],t=s!==l-1?n.lastIndexOf(","):n.length,i=n.substr(0,t),r[a]=isNaN(i)?i.replace(VR,"").trim():+i,a=n.substr(t+1).trim();return r},IR=function(e){return function(t){return 1-e(1-t)}},OR=function e(t,n){for(var i,r=t._first;r;)r instanceof WR?e(r,n):!r.vars.yoyoEase||r._yoyo&&r._repeat||r._yoyo===n||(r.timeline?e(r.timeline,n):(i=r._ease,r._ease=r._yEase,r._yEase=i,r._yoyo=n)),r=r._next},RR=function(e,t){return e&&(DI(e)?e:BR[e]||function(e){var t,n,i,r,o=(e+"").split("("),a=BR[o[0]];return a&&o.length>1&&a.config?a.config.apply(null,~e.indexOf("{")?[kR(o[1])]:(t=e,n=t.indexOf("(")+1,i=t.indexOf(")"),r=t.indexOf("(",n),t.substring(n,~r&&r<i?t.indexOf(")",i+1):i)).split(",").map(CO)):BR._CE&&TR.test(e)?BR._CE("",e):a}(e))||t},HR=function(e,t,n,i){void 0===n&&(n=function(e){return 1-t(1-e)}),void 0===i&&(i=function(e){return e<.5?t(2*e)/2:1-t(2*(1-e))/2});var r,o={easeIn:t,easeOut:n,easeInOut:i};return bO(e,(function(e){for(var t in BR[e]=rO[e]=o,BR[r=e.toLowerCase()]=n,o)BR[r+("easeIn"===t?".in":"easeOut"===t?".out":".inOut")]=BR[e+"."+t]=o[t]})),o},FR=function(e){return function(t){return t<.5?(1-e(1-2*t))/2:.5+e(2*(t-.5))/2}},DR=function e(t,n,i){var r=n>=1?n:1,o=(i||(t?.3:.45))/(n<1?n:1),a=o/VI*(Math.asin(1/r)||0),s=function(e){return 1===e?1:r*Math.pow(2,-10*e)*HI((e-a)*o)+1},l="out"===t?s:"in"===t?function(e){return 1-s(1-e)}:FR(s);return o=VI/o,l.config=function(n,i){return e(t,n,i)},l},GR=function e(t,n){void 0===n&&(n=1.70158);var i=function(e){return e?--e*e*((n+1)*e+n)+1:0},r="out"===t?i:"in"===t?function(e){return 1-i(1-e)}:FR(i);return r.config=function(n){return e(t,n)},r};bO("Linear,Quad,Cubic,Quart,Quint,Strong",(function(e,t){var n=t<5?t+1:t;HR(e+",Power"+(n-1),t?function(e){return Math.pow(e,n)}:function(e){return e},(function(e){return 1-Math.pow(1-e,n)}),(function(e){return e<.5?Math.pow(2*e,n)/2:1-Math.pow(2*(1-e),n)/2}))})),BR.Linear.easeNone=BR.none=BR.Linear.easeIn,HR("Elastic",DR("in"),DR("out"),DR()),MI=7.5625,CI=1/(SI=2.75),NI=function(e){return e<CI?MI*e*e:e<.7272727272727273?MI*Math.pow(e-1.5/SI,2)+.75:e<.9090909090909092?MI*(e-=2.25/SI)*e+.9375:MI*Math.pow(e-2.625/SI,2)+.984375},HR("Bounce",(function(e){return 1-NI(1-e)}),NI),HR("Expo",(function(e){return e?Math.pow(2,10*(e-1)):0})),HR("Circ",(function(e){return-(OI(1-e*e)-1)})),HR("Sine",(function(e){return 1===e?1:1-RI(e*kI)})),HR("Back",GR("in"),GR("out"),GR()),BR.SteppedEase=BR.steps=rO.SteppedEase={config:function(e,t){void 0===e&&(e=1);var n=1/e,i=e+(t?0:1),r=t?1:0;return function(e){return((i*oR(0,.99999999,e)|0)+r)*n}}},LI.ease=BR["quad.out"],bO("onComplete,onUpdate,onStart,onRepeat,onReverseComplete,onInterrupt",(function(e){return xO+=e+","+e+"Params,"}));var UR=function(e,t){this.id=II++,e._gsap=this,this.target=e,this.harness=t,this.get=t?t.get:gO,this.set=t?t.getSetter:lH},jR=function(){function e(e){this.vars=e,this._delay=+e.delay||0,(this._repeat=e.repeat===1/0?-2:e.repeat||0)&&(this._rDelay=e.repeatDelay||0,this._yoyo=!!e.yoyo||!!e.yoyoEase),this._ts=1,QO(this,+e.duration,1,1),this.data=e.data,EI||AR.wake()}var t=e.prototype;return t.delay=function(e){return e||0===e?(this.parent&&this.parent.smoothChildTiming&&this.startTime(this._start+e-this._delay),this._delay=e,this):this._delay},t.duration=function(e){return arguments.length?this.totalDuration(this._repeat>0?e+(e+this._rDelay)*this._repeat:e):this.totalDuration()&&this._dur},t.totalDuration=function(e){return arguments.length?(this._dirty=0,QO(this,this._repeat<0?e:(e-this._repeat*this._rDelay)/(this._repeat+1))):this._tDur},t.totalTime=function(e,t){if(LR(),!arguments.length)return this._tTime;var n=this._dp;if(n&&n.smoothChildTiming&&this._ts){for(WO(this,e),!n._dp||n.parent||qO(n,this);n&&n.parent;)n.parent._time!==n._start+(n._ts>=0?n._tTime/n._ts:(n.totalDuration()-n._tTime)/-n._ts)&&n.totalTime(n._tTime,!0),n=n.parent;!this.parent&&this._dp.autoRemoveChildren&&(this._ts>0&&e<this._tDur||this._ts<0&&e>0||!this._tDur&&!e)&&JO(this._dp,this,this._start-this._delay)}return(this._tTime!==e||!this._dur&&!t||this._initted&&Math.abs(this._zTime)===TI||!e&&!this._initted&&(this.add||this._ptLookup))&&(this._ts||(this._pTime=e),SO(this,e,t)),this},t.time=function(e,t){return arguments.length?this.totalTime(Math.min(this.totalDuration(),e+DO(this))%(this._dur+this._rDelay)||(e?this._dur:0),t):this._time},t.totalProgress=function(e,t){return arguments.length?this.totalTime(this.totalDuration()*e,t):this.totalDuration()?Math.min(1,this._tTime/this._tDur):this.ratio},t.progress=function(e,t){return arguments.length?this.totalTime(this.duration()*(!this._yoyo||1&this.iteration()?e:1-e)+DO(this),t):this.duration()?Math.min(1,this._time/this._dur):this.ratio},t.iteration=function(e,t){var n=this.duration()+this._rDelay;return arguments.length?this.totalTime(this._time+(e-1)*n,t):this._repeat?GO(this._tTime,n)+1:1},t.timeScale=function(e){if(!arguments.length)return-1e-8===this._rts?0:this._rts;if(this._rts===e)return this;var t=this.parent&&this._ts?UO(this.parent._time,this):this._tTime;return this._rts=+e||0,this._ts=this._ps||-1e-8===e?0:this._rts,this.totalTime(oR(-this._delay,this._tDur,t),!0),jO(this),HO(this)},t.paused=function(e){return arguments.length?(this._ps!==e&&(this._ps=e,e?(this._pTime=this._tTime||Math.max(-this._delay,this.rawTime()),this._ts=this._act=0):(LR(),this._ts=this._rts,this.totalTime(this.parent&&!this.parent.smoothChildTiming?this.rawTime():this._tTime||this._pTime,1===this.progress()&&Math.abs(this._zTime)!==TI&&(this._tTime-=TI)))),this):this._ps},t.startTime=function(e){if(arguments.length){this._start=e;var t=this.parent||this._dp;return t&&(t._sort||!this.parent)&&JO(t,this,e-this._delay),this}return this._start},t.endTime=function(e){return this._start+(WI(e)?this.totalDuration():this.duration())/Math.abs(this._ts||1)},t.rawTime=function(e){var t=this.parent||this._dp;return t?e&&(!this._ts||this._repeat&&this._time&&this.totalProgress()<1)?this._tTime%(this._dur+this._rDelay):this._ts?UO(t.rawTime(e),this):this._tTime:this._tTime},t.globalTime=function(e){for(var t=this,n=arguments.length?e:t.rawTime();t;)n=t._start+n/(t._ts||1),t=t._dp;return n},t.repeat=function(e){return arguments.length?(this._repeat=e===1/0?-2:e,eR(this)):-2===this._repeat?1/0:this._repeat},t.repeatDelay=function(e){if(arguments.length){var t=this._time;return this._rDelay=e,eR(this),t?this.time(t):this}return this._rDelay},t.yoyo=function(e){return arguments.length?(this._yoyo=e,this):this._yoyo},t.seek=function(e,t){return this.totalTime(nR(this,e),WI(t))},t.restart=function(e,t){return this.play().totalTime(e?-this._delay:0,WI(t))},t.play=function(e,t){return null!=e&&this.seek(e,t),this.reversed(!1).paused(!1)},t.reverse=function(e,t){return null!=e&&this.seek(e||this.totalDuration(),t),this.reversed(!0).paused(!1)},t.pause=function(e,t){return null!=e&&this.seek(e,t),this.paused(!0)},t.resume=function(){return this.paused(!1)},t.reversed=function(e){return arguments.length?(!!e!==this.reversed()&&this.timeScale(-this._rts||(e?-1e-8:0)),this):this._rts<0},t.invalidate=function(){return this._initted=this._act=0,this._zTime=-1e-8,this},t.isActive=function(){var e,t=this.parent||this._dp,n=this._start;return!(t&&!(this._ts&&this._initted&&t.isActive()&&(e=t.rawTime(!0))>=n&&e<this.endTime(!0)-TI))},t.eventCallback=function(e,t,n){var i=this.vars;return arguments.length>1?(t?(i[e]=t,n&&(i[e+"Params"]=n),"onUpdate"===e&&(this._onUpdate=t)):delete i[e],this):i[e]},t.then=function(e){var t=this;return new Promise((function(n){var i=DI(e)?e:NO,r=function(){var e=t.then;t.then=null,DI(i)&&(i=i(t))&&(i.then||i===t)&&(t.then=e),n(i),t.then=e};t._initted&&1===t.totalProgress()&&t._ts>=0||!t._tTime&&t._ts<0?r():t._prom=r}))},t.kill=function(){vR(this)},e}();AO(jR.prototype,{_time:0,_start:0,_end:0,_tTime:0,_tDur:0,_dirty:0,_repeat:0,_yoyo:!1,parent:null,_initted:!1,_rDelay:0,_ts:1,_dp:0,ratio:0,_zTime:-1e-8,_prom:0,_ps:!1,_rts:1});var WR=function(e){function t(t,n){var i;return void 0===t&&(t={}),(i=e.call(this,t)||this).labels={},i.smoothChildTiming=!!t.smoothChildTiming,i.autoRemoveChildren=!!t.autoRemoveChildren,i._sort=WI(t.sortChildren),yI&&JO(t.parent||yI,PI(i),n),t.reversed&&i.reverse(),t.paused&&i.paused(!0),t.scrollTrigger&&$O(PI(i),t.scrollTrigger),i}fI(t,e);var n=t.prototype;return n.to=function(e,t,n){return iR(0,arguments,this),this},n.from=function(e,t,n){return iR(1,arguments,this),this},n.fromTo=function(e,t,n,i){return iR(2,arguments,this),this},n.set=function(e,t,n){return t.duration=0,t.parent=this,VO(t).repeatDelay||(t.repeat=0),t.immediateRender=!!t.immediateRender,new iH(e,t,nR(this,n),1),this},n.call=function(e,t,n){return JO(this,iH.delayedCall(0,e,t),n)},n.staggerTo=function(e,t,n,i,r,o,a){return n.duration=t,n.stagger=n.stagger||i,n.onComplete=o,n.onCompleteParams=a,n.parent=this,new iH(e,n,nR(this,r)),this},n.staggerFrom=function(e,t,n,i,r,o,a){return n.runBackwards=1,VO(n).immediateRender=WI(n.immediateRender),this.staggerTo(e,t,n,i,r,o,a)},n.staggerFromTo=function(e,t,n,i,r,o,a,s){return i.startAt=n,VO(i).immediateRender=WI(i.immediateRender),this.staggerTo(e,t,i,r,o,a,s)},n.render=function(e,t,n){var i,r,o,a,s,l,p,u,h,c,_,d,m=this._time,P=this._dirty?this.totalDuration():this._tDur,f=this._dur,x=e<=0?0:wO(e),y=this._zTime<0!=e<0&&(this._initted||!f);if(this!==yI&&x>P&&e>=0&&(x=P),x!==this._tTime||n||y){if(m!==this._time&&f&&(x+=this._time-m,e+=this._time-m),i=x,h=this._start,l=!(u=this._ts),y&&(f||(m=this._zTime),(e||!t)&&(this._zTime=e)),this._repeat){if(_=this._yoyo,s=f+this._rDelay,this._repeat<-1&&e<0)return this.totalTime(100*s+e,t,n);if(i=wO(x%s),x===P?(a=this._repeat,i=f):((a=~~(x/s))&&a===x/s&&(i=f,a--),i>f&&(i=f)),c=GO(this._tTime,s),!m&&this._tTime&&c!==a&&(c=a),_&&1&a&&(i=f-i,d=1),a!==c&&!this._lock){var v=_&&1&c,g=v===(_&&1&a);if(a<c&&(v=!v),m=v?0:f,this._lock=1,this.render(m||(d?0:wO(a*s)),t,!f)._lock=0,this._tTime=x,!t&&this.parent&&yR(this,"onRepeat"),this.vars.repeatRefresh&&!d&&(this.invalidate()._lock=1),m&&m!==this._time||l!==!this._ts||this.vars.onRepeat&&!this.parent&&!this._act)return this;if(f=this._dur,P=this._tDur,g&&(this._lock=2,m=v?f:-1e-4,this.render(m,!0),this.vars.repeatRefresh&&!d&&this.invalidate()),this._lock=0,!this._ts&&!l)return this;OR(this,d)}}if(this._hasPause&&!this._forcing&&this._lock<2&&(p=function(e,t,n){var i;if(n>t)for(i=e._first;i&&i._start<=n;){if("isPause"===i.data&&i._start>t)return i;i=i._next}else for(i=e._last;i&&i._start>=n;){if("isPause"===i.data&&i._start<t)return i;i=i._prev}}(this,wO(m),wO(i)),p&&(x-=i-(i=p._start))),this._tTime=x,this._time=i,this._act=!u,this._initted||(this._onUpdate=this.vars.onUpdate,this._initted=1,this._zTime=e,m=0),!m&&i&&!t&&(yR(this,"onStart"),this._tTime!==x))return this;if(i>=m&&e>=0)for(r=this._first;r;){if(o=r._next,(r._act||i>=r._start)&&r._ts&&p!==r){if(r.parent!==this)return this.render(e,t,n);if(r.render(r._ts>0?(i-r._start)*r._ts:(r._dirty?r.totalDuration():r._tDur)+(i-r._start)*r._ts,t,n),i!==this._time||!this._ts&&!l){p=0,o&&(x+=this._zTime=-1e-8);break}}r=o}else{r=this._last;for(var b=e<0?e:i;r;){if(o=r._prev,(r._act||b<=r._end)&&r._ts&&p!==r){if(r.parent!==this)return this.render(e,t,n);if(r.render(r._ts>0?(b-r._start)*r._ts:(r._dirty?r.totalDuration():r._tDur)+(b-r._start)*r._ts,t,n),i!==this._time||!this._ts&&!l){p=0,o&&(x+=this._zTime=b?-1e-8:TI);break}}r=o}}if(p&&!t&&(this.pause(),p.render(i>=m?0:-1e-8)._zTime=i>=m?1:-1,this._ts))return this._start=h,jO(this),this.render(e,t,n);this._onUpdate&&!t&&yR(this,"onUpdate",!0),(x===P&&this._tTime>=this.totalDuration()||!x&&m)&&(h!==this._start&&Math.abs(u)===Math.abs(this._ts)||this._lock||((e||!f)&&(x===P&&this._ts>0||!x&&this._ts<0)&&OO(this,1),t||e<0&&!m||!x&&!m&&P||(yR(this,x===P&&e>=0?"onComplete":"onReverseComplete",!0),this._prom&&!(x<P&&this.timeScale()>0)&&this._prom())))}return this},n.add=function(e,t){var n=this;if(GI(t)||(t=nR(this,t,e)),!(e instanceof jR)){if(XI(e))return e.forEach((function(e){return n.add(e,t)})),this;if(FI(e))return this.addLabel(e,t);if(!DI(e))return this;e=iH.delayedCall(0,e)}return this!==e?JO(this,e,t):this},n.getChildren=function(e,t,n,i){void 0===e&&(e=!0),void 0===t&&(t=!0),void 0===n&&(n=!0),void 0===i&&(i=-1e8);for(var r=[],o=this._first;o;)o._start>=i&&(o instanceof iH?t&&r.push(o):(n&&r.push(o),e&&r.push.apply(r,o.getChildren(!0,t,n)))),o=o._next;return r},n.getById=function(e){for(var t=this.getChildren(1,1,1),n=t.length;n--;)if(t[n].vars.id===e)return t[n]},n.remove=function(e){return FI(e)?this.removeLabel(e):DI(e)?this.killTweensOf(e):(IO(this,e),e===this._recent&&(this._recent=this._last),RO(this))},n.totalTime=function(t,n){return arguments.length?(this._forcing=1,!this._dp&&this._ts&&(this._start=wO(AR.time-(this._ts>0?t/this._ts:(this.totalDuration()-t)/-this._ts))),e.prototype.totalTime.call(this,t,n),this._forcing=0,this):this._tTime},n.addLabel=function(e,t){return this.labels[e]=nR(this,t),this},n.removeLabel=function(e){return delete this.labels[e],this},n.addPause=function(e,t,n){var i=iH.delayedCall(0,t||uO,n);return i.data="isPause",this._hasPause=1,JO(this,i,nR(this,e))},n.removePause=function(e){var t=this._first;for(e=nR(this,e);t;)t._start===e&&"isPause"===t.data&&OO(t),t=t._next},n.killTweensOf=function(e,t,n){for(var i=this.getTweensOf(e,n),r=i.length;r--;)qR!==i[r]&&i[r].kill(e,t);return this},n.getTweensOf=function(e,t){for(var n,i=[],r=pR(e),o=this._first,a=GI(t);o;)o instanceof iH?EO(o._targets,r)&&(a?(!qR||o._initted&&o._ts)&&o.globalTime(0)<=t&&o.globalTime(o.totalDuration())>t:!t||o.isActive())&&i.push(o):(n=o.getTweensOf(r,t)).length&&i.push.apply(i,n),o=o._next;return i},n.tweenTo=function(e,t){t=t||{};var n,i=this,r=nR(i,e),o=t,a=o.startAt,s=o.onStart,l=o.onStartParams,p=o.immediateRender,u=iH.to(i,AO({ease:t.ease||"none",lazy:!1,immediateRender:!1,time:r,overwrite:"auto",duration:t.duration||Math.abs((r-(a&&"time"in a?a.time:i._time))/i.timeScale())||TI,onStart:function(){if(i.pause(),!n){var e=t.duration||Math.abs((r-(a&&"time"in a?a.time:i._time))/i.timeScale());u._dur!==e&&QO(u,e,0,1).render(u._time,!0,!0),n=1}s&&s.apply(u,l||[])}},t));return p?u.render(0):u},n.tweenFromTo=function(e,t,n){return this.tweenTo(t,AO({startAt:{time:nR(this,e)}},n))},n.recent=function(){return this._recent},n.nextLabel=function(e){return void 0===e&&(e=this._time),xR(this,nR(this,e))},n.previousLabel=function(e){return void 0===e&&(e=this._time),xR(this,nR(this,e),1)},n.currentLabel=function(e){return arguments.length?this.seek(e,!0):this.previousLabel(this._time+TI)},n.shiftChildren=function(e,t,n){void 0===n&&(n=0);for(var i,r=this._first,o=this.labels;r;)r._start>=n&&(r._start+=e,r._end+=e),r=r._next;if(t)for(i in o)o[i]>=n&&(o[i]+=e);return RO(this)},n.invalidate=function(){var t=this._first;for(this._lock=0;t;)t.invalidate(),t=t._next;return e.prototype.invalidate.call(this)},n.clear=function(e){void 0===e&&(e=!0);for(var t,n=this._first;n;)t=n._next,this.remove(n),n=t;return this._dp&&(this._time=this._tTime=this._pTime=0),e&&(this.labels={}),RO(this)},n.totalDuration=function(e){var t,n,i,r=0,o=this,a=o._last,s=BI;if(arguments.length)return o.timeScale((o._repeat<0?o.duration():o.totalDuration())/(o.reversed()?-e:e));if(o._dirty){for(i=o.parent;a;)t=a._prev,a._dirty&&a.totalDuration(),(n=a._start)>s&&o._sort&&a._ts&&!o._lock?(o._lock=1,JO(o,a,n-a._delay,1)._lock=0):s=n,n<0&&a._ts&&(r-=n,(!i&&!o._dp||i&&i.smoothChildTiming)&&(o._start+=n/o._ts,o._time-=n,o._tTime-=n),o.shiftChildren(-n,!1,-1/0),s=0),a._end>r&&a._ts&&(r=a._end),a=t;QO(o,o===yI&&o._time>r?o._time:r,1,1),o._dirty=0}return o._tDur},t.updateRoot=function(e){if(yI._ts&&(SO(yI,UO(e,yI)),wI=AR.frame),AR.frame>=PO){PO+=AI.autoSleep||120;var t=yI._first;if((!t||!t._ts)&&AI.autoSleep&&AR._listeners.length<2){for(;t&&!t._ts;)t=t._next;t||AR.sleep()}}},t}(jR);AO(WR.prototype,{_lock:0,_hasPause:0,_forcing:0});var qR,JR,$R=function(e,t,n,i,r,o,a){var s,l,p,u,h,c,_,d,m=new fH(this._pt,e,t,0,1,hH,null,r),P=0,f=0;for(m.b=n,m.e=i,n+="",(_=~(i+="").indexOf("random("))&&(i=PR(i)),o&&(o(d=[n,i],e,t),n=d[0],i=d[1]),l=n.match(eO)||[];s=eO.exec(i);)u=s[0],h=i.substring(P,s.index),p?p=(p+1)%5:"rgba("===h.substr(-5)&&(p=1),u!==l[f++]&&(c=parseFloat(l[f-1])||0,m._pt={_next:m._pt,p:h||1===f?h:",",s:c,c:"="===u.charAt(1)?ZO(c,u)-c:parseFloat(u)-c,m:p&&p<4?Math.round:0},P=eO.lastIndex);return m.c=P<i.length?i.substring(P,i.length):"",m.fp=a,(tO.test(i)||_)&&(m.e=0),this._pt=m,m},XR=function(e,t,n,i,r,o,a,s,l){DI(i)&&(i=i(r||0,e,o));var p,u=e[t],h="get"!==n?n:DI(u)?l?e[t.indexOf("set")||!DI(e["get"+t.substr(3)])?t:"get"+t.substr(3)](l):e[t]():u,c=DI(u)?l?aH:oH:rH;if(FI(i)&&(~i.indexOf("random(")&&(i=PR(i)),"="===i.charAt(1)&&((p=ZO(h,i)+(aR(h)||0))||0===p)&&(i=p)),h!==i||JR)return isNaN(h*i)||""===i?(!u&&!(t in e)&&sO(t,i),$R.call(this,e,t,h,i,c,s||AI.stringFilter,l)):(p=new fH(this._pt,e,t,+h||0,i-(h||0),"boolean"==typeof u?uH:pH,0,c),l&&(p.fp=l),a&&p.modifier(a,this,e),this._pt=p)},YR=function(e,t,n,i,r,o){var a,s,l,p;if(dO[e]&&!1!==(a=new dO[e]).init(r,a.rawVars?t[e]:function(e,t,n,i,r){if(DI(e)&&(e=eH(e,r,t,n,i)),!jI(e)||e.style&&e.nodeType||XI(e)||$I(e))return FI(e)?eH(e,r,t,n,i):e;var o,a={};for(o in e)a[o]=eH(e[o],r,t,n,i);return a}(t[e],i,r,o,n),n,i,o)&&(n._pt=s=new fH(n._pt,r,e,0,1,a.render,a,0,a.priority),n!==ZI))for(l=n._ptLookup[n._targets.indexOf(r)],p=a._props.length;p--;)l[a._props[p]]=s;return a},KR=function e(t,n){var i,r,o,a,s,l,p,u,h,c,_,d,m,P=t.vars,f=P.ease,x=P.startAt,y=P.immediateRender,v=P.lazy,g=P.onUpdate,b=P.onUpdateParams,z=P.callbackScope,w=P.runBackwards,Z=P.yoyoEase,E=P.keyframes,M=P.autoRevert,S=t._dur,C=t._startAt,N=t._targets,A=t.parent,L=A&&"nested"===A.data?A.parent._targets:N,B="auto"===t._overwrite&&!xI,T=t.timeline;if(T&&(!E||!f)&&(f="none"),t._ease=RR(f,LI.ease),t._yEase=Z?IR(RR(!0===Z?f:Z,LI.ease)):0,Z&&t._yoyo&&!t._repeat&&(Z=t._yEase,t._yEase=t._ease,t._ease=Z),t._from=!T&&!!P.runBackwards,!T||E&&!P.stagger){if(d=(u=N[0]?vO(N[0]).harness:0)&&P[u.prop],i=TO(P,hO),C&&(OO(C.render(-1,!0)),C._lazy=0),x)if(OO(t._startAt=iH.set(N,AO({data:"isStart",overwrite:!1,parent:A,immediateRender:!0,lazy:WI(v),startAt:null,delay:0,onUpdate:g,onUpdateParams:b,callbackScope:z,stagger:0},x))),n<0&&!y&&!M&&t._startAt.render(-1,!0),y){if(n>0&&!M&&(t._startAt=0),S&&n<=0)return void(n&&(t._zTime=n))}else!1===M&&(t._startAt=0);else if(w&&S)if(C)!M&&(t._startAt=0);else if(n&&(y=!1),o=AO({overwrite:!1,data:"isFromStart",lazy:y&&WI(v),immediateRender:y,stagger:0,parent:A},i),d&&(o[u.prop]=d),OO(t._startAt=iH.set(N,o)),n<0&&t._startAt.render(-1,!0),t._zTime=n,y){if(!n)return}else e(t._startAt,TI);for(t._pt=t._ptCache=0,v=S&&WI(v)||v&&!S,r=0;r<N.length;r++){if(p=(s=N[r])._gsap||yO(N)[r]._gsap,t._ptLookup[r]=c={},_O[p.id]&&cO.length&&MO(),_=L===N?r:L.indexOf(s),u&&!1!==(h=new u).init(s,d||i,t,_,L)&&(t._pt=a=new fH(t._pt,s,h.name,0,1,h.render,h,0,h.priority),h._props.forEach((function(e){c[e]=a})),h.priority&&(l=1)),!u||d)for(o in i)dO[o]&&(h=YR(o,i,t,_,s,L))?h.priority&&(l=1):c[o]=a=XR.call(t,s,o,"get",i[o],_,L,0,P.stringFilter);t._op&&t._op[r]&&t.kill(s,t._op[r]),B&&t._pt&&(qR=t,yI.killTweensOf(s,c,t.globalTime(n)),m=!t.parent,qR=0),t._pt&&v&&(_O[p.id]=1)}l&&PH(t),t._onInit&&t._onInit(t)}t._onUpdate=g,t._initted=(!t._op||t._pt)&&!m,E&&n<=0&&T.render(BI,!0,!0)},QR=function(e,t,n,i){var r,o,a=t.ease||i||"power1.inOut";if(XI(t))o=n[e]||(n[e]=[]),t.forEach((function(e,n){return o.push({t:n/(t.length-1)*100,v:e,e:a})}));else for(r in t)o=n[r]||(n[r]=[]),"ease"===r||o.push({t:parseFloat(e),v:t[r],e:a})},eH=function(e,t,n,i,r){return DI(e)?e.call(t,n,i,r):FI(e)&&~e.indexOf("random(")?PR(e):e},tH=xO+"repeat,repeatDelay,yoyo,repeatRefresh,yoyoEase,autoRevert",nH={};bO(tH+",id,stagger,delay,duration,paused,scrollTrigger",(function(e){return nH[e]=1}));var iH=function(e){function t(t,n,i,r){var o;"number"==typeof n&&(i.duration=n,n=i,i=null);var a,s,l,p,u,h,c,_,d=(o=e.call(this,r?n:VO(n))||this).vars,m=d.duration,P=d.delay,f=d.immediateRender,x=d.stagger,y=d.overwrite,v=d.keyframes,g=d.defaults,b=d.scrollTrigger,z=d.yoyoEase,w=n.parent||yI,Z=(XI(t)||$I(t)?GI(t[0]):"length"in n)?[t]:pR(t);if(o._targets=Z.length?yO(Z):lO("GSAP target "+t+" not found. https://greensock.com",!AI.nullTargetWarn)||[],o._ptLookup=[],o._overwrite=y,v||x||JI(m)||JI(P)){if(n=o.vars,(a=o.timeline=new WR({data:"nested",defaults:g||{}})).kill(),a.parent=a._dp=PI(o),a._start=0,x||JI(m)||JI(P)){if(p=Z.length,c=x&&hR(x),jI(x))for(u in x)~tH.indexOf(u)&&(_||(_={}),_[u]=x[u]);for(s=0;s<p;s++)(l=TO(n,nH)).stagger=0,z&&(l.yoyoEase=z),_&&LO(l,_),h=Z[s],l.duration=+eH(m,PI(o),s,h,Z),l.delay=(+eH(P,PI(o),s,h,Z)||0)-o._delay,!x&&1===p&&l.delay&&(o._delay=P=l.delay,o._start+=P,l.delay=0),a.to(h,l,c?c(s,h,Z):0),a._ease=BR.none;a.duration()?m=P=0:o.timeline=0}else if(v){VO(AO(a.vars.defaults,{ease:"none"})),a._ease=RR(v.ease||n.ease||"none");var E,M,S,C=0;if(XI(v))v.forEach((function(e){return a.to(Z,e,">")}));else{for(u in l={},v)"ease"===u||"easeEach"===u||QR(u,v[u],l,v.easeEach);for(u in l)for(E=l[u].sort((function(e,t){return e.t-t.t})),C=0,s=0;s<E.length;s++)(S={ease:(M=E[s]).e,duration:(M.t-(s?E[s-1].t:0))/100*m})[u]=M.v,a.to(Z,S,C),C+=S.duration;a.duration()<m&&a.to({},{duration:m-a.duration()})}}m||o.duration(m=a.duration())}else o.timeline=0;return!0!==y||xI||(qR=PI(o),yI.killTweensOf(Z),qR=0),JO(w,PI(o),i),n.reversed&&o.reverse(),n.paused&&o.paused(!0),(f||!m&&!v&&o._start===wO(w._time)&&WI(f)&&FO(PI(o))&&"nested"!==w.data)&&(o._tTime=-1e-8,o.render(Math.max(0,-P))),b&&$O(PI(o),b),o}fI(t,e);var n=t.prototype;return n.render=function(e,t,n){var i,r,o,a,s,l,p,u,h,c=this._time,_=this._tDur,d=this._dur,m=e>_-TI&&e>=0?_:e<TI?0:e;if(d){if(m!==this._tTime||!e||n||!this._initted&&this._tTime||this._startAt&&this._zTime<0!=e<0){if(i=m,u=this.timeline,this._repeat){if(a=d+this._rDelay,this._repeat<-1&&e<0)return this.totalTime(100*a+e,t,n);if(i=wO(m%a),m===_?(o=this._repeat,i=d):((o=~~(m/a))&&o===m/a&&(i=d,o--),i>d&&(i=d)),(l=this._yoyo&&1&o)&&(h=this._yEase,i=d-i),s=GO(this._tTime,a),i===c&&!n&&this._initted)return this._tTime=m,this;o!==s&&(u&&this._yEase&&OR(u,l),!this.vars.repeatRefresh||l||this._lock||(this._lock=n=1,this.render(wO(a*o),!0).invalidate()._lock=0))}if(!this._initted){if(XO(this,e<0?e:i,n,t))return this._tTime=0,this;if(c!==this._time)return this;if(d!==this._dur)return this.render(e,t,n)}if(this._tTime=m,this._time=i,!this._act&&this._ts&&(this._act=1,this._lazy=0),this.ratio=p=(h||this._ease)(i/d),this._from&&(this.ratio=p=1-p),i&&!c&&!t&&(yR(this,"onStart"),this._tTime!==m))return this;for(r=this._pt;r;)r.r(p,r.d),r=r._next;u&&u.render(e<0?e:!i&&l?-1e-8:u._dur*u._ease(i/this._dur),t,n)||this._startAt&&(this._zTime=e),this._onUpdate&&!t&&(e<0&&this._startAt&&this._startAt.render(e,!0,n),yR(this,"onUpdate")),this._repeat&&o!==s&&this.vars.onRepeat&&!t&&this.parent&&yR(this,"onRepeat"),m!==this._tDur&&m||this._tTime!==m||(e<0&&this._startAt&&!this._onUpdate&&this._startAt.render(e,!0,!0),(e||!d)&&(m===this._tDur&&this._ts>0||!m&&this._ts<0)&&OO(this,1),t||e<0&&!c||!m&&!c||(yR(this,m===_?"onComplete":"onReverseComplete",!0),this._prom&&!(m<_&&this.timeScale()>0)&&this._prom()))}}else!function(e,t,n,i){var r,o,a,s=e.ratio,l=t<0||!t&&(!e._start&&YO(e)&&(e._initted||!KO(e))||(e._ts<0||e._dp._ts<0)&&!KO(e))?0:1,p=e._rDelay,u=0;if(p&&e._repeat&&(u=oR(0,e._tDur,t),o=GO(u,p),e._yoyo&&1&o&&(l=1-l),o!==GO(e._tTime,p)&&(s=1-l,e.vars.repeatRefresh&&e._initted&&e.invalidate())),l!==s||i||e._zTime===TI||!t&&e._zTime){if(!e._initted&&XO(e,t,i,n))return;for(a=e._zTime,e._zTime=t||(n?TI:0),n||(n=t&&!a),e.ratio=l,e._from&&(l=1-l),e._time=0,e._tTime=u,r=e._pt;r;)r.r(l,r.d),r=r._next;e._startAt&&t<0&&e._startAt.render(t,!0,!0),e._onUpdate&&!n&&yR(e,"onUpdate"),u&&e._repeat&&!n&&e.parent&&yR(e,"onRepeat"),(t>=e._tDur||t<0)&&e.ratio===l&&(l&&OO(e,1),n||(yR(e,l?"onComplete":"onReverseComplete",!0),e._prom&&e._prom()))}else e._zTime||(e._zTime=t)}(this,e,t,n);return this},n.targets=function(){return this._targets},n.invalidate=function(){return this._pt=this._op=this._startAt=this._onUpdate=this._lazy=this.ratio=0,this._ptLookup=[],this.timeline&&this.timeline.invalidate(),e.prototype.invalidate.call(this)},n.resetTo=function(e,t,n,i){EI||AR.wake(),this._ts||this.play();var r=Math.min(this._dur,(this._dp._time-this._start)*this._ts);return this._initted||KR(this,r),function(e,t,n,i,r,o,a){var s,l,p,u=(e._pt&&e._ptCache||(e._ptCache={}))[t];if(!u)for(u=e._ptCache[t]=[],l=e._ptLookup,p=e._targets.length;p--;){if((s=l[p][t])&&s.d&&s.d._pt)for(s=s.d._pt;s&&s.p!==t;)s=s._next;if(!s)return JR=1,e.vars[t]="+=0",KR(e,a),JR=0,1;u.push(s)}for(p=u.length;p--;)(s=u[p]).s=!i&&0!==i||r?s.s+(i||0)+o*s.c:i,s.c=n-s.s,s.e&&(s.e=zO(n)+aR(s.e)),s.b&&(s.b=s.s+aR(s.b))}(this,e,t,n,i,this._ease(r/this._dur),r)?this.resetTo(e,t,n,i):(WO(this,0),this.parent||kO(this._dp,this,"_first","_last",this._dp._sort?"_start":0),this.render(0))},n.kill=function(e,t){if(void 0===t&&(t="all"),!(e||t&&"all"!==t))return this._lazy=this._pt=0,this.parent?vR(this):this;if(this.timeline){var n=this.timeline.totalDuration();return this.timeline.killTweensOf(e,t,qR&&!0!==qR.vars.overwrite)._first||vR(this),this.parent&&n!==this.timeline.totalDuration()&&QO(this,this._dur*this.timeline._tDur/n,0,1),this}var i,r,o,a,s,l,p,u=this._targets,h=e?pR(e):u,c=this._ptLookup,_=this._pt;if((!t||"all"===t)&&function(e,t){for(var n=e.length,i=n===t.length;i&&n--&&e[n]===t[n];);return n<0}(u,h))return"all"===t&&(this._pt=0),vR(this);for(i=this._op=this._op||[],"all"!==t&&(FI(t)&&(s={},bO(t,(function(e){return s[e]=1})),t=s),t=function(e,t){var n,i,r,o,a=e[0]?vO(e[0]).harness:0,s=a&&a.aliases;if(!s)return t;for(i in n=LO({},t),s)if(i in n)for(r=(o=s[i].split(",")).length;r--;)n[o[r]]=n[i];return n}(u,t)),p=u.length;p--;)if(~h.indexOf(u[p]))for(s in r=c[p],"all"===t?(i[p]=t,a=r,o={}):(o=i[p]=i[p]||{},a=t),a)(l=r&&r[s])&&("kill"in l.d&&!0!==l.d.kill(s)||IO(this,l,"_pt"),delete r[s]),"all"!==o&&(o[s]=1);return this._initted&&!this._pt&&_&&vR(this),this},t.to=function(e,n){return new t(e,n,arguments[2])},t.from=function(e,t){return iR(1,arguments)},t.delayedCall=function(e,n,i,r){return new t(n,0,{immediateRender:!1,lazy:!1,overwrite:!1,delay:e,onComplete:n,onReverseComplete:n,onCompleteParams:i,onReverseCompleteParams:i,callbackScope:r})},t.fromTo=function(e,t,n){return iR(2,arguments)},t.set=function(e,n){return n.duration=0,n.repeatDelay||(n.repeat=0),new t(e,n)},t.killTweensOf=function(e,t,n){return yI.killTweensOf(e,t,n)},t}(jR);AO(iH.prototype,{_targets:[],_lazy:0,_startAt:0,_op:0,_onInit:0}),bO("staggerTo,staggerFrom,staggerFromTo",(function(e){iH[e]=function(){var t=new WR,n=sR.call(arguments,0);return n.splice("staggerFromTo"===e?5:4,0,0),t[e].apply(t,n)}}));var rH=function(e,t,n){return e[t]=n},oH=function(e,t,n){return e[t](n)},aH=function(e,t,n,i){return e[t](i.fp,n)},sH=function(e,t,n){return e.setAttribute(t,n)},lH=function(e,t){return DI(e[t])?oH:UI(e[t])&&e.setAttribute?sH:rH},pH=function(e,t){return t.set(t.t,t.p,Math.round(1e6*(t.s+t.c*e))/1e6,t)},uH=function(e,t){return t.set(t.t,t.p,!!(t.s+t.c*e),t)},hH=function(e,t){var n=t._pt,i="";if(!e&&t.b)i=t.b;else if(1===e&&t.e)i=t.e;else{for(;n;)i=n.p+(n.m?n.m(n.s+n.c*e):Math.round(1e4*(n.s+n.c*e))/1e4)+i,n=n._next;i+=t.c}t.set(t.t,t.p,i,t)},cH=function(e,t){for(var n=t._pt;n;)n.r(e,n.d),n=n._next},_H=function(e,t,n,i){for(var r,o=this._pt;o;)r=o._next,o.p===i&&o.modifier(e,t,n),o=r},dH=function(e){for(var t,n,i=this._pt;i;)n=i._next,i.p===e&&!i.op||i.op===e?IO(this,i,"_pt"):i.dep||(t=1),i=n;return!t},mH=function(e,t,n,i){i.mSet(e,t,i.m.call(i.tween,n,i.mt),i)},PH=function(e){for(var t,n,i,r,o=e._pt;o;){for(t=o._next,n=i;n&&n.pr>o.pr;)n=n._next;(o._prev=n?n._prev:r)?o._prev._next=o:i=o,(o._next=n)?n._prev=o:r=o,o=t}e._pt=i},fH=function(){function e(e,t,n,i,r,o,a,s,l){this.t=t,this.s=i,this.c=r,this.p=n,this.r=o||pH,this.d=a||this,this.set=s||rH,this.pr=l||0,this._next=e,e&&(e._prev=this)}return e.prototype.modifier=function(e,t,n){this.mSet=this.mSet||this.set,this.set=mH,this.m=e,this.mt=n,this.tween=t},e}();bO(xO+"parent,duration,ease,delay,overwrite,runBackwards,startAt,yoyo,immediateRender,repeat,repeatDelay,data,paused,reversed,lazy,callbackScope,stringFilter,id,yoyoEase,stagger,inherit,repeatRefresh,keyframes,autoRevert,scrollTrigger",(function(e){return hO[e]=1})),rO.TweenMax=rO.TweenLite=iH,rO.TimelineLite=rO.TimelineMax=WR,yI=new WR({sortChildren:!1,defaults:LI,autoRemoveChildren:!0,id:"root",smoothChildTiming:!0}),AI.stringFilter=NR;var xH={registerPlugin:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];t.forEach((function(e){return gR(e)}))},timeline:function(e){return new WR(e)},getTweensOf:function(e,t){return yI.getTweensOf(e,t)},getProperty:function(e,t,n,i){FI(e)&&(e=pR(e)[0]);var r=vO(e||{}).get,o=n?NO:CO;return"native"===n&&(n=""),e?t?o((dO[t]&&dO[t].get||r)(e,t,n,i)):function(t,n,i){return o((dO[t]&&dO[t].get||r)(e,t,n,i))}:e},quickSetter:function(e,t,n){if((e=pR(e)).length>1){var i=e.map((function(e){return gH.quickSetter(e,t,n)})),r=i.length;return function(e){for(var t=r;t--;)i[t](e)}}e=e[0]||{};var o=dO[t],a=vO(e),s=a.harness&&(a.harness.aliases||{})[t]||t,l=o?function(t){var i=new o;ZI._pt=0,i.init(e,n?t+n:t,ZI,0,[e]),i.render(1,i),ZI._pt&&cH(1,ZI)}:a.set(e,s);return o?l:function(t){return l(e,s,n?t+n:t,a,1)}},quickTo:function(e,t,n){var i,r=gH.to(e,LO(((i={})[t]="+=0.1",i.paused=!0,i),n||{})),o=function(e,n,i){return r.resetTo(t,e,n,i)};return o.tween=r,o},isTweening:function(e){return yI.getTweensOf(e,!0).length>0},defaults:function(e){return e&&e.ease&&(e.ease=RR(e.ease,LI.ease)),BO(LI,e||{})},config:function(e){return BO(AI,e||{})},registerEffect:function(e){var t=e.name,n=e.effect,i=e.plugins,r=e.defaults,o=e.extendTimeline;(i||"").split(",").forEach((function(e){return e&&!dO[e]&&!rO[e]&&lO(t+" effect requires "+e+" plugin.")})),mO[t]=function(e,t,i){return n(pR(e),AO(t||{},r),i)},o&&(WR.prototype[t]=function(e,n,i){return this.add(mO[t](e,jI(n)?n:(i=n)&&{},this),i)})},registerEase:function(e,t){BR[e]=RR(t)},parseEase:function(e,t){return arguments.length?RR(e,t):BR},getById:function(e){return yI.getById(e)},exportRoot:function(e,t){void 0===e&&(e={});var n,i,r=new WR(e);for(r.smoothChildTiming=WI(e.smoothChildTiming),yI.remove(r),r._dp=0,r._time=r._tTime=yI._time,n=yI._first;n;)i=n._next,!t&&!n._dur&&n instanceof iH&&n.vars.onComplete===n._targets[0]||JO(r,n,n._start-n._delay),n=i;return JO(yI,r,0),r},utils:{wrap:function e(t,n,i){var r=n-t;return XI(t)?mR(t,e(0,t.length),n):rR(i,(function(e){return(r+(e-t)%r)%r+t}))},wrapYoyo:function e(t,n,i){var r=n-t,o=2*r;return XI(t)?mR(t,e(0,t.length-1),n):rR(i,(function(e){return t+((e=(o+(e-t)%o)%o||0)>r?o-e:e)}))},distribute:hR,random:dR,snap:_R,normalize:function(e,t,n){return fR(e,t,0,1,n)},getUnit:aR,clamp:function(e,t,n){return rR(n,(function(n){return oR(e,t,n)}))},splitColor:ZR,toArray:pR,selector:function(e){return e=pR(e)[0]||lO("Invalid scope")||{},function(t){var n=e.current||e.nativeElement||e;return pR(t,n.querySelectorAll?n:n===e?lO("Invalid scope")||bI.createElement("div"):e)}},mapRange:fR,pipe:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(e){return t.reduce((function(e,t){return t(e)}),e)}},unitize:function(e,t){return function(n){return e(parseFloat(n))+(t||aR(n))}},interpolate:function e(t,n,i,r){var o=isNaN(t+n)?0:function(e){return(1-e)*t+e*n};if(!o){var a,s,l,p,u,h=FI(t),c={};if(!0===i&&(r=1)&&(i=null),h)t={p:t},n={p:n};else if(XI(t)&&!XI(n)){for(l=[],p=t.length,u=p-2,s=1;s<p;s++)l.push(e(t[s-1],t[s]));p--,o=function(e){e*=p;var t=Math.min(u,~~e);return l[t](e-t)},i=n}else r||(t=LO(XI(t)?[]:{},t));if(!l){for(a in n)XR.call(c,t,a,"get",n[a]);o=function(e){return cH(e,c)||(h?t.p:t)}}}return rR(i,o)},shuffle:uR},install:aO,effects:mO,ticker:AR,updateRoot:WR.updateRoot,plugins:dO,globalTimeline:yI,core:{PropTween:fH,globals:pO,Tween:iH,Timeline:WR,Animation:jR,getCache:vO,_removeLinkedListItem:IO,suppressOverwrites:function(e){return xI=e}}};bO("to,from,fromTo,delayedCall,set,killTweensOf",(function(e){return xH[e]=iH[e]})),AR.add(WR.updateRoot),ZI=xH.to({},{duration:0});var yH=function(e,t){for(var n=e._pt;n&&n.p!==t&&n.op!==t&&n.fp!==t;)n=n._next;return n},vH=function(e,t){return{name:e,rawVars:1,init:function(e,n,i){i._onInit=function(e){var i,r;if(FI(n)&&(i={},bO(n,(function(e){return i[e]=1})),n=i),t){for(r in i={},n)i[r]=t(n[r]);n=i}!function(e,t){var n,i,r,o=e._targets;for(n in t)for(i=o.length;i--;)(r=e._ptLookup[i][n])&&(r=r.d)&&(r._pt&&(r=yH(r,n)),r&&r.modifier&&r.modifier(t[n],e,o[i],n))}(e,n)}}}},gH=xH.registerPlugin({name:"attr",init:function(e,t,n,i,r){var o,a;for(o in t)(a=this.add(e,"setAttribute",(e.getAttribute(o)||0)+"",t[o],i,r,0,0,o))&&(a.op=o),this._props.push(o)}},{name:"endArray",init:function(e,t){for(var n=t.length;n--;)this.add(e,n,e[n]||0,t[n])}},vH("roundProps",cR),vH("modifiers"),vH("snap",_R))||xH;iH.version=WR.version=gH.version="3.10.4",zI=1,qI()&&LR(),BR.Power0,BR.Power1,BR.Power2,BR.Power3,BR.Power4,BR.Linear,BR.Quad,BR.Cubic,BR.Quart,BR.Quint,BR.Strong,BR.Elastic,BR.Back,BR.SteppedEase,BR.Bounce,BR.Sine,BR.Expo,BR.Circ;
/*!
     * CSSPlugin 3.10.4
     * https://greensock.com
     *
     * Copyright 2008-2022, GreenSock. All rights reserved.
     * Subject to the terms at https://greensock.com/standard-license or for
     * Club GreenSock members, the agreement issued with that membership.
     * @author: Jack Doyle, jack@greensock.com
    */
var bH,zH,wH,ZH,EH,MH,SH,CH={},NH=180/Math.PI,AH=Math.PI/180,LH=Math.atan2,BH=/([A-Z])/g,TH=/(left|right|width|margin|padding|x)/i,VH=/[\s,\(]\S/,kH={autoAlpha:"opacity,visibility",scale:"scaleX,scaleY",alpha:"opacity"},IH=function(e,t){return t.set(t.t,t.p,Math.round(1e4*(t.s+t.c*e))/1e4+t.u,t)},OH=function(e,t){return t.set(t.t,t.p,1===e?t.e:Math.round(1e4*(t.s+t.c*e))/1e4+t.u,t)},RH=function(e,t){return t.set(t.t,t.p,e?Math.round(1e4*(t.s+t.c*e))/1e4+t.u:t.b,t)},HH=function(e,t){var n=t.s+t.c*e;t.set(t.t,t.p,~~(n+(n<0?-.5:.5))+t.u,t)},FH=function(e,t){return t.set(t.t,t.p,e?t.e:t.b,t)},DH=function(e,t){return t.set(t.t,t.p,1!==e?t.b:t.e,t)},GH=function(e,t,n){return e.style[t]=n},UH=function(e,t,n){return e.style.setProperty(t,n)},jH=function(e,t,n){return e._gsap[t]=n},WH=function(e,t,n){return e._gsap.scaleX=e._gsap.scaleY=n},qH=function(e,t,n,i,r){var o=e._gsap;o.scaleX=o.scaleY=n,o.renderTransform(r,o)},JH=function(e,t,n,i,r){var o=e._gsap;o[t]=n,o.renderTransform(r,o)},$H="transform",XH=$H+"Origin",YH=function(e,t){var n=zH.createElementNS?zH.createElementNS((t||"http://www.w3.org/1999/xhtml").replace(/^https/,"http"),e):zH.createElement(e);return n.style?n:zH.createElement(e)},KH=function e(t,n,i){var r=getComputedStyle(t);return r[n]||r.getPropertyValue(n.replace(BH,"-$1").toLowerCase())||r.getPropertyValue(n)||!i&&e(t,eF(n)||n,1)||""},QH="O,Moz,ms,Ms,Webkit".split(","),eF=function(e,t,n){var i=(t||EH).style,r=5;if(e in i&&!n)return e;for(e=e.charAt(0).toUpperCase()+e.substr(1);r--&&!(QH[r]+e in i););return r<0?null:(3===r?"ms":r>=0?QH[r]:"")+e},tF=function(){"undefined"!=typeof window&&window.document&&(bH=window,zH=bH.document,wH=zH.documentElement,EH=YH("div")||{style:{}},YH("div"),$H=eF($H),XH=$H+"Origin",EH.style.cssText="border-width:0;line-height:0;position:absolute;padding:0",SH=!!eF("perspective"),ZH=1)},nF=function e(t){var n,i=YH("svg",this.ownerSVGElement&&this.ownerSVGElement.getAttribute("xmlns")||"http://www.w3.org/2000/svg"),r=this.parentNode,o=this.nextSibling,a=this.style.cssText;if(wH.appendChild(i),i.appendChild(this),this.style.display="block",t)try{n=this.getBBox(),this._gsapBBox=this.getBBox,this.getBBox=e}catch(e){}else this._gsapBBox&&(n=this._gsapBBox());return r&&(o?r.insertBefore(this,o):r.appendChild(this)),wH.removeChild(i),this.style.cssText=a,n},iF=function(e,t){for(var n=t.length;n--;)if(e.hasAttribute(t[n]))return e.getAttribute(t[n])},rF=function(e){var t;try{t=e.getBBox()}catch(n){t=nF.call(e,!0)}return t&&(t.width||t.height)||e.getBBox===nF||(t=nF.call(e,!0)),!t||t.width||t.x||t.y?t:{x:+iF(e,["x","cx","x1"])||0,y:+iF(e,["y","cy","y1"])||0,width:0,height:0}},oF=function(e){return!(!e.getCTM||e.parentNode&&!e.ownerSVGElement||!rF(e))},aF=function(e,t){if(t){var n=e.style;t in CH&&t!==XH&&(t=$H),n.removeProperty?("ms"!==t.substr(0,2)&&"webkit"!==t.substr(0,6)||(t="-"+t),n.removeProperty(t.replace(BH,"-$1").toLowerCase())):n.removeAttribute(t)}},sF=function(e,t,n,i,r,o){var a=new fH(e._pt,t,n,0,1,o?DH:FH);return e._pt=a,a.b=i,a.e=r,e._props.push(n),a},lF={deg:1,rad:1,turn:1},pF=function e(t,n,i,r){var o,a,s,l,p=parseFloat(i)||0,u=(i+"").trim().substr((p+"").length)||"px",h=EH.style,c=TH.test(n),_="svg"===t.tagName.toLowerCase(),d=(_?"client":"offset")+(c?"Width":"Height"),m=100,P="px"===r,f="%"===r;return r===u||!p||lF[r]||lF[u]?p:("px"!==u&&!P&&(p=e(t,n,i,"px")),l=t.getCTM&&oF(t),!f&&"%"!==u||!CH[n]&&!~n.indexOf("adius")?(h[c?"width":"height"]=m+(P?u:r),a=~n.indexOf("adius")||"em"===r&&t.appendChild&&!_?t:t.parentNode,l&&(a=(t.ownerSVGElement||{}).parentNode),a&&a!==zH&&a.appendChild||(a=zH.body),(s=a._gsap)&&f&&s.width&&c&&s.time===AR.time?zO(p/s.width*m):((f||"%"===u)&&(h.position=KH(t,"position")),a===t&&(h.position="static"),a.appendChild(EH),o=EH[d],a.removeChild(EH),h.position="absolute",c&&f&&((s=vO(a)).time=AR.time,s.width=a[d]),zO(P?o*p/m:o&&p?m/o*p:0))):(o=l?t.getBBox()[c?"width":"height"]:t[d],zO(f?p/o*m:p/100*o)))},uF=function(e,t,n,i){var r;return ZH||tF(),t in kH&&"transform"!==t&&~(t=kH[t]).indexOf(",")&&(t=t.split(",")[0]),CH[t]&&"transform"!==t?(r=bF(e,i),r="transformOrigin"!==t?r[t]:r.svg?r.origin:zF(KH(e,XH))+" "+r.zOrigin+"px"):(!(r=e.style[t])||"auto"===r||i||~(r+"").indexOf("calc("))&&(r=mF[t]&&mF[t](e,t,n)||KH(e,t)||gO(e,t)||("opacity"===t?1:0)),n&&!~(r+"").trim().indexOf(" ")?pF(e,t,r,n)+n:r},hF=function(e,t,n,i){if(!n||"none"===n){var r=eF(t,e,1),o=r&&KH(e,r,1);o&&o!==n?(t=r,n=o):"borderColor"===t&&(n=KH(e,"borderTopColor"))}var a,s,l,p,u,h,c,_,d,m,P,f=new fH(this._pt,e.style,t,0,1,hH),x=0,y=0;if(f.b=n,f.e=i,n+="","auto"==(i+="")&&(e.style[t]=i,i=KH(e,t)||i,e.style[t]=n),NR(a=[n,i]),i=a[1],l=(n=a[0]).match(QI)||[],(i.match(QI)||[]).length){for(;s=QI.exec(i);)c=s[0],d=i.substring(x,s.index),u?u=(u+1)%5:"rgba("!==d.substr(-5)&&"hsla("!==d.substr(-5)||(u=1),c!==(h=l[y++]||"")&&(p=parseFloat(h)||0,P=h.substr((p+"").length),"="===c.charAt(1)&&(c=ZO(p,c)+P),_=parseFloat(c),m=c.substr((_+"").length),x=QI.lastIndex-m.length,m||(m=m||AI.units[t]||P,x===i.length&&(i+=m,f.e+=m)),P!==m&&(p=pF(e,t,h,m)||0),f._pt={_next:f._pt,p:d||1===y?d:",",s:p,c:_-p,m:u&&u<4||"zIndex"===t?Math.round:0});f.c=x<i.length?i.substring(x,i.length):""}else f.r="display"===t&&"none"===i?DH:FH;return tO.test(i)&&(f.e=0),this._pt=f,f},cF={top:"0%",bottom:"100%",left:"0%",right:"100%",center:"50%"},_F=function(e){var t=e.split(" "),n=t[0],i=t[1]||"50%";return"top"!==n&&"bottom"!==n&&"left"!==i&&"right"!==i||(e=n,n=i,i=e),t[0]=cF[n]||n,t[1]=cF[i]||i,t.join(" ")},dF=function(e,t){if(t.tween&&t.tween._time===t.tween._dur){var n,i,r,o=t.t,a=o.style,s=t.u,l=o._gsap;if("all"===s||!0===s)a.cssText="",i=1;else for(r=(s=s.split(",")).length;--r>-1;)n=s[r],CH[n]&&(i=1,n="transformOrigin"===n?XH:$H),aF(o,n);i&&(aF(o,$H),l&&(l.svg&&o.removeAttribute("transform"),bF(o,1),l.uncache=1))}},mF={clearProps:function(e,t,n,i,r){if("isFromStart"!==r.data){var o=e._pt=new fH(e._pt,t,n,0,0,dF);return o.u=i,o.pr=-10,o.tween=r,e._props.push(n),1}}},PF=[1,0,0,1,0,0],fF={},xF=function(e){return"matrix(1, 0, 0, 1, 0, 0)"===e||"none"===e||!e},yF=function(e){var t=KH(e,$H);return xF(t)?PF:t.substr(7).match(KI).map(zO)},vF=function(e,t){var n,i,r,o,a=e._gsap||vO(e),s=e.style,l=yF(e);return a.svg&&e.getAttribute("transform")?"1,0,0,1,0,0"===(l=[(r=e.transform.baseVal.consolidate().matrix).a,r.b,r.c,r.d,r.e,r.f]).join(",")?PF:l:(l!==PF||e.offsetParent||e===wH||a.svg||(r=s.display,s.display="block",(n=e.parentNode)&&e.offsetParent||(o=1,i=e.nextSibling,wH.appendChild(e)),l=yF(e),r?s.display=r:aF(e,"display"),o&&(i?n.insertBefore(e,i):n?n.appendChild(e):wH.removeChild(e))),t&&l.length>6?[l[0],l[1],l[4],l[5],l[12],l[13]]:l)},gF=function(e,t,n,i,r,o){var a,s,l,p=e._gsap,u=r||vF(e,!0),h=p.xOrigin||0,c=p.yOrigin||0,_=p.xOffset||0,d=p.yOffset||0,m=u[0],P=u[1],f=u[2],x=u[3],y=u[4],v=u[5],g=t.split(" "),b=parseFloat(g[0])||0,z=parseFloat(g[1])||0;n?u!==PF&&(s=m*x-P*f)&&(l=b*(-P/s)+z*(m/s)-(m*v-P*y)/s,b=b*(x/s)+z*(-f/s)+(f*v-x*y)/s,z=l):(b=(a=rF(e)).x+(~g[0].indexOf("%")?b/100*a.width:b),z=a.y+(~(g[1]||g[0]).indexOf("%")?z/100*a.height:z)),i||!1!==i&&p.smooth?(y=b-h,v=z-c,p.xOffset=_+(y*m+v*f)-y,p.yOffset=d+(y*P+v*x)-v):p.xOffset=p.yOffset=0,p.xOrigin=b,p.yOrigin=z,p.smooth=!!i,p.origin=t,p.originIsAbsolute=!!n,e.style[XH]="0px 0px",o&&(sF(o,p,"xOrigin",h,b),sF(o,p,"yOrigin",c,z),sF(o,p,"xOffset",_,p.xOffset),sF(o,p,"yOffset",d,p.yOffset)),e.setAttribute("data-svg-origin",b+" "+z)},bF=function(e,t){var n=e._gsap||new UR(e);if("x"in n&&!t&&!n.uncache)return n;var i,r,o,a,s,l,p,u,h,c,_,d,m,P,f,x,y,v,g,b,z,w,Z,E,M,S,C,N,A,L,B,T,V=e.style,k=n.scaleX<0,I="px",O="deg",R=KH(e,XH)||"0";return i=r=o=l=p=u=h=c=_=0,a=s=1,n.svg=!(!e.getCTM||!oF(e)),P=vF(e,n.svg),n.svg&&(E=(!n.uncache||"0px 0px"===R)&&!t&&e.getAttribute("data-svg-origin"),gF(e,E||R,!!E||n.originIsAbsolute,!1!==n.smooth,P)),d=n.xOrigin||0,m=n.yOrigin||0,P!==PF&&(v=P[0],g=P[1],b=P[2],z=P[3],i=w=P[4],r=Z=P[5],6===P.length?(a=Math.sqrt(v*v+g*g),s=Math.sqrt(z*z+b*b),l=v||g?LH(g,v)*NH:0,(h=b||z?LH(b,z)*NH+l:0)&&(s*=Math.abs(Math.cos(h*AH))),n.svg&&(i-=d-(d*v+m*b),r-=m-(d*g+m*z))):(T=P[6],L=P[7],C=P[8],N=P[9],A=P[10],B=P[11],i=P[12],r=P[13],o=P[14],p=(f=LH(T,A))*NH,f&&(E=w*(x=Math.cos(-f))+C*(y=Math.sin(-f)),M=Z*x+N*y,S=T*x+A*y,C=w*-y+C*x,N=Z*-y+N*x,A=T*-y+A*x,B=L*-y+B*x,w=E,Z=M,T=S),u=(f=LH(-b,A))*NH,f&&(x=Math.cos(-f),B=z*(y=Math.sin(-f))+B*x,v=E=v*x-C*y,g=M=g*x-N*y,b=S=b*x-A*y),l=(f=LH(g,v))*NH,f&&(E=v*(x=Math.cos(f))+g*(y=Math.sin(f)),M=w*x+Z*y,g=g*x-v*y,Z=Z*x-w*y,v=E,w=M),p&&Math.abs(p)+Math.abs(l)>359.9&&(p=l=0,u=180-u),a=zO(Math.sqrt(v*v+g*g+b*b)),s=zO(Math.sqrt(Z*Z+T*T)),f=LH(w,Z),h=Math.abs(f)>2e-4?f*NH:0,_=B?1/(B<0?-B:B):0),n.svg&&(E=e.getAttribute("transform"),n.forceCSS=e.setAttribute("transform","")||!xF(KH(e,$H)),E&&e.setAttribute("transform",E))),Math.abs(h)>90&&Math.abs(h)<270&&(k?(a*=-1,h+=l<=0?180:-180,l+=l<=0?180:-180):(s*=-1,h+=h<=0?180:-180)),t=t||n.uncache,n.x=i-((n.xPercent=i&&(!t&&n.xPercent||(Math.round(e.offsetWidth/2)===Math.round(-i)?-50:0)))?e.offsetWidth*n.xPercent/100:0)+I,n.y=r-((n.yPercent=r&&(!t&&n.yPercent||(Math.round(e.offsetHeight/2)===Math.round(-r)?-50:0)))?e.offsetHeight*n.yPercent/100:0)+I,n.z=o+I,n.scaleX=zO(a),n.scaleY=zO(s),n.rotation=zO(l)+O,n.rotationX=zO(p)+O,n.rotationY=zO(u)+O,n.skewX=h+O,n.skewY=c+O,n.transformPerspective=_+I,(n.zOrigin=parseFloat(R.split(" ")[2])||0)&&(V[XH]=zF(R)),n.xOffset=n.yOffset=0,n.force3D=AI.force3D,n.renderTransform=n.svg?NF:SH?CF:ZF,n.uncache=0,n},zF=function(e){return(e=e.split(" "))[0]+" "+e[1]},wF=function(e,t,n){var i=aR(t);return zO(parseFloat(t)+parseFloat(pF(e,"x",n+"px",i)))+i},ZF=function(e,t){t.z="0px",t.rotationY=t.rotationX="0deg",t.force3D=0,CF(e,t)},EF="0deg",MF="0px",SF=") ",CF=function(e,t){var n=t||this,i=n.xPercent,r=n.yPercent,o=n.x,a=n.y,s=n.z,l=n.rotation,p=n.rotationY,u=n.rotationX,h=n.skewX,c=n.skewY,_=n.scaleX,d=n.scaleY,m=n.transformPerspective,P=n.force3D,f=n.target,x=n.zOrigin,y="",v="auto"===P&&e&&1!==e||!0===P;if(x&&(u!==EF||p!==EF)){var g,b=parseFloat(p)*AH,z=Math.sin(b),w=Math.cos(b);b=parseFloat(u)*AH,g=Math.cos(b),o=wF(f,o,z*g*-x),a=wF(f,a,-Math.sin(b)*-x),s=wF(f,s,w*g*-x+x)}m!==MF&&(y+="perspective("+m+SF),(i||r)&&(y+="translate("+i+"%, "+r+"%) "),(v||o!==MF||a!==MF||s!==MF)&&(y+=s!==MF||v?"translate3d("+o+", "+a+", "+s+") ":"translate("+o+", "+a+SF),l!==EF&&(y+="rotate("+l+SF),p!==EF&&(y+="rotateY("+p+SF),u!==EF&&(y+="rotateX("+u+SF),h===EF&&c===EF||(y+="skew("+h+", "+c+SF),1===_&&1===d||(y+="scale("+_+", "+d+SF),f.style[$H]=y||"translate(0, 0)"},NF=function(e,t){var n,i,r,o,a,s=t||this,l=s.xPercent,p=s.yPercent,u=s.x,h=s.y,c=s.rotation,_=s.skewX,d=s.skewY,m=s.scaleX,P=s.scaleY,f=s.target,x=s.xOrigin,y=s.yOrigin,v=s.xOffset,g=s.yOffset,b=s.forceCSS,z=parseFloat(u),w=parseFloat(h);c=parseFloat(c),_=parseFloat(_),(d=parseFloat(d))&&(_+=d=parseFloat(d),c+=d),c||_?(c*=AH,_*=AH,n=Math.cos(c)*m,i=Math.sin(c)*m,r=Math.sin(c-_)*-P,o=Math.cos(c-_)*P,_&&(d*=AH,a=Math.tan(_-d),r*=a=Math.sqrt(1+a*a),o*=a,d&&(a=Math.tan(d),n*=a=Math.sqrt(1+a*a),i*=a)),n=zO(n),i=zO(i),r=zO(r),o=zO(o)):(n=m,o=P,i=r=0),(z&&!~(u+"").indexOf("px")||w&&!~(h+"").indexOf("px"))&&(z=pF(f,"x",u,"px"),w=pF(f,"y",h,"px")),(x||y||v||g)&&(z=zO(z+x-(x*n+y*r)+v),w=zO(w+y-(x*i+y*o)+g)),(l||p)&&(a=f.getBBox(),z=zO(z+l/100*a.width),w=zO(w+p/100*a.height)),a="matrix("+n+","+i+","+r+","+o+","+z+","+w+")",f.setAttribute("transform",a),b&&(f.style[$H]=a)},AF=function(e,t,n,i,r){var o,a,s=360,l=FI(r),p=parseFloat(r)*(l&&~r.indexOf("rad")?NH:1)-i,u=i+p+"deg";return l&&("short"===(o=r.split("_")[1])&&(p%=s)!=p%180&&(p+=p<0?s:-360),"cw"===o&&p<0?p=(p+36e9)%s-~~(p/s)*s:"ccw"===o&&p>0&&(p=(p-36e9)%s-~~(p/s)*s)),e._pt=a=new fH(e._pt,t,n,i,p,OH),a.e=u,a.u="deg",e._props.push(n),a},LF=function(e,t){for(var n in t)e[n]=t[n];return e},BF=function(e,t,n){var i,r,o,a,s,l,p,u=LF({},n._gsap),h=n.style;for(r in u.svg?(o=n.getAttribute("transform"),n.setAttribute("transform",""),h[$H]=t,i=bF(n,1),aF(n,$H),n.setAttribute("transform",o)):(o=getComputedStyle(n)[$H],h[$H]=t,i=bF(n,1),h[$H]=o),CH)(o=u[r])!==(a=i[r])&&"perspective,force3D,transformOrigin,svgOrigin".indexOf(r)<0&&(s=aR(o)!==(p=aR(a))?pF(n,r,o,p):parseFloat(o),l=parseFloat(a),e._pt=new fH(e._pt,i,r,s,l-s,IH),e._pt.u=p||0,e._props.push(r));LF(i,u)};bO("padding,margin,Width,Radius",(function(e,t){var n="Top",i="Right",r="Bottom",o="Left",a=(t<3?[n,i,r,o]:[n+o,n+i,r+i,r+o]).map((function(n){return t<2?e+n:"border"+n+e}));mF[t>1?"border"+e:e]=function(e,t,n,i,r){var o,s;if(arguments.length<4)return o=a.map((function(t){return uF(e,t,n)})),5===(s=o.join(" ")).split(o[0]).length?o[0]:s;o=(i+"").split(" "),s={},a.forEach((function(e,t){return s[e]=o[t]=o[t]||o[(t-1)/2|0]})),e.init(t,s,r)}}));var TF,VF,kF={name:"css",register:tF,targetTest:function(e){return e.style&&e.nodeType},init:function(e,t,n,i,r){var o,a,s,l,p,u,h,c,_,d,m,P,f,x,y,v=this._props,g=e.style,b=n.vars.startAt;for(h in ZH||tF(),t)if("autoRound"!==h&&(a=t[h],!dO[h]||!YR(h,t,n,i,e,r)))if(p=typeof a,u=mF[h],"function"===p&&(p=typeof(a=a.call(n,i,e,r))),"string"===p&&~a.indexOf("random(")&&(a=PR(a)),u)u(this,e,h,a,n)&&(y=1);else if("--"===h.substr(0,2))o=(getComputedStyle(e).getPropertyValue(h)+"").trim(),a+="",SR.lastIndex=0,SR.test(o)||(c=aR(o),_=aR(a)),_?c!==_&&(o=pF(e,h,o,_)+_):c&&(a+=c),this.add(g,"setProperty",o,a,i,r,0,0,h),v.push(h);else if("undefined"!==p){if(b&&h in b?(o="function"==typeof b[h]?b[h].call(n,i,e,r):b[h],FI(o)&&~o.indexOf("random(")&&(o=PR(o)),aR(o+"")||(o+=AI.units[h]||aR(uF(e,h))||""),"="===(o+"").charAt(1)&&(o=uF(e,h))):o=uF(e,h),l=parseFloat(o),(d="string"===p&&"="===a.charAt(1)&&a.substr(0,2))&&(a=a.substr(2)),s=parseFloat(a),h in kH&&("autoAlpha"===h&&(1===l&&"hidden"===uF(e,"visibility")&&s&&(l=0),sF(this,g,"visibility",l?"inherit":"hidden",s?"inherit":"hidden",!s)),"scale"!==h&&"transform"!==h&&~(h=kH[h]).indexOf(",")&&(h=h.split(",")[0])),m=h in CH)if(P||((f=e._gsap).renderTransform&&!t.parseTransform||bF(e,t.parseTransform),x=!1!==t.smoothOrigin&&f.smooth,(P=this._pt=new fH(this._pt,g,$H,0,1,f.renderTransform,f,0,-1)).dep=1),"scale"===h)this._pt=new fH(this._pt,f,"scaleY",f.scaleY,(d?ZO(f.scaleY,d+s):s)-f.scaleY||0),v.push("scaleY",h),h+="X";else{if("transformOrigin"===h){a=_F(a),f.svg?gF(e,a,0,x,0,this):((_=parseFloat(a.split(" ")[2])||0)!==f.zOrigin&&sF(this,f,"zOrigin",f.zOrigin,_),sF(this,g,h,zF(o),zF(a)));continue}if("svgOrigin"===h){gF(e,a,1,x,0,this);continue}if(h in fF){AF(this,f,h,l,d?ZO(l,d+a):a);continue}if("smoothOrigin"===h){sF(this,f,"smooth",f.smooth,a);continue}if("force3D"===h){f[h]=a;continue}if("transform"===h){BF(this,a,e);continue}}else h in g||(h=eF(h)||h);if(m||(s||0===s)&&(l||0===l)&&!VH.test(a)&&h in g)s||(s=0),(c=(o+"").substr((l+"").length))!==(_=aR(a)||(h in AI.units?AI.units[h]:c))&&(l=pF(e,h,o,_)),this._pt=new fH(this._pt,m?f:g,h,l,(d?ZO(l,d+s):s)-l,m||"px"!==_&&"zIndex"!==h||!1===t.autoRound?IH:HH),this._pt.u=_||0,c!==_&&"%"!==_&&(this._pt.b=o,this._pt.r=RH);else if(h in g)hF.call(this,e,h,o,d?d+a:a);else{if(!(h in e)){sO(h,a);continue}this.add(e,h,o||e[h],d?d+a:a,i,r)}v.push(h)}y&&PH(this)},get:uF,aliases:kH,getSetter:function(e,t,n){var i=kH[t];return i&&i.indexOf(",")<0&&(t=i),t in CH&&t!==XH&&(e._gsap.x||uF(e,"x"))?n&&MH===n?"scale"===t?WH:jH:(MH=n||{})&&("scale"===t?qH:JH):e.style&&!UI(e.style[t])?GH:~t.indexOf("-")?UH:lH(e,t)},core:{_removeProperty:aF,_getMatrix:vF}};gH.utils.checkPrefix=eF,VF=bO("x,y,z,scale,scaleX,scaleY,xPercent,yPercent"+","+(TF="rotation,rotationX,rotationY,skewX,skewY")+",transform,transformOrigin,svgOrigin,force3D,smoothOrigin,transformPerspective",(function(e){CH[e]=1})),bO(TF,(function(e){AI.units[e]="deg",fF[e]=1})),kH[VF[13]]="x,y,z,scale,scaleX,scaleY,xPercent,yPercent,"+TF,bO("0:translateX,1:translateY,2:translateZ,8:rotate,8:rotationZ,8:rotateZ,9:rotateX,10:rotateY",(function(e){var t=e.split(":");kH[t[1]]=VF[t[0]]})),bO("x,y,z,top,right,bottom,left,width,height,fontSize,padding,margin,perspective",(function(e){AI.units[e]="px"})),gH.registerPlugin(kF);var IF=gH.registerPlugin(kF)||gH;IF.core.Tween;const OF={collectible:{type:0,reactivationTime:-1,initialActivationDelay:0,interactionRadius:.5,isUserInteractionNeeded:!1,model:{gltf:{id:jV},scale:new ev(.0095,.0095,.0095)},on:{activate:({model:e})=>{const t=bT(fz[iz],Be.cycleData.now);t.instance.position.copy(e.position),Be.world.scene.add(t.instance),IF.delayedCall(1,t.dispose),e.scale.set(0,0,0),IF.to(e.scale,{x:1,y:1,z:1,duration:1})},collect:({collectible:{model:e}})=>{const t=bT(fz[rz],Be.cycleData.now);t.instance.position.copy(e.position),Be.world.scene.add(t.instance),IF.delayedCall(1,t.dispose),we.update((e=>e+1))}}}},RF=({gltf:e=null,fbx:t=null,scale:n=new p_(1,1,1)})=>{if(t){const e=Bh(t.id);return e.scale.copy(n),e}if(e){const t=kh(e.id).scene.clone();return t.children.forEach((e=>e.scale.copy(n))),t}},HF={id:zk,create:({world:{cycleData:e}})=>{let t=[],n=[];return{addCollector:e=>n.push(e),removeCollector:e=>n.filter((t=>t!==e)),addCollectible:n=>{n.collisionObject.visible=!1;const i=RF(n.model);i.position.copy(n.collisionObject.position);const r={id:sy(),isInited:!1,initialActivationTime:e.now+1e3*n.initialActivationDelay,lastActivationTime:e.now,lastCollectionTime:0,isCollected:!1,config:n,model:i};return t.push(r),r},removeCollectible:e=>{t=t.filter((t=>t!==e))},update:({isPaused:e,now:i})=>{e||t.forEach((e=>{const{isInited:t,initialActivationTime:r,isCollected:o,lastCollectionTime:a,config:{reactivationTime:s,on:l}}=e;o||!o&&!t?(t&&-1!==s&&i-a>=1e3*s||!t&&i>=r)&&(((e,t)=>{e.isInited=!0,e.isCollected=!1,e.lastActivationTime=t,e.config.collisionObject.parent.add(e.model)})(e,i),l.activate?.(e)):n.forEach((t=>{const{collider:n}=t,{model:r,config:{interactionRadius:o,isUserInteractionNeeded:a,collisionAlgorithm:s,on:l}}=e,p=()=>{l.interact?.({collector:t,collectible:e}),a||(e.isCollected=!0,e.lastCollectionTime=i,e.model.parent?.remove(e.model),l.collect?.({collector:t,collectible:e}))};if(s)s({collector:t,collectible:e})&&p();else{const e=(n.radius+o)**2;for(const t of[n.start,n.end])if(t.distanceToSquared(r.position)<e){p();break}}}))}))},dispose:()=>{t=[],n=[]}}},config:{}},FF={"portal-01":"spawn-02","portal-02":"spawn-03","portal-03":"spawn-01"};let DF="spawn-01";const GF={},UF={},jF=e=>{e.velocity.set(0,0,0)},WF=new p_,qF=new p_,JF=new p_;class $F{constructor(e=new p_(0,0,0),t=new p_(0,1,0),n=1){this.start=e,this.end=t,this.radius=n}clone(){return new $F(this.start.clone(),this.end.clone(),this.radius)}set(e,t,n){this.start.copy(e),this.end.copy(t),this.radius=n}copy(e){this.start.copy(e.start),this.end.copy(e.end),this.radius=e.radius}getCenter(e){return e.copy(this.end).add(this.start).multiplyScalar(.5)}translate(e){this.start.add(e),this.end.add(e)}checkAABBAxis(e,t,n,i,r,o,a,s,l){return(r-e<l||r-n<l)&&(e-o<l||n-o<l)&&(a-t<l||a-i<l)&&(t-s<l||i-s<l)}intersectsBox(e){return this.checkAABBAxis(this.start.x,this.start.y,this.end.x,this.end.y,e.min.x,e.max.x,e.min.y,e.max.y,this.radius)&&this.checkAABBAxis(this.start.x,this.start.z,this.end.x,this.end.z,e.min.x,e.max.x,e.min.z,e.max.z,this.radius)&&this.checkAABBAxis(this.start.y,this.start.z,this.end.y,this.end.z,e.min.y,e.max.y,e.min.z,e.max.z,this.radius)}lineLineMinimumPoints(e,t){const n=WF.copy(e.end).sub(e.start),i=qF.copy(t.end).sub(t.start),r=JF.copy(t.start).sub(e.start),o=n.dot(i),a=n.dot(n),s=i.dot(i),l=i.dot(r),p=n.dot(r);let u,h;const c=a*s-o*o;if(Math.abs(c)<1e-10){const e=-l/s,t=(o-l)/s;Math.abs(e-.5)<Math.abs(t-.5)?(u=0,h=e):(u=1,h=t)}else u=(l*o+p*s)/c,h=(u*o-l)/s;return h=Math.max(0,Math.min(1,h)),u=Math.max(0,Math.min(1,u)),[n.multiplyScalar(u).add(e.start),i.multiplyScalar(h).add(t.start)]}}const XF=new p_,YF=new p_,KF=new ym,QF=new $x,eD=new $x,tD=new A_,nD=new $F;class iD{constructor(e){this.triangles=[],this.box=e,this.subTrees=[]}addTriangle(e){return this.bounds||(this.bounds=new c_),this.bounds.min.x=Math.min(this.bounds.min.x,e.a.x,e.b.x,e.c.x),this.bounds.min.y=Math.min(this.bounds.min.y,e.a.y,e.b.y,e.c.y),this.bounds.min.z=Math.min(this.bounds.min.z,e.a.z,e.b.z,e.c.z),this.bounds.max.x=Math.max(this.bounds.max.x,e.a.x,e.b.x,e.c.x),this.bounds.max.y=Math.max(this.bounds.max.y,e.a.y,e.b.y,e.c.y),this.bounds.max.z=Math.max(this.bounds.max.z,e.a.z,e.b.z,e.c.z),this.triangles.push(e),this}calcBox(){return this.box=this.bounds.clone(),this.box.min.x-=.01,this.box.min.y-=.01,this.box.min.z-=.01,this}split(e){if(!this.box)return;const t=[],n=YF.copy(this.box.max).sub(this.box.min).multiplyScalar(.5);for(let e=0;e<2;e++)for(let i=0;i<2;i++)for(let r=0;r<2;r++){const o=new c_,a=XF.set(e,i,r);o.min.copy(this.box.min).add(a.multiply(n)),o.max.copy(o.min).add(n),t.push(new iD(o))}let i;for(;i=this.triangles.pop();)for(let e=0;e<t.length;e++)t[e].box.intersectsTriangle(i)&&t[e].triangles.push(i);for(let n=0;n<t.length;n++){const i=t[n].triangles.length;i>8&&e<16&&t[n].split(e+1),0!==i&&this.subTrees.push(t[n])}return this}build(){return this.calcBox(),this.split(0),this}getRayTriangles(e,t){for(let n=0;n<this.subTrees.length;n++){const i=this.subTrees[n];if(e.intersectsBox(i.box))if(i.triangles.length>0)for(let e=0;e<i.triangles.length;e++)-1===t.indexOf(i.triangles[e])&&t.push(i.triangles[e]);else i.getRayTriangles(e,t)}return t}triangleCapsuleIntersect(e,t){t.getPlane(KF);const n=KF.distanceToPoint(e.start)-e.radius,i=KF.distanceToPoint(e.end)-e.radius;if(n>0&&i>0||n<-e.radius&&i<-e.radius)return!1;const r=Math.abs(n/(Math.abs(n)+Math.abs(i))),o=XF.copy(e.start).lerp(e.end,r);if(t.containsPoint(o))return{normal:KF.normal.clone(),point:o.clone(),depth:Math.abs(Math.min(n,i))};const a=e.radius*e.radius,s=QF.set(e.start,e.end),l=[[t.a,t.b],[t.b,t.c],[t.c,t.a]];for(let t=0;t<l.length;t++){const n=eD.set(l[t][0],l[t][1]),[i,r]=e.lineLineMinimumPoints(s,n);if(i.distanceToSquared(r)<a)return{normal:i.clone().sub(r).normalize(),point:r.clone(),depth:e.radius-i.distanceTo(r)}}return!1}triangleSphereIntersect(e,t){if(t.getPlane(KF),!e.intersectsPlane(KF))return!1;const n=Math.abs(KF.distanceToSphere(e)),i=e.radius*e.radius-n*n,r=KF.projectPoint(e.center,XF);if(t.containsPoint(e.center))return{normal:KF.normal.clone(),point:r.clone(),depth:Math.abs(KF.distanceToSphere(e))};const o=[[t.a,t.b],[t.b,t.c],[t.c,t.a]];for(let t=0;t<o.length;t++){QF.set(o[t][0],o[t][1]),QF.closestPointToPoint(r,!0,YF);const n=YF.distanceToSquared(e.center);if(n<i)return{normal:e.center.clone().sub(YF).normalize(),point:YF.clone(),depth:e.radius-Math.sqrt(n)}}return!1}getSphereTriangles(e,t){for(let n=0;n<this.subTrees.length;n++){const i=this.subTrees[n];if(e.intersectsBox(i.box))if(i.triangles.length>0)for(let e=0;e<i.triangles.length;e++)-1===t.indexOf(i.triangles[e])&&t.push(i.triangles[e]);else i.getSphereTriangles(e,t)}}getCapsuleTriangles(e,t){for(let n=0;n<this.subTrees.length;n++){const i=this.subTrees[n];if(e.intersectsBox(i.box))if(i.triangles.length>0)for(let e=0;e<i.triangles.length;e++)-1===t.indexOf(i.triangles[e])&&t.push(i.triangles[e]);else i.getCapsuleTriangles(e,t)}}sphereIntersect(e){tD.copy(e);const t=[];let n,i=!1;this.getSphereTriangles(e,t);for(let e=0;e<t.length;e++)(n=this.triangleSphereIntersect(tD,t[e]))&&(i=!0,tD.center.add(n.normal.multiplyScalar(n.depth)));if(i){const t=tD.center.clone().sub(e.center),n=t.length();return{normal:t.normalize(),depth:n}}return!1}capsuleIntersect(e){nD.copy(e);const t=[];let n,i=!1;this.getCapsuleTriangles(nD,t);for(let e=0;e<t.length;e++)(n=this.triangleCapsuleIntersect(nD,t[e]))&&(i=!0,nD.translate(n.normal.multiplyScalar(n.depth)));if(i){const t=nD.getCenter(new p_).sub(e.getCenter(XF)),n=t.length();return{normal:t.normalize(),depth:n}}return!1}rayIntersect(e){if(0===e.direction.length())return;const t=[];let n,i,r=1e100;this.getRayTriangles(e,t);for(let o=0;o<t.length;o++){const a=e.intersectTriangle(t[o].a,t[o].b,t[o].c,!0,XF);if(a){const s=a.sub(e.origin).length();r>s&&(i=a.clone().add(e.origin),r=s,n=t[o])}}return r<1e100&&{distance:r,triangle:n,position:i}}fromGraphNode(e){return e.updateWorldMatrix(!0,!0),e.traverse((e=>{if(!0===e.isMesh){let t,n=!1;null!==e.geometry.index?(n=!0,t=e.geometry.toNonIndexed()):t=e.geometry;const i=t.getAttribute("position");for(let t=0;t<i.count;t+=3){const n=(new p_).fromBufferAttribute(i,t),r=(new p_).fromBufferAttribute(i,t+1),o=(new p_).fromBufferAttribute(i,t+2);n.applyMatrix4(e.matrixWorld),r.applyMatrix4(e.matrixWorld),o.applyMatrix4(e.matrixWorld),this.addTriangle(new bd(n,r,o))}n&&t.dispose()}})),this.build(),this}}const rD={id:gk,create:({config:{gravity:e=40}})=>{const t=new iD,n=new p_,i=new p_,r=new p_;let o=[];return{worldOctree:t,update:({isPaused:a,delta:s})=>{a||(o.forEach((n=>{n.collider.center.addScaledVector(n.velocity,s);const i=t.sphereIntersect(n.collider);i&&(n.isColliding=!0,n.velocity.addScaledVector(i.normal,1.5*-i.normal.dot(n.velocity)),n.collider.center.add(i.normal.multiplyScalar(i.depth)),n.collisionListeners.forEach((e=>e(i)))),n.velocity.y-=e*n.mass*s;const r=Math.exp(-1.5*s)-1;n.velocity.addScaledVector(n.velocity,r)})),(()=>{for(let e=0,t=o.length;e<t;e++){const a=o[e];for(let s=e+1;s<t;s++){const e=o[s],t=a.collider.center.distanceToSquared(e.collider.center),l=a.collider.radius+e.collider.radius;if(t<l*l){const o=n.subVectors(a.collider.center,e.collider.center).normalize(),s=i.copy(o).multiplyScalar(o.dot(a.velocity)),p=r.copy(o).multiplyScalar(o.dot(e.velocity));a.velocity.add(p).sub(s),e.velocity.add(s).sub(p);const u=(l-Math.sqrt(t))/2;a.collider.center.addScaledVector(o,u),e.collider.center.addScaledVector(o,-u)}}}})(),o.forEach((({mesh:e,collider:t})=>e.position.copy(t.center))))},createSphere:({id:e,radius:t,position:n,mesh:i,material:r,mass:a=1})=>{let s=i;if(!s){const e=new hx(t,5),n=r??new _x;s=new im(e,n),s.castShadow=!0,s.receiveShadow=!0}s.position.copy(n);const l=[],p={id:e??sy(),mass:a,mesh:s,collider:new A_(s.position.clone(n),t??globalRadius),velocity:new p_,collisionListeners:l,isColliding:!1,on:{collision:e=>l.push(e)}};return o.push(p),p},dispose:()=>{o=[]}}},config:{callLimit:Kx.CALL_30_PER_SECONDS,forceCallCount:!0}},oD={id:Sk,create:({world:e,config:{actionConfig:t,handlers:n}})=>{let i,r=!1;const o=({actionId:t,value:r})=>{(i&&!e.cycleData.isPaused||a[t].enableDuringPause)&&n.forEach((n=>n.actionId===t&&n.callback({target:i,value:r,world:e})))},a={};t.forEach((e=>{e.customTrigger&&e.customTrigger((t=>{o({actionId:e.actionId,value:t})})),a[e.actionId]={pressed:!1,value:0,...e}}));const s=(()=>{const e={},t=t=>{e[t.key.toLowerCase()]=!0,e[t.key]=!0},n=t=>{e[t.key.toLowerCase()]=!1,e[t.key]=!1};return document.body.addEventListener("keydown",t),document.body.addEventListener("keyup",n),{getState:t=>e[t],dispose:()=>{document.body.removeEventListener("keydown",t),document.body.removeEventListener("keyup",n)}}})(),l=(()=>{const e={},t=({deltaY:t})=>{e[sI]=t>0,e[aI]=t<0},n=t=>{switch(t.button){case 0:e[iI]=!0;break;case 1:e[rI]=!0;break;case 2:e[oI]=!0}},i=t=>{switch(t.button){case 0:e[iI]=!1;break;case 1:e[rI]=!1;break;case 2:e[oI]=!1}};return document.addEventListener("wheel",t),document.addEventListener("mousedown",n),document.addEventListener("mouseup",i),{getState:t=>e[t],dispose:()=>{document.removeEventListener("wheel",t),document.removeEventListener("mousedown",n),document.removeEventListener("mouseup",i)},reset:()=>{e[sI]=!1,e[aI]=!1}}})();return window.addEventListener("gamepadconnected",$k),window.addEventListener("gamepaddisconnected",Xk),{setTarget:e=>i=e,getTarget:()=>i,update:({isPaused:e})=>{r||(Jk||(()=>{const e=navigator.getGamepads?navigator.getGamepads():navigator.webkitGetGamepads?navigator.webkitGetGamepads():{};Object.keys(e).forEach((t=>{const n=e[t];n&&(qk[n.index]=n)}))})(),Object.keys(a).forEach((t=>{e&&!a[t].enableDuringPause||(a[t]=(({prevState:e,axis:t,actionId:n,axisValidator:i=(e=>0!=e),axisValueModifier:r=(e=>e)})=>{const a=t?Kk(t).value:0,p=!!t&&i(a),u=e.keys?.some((e=>s.getState(e)))||e.mouse?.some((e=>l.getState(e)))||e.gamepadButtons?.some((e=>Kk(e).pressed)),h=p?r(a):u?1:0,c={...e,pressed:u||p,value:h};return(e.listenForDeactivation&&c.pressed!=e.pressed||!e.listenForDeactivation&&c.pressed&&c.pressed!=e.pressed)&&o({actionId:n,value:h}),c})({prevState:a[t],actionId:t}))})),l.reset())},pause:()=>r=!0,resume:()=>r=!1,dispose:()=>{s.dispose(),l.dispose()}}},config:{}},aD={id:wk,create:({config:{debug:e}})=>{let t=[],n={};const i=(e,t)=>{n[e.id][t]?n[e.id][t].referenceCount++:n[e.id][t]={collider:t,referenceCount:1,hasCollision:!1,collisionListeners:[],enterListeners:[],leaveListeners:[]}},r=(e,t)=>{n[e.id][t]&&(n[e.id][t].referenceCount--,n[e.id][t].referenceCount<=0&&delete n[e.id][t])};return{createRegion:({id:o,area:a})=>{if(t.some((({id:e})=>o===e)))return void console.error(`Region is already exists with id: ${o}`);const s=new c_;if(a.updateMatrixWorld(!0),s.copy(a.geometry.boundingBox).applyMatrix4(a.matrixWorld),e){var l=new Xx(s);a.parent.add(l)}const p={id:o,area:a,box:s};return t.push(p),n[o]={},(e=>({on:{collision:(t,r)=>{i(e,t),n[e.id][t].collisionListeners.push({region:e,collider:t,callback:r})},enter:(t,r)=>{i(e,t),n[e.id][t].enterListeners.push({region:e,collider:t,callback:r})},leave:(t,r)=>{i(e,t),n[e.id][t].leaveListeners.push({region:e,collider:t,callback:r})}},off:{collision:(t,i)=>{n[e.id][t].collisionListeners=n[e.id][t].collisionListeners.filter((n=>n.region===e&&n.collider===t&&n.callback===i)),r(e,t)},enter:(t,i)=>{n[e.id][t].collisionListeners=n[e.id][t].collisionListeners.filter((n=>n.region===e&&n.collider===t&&n.callback===i)),r(e,t)},leave:(t,i)=>{n[e.id][t].collisionListeners=n[e.id][t].collisionListeners.filter((n=>n.region===e&&n.collider===t&&n.callback===i)),r(e,t)}}}))(p)},update:()=>{Object.entries(n).forEach((([e,i])=>{const r=t.find((({id:t})=>t===e));Object.values(i).forEach((({collider:t})=>{const i=n[e][t].hasCollision,o=r.box.intersectsBox(t);n[e][t].hasCollision=o,o&&n[e][t].collisionListeners.forEach((({callback:e})=>e({region:r,collider:t}))),!i&&o&&n[e][t].enterListeners.forEach((({callback:e})=>e({region:r,collider:t}))),i&&!o&&n[e][t].leaveListeners.forEach((({callback:e})=>e({region:r,collider:t})))}))}))},dispose:()=>{t=[],n={}}}},config:{debug:!1,callLimit:Kx.CALL_30_PER_SECONDS}},sD={id:Ck,create:({config:e})=>{let t,n,i,r,o,a,s,l,p,u=!1,h=new A_(new p_,e.cameraCollisionRadius);i=r=o=e.maxDistance;const c=new p_(e.positionOffset.x,e.positionOffset.y,e.positionOffset.z),_=new hm(70,window.innerWidth/window.innerHeight,.1,1e3),d=new p_,m=new X_,P=new hd,f=new p_(0,0,0),x=new p_(0,0,0),y=new p_(0,0,0),v=()=>{const n=Math.PI-d.x+(t?t.rotation.x:0),i=n+Math.PI/2;f.set(c.x*Math.sin(i)+c.z*Math.sin(n),0,c.z*Math.cos(n)+c.x*Math.cos(i)),x.copy(f).setLength(e.cameraCollisionRadius),a=f.length()},g=t=>{d.y=Math.max(e.yBoundaries.min,d.y),d.y=Math.min(e.yBoundaries.max,d.y),null!==t&&n.setFromAxisAngle(new p_(0,1,0),-d.x),v()};return{instance:_,setWorldOctree:e=>p=e,setTarget:e=>{t=e,t&&(n=t.quaternion.clone())},getTarget:()=>t,setTargetQuaternionOffset:e=>{s=e,l=l||new l_},jumpToTarget:()=>{t&&P.position.copy(t.position)},orientToTarget:()=>{t&&(d.x=-m.setFromQuaternion(n).y+e.initialRotation.x,d.y=e.initialRotation.y)},setMaxDistance:e=>i=e,setYBoundaries:({min:t,max:n})=>{e.yBoundaries.min=t||e.yBoundaries.min,e.yBoundaries.max=n||e.yBoundaries.max,d.y=Math.max(e.yBoundaries.min,d.y),d.y=Math.min(e.yBoundaries.max,d.y)},setPositionOffset:e=>{c.copy(e),v()},update:({isPaused:f,delta:v})=>{if((!e.stopDuringPause||!f)&&t){if(u){const i=l?l.copy(t.quaternion).multiply(s):t.quaternion;n.slerp(i,e.lerp.targetRotation*v),d.x=-m.setFromQuaternion(n).y,g(null)}const f=t.position.clone();if(f){const t=e.cameraCollisionRadius;f.y+=c.y;let s,l=!1,u=0;if(h.center.copy(f),p){s=p.sphereIntersect(h);let e=s;for(;u<a&&!s;)u+=t,e?h.center.sub(x):h.center.add(x),s=p.sphereIntersect(h),l=l||s;s&&(h.center.add(s.normal.multiplyScalar(s.depth)),u=f.distanceTo(h.center))}P.position.lerp(h.center,v*(l?e.lerp.position.collision:e.lerp.position.normal)),h.center.copy(P.position),P.lookAt((e=>{const t=Math.min(o,r),i=new p_(0,-t*Math.cos(d.y),-t*Math.sin(d.y));return i.applyQuaternion(n),i.add(e),i})(h.center.clone())),y.set(0,0,1),y.applyQuaternion(P.quaternion),y.setLength(t);let m=t;if(p){for(s=!1;m<i&&!s;)m+=t,h.center.add(y),s=p.sphereIntersect(h),l=l||s;s&&(h.center.add(s.normal.multiplyScalar(s.depth)),m=P.position.distanceTo(h.center)),o=Ic.lerp(o,m,Math.min(1,v*(l?e.lerp.distance.collision:e.lerp.distance.normal))),r=Math.max(l?m:o,i)}else o=Ic.lerp(o,i,Math.min(1,v*e.lerp.distance.normal)),r=Math.max(o,i);y.setLength(o),h.center.copy(P.position).add(y),_.position.copy(h.center),_.lookAt(P.position)}}},getRotation:()=>d,rotate:({x:e,y:n})=>{t&&(u||(d.x+=e??0),d.y+=n??0,g(e))},setRotation:({x:e,y:n})=>{t&&(u||(d.x=e??0),d.y=n??0,g(e))},getUseTargetRotation:()=>u,setUseTargetRotation:e=>u=e}},config:{callLimit:Kx.CALL_30_PER_SECONDS,forceCallCount:!0,stopDuringPause:!0,maxDistance:3,positionOffset:{x:0,y:0,z:0},yBoundaries:{min:0,max:Math.PI},cameraCollisionRadius:.2,initialRotation:{x:0,y:2},lerp:{position:{collision:20,normal:10},distance:{collision:20,normal:4},targetRotation:6}}},lD={id:Tk,create:({world:{getModule:e},unit:t,config:{}})=>{let n,i=0,r=0,o=0,a=0,s=!1;return{setForwardValue:e=>i=e,setBackwardValue:e=>r=e,setLeftValue:e=>o=e,setRightValue:e=>a=e,pause:()=>s=!0,resume:()=>s=!1,update:({isPaused:l,delta:p})=>{if(!n)return void(n=e(Ck));if(l||s)return;const u=n.getRotation(),h=Math.max(r,i)*(r>i?-1:1),c=Math.max(o,a)*(o>a?1:-1),_=t.getSpeed()*Math.max(i,r,o,a);if(0!==_||t.userData.useAim){let e=t.userData.useAim?u.x:u.x+Math.PI/2+Math.PI+(0===_&&t.userData.useAim?Math.PI/2:Math.atan2(h,c)),n=t.viewRotation;n<0&&(n+=2*Math.PI);let s=e-n;for(;Math.abs(s)>Math.PI;)e<n?(0===e?e=2*Math.PI:e+=2*Math.PI,e>=4*Math.PI&&(e-=4*Math.PI,n-=4*Math.PI)):n+=2*Math.PI,s=e-n;t.setRotation(t.viewRotation+s*(p/.1));let l=Math.abs(s);l-=l>Math.PI?Math.PI:0;let d,m=l>.9?0:(Math.PI-l)/Math.PI,P=2*Math.PI-e;if(t.userData.moveBack=r>0,t.userData.useAim){t.userData.isStrafing=o||a,t.userData.isStrafing&&(m*=.95);let e=0;o?e=i>0?Math.PI/4:r>0?Math.PI+-Math.PI/4:Math.PI/2:a?e=i>0?-Math.PI/4:r>0?Math.PI+Math.PI/4:-Math.PI/2:r&&(e=Math.PI),t.userData.strafingDirection=o?1:a?-1:0,d=new p_(Math.sin(P+e)*_*m*p,0,Math.cos(P+e)*_*m*p)}else t.userData.isStrafing=!1,d=new p_(Math.sin(P)*_*m*p,0,Math.cos(P)*_*m*p);(i||r||o||a)&&t.addVelocity(d)}}}},config:{callLimit:Kx.CALL_30_PER_SECONDS,forceCallCount:!0}},pD=new p_,uD=new p_,hD=new p_;class cD{constructor(e=new p_(0,0,0),t=new p_(0,1,0),n=1){this.start=e,this.end=t,this.radius=n}clone(){return new cD(this.start.clone(),this.end.clone(),this.radius)}set(e,t,n){this.start.copy(e),this.end.copy(t),this.radius=n}copy(e){this.start.copy(e.start),this.end.copy(e.end),this.radius=e.radius}getCenter(e){return e.copy(this.end).add(this.start).multiplyScalar(.5)}translate(e){this.start.add(e),this.end.add(e)}checkAABBAxis(e,t,n,i,r,o,a,s,l){return(r-e<l||r-n<l)&&(e-o<l||n-o<l)&&(a-t<l||a-i<l)&&(t-s<l||i-s<l)}intersectsBox(e){return this.checkAABBAxis(this.start.x,this.start.y,this.end.x,this.end.y,e.min.x,e.max.x,e.min.y,e.max.y,this.radius)&&this.checkAABBAxis(this.start.x,this.start.z,this.end.x,this.end.z,e.min.x,e.max.x,e.min.z,e.max.z,this.radius)&&this.checkAABBAxis(this.start.y,this.start.z,this.end.y,this.end.z,e.min.y,e.max.y,e.min.z,e.max.z,this.radius)}lineLineMinimumPoints(e,t){const n=pD.copy(e.end).sub(e.start),i=uD.copy(t.end).sub(t.start),r=hD.copy(t.start).sub(e.start),o=n.dot(i),a=n.dot(n),s=i.dot(i),l=i.dot(r),p=n.dot(r);let u,h;const c=a*s-o*o;if(Math.abs(c)<1e-10){const e=-l/s,t=(o-l)/s;Math.abs(e-.5)<Math.abs(t-.5)?(u=0,h=e):(u=1,h=t)}else u=(l*o+p*s)/c,h=(u*o-l)/s;return h=Math.max(0,Math.min(1,h)),u=Math.max(0,Math.min(1,u)),[n.multiplyScalar(u).add(e.start),i.multiplyScalar(h).add(t.start)]}}let _D,dD;const mD=[{socketId:kk,modelChildIdList:["Spine_01"]},{socketId:"HEAD",modelChildIdList:["Head"]},{socketId:"LEFT_SHOULDER",modelChildIdList:["Shoulder_L"]},{socketId:Ik,modelChildIdList:["Elbow_L"]},{socketId:Ok,modelChildIdList:["Hand_L"]},{socketId:"RIGHT_SHOULDER",modelChildIdList:["Shoulder_R"]},{socketId:"RIGHT_ELBOW",modelChildIdList:["Elbow_R"]},{socketId:Rk,modelChildIdList:["Hand_R"]}],PD=({world:e,id:t,position:n,rotation:i,onComplete:r,getWorldModule:o,config:a})=>{const s=sy(),l=ly(a.modules);let p=null;const u={},h=[],c={},_=new c_(new p_(-a.radius,0,-a.radius),new p_(a.radius,a.height,a.radius));let d,m=0;const P=Bh(a.model.fbx.id),f=a.model.fbx.childIndex?P.children[a.model.fbx.childIndex]:P;f.scale.copy(a.model.scale),n&&f.position.copy(n);const x=Object.keys(a.animations).length?new Wx(f):null;Object.keys(a.animations).forEach((e=>(e=>{const t=(e=>Th[e])(a.animations[e]);if(!t)return;const n=x.clipAction(t);h[e]=n})(e)));const y=mD.reduce(((e,t)=>(e.some((({socketId:e})=>e===t.socketId))||e.push(t),e)),a.sockets.reduce(((e,t)=>{const n=mD.find((({socketId:e})=>e===t.socketId));return n?e.push({...n,...t}):e.push(t),e}),[])),v=[];if(f.traverse((e=>{y.forEach((t=>{!v[e.name]&&t.modelChildIdList?.includes(e.name)&&(t.selectedModelChildId=e.name,v[e.name]=e)})),a.model?.traverseCallback?.(e)})),y.forEach((({socketId:e,position:t,selectedModelChildId:n})=>{const i=new hd;t&&i.position.copy(t),u[e]=i,(v[n]||f).add(i),a.model.debug.showSockets&&((e,t)=>{const n=1/t;_D=_D||new cx(.02*n,8,8),dD=dD||new Zd({color:16711680});const i=new im(_D,dD);i.add(new Yx(.25*n)),e.add(i)})(i,a.model.scale.x)})),r){const P={id:t,instanceId:s,velocity:new p_,playerDirection:new p_,collider:new cD(n||new p_(0,a.radius,0),n||new p_(0,a.height,0),a.radius),onGround:!0,inAirTime:0,isJumpTriggered:0,box:_},y=()=>{p||(p=o(gk).worldOctree);const e=p.capsuleIntersect(P.collider);P.onGround=!1,e&&(P.onGround=e.normal.y>0,P.onGround||P.velocity.addScaledVector(e.normal,-e.normal.dot(P.velocity)),P.collider.translate(e.normal.multiplyScalar(e.depth)))},v=e=>{P.onGround?(m=0,P.inAirTime=0,P.isJumpTriggered=!1):0===m?m=e:P.inAirTime=e-m},g=(e,t)=>{const{now:n,isPaused:i}=t;if(!i){const t=40;let i=Math.exp(-8*e)-1;P.onGround||(P.velocity.y-=t*e,i*=.1);const r=3;P.velocity.addScaledVector(P.velocity.clone(),i);const o=P.velocity.clone().multiplyScalar(e).clone().divideScalar(r);for(let e=0;e<r;e++)P.collider.translate(o),y();v(n),P.collider.getCenter(f.position),f.position.y-=a.height/2+a.radius/2}_.min.set(-a.radius+f.position.x,0+f.position.y,-a.radius+f.position.z),_.max.set(a.radius+f.position.x,a.height+f.position.y,a.radius+f.position.z),l.update(t)},b=e=>{P.viewRotation=e,f.rotation.y=Math.PI-P.viewRotation+Math.PI},z=e=>{const{id:t,socketId:n,object:i}=e;u[n].add(i),i.visible=!1,c[t]={object:i,...e}},w=()=>Object.values(c).forEach((({object:e})=>e.visible=!1));i&&b(i.z);const Z=()=>{Object.values(c).forEach((({object:e})=>Ah(e))),Ah(f),l.dispose()};Object.assign(P,{getModule:l.getModule,addModule:l.addModule,addModules:e=>e.forEach(l.addModule),model:f,config:a,mixer:x,isDead:!1,hasAnimation:!0,activeAnimation:"",animations:h,getSpeed:()=>a.speedModifier?.(P,a.speed)??a.speed,shimmyVelocity:0,strafingDirection:0,viewRotation:0,targetRotation:0,getForwardVector:()=>(f.getWorldDirection(playerDirection),playerDirection.y=0,playerDirection.normalize(),playerDirection),getSideVector:()=>(f.getWorldDirection(playerDirection),playerDirection.y=0,playerDirection.normalize(),playerDirection.cross(f.up),playerDirection),addVelocity:e=>P.velocity.add(e),jump:()=>{P.velocity.y=a.jumpForce,P.isJumpTriggered=!0},teleportTo:e=>P.collider.translate(e.clone().sub(f.position)),setRotation:b,update:g,getSocket:e=>u[e],registerObjectIntoSocket:z,getRegisteredObject:e=>c[e],getAllRegisteredObjects:()=>Object.values(c),hideAllRegisteredObjects:w,registerTools:e=>{e.forEach((e=>{z(e)}))},chooseTool:e=>{d=e,w(),c[d]&&(c[d].object.visible=!0)},getSelectedTool:()=>c[d],updateAimPosition:e=>aimPosition.copy(e),userData:{},dispose:Z}),l.init({world:e,unit:P}),r(P)}},fD={id:Mk,create:({world:e,config:{}})=>{let t=[];return{update:({delta:n})=>{const i=e.cycleData;t.forEach((e=>{i.isPaused||(({delta:e,unit:t})=>{if(t.mixer){const n={...t,cache:t.config.animationConfig.createCache(t)},i=t.config.animationConfig.rules.find((({condition:e})=>e(n)));(({unit:e,animation:t,transitionTime:n=.2,loop:i=!0})=>{t!==e.activeAnimation&&(e.activeAnimation=t,e.lastAction=e.activeAction,e.activeAction=e.animations[t],e.lastAction&&e.lastAction.fadeOut(n),e.activeAction.reset(),e.activeAction.fadeIn(n),i||(e.activeAction.setLoop(2200),e.activeAction.clampWhenFinished=!0),e.activeAction.play())})({...i,unit:t}),t.mixer.update(e)}})({delta:n,unit:e}),e.update(n,i)}))},dispose:()=>{t.forEach((e=>e.dispose())),t=[]},createUnit:({id:n,config:i,position:r,rotation:o})=>{PD({world:e,id:n,position:"function"==typeof r?r(e):r,rotation:"function"==typeof o?o(e):o,config:i,getWorldModule:e.getModule,onComplete:n=>{e.scene.add(n.model),t.push(n)}})},getUnits:()=>t,getUnit:e=>"function"==typeof e?t.find(e):t.find((({id:t})=>t===e))}},config:{debug:!1,callLimit:Kx.CALL_30_PER_SECONDS,forceCallCount:!0}},xD=ey(yy(),{assetsConfig:WV,renderer:{pixelRatio:window.devicePixelRatio>1.4?1.4:1},fog:new ob(8965358,0,100),entities:()=>{const e=new _b(16777215,.8);e.position.set(0,15,25),e.castShadow=!0;const t=100;return e.shadow.mapSize.width=2048,e.shadow.mapSize.height=2048,e.shadow.radius=1,e.shadow.bias=-6e-5,e.shadow.camera.top=t,e.shadow.camera.bottom=-t,e.shadow.camera.left=-t,e.shadow.camera.right=t,e.shadow.camera.near=.1,e.shadow.camera.far=500,[new lb(4491451,8772,.5),e]},modules:[fD,ey(sD,{callLimit:Kx.NO_LIMIT,config:{yBoundaries:{min:1.2,max:2.7},maxDistance:dI[0]}}),rD,{...aD,config:{debug:!1}},HF,{...oD,config:mI}],skybox:{textures:[wV,ZV,EV,MV,SV,CV]},staticModels:[{id:"level-graphic",modelId:GV},{id:"level-collision",modelId:UV}],onProgress:e=>{document.documentElement.style.setProperty("--preloader-progress-ratio",100*e+"%")},onLoaded:e=>{const{on:t,getModule:n,getStaticModel:i}=e;Be.world=e,t.pause((()=>IF.globalTimeline.pause())),t.resume((()=>IF.globalTimeline.resume()));const{createUnit:r,getUnit:o}=n(Mk);r({id:"unit-01",config:Wk[Gk]}),Be.playersUnit=o("unit-01");const a=i("level-collision").scene;a.visible=!1;const s=n(gk).worldOctree;s.fromGraphNode(a);const l=i("level-graphic").scene,p=n(Ck);e.setCamera(p.instance),e.userData.tpsCamera=p,p.setWorldOctree(s);const u={color:65280},h=(t,i)=>{i.visible=!1;const r=Be.playersUnit;var o,a;n(Sk).setTarget(r),r.addModules([lD]),o=r.model,a=t.color,o.traverse((e=>{e.isMesh&&e.visible&&e.material&&(e.material=e.material.clone(),e.material.color=new Wy(a))})),r.teleportTo(i.position),r.setRotation(i.rotation.y),p.setTarget(r.model),p.setPositionOffset(new ev(0,1.6,0)),p.setRotation({x:i.rotation.y,y:2}),e.getModule(zk).addCollector(r)};l.traverse((e=>{e.isMesh&&(e.material.map&&(e.material.map.anisotropy=4),"spawn-01"===e.name&&h(u,e),e.name.includes("collectible")&&(ze.update((e=>e+1)),((e,t)=>{const n=Be.world.getModule(zk),{model:i}=n.addCollectible({...e,collisionObject:t});1===e.type&&i.children[0].scale.set(.012,.009,.012),IF.to(i.rotation,{y:2*Math.PI,ease:"linear",duration:3,repeat:-1})})(OF.collectible,e)),["portal-01","portal-02","portal-03","spawn-01","spawn-02","spawn-03","bottom"].includes(e.name)&&(e=>{e.visible=!1;const t=Be.world.getModule(wk),{name:n}=e;if(n.includes("spawn"))GF[n]=e;else{const i=t.createRegion({id:n,area:e});n.includes("bottom")?i.on.enter(Be.playersUnit.box,(()=>{Be.playersUnit.teleportTo(GF[DF].position),Be.playersUnit.setRotation(Math.PI-GF[DF].rotation.y),jF(Be.playersUnit),Be.world.userData.tpsCamera.setRotation({x:Math.PI-GF[DF].rotation.y,y:2});const e=GF[DF],t=bT(fz[sz],Be.cycleData.now);t.instance.position.copy(e.position),t.instance.position.y-=.2,Be.world.scene.add(t.instance),IF.delayedCall(2,t.dispose)})):n.includes("portal")&&(UF[n]=e,IF.delayedCall(1,(()=>{const t=bT(fz[az],Be.cycleData.now).instance;t.position.copy(e.position),t.position.y-=.2,Be.world.scene.add(t)})),i.on.enter(Be.playersUnit.box,(()=>{const e=Be.playersUnit.getModule(Tk);e.pause(),jF(Be.playersUnit),Be.isControlDisabled=!0;const t=UF[n];Be.playersUnit.teleportTo(t.position);const i=bT(fz[sz],Be.cycleData.now);i.instance.position.copy(t.position),i.instance.position.y-=.2,Be.world.scene.add(i.instance),IF.delayedCall(1,(()=>{Be.playersUnit.model.visible=!1})),IF.delayedCall(2,(()=>{i.dispose();const t=FF[n];DF=t;const r=GF[t];Be.playersUnit.model.visible=!0,Be.playersUnit.teleportTo(r.position),Be.playersUnit.setRotation(Math.PI-r.rotation.y),Be.world.userData.tpsCamera.setRotation({x:Math.PI-r.rotation.y,y:2}),e.resume();const o=bT(fz[sz],Be.cycleData.now);o.instance.position.copy(r.position),o.instance.position.y-=.2,Be.world.scene.add(o.instance),IF.delayedCall(2,o.dispose)}))})))}})(e))}))}}),yD="SKYBOX_1",vD="SKYBOX_2",gD="SKYBOX_3",bD="SKYBOX_4",zD="SKYBOX_5",wD="SKYBOX_6",ZD="CAR_1",ED="LEVEL",MD="COINS",SD="CAR_1",CD="CAR_WHEEL",ND="COIN",AD={textures:[{id:yD,url:"./assets/textures/skybox/left.webp"},{id:vD,url:"./assets/textures/skybox/right.webp"},{id:gD,url:"./assets/textures/skybox/up.webp"},{id:bD,url:"./assets/textures/skybox/down.webp"},{id:zD,url:"./assets/textures/skybox/front.webp"},{id:wD,url:"./assets/textures/skybox/back.webp"},{id:"POINT",url:"./assets/textures/effects/point.webp"},{id:ZD,url:"./assets/textures/car_03_m1.png"}],fbxModels:[],gltfModels:[{id:ED,url:"./assets/models/world/monster-truck-level.glb"},{id:MD,url:"./assets/models/world/monster-truck-coins.glb"},{id:SD,url:"./assets/models/vehicles/monster-truck-car.glb",material:{materialType:ab,texture:{id:ZD}}},{id:CD,url:"./assets/models/vehicles/monster-truck-car-wheel.glb",material:{materialType:ab,texture:{id:ZD}}},{id:ND,url:"./assets/models/collectibles/sm-polygon-prototype-icon-coin-01.glb",material:{color:16652161}}],audio:[{id:"GAME_BACKGROUND",url:"./assets/audio/music/game-theme.ogg"}]},LD="CHANGE_CAMERA_DISTANCE";let BD=0;const TD=[{maxCameraDistance:25,rotation:{x:-Math.PI,y:Math.PI-Math.PI/3},positionOffset:{x:0,y:0,z:0}},{maxCameraDistance:45,rotation:{x:-Math.PI,y:Math.PI-Math.PI/4},positionOffset:{x:0,y:0,z:0}},{maxCameraDistance:15,rotation:{x:Math.PI+Math.PI/4,y:Math.PI-Math.PI/3},positionOffset:{x:0,y:0,z:0}}],VD=e=>{e.userData.tpsCamera&&(e.userData.tpsCamera.setUseTargetRotation(TD[BD].useTargetRotation),e.userData.tpsCamera.setMaxDistance(TD[BD].maxCameraDistance),e.userData.tpsCamera.setRotation(TD[BD].rotation),e.userData.tpsCamera.setPositionOffset(TD[BD].positionOffset))},kD={actionConfig:[...tI.actionConfig,{actionId:eI.FORWARD,listenForDeactivation:!0,keys:[Qk.W,Qk.ARROW_UP],gamepadButtons:[Yk.Up],axis:Yk.LeftAxisY,axisValidator:e=>e<-.1,axisValueModifier:e=>-1*e},{actionId:eI.BACKWARD,listenForDeactivation:!0,keys:[Qk.S,Qk.ARROW_DOWN],gamepadButtons:[Yk.Down],axis:Yk.LeftAxisY,axisValidator:e=>e>.1},{actionId:eI.LEFT,listenForDeactivation:!0,keys:[Qk.A,Qk.ARROW_LEFT],gamepadButtons:[Yk.Left],axis:Yk.LeftAxisX,axisValidator:e=>e<-.1,axisValueModifier:e=>-1*e},{actionId:eI.RIGHT,listenForDeactivation:!0,keys:[Qk.D,Qk.ARROW_RIGHT],gamepadButtons:[Yk.Right],axis:Yk.LeftAxisX,axisValidator:e=>e>.1},{actionId:LD,keys:[Qk.C]}],handlers:[...tI.handlers,{actionId:eI.FORWARD,callback:({value:e,target:t})=>{t.control.accelerate(e)}},{actionId:eI.BACKWARD,callback:({value:e,target:t})=>{t.control.reverse(e)}},{actionId:eI.LEFT,callback:({value:e,target:t})=>{t.control.leanBack(e)}},{actionId:eI.RIGHT,callback:({value:e,target:t})=>{t.control.leanForward(e)}},{actionId:LD,callback:({world:e})=>{BD++,BD===TD.length&&(BD=0),VD(e)}}]},ID={collectible:{type:0,reactivationTime:-1,initialActivationDelay:0,interactionRadius:.5,isUserInteractionNeeded:!1,collisionAlgorithm:({collector:e,collectible:t})=>t.model.position.distanceTo(e.wheels.frontA.model.position)<3||t.model.position.distanceTo(e.wheels.rearA.model.position)<3,model:{gltf:{id:ND},scale:new ev(.035,.035,.035)},on:{collect:({collectible:{model:e}})=>{const t=bT(fz[oz],Be.cycleData.now);t.instance.position.copy(e.position),Be.world.scene.add(t.instance),IF.delayedCall(1,t.dispose),we.update((e=>e+1))}}}},OD=ty({filter:{group:2,mask:1},body:{model:{},width:110,height:25,depth:3.8,hitAreaHeight:5},wheels:{joinDamping:.2,joinHertz:3.5,front:{model:{},offset:{x:39,y:32},radius:20},rear:{model:{},offset:{x:-39,y:32},radius:20}},pixelRatio:17,accelerationForward:25,accelerationBackward:15,leaningForward:700,leaningBack:700},{body:{model:{gltf:{id:SD}}},wheels:{front:{model:{gltf:{id:CD}}},rear:{model:{gltf:{id:CD}}}},on:{trick:e=>{Le.update((t=>t.concat([e])))}}}),RD=({position:e,space:t,filter:n,radius:i,offset:r})=>{const o=new nape.phys.Body;return o.get_shapes().add(new nape.shape.Circle(i,null,new nape.phys.Material(.1,5,5,1.5,20))),o.setShapeFilters(n),o.get_position().set_x(e.x+r.x),o.get_position().set_y(e.y+r.y),o.set_space(t),o.set_mass(1),o},HD={id:Ak,create:({world:{scene:e,getModule:t},config:{debug:n}})=>{let i,r=[];return{createCar:({id:n,position:o=new p_,config:a})=>{const{space:s}=t(Nk);i||(i=new nape.dynamics.InteractionFilter,i.set_collisionGroup(a.filter.group),i.set_collisionMask(a.filter.mask));const l=RD({space:s,position:o,filter:i,...a.wheels.front}),p=RD({space:s,position:o,filter:i,...a.wheels.rear}),u=[new nape.geom.Vec2(-a.body.width/2,-a.body.height/2),new nape.geom.Vec2(-a.body.width/4,-a.body.height),new nape.geom.Vec2(a.body.width/4,-a.body.height),new nape.geom.Vec2(a.body.width/2,-a.body.height/2),new nape.geom.Vec2(a.body.width/2,a.body.height/2),new nape.geom.Vec2(-a.body.width/2,a.body.height/2)],h=new nape.phys.Body;h.get_shapes().add(new nape.shape.Polygon(u)),h.setShapeFilters(i),h.get_position().set_x(o.x),h.get_position().set_y(o.y),h.set_space(s),h.set_mass(1);var c=[new nape.geom.Vec2(-a.body.width/2+2,-a.body.height/2-2),new nape.geom.Vec2(-a.body.width/4,-a.body.height-2),new nape.geom.Vec2(a.body.width/4,-a.body.height-2),new nape.geom.Vec2(a.body.width/2-2,-a.body.height/2-2),new nape.geom.Vec2(a.body.width/2-2,a.body.height/2-2),new nape.geom.Vec2(-a.body.width/2+2,a.body.height/2-2)];const _=new nape.phys.Body;_.get_shapes().add(new nape.shape.Polygon(c)),_.setShapeFilters(i),_.set_space(s),_.set_mass(1);const d=new nape.geom.Vec2(0,0);new nape.constraint.WeldJoint(h,_,h.get_localCOM(),d).set_space(s);const m=new nape.geom.Vec2(a.wheels.rear.offset.x,a.wheels.rear.offset.y),P=new nape.constraint.PivotJoint(p,h,p.get_localCOM(),m);P.set_stiff(!1),P.set_damping(a.wheels.joinDamping),P.set_frequency(a.wheels.joinHertz),P.set_space(s);const f=new nape.geom.Vec2(a.wheels.front.offset.x,a.wheels.front.offset.y),x=new nape.constraint.PivotJoint(l,h,l.get_localCOM(),f);x.set_stiff(!1),x.set_damping(a.wheels.joinDamping),x.set_frequency(a.wheels.joinHertz),x.set_space(s);const y=a.wheels.front.offset.x+Math.abs(a.wheels.rear.offset.x);new nape.constraint.DistanceJoint(l,p,l.get_localCOM(),p.get_localCOM(),y,y).set_space(s);const v={id:n||sy(),userData:{},config:a,isAccelerating:!1,isReversing:!1,isLeaningBack:!1,isLeaningForward:!1,collider:new cD(new p_,new p_,a.body.height),body:{model:RF(a.body.model),physics:h,hitArea:_,onGround:!1},wheels:{frontA:{model:RF(a.wheels.front.model),physics:l,onAir:!0},frontB:{model:RF(a.wheels.front.model)},rearA:{model:RF(a.wheels.rear.model),physics:p,onAir:!0},rearB:{model:RF(a.wheels.rear.model)}}};return v.wheels.frontA.model.position.set(0,0,a.body.depth/2),v.wheels.frontB.model.position.set(0,0,-a.body.depth/2),v.wheels.rearA.model.position.set(0,0,a.body.depth/2),v.wheels.rearB.model.position.set(0,0,-a.body.depth/2),[v.body.model,v.wheels.frontA.model,v.wheels.frontB.model,v.wheels.rearA.model,v.wheels.rearB.model].forEach((t=>{e.add(t)})),v.trickCalculator=((e,t)=>{const n={isOnWheelie:!1,isBackWheelie:!1,isOnAir:!1,onWheelieStartGameTime:0,onAirStartGameTime:0,jumpAngle:0,lastAngleOnGround:0};return{update:i=>{(i=>{if(e.body.onGround)return n.isOnAir=!1,n.jumpAngle=0,void(n.lastAngleOnGround=0);if(e.wheels.rearA.onAir&&e.wheels.frontA.onAir){let t=Math.atan2(e.wheels.rearA.model.position.y-e.wheels.frontA.model.position.y,e.wheels.rearA.model.position.x-e.wheels.frontA.model.position.x);for(t=e.wheels.rearA.model.position.x-e.wheels.frontA.model.position.x<0?2*Math.PI+t:t;t>2*Math.PI;)t-=2*Math.PI;n.isOnAir||(n.onAirStartGameTime=i,n.isOnAir=!0,n.jumpAngle=0,n.lastAngleOnGround=t);let r=t-n.lastAngleOnGround;r<-Math.PI?(r+=2*Math.PI,r*=-1):r>Math.PI&&(r-=2*Math.PI,r*=-1),n.lastAngleOnGround=t,n.jumpAngle+=r}else if(n.isOnAir){const e=n.jumpAngle*(180/Math.PI);n.isOnAir=!1,n.jumpAngle=0,n.lastAngleOnGround=0,(e>200||e<-200)&&t({type:UT,isBackFlip:e>0,count:Math.floor(Math.abs(e/200))})}})(i),(i=>{const r=e.wheels.frontA.onAir&&!e.wheels.rearA.onAir||!e.wheels.frontA.onAir&&e.wheels.rearA.onAir;!r&&n.isOnWheelie&&i-n.onWheelieStartGameTime>1e3&&t({type:"WHEELIE",isBackWheelie:n.isBackWheelie,duration:i-n.onWheelieStartGameTime}),r&&!n.isOnWheelie&&(n.onWheelieStartGameTime=i,n.isBackWheelie=!e.wheels.rearA.onAir),n.isOnWheelie=r})(i)},reset:()=>{n.isOnWheelie=!1,n.isBackWheelie=!1,n.isOnAir=!1,n.onWheelieStartGameTime=0,n.onAirStartGameTime=0,n.jumpAngle=0,n.lastAngleOnGround=0}}})(v,(e=>a.on.trick?.(e))),r.push(v),v},update:({elapsed:e,isPaused:t})=>{t||r.forEach((t=>{t.isAccelerating&&!t.isReversing?(t.wheels.rearA.physics.set_angularVel(Math.max(t.config.accelerationForward,t.wheels.rearA.physics.get_angularVel())),t.wheels.frontA.physics.set_angularVel(Math.max(t.config.accelerationForward,t.wheels.frontA.physics.get_angularVel()))):!t.isAccelerating&&t.isReversing&&(t.wheels.rearA.physics.set_angularVel(Math.min(-t.config.accelerationBackward,t.wheels.rearA.physics.get_angularVel())),t.wheels.frontA.physics.set_angularVel(Math.min(-t.config.accelerationBackward,t.wheels.frontA.physics.get_angularVel()))),t.isLeaningBack&&t.body.physics.applyAngularImpulse(-t.config.leaningBack),t.isLeaningForward&&t.body.physics.applyAngularImpulse(t.config.leaningForward),t.body.model.position.set(t.body.physics.get_position().get_x()/t.config.pixelRatio,-t.body.physics.get_position().get_y()/t.config.pixelRatio,0),t.body.model.rotation.z=-t.body.physics.get_rotation(),t.wheels.frontA.model.position.set(t.wheels.frontA.physics.get_position().get_x()/t.config.pixelRatio,-t.wheels.frontA.physics.get_position().get_y()/t.config.pixelRatio,t.wheels.frontA.model.position.z),t.wheels.frontB.model.position.set(t.wheels.frontA.model.position.x,t.wheels.frontA.model.position.y,t.wheels.frontB.model.position.z),t.wheels.frontA.model.rotation.z=t.wheels.frontB.model.rotation.z=-t.wheels.frontA.physics.get_rotation(),t.wheels.rearA.model.position.set(t.wheels.rearA.physics.get_position().get_x()/t.config.pixelRatio,-t.wheels.rearA.physics.get_position().get_y()/t.config.pixelRatio,t.wheels.rearA.model.position.z),t.wheels.rearB.model.position.set(t.wheels.rearA.model.position.x,t.wheels.rearA.model.position.y,t.wheels.rearB.model.position.z),t.wheels.rearA.model.rotation.z=t.wheels.rearB.model.rotation.z=-t.wheels.rearA.physics.get_rotation();const n=t.wheels.rearA.physics.interactingBodies();for(t.wheels.rearA.onAir=!0;!n.empty();)if((o=n.pop())!=t.body.physics){t.wheels.rearA.onAir=!1;break}const i=t.wheels.frontA.physics.interactingBodies();for(t.wheels.frontA.onAir=!0;!i.empty();)if((o=i.pop())!=t.body.physics){t.wheels.frontA.onAir=!1;break}const r=t.body.hitArea.interactingBodies(nape.callbacks.InteractionType.COLLISION,1);for(t.body.onGround=!1;!r.empty();){var o;if((o=r.pop())!=t.body.physics&&o!=t.wheels.rearA.physics&&o!=t.wheels.frontA.physics){t.body.onGround=!0;break}}t.collider.set(t.wheels.rearA.model.position,t.wheels.frontA.model.position,t.config.body.height),t.trickCalculator.update(e)}))},dispose:()=>{r.forEach((e=>Ah(e))),r=[]}}},config:{debug:!1,callLimit:Kx.CALL_60_PER_SECONDS,forceCallCount:!0}},FD=()=>{window.define=function(e){window.nape=e()},define((function(){var e,t,n,i,r,o,a,s,l=l||{};function p(e,t){var n=function(){return n.method.apply(n.scope,arguments)};return n.scope=e,n.method=t,n}for(var u in(r=l.Reflect=function(){}).__name__=["Reflect"],r.field=function(e,t){try{return e[t]}catch(e){return e instanceof n._Boot.HaxeError&&e.val,null}},r.fields=function(e){var t=[];if(null!=e){var n=Object.prototype.hasOwnProperty;for(var i in e)"__id__"!=i&&"hx__closures__"!=i&&n.call(e,i)&&t.push(i)}return t},r.copy=function(e){if(null==e)return null;for(var t={},n=0,i=r.fields(e);n<i.length;){var o=i[n];++n,t[o]=r.field(e,o)}return t},r.prototype.__class__=r,(i=l.Std=function(){}).__name__=["Std"],i.string=function(e){return n.Boot.__string_rec(e,"")},i.prototype.__class__=i,(o=l.StringTools=function(){}).__name__=["StringTools"],o.hex=function(e,t){for(var n="";n="0123456789ABCDEF".charAt(15&e)+n,(e>>>=4)>0;);if(null!=t)for(;n.length<t;)n="0"+n;return n},o.prototype.__class__=o,void 0===n&&(n={}),n._Boot||(n._Boot={}),n._Boot.HaxeError=l["js._Boot.HaxeError"]=function(e){Error.call(this),this.val=e,Error.captureStackTrace&&Error.captureStackTrace(this,n._Boot.HaxeError)},n._Boot.HaxeError.__name__=["js","_Boot","HaxeError"],n._Boot.HaxeError.__super__=Error,Error.prototype)n._Boot.HaxeError.prototype[u]=Error.prototype[u];for(var u in n._Boot.HaxeError.prototype.val=null,n._Boot.HaxeError.prototype.__class__=n._Boot.HaxeError,n.Boot=l["js.Boot"]=function(){},n.Boot.__name__=["js","Boot"],n.Boot.__string_rec=function(e,t){if(null==e)return"null";if(t.length>=5)return"<...>";var i=typeof e;switch("function"==i&&(e.__name__||e.__ename__)&&(i="object"),i){case"function":return"<function>";case"object":if(e instanceof Array){var r="[";t+="\t";for(var o=0,a=e.length;o<a;){var s=o++;r+=(s>0?",":"")+n.Boot.__string_rec(e[s],t)}return r+"]"}var l;try{l=e.toString}catch(e){return e instanceof n._Boot.HaxeError&&e.val,"???"}if(null!=l&&l!=Object.toString&&"function"==typeof l){var p=e.toString();if("[object Object]"!=p)return p}var u="{\n";t+="\t";var h=null!=e.hasOwnProperty,c=null;for(c in e)h&&!e.hasOwnProperty(c)||"prototype"!=c&&"__class__"!=c&&"__super__"!=c&&"__interfaces__"!=c&&"__properties__"!=c&&(2!=u.length&&(u+=", \n"),u+=t+c+" : "+n.Boot.__string_rec(e[c],t));return u+"\n"+(t=t.substring(1))+"}";case"string":return e;default:return String(e)}},n.Boot.__toStr=null,n.Boot.prototype.__class__=n.Boot,void 0===e&&(e={}),e.Config=l["nape.Config"]=function(){},e.Config.__name__=["nape","Config"],e.Config.prototype.__class__=e.Config,e.callbacks||(e.callbacks={}),e.callbacks.Callback=l["nape.callbacks.Callback"]=function(){if(this.zpp_inner=null,!t.callbacks.ZPP_Callback.internal)throw new n._Boot.HaxeError("Error: Callback cannot be instantiated derp!")},e.callbacks.Callback.__name__=["nape","callbacks","Callback"],e.callbacks.Callback.prototype.zpp_inner=null,Object.defineProperty(e.callbacks.Callback.prototype,"event",{get:e.callbacks.Callback.prototype.get_event}),e.callbacks.Callback.prototype.get_event=function(){return t.callbacks.ZPP_Listener.events[this.zpp_inner.event]},Object.defineProperty(e.callbacks.Callback.prototype,"listener",{get:e.callbacks.Callback.prototype.get_listener}),e.callbacks.Callback.prototype.get_listener=function(){return this.zpp_inner.listener.outer},e.callbacks.Callback.prototype.toString=function(){return""},e.callbacks.Callback.prototype.__class__=e.callbacks.Callback,e.callbacks.BodyCallback=l["nape.callbacks.BodyCallback"]=function(){e.callbacks.Callback.call(this)},e.callbacks.BodyCallback.__name__=["nape","callbacks","BodyCallback"],e.callbacks.BodyCallback.__super__=e.callbacks.Callback,e.callbacks.Callback.prototype)e.callbacks.BodyCallback.prototype[u]=e.callbacks.Callback.prototype[u];for(var u in Object.defineProperty(e.callbacks.BodyCallback.prototype,"body",{get:e.callbacks.BodyCallback.prototype.get_body}),e.callbacks.BodyCallback.prototype.get_body=function(){return this.zpp_inner.body.outer},e.callbacks.BodyCallback.prototype.toString=function(){var e="Cb:";return e+=["WAKE","SLEEP"][this.zpp_inner.event-2],(e+=":"+this.zpp_inner.body.outer.toString())+" : listener: "+i.string(this.zpp_inner.listener.outer)},e.callbacks.BodyCallback.prototype.__class__=e.callbacks.BodyCallback,e.callbacks.Listener=l["nape.callbacks.Listener"]=function(){if(this.zpp_inner=null,!t.callbacks.ZPP_Listener.internal)throw new n._Boot.HaxeError("Error: Cannot instantiate Listener derp!")},e.callbacks.Listener.__name__=["nape","callbacks","Listener"],e.callbacks.Listener.prototype.zpp_inner=null,Object.defineProperty(e.callbacks.Listener.prototype,"type",{get:e.callbacks.Listener.prototype.get_type}),e.callbacks.Listener.prototype.get_type=function(){return t.callbacks.ZPP_Listener.types[this.zpp_inner.type]},Object.defineProperty(e.callbacks.Listener.prototype,"event",{get:e.callbacks.Listener.prototype.get_event,set:e.callbacks.Listener.prototype.set_event}),e.callbacks.Listener.prototype.get_event=function(){return t.callbacks.ZPP_Listener.events[this.zpp_inner.event]},e.callbacks.Listener.prototype.set_event=function(i){if(null==i)throw new n._Boot.HaxeError("Error: Cannot set listener event type to null");var r;return t.callbacks.ZPP_Listener.events[this.zpp_inner.event]!=i&&(null==t.util.ZPP_Flags.CbEvent_BEGIN&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.CbEvent_BEGIN=new e.callbacks.CbEvent,t.util.ZPP_Flags.internal=!1),i==t.util.ZPP_Flags.CbEvent_BEGIN?r=0:(null==t.util.ZPP_Flags.CbEvent_ONGOING&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.CbEvent_ONGOING=new e.callbacks.CbEvent,t.util.ZPP_Flags.internal=!1),i==t.util.ZPP_Flags.CbEvent_ONGOING?r=6:(null==t.util.ZPP_Flags.CbEvent_END&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.CbEvent_END=new e.callbacks.CbEvent,t.util.ZPP_Flags.internal=!1),i==t.util.ZPP_Flags.CbEvent_END?r=1:(null==t.util.ZPP_Flags.CbEvent_SLEEP&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.CbEvent_SLEEP=new e.callbacks.CbEvent,t.util.ZPP_Flags.internal=!1),i==t.util.ZPP_Flags.CbEvent_SLEEP?r=3:(null==t.util.ZPP_Flags.CbEvent_WAKE&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.CbEvent_WAKE=new e.callbacks.CbEvent,t.util.ZPP_Flags.internal=!1),i==t.util.ZPP_Flags.CbEvent_WAKE?r=2:(null==t.util.ZPP_Flags.CbEvent_PRE&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.CbEvent_PRE=new e.callbacks.CbEvent,t.util.ZPP_Flags.internal=!1),r=i==t.util.ZPP_Flags.CbEvent_PRE?5:4))))),this.zpp_inner.swapEvent(r)),t.callbacks.ZPP_Listener.events[this.zpp_inner.event]},Object.defineProperty(e.callbacks.Listener.prototype,"precedence",{get:e.callbacks.Listener.prototype.get_precedence,set:e.callbacks.Listener.prototype.set_precedence}),e.callbacks.Listener.prototype.get_precedence=function(){return this.zpp_inner.precedence},e.callbacks.Listener.prototype.set_precedence=function(e){return this.zpp_inner.precedence!=e&&(this.zpp_inner.precedence=e,this.zpp_inner.invalidate_precedence()),this.zpp_inner.precedence},Object.defineProperty(e.callbacks.Listener.prototype,"space",{get:e.callbacks.Listener.prototype.get_space,set:e.callbacks.Listener.prototype.set_space}),e.callbacks.Listener.prototype.get_space=function(){return null==this.zpp_inner.space?null:this.zpp_inner.space.outer},e.callbacks.Listener.prototype.set_space=function(e){if((null==this.zpp_inner.space?null:this.zpp_inner.space.outer)!=e)if(null!=this.zpp_inner.space&&this.zpp_inner.space.outer.zpp_inner.wrap_listeners.remove(this),null!=e){var t=e.zpp_inner.wrap_listeners;t.zpp_inner.reverse_flag?t.push(this):t.unshift(this)}else this.zpp_inner.space=null;return null==this.zpp_inner.space?null:this.zpp_inner.space.outer},e.callbacks.Listener.prototype.toString=function(){var e=["BEGIN","END","WAKE","SLEEP","BREAK","PRE","ONGOING"][this.zpp_inner.event];if(0==this.zpp_inner.type){var t=this.zpp_inner.body;return"BodyListener{"+e+"::"+i.string(t.outer_zn.zpp_inner_zn.options.outer)+"}"}if(1==this.zpp_inner.type){var n=this.zpp_inner.constraint;return"ConstraintListener{"+e+"::"+i.string(n.outer_zn.zpp_inner_zn.options.outer)+"}"}var r,o=this.zpp_inner.interaction;switch(o.itype){case 1:r="COLLISION";break;case 2:r="SENSOR";break;case 4:r="FLUID";break;default:r="ALL"}return(2==this.zpp_inner.type?"InteractionListener{"+e+"#"+r+"::"+i.string(o.outer_zni.zpp_inner_zn.options1.outer)+":"+i.string(o.outer_zni.zpp_inner_zn.options2.outer)+"}":"PreListener{"+r+"::"+i.string(o.outer_znp.zpp_inner_zn.options1.outer)+":"+i.string(o.outer_znp.zpp_inner_zn.options2.outer)+"}")+" precedence="+this.zpp_inner.precedence},e.callbacks.Listener.prototype.__class__=e.callbacks.Listener,e.callbacks.BodyListener=l["nape.callbacks.BodyListener"]=function(i,r,o,a){if(null==a&&(a=0),this.zpp_inner_zn=null,t.callbacks.ZPP_Listener.internal=!0,e.callbacks.Listener.call(this),t.callbacks.ZPP_Listener.internal=!1,null==o)throw new n._Boot.HaxeError("Error: BodyListener::handler cannot be null");var s=-1;if(null==t.util.ZPP_Flags.CbEvent_WAKE&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.CbEvent_WAKE=new e.callbacks.CbEvent,t.util.ZPP_Flags.internal=!1),i==t.util.ZPP_Flags.CbEvent_WAKE)s=2;else{if(null==t.util.ZPP_Flags.CbEvent_SLEEP&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.CbEvent_SLEEP=new e.callbacks.CbEvent,t.util.ZPP_Flags.internal=!1),i!=t.util.ZPP_Flags.CbEvent_SLEEP)throw new n._Boot.HaxeError("Error: cbEvent '"+i.toString()+"' is not a valid event type for a BodyListener");s=3}this.zpp_inner_zn=new t.callbacks.ZPP_BodyListener(t.callbacks.ZPP_OptionType.argument(r),s,o),this.zpp_inner=this.zpp_inner_zn,this.zpp_inner.outer=this,this.zpp_inner_zn.outer_zn=this,this.zpp_inner.precedence=a},e.callbacks.BodyListener.__name__=["nape","callbacks","BodyListener"],e.callbacks.BodyListener.__super__=e.callbacks.Listener,e.callbacks.Listener.prototype)e.callbacks.BodyListener.prototype[u]=e.callbacks.Listener.prototype[u];for(var u in e.callbacks.BodyListener.prototype.zpp_inner_zn=null,Object.defineProperty(e.callbacks.BodyListener.prototype,"options",{get:e.callbacks.BodyListener.prototype.get_options,set:e.callbacks.BodyListener.prototype.set_options}),e.callbacks.BodyListener.prototype.get_options=function(){return this.zpp_inner_zn.options.outer},e.callbacks.BodyListener.prototype.set_options=function(e){return this.zpp_inner_zn.options.set(e.zpp_inner),this.zpp_inner_zn.options.outer},Object.defineProperty(e.callbacks.BodyListener.prototype,"handler",{get:e.callbacks.BodyListener.prototype.get_handler,set:e.callbacks.BodyListener.prototype.set_handler}),e.callbacks.BodyListener.prototype.get_handler=function(){return this.zpp_inner_zn.handler},e.callbacks.BodyListener.prototype.set_handler=function(e){if(null==e)throw new n._Boot.HaxeError("Error: BodyListener::handler cannot be null");return this.zpp_inner_zn.handler=e,this.zpp_inner_zn.handler},e.callbacks.BodyListener.prototype.__class__=e.callbacks.BodyListener,e.callbacks.CbEvent=l["nape.callbacks.CbEvent"]=function(){if(!t.util.ZPP_Flags.internal)throw new n._Boot.HaxeError("Error: Cannot instantiate CbEvent derp!")},e.callbacks.CbEvent.__name__=["nape","callbacks","CbEvent"],e.callbacks.CbEvent.BEGIN=null,e.callbacks.CbEvent.get_BEGIN=function(){return null==t.util.ZPP_Flags.CbEvent_BEGIN&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.CbEvent_BEGIN=new e.callbacks.CbEvent,t.util.ZPP_Flags.internal=!1),t.util.ZPP_Flags.CbEvent_BEGIN},e.callbacks.CbEvent.ONGOING=null,e.callbacks.CbEvent.get_ONGOING=function(){return null==t.util.ZPP_Flags.CbEvent_ONGOING&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.CbEvent_ONGOING=new e.callbacks.CbEvent,t.util.ZPP_Flags.internal=!1),t.util.ZPP_Flags.CbEvent_ONGOING},e.callbacks.CbEvent.END=null,e.callbacks.CbEvent.get_END=function(){return null==t.util.ZPP_Flags.CbEvent_END&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.CbEvent_END=new e.callbacks.CbEvent,t.util.ZPP_Flags.internal=!1),t.util.ZPP_Flags.CbEvent_END},e.callbacks.CbEvent.WAKE=null,e.callbacks.CbEvent.get_WAKE=function(){return null==t.util.ZPP_Flags.CbEvent_WAKE&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.CbEvent_WAKE=new e.callbacks.CbEvent,t.util.ZPP_Flags.internal=!1),t.util.ZPP_Flags.CbEvent_WAKE},e.callbacks.CbEvent.SLEEP=null,e.callbacks.CbEvent.get_SLEEP=function(){return null==t.util.ZPP_Flags.CbEvent_SLEEP&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.CbEvent_SLEEP=new e.callbacks.CbEvent,t.util.ZPP_Flags.internal=!1),t.util.ZPP_Flags.CbEvent_SLEEP},e.callbacks.CbEvent.BREAK=null,e.callbacks.CbEvent.get_BREAK=function(){return null==t.util.ZPP_Flags.CbEvent_BREAK&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.CbEvent_BREAK=new e.callbacks.CbEvent,t.util.ZPP_Flags.internal=!1),t.util.ZPP_Flags.CbEvent_BREAK},e.callbacks.CbEvent.PRE=null,e.callbacks.CbEvent.get_PRE=function(){return null==t.util.ZPP_Flags.CbEvent_PRE&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.CbEvent_PRE=new e.callbacks.CbEvent,t.util.ZPP_Flags.internal=!1),t.util.ZPP_Flags.CbEvent_PRE},e.callbacks.CbEvent.prototype.toString=function(){return null==t.util.ZPP_Flags.CbEvent_PRE&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.CbEvent_PRE=new e.callbacks.CbEvent,t.util.ZPP_Flags.internal=!1),this==t.util.ZPP_Flags.CbEvent_PRE?"PRE":(null==t.util.ZPP_Flags.CbEvent_BEGIN&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.CbEvent_BEGIN=new e.callbacks.CbEvent,t.util.ZPP_Flags.internal=!1),this==t.util.ZPP_Flags.CbEvent_BEGIN?"BEGIN":(null==t.util.ZPP_Flags.CbEvent_ONGOING&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.CbEvent_ONGOING=new e.callbacks.CbEvent,t.util.ZPP_Flags.internal=!1),this==t.util.ZPP_Flags.CbEvent_ONGOING?"ONGOING":(null==t.util.ZPP_Flags.CbEvent_END&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.CbEvent_END=new e.callbacks.CbEvent,t.util.ZPP_Flags.internal=!1),this==t.util.ZPP_Flags.CbEvent_END?"END":(null==t.util.ZPP_Flags.CbEvent_WAKE&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.CbEvent_WAKE=new e.callbacks.CbEvent,t.util.ZPP_Flags.internal=!1),this==t.util.ZPP_Flags.CbEvent_WAKE?"WAKE":(null==t.util.ZPP_Flags.CbEvent_SLEEP&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.CbEvent_SLEEP=new e.callbacks.CbEvent,t.util.ZPP_Flags.internal=!1),this==t.util.ZPP_Flags.CbEvent_SLEEP?"SLEEP":(null==t.util.ZPP_Flags.CbEvent_BREAK&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.CbEvent_BREAK=new e.callbacks.CbEvent,t.util.ZPP_Flags.internal=!1),this==t.util.ZPP_Flags.CbEvent_BREAK?"BREAK":""))))))},e.callbacks.CbEvent.prototype.__class__=e.callbacks.CbEvent,e.callbacks.CbType=l["nape.callbacks.CbType"]=function(){this.zpp_inner=null,this.zpp_inner=new t.callbacks.ZPP_CbType,this.zpp_inner.outer=this},e.callbacks.CbType.__name__=["nape","callbacks","CbType"],e.callbacks.CbType.ANY_BODY=null,e.callbacks.CbType.get_ANY_BODY=function(){return t.callbacks.ZPP_CbType.ANY_BODY},e.callbacks.CbType.ANY_CONSTRAINT=null,e.callbacks.CbType.get_ANY_CONSTRAINT=function(){return t.callbacks.ZPP_CbType.ANY_CONSTRAINT},e.callbacks.CbType.ANY_SHAPE=null,e.callbacks.CbType.get_ANY_SHAPE=function(){return t.callbacks.ZPP_CbType.ANY_SHAPE},e.callbacks.CbType.ANY_COMPOUND=null,e.callbacks.CbType.get_ANY_COMPOUND=function(){return t.callbacks.ZPP_CbType.ANY_COMPOUND},e.callbacks.CbType.prototype.zpp_inner=null,Object.defineProperty(e.callbacks.CbType.prototype,"id",{get:e.callbacks.CbType.prototype.get_id}),e.callbacks.CbType.prototype.get_id=function(){return this.zpp_inner.id},e.callbacks.CbType.prototype.including=function(t){return new e.callbacks.OptionType(this).including(t)},e.callbacks.CbType.prototype.excluding=function(t){return new e.callbacks.OptionType(this).excluding(t)},Object.defineProperty(e.callbacks.CbType.prototype,"userData",{get:e.callbacks.CbType.prototype.get_userData}),e.callbacks.CbType.prototype.get_userData=function(){return null==this.zpp_inner.userData&&(this.zpp_inner.userData={}),this.zpp_inner.userData},Object.defineProperty(e.callbacks.CbType.prototype,"interactors",{get:e.callbacks.CbType.prototype.get_interactors}),e.callbacks.CbType.prototype.get_interactors=function(){return null==this.zpp_inner.wrap_interactors&&(this.zpp_inner.wrap_interactors=t.util.ZPP_InteractorList.get(this.zpp_inner.interactors,!0)),this.zpp_inner.wrap_interactors},Object.defineProperty(e.callbacks.CbType.prototype,"constraints",{get:e.callbacks.CbType.prototype.get_constraints}),e.callbacks.CbType.prototype.get_constraints=function(){return null==this.zpp_inner.wrap_constraints&&(this.zpp_inner.wrap_constraints=t.util.ZPP_ConstraintList.get(this.zpp_inner.constraints,!0)),this.zpp_inner.wrap_constraints},e.callbacks.CbType.prototype.toString=function(){return this==t.callbacks.ZPP_CbType.ANY_BODY?"ANY_BODY":this==t.callbacks.ZPP_CbType.ANY_SHAPE?"ANY_SHAPE":this==t.callbacks.ZPP_CbType.ANY_COMPOUND?"ANY_COMPOUND":this==t.callbacks.ZPP_CbType.ANY_CONSTRAINT?"ANY_CONSTRAINT":"CbType#"+this.zpp_inner.id},e.callbacks.CbType.prototype.__class__=e.callbacks.CbType,e.callbacks.CbTypeIterator=l["nape.callbacks.CbTypeIterator"]=function(){if(this.zpp_next=null,this.zpp_critical=!1,this.zpp_i=0,this.zpp_inner=null,!t.util.ZPP_CbTypeList.internal)throw new n._Boot.HaxeError("Error: Cannot instantiate CbTypeIterator derp!")},e.callbacks.CbTypeIterator.__name__=["nape","callbacks","CbTypeIterator"],e.callbacks.CbTypeIterator.get=function(n){var i;if(null==e.callbacks.CbTypeIterator.zpp_pool){t.util.ZPP_CbTypeList.internal=!0;var r=new e.callbacks.CbTypeIterator;t.util.ZPP_CbTypeList.internal=!1,i=r}else{var o=e.callbacks.CbTypeIterator.zpp_pool;e.callbacks.CbTypeIterator.zpp_pool=o.zpp_next,i=o}return i.zpp_i=0,i.zpp_inner=n,i.zpp_critical=!1,i},e.callbacks.CbTypeIterator.prototype.zpp_inner=null,e.callbacks.CbTypeIterator.prototype.zpp_i=null,e.callbacks.CbTypeIterator.prototype.zpp_critical=null,e.callbacks.CbTypeIterator.prototype.zpp_next=null,e.callbacks.CbTypeIterator.prototype.hasNext=function(){this.zpp_inner.zpp_inner.valmod();var t=this.zpp_inner;t.zpp_inner.valmod(),t.zpp_inner.zip_length&&(t.zpp_inner.zip_length=!1,t.zpp_inner.user_length=t.zpp_inner.inner.length);var n=t.zpp_inner.user_length;return this.zpp_critical=!0,this.zpp_i<n||(this.zpp_next=e.callbacks.CbTypeIterator.zpp_pool,e.callbacks.CbTypeIterator.zpp_pool=this,this.zpp_inner=null,!1)},e.callbacks.CbTypeIterator.prototype.next=function(){return this.zpp_critical=!1,this.zpp_inner.at(this.zpp_i++)},e.callbacks.CbTypeIterator.prototype.__class__=e.callbacks.CbTypeIterator,e.callbacks.CbTypeList=l["nape.callbacks.CbTypeList"]=function(){this.zpp_inner=null,this.zpp_inner=new t.util.ZPP_CbTypeList,this.zpp_inner.outer=this},e.callbacks.CbTypeList.__name__=["nape","callbacks","CbTypeList"],e.callbacks.CbTypeList.fromArray=function(t){if(null==t)throw new n._Boot.HaxeError("Error: Cannot convert null Array to Nape list");for(var i=new e.callbacks.CbTypeList,r=0;r<t.length;){var o=t[r];++r,i.push(o)}return i},e.callbacks.CbTypeList.prototype.zpp_inner=null,Object.defineProperty(e.callbacks.CbTypeList.prototype,"length",{get:e.callbacks.CbTypeList.prototype.get_length}),e.callbacks.CbTypeList.prototype.get_length=function(){return this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.user_length},e.callbacks.CbTypeList.prototype.has=function(e){return this.zpp_inner.valmod(),this.zpp_inner.inner.has(e.zpp_inner)},e.callbacks.CbTypeList.prototype.at=function(e){var t;if(this.zpp_inner.valmod(),e>=0?(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t=e>=this.zpp_inner.user_length):t=!0,t)throw new n._Boot.HaxeError("Error: Index out of bounds");if(this.zpp_inner.reverse_flag&&(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),e=this.zpp_inner.user_length-1-e),e<this.zpp_inner.at_index||null==this.zpp_inner.at_ite)this.zpp_inner.at_index=e,this.zpp_inner.at_ite=this.zpp_inner.inner.iterator_at(e);else for(;this.zpp_inner.at_index!=e;)this.zpp_inner.at_index++,this.zpp_inner.at_ite=this.zpp_inner.at_ite.next;return this.zpp_inner.at_ite.elt.outer},e.callbacks.CbTypeList.prototype.push=function(e){if(this.zpp_inner.immutable)throw new n._Boot.HaxeError("Error: CbTypeList is immutable");this.zpp_inner.modify_test(),this.zpp_inner.valmod();var t=null==this.zpp_inner.adder||this.zpp_inner.adder(e);if(t){if(this.zpp_inner.reverse_flag)this.zpp_inner.inner.add(e.zpp_inner);else{if(null==this.zpp_inner.push_ite){var i;if(null==this.zpp_inner.inner.head)i=null;else{var r=this.zpp_inner.inner;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),i=r.iterator_at(this.zpp_inner.user_length-1)}this.zpp_inner.push_ite=i}this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,e.zpp_inner)}this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(e)}return t},e.callbacks.CbTypeList.prototype.unshift=function(e){if(this.zpp_inner.immutable)throw new n._Boot.HaxeError("Error: CbTypeList is immutable");this.zpp_inner.modify_test(),this.zpp_inner.valmod();var t=null==this.zpp_inner.adder||this.zpp_inner.adder(e);if(t){if(this.zpp_inner.reverse_flag){if(null==this.zpp_inner.push_ite){var i;if(null==this.zpp_inner.inner.head)i=null;else{var r=this.zpp_inner.inner;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),i=r.iterator_at(this.zpp_inner.user_length-1)}this.zpp_inner.push_ite=i}this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,e.zpp_inner)}else this.zpp_inner.inner.add(e.zpp_inner);this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(e)}return t},e.callbacks.CbTypeList.prototype.pop=function(){if(this.zpp_inner.immutable)throw new n._Boot.HaxeError("Error: CbTypeList is immutable");if(this.zpp_inner.modify_test(),null==this.zpp_inner.inner.head)throw new n._Boot.HaxeError("Error: Cannot remove from empty list");this.zpp_inner.valmod();var e=null;if(this.zpp_inner.reverse_flag){var t=(e=this.zpp_inner.inner.head.elt).outer;null!=this.zpp_inner.subber&&this.zpp_inner.subber(t),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()}else{var i;if(null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null),this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),1==this.zpp_inner.user_length)i=null;else{var r=this.zpp_inner.inner;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),i=r.iterator_at(this.zpp_inner.user_length-2)}var o=(e=null==i?this.zpp_inner.inner.head.elt:i.next.elt).outer;null!=this.zpp_inner.subber&&this.zpp_inner.subber(o),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(i)}return this.zpp_inner.invalidate(),e.outer},e.callbacks.CbTypeList.prototype.shift=function(){if(this.zpp_inner.immutable)throw new n._Boot.HaxeError("Error: CbTypeList is immutable");if(this.zpp_inner.modify_test(),null==this.zpp_inner.inner.head)throw new n._Boot.HaxeError("Error: Cannot remove from empty list");this.zpp_inner.valmod();var e=null;if(this.zpp_inner.reverse_flag){var t;if(null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null),this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),1==this.zpp_inner.user_length)t=null;else{var i=this.zpp_inner.inner;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t=i.iterator_at(this.zpp_inner.user_length-2)}var r=(e=null==t?this.zpp_inner.inner.head.elt:t.next.elt).outer;null!=this.zpp_inner.subber&&this.zpp_inner.subber(r),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(t)}else{var o=(e=this.zpp_inner.inner.head.elt).outer;null!=this.zpp_inner.subber&&this.zpp_inner.subber(o),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()}return this.zpp_inner.invalidate(),e.outer},e.callbacks.CbTypeList.prototype.add=function(e){return this.zpp_inner.reverse_flag?this.push(e):this.unshift(e)},e.callbacks.CbTypeList.prototype.remove=function(e){if(this.zpp_inner.immutable)throw new n._Boot.HaxeError("Error: CbTypeList is immutable");var t;this.zpp_inner.modify_test(),this.zpp_inner.valmod(),t=!1;for(var i=this.zpp_inner.inner.head;null!=i;){if(i.elt==e.zpp_inner){t=!0;break}i=i.next}return t&&(null!=this.zpp_inner.subber&&this.zpp_inner.subber(e),this.zpp_inner.dontremove||this.zpp_inner.inner.remove(e.zpp_inner),this.zpp_inner.invalidate()),t},e.callbacks.CbTypeList.prototype.clear=function(){if(this.zpp_inner.immutable)throw new n._Boot.HaxeError("Error: CbTypeList is immutable");if(this.zpp_inner.reverse_flag)for(;null!=this.zpp_inner.inner.head;)this.pop();else for(;null!=this.zpp_inner.inner.head;)this.shift()},e.callbacks.CbTypeList.prototype.empty=function(){return null==this.zpp_inner.inner.head},e.callbacks.CbTypeList.prototype.iterator=function(){return this.zpp_inner.valmod(),e.callbacks.CbTypeIterator.get(this)},e.callbacks.CbTypeList.prototype.copy=function(t){null==t&&(t=!1);var i=new e.callbacks.CbTypeList;this.zpp_inner.valmod();for(var r=e.callbacks.CbTypeIterator.get(this);;){r.zpp_inner.zpp_inner.valmod();var o=r.zpp_inner;o.zpp_inner.valmod(),o.zpp_inner.zip_length&&(o.zpp_inner.zip_length=!1,o.zpp_inner.user_length=o.zpp_inner.inner.length);var a,s=o.zpp_inner.user_length;if(r.zpp_critical=!0,r.zpp_i<s?a=!0:(r.zpp_next=e.callbacks.CbTypeIterator.zpp_pool,e.callbacks.CbTypeIterator.zpp_pool=r,r.zpp_inner=null,a=!1),!a)break;r.zpp_critical=!1;var l,p=r.zpp_inner.at(r.zpp_i++);if(t)throw new n._Boot.HaxeError("Error: CbType is not a copyable type");l=p,i.push(l)}return i},e.callbacks.CbTypeList.prototype.merge=function(t){if(null==t)throw new n._Boot.HaxeError("Error: Cannot merge with null list");t.zpp_inner.valmod();for(var i=e.callbacks.CbTypeIterator.get(t);;){i.zpp_inner.zpp_inner.valmod();var r=i.zpp_inner;r.zpp_inner.valmod(),r.zpp_inner.zip_length&&(r.zpp_inner.zip_length=!1,r.zpp_inner.user_length=r.zpp_inner.inner.length);var o,a=r.zpp_inner.user_length;if(i.zpp_critical=!0,i.zpp_i<a?o=!0:(i.zpp_next=e.callbacks.CbTypeIterator.zpp_pool,e.callbacks.CbTypeIterator.zpp_pool=i,i.zpp_inner=null,o=!1),!o)break;i.zpp_critical=!1;var s=i.zpp_inner.at(i.zpp_i++);this.has(s)||(this.zpp_inner.reverse_flag?this.push(s):this.unshift(s))}},e.callbacks.CbTypeList.prototype.toString=function(){var t="[",n=!0;this.zpp_inner.valmod();for(var i=e.callbacks.CbTypeIterator.get(this);;){i.zpp_inner.zpp_inner.valmod();var r=i.zpp_inner;r.zpp_inner.valmod(),r.zpp_inner.zip_length&&(r.zpp_inner.zip_length=!1,r.zpp_inner.user_length=r.zpp_inner.inner.length);var o,a=r.zpp_inner.user_length;if(i.zpp_critical=!0,i.zpp_i<a?o=!0:(i.zpp_next=e.callbacks.CbTypeIterator.zpp_pool,e.callbacks.CbTypeIterator.zpp_pool=i,i.zpp_inner=null,o=!1),!o)break;i.zpp_critical=!1;var s=i.zpp_inner.at(i.zpp_i++);n||(t+=","),t+=null==s?"NULL":s.toString(),n=!1}return t+"]"},e.callbacks.CbTypeList.prototype.foreach=function(t){if(null==t)throw new n._Boot.HaxeError("Error: Cannot execute null on list elements");this.zpp_inner.valmod();for(var i=e.callbacks.CbTypeIterator.get(this);;){i.zpp_inner.zpp_inner.valmod();var r=i.zpp_inner;r.zpp_inner.valmod(),r.zpp_inner.zip_length&&(r.zpp_inner.zip_length=!1,r.zpp_inner.user_length=r.zpp_inner.inner.length);var o,a=r.zpp_inner.user_length;if(i.zpp_critical=!0,i.zpp_i<a?o=!0:(i.zpp_next=e.callbacks.CbTypeIterator.zpp_pool,e.callbacks.CbTypeIterator.zpp_pool=i,i.zpp_inner=null,o=!1),!o)break;try{i.zpp_critical=!1,t(i.zpp_inner.at(i.zpp_i++))}catch(t){t instanceof n._Boot.HaxeError&&t.val,i.zpp_next=e.callbacks.CbTypeIterator.zpp_pool,e.callbacks.CbTypeIterator.zpp_pool=i,i.zpp_inner=null;break}}return this},e.callbacks.CbTypeList.prototype.filter=function(e){if(null==e)throw new n._Boot.HaxeError("Error: Cannot select elements of list with null");for(var t=0;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t<this.zpp_inner.user_length;){var i=this.at(t);try{e(i)?++t:this.remove(i)}catch(e){e instanceof n._Boot.HaxeError&&e.val;break}}return this},e.callbacks.CbTypeList.prototype.__class__=e.callbacks.CbTypeList,e.callbacks.ConstraintCallback=l["nape.callbacks.ConstraintCallback"]=function(){e.callbacks.Callback.call(this)},e.callbacks.ConstraintCallback.__name__=["nape","callbacks","ConstraintCallback"],e.callbacks.ConstraintCallback.__super__=e.callbacks.Callback,e.callbacks.Callback.prototype)e.callbacks.ConstraintCallback.prototype[u]=e.callbacks.Callback.prototype[u];for(var u in Object.defineProperty(e.callbacks.ConstraintCallback.prototype,"constraint",{get:e.callbacks.ConstraintCallback.prototype.get_constraint}),e.callbacks.ConstraintCallback.prototype.get_constraint=function(){return this.zpp_inner.constraint.outer},e.callbacks.ConstraintCallback.prototype.toString=function(){var e="Cb:";return e+=["WAKE","SLEEP","BREAK"][this.zpp_inner.event-2],(e+=":"+this.zpp_inner.constraint.outer.toString())+" : listener: "+i.string(this.zpp_inner.listener.outer)},e.callbacks.ConstraintCallback.prototype.__class__=e.callbacks.ConstraintCallback,e.callbacks.ConstraintListener=l["nape.callbacks.ConstraintListener"]=function(i,r,o,a){if(null==a&&(a=0),this.zpp_inner_zn=null,t.callbacks.ZPP_Listener.internal=!0,e.callbacks.Listener.call(this),t.callbacks.ZPP_Listener.internal=!1,null==o)throw new n._Boot.HaxeError("Error: ConstraintListener::handler cannot be null");var s=-1;if(null==t.util.ZPP_Flags.CbEvent_WAKE&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.CbEvent_WAKE=new e.callbacks.CbEvent,t.util.ZPP_Flags.internal=!1),i==t.util.ZPP_Flags.CbEvent_WAKE)s=2;else if(null==t.util.ZPP_Flags.CbEvent_SLEEP&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.CbEvent_SLEEP=new e.callbacks.CbEvent,t.util.ZPP_Flags.internal=!1),i==t.util.ZPP_Flags.CbEvent_SLEEP)s=3;else{if(null==t.util.ZPP_Flags.CbEvent_BREAK&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.CbEvent_BREAK=new e.callbacks.CbEvent,t.util.ZPP_Flags.internal=!1),i!=t.util.ZPP_Flags.CbEvent_BREAK)throw new n._Boot.HaxeError("Error: cbEvent '"+i.toString()+"' is not a valid event type for a ConstraintListener");s=4}this.zpp_inner_zn=new t.callbacks.ZPP_ConstraintListener(t.callbacks.ZPP_OptionType.argument(r),s,o),this.zpp_inner=this.zpp_inner_zn,this.zpp_inner.outer=this,this.zpp_inner_zn.outer_zn=this,this.zpp_inner.precedence=a},e.callbacks.ConstraintListener.__name__=["nape","callbacks","ConstraintListener"],e.callbacks.ConstraintListener.__super__=e.callbacks.Listener,e.callbacks.Listener.prototype)e.callbacks.ConstraintListener.prototype[u]=e.callbacks.Listener.prototype[u];for(var u in e.callbacks.ConstraintListener.prototype.zpp_inner_zn=null,Object.defineProperty(e.callbacks.ConstraintListener.prototype,"options",{get:e.callbacks.ConstraintListener.prototype.get_options,set:e.callbacks.ConstraintListener.prototype.set_options}),e.callbacks.ConstraintListener.prototype.get_options=function(){return this.zpp_inner_zn.options.outer},e.callbacks.ConstraintListener.prototype.set_options=function(e){return this.zpp_inner_zn.options.set(e.zpp_inner),this.zpp_inner_zn.options.outer},Object.defineProperty(e.callbacks.ConstraintListener.prototype,"handler",{get:e.callbacks.ConstraintListener.prototype.get_handler,set:e.callbacks.ConstraintListener.prototype.set_handler}),e.callbacks.ConstraintListener.prototype.get_handler=function(){return this.zpp_inner_zn.handler},e.callbacks.ConstraintListener.prototype.set_handler=function(e){if(null==e)throw new n._Boot.HaxeError("Error: ConstraintListener::handler cannot be null");return this.zpp_inner_zn.handler=e,this.zpp_inner_zn.handler},e.callbacks.ConstraintListener.prototype.__class__=e.callbacks.ConstraintListener,e.callbacks.InteractionCallback=l["nape.callbacks.InteractionCallback"]=function(){e.callbacks.Callback.call(this)},e.callbacks.InteractionCallback.__name__=["nape","callbacks","InteractionCallback"],e.callbacks.InteractionCallback.__super__=e.callbacks.Callback,e.callbacks.Callback.prototype)e.callbacks.InteractionCallback.prototype[u]=e.callbacks.Callback.prototype[u];for(var u in Object.defineProperty(e.callbacks.InteractionCallback.prototype,"int1",{get:e.callbacks.InteractionCallback.prototype.get_int1}),e.callbacks.InteractionCallback.prototype.get_int1=function(){return this.zpp_inner.int1.outer_i},Object.defineProperty(e.callbacks.InteractionCallback.prototype,"int2",{get:e.callbacks.InteractionCallback.prototype.get_int2}),e.callbacks.InteractionCallback.prototype.get_int2=function(){return this.zpp_inner.int2.outer_i},Object.defineProperty(e.callbacks.InteractionCallback.prototype,"arbiters",{get:e.callbacks.InteractionCallback.prototype.get_arbiters}),e.callbacks.InteractionCallback.prototype.get_arbiters=function(){return this.zpp_inner.wrap_arbiters},e.callbacks.InteractionCallback.prototype.toString=function(){var e="Cb:";return e+=["BEGIN","END","","","","","ONGOING"][this.zpp_inner.event],e+=":"+this.zpp_inner.int1.outer_i.toString()+"/"+this.zpp_inner.int2.outer_i.toString(),(e+=" : "+this.zpp_inner.wrap_arbiters.toString())+" : listener: "+i.string(this.zpp_inner.listener.outer)},e.callbacks.InteractionCallback.prototype.__class__=e.callbacks.InteractionCallback,e.callbacks.InteractionListener=l["nape.callbacks.InteractionListener"]=function(i,r,o,a,s,l){if(null==l&&(l=0),this.zpp_inner_zn=null,t.callbacks.ZPP_Listener.internal=!0,e.callbacks.Listener.call(this),t.callbacks.ZPP_Listener.internal=!1,null==s)throw new n._Boot.HaxeError("Error: InteractionListener::handler cannot be null");if(null==i)throw new n._Boot.HaxeError("Error: CbEvent cannot be null for InteractionListener");var p=-1;if(null==t.util.ZPP_Flags.CbEvent_BEGIN&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.CbEvent_BEGIN=new e.callbacks.CbEvent,t.util.ZPP_Flags.internal=!1),i==t.util.ZPP_Flags.CbEvent_BEGIN)p=0;else if(null==t.util.ZPP_Flags.CbEvent_END&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.CbEvent_END=new e.callbacks.CbEvent,t.util.ZPP_Flags.internal=!1),i==t.util.ZPP_Flags.CbEvent_END)p=1;else{if(null==t.util.ZPP_Flags.CbEvent_ONGOING&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.CbEvent_ONGOING=new e.callbacks.CbEvent,t.util.ZPP_Flags.internal=!1),i!=t.util.ZPP_Flags.CbEvent_ONGOING)throw new n._Boot.HaxeError("Error: CbEvent '"+i.toString()+"' is not a valid event type for InteractionListener");p=6}if(this.zpp_inner_zn=new t.callbacks.ZPP_InteractionListener(t.callbacks.ZPP_OptionType.argument(o),t.callbacks.ZPP_OptionType.argument(a),p,2),this.zpp_inner=this.zpp_inner_zn,this.zpp_inner.outer=this,this.zpp_inner_zn.outer_zni=this,this.zpp_inner.precedence=l,this.zpp_inner_zn.handleri=s,null==r)throw new n._Boot.HaxeError("Error: Cannot set listener interaction type to null");var u,h,c=this.zpp_inner_zn.itype;1==c?(null==t.util.ZPP_Flags.InteractionType_COLLISION&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.InteractionType_COLLISION=new e.callbacks.InteractionType,t.util.ZPP_Flags.internal=!1),u=t.util.ZPP_Flags.InteractionType_COLLISION):2==c?(null==t.util.ZPP_Flags.InteractionType_SENSOR&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.InteractionType_SENSOR=new e.callbacks.InteractionType,t.util.ZPP_Flags.internal=!1),u=t.util.ZPP_Flags.InteractionType_SENSOR):4==c?(null==t.util.ZPP_Flags.InteractionType_FLUID&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.InteractionType_FLUID=new e.callbacks.InteractionType,t.util.ZPP_Flags.internal=!1),u=t.util.ZPP_Flags.InteractionType_FLUID):7==c?(null==t.util.ZPP_Flags.InteractionType_ANY&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.InteractionType_ANY=new e.callbacks.InteractionType,t.util.ZPP_Flags.internal=!1),u=t.util.ZPP_Flags.InteractionType_ANY):u=null,u!=r&&(null==t.util.ZPP_Flags.InteractionType_COLLISION&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.InteractionType_COLLISION=new e.callbacks.InteractionType,t.util.ZPP_Flags.internal=!1),r==t.util.ZPP_Flags.InteractionType_COLLISION?h=1:(null==t.util.ZPP_Flags.InteractionType_SENSOR&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.InteractionType_SENSOR=new e.callbacks.InteractionType,t.util.ZPP_Flags.internal=!1),r==t.util.ZPP_Flags.InteractionType_SENSOR?h=2:(null==t.util.ZPP_Flags.InteractionType_FLUID&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.InteractionType_FLUID=new e.callbacks.InteractionType,t.util.ZPP_Flags.internal=!1),h=r==t.util.ZPP_Flags.InteractionType_FLUID?4:7)),this.zpp_inner_zn.itype=h);var _=this.zpp_inner_zn.itype;1==_?null==t.util.ZPP_Flags.InteractionType_COLLISION&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.InteractionType_COLLISION=new e.callbacks.InteractionType,t.util.ZPP_Flags.internal=!1):2==_?null==t.util.ZPP_Flags.InteractionType_SENSOR&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.InteractionType_SENSOR=new e.callbacks.InteractionType,t.util.ZPP_Flags.internal=!1):4==_?null==t.util.ZPP_Flags.InteractionType_FLUID&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.InteractionType_FLUID=new e.callbacks.InteractionType,t.util.ZPP_Flags.internal=!1):7==_&&null==t.util.ZPP_Flags.InteractionType_ANY&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.InteractionType_ANY=new e.callbacks.InteractionType,t.util.ZPP_Flags.internal=!1)},e.callbacks.InteractionListener.__name__=["nape","callbacks","InteractionListener"],e.callbacks.InteractionListener.__super__=e.callbacks.Listener,e.callbacks.Listener.prototype)e.callbacks.InteractionListener.prototype[u]=e.callbacks.Listener.prototype[u];for(var u in e.callbacks.InteractionListener.prototype.zpp_inner_zn=null,Object.defineProperty(e.callbacks.InteractionListener.prototype,"options1",{get:e.callbacks.InteractionListener.prototype.get_options1,set:e.callbacks.InteractionListener.prototype.set_options1}),e.callbacks.InteractionListener.prototype.get_options1=function(){return this.zpp_inner_zn.options1.outer},e.callbacks.InteractionListener.prototype.set_options1=function(e){return this.zpp_inner_zn.options1.set(e.zpp_inner),this.zpp_inner_zn.options1.outer},Object.defineProperty(e.callbacks.InteractionListener.prototype,"options2",{get:e.callbacks.InteractionListener.prototype.get_options2,set:e.callbacks.InteractionListener.prototype.set_options2}),e.callbacks.InteractionListener.prototype.get_options2=function(){return this.zpp_inner_zn.options2.outer},e.callbacks.InteractionListener.prototype.set_options2=function(e){return this.zpp_inner_zn.options2.set(e.zpp_inner),this.zpp_inner_zn.options2.outer},Object.defineProperty(e.callbacks.InteractionListener.prototype,"interactionType",{get:e.callbacks.InteractionListener.prototype.get_interactionType,set:e.callbacks.InteractionListener.prototype.set_interactionType}),e.callbacks.InteractionListener.prototype.get_interactionType=function(){var n=this.zpp_inner_zn.itype;return 1==n?(null==t.util.ZPP_Flags.InteractionType_COLLISION&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.InteractionType_COLLISION=new e.callbacks.InteractionType,t.util.ZPP_Flags.internal=!1),t.util.ZPP_Flags.InteractionType_COLLISION):2==n?(null==t.util.ZPP_Flags.InteractionType_SENSOR&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.InteractionType_SENSOR=new e.callbacks.InteractionType,t.util.ZPP_Flags.internal=!1),t.util.ZPP_Flags.InteractionType_SENSOR):4==n?(null==t.util.ZPP_Flags.InteractionType_FLUID&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.InteractionType_FLUID=new e.callbacks.InteractionType,t.util.ZPP_Flags.internal=!1),t.util.ZPP_Flags.InteractionType_FLUID):7==n?(null==t.util.ZPP_Flags.InteractionType_ANY&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.InteractionType_ANY=new e.callbacks.InteractionType,t.util.ZPP_Flags.internal=!1),t.util.ZPP_Flags.InteractionType_ANY):null},e.callbacks.InteractionListener.prototype.set_interactionType=function(i){if(null==i)throw new n._Boot.HaxeError("Error: Cannot set listener interaction type to null");var r,o,a=this.zpp_inner_zn.itype;1==a?(null==t.util.ZPP_Flags.InteractionType_COLLISION&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.InteractionType_COLLISION=new e.callbacks.InteractionType,t.util.ZPP_Flags.internal=!1),r=t.util.ZPP_Flags.InteractionType_COLLISION):2==a?(null==t.util.ZPP_Flags.InteractionType_SENSOR&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.InteractionType_SENSOR=new e.callbacks.InteractionType,t.util.ZPP_Flags.internal=!1),r=t.util.ZPP_Flags.InteractionType_SENSOR):4==a?(null==t.util.ZPP_Flags.InteractionType_FLUID&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.InteractionType_FLUID=new e.callbacks.InteractionType,t.util.ZPP_Flags.internal=!1),r=t.util.ZPP_Flags.InteractionType_FLUID):7==a?(null==t.util.ZPP_Flags.InteractionType_ANY&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.InteractionType_ANY=new e.callbacks.InteractionType,t.util.ZPP_Flags.internal=!1),r=t.util.ZPP_Flags.InteractionType_ANY):r=null,r!=i&&(null==t.util.ZPP_Flags.InteractionType_COLLISION&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.InteractionType_COLLISION=new e.callbacks.InteractionType,t.util.ZPP_Flags.internal=!1),i==t.util.ZPP_Flags.InteractionType_COLLISION?o=1:(null==t.util.ZPP_Flags.InteractionType_SENSOR&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.InteractionType_SENSOR=new e.callbacks.InteractionType,t.util.ZPP_Flags.internal=!1),i==t.util.ZPP_Flags.InteractionType_SENSOR?o=2:(null==t.util.ZPP_Flags.InteractionType_FLUID&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.InteractionType_FLUID=new e.callbacks.InteractionType,t.util.ZPP_Flags.internal=!1),o=i==t.util.ZPP_Flags.InteractionType_FLUID?4:7)),this.zpp_inner_zn.itype=o);var s=this.zpp_inner_zn.itype;return 1==s?(null==t.util.ZPP_Flags.InteractionType_COLLISION&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.InteractionType_COLLISION=new e.callbacks.InteractionType,t.util.ZPP_Flags.internal=!1),t.util.ZPP_Flags.InteractionType_COLLISION):2==s?(null==t.util.ZPP_Flags.InteractionType_SENSOR&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.InteractionType_SENSOR=new e.callbacks.InteractionType,t.util.ZPP_Flags.internal=!1),t.util.ZPP_Flags.InteractionType_SENSOR):4==s?(null==t.util.ZPP_Flags.InteractionType_FLUID&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.InteractionType_FLUID=new e.callbacks.InteractionType,t.util.ZPP_Flags.internal=!1),t.util.ZPP_Flags.InteractionType_FLUID):7==s?(null==t.util.ZPP_Flags.InteractionType_ANY&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.InteractionType_ANY=new e.callbacks.InteractionType,t.util.ZPP_Flags.internal=!1),t.util.ZPP_Flags.InteractionType_ANY):null},Object.defineProperty(e.callbacks.InteractionListener.prototype,"handler",{get:e.callbacks.InteractionListener.prototype.get_handler,set:e.callbacks.InteractionListener.prototype.set_handler}),e.callbacks.InteractionListener.prototype.get_handler=function(){return this.zpp_inner_zn.handleri},e.callbacks.InteractionListener.prototype.set_handler=function(e){if(null==e)throw new n._Boot.HaxeError("Error: InteractionListener::handler cannot be null");return this.zpp_inner_zn.handleri=e,this.zpp_inner_zn.handleri},Object.defineProperty(e.callbacks.InteractionListener.prototype,"allowSleepingCallbacks",{get:e.callbacks.InteractionListener.prototype.get_allowSleepingCallbacks,set:e.callbacks.InteractionListener.prototype.set_allowSleepingCallbacks}),e.callbacks.InteractionListener.prototype.get_allowSleepingCallbacks=function(){return this.zpp_inner_zn.allowSleepingCallbacks},e.callbacks.InteractionListener.prototype.set_allowSleepingCallbacks=function(e){return this.zpp_inner_zn.allowSleepingCallbacks=e,this.zpp_inner_zn.allowSleepingCallbacks},e.callbacks.InteractionListener.prototype.__class__=e.callbacks.InteractionListener,e.callbacks.InteractionType=l["nape.callbacks.InteractionType"]=function(){if(!t.util.ZPP_Flags.internal)throw new n._Boot.HaxeError("Error: Cannot instantiate InteractionType derp!")},e.callbacks.InteractionType.__name__=["nape","callbacks","InteractionType"],e.callbacks.InteractionType.COLLISION=null,e.callbacks.InteractionType.get_COLLISION=function(){return null==t.util.ZPP_Flags.InteractionType_COLLISION&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.InteractionType_COLLISION=new e.callbacks.InteractionType,t.util.ZPP_Flags.internal=!1),t.util.ZPP_Flags.InteractionType_COLLISION},e.callbacks.InteractionType.SENSOR=null,e.callbacks.InteractionType.get_SENSOR=function(){return null==t.util.ZPP_Flags.InteractionType_SENSOR&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.InteractionType_SENSOR=new e.callbacks.InteractionType,t.util.ZPP_Flags.internal=!1),t.util.ZPP_Flags.InteractionType_SENSOR},e.callbacks.InteractionType.FLUID=null,e.callbacks.InteractionType.get_FLUID=function(){return null==t.util.ZPP_Flags.InteractionType_FLUID&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.InteractionType_FLUID=new e.callbacks.InteractionType,t.util.ZPP_Flags.internal=!1),t.util.ZPP_Flags.InteractionType_FLUID},e.callbacks.InteractionType.ANY=null,e.callbacks.InteractionType.get_ANY=function(){return null==t.util.ZPP_Flags.InteractionType_ANY&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.InteractionType_ANY=new e.callbacks.InteractionType,t.util.ZPP_Flags.internal=!1),t.util.ZPP_Flags.InteractionType_ANY},e.callbacks.InteractionType.prototype.toString=function(){return null==t.util.ZPP_Flags.InteractionType_COLLISION&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.InteractionType_COLLISION=new e.callbacks.InteractionType,t.util.ZPP_Flags.internal=!1),this==t.util.ZPP_Flags.InteractionType_COLLISION?"COLLISION":(null==t.util.ZPP_Flags.InteractionType_SENSOR&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.InteractionType_SENSOR=new e.callbacks.InteractionType,t.util.ZPP_Flags.internal=!1),this==t.util.ZPP_Flags.InteractionType_SENSOR?"SENSOR":(null==t.util.ZPP_Flags.InteractionType_FLUID&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.InteractionType_FLUID=new e.callbacks.InteractionType,t.util.ZPP_Flags.internal=!1),this==t.util.ZPP_Flags.InteractionType_FLUID?"FLUID":(null==t.util.ZPP_Flags.InteractionType_ANY&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.InteractionType_ANY=new e.callbacks.InteractionType,t.util.ZPP_Flags.internal=!1),this==t.util.ZPP_Flags.InteractionType_ANY?"ANY":"")))},e.callbacks.InteractionType.prototype.__class__=e.callbacks.InteractionType,e.callbacks.ListenerIterator=l["nape.callbacks.ListenerIterator"]=function(){if(this.zpp_next=null,this.zpp_critical=!1,this.zpp_i=0,this.zpp_inner=null,!t.util.ZPP_ListenerList.internal)throw new n._Boot.HaxeError("Error: Cannot instantiate ListenerIterator derp!")},e.callbacks.ListenerIterator.__name__=["nape","callbacks","ListenerIterator"],e.callbacks.ListenerIterator.get=function(n){var i;if(null==e.callbacks.ListenerIterator.zpp_pool){t.util.ZPP_ListenerList.internal=!0;var r=new e.callbacks.ListenerIterator;t.util.ZPP_ListenerList.internal=!1,i=r}else{var o=e.callbacks.ListenerIterator.zpp_pool;e.callbacks.ListenerIterator.zpp_pool=o.zpp_next,i=o}return i.zpp_i=0,i.zpp_inner=n,i.zpp_critical=!1,i},e.callbacks.ListenerIterator.prototype.zpp_inner=null,e.callbacks.ListenerIterator.prototype.zpp_i=null,e.callbacks.ListenerIterator.prototype.zpp_critical=null,e.callbacks.ListenerIterator.prototype.zpp_next=null,e.callbacks.ListenerIterator.prototype.hasNext=function(){this.zpp_inner.zpp_inner.valmod();var t=this.zpp_inner;t.zpp_inner.valmod(),t.zpp_inner.zip_length&&(t.zpp_inner.zip_length=!1,t.zpp_inner.user_length=t.zpp_inner.inner.length);var n=t.zpp_inner.user_length;return this.zpp_critical=!0,this.zpp_i<n||(this.zpp_next=e.callbacks.ListenerIterator.zpp_pool,e.callbacks.ListenerIterator.zpp_pool=this,this.zpp_inner=null,!1)},e.callbacks.ListenerIterator.prototype.next=function(){return this.zpp_critical=!1,this.zpp_inner.at(this.zpp_i++)},e.callbacks.ListenerIterator.prototype.__class__=e.callbacks.ListenerIterator,e.callbacks.ListenerList=l["nape.callbacks.ListenerList"]=function(){this.zpp_inner=null,this.zpp_inner=new t.util.ZPP_ListenerList,this.zpp_inner.outer=this},e.callbacks.ListenerList.__name__=["nape","callbacks","ListenerList"],e.callbacks.ListenerList.fromArray=function(t){if(null==t)throw new n._Boot.HaxeError("Error: Cannot convert null Array to Nape list");for(var i=new e.callbacks.ListenerList,r=0;r<t.length;){var o=t[r];++r,i.push(o)}return i},e.callbacks.ListenerList.prototype.zpp_inner=null,Object.defineProperty(e.callbacks.ListenerList.prototype,"length",{get:e.callbacks.ListenerList.prototype.get_length}),e.callbacks.ListenerList.prototype.get_length=function(){return this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.user_length},e.callbacks.ListenerList.prototype.has=function(e){return this.zpp_inner.valmod(),this.zpp_inner.inner.has(e.zpp_inner)},e.callbacks.ListenerList.prototype.at=function(e){var t;if(this.zpp_inner.valmod(),e>=0?(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t=e>=this.zpp_inner.user_length):t=!0,t)throw new n._Boot.HaxeError("Error: Index out of bounds");if(this.zpp_inner.reverse_flag&&(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),e=this.zpp_inner.user_length-1-e),e<this.zpp_inner.at_index||null==this.zpp_inner.at_ite)this.zpp_inner.at_index=e,this.zpp_inner.at_ite=this.zpp_inner.inner.iterator_at(e);else for(;this.zpp_inner.at_index!=e;)this.zpp_inner.at_index++,this.zpp_inner.at_ite=this.zpp_inner.at_ite.next;return this.zpp_inner.at_ite.elt.outer},e.callbacks.ListenerList.prototype.push=function(e){if(this.zpp_inner.immutable)throw new n._Boot.HaxeError("Error: ListenerList is immutable");this.zpp_inner.modify_test(),this.zpp_inner.valmod();var t=null==this.zpp_inner.adder||this.zpp_inner.adder(e);if(t){if(this.zpp_inner.reverse_flag)this.zpp_inner.inner.add(e.zpp_inner);else{if(null==this.zpp_inner.push_ite){var i;if(null==this.zpp_inner.inner.head)i=null;else{var r=this.zpp_inner.inner;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),i=r.iterator_at(this.zpp_inner.user_length-1)}this.zpp_inner.push_ite=i}this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,e.zpp_inner)}this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(e)}return t},e.callbacks.ListenerList.prototype.unshift=function(e){if(this.zpp_inner.immutable)throw new n._Boot.HaxeError("Error: ListenerList is immutable");this.zpp_inner.modify_test(),this.zpp_inner.valmod();var t=null==this.zpp_inner.adder||this.zpp_inner.adder(e);if(t){if(this.zpp_inner.reverse_flag){if(null==this.zpp_inner.push_ite){var i;if(null==this.zpp_inner.inner.head)i=null;else{var r=this.zpp_inner.inner;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),i=r.iterator_at(this.zpp_inner.user_length-1)}this.zpp_inner.push_ite=i}this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,e.zpp_inner)}else this.zpp_inner.inner.add(e.zpp_inner);this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(e)}return t},e.callbacks.ListenerList.prototype.pop=function(){if(this.zpp_inner.immutable)throw new n._Boot.HaxeError("Error: ListenerList is immutable");if(this.zpp_inner.modify_test(),null==this.zpp_inner.inner.head)throw new n._Boot.HaxeError("Error: Cannot remove from empty list");this.zpp_inner.valmod();var e=null;if(this.zpp_inner.reverse_flag){var t=(e=this.zpp_inner.inner.head.elt).outer;null!=this.zpp_inner.subber&&this.zpp_inner.subber(t),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()}else{var i;if(null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null),this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),1==this.zpp_inner.user_length)i=null;else{var r=this.zpp_inner.inner;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),i=r.iterator_at(this.zpp_inner.user_length-2)}var o=(e=null==i?this.zpp_inner.inner.head.elt:i.next.elt).outer;null!=this.zpp_inner.subber&&this.zpp_inner.subber(o),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(i)}return this.zpp_inner.invalidate(),e.outer},e.callbacks.ListenerList.prototype.shift=function(){if(this.zpp_inner.immutable)throw new n._Boot.HaxeError("Error: ListenerList is immutable");if(this.zpp_inner.modify_test(),null==this.zpp_inner.inner.head)throw new n._Boot.HaxeError("Error: Cannot remove from empty list");this.zpp_inner.valmod();var e=null;if(this.zpp_inner.reverse_flag){var t;if(null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null),this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),1==this.zpp_inner.user_length)t=null;else{var i=this.zpp_inner.inner;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t=i.iterator_at(this.zpp_inner.user_length-2)}var r=(e=null==t?this.zpp_inner.inner.head.elt:t.next.elt).outer;null!=this.zpp_inner.subber&&this.zpp_inner.subber(r),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(t)}else{var o=(e=this.zpp_inner.inner.head.elt).outer;null!=this.zpp_inner.subber&&this.zpp_inner.subber(o),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()}return this.zpp_inner.invalidate(),e.outer},e.callbacks.ListenerList.prototype.add=function(e){return this.zpp_inner.reverse_flag?this.push(e):this.unshift(e)},e.callbacks.ListenerList.prototype.remove=function(e){if(this.zpp_inner.immutable)throw new n._Boot.HaxeError("Error: ListenerList is immutable");var t;this.zpp_inner.modify_test(),this.zpp_inner.valmod(),t=!1;for(var i=this.zpp_inner.inner.head;null!=i;){if(i.elt==e.zpp_inner){t=!0;break}i=i.next}return t&&(null!=this.zpp_inner.subber&&this.zpp_inner.subber(e),this.zpp_inner.dontremove||this.zpp_inner.inner.remove(e.zpp_inner),this.zpp_inner.invalidate()),t},e.callbacks.ListenerList.prototype.clear=function(){if(this.zpp_inner.immutable)throw new n._Boot.HaxeError("Error: ListenerList is immutable");if(this.zpp_inner.reverse_flag)for(;null!=this.zpp_inner.inner.head;)this.pop();else for(;null!=this.zpp_inner.inner.head;)this.shift()},e.callbacks.ListenerList.prototype.empty=function(){return null==this.zpp_inner.inner.head},e.callbacks.ListenerList.prototype.iterator=function(){return this.zpp_inner.valmod(),e.callbacks.ListenerIterator.get(this)},e.callbacks.ListenerList.prototype.copy=function(t){null==t&&(t=!1);var i=new e.callbacks.ListenerList;this.zpp_inner.valmod();for(var r=e.callbacks.ListenerIterator.get(this);;){r.zpp_inner.zpp_inner.valmod();var o=r.zpp_inner;o.zpp_inner.valmod(),o.zpp_inner.zip_length&&(o.zpp_inner.zip_length=!1,o.zpp_inner.user_length=o.zpp_inner.inner.length);var a,s=o.zpp_inner.user_length;if(r.zpp_critical=!0,r.zpp_i<s?a=!0:(r.zpp_next=e.callbacks.ListenerIterator.zpp_pool,e.callbacks.ListenerIterator.zpp_pool=r,r.zpp_inner=null,a=!1),!a)break;r.zpp_critical=!1;var l,p=r.zpp_inner.at(r.zpp_i++);if(t)throw new n._Boot.HaxeError("Error: Listener is not a copyable type");l=p,i.push(l)}return i},e.callbacks.ListenerList.prototype.merge=function(t){if(null==t)throw new n._Boot.HaxeError("Error: Cannot merge with null list");t.zpp_inner.valmod();for(var i=e.callbacks.ListenerIterator.get(t);;){i.zpp_inner.zpp_inner.valmod();var r=i.zpp_inner;r.zpp_inner.valmod(),r.zpp_inner.zip_length&&(r.zpp_inner.zip_length=!1,r.zpp_inner.user_length=r.zpp_inner.inner.length);var o,a=r.zpp_inner.user_length;if(i.zpp_critical=!0,i.zpp_i<a?o=!0:(i.zpp_next=e.callbacks.ListenerIterator.zpp_pool,e.callbacks.ListenerIterator.zpp_pool=i,i.zpp_inner=null,o=!1),!o)break;i.zpp_critical=!1;var s=i.zpp_inner.at(i.zpp_i++);this.has(s)||(this.zpp_inner.reverse_flag?this.push(s):this.unshift(s))}},e.callbacks.ListenerList.prototype.toString=function(){var t="[",n=!0;this.zpp_inner.valmod();for(var i=e.callbacks.ListenerIterator.get(this);;){i.zpp_inner.zpp_inner.valmod();var r=i.zpp_inner;r.zpp_inner.valmod(),r.zpp_inner.zip_length&&(r.zpp_inner.zip_length=!1,r.zpp_inner.user_length=r.zpp_inner.inner.length);var o,a=r.zpp_inner.user_length;if(i.zpp_critical=!0,i.zpp_i<a?o=!0:(i.zpp_next=e.callbacks.ListenerIterator.zpp_pool,e.callbacks.ListenerIterator.zpp_pool=i,i.zpp_inner=null,o=!1),!o)break;i.zpp_critical=!1;var s=i.zpp_inner.at(i.zpp_i++);n||(t+=","),t+=null==s?"NULL":s.toString(),n=!1}return t+"]"},e.callbacks.ListenerList.prototype.foreach=function(t){if(null==t)throw new n._Boot.HaxeError("Error: Cannot execute null on list elements");this.zpp_inner.valmod();for(var i=e.callbacks.ListenerIterator.get(this);;){i.zpp_inner.zpp_inner.valmod();var r=i.zpp_inner;r.zpp_inner.valmod(),r.zpp_inner.zip_length&&(r.zpp_inner.zip_length=!1,r.zpp_inner.user_length=r.zpp_inner.inner.length);var o,a=r.zpp_inner.user_length;if(i.zpp_critical=!0,i.zpp_i<a?o=!0:(i.zpp_next=e.callbacks.ListenerIterator.zpp_pool,e.callbacks.ListenerIterator.zpp_pool=i,i.zpp_inner=null,o=!1),!o)break;try{i.zpp_critical=!1,t(i.zpp_inner.at(i.zpp_i++))}catch(t){t instanceof n._Boot.HaxeError&&t.val,i.zpp_next=e.callbacks.ListenerIterator.zpp_pool,e.callbacks.ListenerIterator.zpp_pool=i,i.zpp_inner=null;break}}return this},e.callbacks.ListenerList.prototype.filter=function(e){if(null==e)throw new n._Boot.HaxeError("Error: Cannot select elements of list with null");for(var t=0;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t<this.zpp_inner.user_length;){var i=this.at(t);try{e(i)?++t:this.remove(i)}catch(e){e instanceof n._Boot.HaxeError&&e.val;break}}return this},e.callbacks.ListenerList.prototype.__class__=e.callbacks.ListenerList,e.callbacks.ListenerType=l["nape.callbacks.ListenerType"]=function(){if(!t.util.ZPP_Flags.internal)throw new n._Boot.HaxeError("Error: Cannot instantiate ListenerType derp!")},e.callbacks.ListenerType.__name__=["nape","callbacks","ListenerType"],e.callbacks.ListenerType.BODY=null,e.callbacks.ListenerType.get_BODY=function(){return null==t.util.ZPP_Flags.ListenerType_BODY&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.ListenerType_BODY=new e.callbacks.ListenerType,t.util.ZPP_Flags.internal=!1),t.util.ZPP_Flags.ListenerType_BODY},e.callbacks.ListenerType.CONSTRAINT=null,e.callbacks.ListenerType.get_CONSTRAINT=function(){return null==t.util.ZPP_Flags.ListenerType_CONSTRAINT&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.ListenerType_CONSTRAINT=new e.callbacks.ListenerType,t.util.ZPP_Flags.internal=!1),t.util.ZPP_Flags.ListenerType_CONSTRAINT},e.callbacks.ListenerType.INTERACTION=null,e.callbacks.ListenerType.get_INTERACTION=function(){return null==t.util.ZPP_Flags.ListenerType_INTERACTION&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.ListenerType_INTERACTION=new e.callbacks.ListenerType,t.util.ZPP_Flags.internal=!1),t.util.ZPP_Flags.ListenerType_INTERACTION},e.callbacks.ListenerType.PRE=null,e.callbacks.ListenerType.get_PRE=function(){return null==t.util.ZPP_Flags.ListenerType_PRE&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.ListenerType_PRE=new e.callbacks.ListenerType,t.util.ZPP_Flags.internal=!1),t.util.ZPP_Flags.ListenerType_PRE},e.callbacks.ListenerType.prototype.toString=function(){return null==t.util.ZPP_Flags.ListenerType_BODY&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.ListenerType_BODY=new e.callbacks.ListenerType,t.util.ZPP_Flags.internal=!1),this==t.util.ZPP_Flags.ListenerType_BODY?"BODY":(null==t.util.ZPP_Flags.ListenerType_CONSTRAINT&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.ListenerType_CONSTRAINT=new e.callbacks.ListenerType,t.util.ZPP_Flags.internal=!1),this==t.util.ZPP_Flags.ListenerType_CONSTRAINT?"CONSTRAINT":(null==t.util.ZPP_Flags.ListenerType_INTERACTION&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.ListenerType_INTERACTION=new e.callbacks.ListenerType,t.util.ZPP_Flags.internal=!1),this==t.util.ZPP_Flags.ListenerType_INTERACTION?"INTERACTION":(null==t.util.ZPP_Flags.ListenerType_PRE&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.ListenerType_PRE=new e.callbacks.ListenerType,t.util.ZPP_Flags.internal=!1),this==t.util.ZPP_Flags.ListenerType_PRE?"PRE":"")))},e.callbacks.ListenerType.prototype.__class__=e.callbacks.ListenerType,e.callbacks.OptionType=l["nape.callbacks.OptionType"]=function(e,n){this.zpp_inner=null,this.zpp_inner=new t.callbacks.ZPP_OptionType,this.zpp_inner.outer=this,null!=e&&this.including(e),null!=n&&this.excluding(n)},e.callbacks.OptionType.__name__=["nape","callbacks","OptionType"],e.callbacks.OptionType.prototype.zpp_inner=null,Object.defineProperty(e.callbacks.OptionType.prototype,"includes",{get:e.callbacks.OptionType.prototype.get_includes}),e.callbacks.OptionType.prototype.get_includes=function(){return null==this.zpp_inner.wrap_includes&&this.zpp_inner.setup_includes(),this.zpp_inner.wrap_includes},Object.defineProperty(e.callbacks.OptionType.prototype,"excludes",{get:e.callbacks.OptionType.prototype.get_excludes}),e.callbacks.OptionType.prototype.get_excludes=function(){return null==this.zpp_inner.wrap_excludes&&this.zpp_inner.setup_excludes(),this.zpp_inner.wrap_excludes},e.callbacks.OptionType.prototype.including=function(e){return this.zpp_inner.append(this.zpp_inner.includes,e),this},e.callbacks.OptionType.prototype.excluding=function(e){return this.zpp_inner.append(this.zpp_inner.excludes,e),this},e.callbacks.OptionType.prototype.toString=function(){null==this.zpp_inner.wrap_includes&&this.zpp_inner.setup_includes();var e=this.zpp_inner.wrap_includes.toString();return null==this.zpp_inner.wrap_excludes&&this.zpp_inner.setup_excludes(),"@{"+e+" excluding "+this.zpp_inner.wrap_excludes.toString()+"}"},e.callbacks.OptionType.prototype.__class__=e.callbacks.OptionType,e.callbacks.PreCallback=l["nape.callbacks.PreCallback"]=function(){e.callbacks.Callback.call(this)},e.callbacks.PreCallback.__name__=["nape","callbacks","PreCallback"],e.callbacks.PreCallback.__super__=e.callbacks.Callback,e.callbacks.Callback.prototype)e.callbacks.PreCallback.prototype[u]=e.callbacks.Callback.prototype[u];for(var u in Object.defineProperty(e.callbacks.PreCallback.prototype,"arbiter",{get:e.callbacks.PreCallback.prototype.get_arbiter}),e.callbacks.PreCallback.prototype.get_arbiter=function(){return this.zpp_inner.pre_arbiter.wrapper()},Object.defineProperty(e.callbacks.PreCallback.prototype,"int1",{get:e.callbacks.PreCallback.prototype.get_int1}),e.callbacks.PreCallback.prototype.get_int1=function(){return this.zpp_inner.int1.outer_i},Object.defineProperty(e.callbacks.PreCallback.prototype,"int2",{get:e.callbacks.PreCallback.prototype.get_int2}),e.callbacks.PreCallback.prototype.get_int2=function(){return this.zpp_inner.int2.outer_i},Object.defineProperty(e.callbacks.PreCallback.prototype,"swapped",{get:e.callbacks.PreCallback.prototype.get_swapped}),e.callbacks.PreCallback.prototype.get_swapped=function(){return this.zpp_inner.pre_swapped},e.callbacks.PreCallback.prototype.toString=function(){var e="Cb:PRE:";return e+=":"+this.zpp_inner.int1.outer_i.toString()+"/"+this.zpp_inner.int2.outer_i.toString(),(e+=" : "+this.zpp_inner.pre_arbiter.wrapper().toString())+" : listnener: "+i.string(this.zpp_inner.listener.outer)},e.callbacks.PreCallback.prototype.__class__=e.callbacks.PreCallback,e.callbacks.PreFlag=l["nape.callbacks.PreFlag"]=function(){if(!t.util.ZPP_Flags.internal)throw new n._Boot.HaxeError("Error: Cannot instantiate PreFlag derp!")},e.callbacks.PreFlag.__name__=["nape","callbacks","PreFlag"],e.callbacks.PreFlag.ACCEPT=null,e.callbacks.PreFlag.get_ACCEPT=function(){return null==t.util.ZPP_Flags.PreFlag_ACCEPT&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.PreFlag_ACCEPT=new e.callbacks.PreFlag,t.util.ZPP_Flags.internal=!1),t.util.ZPP_Flags.PreFlag_ACCEPT},e.callbacks.PreFlag.IGNORE=null,e.callbacks.PreFlag.get_IGNORE=function(){return null==t.util.ZPP_Flags.PreFlag_IGNORE&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.PreFlag_IGNORE=new e.callbacks.PreFlag,t.util.ZPP_Flags.internal=!1),t.util.ZPP_Flags.PreFlag_IGNORE},e.callbacks.PreFlag.ACCEPT_ONCE=null,e.callbacks.PreFlag.get_ACCEPT_ONCE=function(){return null==t.util.ZPP_Flags.PreFlag_ACCEPT_ONCE&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.PreFlag_ACCEPT_ONCE=new e.callbacks.PreFlag,t.util.ZPP_Flags.internal=!1),t.util.ZPP_Flags.PreFlag_ACCEPT_ONCE},e.callbacks.PreFlag.IGNORE_ONCE=null,e.callbacks.PreFlag.get_IGNORE_ONCE=function(){return null==t.util.ZPP_Flags.PreFlag_IGNORE_ONCE&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.PreFlag_IGNORE_ONCE=new e.callbacks.PreFlag,t.util.ZPP_Flags.internal=!1),t.util.ZPP_Flags.PreFlag_IGNORE_ONCE},e.callbacks.PreFlag.prototype.toString=function(){return null==t.util.ZPP_Flags.PreFlag_ACCEPT&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.PreFlag_ACCEPT=new e.callbacks.PreFlag,t.util.ZPP_Flags.internal=!1),this==t.util.ZPP_Flags.PreFlag_ACCEPT?"ACCEPT":(null==t.util.ZPP_Flags.PreFlag_IGNORE&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.PreFlag_IGNORE=new e.callbacks.PreFlag,t.util.ZPP_Flags.internal=!1),this==t.util.ZPP_Flags.PreFlag_IGNORE?"IGNORE":(null==t.util.ZPP_Flags.PreFlag_ACCEPT_ONCE&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.PreFlag_ACCEPT_ONCE=new e.callbacks.PreFlag,t.util.ZPP_Flags.internal=!1),this==t.util.ZPP_Flags.PreFlag_ACCEPT_ONCE?"ACCEPT_ONCE":(null==t.util.ZPP_Flags.PreFlag_IGNORE_ONCE&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.PreFlag_IGNORE_ONCE=new e.callbacks.PreFlag,t.util.ZPP_Flags.internal=!1),this==t.util.ZPP_Flags.PreFlag_IGNORE_ONCE?"IGNORE_ONCE":"")))},e.callbacks.PreFlag.prototype.__class__=e.callbacks.PreFlag,e.callbacks.PreListener=l["nape.callbacks.PreListener"]=function(i,r,o,a,s,l){if(null==l&&(l=!1),null==s&&(s=0),this.zpp_inner_zn=null,t.callbacks.ZPP_Listener.internal=!0,e.callbacks.Listener.call(this),t.callbacks.ZPP_Listener.internal=!1,null==a)throw new n._Boot.HaxeError("Error: PreListener must take a handler!");if(this.zpp_inner_zn=new t.callbacks.ZPP_InteractionListener(t.callbacks.ZPP_OptionType.argument(r),t.callbacks.ZPP_OptionType.argument(o),5,3),this.zpp_inner=this.zpp_inner_zn,this.zpp_inner.outer=this,this.zpp_inner_zn.outer_znp=this,this.zpp_inner.precedence=s,this.zpp_inner_zn.pure=l,this.zpp_inner_zn.handlerp=a,null==i)throw new n._Boot.HaxeError("Error: Cannot set listener interaction type to null");var p,u,h=this.zpp_inner_zn.itype;1==h?(null==t.util.ZPP_Flags.InteractionType_COLLISION&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.InteractionType_COLLISION=new e.callbacks.InteractionType,t.util.ZPP_Flags.internal=!1),p=t.util.ZPP_Flags.InteractionType_COLLISION):2==h?(null==t.util.ZPP_Flags.InteractionType_SENSOR&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.InteractionType_SENSOR=new e.callbacks.InteractionType,t.util.ZPP_Flags.internal=!1),p=t.util.ZPP_Flags.InteractionType_SENSOR):4==h?(null==t.util.ZPP_Flags.InteractionType_FLUID&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.InteractionType_FLUID=new e.callbacks.InteractionType,t.util.ZPP_Flags.internal=!1),p=t.util.ZPP_Flags.InteractionType_FLUID):7==h?(null==t.util.ZPP_Flags.InteractionType_ANY&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.InteractionType_ANY=new e.callbacks.InteractionType,t.util.ZPP_Flags.internal=!1),p=t.util.ZPP_Flags.InteractionType_ANY):p=null,p!=i&&(null==t.util.ZPP_Flags.InteractionType_COLLISION&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.InteractionType_COLLISION=new e.callbacks.InteractionType,t.util.ZPP_Flags.internal=!1),i==t.util.ZPP_Flags.InteractionType_COLLISION?u=1:(null==t.util.ZPP_Flags.InteractionType_SENSOR&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.InteractionType_SENSOR=new e.callbacks.InteractionType,t.util.ZPP_Flags.internal=!1),i==t.util.ZPP_Flags.InteractionType_SENSOR?u=2:(null==t.util.ZPP_Flags.InteractionType_FLUID&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.InteractionType_FLUID=new e.callbacks.InteractionType,t.util.ZPP_Flags.internal=!1),u=i==t.util.ZPP_Flags.InteractionType_FLUID?4:7)),this.zpp_inner_zn.itype=u);var c=this.zpp_inner_zn.itype;1==c?null==t.util.ZPP_Flags.InteractionType_COLLISION&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.InteractionType_COLLISION=new e.callbacks.InteractionType,t.util.ZPP_Flags.internal=!1):2==c?null==t.util.ZPP_Flags.InteractionType_SENSOR&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.InteractionType_SENSOR=new e.callbacks.InteractionType,t.util.ZPP_Flags.internal=!1):4==c?null==t.util.ZPP_Flags.InteractionType_FLUID&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.InteractionType_FLUID=new e.callbacks.InteractionType,t.util.ZPP_Flags.internal=!1):7==c&&null==t.util.ZPP_Flags.InteractionType_ANY&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.InteractionType_ANY=new e.callbacks.InteractionType,t.util.ZPP_Flags.internal=!1)},e.callbacks.PreListener.__name__=["nape","callbacks","PreListener"],e.callbacks.PreListener.__super__=e.callbacks.Listener,e.callbacks.Listener.prototype)e.callbacks.PreListener.prototype[u]=e.callbacks.Listener.prototype[u];for(var u in e.callbacks.PreListener.prototype.zpp_inner_zn=null,Object.defineProperty(e.callbacks.PreListener.prototype,"options1",{get:e.callbacks.PreListener.prototype.get_options1,set:e.callbacks.PreListener.prototype.set_options1}),e.callbacks.PreListener.prototype.get_options1=function(){return this.zpp_inner_zn.options1.outer},e.callbacks.PreListener.prototype.set_options1=function(e){return this.zpp_inner_zn.options1.set(e.zpp_inner),this.zpp_inner_zn.options1.outer},Object.defineProperty(e.callbacks.PreListener.prototype,"options2",{get:e.callbacks.PreListener.prototype.get_options2,set:e.callbacks.PreListener.prototype.set_options2}),e.callbacks.PreListener.prototype.get_options2=function(){return this.zpp_inner_zn.options2.outer},e.callbacks.PreListener.prototype.set_options2=function(e){return this.zpp_inner_zn.options2.set(e.zpp_inner),this.zpp_inner_zn.options2.outer},Object.defineProperty(e.callbacks.PreListener.prototype,"handler",{get:e.callbacks.PreListener.prototype.get_handler,set:e.callbacks.PreListener.prototype.set_handler}),e.callbacks.PreListener.prototype.get_handler=function(){return this.zpp_inner_zn.handlerp},e.callbacks.PreListener.prototype.set_handler=function(e){if(null==e)throw new n._Boot.HaxeError("Error: PreListener must take a non-null handler!");return this.zpp_inner_zn.handlerp=e,this.zpp_inner_zn.wake(),this.zpp_inner_zn.handlerp},Object.defineProperty(e.callbacks.PreListener.prototype,"pure",{get:e.callbacks.PreListener.prototype.get_pure,set:e.callbacks.PreListener.prototype.set_pure}),e.callbacks.PreListener.prototype.get_pure=function(){return this.zpp_inner_zn.pure},e.callbacks.PreListener.prototype.set_pure=function(e){return e||this.zpp_inner_zn.wake(),this.zpp_inner_zn.pure=e,this.zpp_inner_zn.pure},Object.defineProperty(e.callbacks.PreListener.prototype,"interactionType",{get:e.callbacks.PreListener.prototype.get_interactionType,set:e.callbacks.PreListener.prototype.set_interactionType}),e.callbacks.PreListener.prototype.get_interactionType=function(){var n=this.zpp_inner_zn.itype;return 1==n?(null==t.util.ZPP_Flags.InteractionType_COLLISION&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.InteractionType_COLLISION=new e.callbacks.InteractionType,t.util.ZPP_Flags.internal=!1),t.util.ZPP_Flags.InteractionType_COLLISION):2==n?(null==t.util.ZPP_Flags.InteractionType_SENSOR&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.InteractionType_SENSOR=new e.callbacks.InteractionType,t.util.ZPP_Flags.internal=!1),t.util.ZPP_Flags.InteractionType_SENSOR):4==n?(null==t.util.ZPP_Flags.InteractionType_FLUID&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.InteractionType_FLUID=new e.callbacks.InteractionType,t.util.ZPP_Flags.internal=!1),t.util.ZPP_Flags.InteractionType_FLUID):7==n?(null==t.util.ZPP_Flags.InteractionType_ANY&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.InteractionType_ANY=new e.callbacks.InteractionType,t.util.ZPP_Flags.internal=!1),t.util.ZPP_Flags.InteractionType_ANY):null},e.callbacks.PreListener.prototype.set_interactionType=function(i){if(null==i)throw new n._Boot.HaxeError("Error: Cannot set listener interaction type to null");var r,o,a=this.zpp_inner_zn.itype;1==a?(null==t.util.ZPP_Flags.InteractionType_COLLISION&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.InteractionType_COLLISION=new e.callbacks.InteractionType,t.util.ZPP_Flags.internal=!1),r=t.util.ZPP_Flags.InteractionType_COLLISION):2==a?(null==t.util.ZPP_Flags.InteractionType_SENSOR&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.InteractionType_SENSOR=new e.callbacks.InteractionType,t.util.ZPP_Flags.internal=!1),r=t.util.ZPP_Flags.InteractionType_SENSOR):4==a?(null==t.util.ZPP_Flags.InteractionType_FLUID&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.InteractionType_FLUID=new e.callbacks.InteractionType,t.util.ZPP_Flags.internal=!1),r=t.util.ZPP_Flags.InteractionType_FLUID):7==a?(null==t.util.ZPP_Flags.InteractionType_ANY&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.InteractionType_ANY=new e.callbacks.InteractionType,t.util.ZPP_Flags.internal=!1),r=t.util.ZPP_Flags.InteractionType_ANY):r=null,r!=i&&(null==t.util.ZPP_Flags.InteractionType_COLLISION&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.InteractionType_COLLISION=new e.callbacks.InteractionType,t.util.ZPP_Flags.internal=!1),i==t.util.ZPP_Flags.InteractionType_COLLISION?o=1:(null==t.util.ZPP_Flags.InteractionType_SENSOR&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.InteractionType_SENSOR=new e.callbacks.InteractionType,t.util.ZPP_Flags.internal=!1),i==t.util.ZPP_Flags.InteractionType_SENSOR?o=2:(null==t.util.ZPP_Flags.InteractionType_FLUID&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.InteractionType_FLUID=new e.callbacks.InteractionType,t.util.ZPP_Flags.internal=!1),o=i==t.util.ZPP_Flags.InteractionType_FLUID?4:7)),this.zpp_inner_zn.itype=o);var s=this.zpp_inner_zn.itype;return 1==s?(null==t.util.ZPP_Flags.InteractionType_COLLISION&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.InteractionType_COLLISION=new e.callbacks.InteractionType,t.util.ZPP_Flags.internal=!1),t.util.ZPP_Flags.InteractionType_COLLISION):2==s?(null==t.util.ZPP_Flags.InteractionType_SENSOR&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.InteractionType_SENSOR=new e.callbacks.InteractionType,t.util.ZPP_Flags.internal=!1),t.util.ZPP_Flags.InteractionType_SENSOR):4==s?(null==t.util.ZPP_Flags.InteractionType_FLUID&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.InteractionType_FLUID=new e.callbacks.InteractionType,t.util.ZPP_Flags.internal=!1),t.util.ZPP_Flags.InteractionType_FLUID):7==s?(null==t.util.ZPP_Flags.InteractionType_ANY&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.InteractionType_ANY=new e.callbacks.InteractionType,t.util.ZPP_Flags.internal=!1),t.util.ZPP_Flags.InteractionType_ANY):null},e.callbacks.PreListener.prototype.__class__=e.callbacks.PreListener,e.constraint||(e.constraint={}),e.constraint.Constraint=l["nape.constraint.Constraint"]=function(){if(this.debugDraw=!0,this.zpp_inner.insert_cbtype(t.callbacks.ZPP_CbType.ANY_CONSTRAINT.zpp_inner),!e.constraint.Constraint.zpp_internalAlloc)throw new n._Boot.HaxeError("Error: Constraint cannot be instantiated derp!")},e.constraint.Constraint.__name__=["nape","constraint","Constraint"],e.constraint.Constraint.prototype.zpp_inner=null,Object.defineProperty(e.constraint.Constraint.prototype,"userData",{get:e.constraint.Constraint.prototype.get_userData}),e.constraint.Constraint.prototype.get_userData=function(){return null==this.zpp_inner.userData&&(this.zpp_inner.userData={}),this.zpp_inner.userData},e.constraint.Constraint.prototype.debugDraw=null,Object.defineProperty(e.constraint.Constraint.prototype,"compound",{get:e.constraint.Constraint.prototype.get_compound,set:e.constraint.Constraint.prototype.set_compound}),e.constraint.Constraint.prototype.get_compound=function(){return null==this.zpp_inner.compound?null:this.zpp_inner.compound.outer},e.constraint.Constraint.prototype.set_compound=function(e){if((null==this.zpp_inner.compound?null:this.zpp_inner.compound.outer)!=e&&(null!=(null==this.zpp_inner.compound?null:this.zpp_inner.compound.outer)&&(null==this.zpp_inner.compound?null:this.zpp_inner.compound.outer).zpp_inner.wrap_constraints.remove(this),null!=e)){var t=e.zpp_inner.wrap_constraints;t.zpp_inner.reverse_flag?t.push(this):t.unshift(this)}return null==this.zpp_inner.compound?null:this.zpp_inner.compound.outer},Object.defineProperty(e.constraint.Constraint.prototype,"space",{get:e.constraint.Constraint.prototype.get_space,set:e.constraint.Constraint.prototype.set_space}),e.constraint.Constraint.prototype.get_space=function(){return null==this.zpp_inner.space?null:this.zpp_inner.space.outer},e.constraint.Constraint.prototype.set_space=function(e){if(null!=this.zpp_inner.compound)throw new n._Boot.HaxeError("Error: Cannot set the space of a Constraint belonging to a Compound, only the root Compound space can be set");if((null==this.zpp_inner.space?null:this.zpp_inner.space.outer)!=e)if(null!=this.zpp_inner.component&&(this.zpp_inner.component.woken=!1),this.zpp_inner.clearcache(),null!=this.zpp_inner.space&&this.zpp_inner.space.outer.zpp_inner.wrap_constraints.remove(this),null!=e){var t=e.zpp_inner.wrap_constraints;t.zpp_inner.reverse_flag?t.push(this):t.unshift(this)}else this.zpp_inner.space=null;return null==this.zpp_inner.space?null:this.zpp_inner.space.outer},Object.defineProperty(e.constraint.Constraint.prototype,"isSleeping",{get:e.constraint.Constraint.prototype.get_isSleeping}),e.constraint.Constraint.prototype.get_isSleeping=function(){if(null==this.zpp_inner.space||!this.zpp_inner.active)throw new n._Boot.HaxeError("Error: isSleeping only makes sense if constraint is active and inside a space");return this.zpp_inner.component.sleeping},Object.defineProperty(e.constraint.Constraint.prototype,"active",{get:e.constraint.Constraint.prototype.get_active,set:e.constraint.Constraint.prototype.set_active}),e.constraint.Constraint.prototype.get_active=function(){return this.zpp_inner.active},e.constraint.Constraint.prototype.set_active=function(e){return this.zpp_inner.active!=e&&(null!=this.zpp_inner.component&&(this.zpp_inner.component.woken=!1),this.zpp_inner.clearcache(),e?(this.zpp_inner.active=e,this.zpp_inner.activate(),null!=this.zpp_inner.space&&(null!=this.zpp_inner.component&&(this.zpp_inner.component.sleeping=!0),this.zpp_inner.space.wake_constraint(this.zpp_inner,!0))):(null!=this.zpp_inner.space&&(this.zpp_inner.wake(),this.zpp_inner.space.live_constraints.remove(this.zpp_inner)),this.zpp_inner.active=e,this.zpp_inner.deactivate())),this.zpp_inner.active},Object.defineProperty(e.constraint.Constraint.prototype,"ignore",{get:e.constraint.Constraint.prototype.get_ignore,set:e.constraint.Constraint.prototype.set_ignore}),e.constraint.Constraint.prototype.get_ignore=function(){return this.zpp_inner.ignore},e.constraint.Constraint.prototype.set_ignore=function(e){return this.zpp_inner.ignore!=e&&(this.zpp_inner.ignore=e,this.zpp_inner.wake()),this.zpp_inner.ignore},Object.defineProperty(e.constraint.Constraint.prototype,"stiff",{get:e.constraint.Constraint.prototype.get_stiff,set:e.constraint.Constraint.prototype.set_stiff}),e.constraint.Constraint.prototype.get_stiff=function(){return this.zpp_inner.stiff},e.constraint.Constraint.prototype.set_stiff=function(e){return this.zpp_inner.stiff!=e&&(this.zpp_inner.stiff=e,this.zpp_inner.wake()),this.zpp_inner.stiff},Object.defineProperty(e.constraint.Constraint.prototype,"frequency",{get:e.constraint.Constraint.prototype.get_frequency,set:e.constraint.Constraint.prototype.set_frequency}),e.constraint.Constraint.prototype.get_frequency=function(){return this.zpp_inner.frequency},e.constraint.Constraint.prototype.set_frequency=function(e){if(e!=e)throw new n._Boot.HaxeError("Error: Constraint::Frequency cannot be NaN");if(e<=0)throw new n._Boot.HaxeError("Error: Constraint::Frequency must be >0");return this.zpp_inner.frequency!=e&&(this.zpp_inner.frequency=e,this.zpp_inner.stiff||this.zpp_inner.wake()),this.zpp_inner.frequency},Object.defineProperty(e.constraint.Constraint.prototype,"damping",{get:e.constraint.Constraint.prototype.get_damping,set:e.constraint.Constraint.prototype.set_damping}),e.constraint.Constraint.prototype.get_damping=function(){return this.zpp_inner.damping},e.constraint.Constraint.prototype.set_damping=function(e){if(e!=e)throw new n._Boot.HaxeError("Error: Constraint::Damping cannot be Nan");if(e<0)throw new n._Boot.HaxeError("Error: Constraint::Damping must be >=0");return this.zpp_inner.damping!=e&&(this.zpp_inner.damping=e,this.zpp_inner.stiff||this.zpp_inner.wake()),this.zpp_inner.damping},Object.defineProperty(e.constraint.Constraint.prototype,"maxForce",{get:e.constraint.Constraint.prototype.get_maxForce,set:e.constraint.Constraint.prototype.set_maxForce}),e.constraint.Constraint.prototype.get_maxForce=function(){return this.zpp_inner.maxForce},e.constraint.Constraint.prototype.set_maxForce=function(e){if(e!=e)throw new n._Boot.HaxeError("Error: Constraint::maxForce cannot be NaN");if(e<0)throw new n._Boot.HaxeError("Error: Constraint::maxForce must be >=0");return this.zpp_inner.maxForce!=e&&(this.zpp_inner.maxForce=e,this.zpp_inner.wake()),this.zpp_inner.maxForce},Object.defineProperty(e.constraint.Constraint.prototype,"maxError",{get:e.constraint.Constraint.prototype.get_maxError,set:e.constraint.Constraint.prototype.set_maxError}),e.constraint.Constraint.prototype.get_maxError=function(){return this.zpp_inner.maxError},e.constraint.Constraint.prototype.set_maxError=function(e){if(e!=e)throw new n._Boot.HaxeError("Error: Constraint::maxError cannot be NaN");if(e<0)throw new n._Boot.HaxeError("Error: Constraint::maxError must be >=0");return this.zpp_inner.maxError!=e&&(this.zpp_inner.maxError=e,this.zpp_inner.wake()),this.zpp_inner.maxError},Object.defineProperty(e.constraint.Constraint.prototype,"breakUnderForce",{get:e.constraint.Constraint.prototype.get_breakUnderForce,set:e.constraint.Constraint.prototype.set_breakUnderForce}),e.constraint.Constraint.prototype.get_breakUnderForce=function(){return this.zpp_inner.breakUnderForce},e.constraint.Constraint.prototype.set_breakUnderForce=function(e){return this.zpp_inner.breakUnderForce!=e&&(this.zpp_inner.breakUnderForce=e,this.zpp_inner.wake()),this.zpp_inner.breakUnderForce},Object.defineProperty(e.constraint.Constraint.prototype,"breakUnderError",{get:e.constraint.Constraint.prototype.get_breakUnderError,set:e.constraint.Constraint.prototype.set_breakUnderError}),e.constraint.Constraint.prototype.get_breakUnderError=function(){return this.zpp_inner.breakUnderError},e.constraint.Constraint.prototype.set_breakUnderError=function(e){return this.zpp_inner.breakUnderError!=e&&(this.zpp_inner.breakUnderError=e,this.zpp_inner.wake()),this.zpp_inner.breakUnderError},Object.defineProperty(e.constraint.Constraint.prototype,"removeOnBreak",{get:e.constraint.Constraint.prototype.get_removeOnBreak,set:e.constraint.Constraint.prototype.set_removeOnBreak}),e.constraint.Constraint.prototype.get_removeOnBreak=function(){return this.zpp_inner.removeOnBreak},e.constraint.Constraint.prototype.set_removeOnBreak=function(e){return this.zpp_inner.removeOnBreak=e,this.zpp_inner.removeOnBreak},e.constraint.Constraint.prototype.impulse=function(){return null},e.constraint.Constraint.prototype.bodyImpulse=function(e){return null},e.constraint.Constraint.prototype.visitBodies=function(e){},Object.defineProperty(e.constraint.Constraint.prototype,"cbTypes",{get:e.constraint.Constraint.prototype.get_cbTypes}),e.constraint.Constraint.prototype.get_cbTypes=function(){return null==this.zpp_inner.wrap_cbTypes&&this.zpp_inner.setupcbTypes(),this.zpp_inner.wrap_cbTypes},e.constraint.Constraint.prototype.toString=function(){return"{Constraint}"},e.constraint.Constraint.prototype.copy=function(){return this.zpp_inner.copy()},e.constraint.Constraint.prototype.__class__=e.constraint.Constraint,e.constraint.AngleJoint=l["nape.constraint.AngleJoint"]=function(i,r,o,a,s){null==s&&(s=1),this.zpp_inner_zn=null,this.zpp_inner_zn=new t.constraint.ZPP_AngleJoint,this.zpp_inner=this.zpp_inner_zn,this.zpp_inner.outer=this,this.zpp_inner_zn.outer_zn=this,e.constraint.Constraint.zpp_internalAlloc=!0,e.constraint.Constraint.call(this),e.constraint.Constraint.zpp_internalAlloc=!1,this.zpp_inner.immutable_midstep("Constraint::body1");var l=null==i?null:i.zpp_inner;l!=this.zpp_inner_zn.b1&&(null!=this.zpp_inner_zn.b1&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2!=this.zpp_inner_zn.b1&&null!=this.zpp_inner_zn.b1&&this.zpp_inner_zn.b1.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1.wake()),this.zpp_inner_zn.b1=l,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=l&&this.zpp_inner_zn.b2!=l&&null!=l&&l.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=l&&l.wake())),this.zpp_inner_zn.b1,this.zpp_inner.immutable_midstep("Constraint::body2");var p=null==r?null:r.zpp_inner;if(p!=this.zpp_inner_zn.b2&&(null!=this.zpp_inner_zn.b2&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1!=this.zpp_inner_zn.b2&&null!=this.zpp_inner_zn.b2&&this.zpp_inner_zn.b2.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2.wake()),this.zpp_inner_zn.b2=p,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=p&&this.zpp_inner_zn.b1!=p&&null!=p&&p.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=p&&p.wake())),this.zpp_inner_zn.b2,this.zpp_inner.immutable_midstep("AngleJoint::jointMin"),o!=o)throw new n._Boot.HaxeError("Error: AngleJoint::jointMin cannot be NaN");if(this.zpp_inner_zn.jointMin!=o&&(this.zpp_inner_zn.jointMin=o,this.zpp_inner.wake()),this.zpp_inner.immutable_midstep("AngleJoint::jointMax"),a!=a)throw new n._Boot.HaxeError("Error: AngleJoint::jointMax cannot be NaN");if(this.zpp_inner_zn.jointMax!=a&&(this.zpp_inner_zn.jointMax=a,this.zpp_inner.wake()),this.zpp_inner.immutable_midstep("AngleJoint::ratio"),s!=s)throw new n._Boot.HaxeError("Error: AngleJoint::ratio cannot be NaN");this.zpp_inner_zn.ratio!=s&&(this.zpp_inner_zn.ratio=s,this.zpp_inner.wake())},e.constraint.AngleJoint.__name__=["nape","constraint","AngleJoint"],e.constraint.AngleJoint.__super__=e.constraint.Constraint,e.constraint.Constraint.prototype)e.constraint.AngleJoint.prototype[u]=e.constraint.Constraint.prototype[u];for(var u in e.constraint.AngleJoint.prototype.zpp_inner_zn=null,Object.defineProperty(e.constraint.AngleJoint.prototype,"body1",{get:e.constraint.AngleJoint.prototype.get_body1,set:e.constraint.AngleJoint.prototype.set_body1}),e.constraint.AngleJoint.prototype.get_body1=function(){return null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer},e.constraint.AngleJoint.prototype.set_body1=function(e){this.zpp_inner.immutable_midstep("Constraint::body1");var t=null==e?null:e.zpp_inner;return t!=this.zpp_inner_zn.b1&&(null!=this.zpp_inner_zn.b1&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2!=this.zpp_inner_zn.b1&&null!=this.zpp_inner_zn.b1&&this.zpp_inner_zn.b1.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1.wake()),this.zpp_inner_zn.b1=t,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=t&&this.zpp_inner_zn.b2!=t&&null!=t&&t.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=t&&t.wake())),null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer},Object.defineProperty(e.constraint.AngleJoint.prototype,"body2",{get:e.constraint.AngleJoint.prototype.get_body2,set:e.constraint.AngleJoint.prototype.set_body2}),e.constraint.AngleJoint.prototype.get_body2=function(){return null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer},e.constraint.AngleJoint.prototype.set_body2=function(e){this.zpp_inner.immutable_midstep("Constraint::body2");var t=null==e?null:e.zpp_inner;return t!=this.zpp_inner_zn.b2&&(null!=this.zpp_inner_zn.b2&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1!=this.zpp_inner_zn.b2&&null!=this.zpp_inner_zn.b2&&this.zpp_inner_zn.b2.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2.wake()),this.zpp_inner_zn.b2=t,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=t&&this.zpp_inner_zn.b1!=t&&null!=t&&t.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=t&&t.wake())),null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer},Object.defineProperty(e.constraint.AngleJoint.prototype,"jointMin",{get:e.constraint.AngleJoint.prototype.get_jointMin,set:e.constraint.AngleJoint.prototype.set_jointMin}),e.constraint.AngleJoint.prototype.get_jointMin=function(){return this.zpp_inner_zn.jointMin},e.constraint.AngleJoint.prototype.set_jointMin=function(e){if(this.zpp_inner.immutable_midstep("AngleJoint::jointMin"),e!=e)throw new n._Boot.HaxeError("Error: AngleJoint::jointMin cannot be NaN");return this.zpp_inner_zn.jointMin!=e&&(this.zpp_inner_zn.jointMin=e,this.zpp_inner.wake()),this.zpp_inner_zn.jointMin},Object.defineProperty(e.constraint.AngleJoint.prototype,"jointMax",{get:e.constraint.AngleJoint.prototype.get_jointMax,set:e.constraint.AngleJoint.prototype.set_jointMax}),e.constraint.AngleJoint.prototype.get_jointMax=function(){return this.zpp_inner_zn.jointMax},e.constraint.AngleJoint.prototype.set_jointMax=function(e){if(this.zpp_inner.immutable_midstep("AngleJoint::jointMax"),e!=e)throw new n._Boot.HaxeError("Error: AngleJoint::jointMax cannot be NaN");return this.zpp_inner_zn.jointMax!=e&&(this.zpp_inner_zn.jointMax=e,this.zpp_inner.wake()),this.zpp_inner_zn.jointMax},Object.defineProperty(e.constraint.AngleJoint.prototype,"ratio",{get:e.constraint.AngleJoint.prototype.get_ratio,set:e.constraint.AngleJoint.prototype.set_ratio}),e.constraint.AngleJoint.prototype.get_ratio=function(){return this.zpp_inner_zn.ratio},e.constraint.AngleJoint.prototype.set_ratio=function(e){if(this.zpp_inner.immutable_midstep("AngleJoint::ratio"),e!=e)throw new n._Boot.HaxeError("Error: AngleJoint::ratio cannot be NaN");return this.zpp_inner_zn.ratio!=e&&(this.zpp_inner_zn.ratio=e,this.zpp_inner.wake()),this.zpp_inner_zn.ratio},e.constraint.AngleJoint.prototype.isSlack=function(){if(null==(null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer)||null==(null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer))throw new n._Boot.HaxeError("Error: Cannot compute slack for AngleJoint if either body is null.");var e,t=this.zpp_inner_zn,i=t.ratio*t.b2.rot-t.b1.rot;return t.equal?(i-=t.jointMax,e=!1,t.scale=1):i<t.jointMin?(i=t.jointMin-i,t.scale=-1,e=!1):i>t.jointMax?(i-=t.jointMax,t.scale=1,e=!1):(t.scale=0,i=0,e=!0),e},e.constraint.AngleJoint.prototype.impulse=function(){var t=new e.geom.MatMN(1,1);if(0>=t.zpp_inner.m||0>=t.zpp_inner.n)throw new n._Boot.HaxeError("Error: MatMN indices out of range");return t.zpp_inner.x[0*t.zpp_inner.n]=this.zpp_inner_zn.jAcc,t},e.constraint.AngleJoint.prototype.bodyImpulse=function(t){if(null==t)throw new n._Boot.HaxeError("Error: Cannot evaluate impulse on null body");if(t!=(null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer)&&t!=(null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer))throw new n._Boot.HaxeError("Error: Body is not linked to this constraint");return this.zpp_inner.active?this.zpp_inner_zn.bodyImpulse(t.zpp_inner):e.geom.Vec3.get(0,0,0)},e.constraint.AngleJoint.prototype.visitBodies=function(e){if(null==e)throw new n._Boot.HaxeError("Error: Cannot apply null lambda to bodies");null!=(null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer)&&e(null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer),null!=(null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer)&&(null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer)!=(null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer)&&e(null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer)},e.constraint.AngleJoint.prototype.__class__=e.constraint.AngleJoint,e.constraint.ConstraintIterator=l["nape.constraint.ConstraintIterator"]=function(){if(this.zpp_next=null,this.zpp_critical=!1,this.zpp_i=0,this.zpp_inner=null,!t.util.ZPP_ConstraintList.internal)throw new n._Boot.HaxeError("Error: Cannot instantiate ConstraintIterator derp!")},e.constraint.ConstraintIterator.__name__=["nape","constraint","ConstraintIterator"],e.constraint.ConstraintIterator.get=function(n){var i;if(null==e.constraint.ConstraintIterator.zpp_pool){t.util.ZPP_ConstraintList.internal=!0;var r=new e.constraint.ConstraintIterator;t.util.ZPP_ConstraintList.internal=!1,i=r}else{var o=e.constraint.ConstraintIterator.zpp_pool;e.constraint.ConstraintIterator.zpp_pool=o.zpp_next,i=o}return i.zpp_i=0,i.zpp_inner=n,i.zpp_critical=!1,i},e.constraint.ConstraintIterator.prototype.zpp_inner=null,e.constraint.ConstraintIterator.prototype.zpp_i=null,e.constraint.ConstraintIterator.prototype.zpp_critical=null,e.constraint.ConstraintIterator.prototype.zpp_next=null,e.constraint.ConstraintIterator.prototype.hasNext=function(){this.zpp_inner.zpp_inner.valmod();var t=this.zpp_inner;t.zpp_inner.valmod(),t.zpp_inner.zip_length&&(t.zpp_inner.zip_length=!1,t.zpp_inner.user_length=t.zpp_inner.inner.length);var n=t.zpp_inner.user_length;return this.zpp_critical=!0,this.zpp_i<n||(this.zpp_next=e.constraint.ConstraintIterator.zpp_pool,e.constraint.ConstraintIterator.zpp_pool=this,this.zpp_inner=null,!1)},e.constraint.ConstraintIterator.prototype.next=function(){return this.zpp_critical=!1,this.zpp_inner.at(this.zpp_i++)},e.constraint.ConstraintIterator.prototype.__class__=e.constraint.ConstraintIterator,e.constraint.ConstraintList=l["nape.constraint.ConstraintList"]=function(){this.zpp_inner=null,this.zpp_inner=new t.util.ZPP_ConstraintList,this.zpp_inner.outer=this},e.constraint.ConstraintList.__name__=["nape","constraint","ConstraintList"],e.constraint.ConstraintList.fromArray=function(t){if(null==t)throw new n._Boot.HaxeError("Error: Cannot convert null Array to Nape list");for(var i=new e.constraint.ConstraintList,r=0;r<t.length;){var o=t[r];++r,i.push(o)}return i},e.constraint.ConstraintList.prototype.zpp_inner=null,Object.defineProperty(e.constraint.ConstraintList.prototype,"length",{get:e.constraint.ConstraintList.prototype.get_length}),e.constraint.ConstraintList.prototype.get_length=function(){return this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.user_length},e.constraint.ConstraintList.prototype.has=function(e){return this.zpp_inner.valmod(),this.zpp_inner.inner.has(e.zpp_inner)},e.constraint.ConstraintList.prototype.at=function(e){var t;if(this.zpp_inner.valmod(),e>=0?(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t=e>=this.zpp_inner.user_length):t=!0,t)throw new n._Boot.HaxeError("Error: Index out of bounds");if(this.zpp_inner.reverse_flag&&(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),e=this.zpp_inner.user_length-1-e),e<this.zpp_inner.at_index||null==this.zpp_inner.at_ite)this.zpp_inner.at_index=e,this.zpp_inner.at_ite=this.zpp_inner.inner.iterator_at(e);else for(;this.zpp_inner.at_index!=e;)this.zpp_inner.at_index++,this.zpp_inner.at_ite=this.zpp_inner.at_ite.next;return this.zpp_inner.at_ite.elt.outer},e.constraint.ConstraintList.prototype.push=function(e){if(this.zpp_inner.immutable)throw new n._Boot.HaxeError("Error: ConstraintList is immutable");this.zpp_inner.modify_test(),this.zpp_inner.valmod();var t=null==this.zpp_inner.adder||this.zpp_inner.adder(e);if(t){if(this.zpp_inner.reverse_flag)this.zpp_inner.inner.add(e.zpp_inner);else{if(null==this.zpp_inner.push_ite){var i;if(null==this.zpp_inner.inner.head)i=null;else{var r=this.zpp_inner.inner;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),i=r.iterator_at(this.zpp_inner.user_length-1)}this.zpp_inner.push_ite=i}this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,e.zpp_inner)}this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(e)}return t},e.constraint.ConstraintList.prototype.unshift=function(e){if(this.zpp_inner.immutable)throw new n._Boot.HaxeError("Error: ConstraintList is immutable");this.zpp_inner.modify_test(),this.zpp_inner.valmod();var t=null==this.zpp_inner.adder||this.zpp_inner.adder(e);if(t){if(this.zpp_inner.reverse_flag){if(null==this.zpp_inner.push_ite){var i;if(null==this.zpp_inner.inner.head)i=null;else{var r=this.zpp_inner.inner;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),i=r.iterator_at(this.zpp_inner.user_length-1)}this.zpp_inner.push_ite=i}this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,e.zpp_inner)}else this.zpp_inner.inner.add(e.zpp_inner);this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(e)}return t},e.constraint.ConstraintList.prototype.pop=function(){if(this.zpp_inner.immutable)throw new n._Boot.HaxeError("Error: ConstraintList is immutable");if(this.zpp_inner.modify_test(),null==this.zpp_inner.inner.head)throw new n._Boot.HaxeError("Error: Cannot remove from empty list");this.zpp_inner.valmod();var e=null;if(this.zpp_inner.reverse_flag){var t=(e=this.zpp_inner.inner.head.elt).outer;null!=this.zpp_inner.subber&&this.zpp_inner.subber(t),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()}else{var i;if(null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null),this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),1==this.zpp_inner.user_length)i=null;else{var r=this.zpp_inner.inner;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),i=r.iterator_at(this.zpp_inner.user_length-2)}var o=(e=null==i?this.zpp_inner.inner.head.elt:i.next.elt).outer;null!=this.zpp_inner.subber&&this.zpp_inner.subber(o),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(i)}return this.zpp_inner.invalidate(),e.outer},e.constraint.ConstraintList.prototype.shift=function(){if(this.zpp_inner.immutable)throw new n._Boot.HaxeError("Error: ConstraintList is immutable");if(this.zpp_inner.modify_test(),null==this.zpp_inner.inner.head)throw new n._Boot.HaxeError("Error: Cannot remove from empty list");this.zpp_inner.valmod();var e=null;if(this.zpp_inner.reverse_flag){var t;if(null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null),this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),1==this.zpp_inner.user_length)t=null;else{var i=this.zpp_inner.inner;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t=i.iterator_at(this.zpp_inner.user_length-2)}var r=(e=null==t?this.zpp_inner.inner.head.elt:t.next.elt).outer;null!=this.zpp_inner.subber&&this.zpp_inner.subber(r),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(t)}else{var o=(e=this.zpp_inner.inner.head.elt).outer;null!=this.zpp_inner.subber&&this.zpp_inner.subber(o),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()}return this.zpp_inner.invalidate(),e.outer},e.constraint.ConstraintList.prototype.add=function(e){return this.zpp_inner.reverse_flag?this.push(e):this.unshift(e)},e.constraint.ConstraintList.prototype.remove=function(e){if(this.zpp_inner.immutable)throw new n._Boot.HaxeError("Error: ConstraintList is immutable");var t;this.zpp_inner.modify_test(),this.zpp_inner.valmod(),t=!1;for(var i=this.zpp_inner.inner.head;null!=i;){if(i.elt==e.zpp_inner){t=!0;break}i=i.next}return t&&(null!=this.zpp_inner.subber&&this.zpp_inner.subber(e),this.zpp_inner.dontremove||this.zpp_inner.inner.remove(e.zpp_inner),this.zpp_inner.invalidate()),t},e.constraint.ConstraintList.prototype.clear=function(){if(this.zpp_inner.immutable)throw new n._Boot.HaxeError("Error: ConstraintList is immutable");if(this.zpp_inner.reverse_flag)for(;null!=this.zpp_inner.inner.head;)this.pop();else for(;null!=this.zpp_inner.inner.head;)this.shift()},e.constraint.ConstraintList.prototype.empty=function(){return null==this.zpp_inner.inner.head},e.constraint.ConstraintList.prototype.iterator=function(){return this.zpp_inner.valmod(),e.constraint.ConstraintIterator.get(this)},e.constraint.ConstraintList.prototype.copy=function(t){null==t&&(t=!1);var i=new e.constraint.ConstraintList;this.zpp_inner.valmod();for(var r=e.constraint.ConstraintIterator.get(this);;){r.zpp_inner.zpp_inner.valmod();var o=r.zpp_inner;o.zpp_inner.valmod(),o.zpp_inner.zip_length&&(o.zpp_inner.zip_length=!1,o.zpp_inner.user_length=o.zpp_inner.inner.length);var a,s=o.zpp_inner.user_length;if(r.zpp_critical=!0,r.zpp_i<s?a=!0:(r.zpp_next=e.constraint.ConstraintIterator.zpp_pool,e.constraint.ConstraintIterator.zpp_pool=r,r.zpp_inner=null,a=!1),!a)break;r.zpp_critical=!1;var l,p=r.zpp_inner.at(r.zpp_i++);if(t)throw new n._Boot.HaxeError("Error: Constraint is not a copyable type");l=p,i.push(l)}return i},e.constraint.ConstraintList.prototype.merge=function(t){if(null==t)throw new n._Boot.HaxeError("Error: Cannot merge with null list");t.zpp_inner.valmod();for(var i=e.constraint.ConstraintIterator.get(t);;){i.zpp_inner.zpp_inner.valmod();var r=i.zpp_inner;r.zpp_inner.valmod(),r.zpp_inner.zip_length&&(r.zpp_inner.zip_length=!1,r.zpp_inner.user_length=r.zpp_inner.inner.length);var o,a=r.zpp_inner.user_length;if(i.zpp_critical=!0,i.zpp_i<a?o=!0:(i.zpp_next=e.constraint.ConstraintIterator.zpp_pool,e.constraint.ConstraintIterator.zpp_pool=i,i.zpp_inner=null,o=!1),!o)break;i.zpp_critical=!1;var s=i.zpp_inner.at(i.zpp_i++);this.has(s)||(this.zpp_inner.reverse_flag?this.push(s):this.unshift(s))}},e.constraint.ConstraintList.prototype.toString=function(){var t="[",n=!0;this.zpp_inner.valmod();for(var i=e.constraint.ConstraintIterator.get(this);;){i.zpp_inner.zpp_inner.valmod();var r=i.zpp_inner;r.zpp_inner.valmod(),r.zpp_inner.zip_length&&(r.zpp_inner.zip_length=!1,r.zpp_inner.user_length=r.zpp_inner.inner.length);var o,a=r.zpp_inner.user_length;if(i.zpp_critical=!0,i.zpp_i<a?o=!0:(i.zpp_next=e.constraint.ConstraintIterator.zpp_pool,e.constraint.ConstraintIterator.zpp_pool=i,i.zpp_inner=null,o=!1),!o)break;i.zpp_critical=!1;var s=i.zpp_inner.at(i.zpp_i++);n||(t+=","),t+=null==s?"NULL":s.toString(),n=!1}return t+"]"},e.constraint.ConstraintList.prototype.foreach=function(t){if(null==t)throw new n._Boot.HaxeError("Error: Cannot execute null on list elements");this.zpp_inner.valmod();for(var i=e.constraint.ConstraintIterator.get(this);;){i.zpp_inner.zpp_inner.valmod();var r=i.zpp_inner;r.zpp_inner.valmod(),r.zpp_inner.zip_length&&(r.zpp_inner.zip_length=!1,r.zpp_inner.user_length=r.zpp_inner.inner.length);var o,a=r.zpp_inner.user_length;if(i.zpp_critical=!0,i.zpp_i<a?o=!0:(i.zpp_next=e.constraint.ConstraintIterator.zpp_pool,e.constraint.ConstraintIterator.zpp_pool=i,i.zpp_inner=null,o=!1),!o)break;try{i.zpp_critical=!1,t(i.zpp_inner.at(i.zpp_i++))}catch(t){t instanceof n._Boot.HaxeError&&t.val,i.zpp_next=e.constraint.ConstraintIterator.zpp_pool,e.constraint.ConstraintIterator.zpp_pool=i,i.zpp_inner=null;break}}return this},e.constraint.ConstraintList.prototype.filter=function(e){if(null==e)throw new n._Boot.HaxeError("Error: Cannot select elements of list with null");for(var t=0;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t<this.zpp_inner.user_length;){var i=this.at(t);try{e(i)?++t:this.remove(i)}catch(e){e instanceof n._Boot.HaxeError&&e.val;break}}return this},e.constraint.ConstraintList.prototype.__class__=e.constraint.ConstraintList,e.constraint.DistanceJoint=l["nape.constraint.DistanceJoint"]=function(i,r,o,a,s,l){this.zpp_inner_zn=null,this.zpp_inner_zn=new t.constraint.ZPP_DistanceJoint,this.zpp_inner=this.zpp_inner_zn,this.zpp_inner.outer=this,this.zpp_inner_zn.outer_zn=this,e.constraint.Constraint.zpp_internalAlloc=!0,e.constraint.Constraint.call(this),e.constraint.Constraint.zpp_internalAlloc=!1,this.zpp_inner.immutable_midstep("Constraint::body1");var p=null==i?null:i.zpp_inner;p!=this.zpp_inner_zn.b1&&(null!=this.zpp_inner_zn.b1&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2!=this.zpp_inner_zn.b1&&null!=this.zpp_inner_zn.b1&&this.zpp_inner_zn.b1.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1.wake()),this.zpp_inner_zn.b1=p,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=p&&this.zpp_inner_zn.b2!=p&&null!=p&&p.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=p&&p.wake())),this.zpp_inner_zn.b1,this.zpp_inner.immutable_midstep("Constraint::body2");var u=null==r?null:r.zpp_inner;if(u!=this.zpp_inner_zn.b2&&(null!=this.zpp_inner_zn.b2&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1!=this.zpp_inner_zn.b2&&null!=this.zpp_inner_zn.b2&&this.zpp_inner_zn.b2.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2.wake()),this.zpp_inner_zn.b2=u,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=u&&this.zpp_inner_zn.b1!=u&&null!=u&&u.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=u&&u.wake())),this.zpp_inner_zn.b2,null!=o&&o.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");if(null==o)throw new n._Boot.HaxeError("Error: Constraint::anchor1 cannot be null");null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1();var h=this.zpp_inner_zn.wrap_a1;if(null!=h&&h.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");if(null!=o&&o.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var c=h.zpp_inner;if(c._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=c._isimmutable&&c._isimmutable(),null==o)throw new n._Boot.HaxeError("Error: Cannot assign null Vec2");if(null!=o&&o.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var _=o.zpp_inner;null!=_._validate&&_._validate();var d=o.zpp_inner.x;if(null!=o&&o.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var m=o.zpp_inner;null!=m._validate&&m._validate();var P=o.zpp_inner.y;if(null!=h&&h.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var f,x=h.zpp_inner;if(x._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=x._isimmutable&&x._isimmutable(),d!=d||P!=P)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null!=h&&h.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var y=h.zpp_inner;if(null!=y._validate&&y._validate(),h.zpp_inner.x==d){if(null!=h&&h.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var v=h.zpp_inner;null!=v._validate&&v._validate(),f=h.zpp_inner.y==P}else f=!1;if(!f){h.zpp_inner.x=d,h.zpp_inner.y=P;var g=h.zpp_inner;null!=g._invalidate&&g._invalidate(g)}if(o.zpp_inner.weak){if(null!=o&&o.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var b=o.zpp_inner;if(b._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=b._isimmutable&&b._isimmutable(),o.zpp_inner._inuse)throw new n._Boot.HaxeError("Error: This Vec2 is not disposable");var z=o.zpp_inner;o.zpp_inner.outer=null,o.zpp_inner=null;var w=o;w.zpp_pool=null,null!=t.util.ZPP_PubPool.nextVec2?t.util.ZPP_PubPool.nextVec2.zpp_pool=w:t.util.ZPP_PubPool.poolVec2=w,t.util.ZPP_PubPool.nextVec2=w,w.zpp_disp=!0;var Z=z;null!=Z.outer&&(Z.outer.zpp_inner=null,Z.outer=null),Z._isimmutable=null,Z._validate=null,Z._invalidate=null,Z.next=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=Z}if(null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1(),null!=a&&a.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");if(null==a)throw new n._Boot.HaxeError("Error: Constraint::anchor2 cannot be null");null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2();var E=this.zpp_inner_zn.wrap_a2;if(null!=E&&E.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");if(null!=a&&a.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var M=E.zpp_inner;if(M._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=M._isimmutable&&M._isimmutable(),null==a)throw new n._Boot.HaxeError("Error: Cannot assign null Vec2");if(null!=a&&a.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var S=a.zpp_inner;null!=S._validate&&S._validate();var C=a.zpp_inner.x;if(null!=a&&a.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var N=a.zpp_inner;null!=N._validate&&N._validate();var A=a.zpp_inner.y;if(null!=E&&E.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var L,B=E.zpp_inner;if(B._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=B._isimmutable&&B._isimmutable(),C!=C||A!=A)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null!=E&&E.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var T=E.zpp_inner;if(null!=T._validate&&T._validate(),E.zpp_inner.x==C){if(null!=E&&E.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var V=E.zpp_inner;null!=V._validate&&V._validate(),L=E.zpp_inner.y==A}else L=!1;if(!L){E.zpp_inner.x=C,E.zpp_inner.y=A;var k=E.zpp_inner;null!=k._invalidate&&k._invalidate(k)}if(a.zpp_inner.weak){if(null!=a&&a.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var I=a.zpp_inner;if(I._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=I._isimmutable&&I._isimmutable(),a.zpp_inner._inuse)throw new n._Boot.HaxeError("Error: This Vec2 is not disposable");var O=a.zpp_inner;a.zpp_inner.outer=null,a.zpp_inner=null;var R=a;R.zpp_pool=null,null!=t.util.ZPP_PubPool.nextVec2?t.util.ZPP_PubPool.nextVec2.zpp_pool=R:t.util.ZPP_PubPool.poolVec2=R,t.util.ZPP_PubPool.nextVec2=R,R.zpp_disp=!0;var H=O;null!=H.outer&&(H.outer.zpp_inner=null,H.outer=null),H._isimmutable=null,H._validate=null,H._invalidate=null,H.next=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=H}if(null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2(),this.zpp_inner.immutable_midstep("DistanceJoint::jointMin"),s!=s)throw new n._Boot.HaxeError("Error: DistanceJoint::jointMin cannot be NaN");if(s<0)throw new n._Boot.HaxeError("Error: DistanceJoint::jointMin must be >= 0");if(this.zpp_inner_zn.jointMin!=s&&(this.zpp_inner_zn.jointMin=s,this.zpp_inner.wake()),this.zpp_inner.immutable_midstep("DistanceJoint::jointMax"),l!=l)throw new n._Boot.HaxeError("Error: DistanceJoint::jointMax cannot be NaN");if(l<0)throw new n._Boot.HaxeError("Error: DistanceJoint::jointMax must be >= 0");this.zpp_inner_zn.jointMax!=l&&(this.zpp_inner_zn.jointMax=l,this.zpp_inner.wake())},e.constraint.DistanceJoint.__name__=["nape","constraint","DistanceJoint"],e.constraint.DistanceJoint.__super__=e.constraint.Constraint,e.constraint.Constraint.prototype)e.constraint.DistanceJoint.prototype[u]=e.constraint.Constraint.prototype[u];for(var u in e.constraint.DistanceJoint.prototype.zpp_inner_zn=null,Object.defineProperty(e.constraint.DistanceJoint.prototype,"body1",{get:e.constraint.DistanceJoint.prototype.get_body1,set:e.constraint.DistanceJoint.prototype.set_body1}),e.constraint.DistanceJoint.prototype.get_body1=function(){return null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer},e.constraint.DistanceJoint.prototype.set_body1=function(e){this.zpp_inner.immutable_midstep("Constraint::body1");var t=null==e?null:e.zpp_inner;return t!=this.zpp_inner_zn.b1&&(null!=this.zpp_inner_zn.b1&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2!=this.zpp_inner_zn.b1&&null!=this.zpp_inner_zn.b1&&this.zpp_inner_zn.b1.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1.wake()),this.zpp_inner_zn.b1=t,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=t&&this.zpp_inner_zn.b2!=t&&null!=t&&t.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=t&&t.wake())),null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer},Object.defineProperty(e.constraint.DistanceJoint.prototype,"body2",{get:e.constraint.DistanceJoint.prototype.get_body2,set:e.constraint.DistanceJoint.prototype.set_body2}),e.constraint.DistanceJoint.prototype.get_body2=function(){return null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer},e.constraint.DistanceJoint.prototype.set_body2=function(e){this.zpp_inner.immutable_midstep("Constraint::body2");var t=null==e?null:e.zpp_inner;return t!=this.zpp_inner_zn.b2&&(null!=this.zpp_inner_zn.b2&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1!=this.zpp_inner_zn.b2&&null!=this.zpp_inner_zn.b2&&this.zpp_inner_zn.b2.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2.wake()),this.zpp_inner_zn.b2=t,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=t&&this.zpp_inner_zn.b1!=t&&null!=t&&t.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=t&&t.wake())),null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer},Object.defineProperty(e.constraint.DistanceJoint.prototype,"anchor1",{get:e.constraint.DistanceJoint.prototype.get_anchor1,set:e.constraint.DistanceJoint.prototype.set_anchor1}),e.constraint.DistanceJoint.prototype.get_anchor1=function(){return null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1(),this.zpp_inner_zn.wrap_a1},e.constraint.DistanceJoint.prototype.set_anchor1=function(e){if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");if(null==e)throw new n._Boot.HaxeError("Error: Constraint::anchor1 cannot be null");null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1();var i=this.zpp_inner_zn.wrap_a1;if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var r=i.zpp_inner;if(r._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=r._isimmutable&&r._isimmutable(),null==e)throw new n._Boot.HaxeError("Error: Cannot assign null Vec2");if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var o=e.zpp_inner;null!=o._validate&&o._validate();var a=e.zpp_inner.x;if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var s=e.zpp_inner;null!=s._validate&&s._validate();var l=e.zpp_inner.y;if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var p,u=i.zpp_inner;if(u._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=u._isimmutable&&u._isimmutable(),a!=a||l!=l)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var h=i.zpp_inner;if(null!=h._validate&&h._validate(),i.zpp_inner.x==a){if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var c=i.zpp_inner;null!=c._validate&&c._validate(),p=i.zpp_inner.y==l}else p=!1;if(!p){i.zpp_inner.x=a,i.zpp_inner.y=l;var _=i.zpp_inner;null!=_._invalidate&&_._invalidate(_)}if(e.zpp_inner.weak){if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var d=e.zpp_inner;if(d._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=d._isimmutable&&d._isimmutable(),e.zpp_inner._inuse)throw new n._Boot.HaxeError("Error: This Vec2 is not disposable");var m=e.zpp_inner;e.zpp_inner.outer=null,e.zpp_inner=null;var P=e;P.zpp_pool=null,null!=t.util.ZPP_PubPool.nextVec2?t.util.ZPP_PubPool.nextVec2.zpp_pool=P:t.util.ZPP_PubPool.poolVec2=P,t.util.ZPP_PubPool.nextVec2=P,P.zpp_disp=!0;var f=m;null!=f.outer&&(f.outer.zpp_inner=null,f.outer=null),f._isimmutable=null,f._validate=null,f._invalidate=null,f.next=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=f}return null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1(),this.zpp_inner_zn.wrap_a1},Object.defineProperty(e.constraint.DistanceJoint.prototype,"anchor2",{get:e.constraint.DistanceJoint.prototype.get_anchor2,set:e.constraint.DistanceJoint.prototype.set_anchor2}),e.constraint.DistanceJoint.prototype.get_anchor2=function(){return null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2(),this.zpp_inner_zn.wrap_a2},e.constraint.DistanceJoint.prototype.set_anchor2=function(e){if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");if(null==e)throw new n._Boot.HaxeError("Error: Constraint::anchor2 cannot be null");null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2();var i=this.zpp_inner_zn.wrap_a2;if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var r=i.zpp_inner;if(r._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=r._isimmutable&&r._isimmutable(),null==e)throw new n._Boot.HaxeError("Error: Cannot assign null Vec2");if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var o=e.zpp_inner;null!=o._validate&&o._validate();var a=e.zpp_inner.x;if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var s=e.zpp_inner;null!=s._validate&&s._validate();var l=e.zpp_inner.y;if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var p,u=i.zpp_inner;if(u._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=u._isimmutable&&u._isimmutable(),a!=a||l!=l)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var h=i.zpp_inner;if(null!=h._validate&&h._validate(),i.zpp_inner.x==a){if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var c=i.zpp_inner;null!=c._validate&&c._validate(),p=i.zpp_inner.y==l}else p=!1;if(!p){i.zpp_inner.x=a,i.zpp_inner.y=l;var _=i.zpp_inner;null!=_._invalidate&&_._invalidate(_)}if(e.zpp_inner.weak){if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var d=e.zpp_inner;if(d._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=d._isimmutable&&d._isimmutable(),e.zpp_inner._inuse)throw new n._Boot.HaxeError("Error: This Vec2 is not disposable");var m=e.zpp_inner;e.zpp_inner.outer=null,e.zpp_inner=null;var P=e;P.zpp_pool=null,null!=t.util.ZPP_PubPool.nextVec2?t.util.ZPP_PubPool.nextVec2.zpp_pool=P:t.util.ZPP_PubPool.poolVec2=P,t.util.ZPP_PubPool.nextVec2=P,P.zpp_disp=!0;var f=m;null!=f.outer&&(f.outer.zpp_inner=null,f.outer=null),f._isimmutable=null,f._validate=null,f._invalidate=null,f.next=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=f}return null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2(),this.zpp_inner_zn.wrap_a2},Object.defineProperty(e.constraint.DistanceJoint.prototype,"jointMin",{get:e.constraint.DistanceJoint.prototype.get_jointMin,set:e.constraint.DistanceJoint.prototype.set_jointMin}),e.constraint.DistanceJoint.prototype.get_jointMin=function(){return this.zpp_inner_zn.jointMin},e.constraint.DistanceJoint.prototype.set_jointMin=function(e){if(this.zpp_inner.immutable_midstep("DistanceJoint::jointMin"),e!=e)throw new n._Boot.HaxeError("Error: DistanceJoint::jointMin cannot be NaN");if(e<0)throw new n._Boot.HaxeError("Error: DistanceJoint::jointMin must be >= 0");return this.zpp_inner_zn.jointMin!=e&&(this.zpp_inner_zn.jointMin=e,this.zpp_inner.wake()),this.zpp_inner_zn.jointMin},Object.defineProperty(e.constraint.DistanceJoint.prototype,"jointMax",{get:e.constraint.DistanceJoint.prototype.get_jointMax,set:e.constraint.DistanceJoint.prototype.set_jointMax}),e.constraint.DistanceJoint.prototype.get_jointMax=function(){return this.zpp_inner_zn.jointMax},e.constraint.DistanceJoint.prototype.set_jointMax=function(e){if(this.zpp_inner.immutable_midstep("DistanceJoint::jointMax"),e!=e)throw new n._Boot.HaxeError("Error: DistanceJoint::jointMax cannot be NaN");if(e<0)throw new n._Boot.HaxeError("Error: DistanceJoint::jointMax must be >= 0");return this.zpp_inner_zn.jointMax!=e&&(this.zpp_inner_zn.jointMax=e,this.zpp_inner.wake()),this.zpp_inner_zn.jointMax},e.constraint.DistanceJoint.prototype.isSlack=function(){if(null==(null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer)||null==(null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer))throw new n._Boot.HaxeError("Error: Cannot compute slack for DistanceJoint if either body is null.");return this.zpp_inner_zn.slack},e.constraint.DistanceJoint.prototype.impulse=function(){var t=new e.geom.MatMN(1,1);if(0>=t.zpp_inner.m||0>=t.zpp_inner.n)throw new n._Boot.HaxeError("Error: MatMN indices out of range");return t.zpp_inner.x[0*t.zpp_inner.n]=this.zpp_inner_zn.jAcc,t},e.constraint.DistanceJoint.prototype.bodyImpulse=function(t){if(null==t)throw new n._Boot.HaxeError("Error: Cannot evaluate impulse on null body");if(t!=(null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer)&&t!=(null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer))throw new n._Boot.HaxeError("Error: Body is not linked to this constraint");return this.zpp_inner.active?this.zpp_inner_zn.bodyImpulse(t.zpp_inner):e.geom.Vec3.get()},e.constraint.DistanceJoint.prototype.visitBodies=function(e){null!=(null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer)&&e(null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer),null!=(null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer)&&(null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer)!=(null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer)&&e(null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer)},e.constraint.DistanceJoint.prototype.__class__=e.constraint.DistanceJoint,e.constraint.LineJoint=l["nape.constraint.LineJoint"]=function(i,r,o,a,s,l,p){this.zpp_inner_zn=null,this.zpp_inner_zn=new t.constraint.ZPP_LineJoint,this.zpp_inner=this.zpp_inner_zn,this.zpp_inner.outer=this,this.zpp_inner_zn.outer_zn=this,e.constraint.Constraint.zpp_internalAlloc=!0,e.constraint.Constraint.call(this),e.constraint.Constraint.zpp_internalAlloc=!1,this.zpp_inner.immutable_midstep("Constraint::body1");var u=null==i?null:i.zpp_inner;u!=this.zpp_inner_zn.b1&&(null!=this.zpp_inner_zn.b1&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2!=this.zpp_inner_zn.b1&&null!=this.zpp_inner_zn.b1&&this.zpp_inner_zn.b1.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1.wake()),this.zpp_inner_zn.b1=u,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=u&&this.zpp_inner_zn.b2!=u&&null!=u&&u.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=u&&u.wake())),this.zpp_inner_zn.b1,this.zpp_inner.immutable_midstep("Constraint::body2");var h=null==r?null:r.zpp_inner;if(h!=this.zpp_inner_zn.b2&&(null!=this.zpp_inner_zn.b2&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1!=this.zpp_inner_zn.b2&&null!=this.zpp_inner_zn.b2&&this.zpp_inner_zn.b2.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2.wake()),this.zpp_inner_zn.b2=h,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=h&&this.zpp_inner_zn.b1!=h&&null!=h&&h.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=h&&h.wake())),this.zpp_inner_zn.b2,null!=o&&o.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");if(null==o)throw new n._Boot.HaxeError("Error: Constraint::anchor1 cannot be null");null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1();var c=this.zpp_inner_zn.wrap_a1;if(null!=c&&c.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");if(null!=o&&o.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var _=c.zpp_inner;if(_._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=_._isimmutable&&_._isimmutable(),null==o)throw new n._Boot.HaxeError("Error: Cannot assign null Vec2");if(null!=o&&o.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var d=o.zpp_inner;null!=d._validate&&d._validate();var m=o.zpp_inner.x;if(null!=o&&o.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var P=o.zpp_inner;null!=P._validate&&P._validate();var f=o.zpp_inner.y;if(null!=c&&c.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var x,y=c.zpp_inner;if(y._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=y._isimmutable&&y._isimmutable(),m!=m||f!=f)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null!=c&&c.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var v=c.zpp_inner;if(null!=v._validate&&v._validate(),c.zpp_inner.x==m){if(null!=c&&c.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var g=c.zpp_inner;null!=g._validate&&g._validate(),x=c.zpp_inner.y==f}else x=!1;if(!x){c.zpp_inner.x=m,c.zpp_inner.y=f;var b=c.zpp_inner;null!=b._invalidate&&b._invalidate(b)}if(o.zpp_inner.weak){if(null!=o&&o.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var z=o.zpp_inner;if(z._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=z._isimmutable&&z._isimmutable(),o.zpp_inner._inuse)throw new n._Boot.HaxeError("Error: This Vec2 is not disposable");var w=o.zpp_inner;o.zpp_inner.outer=null,o.zpp_inner=null;var Z=o;Z.zpp_pool=null,null!=t.util.ZPP_PubPool.nextVec2?t.util.ZPP_PubPool.nextVec2.zpp_pool=Z:t.util.ZPP_PubPool.poolVec2=Z,t.util.ZPP_PubPool.nextVec2=Z,Z.zpp_disp=!0;var E=w;null!=E.outer&&(E.outer.zpp_inner=null,E.outer=null),E._isimmutable=null,E._validate=null,E._invalidate=null,E.next=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=E}if(null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1(),null!=a&&a.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");if(null==a)throw new n._Boot.HaxeError("Error: Constraint::anchor2 cannot be null");null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2();var M=this.zpp_inner_zn.wrap_a2;if(null!=M&&M.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");if(null!=a&&a.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var S=M.zpp_inner;if(S._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=S._isimmutable&&S._isimmutable(),null==a)throw new n._Boot.HaxeError("Error: Cannot assign null Vec2");if(null!=a&&a.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var C=a.zpp_inner;null!=C._validate&&C._validate();var N=a.zpp_inner.x;if(null!=a&&a.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var A=a.zpp_inner;null!=A._validate&&A._validate();var L=a.zpp_inner.y;if(null!=M&&M.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var B,T=M.zpp_inner;if(T._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=T._isimmutable&&T._isimmutable(),N!=N||L!=L)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null!=M&&M.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var V=M.zpp_inner;if(null!=V._validate&&V._validate(),M.zpp_inner.x==N){if(null!=M&&M.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var k=M.zpp_inner;null!=k._validate&&k._validate(),B=M.zpp_inner.y==L}else B=!1;if(!B){M.zpp_inner.x=N,M.zpp_inner.y=L;var I=M.zpp_inner;null!=I._invalidate&&I._invalidate(I)}if(a.zpp_inner.weak){if(null!=a&&a.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var O=a.zpp_inner;if(O._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=O._isimmutable&&O._isimmutable(),a.zpp_inner._inuse)throw new n._Boot.HaxeError("Error: This Vec2 is not disposable");var R=a.zpp_inner;a.zpp_inner.outer=null,a.zpp_inner=null;var H=a;H.zpp_pool=null,null!=t.util.ZPP_PubPool.nextVec2?t.util.ZPP_PubPool.nextVec2.zpp_pool=H:t.util.ZPP_PubPool.poolVec2=H,t.util.ZPP_PubPool.nextVec2=H,H.zpp_disp=!0;var F=R;null!=F.outer&&(F.outer.zpp_inner=null,F.outer=null),F._isimmutable=null,F._validate=null,F._invalidate=null,F.next=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=F}if(null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2(),null!=s&&s.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");if(null==s)throw new n._Boot.HaxeError("Error: Constraint::direction cannot be null");null==this.zpp_inner_zn.wrap_n&&this.zpp_inner_zn.setup_n();var D=this.zpp_inner_zn.wrap_n;if(null!=D&&D.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");if(null!=s&&s.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var G=D.zpp_inner;if(G._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=G._isimmutable&&G._isimmutable(),null==s)throw new n._Boot.HaxeError("Error: Cannot assign null Vec2");if(null!=s&&s.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var U=s.zpp_inner;null!=U._validate&&U._validate();var j=s.zpp_inner.x;if(null!=s&&s.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var W=s.zpp_inner;null!=W._validate&&W._validate();var q=s.zpp_inner.y;if(null!=D&&D.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var J,$=D.zpp_inner;if($._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=$._isimmutable&&$._isimmutable(),j!=j||q!=q)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null!=D&&D.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var X=D.zpp_inner;if(null!=X._validate&&X._validate(),D.zpp_inner.x==j){if(null!=D&&D.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var Y=D.zpp_inner;null!=Y._validate&&Y._validate(),J=D.zpp_inner.y==q}else J=!1;if(!J){D.zpp_inner.x=j,D.zpp_inner.y=q;var K=D.zpp_inner;null!=K._invalidate&&K._invalidate(K)}if(s.zpp_inner.weak){if(null!=s&&s.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var Q=s.zpp_inner;if(Q._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=Q._isimmutable&&Q._isimmutable(),s.zpp_inner._inuse)throw new n._Boot.HaxeError("Error: This Vec2 is not disposable");var ee=s.zpp_inner;s.zpp_inner.outer=null,s.zpp_inner=null;var te=s;te.zpp_pool=null,null!=t.util.ZPP_PubPool.nextVec2?t.util.ZPP_PubPool.nextVec2.zpp_pool=te:t.util.ZPP_PubPool.poolVec2=te,t.util.ZPP_PubPool.nextVec2=te,te.zpp_disp=!0;var ne=ee;null!=ne.outer&&(ne.outer.zpp_inner=null,ne.outer=null),ne._isimmutable=null,ne._validate=null,ne._invalidate=null,ne.next=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=ne}if(null==this.zpp_inner_zn.wrap_n&&this.zpp_inner_zn.setup_n(),this.zpp_inner.immutable_midstep("LineJoint::jointMin"),l!=l)throw new n._Boot.HaxeError("Error: AngleJoint::jointMin cannot be NaN");if(this.zpp_inner_zn.jointMin!=l&&(this.zpp_inner_zn.jointMin=l,this.zpp_inner.wake()),this.zpp_inner.immutable_midstep("LineJoint::jointMax"),p!=p)throw new n._Boot.HaxeError("Error: AngleJoint::jointMax cannot be NaN");this.zpp_inner_zn.jointMax!=p&&(this.zpp_inner_zn.jointMax=p,this.zpp_inner.wake())},e.constraint.LineJoint.__name__=["nape","constraint","LineJoint"],e.constraint.LineJoint.__super__=e.constraint.Constraint,e.constraint.Constraint.prototype)e.constraint.LineJoint.prototype[u]=e.constraint.Constraint.prototype[u];for(var u in e.constraint.LineJoint.prototype.zpp_inner_zn=null,Object.defineProperty(e.constraint.LineJoint.prototype,"body1",{get:e.constraint.LineJoint.prototype.get_body1,set:e.constraint.LineJoint.prototype.set_body1}),e.constraint.LineJoint.prototype.get_body1=function(){return null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer},e.constraint.LineJoint.prototype.set_body1=function(e){this.zpp_inner.immutable_midstep("Constraint::body1");var t=null==e?null:e.zpp_inner;return t!=this.zpp_inner_zn.b1&&(null!=this.zpp_inner_zn.b1&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2!=this.zpp_inner_zn.b1&&null!=this.zpp_inner_zn.b1&&this.zpp_inner_zn.b1.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1.wake()),this.zpp_inner_zn.b1=t,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=t&&this.zpp_inner_zn.b2!=t&&null!=t&&t.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=t&&t.wake())),null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer},Object.defineProperty(e.constraint.LineJoint.prototype,"body2",{get:e.constraint.LineJoint.prototype.get_body2,set:e.constraint.LineJoint.prototype.set_body2}),e.constraint.LineJoint.prototype.get_body2=function(){return null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer},e.constraint.LineJoint.prototype.set_body2=function(e){this.zpp_inner.immutable_midstep("Constraint::body2");var t=null==e?null:e.zpp_inner;return t!=this.zpp_inner_zn.b2&&(null!=this.zpp_inner_zn.b2&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1!=this.zpp_inner_zn.b2&&null!=this.zpp_inner_zn.b2&&this.zpp_inner_zn.b2.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2.wake()),this.zpp_inner_zn.b2=t,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=t&&this.zpp_inner_zn.b1!=t&&null!=t&&t.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=t&&t.wake())),null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer},Object.defineProperty(e.constraint.LineJoint.prototype,"anchor1",{get:e.constraint.LineJoint.prototype.get_anchor1,set:e.constraint.LineJoint.prototype.set_anchor1}),e.constraint.LineJoint.prototype.get_anchor1=function(){return null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1(),this.zpp_inner_zn.wrap_a1},e.constraint.LineJoint.prototype.set_anchor1=function(e){if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");if(null==e)throw new n._Boot.HaxeError("Error: Constraint::anchor1 cannot be null");null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1();var i=this.zpp_inner_zn.wrap_a1;if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var r=i.zpp_inner;if(r._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=r._isimmutable&&r._isimmutable(),null==e)throw new n._Boot.HaxeError("Error: Cannot assign null Vec2");if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var o=e.zpp_inner;null!=o._validate&&o._validate();var a=e.zpp_inner.x;if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var s=e.zpp_inner;null!=s._validate&&s._validate();var l=e.zpp_inner.y;if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var p,u=i.zpp_inner;if(u._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=u._isimmutable&&u._isimmutable(),a!=a||l!=l)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var h=i.zpp_inner;if(null!=h._validate&&h._validate(),i.zpp_inner.x==a){if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var c=i.zpp_inner;null!=c._validate&&c._validate(),p=i.zpp_inner.y==l}else p=!1;if(!p){i.zpp_inner.x=a,i.zpp_inner.y=l;var _=i.zpp_inner;null!=_._invalidate&&_._invalidate(_)}if(e.zpp_inner.weak){if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var d=e.zpp_inner;if(d._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=d._isimmutable&&d._isimmutable(),e.zpp_inner._inuse)throw new n._Boot.HaxeError("Error: This Vec2 is not disposable");var m=e.zpp_inner;e.zpp_inner.outer=null,e.zpp_inner=null;var P=e;P.zpp_pool=null,null!=t.util.ZPP_PubPool.nextVec2?t.util.ZPP_PubPool.nextVec2.zpp_pool=P:t.util.ZPP_PubPool.poolVec2=P,t.util.ZPP_PubPool.nextVec2=P,P.zpp_disp=!0;var f=m;null!=f.outer&&(f.outer.zpp_inner=null,f.outer=null),f._isimmutable=null,f._validate=null,f._invalidate=null,f.next=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=f}return null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1(),this.zpp_inner_zn.wrap_a1},Object.defineProperty(e.constraint.LineJoint.prototype,"anchor2",{get:e.constraint.LineJoint.prototype.get_anchor2,set:e.constraint.LineJoint.prototype.set_anchor2}),e.constraint.LineJoint.prototype.get_anchor2=function(){return null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2(),this.zpp_inner_zn.wrap_a2},e.constraint.LineJoint.prototype.set_anchor2=function(e){if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");if(null==e)throw new n._Boot.HaxeError("Error: Constraint::anchor2 cannot be null");null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2();var i=this.zpp_inner_zn.wrap_a2;if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var r=i.zpp_inner;if(r._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=r._isimmutable&&r._isimmutable(),null==e)throw new n._Boot.HaxeError("Error: Cannot assign null Vec2");if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var o=e.zpp_inner;null!=o._validate&&o._validate();var a=e.zpp_inner.x;if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var s=e.zpp_inner;null!=s._validate&&s._validate();var l=e.zpp_inner.y;if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var p,u=i.zpp_inner;if(u._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=u._isimmutable&&u._isimmutable(),a!=a||l!=l)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var h=i.zpp_inner;if(null!=h._validate&&h._validate(),i.zpp_inner.x==a){if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var c=i.zpp_inner;null!=c._validate&&c._validate(),p=i.zpp_inner.y==l}else p=!1;if(!p){i.zpp_inner.x=a,i.zpp_inner.y=l;var _=i.zpp_inner;null!=_._invalidate&&_._invalidate(_)}if(e.zpp_inner.weak){if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var d=e.zpp_inner;if(d._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=d._isimmutable&&d._isimmutable(),e.zpp_inner._inuse)throw new n._Boot.HaxeError("Error: This Vec2 is not disposable");var m=e.zpp_inner;e.zpp_inner.outer=null,e.zpp_inner=null;var P=e;P.zpp_pool=null,null!=t.util.ZPP_PubPool.nextVec2?t.util.ZPP_PubPool.nextVec2.zpp_pool=P:t.util.ZPP_PubPool.poolVec2=P,t.util.ZPP_PubPool.nextVec2=P,P.zpp_disp=!0;var f=m;null!=f.outer&&(f.outer.zpp_inner=null,f.outer=null),f._isimmutable=null,f._validate=null,f._invalidate=null,f.next=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=f}return null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2(),this.zpp_inner_zn.wrap_a2},Object.defineProperty(e.constraint.LineJoint.prototype,"direction",{get:e.constraint.LineJoint.prototype.get_direction,set:e.constraint.LineJoint.prototype.set_direction}),e.constraint.LineJoint.prototype.get_direction=function(){return null==this.zpp_inner_zn.wrap_n&&this.zpp_inner_zn.setup_n(),this.zpp_inner_zn.wrap_n},e.constraint.LineJoint.prototype.set_direction=function(e){if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");if(null==e)throw new n._Boot.HaxeError("Error: Constraint::direction cannot be null");null==this.zpp_inner_zn.wrap_n&&this.zpp_inner_zn.setup_n();var i=this.zpp_inner_zn.wrap_n;if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var r=i.zpp_inner;if(r._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=r._isimmutable&&r._isimmutable(),null==e)throw new n._Boot.HaxeError("Error: Cannot assign null Vec2");if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var o=e.zpp_inner;null!=o._validate&&o._validate();var a=e.zpp_inner.x;if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var s=e.zpp_inner;null!=s._validate&&s._validate();var l=e.zpp_inner.y;if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var p,u=i.zpp_inner;if(u._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=u._isimmutable&&u._isimmutable(),a!=a||l!=l)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var h=i.zpp_inner;if(null!=h._validate&&h._validate(),i.zpp_inner.x==a){if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var c=i.zpp_inner;null!=c._validate&&c._validate(),p=i.zpp_inner.y==l}else p=!1;if(!p){i.zpp_inner.x=a,i.zpp_inner.y=l;var _=i.zpp_inner;null!=_._invalidate&&_._invalidate(_)}if(e.zpp_inner.weak){if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var d=e.zpp_inner;if(d._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=d._isimmutable&&d._isimmutable(),e.zpp_inner._inuse)throw new n._Boot.HaxeError("Error: This Vec2 is not disposable");var m=e.zpp_inner;e.zpp_inner.outer=null,e.zpp_inner=null;var P=e;P.zpp_pool=null,null!=t.util.ZPP_PubPool.nextVec2?t.util.ZPP_PubPool.nextVec2.zpp_pool=P:t.util.ZPP_PubPool.poolVec2=P,t.util.ZPP_PubPool.nextVec2=P,P.zpp_disp=!0;var f=m;null!=f.outer&&(f.outer.zpp_inner=null,f.outer=null),f._isimmutable=null,f._validate=null,f._invalidate=null,f.next=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=f}return null==this.zpp_inner_zn.wrap_n&&this.zpp_inner_zn.setup_n(),this.zpp_inner_zn.wrap_n},Object.defineProperty(e.constraint.LineJoint.prototype,"jointMin",{get:e.constraint.LineJoint.prototype.get_jointMin,set:e.constraint.LineJoint.prototype.set_jointMin}),e.constraint.LineJoint.prototype.get_jointMin=function(){return this.zpp_inner_zn.jointMin},e.constraint.LineJoint.prototype.set_jointMin=function(e){if(this.zpp_inner.immutable_midstep("LineJoint::jointMin"),e!=e)throw new n._Boot.HaxeError("Error: AngleJoint::jointMin cannot be NaN");return this.zpp_inner_zn.jointMin!=e&&(this.zpp_inner_zn.jointMin=e,this.zpp_inner.wake()),this.zpp_inner_zn.jointMin},Object.defineProperty(e.constraint.LineJoint.prototype,"jointMax",{get:e.constraint.LineJoint.prototype.get_jointMax,set:e.constraint.LineJoint.prototype.set_jointMax}),e.constraint.LineJoint.prototype.get_jointMax=function(){return this.zpp_inner_zn.jointMax},e.constraint.LineJoint.prototype.set_jointMax=function(e){if(this.zpp_inner.immutable_midstep("LineJoint::jointMax"),e!=e)throw new n._Boot.HaxeError("Error: AngleJoint::jointMax cannot be NaN");return this.zpp_inner_zn.jointMax!=e&&(this.zpp_inner_zn.jointMax=e,this.zpp_inner.wake()),this.zpp_inner_zn.jointMax},e.constraint.LineJoint.prototype.impulse=function(){var t=new e.geom.MatMN(2,1);if(0>=t.zpp_inner.m||0>=t.zpp_inner.n)throw new n._Boot.HaxeError("Error: MatMN indices out of range");if(t.zpp_inner.x[0*t.zpp_inner.n]=this.zpp_inner_zn.jAccx,1>=t.zpp_inner.m||0>=t.zpp_inner.n)throw new n._Boot.HaxeError("Error: MatMN indices out of range");return t.zpp_inner.x[t.zpp_inner.n]=this.zpp_inner_zn.jAccy,t},e.constraint.LineJoint.prototype.bodyImpulse=function(t){if(null==t)throw new n._Boot.HaxeError("Error: Cannot evaluate impulse on null body");if(t!=(null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer)&&t!=(null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer))throw new n._Boot.HaxeError("Error: Body is not linked to this constraint");return this.zpp_inner.active?this.zpp_inner_zn.bodyImpulse(t.zpp_inner):e.geom.Vec3.get()},e.constraint.LineJoint.prototype.visitBodies=function(e){null!=(null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer)&&e(null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer),null!=(null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer)&&(null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer)!=(null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer)&&e(null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer)},e.constraint.LineJoint.prototype.__class__=e.constraint.LineJoint,e.constraint.MotorJoint=l["nape.constraint.MotorJoint"]=function(i,r,o,a){null==a&&(a=1),null==o&&(o=0),this.zpp_inner_zn=null,this.zpp_inner_zn=new t.constraint.ZPP_MotorJoint,this.zpp_inner=this.zpp_inner_zn,this.zpp_inner.outer=this,this.zpp_inner_zn.outer_zn=this,e.constraint.Constraint.zpp_internalAlloc=!0,e.constraint.Constraint.call(this),e.constraint.Constraint.zpp_internalAlloc=!1,this.zpp_inner.immutable_midstep("Constraint::body1");var s=null==i?null:i.zpp_inner;s!=this.zpp_inner_zn.b1&&(null!=this.zpp_inner_zn.b1&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2!=this.zpp_inner_zn.b1&&null!=this.zpp_inner_zn.b1&&this.zpp_inner_zn.b1.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1.wake()),this.zpp_inner_zn.b1=s,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=s&&this.zpp_inner_zn.b2!=s&&null!=s&&s.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=s&&s.wake())),this.zpp_inner_zn.b1,this.zpp_inner.immutable_midstep("Constraint::body2");var l=null==r?null:r.zpp_inner;if(l!=this.zpp_inner_zn.b2&&(null!=this.zpp_inner_zn.b2&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1!=this.zpp_inner_zn.b2&&null!=this.zpp_inner_zn.b2&&this.zpp_inner_zn.b2.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2.wake()),this.zpp_inner_zn.b2=l,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=l&&this.zpp_inner_zn.b1!=l&&null!=l&&l.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=l&&l.wake())),this.zpp_inner_zn.b2,this.zpp_inner.immutable_midstep("MotorJoint::rate"),o!=o)throw new n._Boot.HaxeError("Error: MotorJoint::rate cannot be NaN");if(this.zpp_inner_zn.rate!=o&&(this.zpp_inner_zn.rate=o,this.zpp_inner.wake()),this.zpp_inner.immutable_midstep("MotorJoint::ratio"),a!=a)throw new n._Boot.HaxeError("Error: MotorJoint::ratio cannot be NaN");this.zpp_inner_zn.ratio!=a&&(this.zpp_inner_zn.ratio=a,this.zpp_inner.wake())},e.constraint.MotorJoint.__name__=["nape","constraint","MotorJoint"],e.constraint.MotorJoint.__super__=e.constraint.Constraint,e.constraint.Constraint.prototype)e.constraint.MotorJoint.prototype[u]=e.constraint.Constraint.prototype[u];for(var u in e.constraint.MotorJoint.prototype.zpp_inner_zn=null,Object.defineProperty(e.constraint.MotorJoint.prototype,"body1",{get:e.constraint.MotorJoint.prototype.get_body1,set:e.constraint.MotorJoint.prototype.set_body1}),e.constraint.MotorJoint.prototype.get_body1=function(){return null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer},e.constraint.MotorJoint.prototype.set_body1=function(e){this.zpp_inner.immutable_midstep("Constraint::body1");var t=null==e?null:e.zpp_inner;return t!=this.zpp_inner_zn.b1&&(null!=this.zpp_inner_zn.b1&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2!=this.zpp_inner_zn.b1&&null!=this.zpp_inner_zn.b1&&this.zpp_inner_zn.b1.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1.wake()),this.zpp_inner_zn.b1=t,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=t&&this.zpp_inner_zn.b2!=t&&null!=t&&t.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=t&&t.wake())),null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer},Object.defineProperty(e.constraint.MotorJoint.prototype,"body2",{get:e.constraint.MotorJoint.prototype.get_body2,set:e.constraint.MotorJoint.prototype.set_body2}),e.constraint.MotorJoint.prototype.get_body2=function(){return null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer},e.constraint.MotorJoint.prototype.set_body2=function(e){this.zpp_inner.immutable_midstep("Constraint::body2");var t=null==e?null:e.zpp_inner;return t!=this.zpp_inner_zn.b2&&(null!=this.zpp_inner_zn.b2&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1!=this.zpp_inner_zn.b2&&null!=this.zpp_inner_zn.b2&&this.zpp_inner_zn.b2.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2.wake()),this.zpp_inner_zn.b2=t,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=t&&this.zpp_inner_zn.b1!=t&&null!=t&&t.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=t&&t.wake())),null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer},Object.defineProperty(e.constraint.MotorJoint.prototype,"ratio",{get:e.constraint.MotorJoint.prototype.get_ratio,set:e.constraint.MotorJoint.prototype.set_ratio}),e.constraint.MotorJoint.prototype.get_ratio=function(){return this.zpp_inner_zn.ratio},e.constraint.MotorJoint.prototype.set_ratio=function(e){if(this.zpp_inner.immutable_midstep("MotorJoint::ratio"),e!=e)throw new n._Boot.HaxeError("Error: MotorJoint::ratio cannot be NaN");return this.zpp_inner_zn.ratio!=e&&(this.zpp_inner_zn.ratio=e,this.zpp_inner.wake()),this.zpp_inner_zn.ratio},Object.defineProperty(e.constraint.MotorJoint.prototype,"rate",{get:e.constraint.MotorJoint.prototype.get_rate,set:e.constraint.MotorJoint.prototype.set_rate}),e.constraint.MotorJoint.prototype.get_rate=function(){return this.zpp_inner_zn.rate},e.constraint.MotorJoint.prototype.set_rate=function(e){if(this.zpp_inner.immutable_midstep("MotorJoint::rate"),e!=e)throw new n._Boot.HaxeError("Error: MotorJoint::rate cannot be NaN");return this.zpp_inner_zn.rate!=e&&(this.zpp_inner_zn.rate=e,this.zpp_inner.wake()),this.zpp_inner_zn.rate},e.constraint.MotorJoint.prototype.impulse=function(){var t=new e.geom.MatMN(1,1);if(0>=t.zpp_inner.m||0>=t.zpp_inner.n)throw new n._Boot.HaxeError("Error: MatMN indices out of range");return t.zpp_inner.x[0*t.zpp_inner.n]=this.zpp_inner_zn.jAcc,t},e.constraint.MotorJoint.prototype.bodyImpulse=function(t){if(null==t)throw new n._Boot.HaxeError("Error: Cannot evaluate impulse on null body");if(t!=(null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer)&&t!=(null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer))throw new n._Boot.HaxeError("Error: Body is not linked to this constraint");return this.zpp_inner.active?this.zpp_inner_zn.bodyImpulse(t.zpp_inner):e.geom.Vec3.get()},e.constraint.MotorJoint.prototype.visitBodies=function(e){null!=(null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer)&&e(null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer),null!=(null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer)&&(null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer)!=(null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer)&&e(null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer)},e.constraint.MotorJoint.prototype.__class__=e.constraint.MotorJoint,e.constraint.PivotJoint=l["nape.constraint.PivotJoint"]=function(i,r,o,a){this.zpp_inner_zn=null,this.zpp_inner_zn=new t.constraint.ZPP_PivotJoint,this.zpp_inner=this.zpp_inner_zn,this.zpp_inner.outer=this,this.zpp_inner_zn.outer_zn=this,e.constraint.Constraint.zpp_internalAlloc=!0,e.constraint.Constraint.call(this),e.constraint.Constraint.zpp_internalAlloc=!1,this.zpp_inner.immutable_midstep("Constraint::body1");var s=null==i?null:i.zpp_inner;s!=this.zpp_inner_zn.b1&&(null!=this.zpp_inner_zn.b1&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2!=this.zpp_inner_zn.b1&&null!=this.zpp_inner_zn.b1&&this.zpp_inner_zn.b1.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1.wake()),this.zpp_inner_zn.b1=s,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=s&&this.zpp_inner_zn.b2!=s&&null!=s&&s.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=s&&s.wake())),this.zpp_inner_zn.b1,this.zpp_inner.immutable_midstep("Constraint::body2");var l=null==r?null:r.zpp_inner;if(l!=this.zpp_inner_zn.b2&&(null!=this.zpp_inner_zn.b2&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1!=this.zpp_inner_zn.b2&&null!=this.zpp_inner_zn.b2&&this.zpp_inner_zn.b2.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2.wake()),this.zpp_inner_zn.b2=l,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=l&&this.zpp_inner_zn.b1!=l&&null!=l&&l.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=l&&l.wake())),this.zpp_inner_zn.b2,null!=o&&o.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");if(null==o)throw new n._Boot.HaxeError("Error: Constraint::anchor1 cannot be null");null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1();var p=this.zpp_inner_zn.wrap_a1;if(null!=p&&p.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");if(null!=o&&o.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var u=p.zpp_inner;if(u._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=u._isimmutable&&u._isimmutable(),null==o)throw new n._Boot.HaxeError("Error: Cannot assign null Vec2");if(null!=o&&o.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var h=o.zpp_inner;null!=h._validate&&h._validate();var c=o.zpp_inner.x;if(null!=o&&o.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var _=o.zpp_inner;null!=_._validate&&_._validate();var d=o.zpp_inner.y;if(null!=p&&p.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var m,P=p.zpp_inner;if(P._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=P._isimmutable&&P._isimmutable(),c!=c||d!=d)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null!=p&&p.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var f=p.zpp_inner;if(null!=f._validate&&f._validate(),p.zpp_inner.x==c){if(null!=p&&p.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var x=p.zpp_inner;null!=x._validate&&x._validate(),m=p.zpp_inner.y==d}else m=!1;if(!m){p.zpp_inner.x=c,p.zpp_inner.y=d;var y=p.zpp_inner;null!=y._invalidate&&y._invalidate(y)}if(o.zpp_inner.weak){if(null!=o&&o.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var v=o.zpp_inner;if(v._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=v._isimmutable&&v._isimmutable(),o.zpp_inner._inuse)throw new n._Boot.HaxeError("Error: This Vec2 is not disposable");var g=o.zpp_inner;o.zpp_inner.outer=null,o.zpp_inner=null;var b=o;b.zpp_pool=null,null!=t.util.ZPP_PubPool.nextVec2?t.util.ZPP_PubPool.nextVec2.zpp_pool=b:t.util.ZPP_PubPool.poolVec2=b,t.util.ZPP_PubPool.nextVec2=b,b.zpp_disp=!0;var z=g;null!=z.outer&&(z.outer.zpp_inner=null,z.outer=null),z._isimmutable=null,z._validate=null,z._invalidate=null,z.next=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=z}if(null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1(),null!=a&&a.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");if(null==a)throw new n._Boot.HaxeError("Error: Constraint::anchor2 cannot be null");null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2();var w=this.zpp_inner_zn.wrap_a2;if(null!=w&&w.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");if(null!=a&&a.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var Z=w.zpp_inner;if(Z._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=Z._isimmutable&&Z._isimmutable(),null==a)throw new n._Boot.HaxeError("Error: Cannot assign null Vec2");if(null!=a&&a.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var E=a.zpp_inner;null!=E._validate&&E._validate();var M=a.zpp_inner.x;if(null!=a&&a.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var S=a.zpp_inner;null!=S._validate&&S._validate();var C=a.zpp_inner.y;if(null!=w&&w.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var N,A=w.zpp_inner;if(A._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=A._isimmutable&&A._isimmutable(),M!=M||C!=C)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null!=w&&w.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var L=w.zpp_inner;if(null!=L._validate&&L._validate(),w.zpp_inner.x==M){if(null!=w&&w.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var B=w.zpp_inner;null!=B._validate&&B._validate(),N=w.zpp_inner.y==C}else N=!1;if(!N){w.zpp_inner.x=M,w.zpp_inner.y=C;var T=w.zpp_inner;null!=T._invalidate&&T._invalidate(T)}if(a.zpp_inner.weak){if(null!=a&&a.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var V=a.zpp_inner;if(V._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=V._isimmutable&&V._isimmutable(),a.zpp_inner._inuse)throw new n._Boot.HaxeError("Error: This Vec2 is not disposable");var k=a.zpp_inner;a.zpp_inner.outer=null,a.zpp_inner=null;var I=a;I.zpp_pool=null,null!=t.util.ZPP_PubPool.nextVec2?t.util.ZPP_PubPool.nextVec2.zpp_pool=I:t.util.ZPP_PubPool.poolVec2=I,t.util.ZPP_PubPool.nextVec2=I,I.zpp_disp=!0;var O=k;null!=O.outer&&(O.outer.zpp_inner=null,O.outer=null),O._isimmutable=null,O._validate=null,O._invalidate=null,O.next=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=O}null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2()},e.constraint.PivotJoint.__name__=["nape","constraint","PivotJoint"],e.constraint.PivotJoint.__super__=e.constraint.Constraint,e.constraint.Constraint.prototype)e.constraint.PivotJoint.prototype[u]=e.constraint.Constraint.prototype[u];for(var u in e.constraint.PivotJoint.prototype.zpp_inner_zn=null,Object.defineProperty(e.constraint.PivotJoint.prototype,"body1",{get:e.constraint.PivotJoint.prototype.get_body1,set:e.constraint.PivotJoint.prototype.set_body1}),e.constraint.PivotJoint.prototype.get_body1=function(){return null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer},e.constraint.PivotJoint.prototype.set_body1=function(e){this.zpp_inner.immutable_midstep("Constraint::body1");var t=null==e?null:e.zpp_inner;return t!=this.zpp_inner_zn.b1&&(null!=this.zpp_inner_zn.b1&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2!=this.zpp_inner_zn.b1&&null!=this.zpp_inner_zn.b1&&this.zpp_inner_zn.b1.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1.wake()),this.zpp_inner_zn.b1=t,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=t&&this.zpp_inner_zn.b2!=t&&null!=t&&t.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=t&&t.wake())),null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer},Object.defineProperty(e.constraint.PivotJoint.prototype,"body2",{get:e.constraint.PivotJoint.prototype.get_body2,set:e.constraint.PivotJoint.prototype.set_body2}),e.constraint.PivotJoint.prototype.get_body2=function(){return null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer},e.constraint.PivotJoint.prototype.set_body2=function(e){this.zpp_inner.immutable_midstep("Constraint::body2");var t=null==e?null:e.zpp_inner;return t!=this.zpp_inner_zn.b2&&(null!=this.zpp_inner_zn.b2&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1!=this.zpp_inner_zn.b2&&null!=this.zpp_inner_zn.b2&&this.zpp_inner_zn.b2.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2.wake()),this.zpp_inner_zn.b2=t,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=t&&this.zpp_inner_zn.b1!=t&&null!=t&&t.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=t&&t.wake())),null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer},Object.defineProperty(e.constraint.PivotJoint.prototype,"anchor1",{get:e.constraint.PivotJoint.prototype.get_anchor1,set:e.constraint.PivotJoint.prototype.set_anchor1}),e.constraint.PivotJoint.prototype.get_anchor1=function(){return null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1(),this.zpp_inner_zn.wrap_a1},e.constraint.PivotJoint.prototype.set_anchor1=function(e){if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");if(null==e)throw new n._Boot.HaxeError("Error: Constraint::anchor1 cannot be null");null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1();var i=this.zpp_inner_zn.wrap_a1;if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var r=i.zpp_inner;if(r._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=r._isimmutable&&r._isimmutable(),null==e)throw new n._Boot.HaxeError("Error: Cannot assign null Vec2");if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var o=e.zpp_inner;null!=o._validate&&o._validate();var a=e.zpp_inner.x;if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var s=e.zpp_inner;null!=s._validate&&s._validate();var l=e.zpp_inner.y;if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var p,u=i.zpp_inner;if(u._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=u._isimmutable&&u._isimmutable(),a!=a||l!=l)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var h=i.zpp_inner;if(null!=h._validate&&h._validate(),i.zpp_inner.x==a){if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var c=i.zpp_inner;null!=c._validate&&c._validate(),p=i.zpp_inner.y==l}else p=!1;if(!p){i.zpp_inner.x=a,i.zpp_inner.y=l;var _=i.zpp_inner;null!=_._invalidate&&_._invalidate(_)}if(e.zpp_inner.weak){if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var d=e.zpp_inner;if(d._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=d._isimmutable&&d._isimmutable(),e.zpp_inner._inuse)throw new n._Boot.HaxeError("Error: This Vec2 is not disposable");var m=e.zpp_inner;e.zpp_inner.outer=null,e.zpp_inner=null;var P=e;P.zpp_pool=null,null!=t.util.ZPP_PubPool.nextVec2?t.util.ZPP_PubPool.nextVec2.zpp_pool=P:t.util.ZPP_PubPool.poolVec2=P,t.util.ZPP_PubPool.nextVec2=P,P.zpp_disp=!0;var f=m;null!=f.outer&&(f.outer.zpp_inner=null,f.outer=null),f._isimmutable=null,f._validate=null,f._invalidate=null,f.next=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=f}return null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1(),this.zpp_inner_zn.wrap_a1},Object.defineProperty(e.constraint.PivotJoint.prototype,"anchor2",{get:e.constraint.PivotJoint.prototype.get_anchor2,set:e.constraint.PivotJoint.prototype.set_anchor2}),e.constraint.PivotJoint.prototype.get_anchor2=function(){return null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2(),this.zpp_inner_zn.wrap_a2},e.constraint.PivotJoint.prototype.set_anchor2=function(e){if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");if(null==e)throw new n._Boot.HaxeError("Error: Constraint::anchor2 cannot be null");null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2();var i=this.zpp_inner_zn.wrap_a2;if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var r=i.zpp_inner;if(r._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=r._isimmutable&&r._isimmutable(),null==e)throw new n._Boot.HaxeError("Error: Cannot assign null Vec2");if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var o=e.zpp_inner;null!=o._validate&&o._validate();var a=e.zpp_inner.x;if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var s=e.zpp_inner;null!=s._validate&&s._validate();var l=e.zpp_inner.y;if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var p,u=i.zpp_inner;if(u._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=u._isimmutable&&u._isimmutable(),a!=a||l!=l)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var h=i.zpp_inner;if(null!=h._validate&&h._validate(),i.zpp_inner.x==a){if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var c=i.zpp_inner;null!=c._validate&&c._validate(),p=i.zpp_inner.y==l}else p=!1;if(!p){i.zpp_inner.x=a,i.zpp_inner.y=l;var _=i.zpp_inner;null!=_._invalidate&&_._invalidate(_)}if(e.zpp_inner.weak){if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var d=e.zpp_inner;if(d._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=d._isimmutable&&d._isimmutable(),e.zpp_inner._inuse)throw new n._Boot.HaxeError("Error: This Vec2 is not disposable");var m=e.zpp_inner;e.zpp_inner.outer=null,e.zpp_inner=null;var P=e;P.zpp_pool=null,null!=t.util.ZPP_PubPool.nextVec2?t.util.ZPP_PubPool.nextVec2.zpp_pool=P:t.util.ZPP_PubPool.poolVec2=P,t.util.ZPP_PubPool.nextVec2=P,P.zpp_disp=!0;var f=m;null!=f.outer&&(f.outer.zpp_inner=null,f.outer=null),f._isimmutable=null,f._validate=null,f._invalidate=null,f.next=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=f}return null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2(),this.zpp_inner_zn.wrap_a2},e.constraint.PivotJoint.prototype.impulse=function(){var t=new e.geom.MatMN(2,1);if(0>=t.zpp_inner.m||0>=t.zpp_inner.n)throw new n._Boot.HaxeError("Error: MatMN indices out of range");if(t.zpp_inner.x[0*t.zpp_inner.n]=this.zpp_inner_zn.jAccx,1>=t.zpp_inner.m||0>=t.zpp_inner.n)throw new n._Boot.HaxeError("Error: MatMN indices out of range");return t.zpp_inner.x[t.zpp_inner.n]=this.zpp_inner_zn.jAccy,t},e.constraint.PivotJoint.prototype.bodyImpulse=function(t){if(null==t)throw new n._Boot.HaxeError("Error: Cannot evaluate impulse on null body");if(t!=(null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer)&&t!=(null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer))throw new n._Boot.HaxeError("Error: Body is not linked to this constraint");return this.zpp_inner.active?this.zpp_inner_zn.bodyImpulse(t.zpp_inner):e.geom.Vec3.get()},e.constraint.PivotJoint.prototype.visitBodies=function(e){null!=(null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer)&&e(null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer),null!=(null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer)&&(null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer)!=(null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer)&&e(null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer)},e.constraint.PivotJoint.prototype.__class__=e.constraint.PivotJoint,e.constraint.PulleyJoint=l["nape.constraint.PulleyJoint"]=function(i,r,o,a,s,l,p,u,h,c,_){null==_&&(_=1),this.zpp_inner_zn=null,this.zpp_inner_zn=new t.constraint.ZPP_PulleyJoint,this.zpp_inner=this.zpp_inner_zn,this.zpp_inner.outer=this,this.zpp_inner_zn.outer_zn=this,e.constraint.Constraint.zpp_internalAlloc=!0,e.constraint.Constraint.call(this),e.constraint.Constraint.zpp_internalAlloc=!1,this.zpp_inner.immutable_midstep("Constraint::body1");var d=null==i?null:i.zpp_inner;d!=this.zpp_inner_zn.b1&&(null!=this.zpp_inner_zn.b1&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2!=this.zpp_inner_zn.b1&&this.zpp_inner_zn.b3!=this.zpp_inner_zn.b1&&this.zpp_inner_zn.b4!=this.zpp_inner_zn.b1&&null!=this.zpp_inner_zn.b1&&this.zpp_inner_zn.b1.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1.wake()),this.zpp_inner_zn.b1=d,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=d&&this.zpp_inner_zn.b2!=d&&this.zpp_inner_zn.b3!=d&&this.zpp_inner_zn.b4!=d&&null!=d&&d.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=d&&d.wake())),this.zpp_inner_zn.b1,this.zpp_inner.immutable_midstep("Constraint::body2");var m=null==r?null:r.zpp_inner;m!=this.zpp_inner_zn.b2&&(null!=this.zpp_inner_zn.b2&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1!=this.zpp_inner_zn.b2&&this.zpp_inner_zn.b3!=this.zpp_inner_zn.b2&&this.zpp_inner_zn.b4!=this.zpp_inner_zn.b2&&null!=this.zpp_inner_zn.b2&&this.zpp_inner_zn.b2.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2.wake()),this.zpp_inner_zn.b2=m,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=m&&this.zpp_inner_zn.b1!=m&&this.zpp_inner_zn.b3!=m&&this.zpp_inner_zn.b4!=m&&null!=m&&m.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=m&&m.wake())),this.zpp_inner_zn.b2,this.zpp_inner.immutable_midstep("Constraint::body3");var P=null==o?null:o.zpp_inner;P!=this.zpp_inner_zn.b3&&(null!=this.zpp_inner_zn.b3&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1!=this.zpp_inner_zn.b3&&this.zpp_inner_zn.b2!=this.zpp_inner_zn.b3&&this.zpp_inner_zn.b4!=this.zpp_inner_zn.b3&&null!=this.zpp_inner_zn.b3&&this.zpp_inner_zn.b3.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b3.wake()),this.zpp_inner_zn.b3=P,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=P&&this.zpp_inner_zn.b1!=P&&this.zpp_inner_zn.b2!=P&&this.zpp_inner_zn.b4!=P&&null!=P&&P.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=P&&P.wake())),this.zpp_inner_zn.b3,this.zpp_inner.immutable_midstep("Constraint::body4");var f=null==a?null:a.zpp_inner;if(f!=this.zpp_inner_zn.b4&&(null!=this.zpp_inner_zn.b4&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1!=this.zpp_inner_zn.b4&&this.zpp_inner_zn.b2!=this.zpp_inner_zn.b4&&this.zpp_inner_zn.b3!=this.zpp_inner_zn.b4&&null!=this.zpp_inner_zn.b4&&this.zpp_inner_zn.b4.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b4.wake()),this.zpp_inner_zn.b4=f,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=f&&this.zpp_inner_zn.b1!=f&&this.zpp_inner_zn.b2!=f&&this.zpp_inner_zn.b3!=f&&null!=f&&f.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=f&&f.wake())),this.zpp_inner_zn.b4,null!=s&&s.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");if(null==s)throw new n._Boot.HaxeError("Error: Constraint::anchor1 cannot be null");null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1();var x=this.zpp_inner_zn.wrap_a1;if(null!=x&&x.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");if(null!=s&&s.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var y=x.zpp_inner;if(y._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=y._isimmutable&&y._isimmutable(),null==s)throw new n._Boot.HaxeError("Error: Cannot assign null Vec2");if(null!=s&&s.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var v=s.zpp_inner;null!=v._validate&&v._validate();var g=s.zpp_inner.x;if(null!=s&&s.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var b=s.zpp_inner;null!=b._validate&&b._validate();var z=s.zpp_inner.y;if(null!=x&&x.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var w,Z=x.zpp_inner;if(Z._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=Z._isimmutable&&Z._isimmutable(),g!=g||z!=z)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null!=x&&x.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var E=x.zpp_inner;if(null!=E._validate&&E._validate(),x.zpp_inner.x==g){if(null!=x&&x.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var M=x.zpp_inner;null!=M._validate&&M._validate(),w=x.zpp_inner.y==z}else w=!1;if(!w){x.zpp_inner.x=g,x.zpp_inner.y=z;var S=x.zpp_inner;null!=S._invalidate&&S._invalidate(S)}if(s.zpp_inner.weak){if(null!=s&&s.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var C=s.zpp_inner;if(C._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=C._isimmutable&&C._isimmutable(),s.zpp_inner._inuse)throw new n._Boot.HaxeError("Error: This Vec2 is not disposable");var N=s.zpp_inner;s.zpp_inner.outer=null,s.zpp_inner=null;var A=s;A.zpp_pool=null,null!=t.util.ZPP_PubPool.nextVec2?t.util.ZPP_PubPool.nextVec2.zpp_pool=A:t.util.ZPP_PubPool.poolVec2=A,t.util.ZPP_PubPool.nextVec2=A,A.zpp_disp=!0;var L=N;null!=L.outer&&(L.outer.zpp_inner=null,L.outer=null),L._isimmutable=null,L._validate=null,L._invalidate=null,L.next=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=L}if(null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1(),null!=l&&l.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");if(null==l)throw new n._Boot.HaxeError("Error: Constraint::anchor2 cannot be null");null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2();var B=this.zpp_inner_zn.wrap_a2;if(null!=B&&B.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");if(null!=l&&l.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var T=B.zpp_inner;if(T._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=T._isimmutable&&T._isimmutable(),null==l)throw new n._Boot.HaxeError("Error: Cannot assign null Vec2");if(null!=l&&l.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var V=l.zpp_inner;null!=V._validate&&V._validate();var k=l.zpp_inner.x;if(null!=l&&l.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var I=l.zpp_inner;null!=I._validate&&I._validate();var O=l.zpp_inner.y;if(null!=B&&B.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var R,H=B.zpp_inner;if(H._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=H._isimmutable&&H._isimmutable(),k!=k||O!=O)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null!=B&&B.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var F=B.zpp_inner;if(null!=F._validate&&F._validate(),B.zpp_inner.x==k){if(null!=B&&B.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var D=B.zpp_inner;null!=D._validate&&D._validate(),R=B.zpp_inner.y==O}else R=!1;if(!R){B.zpp_inner.x=k,B.zpp_inner.y=O;var G=B.zpp_inner;null!=G._invalidate&&G._invalidate(G)}if(l.zpp_inner.weak){if(null!=l&&l.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var U=l.zpp_inner;if(U._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=U._isimmutable&&U._isimmutable(),l.zpp_inner._inuse)throw new n._Boot.HaxeError("Error: This Vec2 is not disposable");var j=l.zpp_inner;l.zpp_inner.outer=null,l.zpp_inner=null;var W=l;W.zpp_pool=null,null!=t.util.ZPP_PubPool.nextVec2?t.util.ZPP_PubPool.nextVec2.zpp_pool=W:t.util.ZPP_PubPool.poolVec2=W,t.util.ZPP_PubPool.nextVec2=W,W.zpp_disp=!0;var q=j;null!=q.outer&&(q.outer.zpp_inner=null,q.outer=null),q._isimmutable=null,q._validate=null,q._invalidate=null,q.next=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=q}if(null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2(),null!=p&&p.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");if(null==p)throw new n._Boot.HaxeError("Error: Constraint::anchor3 cannot be null");null==this.zpp_inner_zn.wrap_a3&&this.zpp_inner_zn.setup_a3();var J=this.zpp_inner_zn.wrap_a3;if(null!=J&&J.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");if(null!=p&&p.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var $=J.zpp_inner;if($._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=$._isimmutable&&$._isimmutable(),null==p)throw new n._Boot.HaxeError("Error: Cannot assign null Vec2");if(null!=p&&p.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var X=p.zpp_inner;null!=X._validate&&X._validate();var Y=p.zpp_inner.x;if(null!=p&&p.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var K=p.zpp_inner;null!=K._validate&&K._validate();var Q=p.zpp_inner.y;if(null!=J&&J.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var ee,te=J.zpp_inner;if(te._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=te._isimmutable&&te._isimmutable(),Y!=Y||Q!=Q)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null!=J&&J.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var ne=J.zpp_inner;if(null!=ne._validate&&ne._validate(),J.zpp_inner.x==Y){if(null!=J&&J.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var ie=J.zpp_inner;null!=ie._validate&&ie._validate(),ee=J.zpp_inner.y==Q}else ee=!1;if(!ee){J.zpp_inner.x=Y,J.zpp_inner.y=Q;var re=J.zpp_inner;null!=re._invalidate&&re._invalidate(re)}if(p.zpp_inner.weak){if(null!=p&&p.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var oe=p.zpp_inner;if(oe._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=oe._isimmutable&&oe._isimmutable(),p.zpp_inner._inuse)throw new n._Boot.HaxeError("Error: This Vec2 is not disposable");var ae=p.zpp_inner;p.zpp_inner.outer=null,p.zpp_inner=null;var se=p;se.zpp_pool=null,null!=t.util.ZPP_PubPool.nextVec2?t.util.ZPP_PubPool.nextVec2.zpp_pool=se:t.util.ZPP_PubPool.poolVec2=se,t.util.ZPP_PubPool.nextVec2=se,se.zpp_disp=!0;var le=ae;null!=le.outer&&(le.outer.zpp_inner=null,le.outer=null),le._isimmutable=null,le._validate=null,le._invalidate=null,le.next=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=le}if(null==this.zpp_inner_zn.wrap_a3&&this.zpp_inner_zn.setup_a3(),null!=u&&u.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");if(null==u)throw new n._Boot.HaxeError("Error: Constraint::anchor4 cannot be null");null==this.zpp_inner_zn.wrap_a4&&this.zpp_inner_zn.setup_a4();var pe=this.zpp_inner_zn.wrap_a4;if(null!=pe&&pe.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");if(null!=u&&u.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var ue=pe.zpp_inner;if(ue._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=ue._isimmutable&&ue._isimmutable(),null==u)throw new n._Boot.HaxeError("Error: Cannot assign null Vec2");if(null!=u&&u.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var he=u.zpp_inner;null!=he._validate&&he._validate();var ce=u.zpp_inner.x;if(null!=u&&u.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var _e=u.zpp_inner;null!=_e._validate&&_e._validate();var de=u.zpp_inner.y;if(null!=pe&&pe.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var me,Pe=pe.zpp_inner;if(Pe._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=Pe._isimmutable&&Pe._isimmutable(),ce!=ce||de!=de)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null!=pe&&pe.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var fe=pe.zpp_inner;if(null!=fe._validate&&fe._validate(),pe.zpp_inner.x==ce){if(null!=pe&&pe.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var xe=pe.zpp_inner;null!=xe._validate&&xe._validate(),me=pe.zpp_inner.y==de}else me=!1;if(!me){pe.zpp_inner.x=ce,pe.zpp_inner.y=de;var ye=pe.zpp_inner;null!=ye._invalidate&&ye._invalidate(ye)}if(u.zpp_inner.weak){if(null!=u&&u.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var ve=u.zpp_inner;if(ve._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=ve._isimmutable&&ve._isimmutable(),u.zpp_inner._inuse)throw new n._Boot.HaxeError("Error: This Vec2 is not disposable");var ge=u.zpp_inner;u.zpp_inner.outer=null,u.zpp_inner=null;var be=u;be.zpp_pool=null,null!=t.util.ZPP_PubPool.nextVec2?t.util.ZPP_PubPool.nextVec2.zpp_pool=be:t.util.ZPP_PubPool.poolVec2=be,t.util.ZPP_PubPool.nextVec2=be,be.zpp_disp=!0;var ze=ge;null!=ze.outer&&(ze.outer.zpp_inner=null,ze.outer=null),ze._isimmutable=null,ze._validate=null,ze._invalidate=null,ze.next=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=ze}if(null==this.zpp_inner_zn.wrap_a4&&this.zpp_inner_zn.setup_a4(),this.zpp_inner.immutable_midstep("PulleyJoint::ratio"),_!=_)throw new n._Boot.HaxeError("Error: PulleyJoint::ratio cannot be NaN");if(this.zpp_inner_zn.ratio!=_&&(this.zpp_inner_zn.ratio=_,this.zpp_inner.wake()),this.zpp_inner.immutable_midstep("PulleyJoint::jointMin"),h!=h)throw new n._Boot.HaxeError("Error: PulleyJoint::jointMin cannot be NaN");if(h<0)throw new n._Boot.HaxeError("Error: PulleyJoint::jointMin must be >= 0");if(this.zpp_inner_zn.jointMin!=h&&(this.zpp_inner_zn.jointMin=h,this.zpp_inner.wake()),this.zpp_inner.immutable_midstep("PulleyJoint::jointMax"),c!=c)throw new n._Boot.HaxeError("Error: PulleyJoint::jointMax cannot be NaN");if(c<0)throw new n._Boot.HaxeError("Error: PulleyJoint::jointMax must be >= 0");this.zpp_inner_zn.jointMax!=c&&(this.zpp_inner_zn.jointMax=c,this.zpp_inner.wake())},e.constraint.PulleyJoint.__name__=["nape","constraint","PulleyJoint"],e.constraint.PulleyJoint.__super__=e.constraint.Constraint,e.constraint.Constraint.prototype)e.constraint.PulleyJoint.prototype[u]=e.constraint.Constraint.prototype[u];for(var u in e.constraint.PulleyJoint.prototype.zpp_inner_zn=null,Object.defineProperty(e.constraint.PulleyJoint.prototype,"body1",{get:e.constraint.PulleyJoint.prototype.get_body1,set:e.constraint.PulleyJoint.prototype.set_body1}),e.constraint.PulleyJoint.prototype.get_body1=function(){return null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer},e.constraint.PulleyJoint.prototype.set_body1=function(e){this.zpp_inner.immutable_midstep("Constraint::body1");var t=null==e?null:e.zpp_inner;return t!=this.zpp_inner_zn.b1&&(null!=this.zpp_inner_zn.b1&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2!=this.zpp_inner_zn.b1&&this.zpp_inner_zn.b3!=this.zpp_inner_zn.b1&&this.zpp_inner_zn.b4!=this.zpp_inner_zn.b1&&null!=this.zpp_inner_zn.b1&&this.zpp_inner_zn.b1.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1.wake()),this.zpp_inner_zn.b1=t,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=t&&this.zpp_inner_zn.b2!=t&&this.zpp_inner_zn.b3!=t&&this.zpp_inner_zn.b4!=t&&null!=t&&t.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=t&&t.wake())),null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer},Object.defineProperty(e.constraint.PulleyJoint.prototype,"body2",{get:e.constraint.PulleyJoint.prototype.get_body2,set:e.constraint.PulleyJoint.prototype.set_body2}),e.constraint.PulleyJoint.prototype.get_body2=function(){return null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer},e.constraint.PulleyJoint.prototype.set_body2=function(e){this.zpp_inner.immutable_midstep("Constraint::body2");var t=null==e?null:e.zpp_inner;return t!=this.zpp_inner_zn.b2&&(null!=this.zpp_inner_zn.b2&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1!=this.zpp_inner_zn.b2&&this.zpp_inner_zn.b3!=this.zpp_inner_zn.b2&&this.zpp_inner_zn.b4!=this.zpp_inner_zn.b2&&null!=this.zpp_inner_zn.b2&&this.zpp_inner_zn.b2.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2.wake()),this.zpp_inner_zn.b2=t,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=t&&this.zpp_inner_zn.b1!=t&&this.zpp_inner_zn.b3!=t&&this.zpp_inner_zn.b4!=t&&null!=t&&t.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=t&&t.wake())),null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer},Object.defineProperty(e.constraint.PulleyJoint.prototype,"body3",{get:e.constraint.PulleyJoint.prototype.get_body3,set:e.constraint.PulleyJoint.prototype.set_body3}),e.constraint.PulleyJoint.prototype.get_body3=function(){return null==this.zpp_inner_zn.b3?null:this.zpp_inner_zn.b3.outer},e.constraint.PulleyJoint.prototype.set_body3=function(e){this.zpp_inner.immutable_midstep("Constraint::body3");var t=null==e?null:e.zpp_inner;return t!=this.zpp_inner_zn.b3&&(null!=this.zpp_inner_zn.b3&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1!=this.zpp_inner_zn.b3&&this.zpp_inner_zn.b2!=this.zpp_inner_zn.b3&&this.zpp_inner_zn.b4!=this.zpp_inner_zn.b3&&null!=this.zpp_inner_zn.b3&&this.zpp_inner_zn.b3.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b3.wake()),this.zpp_inner_zn.b3=t,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=t&&this.zpp_inner_zn.b1!=t&&this.zpp_inner_zn.b2!=t&&this.zpp_inner_zn.b4!=t&&null!=t&&t.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=t&&t.wake())),null==this.zpp_inner_zn.b3?null:this.zpp_inner_zn.b3.outer},Object.defineProperty(e.constraint.PulleyJoint.prototype,"body4",{get:e.constraint.PulleyJoint.prototype.get_body4,set:e.constraint.PulleyJoint.prototype.set_body4}),e.constraint.PulleyJoint.prototype.get_body4=function(){return null==this.zpp_inner_zn.b4?null:this.zpp_inner_zn.b4.outer},e.constraint.PulleyJoint.prototype.set_body4=function(e){this.zpp_inner.immutable_midstep("Constraint::body4");var t=null==e?null:e.zpp_inner;return t!=this.zpp_inner_zn.b4&&(null!=this.zpp_inner_zn.b4&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1!=this.zpp_inner_zn.b4&&this.zpp_inner_zn.b2!=this.zpp_inner_zn.b4&&this.zpp_inner_zn.b3!=this.zpp_inner_zn.b4&&null!=this.zpp_inner_zn.b4&&this.zpp_inner_zn.b4.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b4.wake()),this.zpp_inner_zn.b4=t,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=t&&this.zpp_inner_zn.b1!=t&&this.zpp_inner_zn.b2!=t&&this.zpp_inner_zn.b3!=t&&null!=t&&t.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=t&&t.wake())),null==this.zpp_inner_zn.b4?null:this.zpp_inner_zn.b4.outer},Object.defineProperty(e.constraint.PulleyJoint.prototype,"anchor1",{get:e.constraint.PulleyJoint.prototype.get_anchor1,set:e.constraint.PulleyJoint.prototype.set_anchor1}),e.constraint.PulleyJoint.prototype.get_anchor1=function(){return null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1(),this.zpp_inner_zn.wrap_a1},e.constraint.PulleyJoint.prototype.set_anchor1=function(e){if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");if(null==e)throw new n._Boot.HaxeError("Error: Constraint::anchor1 cannot be null");null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1();var i=this.zpp_inner_zn.wrap_a1;if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var r=i.zpp_inner;if(r._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=r._isimmutable&&r._isimmutable(),null==e)throw new n._Boot.HaxeError("Error: Cannot assign null Vec2");if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var o=e.zpp_inner;null!=o._validate&&o._validate();var a=e.zpp_inner.x;if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var s=e.zpp_inner;null!=s._validate&&s._validate();var l=e.zpp_inner.y;if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var p,u=i.zpp_inner;if(u._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=u._isimmutable&&u._isimmutable(),a!=a||l!=l)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var h=i.zpp_inner;if(null!=h._validate&&h._validate(),i.zpp_inner.x==a){if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var c=i.zpp_inner;null!=c._validate&&c._validate(),p=i.zpp_inner.y==l}else p=!1;if(!p){i.zpp_inner.x=a,i.zpp_inner.y=l;var _=i.zpp_inner;null!=_._invalidate&&_._invalidate(_)}if(e.zpp_inner.weak){if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var d=e.zpp_inner;if(d._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=d._isimmutable&&d._isimmutable(),e.zpp_inner._inuse)throw new n._Boot.HaxeError("Error: This Vec2 is not disposable");var m=e.zpp_inner;e.zpp_inner.outer=null,e.zpp_inner=null;var P=e;P.zpp_pool=null,null!=t.util.ZPP_PubPool.nextVec2?t.util.ZPP_PubPool.nextVec2.zpp_pool=P:t.util.ZPP_PubPool.poolVec2=P,t.util.ZPP_PubPool.nextVec2=P,P.zpp_disp=!0;var f=m;null!=f.outer&&(f.outer.zpp_inner=null,f.outer=null),f._isimmutable=null,f._validate=null,f._invalidate=null,f.next=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=f}return null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1(),this.zpp_inner_zn.wrap_a1},Object.defineProperty(e.constraint.PulleyJoint.prototype,"anchor2",{get:e.constraint.PulleyJoint.prototype.get_anchor2,set:e.constraint.PulleyJoint.prototype.set_anchor2}),e.constraint.PulleyJoint.prototype.get_anchor2=function(){return null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2(),this.zpp_inner_zn.wrap_a2},e.constraint.PulleyJoint.prototype.set_anchor2=function(e){if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");if(null==e)throw new n._Boot.HaxeError("Error: Constraint::anchor2 cannot be null");null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2();var i=this.zpp_inner_zn.wrap_a2;if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var r=i.zpp_inner;if(r._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=r._isimmutable&&r._isimmutable(),null==e)throw new n._Boot.HaxeError("Error: Cannot assign null Vec2");if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var o=e.zpp_inner;null!=o._validate&&o._validate();var a=e.zpp_inner.x;if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var s=e.zpp_inner;null!=s._validate&&s._validate();var l=e.zpp_inner.y;if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var p,u=i.zpp_inner;if(u._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=u._isimmutable&&u._isimmutable(),a!=a||l!=l)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var h=i.zpp_inner;if(null!=h._validate&&h._validate(),i.zpp_inner.x==a){if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var c=i.zpp_inner;null!=c._validate&&c._validate(),p=i.zpp_inner.y==l}else p=!1;if(!p){i.zpp_inner.x=a,i.zpp_inner.y=l;var _=i.zpp_inner;null!=_._invalidate&&_._invalidate(_)}if(e.zpp_inner.weak){if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var d=e.zpp_inner;if(d._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=d._isimmutable&&d._isimmutable(),e.zpp_inner._inuse)throw new n._Boot.HaxeError("Error: This Vec2 is not disposable");var m=e.zpp_inner;e.zpp_inner.outer=null,e.zpp_inner=null;var P=e;P.zpp_pool=null,null!=t.util.ZPP_PubPool.nextVec2?t.util.ZPP_PubPool.nextVec2.zpp_pool=P:t.util.ZPP_PubPool.poolVec2=P,t.util.ZPP_PubPool.nextVec2=P,P.zpp_disp=!0;var f=m;null!=f.outer&&(f.outer.zpp_inner=null,f.outer=null),f._isimmutable=null,f._validate=null,f._invalidate=null,f.next=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=f}return null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2(),this.zpp_inner_zn.wrap_a2},Object.defineProperty(e.constraint.PulleyJoint.prototype,"anchor3",{get:e.constraint.PulleyJoint.prototype.get_anchor3,set:e.constraint.PulleyJoint.prototype.set_anchor3}),e.constraint.PulleyJoint.prototype.get_anchor3=function(){return null==this.zpp_inner_zn.wrap_a3&&this.zpp_inner_zn.setup_a3(),this.zpp_inner_zn.wrap_a3},e.constraint.PulleyJoint.prototype.set_anchor3=function(e){if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");if(null==e)throw new n._Boot.HaxeError("Error: Constraint::anchor3 cannot be null");null==this.zpp_inner_zn.wrap_a3&&this.zpp_inner_zn.setup_a3();var i=this.zpp_inner_zn.wrap_a3;if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var r=i.zpp_inner;if(r._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=r._isimmutable&&r._isimmutable(),null==e)throw new n._Boot.HaxeError("Error: Cannot assign null Vec2");if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var o=e.zpp_inner;null!=o._validate&&o._validate();var a=e.zpp_inner.x;if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var s=e.zpp_inner;null!=s._validate&&s._validate();var l=e.zpp_inner.y;if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var p,u=i.zpp_inner;if(u._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=u._isimmutable&&u._isimmutable(),a!=a||l!=l)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var h=i.zpp_inner;if(null!=h._validate&&h._validate(),i.zpp_inner.x==a){if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var c=i.zpp_inner;null!=c._validate&&c._validate(),p=i.zpp_inner.y==l}else p=!1;if(!p){i.zpp_inner.x=a,i.zpp_inner.y=l;var _=i.zpp_inner;null!=_._invalidate&&_._invalidate(_)}if(e.zpp_inner.weak){if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var d=e.zpp_inner;if(d._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=d._isimmutable&&d._isimmutable(),e.zpp_inner._inuse)throw new n._Boot.HaxeError("Error: This Vec2 is not disposable");var m=e.zpp_inner;e.zpp_inner.outer=null,e.zpp_inner=null;var P=e;P.zpp_pool=null,null!=t.util.ZPP_PubPool.nextVec2?t.util.ZPP_PubPool.nextVec2.zpp_pool=P:t.util.ZPP_PubPool.poolVec2=P,t.util.ZPP_PubPool.nextVec2=P,P.zpp_disp=!0;var f=m;null!=f.outer&&(f.outer.zpp_inner=null,f.outer=null),f._isimmutable=null,f._validate=null,f._invalidate=null,f.next=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=f}return null==this.zpp_inner_zn.wrap_a3&&this.zpp_inner_zn.setup_a3(),this.zpp_inner_zn.wrap_a3},Object.defineProperty(e.constraint.PulleyJoint.prototype,"anchor4",{get:e.constraint.PulleyJoint.prototype.get_anchor4,set:e.constraint.PulleyJoint.prototype.set_anchor4}),e.constraint.PulleyJoint.prototype.get_anchor4=function(){return null==this.zpp_inner_zn.wrap_a4&&this.zpp_inner_zn.setup_a4(),this.zpp_inner_zn.wrap_a4},e.constraint.PulleyJoint.prototype.set_anchor4=function(e){if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");if(null==e)throw new n._Boot.HaxeError("Error: Constraint::anchor4 cannot be null");null==this.zpp_inner_zn.wrap_a4&&this.zpp_inner_zn.setup_a4();var i=this.zpp_inner_zn.wrap_a4;if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var r=i.zpp_inner;if(r._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=r._isimmutable&&r._isimmutable(),null==e)throw new n._Boot.HaxeError("Error: Cannot assign null Vec2");if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var o=e.zpp_inner;null!=o._validate&&o._validate();var a=e.zpp_inner.x;if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var s=e.zpp_inner;null!=s._validate&&s._validate();var l=e.zpp_inner.y;if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var p,u=i.zpp_inner;if(u._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=u._isimmutable&&u._isimmutable(),a!=a||l!=l)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var h=i.zpp_inner;if(null!=h._validate&&h._validate(),i.zpp_inner.x==a){if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var c=i.zpp_inner;null!=c._validate&&c._validate(),p=i.zpp_inner.y==l}else p=!1;if(!p){i.zpp_inner.x=a,i.zpp_inner.y=l;var _=i.zpp_inner;null!=_._invalidate&&_._invalidate(_)}if(e.zpp_inner.weak){if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var d=e.zpp_inner;if(d._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=d._isimmutable&&d._isimmutable(),e.zpp_inner._inuse)throw new n._Boot.HaxeError("Error: This Vec2 is not disposable");var m=e.zpp_inner;e.zpp_inner.outer=null,e.zpp_inner=null;var P=e;P.zpp_pool=null,null!=t.util.ZPP_PubPool.nextVec2?t.util.ZPP_PubPool.nextVec2.zpp_pool=P:t.util.ZPP_PubPool.poolVec2=P,t.util.ZPP_PubPool.nextVec2=P,P.zpp_disp=!0;var f=m;null!=f.outer&&(f.outer.zpp_inner=null,f.outer=null),f._isimmutable=null,f._validate=null,f._invalidate=null,f.next=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=f}return null==this.zpp_inner_zn.wrap_a4&&this.zpp_inner_zn.setup_a4(),this.zpp_inner_zn.wrap_a4},Object.defineProperty(e.constraint.PulleyJoint.prototype,"jointMin",{get:e.constraint.PulleyJoint.prototype.get_jointMin,set:e.constraint.PulleyJoint.prototype.set_jointMin}),e.constraint.PulleyJoint.prototype.get_jointMin=function(){return this.zpp_inner_zn.jointMin},e.constraint.PulleyJoint.prototype.set_jointMin=function(e){if(this.zpp_inner.immutable_midstep("PulleyJoint::jointMin"),e!=e)throw new n._Boot.HaxeError("Error: PulleyJoint::jointMin cannot be NaN");if(e<0)throw new n._Boot.HaxeError("Error: PulleyJoint::jointMin must be >= 0");return this.zpp_inner_zn.jointMin!=e&&(this.zpp_inner_zn.jointMin=e,this.zpp_inner.wake()),this.zpp_inner_zn.jointMin},Object.defineProperty(e.constraint.PulleyJoint.prototype,"jointMax",{get:e.constraint.PulleyJoint.prototype.get_jointMax,set:e.constraint.PulleyJoint.prototype.set_jointMax}),e.constraint.PulleyJoint.prototype.get_jointMax=function(){return this.zpp_inner_zn.jointMax},e.constraint.PulleyJoint.prototype.set_jointMax=function(e){if(this.zpp_inner.immutable_midstep("PulleyJoint::jointMax"),e!=e)throw new n._Boot.HaxeError("Error: PulleyJoint::jointMax cannot be NaN");if(e<0)throw new n._Boot.HaxeError("Error: PulleyJoint::jointMax must be >= 0");return this.zpp_inner_zn.jointMax!=e&&(this.zpp_inner_zn.jointMax=e,this.zpp_inner.wake()),this.zpp_inner_zn.jointMax},Object.defineProperty(e.constraint.PulleyJoint.prototype,"ratio",{get:e.constraint.PulleyJoint.prototype.get_ratio,set:e.constraint.PulleyJoint.prototype.set_ratio}),e.constraint.PulleyJoint.prototype.get_ratio=function(){return this.zpp_inner_zn.ratio},e.constraint.PulleyJoint.prototype.set_ratio=function(e){if(this.zpp_inner.immutable_midstep("PulleyJoint::ratio"),e!=e)throw new n._Boot.HaxeError("Error: PulleyJoint::ratio cannot be NaN");return this.zpp_inner_zn.ratio!=e&&(this.zpp_inner_zn.ratio=e,this.zpp_inner.wake()),this.zpp_inner_zn.ratio},e.constraint.PulleyJoint.prototype.isSlack=function(){if(null==(null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer)||null==(null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer)||null==(null==this.zpp_inner_zn.b3?null:this.zpp_inner_zn.b3.outer)||null==(null==this.zpp_inner_zn.b4?null:this.zpp_inner_zn.b4.outer))throw new n._Boot.HaxeError("Error: Cannot compute slack for PulleyJoint if either body is null.");return this.zpp_inner_zn.slack},e.constraint.PulleyJoint.prototype.impulse=function(){var t=new e.geom.MatMN(1,1);if(0>=t.zpp_inner.m||0>=t.zpp_inner.n)throw new n._Boot.HaxeError("Error: MatMN indices out of range");return t.zpp_inner.x[0*t.zpp_inner.n]=this.zpp_inner_zn.jAcc,t},e.constraint.PulleyJoint.prototype.bodyImpulse=function(t){if(null==t)throw new n._Boot.HaxeError("Error: Cannot evaluate impulse on null body");if(t!=(null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer)&&t!=(null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer)&&t!=(null==this.zpp_inner_zn.b3?null:this.zpp_inner_zn.b3.outer)&&t!=(null==this.zpp_inner_zn.b4?null:this.zpp_inner_zn.b4.outer))throw new n._Boot.HaxeError("Error: Body is not linked to this constraint");return this.zpp_inner.active?this.zpp_inner_zn.bodyImpulse(t.zpp_inner):e.geom.Vec3.get()},e.constraint.PulleyJoint.prototype.visitBodies=function(e){null!=(null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer)&&e(null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer),null!=(null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer)&&(null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer)!=(null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer)&&e(null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer),null!=(null==this.zpp_inner_zn.b3?null:this.zpp_inner_zn.b3.outer)&&(null==this.zpp_inner_zn.b3?null:this.zpp_inner_zn.b3.outer)!=(null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer)&&(null==this.zpp_inner_zn.b3?null:this.zpp_inner_zn.b3.outer)!=(null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer)&&e(null==this.zpp_inner_zn.b3?null:this.zpp_inner_zn.b3.outer),null!=(null==this.zpp_inner_zn.b4?null:this.zpp_inner_zn.b4.outer)&&(null==this.zpp_inner_zn.b4?null:this.zpp_inner_zn.b4.outer)!=(null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer)&&(null==this.zpp_inner_zn.b4?null:this.zpp_inner_zn.b4.outer)!=(null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer)&&(null==this.zpp_inner_zn.b4?null:this.zpp_inner_zn.b4.outer)!=(null==this.zpp_inner_zn.b3?null:this.zpp_inner_zn.b3.outer)&&e(null==this.zpp_inner_zn.b4?null:this.zpp_inner_zn.b4.outer)},e.constraint.PulleyJoint.prototype.__class__=e.constraint.PulleyJoint,e.constraint.UserConstraint=l["nape.constraint.UserConstraint"]=function(i,r){if(null==r&&(r=!1),this.zpp_inner_zn=null,i<1)throw new n._Boot.HaxeError("Error: Constraint dimension must be at least 1");this.zpp_inner_zn=new t.constraint.ZPP_UserConstraint(i,r),this.zpp_inner=this.zpp_inner_zn,this.zpp_inner.outer=this,this.zpp_inner_zn.outer_zn=this,e.constraint.Constraint.zpp_internalAlloc=!0,e.constraint.Constraint.call(this),e.constraint.Constraint.zpp_internalAlloc=!1},e.constraint.UserConstraint.__name__=["nape","constraint","UserConstraint"],e.constraint.UserConstraint.__super__=e.constraint.Constraint,e.constraint.Constraint.prototype)e.constraint.UserConstraint.prototype[u]=e.constraint.Constraint.prototype[u];for(var u in e.constraint.UserConstraint.prototype.zpp_inner_zn=null,e.constraint.UserConstraint.prototype.__bindVec2=function(){var t=new e.geom.Vec2;return t.zpp_inner._inuse=!0,t.zpp_inner._invalidate=p(s=this.zpp_inner_zn,s.bindVec2_invalidate),t},e.constraint.UserConstraint.prototype.__copy=function(){throw new n._Boot.HaxeError("Error: UserConstraint::__copy must be overriden")},e.constraint.UserConstraint.prototype.__broken=function(){},e.constraint.UserConstraint.prototype.__validate=function(){},e.constraint.UserConstraint.prototype.__draw=function(e){},e.constraint.UserConstraint.prototype.__prepare=function(){},e.constraint.UserConstraint.prototype.__position=function(e){throw new n._Boot.HaxeError("Error: UserConstraint::__position must be overriden")},e.constraint.UserConstraint.prototype.__velocity=function(e){throw new n._Boot.HaxeError("Error: Userconstraint::__velocity must be overriden")},e.constraint.UserConstraint.prototype.__eff_mass=function(e){throw new n._Boot.HaxeError("Error: UserConstraint::__eff_mass must be overriden")},e.constraint.UserConstraint.prototype.__clamp=function(e){},e.constraint.UserConstraint.prototype.__impulse=function(e,t,i){throw new n._Boot.HaxeError("Error: UserConstraint::__impulse must be overriden")},e.constraint.UserConstraint.prototype.impulse=function(){for(var t=new e.geom.MatMN(this.zpp_inner_zn.dim,1),i=0,r=this.zpp_inner_zn.dim;i<r;){var o=i++;if(o<0||o>=t.zpp_inner.m||0>=t.zpp_inner.n)throw new n._Boot.HaxeError("Error: MatMN indices out of range");t.zpp_inner.x[o*t.zpp_inner.n]=this.zpp_inner_zn.jAcc[o]}return t},e.constraint.UserConstraint.prototype.bodyImpulse=function(t){if(null==t)throw new n._Boot.HaxeError("Error: Cannot evaluate impulse on null body");for(var i=!1,r=0,o=this.zpp_inner_zn.bodies;r<o.length;){var a=o[r];if(++r,a.body==t.zpp_inner){i=!0;break}}if(!i)throw new n._Boot.HaxeError("Error: Body is not linked to this constraint");return this.zpp_inner.active?this.zpp_inner_zn.bodyImpulse(t.zpp_inner):e.geom.Vec3.get()},e.constraint.UserConstraint.prototype.visitBodies=function(e){for(var t=0,n=this.zpp_inner_zn.bodies.length;t<n;){var i=this.zpp_inner_zn.bodies[t];if(null!=i.body){for(var r=!1,o=t+1,a=n;o<a;){var s=o++;if(this.zpp_inner_zn.bodies[s].body==i.body){r=!0;break}}r||e(i.body.outer)}++t}},e.constraint.UserConstraint.prototype.__invalidate=function(){this.zpp_inner.immutable_midstep("UserConstraint::invalidate()"),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner.wake()},e.constraint.UserConstraint.prototype.__registerBody=function(e,t){if(this.zpp_inner.immutable_midstep("UserConstraint::registerBody(..)"),e!=t){if(null!=e){if(!this.zpp_inner_zn.remBody(e.zpp_inner))throw new n._Boot.HaxeError("Error: oldBody is not registered to the cosntraint");this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&e.zpp_inner.wake()}null!=t&&this.zpp_inner_zn.addBody(t.zpp_inner),this.zpp_inner.wake(),null!=t&&t.zpp_inner.wake()}return t},e.constraint.UserConstraint.prototype.__class__=e.constraint.UserConstraint,e.constraint.WeldJoint=l["nape.constraint.WeldJoint"]=function(i,r,o,a,s){null==s&&(s=0),this.zpp_inner_zn=null,this.zpp_inner_zn=new t.constraint.ZPP_WeldJoint,this.zpp_inner=this.zpp_inner_zn,this.zpp_inner.outer=this,this.zpp_inner_zn.outer_zn=this,e.constraint.Constraint.zpp_internalAlloc=!0,e.constraint.Constraint.call(this),e.constraint.Constraint.zpp_internalAlloc=!1,this.zpp_inner.immutable_midstep("Constraint::body1");var l=null==i?null:i.zpp_inner;l!=this.zpp_inner_zn.b1&&(null!=this.zpp_inner_zn.b1&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2!=this.zpp_inner_zn.b1&&null!=this.zpp_inner_zn.b1&&this.zpp_inner_zn.b1.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1.wake()),this.zpp_inner_zn.b1=l,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=l&&this.zpp_inner_zn.b2!=l&&null!=l&&l.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=l&&l.wake())),this.zpp_inner_zn.b1,this.zpp_inner.immutable_midstep("Constraint::body2");var p=null==r?null:r.zpp_inner;if(p!=this.zpp_inner_zn.b2&&(null!=this.zpp_inner_zn.b2&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1!=this.zpp_inner_zn.b2&&null!=this.zpp_inner_zn.b2&&this.zpp_inner_zn.b2.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2.wake()),this.zpp_inner_zn.b2=p,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=p&&this.zpp_inner_zn.b1!=p&&null!=p&&p.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=p&&p.wake())),this.zpp_inner_zn.b2,null!=o&&o.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");if(null==o)throw new n._Boot.HaxeError("Error: Constraint::anchor1 cannot be null");null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1();var u=this.zpp_inner_zn.wrap_a1;if(null!=u&&u.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");if(null!=o&&o.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var h=u.zpp_inner;if(h._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=h._isimmutable&&h._isimmutable(),null==o)throw new n._Boot.HaxeError("Error: Cannot assign null Vec2");if(null!=o&&o.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var c=o.zpp_inner;null!=c._validate&&c._validate();var _=o.zpp_inner.x;if(null!=o&&o.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var d=o.zpp_inner;null!=d._validate&&d._validate();var m=o.zpp_inner.y;if(null!=u&&u.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var P,f=u.zpp_inner;if(f._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=f._isimmutable&&f._isimmutable(),_!=_||m!=m)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null!=u&&u.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var x=u.zpp_inner;if(null!=x._validate&&x._validate(),u.zpp_inner.x==_){if(null!=u&&u.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var y=u.zpp_inner;null!=y._validate&&y._validate(),P=u.zpp_inner.y==m}else P=!1;if(!P){u.zpp_inner.x=_,u.zpp_inner.y=m;var v=u.zpp_inner;null!=v._invalidate&&v._invalidate(v)}if(o.zpp_inner.weak){if(null!=o&&o.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var g=o.zpp_inner;if(g._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=g._isimmutable&&g._isimmutable(),o.zpp_inner._inuse)throw new n._Boot.HaxeError("Error: This Vec2 is not disposable");var b=o.zpp_inner;o.zpp_inner.outer=null,o.zpp_inner=null;var z=o;z.zpp_pool=null,null!=t.util.ZPP_PubPool.nextVec2?t.util.ZPP_PubPool.nextVec2.zpp_pool=z:t.util.ZPP_PubPool.poolVec2=z,t.util.ZPP_PubPool.nextVec2=z,z.zpp_disp=!0;var w=b;null!=w.outer&&(w.outer.zpp_inner=null,w.outer=null),w._isimmutable=null,w._validate=null,w._invalidate=null,w.next=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=w}if(null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1(),null!=a&&a.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");if(null==a)throw new n._Boot.HaxeError("Error: Constraint::anchor2 cannot be null");null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2();var Z=this.zpp_inner_zn.wrap_a2;if(null!=Z&&Z.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");if(null!=a&&a.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var E=Z.zpp_inner;if(E._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=E._isimmutable&&E._isimmutable(),null==a)throw new n._Boot.HaxeError("Error: Cannot assign null Vec2");if(null!=a&&a.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var M=a.zpp_inner;null!=M._validate&&M._validate();var S=a.zpp_inner.x;if(null!=a&&a.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var C=a.zpp_inner;null!=C._validate&&C._validate();var N=a.zpp_inner.y;if(null!=Z&&Z.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var A,L=Z.zpp_inner;if(L._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=L._isimmutable&&L._isimmutable(),S!=S||N!=N)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null!=Z&&Z.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var B=Z.zpp_inner;if(null!=B._validate&&B._validate(),Z.zpp_inner.x==S){if(null!=Z&&Z.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var T=Z.zpp_inner;null!=T._validate&&T._validate(),A=Z.zpp_inner.y==N}else A=!1;if(!A){Z.zpp_inner.x=S,Z.zpp_inner.y=N;var V=Z.zpp_inner;null!=V._invalidate&&V._invalidate(V)}if(a.zpp_inner.weak){if(null!=a&&a.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var k=a.zpp_inner;if(k._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=k._isimmutable&&k._isimmutable(),a.zpp_inner._inuse)throw new n._Boot.HaxeError("Error: This Vec2 is not disposable");var I=a.zpp_inner;a.zpp_inner.outer=null,a.zpp_inner=null;var O=a;O.zpp_pool=null,null!=t.util.ZPP_PubPool.nextVec2?t.util.ZPP_PubPool.nextVec2.zpp_pool=O:t.util.ZPP_PubPool.poolVec2=O,t.util.ZPP_PubPool.nextVec2=O,O.zpp_disp=!0;var R=I;null!=R.outer&&(R.outer.zpp_inner=null,R.outer=null),R._isimmutable=null,R._validate=null,R._invalidate=null,R.next=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=R}if(null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2(),this.zpp_inner.immutable_midstep("WeldJoint::phase"),s!=s)throw new n._Boot.HaxeError("Error: WeldJoint::phase cannot be NaN");this.zpp_inner_zn.phase!=s&&(this.zpp_inner_zn.phase=s,this.zpp_inner.wake())},e.constraint.WeldJoint.__name__=["nape","constraint","WeldJoint"],e.constraint.WeldJoint.__super__=e.constraint.Constraint,e.constraint.Constraint.prototype)e.constraint.WeldJoint.prototype[u]=e.constraint.Constraint.prototype[u];for(var u in e.constraint.WeldJoint.prototype.zpp_inner_zn=null,Object.defineProperty(e.constraint.WeldJoint.prototype,"body1",{get:e.constraint.WeldJoint.prototype.get_body1,set:e.constraint.WeldJoint.prototype.set_body1}),e.constraint.WeldJoint.prototype.get_body1=function(){return null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer},e.constraint.WeldJoint.prototype.set_body1=function(e){this.zpp_inner.immutable_midstep("Constraint::body1");var t=null==e?null:e.zpp_inner;return t!=this.zpp_inner_zn.b1&&(null!=this.zpp_inner_zn.b1&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2!=this.zpp_inner_zn.b1&&null!=this.zpp_inner_zn.b1&&this.zpp_inner_zn.b1.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1.wake()),this.zpp_inner_zn.b1=t,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=t&&this.zpp_inner_zn.b2!=t&&null!=t&&t.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=t&&t.wake())),null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer},Object.defineProperty(e.constraint.WeldJoint.prototype,"body2",{get:e.constraint.WeldJoint.prototype.get_body2,set:e.constraint.WeldJoint.prototype.set_body2}),e.constraint.WeldJoint.prototype.get_body2=function(){return null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer},e.constraint.WeldJoint.prototype.set_body2=function(e){this.zpp_inner.immutable_midstep("Constraint::body2");var t=null==e?null:e.zpp_inner;return t!=this.zpp_inner_zn.b2&&(null!=this.zpp_inner_zn.b2&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1!=this.zpp_inner_zn.b2&&null!=this.zpp_inner_zn.b2&&this.zpp_inner_zn.b2.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2.wake()),this.zpp_inner_zn.b2=t,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=t&&this.zpp_inner_zn.b1!=t&&null!=t&&t.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=t&&t.wake())),null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer},Object.defineProperty(e.constraint.WeldJoint.prototype,"anchor1",{get:e.constraint.WeldJoint.prototype.get_anchor1,set:e.constraint.WeldJoint.prototype.set_anchor1}),e.constraint.WeldJoint.prototype.get_anchor1=function(){return null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1(),this.zpp_inner_zn.wrap_a1},e.constraint.WeldJoint.prototype.set_anchor1=function(e){if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");if(null==e)throw new n._Boot.HaxeError("Error: Constraint::anchor1 cannot be null");null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1();var i=this.zpp_inner_zn.wrap_a1;if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var r=i.zpp_inner;if(r._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=r._isimmutable&&r._isimmutable(),null==e)throw new n._Boot.HaxeError("Error: Cannot assign null Vec2");if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var o=e.zpp_inner;null!=o._validate&&o._validate();var a=e.zpp_inner.x;if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var s=e.zpp_inner;null!=s._validate&&s._validate();var l=e.zpp_inner.y;if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var p,u=i.zpp_inner;if(u._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=u._isimmutable&&u._isimmutable(),a!=a||l!=l)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var h=i.zpp_inner;if(null!=h._validate&&h._validate(),i.zpp_inner.x==a){if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var c=i.zpp_inner;null!=c._validate&&c._validate(),p=i.zpp_inner.y==l}else p=!1;if(!p){i.zpp_inner.x=a,i.zpp_inner.y=l;var _=i.zpp_inner;null!=_._invalidate&&_._invalidate(_)}if(e.zpp_inner.weak){if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var d=e.zpp_inner;if(d._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=d._isimmutable&&d._isimmutable(),e.zpp_inner._inuse)throw new n._Boot.HaxeError("Error: This Vec2 is not disposable");var m=e.zpp_inner;e.zpp_inner.outer=null,e.zpp_inner=null;var P=e;P.zpp_pool=null,null!=t.util.ZPP_PubPool.nextVec2?t.util.ZPP_PubPool.nextVec2.zpp_pool=P:t.util.ZPP_PubPool.poolVec2=P,t.util.ZPP_PubPool.nextVec2=P,P.zpp_disp=!0;var f=m;null!=f.outer&&(f.outer.zpp_inner=null,f.outer=null),f._isimmutable=null,f._validate=null,f._invalidate=null,f.next=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=f}return null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1(),this.zpp_inner_zn.wrap_a1},Object.defineProperty(e.constraint.WeldJoint.prototype,"anchor2",{get:e.constraint.WeldJoint.prototype.get_anchor2,set:e.constraint.WeldJoint.prototype.set_anchor2}),e.constraint.WeldJoint.prototype.get_anchor2=function(){return null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2(),this.zpp_inner_zn.wrap_a2},e.constraint.WeldJoint.prototype.set_anchor2=function(e){if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");if(null==e)throw new n._Boot.HaxeError("Error: Constraint::anchor2 cannot be null");null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2();var i=this.zpp_inner_zn.wrap_a2;if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var r=i.zpp_inner;if(r._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=r._isimmutable&&r._isimmutable(),null==e)throw new n._Boot.HaxeError("Error: Cannot assign null Vec2");if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var o=e.zpp_inner;null!=o._validate&&o._validate();var a=e.zpp_inner.x;if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var s=e.zpp_inner;null!=s._validate&&s._validate();var l=e.zpp_inner.y;if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var p,u=i.zpp_inner;if(u._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=u._isimmutable&&u._isimmutable(),a!=a||l!=l)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var h=i.zpp_inner;if(null!=h._validate&&h._validate(),i.zpp_inner.x==a){if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var c=i.zpp_inner;null!=c._validate&&c._validate(),p=i.zpp_inner.y==l}else p=!1;if(!p){i.zpp_inner.x=a,i.zpp_inner.y=l;var _=i.zpp_inner;null!=_._invalidate&&_._invalidate(_)}if(e.zpp_inner.weak){if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var d=e.zpp_inner;if(d._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=d._isimmutable&&d._isimmutable(),e.zpp_inner._inuse)throw new n._Boot.HaxeError("Error: This Vec2 is not disposable");var m=e.zpp_inner;e.zpp_inner.outer=null,e.zpp_inner=null;var P=e;P.zpp_pool=null,null!=t.util.ZPP_PubPool.nextVec2?t.util.ZPP_PubPool.nextVec2.zpp_pool=P:t.util.ZPP_PubPool.poolVec2=P,t.util.ZPP_PubPool.nextVec2=P,P.zpp_disp=!0;var f=m;null!=f.outer&&(f.outer.zpp_inner=null,f.outer=null),f._isimmutable=null,f._validate=null,f._invalidate=null,f.next=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=f}return null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2(),this.zpp_inner_zn.wrap_a2},Object.defineProperty(e.constraint.WeldJoint.prototype,"phase",{get:e.constraint.WeldJoint.prototype.get_phase,set:e.constraint.WeldJoint.prototype.set_phase}),e.constraint.WeldJoint.prototype.get_phase=function(){return this.zpp_inner_zn.phase},e.constraint.WeldJoint.prototype.set_phase=function(e){if(this.zpp_inner.immutable_midstep("WeldJoint::phase"),e!=e)throw new n._Boot.HaxeError("Error: WeldJoint::phase cannot be NaN");return this.zpp_inner_zn.phase!=e&&(this.zpp_inner_zn.phase=e,this.zpp_inner.wake()),this.zpp_inner_zn.phase},e.constraint.WeldJoint.prototype.impulse=function(){var t=new e.geom.MatMN(3,1);if(0>=t.zpp_inner.m||0>=t.zpp_inner.n)throw new n._Boot.HaxeError("Error: MatMN indices out of range");if(t.zpp_inner.x[0*t.zpp_inner.n]=this.zpp_inner_zn.jAccx,1>=t.zpp_inner.m||0>=t.zpp_inner.n)throw new n._Boot.HaxeError("Error: MatMN indices out of range");if(t.zpp_inner.x[t.zpp_inner.n]=this.zpp_inner_zn.jAccy,1>=t.zpp_inner.m||0>=t.zpp_inner.n)throw new n._Boot.HaxeError("Error: MatMN indices out of range");return t.zpp_inner.x[t.zpp_inner.n]=this.zpp_inner_zn.jAccz,t},e.constraint.WeldJoint.prototype.bodyImpulse=function(t){if(null==t)throw new n._Boot.HaxeError("Error: Cannot evaluate impulse on null body");if(t!=(null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer)&&t!=(null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer))throw new n._Boot.HaxeError("Error: Body is not linked to this constraint");return this.zpp_inner.active?this.zpp_inner_zn.bodyImpulse(t.zpp_inner):e.geom.Vec3.get()},e.constraint.WeldJoint.prototype.visitBodies=function(e){null!=(null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer)&&e(null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer),null!=(null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer)&&(null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer)!=(null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer)&&e(null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer)},e.constraint.WeldJoint.prototype.__class__=e.constraint.WeldJoint,e.dynamics||(e.dynamics={}),e.dynamics.Arbiter=l["nape.dynamics.Arbiter"]=function(){if(this.zpp_inner=null,!t.dynamics.ZPP_Arbiter.internal)throw new n._Boot.HaxeError("Error: Cannot instantiate Arbiter derp!")},e.dynamics.Arbiter.__name__=["nape","dynamics","Arbiter"],e.dynamics.Arbiter.prototype.zpp_inner=null,Object.defineProperty(e.dynamics.Arbiter.prototype,"isSleeping",{get:e.dynamics.Arbiter.prototype.get_isSleeping}),e.dynamics.Arbiter.prototype.get_isSleeping=function(){if(!this.zpp_inner.active)throw new n._Boot.HaxeError("Error: Arbiter not currently in use");return this.zpp_inner.sleeping},Object.defineProperty(e.dynamics.Arbiter.prototype,"type",{get:e.dynamics.Arbiter.prototype.get_type}),e.dynamics.Arbiter.prototype.get_type=function(){return t.dynamics.ZPP_Arbiter.types[this.zpp_inner.type]},e.dynamics.Arbiter.prototype.isCollisionArbiter=function(){return this.zpp_inner.type==t.dynamics.ZPP_Arbiter.COL},e.dynamics.Arbiter.prototype.isFluidArbiter=function(){return this.zpp_inner.type==t.dynamics.ZPP_Arbiter.FLUID},e.dynamics.Arbiter.prototype.isSensorArbiter=function(){return this.zpp_inner.type==t.dynamics.ZPP_Arbiter.SENSOR},Object.defineProperty(e.dynamics.Arbiter.prototype,"collisionArbiter",{get:e.dynamics.Arbiter.prototype.get_collisionArbiter}),e.dynamics.Arbiter.prototype.get_collisionArbiter=function(){return this.zpp_inner.type==t.dynamics.ZPP_Arbiter.COL?this.zpp_inner.colarb.outer_zn:null},Object.defineProperty(e.dynamics.Arbiter.prototype,"fluidArbiter",{get:e.dynamics.Arbiter.prototype.get_fluidArbiter}),e.dynamics.Arbiter.prototype.get_fluidArbiter=function(){return this.zpp_inner.type==t.dynamics.ZPP_Arbiter.FLUID?this.zpp_inner.fluidarb.outer_zn:null},Object.defineProperty(e.dynamics.Arbiter.prototype,"shape1",{get:e.dynamics.Arbiter.prototype.get_shape1}),e.dynamics.Arbiter.prototype.get_shape1=function(){if(!this.zpp_inner.active)throw new n._Boot.HaxeError("Error: Arbiter not currently in use");return this.zpp_inner.ws1.id>this.zpp_inner.ws2.id?this.zpp_inner.ws2.outer:this.zpp_inner.ws1.outer},Object.defineProperty(e.dynamics.Arbiter.prototype,"shape2",{get:e.dynamics.Arbiter.prototype.get_shape2}),e.dynamics.Arbiter.prototype.get_shape2=function(){if(!this.zpp_inner.active)throw new n._Boot.HaxeError("Error: Arbiter not currently in use");return this.zpp_inner.ws1.id>this.zpp_inner.ws2.id?this.zpp_inner.ws1.outer:this.zpp_inner.ws2.outer},Object.defineProperty(e.dynamics.Arbiter.prototype,"body1",{get:e.dynamics.Arbiter.prototype.get_body1}),e.dynamics.Arbiter.prototype.get_body1=function(){if(!this.zpp_inner.active)throw new n._Boot.HaxeError("Error: Arbiter not currently in use");return this.zpp_inner.ws1.id>this.zpp_inner.ws2.id?this.zpp_inner.b2.outer:this.zpp_inner.b1.outer},Object.defineProperty(e.dynamics.Arbiter.prototype,"body2",{get:e.dynamics.Arbiter.prototype.get_body2}),e.dynamics.Arbiter.prototype.get_body2=function(){if(!this.zpp_inner.active)throw new n._Boot.HaxeError("Error: Arbiter not currently in use");return this.zpp_inner.ws1.id>this.zpp_inner.ws2.id?this.zpp_inner.b1.outer:this.zpp_inner.b2.outer},Object.defineProperty(e.dynamics.Arbiter.prototype,"state",{get:e.dynamics.Arbiter.prototype.get_state}),e.dynamics.Arbiter.prototype.get_state=function(){if(!this.zpp_inner.active)throw new n._Boot.HaxeError("Error: Arbiter not currently in use");var i=this.zpp_inner.immState;return 5==i?(null==t.util.ZPP_Flags.PreFlag_ACCEPT&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.PreFlag_ACCEPT=new e.callbacks.PreFlag,t.util.ZPP_Flags.internal=!1),t.util.ZPP_Flags.PreFlag_ACCEPT):1==i?(null==t.util.ZPP_Flags.PreFlag_ACCEPT_ONCE&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.PreFlag_ACCEPT_ONCE=new e.callbacks.PreFlag,t.util.ZPP_Flags.internal=!1),t.util.ZPP_Flags.PreFlag_ACCEPT_ONCE):6==i?(null==t.util.ZPP_Flags.PreFlag_IGNORE&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.PreFlag_IGNORE=new e.callbacks.PreFlag,t.util.ZPP_Flags.internal=!1),t.util.ZPP_Flags.PreFlag_IGNORE):(null==t.util.ZPP_Flags.PreFlag_IGNORE_ONCE&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.PreFlag_IGNORE_ONCE=new e.callbacks.PreFlag,t.util.ZPP_Flags.internal=!1),t.util.ZPP_Flags.PreFlag_IGNORE_ONCE)},e.dynamics.Arbiter.prototype.totalImpulse=function(t,i){if(!this.zpp_inner.active)throw new n._Boot.HaxeError("Error: Arbiter not currently in use");var r,o;if(null!=t){if(!this.zpp_inner.active)throw new n._Boot.HaxeError("Error: Arbiter not currently in use");o=t!=(this.zpp_inner.ws1.id>this.zpp_inner.ws2.id?this.zpp_inner.b2.outer:this.zpp_inner.b1.outer)}else o=!1;if(o){if(!this.zpp_inner.active)throw new n._Boot.HaxeError("Error: Arbiter not currently in use");r=t!=(this.zpp_inner.ws1.id>this.zpp_inner.ws2.id?this.zpp_inner.b1.outer:this.zpp_inner.b2.outer)}else r=!1;if(r)throw new n._Boot.HaxeError("Error: Arbiter does not relate to body");return e.geom.Vec3.get(0,0,0)},e.dynamics.Arbiter.prototype.toString=function(){var i=this.zpp_inner.type==t.dynamics.ZPP_Arbiter.COL?"CollisionArbiter":this.zpp_inner.type==t.dynamics.ZPP_Arbiter.FLUID?"FluidArbiter":"SensorArbiter";if(this.zpp_inner.cleared)return i+"(object-pooled)";if(!this.zpp_inner.active)throw new n._Boot.HaxeError("Error: Arbiter not currently in use");var r=i+"("+(this.zpp_inner.ws1.id>this.zpp_inner.ws2.id?this.zpp_inner.ws2.outer:this.zpp_inner.ws1.outer).toString()+"|";if(!this.zpp_inner.active)throw new n._Boot.HaxeError("Error: Arbiter not currently in use");var o,a=r+(this.zpp_inner.ws1.id>this.zpp_inner.ws2.id?this.zpp_inner.ws1.outer:this.zpp_inner.ws2.outer).toString()+")",s=this.zpp_inner.type==t.dynamics.ZPP_Arbiter.COL?"["+["SD","DD"][this.zpp_inner.colarb.stat?0:1]+"]":"";if(!this.zpp_inner.active)throw new n._Boot.HaxeError("Error: Arbiter not currently in use");var l=this.zpp_inner.immState;return 5==l?(null==t.util.ZPP_Flags.PreFlag_ACCEPT&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.PreFlag_ACCEPT=new e.callbacks.PreFlag,t.util.ZPP_Flags.internal=!1),o=t.util.ZPP_Flags.PreFlag_ACCEPT):1==l?(null==t.util.ZPP_Flags.PreFlag_ACCEPT_ONCE&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.PreFlag_ACCEPT_ONCE=new e.callbacks.PreFlag,t.util.ZPP_Flags.internal=!1),o=t.util.ZPP_Flags.PreFlag_ACCEPT_ONCE):6==l?(null==t.util.ZPP_Flags.PreFlag_IGNORE&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.PreFlag_IGNORE=new e.callbacks.PreFlag,t.util.ZPP_Flags.internal=!1),o=t.util.ZPP_Flags.PreFlag_IGNORE):(null==t.util.ZPP_Flags.PreFlag_IGNORE_ONCE&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.PreFlag_IGNORE_ONCE=new e.callbacks.PreFlag,t.util.ZPP_Flags.internal=!1),o=t.util.ZPP_Flags.PreFlag_IGNORE_ONCE),a+s+"<-"+o.toString()},e.dynamics.Arbiter.prototype.__class__=e.dynamics.Arbiter,e.dynamics.ArbiterIterator=l["nape.dynamics.ArbiterIterator"]=function(){if(this.zpp_next=null,this.zpp_critical=!1,this.zpp_i=0,this.zpp_inner=null,!t.util.ZPP_ArbiterList.internal)throw new n._Boot.HaxeError("Error: Cannot instantiate ArbiterIterator derp!")},e.dynamics.ArbiterIterator.__name__=["nape","dynamics","ArbiterIterator"],e.dynamics.ArbiterIterator.get=function(n){var i;if(null==e.dynamics.ArbiterIterator.zpp_pool){t.util.ZPP_ArbiterList.internal=!0;var r=new e.dynamics.ArbiterIterator;t.util.ZPP_ArbiterList.internal=!1,i=r}else{var o=e.dynamics.ArbiterIterator.zpp_pool;e.dynamics.ArbiterIterator.zpp_pool=o.zpp_next,i=o}return i.zpp_i=0,i.zpp_inner=n,i.zpp_critical=!1,i},e.dynamics.ArbiterIterator.prototype.zpp_inner=null,e.dynamics.ArbiterIterator.prototype.zpp_i=null,e.dynamics.ArbiterIterator.prototype.zpp_critical=null,e.dynamics.ArbiterIterator.prototype.zpp_next=null,e.dynamics.ArbiterIterator.prototype.hasNext=function(){this.zpp_inner.zpp_inner.valmod();var t=this.zpp_inner.zpp_gl();return this.zpp_critical=!0,this.zpp_i<t||(this.zpp_next=e.dynamics.ArbiterIterator.zpp_pool,e.dynamics.ArbiterIterator.zpp_pool=this,this.zpp_inner=null,!1)},e.dynamics.ArbiterIterator.prototype.next=function(){return this.zpp_critical=!1,this.zpp_inner.at(this.zpp_i++)},e.dynamics.ArbiterIterator.prototype.__class__=e.dynamics.ArbiterIterator,e.dynamics.ArbiterList=l["nape.dynamics.ArbiterList"]=function(){this.zpp_inner=null,this.zpp_inner=new t.util.ZPP_ArbiterList,this.zpp_inner.outer=this},e.dynamics.ArbiterList.__name__=["nape","dynamics","ArbiterList"],e.dynamics.ArbiterList.fromArray=function(t){if(null==t)throw new n._Boot.HaxeError("Error: Cannot convert null Array to Nape list");for(var i=new e.dynamics.ArbiterList,r=0;r<t.length;){var o=t[r];++r,i.push(o)}return i},e.dynamics.ArbiterList.prototype.zpp_inner=null,Object.defineProperty(e.dynamics.ArbiterList.prototype,"length",{get:e.dynamics.ArbiterList.prototype.get_length}),e.dynamics.ArbiterList.prototype.get_length=function(){return this.zpp_gl()},e.dynamics.ArbiterList.prototype.zpp_gl=function(){if(this.zpp_inner.valmod(),this.zpp_inner.zip_length){this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=0;for(var e=this.zpp_inner.inner.head;null!=e;)e.elt.active&&this.zpp_inner.user_length++,e=e.next}return this.zpp_inner.user_length},e.dynamics.ArbiterList.prototype.zpp_vm=function(){this.zpp_inner.valmod()},e.dynamics.ArbiterList.prototype.has=function(e){return this.zpp_vm(),this.zpp_inner.inner.has(e.zpp_inner)},e.dynamics.ArbiterList.prototype.at=function(e){if(this.zpp_vm(),e<0||e>=this.zpp_gl())throw new n._Boot.HaxeError("Error: Index out of bounds");if(this.zpp_inner.reverse_flag&&(e=this.zpp_gl()-1-e),e<this.zpp_inner.at_index||null==this.zpp_inner.at_ite)for(this.zpp_inner.at_index=0,this.zpp_inner.at_ite=this.zpp_inner.inner.head;!this.zpp_inner.at_ite.elt.active;)this.zpp_inner.at_ite=this.zpp_inner.at_ite.next;for(;this.zpp_inner.at_index!=e;)for(this.zpp_inner.at_index++,this.zpp_inner.at_ite=this.zpp_inner.at_ite.next;!this.zpp_inner.at_ite.elt.active;)this.zpp_inner.at_ite=this.zpp_inner.at_ite.next;return this.zpp_inner.at_ite.elt.wrapper()},e.dynamics.ArbiterList.prototype.push=function(e){if(this.zpp_inner.immutable)throw new n._Boot.HaxeError("Error: ArbiterList is immutable");this.zpp_inner.modify_test(),this.zpp_vm();var t=null==this.zpp_inner.adder||this.zpp_inner.adder(e);if(t){if(this.zpp_inner.reverse_flag)this.zpp_inner.inner.add(e.zpp_inner);else{if(null==this.zpp_inner.push_ite){var i=this.empty()?null:this.zpp_inner.inner.iterator_at(this.zpp_gl()-1);this.zpp_inner.push_ite=i}this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,e.zpp_inner)}this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(e)}return t},e.dynamics.ArbiterList.prototype.unshift=function(e){if(this.zpp_inner.immutable)throw new n._Boot.HaxeError("Error: ArbiterList is immutable");this.zpp_inner.modify_test(),this.zpp_vm();var t=null==this.zpp_inner.adder||this.zpp_inner.adder(e);if(t){if(this.zpp_inner.reverse_flag){if(null==this.zpp_inner.push_ite){var i=this.empty()?null:this.zpp_inner.inner.iterator_at(this.zpp_gl()-1);this.zpp_inner.push_ite=i}this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,e.zpp_inner)}else this.zpp_inner.inner.add(e.zpp_inner);this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(e)}return t},e.dynamics.ArbiterList.prototype.pop=function(){if(this.zpp_inner.immutable)throw new n._Boot.HaxeError("Error: ArbiterList is immutable");if(this.zpp_inner.modify_test(),this.empty())throw new n._Boot.HaxeError("Error: Cannot remove from empty list");this.zpp_vm();var e=null;if(this.zpp_inner.reverse_flag){var t=(e=this.zpp_inner.inner.head.elt).wrapper();null!=this.zpp_inner.subber&&this.zpp_inner.subber(t),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()}else{null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null);var i=1==this.zpp_gl()?null:this.zpp_inner.inner.iterator_at(this.zpp_gl()-2),r=(e=null==i?this.zpp_inner.inner.head.elt:i.next.elt).wrapper();null!=this.zpp_inner.subber&&this.zpp_inner.subber(r),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(i)}return this.zpp_inner.invalidate(),e.wrapper()},e.dynamics.ArbiterList.prototype.shift=function(){if(this.zpp_inner.immutable)throw new n._Boot.HaxeError("Error: ArbiterList is immutable");if(this.zpp_inner.modify_test(),this.empty())throw new n._Boot.HaxeError("Error: Cannot remove from empty list");this.zpp_vm();var e=null;if(this.zpp_inner.reverse_flag){null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null);var t=1==this.zpp_gl()?null:this.zpp_inner.inner.iterator_at(this.zpp_gl()-2),i=(e=null==t?this.zpp_inner.inner.head.elt:t.next.elt).wrapper();null!=this.zpp_inner.subber&&this.zpp_inner.subber(i),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(t)}else{var r=(e=this.zpp_inner.inner.head.elt).wrapper();null!=this.zpp_inner.subber&&this.zpp_inner.subber(r),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()}return this.zpp_inner.invalidate(),e.wrapper()},e.dynamics.ArbiterList.prototype.add=function(e){return this.zpp_inner.reverse_flag?this.push(e):this.unshift(e)},e.dynamics.ArbiterList.prototype.remove=function(e){if(this.zpp_inner.immutable)throw new n._Boot.HaxeError("Error: ArbiterList is immutable");var t;this.zpp_inner.modify_test(),this.zpp_vm(),t=!1;for(var i=this.zpp_inner.inner.head;null!=i;){if(i.elt==e.zpp_inner){t=!0;break}i=i.next}return t&&(null!=this.zpp_inner.subber&&this.zpp_inner.subber(e),this.zpp_inner.dontremove||this.zpp_inner.inner.remove(e.zpp_inner),this.zpp_inner.invalidate()),t},e.dynamics.ArbiterList.prototype.clear=function(){if(this.zpp_inner.immutable)throw new n._Boot.HaxeError("Error: ArbiterList is immutable");if(this.zpp_inner.reverse_flag)for(;!this.empty();)this.pop();else for(;!this.empty();)this.shift()},e.dynamics.ArbiterList.prototype.empty=function(){return 0==this.zpp_gl()},e.dynamics.ArbiterList.prototype.iterator=function(){return this.zpp_vm(),e.dynamics.ArbiterIterator.get(this)},e.dynamics.ArbiterList.prototype.copy=function(t){null==t&&(t=!1);for(var i=new e.dynamics.ArbiterList,r=this.iterator();;){r.zpp_inner.zpp_inner.valmod();var o,a=r.zpp_inner.zpp_gl();if(r.zpp_critical=!0,r.zpp_i<a?o=!0:(r.zpp_next=e.dynamics.ArbiterIterator.zpp_pool,e.dynamics.ArbiterIterator.zpp_pool=r,r.zpp_inner=null,o=!1),!o)break;r.zpp_critical=!1;var s,l=r.zpp_inner.at(r.zpp_i++);if(t)throw new n._Boot.HaxeError("Error: Arbiter is not a copyable type");s=l,i.push(s)}return i},e.dynamics.ArbiterList.prototype.merge=function(t){if(null==t)throw new n._Boot.HaxeError("Error: Cannot merge with null list");for(var i=t.iterator();;){i.zpp_inner.zpp_inner.valmod();var r,o=i.zpp_inner.zpp_gl();if(i.zpp_critical=!0,i.zpp_i<o?r=!0:(i.zpp_next=e.dynamics.ArbiterIterator.zpp_pool,e.dynamics.ArbiterIterator.zpp_pool=i,i.zpp_inner=null,r=!1),!r)break;i.zpp_critical=!1;var a=i.zpp_inner.at(i.zpp_i++);this.has(a)||this.add(a)}},e.dynamics.ArbiterList.prototype.toString=function(){for(var t="[",n=!0,i=this.iterator();;){i.zpp_inner.zpp_inner.valmod();var r,o=i.zpp_inner.zpp_gl();if(i.zpp_critical=!0,i.zpp_i<o?r=!0:(i.zpp_next=e.dynamics.ArbiterIterator.zpp_pool,e.dynamics.ArbiterIterator.zpp_pool=i,i.zpp_inner=null,r=!1),!r)break;i.zpp_critical=!1;var a=i.zpp_inner.at(i.zpp_i++);n||(t+=","),t+=null==a?"NULL":a.toString(),n=!1}return t+"]"},e.dynamics.ArbiterList.prototype.foreach=function(t){if(null==t)throw new n._Boot.HaxeError("Error: Cannot execute null on list elements");for(var i=this.iterator();;){i.zpp_inner.zpp_inner.valmod();var r,o=i.zpp_inner.zpp_gl();if(i.zpp_critical=!0,i.zpp_i<o?r=!0:(i.zpp_next=e.dynamics.ArbiterIterator.zpp_pool,e.dynamics.ArbiterIterator.zpp_pool=i,i.zpp_inner=null,r=!1),!r)break;try{i.zpp_critical=!1,t(i.zpp_inner.at(i.zpp_i++))}catch(t){t instanceof n._Boot.HaxeError&&t.val,i.zpp_next=e.dynamics.ArbiterIterator.zpp_pool,e.dynamics.ArbiterIterator.zpp_pool=i,i.zpp_inner=null;break}}return this},e.dynamics.ArbiterList.prototype.filter=function(e){if(null==e)throw new n._Boot.HaxeError("Error: Cannot select elements of list with null");for(var t=0;t<this.zpp_gl();){var i=this.at(t);try{e(i)?++t:this.remove(i)}catch(e){e instanceof n._Boot.HaxeError&&e.val;break}}return this},e.dynamics.ArbiterList.prototype.__class__=e.dynamics.ArbiterList,e.dynamics.ArbiterType=l["nape.dynamics.ArbiterType"]=function(){if(!t.util.ZPP_Flags.internal)throw new n._Boot.HaxeError("Error: Cannot instantiate ArbiterType derp!")},e.dynamics.ArbiterType.__name__=["nape","dynamics","ArbiterType"],e.dynamics.ArbiterType.COLLISION=null,e.dynamics.ArbiterType.get_COLLISION=function(){return null==t.util.ZPP_Flags.ArbiterType_COLLISION&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.ArbiterType_COLLISION=new e.dynamics.ArbiterType,t.util.ZPP_Flags.internal=!1),t.util.ZPP_Flags.ArbiterType_COLLISION},e.dynamics.ArbiterType.SENSOR=null,e.dynamics.ArbiterType.get_SENSOR=function(){return null==t.util.ZPP_Flags.ArbiterType_SENSOR&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.ArbiterType_SENSOR=new e.dynamics.ArbiterType,t.util.ZPP_Flags.internal=!1),t.util.ZPP_Flags.ArbiterType_SENSOR},e.dynamics.ArbiterType.FLUID=null,e.dynamics.ArbiterType.get_FLUID=function(){return null==t.util.ZPP_Flags.ArbiterType_FLUID&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.ArbiterType_FLUID=new e.dynamics.ArbiterType,t.util.ZPP_Flags.internal=!1),t.util.ZPP_Flags.ArbiterType_FLUID},e.dynamics.ArbiterType.prototype.toString=function(){return null==t.util.ZPP_Flags.ArbiterType_COLLISION&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.ArbiterType_COLLISION=new e.dynamics.ArbiterType,t.util.ZPP_Flags.internal=!1),this==t.util.ZPP_Flags.ArbiterType_COLLISION?"COLLISION":(null==t.util.ZPP_Flags.ArbiterType_SENSOR&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.ArbiterType_SENSOR=new e.dynamics.ArbiterType,t.util.ZPP_Flags.internal=!1),this==t.util.ZPP_Flags.ArbiterType_SENSOR?"SENSOR":(null==t.util.ZPP_Flags.ArbiterType_FLUID&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.ArbiterType_FLUID=new e.dynamics.ArbiterType,t.util.ZPP_Flags.internal=!1),this==t.util.ZPP_Flags.ArbiterType_FLUID?"FLUID":""))},e.dynamics.ArbiterType.prototype.__class__=e.dynamics.ArbiterType,e.dynamics.CollisionArbiter=l["nape.dynamics.CollisionArbiter"]=function(){if(!t.dynamics.ZPP_Arbiter.internal)throw new n._Boot.HaxeError("Error: Cannot instantiate CollisionArbiter derp!");e.dynamics.Arbiter.call(this)},e.dynamics.CollisionArbiter.__name__=["nape","dynamics","CollisionArbiter"],e.dynamics.CollisionArbiter.__super__=e.dynamics.Arbiter,e.dynamics.Arbiter.prototype)e.dynamics.CollisionArbiter.prototype[u]=e.dynamics.Arbiter.prototype[u];for(var u in Object.defineProperty(e.dynamics.CollisionArbiter.prototype,"contacts",{get:e.dynamics.CollisionArbiter.prototype.get_contacts}),e.dynamics.CollisionArbiter.prototype.get_contacts=function(){if(!this.zpp_inner.active)throw new n._Boot.HaxeError("Error: Arbiter not currently in use");return null==this.zpp_inner.colarb.wrap_contacts&&this.zpp_inner.colarb.setupcontacts(),this.zpp_inner.colarb.wrap_contacts},Object.defineProperty(e.dynamics.CollisionArbiter.prototype,"normal",{get:e.dynamics.CollisionArbiter.prototype.get_normal}),e.dynamics.CollisionArbiter.prototype.get_normal=function(){if(!this.zpp_inner.active)throw new n._Boot.HaxeError("Error: Arbiter not currently in use");return null==this.zpp_inner.colarb.wrap_normal&&this.zpp_inner.colarb.getnormal(),this.zpp_inner.colarb.wrap_normal},Object.defineProperty(e.dynamics.CollisionArbiter.prototype,"radius",{get:e.dynamics.CollisionArbiter.prototype.get_radius}),e.dynamics.CollisionArbiter.prototype.get_radius=function(){if(!this.zpp_inner.active)throw new n._Boot.HaxeError("Error: Arbiter not currently in use");return this.zpp_inner.colarb.radius},Object.defineProperty(e.dynamics.CollisionArbiter.prototype,"referenceEdge1",{get:e.dynamics.CollisionArbiter.prototype.get_referenceEdge1}),e.dynamics.CollisionArbiter.prototype.get_referenceEdge1=function(){if(!this.zpp_inner.active)throw new n._Boot.HaxeError("Error: Arbiter not currently in use");var e,t=this.zpp_inner.colarb.__ref_edge1;if(null!=t){if(!this.zpp_inner.active)throw new n._Boot.HaxeError("Error: Arbiter not currently in use");if(1==(this.zpp_inner.ws1.id>this.zpp_inner.ws2.id?this.zpp_inner.ws2.outer:this.zpp_inner.ws1.outer).zpp_inner.type){if(!this.zpp_inner.active)throw new n._Boot.HaxeError("Error: Arbiter not currently in use");e=(this.zpp_inner.ws1.id>this.zpp_inner.ws2.id?this.zpp_inner.ws2.outer:this.zpp_inner.ws1.outer).zpp_inner!=t.polygon}else e=!0}else e=!1;return e&&(t=this.zpp_inner.colarb.__ref_edge2),null==t?null:t.wrapper()},Object.defineProperty(e.dynamics.CollisionArbiter.prototype,"referenceEdge2",{get:e.dynamics.CollisionArbiter.prototype.get_referenceEdge2}),e.dynamics.CollisionArbiter.prototype.get_referenceEdge2=function(){if(!this.zpp_inner.active)throw new n._Boot.HaxeError("Error: Arbiter not currently in use");var e,t=this.zpp_inner.colarb.__ref_edge1;if(null!=t){if(!this.zpp_inner.active)throw new n._Boot.HaxeError("Error: Arbiter not currently in use");if(1==(this.zpp_inner.ws1.id>this.zpp_inner.ws2.id?this.zpp_inner.ws1.outer:this.zpp_inner.ws2.outer).zpp_inner.type){if(!this.zpp_inner.active)throw new n._Boot.HaxeError("Error: Arbiter not currently in use");e=(this.zpp_inner.ws1.id>this.zpp_inner.ws2.id?this.zpp_inner.ws1.outer:this.zpp_inner.ws2.outer).zpp_inner!=t.polygon}else e=!0}else e=!1;return e&&(t=this.zpp_inner.colarb.__ref_edge2),null==t?null:t.wrapper()},e.dynamics.CollisionArbiter.prototype.firstVertex=function(){if(!this.zpp_inner.active)throw new n._Boot.HaxeError("Error: Arbiter not currently in use");return!(null!=this.zpp_inner.colarb.__ref_edge1==(null!=this.zpp_inner.colarb.__ref_edge2))&&-1==this.zpp_inner.colarb.__ref_vertex},e.dynamics.CollisionArbiter.prototype.secondVertex=function(){if(!this.zpp_inner.active)throw new n._Boot.HaxeError("Error: Arbiter not currently in use");return!(null!=this.zpp_inner.colarb.__ref_edge1==(null!=this.zpp_inner.colarb.__ref_edge2))&&1==this.zpp_inner.colarb.__ref_vertex},e.dynamics.CollisionArbiter.prototype.normalImpulse=function(t,i){if(null==i&&(i=!1),!this.zpp_inner.active)throw new n._Boot.HaxeError("Error: Arbiter not currently in use");var r,o;if(null!=t){if(!this.zpp_inner.active)throw new n._Boot.HaxeError("Error: Arbiter not currently in use");o=t!=(this.zpp_inner.ws1.id>this.zpp_inner.ws2.id?this.zpp_inner.b2.outer:this.zpp_inner.b1.outer)}else o=!1;if(o){if(!this.zpp_inner.active)throw new n._Boot.HaxeError("Error: Arbiter not currently in use");r=t!=(this.zpp_inner.ws1.id>this.zpp_inner.ws2.id?this.zpp_inner.b1.outer:this.zpp_inner.b2.outer)}else r=!1;if(r)throw new n._Boot.HaxeError("Error: Arbiter does not relate to body");var a=0,s=0,l=0,p=this.zpp_inner.colarb;if(!i||p.oc1.fresh){var u=p.oc1.wrapper().normalImpulse(t);if(null!=u&&u.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");var h=u.zpp_inner;if(null!=h._validate&&h._validate(),a+=1*u.zpp_inner.x,null!=u&&u.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");var c=u.zpp_inner;if(null!=c._validate&&c._validate(),s+=1*u.zpp_inner.y,null!=u&&u.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");var _=u.zpp_inner;null!=_._validate&&_._validate(),l+=1*u.zpp_inner.z,u.dispose()}if(p.hc2&&(!i||p.oc2.fresh)){var d=p.oc2.wrapper().normalImpulse(t);if(null!=d&&d.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");var m=d.zpp_inner;if(null!=m._validate&&m._validate(),a+=1*d.zpp_inner.x,null!=d&&d.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");var P=d.zpp_inner;if(null!=P._validate&&P._validate(),s+=1*d.zpp_inner.y,null!=d&&d.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");var f=d.zpp_inner;null!=f._validate&&f._validate(),l+=1*d.zpp_inner.z,d.dispose()}return e.geom.Vec3.get(a,s,l)},e.dynamics.CollisionArbiter.prototype.tangentImpulse=function(t,i){if(null==i&&(i=!1),!this.zpp_inner.active)throw new n._Boot.HaxeError("Error: Arbiter not currently in use");var r,o;if(null!=t){if(!this.zpp_inner.active)throw new n._Boot.HaxeError("Error: Arbiter not currently in use");o=t!=(this.zpp_inner.ws1.id>this.zpp_inner.ws2.id?this.zpp_inner.b2.outer:this.zpp_inner.b1.outer)}else o=!1;if(o){if(!this.zpp_inner.active)throw new n._Boot.HaxeError("Error: Arbiter not currently in use");r=t!=(this.zpp_inner.ws1.id>this.zpp_inner.ws2.id?this.zpp_inner.b1.outer:this.zpp_inner.b2.outer)}else r=!1;if(r)throw new n._Boot.HaxeError("Error: Arbiter does not relate to body");var a=0,s=0,l=0,p=this.zpp_inner.colarb;if(!i||p.oc1.fresh){var u=p.oc1.wrapper().tangentImpulse(t);if(null!=u&&u.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");var h=u.zpp_inner;if(null!=h._validate&&h._validate(),a+=1*u.zpp_inner.x,null!=u&&u.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");var c=u.zpp_inner;if(null!=c._validate&&c._validate(),s+=1*u.zpp_inner.y,null!=u&&u.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");var _=u.zpp_inner;null!=_._validate&&_._validate(),l+=1*u.zpp_inner.z,u.dispose()}if(p.hc2&&(!i||p.oc2.fresh)){var d=p.oc2.wrapper().tangentImpulse(t);if(null!=d&&d.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");var m=d.zpp_inner;if(null!=m._validate&&m._validate(),a+=1*d.zpp_inner.x,null!=d&&d.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");var P=d.zpp_inner;if(null!=P._validate&&P._validate(),s+=1*d.zpp_inner.y,null!=d&&d.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");var f=d.zpp_inner;null!=f._validate&&f._validate(),l+=1*d.zpp_inner.z,d.dispose()}return e.geom.Vec3.get(a,s,l)},e.dynamics.CollisionArbiter.prototype.totalImpulse=function(t,i){if(null==i&&(i=!1),!this.zpp_inner.active)throw new n._Boot.HaxeError("Error: Arbiter not currently in use");var r,o;if(null!=t){if(!this.zpp_inner.active)throw new n._Boot.HaxeError("Error: Arbiter not currently in use");o=t!=(this.zpp_inner.ws1.id>this.zpp_inner.ws2.id?this.zpp_inner.b2.outer:this.zpp_inner.b1.outer)}else o=!1;if(o){if(!this.zpp_inner.active)throw new n._Boot.HaxeError("Error: Arbiter not currently in use");r=t!=(this.zpp_inner.ws1.id>this.zpp_inner.ws2.id?this.zpp_inner.b1.outer:this.zpp_inner.b2.outer)}else r=!1;if(r)throw new n._Boot.HaxeError("Error: Arbiter does not relate to body");var a=0,s=0,l=0,p=this.zpp_inner.colarb;if(!i||p.oc1.fresh){var u=p.oc1.wrapper().totalImpulse(t);if(null!=u&&u.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");var h=u.zpp_inner;if(null!=h._validate&&h._validate(),a+=1*u.zpp_inner.x,null!=u&&u.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");var c=u.zpp_inner;if(null!=c._validate&&c._validate(),s+=1*u.zpp_inner.y,null!=u&&u.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");var _=u.zpp_inner;null!=_._validate&&_._validate(),l+=1*u.zpp_inner.z,u.dispose()}if(p.hc2&&(!i||p.oc2.fresh)){var d=p.oc2.wrapper().totalImpulse(t);if(null!=d&&d.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");var m=d.zpp_inner;if(null!=m._validate&&m._validate(),a+=1*d.zpp_inner.x,null!=d&&d.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");var P=d.zpp_inner;if(null!=P._validate&&P._validate(),s+=1*d.zpp_inner.y,null!=d&&d.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");var f=d.zpp_inner;null!=f._validate&&f._validate(),l+=1*d.zpp_inner.z,d.dispose()}return e.geom.Vec3.get(a,s,l)},e.dynamics.CollisionArbiter.prototype.rollingImpulse=function(e,t){if(null==t&&(t=!1),!this.zpp_inner.active)throw new n._Boot.HaxeError("Error: Arbiter not currently in use");var i,r;if(null!=e){if(!this.zpp_inner.active)throw new n._Boot.HaxeError("Error: Arbiter not currently in use");r=e!=(this.zpp_inner.ws1.id>this.zpp_inner.ws2.id?this.zpp_inner.b2.outer:this.zpp_inner.b1.outer)}else r=!1;if(r){if(!this.zpp_inner.active)throw new n._Boot.HaxeError("Error: Arbiter not currently in use");i=e!=(this.zpp_inner.ws1.id>this.zpp_inner.ws2.id?this.zpp_inner.b1.outer:this.zpp_inner.b2.outer)}else i=!1;if(i)throw new n._Boot.HaxeError("Error: Arbiter does not relate to body");var o=this.zpp_inner.colarb;return!t||o.oc1.fresh?o.oc1.wrapper().rollingImpulse(e):0},Object.defineProperty(e.dynamics.CollisionArbiter.prototype,"elasticity",{get:e.dynamics.CollisionArbiter.prototype.get_elasticity,set:e.dynamics.CollisionArbiter.prototype.set_elasticity}),e.dynamics.CollisionArbiter.prototype.get_elasticity=function(){if(!this.zpp_inner.active)throw new n._Boot.HaxeError("Error: Arbiter not currently in use");var e=this.zpp_inner.colarb;return e.invalidated&&(e.invalidated=!1,e.userdef_restitution||(e.s1.material.elasticity<=-1/0||e.s2.material.elasticity<=-1/0?e.restitution=0:e.s1.material.elasticity>=1/0||e.s2.material.elasticity>=1/0?e.restitution=1:e.restitution=(e.s1.material.elasticity+e.s2.material.elasticity)/2,e.restitution<0&&(e.restitution=0),e.restitution>1&&(e.restitution=1)),e.userdef_dyn_fric||(e.dyn_fric=Math.sqrt(e.s1.material.dynamicFriction*e.s2.material.dynamicFriction)),e.userdef_stat_fric||(e.stat_fric=Math.sqrt(e.s1.material.staticFriction*e.s2.material.staticFriction)),e.userdef_rfric||(e.rfric=Math.sqrt(e.s1.material.rollingFriction*e.s2.material.rollingFriction))),e.restitution},e.dynamics.CollisionArbiter.prototype.set_elasticity=function(e){if(!this.zpp_inner.colarb.mutable)throw new n._Boot.HaxeError("Error: CollisionArbiter::elasticity is only mutable during a pre-handler");if(e!=e)throw new n._Boot.HaxeError("Error: CollisionArbiter::elasticity cannot be NaN");if(e<0)throw new n._Boot.HaxeError("Error: CollisionArbiter::elasticity cannot be negative");var t=this.zpp_inner.colarb;if(t.restitution=e,t.userdef_restitution=!0,!this.zpp_inner.active)throw new n._Boot.HaxeError("Error: Arbiter not currently in use");var i=this.zpp_inner.colarb;return i.invalidated&&(i.invalidated=!1,i.userdef_restitution||(i.s1.material.elasticity<=-1/0||i.s2.material.elasticity<=-1/0?i.restitution=0:i.s1.material.elasticity>=1/0||i.s2.material.elasticity>=1/0?i.restitution=1:i.restitution=(i.s1.material.elasticity+i.s2.material.elasticity)/2,i.restitution<0&&(i.restitution=0),i.restitution>1&&(i.restitution=1)),i.userdef_dyn_fric||(i.dyn_fric=Math.sqrt(i.s1.material.dynamicFriction*i.s2.material.dynamicFriction)),i.userdef_stat_fric||(i.stat_fric=Math.sqrt(i.s1.material.staticFriction*i.s2.material.staticFriction)),i.userdef_rfric||(i.rfric=Math.sqrt(i.s1.material.rollingFriction*i.s2.material.rollingFriction))),i.restitution},Object.defineProperty(e.dynamics.CollisionArbiter.prototype,"dynamicFriction",{get:e.dynamics.CollisionArbiter.prototype.get_dynamicFriction,set:e.dynamics.CollisionArbiter.prototype.set_dynamicFriction}),e.dynamics.CollisionArbiter.prototype.get_dynamicFriction=function(){if(!this.zpp_inner.active)throw new n._Boot.HaxeError("Error: Arbiter not currently in use");var e=this.zpp_inner.colarb;return e.invalidated&&(e.invalidated=!1,e.userdef_restitution||(e.s1.material.elasticity<=-1/0||e.s2.material.elasticity<=-1/0?e.restitution=0:e.s1.material.elasticity>=1/0||e.s2.material.elasticity>=1/0?e.restitution=1:e.restitution=(e.s1.material.elasticity+e.s2.material.elasticity)/2,e.restitution<0&&(e.restitution=0),e.restitution>1&&(e.restitution=1)),e.userdef_dyn_fric||(e.dyn_fric=Math.sqrt(e.s1.material.dynamicFriction*e.s2.material.dynamicFriction)),e.userdef_stat_fric||(e.stat_fric=Math.sqrt(e.s1.material.staticFriction*e.s2.material.staticFriction)),e.userdef_rfric||(e.rfric=Math.sqrt(e.s1.material.rollingFriction*e.s2.material.rollingFriction))),e.dyn_fric},e.dynamics.CollisionArbiter.prototype.set_dynamicFriction=function(e){if(!this.zpp_inner.colarb.mutable)throw new n._Boot.HaxeError("Error: CollisionArbiter::dynamicFriction is only mutable during a pre-handler");if(e!=e)throw new n._Boot.HaxeError("Error: CollisionArbiter::dynamicFriction cannot be NaN");if(e<0)throw new n._Boot.HaxeError("Error: CollisionArbiter::dynamicFriction cannot be negative");var t=this.zpp_inner.colarb;if(t.dyn_fric=e,t.userdef_dyn_fric=!0,!this.zpp_inner.active)throw new n._Boot.HaxeError("Error: Arbiter not currently in use");var i=this.zpp_inner.colarb;return i.invalidated&&(i.invalidated=!1,i.userdef_restitution||(i.s1.material.elasticity<=-1/0||i.s2.material.elasticity<=-1/0?i.restitution=0:i.s1.material.elasticity>=1/0||i.s2.material.elasticity>=1/0?i.restitution=1:i.restitution=(i.s1.material.elasticity+i.s2.material.elasticity)/2,i.restitution<0&&(i.restitution=0),i.restitution>1&&(i.restitution=1)),i.userdef_dyn_fric||(i.dyn_fric=Math.sqrt(i.s1.material.dynamicFriction*i.s2.material.dynamicFriction)),i.userdef_stat_fric||(i.stat_fric=Math.sqrt(i.s1.material.staticFriction*i.s2.material.staticFriction)),i.userdef_rfric||(i.rfric=Math.sqrt(i.s1.material.rollingFriction*i.s2.material.rollingFriction))),i.dyn_fric},Object.defineProperty(e.dynamics.CollisionArbiter.prototype,"staticFriction",{get:e.dynamics.CollisionArbiter.prototype.get_staticFriction,set:e.dynamics.CollisionArbiter.prototype.set_staticFriction}),e.dynamics.CollisionArbiter.prototype.get_staticFriction=function(){if(!this.zpp_inner.active)throw new n._Boot.HaxeError("Error: Arbiter not currently in use");var e=this.zpp_inner.colarb;return e.invalidated&&(e.invalidated=!1,e.userdef_restitution||(e.s1.material.elasticity<=-1/0||e.s2.material.elasticity<=-1/0?e.restitution=0:e.s1.material.elasticity>=1/0||e.s2.material.elasticity>=1/0?e.restitution=1:e.restitution=(e.s1.material.elasticity+e.s2.material.elasticity)/2,e.restitution<0&&(e.restitution=0),e.restitution>1&&(e.restitution=1)),e.userdef_dyn_fric||(e.dyn_fric=Math.sqrt(e.s1.material.dynamicFriction*e.s2.material.dynamicFriction)),e.userdef_stat_fric||(e.stat_fric=Math.sqrt(e.s1.material.staticFriction*e.s2.material.staticFriction)),e.userdef_rfric||(e.rfric=Math.sqrt(e.s1.material.rollingFriction*e.s2.material.rollingFriction))),e.stat_fric},e.dynamics.CollisionArbiter.prototype.set_staticFriction=function(e){if(!this.zpp_inner.colarb.mutable)throw new n._Boot.HaxeError("Error: CollisionArbiter::staticFriction is only mutable during a pre-handler");if(e!=e)throw new n._Boot.HaxeError("Error: CollisionArbiter::staticFriction cannot be NaN");if(e<0)throw new n._Boot.HaxeError("Error: CollisionArbiter::staticFriction cannot be negative");var t=this.zpp_inner.colarb;if(t.stat_fric=e,t.userdef_stat_fric=!0,!this.zpp_inner.active)throw new n._Boot.HaxeError("Error: Arbiter not currently in use");var i=this.zpp_inner.colarb;return i.invalidated&&(i.invalidated=!1,i.userdef_restitution||(i.s1.material.elasticity<=-1/0||i.s2.material.elasticity<=-1/0?i.restitution=0:i.s1.material.elasticity>=1/0||i.s2.material.elasticity>=1/0?i.restitution=1:i.restitution=(i.s1.material.elasticity+i.s2.material.elasticity)/2,i.restitution<0&&(i.restitution=0),i.restitution>1&&(i.restitution=1)),i.userdef_dyn_fric||(i.dyn_fric=Math.sqrt(i.s1.material.dynamicFriction*i.s2.material.dynamicFriction)),i.userdef_stat_fric||(i.stat_fric=Math.sqrt(i.s1.material.staticFriction*i.s2.material.staticFriction)),i.userdef_rfric||(i.rfric=Math.sqrt(i.s1.material.rollingFriction*i.s2.material.rollingFriction))),i.stat_fric},Object.defineProperty(e.dynamics.CollisionArbiter.prototype,"rollingFriction",{get:e.dynamics.CollisionArbiter.prototype.get_rollingFriction,set:e.dynamics.CollisionArbiter.prototype.set_rollingFriction}),e.dynamics.CollisionArbiter.prototype.get_rollingFriction=function(){if(!this.zpp_inner.active)throw new n._Boot.HaxeError("Error: Arbiter not currently in use");var e=this.zpp_inner.colarb;return e.invalidated&&(e.invalidated=!1,e.userdef_restitution||(e.s1.material.elasticity<=-1/0||e.s2.material.elasticity<=-1/0?e.restitution=0:e.s1.material.elasticity>=1/0||e.s2.material.elasticity>=1/0?e.restitution=1:e.restitution=(e.s1.material.elasticity+e.s2.material.elasticity)/2,e.restitution<0&&(e.restitution=0),e.restitution>1&&(e.restitution=1)),e.userdef_dyn_fric||(e.dyn_fric=Math.sqrt(e.s1.material.dynamicFriction*e.s2.material.dynamicFriction)),e.userdef_stat_fric||(e.stat_fric=Math.sqrt(e.s1.material.staticFriction*e.s2.material.staticFriction)),e.userdef_rfric||(e.rfric=Math.sqrt(e.s1.material.rollingFriction*e.s2.material.rollingFriction))),e.rfric},e.dynamics.CollisionArbiter.prototype.set_rollingFriction=function(e){if(!this.zpp_inner.colarb.mutable)throw new n._Boot.HaxeError("Error: CollisionArbiter::rollingFriction is only mutable during a pre-handler");if(e!=e)throw new n._Boot.HaxeError("Error: CollisionArbiter::rollingFriction cannot be NaN");if(e<0)throw new n._Boot.HaxeError("Error: CollisionArbiter::rollingFriction cannot be negative");var t=this.zpp_inner.colarb;if(t.rfric=e,t.userdef_rfric=!0,!this.zpp_inner.active)throw new n._Boot.HaxeError("Error: Arbiter not currently in use");var i=this.zpp_inner.colarb;return i.invalidated&&(i.invalidated=!1,i.userdef_restitution||(i.s1.material.elasticity<=-1/0||i.s2.material.elasticity<=-1/0?i.restitution=0:i.s1.material.elasticity>=1/0||i.s2.material.elasticity>=1/0?i.restitution=1:i.restitution=(i.s1.material.elasticity+i.s2.material.elasticity)/2,i.restitution<0&&(i.restitution=0),i.restitution>1&&(i.restitution=1)),i.userdef_dyn_fric||(i.dyn_fric=Math.sqrt(i.s1.material.dynamicFriction*i.s2.material.dynamicFriction)),i.userdef_stat_fric||(i.stat_fric=Math.sqrt(i.s1.material.staticFriction*i.s2.material.staticFriction)),i.userdef_rfric||(i.rfric=Math.sqrt(i.s1.material.rollingFriction*i.s2.material.rollingFriction))),i.rfric},e.dynamics.CollisionArbiter.prototype.__class__=e.dynamics.CollisionArbiter,e.dynamics.Contact=l["nape.dynamics.Contact"]=function(){if(this.zpp_inner=null,!t.dynamics.ZPP_Contact.internal)throw new n._Boot.HaxeError("Error: Cannot instantiate Contact derp!")},e.dynamics.Contact.__name__=["nape","dynamics","Contact"],e.dynamics.Contact.prototype.zpp_inner=null,Object.defineProperty(e.dynamics.Contact.prototype,"arbiter",{get:e.dynamics.Contact.prototype.get_arbiter}),e.dynamics.Contact.prototype.get_arbiter=function(){if(null==this.zpp_inner.arbiter)return null;var e=this.zpp_inner.arbiter.outer;return e.zpp_inner.type==t.dynamics.ZPP_Arbiter.COL?e.zpp_inner.colarb.outer_zn:null},Object.defineProperty(e.dynamics.Contact.prototype,"penetration",{get:e.dynamics.Contact.prototype.get_penetration}),e.dynamics.Contact.prototype.get_penetration=function(){if(this.zpp_inner.inactiveme())throw new n._Boot.HaxeError("Error: Contact not currently in use");return-this.zpp_inner.dist},Object.defineProperty(e.dynamics.Contact.prototype,"position",{get:e.dynamics.Contact.prototype.get_position}),e.dynamics.Contact.prototype.get_position=function(){if(this.zpp_inner.inactiveme())throw new n._Boot.HaxeError("Error: Contact not currently in use");return null==this.zpp_inner.wrap_position&&this.zpp_inner.getposition(),this.zpp_inner.wrap_position},Object.defineProperty(e.dynamics.Contact.prototype,"fresh",{get:e.dynamics.Contact.prototype.get_fresh}),e.dynamics.Contact.prototype.get_fresh=function(){if(this.zpp_inner.inactiveme())throw new n._Boot.HaxeError("Error: Contact not currently in use");return this.zpp_inner.fresh},e.dynamics.Contact.prototype.normalImpulse=function(t){if(this.zpp_inner.inactiveme())throw new n._Boot.HaxeError("Error: Contact not currently in use");var i=this.zpp_inner.arbiter.colarb,r=this.zpp_inner.inner,o=r.jnAcc;if(null==t)return e.geom.Vec3.get(i.nx*o,i.ny*o);if(t!=i.b1.outer&&t!=i.b2.outer)throw new n._Boot.HaxeError("Error: Contact does not relate to the given body");return t==i.b1.outer?e.geom.Vec3.get(i.nx*-o,i.ny*-o,-(i.ny*r.r1x-i.nx*r.r1y)*o):e.geom.Vec3.get(i.nx*o,i.ny*o,(i.ny*r.r2x-i.nx*r.r2y)*o)},e.dynamics.Contact.prototype.tangentImpulse=function(t){if(this.zpp_inner.inactiveme())throw new n._Boot.HaxeError("Error: Contact not currently in use");var i=this.zpp_inner.arbiter.colarb,r=this.zpp_inner.inner,o=r.jtAcc;if(null==t)return e.geom.Vec3.get(-i.ny*o,i.nx*o);if(t!=i.b1.outer&&t!=i.b2.outer)throw new n._Boot.HaxeError("Error: Contact does not relate to the given body");return t==i.b1.outer?e.geom.Vec3.get(i.ny*o,-i.nx*o,-(r.r1x*i.nx+r.r1y*i.ny)*o):e.geom.Vec3.get(-i.ny*o,i.nx*o,(r.r2x*i.nx+r.r2y*i.ny)*o)},e.dynamics.Contact.prototype.rollingImpulse=function(e){if(this.zpp_inner.inactiveme())throw new n._Boot.HaxeError("Error: Contact not currently in use");var t=this.zpp_inner.arbiter.colarb,i=this.zpp_inner.arbiter.colarb.jrAcc;if(null==e)return i;if(e!=t.b1.outer&&e!=t.b2.outer)throw new n._Boot.HaxeError("Error: Contact does not relate to the given body");return e==t.b1.outer?-i:i},e.dynamics.Contact.prototype.totalImpulse=function(t){if(this.zpp_inner.inactiveme())throw new n._Boot.HaxeError("Error: Contact not currently in use");var i=this.zpp_inner.arbiter.colarb,r=this.zpp_inner.inner,o=r.jnAcc,a=r.jtAcc,s=i.jrAcc;if(null==t)return e.geom.Vec3.get(i.nx*o-i.ny*a,i.ny*o+i.nx*a,s);if(t!=i.b1.outer&&t!=i.b2.outer)throw new n._Boot.HaxeError("Error: Contact does not relate to the given body");var l=i.nx*o-i.ny*a,p=i.ny*o+i.nx*a;return t==i.b1.outer?e.geom.Vec3.get(-l,-p,-(p*r.r1x-l*r.r1y)-s):e.geom.Vec3.get(l,p,p*r.r2x-l*r.r2y+s)},Object.defineProperty(e.dynamics.Contact.prototype,"friction",{get:e.dynamics.Contact.prototype.get_friction}),e.dynamics.Contact.prototype.get_friction=function(){if(this.zpp_inner.inactiveme())throw new n._Boot.HaxeError("Error: Contact not currently in use");return this.zpp_inner.inner.friction},e.dynamics.Contact.prototype.toString=function(){return null==this.zpp_inner.arbiter||this.zpp_inner.arbiter.cleared?"{object-pooled}":"{Contact}"},e.dynamics.Contact.prototype.__class__=e.dynamics.Contact,e.dynamics.ContactIterator=l["nape.dynamics.ContactIterator"]=function(){if(this.zpp_next=null,this.zpp_critical=!1,this.zpp_i=0,this.zpp_inner=null,!t.util.ZPP_ContactList.internal)throw new n._Boot.HaxeError("Error: Cannot instantiate ContactIterator derp!")},e.dynamics.ContactIterator.__name__=["nape","dynamics","ContactIterator"],e.dynamics.ContactIterator.get=function(n){var i;if(null==e.dynamics.ContactIterator.zpp_pool){t.util.ZPP_ContactList.internal=!0;var r=new e.dynamics.ContactIterator;t.util.ZPP_ContactList.internal=!1,i=r}else{var o=e.dynamics.ContactIterator.zpp_pool;e.dynamics.ContactIterator.zpp_pool=o.zpp_next,i=o}return i.zpp_i=0,i.zpp_inner=n,i.zpp_critical=!1,i},e.dynamics.ContactIterator.prototype.zpp_inner=null,e.dynamics.ContactIterator.prototype.zpp_i=null,e.dynamics.ContactIterator.prototype.zpp_critical=null,e.dynamics.ContactIterator.prototype.zpp_next=null,e.dynamics.ContactIterator.prototype.hasNext=function(){this.zpp_inner.zpp_inner.valmod();var t=this.zpp_inner;if(t.zpp_inner.valmod(),t.zpp_inner.zip_length){t.zpp_inner.zip_length=!1,t.zpp_inner.user_length=0;for(var n=t.zpp_inner.inner.next;null!=n;){var i=n;i.active&&i.arbiter.active&&t.zpp_inner.user_length++,n=n.next}}var r=t.zpp_inner.user_length;return this.zpp_critical=!0,this.zpp_i<r||(this.zpp_next=e.dynamics.ContactIterator.zpp_pool,e.dynamics.ContactIterator.zpp_pool=this,this.zpp_inner=null,!1)},e.dynamics.ContactIterator.prototype.next=function(){return this.zpp_critical=!1,this.zpp_inner.at(this.zpp_i++)},e.dynamics.ContactIterator.prototype.__class__=e.dynamics.ContactIterator,e.dynamics.ContactList=l["nape.dynamics.ContactList"]=function(){this.zpp_inner=null,this.zpp_inner=new t.util.ZPP_ContactList,this.zpp_inner.outer=this},e.dynamics.ContactList.__name__=["nape","dynamics","ContactList"],e.dynamics.ContactList.fromArray=function(t){if(null==t)throw new n._Boot.HaxeError("Error: Cannot convert null Array to Nape list");for(var i=new e.dynamics.ContactList,r=0;r<t.length;){var o=t[r];++r,i.push(o)}return i},e.dynamics.ContactList.prototype.zpp_inner=null,Object.defineProperty(e.dynamics.ContactList.prototype,"length",{get:e.dynamics.ContactList.prototype.get_length}),e.dynamics.ContactList.prototype.get_length=function(){if(this.zpp_inner.valmod(),this.zpp_inner.zip_length){this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=0;for(var e=this.zpp_inner.inner.next;null!=e;){var t=e;t.active&&t.arbiter.active&&this.zpp_inner.user_length++,e=e.next}}return this.zpp_inner.user_length},e.dynamics.ContactList.prototype.has=function(e){return this.zpp_inner.valmod(),this.zpp_inner.inner.has(e.zpp_inner)},e.dynamics.ContactList.prototype.at=function(e){var t;if(this.zpp_inner.valmod(),e>=0){if(this.zpp_inner.valmod(),this.zpp_inner.zip_length){this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=0;for(var i=this.zpp_inner.inner.next;null!=i;){var r=i;r.active&&r.arbiter.active&&this.zpp_inner.user_length++,i=i.next}}t=e>=this.zpp_inner.user_length}else t=!0;if(t)throw new n._Boot.HaxeError("Error: Index out of bounds");if(this.zpp_inner.reverse_flag){if(this.zpp_inner.valmod(),this.zpp_inner.zip_length){this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=0;for(var o=this.zpp_inner.inner.next;null!=o;){var a=o;a.active&&a.arbiter.active&&this.zpp_inner.user_length++,o=o.next}}e=this.zpp_inner.user_length-1-e}if(e<this.zpp_inner.at_index||null==this.zpp_inner.at_ite)for(this.zpp_inner.at_index=0,this.zpp_inner.at_ite=this.zpp_inner.inner.next;;){var s=this.zpp_inner.at_ite;if(s.active&&s.arbiter.active)break;this.zpp_inner.at_ite=this.zpp_inner.at_ite.next}for(;this.zpp_inner.at_index!=e;)for(this.zpp_inner.at_index++,this.zpp_inner.at_ite=this.zpp_inner.at_ite.next;;){var l=this.zpp_inner.at_ite;if(l.active&&l.arbiter.active)break;this.zpp_inner.at_ite=this.zpp_inner.at_ite.next}return this.zpp_inner.at_ite.wrapper()},e.dynamics.ContactList.prototype.push=function(e){if(this.zpp_inner.immutable)throw new n._Boot.HaxeError("Error: ContactList is immutable");this.zpp_inner.modify_test(),this.zpp_inner.valmod();var t=null==this.zpp_inner.adder||this.zpp_inner.adder(e);if(t){if(this.zpp_inner.reverse_flag)this.zpp_inner.inner.add(e.zpp_inner);else{if(null==this.zpp_inner.push_ite){var i;if(this.zpp_inner.valmod(),this.zpp_inner.zip_length){this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=0;for(var r=this.zpp_inner.inner.next;null!=r;){var o=r;o.active&&o.arbiter.active&&this.zpp_inner.user_length++,r=r.next}}if(0==this.zpp_inner.user_length)i=null;else{var a=this.zpp_inner.inner;if(this.zpp_inner.valmod(),this.zpp_inner.zip_length){this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=0;for(var s=this.zpp_inner.inner.next;null!=s;){var l=s;l.active&&l.arbiter.active&&this.zpp_inner.user_length++,s=s.next}}i=a.iterator_at(this.zpp_inner.user_length-1)}this.zpp_inner.push_ite=i}this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,e.zpp_inner)}this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(e)}return t},e.dynamics.ContactList.prototype.unshift=function(e){if(this.zpp_inner.immutable)throw new n._Boot.HaxeError("Error: ContactList is immutable");this.zpp_inner.modify_test(),this.zpp_inner.valmod();var t=null==this.zpp_inner.adder||this.zpp_inner.adder(e);if(t){if(this.zpp_inner.reverse_flag){if(null==this.zpp_inner.push_ite){var i;if(this.zpp_inner.valmod(),this.zpp_inner.zip_length){this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=0;for(var r=this.zpp_inner.inner.next;null!=r;){var o=r;o.active&&o.arbiter.active&&this.zpp_inner.user_length++,r=r.next}}if(0==this.zpp_inner.user_length)i=null;else{var a=this.zpp_inner.inner;if(this.zpp_inner.valmod(),this.zpp_inner.zip_length){this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=0;for(var s=this.zpp_inner.inner.next;null!=s;){var l=s;l.active&&l.arbiter.active&&this.zpp_inner.user_length++,s=s.next}}i=a.iterator_at(this.zpp_inner.user_length-1)}this.zpp_inner.push_ite=i}this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,e.zpp_inner)}else this.zpp_inner.inner.add(e.zpp_inner);this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(e)}return t},e.dynamics.ContactList.prototype.pop=function(){if(this.zpp_inner.immutable)throw new n._Boot.HaxeError("Error: ContactList is immutable");if(this.zpp_inner.modify_test(),this.zpp_inner.valmod(),this.zpp_inner.zip_length){this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=0;for(var e=this.zpp_inner.inner.next;null!=e;){var t=e;t.active&&t.arbiter.active&&this.zpp_inner.user_length++,e=e.next}}if(0==this.zpp_inner.user_length)throw new n._Boot.HaxeError("Error: Cannot remove from empty list");this.zpp_inner.valmod();var i=null;if(this.zpp_inner.reverse_flag){var r=(i=this.zpp_inner.inner.next).wrapper();null!=this.zpp_inner.subber&&this.zpp_inner.subber(r),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()}else{var o;if(null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null),this.zpp_inner.valmod(),this.zpp_inner.zip_length){this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=0;for(var a=this.zpp_inner.inner.next;null!=a;){var s=a;s.active&&s.arbiter.active&&this.zpp_inner.user_length++,a=a.next}}if(1==this.zpp_inner.user_length)o=null;else{var l=this.zpp_inner.inner;if(this.zpp_inner.valmod(),this.zpp_inner.zip_length){this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=0;for(var p=this.zpp_inner.inner.next;null!=p;){var u=p;u.active&&u.arbiter.active&&this.zpp_inner.user_length++,p=p.next}}o=l.iterator_at(this.zpp_inner.user_length-2)}var h=(i=null==o?this.zpp_inner.inner.next:o.next).wrapper();null!=this.zpp_inner.subber&&this.zpp_inner.subber(h),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(o)}return this.zpp_inner.invalidate(),i.wrapper()},e.dynamics.ContactList.prototype.shift=function(){if(this.zpp_inner.immutable)throw new n._Boot.HaxeError("Error: ContactList is immutable");if(this.zpp_inner.modify_test(),this.zpp_inner.valmod(),this.zpp_inner.zip_length){this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=0;for(var e=this.zpp_inner.inner.next;null!=e;){var t=e;t.active&&t.arbiter.active&&this.zpp_inner.user_length++,e=e.next}}if(0==this.zpp_inner.user_length)throw new n._Boot.HaxeError("Error: Cannot remove from empty list");this.zpp_inner.valmod();var i=null;if(this.zpp_inner.reverse_flag){var r;if(null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null),this.zpp_inner.valmod(),this.zpp_inner.zip_length){this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=0;for(var o=this.zpp_inner.inner.next;null!=o;){var a=o;a.active&&a.arbiter.active&&this.zpp_inner.user_length++,o=o.next}}if(1==this.zpp_inner.user_length)r=null;else{var s=this.zpp_inner.inner;if(this.zpp_inner.valmod(),this.zpp_inner.zip_length){this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=0;for(var l=this.zpp_inner.inner.next;null!=l;){var p=l;p.active&&p.arbiter.active&&this.zpp_inner.user_length++,l=l.next}}r=s.iterator_at(this.zpp_inner.user_length-2)}var u=(i=null==r?this.zpp_inner.inner.next:r.next).wrapper();null!=this.zpp_inner.subber&&this.zpp_inner.subber(u),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(r)}else{var h=(i=this.zpp_inner.inner.next).wrapper();null!=this.zpp_inner.subber&&this.zpp_inner.subber(h),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()}return this.zpp_inner.invalidate(),i.wrapper()},e.dynamics.ContactList.prototype.add=function(e){return this.zpp_inner.reverse_flag?this.push(e):this.unshift(e)},e.dynamics.ContactList.prototype.remove=function(e){if(this.zpp_inner.immutable)throw new n._Boot.HaxeError("Error: ContactList is immutable");var t;this.zpp_inner.modify_test(),this.zpp_inner.valmod(),t=!1;for(var i=this.zpp_inner.inner.next;null!=i;){if(i==e.zpp_inner){t=!0;break}i=i.next}return t&&(null!=this.zpp_inner.subber&&this.zpp_inner.subber(e),this.zpp_inner.dontremove||this.zpp_inner.inner.remove(e.zpp_inner),this.zpp_inner.invalidate()),t},e.dynamics.ContactList.prototype.clear=function(){if(this.zpp_inner.immutable)throw new n._Boot.HaxeError("Error: ContactList is immutable");if(this.zpp_inner.reverse_flag)for(;;){if(this.zpp_inner.valmod(),this.zpp_inner.zip_length){this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=0;for(var e=this.zpp_inner.inner.next;null!=e;){var t=e;t.active&&t.arbiter.active&&this.zpp_inner.user_length++,e=e.next}}if(0==this.zpp_inner.user_length)break;this.pop()}else for(;;){if(this.zpp_inner.valmod(),this.zpp_inner.zip_length){this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=0;for(var i=this.zpp_inner.inner.next;null!=i;){var r=i;r.active&&r.arbiter.active&&this.zpp_inner.user_length++,i=i.next}}if(0==this.zpp_inner.user_length)break;this.shift()}},e.dynamics.ContactList.prototype.empty=function(){if(this.zpp_inner.valmod(),this.zpp_inner.zip_length){this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=0;for(var e=this.zpp_inner.inner.next;null!=e;){var t=e;t.active&&t.arbiter.active&&this.zpp_inner.user_length++,e=e.next}}return 0==this.zpp_inner.user_length},e.dynamics.ContactList.prototype.iterator=function(){return this.zpp_inner.valmod(),e.dynamics.ContactIterator.get(this)},e.dynamics.ContactList.prototype.copy=function(t){null==t&&(t=!1);var i=new e.dynamics.ContactList;this.zpp_inner.valmod();for(var r=e.dynamics.ContactIterator.get(this);;){r.zpp_inner.zpp_inner.valmod();var o=r.zpp_inner;if(o.zpp_inner.valmod(),o.zpp_inner.zip_length){o.zpp_inner.zip_length=!1,o.zpp_inner.user_length=0;for(var a=o.zpp_inner.inner.next;null!=a;){var s=a;s.active&&s.arbiter.active&&o.zpp_inner.user_length++,a=a.next}}var l,p=o.zpp_inner.user_length;if(r.zpp_critical=!0,r.zpp_i<p?l=!0:(r.zpp_next=e.dynamics.ContactIterator.zpp_pool,e.dynamics.ContactIterator.zpp_pool=r,r.zpp_inner=null,l=!1),!l)break;r.zpp_critical=!1;var u,h=r.zpp_inner.at(r.zpp_i++);if(t)throw new n._Boot.HaxeError("Error: Contact is not a copyable type");u=h,i.push(u)}return i},e.dynamics.ContactList.prototype.merge=function(t){if(null==t)throw new n._Boot.HaxeError("Error: Cannot merge with null list");t.zpp_inner.valmod();for(var i=e.dynamics.ContactIterator.get(t);;){i.zpp_inner.zpp_inner.valmod();var r=i.zpp_inner;if(r.zpp_inner.valmod(),r.zpp_inner.zip_length){r.zpp_inner.zip_length=!1,r.zpp_inner.user_length=0;for(var o=r.zpp_inner.inner.next;null!=o;){var a=o;a.active&&a.arbiter.active&&r.zpp_inner.user_length++,o=o.next}}var s,l=r.zpp_inner.user_length;if(i.zpp_critical=!0,i.zpp_i<l?s=!0:(i.zpp_next=e.dynamics.ContactIterator.zpp_pool,e.dynamics.ContactIterator.zpp_pool=i,i.zpp_inner=null,s=!1),!s)break;i.zpp_critical=!1;var p=i.zpp_inner.at(i.zpp_i++);this.has(p)||(this.zpp_inner.reverse_flag?this.push(p):this.unshift(p))}},e.dynamics.ContactList.prototype.toString=function(){var t="[",n=!0;this.zpp_inner.valmod();for(var i=e.dynamics.ContactIterator.get(this);;){i.zpp_inner.zpp_inner.valmod();var r=i.zpp_inner;if(r.zpp_inner.valmod(),r.zpp_inner.zip_length){r.zpp_inner.zip_length=!1,r.zpp_inner.user_length=0;for(var o=r.zpp_inner.inner.next;null!=o;){var a=o;a.active&&a.arbiter.active&&r.zpp_inner.user_length++,o=o.next}}var s,l=r.zpp_inner.user_length;if(i.zpp_critical=!0,i.zpp_i<l?s=!0:(i.zpp_next=e.dynamics.ContactIterator.zpp_pool,e.dynamics.ContactIterator.zpp_pool=i,i.zpp_inner=null,s=!1),!s)break;i.zpp_critical=!1;var p=i.zpp_inner.at(i.zpp_i++);n||(t+=","),t+=null==p?"NULL":p.toString(),n=!1}return t+"]"},e.dynamics.ContactList.prototype.foreach=function(t){if(null==t)throw new n._Boot.HaxeError("Error: Cannot execute null on list elements");this.zpp_inner.valmod();for(var i=e.dynamics.ContactIterator.get(this);;){i.zpp_inner.zpp_inner.valmod();var r=i.zpp_inner;if(r.zpp_inner.valmod(),r.zpp_inner.zip_length){r.zpp_inner.zip_length=!1,r.zpp_inner.user_length=0;for(var o=r.zpp_inner.inner.next;null!=o;){var a=o;a.active&&a.arbiter.active&&r.zpp_inner.user_length++,o=o.next}}var s,l=r.zpp_inner.user_length;if(i.zpp_critical=!0,i.zpp_i<l?s=!0:(i.zpp_next=e.dynamics.ContactIterator.zpp_pool,e.dynamics.ContactIterator.zpp_pool=i,i.zpp_inner=null,s=!1),!s)break;try{i.zpp_critical=!1,t(i.zpp_inner.at(i.zpp_i++))}catch(t){t instanceof n._Boot.HaxeError&&t.val,i.zpp_next=e.dynamics.ContactIterator.zpp_pool,e.dynamics.ContactIterator.zpp_pool=i,i.zpp_inner=null;break}}return this},e.dynamics.ContactList.prototype.filter=function(e){if(null==e)throw new n._Boot.HaxeError("Error: Cannot select elements of list with null");for(var t=0;;){if(this.zpp_inner.valmod(),this.zpp_inner.zip_length){this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=0;for(var i=this.zpp_inner.inner.next;null!=i;){var r=i;r.active&&r.arbiter.active&&this.zpp_inner.user_length++,i=i.next}}if(!(t<this.zpp_inner.user_length))break;var o=this.at(t);try{e(o)?++t:this.remove(o)}catch(e){e instanceof n._Boot.HaxeError&&e.val;break}}return this},e.dynamics.ContactList.prototype.__class__=e.dynamics.ContactList,e.dynamics.FluidArbiter=l["nape.dynamics.FluidArbiter"]=function(){if(!t.dynamics.ZPP_Arbiter.internal)throw new n._Boot.HaxeError("Error: Cannot instantiate FluidArbiter derp!");e.dynamics.Arbiter.call(this)},e.dynamics.FluidArbiter.__name__=["nape","dynamics","FluidArbiter"],e.dynamics.FluidArbiter.__super__=e.dynamics.Arbiter,e.dynamics.Arbiter.prototype)e.dynamics.FluidArbiter.prototype[u]=e.dynamics.Arbiter.prototype[u];for(var u in Object.defineProperty(e.dynamics.FluidArbiter.prototype,"position",{get:e.dynamics.FluidArbiter.prototype.get_position,set:e.dynamics.FluidArbiter.prototype.set_position}),e.dynamics.FluidArbiter.prototype.get_position=function(){if(!this.zpp_inner.active)throw new n._Boot.HaxeError("Error: Arbiter not currently in use");return null==this.zpp_inner.fluidarb.wrap_position&&this.zpp_inner.fluidarb.getposition(),this.zpp_inner.fluidarb.wrap_position},e.dynamics.FluidArbiter.prototype.set_position=function(e){if(!this.zpp_inner.fluidarb.mutable)throw new n._Boot.HaxeError("Error: Arbiter is mutable only within a pre-handler");if(null==e)throw new n._Boot.HaxeError("Error: FluidArbiter::position cannot be null");if(!this.zpp_inner.active)throw new n._Boot.HaxeError("Error: Arbiter not currently in use");null==this.zpp_inner.fluidarb.wrap_position&&this.zpp_inner.fluidarb.getposition();var i=this.zpp_inner.fluidarb.wrap_position;if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var r=i.zpp_inner;if(r._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=r._isimmutable&&r._isimmutable(),null==e)throw new n._Boot.HaxeError("Error: Cannot assign null Vec2");if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var o=e.zpp_inner;null!=o._validate&&o._validate();var a=e.zpp_inner.x;if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var s=e.zpp_inner;null!=s._validate&&s._validate();var l=e.zpp_inner.y;if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var p,u=i.zpp_inner;if(u._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=u._isimmutable&&u._isimmutable(),a!=a||l!=l)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var h=i.zpp_inner;if(null!=h._validate&&h._validate(),i.zpp_inner.x==a){if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var c=i.zpp_inner;null!=c._validate&&c._validate(),p=i.zpp_inner.y==l}else p=!1;if(!p){i.zpp_inner.x=a,i.zpp_inner.y=l;var _=i.zpp_inner;null!=_._invalidate&&_._invalidate(_)}if(e.zpp_inner.weak){if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var d=e.zpp_inner;if(d._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=d._isimmutable&&d._isimmutable(),e.zpp_inner._inuse)throw new n._Boot.HaxeError("Error: This Vec2 is not disposable");var m=e.zpp_inner;e.zpp_inner.outer=null,e.zpp_inner=null;var P=e;P.zpp_pool=null,null!=t.util.ZPP_PubPool.nextVec2?t.util.ZPP_PubPool.nextVec2.zpp_pool=P:t.util.ZPP_PubPool.poolVec2=P,t.util.ZPP_PubPool.nextVec2=P,P.zpp_disp=!0;var f=m;null!=f.outer&&(f.outer.zpp_inner=null,f.outer=null),f._isimmutable=null,f._validate=null,f._invalidate=null,f.next=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=f}if(!this.zpp_inner.active)throw new n._Boot.HaxeError("Error: Arbiter not currently in use");return null==this.zpp_inner.fluidarb.wrap_position&&this.zpp_inner.fluidarb.getposition(),this.zpp_inner.fluidarb.wrap_position},Object.defineProperty(e.dynamics.FluidArbiter.prototype,"overlap",{get:e.dynamics.FluidArbiter.prototype.get_overlap,set:e.dynamics.FluidArbiter.prototype.set_overlap}),e.dynamics.FluidArbiter.prototype.get_overlap=function(){if(!this.zpp_inner.active)throw new n._Boot.HaxeError("Error: Arbiter not currently in use");return this.zpp_inner.fluidarb.overlap},e.dynamics.FluidArbiter.prototype.set_overlap=function(e){if(!this.zpp_inner.fluidarb.mutable)throw new n._Boot.HaxeError("Error: Arbiter is mutable only within a pre-handler");if(e!=e)throw new n._Boot.HaxeError("Error: FluidArbiter::overlap cannot be NaN");if(e<=0||e==1/0)throw new n._Boot.HaxeError("Error: FluidArbiter::overlap must be strictly positive and non infinite");if(this.zpp_inner.fluidarb.overlap=e,!this.zpp_inner.active)throw new n._Boot.HaxeError("Error: Arbiter not currently in use");return this.zpp_inner.fluidarb.overlap},e.dynamics.FluidArbiter.prototype.buoyancyImpulse=function(t){if(!this.zpp_inner.active)throw new n._Boot.HaxeError("Error: Arbiter not currently in use");var i,r;if(null!=t){if(!this.zpp_inner.active)throw new n._Boot.HaxeError("Error: Arbiter not currently in use");r=t!=(this.zpp_inner.ws1.id>this.zpp_inner.ws2.id?this.zpp_inner.b2.outer:this.zpp_inner.b1.outer)}else r=!1;if(r){if(!this.zpp_inner.active)throw new n._Boot.HaxeError("Error: Arbiter not currently in use");i=t!=(this.zpp_inner.ws1.id>this.zpp_inner.ws2.id?this.zpp_inner.b1.outer:this.zpp_inner.b2.outer)}else i=!1;if(i)throw new n._Boot.HaxeError("Error: Arbiter does not relate to body");var o=this.zpp_inner.fluidarb;return null==t?e.geom.Vec3.get(o.buoyx,o.buoyy,0):t.zpp_inner==this.zpp_inner.b2?e.geom.Vec3.get(o.buoyx,o.buoyy,o.buoyy*o.r2x-o.buoyx*o.r2y):e.geom.Vec3.get(-o.buoyx,-o.buoyy,-(o.buoyy*o.r1x-o.buoyx*o.r1y))},e.dynamics.FluidArbiter.prototype.dragImpulse=function(t){if(!this.zpp_inner.active)throw new n._Boot.HaxeError("Error: Arbiter not currently in use");var i,r;if(null!=t){if(!this.zpp_inner.active)throw new n._Boot.HaxeError("Error: Arbiter not currently in use");r=t!=(this.zpp_inner.ws1.id>this.zpp_inner.ws2.id?this.zpp_inner.b2.outer:this.zpp_inner.b1.outer)}else r=!1;if(r){if(!this.zpp_inner.active)throw new n._Boot.HaxeError("Error: Arbiter not currently in use");i=t!=(this.zpp_inner.ws1.id>this.zpp_inner.ws2.id?this.zpp_inner.b1.outer:this.zpp_inner.b2.outer)}else i=!1;if(i)throw new n._Boot.HaxeError("Error: Arbiter does not relate to body");var o=this.zpp_inner.fluidarb,a=null==t||t.zpp_inner==this.zpp_inner.b2?1:-1;return e.geom.Vec3.get(o.dampx*a,o.dampy*a,o.adamp*a)},e.dynamics.FluidArbiter.prototype.totalImpulse=function(e,t){if(!this.zpp_inner.active)throw new n._Boot.HaxeError("Error: Arbiter not currently in use");var i,r;if(null!=e){if(!this.zpp_inner.active)throw new n._Boot.HaxeError("Error: Arbiter not currently in use");r=e!=(this.zpp_inner.ws1.id>this.zpp_inner.ws2.id?this.zpp_inner.b2.outer:this.zpp_inner.b1.outer)}else r=!1;if(r){if(!this.zpp_inner.active)throw new n._Boot.HaxeError("Error: Arbiter not currently in use");i=e!=(this.zpp_inner.ws1.id>this.zpp_inner.ws2.id?this.zpp_inner.b1.outer:this.zpp_inner.b2.outer)}else i=!1;if(i)throw new n._Boot.HaxeError("Error: Arbiter does not relate to body");var o=this.buoyancyImpulse(e),a=this.dragImpulse(e),s=a;if(null!=s&&s.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");var l=s.zpp_inner;null!=l._validate&&l._validate();var p=s.zpp_inner.x;if(null!=o&&o.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");var u=o.zpp_inner;if(null!=u._validate&&u._validate(),null!=s&&s.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");if(s.zpp_inner.immutable)throw new n._Boot.HaxeError("Error: Vec3 is immutable");if(s.zpp_inner.x=p+o.zpp_inner.x,null!=s&&s.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");var h=s.zpp_inner;null!=h._validate&&h._validate();var c=a;if(null!=c&&c.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");var _=c.zpp_inner;null!=_._validate&&_._validate();var d=c.zpp_inner.y;if(null!=o&&o.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");var m=o.zpp_inner;if(null!=m._validate&&m._validate(),null!=c&&c.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");if(c.zpp_inner.immutable)throw new n._Boot.HaxeError("Error: Vec3 is immutable");if(c.zpp_inner.y=d+o.zpp_inner.y,null!=c&&c.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");var P=c.zpp_inner;null!=P._validate&&P._validate();var f=a;if(null!=f&&f.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");var x=f.zpp_inner;null!=x._validate&&x._validate();var y=f.zpp_inner.z;if(null!=o&&o.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");var v=o.zpp_inner;if(null!=v._validate&&v._validate(),null!=f&&f.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");if(f.zpp_inner.immutable)throw new n._Boot.HaxeError("Error: Vec3 is immutable");if(f.zpp_inner.z=y+o.zpp_inner.z,null!=f&&f.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");var g=f.zpp_inner;return null!=g._validate&&g._validate(),o.dispose(),a},e.dynamics.FluidArbiter.prototype.__class__=e.dynamics.FluidArbiter,e.dynamics.InteractionFilter=l["nape.dynamics.InteractionFilter"]=function(e,n,i,r,o,a){null==a&&(a=-1),null==o&&(o=1),null==r&&(r=-1),null==i&&(i=1),null==n&&(n=-1),null==e&&(e=1),this.zpp_inner=null,null==t.dynamics.ZPP_InteractionFilter.zpp_pool?this.zpp_inner=new t.dynamics.ZPP_InteractionFilter:(this.zpp_inner=t.dynamics.ZPP_InteractionFilter.zpp_pool,t.dynamics.ZPP_InteractionFilter.zpp_pool=this.zpp_inner.next,this.zpp_inner.next=null),this.zpp_inner.outer=this,this.zpp_inner.collisionGroup!=e&&(this.zpp_inner.collisionGroup=e,this.zpp_inner.invalidate()),this.zpp_inner.collisionMask!=n&&(this.zpp_inner.collisionMask=n,this.zpp_inner.invalidate()),this.zpp_inner.sensorGroup!=i&&(this.zpp_inner.sensorGroup=i,this.zpp_inner.invalidate()),this.zpp_inner.sensorMask!=r&&(this.zpp_inner.sensorMask=r,this.zpp_inner.invalidate()),this.zpp_inner.fluidGroup!=o&&(this.zpp_inner.fluidGroup=o,this.zpp_inner.invalidate()),this.zpp_inner.fluidMask!=a&&(this.zpp_inner.fluidMask=a,this.zpp_inner.invalidate())},e.dynamics.InteractionFilter.__name__=["nape","dynamics","InteractionFilter"],e.dynamics.InteractionFilter.prototype.zpp_inner=null,Object.defineProperty(e.dynamics.InteractionFilter.prototype,"userData",{get:e.dynamics.InteractionFilter.prototype.get_userData}),e.dynamics.InteractionFilter.prototype.get_userData=function(){return null==this.zpp_inner.userData&&(this.zpp_inner.userData={}),this.zpp_inner.userData},Object.defineProperty(e.dynamics.InteractionFilter.prototype,"shapes",{get:e.dynamics.InteractionFilter.prototype.get_shapes}),e.dynamics.InteractionFilter.prototype.get_shapes=function(){return null==this.zpp_inner.wrap_shapes&&(this.zpp_inner.wrap_shapes=t.util.ZPP_ShapeList.get(this.zpp_inner.shapes,!0)),this.zpp_inner.wrap_shapes},Object.defineProperty(e.dynamics.InteractionFilter.prototype,"collisionGroup",{get:e.dynamics.InteractionFilter.prototype.get_collisionGroup,set:e.dynamics.InteractionFilter.prototype.set_collisionGroup}),e.dynamics.InteractionFilter.prototype.get_collisionGroup=function(){return this.zpp_inner.collisionGroup},e.dynamics.InteractionFilter.prototype.set_collisionGroup=function(e){return this.zpp_inner.collisionGroup!=e&&(this.zpp_inner.collisionGroup=e,this.zpp_inner.invalidate()),this.zpp_inner.collisionGroup},Object.defineProperty(e.dynamics.InteractionFilter.prototype,"collisionMask",{get:e.dynamics.InteractionFilter.prototype.get_collisionMask,set:e.dynamics.InteractionFilter.prototype.set_collisionMask}),e.dynamics.InteractionFilter.prototype.get_collisionMask=function(){return this.zpp_inner.collisionMask},e.dynamics.InteractionFilter.prototype.set_collisionMask=function(e){return this.zpp_inner.collisionMask!=e&&(this.zpp_inner.collisionMask=e,this.zpp_inner.invalidate()),this.zpp_inner.collisionMask},Object.defineProperty(e.dynamics.InteractionFilter.prototype,"sensorGroup",{get:e.dynamics.InteractionFilter.prototype.get_sensorGroup,set:e.dynamics.InteractionFilter.prototype.set_sensorGroup}),e.dynamics.InteractionFilter.prototype.get_sensorGroup=function(){return this.zpp_inner.sensorGroup},e.dynamics.InteractionFilter.prototype.set_sensorGroup=function(e){return this.zpp_inner.sensorGroup!=e&&(this.zpp_inner.sensorGroup=e,this.zpp_inner.invalidate()),this.zpp_inner.sensorGroup},Object.defineProperty(e.dynamics.InteractionFilter.prototype,"sensorMask",{get:e.dynamics.InteractionFilter.prototype.get_sensorMask,set:e.dynamics.InteractionFilter.prototype.set_sensorMask}),e.dynamics.InteractionFilter.prototype.get_sensorMask=function(){return this.zpp_inner.sensorMask},e.dynamics.InteractionFilter.prototype.set_sensorMask=function(e){return this.zpp_inner.sensorMask!=e&&(this.zpp_inner.sensorMask=e,this.zpp_inner.invalidate()),this.zpp_inner.sensorMask},Object.defineProperty(e.dynamics.InteractionFilter.prototype,"fluidGroup",{get:e.dynamics.InteractionFilter.prototype.get_fluidGroup,set:e.dynamics.InteractionFilter.prototype.set_fluidGroup}),e.dynamics.InteractionFilter.prototype.get_fluidGroup=function(){return this.zpp_inner.fluidGroup},e.dynamics.InteractionFilter.prototype.set_fluidGroup=function(e){return this.zpp_inner.fluidGroup!=e&&(this.zpp_inner.fluidGroup=e,this.zpp_inner.invalidate()),this.zpp_inner.fluidGroup},Object.defineProperty(e.dynamics.InteractionFilter.prototype,"fluidMask",{get:e.dynamics.InteractionFilter.prototype.get_fluidMask,set:e.dynamics.InteractionFilter.prototype.set_fluidMask}),e.dynamics.InteractionFilter.prototype.get_fluidMask=function(){return this.zpp_inner.fluidMask},e.dynamics.InteractionFilter.prototype.set_fluidMask=function(e){return this.zpp_inner.fluidMask!=e&&(this.zpp_inner.fluidMask=e,this.zpp_inner.invalidate()),this.zpp_inner.fluidMask},e.dynamics.InteractionFilter.prototype.shouldCollide=function(e){if(null==e)throw new n._Boot.HaxeError("Error: filter argument cannot be null for shouldCollide");var t=this.zpp_inner,i=e.zpp_inner;return 0!=(t.collisionMask&i.collisionGroup)&&0!=(i.collisionMask&t.collisionGroup)},e.dynamics.InteractionFilter.prototype.shouldSense=function(e){if(null==e)throw new n._Boot.HaxeError("Error: filter argument cannot be null for shouldSense");var t=this.zpp_inner,i=e.zpp_inner;return 0!=(t.sensorMask&i.sensorGroup)&&0!=(i.sensorMask&t.sensorGroup)},e.dynamics.InteractionFilter.prototype.shouldFlow=function(e){if(null==e)throw new n._Boot.HaxeError("Error: filter argument cannot be null for shouldFlow");var t=this.zpp_inner,i=e.zpp_inner;return 0!=(t.fluidMask&i.fluidGroup)&&0!=(i.fluidMask&t.fluidGroup)},e.dynamics.InteractionFilter.prototype.copy=function(){return new e.dynamics.InteractionFilter(this.zpp_inner.collisionGroup,this.zpp_inner.collisionMask,this.zpp_inner.sensorGroup,this.zpp_inner.sensorMask,this.zpp_inner.fluidGroup,this.zpp_inner.fluidMask)},e.dynamics.InteractionFilter.prototype.toString=function(){return"{ collision: "+o.hex(this.zpp_inner.collisionGroup,8)+"~"+o.hex(this.zpp_inner.collisionMask,8)+" sensor: "+o.hex(this.zpp_inner.sensorGroup,8)+"~"+o.hex(this.zpp_inner.sensorMask,8)+" fluid: "+o.hex(this.zpp_inner.fluidGroup,8)+"~"+o.hex(this.zpp_inner.fluidMask,8)+" }"},e.dynamics.InteractionFilter.prototype.__class__=e.dynamics.InteractionFilter,e.dynamics.InteractionGroup=l["nape.dynamics.InteractionGroup"]=function(e){null==e&&(e=!1),this.zpp_inner=null,this.zpp_inner=new t.dynamics.ZPP_InteractionGroup,this.zpp_inner.outer=this,this.zpp_inner.ignore!=e&&(this.zpp_inner.invalidate(!0),this.zpp_inner.ignore=e)},e.dynamics.InteractionGroup.__name__=["nape","dynamics","InteractionGroup"],e.dynamics.InteractionGroup.prototype.zpp_inner=null,Object.defineProperty(e.dynamics.InteractionGroup.prototype,"group",{get:e.dynamics.InteractionGroup.prototype.get_group,set:e.dynamics.InteractionGroup.prototype.set_group}),e.dynamics.InteractionGroup.prototype.get_group=function(){return null==this.zpp_inner.group?null:this.zpp_inner.group.outer},e.dynamics.InteractionGroup.prototype.set_group=function(e){if(e==this)throw new n._Boot.HaxeError("Error: Cannot assign InteractionGroup to itself");return this.zpp_inner.setGroup(null==e?null:e.zpp_inner),null==this.zpp_inner.group?null:this.zpp_inner.group.outer},Object.defineProperty(e.dynamics.InteractionGroup.prototype,"ignore",{get:e.dynamics.InteractionGroup.prototype.get_ignore,set:e.dynamics.InteractionGroup.prototype.set_ignore}),e.dynamics.InteractionGroup.prototype.get_ignore=function(){return this.zpp_inner.ignore},e.dynamics.InteractionGroup.prototype.set_ignore=function(e){return this.zpp_inner.ignore!=e&&(this.zpp_inner.invalidate(!0),this.zpp_inner.ignore=e),this.zpp_inner.ignore},Object.defineProperty(e.dynamics.InteractionGroup.prototype,"interactors",{get:e.dynamics.InteractionGroup.prototype.get_interactors}),e.dynamics.InteractionGroup.prototype.get_interactors=function(){return null==this.zpp_inner.wrap_interactors&&(this.zpp_inner.wrap_interactors=t.util.ZPP_InteractorList.get(this.zpp_inner.interactors,!0)),this.zpp_inner.wrap_interactors},Object.defineProperty(e.dynamics.InteractionGroup.prototype,"groups",{get:e.dynamics.InteractionGroup.prototype.get_groups}),e.dynamics.InteractionGroup.prototype.get_groups=function(){return null==this.zpp_inner.wrap_groups&&(this.zpp_inner.wrap_groups=t.util.ZPP_InteractionGroupList.get(this.zpp_inner.groups,!0)),this.zpp_inner.wrap_groups},e.dynamics.InteractionGroup.prototype.toString=function(){var e="InteractionGroup";return this.zpp_inner.ignore&&(e+=":ignore"),e},e.dynamics.InteractionGroup.prototype.__class__=e.dynamics.InteractionGroup,e.dynamics.InteractionGroupIterator=l["nape.dynamics.InteractionGroupIterator"]=function(){if(this.zpp_next=null,this.zpp_critical=!1,this.zpp_i=0,this.zpp_inner=null,!t.util.ZPP_InteractionGroupList.internal)throw new n._Boot.HaxeError("Error: Cannot instantiate InteractionGroupIterator derp!")},e.dynamics.InteractionGroupIterator.__name__=["nape","dynamics","InteractionGroupIterator"],e.dynamics.InteractionGroupIterator.get=function(n){var i;if(null==e.dynamics.InteractionGroupIterator.zpp_pool){t.util.ZPP_InteractionGroupList.internal=!0;var r=new e.dynamics.InteractionGroupIterator;t.util.ZPP_InteractionGroupList.internal=!1,i=r}else{var o=e.dynamics.InteractionGroupIterator.zpp_pool;e.dynamics.InteractionGroupIterator.zpp_pool=o.zpp_next,i=o}return i.zpp_i=0,i.zpp_inner=n,i.zpp_critical=!1,i},e.dynamics.InteractionGroupIterator.prototype.zpp_inner=null,e.dynamics.InteractionGroupIterator.prototype.zpp_i=null,e.dynamics.InteractionGroupIterator.prototype.zpp_critical=null,e.dynamics.InteractionGroupIterator.prototype.zpp_next=null,e.dynamics.InteractionGroupIterator.prototype.hasNext=function(){this.zpp_inner.zpp_inner.valmod();var t=this.zpp_inner;t.zpp_inner.valmod(),t.zpp_inner.zip_length&&(t.zpp_inner.zip_length=!1,t.zpp_inner.user_length=t.zpp_inner.inner.length);var n=t.zpp_inner.user_length;return this.zpp_critical=!0,this.zpp_i<n||(this.zpp_next=e.dynamics.InteractionGroupIterator.zpp_pool,e.dynamics.InteractionGroupIterator.zpp_pool=this,this.zpp_inner=null,!1)},e.dynamics.InteractionGroupIterator.prototype.next=function(){return this.zpp_critical=!1,this.zpp_inner.at(this.zpp_i++)},e.dynamics.InteractionGroupIterator.prototype.__class__=e.dynamics.InteractionGroupIterator,e.dynamics.InteractionGroupList=l["nape.dynamics.InteractionGroupList"]=function(){this.zpp_inner=null,this.zpp_inner=new t.util.ZPP_InteractionGroupList,this.zpp_inner.outer=this},e.dynamics.InteractionGroupList.__name__=["nape","dynamics","InteractionGroupList"],e.dynamics.InteractionGroupList.fromArray=function(t){if(null==t)throw new n._Boot.HaxeError("Error: Cannot convert null Array to Nape list");for(var i=new e.dynamics.InteractionGroupList,r=0;r<t.length;){var o=t[r];++r,i.push(o)}return i},e.dynamics.InteractionGroupList.prototype.zpp_inner=null,Object.defineProperty(e.dynamics.InteractionGroupList.prototype,"length",{get:e.dynamics.InteractionGroupList.prototype.get_length}),e.dynamics.InteractionGroupList.prototype.get_length=function(){return this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.user_length},e.dynamics.InteractionGroupList.prototype.has=function(e){return this.zpp_inner.valmod(),this.zpp_inner.inner.has(e.zpp_inner)},e.dynamics.InteractionGroupList.prototype.at=function(e){var t;if(this.zpp_inner.valmod(),e>=0?(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t=e>=this.zpp_inner.user_length):t=!0,t)throw new n._Boot.HaxeError("Error: Index out of bounds");if(this.zpp_inner.reverse_flag&&(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),e=this.zpp_inner.user_length-1-e),e<this.zpp_inner.at_index||null==this.zpp_inner.at_ite)this.zpp_inner.at_index=e,this.zpp_inner.at_ite=this.zpp_inner.inner.iterator_at(e);else for(;this.zpp_inner.at_index!=e;)this.zpp_inner.at_index++,this.zpp_inner.at_ite=this.zpp_inner.at_ite.next;return this.zpp_inner.at_ite.elt.outer},e.dynamics.InteractionGroupList.prototype.push=function(e){if(this.zpp_inner.immutable)throw new n._Boot.HaxeError("Error: InteractionGroupList is immutable");this.zpp_inner.modify_test(),this.zpp_inner.valmod();var t=null==this.zpp_inner.adder||this.zpp_inner.adder(e);if(t){if(this.zpp_inner.reverse_flag)this.zpp_inner.inner.add(e.zpp_inner);else{if(null==this.zpp_inner.push_ite){var i;if(null==this.zpp_inner.inner.head)i=null;else{var r=this.zpp_inner.inner;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),i=r.iterator_at(this.zpp_inner.user_length-1)}this.zpp_inner.push_ite=i}this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,e.zpp_inner)}this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(e)}return t},e.dynamics.InteractionGroupList.prototype.unshift=function(e){if(this.zpp_inner.immutable)throw new n._Boot.HaxeError("Error: InteractionGroupList is immutable");this.zpp_inner.modify_test(),this.zpp_inner.valmod();var t=null==this.zpp_inner.adder||this.zpp_inner.adder(e);if(t){if(this.zpp_inner.reverse_flag){if(null==this.zpp_inner.push_ite){var i;if(null==this.zpp_inner.inner.head)i=null;else{var r=this.zpp_inner.inner;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),i=r.iterator_at(this.zpp_inner.user_length-1)}this.zpp_inner.push_ite=i}this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,e.zpp_inner)}else this.zpp_inner.inner.add(e.zpp_inner);this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(e)}return t},e.dynamics.InteractionGroupList.prototype.pop=function(){if(this.zpp_inner.immutable)throw new n._Boot.HaxeError("Error: InteractionGroupList is immutable");if(this.zpp_inner.modify_test(),null==this.zpp_inner.inner.head)throw new n._Boot.HaxeError("Error: Cannot remove from empty list");this.zpp_inner.valmod();var e=null;if(this.zpp_inner.reverse_flag){var t=(e=this.zpp_inner.inner.head.elt).outer;null!=this.zpp_inner.subber&&this.zpp_inner.subber(t),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()}else{var i;if(null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null),this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),1==this.zpp_inner.user_length)i=null;else{var r=this.zpp_inner.inner;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),i=r.iterator_at(this.zpp_inner.user_length-2)}var o=(e=null==i?this.zpp_inner.inner.head.elt:i.next.elt).outer;null!=this.zpp_inner.subber&&this.zpp_inner.subber(o),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(i)}return this.zpp_inner.invalidate(),e.outer},e.dynamics.InteractionGroupList.prototype.shift=function(){if(this.zpp_inner.immutable)throw new n._Boot.HaxeError("Error: InteractionGroupList is immutable");if(this.zpp_inner.modify_test(),null==this.zpp_inner.inner.head)throw new n._Boot.HaxeError("Error: Cannot remove from empty list");this.zpp_inner.valmod();var e=null;if(this.zpp_inner.reverse_flag){var t;if(null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null),this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),1==this.zpp_inner.user_length)t=null;else{var i=this.zpp_inner.inner;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t=i.iterator_at(this.zpp_inner.user_length-2)}var r=(e=null==t?this.zpp_inner.inner.head.elt:t.next.elt).outer;null!=this.zpp_inner.subber&&this.zpp_inner.subber(r),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(t)}else{var o=(e=this.zpp_inner.inner.head.elt).outer;null!=this.zpp_inner.subber&&this.zpp_inner.subber(o),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()}return this.zpp_inner.invalidate(),e.outer},e.dynamics.InteractionGroupList.prototype.add=function(e){return this.zpp_inner.reverse_flag?this.push(e):this.unshift(e)},e.dynamics.InteractionGroupList.prototype.remove=function(e){if(this.zpp_inner.immutable)throw new n._Boot.HaxeError("Error: InteractionGroupList is immutable");var t;this.zpp_inner.modify_test(),this.zpp_inner.valmod(),t=!1;for(var i=this.zpp_inner.inner.head;null!=i;){if(i.elt==e.zpp_inner){t=!0;break}i=i.next}return t&&(null!=this.zpp_inner.subber&&this.zpp_inner.subber(e),this.zpp_inner.dontremove||this.zpp_inner.inner.remove(e.zpp_inner),this.zpp_inner.invalidate()),t},e.dynamics.InteractionGroupList.prototype.clear=function(){if(this.zpp_inner.immutable)throw new n._Boot.HaxeError("Error: InteractionGroupList is immutable");if(this.zpp_inner.reverse_flag)for(;null!=this.zpp_inner.inner.head;)this.pop();else for(;null!=this.zpp_inner.inner.head;)this.shift()},e.dynamics.InteractionGroupList.prototype.empty=function(){return null==this.zpp_inner.inner.head},e.dynamics.InteractionGroupList.prototype.iterator=function(){return this.zpp_inner.valmod(),e.dynamics.InteractionGroupIterator.get(this)},e.dynamics.InteractionGroupList.prototype.copy=function(t){null==t&&(t=!1);var i=new e.dynamics.InteractionGroupList;this.zpp_inner.valmod();for(var r=e.dynamics.InteractionGroupIterator.get(this);;){r.zpp_inner.zpp_inner.valmod();var o=r.zpp_inner;o.zpp_inner.valmod(),o.zpp_inner.zip_length&&(o.zpp_inner.zip_length=!1,o.zpp_inner.user_length=o.zpp_inner.inner.length);var a,s=o.zpp_inner.user_length;if(r.zpp_critical=!0,r.zpp_i<s?a=!0:(r.zpp_next=e.dynamics.InteractionGroupIterator.zpp_pool,e.dynamics.InteractionGroupIterator.zpp_pool=r,r.zpp_inner=null,a=!1),!a)break;r.zpp_critical=!1;var l,p=r.zpp_inner.at(r.zpp_i++);if(t)throw new n._Boot.HaxeError("Error: InteractionGroup is not a copyable type");l=p,i.push(l)}return i},e.dynamics.InteractionGroupList.prototype.merge=function(t){if(null==t)throw new n._Boot.HaxeError("Error: Cannot merge with null list");t.zpp_inner.valmod();for(var i=e.dynamics.InteractionGroupIterator.get(t);;){i.zpp_inner.zpp_inner.valmod();var r=i.zpp_inner;r.zpp_inner.valmod(),r.zpp_inner.zip_length&&(r.zpp_inner.zip_length=!1,r.zpp_inner.user_length=r.zpp_inner.inner.length);var o,a=r.zpp_inner.user_length;if(i.zpp_critical=!0,i.zpp_i<a?o=!0:(i.zpp_next=e.dynamics.InteractionGroupIterator.zpp_pool,e.dynamics.InteractionGroupIterator.zpp_pool=i,i.zpp_inner=null,o=!1),!o)break;i.zpp_critical=!1;var s=i.zpp_inner.at(i.zpp_i++);this.has(s)||(this.zpp_inner.reverse_flag?this.push(s):this.unshift(s))}},e.dynamics.InteractionGroupList.prototype.toString=function(){var t="[",n=!0;this.zpp_inner.valmod();for(var i=e.dynamics.InteractionGroupIterator.get(this);;){i.zpp_inner.zpp_inner.valmod();var r=i.zpp_inner;r.zpp_inner.valmod(),r.zpp_inner.zip_length&&(r.zpp_inner.zip_length=!1,r.zpp_inner.user_length=r.zpp_inner.inner.length);var o,a=r.zpp_inner.user_length;if(i.zpp_critical=!0,i.zpp_i<a?o=!0:(i.zpp_next=e.dynamics.InteractionGroupIterator.zpp_pool,e.dynamics.InteractionGroupIterator.zpp_pool=i,i.zpp_inner=null,o=!1),!o)break;i.zpp_critical=!1;var s=i.zpp_inner.at(i.zpp_i++);n||(t+=","),t+=null==s?"NULL":s.toString(),n=!1}return t+"]"},e.dynamics.InteractionGroupList.prototype.foreach=function(t){if(null==t)throw new n._Boot.HaxeError("Error: Cannot execute null on list elements");this.zpp_inner.valmod();for(var i=e.dynamics.InteractionGroupIterator.get(this);;){i.zpp_inner.zpp_inner.valmod();var r=i.zpp_inner;r.zpp_inner.valmod(),r.zpp_inner.zip_length&&(r.zpp_inner.zip_length=!1,r.zpp_inner.user_length=r.zpp_inner.inner.length);var o,a=r.zpp_inner.user_length;if(i.zpp_critical=!0,i.zpp_i<a?o=!0:(i.zpp_next=e.dynamics.InteractionGroupIterator.zpp_pool,e.dynamics.InteractionGroupIterator.zpp_pool=i,i.zpp_inner=null,o=!1),!o)break;try{i.zpp_critical=!1,t(i.zpp_inner.at(i.zpp_i++))}catch(t){t instanceof n._Boot.HaxeError&&t.val,i.zpp_next=e.dynamics.InteractionGroupIterator.zpp_pool,e.dynamics.InteractionGroupIterator.zpp_pool=i,i.zpp_inner=null;break}}return this},e.dynamics.InteractionGroupList.prototype.filter=function(e){if(null==e)throw new n._Boot.HaxeError("Error: Cannot select elements of list with null");for(var t=0;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t<this.zpp_inner.user_length;){var i=this.at(t);try{e(i)?++t:this.remove(i)}catch(e){e instanceof n._Boot.HaxeError&&e.val;break}}return this},e.dynamics.InteractionGroupList.prototype.__class__=e.dynamics.InteractionGroupList,e.geom||(e.geom={}),e.geom.AABB=l["nape.geom.AABB"]=function(e,i,r,o){if(null==o&&(o=0),null==r&&(r=0),null==i&&(i=0),null==e&&(e=0),this.zpp_inner=null,e!=e||i!=i)throw new n._Boot.HaxeError("Error: AABB position cannot be NaN");if(r!=r||o!=o)throw new n._Boot.HaxeError("Error: AABB dimensions cannot be NaN");var a;null==t.geom.ZPP_AABB.zpp_pool?a=new t.geom.ZPP_AABB:(a=t.geom.ZPP_AABB.zpp_pool,t.geom.ZPP_AABB.zpp_pool=a.next,a.next=null),a.minx=e,a.miny=i,a.maxx=e+r,a.maxy=i+o,this.zpp_inner=a,this.zpp_inner.outer=this},e.geom.AABB.__name__=["nape","geom","AABB"],e.geom.AABB.prototype.zpp_inner=null,e.geom.AABB.prototype.copy=function(){var e=this.zpp_inner;null!=e._validate&&e._validate();var n,i=this.zpp_inner,r=i.minx,o=i.miny,a=i.maxx,s=i.maxy;return null==t.geom.ZPP_AABB.zpp_pool?n=new t.geom.ZPP_AABB:(n=t.geom.ZPP_AABB.zpp_pool,t.geom.ZPP_AABB.zpp_pool=n.next,n.next=null),n.minx=r,n.miny=o,n.maxx=a,n.maxy=s,n.wrapper()},Object.defineProperty(e.geom.AABB.prototype,"min",{get:e.geom.AABB.prototype.get_min,set:e.geom.AABB.prototype.set_min}),e.geom.AABB.prototype.get_min=function(){return this.zpp_inner.getmin()},e.geom.AABB.prototype.set_min=function(e){if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");if(this.zpp_inner._immutable)throw new n._Boot.HaxeError("Error: AABB is immutable");if(null==e)throw new n._Boot.HaxeError("Error: Cannot assign null to AABB::min");var i,r=this.zpp_inner;null!=r._validate&&r._validate();var o=this.zpp_inner.minx,a=this.zpp_inner;if(null!=a._validate&&a._validate(),o==this.zpp_inner.minx){var s=this.zpp_inner;null!=s._validate&&s._validate();var l=this.zpp_inner.miny,p=this.zpp_inner;null!=p._validate&&p._validate(),i=l!=this.zpp_inner.miny}else i=!0;if(i)throw new n._Boot.HaxeError("Error: AABB::min components cannot be NaN");if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var u=e.zpp_inner;null!=u._validate&&u._validate();var h=e.zpp_inner.x,c=this.zpp_inner.getmax();if(null!=c&&c.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var _=c.zpp_inner;if(null!=_._validate&&_._validate(),h>c.zpp_inner.x)throw new n._Boot.HaxeError("Error: Assignment would cause negative width");if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var d=e.zpp_inner;null!=d._validate&&d._validate();var m=e.zpp_inner.y,P=this.zpp_inner.getmax();if(null!=P&&P.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var f=P.zpp_inner;if(null!=f._validate&&f._validate(),m>P.zpp_inner.y)throw new n._Boot.HaxeError("Error: Assignment would cause negative height");var x=this.zpp_inner.getmin();if(null!=x&&x.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var y=x.zpp_inner;if(y._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=y._isimmutable&&y._isimmutable(),null==e)throw new n._Boot.HaxeError("Error: Cannot assign null Vec2");if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var v=e.zpp_inner;null!=v._validate&&v._validate();var g=e.zpp_inner.x;if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var b=e.zpp_inner;null!=b._validate&&b._validate();var z=e.zpp_inner.y;if(null!=x&&x.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var w,Z=x.zpp_inner;if(Z._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=Z._isimmutable&&Z._isimmutable(),g!=g||z!=z)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null!=x&&x.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var E=x.zpp_inner;if(null!=E._validate&&E._validate(),x.zpp_inner.x==g){if(null!=x&&x.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var M=x.zpp_inner;null!=M._validate&&M._validate(),w=x.zpp_inner.y==z}else w=!1;if(!w){x.zpp_inner.x=g,x.zpp_inner.y=z;var S=x.zpp_inner;null!=S._invalidate&&S._invalidate(S)}if(e.zpp_inner.weak){if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var C=e.zpp_inner;if(C._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=C._isimmutable&&C._isimmutable(),e.zpp_inner._inuse)throw new n._Boot.HaxeError("Error: This Vec2 is not disposable");var N=e.zpp_inner;e.zpp_inner.outer=null,e.zpp_inner=null;var A=e;A.zpp_pool=null,null!=t.util.ZPP_PubPool.nextVec2?t.util.ZPP_PubPool.nextVec2.zpp_pool=A:t.util.ZPP_PubPool.poolVec2=A,t.util.ZPP_PubPool.nextVec2=A,A.zpp_disp=!0;var L=N;null!=L.outer&&(L.outer.zpp_inner=null,L.outer=null),L._isimmutable=null,L._validate=null,L._invalidate=null,L.next=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=L}return this.zpp_inner.getmin()},Object.defineProperty(e.geom.AABB.prototype,"max",{get:e.geom.AABB.prototype.get_max,set:e.geom.AABB.prototype.set_max}),e.geom.AABB.prototype.get_max=function(){return this.zpp_inner.getmax()},e.geom.AABB.prototype.set_max=function(e){if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");if(this.zpp_inner._immutable)throw new n._Boot.HaxeError("Error: AABB is immutable");if(null==e)throw new n._Boot.HaxeError("Error: Cannot assign null to AABB::max");var i,r=this.zpp_inner;null!=r._validate&&r._validate();var o=this.zpp_inner.minx,a=this.zpp_inner;if(null!=a._validate&&a._validate(),o==this.zpp_inner.minx){var s=this.zpp_inner;null!=s._validate&&s._validate();var l=this.zpp_inner.miny,p=this.zpp_inner;null!=p._validate&&p._validate(),i=l!=this.zpp_inner.miny}else i=!0;if(i)throw new n._Boot.HaxeError("Error: AABB::max components cannot be NaN");if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var u=e.zpp_inner;null!=u._validate&&u._validate();var h=e.zpp_inner.x,c=this.zpp_inner.getmin();if(null!=c&&c.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var _=c.zpp_inner;if(null!=_._validate&&_._validate(),h<c.zpp_inner.x)throw new n._Boot.HaxeError("Error: Assignment would cause negative width");if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var d=e.zpp_inner;null!=d._validate&&d._validate();var m=e.zpp_inner.y,P=this.zpp_inner.getmin();if(null!=P&&P.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var f=P.zpp_inner;if(null!=f._validate&&f._validate(),m<P.zpp_inner.y)throw new n._Boot.HaxeError("Error: Assignment would cause negative height");var x=this.zpp_inner.getmax();if(null!=x&&x.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var y=x.zpp_inner;if(y._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=y._isimmutable&&y._isimmutable(),null==e)throw new n._Boot.HaxeError("Error: Cannot assign null Vec2");if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var v=e.zpp_inner;null!=v._validate&&v._validate();var g=e.zpp_inner.x;if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var b=e.zpp_inner;null!=b._validate&&b._validate();var z=e.zpp_inner.y;if(null!=x&&x.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var w,Z=x.zpp_inner;if(Z._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=Z._isimmutable&&Z._isimmutable(),g!=g||z!=z)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null!=x&&x.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var E=x.zpp_inner;if(null!=E._validate&&E._validate(),x.zpp_inner.x==g){if(null!=x&&x.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var M=x.zpp_inner;null!=M._validate&&M._validate(),w=x.zpp_inner.y==z}else w=!1;if(!w){x.zpp_inner.x=g,x.zpp_inner.y=z;var S=x.zpp_inner;null!=S._invalidate&&S._invalidate(S)}if(e.zpp_inner.weak){if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var C=e.zpp_inner;if(C._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=C._isimmutable&&C._isimmutable(),e.zpp_inner._inuse)throw new n._Boot.HaxeError("Error: This Vec2 is not disposable");var N=e.zpp_inner;e.zpp_inner.outer=null,e.zpp_inner=null;var A=e;A.zpp_pool=null,null!=t.util.ZPP_PubPool.nextVec2?t.util.ZPP_PubPool.nextVec2.zpp_pool=A:t.util.ZPP_PubPool.poolVec2=A,t.util.ZPP_PubPool.nextVec2=A,A.zpp_disp=!0;var L=N;null!=L.outer&&(L.outer.zpp_inner=null,L.outer=null),L._isimmutable=null,L._validate=null,L._invalidate=null,L.next=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=L}return this.zpp_inner.getmax()},Object.defineProperty(e.geom.AABB.prototype,"x",{get:e.geom.AABB.prototype.get_x,set:e.geom.AABB.prototype.set_x}),e.geom.AABB.prototype.get_x=function(){var e=this.zpp_inner;return null!=e._validate&&e._validate(),this.zpp_inner.minx},e.geom.AABB.prototype.set_x=function(e){if(this.zpp_inner._immutable)throw new n._Boot.HaxeError("Error: AABB is immutable");var t=this.zpp_inner;if(null!=t._validate&&t._validate(),this.zpp_inner.minx!=e){if(e!=e)throw new n._Boot.HaxeError("Error: AABB::x cannot be NaN");this.zpp_inner.maxx+=e-this.zpp_inner.minx,this.zpp_inner.minx=e;var i=this.zpp_inner;null!=i._invalidate&&i._invalidate(i)}var r=this.zpp_inner;return null!=r._validate&&r._validate(),this.zpp_inner.minx},Object.defineProperty(e.geom.AABB.prototype,"y",{get:e.geom.AABB.prototype.get_y,set:e.geom.AABB.prototype.set_y}),e.geom.AABB.prototype.get_y=function(){var e=this.zpp_inner;return null!=e._validate&&e._validate(),this.zpp_inner.miny},e.geom.AABB.prototype.set_y=function(e){if(this.zpp_inner._immutable)throw new n._Boot.HaxeError("Error: AABB is immutable");var t=this.zpp_inner;if(null!=t._validate&&t._validate(),this.zpp_inner.miny!=e){if(e!=e)throw new n._Boot.HaxeError("Error: AABB::y cannot be NaN");this.zpp_inner.maxy+=e-this.zpp_inner.miny,this.zpp_inner.miny=e;var i=this.zpp_inner;null!=i._invalidate&&i._invalidate(i)}var r=this.zpp_inner;return null!=r._validate&&r._validate(),this.zpp_inner.miny},Object.defineProperty(e.geom.AABB.prototype,"width",{get:e.geom.AABB.prototype.get_width,set:e.geom.AABB.prototype.set_width}),e.geom.AABB.prototype.get_width=function(){var e=this.zpp_inner;null!=e._validate&&e._validate();var t=this.zpp_inner;return t.maxx-t.minx},e.geom.AABB.prototype.set_width=function(e){if(this.zpp_inner._immutable)throw new n._Boot.HaxeError("Error: AABB is immutable");var t=this.zpp_inner;null!=t._validate&&t._validate();var i=this.zpp_inner;if(i.maxx-i.minx!=e){if(e!=e)throw new n._Boot.HaxeError("Error: AABB::width cannot be NaN");if(e<0)throw new n._Boot.HaxeError("Error: AABB::width ("+e+") must be >= 0");var r=this.zpp_inner;null!=r._validate&&r._validate(),this.zpp_inner.maxx=this.zpp_inner.minx+e;var o=this.zpp_inner;null!=o._invalidate&&o._invalidate(o)}var a=this.zpp_inner;null!=a._validate&&a._validate();var s=this.zpp_inner;return s.maxx-s.minx},Object.defineProperty(e.geom.AABB.prototype,"height",{get:e.geom.AABB.prototype.get_height,set:e.geom.AABB.prototype.set_height}),e.geom.AABB.prototype.get_height=function(){var e=this.zpp_inner;null!=e._validate&&e._validate();var t=this.zpp_inner;return t.maxy-t.miny},e.geom.AABB.prototype.set_height=function(e){if(this.zpp_inner._immutable)throw new n._Boot.HaxeError("Error: AABB is immutable");var t=this.zpp_inner;null!=t._validate&&t._validate();var i=this.zpp_inner;if(i.maxy-i.miny!=e){if(e!=e)throw new n._Boot.HaxeError("Error: AABB::height cannot be NaN");if(e<0)throw new n._Boot.HaxeError("Error: AABB::height ("+e+") must be >= 0");var r=this.zpp_inner;null!=r._validate&&r._validate(),this.zpp_inner.maxy=this.zpp_inner.miny+e;var o=this.zpp_inner;null!=o._invalidate&&o._invalidate(o)}var a=this.zpp_inner;null!=a._validate&&a._validate();var s=this.zpp_inner;return s.maxy-s.miny},e.geom.AABB.prototype.toString=function(){var e=this.zpp_inner;return null!=e._validate&&e._validate(),this.zpp_inner.toString()},e.geom.AABB.prototype.__class__=e.geom.AABB,e.geom.ConvexResult=l["nape.geom.ConvexResult"]=function(){if(this.zpp_inner=null,!t.geom.ZPP_ConvexRayResult.internal)throw new n._Boot.HaxeError("Error: ConvexResult cannot be instantiated derp!")},e.geom.ConvexResult.__name__=["nape","geom","ConvexResult"],e.geom.ConvexResult.prototype.zpp_inner=null,Object.defineProperty(e.geom.ConvexResult.prototype,"normal",{get:e.geom.ConvexResult.prototype.get_normal}),e.geom.ConvexResult.prototype.get_normal=function(){if(null!=this.zpp_inner.next)throw new n._Boot.HaxeError("Error: This object has been disposed of and cannot be used");return this.zpp_inner.normal},Object.defineProperty(e.geom.ConvexResult.prototype,"position",{get:e.geom.ConvexResult.prototype.get_position}),e.geom.ConvexResult.prototype.get_position=function(){if(null!=this.zpp_inner.next)throw new n._Boot.HaxeError("Error: This object has been disposed of and cannot be used");return this.zpp_inner.position},Object.defineProperty(e.geom.ConvexResult.prototype,"toi",{get:e.geom.ConvexResult.prototype.get_toi}),e.geom.ConvexResult.prototype.get_toi=function(){if(null!=this.zpp_inner.next)throw new n._Boot.HaxeError("Error: This object has been disposed of and cannot be used");return this.zpp_inner.toiDistance},Object.defineProperty(e.geom.ConvexResult.prototype,"shape",{get:e.geom.ConvexResult.prototype.get_shape}),e.geom.ConvexResult.prototype.get_shape=function(){if(null!=this.zpp_inner.next)throw new n._Boot.HaxeError("Error: This object has been disposed of and cannot be used");return this.zpp_inner.shape},e.geom.ConvexResult.prototype.dispose=function(){if(null!=this.zpp_inner.next)throw new n._Boot.HaxeError("Error: This object has been disposed of and cannot be used");this.zpp_inner.free()},e.geom.ConvexResult.prototype.toString=function(){if(null!=this.zpp_inner.next)throw new n._Boot.HaxeError("Error: This object has been disposed of and cannot be used");if(null!=this.zpp_inner.next)throw new n._Boot.HaxeError("Error: This object has been disposed of and cannot be used");if(null!=this.zpp_inner.next)throw new n._Boot.HaxeError("Error: This object has been disposed of and cannot be used");return"{ shape: "+i.string(this.zpp_inner.shape)+" toi: "+this.zpp_inner.toiDistance+" }"},e.geom.ConvexResult.prototype.__class__=e.geom.ConvexResult,e.geom.ConvexResultIterator=l["nape.geom.ConvexResultIterator"]=function(){if(this.zpp_next=null,this.zpp_critical=!1,this.zpp_i=0,this.zpp_inner=null,!t.util.ZPP_ConvexResultList.internal)throw new n._Boot.HaxeError("Error: Cannot instantiate ConvexResultIterator derp!")},e.geom.ConvexResultIterator.__name__=["nape","geom","ConvexResultIterator"],e.geom.ConvexResultIterator.get=function(n){var i;if(null==e.geom.ConvexResultIterator.zpp_pool){t.util.ZPP_ConvexResultList.internal=!0;var r=new e.geom.ConvexResultIterator;t.util.ZPP_ConvexResultList.internal=!1,i=r}else{var o=e.geom.ConvexResultIterator.zpp_pool;e.geom.ConvexResultIterator.zpp_pool=o.zpp_next,i=o}return i.zpp_i=0,i.zpp_inner=n,i.zpp_critical=!1,i},e.geom.ConvexResultIterator.prototype.zpp_inner=null,e.geom.ConvexResultIterator.prototype.zpp_i=null,e.geom.ConvexResultIterator.prototype.zpp_critical=null,e.geom.ConvexResultIterator.prototype.zpp_next=null,e.geom.ConvexResultIterator.prototype.hasNext=function(){this.zpp_inner.zpp_inner.valmod();var t=this.zpp_inner;t.zpp_inner.valmod(),t.zpp_inner.zip_length&&(t.zpp_inner.zip_length=!1,t.zpp_inner.user_length=t.zpp_inner.inner.length);var n=t.zpp_inner.user_length;return this.zpp_critical=!0,this.zpp_i<n||(this.zpp_next=e.geom.ConvexResultIterator.zpp_pool,e.geom.ConvexResultIterator.zpp_pool=this,this.zpp_inner=null,!1)},e.geom.ConvexResultIterator.prototype.next=function(){return this.zpp_critical=!1,this.zpp_inner.at(this.zpp_i++)},e.geom.ConvexResultIterator.prototype.__class__=e.geom.ConvexResultIterator,e.geom.ConvexResultList=l["nape.geom.ConvexResultList"]=function(){this.zpp_inner=null,this.zpp_inner=new t.util.ZPP_ConvexResultList,this.zpp_inner.outer=this},e.geom.ConvexResultList.__name__=["nape","geom","ConvexResultList"],e.geom.ConvexResultList.fromArray=function(t){if(null==t)throw new n._Boot.HaxeError("Error: Cannot convert null Array to Nape list");for(var i=new e.geom.ConvexResultList,r=0;r<t.length;){var o=t[r];++r,i.push(o)}return i},e.geom.ConvexResultList.prototype.zpp_inner=null,Object.defineProperty(e.geom.ConvexResultList.prototype,"length",{get:e.geom.ConvexResultList.prototype.get_length}),e.geom.ConvexResultList.prototype.get_length=function(){return this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.user_length},e.geom.ConvexResultList.prototype.has=function(e){return this.zpp_inner.valmod(),this.zpp_inner.inner.has(e)},e.geom.ConvexResultList.prototype.at=function(e){var t;if(this.zpp_inner.valmod(),e>=0?(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t=e>=this.zpp_inner.user_length):t=!0,t)throw new n._Boot.HaxeError("Error: Index out of bounds");if(this.zpp_inner.reverse_flag&&(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),e=this.zpp_inner.user_length-1-e),e<this.zpp_inner.at_index||null==this.zpp_inner.at_ite)this.zpp_inner.at_index=e,this.zpp_inner.at_ite=this.zpp_inner.inner.iterator_at(e);else for(;this.zpp_inner.at_index!=e;)this.zpp_inner.at_index++,this.zpp_inner.at_ite=this.zpp_inner.at_ite.next;return this.zpp_inner.at_ite.elt},e.geom.ConvexResultList.prototype.push=function(e){if(this.zpp_inner.immutable)throw new n._Boot.HaxeError("Error: ConvexResultList is immutable");this.zpp_inner.modify_test(),this.zpp_inner.valmod();var t=null==this.zpp_inner.adder||this.zpp_inner.adder(e);if(t){if(this.zpp_inner.reverse_flag)this.zpp_inner.inner.add(e);else{if(null==this.zpp_inner.push_ite){var i;if(null==this.zpp_inner.inner.head)i=null;else{var r=this.zpp_inner.inner;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),i=r.iterator_at(this.zpp_inner.user_length-1)}this.zpp_inner.push_ite=i}this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,e)}this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(e)}return t},e.geom.ConvexResultList.prototype.unshift=function(e){if(this.zpp_inner.immutable)throw new n._Boot.HaxeError("Error: ConvexResultList is immutable");this.zpp_inner.modify_test(),this.zpp_inner.valmod();var t=null==this.zpp_inner.adder||this.zpp_inner.adder(e);if(t){if(this.zpp_inner.reverse_flag){if(null==this.zpp_inner.push_ite){var i;if(null==this.zpp_inner.inner.head)i=null;else{var r=this.zpp_inner.inner;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),i=r.iterator_at(this.zpp_inner.user_length-1)}this.zpp_inner.push_ite=i}this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,e)}else this.zpp_inner.inner.add(e);this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(e)}return t},e.geom.ConvexResultList.prototype.pop=function(){if(this.zpp_inner.immutable)throw new n._Boot.HaxeError("Error: ConvexResultList is immutable");if(this.zpp_inner.modify_test(),null==this.zpp_inner.inner.head)throw new n._Boot.HaxeError("Error: Cannot remove from empty list");this.zpp_inner.valmod();var e=null;if(this.zpp_inner.reverse_flag){var t=e=this.zpp_inner.inner.head.elt;null!=this.zpp_inner.subber&&this.zpp_inner.subber(t),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()}else{var i;if(null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null),this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),1==this.zpp_inner.user_length)i=null;else{var r=this.zpp_inner.inner;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),i=r.iterator_at(this.zpp_inner.user_length-2)}var o=e=null==i?this.zpp_inner.inner.head.elt:i.next.elt;null!=this.zpp_inner.subber&&this.zpp_inner.subber(o),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(i)}return this.zpp_inner.invalidate(),e},e.geom.ConvexResultList.prototype.shift=function(){if(this.zpp_inner.immutable)throw new n._Boot.HaxeError("Error: ConvexResultList is immutable");if(this.zpp_inner.modify_test(),null==this.zpp_inner.inner.head)throw new n._Boot.HaxeError("Error: Cannot remove from empty list");this.zpp_inner.valmod();var e=null;if(this.zpp_inner.reverse_flag){var t;if(null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null),this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),1==this.zpp_inner.user_length)t=null;else{var i=this.zpp_inner.inner;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t=i.iterator_at(this.zpp_inner.user_length-2)}var r=e=null==t?this.zpp_inner.inner.head.elt:t.next.elt;null!=this.zpp_inner.subber&&this.zpp_inner.subber(r),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(t)}else{var o=e=this.zpp_inner.inner.head.elt;null!=this.zpp_inner.subber&&this.zpp_inner.subber(o),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()}return this.zpp_inner.invalidate(),e},e.geom.ConvexResultList.prototype.add=function(e){return this.zpp_inner.reverse_flag?this.push(e):this.unshift(e)},e.geom.ConvexResultList.prototype.remove=function(e){if(this.zpp_inner.immutable)throw new n._Boot.HaxeError("Error: ConvexResultList is immutable");var t;this.zpp_inner.modify_test(),this.zpp_inner.valmod(),t=!1;for(var i=this.zpp_inner.inner.head;null!=i;){if(i.elt==e){t=!0;break}i=i.next}return t&&(null!=this.zpp_inner.subber&&this.zpp_inner.subber(e),this.zpp_inner.dontremove||this.zpp_inner.inner.remove(e),this.zpp_inner.invalidate()),t},e.geom.ConvexResultList.prototype.clear=function(){if(this.zpp_inner.immutable)throw new n._Boot.HaxeError("Error: ConvexResultList is immutable");if(this.zpp_inner.reverse_flag)for(;null!=this.zpp_inner.inner.head;)this.pop();else for(;null!=this.zpp_inner.inner.head;)this.shift()},e.geom.ConvexResultList.prototype.empty=function(){return null==this.zpp_inner.inner.head},e.geom.ConvexResultList.prototype.iterator=function(){return this.zpp_inner.valmod(),e.geom.ConvexResultIterator.get(this)},e.geom.ConvexResultList.prototype.copy=function(t){null==t&&(t=!1);var i=new e.geom.ConvexResultList;this.zpp_inner.valmod();for(var r=e.geom.ConvexResultIterator.get(this);;){r.zpp_inner.zpp_inner.valmod();var o=r.zpp_inner;o.zpp_inner.valmod(),o.zpp_inner.zip_length&&(o.zpp_inner.zip_length=!1,o.zpp_inner.user_length=o.zpp_inner.inner.length);var a,s=o.zpp_inner.user_length;if(r.zpp_critical=!0,r.zpp_i<s?a=!0:(r.zpp_next=e.geom.ConvexResultIterator.zpp_pool,e.geom.ConvexResultIterator.zpp_pool=r,r.zpp_inner=null,a=!1),!a)break;r.zpp_critical=!1;var l,p=r.zpp_inner.at(r.zpp_i++);if(t)throw new n._Boot.HaxeError("Error: ConvexResult is not a copyable type");l=p,i.push(l)}return i},e.geom.ConvexResultList.prototype.merge=function(t){if(null==t)throw new n._Boot.HaxeError("Error: Cannot merge with null list");t.zpp_inner.valmod();for(var i=e.geom.ConvexResultIterator.get(t);;){i.zpp_inner.zpp_inner.valmod();var r=i.zpp_inner;r.zpp_inner.valmod(),r.zpp_inner.zip_length&&(r.zpp_inner.zip_length=!1,r.zpp_inner.user_length=r.zpp_inner.inner.length);var o,a=r.zpp_inner.user_length;if(i.zpp_critical=!0,i.zpp_i<a?o=!0:(i.zpp_next=e.geom.ConvexResultIterator.zpp_pool,e.geom.ConvexResultIterator.zpp_pool=i,i.zpp_inner=null,o=!1),!o)break;i.zpp_critical=!1;var s=i.zpp_inner.at(i.zpp_i++);this.has(s)||(this.zpp_inner.reverse_flag?this.push(s):this.unshift(s))}},e.geom.ConvexResultList.prototype.toString=function(){var t="[",n=!0;this.zpp_inner.valmod();for(var i=e.geom.ConvexResultIterator.get(this);;){i.zpp_inner.zpp_inner.valmod();var r=i.zpp_inner;r.zpp_inner.valmod(),r.zpp_inner.zip_length&&(r.zpp_inner.zip_length=!1,r.zpp_inner.user_length=r.zpp_inner.inner.length);var o,a=r.zpp_inner.user_length;if(i.zpp_critical=!0,i.zpp_i<a?o=!0:(i.zpp_next=e.geom.ConvexResultIterator.zpp_pool,e.geom.ConvexResultIterator.zpp_pool=i,i.zpp_inner=null,o=!1),!o)break;i.zpp_critical=!1;var s=i.zpp_inner.at(i.zpp_i++);n||(t+=","),t+=null==s?"NULL":s.toString(),n=!1}return t+"]"},e.geom.ConvexResultList.prototype.foreach=function(t){if(null==t)throw new n._Boot.HaxeError("Error: Cannot execute null on list elements");this.zpp_inner.valmod();for(var i=e.geom.ConvexResultIterator.get(this);;){i.zpp_inner.zpp_inner.valmod();var r=i.zpp_inner;r.zpp_inner.valmod(),r.zpp_inner.zip_length&&(r.zpp_inner.zip_length=!1,r.zpp_inner.user_length=r.zpp_inner.inner.length);var o,a=r.zpp_inner.user_length;if(i.zpp_critical=!0,i.zpp_i<a?o=!0:(i.zpp_next=e.geom.ConvexResultIterator.zpp_pool,e.geom.ConvexResultIterator.zpp_pool=i,i.zpp_inner=null,o=!1),!o)break;try{i.zpp_critical=!1,t(i.zpp_inner.at(i.zpp_i++))}catch(t){t instanceof n._Boot.HaxeError&&t.val,i.zpp_next=e.geom.ConvexResultIterator.zpp_pool,e.geom.ConvexResultIterator.zpp_pool=i,i.zpp_inner=null;break}}return this},e.geom.ConvexResultList.prototype.filter=function(e){if(null==e)throw new n._Boot.HaxeError("Error: Cannot select elements of list with null");for(var t=0;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t<this.zpp_inner.user_length;){var i=this.at(t);try{e(i)?++t:this.remove(i)}catch(e){e instanceof n._Boot.HaxeError&&e.val;break}}return this},e.geom.ConvexResultList.prototype.__class__=e.geom.ConvexResultList,e.geom.Geom=l["nape.geom.Geom"]=function(){},e.geom.Geom.__name__=["nape","geom","Geom"],e.geom.Geom.distanceBody=function(e,i,r,o){if(null!=r&&r.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");if(null!=o&&o.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var a=r.zpp_inner;if(a._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");null!=a._isimmutable&&a._isimmutable();var s=o.zpp_inner;if(s._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=s._isimmutable&&s._isimmutable(),null==e.zpp_inner.wrap_shapes.zpp_inner.inner.head||null==i.zpp_inner.wrap_shapes.zpp_inner.inner.head)throw new n._Boot.HaxeError("Error: Bodies cannot be empty in calculating distances");for(var l=e.zpp_inner.shapes.head;null!=l;){var p=l.elt;t.geom.ZPP_Geom.validateShape(p),l=l.next}for(var u=i.zpp_inner.shapes.head;null!=u;){var h=u.elt;t.geom.ZPP_Geom.validateShape(h),u=u.next}return t.geom.ZPP_SweepDistance.distanceBody(e.zpp_inner,i.zpp_inner,r.zpp_inner,o.zpp_inner)},e.geom.Geom.distance=function(i,r,o,a){if(null!=o&&o.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");if(null!=a&&a.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var s=o.zpp_inner;if(s._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");null!=s._isimmutable&&s._isimmutable();var l,p=a.zpp_inner;if(p._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=p._isimmutable&&p._isimmutable(),null==(null!=i.zpp_inner.body?i.zpp_inner.body.outer:null)||null==(null!=r.zpp_inner.body?r.zpp_inner.body.outer:null))throw new n._Boot.HaxeError("Error: Shape must be part of a Body to calculate distances");t.geom.ZPP_Geom.validateShape(i.zpp_inner),t.geom.ZPP_Geom.validateShape(r.zpp_inner),null==t.geom.ZPP_Vec2.zpp_pool?l=new t.geom.ZPP_Vec2:(l=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=l.next,l.next=null),l.weak=!1;var u,h=i.zpp_inner,c=r.zpp_inner,_=o.zpp_inner,d=a.zpp_inner,m=1e100;if(0==h.type&&0==c.type){var P,f=h.circle,x=c.circle,y=0,v=0;y=x.worldCOMx-f.worldCOMx,v=x.worldCOMy-f.worldCOMy;var g=Math.sqrt(y*y+v*v);if((P=g-(f.radius+x.radius))<m){if(0==g)y=1,v=0;else{var b=1/g;y*=b,v*=b}var z=f.radius;_.x=f.worldCOMx+y*z,_.y=f.worldCOMy+v*z;var w=-x.radius;d.x=x.worldCOMx+y*w,d.y=x.worldCOMy+v*w,l.x=y,l.y=v}u=P}else{var Z=!1;if(0==h.type&&1==c.type){var E=h;h=c,c=E;var M=_;_=d,d=M,Z=!0}if(1==h.type&&0==c.type){for(var S=h.polygon,C=c.circle,N=-1e100,A=null,L=S.edges.head;null!=L;){var B=L.elt,T=B.gnormx*C.worldCOMx+B.gnormy*C.worldCOMy-B.gprojection-C.radius;if(T>m){N=T;break}T>0?T>N&&(N=T,A=B):N<0&&T>N&&(N=T,A=B),L=L.next}if(N<m){var V=A.gp0,k=A.gp1,I=C.worldCOMy*A.gnormx-C.worldCOMx*A.gnormy;if(I<=V.y*A.gnormx-V.x*A.gnormy){var O=0,R=0;O=C.worldCOMx-V.x,R=C.worldCOMy-V.y;var H=Math.sqrt(O*O+R*R);if((N=H-C.radius)<m){if(0==H)O=1,R=0;else{var F=1/H;O*=F,R*=F}_.x=V.x+0*O,_.y=V.y+0*R;var D=-C.radius;d.x=C.worldCOMx+O*D,d.y=C.worldCOMy+R*D,l.x=O,l.y=R}}else if(I>=k.y*A.gnormx-k.x*A.gnormy){var G=0,U=0;G=C.worldCOMx-k.x,U=C.worldCOMy-k.y;var j=Math.sqrt(G*G+U*U);if((N=j-C.radius)<m){if(0==j)G=1,U=0;else{var W=1/j;G*=W,U*=W}_.x=k.x+0*G,_.y=k.y+0*U;var q=-C.radius;d.x=C.worldCOMx+G*q,d.y=C.worldCOMy+U*q,l.x=G,l.y=U}}else{var J=-C.radius;d.x=C.worldCOMx+A.gnormx*J,d.y=C.worldCOMy+A.gnormy*J;var $=-N;_.x=d.x+A.gnormx*$,_.y=d.y+A.gnormy*$,l.x=A.gnormx,l.y=A.gnormy}}Z&&(l.x=-l.x,l.y=-l.y),u=N}else{for(var X=h.polygon,Y=c.polygon,K=-1e100,Q=null,ee=null,te=0,ne=X.edges.head;null!=ne;){for(var ie=ne.elt,re=1e100,oe=Y.gverts.next;null!=oe;){var ae=oe,se=ie.gnormx*ae.x+ie.gnormy*ae.y;se<re&&(re=se),oe=oe.next}if((re-=ie.gprojection)>m){K=re;break}re>0?re>K&&(K=re,Q=ie,te=1):K<0&&re>K&&(K=re,Q=ie,te=1),ne=ne.next}if(K<m){for(var le=Y.edges.head;null!=le;){for(var pe=le.elt,ue=1e100,he=X.gverts.next;null!=he;){var ce=he,_e=pe.gnormx*ce.x+pe.gnormy*ce.y;_e<ue&&(ue=_e),he=he.next}if((ue-=pe.gprojection)>m){K=ue;break}ue>0?ue>K&&(K=ue,ee=pe,te=2):K<0&&ue>K&&(K=ue,ee=pe,te=2),le=le.next}if(K<m){var de,me;if(1==te)de=Y,me=Q;else{de=X,me=ee;var Pe=_;_=d,d=Pe,Z=!Z}for(var fe=null,xe=1e100,ye=de.edges.head;null!=ye;){var ve=ye.elt,ge=me.gnormx*ve.gnormx+me.gnormy*ve.gnormy;ge<xe&&(xe=ge,fe=ve),ye=ye.next}if(Z?(l.x=-me.gnormx,l.y=-me.gnormy):(l.x=me.gnormx,l.y=me.gnormy),K>=0){var be,ze,we,Ze,Ee=me.gp0,Me=me.gp1,Se=fe.gp0,Ce=fe.gp1,Ne=1/((be=Me.x-Ee.x)*be+(ze=Me.y-Ee.y)*ze),Ae=1/((we=Ce.x-Se.x)*we+(Ze=Ce.y-Se.y)*Ze),Le=-(be*(Ee.x-Se.x)+ze*(Ee.y-Se.y))*Ne,Be=-(be*(Ee.x-Ce.x)+ze*(Ee.y-Ce.y))*Ne,Te=-(we*(Se.x-Ee.x)+Ze*(Se.y-Ee.y))*Ae,Ve=-(we*(Se.x-Me.x)+Ze*(Se.y-Me.y))*Ae;Le<0?Le=0:Le>1&&(Le=1),Be<0?Be=0:Be>1&&(Be=1),Te<0?Te=0:Te>1&&(Te=1),Ve<0?Ve=0:Ve>1&&(Ve=1);var ke,Ie,Oe=Le;ke=Ee.x+be*Oe,Ie=Ee.y+ze*Oe;var Re,He,Fe=Be;Re=Ee.x+be*Fe,He=Ee.y+ze*Fe;var De,Ge,Ue=Te;De=Se.x+we*Ue,Ge=Se.y+Ze*Ue;var je,We,qe=Ve;je=Se.x+we*qe,We=Se.y+Ze*qe;var Je,$e,Xe,Ye,Ke,Qe,et,tt,nt=(Je=ke-Se.x)*Je+($e=Ie-Se.y)*$e,it=(Xe=Re-Ce.x)*Xe+(Ye=He-Ce.y)*Ye,rt=(Ke=De-Ee.x)*Ke+(Qe=Ge-Ee.y)*Qe,ot=(et=je-Me.x)*et+(tt=We-Me.y)*tt,at=0,st=0,lt=null;nt<it?(at=ke,st=Ie,lt=Se):(at=Re,st=He,lt=Ce,nt=it);var pt=0,ut=0,ht=null;if(rt<ot?(pt=De,ut=Ge,ht=Ee):(pt=je,ut=We,ht=Me,rt=ot),nt<rt?(_.x=at,_.y=st,d.x=lt.x,d.y=lt.y,K=Math.sqrt(nt)):(d.x=pt,d.y=ut,_.x=ht.x,_.y=ht.y,K=Math.sqrt(rt)),0!=K){l.x=d.x-_.x,l.y=d.y-_.y;var ct=1/K;l.x*=ct,l.y*=ct,Z&&(l.x=-l.x,l.y=-l.y)}u=K}else{var _t=0,dt=0;_t=fe.gp0.x,dt=fe.gp0.y;var mt,Pt,ft=0,xt=0;mt=(ft=fe.gp1.x)-_t,Pt=(xt=fe.gp1.y)-dt;var yt=me.gnormy*_t-me.gnormx*dt,vt=me.gnormy*ft-me.gnormx*xt,gt=1/(vt-yt),bt=(-me.tp1-yt)*gt;bt>e.Config.epsilon&&(_t+=mt*bt,dt+=Pt*bt);var zt=(-me.tp0-vt)*gt;zt<-e.Config.epsilon&&(ft+=mt*zt,xt+=Pt*zt);var wt=_t*me.gnormx+dt*me.gnormy-me.gprojection,Zt=ft*me.gnormx+xt*me.gnormy-me.gprojection;if(wt<Zt){d.x=_t,d.y=dt;var Et=-wt;_.x=d.x+me.gnormx*Et,_.y=d.y+me.gnormy*Et,u=wt}else{d.x=ft,d.y=xt;var Mt=-Zt;_.x=d.x+me.gnormx*Mt,_.y=d.y+me.gnormy*Mt,u=Zt}}}else u=m}else u=m}}var St=l;return null!=St.outer&&(St.outer.zpp_inner=null,St.outer=null),St._isimmutable=null,St._validate=null,St._invalidate=null,St.next=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=St,u},e.geom.Geom.intersectsBody=function(e,i){if(null==e.zpp_inner.wrap_shapes.zpp_inner.inner.head||null==i.zpp_inner.wrap_shapes.zpp_inner.inner.head)throw new n._Boot.HaxeError("Error: Bodies must have shapes to test for intersection.");for(var r=e.zpp_inner.shapes.head;null!=r;){var o=r.elt;t.geom.ZPP_Geom.validateShape(o),r=r.next}for(var a=i.zpp_inner.shapes.head;null!=a;){var s=a.elt;t.geom.ZPP_Geom.validateShape(s),a=a.next}var l=e.zpp_inner.aabb,p=i.zpp_inner.aabb;if(p.miny<=l.maxy&&l.miny<=p.maxy&&p.minx<=l.maxx&&l.minx<=p.maxx){for(var u=e.zpp_inner.shapes.head;null!=u;){for(var h=u.elt,c=i.zpp_inner.shapes.head;null!=c;){var _=c.elt;if(t.geom.ZPP_Collide.testCollide_safe(h,_))return!0;c=c.next}u=u.next}return!1}return!1},e.geom.Geom.intersects=function(e,i){if(null==(null!=e.zpp_inner.body?e.zpp_inner.body.outer:null)||null==(null!=i.zpp_inner.body?i.zpp_inner.body.outer:null))throw new n._Boot.HaxeError("Error: Shape must be part of a Body to calculate intersection");t.geom.ZPP_Geom.validateShape(e.zpp_inner),t.geom.ZPP_Geom.validateShape(i.zpp_inner);var r=e.zpp_inner.aabb,o=i.zpp_inner.aabb;return o.miny<=r.maxy&&r.miny<=o.maxy&&o.minx<=r.maxx&&r.minx<=o.maxx&&t.geom.ZPP_Collide.testCollide_safe(e.zpp_inner,i.zpp_inner)},e.geom.Geom.contains=function(e,i){if(null==(null!=e.zpp_inner.body?e.zpp_inner.body.outer:null)||null==(null!=i.zpp_inner.body?i.zpp_inner.body.outer:null))throw new n._Boot.HaxeError("Error: Shape must be part of a Body to calculate containment");return t.geom.ZPP_Geom.validateShape(e.zpp_inner),t.geom.ZPP_Geom.validateShape(i.zpp_inner),t.geom.ZPP_Collide.containTest(e.zpp_inner,i.zpp_inner)},e.geom.Geom.prototype.__class__=e.geom.Geom,e.geom.GeomPoly=l["nape.geom.GeomPoly"]=function(i){if(this.zpp_inner=null,this.zpp_pool=null,this.zpp_inner=new t.geom.ZPP_GeomPoly(this),null!=i){if(i instanceof Array)for(var r=i,o=0;o<r.length;){var a=r[o];if(++o,null==a)throw new n._Boot.HaxeError("Error: Array<Vec2> contains null objects");if(!(a instanceof e.geom.Vec2))throw new n._Boot.HaxeError("Error: Array<Vec2> contains non Vec2 objects");var s=a;if(null!=s&&s.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");if(null!=s&&s.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var l=s.zpp_inner;null!=l._validate&&l._validate();var p=s.zpp_inner.x;if(null!=s&&s.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var u=s.zpp_inner;null!=u._validate&&u._validate();var h,c=s.zpp_inner.y;null==t.geom.ZPP_GeomVert.zpp_pool?h=new t.geom.ZPP_GeomVert:(h=t.geom.ZPP_GeomVert.zpp_pool,t.geom.ZPP_GeomVert.zpp_pool=h.next,h.next=null),h.forced=!1,h.x=p,h.y=c;var _=h;null==this.zpp_inner.vertices?this.zpp_inner.vertices=_.prev=_.next=_:(_.prev=this.zpp_inner.vertices,_.next=this.zpp_inner.vertices.next,this.zpp_inner.vertices.next.prev=_,this.zpp_inner.vertices.next=_),this.zpp_inner.vertices=_}else if(i instanceof e.geom.Vec2List)for(var d=i.iterator();;){d.zpp_inner.zpp_inner.valmod();var m,P=d.zpp_inner.zpp_gl();if(d.zpp_critical=!0,d.zpp_i<P?m=!0:(d.zpp_next=e.geom.Vec2Iterator.zpp_pool,e.geom.Vec2Iterator.zpp_pool=d,d.zpp_inner=null,m=!1),!m)break;d.zpp_critical=!1;var f=d.zpp_inner.at(d.zpp_i++);if(null==f)throw new n._Boot.HaxeError("Error: Vec2List contains null objects");if(null!=f&&f.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");if(null!=f&&f.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var x=f.zpp_inner;null!=x._validate&&x._validate();var y=f.zpp_inner.x;if(null!=f&&f.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var v=f.zpp_inner;null!=v._validate&&v._validate();var g,b=f.zpp_inner.y;null==t.geom.ZPP_GeomVert.zpp_pool?g=new t.geom.ZPP_GeomVert:(g=t.geom.ZPP_GeomVert.zpp_pool,t.geom.ZPP_GeomVert.zpp_pool=g.next,g.next=null),g.forced=!1,g.x=y,g.y=b;var z=g;null==this.zpp_inner.vertices?this.zpp_inner.vertices=z.prev=z.next=z:(z.prev=this.zpp_inner.vertices,z.next=this.zpp_inner.vertices.next,this.zpp_inner.vertices.next.prev=z,this.zpp_inner.vertices.next=z),this.zpp_inner.vertices=z}else{if(!(i instanceof e.geom.GeomPoly))throw new n._Boot.HaxeError("Error: Invalid type for polygon object, should be Array<Vec2>, Vec2List, GeomPoly or for flash10+ flash.Vector<Vec2>");var w=i;if(null!=w&&w.zpp_disp)throw new n._Boot.HaxeError("Error: GeomPoly has been disposed and cannot be used!");var Z=w.zpp_inner.vertices;if(null!=Z)for(var E=Z;;){var M,S=E.x,C=E.y;if(null==C&&(C=0),null==S&&(S=0),S!=S||C!=C)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null==t.util.ZPP_PubPool.poolVec2?M=new e.geom.Vec2:(M=t.util.ZPP_PubPool.poolVec2,t.util.ZPP_PubPool.poolVec2=M.zpp_pool,M.zpp_pool=null,M.zpp_disp=!1,M==t.util.ZPP_PubPool.nextVec2&&(t.util.ZPP_PubPool.nextVec2=null)),null==M.zpp_inner){var N;null==t.geom.ZPP_Vec2.zpp_pool?N=new t.geom.ZPP_Vec2:(N=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=N.next,N.next=null),N.weak=!1,N._immutable=!1,N.x=S,N.y=C,M.zpp_inner=N,M.zpp_inner.outer=M}else{if(null!=M&&M.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var A,L=M.zpp_inner;if(L._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=L._isimmutable&&L._isimmutable(),S!=S||C!=C)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null!=M&&M.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var B=M.zpp_inner;if(null!=B._validate&&B._validate(),M.zpp_inner.x==S){if(null!=M&&M.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var T=M.zpp_inner;null!=T._validate&&T._validate(),A=M.zpp_inner.y==C}else A=!1;if(!A){M.zpp_inner.x=S,M.zpp_inner.y=C;var V=M.zpp_inner;null!=V._invalidate&&V._invalidate(V)}}M.zpp_inner.weak=!1;var k=M;if(E=E.next,null!=k&&k.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var I=k.zpp_inner;null!=I._validate&&I._validate();var O=k.zpp_inner.x;if(null!=k&&k.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var R=k.zpp_inner;null!=R._validate&&R._validate();var H,F=k.zpp_inner.y;null==t.geom.ZPP_GeomVert.zpp_pool?H=new t.geom.ZPP_GeomVert:(H=t.geom.ZPP_GeomVert.zpp_pool,t.geom.ZPP_GeomVert.zpp_pool=H.next,H.next=null),H.forced=!1,H.x=O,H.y=F;var D=H;if(null==this.zpp_inner.vertices?this.zpp_inner.vertices=D.prev=D.next=D:(D.prev=this.zpp_inner.vertices,D.next=this.zpp_inner.vertices.next,this.zpp_inner.vertices.next.prev=D,this.zpp_inner.vertices.next=D),this.zpp_inner.vertices=D,null!=k&&k.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var G=k.zpp_inner;if(G._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=G._isimmutable&&G._isimmutable(),k.zpp_inner._inuse)throw new n._Boot.HaxeError("Error: This Vec2 is not disposable");var U=k.zpp_inner;k.zpp_inner.outer=null,k.zpp_inner=null;var j=k;j.zpp_pool=null,null!=t.util.ZPP_PubPool.nextVec2?t.util.ZPP_PubPool.nextVec2.zpp_pool=j:t.util.ZPP_PubPool.poolVec2=j,t.util.ZPP_PubPool.nextVec2=j,j.zpp_disp=!0;var W=U;if(null!=W.outer&&(W.outer.zpp_inner=null,W.outer=null),W._isimmutable=null,W._validate=null,W._invalidate=null,W.next=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=W,E==Z)break}}if(this.skipForward(1),i instanceof Array)for(var q=i,J=0;J<q.length;){var $,X=q[J];if(X.zpp_inner.weak){if(null!=X&&X.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var Y=X.zpp_inner;if(Y._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=Y._isimmutable&&Y._isimmutable(),X.zpp_inner._inuse)throw new n._Boot.HaxeError("Error: This Vec2 is not disposable");var K=X.zpp_inner;X.zpp_inner.outer=null,X.zpp_inner=null;var Q=X;Q.zpp_pool=null,null!=t.util.ZPP_PubPool.nextVec2?t.util.ZPP_PubPool.nextVec2.zpp_pool=Q:t.util.ZPP_PubPool.poolVec2=Q,t.util.ZPP_PubPool.nextVec2=Q,Q.zpp_disp=!0;var ee=K;null!=ee.outer&&(ee.outer.zpp_inner=null,ee.outer=null),ee._isimmutable=null,ee._validate=null,ee._invalidate=null,ee.next=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=ee,$=!0}else $=!1;$?q.splice(J,1):++J}else if(i instanceof e.geom.Vec2List){var te=i;null!=te.zpp_inner._validate&&te.zpp_inner._validate();for(var ne=te.zpp_inner.inner,ie=null,re=ne.head;null!=re;){var oe=re.elt;if(oe.outer.zpp_inner.weak){if(re=ne.erase(ie),oe.outer.zpp_inner.weak){var ae=oe.outer;if(null!=ae&&ae.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var se=ae.zpp_inner;if(se._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=se._isimmutable&&se._isimmutable(),ae.zpp_inner._inuse)throw new n._Boot.HaxeError("Error: This Vec2 is not disposable");var le=ae.zpp_inner;ae.zpp_inner.outer=null,ae.zpp_inner=null;var pe=ae;pe.zpp_pool=null,null!=t.util.ZPP_PubPool.nextVec2?t.util.ZPP_PubPool.nextVec2.zpp_pool=pe:t.util.ZPP_PubPool.poolVec2=pe,t.util.ZPP_PubPool.nextVec2=pe,pe.zpp_disp=!0;var ue=le;null!=ue.outer&&(ue.outer.zpp_inner=null,ue.outer=null),ue._isimmutable=null,ue._validate=null,ue._invalidate=null,ue.next=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=ue}}else ie=re,re=re.next}}}},e.geom.GeomPoly.__name__=["nape","geom","GeomPoly"],e.geom.GeomPoly.get=function(i){var r;if(null==t.util.ZPP_PubPool.poolGeomPoly?r=new e.geom.GeomPoly:(r=t.util.ZPP_PubPool.poolGeomPoly,t.util.ZPP_PubPool.poolGeomPoly=r.zpp_pool,r.zpp_pool=null,r.zpp_disp=!1,r==t.util.ZPP_PubPool.nextGeomPoly&&(t.util.ZPP_PubPool.nextGeomPoly=null)),null!=i){if(i instanceof Array)for(var o=i,a=0;a<o.length;){var s=o[a];if(++a,null==s)throw new n._Boot.HaxeError("Error: Array<Vec2> contains null objects");if(!(s instanceof e.geom.Vec2))throw new n._Boot.HaxeError("Error: Array<Vec2> contains non Vec2 objects");var l=s;if(null!=l&&l.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");if(null!=l&&l.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var p=l.zpp_inner;null!=p._validate&&p._validate();var u=l.zpp_inner.x;if(null!=l&&l.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var h=l.zpp_inner;null!=h._validate&&h._validate();var c,_=l.zpp_inner.y;null==t.geom.ZPP_GeomVert.zpp_pool?c=new t.geom.ZPP_GeomVert:(c=t.geom.ZPP_GeomVert.zpp_pool,t.geom.ZPP_GeomVert.zpp_pool=c.next,c.next=null),c.forced=!1,c.x=u,c.y=_;var d=c;null==r.zpp_inner.vertices?r.zpp_inner.vertices=d.prev=d.next=d:(d.prev=r.zpp_inner.vertices,d.next=r.zpp_inner.vertices.next,r.zpp_inner.vertices.next.prev=d,r.zpp_inner.vertices.next=d),r.zpp_inner.vertices=d}else if(i instanceof e.geom.Vec2List)for(var m=i.iterator();;){m.zpp_inner.zpp_inner.valmod();var P,f=m.zpp_inner.zpp_gl();if(m.zpp_critical=!0,m.zpp_i<f?P=!0:(m.zpp_next=e.geom.Vec2Iterator.zpp_pool,e.geom.Vec2Iterator.zpp_pool=m,m.zpp_inner=null,P=!1),!P)break;m.zpp_critical=!1;var x=m.zpp_inner.at(m.zpp_i++);if(null==x)throw new n._Boot.HaxeError("Error: Vec2List contains null objects");if(null!=x&&x.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");if(null!=x&&x.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var y=x.zpp_inner;null!=y._validate&&y._validate();var v=x.zpp_inner.x;if(null!=x&&x.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var g=x.zpp_inner;null!=g._validate&&g._validate();var b,z=x.zpp_inner.y;null==t.geom.ZPP_GeomVert.zpp_pool?b=new t.geom.ZPP_GeomVert:(b=t.geom.ZPP_GeomVert.zpp_pool,t.geom.ZPP_GeomVert.zpp_pool=b.next,b.next=null),b.forced=!1,b.x=v,b.y=z;var w=b;null==r.zpp_inner.vertices?r.zpp_inner.vertices=w.prev=w.next=w:(w.prev=r.zpp_inner.vertices,w.next=r.zpp_inner.vertices.next,r.zpp_inner.vertices.next.prev=w,r.zpp_inner.vertices.next=w),r.zpp_inner.vertices=w}else{if(!(i instanceof e.geom.GeomPoly))throw new n._Boot.HaxeError("Error: Invalid type for polygon object, should be Array<Vec2>, Vec2List, GeomPoly or for flash10+ flash.Vector<Vec2>");var Z=i;if(null!=Z&&Z.zpp_disp)throw new n._Boot.HaxeError("Error: GeomPoly has been disposed and cannot be used!");var E=Z.zpp_inner.vertices;if(null!=E)for(var M=E;;){var S,C=M.x,N=M.y;if(null==N&&(N=0),null==C&&(C=0),C!=C||N!=N)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null==t.util.ZPP_PubPool.poolVec2?S=new e.geom.Vec2:(S=t.util.ZPP_PubPool.poolVec2,t.util.ZPP_PubPool.poolVec2=S.zpp_pool,S.zpp_pool=null,S.zpp_disp=!1,S==t.util.ZPP_PubPool.nextVec2&&(t.util.ZPP_PubPool.nextVec2=null)),null==S.zpp_inner){var A;null==t.geom.ZPP_Vec2.zpp_pool?A=new t.geom.ZPP_Vec2:(A=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=A.next,A.next=null),A.weak=!1,A._immutable=!1,A.x=C,A.y=N,S.zpp_inner=A,S.zpp_inner.outer=S}else{if(null!=S&&S.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var L,B=S.zpp_inner;if(B._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=B._isimmutable&&B._isimmutable(),C!=C||N!=N)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null!=S&&S.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var T=S.zpp_inner;if(null!=T._validate&&T._validate(),S.zpp_inner.x==C){if(null!=S&&S.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var V=S.zpp_inner;null!=V._validate&&V._validate(),L=S.zpp_inner.y==N}else L=!1;if(!L){S.zpp_inner.x=C,S.zpp_inner.y=N;var k=S.zpp_inner;null!=k._invalidate&&k._invalidate(k)}}S.zpp_inner.weak=!1;var I=S;if(M=M.next,null!=I&&I.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var O=I.zpp_inner;null!=O._validate&&O._validate();var R=I.zpp_inner.x;if(null!=I&&I.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var H=I.zpp_inner;null!=H._validate&&H._validate();var F,D=I.zpp_inner.y;null==t.geom.ZPP_GeomVert.zpp_pool?F=new t.geom.ZPP_GeomVert:(F=t.geom.ZPP_GeomVert.zpp_pool,t.geom.ZPP_GeomVert.zpp_pool=F.next,F.next=null),F.forced=!1,F.x=R,F.y=D;var G=F;if(null==r.zpp_inner.vertices?r.zpp_inner.vertices=G.prev=G.next=G:(G.prev=r.zpp_inner.vertices,G.next=r.zpp_inner.vertices.next,r.zpp_inner.vertices.next.prev=G,r.zpp_inner.vertices.next=G),r.zpp_inner.vertices=G,null!=I&&I.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var U=I.zpp_inner;if(U._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=U._isimmutable&&U._isimmutable(),I.zpp_inner._inuse)throw new n._Boot.HaxeError("Error: This Vec2 is not disposable");var j=I.zpp_inner;I.zpp_inner.outer=null,I.zpp_inner=null;var W=I;W.zpp_pool=null,null!=t.util.ZPP_PubPool.nextVec2?t.util.ZPP_PubPool.nextVec2.zpp_pool=W:t.util.ZPP_PubPool.poolVec2=W,t.util.ZPP_PubPool.nextVec2=W,W.zpp_disp=!0;var q=j;if(null!=q.outer&&(q.outer.zpp_inner=null,q.outer=null),q._isimmutable=null,q._validate=null,q._invalidate=null,q.next=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=q,M==E)break}}if(r.skipForward(1),i instanceof Array)for(var J=i,$=0;$<J.length;){var X,Y=J[$];if(Y.zpp_inner.weak){if(null!=Y&&Y.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var K=Y.zpp_inner;if(K._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=K._isimmutable&&K._isimmutable(),Y.zpp_inner._inuse)throw new n._Boot.HaxeError("Error: This Vec2 is not disposable");var Q=Y.zpp_inner;Y.zpp_inner.outer=null,Y.zpp_inner=null;var ee=Y;ee.zpp_pool=null,null!=t.util.ZPP_PubPool.nextVec2?t.util.ZPP_PubPool.nextVec2.zpp_pool=ee:t.util.ZPP_PubPool.poolVec2=ee,t.util.ZPP_PubPool.nextVec2=ee,ee.zpp_disp=!0;var te=Q;null!=te.outer&&(te.outer.zpp_inner=null,te.outer=null),te._isimmutable=null,te._validate=null,te._invalidate=null,te.next=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=te,X=!0}else X=!1;X?J.splice($,1):++$}else if(i instanceof e.geom.Vec2List){var ne=i;null!=ne.zpp_inner._validate&&ne.zpp_inner._validate();for(var ie=ne.zpp_inner.inner,re=null,oe=ie.head;null!=oe;){var ae=oe.elt;if(ae.outer.zpp_inner.weak){if(oe=ie.erase(re),ae.outer.zpp_inner.weak){var se=ae.outer;if(null!=se&&se.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var le=se.zpp_inner;if(le._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=le._isimmutable&&le._isimmutable(),se.zpp_inner._inuse)throw new n._Boot.HaxeError("Error: This Vec2 is not disposable");var pe=se.zpp_inner;se.zpp_inner.outer=null,se.zpp_inner=null;var ue=se;ue.zpp_pool=null,null!=t.util.ZPP_PubPool.nextVec2?t.util.ZPP_PubPool.nextVec2.zpp_pool=ue:t.util.ZPP_PubPool.poolVec2=ue,t.util.ZPP_PubPool.nextVec2=ue,ue.zpp_disp=!0;var he=pe;null!=he.outer&&(he.outer.zpp_inner=null,he.outer=null),he._isimmutable=null,he._validate=null,he._invalidate=null,he.next=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=he}}else re=oe,oe=oe.next}}}return r},e.geom.GeomPoly.prototype.zpp_pool=null,e.geom.GeomPoly.prototype.zpp_disp=null,e.geom.GeomPoly.prototype.zpp_inner=null,e.geom.GeomPoly.prototype.empty=function(){if(this.zpp_disp)throw new n._Boot.HaxeError("Error: GeomPoly has been disposed and cannot be used!");return null==this.zpp_inner.vertices},e.geom.GeomPoly.prototype.size=function(){if(this.zpp_disp)throw new n._Boot.HaxeError("Error: GeomPoly has been disposed and cannot be used!");var e=0,t=this.zpp_inner.vertices,i=this.zpp_inner.vertices;if(null!=t)for(var r=t;++e,(r=r.next)!=i;);return e},e.geom.GeomPoly.prototype.iterator=function(){if(this.zpp_disp)throw new n._Boot.HaxeError("Error: GeomPoly has been disposed and cannot be used!");return t.geom.ZPP_GeomVertexIterator.get(this.zpp_inner.vertices,!0)},e.geom.GeomPoly.prototype.forwardIterator=function(){if(this.zpp_disp)throw new n._Boot.HaxeError("Error: GeomPoly has been disposed and cannot be used!");return t.geom.ZPP_GeomVertexIterator.get(this.zpp_inner.vertices,!0)},e.geom.GeomPoly.prototype.backwardsIterator=function(){if(this.zpp_disp)throw new n._Boot.HaxeError("Error: GeomPoly has been disposed and cannot be used!");return t.geom.ZPP_GeomVertexIterator.get(this.zpp_inner.vertices,!1)},e.geom.GeomPoly.prototype.current=function(){if(this.zpp_disp)throw new n._Boot.HaxeError("Error: GeomPoly has been disposed and cannot be used!");if(this.zpp_disp)throw new n._Boot.HaxeError("Error: GeomPoly has been disposed and cannot be used!");if(null==this.zpp_inner.vertices)throw new n._Boot.HaxeError("Error: GeomPoly is empty");var i=this.zpp_inner.vertices;if(null==i.wrap){var r,o=i.x,a=i.y;if(null==a&&(a=0),null==o&&(o=0),o!=o||a!=a)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null==t.util.ZPP_PubPool.poolVec2?r=new e.geom.Vec2:(r=t.util.ZPP_PubPool.poolVec2,t.util.ZPP_PubPool.poolVec2=r.zpp_pool,r.zpp_pool=null,r.zpp_disp=!1,r==t.util.ZPP_PubPool.nextVec2&&(t.util.ZPP_PubPool.nextVec2=null)),null==r.zpp_inner){var s;null==t.geom.ZPP_Vec2.zpp_pool?s=new t.geom.ZPP_Vec2:(s=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=s.next,s.next=null),s.weak=!1,s._immutable=!1,s.x=o,s.y=a,r.zpp_inner=s,r.zpp_inner.outer=r}else{if(null!=r&&r.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var l,u=r.zpp_inner;if(u._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=u._isimmutable&&u._isimmutable(),o!=o||a!=a)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null!=r&&r.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var h=r.zpp_inner;if(null!=h._validate&&h._validate(),r.zpp_inner.x==o){if(null!=r&&r.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var c=r.zpp_inner;null!=c._validate&&c._validate(),l=r.zpp_inner.y==a}else l=!1;if(!l){r.zpp_inner.x=o,r.zpp_inner.y=a;var _=r.zpp_inner;null!=_._invalidate&&_._invalidate(_)}}r.zpp_inner.weak=!1,i.wrap=r,i.wrap.zpp_inner._inuse=!0,i.wrap.zpp_inner._invalidate=p(i,i.modwrap),i.wrap.zpp_inner._validate=p(i,i.getwrap)}return i.wrap},e.geom.GeomPoly.prototype.push=function(e){if(this.zpp_disp)throw new n._Boot.HaxeError("Error: GeomPoly has been disposed and cannot be used!");if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");if(null==e)throw new n._Boot.HaxeError("Error: Cannot push null vertex");if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var i=e.zpp_inner;null!=i._validate&&i._validate();var r=e.zpp_inner.x;if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var o=e.zpp_inner;null!=o._validate&&o._validate();var a,s=e.zpp_inner.y;null==t.geom.ZPP_GeomVert.zpp_pool?a=new t.geom.ZPP_GeomVert:(a=t.geom.ZPP_GeomVert.zpp_pool,t.geom.ZPP_GeomVert.zpp_pool=a.next,a.next=null),a.forced=!1,a.x=r,a.y=s;var l=a;if(null==this.zpp_inner.vertices?this.zpp_inner.vertices=l.prev=l.next=l:(l.prev=this.zpp_inner.vertices,l.next=this.zpp_inner.vertices.next,this.zpp_inner.vertices.next.prev=l,this.zpp_inner.vertices.next=l),this.zpp_inner.vertices=l,e.zpp_inner.weak){if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var p=e.zpp_inner;if(p._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=p._isimmutable&&p._isimmutable(),e.zpp_inner._inuse)throw new n._Boot.HaxeError("Error: This Vec2 is not disposable");var u=e.zpp_inner;e.zpp_inner.outer=null,e.zpp_inner=null;var h=e;h.zpp_pool=null,null!=t.util.ZPP_PubPool.nextVec2?t.util.ZPP_PubPool.nextVec2.zpp_pool=h:t.util.ZPP_PubPool.poolVec2=h,t.util.ZPP_PubPool.nextVec2=h,h.zpp_disp=!0;var c=u;null!=c.outer&&(c.outer.zpp_inner=null,c.outer=null),c._isimmutable=null,c._validate=null,c._invalidate=null,c.next=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=c}return this},e.geom.GeomPoly.prototype.pop=function(){if(this.zpp_disp)throw new n._Boot.HaxeError("Error: GeomPoly has been disposed and cannot be used!");if(null==this.zpp_inner.vertices)throw new n._Boot.HaxeError("Error: Cannot pop from empty polygon");var e,i=this.zpp_inner.vertices;if(null!=this.zpp_inner.vertices&&this.zpp_inner.vertices.prev==this.zpp_inner.vertices)this.zpp_inner.vertices.next=this.zpp_inner.vertices.prev=null,e=null;else{var r=this.zpp_inner.vertices.prev;this.zpp_inner.vertices.prev.next=this.zpp_inner.vertices.next,this.zpp_inner.vertices.next.prev=this.zpp_inner.vertices.prev,this.zpp_inner.vertices.next=this.zpp_inner.vertices.prev=null,this.zpp_inner.vertices=null,e=r}this.zpp_inner.vertices=e;var o=i;if(null!=o.wrap){o.wrap.zpp_inner._inuse=!1;var a=o.wrap;if(null!=a&&a.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var s=a.zpp_inner;if(s._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=s._isimmutable&&s._isimmutable(),a.zpp_inner._inuse)throw new n._Boot.HaxeError("Error: This Vec2 is not disposable");var l=a.zpp_inner;a.zpp_inner.outer=null,a.zpp_inner=null;var p=a;p.zpp_pool=null,null!=t.util.ZPP_PubPool.nextVec2?t.util.ZPP_PubPool.nextVec2.zpp_pool=p:t.util.ZPP_PubPool.poolVec2=p,t.util.ZPP_PubPool.nextVec2=p,p.zpp_disp=!0;var u=l;null!=u.outer&&(u.outer.zpp_inner=null,u.outer=null),u._isimmutable=null,u._validate=null,u._invalidate=null,u.next=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=u,o.wrap=null}return o.prev=o.next=null,o.next=t.geom.ZPP_GeomVert.zpp_pool,t.geom.ZPP_GeomVert.zpp_pool=o,this},e.geom.GeomPoly.prototype.unshift=function(e){if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");if(null==e)throw new n._Boot.HaxeError("Error: Cannot unshift null vertex");if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var i=e.zpp_inner;null!=i._validate&&i._validate();var r=e.zpp_inner.x;if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var o=e.zpp_inner;null!=o._validate&&o._validate();var a,s=e.zpp_inner.y;null==t.geom.ZPP_GeomVert.zpp_pool?a=new t.geom.ZPP_GeomVert:(a=t.geom.ZPP_GeomVert.zpp_pool,t.geom.ZPP_GeomVert.zpp_pool=a.next,a.next=null),a.forced=!1,a.x=r,a.y=s;var l=a;if(null==this.zpp_inner.vertices?this.zpp_inner.vertices=l.prev=l.next=l:(l.next=this.zpp_inner.vertices,l.prev=this.zpp_inner.vertices.prev,this.zpp_inner.vertices.prev.next=l,this.zpp_inner.vertices.prev=l),this.zpp_inner.vertices=l,e.zpp_inner.weak){if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var p=e.zpp_inner;if(p._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=p._isimmutable&&p._isimmutable(),e.zpp_inner._inuse)throw new n._Boot.HaxeError("Error: This Vec2 is not disposable");var u=e.zpp_inner;e.zpp_inner.outer=null,e.zpp_inner=null;var h=e;h.zpp_pool=null,null!=t.util.ZPP_PubPool.nextVec2?t.util.ZPP_PubPool.nextVec2.zpp_pool=h:t.util.ZPP_PubPool.poolVec2=h,t.util.ZPP_PubPool.nextVec2=h,h.zpp_disp=!0;var c=u;null!=c.outer&&(c.outer.zpp_inner=null,c.outer=null),c._isimmutable=null,c._validate=null,c._invalidate=null,c.next=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=c}return this},e.geom.GeomPoly.prototype.shift=function(){if(this.zpp_disp)throw new n._Boot.HaxeError("Error: GeomPoly has been disposed and cannot be used!");if(null==this.zpp_inner.vertices)throw new n._Boot.HaxeError("Error: Cannot shift from empty polygon");var e,i=this.zpp_inner.vertices;if(null!=this.zpp_inner.vertices&&this.zpp_inner.vertices.prev==this.zpp_inner.vertices)this.zpp_inner.vertices.next=this.zpp_inner.vertices.prev=null,e=this.zpp_inner.vertices=null;else{var r=this.zpp_inner.vertices.next;this.zpp_inner.vertices.prev.next=this.zpp_inner.vertices.next,this.zpp_inner.vertices.next.prev=this.zpp_inner.vertices.prev,this.zpp_inner.vertices.next=this.zpp_inner.vertices.prev=null,this.zpp_inner.vertices=null,e=r}this.zpp_inner.vertices=e;var o=i;if(null!=o.wrap){o.wrap.zpp_inner._inuse=!1;var a=o.wrap;if(null!=a&&a.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var s=a.zpp_inner;if(s._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=s._isimmutable&&s._isimmutable(),a.zpp_inner._inuse)throw new n._Boot.HaxeError("Error: This Vec2 is not disposable");var l=a.zpp_inner;a.zpp_inner.outer=null,a.zpp_inner=null;var p=a;p.zpp_pool=null,null!=t.util.ZPP_PubPool.nextVec2?t.util.ZPP_PubPool.nextVec2.zpp_pool=p:t.util.ZPP_PubPool.poolVec2=p,t.util.ZPP_PubPool.nextVec2=p,p.zpp_disp=!0;var u=l;null!=u.outer&&(u.outer.zpp_inner=null,u.outer=null),u._isimmutable=null,u._validate=null,u._invalidate=null,u.next=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=u,o.wrap=null}return o.prev=o.next=null,o.next=t.geom.ZPP_GeomVert.zpp_pool,t.geom.ZPP_GeomVert.zpp_pool=o,this},e.geom.GeomPoly.prototype.skipForward=function(e){if(this.zpp_disp)throw new n._Boot.HaxeError("Error: GeomPoly has been disposed and cannot be used!");if(null!=this.zpp_inner.vertices)if(e>0)for(;e-- >0;)this.zpp_inner.vertices=this.zpp_inner.vertices.next;else if(e<0)for(;e++<0;)this.zpp_inner.vertices=this.zpp_inner.vertices.prev;return this},e.geom.GeomPoly.prototype.skipBackwards=function(e){if(this.zpp_disp)throw new n._Boot.HaxeError("Error: GeomPoly has been disposed and cannot be used!");return this.skipForward(-e)},e.geom.GeomPoly.prototype.erase=function(e){if(this.zpp_disp)throw new n._Boot.HaxeError("Error: GeomPoly has been disposed and cannot be used!");for(;0!=e&&null!=this.zpp_inner.vertices;){var i=this.zpp_inner.vertices;if(e>0){var r;if(null!=this.zpp_inner.vertices&&this.zpp_inner.vertices.prev==this.zpp_inner.vertices)this.zpp_inner.vertices.next=this.zpp_inner.vertices.prev=null,r=this.zpp_inner.vertices=null;else{var o=this.zpp_inner.vertices.next;this.zpp_inner.vertices.prev.next=this.zpp_inner.vertices.next,this.zpp_inner.vertices.next.prev=this.zpp_inner.vertices.prev,this.zpp_inner.vertices.next=this.zpp_inner.vertices.prev=null,this.zpp_inner.vertices=null,r=o}this.zpp_inner.vertices=r,--e}else if(e<0){var a;if(null!=this.zpp_inner.vertices&&this.zpp_inner.vertices.prev==this.zpp_inner.vertices)this.zpp_inner.vertices.next=this.zpp_inner.vertices.prev=null,a=null;else{var s=this.zpp_inner.vertices.prev;this.zpp_inner.vertices.prev.next=this.zpp_inner.vertices.next,this.zpp_inner.vertices.next.prev=this.zpp_inner.vertices.prev,this.zpp_inner.vertices.next=this.zpp_inner.vertices.prev=null,this.zpp_inner.vertices=null,a=s}this.zpp_inner.vertices=a,++e}var l=i;if(null!=l.wrap){l.wrap.zpp_inner._inuse=!1;var p=l.wrap;if(null!=p&&p.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var u=p.zpp_inner;if(u._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=u._isimmutable&&u._isimmutable(),p.zpp_inner._inuse)throw new n._Boot.HaxeError("Error: This Vec2 is not disposable");var h=p.zpp_inner;p.zpp_inner.outer=null,p.zpp_inner=null;var c=p;c.zpp_pool=null,null!=t.util.ZPP_PubPool.nextVec2?t.util.ZPP_PubPool.nextVec2.zpp_pool=c:t.util.ZPP_PubPool.poolVec2=c,t.util.ZPP_PubPool.nextVec2=c,c.zpp_disp=!0;var _=h;null!=_.outer&&(_.outer.zpp_inner=null,_.outer=null),_._isimmutable=null,_._validate=null,_._invalidate=null,_.next=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=_,l.wrap=null}l.prev=l.next=null,l.next=t.geom.ZPP_GeomVert.zpp_pool,t.geom.ZPP_GeomVert.zpp_pool=l}return this},e.geom.GeomPoly.prototype.clear=function(){if(this.zpp_disp)throw new n._Boot.HaxeError("Error: GeomPoly has been disposed and cannot be used!");for(;null!=this.zpp_inner.vertices;){var e,i=this.zpp_inner.vertices;if(null!=this.zpp_inner.vertices&&this.zpp_inner.vertices.prev==this.zpp_inner.vertices)this.zpp_inner.vertices.next=this.zpp_inner.vertices.prev=null,e=this.zpp_inner.vertices=null;else{var r=this.zpp_inner.vertices.next;this.zpp_inner.vertices.prev.next=this.zpp_inner.vertices.next,this.zpp_inner.vertices.next.prev=this.zpp_inner.vertices.prev,this.zpp_inner.vertices.next=this.zpp_inner.vertices.prev=null,this.zpp_inner.vertices=null,e=r}this.zpp_inner.vertices=e;var o=i;if(null!=o.wrap){o.wrap.zpp_inner._inuse=!1;var a=o.wrap;if(null!=a&&a.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var s=a.zpp_inner;if(s._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=s._isimmutable&&s._isimmutable(),a.zpp_inner._inuse)throw new n._Boot.HaxeError("Error: This Vec2 is not disposable");var l=a.zpp_inner;a.zpp_inner.outer=null,a.zpp_inner=null;var p=a;p.zpp_pool=null,null!=t.util.ZPP_PubPool.nextVec2?t.util.ZPP_PubPool.nextVec2.zpp_pool=p:t.util.ZPP_PubPool.poolVec2=p,t.util.ZPP_PubPool.nextVec2=p,p.zpp_disp=!0;var u=l;null!=u.outer&&(u.outer.zpp_inner=null,u.outer=null),u._isimmutable=null,u._validate=null,u._invalidate=null,u.next=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=u,o.wrap=null}o.prev=o.next=null,o.next=t.geom.ZPP_GeomVert.zpp_pool,t.geom.ZPP_GeomVert.zpp_pool=o}return this},e.geom.GeomPoly.prototype.copy=function(){if(this.zpp_disp)throw new n._Boot.HaxeError("Error: GeomPoly has been disposed and cannot be used!");var i=e.geom.GeomPoly.get(),r=this.zpp_inner.vertices,o=this.zpp_inner.vertices;if(null!=r)for(var a=r;;){var s,l=a,p=l.x,u=l.y;null==t.geom.ZPP_GeomVert.zpp_pool?s=new t.geom.ZPP_GeomVert:(s=t.geom.ZPP_GeomVert.zpp_pool,t.geom.ZPP_GeomVert.zpp_pool=s.next,s.next=null),s.forced=!1,s.x=p,s.y=u;var h=s;if(null==i.zpp_inner.vertices?i.zpp_inner.vertices=h.prev=h.next=h:(h.prev=i.zpp_inner.vertices,h.next=i.zpp_inner.vertices.next,i.zpp_inner.vertices.next.prev=h,i.zpp_inner.vertices.next=h),i.zpp_inner.vertices=h,(a=a.next)==o)break}return i.skipForward(1)},e.geom.GeomPoly.prototype.dispose=function(){if(this.zpp_disp)throw new n._Boot.HaxeError("Error: GeomPoly has been disposed and cannot be used!");this.clear();var e=this;e.zpp_pool=null,null!=t.util.ZPP_PubPool.nextGeomPoly?t.util.ZPP_PubPool.nextGeomPoly.zpp_pool=e:t.util.ZPP_PubPool.poolGeomPoly=e,t.util.ZPP_PubPool.nextGeomPoly=e,e.zpp_disp=!0},e.geom.GeomPoly.prototype.toString=function(){var e="GeomPoly[",t=this.zpp_inner.vertices,n=this.zpp_inner.vertices;if(null!=t)for(var i=t;;){var r=i;if(r!=this.zpp_inner.vertices&&(e+=","),e+="{"+r.x+","+r.y+"}",(i=i.next)==n)break}return e+"]"},e.geom.GeomPoly.prototype.area=function(){if(this.zpp_disp)throw new n._Boot.HaxeError("Error: GeomPoly has been disposed and cannot be used!");if(null==this.zpp_inner.vertices||null==this.zpp_inner.vertices.next||this.zpp_inner.vertices.prev==this.zpp_inner.vertices.next)return 0;var e=0,t=this.zpp_inner.vertices,i=this.zpp_inner.vertices;if(null!=t)for(var r=t;;){var o=r;if(e+=o.x*(o.next.y-o.prev.y),(r=r.next)==i)break}var a=.5*e;return a<0?-a:a},e.geom.GeomPoly.prototype.winding=function(){if(this.zpp_disp)throw new n._Boot.HaxeError("Error: GeomPoly has been disposed and cannot be used!");if(null==this.zpp_inner.vertices||null==this.zpp_inner.vertices.next||this.zpp_inner.vertices.prev==this.zpp_inner.vertices.next)return null==t.util.ZPP_Flags.Winding_UNDEFINED&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.Winding_UNDEFINED=new e.geom.Winding,t.util.ZPP_Flags.internal=!1),t.util.ZPP_Flags.Winding_UNDEFINED;var i=0,r=this.zpp_inner.vertices,o=this.zpp_inner.vertices;if(null!=r)for(var a=r;;){var s=a;if(i+=s.x*(s.next.y-s.prev.y),(a=a.next)==o)break}var l=.5*i;return l>0?(null==t.util.ZPP_Flags.Winding_CLOCKWISE&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.Winding_CLOCKWISE=new e.geom.Winding,t.util.ZPP_Flags.internal=!1),t.util.ZPP_Flags.Winding_CLOCKWISE):0==l?(null==t.util.ZPP_Flags.Winding_UNDEFINED&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.Winding_UNDEFINED=new e.geom.Winding,t.util.ZPP_Flags.internal=!1),t.util.ZPP_Flags.Winding_UNDEFINED):(null==t.util.ZPP_Flags.Winding_ANTICLOCKWISE&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.Winding_ANTICLOCKWISE=new e.geom.Winding,t.util.ZPP_Flags.internal=!1),t.util.ZPP_Flags.Winding_ANTICLOCKWISE)},e.geom.GeomPoly.prototype.contains=function(e){if(this.zpp_disp)throw new n._Boot.HaxeError("Error: GeomPoly has been disposed and cannot be used!");if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");if(null==e)throw new n._Boot.HaxeError("Error: GeomPoly::contains point cannot be null");if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var i=e.zpp_inner;null!=i._validate&&i._validate();var r=e.zpp_inner.x;if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var o=e.zpp_inner;null!=o._validate&&o._validate();var a=e.zpp_inner.y,s=!1,l=this.zpp_inner.vertices,p=this.zpp_inner.vertices;if(null!=l)for(var u=l;;){var h=u,c=h.prev;if((h.y<a&&c.y>=a||c.y<a&&h.y>=a)&&(h.x<=r||c.x<=r)&&h.x+(a-h.y)/(c.y-h.y)*(c.x-h.x)<r&&(s=!s),(u=u.next)==p)break}var _=s;if(e.zpp_inner.weak){if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var d=e.zpp_inner;if(d._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=d._isimmutable&&d._isimmutable(),e.zpp_inner._inuse)throw new n._Boot.HaxeError("Error: This Vec2 is not disposable");var m=e.zpp_inner;e.zpp_inner.outer=null,e.zpp_inner=null;var P=e;P.zpp_pool=null,null!=t.util.ZPP_PubPool.nextVec2?t.util.ZPP_PubPool.nextVec2.zpp_pool=P:t.util.ZPP_PubPool.poolVec2=P,t.util.ZPP_PubPool.nextVec2=P,P.zpp_disp=!0;var f=m;null!=f.outer&&(f.outer.zpp_inner=null,f.outer=null),f._isimmutable=null,f._validate=null,f._invalidate=null,f.next=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=f}return _},e.geom.GeomPoly.prototype.isClockwise=function(){var n=this.winding();return null==t.util.ZPP_Flags.Winding_CLOCKWISE&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.Winding_CLOCKWISE=new e.geom.Winding,t.util.ZPP_Flags.internal=!1),n==t.util.ZPP_Flags.Winding_CLOCKWISE},e.geom.GeomPoly.prototype.isConvex=function(){if(this.zpp_disp)throw new n._Boot.HaxeError("Error: GeomPoly has been disposed and cannot be used!");if(null==this.zpp_inner.vertices||null==this.zpp_inner.vertices.next||this.zpp_inner.vertices.prev==this.zpp_inner.vertices.next)return!0;var e=!1,t=!1,i=!0,r=this.zpp_inner.vertices,o=this.zpp_inner.vertices;if(null!=r)for(var a=r;;){var s,l,p,u=a,h=u.prev,c=u.next;s=c.x-u.x,l=c.y-u.y,p=u.x-h.x;var _=(u.y-h.y)*s-p*l;if(_>0?t=!0:_<0&&(e=!0),t&&e){i=!1;break}if((a=a.next)==o)break}return i},e.geom.GeomPoly.prototype.isSimple=function(){if(this.zpp_disp)throw new n._Boot.HaxeError("Error: GeomPoly has been disposed and cannot be used!");return null==this.zpp_inner.vertices||null==this.zpp_inner.vertices.next||this.zpp_inner.vertices.prev==this.zpp_inner.vertices.next||t.geom.ZPP_Simple.isSimple(this.zpp_inner.vertices)},e.geom.GeomPoly.prototype.isMonotone=function(){if(this.zpp_disp)throw new n._Boot.HaxeError("Error: GeomPoly has been disposed and cannot be used!");return null==this.zpp_inner.vertices||null==this.zpp_inner.vertices.next||this.zpp_inner.vertices.prev==this.zpp_inner.vertices.next||t.geom.ZPP_Monotone.isMonotone(this.zpp_inner.vertices)},e.geom.GeomPoly.prototype.isDegenerate=function(){if(this.zpp_disp)throw new n._Boot.HaxeError("Error: GeomPoly has been disposed and cannot be used!");return null==this.zpp_inner.vertices||null==this.zpp_inner.vertices.next||this.zpp_inner.vertices.prev==this.zpp_inner.vertices.next||this.area()<e.Config.epsilon},e.geom.GeomPoly.prototype.simplify=function(i){if(this.zpp_disp)throw new n._Boot.HaxeError("Error: GeomPoly has been disposed and cannot be used!");if(i<=0)throw new n._Boot.HaxeError("Error: Epsilon should be > 0 for simplifying a GeomPoly");if(null==this.zpp_inner.vertices||null==this.zpp_inner.vertices.next||this.zpp_inner.vertices.prev==this.zpp_inner.vertices.next)return this.copy();var r=t.geom.ZPP_Simplify.simplify(this.zpp_inner.vertices,i),o=e.geom.GeomPoly.get();return o.zpp_inner.vertices=r,o},e.geom.GeomPoly.prototype.simpleDecomposition=function(i){if(this.zpp_disp)throw new n._Boot.HaxeError("Error: GeomPoly has been disposed and cannot be used!");if(null==this.zpp_inner.vertices||null==this.zpp_inner.vertices.next||this.zpp_inner.vertices.prev==this.zpp_inner.vertices.next)throw new n._Boot.HaxeError("Error: Cannot decompose a degenerate polygon");var r=this.zpp_inner.vertices;null==t.geom.ZPP_PartitionedPoly.sharedGVList&&(t.geom.ZPP_PartitionedPoly.sharedGVList=new t.util.ZNPList_ZPP_GeomVert);for(var o=t.geom.ZPP_Simple.decompose(r,t.geom.ZPP_PartitionedPoly.sharedGVList),a=null==i?new e.geom.GeomPolyList:i;null!=o.head;){var s=o.pop_unsafe(),l=e.geom.GeomPoly.get();l.zpp_inner.vertices=s,a.zpp_inner.reverse_flag?a.push(l):a.unshift(l)}return a},e.geom.GeomPoly.prototype.monotoneDecomposition=function(i){if(this.zpp_disp)throw new n._Boot.HaxeError("Error: GeomPoly has been disposed and cannot be used!");if(null==this.zpp_inner.vertices||null==this.zpp_inner.vertices.next||this.zpp_inner.vertices.prev==this.zpp_inner.vertices.next)throw new n._Boot.HaxeError("Error: Cannot decompose a degenerate polygon");var r=this.zpp_inner.vertices;null==t.geom.ZPP_Monotone.sharedPPoly&&(t.geom.ZPP_Monotone.sharedPPoly=new t.geom.ZPP_PartitionedPoly);var o=t.geom.ZPP_Monotone.decompose(r,t.geom.ZPP_Monotone.sharedPPoly);null==t.geom.ZPP_PartitionedPoly.sharedGVList&&(t.geom.ZPP_PartitionedPoly.sharedGVList=new t.util.ZNPList_ZPP_GeomVert);for(var a=o.extract(t.geom.ZPP_PartitionedPoly.sharedGVList),s=null==i?new e.geom.GeomPolyList:i;null!=a.head;){var l=a.pop_unsafe(),p=e.geom.GeomPoly.get();p.zpp_inner.vertices=l,s.zpp_inner.reverse_flag?s.push(p):s.unshift(p)}return s},e.geom.GeomPoly.prototype.convexDecomposition=function(i,r){if(null==i&&(i=!1),this.zpp_disp)throw new n._Boot.HaxeError("Error: GeomPoly has been disposed and cannot be used!");if(null==this.zpp_inner.vertices||null==this.zpp_inner.vertices.next||this.zpp_inner.vertices.prev==this.zpp_inner.vertices.next)throw new n._Boot.HaxeError("Error: Cannot decompose a degenerate polygon");var o=this.zpp_inner.vertices;null==t.geom.ZPP_Monotone.sharedPPoly&&(t.geom.ZPP_Monotone.sharedPPoly=new t.geom.ZPP_PartitionedPoly);var a=t.geom.ZPP_Monotone.decompose(o,t.geom.ZPP_Monotone.sharedPPoly);null==t.geom.ZPP_PartitionedPoly.sharedPPList&&(t.geom.ZPP_PartitionedPoly.sharedPPList=new t.util.ZNPList_ZPP_PartitionedPoly);for(var s=a.extract_partitions(t.geom.ZPP_PartitionedPoly.sharedPPList),l=null==r?new e.geom.GeomPolyList:r;null!=s.head;){var p=s.pop_unsafe();t.geom.ZPP_Triangular.triangulate(p),i&&t.geom.ZPP_Triangular.optimise(p),t.geom.ZPP_Convex.optimise(p),null==t.geom.ZPP_PartitionedPoly.sharedGVList&&(t.geom.ZPP_PartitionedPoly.sharedGVList=new t.util.ZNPList_ZPP_GeomVert);var u=p.extract(t.geom.ZPP_PartitionedPoly.sharedGVList),h=p;for(h.next=t.geom.ZPP_PartitionedPoly.zpp_pool,t.geom.ZPP_PartitionedPoly.zpp_pool=h;null!=u.head;){var c=u.pop_unsafe(),_=e.geom.GeomPoly.get();_.zpp_inner.vertices=c,l.zpp_inner.reverse_flag?l.push(_):l.unshift(_)}}return l},e.geom.GeomPoly.prototype.triangularDecomposition=function(i,r){if(null==i&&(i=!1),this.zpp_disp)throw new n._Boot.HaxeError("Error: GeomPoly has been disposed and cannot be used!");if(null==this.zpp_inner.vertices||null==this.zpp_inner.vertices.next||this.zpp_inner.vertices.prev==this.zpp_inner.vertices.next)throw new n._Boot.HaxeError("Error: Cannot decompose a degenerate polygon");var o=this.zpp_inner.vertices;null==t.geom.ZPP_Monotone.sharedPPoly&&(t.geom.ZPP_Monotone.sharedPPoly=new t.geom.ZPP_PartitionedPoly);var a=t.geom.ZPP_Monotone.decompose(o,t.geom.ZPP_Monotone.sharedPPoly);null==t.geom.ZPP_PartitionedPoly.sharedPPList&&(t.geom.ZPP_PartitionedPoly.sharedPPList=new t.util.ZNPList_ZPP_PartitionedPoly);for(var s=a.extract_partitions(t.geom.ZPP_PartitionedPoly.sharedPPList),l=null==r?new e.geom.GeomPolyList:r;null!=s.head;){var p=s.pop_unsafe();t.geom.ZPP_Triangular.triangulate(p),i&&t.geom.ZPP_Triangular.optimise(p),null==t.geom.ZPP_PartitionedPoly.sharedGVList&&(t.geom.ZPP_PartitionedPoly.sharedGVList=new t.util.ZNPList_ZPP_GeomVert);var u=p.extract(t.geom.ZPP_PartitionedPoly.sharedGVList),h=p;for(h.next=t.geom.ZPP_PartitionedPoly.zpp_pool,t.geom.ZPP_PartitionedPoly.zpp_pool=h;null!=u.head;){var c=u.pop_unsafe(),_=e.geom.GeomPoly.get();_.zpp_inner.vertices=c,l.zpp_inner.reverse_flag?l.push(_):l.unshift(_)}}return l},e.geom.GeomPoly.prototype.inflate=function(i){if(this.zpp_disp)throw new n._Boot.HaxeError("Error: GeomPoly has been disposed and cannot be used!");var r=e.geom.GeomPoly.get(),o=this.winding();null==t.util.ZPP_Flags.Winding_CLOCKWISE&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.Winding_CLOCKWISE=new e.geom.Winding,t.util.ZPP_Flags.internal=!1),o==t.util.ZPP_Flags.Winding_CLOCKWISE&&(i=-i);var a=this.zpp_inner.vertices,s=this.zpp_inner.vertices;if(null!=a)for(var l=a;;){var p,u,h,c,_=l,d=_.prev,m=_.next;p=_.x-d.x,u=_.y-d.y,h=m.x-_.x,c=m.y-_.y;var P=0,f=0,x=0,y=0,v=(P=p)*P+(f=u)*f,g=1/Math.sqrt(v),b=P*=g;P=-(f*=g),f=b,P*=i,f*=i;var z=(x=h)*x+(y=c)*y,w=1/Math.sqrt(z),Z=x*=w;x=-(y*=w),y=Z;var E=c*((x*=i)-P)-h*((y*=i)-f),M=0==E?0:E/(c*p-h*u),S=0,C=0;S=_.x+P,C=_.y+f;var N,A=S+=p*M,L=C+=u*M;if(null==L&&(L=0),null==A&&(A=0),A!=A||L!=L)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null==t.util.ZPP_PubPool.poolVec2?N=new e.geom.Vec2:(N=t.util.ZPP_PubPool.poolVec2,t.util.ZPP_PubPool.poolVec2=N.zpp_pool,N.zpp_pool=null,N.zpp_disp=!1,N==t.util.ZPP_PubPool.nextVec2&&(t.util.ZPP_PubPool.nextVec2=null)),null==N.zpp_inner){var B;null==t.geom.ZPP_Vec2.zpp_pool?B=new t.geom.ZPP_Vec2:(B=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=B.next,B.next=null),B.weak=!1,B._immutable=!1,B.x=A,B.y=L,N.zpp_inner=B,N.zpp_inner.outer=N}else{if(null!=N&&N.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var T,V=N.zpp_inner;if(V._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=V._isimmutable&&V._isimmutable(),A!=A||L!=L)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null!=N&&N.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var k=N.zpp_inner;if(null!=k._validate&&k._validate(),N.zpp_inner.x==A){if(null!=N&&N.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var I=N.zpp_inner;null!=I._validate&&I._validate(),T=N.zpp_inner.y==L}else T=!1;if(!T){N.zpp_inner.x=A,N.zpp_inner.y=L;var O=N.zpp_inner;null!=O._invalidate&&O._invalidate(O)}}if(N.zpp_inner.weak=!1,r.push(N),(l=l.next)==s)break}return r.skipForward(1)},e.geom.GeomPoly.prototype.cut=function(e,i,r,o,a){if(null==o&&(o=!1),null==r&&(r=!1),this.zpp_disp)throw new n._Boot.HaxeError("Error: GeomPoly has been disposed and cannot be used!");if(this.zpp_disp)throw new n._Boot.HaxeError("Error: GeomPoly has been disposed and cannot be used!");if(null!=this.zpp_inner.vertices&&null!=this.zpp_inner.vertices.next&&this.zpp_inner.vertices.prev!=this.zpp_inner.vertices.next&&!t.geom.ZPP_Simple.isSimple(this.zpp_inner.vertices))throw new n._Boot.HaxeError("Error: Cut requires a truly simple polygon");if(null==e||null==i)throw new n._Boot.HaxeError("Error: Cannot cut with null start/end's");if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var s=t.geom.ZPP_Cutter.run(this.zpp_inner.vertices,e,i,r,o,a);if(e.zpp_inner.weak){if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var l=e.zpp_inner;if(l._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=l._isimmutable&&l._isimmutable(),e.zpp_inner._inuse)throw new n._Boot.HaxeError("Error: This Vec2 is not disposable");var p=e.zpp_inner;e.zpp_inner.outer=null,e.zpp_inner=null;var u=e;u.zpp_pool=null,null!=t.util.ZPP_PubPool.nextVec2?t.util.ZPP_PubPool.nextVec2.zpp_pool=u:t.util.ZPP_PubPool.poolVec2=u,t.util.ZPP_PubPool.nextVec2=u,u.zpp_disp=!0;var h=p;null!=h.outer&&(h.outer.zpp_inner=null,h.outer=null),h._isimmutable=null,h._validate=null,h._invalidate=null,h.next=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=h}if(i.zpp_inner.weak){if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var c=i.zpp_inner;if(c._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=c._isimmutable&&c._isimmutable(),i.zpp_inner._inuse)throw new n._Boot.HaxeError("Error: This Vec2 is not disposable");var _=i.zpp_inner;i.zpp_inner.outer=null,i.zpp_inner=null;var d=i;d.zpp_pool=null,null!=t.util.ZPP_PubPool.nextVec2?t.util.ZPP_PubPool.nextVec2.zpp_pool=d:t.util.ZPP_PubPool.poolVec2=d,t.util.ZPP_PubPool.nextVec2=d,d.zpp_disp=!0;var m=_;null!=m.outer&&(m.outer.zpp_inner=null,m.outer=null),m._isimmutable=null,m._validate=null,m._invalidate=null,m.next=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=m}return s},e.geom.GeomPoly.prototype.transform=function(e){if(this.zpp_disp)throw new n._Boot.HaxeError("Error: GeomPoly has been disposed and cannot be used!");if(null==e)throw new n._Boot.HaxeError("Error: Cannot transform by null matrix");var t=this.zpp_inner.vertices,i=this.zpp_inner.vertices;if(null!=t)for(var r=t;;){var o=r,a=e.zpp_inner.a*o.x+e.zpp_inner.b*o.y+e.zpp_inner.tx;if(o.y=e.zpp_inner.c*o.x+e.zpp_inner.d*o.y+e.zpp_inner.ty,o.x=a,(r=r.next)==i)break}return this},e.geom.GeomPoly.prototype.bounds=function(){if(this.zpp_disp)throw new n._Boot.HaxeError("Error: GeomPoly has been disposed and cannot be used!");if(this.zpp_disp)throw new n._Boot.HaxeError("Error: GeomPoly has been disposed and cannot be used!");if(null==this.zpp_inner.vertices)throw new n._Boot.HaxeError("Error: empty GeomPoly has no defineable bounds");var t=1e100,i=1e100,r=-1e100,o=-1e100,a=this.zpp_inner.vertices,s=this.zpp_inner.vertices;if(null!=a)for(var l=a;;){var p=l;if(p.x<t&&(t=p.x),p.y<i&&(i=p.y),p.x>r&&(r=p.x),p.y>o&&(o=p.y),(l=l.next)==s)break}return new e.geom.AABB(t,i,r-t,o-i)},e.geom.GeomPoly.prototype.top=function(){if(this.zpp_disp)throw new n._Boot.HaxeError("Error: GeomPoly has been disposed and cannot be used!");if(this.zpp_disp)throw new n._Boot.HaxeError("Error: GeomPoly has been disposed and cannot be used!");if(null==this.zpp_inner.vertices)throw new n._Boot.HaxeError("Error: empty GeomPoly has no defineable topmost vertex");var i=this.zpp_inner.vertices,r=this.zpp_inner.vertices.next,o=this.zpp_inner.vertices;if(null!=r)for(var a=r;;){var s=a;if(s.y<i.y&&(i=s),(a=a.next)==o)break}if(null==i.wrap){var l,u=i.x,h=i.y;if(null==h&&(h=0),null==u&&(u=0),u!=u||h!=h)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null==t.util.ZPP_PubPool.poolVec2?l=new e.geom.Vec2:(l=t.util.ZPP_PubPool.poolVec2,t.util.ZPP_PubPool.poolVec2=l.zpp_pool,l.zpp_pool=null,l.zpp_disp=!1,l==t.util.ZPP_PubPool.nextVec2&&(t.util.ZPP_PubPool.nextVec2=null)),null==l.zpp_inner){var c;null==t.geom.ZPP_Vec2.zpp_pool?c=new t.geom.ZPP_Vec2:(c=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=c.next,c.next=null),c.weak=!1,c._immutable=!1,c.x=u,c.y=h,l.zpp_inner=c,l.zpp_inner.outer=l}else{if(null!=l&&l.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var _,d=l.zpp_inner;if(d._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=d._isimmutable&&d._isimmutable(),u!=u||h!=h)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null!=l&&l.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var m=l.zpp_inner;if(null!=m._validate&&m._validate(),l.zpp_inner.x==u){if(null!=l&&l.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var P=l.zpp_inner;null!=P._validate&&P._validate(),_=l.zpp_inner.y==h}else _=!1;if(!_){l.zpp_inner.x=u,l.zpp_inner.y=h;var f=l.zpp_inner;null!=f._invalidate&&f._invalidate(f)}}l.zpp_inner.weak=!1,i.wrap=l,i.wrap.zpp_inner._inuse=!0,i.wrap.zpp_inner._invalidate=p(i,i.modwrap),i.wrap.zpp_inner._validate=p(i,i.getwrap)}return i.wrap},e.geom.GeomPoly.prototype.bottom=function(){if(this.zpp_disp)throw new n._Boot.HaxeError("Error: GeomPoly has been disposed and cannot be used!");if(this.zpp_disp)throw new n._Boot.HaxeError("Error: GeomPoly has been disposed and cannot be used!");if(null==this.zpp_inner.vertices)throw new n._Boot.HaxeError("Error: empty GeomPoly has no defineable bottommost vertex");var i=this.zpp_inner.vertices,r=this.zpp_inner.vertices.next,o=this.zpp_inner.vertices;if(null!=r)for(var a=r;;){var s=a;if(s.y>i.y&&(i=s),(a=a.next)==o)break}if(null==i.wrap){var l,u=i.x,h=i.y;if(null==h&&(h=0),null==u&&(u=0),u!=u||h!=h)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null==t.util.ZPP_PubPool.poolVec2?l=new e.geom.Vec2:(l=t.util.ZPP_PubPool.poolVec2,t.util.ZPP_PubPool.poolVec2=l.zpp_pool,l.zpp_pool=null,l.zpp_disp=!1,l==t.util.ZPP_PubPool.nextVec2&&(t.util.ZPP_PubPool.nextVec2=null)),null==l.zpp_inner){var c;null==t.geom.ZPP_Vec2.zpp_pool?c=new t.geom.ZPP_Vec2:(c=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=c.next,c.next=null),c.weak=!1,c._immutable=!1,c.x=u,c.y=h,l.zpp_inner=c,l.zpp_inner.outer=l}else{if(null!=l&&l.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var _,d=l.zpp_inner;if(d._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=d._isimmutable&&d._isimmutable(),u!=u||h!=h)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null!=l&&l.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var m=l.zpp_inner;if(null!=m._validate&&m._validate(),l.zpp_inner.x==u){if(null!=l&&l.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var P=l.zpp_inner;null!=P._validate&&P._validate(),_=l.zpp_inner.y==h}else _=!1;if(!_){l.zpp_inner.x=u,l.zpp_inner.y=h;var f=l.zpp_inner;null!=f._invalidate&&f._invalidate(f)}}l.zpp_inner.weak=!1,i.wrap=l,i.wrap.zpp_inner._inuse=!0,i.wrap.zpp_inner._invalidate=p(i,i.modwrap),i.wrap.zpp_inner._validate=p(i,i.getwrap)}return i.wrap},e.geom.GeomPoly.prototype.left=function(){if(this.zpp_disp)throw new n._Boot.HaxeError("Error: GeomPoly has been disposed and cannot be used!");if(this.zpp_disp)throw new n._Boot.HaxeError("Error: GeomPoly has been disposed and cannot be used!");if(null==this.zpp_inner.vertices)throw new n._Boot.HaxeError("Error: empty GeomPoly has no defineable leftmost vertex");var i=this.zpp_inner.vertices,r=this.zpp_inner.vertices.next,o=this.zpp_inner.vertices;if(null!=r)for(var a=r;;){var s=a;if(s.x<i.x&&(i=s),(a=a.next)==o)break}if(null==i.wrap){var l,u=i.x,h=i.y;if(null==h&&(h=0),null==u&&(u=0),u!=u||h!=h)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null==t.util.ZPP_PubPool.poolVec2?l=new e.geom.Vec2:(l=t.util.ZPP_PubPool.poolVec2,t.util.ZPP_PubPool.poolVec2=l.zpp_pool,l.zpp_pool=null,l.zpp_disp=!1,l==t.util.ZPP_PubPool.nextVec2&&(t.util.ZPP_PubPool.nextVec2=null)),null==l.zpp_inner){var c;null==t.geom.ZPP_Vec2.zpp_pool?c=new t.geom.ZPP_Vec2:(c=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=c.next,c.next=null),c.weak=!1,c._immutable=!1,c.x=u,c.y=h,l.zpp_inner=c,l.zpp_inner.outer=l}else{if(null!=l&&l.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var _,d=l.zpp_inner;if(d._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=d._isimmutable&&d._isimmutable(),u!=u||h!=h)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null!=l&&l.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var m=l.zpp_inner;if(null!=m._validate&&m._validate(),l.zpp_inner.x==u){if(null!=l&&l.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var P=l.zpp_inner;null!=P._validate&&P._validate(),_=l.zpp_inner.y==h}else _=!1;if(!_){l.zpp_inner.x=u,l.zpp_inner.y=h;var f=l.zpp_inner;null!=f._invalidate&&f._invalidate(f)}}l.zpp_inner.weak=!1,i.wrap=l,i.wrap.zpp_inner._inuse=!0,i.wrap.zpp_inner._invalidate=p(i,i.modwrap),i.wrap.zpp_inner._validate=p(i,i.getwrap)}return i.wrap},e.geom.GeomPoly.prototype.right=function(){if(this.zpp_disp)throw new n._Boot.HaxeError("Error: GeomPoly has been disposed and cannot be used!");if(this.zpp_disp)throw new n._Boot.HaxeError("Error: GeomPoly has been disposed and cannot be used!");if(null==this.zpp_inner.vertices)throw new n._Boot.HaxeError("Error: empty GeomPoly has no defineable rightmmost vertex");var i=this.zpp_inner.vertices,r=this.zpp_inner.vertices.next,o=this.zpp_inner.vertices;if(null!=r)for(var a=r;;){var s=a;if(s.x>i.x&&(i=s),(a=a.next)==o)break}if(null==i.wrap){var l,u=i.x,h=i.y;if(null==h&&(h=0),null==u&&(u=0),u!=u||h!=h)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null==t.util.ZPP_PubPool.poolVec2?l=new e.geom.Vec2:(l=t.util.ZPP_PubPool.poolVec2,t.util.ZPP_PubPool.poolVec2=l.zpp_pool,l.zpp_pool=null,l.zpp_disp=!1,l==t.util.ZPP_PubPool.nextVec2&&(t.util.ZPP_PubPool.nextVec2=null)),null==l.zpp_inner){var c;null==t.geom.ZPP_Vec2.zpp_pool?c=new t.geom.ZPP_Vec2:(c=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=c.next,c.next=null),c.weak=!1,c._immutable=!1,c.x=u,c.y=h,l.zpp_inner=c,l.zpp_inner.outer=l}else{if(null!=l&&l.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var _,d=l.zpp_inner;if(d._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=d._isimmutable&&d._isimmutable(),u!=u||h!=h)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null!=l&&l.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var m=l.zpp_inner;if(null!=m._validate&&m._validate(),l.zpp_inner.x==u){if(null!=l&&l.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var P=l.zpp_inner;null!=P._validate&&P._validate(),_=l.zpp_inner.y==h}else _=!1;if(!_){l.zpp_inner.x=u,l.zpp_inner.y=h;var f=l.zpp_inner;null!=f._invalidate&&f._invalidate(f)}}l.zpp_inner.weak=!1,i.wrap=l,i.wrap.zpp_inner._inuse=!0,i.wrap.zpp_inner._invalidate=p(i,i.modwrap),i.wrap.zpp_inner._validate=p(i,i.getwrap)}return i.wrap},e.geom.GeomPoly.prototype.__class__=e.geom.GeomPoly,e.geom.GeomPolyIterator=l["nape.geom.GeomPolyIterator"]=function(){if(this.zpp_next=null,this.zpp_critical=!1,this.zpp_i=0,this.zpp_inner=null,!t.util.ZPP_GeomPolyList.internal)throw new n._Boot.HaxeError("Error: Cannot instantiate GeomPolyIterator derp!")},e.geom.GeomPolyIterator.__name__=["nape","geom","GeomPolyIterator"],e.geom.GeomPolyIterator.get=function(n){var i;if(null==e.geom.GeomPolyIterator.zpp_pool){t.util.ZPP_GeomPolyList.internal=!0;var r=new e.geom.GeomPolyIterator;t.util.ZPP_GeomPolyList.internal=!1,i=r}else{var o=e.geom.GeomPolyIterator.zpp_pool;e.geom.GeomPolyIterator.zpp_pool=o.zpp_next,i=o}return i.zpp_i=0,i.zpp_inner=n,i.zpp_critical=!1,i},e.geom.GeomPolyIterator.prototype.zpp_inner=null,e.geom.GeomPolyIterator.prototype.zpp_i=null,e.geom.GeomPolyIterator.prototype.zpp_critical=null,e.geom.GeomPolyIterator.prototype.zpp_next=null,e.geom.GeomPolyIterator.prototype.hasNext=function(){this.zpp_inner.zpp_inner.valmod();var t=this.zpp_inner;t.zpp_inner.valmod(),t.zpp_inner.zip_length&&(t.zpp_inner.zip_length=!1,t.zpp_inner.user_length=t.zpp_inner.inner.length);var n=t.zpp_inner.user_length;return this.zpp_critical=!0,this.zpp_i<n||(this.zpp_next=e.geom.GeomPolyIterator.zpp_pool,e.geom.GeomPolyIterator.zpp_pool=this,this.zpp_inner=null,!1)},e.geom.GeomPolyIterator.prototype.next=function(){return this.zpp_critical=!1,this.zpp_inner.at(this.zpp_i++)},e.geom.GeomPolyIterator.prototype.__class__=e.geom.GeomPolyIterator,e.geom.GeomPolyList=l["nape.geom.GeomPolyList"]=function(){this.zpp_inner=null,this.zpp_inner=new t.util.ZPP_GeomPolyList,this.zpp_inner.outer=this},e.geom.GeomPolyList.__name__=["nape","geom","GeomPolyList"],e.geom.GeomPolyList.fromArray=function(t){if(null==t)throw new n._Boot.HaxeError("Error: Cannot convert null Array to Nape list");for(var i=new e.geom.GeomPolyList,r=0;r<t.length;){var o=t[r];++r,i.push(o)}return i},e.geom.GeomPolyList.prototype.zpp_inner=null,Object.defineProperty(e.geom.GeomPolyList.prototype,"length",{get:e.geom.GeomPolyList.prototype.get_length}),e.geom.GeomPolyList.prototype.get_length=function(){return this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.user_length},e.geom.GeomPolyList.prototype.has=function(e){return this.zpp_inner.valmod(),this.zpp_inner.inner.has(e.zpp_inner)},e.geom.GeomPolyList.prototype.at=function(e){var t;if(this.zpp_inner.valmod(),e>=0?(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t=e>=this.zpp_inner.user_length):t=!0,t)throw new n._Boot.HaxeError("Error: Index out of bounds");if(this.zpp_inner.reverse_flag&&(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),e=this.zpp_inner.user_length-1-e),e<this.zpp_inner.at_index||null==this.zpp_inner.at_ite)this.zpp_inner.at_index=e,this.zpp_inner.at_ite=this.zpp_inner.inner.iterator_at(e);else for(;this.zpp_inner.at_index!=e;)this.zpp_inner.at_index++,this.zpp_inner.at_ite=this.zpp_inner.at_ite.next;return this.zpp_inner.at_ite.elt.outer},e.geom.GeomPolyList.prototype.push=function(e){if(this.zpp_inner.immutable)throw new n._Boot.HaxeError("Error: GeomPolyList is immutable");this.zpp_inner.modify_test(),this.zpp_inner.valmod();var t=null==this.zpp_inner.adder||this.zpp_inner.adder(e);if(t){if(this.zpp_inner.reverse_flag)this.zpp_inner.inner.add(e.zpp_inner);else{if(null==this.zpp_inner.push_ite){var i;if(null==this.zpp_inner.inner.head)i=null;else{var r=this.zpp_inner.inner;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),i=r.iterator_at(this.zpp_inner.user_length-1)}this.zpp_inner.push_ite=i}this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,e.zpp_inner)}this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(e)}return t},e.geom.GeomPolyList.prototype.unshift=function(e){if(this.zpp_inner.immutable)throw new n._Boot.HaxeError("Error: GeomPolyList is immutable");this.zpp_inner.modify_test(),this.zpp_inner.valmod();var t=null==this.zpp_inner.adder||this.zpp_inner.adder(e);if(t){if(this.zpp_inner.reverse_flag){if(null==this.zpp_inner.push_ite){var i;if(null==this.zpp_inner.inner.head)i=null;else{var r=this.zpp_inner.inner;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),i=r.iterator_at(this.zpp_inner.user_length-1)}this.zpp_inner.push_ite=i}this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,e.zpp_inner)}else this.zpp_inner.inner.add(e.zpp_inner);this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(e)}return t},e.geom.GeomPolyList.prototype.pop=function(){if(this.zpp_inner.immutable)throw new n._Boot.HaxeError("Error: GeomPolyList is immutable");if(this.zpp_inner.modify_test(),null==this.zpp_inner.inner.head)throw new n._Boot.HaxeError("Error: Cannot remove from empty list");this.zpp_inner.valmod();var e=null;if(this.zpp_inner.reverse_flag){var t=(e=this.zpp_inner.inner.head.elt).outer;null!=this.zpp_inner.subber&&this.zpp_inner.subber(t),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()}else{var i;if(null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null),this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),1==this.zpp_inner.user_length)i=null;else{var r=this.zpp_inner.inner;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),i=r.iterator_at(this.zpp_inner.user_length-2)}var o=(e=null==i?this.zpp_inner.inner.head.elt:i.next.elt).outer;null!=this.zpp_inner.subber&&this.zpp_inner.subber(o),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(i)}return this.zpp_inner.invalidate(),e.outer},e.geom.GeomPolyList.prototype.shift=function(){if(this.zpp_inner.immutable)throw new n._Boot.HaxeError("Error: GeomPolyList is immutable");if(this.zpp_inner.modify_test(),null==this.zpp_inner.inner.head)throw new n._Boot.HaxeError("Error: Cannot remove from empty list");this.zpp_inner.valmod();var e=null;if(this.zpp_inner.reverse_flag){var t;if(null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null),this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),1==this.zpp_inner.user_length)t=null;else{var i=this.zpp_inner.inner;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t=i.iterator_at(this.zpp_inner.user_length-2)}var r=(e=null==t?this.zpp_inner.inner.head.elt:t.next.elt).outer;null!=this.zpp_inner.subber&&this.zpp_inner.subber(r),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(t)}else{var o=(e=this.zpp_inner.inner.head.elt).outer;null!=this.zpp_inner.subber&&this.zpp_inner.subber(o),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()}return this.zpp_inner.invalidate(),e.outer},e.geom.GeomPolyList.prototype.add=function(e){return this.zpp_inner.reverse_flag?this.push(e):this.unshift(e)},e.geom.GeomPolyList.prototype.remove=function(e){if(this.zpp_inner.immutable)throw new n._Boot.HaxeError("Error: GeomPolyList is immutable");var t;this.zpp_inner.modify_test(),this.zpp_inner.valmod(),t=!1;for(var i=this.zpp_inner.inner.head;null!=i;){if(i.elt==e.zpp_inner){t=!0;break}i=i.next}return t&&(null!=this.zpp_inner.subber&&this.zpp_inner.subber(e),this.zpp_inner.dontremove||this.zpp_inner.inner.remove(e.zpp_inner),this.zpp_inner.invalidate()),t},e.geom.GeomPolyList.prototype.clear=function(){if(this.zpp_inner.immutable)throw new n._Boot.HaxeError("Error: GeomPolyList is immutable");if(this.zpp_inner.reverse_flag)for(;null!=this.zpp_inner.inner.head;)this.pop();else for(;null!=this.zpp_inner.inner.head;)this.shift()},e.geom.GeomPolyList.prototype.empty=function(){return null==this.zpp_inner.inner.head},e.geom.GeomPolyList.prototype.iterator=function(){return this.zpp_inner.valmod(),e.geom.GeomPolyIterator.get(this)},e.geom.GeomPolyList.prototype.copy=function(t){null==t&&(t=!1);var i=new e.geom.GeomPolyList;this.zpp_inner.valmod();for(var r=e.geom.GeomPolyIterator.get(this);;){r.zpp_inner.zpp_inner.valmod();var o=r.zpp_inner;o.zpp_inner.valmod(),o.zpp_inner.zip_length&&(o.zpp_inner.zip_length=!1,o.zpp_inner.user_length=o.zpp_inner.inner.length);var a,s=o.zpp_inner.user_length;if(r.zpp_critical=!0,r.zpp_i<s?a=!0:(r.zpp_next=e.geom.GeomPolyIterator.zpp_pool,e.geom.GeomPolyIterator.zpp_pool=r,r.zpp_inner=null,a=!1),!a)break;r.zpp_critical=!1;var l,p=r.zpp_inner.at(r.zpp_i++);if(t)throw new n._Boot.HaxeError("Error: GeomPoly is not a copyable type");l=p,i.push(l)}return i},e.geom.GeomPolyList.prototype.merge=function(t){if(null==t)throw new n._Boot.HaxeError("Error: Cannot merge with null list");t.zpp_inner.valmod();for(var i=e.geom.GeomPolyIterator.get(t);;){i.zpp_inner.zpp_inner.valmod();var r=i.zpp_inner;r.zpp_inner.valmod(),r.zpp_inner.zip_length&&(r.zpp_inner.zip_length=!1,r.zpp_inner.user_length=r.zpp_inner.inner.length);var o,a=r.zpp_inner.user_length;if(i.zpp_critical=!0,i.zpp_i<a?o=!0:(i.zpp_next=e.geom.GeomPolyIterator.zpp_pool,e.geom.GeomPolyIterator.zpp_pool=i,i.zpp_inner=null,o=!1),!o)break;i.zpp_critical=!1;var s=i.zpp_inner.at(i.zpp_i++);this.has(s)||(this.zpp_inner.reverse_flag?this.push(s):this.unshift(s))}},e.geom.GeomPolyList.prototype.toString=function(){var t="[",n=!0;this.zpp_inner.valmod();for(var i=e.geom.GeomPolyIterator.get(this);;){i.zpp_inner.zpp_inner.valmod();var r=i.zpp_inner;r.zpp_inner.valmod(),r.zpp_inner.zip_length&&(r.zpp_inner.zip_length=!1,r.zpp_inner.user_length=r.zpp_inner.inner.length);var o,a=r.zpp_inner.user_length;if(i.zpp_critical=!0,i.zpp_i<a?o=!0:(i.zpp_next=e.geom.GeomPolyIterator.zpp_pool,e.geom.GeomPolyIterator.zpp_pool=i,i.zpp_inner=null,o=!1),!o)break;i.zpp_critical=!1;var s=i.zpp_inner.at(i.zpp_i++);n||(t+=","),t+=null==s?"NULL":s.toString(),n=!1}return t+"]"},e.geom.GeomPolyList.prototype.foreach=function(t){if(null==t)throw new n._Boot.HaxeError("Error: Cannot execute null on list elements");this.zpp_inner.valmod();for(var i=e.geom.GeomPolyIterator.get(this);;){i.zpp_inner.zpp_inner.valmod();var r=i.zpp_inner;r.zpp_inner.valmod(),r.zpp_inner.zip_length&&(r.zpp_inner.zip_length=!1,r.zpp_inner.user_length=r.zpp_inner.inner.length);var o,a=r.zpp_inner.user_length;if(i.zpp_critical=!0,i.zpp_i<a?o=!0:(i.zpp_next=e.geom.GeomPolyIterator.zpp_pool,e.geom.GeomPolyIterator.zpp_pool=i,i.zpp_inner=null,o=!1),!o)break;try{i.zpp_critical=!1,t(i.zpp_inner.at(i.zpp_i++))}catch(t){t instanceof n._Boot.HaxeError&&t.val,i.zpp_next=e.geom.GeomPolyIterator.zpp_pool,e.geom.GeomPolyIterator.zpp_pool=i,i.zpp_inner=null;break}}return this},e.geom.GeomPolyList.prototype.filter=function(e){if(null==e)throw new n._Boot.HaxeError("Error: Cannot select elements of list with null");for(var t=0;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t<this.zpp_inner.user_length;){var i=this.at(t);try{e(i)?++t:this.remove(i)}catch(e){e instanceof n._Boot.HaxeError&&e.val;break}}return this},e.geom.GeomPolyList.prototype.__class__=e.geom.GeomPolyList,e.geom.GeomVertexIterator=l["nape.geom.GeomVertexIterator"]=function(){if(!t.geom.ZPP_GeomVertexIterator.internal)throw new n._Boot.HaxeError("Error: Cannot instantiate GeomVertexIterator")},e.geom.GeomVertexIterator.__name__=["nape","geom","GeomVertexIterator"],e.geom.GeomVertexIterator.prototype.zpp_inner=null,e.geom.GeomVertexIterator.prototype.hasNext=function(){if(null==this.zpp_inner)throw new n._Boot.HaxeError("Error: Iterator has been disposed");var e=this.zpp_inner.ptr!=this.zpp_inner.start||this.zpp_inner.first;if(this.zpp_inner.first=!1,!e){var i=this.zpp_inner;i.outer.zpp_inner=null,i.ptr=i.start=null,i.next=t.geom.ZPP_GeomVertexIterator.zpp_pool,t.geom.ZPP_GeomVertexIterator.zpp_pool=i}return e},e.geom.GeomVertexIterator.prototype.next=function(){if(null==this.zpp_inner)throw new n._Boot.HaxeError("Error: Iterator has been disposed");var i=this.zpp_inner.ptr;if(null==i.wrap){var r,o=i.x,a=i.y;if(null==a&&(a=0),null==o&&(o=0),o!=o||a!=a)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null==t.util.ZPP_PubPool.poolVec2?r=new e.geom.Vec2:(r=t.util.ZPP_PubPool.poolVec2,t.util.ZPP_PubPool.poolVec2=r.zpp_pool,r.zpp_pool=null,r.zpp_disp=!1,r==t.util.ZPP_PubPool.nextVec2&&(t.util.ZPP_PubPool.nextVec2=null)),null==r.zpp_inner){var s;null==t.geom.ZPP_Vec2.zpp_pool?s=new t.geom.ZPP_Vec2:(s=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=s.next,s.next=null),s.weak=!1,s._immutable=!1,s.x=o,s.y=a,r.zpp_inner=s,r.zpp_inner.outer=r}else{if(null!=r&&r.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var l,u=r.zpp_inner;if(u._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=u._isimmutable&&u._isimmutable(),o!=o||a!=a)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null!=r&&r.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var h=r.zpp_inner;if(null!=h._validate&&h._validate(),r.zpp_inner.x==o){if(null!=r&&r.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var c=r.zpp_inner;null!=c._validate&&c._validate(),l=r.zpp_inner.y==a}else l=!1;if(!l){r.zpp_inner.x=o,r.zpp_inner.y=a;var _=r.zpp_inner;null!=_._invalidate&&_._invalidate(_)}}r.zpp_inner.weak=!1,i.wrap=r,i.wrap.zpp_inner._inuse=!0,i.wrap.zpp_inner._invalidate=p(i,i.modwrap),i.wrap.zpp_inner._validate=p(i,i.getwrap)}var d=i.wrap;return this.zpp_inner.ptr=this.zpp_inner.forward?this.zpp_inner.ptr.next:this.zpp_inner.ptr.prev,d},e.geom.GeomVertexIterator.prototype.__class__=e.geom.GeomVertexIterator,e.geom.MarchingSquares=l["nape.geom.MarchingSquares"]=function(){},e.geom.MarchingSquares.__name__=["nape","geom","MarchingSquares"],e.geom.MarchingSquares.run=function(i,r,o,a,s,l,p){if(null==l&&(l=!0),null==a&&(a=2),null!=o&&o.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");if(null!=s&&s.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");if(null==i)throw new n._Boot.HaxeError("Error: MarchingSquares requires an iso function to operate");if(null==r)throw new n._Boot.HaxeError("Error: MarchingSquares requires an AABB to define bounds of surface extraction");if(null==o)throw new n._Boot.HaxeError("Error: MarchingSquares requires a Vec2 to define cell size for surface extraction");var u;if(null!=o&&o.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var h,c=o.zpp_inner;if(null!=c._validate&&c._validate(),o.zpp_inner.x<=0)u=!0;else{if(null!=o&&o.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var _=o.zpp_inner;null!=_._validate&&_._validate(),u=o.zpp_inner.y<=0}if(u)throw new n._Boot.HaxeError("Error: MarchingSquares cannot operate with non-positive cell dimensions");if(a<0)throw new n._Boot.HaxeError("Error: MarchingSquares cannot use a negative quality value for interpolation");if(null!=s){if(null!=s&&s.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var d=s.zpp_inner;if(null!=d._validate&&d._validate(),s.zpp_inner.x<=0)h=!0;else{if(null!=s&&s.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var m=s.zpp_inner;null!=m._validate&&m._validate(),h=s.zpp_inner.y<=0}}else h=!1;if(h)throw new n._Boot.HaxeError("Error: MarchingSquares cannot with non-positive sub-grid dimensions");var P=null!=p?p:new e.geom.GeomPolyList;if(null==s){var f=r.zpp_inner;null!=f._validate&&f._validate();var x=r.zpp_inner.minx,y=r.zpp_inner;null!=y._validate&&y._validate();var v=r.zpp_inner.miny,g=r.zpp_inner.getmax();if(null!=g&&g.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var b=g.zpp_inner;null!=b._validate&&b._validate();var z=g.zpp_inner.x,w=r.zpp_inner.getmax();if(null!=w&&w.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var Z=w.zpp_inner;null!=Z._validate&&Z._validate(),t.geom.ZPP_MarchingSquares.run(i,x,v,z,w.zpp_inner.y,o,a,l,P)}else{var E=r.zpp_inner;null!=E._validate&&E._validate();var M=r.zpp_inner,S=M.maxx-M.minx;if(null!=s&&s.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var C=s.zpp_inner;null!=C._validate&&C._validate();var N=S/s.zpp_inner.x,A=r.zpp_inner;null!=A._validate&&A._validate();var L=r.zpp_inner,B=L.maxy-L.miny;if(null!=s&&s.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var T=s.zpp_inner;null!=T._validate&&T._validate();var V=B/s.zpp_inner.y,k=0|N,I=0|V;k!=N&&++k,I!=V&&++I;for(var O=0,R=k;O<R;){var H=O++,F=r.zpp_inner;null!=F._validate&&F._validate();var D=r.zpp_inner.minx;if(null!=s&&s.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var G=s.zpp_inner;null!=G._validate&&G._validate();var U,j=D+s.zpp_inner.x*H;if(H==k-1){var W=r.zpp_inner.getmax();if(null!=W&&W.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var q=W.zpp_inner;null!=q._validate&&q._validate(),U=W.zpp_inner.x}else{if(null!=s&&s.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var J=s.zpp_inner;null!=J._validate&&J._validate(),U=j+s.zpp_inner.x}for(var $=0,X=I;$<X;){var Y=$++,K=r.zpp_inner;null!=K._validate&&K._validate();var Q=r.zpp_inner.miny;if(null!=s&&s.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var ee=s.zpp_inner;null!=ee._validate&&ee._validate();var te,ne=Q+s.zpp_inner.y*Y;if(Y==I-1){var ie=r.zpp_inner.getmax();if(null!=ie&&ie.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var re=ie.zpp_inner;null!=re._validate&&re._validate(),te=ie.zpp_inner.y}else{if(null!=s&&s.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var oe=s.zpp_inner;null!=oe._validate&&oe._validate(),te=ne+s.zpp_inner.y}t.geom.ZPP_MarchingSquares.run(i,j,ne,U,te,o,a,l,P)}}}if(o.zpp_inner.weak){if(null!=o&&o.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var ae=o.zpp_inner;if(ae._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=ae._isimmutable&&ae._isimmutable(),o.zpp_inner._inuse)throw new n._Boot.HaxeError("Error: This Vec2 is not disposable");var se=o.zpp_inner;o.zpp_inner.outer=null,o.zpp_inner=null;var le=o;le.zpp_pool=null,null!=t.util.ZPP_PubPool.nextVec2?t.util.ZPP_PubPool.nextVec2.zpp_pool=le:t.util.ZPP_PubPool.poolVec2=le,t.util.ZPP_PubPool.nextVec2=le,le.zpp_disp=!0;var pe=se;null!=pe.outer&&(pe.outer.zpp_inner=null,pe.outer=null),pe._isimmutable=null,pe._validate=null,pe._invalidate=null,pe.next=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=pe}if(null!=s&&s.zpp_inner.weak){if(null!=s&&s.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var ue=s.zpp_inner;if(ue._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=ue._isimmutable&&ue._isimmutable(),s.zpp_inner._inuse)throw new n._Boot.HaxeError("Error: This Vec2 is not disposable");var he=s.zpp_inner;s.zpp_inner.outer=null,s.zpp_inner=null;var ce=s;ce.zpp_pool=null,null!=t.util.ZPP_PubPool.nextVec2?t.util.ZPP_PubPool.nextVec2.zpp_pool=ce:t.util.ZPP_PubPool.poolVec2=ce,t.util.ZPP_PubPool.nextVec2=ce,ce.zpp_disp=!0;var _e=he;null!=_e.outer&&(_e.outer.zpp_inner=null,_e.outer=null),_e._isimmutable=null,_e._validate=null,_e._invalidate=null,_e.next=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=_e}return P},e.geom.MarchingSquares.prototype.__class__=e.geom.MarchingSquares,e.geom.Mat23=l["nape.geom.Mat23"]=function(e,i,r,o,a,s){if(null==s&&(s=0),null==a&&(a=0),null==o&&(o=1),null==r&&(r=0),null==i&&(i=0),null==e&&(e=1),this.zpp_inner=null,this.zpp_inner=t.geom.ZPP_Mat23.get(),this.zpp_inner.outer=this,e!=e)throw new n._Boot.HaxeError("Error: Mat23::a cannot be NaN");this.zpp_inner.a=e;var l=this.zpp_inner;if(null!=l._invalidate&&l._invalidate(),i!=i)throw new n._Boot.HaxeError("Error: Mat23::b cannot be NaN");this.zpp_inner.b=i;var p=this.zpp_inner;if(null!=p._invalidate&&p._invalidate(),a!=a)throw new n._Boot.HaxeError("Error: Mat23::tx cannot be NaN");this.zpp_inner.tx=a;var u=this.zpp_inner;if(null!=u._invalidate&&u._invalidate(),r!=r)throw new n._Boot.HaxeError("Error: Mat23::c cannot be NaN");this.zpp_inner.c=r;var h=this.zpp_inner;if(null!=h._invalidate&&h._invalidate(),o!=o)throw new n._Boot.HaxeError("Error: Mat23::d cannot be NaN");this.zpp_inner.d=o;var c=this.zpp_inner;if(null!=c._invalidate&&c._invalidate(),s!=s)throw new n._Boot.HaxeError("Error: Mat23::ty cannot be NaN");this.zpp_inner.ty=s;var _=this.zpp_inner;null!=_._invalidate&&_._invalidate()},e.geom.Mat23.__name__=["nape","geom","Mat23"],e.geom.Mat23.rotation=function(t){if(t!=t)throw new n._Boot.HaxeError("Error: Cannot create rotation matrix with NaN angle");var i=Math.cos(t),r=Math.sin(t);return new e.geom.Mat23(i,-r,r,i,0,0)},e.geom.Mat23.translation=function(t,n){return new e.geom.Mat23(1,0,0,1,t,n)},e.geom.Mat23.scale=function(t,n){return new e.geom.Mat23(t,0,0,n,0,0)},e.geom.Mat23.prototype.zpp_inner=null,Object.defineProperty(e.geom.Mat23.prototype,"a",{get:e.geom.Mat23.prototype.get_a,set:e.geom.Mat23.prototype.set_a}),e.geom.Mat23.prototype.get_a=function(){return this.zpp_inner.a},e.geom.Mat23.prototype.set_a=function(e){if(e!=e)throw new n._Boot.HaxeError("Error: Mat23::a cannot be NaN");this.zpp_inner.a=e;var t=this.zpp_inner;return null!=t._invalidate&&t._invalidate(),this.zpp_inner.a},Object.defineProperty(e.geom.Mat23.prototype,"b",{get:e.geom.Mat23.prototype.get_b,set:e.geom.Mat23.prototype.set_b}),e.geom.Mat23.prototype.get_b=function(){return this.zpp_inner.b},e.geom.Mat23.prototype.set_b=function(e){if(e!=e)throw new n._Boot.HaxeError("Error: Mat23::b cannot be NaN");this.zpp_inner.b=e;var t=this.zpp_inner;return null!=t._invalidate&&t._invalidate(),this.zpp_inner.b},Object.defineProperty(e.geom.Mat23.prototype,"c",{get:e.geom.Mat23.prototype.get_c,set:e.geom.Mat23.prototype.set_c}),e.geom.Mat23.prototype.get_c=function(){return this.zpp_inner.c},e.geom.Mat23.prototype.set_c=function(e){if(e!=e)throw new n._Boot.HaxeError("Error: Mat23::c cannot be NaN");this.zpp_inner.c=e;var t=this.zpp_inner;return null!=t._invalidate&&t._invalidate(),this.zpp_inner.c},Object.defineProperty(e.geom.Mat23.prototype,"d",{get:e.geom.Mat23.prototype.get_d,set:e.geom.Mat23.prototype.set_d}),e.geom.Mat23.prototype.get_d=function(){return this.zpp_inner.d},e.geom.Mat23.prototype.set_d=function(e){if(e!=e)throw new n._Boot.HaxeError("Error: Mat23::d cannot be NaN");this.zpp_inner.d=e;var t=this.zpp_inner;return null!=t._invalidate&&t._invalidate(),this.zpp_inner.d},Object.defineProperty(e.geom.Mat23.prototype,"tx",{get:e.geom.Mat23.prototype.get_tx,set:e.geom.Mat23.prototype.set_tx}),e.geom.Mat23.prototype.get_tx=function(){return this.zpp_inner.tx},e.geom.Mat23.prototype.set_tx=function(e){if(e!=e)throw new n._Boot.HaxeError("Error: Mat23::tx cannot be NaN");this.zpp_inner.tx=e;var t=this.zpp_inner;return null!=t._invalidate&&t._invalidate(),this.zpp_inner.tx},Object.defineProperty(e.geom.Mat23.prototype,"ty",{get:e.geom.Mat23.prototype.get_ty,set:e.geom.Mat23.prototype.set_ty}),e.geom.Mat23.prototype.get_ty=function(){return this.zpp_inner.ty},e.geom.Mat23.prototype.set_ty=function(e){if(e!=e)throw new n._Boot.HaxeError("Error: Mat23::ty cannot be NaN");this.zpp_inner.ty=e;var t=this.zpp_inner;return null!=t._invalidate&&t._invalidate(),this.zpp_inner.ty},e.geom.Mat23.prototype.copy=function(){return new e.geom.Mat23(this.zpp_inner.a,this.zpp_inner.b,this.zpp_inner.c,this.zpp_inner.d,this.zpp_inner.tx,this.zpp_inner.ty)},e.geom.Mat23.prototype.set=function(e){if(null==e)throw new n._Boot.HaxeError("Error: Cannot set form null matrix");var t=e.zpp_inner;this.zpp_inner.setas(t.a,t.b,t.c,t.d,t.tx,t.ty);var i=this.zpp_inner;return null!=i._invalidate&&i._invalidate(),this},e.geom.Mat23.prototype.setAs=function(e,t,n,i,r,o){null==o&&(o=0),null==r&&(r=0),null==i&&(i=1),null==n&&(n=0),null==t&&(t=0),null==e&&(e=1),this.zpp_inner.setas(e,t,n,i,r,o);var a=this.zpp_inner;return null!=a._invalidate&&a._invalidate(),this},e.geom.Mat23.prototype.reset=function(){return this.setAs()},Object.defineProperty(e.geom.Mat23.prototype,"determinant",{get:e.geom.Mat23.prototype.get_determinant}),e.geom.Mat23.prototype.get_determinant=function(){return this.zpp_inner.a*this.zpp_inner.d-this.zpp_inner.b*this.zpp_inner.c},e.geom.Mat23.prototype.singular=function(){var t=this.zpp_inner.a*this.zpp_inner.a+this.zpp_inner.b*this.zpp_inner.b+this.zpp_inner.c*this.zpp_inner.c+this.zpp_inner.d*this.zpp_inner.d,n=this.zpp_inner.a*this.zpp_inner.d-this.zpp_inner.b*this.zpp_inner.c;return n<0&&(n=-n),t>e.Config.illConditionedThreshold*n},e.geom.Mat23.prototype.inverse=function(){if(this.singular())throw new n._Boot.HaxeError("Error: Matrix is singular and cannot be inverted");var t=1/(this.zpp_inner.a*this.zpp_inner.d-this.zpp_inner.b*this.zpp_inner.c);return new e.geom.Mat23(this.zpp_inner.d*t,-this.zpp_inner.b*t,-this.zpp_inner.c*t,this.zpp_inner.a*t,(this.zpp_inner.b*this.zpp_inner.ty-this.zpp_inner.d*this.zpp_inner.tx)*t,(this.zpp_inner.c*this.zpp_inner.tx-this.zpp_inner.a*this.zpp_inner.ty)*t)},e.geom.Mat23.prototype.transpose=function(){return new e.geom.Mat23(this.zpp_inner.a,this.zpp_inner.c,this.zpp_inner.b,this.zpp_inner.d,-this.zpp_inner.a*this.zpp_inner.tx-this.zpp_inner.c*this.zpp_inner.ty,-this.zpp_inner.b*this.zpp_inner.tx-this.zpp_inner.d*this.zpp_inner.ty)},e.geom.Mat23.prototype.concat=function(t){var i=t;if(null==i)throw new n._Boot.HaxeError("Error: Cannot concatenate with null Mat23");return new e.geom.Mat23(i.zpp_inner.a*this.zpp_inner.a+i.zpp_inner.b*this.zpp_inner.c,i.zpp_inner.a*this.zpp_inner.b+i.zpp_inner.b*this.zpp_inner.d,i.zpp_inner.c*this.zpp_inner.a+i.zpp_inner.d*this.zpp_inner.c,i.zpp_inner.c*this.zpp_inner.b+i.zpp_inner.d*this.zpp_inner.d,i.zpp_inner.a*this.zpp_inner.tx+i.zpp_inner.b*this.zpp_inner.ty+i.zpp_inner.tx,i.zpp_inner.c*this.zpp_inner.tx+i.zpp_inner.d*this.zpp_inner.ty+i.zpp_inner.ty)},e.geom.Mat23.prototype.transform=function(i,r,o){if(null==o&&(o=!1),null==r&&(r=!1),null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");if(null==i)throw new n._Boot.HaxeError("Error: Cannot transform null Vec2");var a;if(r){if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var s=i.zpp_inner;null!=s._validate&&s._validate();var l=i.zpp_inner.x*this.zpp_inner.a;if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var p=i.zpp_inner;null!=p._validate&&p._validate();var u=l+i.zpp_inner.y*this.zpp_inner.b;if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var h=i.zpp_inner;null!=h._validate&&h._validate();var c=i.zpp_inner.x*this.zpp_inner.c;if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var _=i.zpp_inner;null!=_._validate&&_._validate();var d,m=c+i.zpp_inner.y*this.zpp_inner.d,P=o;if(null==P&&(P=!1),null==m&&(m=0),null==u&&(u=0),u!=u||m!=m)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null==t.util.ZPP_PubPool.poolVec2?d=new e.geom.Vec2:(d=t.util.ZPP_PubPool.poolVec2,t.util.ZPP_PubPool.poolVec2=d.zpp_pool,d.zpp_pool=null,d.zpp_disp=!1,d==t.util.ZPP_PubPool.nextVec2&&(t.util.ZPP_PubPool.nextVec2=null)),null==d.zpp_inner){var f;null==t.geom.ZPP_Vec2.zpp_pool?f=new t.geom.ZPP_Vec2:(f=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=f.next,f.next=null),f.weak=!1,f._immutable=!1,f.x=u,f.y=m,d.zpp_inner=f,d.zpp_inner.outer=d}else{if(null!=d&&d.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var x,y=d.zpp_inner;if(y._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=y._isimmutable&&y._isimmutable(),u!=u||m!=m)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null!=d&&d.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var v=d.zpp_inner;if(null!=v._validate&&v._validate(),d.zpp_inner.x==u){if(null!=d&&d.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var g=d.zpp_inner;null!=g._validate&&g._validate(),x=d.zpp_inner.y==m}else x=!1;if(!x){d.zpp_inner.x=u,d.zpp_inner.y=m;var b=d.zpp_inner;null!=b._invalidate&&b._invalidate(b)}}d.zpp_inner.weak=P,a=d}else{if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var z=i.zpp_inner;null!=z._validate&&z._validate();var w=i.zpp_inner.x*this.zpp_inner.a;if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var Z=i.zpp_inner;null!=Z._validate&&Z._validate();var E=w+i.zpp_inner.y*this.zpp_inner.b+this.zpp_inner.tx;if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var M=i.zpp_inner;null!=M._validate&&M._validate();var S=i.zpp_inner.x*this.zpp_inner.c;if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var C=i.zpp_inner;null!=C._validate&&C._validate();var N,A=S+i.zpp_inner.y*this.zpp_inner.d+this.zpp_inner.ty,L=o;if(null==L&&(L=!1),null==A&&(A=0),null==E&&(E=0),E!=E||A!=A)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null==t.util.ZPP_PubPool.poolVec2?N=new e.geom.Vec2:(N=t.util.ZPP_PubPool.poolVec2,t.util.ZPP_PubPool.poolVec2=N.zpp_pool,N.zpp_pool=null,N.zpp_disp=!1,N==t.util.ZPP_PubPool.nextVec2&&(t.util.ZPP_PubPool.nextVec2=null)),null==N.zpp_inner){var B;null==t.geom.ZPP_Vec2.zpp_pool?B=new t.geom.ZPP_Vec2:(B=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=B.next,B.next=null),B.weak=!1,B._immutable=!1,B.x=E,B.y=A,N.zpp_inner=B,N.zpp_inner.outer=N}else{if(null!=N&&N.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var T,V=N.zpp_inner;if(V._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=V._isimmutable&&V._isimmutable(),E!=E||A!=A)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null!=N&&N.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var k=N.zpp_inner;if(null!=k._validate&&k._validate(),N.zpp_inner.x==E){if(null!=N&&N.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var I=N.zpp_inner;null!=I._validate&&I._validate(),T=N.zpp_inner.y==A}else T=!1;if(!T){N.zpp_inner.x=E,N.zpp_inner.y=A;var O=N.zpp_inner;null!=O._invalidate&&O._invalidate(O)}}N.zpp_inner.weak=L,a=N}if(i.zpp_inner.weak){if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var R=i.zpp_inner;if(R._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=R._isimmutable&&R._isimmutable(),i.zpp_inner._inuse)throw new n._Boot.HaxeError("Error: This Vec2 is not disposable");var H=i.zpp_inner;i.zpp_inner.outer=null,i.zpp_inner=null;var F=i;F.zpp_pool=null,null!=t.util.ZPP_PubPool.nextVec2?t.util.ZPP_PubPool.nextVec2.zpp_pool=F:t.util.ZPP_PubPool.poolVec2=F,t.util.ZPP_PubPool.nextVec2=F,F.zpp_disp=!0;var D=H;null!=D.outer&&(D.outer.zpp_inner=null,D.outer=null),D._isimmutable=null,D._validate=null,D._invalidate=null,D.next=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=D}return a},e.geom.Mat23.prototype.inverseTransform=function(i,r,o){if(null==o&&(o=!1),null==r&&(r=!1),null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");if(null==i)throw new n._Boot.HaxeError("Error: Cannot transform null Vec2");if(this.singular())throw new n._Boot.HaxeError("Error: Matrix is singular and inverse transformation cannot be performed");var a,s=1/(this.zpp_inner.a*this.zpp_inner.d-this.zpp_inner.b*this.zpp_inner.c);if(r){if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var l=i.zpp_inner;null!=l._validate&&l._validate();var p=i.zpp_inner.x*this.zpp_inner.d;if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var u=i.zpp_inner;null!=u._validate&&u._validate();var h=(p-i.zpp_inner.y*this.zpp_inner.b)*s;if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var c=i.zpp_inner;null!=c._validate&&c._validate();var _=i.zpp_inner.y*this.zpp_inner.a;if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var d=i.zpp_inner;null!=d._validate&&d._validate();var m,P=(_-i.zpp_inner.x*this.zpp_inner.c)*s,f=o;if(null==f&&(f=!1),null==P&&(P=0),null==h&&(h=0),h!=h||P!=P)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null==t.util.ZPP_PubPool.poolVec2?m=new e.geom.Vec2:(m=t.util.ZPP_PubPool.poolVec2,t.util.ZPP_PubPool.poolVec2=m.zpp_pool,m.zpp_pool=null,m.zpp_disp=!1,m==t.util.ZPP_PubPool.nextVec2&&(t.util.ZPP_PubPool.nextVec2=null)),null==m.zpp_inner){var x;null==t.geom.ZPP_Vec2.zpp_pool?x=new t.geom.ZPP_Vec2:(x=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=x.next,x.next=null),x.weak=!1,x._immutable=!1,x.x=h,x.y=P,m.zpp_inner=x,m.zpp_inner.outer=m}else{if(null!=m&&m.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var y,v=m.zpp_inner;if(v._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=v._isimmutable&&v._isimmutable(),h!=h||P!=P)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null!=m&&m.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var g=m.zpp_inner;if(null!=g._validate&&g._validate(),m.zpp_inner.x==h){if(null!=m&&m.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var b=m.zpp_inner;null!=b._validate&&b._validate(),y=m.zpp_inner.y==P}else y=!1;if(!y){m.zpp_inner.x=h,m.zpp_inner.y=P;var z=m.zpp_inner;null!=z._invalidate&&z._invalidate(z)}}m.zpp_inner.weak=f,a=m}else{if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var w=i.zpp_inner;null!=w._validate&&w._validate();var Z=i.zpp_inner.x-this.zpp_inner.tx;if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var E=i.zpp_inner;null!=E._validate&&E._validate();var M,S=i.zpp_inner.y-this.zpp_inner.ty,C=(Z*this.zpp_inner.d-S*this.zpp_inner.b)*s,N=(S*this.zpp_inner.a-Z*this.zpp_inner.c)*s,A=o;if(null==A&&(A=!1),null==N&&(N=0),null==C&&(C=0),C!=C||N!=N)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null==t.util.ZPP_PubPool.poolVec2?M=new e.geom.Vec2:(M=t.util.ZPP_PubPool.poolVec2,t.util.ZPP_PubPool.poolVec2=M.zpp_pool,M.zpp_pool=null,M.zpp_disp=!1,M==t.util.ZPP_PubPool.nextVec2&&(t.util.ZPP_PubPool.nextVec2=null)),null==M.zpp_inner){var L;null==t.geom.ZPP_Vec2.zpp_pool?L=new t.geom.ZPP_Vec2:(L=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=L.next,L.next=null),L.weak=!1,L._immutable=!1,L.x=C,L.y=N,M.zpp_inner=L,M.zpp_inner.outer=M}else{if(null!=M&&M.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var B,T=M.zpp_inner;if(T._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=T._isimmutable&&T._isimmutable(),C!=C||N!=N)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null!=M&&M.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var V=M.zpp_inner;if(null!=V._validate&&V._validate(),M.zpp_inner.x==C){if(null!=M&&M.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var k=M.zpp_inner;null!=k._validate&&k._validate(),B=M.zpp_inner.y==N}else B=!1;if(!B){M.zpp_inner.x=C,M.zpp_inner.y=N;var I=M.zpp_inner;null!=I._invalidate&&I._invalidate(I)}}M.zpp_inner.weak=A,a=M}if(i.zpp_inner.weak){if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var O=i.zpp_inner;if(O._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=O._isimmutable&&O._isimmutable(),i.zpp_inner._inuse)throw new n._Boot.HaxeError("Error: This Vec2 is not disposable");var R=i.zpp_inner;i.zpp_inner.outer=null,i.zpp_inner=null;var H=i;H.zpp_pool=null,null!=t.util.ZPP_PubPool.nextVec2?t.util.ZPP_PubPool.nextVec2.zpp_pool=H:t.util.ZPP_PubPool.poolVec2=H,t.util.ZPP_PubPool.nextVec2=H,H.zpp_disp=!0;var F=R;null!=F.outer&&(F.outer.zpp_inner=null,F.outer=null),F._isimmutable=null,F._validate=null,F._invalidate=null,F.next=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=F}return a},e.geom.Mat23.prototype.toString=function(){return"{ a: "+this.zpp_inner.a+" b: "+this.zpp_inner.b+" c: "+this.zpp_inner.c+" d: "+this.zpp_inner.d+" tx: "+this.zpp_inner.tx+" ty: "+this.zpp_inner.ty+" }"},e.geom.Mat23.prototype.equiorthogonal=function(){if(this.singular())return!1;var t=this.zpp_inner.a*this.zpp_inner.b+this.zpp_inner.c*this.zpp_inner.d;if(t*t<e.Config.epsilon){var n=this.zpp_inner.a*this.zpp_inner.a+this.zpp_inner.b*this.zpp_inner.b-this.zpp_inner.c*this.zpp_inner.c-this.zpp_inner.d*this.zpp_inner.d;return n*n<e.Config.epsilon}return!1},e.geom.Mat23.prototype.orthogonal=function(){var t=this.zpp_inner.a*this.zpp_inner.b+this.zpp_inner.c*this.zpp_inner.d;if(t*t<e.Config.epsilon){var n=this.zpp_inner.a*this.zpp_inner.a+this.zpp_inner.b*this.zpp_inner.b-1,i=this.zpp_inner.c*this.zpp_inner.c+this.zpp_inner.d*this.zpp_inner.d-1;return n*n<e.Config.epsilon&&i*i<e.Config.epsilon}return!1},e.geom.Mat23.prototype.equiorthogonalise=function(){if(!this.equiorthogonal()){var t=Math.sqrt(this.zpp_inner.a*this.zpp_inner.a+this.zpp_inner.c*this.zpp_inner.c),i=Math.sqrt(this.zpp_inner.b*this.zpp_inner.b+this.zpp_inner.d*this.zpp_inner.d);if(t*t<e.Config.epsilon||i*i<e.Config.epsilon)throw new n._Boot.HaxeError("Error: Matrix is singular and cannot be equiorthogonalised");var r=(t+i)/2;t=r/t,i=r/i;var o=this,a=o.zpp_inner.a*t;if(a!=a)throw new n._Boot.HaxeError("Error: Mat23::a cannot be NaN");o.zpp_inner.a=a;var s=o.zpp_inner;null!=s._invalidate&&s._invalidate();var l=this,p=l.zpp_inner.c*t;if(p!=p)throw new n._Boot.HaxeError("Error: Mat23::c cannot be NaN");l.zpp_inner.c=p;var u=l.zpp_inner;null!=u._invalidate&&u._invalidate();var h=this,c=h.zpp_inner.b*i;if(c!=c)throw new n._Boot.HaxeError("Error: Mat23::b cannot be NaN");h.zpp_inner.b=c;var _=h.zpp_inner;null!=_._invalidate&&_._invalidate();var d=this,m=d.zpp_inner.d*i;if(m!=m)throw new n._Boot.HaxeError("Error: Mat23::d cannot be NaN");d.zpp_inner.d=m;var P=d.zpp_inner;null!=P._invalidate&&P._invalidate();var f=this.zpp_inner.a*this.zpp_inner.b+this.zpp_inner.c*this.zpp_inner.d,x=.25*Math.PI-.5*Math.acos(f/(r*r));this.zpp_inner.a*this.zpp_inner.d-this.zpp_inner.b*this.zpp_inner.c>0&&(x=-x);var y=Math.sin(x),v=Math.cos(x),g=this.zpp_inner.a*v-this.zpp_inner.c*y,b=this.zpp_inner.b*v+this.zpp_inner.d*y,z=this.zpp_inner.c*v+this.zpp_inner.a*y;if(z!=z)throw new n._Boot.HaxeError("Error: Mat23::c cannot be NaN");this.zpp_inner.c=z;var w=this.zpp_inner;if(null!=w._invalidate&&w._invalidate(),g!=g)throw new n._Boot.HaxeError("Error: Mat23::a cannot be NaN");this.zpp_inner.a=g;var Z=this.zpp_inner;null!=Z._invalidate&&Z._invalidate();var E=this.zpp_inner.d*v-this.zpp_inner.b*y;if(E!=E)throw new n._Boot.HaxeError("Error: Mat23::d cannot be NaN");this.zpp_inner.d=E;var M=this.zpp_inner;if(null!=M._invalidate&&M._invalidate(),b!=b)throw new n._Boot.HaxeError("Error: Mat23::b cannot be NaN");this.zpp_inner.b=b;var S=this.zpp_inner;null!=S._invalidate&&S._invalidate();var C=this.zpp_inner;null!=C._invalidate&&C._invalidate()}return this},e.geom.Mat23.prototype.orthogonalise=function(){if(!this.orthogonal()){var t=Math.sqrt(this.zpp_inner.a*this.zpp_inner.a+this.zpp_inner.c*this.zpp_inner.c),i=Math.sqrt(this.zpp_inner.b*this.zpp_inner.b+this.zpp_inner.d*this.zpp_inner.d);if(t*t<e.Config.epsilon||i*i<e.Config.epsilon)throw new n._Boot.HaxeError("Error: Matrix is singular and cannot be orthogonalised");t=1/t,i=1/i;var r=this,o=r.zpp_inner.a*t;if(o!=o)throw new n._Boot.HaxeError("Error: Mat23::a cannot be NaN");r.zpp_inner.a=o;var a=r.zpp_inner;null!=a._invalidate&&a._invalidate();var s=this,l=s.zpp_inner.c*t;if(l!=l)throw new n._Boot.HaxeError("Error: Mat23::c cannot be NaN");s.zpp_inner.c=l;var p=s.zpp_inner;null!=p._invalidate&&p._invalidate();var u=this,h=u.zpp_inner.b*i;if(h!=h)throw new n._Boot.HaxeError("Error: Mat23::b cannot be NaN");u.zpp_inner.b=h;var c=u.zpp_inner;null!=c._invalidate&&c._invalidate();var _=this,d=_.zpp_inner.d*i;if(d!=d)throw new n._Boot.HaxeError("Error: Mat23::d cannot be NaN");_.zpp_inner.d=d;var m=_.zpp_inner;null!=m._invalidate&&m._invalidate();var P=this.zpp_inner.a*this.zpp_inner.b+this.zpp_inner.c*this.zpp_inner.d,f=.25*Math.PI-.5*Math.acos(P/1);this.zpp_inner.a*this.zpp_inner.d-this.zpp_inner.b*this.zpp_inner.c>0&&(f=-f);var x=Math.sin(f),y=Math.cos(f),v=this.zpp_inner.a*y-this.zpp_inner.c*x,g=this.zpp_inner.b*y+this.zpp_inner.d*x,b=this.zpp_inner.c*y+this.zpp_inner.a*x;if(b!=b)throw new n._Boot.HaxeError("Error: Mat23::c cannot be NaN");this.zpp_inner.c=b;var z=this.zpp_inner;if(null!=z._invalidate&&z._invalidate(),v!=v)throw new n._Boot.HaxeError("Error: Mat23::a cannot be NaN");this.zpp_inner.a=v;var w=this.zpp_inner;null!=w._invalidate&&w._invalidate();var Z=this.zpp_inner.d*y-this.zpp_inner.b*x;if(Z!=Z)throw new n._Boot.HaxeError("Error: Mat23::d cannot be NaN");this.zpp_inner.d=Z;var E=this.zpp_inner;if(null!=E._invalidate&&E._invalidate(),g!=g)throw new n._Boot.HaxeError("Error: Mat23::b cannot be NaN");this.zpp_inner.b=g;var M=this.zpp_inner;null!=M._invalidate&&M._invalidate();var S=this.zpp_inner;null!=S._invalidate&&S._invalidate()}return this},e.geom.Mat23.prototype.__class__=e.geom.Mat23,e.geom.MatMN=l["nape.geom.MatMN"]=function(e,i){if(this.zpp_inner=null,e<=0||i<=0)throw new n._Boot.HaxeError("Error: MatMN::dimensions cannot be < 1");this.zpp_inner=new t.geom.ZPP_MatMN(e,i),this.zpp_inner.outer=this},e.geom.MatMN.__name__=["nape","geom","MatMN"],e.geom.MatMN.prototype.zpp_inner=null,Object.defineProperty(e.geom.MatMN.prototype,"rows",{get:e.geom.MatMN.prototype.get_rows}),e.geom.MatMN.prototype.get_rows=function(){return this.zpp_inner.m},Object.defineProperty(e.geom.MatMN.prototype,"cols",{get:e.geom.MatMN.prototype.get_cols}),e.geom.MatMN.prototype.get_cols=function(){return this.zpp_inner.n},e.geom.MatMN.prototype.x=function(e,t){if(e<0||t<0||e>=this.zpp_inner.m||t>=this.zpp_inner.n)throw new n._Boot.HaxeError("Error: MatMN indices out of range");return this.zpp_inner.x[e*this.zpp_inner.n+t]},e.geom.MatMN.prototype.setx=function(e,t,i){if(e<0||t<0||e>=this.zpp_inner.m||t>=this.zpp_inner.n)throw new n._Boot.HaxeError("Error: MatMN indices out of range");return this.zpp_inner.x[e*this.zpp_inner.n+t]=i},e.geom.MatMN.prototype.toString=function(){for(var e="{ ",t=!0,i=0,r=this.zpp_inner.m;i<r;){var o=i++;t||(e+="; "),t=!1;for(var a=0,s=this.zpp_inner.n;a<s;){var l=a++;if(o<0||l<0||o>=this.zpp_inner.m||l>=this.zpp_inner.n)throw new n._Boot.HaxeError("Error: MatMN indices out of range");e+=this.zpp_inner.x[o*this.zpp_inner.n+l]+" "}}return e+"}"},e.geom.MatMN.prototype.transpose=function(){for(var t=new e.geom.MatMN(this.zpp_inner.n,this.zpp_inner.m),i=0,r=this.zpp_inner.m;i<r;)for(var o=i++,a=0,s=this.zpp_inner.n;a<s;){var l=a++;if(o<0||l<0||o>=this.zpp_inner.m||l>=this.zpp_inner.n)throw new n._Boot.HaxeError("Error: MatMN indices out of range");if(l<0||o<0||l>=t.zpp_inner.m||o>=t.zpp_inner.n)throw new n._Boot.HaxeError("Error: MatMN indices out of range");t.zpp_inner.x[l*t.zpp_inner.n+o]=this.zpp_inner.x[o*this.zpp_inner.n+l]}return t},e.geom.MatMN.prototype.mul=function(t){var i=t;if(this.zpp_inner.n!=i.zpp_inner.m)throw new n._Boot.HaxeError("Error: Matrix dimensions aren't compatible");for(var r=new e.geom.MatMN(this.zpp_inner.m,i.zpp_inner.n),o=0,a=this.zpp_inner.m;o<a;)for(var s=o++,l=0,p=i.zpp_inner.n;l<p;){for(var u=l++,h=0,c=0,_=this.zpp_inner.n;c<_;){var d=c++;if(s<0||d<0||s>=this.zpp_inner.m||d>=this.zpp_inner.n)throw new n._Boot.HaxeError("Error: MatMN indices out of range");if(d<0||u<0||d>=i.zpp_inner.m||u>=i.zpp_inner.n)throw new n._Boot.HaxeError("Error: MatMN indices out of range");h+=this.zpp_inner.x[s*this.zpp_inner.n+d]*i.zpp_inner.x[d*i.zpp_inner.n+u]}if(s<0||u<0||s>=r.zpp_inner.m||u>=r.zpp_inner.n)throw new n._Boot.HaxeError("Error: MatMN indices out of range");r.zpp_inner.x[s*r.zpp_inner.n+u]=h}return r},e.geom.MatMN.prototype.__class__=e.geom.MatMN,e.geom.Ray=l["nape.geom.Ray"]=function(e,i){if(this.zpp_inner=null,null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");if(this.zpp_inner=new t.geom.ZPP_Ray,null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");if(null==e)throw new n._Boot.HaxeError("Error: Ray::origin cannot be null");var r=this.zpp_inner.origin;if(null!=r&&r.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var o=r.zpp_inner;if(o._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=o._isimmutable&&o._isimmutable(),null==e)throw new n._Boot.HaxeError("Error: Cannot assign null Vec2");if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var a=e.zpp_inner;null!=a._validate&&a._validate();var s=e.zpp_inner.x;if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var l=e.zpp_inner;null!=l._validate&&l._validate();var p=e.zpp_inner.y;if(null!=r&&r.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var u,h=r.zpp_inner;if(h._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=h._isimmutable&&h._isimmutable(),s!=s||p!=p)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null!=r&&r.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var c=r.zpp_inner;if(null!=c._validate&&c._validate(),r.zpp_inner.x==s){if(null!=r&&r.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var _=r.zpp_inner;null!=_._validate&&_._validate(),u=r.zpp_inner.y==p}else u=!1;if(!u){r.zpp_inner.x=s,r.zpp_inner.y=p;var d=r.zpp_inner;null!=d._invalidate&&d._invalidate(d)}if(e.zpp_inner.weak){if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var m=e.zpp_inner;if(m._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=m._isimmutable&&m._isimmutable(),e.zpp_inner._inuse)throw new n._Boot.HaxeError("Error: This Vec2 is not disposable");var P=e.zpp_inner;e.zpp_inner.outer=null,e.zpp_inner=null;var f=e;f.zpp_pool=null,null!=t.util.ZPP_PubPool.nextVec2?t.util.ZPP_PubPool.nextVec2.zpp_pool=f:t.util.ZPP_PubPool.poolVec2=f,t.util.ZPP_PubPool.nextVec2=f,f.zpp_disp=!0;var x=P;null!=x.outer&&(x.outer.zpp_inner=null,x.outer=null),x._isimmutable=null,x._validate=null,x._invalidate=null,x.next=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=x}if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");if(null==i)throw new n._Boot.HaxeError("Error: Ray::direction cannot be null");var y=this.zpp_inner.direction;if(null!=y&&y.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var v=y.zpp_inner;if(v._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=v._isimmutable&&v._isimmutable(),null==i)throw new n._Boot.HaxeError("Error: Cannot assign null Vec2");if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var g=i.zpp_inner;null!=g._validate&&g._validate();var b=i.zpp_inner.x;if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var z=i.zpp_inner;null!=z._validate&&z._validate();var w=i.zpp_inner.y;if(null!=y&&y.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var Z,E=y.zpp_inner;if(E._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=E._isimmutable&&E._isimmutable(),b!=b||w!=w)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null!=y&&y.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var M=y.zpp_inner;if(null!=M._validate&&M._validate(),y.zpp_inner.x==b){if(null!=y&&y.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var S=y.zpp_inner;null!=S._validate&&S._validate(),Z=y.zpp_inner.y==w}else Z=!1;if(!Z){y.zpp_inner.x=b,y.zpp_inner.y=w;var C=y.zpp_inner;null!=C._invalidate&&C._invalidate(C)}if(i.zpp_inner.weak){if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var N=i.zpp_inner;if(N._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=N._isimmutable&&N._isimmutable(),i.zpp_inner._inuse)throw new n._Boot.HaxeError("Error: This Vec2 is not disposable");var A=i.zpp_inner;i.zpp_inner.outer=null,i.zpp_inner=null;var L=i;L.zpp_pool=null,null!=t.util.ZPP_PubPool.nextVec2?t.util.ZPP_PubPool.nextVec2.zpp_pool=L:t.util.ZPP_PubPool.poolVec2=L,t.util.ZPP_PubPool.nextVec2=L,L.zpp_disp=!0;var B=A;null!=B.outer&&(B.outer.zpp_inner=null,B.outer=null),B._isimmutable=null,B._validate=null,B._invalidate=null,B.next=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=B}this.zpp_inner.zip_dir=!0,this.zpp_inner.maxdist=1/0},e.geom.Ray.__name__=["nape","geom","Ray"],e.geom.Ray.fromSegment=function(i,r){if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");if(null!=r&&r.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");if(null==i)throw new n._Boot.HaxeError("Error: Ray::fromSegment::start is null");if(null==r)throw new n._Boot.HaxeError("Error: Ray::fromSegment::end is null");var o=r.sub(i,!0),a=new e.geom.Ray(i,o);if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var s=i.zpp_inner;null!=s._validate&&s._validate();var l=i.zpp_inner.x;if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var p=i.zpp_inner;null!=p._validate&&p._validate();var u=i.zpp_inner.y;if(null!=r&&r.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var h=r.zpp_inner;null!=h._validate&&h._validate();var c=r.zpp_inner.x;if(null!=r&&r.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var _,d,m=r.zpp_inner;null!=m._validate&&m._validate(),_=l-c,d=u-r.zpp_inner.y;var P=Math.sqrt(_*_+d*d);if(P!=P)throw new n._Boot.HaxeError("Error: maxDistance cannot be NaN");if(a.zpp_inner.maxdist=P,i.zpp_inner.weak){if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var f=i.zpp_inner;if(f._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=f._isimmutable&&f._isimmutable(),i.zpp_inner._inuse)throw new n._Boot.HaxeError("Error: This Vec2 is not disposable");var x=i.zpp_inner;i.zpp_inner.outer=null,i.zpp_inner=null;var y=i;y.zpp_pool=null,null!=t.util.ZPP_PubPool.nextVec2?t.util.ZPP_PubPool.nextVec2.zpp_pool=y:t.util.ZPP_PubPool.poolVec2=y,t.util.ZPP_PubPool.nextVec2=y,y.zpp_disp=!0;var v=x;null!=v.outer&&(v.outer.zpp_inner=null,v.outer=null),v._isimmutable=null,v._validate=null,v._invalidate=null,v.next=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=v}if(r.zpp_inner.weak){if(null!=r&&r.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var g=r.zpp_inner;if(g._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=g._isimmutable&&g._isimmutable(),r.zpp_inner._inuse)throw new n._Boot.HaxeError("Error: This Vec2 is not disposable");var b=r.zpp_inner;r.zpp_inner.outer=null,r.zpp_inner=null;var z=r;z.zpp_pool=null,null!=t.util.ZPP_PubPool.nextVec2?t.util.ZPP_PubPool.nextVec2.zpp_pool=z:t.util.ZPP_PubPool.poolVec2=z,t.util.ZPP_PubPool.nextVec2=z,z.zpp_disp=!0;var w=b;null!=w.outer&&(w.outer.zpp_inner=null,w.outer=null),w._isimmutable=null,w._validate=null,w._invalidate=null,w.next=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=w}return a},e.geom.Ray.prototype.zpp_inner=null,Object.defineProperty(e.geom.Ray.prototype,"userData",{get:e.geom.Ray.prototype.get_userData}),e.geom.Ray.prototype.get_userData=function(){return null==this.zpp_inner.userData&&(this.zpp_inner.userData={}),this.zpp_inner.userData},Object.defineProperty(e.geom.Ray.prototype,"origin",{get:e.geom.Ray.prototype.get_origin,set:e.geom.Ray.prototype.set_origin}),e.geom.Ray.prototype.get_origin=function(){return this.zpp_inner.origin},e.geom.Ray.prototype.set_origin=function(e){if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");if(null==e)throw new n._Boot.HaxeError("Error: Ray::origin cannot be null");var i=this.zpp_inner.origin;if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var r=i.zpp_inner;if(r._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=r._isimmutable&&r._isimmutable(),null==e)throw new n._Boot.HaxeError("Error: Cannot assign null Vec2");if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var o=e.zpp_inner;null!=o._validate&&o._validate();var a=e.zpp_inner.x;if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var s=e.zpp_inner;null!=s._validate&&s._validate();var l=e.zpp_inner.y;if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var p,u=i.zpp_inner;if(u._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=u._isimmutable&&u._isimmutable(),a!=a||l!=l)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var h=i.zpp_inner;if(null!=h._validate&&h._validate(),i.zpp_inner.x==a){if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var c=i.zpp_inner;null!=c._validate&&c._validate(),p=i.zpp_inner.y==l}else p=!1;if(!p){i.zpp_inner.x=a,i.zpp_inner.y=l;var _=i.zpp_inner;null!=_._invalidate&&_._invalidate(_)}if(e.zpp_inner.weak){if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var d=e.zpp_inner;if(d._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=d._isimmutable&&d._isimmutable(),e.zpp_inner._inuse)throw new n._Boot.HaxeError("Error: This Vec2 is not disposable");var m=e.zpp_inner;e.zpp_inner.outer=null,e.zpp_inner=null;var P=e;P.zpp_pool=null,null!=t.util.ZPP_PubPool.nextVec2?t.util.ZPP_PubPool.nextVec2.zpp_pool=P:t.util.ZPP_PubPool.poolVec2=P,t.util.ZPP_PubPool.nextVec2=P,P.zpp_disp=!0;var f=m;null!=f.outer&&(f.outer.zpp_inner=null,f.outer=null),f._isimmutable=null,f._validate=null,f._invalidate=null,f.next=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=f}return this.zpp_inner.origin},Object.defineProperty(e.geom.Ray.prototype,"direction",{get:e.geom.Ray.prototype.get_direction,set:e.geom.Ray.prototype.set_direction}),e.geom.Ray.prototype.get_direction=function(){return this.zpp_inner.direction},e.geom.Ray.prototype.set_direction=function(e){if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");if(null==e)throw new n._Boot.HaxeError("Error: Ray::direction cannot be null");var i=this.zpp_inner.direction;if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var r=i.zpp_inner;if(r._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=r._isimmutable&&r._isimmutable(),null==e)throw new n._Boot.HaxeError("Error: Cannot assign null Vec2");if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var o=e.zpp_inner;null!=o._validate&&o._validate();var a=e.zpp_inner.x;if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var s=e.zpp_inner;null!=s._validate&&s._validate();var l=e.zpp_inner.y;if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var p,u=i.zpp_inner;if(u._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=u._isimmutable&&u._isimmutable(),a!=a||l!=l)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var h=i.zpp_inner;if(null!=h._validate&&h._validate(),i.zpp_inner.x==a){if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var c=i.zpp_inner;null!=c._validate&&c._validate(),p=i.zpp_inner.y==l}else p=!1;if(!p){i.zpp_inner.x=a,i.zpp_inner.y=l;var _=i.zpp_inner;null!=_._invalidate&&_._invalidate(_)}if(e.zpp_inner.weak){if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var d=e.zpp_inner;if(d._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=d._isimmutable&&d._isimmutable(),e.zpp_inner._inuse)throw new n._Boot.HaxeError("Error: This Vec2 is not disposable");var m=e.zpp_inner;e.zpp_inner.outer=null,e.zpp_inner=null;var P=e;P.zpp_pool=null,null!=t.util.ZPP_PubPool.nextVec2?t.util.ZPP_PubPool.nextVec2.zpp_pool=P:t.util.ZPP_PubPool.poolVec2=P,t.util.ZPP_PubPool.nextVec2=P,P.zpp_disp=!0;var f=m;null!=f.outer&&(f.outer.zpp_inner=null,f.outer=null),f._isimmutable=null,f._validate=null,f._invalidate=null,f.next=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=f}return this.zpp_inner.zip_dir=!0,this.zpp_inner.direction},Object.defineProperty(e.geom.Ray.prototype,"maxDistance",{get:e.geom.Ray.prototype.get_maxDistance,set:e.geom.Ray.prototype.set_maxDistance}),e.geom.Ray.prototype.get_maxDistance=function(){return this.zpp_inner.maxdist},e.geom.Ray.prototype.set_maxDistance=function(e){if(e!=e)throw new n._Boot.HaxeError("Error: maxDistance cannot be NaN");return this.zpp_inner.maxdist=e,this.zpp_inner.maxdist},e.geom.Ray.prototype.aabb=function(){return this.zpp_inner.rayAABB().wrapper()},e.geom.Ray.prototype.at=function(i,r){null==r&&(r=!1),this.zpp_inner.validate_dir();var o=this.zpp_inner.origin;if(null!=o&&o.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var a=o.zpp_inner;null!=a._validate&&a._validate();var s=o.zpp_inner.x+i*this.zpp_inner.dirx,l=this.zpp_inner.origin;if(null!=l&&l.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var p=l.zpp_inner;null!=p._validate&&p._validate();var u,h=l.zpp_inner.y+i*this.zpp_inner.diry,c=r;if(null==c&&(c=!1),null==h&&(h=0),null==s&&(s=0),s!=s||h!=h)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null==t.util.ZPP_PubPool.poolVec2?u=new e.geom.Vec2:(u=t.util.ZPP_PubPool.poolVec2,t.util.ZPP_PubPool.poolVec2=u.zpp_pool,u.zpp_pool=null,u.zpp_disp=!1,u==t.util.ZPP_PubPool.nextVec2&&(t.util.ZPP_PubPool.nextVec2=null)),null==u.zpp_inner){var _;null==t.geom.ZPP_Vec2.zpp_pool?_=new t.geom.ZPP_Vec2:(_=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=_.next,_.next=null),_.weak=!1,_._immutable=!1,_.x=s,_.y=h,u.zpp_inner=_,u.zpp_inner.outer=u}else{if(null!=u&&u.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var d,m=u.zpp_inner;if(m._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=m._isimmutable&&m._isimmutable(),s!=s||h!=h)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null!=u&&u.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var P=u.zpp_inner;if(null!=P._validate&&P._validate(),u.zpp_inner.x==s){if(null!=u&&u.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var f=u.zpp_inner;null!=f._validate&&f._validate(),d=u.zpp_inner.y==h}else d=!1;if(!d){u.zpp_inner.x=s,u.zpp_inner.y=h;var x=u.zpp_inner;null!=x._invalidate&&x._invalidate(x)}}return u.zpp_inner.weak=c,u},e.geom.Ray.prototype.copy=function(){var t=new e.geom.Ray(this.zpp_inner.origin,this.zpp_inner.direction),i=this.zpp_inner.maxdist;if(i!=i)throw new n._Boot.HaxeError("Error: maxDistance cannot be NaN");return t.zpp_inner.maxdist=i,t},e.geom.Ray.prototype.__class__=e.geom.Ray,e.geom.RayResult=l["nape.geom.RayResult"]=function(){if(this.zpp_inner=null,!t.geom.ZPP_ConvexRayResult.internal)throw new n._Boot.HaxeError("Error: RayResult cannot be instantiated derp!")},e.geom.RayResult.__name__=["nape","geom","RayResult"],e.geom.RayResult.prototype.zpp_inner=null,Object.defineProperty(e.geom.RayResult.prototype,"normal",{get:e.geom.RayResult.prototype.get_normal}),e.geom.RayResult.prototype.get_normal=function(){if(null!=this.zpp_inner.next)throw new n._Boot.HaxeError("Error: This object has been disposed of and cannot be used");return this.zpp_inner.normal},Object.defineProperty(e.geom.RayResult.prototype,"distance",{get:e.geom.RayResult.prototype.get_distance}),e.geom.RayResult.prototype.get_distance=function(){if(null!=this.zpp_inner.next)throw new n._Boot.HaxeError("Error: This object has been disposed of and cannot be used");return this.zpp_inner.toiDistance},Object.defineProperty(e.geom.RayResult.prototype,"inner",{get:e.geom.RayResult.prototype.get_inner}),e.geom.RayResult.prototype.get_inner=function(){if(null!=this.zpp_inner.next)throw new n._Boot.HaxeError("Error: This object has been disposed of and cannot be used");return this.zpp_inner.inner},Object.defineProperty(e.geom.RayResult.prototype,"shape",{get:e.geom.RayResult.prototype.get_shape}),e.geom.RayResult.prototype.get_shape=function(){if(null!=this.zpp_inner.next)throw new n._Boot.HaxeError("Error: This object has been disposed of and cannot be used");return this.zpp_inner.shape},e.geom.RayResult.prototype.dispose=function(){if(null!=this.zpp_inner.next)throw new n._Boot.HaxeError("Error: This object has been disposed of and cannot be used");this.zpp_inner.free()},e.geom.RayResult.prototype.toString=function(){if(null!=this.zpp_inner.next)throw new n._Boot.HaxeError("Error: This object has been disposed of and cannot be used");if(null!=this.zpp_inner.next)throw new n._Boot.HaxeError("Error: This object has been disposed of and cannot be used");if(null!=this.zpp_inner.next)throw new n._Boot.HaxeError("Error: This object has been disposed of and cannot be used");if(null!=this.zpp_inner.next)throw new n._Boot.HaxeError("Error: This object has been disposed of and cannot be used");return"{ shape: "+i.string(this.zpp_inner.shape)+" distance: "+this.zpp_inner.toiDistance+" ?inner: "+i.string(this.zpp_inner.inner)+" }"},e.geom.RayResult.prototype.__class__=e.geom.RayResult,e.geom.RayResultIterator=l["nape.geom.RayResultIterator"]=function(){if(this.zpp_next=null,this.zpp_critical=!1,this.zpp_i=0,this.zpp_inner=null,!t.util.ZPP_RayResultList.internal)throw new n._Boot.HaxeError("Error: Cannot instantiate RayResultIterator derp!")},e.geom.RayResultIterator.__name__=["nape","geom","RayResultIterator"],e.geom.RayResultIterator.get=function(n){var i;if(null==e.geom.RayResultIterator.zpp_pool){t.util.ZPP_RayResultList.internal=!0;var r=new e.geom.RayResultIterator;t.util.ZPP_RayResultList.internal=!1,i=r}else{var o=e.geom.RayResultIterator.zpp_pool;e.geom.RayResultIterator.zpp_pool=o.zpp_next,i=o}return i.zpp_i=0,i.zpp_inner=n,i.zpp_critical=!1,i},e.geom.RayResultIterator.prototype.zpp_inner=null,e.geom.RayResultIterator.prototype.zpp_i=null,e.geom.RayResultIterator.prototype.zpp_critical=null,e.geom.RayResultIterator.prototype.zpp_next=null,e.geom.RayResultIterator.prototype.hasNext=function(){this.zpp_inner.zpp_inner.valmod();var t=this.zpp_inner;t.zpp_inner.valmod(),t.zpp_inner.zip_length&&(t.zpp_inner.zip_length=!1,t.zpp_inner.user_length=t.zpp_inner.inner.length);var n=t.zpp_inner.user_length;return this.zpp_critical=!0,this.zpp_i<n||(this.zpp_next=e.geom.RayResultIterator.zpp_pool,e.geom.RayResultIterator.zpp_pool=this,this.zpp_inner=null,!1)},e.geom.RayResultIterator.prototype.next=function(){return this.zpp_critical=!1,this.zpp_inner.at(this.zpp_i++)},e.geom.RayResultIterator.prototype.__class__=e.geom.RayResultIterator,e.geom.RayResultList=l["nape.geom.RayResultList"]=function(){this.zpp_inner=null,this.zpp_inner=new t.util.ZPP_RayResultList,this.zpp_inner.outer=this},e.geom.RayResultList.__name__=["nape","geom","RayResultList"],e.geom.RayResultList.fromArray=function(t){if(null==t)throw new n._Boot.HaxeError("Error: Cannot convert null Array to Nape list");for(var i=new e.geom.RayResultList,r=0;r<t.length;){var o=t[r];++r,i.push(o)}return i},e.geom.RayResultList.prototype.zpp_inner=null,Object.defineProperty(e.geom.RayResultList.prototype,"length",{get:e.geom.RayResultList.prototype.get_length}),e.geom.RayResultList.prototype.get_length=function(){return this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.user_length},e.geom.RayResultList.prototype.has=function(e){return this.zpp_inner.valmod(),this.zpp_inner.inner.has(e)},e.geom.RayResultList.prototype.at=function(e){var t;if(this.zpp_inner.valmod(),e>=0?(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t=e>=this.zpp_inner.user_length):t=!0,t)throw new n._Boot.HaxeError("Error: Index out of bounds");if(this.zpp_inner.reverse_flag&&(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),e=this.zpp_inner.user_length-1-e),e<this.zpp_inner.at_index||null==this.zpp_inner.at_ite)this.zpp_inner.at_index=e,this.zpp_inner.at_ite=this.zpp_inner.inner.iterator_at(e);else for(;this.zpp_inner.at_index!=e;)this.zpp_inner.at_index++,this.zpp_inner.at_ite=this.zpp_inner.at_ite.next;return this.zpp_inner.at_ite.elt},e.geom.RayResultList.prototype.push=function(e){if(this.zpp_inner.immutable)throw new n._Boot.HaxeError("Error: RayResultList is immutable");this.zpp_inner.modify_test(),this.zpp_inner.valmod();var t=null==this.zpp_inner.adder||this.zpp_inner.adder(e);if(t){if(this.zpp_inner.reverse_flag)this.zpp_inner.inner.add(e);else{if(null==this.zpp_inner.push_ite){var i;if(null==this.zpp_inner.inner.head)i=null;else{var r=this.zpp_inner.inner;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),i=r.iterator_at(this.zpp_inner.user_length-1)}this.zpp_inner.push_ite=i}this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,e)}this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(e)}return t},e.geom.RayResultList.prototype.unshift=function(e){if(this.zpp_inner.immutable)throw new n._Boot.HaxeError("Error: RayResultList is immutable");this.zpp_inner.modify_test(),this.zpp_inner.valmod();var t=null==this.zpp_inner.adder||this.zpp_inner.adder(e);if(t){if(this.zpp_inner.reverse_flag){if(null==this.zpp_inner.push_ite){var i;if(null==this.zpp_inner.inner.head)i=null;else{var r=this.zpp_inner.inner;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),i=r.iterator_at(this.zpp_inner.user_length-1)}this.zpp_inner.push_ite=i}this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,e)}else this.zpp_inner.inner.add(e);this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(e)}return t},e.geom.RayResultList.prototype.pop=function(){if(this.zpp_inner.immutable)throw new n._Boot.HaxeError("Error: RayResultList is immutable");if(this.zpp_inner.modify_test(),null==this.zpp_inner.inner.head)throw new n._Boot.HaxeError("Error: Cannot remove from empty list");this.zpp_inner.valmod();var e=null;if(this.zpp_inner.reverse_flag){var t=e=this.zpp_inner.inner.head.elt;null!=this.zpp_inner.subber&&this.zpp_inner.subber(t),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()}else{var i;if(null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null),this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),1==this.zpp_inner.user_length)i=null;else{var r=this.zpp_inner.inner;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),i=r.iterator_at(this.zpp_inner.user_length-2)}var o=e=null==i?this.zpp_inner.inner.head.elt:i.next.elt;null!=this.zpp_inner.subber&&this.zpp_inner.subber(o),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(i)}return this.zpp_inner.invalidate(),e},e.geom.RayResultList.prototype.shift=function(){if(this.zpp_inner.immutable)throw new n._Boot.HaxeError("Error: RayResultList is immutable");if(this.zpp_inner.modify_test(),null==this.zpp_inner.inner.head)throw new n._Boot.HaxeError("Error: Cannot remove from empty list");this.zpp_inner.valmod();var e=null;if(this.zpp_inner.reverse_flag){var t;if(null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null),this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),1==this.zpp_inner.user_length)t=null;else{var i=this.zpp_inner.inner;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t=i.iterator_at(this.zpp_inner.user_length-2)}var r=e=null==t?this.zpp_inner.inner.head.elt:t.next.elt;null!=this.zpp_inner.subber&&this.zpp_inner.subber(r),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(t)}else{var o=e=this.zpp_inner.inner.head.elt;null!=this.zpp_inner.subber&&this.zpp_inner.subber(o),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()}return this.zpp_inner.invalidate(),e},e.geom.RayResultList.prototype.add=function(e){return this.zpp_inner.reverse_flag?this.push(e):this.unshift(e)},e.geom.RayResultList.prototype.remove=function(e){if(this.zpp_inner.immutable)throw new n._Boot.HaxeError("Error: RayResultList is immutable");var t;this.zpp_inner.modify_test(),this.zpp_inner.valmod(),t=!1;for(var i=this.zpp_inner.inner.head;null!=i;){if(i.elt==e){t=!0;break}i=i.next}return t&&(null!=this.zpp_inner.subber&&this.zpp_inner.subber(e),this.zpp_inner.dontremove||this.zpp_inner.inner.remove(e),this.zpp_inner.invalidate()),t},e.geom.RayResultList.prototype.clear=function(){if(this.zpp_inner.immutable)throw new n._Boot.HaxeError("Error: RayResultList is immutable");if(this.zpp_inner.reverse_flag)for(;null!=this.zpp_inner.inner.head;)this.pop();else for(;null!=this.zpp_inner.inner.head;)this.shift()},e.geom.RayResultList.prototype.empty=function(){return null==this.zpp_inner.inner.head},e.geom.RayResultList.prototype.iterator=function(){return this.zpp_inner.valmod(),e.geom.RayResultIterator.get(this)},e.geom.RayResultList.prototype.copy=function(t){null==t&&(t=!1);var i=new e.geom.RayResultList;this.zpp_inner.valmod();for(var r=e.geom.RayResultIterator.get(this);;){r.zpp_inner.zpp_inner.valmod();var o=r.zpp_inner;o.zpp_inner.valmod(),o.zpp_inner.zip_length&&(o.zpp_inner.zip_length=!1,o.zpp_inner.user_length=o.zpp_inner.inner.length);var a,s=o.zpp_inner.user_length;if(r.zpp_critical=!0,r.zpp_i<s?a=!0:(r.zpp_next=e.geom.RayResultIterator.zpp_pool,e.geom.RayResultIterator.zpp_pool=r,r.zpp_inner=null,a=!1),!a)break;r.zpp_critical=!1;var l,p=r.zpp_inner.at(r.zpp_i++);if(t)throw new n._Boot.HaxeError("Error: RayResult is not a copyable type");l=p,i.push(l)}return i},e.geom.RayResultList.prototype.merge=function(t){if(null==t)throw new n._Boot.HaxeError("Error: Cannot merge with null list");t.zpp_inner.valmod();for(var i=e.geom.RayResultIterator.get(t);;){i.zpp_inner.zpp_inner.valmod();var r=i.zpp_inner;r.zpp_inner.valmod(),r.zpp_inner.zip_length&&(r.zpp_inner.zip_length=!1,r.zpp_inner.user_length=r.zpp_inner.inner.length);var o,a=r.zpp_inner.user_length;if(i.zpp_critical=!0,i.zpp_i<a?o=!0:(i.zpp_next=e.geom.RayResultIterator.zpp_pool,e.geom.RayResultIterator.zpp_pool=i,i.zpp_inner=null,o=!1),!o)break;i.zpp_critical=!1;var s=i.zpp_inner.at(i.zpp_i++);this.has(s)||(this.zpp_inner.reverse_flag?this.push(s):this.unshift(s))}},e.geom.RayResultList.prototype.toString=function(){var t="[",n=!0;this.zpp_inner.valmod();for(var i=e.geom.RayResultIterator.get(this);;){i.zpp_inner.zpp_inner.valmod();var r=i.zpp_inner;r.zpp_inner.valmod(),r.zpp_inner.zip_length&&(r.zpp_inner.zip_length=!1,r.zpp_inner.user_length=r.zpp_inner.inner.length);var o,a=r.zpp_inner.user_length;if(i.zpp_critical=!0,i.zpp_i<a?o=!0:(i.zpp_next=e.geom.RayResultIterator.zpp_pool,e.geom.RayResultIterator.zpp_pool=i,i.zpp_inner=null,o=!1),!o)break;i.zpp_critical=!1;var s=i.zpp_inner.at(i.zpp_i++);n||(t+=","),t+=null==s?"NULL":s.toString(),n=!1}return t+"]"},e.geom.RayResultList.prototype.foreach=function(t){if(null==t)throw new n._Boot.HaxeError("Error: Cannot execute null on list elements");this.zpp_inner.valmod();for(var i=e.geom.RayResultIterator.get(this);;){i.zpp_inner.zpp_inner.valmod();var r=i.zpp_inner;r.zpp_inner.valmod(),r.zpp_inner.zip_length&&(r.zpp_inner.zip_length=!1,r.zpp_inner.user_length=r.zpp_inner.inner.length);var o,a=r.zpp_inner.user_length;if(i.zpp_critical=!0,i.zpp_i<a?o=!0:(i.zpp_next=e.geom.RayResultIterator.zpp_pool,e.geom.RayResultIterator.zpp_pool=i,i.zpp_inner=null,o=!1),!o)break;try{i.zpp_critical=!1,t(i.zpp_inner.at(i.zpp_i++))}catch(t){t instanceof n._Boot.HaxeError&&t.val,i.zpp_next=e.geom.RayResultIterator.zpp_pool,e.geom.RayResultIterator.zpp_pool=i,i.zpp_inner=null;break}}return this},e.geom.RayResultList.prototype.filter=function(e){if(null==e)throw new n._Boot.HaxeError("Error: Cannot select elements of list with null");for(var t=0;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t<this.zpp_inner.user_length;){var i=this.at(t);try{e(i)?++t:this.remove(i)}catch(e){e instanceof n._Boot.HaxeError&&e.val;break}}return this},e.geom.RayResultList.prototype.__class__=e.geom.RayResultList,e.geom.Vec2=l["nape.geom.Vec2"]=function(e,i){if(null==i&&(i=0),null==e&&(e=0),this.zpp_pool=null,this.zpp_inner=null,e!=e||i!=i)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");var r;null==t.geom.ZPP_Vec2.zpp_pool?r=new t.geom.ZPP_Vec2:(r=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=r.next,r.next=null),r.weak=!1,r._immutable=!1,r.x=e,r.y=i,this.zpp_inner=r,this.zpp_inner.outer=this},e.geom.Vec2.__name__=["nape","geom","Vec2"],e.geom.Vec2.weak=function(i,r){null==r&&(r=0),null==i&&(i=0);var o,a=i,s=r;if(null==s&&(s=0),null==a&&(a=0),a!=a||s!=s)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null==t.util.ZPP_PubPool.poolVec2?o=new e.geom.Vec2:(o=t.util.ZPP_PubPool.poolVec2,t.util.ZPP_PubPool.poolVec2=o.zpp_pool,o.zpp_pool=null,o.zpp_disp=!1,o==t.util.ZPP_PubPool.nextVec2&&(t.util.ZPP_PubPool.nextVec2=null)),null==o.zpp_inner){var l;null==t.geom.ZPP_Vec2.zpp_pool?l=new t.geom.ZPP_Vec2:(l=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=l.next,l.next=null),l.weak=!1,l._immutable=!1,l.x=a,l.y=s,o.zpp_inner=l,o.zpp_inner.outer=o}else{if(null!=o&&o.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var p,u=o.zpp_inner;if(u._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=u._isimmutable&&u._isimmutable(),a!=a||s!=s)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null!=o&&o.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var h=o.zpp_inner;if(null!=h._validate&&h._validate(),o.zpp_inner.x==a){if(null!=o&&o.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var c=o.zpp_inner;null!=c._validate&&c._validate(),p=o.zpp_inner.y==s}else p=!1;if(!p){o.zpp_inner.x=a,o.zpp_inner.y=s;var _=o.zpp_inner;null!=_._invalidate&&_._invalidate(_)}}return o.zpp_inner.weak=!0,o},e.geom.Vec2.get=function(i,r,o){if(null==o&&(o=!1),null==r&&(r=0),null==i&&(i=0),i!=i||r!=r)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");var a;if(null==t.util.ZPP_PubPool.poolVec2?a=new e.geom.Vec2:(a=t.util.ZPP_PubPool.poolVec2,t.util.ZPP_PubPool.poolVec2=a.zpp_pool,a.zpp_pool=null,a.zpp_disp=!1,a==t.util.ZPP_PubPool.nextVec2&&(t.util.ZPP_PubPool.nextVec2=null)),null==a.zpp_inner){var s;null==t.geom.ZPP_Vec2.zpp_pool?s=new t.geom.ZPP_Vec2:(s=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=s.next,s.next=null),s.weak=!1,s._immutable=!1,s.x=i,s.y=r,a.zpp_inner=s,a.zpp_inner.outer=a}else{if(null!=a&&a.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var l,p=a.zpp_inner;if(p._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=p._isimmutable&&p._isimmutable(),i!=i||r!=r)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null!=a&&a.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var u=a.zpp_inner;if(null!=u._validate&&u._validate(),a.zpp_inner.x==i){if(null!=a&&a.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var h=a.zpp_inner;null!=h._validate&&h._validate(),l=a.zpp_inner.y==r}else l=!1;if(!l){a.zpp_inner.x=i,a.zpp_inner.y=r;var c=a.zpp_inner;null!=c._invalidate&&c._invalidate(c)}}return a.zpp_inner.weak=o,a},e.geom.Vec2.fromPolar=function(i,r,o){if(null==o&&(o=!1),i!=i)throw new n._Boot.HaxeError("Error: Vec2::length cannot be NaN");if(r!=r)throw new n._Boot.HaxeError("Error: Vec2::angle cannot be NaN");var a,s=i*Math.cos(r),l=i*Math.sin(r),p=o;if(null==p&&(p=!1),null==l&&(l=0),null==s&&(s=0),s!=s||l!=l)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null==t.util.ZPP_PubPool.poolVec2?a=new e.geom.Vec2:(a=t.util.ZPP_PubPool.poolVec2,t.util.ZPP_PubPool.poolVec2=a.zpp_pool,a.zpp_pool=null,a.zpp_disp=!1,a==t.util.ZPP_PubPool.nextVec2&&(t.util.ZPP_PubPool.nextVec2=null)),null==a.zpp_inner){var u;null==t.geom.ZPP_Vec2.zpp_pool?u=new t.geom.ZPP_Vec2:(u=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=u.next,u.next=null),u.weak=!1,u._immutable=!1,u.x=s,u.y=l,a.zpp_inner=u,a.zpp_inner.outer=a}else{if(null!=a&&a.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var h,c=a.zpp_inner;if(c._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=c._isimmutable&&c._isimmutable(),s!=s||l!=l)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null!=a&&a.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var _=a.zpp_inner;if(null!=_._validate&&_._validate(),a.zpp_inner.x==s){if(null!=a&&a.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var d=a.zpp_inner;null!=d._validate&&d._validate(),h=a.zpp_inner.y==l}else h=!1;if(!h){a.zpp_inner.x=s,a.zpp_inner.y=l;var m=a.zpp_inner;null!=m._invalidate&&m._invalidate(m)}}return a.zpp_inner.weak=p,a},e.geom.Vec2.dsq=function(e,i){if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");if(null==e||null==i)throw new n._Boot.HaxeError("Error: Cannot compute squared distance between null Vec2");if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var r=e.zpp_inner;null!=r._validate&&r._validate();var o=e.zpp_inner.x;if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var a=e.zpp_inner;null!=a._validate&&a._validate();var s=e.zpp_inner.y;if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var l=i.zpp_inner;null!=l._validate&&l._validate();var p=i.zpp_inner.x;if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var u=i.zpp_inner;null!=u._validate&&u._validate();var h,c,_=(h=o-p)*h+(c=s-i.zpp_inner.y)*c;if(e.zpp_inner.weak){if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var d=e.zpp_inner;if(d._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=d._isimmutable&&d._isimmutable(),e.zpp_inner._inuse)throw new n._Boot.HaxeError("Error: This Vec2 is not disposable");var m=e.zpp_inner;e.zpp_inner.outer=null,e.zpp_inner=null;var P=e;P.zpp_pool=null,null!=t.util.ZPP_PubPool.nextVec2?t.util.ZPP_PubPool.nextVec2.zpp_pool=P:t.util.ZPP_PubPool.poolVec2=P,t.util.ZPP_PubPool.nextVec2=P,P.zpp_disp=!0;var f=m;null!=f.outer&&(f.outer.zpp_inner=null,f.outer=null),f._isimmutable=null,f._validate=null,f._invalidate=null,f.next=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=f}if(i.zpp_inner.weak){if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var x=i.zpp_inner;if(x._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=x._isimmutable&&x._isimmutable(),i.zpp_inner._inuse)throw new n._Boot.HaxeError("Error: This Vec2 is not disposable");var y=i.zpp_inner;i.zpp_inner.outer=null,i.zpp_inner=null;var v=i;v.zpp_pool=null,null!=t.util.ZPP_PubPool.nextVec2?t.util.ZPP_PubPool.nextVec2.zpp_pool=v:t.util.ZPP_PubPool.poolVec2=v,t.util.ZPP_PubPool.nextVec2=v,v.zpp_disp=!0;var g=y;null!=g.outer&&(g.outer.zpp_inner=null,g.outer=null),g._isimmutable=null,g._validate=null,g._invalidate=null,g.next=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=g}return _},e.geom.Vec2.distance=function(e,i){if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");if(null==e||null==i)throw new n._Boot.HaxeError("Error: Cannot compute squared distance between null Vec2");if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var r=e.zpp_inner;null!=r._validate&&r._validate();var o=e.zpp_inner.x;if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var a=e.zpp_inner;null!=a._validate&&a._validate();var s=e.zpp_inner.y;if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var l=i.zpp_inner;null!=l._validate&&l._validate();var p=i.zpp_inner.x;if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var u,h,c=i.zpp_inner;null!=c._validate&&c._validate(),u=o-p,h=s-i.zpp_inner.y;var _=Math.sqrt(u*u+h*h);if(e.zpp_inner.weak){if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var d=e.zpp_inner;if(d._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=d._isimmutable&&d._isimmutable(),e.zpp_inner._inuse)throw new n._Boot.HaxeError("Error: This Vec2 is not disposable");var m=e.zpp_inner;e.zpp_inner.outer=null,e.zpp_inner=null;var P=e;P.zpp_pool=null,null!=t.util.ZPP_PubPool.nextVec2?t.util.ZPP_PubPool.nextVec2.zpp_pool=P:t.util.ZPP_PubPool.poolVec2=P,t.util.ZPP_PubPool.nextVec2=P,P.zpp_disp=!0;var f=m;null!=f.outer&&(f.outer.zpp_inner=null,f.outer=null),f._isimmutable=null,f._validate=null,f._invalidate=null,f.next=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=f}if(i.zpp_inner.weak){if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var x=i.zpp_inner;if(x._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=x._isimmutable&&x._isimmutable(),i.zpp_inner._inuse)throw new n._Boot.HaxeError("Error: This Vec2 is not disposable");var y=i.zpp_inner;i.zpp_inner.outer=null,i.zpp_inner=null;var v=i;v.zpp_pool=null,null!=t.util.ZPP_PubPool.nextVec2?t.util.ZPP_PubPool.nextVec2.zpp_pool=v:t.util.ZPP_PubPool.poolVec2=v,t.util.ZPP_PubPool.nextVec2=v,v.zpp_disp=!0;var g=y;null!=g.outer&&(g.outer.zpp_inner=null,g.outer=null),g._isimmutable=null,g._validate=null,g._invalidate=null,g.next=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=g}return _},e.geom.Vec2.prototype.zpp_inner=null,e.geom.Vec2.prototype.zpp_pool=null,e.geom.Vec2.prototype.zpp_disp=null,e.geom.Vec2.prototype.dispose=function(){if(this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var e=this.zpp_inner;if(e._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=e._isimmutable&&e._isimmutable(),this.zpp_inner._inuse)throw new n._Boot.HaxeError("Error: This Vec2 is not disposable");var i=this.zpp_inner;this.zpp_inner.outer=null,this.zpp_inner=null;var r=this;r.zpp_pool=null,null!=t.util.ZPP_PubPool.nextVec2?t.util.ZPP_PubPool.nextVec2.zpp_pool=r:t.util.ZPP_PubPool.poolVec2=r,t.util.ZPP_PubPool.nextVec2=r,r.zpp_disp=!0;var o=i;null!=o.outer&&(o.outer.zpp_inner=null,o.outer=null),o._isimmutable=null,o._validate=null,o._invalidate=null,o.next=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=o},e.geom.Vec2.prototype.copy=function(i){if(null==i&&(i=!1),this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");if(this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var r=this.zpp_inner;null!=r._validate&&r._validate();var o=this.zpp_inner.x;if(this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var a=this.zpp_inner;null!=a._validate&&a._validate();var s,l=this.zpp_inner.y,p=i;if(null==p&&(p=!1),null==l&&(l=0),null==o&&(o=0),o!=o||l!=l)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null==t.util.ZPP_PubPool.poolVec2?s=new e.geom.Vec2:(s=t.util.ZPP_PubPool.poolVec2,t.util.ZPP_PubPool.poolVec2=s.zpp_pool,s.zpp_pool=null,s.zpp_disp=!1,s==t.util.ZPP_PubPool.nextVec2&&(t.util.ZPP_PubPool.nextVec2=null)),null==s.zpp_inner){var u;null==t.geom.ZPP_Vec2.zpp_pool?u=new t.geom.ZPP_Vec2:(u=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=u.next,u.next=null),u.weak=!1,u._immutable=!1,u.x=o,u.y=l,s.zpp_inner=u,s.zpp_inner.outer=s}else{if(null!=s&&s.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var h,c=s.zpp_inner;if(c._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=c._isimmutable&&c._isimmutable(),o!=o||l!=l)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null!=s&&s.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var _=s.zpp_inner;if(null!=_._validate&&_._validate(),s.zpp_inner.x==o){if(null!=s&&s.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var d=s.zpp_inner;null!=d._validate&&d._validate(),h=s.zpp_inner.y==l}else h=!1;if(!h){s.zpp_inner.x=o,s.zpp_inner.y=l;var m=s.zpp_inner;null!=m._invalidate&&m._invalidate(m)}}return s.zpp_inner.weak=p,s},Object.defineProperty(e.geom.Vec2.prototype,"x",{get:e.geom.Vec2.prototype.get_x,set:e.geom.Vec2.prototype.set_x}),e.geom.Vec2.prototype.get_x=function(){if(this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var e=this.zpp_inner;return null!=e._validate&&e._validate(),this.zpp_inner.x},e.geom.Vec2.prototype.set_x=function(e){if(this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var t=this.zpp_inner;if(t._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=t._isimmutable&&t._isimmutable(),this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var i=this.zpp_inner;if(null!=i._validate&&i._validate(),this.zpp_inner.x!=e){if(e!=e)throw new n._Boot.HaxeError("Error: Vec2::x cannot be NaN");this.zpp_inner.x=e;var r=this.zpp_inner;null!=r._invalidate&&r._invalidate(r)}if(this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var o=this.zpp_inner;return null!=o._validate&&o._validate(),this.zpp_inner.x},Object.defineProperty(e.geom.Vec2.prototype,"y",{get:e.geom.Vec2.prototype.get_y,set:e.geom.Vec2.prototype.set_y}),e.geom.Vec2.prototype.get_y=function(){if(this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var e=this.zpp_inner;return null!=e._validate&&e._validate(),this.zpp_inner.y},e.geom.Vec2.prototype.set_y=function(e){if(this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var t=this.zpp_inner;if(t._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=t._isimmutable&&t._isimmutable(),this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var i=this.zpp_inner;if(null!=i._validate&&i._validate(),this.zpp_inner.y!=e){if(e!=e)throw new n._Boot.HaxeError("Error: Vec2::y cannot be NaN");this.zpp_inner.y=e;var r=this.zpp_inner;null!=r._invalidate&&r._invalidate(r)}if(this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var o=this.zpp_inner;return null!=o._validate&&o._validate(),this.zpp_inner.y},Object.defineProperty(e.geom.Vec2.prototype,"length",{get:e.geom.Vec2.prototype.get_length,set:e.geom.Vec2.prototype.set_length}),e.geom.Vec2.prototype.get_length=function(){if(this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");if(this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var e=this.zpp_inner;null!=e._validate&&e._validate();var t=this.zpp_inner.x;if(this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var i=this.zpp_inner;null!=i._validate&&i._validate();var r=t*this.zpp_inner.x;if(this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var o=this.zpp_inner;null!=o._validate&&o._validate();var a=this.zpp_inner.y;if(this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var s=this.zpp_inner;return null!=s._validate&&s._validate(),Math.sqrt(r+a*this.zpp_inner.y)},e.geom.Vec2.prototype.set_length=function(e){if(this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var t=this.zpp_inner;if(t._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=t._isimmutable&&t._isimmutable(),e!=e)throw new n._Boot.HaxeError("Error: Vec2::length cannot be NaN");if(this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var i=this.zpp_inner;null!=i._validate&&i._validate();var r=this.zpp_inner.x;if(this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var o=this.zpp_inner;null!=o._validate&&o._validate();var a=r*this.zpp_inner.x;if(this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var s=this.zpp_inner;null!=s._validate&&s._validate();var l=this.zpp_inner.y;if(this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var p=this.zpp_inner;if(null!=p._validate&&p._validate(),a+l*this.zpp_inner.y==0)throw new n._Boot.HaxeError("Error: Cannot set length of a zero vector");if(this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var u=this.zpp_inner;null!=u._validate&&u._validate();var h=this.zpp_inner.x;if(this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var c=this.zpp_inner;null!=c._validate&&c._validate();var _=h*this.zpp_inner.x;if(this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var d=this.zpp_inner;null!=d._validate&&d._validate();var m=this.zpp_inner.y;if(this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var P=this.zpp_inner;null!=P._validate&&P._validate();var f=e/Math.sqrt(_+m*this.zpp_inner.y),x=this;if(null!=x&&x.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var y=x.zpp_inner;null!=y._validate&&y._validate();var v=x.zpp_inner.x*f;if(null!=x&&x.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var g=x.zpp_inner;if(g._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=g._isimmutable&&g._isimmutable(),null!=x&&x.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var b=x.zpp_inner;if(null!=b._validate&&b._validate(),x.zpp_inner.x!=v){if(v!=v)throw new n._Boot.HaxeError("Error: Vec2::x cannot be NaN");x.zpp_inner.x=v;var z=x.zpp_inner;null!=z._invalidate&&z._invalidate(z)}if(null!=x&&x.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var w=x.zpp_inner;null!=w._validate&&w._validate();var Z=this;if(null!=Z&&Z.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var E=Z.zpp_inner;null!=E._validate&&E._validate();var M=Z.zpp_inner.y*f;if(null!=Z&&Z.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var S=Z.zpp_inner;if(S._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=S._isimmutable&&S._isimmutable(),null!=Z&&Z.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var C=Z.zpp_inner;if(null!=C._validate&&C._validate(),Z.zpp_inner.y!=M){if(M!=M)throw new n._Boot.HaxeError("Error: Vec2::y cannot be NaN");Z.zpp_inner.y=M;var N=Z.zpp_inner;null!=N._invalidate&&N._invalidate(N)}if(null!=Z&&Z.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var A=Z.zpp_inner;null!=A._validate&&A._validate();var L=this.zpp_inner;if(null!=L._invalidate&&L._invalidate(L),this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");if(this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var B=this.zpp_inner;null!=B._validate&&B._validate();var T=this.zpp_inner.x;if(this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var V=this.zpp_inner;null!=V._validate&&V._validate();var k=T*this.zpp_inner.x;if(this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var I=this.zpp_inner;null!=I._validate&&I._validate();var O=this.zpp_inner.y;if(this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var R=this.zpp_inner;return null!=R._validate&&R._validate(),Math.sqrt(k+O*this.zpp_inner.y)},e.geom.Vec2.prototype.lsq=function(){if(this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");if(this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var e=this.zpp_inner;null!=e._validate&&e._validate();var t=this.zpp_inner.x;if(this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var i=this.zpp_inner;null!=i._validate&&i._validate();var r=t*this.zpp_inner.x;if(this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var o=this.zpp_inner;null!=o._validate&&o._validate();var a=this.zpp_inner.y;if(this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var s=this.zpp_inner;return null!=s._validate&&s._validate(),r+a*this.zpp_inner.y},e.geom.Vec2.prototype.set=function(e){if(this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var i=this.zpp_inner;if(i._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=i._isimmutable&&i._isimmutable(),null==e)throw new n._Boot.HaxeError("Error: Cannot assign null Vec2");if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var r=e.zpp_inner;null!=r._validate&&r._validate();var o=e.zpp_inner.x;if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var a=e.zpp_inner;null!=a._validate&&a._validate();var s=e.zpp_inner.y;if(this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var l,p=this.zpp_inner;if(p._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=p._isimmutable&&p._isimmutable(),o!=o||s!=s)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var u=this.zpp_inner;if(null!=u._validate&&u._validate(),this.zpp_inner.x==o){if(this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var h=this.zpp_inner;null!=h._validate&&h._validate(),l=this.zpp_inner.y==s}else l=!1;if(!l){this.zpp_inner.x=o,this.zpp_inner.y=s;var c=this.zpp_inner;null!=c._invalidate&&c._invalidate(c)}if(e.zpp_inner.weak){if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var _=e.zpp_inner;if(_._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=_._isimmutable&&_._isimmutable(),e.zpp_inner._inuse)throw new n._Boot.HaxeError("Error: This Vec2 is not disposable");var d=e.zpp_inner;e.zpp_inner.outer=null,e.zpp_inner=null;var m=e;m.zpp_pool=null,null!=t.util.ZPP_PubPool.nextVec2?t.util.ZPP_PubPool.nextVec2.zpp_pool=m:t.util.ZPP_PubPool.poolVec2=m,t.util.ZPP_PubPool.nextVec2=m,m.zpp_disp=!0;var P=d;null!=P.outer&&(P.outer.zpp_inner=null,P.outer=null),P._isimmutable=null,P._validate=null,P._invalidate=null,P.next=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=P}return this},e.geom.Vec2.prototype.setxy=function(e,t){if(this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var i,r=this.zpp_inner;if(r._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=r._isimmutable&&r._isimmutable(),e!=e||t!=t)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var o=this.zpp_inner;if(null!=o._validate&&o._validate(),this.zpp_inner.x==e){if(this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var a=this.zpp_inner;null!=a._validate&&a._validate(),i=this.zpp_inner.y==t}else i=!1;if(!i){this.zpp_inner.x=e,this.zpp_inner.y=t;var s=this.zpp_inner;null!=s._invalidate&&s._invalidate(s)}return this},Object.defineProperty(e.geom.Vec2.prototype,"angle",{get:e.geom.Vec2.prototype.get_angle,set:e.geom.Vec2.prototype.set_angle}),e.geom.Vec2.prototype.get_angle=function(){if(this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var e;if(this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var t=this.zpp_inner;null!=t._validate&&t._validate();var i=this.zpp_inner.x;if(this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var r=this.zpp_inner;if(null!=r._validate&&r._validate(),i==this.zpp_inner.y){if(this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var o=this.zpp_inner;null!=o._validate&&o._validate(),e=0==this.zpp_inner.x}else e=!1;if(e)return 0;if(this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var a=this.zpp_inner;null!=a._validate&&a._validate();var s=this.zpp_inner.y;if(this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var l=this.zpp_inner;return null!=l._validate&&l._validate(),Math.atan2(s,this.zpp_inner.x)},e.geom.Vec2.prototype.set_angle=function(e){if(this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var t=this.zpp_inner;if(t._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=t._isimmutable&&t._isimmutable(),e!=e)throw new n._Boot.HaxeError("Error: Vec2::angle cannot be NaN");if(this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");if(this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var i=this.zpp_inner;null!=i._validate&&i._validate();var r=this.zpp_inner.x;if(this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var o=this.zpp_inner;null!=o._validate&&o._validate();var a=r*this.zpp_inner.x;if(this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var s=this.zpp_inner;null!=s._validate&&s._validate();var l=this.zpp_inner.y;if(this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var p=this.zpp_inner;null!=p._validate&&p._validate();var u=Math.sqrt(a+l*this.zpp_inner.y),h=u*Math.cos(e),c=u*Math.sin(e);if(this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var _,d=this.zpp_inner;if(d._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=d._isimmutable&&d._isimmutable(),h!=h||c!=c)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var m,P=this.zpp_inner;if(null!=P._validate&&P._validate(),this.zpp_inner.x==h){if(this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var f=this.zpp_inner;null!=f._validate&&f._validate(),_=this.zpp_inner.y==c}else _=!1;if(!_){this.zpp_inner.x=h,this.zpp_inner.y=c;var x=this.zpp_inner;null!=x._invalidate&&x._invalidate(x)}if(this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");if(this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var y=this.zpp_inner;null!=y._validate&&y._validate();var v=this.zpp_inner.x;if(this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var g=this.zpp_inner;if(null!=g._validate&&g._validate(),v==this.zpp_inner.y){if(this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var b=this.zpp_inner;null!=b._validate&&b._validate(),m=0==this.zpp_inner.x}else m=!1;if(m)return 0;if(this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var z=this.zpp_inner;null!=z._validate&&z._validate();var w=this.zpp_inner.y;if(this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var Z=this.zpp_inner;return null!=Z._validate&&Z._validate(),Math.atan2(w,this.zpp_inner.x)},e.geom.Vec2.prototype.rotate=function(e){if(this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var t=this.zpp_inner;if(t._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=t._isimmutable&&t._isimmutable(),e!=e)throw new n._Boot.HaxeError("Error: Cannot rotate Vec2 by NaN");if(e%(2*Math.PI)!=0){var i=Math.sin(e),r=Math.cos(e),o=r*this.zpp_inner.x-i*this.zpp_inner.y;this.zpp_inner.y=this.zpp_inner.x*i+this.zpp_inner.y*r,this.zpp_inner.x=o;var a=this.zpp_inner;null!=a._invalidate&&a._invalidate(a)}return this},e.geom.Vec2.prototype.reflect=function(i,r){if(null==r&&(r=!1),this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");if(this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");if(this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var o=this.zpp_inner;null!=o._validate&&o._validate();var a=this.zpp_inner.x;if(this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var s=this.zpp_inner;null!=s._validate&&s._validate();var l=a*this.zpp_inner.x;if(this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var p=this.zpp_inner;null!=p._validate&&p._validate();var u=this.zpp_inner.y;if(this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var h=this.zpp_inner;if(null!=h._validate&&h._validate(),0==Math.sqrt(l+u*this.zpp_inner.y))throw new n._Boot.HaxeError("Error: Cannot reflect in zero vector");if(this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");if(this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var c=this.zpp_inner;null!=c._validate&&c._validate();var _=this.zpp_inner.x;if(this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var d=this.zpp_inner;null!=d._validate&&d._validate();var m,P=this.zpp_inner.y;if(null==P&&(P=0),null==_&&(_=0),_!=_||P!=P)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null==t.util.ZPP_PubPool.poolVec2?m=new e.geom.Vec2:(m=t.util.ZPP_PubPool.poolVec2,t.util.ZPP_PubPool.poolVec2=m.zpp_pool,m.zpp_pool=null,m.zpp_disp=!1,m==t.util.ZPP_PubPool.nextVec2&&(t.util.ZPP_PubPool.nextVec2=null)),null==m.zpp_inner){var f;null==t.geom.ZPP_Vec2.zpp_pool?f=new t.geom.ZPP_Vec2:(f=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=f.next,f.next=null),f.weak=!1,f._immutable=!1,f.x=_,f.y=P,m.zpp_inner=f,m.zpp_inner.outer=m}else{if(null!=m&&m.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var x,y=m.zpp_inner;if(y._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=y._isimmutable&&y._isimmutable(),_!=_||P!=P)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null!=m&&m.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var v=m.zpp_inner;if(null!=v._validate&&v._validate(),m.zpp_inner.x==_){if(null!=m&&m.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var g=m.zpp_inner;null!=g._validate&&g._validate(),x=m.zpp_inner.y==P}else x=!1;if(!x){m.zpp_inner.x=_,m.zpp_inner.y=P;var b=m.zpp_inner;null!=b._invalidate&&b._invalidate(b)}}m.zpp_inner.weak=!0;var z=m.normalise(),w=i.sub(z.muleq(2*z.dot(i)),r);if(i.zpp_inner.weak){if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var Z=i.zpp_inner;if(Z._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=Z._isimmutable&&Z._isimmutable(),i.zpp_inner._inuse)throw new n._Boot.HaxeError("Error: This Vec2 is not disposable");var E=i.zpp_inner;i.zpp_inner.outer=null,i.zpp_inner=null;var M=i;M.zpp_pool=null,null!=t.util.ZPP_PubPool.nextVec2?t.util.ZPP_PubPool.nextVec2.zpp_pool=M:t.util.ZPP_PubPool.poolVec2=M,t.util.ZPP_PubPool.nextVec2=M,M.zpp_disp=!0;var S=E;null!=S.outer&&(S.outer.zpp_inner=null,S.outer=null),S._isimmutable=null,S._validate=null,S._invalidate=null,S.next=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=S}return w},e.geom.Vec2.prototype.normalise=function(){if(this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var e=this.zpp_inner;if(e._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=e._isimmutable&&e._isimmutable(),this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");if(this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var t=this.zpp_inner;null!=t._validate&&t._validate();var i=this.zpp_inner.x;if(this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var r=this.zpp_inner;null!=r._validate&&r._validate();var o=i*this.zpp_inner.x;if(this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var a=this.zpp_inner;null!=a._validate&&a._validate();var s=this.zpp_inner.y;if(this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var l=this.zpp_inner;if(null!=l._validate&&l._validate(),0==Math.sqrt(o+s*this.zpp_inner.y))throw new n._Boot.HaxeError("Error: Cannot normalise vector of length 0");if(this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var p=this.zpp_inner;null!=p._validate&&p._validate();var u=this.zpp_inner.x;if(this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var h=this.zpp_inner;null!=h._validate&&h._validate();var c=u*this.zpp_inner.x;if(this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var _=this.zpp_inner;null!=_._validate&&_._validate();var d=this.zpp_inner.y;if(this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var m=this.zpp_inner;null!=m._validate&&m._validate();var P=c+d*this.zpp_inner.y,f=1/Math.sqrt(P),x=this;if(null!=x&&x.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var y=x.zpp_inner;null!=y._validate&&y._validate();var v=x.zpp_inner.x*f;if(null!=x&&x.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var g=x.zpp_inner;if(g._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=g._isimmutable&&g._isimmutable(),null!=x&&x.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var b=x.zpp_inner;if(null!=b._validate&&b._validate(),x.zpp_inner.x!=v){if(v!=v)throw new n._Boot.HaxeError("Error: Vec2::x cannot be NaN");x.zpp_inner.x=v;var z=x.zpp_inner;null!=z._invalidate&&z._invalidate(z)}if(null!=x&&x.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var w=x.zpp_inner;null!=w._validate&&w._validate();var Z=this;if(null!=Z&&Z.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var E=Z.zpp_inner;null!=E._validate&&E._validate();var M=Z.zpp_inner.y*f;if(null!=Z&&Z.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var S=Z.zpp_inner;if(S._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=S._isimmutable&&S._isimmutable(),null!=Z&&Z.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var C=Z.zpp_inner;if(null!=C._validate&&C._validate(),Z.zpp_inner.y!=M){if(M!=M)throw new n._Boot.HaxeError("Error: Vec2::y cannot be NaN");Z.zpp_inner.y=M;var N=Z.zpp_inner;null!=N._invalidate&&N._invalidate(N)}if(null!=Z&&Z.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var A=Z.zpp_inner;null!=A._validate&&A._validate();var L=this.zpp_inner;return null!=L._invalidate&&L._invalidate(L),this},e.geom.Vec2.prototype.unit=function(i){if(null==i&&(i=!1),this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");if(this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");if(this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var r=this.zpp_inner;null!=r._validate&&r._validate();var o=this.zpp_inner.x;if(this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var a=this.zpp_inner;null!=a._validate&&a._validate();var s=o*this.zpp_inner.x;if(this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var l=this.zpp_inner;null!=l._validate&&l._validate();var p=this.zpp_inner.y;if(this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var u=this.zpp_inner;if(null!=u._validate&&u._validate(),0==Math.sqrt(s+p*this.zpp_inner.y))throw new n._Boot.HaxeError("Error: Cannot normalise vector of length 0");if(this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var h=this.zpp_inner;null!=h._validate&&h._validate();var c=this.zpp_inner.x;if(this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var _=this.zpp_inner;null!=_._validate&&_._validate();var d=c*this.zpp_inner.x;if(this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var m=this.zpp_inner;null!=m._validate&&m._validate();var P=this.zpp_inner.y;if(this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var f=this.zpp_inner;null!=f._validate&&f._validate();var x=1/Math.sqrt(d+P*this.zpp_inner.y);if(this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var y=this.zpp_inner;null!=y._validate&&y._validate();var v=this.zpp_inner.x*x;if(this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var g=this.zpp_inner;null!=g._validate&&g._validate();var b,z=this.zpp_inner.y*x,w=i;if(null==w&&(w=!1),null==z&&(z=0),null==v&&(v=0),v!=v||z!=z)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null==t.util.ZPP_PubPool.poolVec2?b=new e.geom.Vec2:(b=t.util.ZPP_PubPool.poolVec2,t.util.ZPP_PubPool.poolVec2=b.zpp_pool,b.zpp_pool=null,b.zpp_disp=!1,b==t.util.ZPP_PubPool.nextVec2&&(t.util.ZPP_PubPool.nextVec2=null)),null==b.zpp_inner){var Z;null==t.geom.ZPP_Vec2.zpp_pool?Z=new t.geom.ZPP_Vec2:(Z=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=Z.next,Z.next=null),Z.weak=!1,Z._immutable=!1,Z.x=v,Z.y=z,b.zpp_inner=Z,b.zpp_inner.outer=b}else{if(null!=b&&b.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var E,M=b.zpp_inner;if(M._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=M._isimmutable&&M._isimmutable(),v!=v||z!=z)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null!=b&&b.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var S=b.zpp_inner;if(null!=S._validate&&S._validate(),b.zpp_inner.x==v){if(null!=b&&b.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var C=b.zpp_inner;null!=C._validate&&C._validate(),E=b.zpp_inner.y==z}else E=!1;if(!E){b.zpp_inner.x=v,b.zpp_inner.y=z;var N=b.zpp_inner;null!=N._invalidate&&N._invalidate(N)}}return b.zpp_inner.weak=w,b},e.geom.Vec2.prototype.add=function(i,r){if(null==r&&(r=!1),this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");if(null==i)throw new n._Boot.HaxeError("Error: Cannot add null vectors");if(this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var o=this.zpp_inner;null!=o._validate&&o._validate();var a=this.zpp_inner.x;if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var s=i.zpp_inner;null!=s._validate&&s._validate();var l=a+i.zpp_inner.x;if(this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var p=this.zpp_inner;null!=p._validate&&p._validate();var u=this.zpp_inner.y;if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var h=i.zpp_inner;null!=h._validate&&h._validate();var c,_=u+i.zpp_inner.y,d=r;if(null==d&&(d=!1),null==_&&(_=0),null==l&&(l=0),l!=l||_!=_)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null==t.util.ZPP_PubPool.poolVec2?c=new e.geom.Vec2:(c=t.util.ZPP_PubPool.poolVec2,t.util.ZPP_PubPool.poolVec2=c.zpp_pool,c.zpp_pool=null,c.zpp_disp=!1,c==t.util.ZPP_PubPool.nextVec2&&(t.util.ZPP_PubPool.nextVec2=null)),null==c.zpp_inner){var m;null==t.geom.ZPP_Vec2.zpp_pool?m=new t.geom.ZPP_Vec2:(m=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=m.next,m.next=null),m.weak=!1,m._immutable=!1,m.x=l,m.y=_,c.zpp_inner=m,c.zpp_inner.outer=c}else{if(null!=c&&c.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var P,f=c.zpp_inner;if(f._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=f._isimmutable&&f._isimmutable(),l!=l||_!=_)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null!=c&&c.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var x=c.zpp_inner;if(null!=x._validate&&x._validate(),c.zpp_inner.x==l){if(null!=c&&c.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var y=c.zpp_inner;null!=y._validate&&y._validate(),P=c.zpp_inner.y==_}else P=!1;if(!P){c.zpp_inner.x=l,c.zpp_inner.y=_;var v=c.zpp_inner;null!=v._invalidate&&v._invalidate(v)}}c.zpp_inner.weak=d;var g=c;if(i.zpp_inner.weak){if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var b=i.zpp_inner;if(b._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=b._isimmutable&&b._isimmutable(),i.zpp_inner._inuse)throw new n._Boot.HaxeError("Error: This Vec2 is not disposable");var z=i.zpp_inner;i.zpp_inner.outer=null,i.zpp_inner=null;var w=i;w.zpp_pool=null,null!=t.util.ZPP_PubPool.nextVec2?t.util.ZPP_PubPool.nextVec2.zpp_pool=w:t.util.ZPP_PubPool.poolVec2=w,t.util.ZPP_PubPool.nextVec2=w,w.zpp_disp=!0;var Z=z;null!=Z.outer&&(Z.outer.zpp_inner=null,Z.outer=null),Z._isimmutable=null,Z._validate=null,Z._invalidate=null,Z.next=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=Z}return g},e.geom.Vec2.prototype.addMul=function(i,r,o){if(null==o&&(o=!1),this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");if(null==i)throw new n._Boot.HaxeError("Error: Cannot add null vectors");if(this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var a=this.zpp_inner;null!=a._validate&&a._validate();var s=this.zpp_inner.x;if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var l=i.zpp_inner;null!=l._validate&&l._validate();var p=s+i.zpp_inner.x*r;if(this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var u=this.zpp_inner;null!=u._validate&&u._validate();var h=this.zpp_inner.y;if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var c=i.zpp_inner;null!=c._validate&&c._validate();var _,d=h+i.zpp_inner.y*r,m=o;if(null==m&&(m=!1),null==d&&(d=0),null==p&&(p=0),p!=p||d!=d)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null==t.util.ZPP_PubPool.poolVec2?_=new e.geom.Vec2:(_=t.util.ZPP_PubPool.poolVec2,t.util.ZPP_PubPool.poolVec2=_.zpp_pool,_.zpp_pool=null,_.zpp_disp=!1,_==t.util.ZPP_PubPool.nextVec2&&(t.util.ZPP_PubPool.nextVec2=null)),null==_.zpp_inner){var P;null==t.geom.ZPP_Vec2.zpp_pool?P=new t.geom.ZPP_Vec2:(P=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=P.next,P.next=null),P.weak=!1,P._immutable=!1,P.x=p,P.y=d,_.zpp_inner=P,_.zpp_inner.outer=_}else{if(null!=_&&_.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var f,x=_.zpp_inner;if(x._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=x._isimmutable&&x._isimmutable(),p!=p||d!=d)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null!=_&&_.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var y=_.zpp_inner;if(null!=y._validate&&y._validate(),_.zpp_inner.x==p){if(null!=_&&_.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var v=_.zpp_inner;null!=v._validate&&v._validate(),f=_.zpp_inner.y==d}else f=!1;if(!f){_.zpp_inner.x=p,_.zpp_inner.y=d;var g=_.zpp_inner;null!=g._invalidate&&g._invalidate(g)}}_.zpp_inner.weak=m;var b=_;if(i.zpp_inner.weak){if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var z=i.zpp_inner;if(z._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=z._isimmutable&&z._isimmutable(),i.zpp_inner._inuse)throw new n._Boot.HaxeError("Error: This Vec2 is not disposable");var w=i.zpp_inner;i.zpp_inner.outer=null,i.zpp_inner=null;var Z=i;Z.zpp_pool=null,null!=t.util.ZPP_PubPool.nextVec2?t.util.ZPP_PubPool.nextVec2.zpp_pool=Z:t.util.ZPP_PubPool.poolVec2=Z,t.util.ZPP_PubPool.nextVec2=Z,Z.zpp_disp=!0;var E=w;null!=E.outer&&(E.outer.zpp_inner=null,E.outer=null),E._isimmutable=null,E._validate=null,E._invalidate=null,E.next=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=E}return b},e.geom.Vec2.prototype.sub=function(i,r){if(null==r&&(r=!1),this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");if(null==i)throw new n._Boot.HaxeError("Error: Cannot subtract null vectors");if(this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var o=this.zpp_inner;null!=o._validate&&o._validate();var a=this.zpp_inner.x;if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var s=i.zpp_inner;null!=s._validate&&s._validate();var l=a-i.zpp_inner.x;if(this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var p=this.zpp_inner;null!=p._validate&&p._validate();var u=this.zpp_inner.y;if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var h=i.zpp_inner;null!=h._validate&&h._validate();var c,_=u-i.zpp_inner.y,d=r;if(null==d&&(d=!1),null==_&&(_=0),null==l&&(l=0),l!=l||_!=_)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null==t.util.ZPP_PubPool.poolVec2?c=new e.geom.Vec2:(c=t.util.ZPP_PubPool.poolVec2,t.util.ZPP_PubPool.poolVec2=c.zpp_pool,c.zpp_pool=null,c.zpp_disp=!1,c==t.util.ZPP_PubPool.nextVec2&&(t.util.ZPP_PubPool.nextVec2=null)),null==c.zpp_inner){var m;null==t.geom.ZPP_Vec2.zpp_pool?m=new t.geom.ZPP_Vec2:(m=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=m.next,m.next=null),m.weak=!1,m._immutable=!1,m.x=l,m.y=_,c.zpp_inner=m,c.zpp_inner.outer=c}else{if(null!=c&&c.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var P,f=c.zpp_inner;if(f._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=f._isimmutable&&f._isimmutable(),l!=l||_!=_)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null!=c&&c.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var x=c.zpp_inner;if(null!=x._validate&&x._validate(),c.zpp_inner.x==l){if(null!=c&&c.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var y=c.zpp_inner;null!=y._validate&&y._validate(),P=c.zpp_inner.y==_}else P=!1;if(!P){c.zpp_inner.x=l,c.zpp_inner.y=_;var v=c.zpp_inner;null!=v._invalidate&&v._invalidate(v)}}c.zpp_inner.weak=d;var g=c;if(i.zpp_inner.weak){if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var b=i.zpp_inner;if(b._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=b._isimmutable&&b._isimmutable(),i.zpp_inner._inuse)throw new n._Boot.HaxeError("Error: This Vec2 is not disposable");var z=i.zpp_inner;i.zpp_inner.outer=null,i.zpp_inner=null;var w=i;w.zpp_pool=null,null!=t.util.ZPP_PubPool.nextVec2?t.util.ZPP_PubPool.nextVec2.zpp_pool=w:t.util.ZPP_PubPool.poolVec2=w,t.util.ZPP_PubPool.nextVec2=w,w.zpp_disp=!0;var Z=z;null!=Z.outer&&(Z.outer.zpp_inner=null,Z.outer=null),Z._isimmutable=null,Z._validate=null,Z._invalidate=null,Z.next=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=Z}return g},e.geom.Vec2.prototype.mul=function(i,r){if(null==r&&(r=!1),this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");if(i!=i)throw new n._Boot.HaxeError("Error: Cannot multiply with NaN");if(this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var o=this.zpp_inner;null!=o._validate&&o._validate();var a=this.zpp_inner.x*i;if(this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var s=this.zpp_inner;null!=s._validate&&s._validate();var l,p=this.zpp_inner.y*i,u=r;if(null==u&&(u=!1),null==p&&(p=0),null==a&&(a=0),a!=a||p!=p)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null==t.util.ZPP_PubPool.poolVec2?l=new e.geom.Vec2:(l=t.util.ZPP_PubPool.poolVec2,t.util.ZPP_PubPool.poolVec2=l.zpp_pool,l.zpp_pool=null,l.zpp_disp=!1,l==t.util.ZPP_PubPool.nextVec2&&(t.util.ZPP_PubPool.nextVec2=null)),null==l.zpp_inner){var h;null==t.geom.ZPP_Vec2.zpp_pool?h=new t.geom.ZPP_Vec2:(h=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=h.next,h.next=null),h.weak=!1,h._immutable=!1,h.x=a,h.y=p,l.zpp_inner=h,l.zpp_inner.outer=l}else{if(null!=l&&l.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var c,_=l.zpp_inner;if(_._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=_._isimmutable&&_._isimmutable(),a!=a||p!=p)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null!=l&&l.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var d=l.zpp_inner;if(null!=d._validate&&d._validate(),l.zpp_inner.x==a){if(null!=l&&l.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var m=l.zpp_inner;null!=m._validate&&m._validate(),c=l.zpp_inner.y==p}else c=!1;if(!c){l.zpp_inner.x=a,l.zpp_inner.y=p;var P=l.zpp_inner;null!=P._invalidate&&P._invalidate(P)}}return l.zpp_inner.weak=u,l},e.geom.Vec2.prototype.addeq=function(e){if(this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var i=this.zpp_inner;if(i._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=i._isimmutable&&i._isimmutable(),null==e)throw new n._Boot.HaxeError("Error: Cannot add null vectors");if(this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var r=this.zpp_inner;null!=r._validate&&r._validate();var o=this.zpp_inner.x;if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var a=e.zpp_inner;null!=a._validate&&a._validate();var s=o+e.zpp_inner.x;if(this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var l=this.zpp_inner;null!=l._validate&&l._validate();var p=this.zpp_inner.y;if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var u=e.zpp_inner;null!=u._validate&&u._validate();var h=p+e.zpp_inner.y;if(this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var c,_=this.zpp_inner;if(_._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=_._isimmutable&&_._isimmutable(),s!=s||h!=h)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var d=this.zpp_inner;if(null!=d._validate&&d._validate(),this.zpp_inner.x==s){if(this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var m=this.zpp_inner;null!=m._validate&&m._validate(),c=this.zpp_inner.y==h}else c=!1;if(!c){this.zpp_inner.x=s,this.zpp_inner.y=h;var P=this.zpp_inner;null!=P._invalidate&&P._invalidate(P)}if(e.zpp_inner.weak){if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var f=e.zpp_inner;if(f._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=f._isimmutable&&f._isimmutable(),e.zpp_inner._inuse)throw new n._Boot.HaxeError("Error: This Vec2 is not disposable");var x=e.zpp_inner;e.zpp_inner.outer=null,e.zpp_inner=null;var y=e;y.zpp_pool=null,null!=t.util.ZPP_PubPool.nextVec2?t.util.ZPP_PubPool.nextVec2.zpp_pool=y:t.util.ZPP_PubPool.poolVec2=y,t.util.ZPP_PubPool.nextVec2=y,y.zpp_disp=!0;var v=x;null!=v.outer&&(v.outer.zpp_inner=null,v.outer=null),v._isimmutable=null,v._validate=null,v._invalidate=null,v.next=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=v}return this},e.geom.Vec2.prototype.subeq=function(e){if(this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var i=this.zpp_inner;if(i._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=i._isimmutable&&i._isimmutable(),null==e)throw new n._Boot.HaxeError("Error: Cannot subtract null vectors");if(this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var r=this.zpp_inner;null!=r._validate&&r._validate();var o=this.zpp_inner.x;if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var a=e.zpp_inner;null!=a._validate&&a._validate();var s=o-e.zpp_inner.x;if(this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var l=this.zpp_inner;null!=l._validate&&l._validate();var p=this.zpp_inner.y;if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var u=e.zpp_inner;null!=u._validate&&u._validate();var h=p-e.zpp_inner.y;if(this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var c,_=this.zpp_inner;if(_._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=_._isimmutable&&_._isimmutable(),s!=s||h!=h)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var d=this.zpp_inner;if(null!=d._validate&&d._validate(),this.zpp_inner.x==s){if(this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var m=this.zpp_inner;null!=m._validate&&m._validate(),c=this.zpp_inner.y==h}else c=!1;if(!c){this.zpp_inner.x=s,this.zpp_inner.y=h;var P=this.zpp_inner;null!=P._invalidate&&P._invalidate(P)}if(e.zpp_inner.weak){if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var f=e.zpp_inner;if(f._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=f._isimmutable&&f._isimmutable(),e.zpp_inner._inuse)throw new n._Boot.HaxeError("Error: This Vec2 is not disposable");var x=e.zpp_inner;e.zpp_inner.outer=null,e.zpp_inner=null;var y=e;y.zpp_pool=null,null!=t.util.ZPP_PubPool.nextVec2?t.util.ZPP_PubPool.nextVec2.zpp_pool=y:t.util.ZPP_PubPool.poolVec2=y,t.util.ZPP_PubPool.nextVec2=y,y.zpp_disp=!0;var v=x;null!=v.outer&&(v.outer.zpp_inner=null,v.outer=null),v._isimmutable=null,v._validate=null,v._invalidate=null,v.next=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=v}return this},e.geom.Vec2.prototype.muleq=function(e){if(this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var t=this.zpp_inner;if(t._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=t._isimmutable&&t._isimmutable(),e!=e)throw new n._Boot.HaxeError("Error: Cannot multiply with NaN");if(this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var i=this.zpp_inner;null!=i._validate&&i._validate();var r=this.zpp_inner.x*e;if(this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var o=this.zpp_inner;null!=o._validate&&o._validate();var a=this.zpp_inner.y*e;if(this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var s,l=this.zpp_inner;if(l._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=l._isimmutable&&l._isimmutable(),r!=r||a!=a)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var p=this.zpp_inner;if(null!=p._validate&&p._validate(),this.zpp_inner.x==r){if(this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var u=this.zpp_inner;null!=u._validate&&u._validate(),s=this.zpp_inner.y==a}else s=!1;if(!s){this.zpp_inner.x=r,this.zpp_inner.y=a;var h=this.zpp_inner;null!=h._invalidate&&h._invalidate(h)}return this},e.geom.Vec2.prototype.dot=function(e){if(this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");if(null==e)throw new n._Boot.HaxeError("Error: Cannot take dot product with null vector");if(this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var i=this.zpp_inner;null!=i._validate&&i._validate();var r=this.zpp_inner.x;if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var o=e.zpp_inner;null!=o._validate&&o._validate();var a=r*e.zpp_inner.x;if(this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var s=this.zpp_inner;null!=s._validate&&s._validate();var l=this.zpp_inner.y;if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var p=e.zpp_inner;null!=p._validate&&p._validate();var u=a+l*e.zpp_inner.y;if(e.zpp_inner.weak){if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var h=e.zpp_inner;if(h._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=h._isimmutable&&h._isimmutable(),e.zpp_inner._inuse)throw new n._Boot.HaxeError("Error: This Vec2 is not disposable");var c=e.zpp_inner;e.zpp_inner.outer=null,e.zpp_inner=null;var _=e;_.zpp_pool=null,null!=t.util.ZPP_PubPool.nextVec2?t.util.ZPP_PubPool.nextVec2.zpp_pool=_:t.util.ZPP_PubPool.poolVec2=_,t.util.ZPP_PubPool.nextVec2=_,_.zpp_disp=!0;var d=c;null!=d.outer&&(d.outer.zpp_inner=null,d.outer=null),d._isimmutable=null,d._validate=null,d._invalidate=null,d.next=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=d}return u},e.geom.Vec2.prototype.cross=function(e){if(this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");if(null==e)throw new n._Boot.HaxeError("Error: Cannot take cross product with null vector");if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var i=e.zpp_inner;null!=i._validate&&i._validate();var r=e.zpp_inner.y;if(this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var o=this.zpp_inner;null!=o._validate&&o._validate();var a=r*this.zpp_inner.x;if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var s=e.zpp_inner;null!=s._validate&&s._validate();var l=e.zpp_inner.x;if(this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var p=this.zpp_inner;null!=p._validate&&p._validate();var u=a-l*this.zpp_inner.y;if(e.zpp_inner.weak){if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var h=e.zpp_inner;if(h._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=h._isimmutable&&h._isimmutable(),e.zpp_inner._inuse)throw new n._Boot.HaxeError("Error: This Vec2 is not disposable");var c=e.zpp_inner;e.zpp_inner.outer=null,e.zpp_inner=null;var _=e;_.zpp_pool=null,null!=t.util.ZPP_PubPool.nextVec2?t.util.ZPP_PubPool.nextVec2.zpp_pool=_:t.util.ZPP_PubPool.poolVec2=_,t.util.ZPP_PubPool.nextVec2=_,_.zpp_disp=!0;var d=c;null!=d.outer&&(d.outer.zpp_inner=null,d.outer=null),d._isimmutable=null,d._validate=null,d._invalidate=null,d.next=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=d}return u},e.geom.Vec2.prototype.perp=function(i){if(null==i&&(i=!1),this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");if(this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var r=this.zpp_inner;null!=r._validate&&r._validate();var o=-this.zpp_inner.y;if(this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var a=this.zpp_inner;null!=a._validate&&a._validate();var s,l=this.zpp_inner.x,p=i;if(null==p&&(p=!1),null==l&&(l=0),null==o&&(o=0),o!=o||l!=l)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null==t.util.ZPP_PubPool.poolVec2?s=new e.geom.Vec2:(s=t.util.ZPP_PubPool.poolVec2,t.util.ZPP_PubPool.poolVec2=s.zpp_pool,s.zpp_pool=null,s.zpp_disp=!1,s==t.util.ZPP_PubPool.nextVec2&&(t.util.ZPP_PubPool.nextVec2=null)),null==s.zpp_inner){var u;null==t.geom.ZPP_Vec2.zpp_pool?u=new t.geom.ZPP_Vec2:(u=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=u.next,u.next=null),u.weak=!1,u._immutable=!1,u.x=o,u.y=l,s.zpp_inner=u,s.zpp_inner.outer=s}else{if(null!=s&&s.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var h,c=s.zpp_inner;if(c._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=c._isimmutable&&c._isimmutable(),o!=o||l!=l)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null!=s&&s.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var _=s.zpp_inner;if(null!=_._validate&&_._validate(),s.zpp_inner.x==o){if(null!=s&&s.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var d=s.zpp_inner;null!=d._validate&&d._validate(),h=s.zpp_inner.y==l}else h=!1;if(!h){s.zpp_inner.x=o,s.zpp_inner.y=l;var m=s.zpp_inner;null!=m._invalidate&&m._invalidate(m)}}return s.zpp_inner.weak=p,s},e.geom.Vec2.prototype.toString=function(){if(this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var e=this.zpp_inner;return null!=e._validate&&e._validate(),this.zpp_inner.toString()},e.geom.Vec2.prototype.__class__=e.geom.Vec2,e.geom.Vec2Iterator=l["nape.geom.Vec2Iterator"]=function(){if(this.zpp_next=null,this.zpp_critical=!1,this.zpp_i=0,this.zpp_inner=null,!t.util.ZPP_Vec2List.internal)throw new n._Boot.HaxeError("Error: Cannot instantiate Vec2Iterator derp!")},e.geom.Vec2Iterator.__name__=["nape","geom","Vec2Iterator"],e.geom.Vec2Iterator.get=function(n){var i;if(null==e.geom.Vec2Iterator.zpp_pool){t.util.ZPP_Vec2List.internal=!0;var r=new e.geom.Vec2Iterator;t.util.ZPP_Vec2List.internal=!1,i=r}else{var o=e.geom.Vec2Iterator.zpp_pool;e.geom.Vec2Iterator.zpp_pool=o.zpp_next,i=o}return i.zpp_i=0,i.zpp_inner=n,i.zpp_critical=!1,i},e.geom.Vec2Iterator.prototype.zpp_inner=null,e.geom.Vec2Iterator.prototype.zpp_i=null,e.geom.Vec2Iterator.prototype.zpp_critical=null,e.geom.Vec2Iterator.prototype.zpp_next=null,e.geom.Vec2Iterator.prototype.hasNext=function(){this.zpp_inner.zpp_inner.valmod();var t=this.zpp_inner.zpp_gl();return this.zpp_critical=!0,this.zpp_i<t||(this.zpp_next=e.geom.Vec2Iterator.zpp_pool,e.geom.Vec2Iterator.zpp_pool=this,this.zpp_inner=null,!1)},e.geom.Vec2Iterator.prototype.next=function(){return this.zpp_critical=!1,this.zpp_inner.at(this.zpp_i++)},e.geom.Vec2Iterator.prototype.__class__=e.geom.Vec2Iterator,e.geom.Vec2List=l["nape.geom.Vec2List"]=function(){this.zpp_inner=null,this.zpp_inner=new t.util.ZPP_Vec2List,this.zpp_inner.outer=this},e.geom.Vec2List.__name__=["nape","geom","Vec2List"],e.geom.Vec2List.fromArray=function(t){if(null==t)throw new n._Boot.HaxeError("Error: Cannot convert null Array to Nape list");for(var i=new e.geom.Vec2List,r=0;r<t.length;){var o=t[r];++r,i.push(o)}return i},e.geom.Vec2List.prototype.zpp_inner=null,Object.defineProperty(e.geom.Vec2List.prototype,"length",{get:e.geom.Vec2List.prototype.get_length}),e.geom.Vec2List.prototype.get_length=function(){return this.zpp_gl()},e.geom.Vec2List.prototype.zpp_gl=function(){return this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.user_length},e.geom.Vec2List.prototype.zpp_vm=function(){this.zpp_inner.valmod()},e.geom.Vec2List.prototype.has=function(e){return this.zpp_vm(),this.zpp_inner.inner.has(e.zpp_inner)},e.geom.Vec2List.prototype.at=function(i){if(this.zpp_vm(),i<0||i>=this.zpp_gl())throw new n._Boot.HaxeError("Error: Index out of bounds");if(this.zpp_inner.reverse_flag&&(i=this.zpp_gl()-1-i),i<this.zpp_inner.at_index||null==this.zpp_inner.at_ite)this.zpp_inner.at_index=i,this.zpp_inner.at_ite=this.zpp_inner.inner.iterator_at(i);else for(;this.zpp_inner.at_index!=i;)this.zpp_inner.at_index++,this.zpp_inner.at_ite=this.zpp_inner.at_ite.next;var r=this.zpp_inner.at_ite.elt;if(null==r.outer){r.outer=new e.geom.Vec2;var o=r.outer.zpp_inner;null!=o.outer&&(o.outer.zpp_inner=null,o.outer=null),o._isimmutable=null,o._validate=null,o._invalidate=null,o.next=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=o,r.outer.zpp_inner=r}return r.outer},e.geom.Vec2List.prototype.push=function(e){if(this.zpp_inner.immutable)throw new n._Boot.HaxeError("Error: Vec2List is immutable");this.zpp_inner.modify_test(),this.zpp_vm();var t=null==this.zpp_inner.adder||this.zpp_inner.adder(e);if(t){if(this.zpp_inner.reverse_flag)this.zpp_inner.inner.add(e.zpp_inner);else{if(null==this.zpp_inner.push_ite){var i=this.empty()?null:this.zpp_inner.inner.iterator_at(this.zpp_gl()-1);this.zpp_inner.push_ite=i}this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,e.zpp_inner)}this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(e)}return t},e.geom.Vec2List.prototype.unshift=function(e){if(this.zpp_inner.immutable)throw new n._Boot.HaxeError("Error: Vec2List is immutable");this.zpp_inner.modify_test(),this.zpp_vm();var t=null==this.zpp_inner.adder||this.zpp_inner.adder(e);if(t){if(this.zpp_inner.reverse_flag){if(null==this.zpp_inner.push_ite){var i=this.empty()?null:this.zpp_inner.inner.iterator_at(this.zpp_gl()-1);this.zpp_inner.push_ite=i}this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,e.zpp_inner)}else this.zpp_inner.inner.add(e.zpp_inner);this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(e)}return t},e.geom.Vec2List.prototype.pop=function(){if(this.zpp_inner.immutable)throw new n._Boot.HaxeError("Error: Vec2List is immutable");if(this.zpp_inner.modify_test(),this.empty())throw new n._Boot.HaxeError("Error: Cannot remove from empty list");this.zpp_vm();var i=null;if(this.zpp_inner.reverse_flag){if(null==(i=this.zpp_inner.inner.head.elt).outer){i.outer=new e.geom.Vec2;var r=i.outer.zpp_inner;null!=r.outer&&(r.outer.zpp_inner=null,r.outer=null),r._isimmutable=null,r._validate=null,r._invalidate=null,r.next=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=r,i.outer.zpp_inner=i}var o=i.outer;null!=this.zpp_inner.subber&&this.zpp_inner.subber(o),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()}else{null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null);var a=1==this.zpp_gl()?null:this.zpp_inner.inner.iterator_at(this.zpp_gl()-2);if(null==(i=null==a?this.zpp_inner.inner.head.elt:a.next.elt).outer){i.outer=new e.geom.Vec2;var s=i.outer.zpp_inner;null!=s.outer&&(s.outer.zpp_inner=null,s.outer=null),s._isimmutable=null,s._validate=null,s._invalidate=null,s.next=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=s,i.outer.zpp_inner=i}var l=i.outer;null!=this.zpp_inner.subber&&this.zpp_inner.subber(l),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(a)}if(this.zpp_inner.invalidate(),null==i.outer){i.outer=new e.geom.Vec2;var p=i.outer.zpp_inner;null!=p.outer&&(p.outer.zpp_inner=null,p.outer=null),p._isimmutable=null,p._validate=null,p._invalidate=null,p.next=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=p,i.outer.zpp_inner=i}return i.outer},e.geom.Vec2List.prototype.shift=function(){if(this.zpp_inner.immutable)throw new n._Boot.HaxeError("Error: Vec2List is immutable");if(this.zpp_inner.modify_test(),this.empty())throw new n._Boot.HaxeError("Error: Cannot remove from empty list");this.zpp_vm();var i=null;if(this.zpp_inner.reverse_flag){null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null);var r=1==this.zpp_gl()?null:this.zpp_inner.inner.iterator_at(this.zpp_gl()-2);if(null==(i=null==r?this.zpp_inner.inner.head.elt:r.next.elt).outer){i.outer=new e.geom.Vec2;var o=i.outer.zpp_inner;null!=o.outer&&(o.outer.zpp_inner=null,o.outer=null),o._isimmutable=null,o._validate=null,o._invalidate=null,o.next=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=o,i.outer.zpp_inner=i}var a=i.outer;null!=this.zpp_inner.subber&&this.zpp_inner.subber(a),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(r)}else{if(null==(i=this.zpp_inner.inner.head.elt).outer){i.outer=new e.geom.Vec2;var s=i.outer.zpp_inner;null!=s.outer&&(s.outer.zpp_inner=null,s.outer=null),s._isimmutable=null,s._validate=null,s._invalidate=null,s.next=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=s,i.outer.zpp_inner=i}var l=i.outer;null!=this.zpp_inner.subber&&this.zpp_inner.subber(l),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()}if(this.zpp_inner.invalidate(),null==i.outer){i.outer=new e.geom.Vec2;var p=i.outer.zpp_inner;null!=p.outer&&(p.outer.zpp_inner=null,p.outer=null),p._isimmutable=null,p._validate=null,p._invalidate=null,p.next=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=p,i.outer.zpp_inner=i}return i.outer},e.geom.Vec2List.prototype.add=function(e){return this.zpp_inner.reverse_flag?this.push(e):this.unshift(e)},e.geom.Vec2List.prototype.remove=function(e){if(this.zpp_inner.immutable)throw new n._Boot.HaxeError("Error: Vec2List is immutable");var t;this.zpp_inner.modify_test(),this.zpp_vm(),t=!1;for(var i=this.zpp_inner.inner.head;null!=i;){if(i.elt==e.zpp_inner){t=!0;break}i=i.next}return t&&(null!=this.zpp_inner.subber&&this.zpp_inner.subber(e),this.zpp_inner.dontremove||this.zpp_inner.inner.remove(e.zpp_inner),this.zpp_inner.invalidate()),t},e.geom.Vec2List.prototype.clear=function(){if(this.zpp_inner.immutable)throw new n._Boot.HaxeError("Error: Vec2List is immutable");if(this.zpp_inner.reverse_flag)for(;!this.empty();)this.pop();else for(;!this.empty();)this.shift()},e.geom.Vec2List.prototype.empty=function(){return 0==this.zpp_gl()},e.geom.Vec2List.prototype.iterator=function(){return this.zpp_vm(),e.geom.Vec2Iterator.get(this)},e.geom.Vec2List.prototype.copy=function(i){null==i&&(i=!1);for(var r=new e.geom.Vec2List,o=this.iterator();;){o.zpp_inner.zpp_inner.valmod();var a,s=o.zpp_inner.zpp_gl();if(o.zpp_critical=!0,o.zpp_i<s?a=!0:(o.zpp_next=e.geom.Vec2Iterator.zpp_pool,e.geom.Vec2Iterator.zpp_pool=o,o.zpp_inner=null,a=!1),!a)break;o.zpp_critical=!1;var l,p=o.zpp_inner.at(o.zpp_i++);if(i){if(null!=p&&p.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");if(p.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var u=p.zpp_inner;null!=u._validate&&u._validate();var h=p.zpp_inner.x;if(p.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var c=p.zpp_inner;null!=c._validate&&c._validate();var _,d=p.zpp_inner.y,m=!1;if(null==m&&(m=!1),null==d&&(d=0),null==h&&(h=0),h!=h||d!=d)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null==t.util.ZPP_PubPool.poolVec2?_=new e.geom.Vec2:(_=t.util.ZPP_PubPool.poolVec2,t.util.ZPP_PubPool.poolVec2=_.zpp_pool,_.zpp_pool=null,_.zpp_disp=!1,_==t.util.ZPP_PubPool.nextVec2&&(t.util.ZPP_PubPool.nextVec2=null)),null==_.zpp_inner){var P;null==t.geom.ZPP_Vec2.zpp_pool?P=new t.geom.ZPP_Vec2:(P=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=P.next,P.next=null),P.weak=!1,P._immutable=!1,P.x=h,P.y=d,_.zpp_inner=P,_.zpp_inner.outer=_}else{if(null!=_&&_.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var f,x=_.zpp_inner;if(x._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=x._isimmutable&&x._isimmutable(),h!=h||d!=d)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null!=_&&_.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var y=_.zpp_inner;if(null!=y._validate&&y._validate(),_.zpp_inner.x==h){if(null!=_&&_.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var v=_.zpp_inner;null!=v._validate&&v._validate(),f=_.zpp_inner.y==d}else f=!1;if(!f){_.zpp_inner.x=h,_.zpp_inner.y=d;var g=_.zpp_inner;null!=g._invalidate&&g._invalidate(g)}}_.zpp_inner.weak=m,l=_}else l=p;r.push(l)}return r},e.geom.Vec2List.prototype.merge=function(t){if(null==t)throw new n._Boot.HaxeError("Error: Cannot merge with null list");for(var i=t.iterator();;){i.zpp_inner.zpp_inner.valmod();var r,o=i.zpp_inner.zpp_gl();if(i.zpp_critical=!0,i.zpp_i<o?r=!0:(i.zpp_next=e.geom.Vec2Iterator.zpp_pool,e.geom.Vec2Iterator.zpp_pool=i,i.zpp_inner=null,r=!1),!r)break;i.zpp_critical=!1;var a=i.zpp_inner.at(i.zpp_i++);this.has(a)||this.add(a)}},e.geom.Vec2List.prototype.toString=function(){for(var t="[",n=!0,i=this.iterator();;){i.zpp_inner.zpp_inner.valmod();var r,o=i.zpp_inner.zpp_gl();if(i.zpp_critical=!0,i.zpp_i<o?r=!0:(i.zpp_next=e.geom.Vec2Iterator.zpp_pool,e.geom.Vec2Iterator.zpp_pool=i,i.zpp_inner=null,r=!1),!r)break;i.zpp_critical=!1;var a=i.zpp_inner.at(i.zpp_i++);n||(t+=","),t+=null==a?"NULL":a.toString(),n=!1}return t+"]"},e.geom.Vec2List.prototype.foreach=function(t){if(null==t)throw new n._Boot.HaxeError("Error: Cannot execute null on list elements");for(var i=this.iterator();;){i.zpp_inner.zpp_inner.valmod();var r,o=i.zpp_inner.zpp_gl();if(i.zpp_critical=!0,i.zpp_i<o?r=!0:(i.zpp_next=e.geom.Vec2Iterator.zpp_pool,e.geom.Vec2Iterator.zpp_pool=i,i.zpp_inner=null,r=!1),!r)break;try{i.zpp_critical=!1,t(i.zpp_inner.at(i.zpp_i++))}catch(t){t instanceof n._Boot.HaxeError&&t.val,i.zpp_next=e.geom.Vec2Iterator.zpp_pool,e.geom.Vec2Iterator.zpp_pool=i,i.zpp_inner=null;break}}return this},e.geom.Vec2List.prototype.filter=function(e){if(null==e)throw new n._Boot.HaxeError("Error: Cannot select elements of list with null");for(var t=0;t<this.zpp_gl();){var i=this.at(t);try{e(i)?++t:this.remove(i)}catch(e){e instanceof n._Boot.HaxeError&&e.val;break}}return this},e.geom.Vec2List.prototype.__class__=e.geom.Vec2List,e.geom.Vec3=l["nape.geom.Vec3"]=function(e,i,r){if(null==r&&(r=0),null==i&&(i=0),null==e&&(e=0),this.zpp_pool=null,this.zpp_inner=null,this.zpp_inner=new t.geom.ZPP_Vec3,this.zpp_inner.outer=this,this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");if(this.zpp_inner.immutable)throw new n._Boot.HaxeError("Error: Vec3 is immutable");if(this.zpp_inner.x=e,this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");var o=this.zpp_inner;if(null!=o._validate&&o._validate(),this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");if(this.zpp_inner.immutable)throw new n._Boot.HaxeError("Error: Vec3 is immutable");if(this.zpp_inner.y=i,this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");var a=this.zpp_inner;if(null!=a._validate&&a._validate(),this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");if(this.zpp_inner.immutable)throw new n._Boot.HaxeError("Error: Vec3 is immutable");if(this.zpp_inner.z=r,this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");var s=this.zpp_inner;null!=s._validate&&s._validate()},e.geom.Vec3.__name__=["nape","geom","Vec3"],e.geom.Vec3.get=function(n,i,r){var o;return null==r&&(r=0),null==i&&(i=0),null==n&&(n=0),null==t.util.ZPP_PubPool.poolVec3?o=new e.geom.Vec3:(o=t.util.ZPP_PubPool.poolVec3,t.util.ZPP_PubPool.poolVec3=o.zpp_pool,o.zpp_pool=null,o.zpp_disp=!1,o==t.util.ZPP_PubPool.nextVec3&&(t.util.ZPP_PubPool.nextVec3=null)),o.setxyz(n,i,r),o.zpp_inner.immutable=!1,o.zpp_inner._validate=null,o},e.geom.Vec3.prototype.zpp_inner=null,e.geom.Vec3.prototype.zpp_pool=null,e.geom.Vec3.prototype.zpp_disp=null,Object.defineProperty(e.geom.Vec3.prototype,"x",{get:e.geom.Vec3.prototype.get_x,set:e.geom.Vec3.prototype.set_x}),e.geom.Vec3.prototype.get_x=function(){if(this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");var e=this.zpp_inner;return null!=e._validate&&e._validate(),this.zpp_inner.x},e.geom.Vec3.prototype.set_x=function(e){if(this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");if(this.zpp_inner.immutable)throw new n._Boot.HaxeError("Error: Vec3 is immutable");if(this.zpp_inner.x=e,this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");var t=this.zpp_inner;return null!=t._validate&&t._validate(),this.zpp_inner.x},Object.defineProperty(e.geom.Vec3.prototype,"y",{get:e.geom.Vec3.prototype.get_y,set:e.geom.Vec3.prototype.set_y}),e.geom.Vec3.prototype.get_y=function(){if(this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");var e=this.zpp_inner;return null!=e._validate&&e._validate(),this.zpp_inner.y},e.geom.Vec3.prototype.set_y=function(e){if(this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");if(this.zpp_inner.immutable)throw new n._Boot.HaxeError("Error: Vec3 is immutable");if(this.zpp_inner.y=e,this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");var t=this.zpp_inner;return null!=t._validate&&t._validate(),this.zpp_inner.y},Object.defineProperty(e.geom.Vec3.prototype,"z",{get:e.geom.Vec3.prototype.get_z,set:e.geom.Vec3.prototype.set_z}),e.geom.Vec3.prototype.get_z=function(){if(this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");var e=this.zpp_inner;return null!=e._validate&&e._validate(),this.zpp_inner.z},e.geom.Vec3.prototype.set_z=function(e){if(this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");if(this.zpp_inner.immutable)throw new n._Boot.HaxeError("Error: Vec3 is immutable");if(this.zpp_inner.z=e,this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");var t=this.zpp_inner;return null!=t._validate&&t._validate(),this.zpp_inner.z},e.geom.Vec3.prototype.dispose=function(){if(this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");if(this.zpp_inner.immutable)throw new n._Boot.HaxeError("Error: This Vec3 is not disposable");var e=this;e.zpp_pool=null,null!=t.util.ZPP_PubPool.nextVec3?t.util.ZPP_PubPool.nextVec3.zpp_pool=e:t.util.ZPP_PubPool.poolVec3=e,t.util.ZPP_PubPool.nextVec3=e,e.zpp_disp=!0},Object.defineProperty(e.geom.Vec3.prototype,"length",{get:e.geom.Vec3.prototype.get_length,set:e.geom.Vec3.prototype.set_length}),e.geom.Vec3.prototype.get_length=function(){if(this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");if(this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");var e=this.zpp_inner;null!=e._validate&&e._validate();var t=this.zpp_inner.x;if(this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");var i=this.zpp_inner;null!=i._validate&&i._validate();var r=t*this.zpp_inner.x;if(this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");var o=this.zpp_inner;null!=o._validate&&o._validate();var a=this.zpp_inner.y;if(this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");var s=this.zpp_inner;null!=s._validate&&s._validate();var l=r+a*this.zpp_inner.y;if(this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");var p=this.zpp_inner;null!=p._validate&&p._validate();var u=this.zpp_inner.z;if(this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");var h=this.zpp_inner;return null!=h._validate&&h._validate(),Math.sqrt(l+u*this.zpp_inner.z)},e.geom.Vec3.prototype.set_length=function(e){if(this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");if(e!=e)throw new n._Boot.HaxeError("Error: Vec3::length cannot be NaN");if(this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");var t=this.zpp_inner;null!=t._validate&&t._validate();var i=this.zpp_inner.x;if(this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");var r=this.zpp_inner;null!=r._validate&&r._validate();var o=i*this.zpp_inner.x;if(this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");var a=this.zpp_inner;null!=a._validate&&a._validate();var s=this.zpp_inner.y;if(this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");var l=this.zpp_inner;null!=l._validate&&l._validate();var p=o+s*this.zpp_inner.y;if(this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");var u=this.zpp_inner;null!=u._validate&&u._validate();var h=this.zpp_inner.z;if(this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");var c=this.zpp_inner;if(null!=c._validate&&c._validate(),p+h*this.zpp_inner.z==0)throw new n._Boot.HaxeError("Error: Cannot set length of a zero vector");if(this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");if(this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");var _=this.zpp_inner;null!=_._validate&&_._validate();var d=this.zpp_inner.x;if(this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");var m=this.zpp_inner;null!=m._validate&&m._validate();var P=d*this.zpp_inner.x;if(this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");var f=this.zpp_inner;null!=f._validate&&f._validate();var x=this.zpp_inner.y;if(this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");var y=this.zpp_inner;null!=y._validate&&y._validate();var v=P+x*this.zpp_inner.y;if(this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");var g=this.zpp_inner;null!=g._validate&&g._validate();var b=this.zpp_inner.z;if(this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");var z=this.zpp_inner;null!=z._validate&&z._validate();var w=e/Math.sqrt(v+b*this.zpp_inner.z),Z=w,E=this;if(null!=E&&E.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");var M=E.zpp_inner;if(null!=M._validate&&M._validate(),null!=E&&E.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");if(E.zpp_inner.immutable)throw new n._Boot.HaxeError("Error: Vec3 is immutable");if(E.zpp_inner.x=E.zpp_inner.x*Z,null!=E&&E.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");var S=E.zpp_inner;null!=S._validate&&S._validate();var C=this;if(null!=C&&C.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");var N=C.zpp_inner;if(null!=N._validate&&N._validate(),null!=C&&C.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");if(C.zpp_inner.immutable)throw new n._Boot.HaxeError("Error: Vec3 is immutable");if(C.zpp_inner.y=C.zpp_inner.y*Z,null!=C&&C.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");var A=C.zpp_inner;null!=A._validate&&A._validate();var L=this;if(null!=L&&L.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");var B=L.zpp_inner;if(null!=B._validate&&B._validate(),null!=L&&L.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");if(L.zpp_inner.immutable)throw new n._Boot.HaxeError("Error: Vec3 is immutable");if(L.zpp_inner.z=L.zpp_inner.z*w,null!=L&&L.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");var T=L.zpp_inner;if(null!=T._validate&&T._validate(),this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");if(this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");var V=this.zpp_inner;null!=V._validate&&V._validate();var k=this.zpp_inner.x;if(this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");var I=this.zpp_inner;null!=I._validate&&I._validate();var O=k*this.zpp_inner.x;if(this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");var R=this.zpp_inner;null!=R._validate&&R._validate();var H=this.zpp_inner.y;if(this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");var F=this.zpp_inner;null!=F._validate&&F._validate();var D=O+H*this.zpp_inner.y;if(this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");var G=this.zpp_inner;null!=G._validate&&G._validate();var U=this.zpp_inner.z;if(this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");var j=this.zpp_inner;return null!=j._validate&&j._validate(),Math.sqrt(D+U*this.zpp_inner.z)},e.geom.Vec3.prototype.lsq=function(){if(this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");if(this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");var e=this.zpp_inner;null!=e._validate&&e._validate();var t=this.zpp_inner.x;if(this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");var i=this.zpp_inner;null!=i._validate&&i._validate();var r=t*this.zpp_inner.x;if(this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");var o=this.zpp_inner;null!=o._validate&&o._validate();var a=this.zpp_inner.y;if(this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");var s=this.zpp_inner;null!=s._validate&&s._validate();var l=r+a*this.zpp_inner.y;if(this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");var p=this.zpp_inner;null!=p._validate&&p._validate();var u=this.zpp_inner.z;if(this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");var h=this.zpp_inner;return null!=h._validate&&h._validate(),l+u*this.zpp_inner.z},e.geom.Vec3.prototype.set=function(e){if(this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");if(null==e)throw new n._Boot.HaxeError("Error: Cannot assign null Vec3");if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");var t=e.zpp_inner;null!=t._validate&&t._validate();var i=e.zpp_inner.x;if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");var r=e.zpp_inner;null!=r._validate&&r._validate();var o=e.zpp_inner.y;if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");var a=e.zpp_inner;return null!=a._validate&&a._validate(),this.setxyz(i,o,e.zpp_inner.z)},e.geom.Vec3.prototype.setxyz=function(e,t,i){if(this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");if(this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");if(this.zpp_inner.immutable)throw new n._Boot.HaxeError("Error: Vec3 is immutable");if(this.zpp_inner.x=e,this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");var r=this.zpp_inner;if(null!=r._validate&&r._validate(),this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");if(this.zpp_inner.immutable)throw new n._Boot.HaxeError("Error: Vec3 is immutable");if(this.zpp_inner.y=t,this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");var o=this.zpp_inner;if(null!=o._validate&&o._validate(),this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");if(this.zpp_inner.immutable)throw new n._Boot.HaxeError("Error: Vec3 is immutable");if(this.zpp_inner.z=i,this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");var a=this.zpp_inner;return null!=a._validate&&a._validate(),this},e.geom.Vec3.prototype.xy=function(i){if(null==i&&(i=!1),this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");if(this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");var r=this.zpp_inner;null!=r._validate&&r._validate();var o=this.zpp_inner.x;if(this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");var a=this.zpp_inner;null!=a._validate&&a._validate();var s,l=this.zpp_inner.y,p=i;if(null==p&&(p=!1),null==l&&(l=0),null==o&&(o=0),o!=o||l!=l)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null==t.util.ZPP_PubPool.poolVec2?s=new e.geom.Vec2:(s=t.util.ZPP_PubPool.poolVec2,t.util.ZPP_PubPool.poolVec2=s.zpp_pool,s.zpp_pool=null,s.zpp_disp=!1,s==t.util.ZPP_PubPool.nextVec2&&(t.util.ZPP_PubPool.nextVec2=null)),null==s.zpp_inner){var u;null==t.geom.ZPP_Vec2.zpp_pool?u=new t.geom.ZPP_Vec2:(u=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=u.next,u.next=null),u.weak=!1,u._immutable=!1,u.x=o,u.y=l,s.zpp_inner=u,s.zpp_inner.outer=s}else{if(null!=s&&s.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var h,c=s.zpp_inner;if(c._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=c._isimmutable&&c._isimmutable(),o!=o||l!=l)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null!=s&&s.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var _=s.zpp_inner;if(null!=_._validate&&_._validate(),s.zpp_inner.x==o){if(null!=s&&s.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var d=s.zpp_inner;null!=d._validate&&d._validate(),h=s.zpp_inner.y==l}else h=!1;if(!h){s.zpp_inner.x=o,s.zpp_inner.y=l;var m=s.zpp_inner;null!=m._invalidate&&m._invalidate(m)}}return s.zpp_inner.weak=p,s},e.geom.Vec3.prototype.toString=function(){if(this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");if(this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");var e=this.zpp_inner;null!=e._validate&&e._validate();var t="{ x: "+this.zpp_inner.x+" y: ";if(this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");var i=this.zpp_inner;null!=i._validate&&i._validate();var r=t+this.zpp_inner.y+" z: ";if(this.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");var o=this.zpp_inner;return null!=o._validate&&o._validate(),r+this.zpp_inner.z+" }"},e.geom.Vec3.prototype.__class__=e.geom.Vec3,e.geom.Winding=l["nape.geom.Winding"]=function(){if(!t.util.ZPP_Flags.internal)throw new n._Boot.HaxeError("Error: Cannot instantiate Winding derp!")},e.geom.Winding.__name__=["nape","geom","Winding"],e.geom.Winding.UNDEFINED=null,e.geom.Winding.get_UNDEFINED=function(){return null==t.util.ZPP_Flags.Winding_UNDEFINED&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.Winding_UNDEFINED=new e.geom.Winding,t.util.ZPP_Flags.internal=!1),t.util.ZPP_Flags.Winding_UNDEFINED},e.geom.Winding.CLOCKWISE=null,e.geom.Winding.get_CLOCKWISE=function(){return null==t.util.ZPP_Flags.Winding_CLOCKWISE&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.Winding_CLOCKWISE=new e.geom.Winding,t.util.ZPP_Flags.internal=!1),t.util.ZPP_Flags.Winding_CLOCKWISE},e.geom.Winding.ANTICLOCKWISE=null,e.geom.Winding.get_ANTICLOCKWISE=function(){return null==t.util.ZPP_Flags.Winding_ANTICLOCKWISE&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.Winding_ANTICLOCKWISE=new e.geom.Winding,t.util.ZPP_Flags.internal=!1),t.util.ZPP_Flags.Winding_ANTICLOCKWISE},e.geom.Winding.prototype.toString=function(){return null==t.util.ZPP_Flags.Winding_UNDEFINED&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.Winding_UNDEFINED=new e.geom.Winding,t.util.ZPP_Flags.internal=!1),this==t.util.ZPP_Flags.Winding_UNDEFINED?"UNDEFINED":(null==t.util.ZPP_Flags.Winding_CLOCKWISE&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.Winding_CLOCKWISE=new e.geom.Winding,t.util.ZPP_Flags.internal=!1),this==t.util.ZPP_Flags.Winding_CLOCKWISE?"CLOCKWISE":(null==t.util.ZPP_Flags.Winding_ANTICLOCKWISE&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.Winding_ANTICLOCKWISE=new e.geom.Winding,t.util.ZPP_Flags.internal=!1),this==t.util.ZPP_Flags.Winding_ANTICLOCKWISE?"ANTICLOCKWISE":""))},e.geom.Winding.prototype.__class__=e.geom.Winding,e.phys||(e.phys={}),e.phys.Interactor=l["nape.phys.Interactor"]=function(){if(this.zpp_inner_i=null,!e.phys.Interactor.zpp_internalAlloc)throw new n._Boot.HaxeError("Error: Cannot instantiate an Interactor, only Shape/Body/Compound")},e.phys.Interactor.__name__=["nape","phys","Interactor"],e.phys.Interactor.prototype.zpp_inner_i=null,Object.defineProperty(e.phys.Interactor.prototype,"id",{get:e.phys.Interactor.prototype.get_id}),e.phys.Interactor.prototype.get_id=function(){return this.zpp_inner_i.id},Object.defineProperty(e.phys.Interactor.prototype,"userData",{get:e.phys.Interactor.prototype.get_userData}),e.phys.Interactor.prototype.get_userData=function(){return null==this.zpp_inner_i.userData&&(this.zpp_inner_i.userData={}),this.zpp_inner_i.userData},e.phys.Interactor.prototype.isShape=function(){return null!=this.zpp_inner_i.ishape},e.phys.Interactor.prototype.isBody=function(){return null!=this.zpp_inner_i.ibody},e.phys.Interactor.prototype.isCompound=function(){return null!=this.zpp_inner_i.icompound},Object.defineProperty(e.phys.Interactor.prototype,"castShape",{get:e.phys.Interactor.prototype.get_castShape}),e.phys.Interactor.prototype.get_castShape=function(){return null!=this.zpp_inner_i.ishape?this.zpp_inner_i.ishape.outer:null},Object.defineProperty(e.phys.Interactor.prototype,"castBody",{get:e.phys.Interactor.prototype.get_castBody}),e.phys.Interactor.prototype.get_castBody=function(){return null!=this.zpp_inner_i.ibody?this.zpp_inner_i.ibody.outer:null},Object.defineProperty(e.phys.Interactor.prototype,"castCompound",{get:e.phys.Interactor.prototype.get_castCompound}),e.phys.Interactor.prototype.get_castCompound=function(){return null!=this.zpp_inner_i.icompound?this.zpp_inner_i.icompound.outer:null},Object.defineProperty(e.phys.Interactor.prototype,"group",{get:e.phys.Interactor.prototype.get_group,set:e.phys.Interactor.prototype.set_group}),e.phys.Interactor.prototype.get_group=function(){return null==this.zpp_inner_i.group?null:this.zpp_inner_i.group.outer},e.phys.Interactor.prototype.set_group=function(e){return this.zpp_inner_i.immutable_midstep("Interactor::group"),this.zpp_inner_i.setGroup(null==e?null:e.zpp_inner),null==this.zpp_inner_i.group?null:this.zpp_inner_i.group.outer},Object.defineProperty(e.phys.Interactor.prototype,"cbTypes",{get:e.phys.Interactor.prototype.get_cbTypes}),e.phys.Interactor.prototype.get_cbTypes=function(){return null==this.zpp_inner_i.wrap_cbTypes&&this.zpp_inner_i.setupcbTypes(),this.zpp_inner_i.wrap_cbTypes},e.phys.Interactor.prototype.toString=function(){return""},e.phys.Interactor.prototype.__class__=e.phys.Interactor,e.phys.Body=l["nape.phys.Body"]=function(i,r){if(this.debugDraw=!0,this.zpp_inner=null,e.phys.Interactor.zpp_internalAlloc=!0,e.phys.Interactor.call(this),e.phys.Interactor.zpp_internalAlloc=!1,this.zpp_inner=new t.phys.ZPP_Body,this.zpp_inner.outer=this,this.zpp_inner.outer_i=this,this.zpp_inner_i=this.zpp_inner,null!=r){if(null!=r&&r.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");if(null!=r&&r.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var o=r.zpp_inner;if(null!=o._validate&&o._validate(),this.zpp_inner.posx=r.zpp_inner.x,null!=r&&r.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var a=r.zpp_inner;null!=a._validate&&a._validate(),this.zpp_inner.posy=r.zpp_inner.y}else this.zpp_inner.posx=0,this.zpp_inner.posy=0;var s;if(null==i?(null==t.util.ZPP_Flags.BodyType_DYNAMIC&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.BodyType_DYNAMIC=new e.phys.BodyType,t.util.ZPP_Flags.internal=!1),s=t.util.ZPP_Flags.BodyType_DYNAMIC):s=i,this.zpp_inner.immutable_midstep("Body::type"),this.zpp_inner.world)throw new n._Boot.HaxeError("Error: Space::world is immutable");if(t.phys.ZPP_Body.types[this.zpp_inner.type]!=s){if(null==s)throw new n._Boot.HaxeError("Error: Cannot use null BodyType");var l;null==t.util.ZPP_Flags.BodyType_DYNAMIC&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.BodyType_DYNAMIC=new e.phys.BodyType,t.util.ZPP_Flags.internal=!1),s==t.util.ZPP_Flags.BodyType_DYNAMIC?l=2:(null==t.util.ZPP_Flags.BodyType_KINEMATIC&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.BodyType_KINEMATIC=new e.phys.BodyType,t.util.ZPP_Flags.internal=!1),l=s==t.util.ZPP_Flags.BodyType_KINEMATIC?3:1),1==l&&null!=this.zpp_inner.space&&(this.zpp_inner.velx=0,this.zpp_inner.vely=0,this.zpp_inner.angvel=0),this.zpp_inner.invalidate_type(),null!=this.zpp_inner.space?this.zpp_inner.space.transmitType(this.zpp_inner,l):this.zpp_inner.type=l}if(null!=r&&r.zpp_inner.weak){if(null!=r&&r.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var p=r.zpp_inner;if(p._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=p._isimmutable&&p._isimmutable(),r.zpp_inner._inuse)throw new n._Boot.HaxeError("Error: This Vec2 is not disposable");var u=r.zpp_inner;r.zpp_inner.outer=null,r.zpp_inner=null;var h=r;h.zpp_pool=null,null!=t.util.ZPP_PubPool.nextVec2?t.util.ZPP_PubPool.nextVec2.zpp_pool=h:t.util.ZPP_PubPool.poolVec2=h,t.util.ZPP_PubPool.nextVec2=h,h.zpp_disp=!0;var c=u;null!=c.outer&&(c.outer.zpp_inner=null,c.outer=null),c._isimmutable=null,c._validate=null,c._invalidate=null,c.next=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=c}this.zpp_inner_i.insert_cbtype(t.callbacks.ZPP_CbType.ANY_BODY.zpp_inner)},e.phys.Body.__name__=["nape","phys","Body"],e.phys.Body.__super__=e.phys.Interactor,e.phys.Interactor.prototype)e.phys.Body.prototype[u]=e.phys.Interactor.prototype[u];for(var u in e.phys.Body.prototype.zpp_inner=null,e.phys.Body.prototype.debugDraw=null,Object.defineProperty(e.phys.Body.prototype,"type",{get:e.phys.Body.prototype.get_type,set:e.phys.Body.prototype.set_type}),e.phys.Body.prototype.get_type=function(){return t.phys.ZPP_Body.types[this.zpp_inner.type]},e.phys.Body.prototype.set_type=function(i){if(this.zpp_inner.immutable_midstep("Body::type"),this.zpp_inner.world)throw new n._Boot.HaxeError("Error: Space::world is immutable");if(t.phys.ZPP_Body.types[this.zpp_inner.type]!=i){if(null==i)throw new n._Boot.HaxeError("Error: Cannot use null BodyType");var r;null==t.util.ZPP_Flags.BodyType_DYNAMIC&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.BodyType_DYNAMIC=new e.phys.BodyType,t.util.ZPP_Flags.internal=!1),i==t.util.ZPP_Flags.BodyType_DYNAMIC?r=2:(null==t.util.ZPP_Flags.BodyType_KINEMATIC&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.BodyType_KINEMATIC=new e.phys.BodyType,t.util.ZPP_Flags.internal=!1),r=i==t.util.ZPP_Flags.BodyType_KINEMATIC?3:1),1==r&&null!=this.zpp_inner.space&&(this.zpp_inner.velx=0,this.zpp_inner.vely=0,this.zpp_inner.angvel=0),this.zpp_inner.invalidate_type(),null!=this.zpp_inner.space?this.zpp_inner.space.transmitType(this.zpp_inner,r):this.zpp_inner.type=r}return t.phys.ZPP_Body.types[this.zpp_inner.type]},Object.defineProperty(e.phys.Body.prototype,"isBullet",{get:e.phys.Body.prototype.get_isBullet,set:e.phys.Body.prototype.set_isBullet}),e.phys.Body.prototype.get_isBullet=function(){return this.zpp_inner.bulletEnabled},e.phys.Body.prototype.set_isBullet=function(e){return this.zpp_inner.bulletEnabled=e,this.zpp_inner.bulletEnabled},Object.defineProperty(e.phys.Body.prototype,"disableCCD",{get:e.phys.Body.prototype.get_disableCCD,set:e.phys.Body.prototype.set_disableCCD}),e.phys.Body.prototype.get_disableCCD=function(){return this.zpp_inner.disableCCD},e.phys.Body.prototype.set_disableCCD=function(e){return this.zpp_inner.disableCCD=e,this.zpp_inner.disableCCD},e.phys.Body.prototype.integrate=function(e){if(e!=e)throw new n._Boot.HaxeError("Cannot integrate by NaN time");if(this.zpp_inner.immutable_midstep("Body::space"),this.zpp_inner.world)throw new n._Boot.HaxeError("Error: Space::world is immutable");if(0==e)return this;var t=this.zpp_inner;t.sweepTime=0,t.sweep_angvel=t.angvel;var i=e-t.sweepTime;if(0!=i){t.sweepTime=e;var r=i;if(t.posx+=t.velx*r,t.posy+=t.vely*r,0!=t.angvel){var o=t.sweep_angvel*i;if(t.rot+=o,o*o>1e-4)t.axisx=Math.sin(t.rot),t.axisy=Math.cos(t.rot);else{var a=o*o,s=1-.5*a,l=1-a*a/8,p=(s*t.axisx+o*t.axisy)*l;t.axisy=(s*t.axisy-o*t.axisx)*l,t.axisx=p}}}for(var u=t.shapes.head;null!=u;){var h=u.elt;1==h.type&&(h.polygon.invalidate_gverts(),h.polygon.invalidate_gaxi()),h.invalidate_worldCOM(),u=u.next}t.zip_worldCOM=!0,t.zip_axis=!0;for(var c=t.shapes.head;null!=c;){var _=c.elt;1==_.type&&(_.polygon.invalidate_gverts(),_.polygon.invalidate_gaxi()),_.invalidate_worldCOM(),c=c.next}return t.zip_worldCOM=!0,t.sweepTime=0,this},e.phys.Body.prototype.isStatic=function(){return 1==this.zpp_inner.type},e.phys.Body.prototype.isDynamic=function(){return 2==this.zpp_inner.type},e.phys.Body.prototype.isKinematic=function(){return 3==this.zpp_inner.type},Object.defineProperty(e.phys.Body.prototype,"shapes",{get:e.phys.Body.prototype.get_shapes}),e.phys.Body.prototype.get_shapes=function(){return this.zpp_inner.wrap_shapes},Object.defineProperty(e.phys.Body.prototype,"compound",{get:e.phys.Body.prototype.get_compound,set:e.phys.Body.prototype.set_compound}),e.phys.Body.prototype.get_compound=function(){return null==this.zpp_inner.compound?null:this.zpp_inner.compound.outer},e.phys.Body.prototype.set_compound=function(e){if((null==this.zpp_inner.compound?null:this.zpp_inner.compound.outer)!=e&&(null!=(null==this.zpp_inner.compound?null:this.zpp_inner.compound.outer)&&(null==this.zpp_inner.compound?null:this.zpp_inner.compound.outer).zpp_inner.wrap_bodies.remove(this),null!=e)){var t=e.zpp_inner.wrap_bodies;t.zpp_inner.reverse_flag?t.push(this):t.unshift(this)}return null==this.zpp_inner.compound?null:this.zpp_inner.compound.outer},Object.defineProperty(e.phys.Body.prototype,"space",{get:e.phys.Body.prototype.get_space,set:e.phys.Body.prototype.set_space}),e.phys.Body.prototype.get_space=function(){return null==this.zpp_inner.space?null:this.zpp_inner.space.outer},e.phys.Body.prototype.set_space=function(e){if(null!=this.zpp_inner.compound)throw new n._Boot.HaxeError("Error: Cannot set the space of a Body belonging to a Compound, only the root Compound space can be set");if(this.zpp_inner.immutable_midstep("Body::space"),this.zpp_inner.world)throw new n._Boot.HaxeError("Error: Space::world is immutable");if((null==this.zpp_inner.space?null:this.zpp_inner.space.outer)!=e&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.component.woken=!1),null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(null==this.zpp_inner.space?null:this.zpp_inner.space.outer).zpp_inner.wrap_bodies.remove(this),null!=e)){var t=e.zpp_inner.wrap_bodies;t.zpp_inner.reverse_flag?t.push(this):t.unshift(this)}return null==this.zpp_inner.space?null:this.zpp_inner.space.outer},Object.defineProperty(e.phys.Body.prototype,"arbiters",{get:e.phys.Body.prototype.get_arbiters}),e.phys.Body.prototype.get_arbiters=function(){return null==this.zpp_inner.wrap_arbiters&&(this.zpp_inner.wrap_arbiters=t.util.ZPP_ArbiterList.get(this.zpp_inner.arbiters,!0)),this.zpp_inner.wrap_arbiters},Object.defineProperty(e.phys.Body.prototype,"isSleeping",{get:e.phys.Body.prototype.get_isSleeping}),e.phys.Body.prototype.get_isSleeping=function(){if(null==this.zpp_inner.space)throw new n._Boot.HaxeError("Error: isSleeping makes no sense if the object is not contained within a Space");return this.zpp_inner.component.sleeping},Object.defineProperty(e.phys.Body.prototype,"constraints",{get:e.phys.Body.prototype.get_constraints}),e.phys.Body.prototype.get_constraints=function(){return null==this.zpp_inner.wrap_constraints&&(this.zpp_inner.wrap_constraints=t.util.ZPP_ConstraintList.get(this.zpp_inner.constraints,!0)),this.zpp_inner.wrap_constraints},e.phys.Body.prototype.copy=function(){if(this.zpp_inner.world)throw new n._Boot.HaxeError("Error: Space::world cannot be copied");return this.zpp_inner.copy()},Object.defineProperty(e.phys.Body.prototype,"position",{get:e.phys.Body.prototype.get_position,set:e.phys.Body.prototype.set_position}),e.phys.Body.prototype.get_position=function(){return null==this.zpp_inner.wrap_pos&&this.zpp_inner.setupPosition(),this.zpp_inner.wrap_pos},e.phys.Body.prototype.set_position=function(e){if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");if(null==e)throw new n._Boot.HaxeError("Error: Body::position cannot be null");null==this.zpp_inner.wrap_pos&&this.zpp_inner.setupPosition();var i=this.zpp_inner.wrap_pos;if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var r=i.zpp_inner;if(r._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=r._isimmutable&&r._isimmutable(),null==e)throw new n._Boot.HaxeError("Error: Cannot assign null Vec2");if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var o=e.zpp_inner;null!=o._validate&&o._validate();var a=e.zpp_inner.x;if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var s=e.zpp_inner;null!=s._validate&&s._validate();var l=e.zpp_inner.y;if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var p,u=i.zpp_inner;if(u._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=u._isimmutable&&u._isimmutable(),a!=a||l!=l)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var h=i.zpp_inner;if(null!=h._validate&&h._validate(),i.zpp_inner.x==a){if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var c=i.zpp_inner;null!=c._validate&&c._validate(),p=i.zpp_inner.y==l}else p=!1;if(!p){i.zpp_inner.x=a,i.zpp_inner.y=l;var _=i.zpp_inner;null!=_._invalidate&&_._invalidate(_)}if(e.zpp_inner.weak){if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var d=e.zpp_inner;if(d._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=d._isimmutable&&d._isimmutable(),e.zpp_inner._inuse)throw new n._Boot.HaxeError("Error: This Vec2 is not disposable");var m=e.zpp_inner;e.zpp_inner.outer=null,e.zpp_inner=null;var P=e;P.zpp_pool=null,null!=t.util.ZPP_PubPool.nextVec2?t.util.ZPP_PubPool.nextVec2.zpp_pool=P:t.util.ZPP_PubPool.poolVec2=P,t.util.ZPP_PubPool.nextVec2=P,P.zpp_disp=!0;var f=m;null!=f.outer&&(f.outer.zpp_inner=null,f.outer=null),f._isimmutable=null,f._validate=null,f._invalidate=null,f.next=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=f}return null==this.zpp_inner.wrap_pos&&this.zpp_inner.setupPosition(),this.zpp_inner.wrap_pos},Object.defineProperty(e.phys.Body.prototype,"velocity",{get:e.phys.Body.prototype.get_velocity,set:e.phys.Body.prototype.set_velocity}),e.phys.Body.prototype.get_velocity=function(){return null==this.zpp_inner.wrap_vel&&this.zpp_inner.setupVelocity(),this.zpp_inner.wrap_vel},e.phys.Body.prototype.set_velocity=function(e){if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");if(null==e)throw new n._Boot.HaxeError("Error: Body::velocity cannot be null");null==this.zpp_inner.wrap_vel&&this.zpp_inner.setupVelocity();var i=this.zpp_inner.wrap_vel;if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var r=i.zpp_inner;if(r._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=r._isimmutable&&r._isimmutable(),null==e)throw new n._Boot.HaxeError("Error: Cannot assign null Vec2");if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var o=e.zpp_inner;null!=o._validate&&o._validate();var a=e.zpp_inner.x;if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var s=e.zpp_inner;null!=s._validate&&s._validate();var l=e.zpp_inner.y;if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var p,u=i.zpp_inner;if(u._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=u._isimmutable&&u._isimmutable(),a!=a||l!=l)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var h=i.zpp_inner;if(null!=h._validate&&h._validate(),i.zpp_inner.x==a){if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var c=i.zpp_inner;null!=c._validate&&c._validate(),p=i.zpp_inner.y==l}else p=!1;if(!p){i.zpp_inner.x=a,i.zpp_inner.y=l;var _=i.zpp_inner;null!=_._invalidate&&_._invalidate(_)}if(e.zpp_inner.weak){if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var d=e.zpp_inner;if(d._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=d._isimmutable&&d._isimmutable(),e.zpp_inner._inuse)throw new n._Boot.HaxeError("Error: This Vec2 is not disposable");var m=e.zpp_inner;e.zpp_inner.outer=null,e.zpp_inner=null;var P=e;P.zpp_pool=null,null!=t.util.ZPP_PubPool.nextVec2?t.util.ZPP_PubPool.nextVec2.zpp_pool=P:t.util.ZPP_PubPool.poolVec2=P,t.util.ZPP_PubPool.nextVec2=P,P.zpp_disp=!0;var f=m;null!=f.outer&&(f.outer.zpp_inner=null,f.outer=null),f._isimmutable=null,f._validate=null,f._invalidate=null,f.next=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=f}return null==this.zpp_inner.wrap_vel&&this.zpp_inner.setupVelocity(),this.zpp_inner.wrap_vel},e.phys.Body.prototype.setVelocityFromTarget=function(e,i,r){if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");if(null==e)throw new n._Boot.HaxeError("Cannot set velocity for null target position");if(0==r)throw new n._Boot.HaxeError("deltaTime cannot be 0 for setVelocityFromTarget");var o=1/r;null==this.zpp_inner.wrap_vel&&this.zpp_inner.setupVelocity();var a=this.zpp_inner.wrap_vel;null==this.zpp_inner.wrap_pos&&this.zpp_inner.setupPosition();var s=e.sub(this.zpp_inner.wrap_pos,!0).muleq(o);if(null!=a&&a.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");if(null!=s&&s.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var l=a.zpp_inner;if(l._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=l._isimmutable&&l._isimmutable(),null==s)throw new n._Boot.HaxeError("Error: Cannot assign null Vec2");if(null!=s&&s.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var p=s.zpp_inner;null!=p._validate&&p._validate();var u=s.zpp_inner.x;if(null!=s&&s.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var h=s.zpp_inner;null!=h._validate&&h._validate();var c=s.zpp_inner.y;if(null!=a&&a.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var _,d=a.zpp_inner;if(d._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=d._isimmutable&&d._isimmutable(),u!=u||c!=c)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null!=a&&a.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var m=a.zpp_inner;if(null!=m._validate&&m._validate(),a.zpp_inner.x==u){if(null!=a&&a.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var P=a.zpp_inner;null!=P._validate&&P._validate(),_=a.zpp_inner.y==c}else _=!1;if(!_){a.zpp_inner.x=u,a.zpp_inner.y=c;var f=a.zpp_inner;null!=f._invalidate&&f._invalidate(f)}if(s.zpp_inner.weak){if(null!=s&&s.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var x=s.zpp_inner;if(x._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=x._isimmutable&&x._isimmutable(),s.zpp_inner._inuse)throw new n._Boot.HaxeError("Error: This Vec2 is not disposable");var y=s.zpp_inner;s.zpp_inner.outer=null,s.zpp_inner=null;var v=s;v.zpp_pool=null,null!=t.util.ZPP_PubPool.nextVec2?t.util.ZPP_PubPool.nextVec2.zpp_pool=v:t.util.ZPP_PubPool.poolVec2=v,t.util.ZPP_PubPool.nextVec2=v,v.zpp_disp=!0;var g=y;null!=g.outer&&(g.outer.zpp_inner=null,g.outer=null),g._isimmutable=null,g._validate=null,g._invalidate=null,g.next=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=g}var b=(i-this.zpp_inner.rot)*o;if(this.zpp_inner.world)throw new n._Boot.HaxeError("Error: Space::world is immutable");if(this.zpp_inner.angvel!=b){if(b!=b)throw new n._Boot.HaxeError("Error: Body::angularVel cannot be NaN");if(1==this.zpp_inner.type)throw new n._Boot.HaxeError("Error: A static object cannot be given a velocity");this.zpp_inner.angvel=b,this.zpp_inner.wake()}if(e.zpp_inner.weak){if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var z=e.zpp_inner;if(z._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=z._isimmutable&&z._isimmutable(),e.zpp_inner._inuse)throw new n._Boot.HaxeError("Error: This Vec2 is not disposable");var w=e.zpp_inner;e.zpp_inner.outer=null,e.zpp_inner=null;var Z=e;Z.zpp_pool=null,null!=t.util.ZPP_PubPool.nextVec2?t.util.ZPP_PubPool.nextVec2.zpp_pool=Z:t.util.ZPP_PubPool.poolVec2=Z,t.util.ZPP_PubPool.nextVec2=Z,Z.zpp_disp=!0;var E=w;null!=E.outer&&(E.outer.zpp_inner=null,E.outer=null),E._isimmutable=null,E._validate=null,E._invalidate=null,E.next=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=E}return this},Object.defineProperty(e.phys.Body.prototype,"kinematicVel",{get:e.phys.Body.prototype.get_kinematicVel,set:e.phys.Body.prototype.set_kinematicVel}),e.phys.Body.prototype.get_kinematicVel=function(){return null==this.zpp_inner.wrap_kinvel&&this.zpp_inner.setupkinvel(),this.zpp_inner.wrap_kinvel},e.phys.Body.prototype.set_kinematicVel=function(e){if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");if(null==e)throw new n._Boot.HaxeError("Error: Body::kinematicVel cannot be null");null==this.zpp_inner.wrap_kinvel&&this.zpp_inner.setupkinvel();var i=this.zpp_inner.wrap_kinvel;if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var r=i.zpp_inner;if(r._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=r._isimmutable&&r._isimmutable(),null==e)throw new n._Boot.HaxeError("Error: Cannot assign null Vec2");if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var o=e.zpp_inner;null!=o._validate&&o._validate();var a=e.zpp_inner.x;if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var s=e.zpp_inner;null!=s._validate&&s._validate();var l=e.zpp_inner.y;if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var p,u=i.zpp_inner;if(u._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=u._isimmutable&&u._isimmutable(),a!=a||l!=l)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var h=i.zpp_inner;if(null!=h._validate&&h._validate(),i.zpp_inner.x==a){if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var c=i.zpp_inner;null!=c._validate&&c._validate(),p=i.zpp_inner.y==l}else p=!1;if(!p){i.zpp_inner.x=a,i.zpp_inner.y=l;var _=i.zpp_inner;null!=_._invalidate&&_._invalidate(_)}if(e.zpp_inner.weak){if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var d=e.zpp_inner;if(d._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=d._isimmutable&&d._isimmutable(),e.zpp_inner._inuse)throw new n._Boot.HaxeError("Error: This Vec2 is not disposable");var m=e.zpp_inner;e.zpp_inner.outer=null,e.zpp_inner=null;var P=e;P.zpp_pool=null,null!=t.util.ZPP_PubPool.nextVec2?t.util.ZPP_PubPool.nextVec2.zpp_pool=P:t.util.ZPP_PubPool.poolVec2=P,t.util.ZPP_PubPool.nextVec2=P,P.zpp_disp=!0;var f=m;null!=f.outer&&(f.outer.zpp_inner=null,f.outer=null),f._isimmutable=null,f._validate=null,f._invalidate=null,f.next=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=f}return null==this.zpp_inner.wrap_kinvel&&this.zpp_inner.setupkinvel(),this.zpp_inner.wrap_kinvel},Object.defineProperty(e.phys.Body.prototype,"surfaceVel",{get:e.phys.Body.prototype.get_surfaceVel,set:e.phys.Body.prototype.set_surfaceVel}),e.phys.Body.prototype.get_surfaceVel=function(){return null==this.zpp_inner.wrap_svel&&this.zpp_inner.setupsvel(),this.zpp_inner.wrap_svel},e.phys.Body.prototype.set_surfaceVel=function(e){if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");if(null==e)throw new n._Boot.HaxeError("Error: Body::surfaceVel cannot be null");null==this.zpp_inner.wrap_svel&&this.zpp_inner.setupsvel();var i=this.zpp_inner.wrap_svel;if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var r=i.zpp_inner;if(r._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=r._isimmutable&&r._isimmutable(),null==e)throw new n._Boot.HaxeError("Error: Cannot assign null Vec2");if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var o=e.zpp_inner;null!=o._validate&&o._validate();var a=e.zpp_inner.x;if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var s=e.zpp_inner;null!=s._validate&&s._validate();var l=e.zpp_inner.y;if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var p,u=i.zpp_inner;if(u._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=u._isimmutable&&u._isimmutable(),a!=a||l!=l)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var h=i.zpp_inner;if(null!=h._validate&&h._validate(),i.zpp_inner.x==a){if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var c=i.zpp_inner;null!=c._validate&&c._validate(),p=i.zpp_inner.y==l}else p=!1;if(!p){i.zpp_inner.x=a,i.zpp_inner.y=l;var _=i.zpp_inner;null!=_._invalidate&&_._invalidate(_)}if(e.zpp_inner.weak){if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var d=e.zpp_inner;if(d._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=d._isimmutable&&d._isimmutable(),e.zpp_inner._inuse)throw new n._Boot.HaxeError("Error: This Vec2 is not disposable");var m=e.zpp_inner;e.zpp_inner.outer=null,e.zpp_inner=null;var P=e;P.zpp_pool=null,null!=t.util.ZPP_PubPool.nextVec2?t.util.ZPP_PubPool.nextVec2.zpp_pool=P:t.util.ZPP_PubPool.poolVec2=P,t.util.ZPP_PubPool.nextVec2=P,P.zpp_disp=!0;var f=m;null!=f.outer&&(f.outer.zpp_inner=null,f.outer=null),f._isimmutable=null,f._validate=null,f._invalidate=null,f.next=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=f}return null==this.zpp_inner.wrap_svel&&this.zpp_inner.setupsvel(),this.zpp_inner.wrap_svel},Object.defineProperty(e.phys.Body.prototype,"force",{get:e.phys.Body.prototype.get_force,set:e.phys.Body.prototype.set_force}),e.phys.Body.prototype.get_force=function(){return null==this.zpp_inner.wrap_force&&this.zpp_inner.setupForce(),this.zpp_inner.wrap_force},e.phys.Body.prototype.set_force=function(e){if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");if(null==e)throw new n._Boot.HaxeError("Error: Body::force cannot be null");null==this.zpp_inner.wrap_force&&this.zpp_inner.setupForce();var i=this.zpp_inner.wrap_force;if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var r=i.zpp_inner;if(r._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=r._isimmutable&&r._isimmutable(),null==e)throw new n._Boot.HaxeError("Error: Cannot assign null Vec2");if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var o=e.zpp_inner;null!=o._validate&&o._validate();var a=e.zpp_inner.x;if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var s=e.zpp_inner;null!=s._validate&&s._validate();var l=e.zpp_inner.y;if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var p,u=i.zpp_inner;if(u._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=u._isimmutable&&u._isimmutable(),a!=a||l!=l)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var h=i.zpp_inner;if(null!=h._validate&&h._validate(),i.zpp_inner.x==a){if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var c=i.zpp_inner;null!=c._validate&&c._validate(),p=i.zpp_inner.y==l}else p=!1;if(!p){i.zpp_inner.x=a,i.zpp_inner.y=l;var _=i.zpp_inner;null!=_._invalidate&&_._invalidate(_)}if(e.zpp_inner.weak){if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var d=e.zpp_inner;if(d._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=d._isimmutable&&d._isimmutable(),e.zpp_inner._inuse)throw new n._Boot.HaxeError("Error: This Vec2 is not disposable");var m=e.zpp_inner;e.zpp_inner.outer=null,e.zpp_inner=null;var P=e;P.zpp_pool=null,null!=t.util.ZPP_PubPool.nextVec2?t.util.ZPP_PubPool.nextVec2.zpp_pool=P:t.util.ZPP_PubPool.poolVec2=P,t.util.ZPP_PubPool.nextVec2=P,P.zpp_disp=!0;var f=m;null!=f.outer&&(f.outer.zpp_inner=null,f.outer=null),f._isimmutable=null,f._validate=null,f._invalidate=null,f.next=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=f}return null==this.zpp_inner.wrap_force&&this.zpp_inner.setupForce(),this.zpp_inner.wrap_force},Object.defineProperty(e.phys.Body.prototype,"constraintVelocity",{get:e.phys.Body.prototype.get_constraintVelocity}),e.phys.Body.prototype.get_constraintVelocity=function(){return null==this.zpp_inner.wrapcvel&&this.zpp_inner.setup_cvel(),this.zpp_inner.wrapcvel},Object.defineProperty(e.phys.Body.prototype,"rotation",{get:e.phys.Body.prototype.get_rotation,set:e.phys.Body.prototype.set_rotation}),e.phys.Body.prototype.get_rotation=function(){return this.zpp_inner.rot},e.phys.Body.prototype.set_rotation=function(e){if(this.zpp_inner.immutable_midstep("Body::rotation"),this.zpp_inner.world)throw new n._Boot.HaxeError("Error: Space::world is immutable");if(1==this.zpp_inner.type&&null!=this.zpp_inner.space)throw new n._Boot.HaxeError("Error: Static objects cannot be rotated once inside a Space");if(this.zpp_inner.rot!=e){if(e!=e)throw new n._Boot.HaxeError("Error: Body::rotation cannot be NaN");this.zpp_inner.rot=e;var t=this.zpp_inner;t.zip_axis=!0;for(var i=t.shapes.head;null!=i;){var r=i.elt;1==r.type&&(r.polygon.invalidate_gverts(),r.polygon.invalidate_gaxi()),r.invalidate_worldCOM(),i=i.next}t.zip_worldCOM=!0,this.zpp_inner.wake()}return this.zpp_inner.rot},Object.defineProperty(e.phys.Body.prototype,"angularVel",{get:e.phys.Body.prototype.get_angularVel,set:e.phys.Body.prototype.set_angularVel}),e.phys.Body.prototype.get_angularVel=function(){return this.zpp_inner.angvel},e.phys.Body.prototype.set_angularVel=function(e){if(this.zpp_inner.world)throw new n._Boot.HaxeError("Error: Space::world is immutable");if(this.zpp_inner.angvel!=e){if(e!=e)throw new n._Boot.HaxeError("Error: Body::angularVel cannot be NaN");if(1==this.zpp_inner.type)throw new n._Boot.HaxeError("Error: A static object cannot be given a velocity");this.zpp_inner.angvel=e,this.zpp_inner.wake()}return this.zpp_inner.angvel},Object.defineProperty(e.phys.Body.prototype,"kinAngVel",{get:e.phys.Body.prototype.get_kinAngVel,set:e.phys.Body.prototype.set_kinAngVel}),e.phys.Body.prototype.get_kinAngVel=function(){return this.zpp_inner.kinangvel},e.phys.Body.prototype.set_kinAngVel=function(e){if(this.zpp_inner.world)throw new n._Boot.HaxeError("Error: Space::world is immutable");if(this.zpp_inner.kinangvel!=e){if(e!=e)throw new n._Boot.HaxeError("Error: Body::kinAngVel cannot be NaN");this.zpp_inner.kinangvel=e,this.zpp_inner.wake()}return this.zpp_inner.kinangvel},Object.defineProperty(e.phys.Body.prototype,"torque",{get:e.phys.Body.prototype.get_torque,set:e.phys.Body.prototype.set_torque}),e.phys.Body.prototype.get_torque=function(){return this.zpp_inner.torque},e.phys.Body.prototype.set_torque=function(e){if(this.zpp_inner.world)throw new n._Boot.HaxeError("Error: Space::world is immutable");if(2!=this.zpp_inner.type)throw new n._Boot.HaxeError("Error: Non-dynamic body cannot have torque applied.");if(e!=e)throw new n._Boot.HaxeError("Error: Body::torque cannot be NaN");return this.zpp_inner.torque!=e&&(this.zpp_inner.torque=e,this.zpp_inner.wake()),this.zpp_inner.torque},Object.defineProperty(e.phys.Body.prototype,"bounds",{get:e.phys.Body.prototype.get_bounds}),e.phys.Body.prototype.get_bounds=function(){if(this.zpp_inner.world)throw new n._Boot.HaxeError("Error: Space::world has no bounds");return this.zpp_inner.aabb.wrapper()},Object.defineProperty(e.phys.Body.prototype,"allowMovement",{get:e.phys.Body.prototype.get_allowMovement,set:e.phys.Body.prototype.set_allowMovement}),e.phys.Body.prototype.get_allowMovement=function(){return!this.zpp_inner.nomove},e.phys.Body.prototype.set_allowMovement=function(e){return this.zpp_inner.immutable_midstep("Body::"+(null==e?"null":""+e)),!this.zpp_inner.nomove!=e&&(this.zpp_inner.nomove=!e,this.zpp_inner.invalidate_mass()),!this.zpp_inner.nomove},Object.defineProperty(e.phys.Body.prototype,"allowRotation",{get:e.phys.Body.prototype.get_allowRotation,set:e.phys.Body.prototype.set_allowRotation}),e.phys.Body.prototype.get_allowRotation=function(){return!this.zpp_inner.norotate},e.phys.Body.prototype.set_allowRotation=function(e){return this.zpp_inner.immutable_midstep("Body::"+(null==e?"null":""+e)),!this.zpp_inner.norotate!=e&&(this.zpp_inner.norotate=!e,this.zpp_inner.invalidate_inertia()),!this.zpp_inner.norotate},Object.defineProperty(e.phys.Body.prototype,"massMode",{get:e.phys.Body.prototype.get_massMode,set:e.phys.Body.prototype.set_massMode}),e.phys.Body.prototype.get_massMode=function(){null==t.util.ZPP_Flags.MassMode_DEFAULT&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.MassMode_DEFAULT=new e.phys.MassMode,t.util.ZPP_Flags.internal=!1);var n=t.util.ZPP_Flags.MassMode_DEFAULT;return null==t.util.ZPP_Flags.MassMode_FIXED&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.MassMode_FIXED=new e.phys.MassMode,t.util.ZPP_Flags.internal=!1),[n,t.util.ZPP_Flags.MassMode_FIXED][this.zpp_inner.massMode]},e.phys.Body.prototype.set_massMode=function(i){if(this.zpp_inner.immutable_midstep("Body::massMode"),this.zpp_inner.world)throw new n._Boot.HaxeError("Error: Space::world is immutable");if(null==i)throw new n._Boot.HaxeError("Error: cannot use null massMode");null==t.util.ZPP_Flags.MassMode_DEFAULT&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.MassMode_DEFAULT=new e.phys.MassMode,t.util.ZPP_Flags.internal=!1),this.zpp_inner.massMode=i==t.util.ZPP_Flags.MassMode_DEFAULT?0:1,this.zpp_inner.invalidate_mass(),null==t.util.ZPP_Flags.MassMode_DEFAULT&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.MassMode_DEFAULT=new e.phys.MassMode,t.util.ZPP_Flags.internal=!1);var r=t.util.ZPP_Flags.MassMode_DEFAULT;return null==t.util.ZPP_Flags.MassMode_FIXED&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.MassMode_FIXED=new e.phys.MassMode,t.util.ZPP_Flags.internal=!1),[r,t.util.ZPP_Flags.MassMode_FIXED][this.zpp_inner.massMode]},Object.defineProperty(e.phys.Body.prototype,"constraintMass",{get:e.phys.Body.prototype.get_constraintMass}),e.phys.Body.prototype.get_constraintMass=function(){return this.zpp_inner.world||this.zpp_inner.validate_mass(),this.zpp_inner.smass},Object.defineProperty(e.phys.Body.prototype,"mass",{get:e.phys.Body.prototype.get_mass,set:e.phys.Body.prototype.set_mass}),e.phys.Body.prototype.get_mass=function(){if(this.zpp_inner.world)throw new n._Boot.HaxeError("Error: Space::world has no mass");if(this.zpp_inner.validate_mass(),0==this.zpp_inner.massMode&&null==this.zpp_inner.shapes.head)throw new n._Boot.HaxeError("Error: Given current mass mode, Body::mass only makes sense if it contains shapes");return this.zpp_inner.cmass},e.phys.Body.prototype.set_mass=function(e){if(this.zpp_inner.immutable_midstep("Body::mass"),this.zpp_inner.world)throw new n._Boot.HaxeError("Error: Space::world is immutable");if(e!=e)throw new n._Boot.HaxeError("Error: Mass cannot be NaN");if(e<=0)throw new n._Boot.HaxeError("Error: Mass must be strictly positive");if(e>=1/0)throw new n._Boot.HaxeError("Error: Mass cannot be infinite, use allowMovement = false instead");if(this.zpp_inner.massMode=1,this.zpp_inner.cmass=e,this.zpp_inner.invalidate_mass(),this.zpp_inner.world)throw new n._Boot.HaxeError("Error: Space::world has no mass");if(this.zpp_inner.validate_mass(),0==this.zpp_inner.massMode&&null==this.zpp_inner.shapes.head)throw new n._Boot.HaxeError("Error: Given current mass mode, Body::mass only makes sense if it contains shapes");return this.zpp_inner.cmass},Object.defineProperty(e.phys.Body.prototype,"gravMassMode",{get:e.phys.Body.prototype.get_gravMassMode,set:e.phys.Body.prototype.set_gravMassMode}),e.phys.Body.prototype.get_gravMassMode=function(){null==t.util.ZPP_Flags.GravMassMode_DEFAULT&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.GravMassMode_DEFAULT=new e.phys.GravMassMode,t.util.ZPP_Flags.internal=!1);var n=t.util.ZPP_Flags.GravMassMode_DEFAULT;null==t.util.ZPP_Flags.GravMassMode_FIXED&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.GravMassMode_FIXED=new e.phys.GravMassMode,t.util.ZPP_Flags.internal=!1);var i=t.util.ZPP_Flags.GravMassMode_FIXED;return null==t.util.ZPP_Flags.GravMassMode_SCALED&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.GravMassMode_SCALED=new e.phys.GravMassMode,t.util.ZPP_Flags.internal=!1),[n,i,t.util.ZPP_Flags.GravMassMode_SCALED][this.zpp_inner.massMode]},e.phys.Body.prototype.set_gravMassMode=function(i){if(this.zpp_inner.immutable_midstep("Body::gravMassMode"),this.zpp_inner.world)throw new n._Boot.HaxeError("Error: Space::world is immutable");if(null==i)throw new n._Boot.HaxeError("Error: Cannot use null gravMassMode");var r;null==t.util.ZPP_Flags.GravMassMode_SCALED&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.GravMassMode_SCALED=new e.phys.GravMassMode,t.util.ZPP_Flags.internal=!1),i==t.util.ZPP_Flags.GravMassMode_SCALED?r=2:(null==t.util.ZPP_Flags.GravMassMode_DEFAULT&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.GravMassMode_DEFAULT=new e.phys.GravMassMode,t.util.ZPP_Flags.internal=!1),r=i==t.util.ZPP_Flags.GravMassMode_DEFAULT?0:1),this.zpp_inner.gravMassMode=r,this.zpp_inner.invalidate_gravMass(),null==t.util.ZPP_Flags.GravMassMode_DEFAULT&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.GravMassMode_DEFAULT=new e.phys.GravMassMode,t.util.ZPP_Flags.internal=!1);var o=t.util.ZPP_Flags.GravMassMode_DEFAULT;null==t.util.ZPP_Flags.GravMassMode_FIXED&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.GravMassMode_FIXED=new e.phys.GravMassMode,t.util.ZPP_Flags.internal=!1);var a=t.util.ZPP_Flags.GravMassMode_FIXED;return null==t.util.ZPP_Flags.GravMassMode_SCALED&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.GravMassMode_SCALED=new e.phys.GravMassMode,t.util.ZPP_Flags.internal=!1),[o,a,t.util.ZPP_Flags.GravMassMode_SCALED][this.zpp_inner.massMode]},Object.defineProperty(e.phys.Body.prototype,"gravMass",{get:e.phys.Body.prototype.get_gravMass,set:e.phys.Body.prototype.set_gravMass}),e.phys.Body.prototype.get_gravMass=function(){if(this.zpp_inner.world)throw new n._Boot.HaxeError("Error: Space::world has no gravMass");if(this.zpp_inner.validate_gravMass(),null==this.zpp_inner.shapes.head&&0==this.zpp_inner.massMode&&1!=this.zpp_inner.gravMassMode)throw new n._Boot.HaxeError("Error: Given current mass/gravMass modes; Body::gravMass only makes sense if it contains Shapes");return this.zpp_inner.gravMass},e.phys.Body.prototype.set_gravMass=function(e){if(this.zpp_inner.immutable_midstep("Body::gravMass"),this.zpp_inner.world)throw new n._Boot.HaxeError("Error: Space::world is immutable");if(e!=e)throw new n._Boot.HaxeError("Error: gravMass cannot be NaN");if(this.zpp_inner.gravMassMode=1,this.zpp_inner.gravMass=e,this.zpp_inner.invalidate_gravMass(),this.zpp_inner.world)throw new n._Boot.HaxeError("Error: Space::world has no gravMass");if(this.zpp_inner.validate_gravMass(),null==this.zpp_inner.shapes.head&&0==this.zpp_inner.massMode&&1!=this.zpp_inner.gravMassMode)throw new n._Boot.HaxeError("Error: Given current mass/gravMass modes; Body::gravMass only makes sense if it contains Shapes");return this.zpp_inner.gravMass},Object.defineProperty(e.phys.Body.prototype,"gravMassScale",{get:e.phys.Body.prototype.get_gravMassScale,set:e.phys.Body.prototype.set_gravMassScale}),e.phys.Body.prototype.get_gravMassScale=function(){if(this.zpp_inner.validate_gravMassScale(),null==this.zpp_inner.shapes.head&&0==this.zpp_inner.massMode&&2!=this.zpp_inner.gravMassMode)throw new n._Boot.HaxeError("Error: Given current mass/gravMass modes; Body::gravMassScale only makes sense if it contains Shapes");return this.zpp_inner.gravMassScale},e.phys.Body.prototype.set_gravMassScale=function(e){if(this.zpp_inner.immutable_midstep("Body::gravMassScale"),this.zpp_inner.world)throw new n._Boot.HaxeError("Error: Space::world is immutable");if(e!=e)throw new n._Boot.HaxeError("Error: gravMassScale cannot be NaN");if(this.zpp_inner.gravMassMode=2,this.zpp_inner.gravMassScale=e,this.zpp_inner.invalidate_gravMassScale(),this.zpp_inner.validate_gravMassScale(),null==this.zpp_inner.shapes.head&&0==this.zpp_inner.massMode&&2!=this.zpp_inner.gravMassMode)throw new n._Boot.HaxeError("Error: Given current mass/gravMass modes; Body::gravMassScale only makes sense if it contains Shapes");return this.zpp_inner.gravMassScale},Object.defineProperty(e.phys.Body.prototype,"inertiaMode",{get:e.phys.Body.prototype.get_inertiaMode,set:e.phys.Body.prototype.set_inertiaMode}),e.phys.Body.prototype.get_inertiaMode=function(){null==t.util.ZPP_Flags.InertiaMode_DEFAULT&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.InertiaMode_DEFAULT=new e.phys.InertiaMode,t.util.ZPP_Flags.internal=!1);var n=t.util.ZPP_Flags.InertiaMode_DEFAULT;return null==t.util.ZPP_Flags.InertiaMode_FIXED&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.InertiaMode_FIXED=new e.phys.InertiaMode,t.util.ZPP_Flags.internal=!1),[n,t.util.ZPP_Flags.InertiaMode_FIXED][this.zpp_inner.inertiaMode]},e.phys.Body.prototype.set_inertiaMode=function(i){if(this.zpp_inner.immutable_midstep("Body::inertiaMode"),this.zpp_inner.world)throw new n._Boot.HaxeError("Error: Space::world is immutable");if(null==i)throw new n._Boot.HaxeError("Error: Cannot use null InertiaMode");null==t.util.ZPP_Flags.InertiaMode_FIXED&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.InertiaMode_FIXED=new e.phys.InertiaMode,t.util.ZPP_Flags.internal=!1),this.zpp_inner.inertiaMode=i==t.util.ZPP_Flags.InertiaMode_FIXED?1:0,this.zpp_inner.invalidate_inertia(),null==t.util.ZPP_Flags.InertiaMode_DEFAULT&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.InertiaMode_DEFAULT=new e.phys.InertiaMode,t.util.ZPP_Flags.internal=!1);var r=t.util.ZPP_Flags.InertiaMode_DEFAULT;return null==t.util.ZPP_Flags.InertiaMode_FIXED&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.InertiaMode_FIXED=new e.phys.InertiaMode,t.util.ZPP_Flags.internal=!1),[r,t.util.ZPP_Flags.InertiaMode_FIXED][this.zpp_inner.inertiaMode]},Object.defineProperty(e.phys.Body.prototype,"constraintInertia",{get:e.phys.Body.prototype.get_constraintInertia}),e.phys.Body.prototype.get_constraintInertia=function(){return this.zpp_inner.world||this.zpp_inner.validate_inertia(),this.zpp_inner.sinertia},Object.defineProperty(e.phys.Body.prototype,"inertia",{get:e.phys.Body.prototype.get_inertia,set:e.phys.Body.prototype.set_inertia}),e.phys.Body.prototype.get_inertia=function(){if(this.zpp_inner.world)throw new n._Boot.HaxeError("Error: Space::world has no inertia");if(this.zpp_inner.validate_inertia(),0==this.zpp_inner.inertiaMode&&null==this.zpp_inner.wrap_shapes.zpp_inner.inner.head)throw new n._Boot.HaxeError("Error: Given current inertia mode flag, Body::inertia only makes sense if Body contains Shapes");return this.zpp_inner.cinertia},e.phys.Body.prototype.set_inertia=function(e){if(this.zpp_inner.immutable_midstep("Body::inertia"),this.zpp_inner.world)throw new n._Boot.HaxeError("Error: Space::world is immutable");if(e!=e)throw new n._Boot.HaxeError("Error: Inertia cannot be NaN");if(e<=0)throw new n._Boot.HaxeError("Error: Inertia must be strictly positive");if(e>=1/0)throw new n._Boot.HaxeError("Error: Inertia cannot be infinite, use allowRotation = false instead");if(this.zpp_inner.inertiaMode=1,this.zpp_inner.cinertia=e,this.zpp_inner.invalidate_inertia(),this.zpp_inner.world)throw new n._Boot.HaxeError("Error: Space::world has no inertia");if(this.zpp_inner.validate_inertia(),0==this.zpp_inner.inertiaMode&&null==this.zpp_inner.wrap_shapes.zpp_inner.inner.head)throw new n._Boot.HaxeError("Error: Given current inertia mode flag, Body::inertia only makes sense if Body contains Shapes");return this.zpp_inner.cinertia},e.phys.Body.prototype.connectedBodies=function(e,t){return null==e&&(e=-1),this.zpp_inner.connectedBodies(e,t)},e.phys.Body.prototype.interactingBodies=function(n,i,r){var o;return null==i&&(i=-1),null==n?o=t.dynamics.ZPP_Arbiter.COL|t.dynamics.ZPP_Arbiter.SENSOR|t.dynamics.ZPP_Arbiter.FLUID:(null==t.util.ZPP_Flags.InteractionType_COLLISION&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.InteractionType_COLLISION=new e.callbacks.InteractionType,t.util.ZPP_Flags.internal=!1),n==t.util.ZPP_Flags.InteractionType_COLLISION?o=t.dynamics.ZPP_Arbiter.COL:(null==t.util.ZPP_Flags.InteractionType_SENSOR&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.InteractionType_SENSOR=new e.callbacks.InteractionType,t.util.ZPP_Flags.internal=!1),o=n==t.util.ZPP_Flags.InteractionType_SENSOR?t.dynamics.ZPP_Arbiter.SENSOR:t.dynamics.ZPP_Arbiter.FLUID)),this.zpp_inner.interactingBodies(o,i,r)},e.phys.Body.prototype.crushFactor=function(){if(null==(null==this.zpp_inner.space?null:this.zpp_inner.space.outer))throw new n._Boot.HaxeError("Error: Makes no sense to see how much an object not taking part in a simulation is being crushed");var i,r=0;if(null==t.util.ZPP_PubPool.poolVec2?i=new e.geom.Vec2:(i=t.util.ZPP_PubPool.poolVec2,t.util.ZPP_PubPool.poolVec2=i.zpp_pool,i.zpp_pool=null,i.zpp_disp=!1,i==t.util.ZPP_PubPool.nextVec2&&(t.util.ZPP_PubPool.nextVec2=null)),null==i.zpp_inner){var o;null==t.geom.ZPP_Vec2.zpp_pool?o=new t.geom.ZPP_Vec2:(o=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=o.next,o.next=null),o.weak=!1,o._immutable=!1,o.x=0,o.y=0,i.zpp_inner=o,i.zpp_inner.outer=i}else{if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var a,s=i.zpp_inner;if(s._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=s._isimmutable&&s._isimmutable(),null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var l=i.zpp_inner;if(null!=l._validate&&l._validate(),0==i.zpp_inner.x){if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var p=i.zpp_inner;null!=p._validate&&p._validate(),a=0==i.zpp_inner.y}else a=!1;if(!a){i.zpp_inner.x=0,i.zpp_inner.y=0;var u=i.zpp_inner;null!=u._invalidate&&u._invalidate(u)}}i.zpp_inner.weak=!1;var h=i;null==this.zpp_inner.wrap_arbiters&&(this.zpp_inner.wrap_arbiters=t.util.ZPP_ArbiterList.get(this.zpp_inner.arbiters,!0));for(var c=this.zpp_inner.wrap_arbiters.iterator();;){c.zpp_inner.zpp_inner.valmod();var _,d=c.zpp_inner.zpp_gl();if(c.zpp_critical=!0,c.zpp_i<d?_=!0:(c.zpp_next=e.dynamics.ArbiterIterator.zpp_pool,e.dynamics.ArbiterIterator.zpp_pool=c,c.zpp_inner=null,_=!1),!_)break;c.zpp_critical=!1;var m=c.zpp_inner.at(c.zpp_i++).totalImpulse(this),P=m.xy();if(h.addeq(P),null!=P&&P.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");if(null!=P&&P.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var f=P.zpp_inner;null!=f._validate&&f._validate();var x=P.zpp_inner.x;if(null!=P&&P.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var y=P.zpp_inner;null!=y._validate&&y._validate();var v=x*P.zpp_inner.x;if(null!=P&&P.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var g=P.zpp_inner;null!=g._validate&&g._validate();var b=P.zpp_inner.y;if(null!=P&&P.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var z=P.zpp_inner;if(null!=z._validate&&z._validate(),r+=Math.sqrt(v+b*P.zpp_inner.y),null!=P&&P.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var w=P.zpp_inner;if(w._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=w._isimmutable&&w._isimmutable(),P.zpp_inner._inuse)throw new n._Boot.HaxeError("Error: This Vec2 is not disposable");var Z=P.zpp_inner;P.zpp_inner.outer=null,P.zpp_inner=null;var E=P;E.zpp_pool=null,null!=t.util.ZPP_PubPool.nextVec2?t.util.ZPP_PubPool.nextVec2.zpp_pool=E:t.util.ZPP_PubPool.poolVec2=E,t.util.ZPP_PubPool.nextVec2=E,E.zpp_disp=!0;var M=Z;null!=M.outer&&(M.outer.zpp_inner=null,M.outer=null),M._isimmutable=null,M._validate=null,M._invalidate=null,M.next=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=M,m.dispose()}null==this.zpp_inner.wrap_constraints&&(this.zpp_inner.wrap_constraints=t.util.ZPP_ConstraintList.get(this.zpp_inner.constraints,!0));var S=this.zpp_inner.wrap_constraints;S.zpp_inner.valmod();for(var C=e.constraint.ConstraintIterator.get(S);;){C.zpp_inner.zpp_inner.valmod();var N=C.zpp_inner;N.zpp_inner.valmod(),N.zpp_inner.zip_length&&(N.zpp_inner.zip_length=!1,N.zpp_inner.user_length=N.zpp_inner.inner.length);var A,L=N.zpp_inner.user_length;if(C.zpp_critical=!0,C.zpp_i<L?A=!0:(C.zpp_next=e.constraint.ConstraintIterator.zpp_pool,e.constraint.ConstraintIterator.zpp_pool=C,C.zpp_inner=null,A=!1),!A)break;C.zpp_critical=!1;var B=C.zpp_inner.at(C.zpp_i++).bodyImpulse(this),T=B.xy();if(h.addeq(T),null!=T&&T.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");if(null!=T&&T.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var V=T.zpp_inner;null!=V._validate&&V._validate();var k=T.zpp_inner.x;if(null!=T&&T.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var I=T.zpp_inner;null!=I._validate&&I._validate();var O=k*T.zpp_inner.x;if(null!=T&&T.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var R=T.zpp_inner;null!=R._validate&&R._validate();var H=T.zpp_inner.y;if(null!=T&&T.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var F=T.zpp_inner;if(null!=F._validate&&F._validate(),r+=Math.sqrt(O+H*T.zpp_inner.y),null!=T&&T.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var D=T.zpp_inner;if(D._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=D._isimmutable&&D._isimmutable(),T.zpp_inner._inuse)throw new n._Boot.HaxeError("Error: This Vec2 is not disposable");var G=T.zpp_inner;T.zpp_inner.outer=null,T.zpp_inner=null;var U=T;U.zpp_pool=null,null!=t.util.ZPP_PubPool.nextVec2?t.util.ZPP_PubPool.nextVec2.zpp_pool=U:t.util.ZPP_PubPool.poolVec2=U,t.util.ZPP_PubPool.nextVec2=U,U.zpp_disp=!0;var j=G;null!=j.outer&&(j.outer.zpp_inner=null,j.outer=null),j._isimmutable=null,j._validate=null,j._invalidate=null,j.next=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=j,B.dispose()}if(null!=h&&h.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");if(null!=h&&h.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var W=h.zpp_inner;null!=W._validate&&W._validate();var q=h.zpp_inner.x;if(null!=h&&h.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var J=h.zpp_inner;null!=J._validate&&J._validate();var $=q*h.zpp_inner.x;if(null!=h&&h.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var X=h.zpp_inner;null!=X._validate&&X._validate();var Y=h.zpp_inner.y;if(null!=h&&h.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var K=h.zpp_inner;null!=K._validate&&K._validate();var Q=r-Math.sqrt($+Y*h.zpp_inner.y);if(this.zpp_inner.world)throw new n._Boot.HaxeError("Error: Space::world has no mass");if(this.zpp_inner.validate_mass(),0==this.zpp_inner.massMode&&null==this.zpp_inner.shapes.head)throw new n._Boot.HaxeError("Error: Given current mass mode, Body::mass only makes sense if it contains shapes");var ee=Q/(this.zpp_inner.cmass*(null==this.zpp_inner.space?null:this.zpp_inner.space.outer).zpp_inner.pre_dt);if(null!=h&&h.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var te=h.zpp_inner;if(te._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=te._isimmutable&&te._isimmutable(),h.zpp_inner._inuse)throw new n._Boot.HaxeError("Error: This Vec2 is not disposable");var ne=h.zpp_inner;h.zpp_inner.outer=null,h.zpp_inner=null;var ie=h;ie.zpp_pool=null,null!=t.util.ZPP_PubPool.nextVec2?t.util.ZPP_PubPool.nextVec2.zpp_pool=ie:t.util.ZPP_PubPool.poolVec2=ie,t.util.ZPP_PubPool.nextVec2=ie,ie.zpp_disp=!0;var re=ne;return null!=re.outer&&(re.outer.zpp_inner=null,re.outer=null),re._isimmutable=null,re._validate=null,re._invalidate=null,re.next=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=re,ee},e.phys.Body.prototype.localPointToWorld=function(i,r){if(null==r&&(r=!1),null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");if(null==i)throw new n._Boot.HaxeError("Error: Cannot transform null Vec2");var o=this.zpp_inner;o.zip_axis&&(o.zip_axis=!1,o.axisx=Math.sin(o.rot),o.axisy=Math.cos(o.rot));var a,s,l=this.zpp_inner.axisy;if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var p=i.zpp_inner;null!=p._validate&&p._validate();var u=l*i.zpp_inner.x,h=this.zpp_inner.axisx;if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var c=i.zpp_inner;if(null!=c._validate&&c._validate(),a=u-h*i.zpp_inner.y,null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var _=i.zpp_inner;null!=_._validate&&_._validate();var d=i.zpp_inner.x*this.zpp_inner.axisx;if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var m=i.zpp_inner;if(null!=m._validate&&m._validate(),s=d+i.zpp_inner.y*this.zpp_inner.axisy,i.zpp_inner.weak){if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var P=i.zpp_inner;if(P._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=P._isimmutable&&P._isimmutable(),i.zpp_inner._inuse)throw new n._Boot.HaxeError("Error: This Vec2 is not disposable");var f=i.zpp_inner;i.zpp_inner.outer=null,i.zpp_inner=null;var x=i;x.zpp_pool=null,null!=t.util.ZPP_PubPool.nextVec2?t.util.ZPP_PubPool.nextVec2.zpp_pool=x:t.util.ZPP_PubPool.poolVec2=x,t.util.ZPP_PubPool.nextVec2=x,x.zpp_disp=!0;var y=f;null!=y.outer&&(y.outer.zpp_inner=null,y.outer=null),y._isimmutable=null,y._validate=null,y._invalidate=null,y.next=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=y}var v,g=a+this.zpp_inner.posx,b=s+this.zpp_inner.posy,z=r;if(null==z&&(z=!1),null==b&&(b=0),null==g&&(g=0),g!=g||b!=b)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null==t.util.ZPP_PubPool.poolVec2?v=new e.geom.Vec2:(v=t.util.ZPP_PubPool.poolVec2,t.util.ZPP_PubPool.poolVec2=v.zpp_pool,v.zpp_pool=null,v.zpp_disp=!1,v==t.util.ZPP_PubPool.nextVec2&&(t.util.ZPP_PubPool.nextVec2=null)),null==v.zpp_inner){var w;null==t.geom.ZPP_Vec2.zpp_pool?w=new t.geom.ZPP_Vec2:(w=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=w.next,w.next=null),w.weak=!1,w._immutable=!1,w.x=g,w.y=b,v.zpp_inner=w,v.zpp_inner.outer=v}else{if(null!=v&&v.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var Z,E=v.zpp_inner;if(E._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=E._isimmutable&&E._isimmutable(),g!=g||b!=b)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null!=v&&v.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var M=v.zpp_inner;if(null!=M._validate&&M._validate(),v.zpp_inner.x==g){if(null!=v&&v.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var S=v.zpp_inner;null!=S._validate&&S._validate(),Z=v.zpp_inner.y==b}else Z=!1;if(!Z){v.zpp_inner.x=g,v.zpp_inner.y=b;var C=v.zpp_inner;null!=C._invalidate&&C._invalidate(C)}}return v.zpp_inner.weak=z,v},e.phys.Body.prototype.worldPointToLocal=function(i,r){if(null==r&&(r=!1),null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");if(null==i)throw new n._Boot.HaxeError("Error: Cannot transform null Vec2");var o,a,s,l,p=this.zpp_inner;if(p.zip_axis&&(p.zip_axis=!1,p.axisx=Math.sin(p.rot),p.axisy=Math.cos(p.rot)),null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var u=i.zpp_inner;if(null!=u._validate&&u._validate(),s=i.zpp_inner.x-this.zpp_inner.posx,null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var h=i.zpp_inner;if(null!=h._validate&&h._validate(),l=i.zpp_inner.y-this.zpp_inner.posy,o=s*this.zpp_inner.axisy+l*this.zpp_inner.axisx,a=l*this.zpp_inner.axisy-s*this.zpp_inner.axisx,i.zpp_inner.weak){if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var c=i.zpp_inner;if(c._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=c._isimmutable&&c._isimmutable(),i.zpp_inner._inuse)throw new n._Boot.HaxeError("Error: This Vec2 is not disposable");var _=i.zpp_inner;i.zpp_inner.outer=null,i.zpp_inner=null;var d=i;d.zpp_pool=null,null!=t.util.ZPP_PubPool.nextVec2?t.util.ZPP_PubPool.nextVec2.zpp_pool=d:t.util.ZPP_PubPool.poolVec2=d,t.util.ZPP_PubPool.nextVec2=d,d.zpp_disp=!0;var m=_;null!=m.outer&&(m.outer.zpp_inner=null,m.outer=null),m._isimmutable=null,m._validate=null,m._invalidate=null,m.next=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=m}var P,f=o,x=a,y=r;if(null==y&&(y=!1),null==x&&(x=0),null==f&&(f=0),f!=f||x!=x)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null==t.util.ZPP_PubPool.poolVec2?P=new e.geom.Vec2:(P=t.util.ZPP_PubPool.poolVec2,t.util.ZPP_PubPool.poolVec2=P.zpp_pool,P.zpp_pool=null,P.zpp_disp=!1,P==t.util.ZPP_PubPool.nextVec2&&(t.util.ZPP_PubPool.nextVec2=null)),null==P.zpp_inner){var v;null==t.geom.ZPP_Vec2.zpp_pool?v=new t.geom.ZPP_Vec2:(v=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=v.next,v.next=null),v.weak=!1,v._immutable=!1,v.x=f,v.y=x,P.zpp_inner=v,P.zpp_inner.outer=P}else{if(null!=P&&P.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var g,b=P.zpp_inner;if(b._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=b._isimmutable&&b._isimmutable(),f!=f||x!=x)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null!=P&&P.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var z=P.zpp_inner;if(null!=z._validate&&z._validate(),P.zpp_inner.x==f){if(null!=P&&P.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var w=P.zpp_inner;null!=w._validate&&w._validate(),g=P.zpp_inner.y==x}else g=!1;if(!g){P.zpp_inner.x=f,P.zpp_inner.y=x;var Z=P.zpp_inner;null!=Z._invalidate&&Z._invalidate(Z)}}return P.zpp_inner.weak=y,P},e.phys.Body.prototype.localVectorToWorld=function(i,r){if(null==r&&(r=!1),null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");if(null==i)throw new n._Boot.HaxeError("Error: Cannot transform null Vec2");var o=this.zpp_inner;o.zip_axis&&(o.zip_axis=!1,o.axisx=Math.sin(o.rot),o.axisy=Math.cos(o.rot));var a,s,l=this.zpp_inner.axisy;if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var p=i.zpp_inner;null!=p._validate&&p._validate();var u=l*i.zpp_inner.x,h=this.zpp_inner.axisx;if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var c=i.zpp_inner;if(null!=c._validate&&c._validate(),a=u-h*i.zpp_inner.y,null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var _=i.zpp_inner;null!=_._validate&&_._validate();var d=i.zpp_inner.x*this.zpp_inner.axisx;if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var m=i.zpp_inner;if(null!=m._validate&&m._validate(),s=d+i.zpp_inner.y*this.zpp_inner.axisy,i.zpp_inner.weak){if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var P=i.zpp_inner;if(P._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=P._isimmutable&&P._isimmutable(),i.zpp_inner._inuse)throw new n._Boot.HaxeError("Error: This Vec2 is not disposable");var f=i.zpp_inner;i.zpp_inner.outer=null,i.zpp_inner=null;var x=i;x.zpp_pool=null,null!=t.util.ZPP_PubPool.nextVec2?t.util.ZPP_PubPool.nextVec2.zpp_pool=x:t.util.ZPP_PubPool.poolVec2=x,t.util.ZPP_PubPool.nextVec2=x,x.zpp_disp=!0;var y=f;null!=y.outer&&(y.outer.zpp_inner=null,y.outer=null),y._isimmutable=null,y._validate=null,y._invalidate=null,y.next=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=y}var v,g=a,b=s,z=r;if(null==z&&(z=!1),null==b&&(b=0),null==g&&(g=0),g!=g||b!=b)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null==t.util.ZPP_PubPool.poolVec2?v=new e.geom.Vec2:(v=t.util.ZPP_PubPool.poolVec2,t.util.ZPP_PubPool.poolVec2=v.zpp_pool,v.zpp_pool=null,v.zpp_disp=!1,v==t.util.ZPP_PubPool.nextVec2&&(t.util.ZPP_PubPool.nextVec2=null)),null==v.zpp_inner){var w;null==t.geom.ZPP_Vec2.zpp_pool?w=new t.geom.ZPP_Vec2:(w=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=w.next,w.next=null),w.weak=!1,w._immutable=!1,w.x=g,w.y=b,v.zpp_inner=w,v.zpp_inner.outer=v}else{if(null!=v&&v.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var Z,E=v.zpp_inner;if(E._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=E._isimmutable&&E._isimmutable(),g!=g||b!=b)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null!=v&&v.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var M=v.zpp_inner;if(null!=M._validate&&M._validate(),v.zpp_inner.x==g){if(null!=v&&v.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var S=v.zpp_inner;null!=S._validate&&S._validate(),Z=v.zpp_inner.y==b}else Z=!1;if(!Z){v.zpp_inner.x=g,v.zpp_inner.y=b;var C=v.zpp_inner;null!=C._invalidate&&C._invalidate(C)}}return v.zpp_inner.weak=z,v},e.phys.Body.prototype.worldVectorToLocal=function(i,r){if(null==r&&(r=!1),null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");if(null==i)throw new n._Boot.HaxeError("Error: Cannot transform null Vec2");var o,a,s=this.zpp_inner;if(s.zip_axis&&(s.zip_axis=!1,s.axisx=Math.sin(s.rot),s.axisy=Math.cos(s.rot)),null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var l=i.zpp_inner;null!=l._validate&&l._validate();var p=i.zpp_inner.x*this.zpp_inner.axisy;if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var u=i.zpp_inner;if(null!=u._validate&&u._validate(),o=p+i.zpp_inner.y*this.zpp_inner.axisx,null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var h=i.zpp_inner;null!=h._validate&&h._validate();var c=i.zpp_inner.y*this.zpp_inner.axisy;if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var _=i.zpp_inner;if(null!=_._validate&&_._validate(),a=c-i.zpp_inner.x*this.zpp_inner.axisx,i.zpp_inner.weak){if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var d=i.zpp_inner;if(d._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=d._isimmutable&&d._isimmutable(),i.zpp_inner._inuse)throw new n._Boot.HaxeError("Error: This Vec2 is not disposable");var m=i.zpp_inner;i.zpp_inner.outer=null,i.zpp_inner=null;var P=i;P.zpp_pool=null,null!=t.util.ZPP_PubPool.nextVec2?t.util.ZPP_PubPool.nextVec2.zpp_pool=P:t.util.ZPP_PubPool.poolVec2=P,t.util.ZPP_PubPool.nextVec2=P,P.zpp_disp=!0;var f=m;null!=f.outer&&(f.outer.zpp_inner=null,f.outer=null),f._isimmutable=null,f._validate=null,f._invalidate=null,f.next=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=f}var x,y=o,v=a,g=r;if(null==g&&(g=!1),null==v&&(v=0),null==y&&(y=0),y!=y||v!=v)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null==t.util.ZPP_PubPool.poolVec2?x=new e.geom.Vec2:(x=t.util.ZPP_PubPool.poolVec2,t.util.ZPP_PubPool.poolVec2=x.zpp_pool,x.zpp_pool=null,x.zpp_disp=!1,x==t.util.ZPP_PubPool.nextVec2&&(t.util.ZPP_PubPool.nextVec2=null)),null==x.zpp_inner){var b;null==t.geom.ZPP_Vec2.zpp_pool?b=new t.geom.ZPP_Vec2:(b=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=b.next,b.next=null),b.weak=!1,b._immutable=!1,b.x=y,b.y=v,x.zpp_inner=b,x.zpp_inner.outer=x}else{if(null!=x&&x.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var z,w=x.zpp_inner;if(w._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=w._isimmutable&&w._isimmutable(),y!=y||v!=v)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null!=x&&x.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var Z=x.zpp_inner;if(null!=Z._validate&&Z._validate(),x.zpp_inner.x==y){if(null!=x&&x.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var E=x.zpp_inner;null!=E._validate&&E._validate(),z=x.zpp_inner.y==v}else z=!1;if(!z){x.zpp_inner.x=y,x.zpp_inner.y=v;var M=x.zpp_inner;null!=M._invalidate&&M._invalidate(M)}}return x.zpp_inner.weak=g,x},e.phys.Body.prototype.applyImpulse=function(e,i,r){if(null==r&&(r=!1),null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");if(this.zpp_inner.world)throw new n._Boot.HaxeError("Error: Space::world is immutable");if(null==e)throw new n._Boot.HaxeError("Error: Cannot apply null impulse to Body");var o;if(r){if(null==this.zpp_inner.space)throw new n._Boot.HaxeError("Error: isSleeping makes no sense if the object is not contained within a Space");o=this.zpp_inner.component.sleeping}else o=!1;if(o){if(e.zpp_inner.weak){if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var a=e.zpp_inner;if(a._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=a._isimmutable&&a._isimmutable(),e.zpp_inner._inuse)throw new n._Boot.HaxeError("Error: This Vec2 is not disposable");var s=e.zpp_inner;e.zpp_inner.outer=null,e.zpp_inner=null;var l=e;l.zpp_pool=null,null!=t.util.ZPP_PubPool.nextVec2?t.util.ZPP_PubPool.nextVec2.zpp_pool=l:t.util.ZPP_PubPool.poolVec2=l,t.util.ZPP_PubPool.nextVec2=l,l.zpp_disp=!0;var p=s;null!=p.outer&&(p.outer.zpp_inner=null,p.outer=null),p._isimmutable=null,p._validate=null,p._invalidate=null,p.next=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=p}if(null!=i&&i.zpp_inner.weak){if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var u=i.zpp_inner;if(u._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=u._isimmutable&&u._isimmutable(),i.zpp_inner._inuse)throw new n._Boot.HaxeError("Error: This Vec2 is not disposable");var h=i.zpp_inner;i.zpp_inner.outer=null,i.zpp_inner=null;var c=i;c.zpp_pool=null,null!=t.util.ZPP_PubPool.nextVec2?t.util.ZPP_PubPool.nextVec2.zpp_pool=c:t.util.ZPP_PubPool.poolVec2=c,t.util.ZPP_PubPool.nextVec2=c,c.zpp_disp=!0;var _=h;null!=_.outer&&(_.outer.zpp_inner=null,_.outer=null),_._isimmutable=null,_._validate=null,_._invalidate=null,_.next=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=_}return this}this.zpp_inner.validate_mass();var d=this.zpp_inner.imass,m=this.zpp_inner,P=m.velx;if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var f=e.zpp_inner;null!=f._validate&&f._validate(),m.velx=P+e.zpp_inner.x*d;var x=this.zpp_inner,y=x.vely;if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var v=e.zpp_inner;if(null!=v._validate&&v._validate(),x.vely=y+e.zpp_inner.y*d,null!=i){var g,b;if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var z=i.zpp_inner;if(null!=z._validate&&z._validate(),g=i.zpp_inner.x-this.zpp_inner.posx,null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var w=i.zpp_inner;null!=w._validate&&w._validate(),b=i.zpp_inner.y-this.zpp_inner.posy,this.zpp_inner.validate_inertia();var Z=this.zpp_inner,E=Z.angvel;if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var M=e.zpp_inner;null!=M._validate&&M._validate();var S=e.zpp_inner.y*g;if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var C=e.zpp_inner;if(null!=C._validate&&C._validate(),Z.angvel=E+(S-e.zpp_inner.x*b)*this.zpp_inner.iinertia,i.zpp_inner.weak){if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var N=i.zpp_inner;if(N._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=N._isimmutable&&N._isimmutable(),i.zpp_inner._inuse)throw new n._Boot.HaxeError("Error: This Vec2 is not disposable");var A=i.zpp_inner;i.zpp_inner.outer=null,i.zpp_inner=null;var L=i;L.zpp_pool=null,null!=t.util.ZPP_PubPool.nextVec2?t.util.ZPP_PubPool.nextVec2.zpp_pool=L:t.util.ZPP_PubPool.poolVec2=L,t.util.ZPP_PubPool.nextVec2=L,L.zpp_disp=!0;var B=A;null!=B.outer&&(B.outer.zpp_inner=null,B.outer=null),B._isimmutable=null,B._validate=null,B._invalidate=null,B.next=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=B}}if(r||2==this.zpp_inner.type&&this.zpp_inner.wake(),e.zpp_inner.weak){if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var T=e.zpp_inner;if(T._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=T._isimmutable&&T._isimmutable(),e.zpp_inner._inuse)throw new n._Boot.HaxeError("Error: This Vec2 is not disposable");var V=e.zpp_inner;e.zpp_inner.outer=null,e.zpp_inner=null;var k=e;k.zpp_pool=null,null!=t.util.ZPP_PubPool.nextVec2?t.util.ZPP_PubPool.nextVec2.zpp_pool=k:t.util.ZPP_PubPool.poolVec2=k,t.util.ZPP_PubPool.nextVec2=k,k.zpp_disp=!0;var I=V;null!=I.outer&&(I.outer.zpp_inner=null,I.outer=null),I._isimmutable=null,I._validate=null,I._invalidate=null,I.next=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=I}return this},e.phys.Body.prototype.applyAngularImpulse=function(e,t){if(null==t&&(t=!1),this.zpp_inner.world)throw new n._Boot.HaxeError("Error: Space::world is immutable");var i;if(t){if(null==this.zpp_inner.space)throw new n._Boot.HaxeError("Error: isSleeping makes no sense if the object is not contained within a Space");i=this.zpp_inner.component.sleeping}else i=!1;return i||(this.zpp_inner.validate_inertia(),this.zpp_inner.angvel+=e*this.zpp_inner.iinertia,t||2==this.zpp_inner.type&&this.zpp_inner.wake()),this},e.phys.Body.prototype.translateShapes=function(e){if(this.zpp_inner.immutable_midstep("Body::translateShapes()"),null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");if(this.zpp_inner.world)throw new n._Boot.HaxeError("Error: Space::world is immutable");if(null==e)throw new n._Boot.HaxeError("Error: Cannot displace by null Vec2");var i=e.zpp_inner.weak;e.zpp_inner.weak=!1;for(var r=this.zpp_inner.shapes.head;null!=r;)r.elt.outer.translate(e),r=r.next;if(e.zpp_inner.weak=i,e.zpp_inner.weak){if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var o=e.zpp_inner;if(o._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=o._isimmutable&&o._isimmutable(),e.zpp_inner._inuse)throw new n._Boot.HaxeError("Error: This Vec2 is not disposable");var a=e.zpp_inner;e.zpp_inner.outer=null,e.zpp_inner=null;var s=e;s.zpp_pool=null,null!=t.util.ZPP_PubPool.nextVec2?t.util.ZPP_PubPool.nextVec2.zpp_pool=s:t.util.ZPP_PubPool.poolVec2=s,t.util.ZPP_PubPool.nextVec2=s,s.zpp_disp=!0;var l=a;null!=l.outer&&(l.outer.zpp_inner=null,l.outer=null),l._isimmutable=null,l._validate=null,l._invalidate=null,l.next=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=l}return this},e.phys.Body.prototype.rotateShapes=function(e){if(this.zpp_inner.immutable_midstep("Body::rotateShapes()"),this.zpp_inner.world)throw new n._Boot.HaxeError("Error: Space::world is immutable");for(var t=this.zpp_inner.shapes.head;null!=t;)t.elt.outer.rotate(e),t=t.next;return this},e.phys.Body.prototype.scaleShapes=function(e,t){if(this.zpp_inner.immutable_midstep("Body::scaleShapes()"),this.zpp_inner.world)throw new n._Boot.HaxeError("Error: Space::world is immutable");for(var i=this.zpp_inner.shapes.head;null!=i;)i.elt.outer.scale(e,t),i=i.next;return this},e.phys.Body.prototype.transformShapes=function(e){if(this.zpp_inner.immutable_midstep("Body::transformShapes()"),this.zpp_inner.world)throw new n._Boot.HaxeError("Error: Space::world is immutable");for(var t=this.zpp_inner.shapes.head;null!=t;)t.elt.outer.transform(e),t=t.next;return this},e.phys.Body.prototype.align=function(){if(this.zpp_inner.immutable_midstep("Body::align()"),this.zpp_inner.world)throw new n._Boot.HaxeError("Error: Space::world is immutable");if(null==this.zpp_inner.shapes.head)throw new n._Boot.HaxeError("Error: Cannot align empty Body");this.zpp_inner.validate_localCOM();var i,r=-this.zpp_inner.localCOMx,o=-this.zpp_inner.localCOMy;if(null==o&&(o=0),null==r&&(r=0),r!=r||o!=o)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null==t.util.ZPP_PubPool.poolVec2?i=new e.geom.Vec2:(i=t.util.ZPP_PubPool.poolVec2,t.util.ZPP_PubPool.poolVec2=i.zpp_pool,i.zpp_pool=null,i.zpp_disp=!1,i==t.util.ZPP_PubPool.nextVec2&&(t.util.ZPP_PubPool.nextVec2=null)),null==i.zpp_inner){var a;null==t.geom.ZPP_Vec2.zpp_pool?a=new t.geom.ZPP_Vec2:(a=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=a.next,a.next=null),a.weak=!1,a._immutable=!1,a.x=r,a.y=o,i.zpp_inner=a,i.zpp_inner.outer=i}else{if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var s,l=i.zpp_inner;if(l._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=l._isimmutable&&l._isimmutable(),r!=r||o!=o)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var p=i.zpp_inner;if(null!=p._validate&&p._validate(),i.zpp_inner.x==r){if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var u=i.zpp_inner;null!=u._validate&&u._validate(),s=i.zpp_inner.y==o}else s=!1;if(!s){i.zpp_inner.x=r,i.zpp_inner.y=o;var h=i.zpp_inner;null!=h._invalidate&&h._invalidate(h)}}i.zpp_inner.weak=!1;var c=i;this.translateShapes(c);var _=this.localVectorToWorld(c);if(null==this.zpp_inner.wrap_pos&&this.zpp_inner.setupPosition(),this.zpp_inner.wrap_pos.subeq(_),this.zpp_inner.pre_posx<1/0){var d=this.zpp_inner,m=d.pre_posx;if(null!=_&&_.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var P=_.zpp_inner;null!=P._validate&&P._validate(),d.pre_posx=m-1*_.zpp_inner.x;var f=this.zpp_inner,x=f.pre_posy;if(null!=_&&_.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var y=_.zpp_inner;null!=y._validate&&y._validate(),f.pre_posy=x-1*_.zpp_inner.y}if(null!=c&&c.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var v=c.zpp_inner;if(v._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=v._isimmutable&&v._isimmutable(),c.zpp_inner._inuse)throw new n._Boot.HaxeError("Error: This Vec2 is not disposable");var g=c.zpp_inner;c.zpp_inner.outer=null,c.zpp_inner=null;var b=c;b.zpp_pool=null,null!=t.util.ZPP_PubPool.nextVec2?t.util.ZPP_PubPool.nextVec2.zpp_pool=b:t.util.ZPP_PubPool.poolVec2=b,t.util.ZPP_PubPool.nextVec2=b,b.zpp_disp=!0;var z=g;if(null!=z.outer&&(z.outer.zpp_inner=null,z.outer=null),z._isimmutable=null,z._validate=null,z._invalidate=null,z.next=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=z,null!=_&&_.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var w=_.zpp_inner;if(w._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=w._isimmutable&&w._isimmutable(),_.zpp_inner._inuse)throw new n._Boot.HaxeError("Error: This Vec2 is not disposable");var Z=_.zpp_inner;_.zpp_inner.outer=null,_.zpp_inner=null;var E=_;E.zpp_pool=null,null!=t.util.ZPP_PubPool.nextVec2?t.util.ZPP_PubPool.nextVec2.zpp_pool=E:t.util.ZPP_PubPool.poolVec2=E,t.util.ZPP_PubPool.nextVec2=E,E.zpp_disp=!0;var M=Z;return null!=M.outer&&(M.outer.zpp_inner=null,M.outer=null),M._isimmutable=null,M._validate=null,M._invalidate=null,M.next=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=M,this},e.phys.Body.prototype.rotate=function(e,i){if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");if(null==e)throw new n._Boot.HaxeError("Error: Cannot rotate about a null Vec2");if(i!=i)throw new n._Boot.HaxeError("Error: Cannot rotate by NaN radians");var r=e.zpp_inner.weak;e.zpp_inner.weak=!1,null==this.zpp_inner.wrap_pos&&this.zpp_inner.setupPosition();var o=this.zpp_inner.wrap_pos.sub(e);o.rotate(i);var a=e.add(o,!0);if(null!=a&&a.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");if(null==a)throw new n._Boot.HaxeError("Error: Body::position cannot be null");null==this.zpp_inner.wrap_pos&&this.zpp_inner.setupPosition();var s=this.zpp_inner.wrap_pos;if(null!=s&&s.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");if(null!=a&&a.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var l=s.zpp_inner;if(l._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=l._isimmutable&&l._isimmutable(),null==a)throw new n._Boot.HaxeError("Error: Cannot assign null Vec2");if(null!=a&&a.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var p=a.zpp_inner;null!=p._validate&&p._validate();var u=a.zpp_inner.x;if(null!=a&&a.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var h=a.zpp_inner;null!=h._validate&&h._validate();var c=a.zpp_inner.y;if(null!=s&&s.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var _,d=s.zpp_inner;if(d._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=d._isimmutable&&d._isimmutable(),u!=u||c!=c)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null!=s&&s.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var m=s.zpp_inner;if(null!=m._validate&&m._validate(),s.zpp_inner.x==u){if(null!=s&&s.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var P=s.zpp_inner;null!=P._validate&&P._validate(),_=s.zpp_inner.y==c}else _=!1;if(!_){s.zpp_inner.x=u,s.zpp_inner.y=c;var f=s.zpp_inner;null!=f._invalidate&&f._invalidate(f)}if(a.zpp_inner.weak){if(null!=a&&a.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var x=a.zpp_inner;if(x._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=x._isimmutable&&x._isimmutable(),a.zpp_inner._inuse)throw new n._Boot.HaxeError("Error: This Vec2 is not disposable");var y=a.zpp_inner;a.zpp_inner.outer=null,a.zpp_inner=null;var v=a;v.zpp_pool=null,null!=t.util.ZPP_PubPool.nextVec2?t.util.ZPP_PubPool.nextVec2.zpp_pool=v:t.util.ZPP_PubPool.poolVec2=v,t.util.ZPP_PubPool.nextVec2=v,v.zpp_disp=!0;var g=y;null!=g.outer&&(g.outer.zpp_inner=null,g.outer=null),g._isimmutable=null,g._validate=null,g._invalidate=null,g.next=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=g}if(null==this.zpp_inner.wrap_pos&&this.zpp_inner.setupPosition(),null!=o&&o.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var b=o.zpp_inner;if(b._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=b._isimmutable&&b._isimmutable(),o.zpp_inner._inuse)throw new n._Boot.HaxeError("Error: This Vec2 is not disposable");var z=o.zpp_inner;o.zpp_inner.outer=null,o.zpp_inner=null;var w=o;w.zpp_pool=null,null!=t.util.ZPP_PubPool.nextVec2?t.util.ZPP_PubPool.nextVec2.zpp_pool=w:t.util.ZPP_PubPool.poolVec2=w,t.util.ZPP_PubPool.nextVec2=w,w.zpp_disp=!0;var Z=z;null!=Z.outer&&(Z.outer.zpp_inner=null,Z.outer=null),Z._isimmutable=null,Z._validate=null,Z._invalidate=null,Z.next=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=Z;var E=this,M=E.zpp_inner.rot+i;if(E.zpp_inner.immutable_midstep("Body::rotation"),E.zpp_inner.world)throw new n._Boot.HaxeError("Error: Space::world is immutable");if(1==E.zpp_inner.type&&null!=E.zpp_inner.space)throw new n._Boot.HaxeError("Error: Static objects cannot be rotated once inside a Space");if(E.zpp_inner.rot!=M){if(M!=M)throw new n._Boot.HaxeError("Error: Body::rotation cannot be NaN");E.zpp_inner.rot=M;var S=E.zpp_inner;S.zip_axis=!0;for(var C=S.shapes.head;null!=C;){var N=C.elt;1==N.type&&(N.polygon.invalidate_gverts(),N.polygon.invalidate_gaxi()),N.invalidate_worldCOM(),C=C.next}S.zip_worldCOM=!0,E.zpp_inner.wake()}if(e.zpp_inner.weak=r,e.zpp_inner.weak){if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var A=e.zpp_inner;if(A._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=A._isimmutable&&A._isimmutable(),e.zpp_inner._inuse)throw new n._Boot.HaxeError("Error: This Vec2 is not disposable");var L=e.zpp_inner;e.zpp_inner.outer=null,e.zpp_inner=null;var B=e;B.zpp_pool=null,null!=t.util.ZPP_PubPool.nextVec2?t.util.ZPP_PubPool.nextVec2.zpp_pool=B:t.util.ZPP_PubPool.poolVec2=B,t.util.ZPP_PubPool.nextVec2=B,B.zpp_disp=!0;var T=L;null!=T.outer&&(T.outer.zpp_inner=null,T.outer=null),T._isimmutable=null,T._validate=null,T._invalidate=null,T.next=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=T}return this},e.phys.Body.prototype.setShapeMaterials=function(e){if(this.zpp_inner.immutable_midstep("Body::setShapeMaterials()"),this.zpp_inner.world)throw new n._Boot.HaxeError("Error: Space::world is immutable");for(var t=this.zpp_inner.shapes.head;null!=t;){var i=t.elt.outer;if(i.zpp_inner.immutable_midstep("Shape::material"),null==e)throw new n._Boot.HaxeError("Error: Cannot assign null as Shape material");i.zpp_inner.setMaterial(e.zpp_inner),i.zpp_inner.material.wrapper(),t=t.next}return this},e.phys.Body.prototype.setShapeFilters=function(e){if(this.zpp_inner.immutable_midstep("Body::setShapeFilters()"),this.zpp_inner.world)throw new n._Boot.HaxeError("Error: Space::world is immutable");for(var t=this.zpp_inner.shapes.head;null!=t;){var i=t.elt.outer;if(i.zpp_inner.immutable_midstep("Shape::filter"),null==e)throw new n._Boot.HaxeError("Error: Cannot assign null as Shape filter");i.zpp_inner.setFilter(e.zpp_inner),i.zpp_inner.filter.wrapper(),t=t.next}return this},e.phys.Body.prototype.setShapeFluidProperties=function(t){if(this.zpp_inner.immutable_midstep("Body::setShapeFluidProperties()"),this.zpp_inner.world)throw new n._Boot.HaxeError("Error: Space::world is immutable");for(var i=this.zpp_inner.shapes.head;null!=i;){var r=i.elt.outer;if(null==t)throw new n._Boot.HaxeError("Error: Cannot assign null as Shape fluidProperties, disable fluids by setting fluidEnabled to false");r.zpp_inner.setFluid(t.zpp_inner),r.zpp_inner.immutable_midstep("Shape::fluidProperties"),null==r.zpp_inner.fluidProperties&&r.zpp_inner.setFluid((new e.phys.FluidProperties).zpp_inner),r.zpp_inner.fluidProperties.wrapper(),i=i.next}return this},Object.defineProperty(e.phys.Body.prototype,"localCOM",{get:e.phys.Body.prototype.get_localCOM}),e.phys.Body.prototype.get_localCOM=function(){if(this.zpp_inner.world)throw new n._Boot.HaxeError("Error: Space::world has no localCOM");if(null==this.zpp_inner.wrap_localCOM){var i,r=this.zpp_inner.localCOMx,o=this.zpp_inner.localCOMy;if(null==o&&(o=0),null==r&&(r=0),r!=r||o!=o)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null==t.util.ZPP_PubPool.poolVec2?i=new e.geom.Vec2:(i=t.util.ZPP_PubPool.poolVec2,t.util.ZPP_PubPool.poolVec2=i.zpp_pool,i.zpp_pool=null,i.zpp_disp=!1,i==t.util.ZPP_PubPool.nextVec2&&(t.util.ZPP_PubPool.nextVec2=null)),null==i.zpp_inner){var a;null==t.geom.ZPP_Vec2.zpp_pool?a=new t.geom.ZPP_Vec2:(a=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=a.next,a.next=null),a.weak=!1,a._immutable=!1,a.x=r,a.y=o,i.zpp_inner=a,i.zpp_inner.outer=i}else{if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var l,u=i.zpp_inner;if(u._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=u._isimmutable&&u._isimmutable(),r!=r||o!=o)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var h=i.zpp_inner;if(null!=h._validate&&h._validate(),i.zpp_inner.x==r){if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var c=i.zpp_inner;null!=c._validate&&c._validate(),l=i.zpp_inner.y==o}else l=!1;if(!l){i.zpp_inner.x=r,i.zpp_inner.y=o;var _=i.zpp_inner;null!=_._invalidate&&_._invalidate(_)}}i.zpp_inner.weak=!1,this.zpp_inner.wrap_localCOM=i,this.zpp_inner.wrap_localCOM.zpp_inner._inuse=!0,this.zpp_inner.wrap_localCOM.zpp_inner._immutable=!0,this.zpp_inner.wrap_localCOM.zpp_inner._validate=p(s=this.zpp_inner,s.getlocalCOM)}return this.zpp_inner.wrap_localCOM},Object.defineProperty(e.phys.Body.prototype,"worldCOM",{get:e.phys.Body.prototype.get_worldCOM}),e.phys.Body.prototype.get_worldCOM=function(){if(this.zpp_inner.world)throw new n._Boot.HaxeError("Error: Space::world has no worldCOM");if(null==this.zpp_inner.wrap_worldCOM){var i,r=this.zpp_inner.worldCOMx,o=this.zpp_inner.worldCOMy;if(null==o&&(o=0),null==r&&(r=0),r!=r||o!=o)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null==t.util.ZPP_PubPool.poolVec2?i=new e.geom.Vec2:(i=t.util.ZPP_PubPool.poolVec2,t.util.ZPP_PubPool.poolVec2=i.zpp_pool,i.zpp_pool=null,i.zpp_disp=!1,i==t.util.ZPP_PubPool.nextVec2&&(t.util.ZPP_PubPool.nextVec2=null)),null==i.zpp_inner){var a;null==t.geom.ZPP_Vec2.zpp_pool?a=new t.geom.ZPP_Vec2:(a=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=a.next,a.next=null),a.weak=!1,a._immutable=!1,a.x=r,a.y=o,i.zpp_inner=a,i.zpp_inner.outer=i}else{if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var l,u=i.zpp_inner;if(u._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=u._isimmutable&&u._isimmutable(),r!=r||o!=o)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var h=i.zpp_inner;if(null!=h._validate&&h._validate(),i.zpp_inner.x==r){if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var c=i.zpp_inner;null!=c._validate&&c._validate(),l=i.zpp_inner.y==o}else l=!1;if(!l){i.zpp_inner.x=r,i.zpp_inner.y=o;var _=i.zpp_inner;null!=_._invalidate&&_._invalidate(_)}}i.zpp_inner.weak=!1,this.zpp_inner.wrap_worldCOM=i,this.zpp_inner.wrap_worldCOM.zpp_inner._inuse=!0,this.zpp_inner.wrap_worldCOM.zpp_inner._immutable=!0,this.zpp_inner.wrap_worldCOM.zpp_inner._validate=p(s=this.zpp_inner,s.getworldCOM)}return this.zpp_inner.wrap_worldCOM},e.phys.Body.prototype.normalImpulse=function(i,r){null==r&&(r=!1);var o=0,a=0,s=0;this.zpp_inner.arbiters,null==this.zpp_inner.wrap_arbiters&&(this.zpp_inner.wrap_arbiters=t.util.ZPP_ArbiterList.get(this.zpp_inner.arbiters,!0));for(var l=this.zpp_inner.wrap_arbiters.iterator();;){l.zpp_inner.zpp_inner.valmod();var p,u=l.zpp_inner.zpp_gl();if(l.zpp_critical=!0,l.zpp_i<u?p=!0:(l.zpp_next=e.dynamics.ArbiterIterator.zpp_pool,e.dynamics.ArbiterIterator.zpp_pool=l,l.zpp_inner=null,p=!1),!p)break;l.zpp_critical=!1;var h=l.zpp_inner.at(l.zpp_i++).zpp_inner;if(h.type==t.dynamics.ZPP_Arbiter.COL&&(null==i||h.b2==i.zpp_inner||h.b1==i.zpp_inner)){var c=h.wrapper(),_=(c.zpp_inner.type==t.dynamics.ZPP_Arbiter.COL?c.zpp_inner.colarb.outer_zn:null).normalImpulse(this,r);if(null!=_&&_.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");var d=_.zpp_inner;if(null!=d._validate&&d._validate(),o+=1*_.zpp_inner.x,null!=_&&_.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");var m=_.zpp_inner;if(null!=m._validate&&m._validate(),a+=1*_.zpp_inner.y,null!=_&&_.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");var P=_.zpp_inner;null!=P._validate&&P._validate(),s+=1*_.zpp_inner.z,_.dispose()}}return e.geom.Vec3.get(o,a,s)},e.phys.Body.prototype.tangentImpulse=function(i,r){null==r&&(r=!1);var o=0,a=0,s=0;this.zpp_inner.arbiters,null==this.zpp_inner.wrap_arbiters&&(this.zpp_inner.wrap_arbiters=t.util.ZPP_ArbiterList.get(this.zpp_inner.arbiters,!0));for(var l=this.zpp_inner.wrap_arbiters.iterator();;){l.zpp_inner.zpp_inner.valmod();var p,u=l.zpp_inner.zpp_gl();if(l.zpp_critical=!0,l.zpp_i<u?p=!0:(l.zpp_next=e.dynamics.ArbiterIterator.zpp_pool,e.dynamics.ArbiterIterator.zpp_pool=l,l.zpp_inner=null,p=!1),!p)break;l.zpp_critical=!1;var h=l.zpp_inner.at(l.zpp_i++).zpp_inner;if(h.type==t.dynamics.ZPP_Arbiter.COL&&(null==i||h.b2==i.zpp_inner||h.b1==i.zpp_inner)){var c=h.wrapper(),_=(c.zpp_inner.type==t.dynamics.ZPP_Arbiter.COL?c.zpp_inner.colarb.outer_zn:null).tangentImpulse(this,r);if(null!=_&&_.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");var d=_.zpp_inner;if(null!=d._validate&&d._validate(),o+=1*_.zpp_inner.x,null!=_&&_.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");var m=_.zpp_inner;if(null!=m._validate&&m._validate(),a+=1*_.zpp_inner.y,null!=_&&_.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");var P=_.zpp_inner;null!=P._validate&&P._validate(),s+=1*_.zpp_inner.z,_.dispose()}}return e.geom.Vec3.get(o,a,s)},e.phys.Body.prototype.totalContactsImpulse=function(i,r){null==r&&(r=!1);var o=0,a=0,s=0;this.zpp_inner.arbiters,null==this.zpp_inner.wrap_arbiters&&(this.zpp_inner.wrap_arbiters=t.util.ZPP_ArbiterList.get(this.zpp_inner.arbiters,!0));for(var l=this.zpp_inner.wrap_arbiters.iterator();;){l.zpp_inner.zpp_inner.valmod();var p,u=l.zpp_inner.zpp_gl();if(l.zpp_critical=!0,l.zpp_i<u?p=!0:(l.zpp_next=e.dynamics.ArbiterIterator.zpp_pool,e.dynamics.ArbiterIterator.zpp_pool=l,l.zpp_inner=null,p=!1),!p)break;l.zpp_critical=!1;var h=l.zpp_inner.at(l.zpp_i++).zpp_inner;if(h.type==t.dynamics.ZPP_Arbiter.COL&&(null==i||h.b2==i.zpp_inner||h.b1==i.zpp_inner)){var c=h.wrapper(),_=(c.zpp_inner.type==t.dynamics.ZPP_Arbiter.COL?c.zpp_inner.colarb.outer_zn:null).totalImpulse(this,r);if(null!=_&&_.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");var d=_.zpp_inner;if(null!=d._validate&&d._validate(),o+=1*_.zpp_inner.x,null!=_&&_.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");var m=_.zpp_inner;if(null!=m._validate&&m._validate(),a+=1*_.zpp_inner.y,null!=_&&_.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");var P=_.zpp_inner;null!=P._validate&&P._validate(),s+=1*_.zpp_inner.z,_.dispose()}}return e.geom.Vec3.get(o,a,s)},e.phys.Body.prototype.rollingImpulse=function(n,i){null==i&&(i=!1);var r=0;this.zpp_inner.arbiters,null==this.zpp_inner.wrap_arbiters&&(this.zpp_inner.wrap_arbiters=t.util.ZPP_ArbiterList.get(this.zpp_inner.arbiters,!0));for(var o=this.zpp_inner.wrap_arbiters.iterator();;){o.zpp_inner.zpp_inner.valmod();var a,s=o.zpp_inner.zpp_gl();if(o.zpp_critical=!0,o.zpp_i<s?a=!0:(o.zpp_next=e.dynamics.ArbiterIterator.zpp_pool,e.dynamics.ArbiterIterator.zpp_pool=o,o.zpp_inner=null,a=!1),!a)break;o.zpp_critical=!1;var l=o.zpp_inner.at(o.zpp_i++).zpp_inner;if(l.type==t.dynamics.ZPP_Arbiter.COL&&(null==n||l.b2==n.zpp_inner||l.b1==n.zpp_inner)){var p=l.wrapper();r+=(p.zpp_inner.type==t.dynamics.ZPP_Arbiter.COL?p.zpp_inner.colarb.outer_zn:null).rollingImpulse(this,i)}}return r},e.phys.Body.prototype.buoyancyImpulse=function(i){var r=0,o=0,a=0;this.zpp_inner.arbiters,null==this.zpp_inner.wrap_arbiters&&(this.zpp_inner.wrap_arbiters=t.util.ZPP_ArbiterList.get(this.zpp_inner.arbiters,!0));for(var s=this.zpp_inner.wrap_arbiters.iterator();;){s.zpp_inner.zpp_inner.valmod();var l,p=s.zpp_inner.zpp_gl();if(s.zpp_critical=!0,s.zpp_i<p?l=!0:(s.zpp_next=e.dynamics.ArbiterIterator.zpp_pool,e.dynamics.ArbiterIterator.zpp_pool=s,s.zpp_inner=null,l=!1),!l)break;s.zpp_critical=!1;var u=s.zpp_inner.at(s.zpp_i++).zpp_inner;if(u.type==t.dynamics.ZPP_Arbiter.FLUID&&(null==i||u.b2==i.zpp_inner||u.b1==i.zpp_inner)){var h=u.wrapper(),c=(h.zpp_inner.type==t.dynamics.ZPP_Arbiter.FLUID?h.zpp_inner.fluidarb.outer_zn:null).buoyancyImpulse(this);if(null!=c&&c.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");var _=c.zpp_inner;if(null!=_._validate&&_._validate(),r+=1*c.zpp_inner.x,null!=c&&c.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");var d=c.zpp_inner;if(null!=d._validate&&d._validate(),o+=1*c.zpp_inner.y,null!=c&&c.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");var m=c.zpp_inner;null!=m._validate&&m._validate(),a+=1*c.zpp_inner.z,c.dispose()}}return e.geom.Vec3.get(r,o,a)},e.phys.Body.prototype.dragImpulse=function(i){var r=0,o=0,a=0;this.zpp_inner.arbiters,null==this.zpp_inner.wrap_arbiters&&(this.zpp_inner.wrap_arbiters=t.util.ZPP_ArbiterList.get(this.zpp_inner.arbiters,!0));for(var s=this.zpp_inner.wrap_arbiters.iterator();;){s.zpp_inner.zpp_inner.valmod();var l,p=s.zpp_inner.zpp_gl();if(s.zpp_critical=!0,s.zpp_i<p?l=!0:(s.zpp_next=e.dynamics.ArbiterIterator.zpp_pool,e.dynamics.ArbiterIterator.zpp_pool=s,s.zpp_inner=null,l=!1),!l)break;s.zpp_critical=!1;var u=s.zpp_inner.at(s.zpp_i++).zpp_inner;if(u.type==t.dynamics.ZPP_Arbiter.FLUID&&(null==i||u.b2==i.zpp_inner||u.b1==i.zpp_inner)){var h=u.wrapper(),c=(h.zpp_inner.type==t.dynamics.ZPP_Arbiter.FLUID?h.zpp_inner.fluidarb.outer_zn:null).dragImpulse(this);if(null!=c&&c.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");var _=c.zpp_inner;if(null!=_._validate&&_._validate(),r+=1*c.zpp_inner.x,null!=c&&c.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");var d=c.zpp_inner;if(null!=d._validate&&d._validate(),o+=1*c.zpp_inner.y,null!=c&&c.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");var m=c.zpp_inner;null!=m._validate&&m._validate(),a+=1*c.zpp_inner.z,c.dispose()}}return e.geom.Vec3.get(r,o,a)},e.phys.Body.prototype.totalFluidImpulse=function(i){var r=0,o=0,a=0;this.zpp_inner.arbiters,null==this.zpp_inner.wrap_arbiters&&(this.zpp_inner.wrap_arbiters=t.util.ZPP_ArbiterList.get(this.zpp_inner.arbiters,!0));for(var s=this.zpp_inner.wrap_arbiters.iterator();;){s.zpp_inner.zpp_inner.valmod();var l,p=s.zpp_inner.zpp_gl();if(s.zpp_critical=!0,s.zpp_i<p?l=!0:(s.zpp_next=e.dynamics.ArbiterIterator.zpp_pool,e.dynamics.ArbiterIterator.zpp_pool=s,s.zpp_inner=null,l=!1),!l)break;s.zpp_critical=!1;var u=s.zpp_inner.at(s.zpp_i++).zpp_inner;if(u.type==t.dynamics.ZPP_Arbiter.FLUID&&(null==i||u.b2==i.zpp_inner||u.b1==i.zpp_inner)){var h=u.wrapper(),c=(h.zpp_inner.type==t.dynamics.ZPP_Arbiter.FLUID?h.zpp_inner.fluidarb.outer_zn:null).totalImpulse(this);if(null!=c&&c.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");var _=c.zpp_inner;if(null!=_._validate&&_._validate(),r+=1*c.zpp_inner.x,null!=c&&c.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");var d=c.zpp_inner;if(null!=d._validate&&d._validate(),o+=1*c.zpp_inner.y,null!=c&&c.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");var m=c.zpp_inner;null!=m._validate&&m._validate(),a+=1*c.zpp_inner.z,c.dispose()}}return e.geom.Vec3.get(r,o,a)},e.phys.Body.prototype.constraintsImpulse=function(){for(var t=0,i=0,r=0,o=this.zpp_inner.constraints.head;null!=o;){var a=o.elt.outer.bodyImpulse(this);if(null!=a&&a.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");var s=a.zpp_inner;if(null!=s._validate&&s._validate(),t+=1*a.zpp_inner.x,null!=a&&a.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");var l=a.zpp_inner;if(null!=l._validate&&l._validate(),i+=1*a.zpp_inner.y,null!=a&&a.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");var p=a.zpp_inner;null!=p._validate&&p._validate(),r+=1*a.zpp_inner.z,a.dispose(),o=o.next}return e.geom.Vec3.get(t,i,r)},e.phys.Body.prototype.totalImpulse=function(i,r){null==r&&(r=!1);var o=0,a=0,s=0;this.zpp_inner.arbiters,null==this.zpp_inner.wrap_arbiters&&(this.zpp_inner.wrap_arbiters=t.util.ZPP_ArbiterList.get(this.zpp_inner.arbiters,!0));for(var l=this.zpp_inner.wrap_arbiters.iterator();;){l.zpp_inner.zpp_inner.valmod();var p,u=l.zpp_inner.zpp_gl();if(l.zpp_critical=!0,l.zpp_i<u?p=!0:(l.zpp_next=e.dynamics.ArbiterIterator.zpp_pool,e.dynamics.ArbiterIterator.zpp_pool=l,l.zpp_inner=null,p=!1),!p)break;l.zpp_critical=!1;var h=l.zpp_inner.at(l.zpp_i++).zpp_inner;if(h.type!=t.dynamics.ZPP_Arbiter.SENSOR&&(null==i||h.b2==i.zpp_inner||h.b1==i.zpp_inner)){var c=h.wrapper().totalImpulse(this,r);if(null!=c&&c.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");var _=c.zpp_inner;if(null!=_._validate&&_._validate(),o+=1*c.zpp_inner.x,null!=c&&c.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");var d=c.zpp_inner;if(null!=d._validate&&d._validate(),a+=1*c.zpp_inner.y,null!=c&&c.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");var m=c.zpp_inner;null!=m._validate&&m._validate(),s+=1*c.zpp_inner.z,c.dispose()}}for(var P=this.zpp_inner.constraints.head;null!=P;){var f=P.elt;if(f.active){var x=f.outer.bodyImpulse(this);if(null!=x&&x.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");var y=x.zpp_inner;if(null!=y._validate&&y._validate(),o+=1*x.zpp_inner.x,null!=x&&x.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");var v=x.zpp_inner;if(null!=v._validate&&v._validate(),a+=1*x.zpp_inner.y,null!=x&&x.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");var g=x.zpp_inner;null!=g._validate&&g._validate(),s+=1*x.zpp_inner.z,x.dispose()}P=P.next}return e.geom.Vec3.get(o,a,s)},e.phys.Body.prototype.contains=function(e){if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");if(null==e)throw new n._Boot.HaxeError("Error: Cannot check containment of null point");var i,r=e.zpp_inner.weak;e.zpp_inner.weak=!1,i=!1;for(var o=this.zpp_inner.shapes.head;null!=o;){if(o.elt.outer.contains(e)){i=!0;break}o=o.next}if(e.zpp_inner.weak=r,e.zpp_inner.weak){if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var a=e.zpp_inner;if(a._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=a._isimmutable&&a._isimmutable(),e.zpp_inner._inuse)throw new n._Boot.HaxeError("Error: This Vec2 is not disposable");var s=e.zpp_inner;e.zpp_inner.outer=null,e.zpp_inner=null;var l=e;l.zpp_pool=null,null!=t.util.ZPP_PubPool.nextVec2?t.util.ZPP_PubPool.nextVec2.zpp_pool=l:t.util.ZPP_PubPool.poolVec2=l,t.util.ZPP_PubPool.nextVec2=l,l.zpp_disp=!0;var p=s;null!=p.outer&&(p.outer.zpp_inner=null,p.outer=null),p._isimmutable=null,p._validate=null,p._invalidate=null,p.next=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=p}return i},e.phys.Body.prototype.toString=function(){return(this.zpp_inner.world?"(space::world":"("+(2==this.zpp_inner.type?"dynamic":1==this.zpp_inner.type?"static":"kinematic"))+")#"+this.zpp_inner_i.id},e.phys.Body.prototype.__class__=e.phys.Body,e.phys.BodyIterator=l["nape.phys.BodyIterator"]=function(){if(this.zpp_next=null,this.zpp_critical=!1,this.zpp_i=0,this.zpp_inner=null,!t.util.ZPP_BodyList.internal)throw new n._Boot.HaxeError("Error: Cannot instantiate BodyIterator derp!")},e.phys.BodyIterator.__name__=["nape","phys","BodyIterator"],e.phys.BodyIterator.get=function(n){var i;if(null==e.phys.BodyIterator.zpp_pool){t.util.ZPP_BodyList.internal=!0;var r=new e.phys.BodyIterator;t.util.ZPP_BodyList.internal=!1,i=r}else{var o=e.phys.BodyIterator.zpp_pool;e.phys.BodyIterator.zpp_pool=o.zpp_next,i=o}return i.zpp_i=0,i.zpp_inner=n,i.zpp_critical=!1,i},e.phys.BodyIterator.prototype.zpp_inner=null,e.phys.BodyIterator.prototype.zpp_i=null,e.phys.BodyIterator.prototype.zpp_critical=null,e.phys.BodyIterator.prototype.zpp_next=null,e.phys.BodyIterator.prototype.hasNext=function(){this.zpp_inner.zpp_inner.valmod();var t=this.zpp_inner;t.zpp_inner.valmod(),t.zpp_inner.zip_length&&(t.zpp_inner.zip_length=!1,t.zpp_inner.user_length=t.zpp_inner.inner.length);var n=t.zpp_inner.user_length;return this.zpp_critical=!0,this.zpp_i<n||(this.zpp_next=e.phys.BodyIterator.zpp_pool,e.phys.BodyIterator.zpp_pool=this,this.zpp_inner=null,!1)},e.phys.BodyIterator.prototype.next=function(){return this.zpp_critical=!1,this.zpp_inner.at(this.zpp_i++)},e.phys.BodyIterator.prototype.__class__=e.phys.BodyIterator,e.phys.BodyList=l["nape.phys.BodyList"]=function(){this.zpp_inner=null,this.zpp_inner=new t.util.ZPP_BodyList,this.zpp_inner.outer=this},e.phys.BodyList.__name__=["nape","phys","BodyList"],e.phys.BodyList.fromArray=function(t){if(null==t)throw new n._Boot.HaxeError("Error: Cannot convert null Array to Nape list");for(var i=new e.phys.BodyList,r=0;r<t.length;){var o=t[r];++r,i.push(o)}return i},e.phys.BodyList.prototype.zpp_inner=null,Object.defineProperty(e.phys.BodyList.prototype,"length",{get:e.phys.BodyList.prototype.get_length}),e.phys.BodyList.prototype.get_length=function(){return this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.user_length},e.phys.BodyList.prototype.has=function(e){return this.zpp_inner.valmod(),this.zpp_inner.inner.has(e.zpp_inner)},e.phys.BodyList.prototype.at=function(e){var t;if(this.zpp_inner.valmod(),e>=0?(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t=e>=this.zpp_inner.user_length):t=!0,t)throw new n._Boot.HaxeError("Error: Index out of bounds");if(this.zpp_inner.reverse_flag&&(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),e=this.zpp_inner.user_length-1-e),e<this.zpp_inner.at_index||null==this.zpp_inner.at_ite)this.zpp_inner.at_index=e,this.zpp_inner.at_ite=this.zpp_inner.inner.iterator_at(e);else for(;this.zpp_inner.at_index!=e;)this.zpp_inner.at_index++,this.zpp_inner.at_ite=this.zpp_inner.at_ite.next;return this.zpp_inner.at_ite.elt.outer},e.phys.BodyList.prototype.push=function(e){if(this.zpp_inner.immutable)throw new n._Boot.HaxeError("Error: BodyList is immutable");this.zpp_inner.modify_test(),this.zpp_inner.valmod();var t=null==this.zpp_inner.adder||this.zpp_inner.adder(e);if(t){if(this.zpp_inner.reverse_flag)this.zpp_inner.inner.add(e.zpp_inner);else{if(null==this.zpp_inner.push_ite){var i;if(null==this.zpp_inner.inner.head)i=null;else{var r=this.zpp_inner.inner;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),i=r.iterator_at(this.zpp_inner.user_length-1)}this.zpp_inner.push_ite=i}this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,e.zpp_inner)}this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(e)}return t},e.phys.BodyList.prototype.unshift=function(e){if(this.zpp_inner.immutable)throw new n._Boot.HaxeError("Error: BodyList is immutable");this.zpp_inner.modify_test(),this.zpp_inner.valmod();var t=null==this.zpp_inner.adder||this.zpp_inner.adder(e);if(t){if(this.zpp_inner.reverse_flag){if(null==this.zpp_inner.push_ite){var i;if(null==this.zpp_inner.inner.head)i=null;else{var r=this.zpp_inner.inner;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),i=r.iterator_at(this.zpp_inner.user_length-1)}this.zpp_inner.push_ite=i}this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,e.zpp_inner)}else this.zpp_inner.inner.add(e.zpp_inner);this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(e)}return t},e.phys.BodyList.prototype.pop=function(){if(this.zpp_inner.immutable)throw new n._Boot.HaxeError("Error: BodyList is immutable");if(this.zpp_inner.modify_test(),null==this.zpp_inner.inner.head)throw new n._Boot.HaxeError("Error: Cannot remove from empty list");this.zpp_inner.valmod();var e=null;if(this.zpp_inner.reverse_flag){var t=(e=this.zpp_inner.inner.head.elt).outer;null!=this.zpp_inner.subber&&this.zpp_inner.subber(t),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()}else{var i;if(null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null),this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),1==this.zpp_inner.user_length)i=null;else{var r=this.zpp_inner.inner;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),i=r.iterator_at(this.zpp_inner.user_length-2)}var o=(e=null==i?this.zpp_inner.inner.head.elt:i.next.elt).outer;null!=this.zpp_inner.subber&&this.zpp_inner.subber(o),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(i)}return this.zpp_inner.invalidate(),e.outer},e.phys.BodyList.prototype.shift=function(){if(this.zpp_inner.immutable)throw new n._Boot.HaxeError("Error: BodyList is immutable");if(this.zpp_inner.modify_test(),null==this.zpp_inner.inner.head)throw new n._Boot.HaxeError("Error: Cannot remove from empty list");this.zpp_inner.valmod();var e=null;if(this.zpp_inner.reverse_flag){var t;if(null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null),this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),1==this.zpp_inner.user_length)t=null;else{var i=this.zpp_inner.inner;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t=i.iterator_at(this.zpp_inner.user_length-2)}var r=(e=null==t?this.zpp_inner.inner.head.elt:t.next.elt).outer;null!=this.zpp_inner.subber&&this.zpp_inner.subber(r),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(t)}else{var o=(e=this.zpp_inner.inner.head.elt).outer;null!=this.zpp_inner.subber&&this.zpp_inner.subber(o),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()}return this.zpp_inner.invalidate(),e.outer},e.phys.BodyList.prototype.add=function(e){return this.zpp_inner.reverse_flag?this.push(e):this.unshift(e)},e.phys.BodyList.prototype.remove=function(e){if(this.zpp_inner.immutable)throw new n._Boot.HaxeError("Error: BodyList is immutable");var t;this.zpp_inner.modify_test(),this.zpp_inner.valmod(),t=!1;for(var i=this.zpp_inner.inner.head;null!=i;){if(i.elt==e.zpp_inner){t=!0;break}i=i.next}return t&&(null!=this.zpp_inner.subber&&this.zpp_inner.subber(e),this.zpp_inner.dontremove||this.zpp_inner.inner.remove(e.zpp_inner),this.zpp_inner.invalidate()),t},e.phys.BodyList.prototype.clear=function(){if(this.zpp_inner.immutable)throw new n._Boot.HaxeError("Error: BodyList is immutable");if(this.zpp_inner.reverse_flag)for(;null!=this.zpp_inner.inner.head;)this.pop();else for(;null!=this.zpp_inner.inner.head;)this.shift()},e.phys.BodyList.prototype.empty=function(){return null==this.zpp_inner.inner.head},e.phys.BodyList.prototype.iterator=function(){return this.zpp_inner.valmod(),e.phys.BodyIterator.get(this)},e.phys.BodyList.prototype.copy=function(t){null==t&&(t=!1);var i=new e.phys.BodyList;this.zpp_inner.valmod();for(var r=e.phys.BodyIterator.get(this);;){r.zpp_inner.zpp_inner.valmod();var o=r.zpp_inner;o.zpp_inner.valmod(),o.zpp_inner.zip_length&&(o.zpp_inner.zip_length=!1,o.zpp_inner.user_length=o.zpp_inner.inner.length);var a,s=o.zpp_inner.user_length;if(r.zpp_critical=!0,r.zpp_i<s?a=!0:(r.zpp_next=e.phys.BodyIterator.zpp_pool,e.phys.BodyIterator.zpp_pool=r,r.zpp_inner=null,a=!1),!a)break;r.zpp_critical=!1;var l,p=r.zpp_inner.at(r.zpp_i++);if(t)throw new n._Boot.HaxeError("Error: Body is not a copyable type");l=p,i.push(l)}return i},e.phys.BodyList.prototype.merge=function(t){if(null==t)throw new n._Boot.HaxeError("Error: Cannot merge with null list");t.zpp_inner.valmod();for(var i=e.phys.BodyIterator.get(t);;){i.zpp_inner.zpp_inner.valmod();var r=i.zpp_inner;r.zpp_inner.valmod(),r.zpp_inner.zip_length&&(r.zpp_inner.zip_length=!1,r.zpp_inner.user_length=r.zpp_inner.inner.length);var o,a=r.zpp_inner.user_length;if(i.zpp_critical=!0,i.zpp_i<a?o=!0:(i.zpp_next=e.phys.BodyIterator.zpp_pool,e.phys.BodyIterator.zpp_pool=i,i.zpp_inner=null,o=!1),!o)break;i.zpp_critical=!1;var s=i.zpp_inner.at(i.zpp_i++);this.has(s)||(this.zpp_inner.reverse_flag?this.push(s):this.unshift(s))}},e.phys.BodyList.prototype.toString=function(){var t="[",n=!0;this.zpp_inner.valmod();for(var i=e.phys.BodyIterator.get(this);;){i.zpp_inner.zpp_inner.valmod();var r=i.zpp_inner;r.zpp_inner.valmod(),r.zpp_inner.zip_length&&(r.zpp_inner.zip_length=!1,r.zpp_inner.user_length=r.zpp_inner.inner.length);var o,a=r.zpp_inner.user_length;if(i.zpp_critical=!0,i.zpp_i<a?o=!0:(i.zpp_next=e.phys.BodyIterator.zpp_pool,e.phys.BodyIterator.zpp_pool=i,i.zpp_inner=null,o=!1),!o)break;i.zpp_critical=!1;var s=i.zpp_inner.at(i.zpp_i++);n||(t+=","),t+=null==s?"NULL":s.toString(),n=!1}return t+"]"},e.phys.BodyList.prototype.foreach=function(t){if(null==t)throw new n._Boot.HaxeError("Error: Cannot execute null on list elements");this.zpp_inner.valmod();for(var i=e.phys.BodyIterator.get(this);;){i.zpp_inner.zpp_inner.valmod();var r=i.zpp_inner;r.zpp_inner.valmod(),r.zpp_inner.zip_length&&(r.zpp_inner.zip_length=!1,r.zpp_inner.user_length=r.zpp_inner.inner.length);var o,a=r.zpp_inner.user_length;if(i.zpp_critical=!0,i.zpp_i<a?o=!0:(i.zpp_next=e.phys.BodyIterator.zpp_pool,e.phys.BodyIterator.zpp_pool=i,i.zpp_inner=null,o=!1),!o)break;try{i.zpp_critical=!1,t(i.zpp_inner.at(i.zpp_i++))}catch(t){t instanceof n._Boot.HaxeError&&t.val,i.zpp_next=e.phys.BodyIterator.zpp_pool,e.phys.BodyIterator.zpp_pool=i,i.zpp_inner=null;break}}return this},e.phys.BodyList.prototype.filter=function(e){if(null==e)throw new n._Boot.HaxeError("Error: Cannot select elements of list with null");for(var t=0;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t<this.zpp_inner.user_length;){var i=this.at(t);try{e(i)?++t:this.remove(i)}catch(e){e instanceof n._Boot.HaxeError&&e.val;break}}return this},e.phys.BodyList.prototype.__class__=e.phys.BodyList,e.phys.BodyType=l["nape.phys.BodyType"]=function(){if(!t.util.ZPP_Flags.internal)throw new n._Boot.HaxeError("Error: Cannot instantiate BodyType derp!")},e.phys.BodyType.__name__=["nape","phys","BodyType"],e.phys.BodyType.STATIC=null,e.phys.BodyType.get_STATIC=function(){return null==t.util.ZPP_Flags.BodyType_STATIC&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.BodyType_STATIC=new e.phys.BodyType,t.util.ZPP_Flags.internal=!1),t.util.ZPP_Flags.BodyType_STATIC},e.phys.BodyType.DYNAMIC=null,e.phys.BodyType.get_DYNAMIC=function(){return null==t.util.ZPP_Flags.BodyType_DYNAMIC&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.BodyType_DYNAMIC=new e.phys.BodyType,t.util.ZPP_Flags.internal=!1),t.util.ZPP_Flags.BodyType_DYNAMIC},e.phys.BodyType.KINEMATIC=null,e.phys.BodyType.get_KINEMATIC=function(){return null==t.util.ZPP_Flags.BodyType_KINEMATIC&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.BodyType_KINEMATIC=new e.phys.BodyType,t.util.ZPP_Flags.internal=!1),t.util.ZPP_Flags.BodyType_KINEMATIC},e.phys.BodyType.prototype.toString=function(){return null==t.util.ZPP_Flags.BodyType_STATIC&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.BodyType_STATIC=new e.phys.BodyType,t.util.ZPP_Flags.internal=!1),this==t.util.ZPP_Flags.BodyType_STATIC?"STATIC":(null==t.util.ZPP_Flags.BodyType_DYNAMIC&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.BodyType_DYNAMIC=new e.phys.BodyType,t.util.ZPP_Flags.internal=!1),this==t.util.ZPP_Flags.BodyType_DYNAMIC?"DYNAMIC":(null==t.util.ZPP_Flags.BodyType_KINEMATIC&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.BodyType_KINEMATIC=new e.phys.BodyType,t.util.ZPP_Flags.internal=!1),this==t.util.ZPP_Flags.BodyType_KINEMATIC?"KINEMATIC":""))},e.phys.BodyType.prototype.__class__=e.phys.BodyType,e.phys.Compound=l["nape.phys.Compound"]=function(){this.zpp_inner=null,e.phys.Interactor.zpp_internalAlloc=!0,e.phys.Interactor.call(this),e.phys.Interactor.zpp_internalAlloc=!1,this.zpp_inner=new t.phys.ZPP_Compound,this.zpp_inner.outer=this,this.zpp_inner.outer_i=this,this.zpp_inner_i=this.zpp_inner,this.zpp_inner.insert_cbtype(t.callbacks.ZPP_CbType.ANY_COMPOUND.zpp_inner)},e.phys.Compound.__name__=["nape","phys","Compound"],e.phys.Compound.__super__=e.phys.Interactor,e.phys.Interactor.prototype)e.phys.Compound.prototype[u]=e.phys.Interactor.prototype[u];for(var u in e.phys.Compound.prototype.zpp_inner=null,Object.defineProperty(e.phys.Compound.prototype,"bodies",{get:e.phys.Compound.prototype.get_bodies}),e.phys.Compound.prototype.get_bodies=function(){return this.zpp_inner.wrap_bodies},Object.defineProperty(e.phys.Compound.prototype,"constraints",{get:e.phys.Compound.prototype.get_constraints}),e.phys.Compound.prototype.get_constraints=function(){return this.zpp_inner.wrap_constraints},Object.defineProperty(e.phys.Compound.prototype,"compounds",{get:e.phys.Compound.prototype.get_compounds}),e.phys.Compound.prototype.get_compounds=function(){return this.zpp_inner.wrap_compounds},Object.defineProperty(e.phys.Compound.prototype,"compound",{get:e.phys.Compound.prototype.get_compound,set:e.phys.Compound.prototype.set_compound}),e.phys.Compound.prototype.get_compound=function(){return null==this.zpp_inner.compound?null:this.zpp_inner.compound.outer},e.phys.Compound.prototype.set_compound=function(e){if(this.zpp_inner.immutable_midstep("Compound::compound"),(null==this.zpp_inner.compound?null:this.zpp_inner.compound.outer)!=e&&(null!=(null==this.zpp_inner.compound?null:this.zpp_inner.compound.outer)&&(null==this.zpp_inner.compound?null:this.zpp_inner.compound.outer).zpp_inner.wrap_compounds.remove(this),null!=e)){var t=e.zpp_inner.wrap_compounds;t.zpp_inner.reverse_flag?t.push(this):t.unshift(this)}return null==this.zpp_inner.compound?null:this.zpp_inner.compound.outer},Object.defineProperty(e.phys.Compound.prototype,"space",{get:e.phys.Compound.prototype.get_space,set:e.phys.Compound.prototype.set_space}),e.phys.Compound.prototype.get_space=function(){return null==this.zpp_inner.space?null:this.zpp_inner.space.outer},e.phys.Compound.prototype.set_space=function(e){if(null!=this.zpp_inner.compound)throw new n._Boot.HaxeError("Error: Cannot set the space of an inner Compound, only the root Compound space can be set");if(this.zpp_inner.immutable_midstep("Compound::space"),(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)!=e&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(null==this.zpp_inner.space?null:this.zpp_inner.space.outer).zpp_inner.wrap_compounds.remove(this),null!=e)){var t=e.zpp_inner.wrap_compounds;t.zpp_inner.reverse_flag?t.push(this):t.unshift(this)}return null==this.zpp_inner.space?null:this.zpp_inner.space.outer},e.phys.Compound.prototype.toString=function(){return"Compound"+this.zpp_inner_i.id},e.phys.Compound.prototype.copy=function(){return this.zpp_inner.copy()},e.phys.Compound.prototype.breakApart=function(){this.zpp_inner.breakApart()},e.phys.Compound.prototype.visitBodies=function(t){if(null==t)throw new n._Boot.HaxeError("Error: lambda cannot be null for Compound::visitBodies");var i=this.zpp_inner.wrap_bodies;i.zpp_inner.valmod();for(var r=e.phys.BodyIterator.get(i);;){r.zpp_inner.zpp_inner.valmod();var o=r.zpp_inner;o.zpp_inner.valmod(),o.zpp_inner.zip_length&&(o.zpp_inner.zip_length=!1,o.zpp_inner.user_length=o.zpp_inner.inner.length);var a,s=o.zpp_inner.user_length;if(r.zpp_critical=!0,r.zpp_i<s?a=!0:(r.zpp_next=e.phys.BodyIterator.zpp_pool,e.phys.BodyIterator.zpp_pool=r,r.zpp_inner=null,a=!1),!a)break;r.zpp_critical=!1,t(r.zpp_inner.at(r.zpp_i++))}var l=this.zpp_inner.wrap_compounds;l.zpp_inner.valmod();for(var p=e.phys.CompoundIterator.get(l);;){p.zpp_inner.zpp_inner.valmod();var u=p.zpp_inner;u.zpp_inner.valmod(),u.zpp_inner.zip_length&&(u.zpp_inner.zip_length=!1,u.zpp_inner.user_length=u.zpp_inner.inner.length);var h,c=u.zpp_inner.user_length;if(p.zpp_critical=!0,p.zpp_i<c?h=!0:(p.zpp_next=e.phys.CompoundIterator.zpp_pool,e.phys.CompoundIterator.zpp_pool=p,p.zpp_inner=null,h=!1),!h)break;p.zpp_critical=!1,p.zpp_inner.at(p.zpp_i++).visitBodies(t)}},e.phys.Compound.prototype.visitConstraints=function(t){if(null==t)throw new n._Boot.HaxeError("Error: lambda cannot be null for Compound::visitConstraints");var i=this.zpp_inner.wrap_constraints;i.zpp_inner.valmod();for(var r=e.constraint.ConstraintIterator.get(i);;){r.zpp_inner.zpp_inner.valmod();var o=r.zpp_inner;o.zpp_inner.valmod(),o.zpp_inner.zip_length&&(o.zpp_inner.zip_length=!1,o.zpp_inner.user_length=o.zpp_inner.inner.length);var a,s=o.zpp_inner.user_length;if(r.zpp_critical=!0,r.zpp_i<s?a=!0:(r.zpp_next=e.constraint.ConstraintIterator.zpp_pool,e.constraint.ConstraintIterator.zpp_pool=r,r.zpp_inner=null,a=!1),!a)break;r.zpp_critical=!1,t(r.zpp_inner.at(r.zpp_i++))}var l=this.zpp_inner.wrap_compounds;l.zpp_inner.valmod();for(var p=e.phys.CompoundIterator.get(l);;){p.zpp_inner.zpp_inner.valmod();var u=p.zpp_inner;u.zpp_inner.valmod(),u.zpp_inner.zip_length&&(u.zpp_inner.zip_length=!1,u.zpp_inner.user_length=u.zpp_inner.inner.length);var h,c=u.zpp_inner.user_length;if(p.zpp_critical=!0,p.zpp_i<c?h=!0:(p.zpp_next=e.phys.CompoundIterator.zpp_pool,e.phys.CompoundIterator.zpp_pool=p,p.zpp_inner=null,h=!1),!h)break;p.zpp_critical=!1,p.zpp_inner.at(p.zpp_i++).visitConstraints(t)}},e.phys.Compound.prototype.visitCompounds=function(t){if(null==t)throw new n._Boot.HaxeError("Error: lambda cannot be null for Compound::visitConstraints");var i=this.zpp_inner.wrap_compounds;i.zpp_inner.valmod();for(var r=e.phys.CompoundIterator.get(i);;){r.zpp_inner.zpp_inner.valmod();var o=r.zpp_inner;o.zpp_inner.valmod(),o.zpp_inner.zip_length&&(o.zpp_inner.zip_length=!1,o.zpp_inner.user_length=o.zpp_inner.inner.length);var a,s=o.zpp_inner.user_length;if(r.zpp_critical=!0,r.zpp_i<s?a=!0:(r.zpp_next=e.phys.CompoundIterator.zpp_pool,e.phys.CompoundIterator.zpp_pool=r,r.zpp_inner=null,a=!1),!a)break;r.zpp_critical=!1;var l=r.zpp_inner.at(r.zpp_i++);t(l),l.visitCompounds(t)}},e.phys.Compound.prototype.COM=function(i){null==i&&(i=!1);var r,o=i;if(null==o&&(o=!1),null==t.util.ZPP_PubPool.poolVec2?r=new e.geom.Vec2:(r=t.util.ZPP_PubPool.poolVec2,t.util.ZPP_PubPool.poolVec2=r.zpp_pool,r.zpp_pool=null,r.zpp_disp=!1,r==t.util.ZPP_PubPool.nextVec2&&(t.util.ZPP_PubPool.nextVec2=null)),null==r.zpp_inner){var a;null==t.geom.ZPP_Vec2.zpp_pool?a=new t.geom.ZPP_Vec2:(a=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=a.next,a.next=null),a.weak=!1,a._immutable=!1,a.x=0,a.y=0,r.zpp_inner=a,r.zpp_inner.outer=r}else{if(null!=r&&r.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var l,u=r.zpp_inner;if(u._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=u._isimmutable&&u._isimmutable(),null!=r&&r.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var h=r.zpp_inner;if(null!=h._validate&&h._validate(),0==r.zpp_inner.x){if(null!=r&&r.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var c=r.zpp_inner;null!=c._validate&&c._validate(),l=0==r.zpp_inner.y}else l=!1;if(!l){r.zpp_inner.x=0,r.zpp_inner.y=0;var _=r.zpp_inner;null!=_._invalidate&&_._invalidate(_)}}r.zpp_inner.weak=o;var d=r,m=0;if(this.visitBodies((function(i){if(null!=i.zpp_inner.wrap_shapes.zpp_inner.inner.head){if(i.zpp_inner.world)throw new n._Boot.HaxeError("Error: Space::world has no worldCOM");if(null==i.zpp_inner.wrap_worldCOM){var r,o=i.zpp_inner.worldCOMx,a=i.zpp_inner.worldCOMy;if(null==a&&(a=0),null==o&&(o=0),o!=o||a!=a)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null==t.util.ZPP_PubPool.poolVec2?r=new e.geom.Vec2:(r=t.util.ZPP_PubPool.poolVec2,t.util.ZPP_PubPool.poolVec2=r.zpp_pool,r.zpp_pool=null,r.zpp_disp=!1,r==t.util.ZPP_PubPool.nextVec2&&(t.util.ZPP_PubPool.nextVec2=null)),null==r.zpp_inner){var l;null==t.geom.ZPP_Vec2.zpp_pool?l=new t.geom.ZPP_Vec2:(l=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=l.next,l.next=null),l.weak=!1,l._immutable=!1,l.x=o,l.y=a,r.zpp_inner=l,r.zpp_inner.outer=r}else{if(null!=r&&r.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var u,h=r.zpp_inner;if(h._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=h._isimmutable&&h._isimmutable(),o!=o||a!=a)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null!=r&&r.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var c=r.zpp_inner;if(null!=c._validate&&c._validate(),r.zpp_inner.x==o){if(null!=r&&r.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var _=r.zpp_inner;null!=_._validate&&_._validate(),u=r.zpp_inner.y==a}else u=!1;if(!u){r.zpp_inner.x=o,r.zpp_inner.y=a;var P=r.zpp_inner;null!=P._invalidate&&P._invalidate(P)}}r.zpp_inner.weak=!1,i.zpp_inner.wrap_worldCOM=r,i.zpp_inner.wrap_worldCOM.zpp_inner._inuse=!0,i.zpp_inner.wrap_worldCOM.zpp_inner._immutable=!0,i.zpp_inner.wrap_worldCOM.zpp_inner._validate=p(s=i.zpp_inner,s.getworldCOM)}var f=i.zpp_inner.wrap_worldCOM;if(i.zpp_inner.world)throw new n._Boot.HaxeError("Error: Space::world has no mass");if(i.zpp_inner.validate_mass(),0==i.zpp_inner.massMode&&null==i.zpp_inner.shapes.head)throw new n._Boot.HaxeError("Error: Given current mass mode, Body::mass only makes sense if it contains shapes");var x=f.mul(i.zpp_inner.cmass,!0);if(d.addeq(x),i.zpp_inner.world)throw new n._Boot.HaxeError("Error: Space::world has no mass");if(i.zpp_inner.validate_mass(),0==i.zpp_inner.massMode&&null==i.zpp_inner.shapes.head)throw new n._Boot.HaxeError("Error: Given current mass mode, Body::mass only makes sense if it contains shapes");m+=i.zpp_inner.cmass}})),0==m)throw new n._Boot.HaxeError("Error: COM of an empty Compound is undefined silly");return d.muleq(1/m),d},e.phys.Compound.prototype.translate=function(e){if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");if(null==e)throw new n._Boot.HaxeError("Error: Cannot translate by null Vec2");var i=e.zpp_inner.weak;if(e.zpp_inner.weak=!1,this.visitBodies((function(t){null==t.zpp_inner.wrap_pos&&t.zpp_inner.setupPosition(),t.zpp_inner.wrap_pos.addeq(e)})),e.zpp_inner.weak=i,e.zpp_inner.weak){if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var r=e.zpp_inner;if(r._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=r._isimmutable&&r._isimmutable(),e.zpp_inner._inuse)throw new n._Boot.HaxeError("Error: This Vec2 is not disposable");var o=e.zpp_inner;e.zpp_inner.outer=null,e.zpp_inner=null;var a=e;a.zpp_pool=null,null!=t.util.ZPP_PubPool.nextVec2?t.util.ZPP_PubPool.nextVec2.zpp_pool=a:t.util.ZPP_PubPool.poolVec2=a,t.util.ZPP_PubPool.nextVec2=a,a.zpp_disp=!0;var s=o;null!=s.outer&&(s.outer.zpp_inner=null,s.outer=null),s._isimmutable=null,s._validate=null,s._invalidate=null,s.next=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=s}return this},e.phys.Compound.prototype.rotate=function(e,i){if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");if(null==e)throw new n._Boot.HaxeError("Error: Cannot rotate about a null Vec2");if(i!=i)throw new n._Boot.HaxeError("Error: Cannot rotate by NaN radians");var r=e.zpp_inner.weak;if(e.zpp_inner.weak=!1,this.visitBodies((function(t){t.rotate(e,i)})),e.zpp_inner.weak=r,e.zpp_inner.weak){if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var o=e.zpp_inner;if(o._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=o._isimmutable&&o._isimmutable(),e.zpp_inner._inuse)throw new n._Boot.HaxeError("Error: This Vec2 is not disposable");var a=e.zpp_inner;e.zpp_inner.outer=null,e.zpp_inner=null;var s=e;s.zpp_pool=null,null!=t.util.ZPP_PubPool.nextVec2?t.util.ZPP_PubPool.nextVec2.zpp_pool=s:t.util.ZPP_PubPool.poolVec2=s,t.util.ZPP_PubPool.nextVec2=s,s.zpp_disp=!0;var l=a;null!=l.outer&&(l.outer.zpp_inner=null,l.outer=null),l._isimmutable=null,l._validate=null,l._invalidate=null,l.next=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=l}return this},e.phys.Compound.prototype.__class__=e.phys.Compound,e.phys.CompoundIterator=l["nape.phys.CompoundIterator"]=function(){if(this.zpp_next=null,this.zpp_critical=!1,this.zpp_i=0,this.zpp_inner=null,!t.util.ZPP_CompoundList.internal)throw new n._Boot.HaxeError("Error: Cannot instantiate CompoundIterator derp!")},e.phys.CompoundIterator.__name__=["nape","phys","CompoundIterator"],e.phys.CompoundIterator.get=function(n){var i;if(null==e.phys.CompoundIterator.zpp_pool){t.util.ZPP_CompoundList.internal=!0;var r=new e.phys.CompoundIterator;t.util.ZPP_CompoundList.internal=!1,i=r}else{var o=e.phys.CompoundIterator.zpp_pool;e.phys.CompoundIterator.zpp_pool=o.zpp_next,i=o}return i.zpp_i=0,i.zpp_inner=n,i.zpp_critical=!1,i},e.phys.CompoundIterator.prototype.zpp_inner=null,e.phys.CompoundIterator.prototype.zpp_i=null,e.phys.CompoundIterator.prototype.zpp_critical=null,e.phys.CompoundIterator.prototype.zpp_next=null,e.phys.CompoundIterator.prototype.hasNext=function(){this.zpp_inner.zpp_inner.valmod();var t=this.zpp_inner;t.zpp_inner.valmod(),t.zpp_inner.zip_length&&(t.zpp_inner.zip_length=!1,t.zpp_inner.user_length=t.zpp_inner.inner.length);var n=t.zpp_inner.user_length;return this.zpp_critical=!0,this.zpp_i<n||(this.zpp_next=e.phys.CompoundIterator.zpp_pool,e.phys.CompoundIterator.zpp_pool=this,this.zpp_inner=null,!1)},e.phys.CompoundIterator.prototype.next=function(){return this.zpp_critical=!1,this.zpp_inner.at(this.zpp_i++)},e.phys.CompoundIterator.prototype.__class__=e.phys.CompoundIterator,e.phys.CompoundList=l["nape.phys.CompoundList"]=function(){this.zpp_inner=null,this.zpp_inner=new t.util.ZPP_CompoundList,this.zpp_inner.outer=this},e.phys.CompoundList.__name__=["nape","phys","CompoundList"],e.phys.CompoundList.fromArray=function(t){if(null==t)throw new n._Boot.HaxeError("Error: Cannot convert null Array to Nape list");for(var i=new e.phys.CompoundList,r=0;r<t.length;){var o=t[r];++r,i.push(o)}return i},e.phys.CompoundList.prototype.zpp_inner=null,Object.defineProperty(e.phys.CompoundList.prototype,"length",{get:e.phys.CompoundList.prototype.get_length}),e.phys.CompoundList.prototype.get_length=function(){return this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.user_length},e.phys.CompoundList.prototype.has=function(e){return this.zpp_inner.valmod(),this.zpp_inner.inner.has(e.zpp_inner)},e.phys.CompoundList.prototype.at=function(e){var t;if(this.zpp_inner.valmod(),e>=0?(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t=e>=this.zpp_inner.user_length):t=!0,t)throw new n._Boot.HaxeError("Error: Index out of bounds");if(this.zpp_inner.reverse_flag&&(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),e=this.zpp_inner.user_length-1-e),e<this.zpp_inner.at_index||null==this.zpp_inner.at_ite)this.zpp_inner.at_index=e,this.zpp_inner.at_ite=this.zpp_inner.inner.iterator_at(e);else for(;this.zpp_inner.at_index!=e;)this.zpp_inner.at_index++,this.zpp_inner.at_ite=this.zpp_inner.at_ite.next;return this.zpp_inner.at_ite.elt.outer},e.phys.CompoundList.prototype.push=function(e){if(this.zpp_inner.immutable)throw new n._Boot.HaxeError("Error: CompoundList is immutable");this.zpp_inner.modify_test(),this.zpp_inner.valmod();var t=null==this.zpp_inner.adder||this.zpp_inner.adder(e);if(t){if(this.zpp_inner.reverse_flag)this.zpp_inner.inner.add(e.zpp_inner);else{if(null==this.zpp_inner.push_ite){var i;if(null==this.zpp_inner.inner.head)i=null;else{var r=this.zpp_inner.inner;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),i=r.iterator_at(this.zpp_inner.user_length-1)}this.zpp_inner.push_ite=i}this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,e.zpp_inner)}this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(e)}return t},e.phys.CompoundList.prototype.unshift=function(e){if(this.zpp_inner.immutable)throw new n._Boot.HaxeError("Error: CompoundList is immutable");this.zpp_inner.modify_test(),this.zpp_inner.valmod();var t=null==this.zpp_inner.adder||this.zpp_inner.adder(e);if(t){if(this.zpp_inner.reverse_flag){if(null==this.zpp_inner.push_ite){var i;if(null==this.zpp_inner.inner.head)i=null;else{var r=this.zpp_inner.inner;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),i=r.iterator_at(this.zpp_inner.user_length-1)}this.zpp_inner.push_ite=i}this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,e.zpp_inner)}else this.zpp_inner.inner.add(e.zpp_inner);this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(e)}return t},e.phys.CompoundList.prototype.pop=function(){if(this.zpp_inner.immutable)throw new n._Boot.HaxeError("Error: CompoundList is immutable");if(this.zpp_inner.modify_test(),null==this.zpp_inner.inner.head)throw new n._Boot.HaxeError("Error: Cannot remove from empty list");this.zpp_inner.valmod();var e=null;if(this.zpp_inner.reverse_flag){var t=(e=this.zpp_inner.inner.head.elt).outer;null!=this.zpp_inner.subber&&this.zpp_inner.subber(t),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()}else{var i;if(null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null),this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),1==this.zpp_inner.user_length)i=null;else{var r=this.zpp_inner.inner;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),i=r.iterator_at(this.zpp_inner.user_length-2)}var o=(e=null==i?this.zpp_inner.inner.head.elt:i.next.elt).outer;null!=this.zpp_inner.subber&&this.zpp_inner.subber(o),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(i)}return this.zpp_inner.invalidate(),e.outer},e.phys.CompoundList.prototype.shift=function(){if(this.zpp_inner.immutable)throw new n._Boot.HaxeError("Error: CompoundList is immutable");if(this.zpp_inner.modify_test(),null==this.zpp_inner.inner.head)throw new n._Boot.HaxeError("Error: Cannot remove from empty list");this.zpp_inner.valmod();var e=null;if(this.zpp_inner.reverse_flag){var t;if(null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null),this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),1==this.zpp_inner.user_length)t=null;else{var i=this.zpp_inner.inner;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t=i.iterator_at(this.zpp_inner.user_length-2)}var r=(e=null==t?this.zpp_inner.inner.head.elt:t.next.elt).outer;null!=this.zpp_inner.subber&&this.zpp_inner.subber(r),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(t)}else{var o=(e=this.zpp_inner.inner.head.elt).outer;null!=this.zpp_inner.subber&&this.zpp_inner.subber(o),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()}return this.zpp_inner.invalidate(),e.outer},e.phys.CompoundList.prototype.add=function(e){return this.zpp_inner.reverse_flag?this.push(e):this.unshift(e)},e.phys.CompoundList.prototype.remove=function(e){if(this.zpp_inner.immutable)throw new n._Boot.HaxeError("Error: CompoundList is immutable");var t;this.zpp_inner.modify_test(),this.zpp_inner.valmod(),t=!1;for(var i=this.zpp_inner.inner.head;null!=i;){if(i.elt==e.zpp_inner){t=!0;break}i=i.next}return t&&(null!=this.zpp_inner.subber&&this.zpp_inner.subber(e),this.zpp_inner.dontremove||this.zpp_inner.inner.remove(e.zpp_inner),this.zpp_inner.invalidate()),t},e.phys.CompoundList.prototype.clear=function(){if(this.zpp_inner.immutable)throw new n._Boot.HaxeError("Error: CompoundList is immutable");if(this.zpp_inner.reverse_flag)for(;null!=this.zpp_inner.inner.head;)this.pop();else for(;null!=this.zpp_inner.inner.head;)this.shift()},e.phys.CompoundList.prototype.empty=function(){return null==this.zpp_inner.inner.head},e.phys.CompoundList.prototype.iterator=function(){return this.zpp_inner.valmod(),e.phys.CompoundIterator.get(this)},e.phys.CompoundList.prototype.copy=function(t){null==t&&(t=!1);var i=new e.phys.CompoundList;this.zpp_inner.valmod();for(var r=e.phys.CompoundIterator.get(this);;){r.zpp_inner.zpp_inner.valmod();var o=r.zpp_inner;o.zpp_inner.valmod(),o.zpp_inner.zip_length&&(o.zpp_inner.zip_length=!1,o.zpp_inner.user_length=o.zpp_inner.inner.length);var a,s=o.zpp_inner.user_length;if(r.zpp_critical=!0,r.zpp_i<s?a=!0:(r.zpp_next=e.phys.CompoundIterator.zpp_pool,e.phys.CompoundIterator.zpp_pool=r,r.zpp_inner=null,a=!1),!a)break;r.zpp_critical=!1;var l,p=r.zpp_inner.at(r.zpp_i++);if(t)throw new n._Boot.HaxeError("Error: Compound is not a copyable type");l=p,i.push(l)}return i},e.phys.CompoundList.prototype.merge=function(t){if(null==t)throw new n._Boot.HaxeError("Error: Cannot merge with null list");t.zpp_inner.valmod();for(var i=e.phys.CompoundIterator.get(t);;){i.zpp_inner.zpp_inner.valmod();var r=i.zpp_inner;r.zpp_inner.valmod(),r.zpp_inner.zip_length&&(r.zpp_inner.zip_length=!1,r.zpp_inner.user_length=r.zpp_inner.inner.length);var o,a=r.zpp_inner.user_length;if(i.zpp_critical=!0,i.zpp_i<a?o=!0:(i.zpp_next=e.phys.CompoundIterator.zpp_pool,e.phys.CompoundIterator.zpp_pool=i,i.zpp_inner=null,o=!1),!o)break;i.zpp_critical=!1;var s=i.zpp_inner.at(i.zpp_i++);this.has(s)||(this.zpp_inner.reverse_flag?this.push(s):this.unshift(s))}},e.phys.CompoundList.prototype.toString=function(){var t="[",n=!0;this.zpp_inner.valmod();for(var i=e.phys.CompoundIterator.get(this);;){i.zpp_inner.zpp_inner.valmod();var r=i.zpp_inner;r.zpp_inner.valmod(),r.zpp_inner.zip_length&&(r.zpp_inner.zip_length=!1,r.zpp_inner.user_length=r.zpp_inner.inner.length);var o,a=r.zpp_inner.user_length;if(i.zpp_critical=!0,i.zpp_i<a?o=!0:(i.zpp_next=e.phys.CompoundIterator.zpp_pool,e.phys.CompoundIterator.zpp_pool=i,i.zpp_inner=null,o=!1),!o)break;i.zpp_critical=!1;var s=i.zpp_inner.at(i.zpp_i++);n||(t+=","),t+=null==s?"NULL":s.toString(),n=!1}return t+"]"},e.phys.CompoundList.prototype.foreach=function(t){if(null==t)throw new n._Boot.HaxeError("Error: Cannot execute null on list elements");this.zpp_inner.valmod();for(var i=e.phys.CompoundIterator.get(this);;){i.zpp_inner.zpp_inner.valmod();var r=i.zpp_inner;r.zpp_inner.valmod(),r.zpp_inner.zip_length&&(r.zpp_inner.zip_length=!1,r.zpp_inner.user_length=r.zpp_inner.inner.length);var o,a=r.zpp_inner.user_length;if(i.zpp_critical=!0,i.zpp_i<a?o=!0:(i.zpp_next=e.phys.CompoundIterator.zpp_pool,e.phys.CompoundIterator.zpp_pool=i,i.zpp_inner=null,o=!1),!o)break;try{i.zpp_critical=!1,t(i.zpp_inner.at(i.zpp_i++))}catch(t){t instanceof n._Boot.HaxeError&&t.val,i.zpp_next=e.phys.CompoundIterator.zpp_pool,e.phys.CompoundIterator.zpp_pool=i,i.zpp_inner=null;break}}return this},e.phys.CompoundList.prototype.filter=function(e){if(null==e)throw new n._Boot.HaxeError("Error: Cannot select elements of list with null");for(var t=0;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t<this.zpp_inner.user_length;){var i=this.at(t);try{e(i)?++t:this.remove(i)}catch(e){e instanceof n._Boot.HaxeError&&e.val;break}}return this},e.phys.CompoundList.prototype.__class__=e.phys.CompoundList,e.phys.FluidProperties=l["nape.phys.FluidProperties"]=function(e,i){if(null==i&&(i=1),null==e&&(e=1),this.zpp_inner=null,null==t.phys.ZPP_FluidProperties.zpp_pool?this.zpp_inner=new t.phys.ZPP_FluidProperties:(this.zpp_inner=t.phys.ZPP_FluidProperties.zpp_pool,t.phys.ZPP_FluidProperties.zpp_pool=this.zpp_inner.next,this.zpp_inner.next=null),this.zpp_inner.outer=this,e!=1e3*this.zpp_inner.density){if(e!=e)throw new n._Boot.HaxeError("Error: FluidProperties::density cannot be NaN");this.zpp_inner.density=e/1e3,this.zpp_inner.invalidate()}if(i!=this.zpp_inner.viscosity){if(i!=i)throw new n._Boot.HaxeError("Error: FluidProperties::viscosity cannot be NaN");if(i<0)throw new n._Boot.HaxeError("Error: FluidProperties::viscosity ("+i+") must be >= 0");this.zpp_inner.viscosity=i/1,this.zpp_inner.invalidate()}},e.phys.FluidProperties.__name__=["nape","phys","FluidProperties"],e.phys.FluidProperties.prototype.zpp_inner=null,Object.defineProperty(e.phys.FluidProperties.prototype,"userData",{get:e.phys.FluidProperties.prototype.get_userData}),e.phys.FluidProperties.prototype.get_userData=function(){return null==this.zpp_inner.userData&&(this.zpp_inner.userData={}),this.zpp_inner.userData},Object.defineProperty(e.phys.FluidProperties.prototype,"shapes",{get:e.phys.FluidProperties.prototype.get_shapes}),e.phys.FluidProperties.prototype.get_shapes=function(){return null==this.zpp_inner.wrap_shapes&&(this.zpp_inner.wrap_shapes=t.util.ZPP_ShapeList.get(this.zpp_inner.shapes,!0)),this.zpp_inner.wrap_shapes},e.phys.FluidProperties.prototype.copy=function(){var i=new e.phys.FluidProperties(1e3*this.zpp_inner.density,this.zpp_inner.viscosity);null!=this.zpp_inner.userData&&(i.zpp_inner.userData=r.copy(this.zpp_inner.userData));var o=this.zpp_inner.wrap_gravity;if(null==o){if(null!=i.zpp_inner.wrap_gravity){i.zpp_inner.wrap_gravity.zpp_inner._inuse=!1;var a=i.zpp_inner.wrap_gravity;if(null!=a&&a.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var s=a.zpp_inner;if(s._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=s._isimmutable&&s._isimmutable(),a.zpp_inner._inuse)throw new n._Boot.HaxeError("Error: This Vec2 is not disposable");var l=a.zpp_inner;a.zpp_inner.outer=null,a.zpp_inner=null;var p=a;p.zpp_pool=null,null!=t.util.ZPP_PubPool.nextVec2?t.util.ZPP_PubPool.nextVec2.zpp_pool=p:t.util.ZPP_PubPool.poolVec2=p,t.util.ZPP_PubPool.nextVec2=p,p.zpp_disp=!0;var u=l;null!=u.outer&&(u.outer.zpp_inner=null,u.outer=null),u._isimmutable=null,u._validate=null,u._invalidate=null,u.next=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=u,i.zpp_inner.wrap_gravity=null}}else{if(null!=o&&o.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");null==i.zpp_inner.wrap_gravity&&i.zpp_inner.getgravity();var h=i.zpp_inner.wrap_gravity;if(null!=h&&h.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");if(null!=o&&o.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var c=h.zpp_inner;if(c._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=c._isimmutable&&c._isimmutable(),null==o)throw new n._Boot.HaxeError("Error: Cannot assign null Vec2");if(null!=o&&o.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var _=o.zpp_inner;null!=_._validate&&_._validate();var d=o.zpp_inner.x;if(null!=o&&o.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var m=o.zpp_inner;null!=m._validate&&m._validate();var P=o.zpp_inner.y;if(null!=h&&h.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var f,x=h.zpp_inner;if(x._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=x._isimmutable&&x._isimmutable(),d!=d||P!=P)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null!=h&&h.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var y=h.zpp_inner;if(null!=y._validate&&y._validate(),h.zpp_inner.x==d){if(null!=h&&h.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var v=h.zpp_inner;null!=v._validate&&v._validate(),f=h.zpp_inner.y==P}else f=!1;if(!f){h.zpp_inner.x=d,h.zpp_inner.y=P;var g=h.zpp_inner;null!=g._invalidate&&g._invalidate(g)}if(o.zpp_inner.weak){if(null!=o&&o.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var b=o.zpp_inner;if(b._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=b._isimmutable&&b._isimmutable(),o.zpp_inner._inuse)throw new n._Boot.HaxeError("Error: This Vec2 is not disposable");var z=o.zpp_inner;o.zpp_inner.outer=null,o.zpp_inner=null;var w=o;w.zpp_pool=null,null!=t.util.ZPP_PubPool.nextVec2?t.util.ZPP_PubPool.nextVec2.zpp_pool=w:t.util.ZPP_PubPool.poolVec2=w,t.util.ZPP_PubPool.nextVec2=w,w.zpp_disp=!0;var Z=z;null!=Z.outer&&(Z.outer.zpp_inner=null,Z.outer=null),Z._isimmutable=null,Z._validate=null,Z._invalidate=null,Z.next=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=Z}}return i},Object.defineProperty(e.phys.FluidProperties.prototype,"density",{get:e.phys.FluidProperties.prototype.get_density,set:e.phys.FluidProperties.prototype.set_density}),e.phys.FluidProperties.prototype.get_density=function(){return 1e3*this.zpp_inner.density},e.phys.FluidProperties.prototype.set_density=function(e){if(e!=1e3*this.zpp_inner.density){if(e!=e)throw new n._Boot.HaxeError("Error: FluidProperties::density cannot be NaN");this.zpp_inner.density=e/1e3,this.zpp_inner.invalidate()}return 1e3*this.zpp_inner.density},Object.defineProperty(e.phys.FluidProperties.prototype,"viscosity",{get:e.phys.FluidProperties.prototype.get_viscosity,set:e.phys.FluidProperties.prototype.set_viscosity}),e.phys.FluidProperties.prototype.get_viscosity=function(){return this.zpp_inner.viscosity},e.phys.FluidProperties.prototype.set_viscosity=function(e){if(e!=this.zpp_inner.viscosity){if(e!=e)throw new n._Boot.HaxeError("Error: FluidProperties::viscosity cannot be NaN");if(e<0)throw new n._Boot.HaxeError("Error: FluidProperties::viscosity ("+e+") must be >= 0");this.zpp_inner.viscosity=e/1,this.zpp_inner.invalidate()}return this.zpp_inner.viscosity},Object.defineProperty(e.phys.FluidProperties.prototype,"gravity",{get:e.phys.FluidProperties.prototype.get_gravity,set:e.phys.FluidProperties.prototype.set_gravity}),e.phys.FluidProperties.prototype.get_gravity=function(){return this.zpp_inner.wrap_gravity},e.phys.FluidProperties.prototype.set_gravity=function(e){if(null==e){if(null!=this.zpp_inner.wrap_gravity){this.zpp_inner.wrap_gravity.zpp_inner._inuse=!1;var i=this.zpp_inner.wrap_gravity;if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var r=i.zpp_inner;if(r._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=r._isimmutable&&r._isimmutable(),i.zpp_inner._inuse)throw new n._Boot.HaxeError("Error: This Vec2 is not disposable");var o=i.zpp_inner;i.zpp_inner.outer=null,i.zpp_inner=null;var a=i;a.zpp_pool=null,null!=t.util.ZPP_PubPool.nextVec2?t.util.ZPP_PubPool.nextVec2.zpp_pool=a:t.util.ZPP_PubPool.poolVec2=a,t.util.ZPP_PubPool.nextVec2=a,a.zpp_disp=!0;var s=o;null!=s.outer&&(s.outer.zpp_inner=null,s.outer=null),s._isimmutable=null,s._validate=null,s._invalidate=null,s.next=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=s,this.zpp_inner.wrap_gravity=null}}else{if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");null==this.zpp_inner.wrap_gravity&&this.zpp_inner.getgravity();var l=this.zpp_inner.wrap_gravity;if(null!=l&&l.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var p=l.zpp_inner;if(p._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=p._isimmutable&&p._isimmutable(),null==e)throw new n._Boot.HaxeError("Error: Cannot assign null Vec2");if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var u=e.zpp_inner;null!=u._validate&&u._validate();var h=e.zpp_inner.x;if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var c=e.zpp_inner;null!=c._validate&&c._validate();var _=e.zpp_inner.y;if(null!=l&&l.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var d,m=l.zpp_inner;if(m._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=m._isimmutable&&m._isimmutable(),h!=h||_!=_)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null!=l&&l.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var P=l.zpp_inner;if(null!=P._validate&&P._validate(),l.zpp_inner.x==h){if(null!=l&&l.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var f=l.zpp_inner;null!=f._validate&&f._validate(),d=l.zpp_inner.y==_}else d=!1;if(!d){l.zpp_inner.x=h,l.zpp_inner.y=_;var x=l.zpp_inner;null!=x._invalidate&&x._invalidate(x)}if(e.zpp_inner.weak){if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var y=e.zpp_inner;if(y._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=y._isimmutable&&y._isimmutable(),e.zpp_inner._inuse)throw new n._Boot.HaxeError("Error: This Vec2 is not disposable");var v=e.zpp_inner;e.zpp_inner.outer=null,e.zpp_inner=null;var g=e;g.zpp_pool=null,null!=t.util.ZPP_PubPool.nextVec2?t.util.ZPP_PubPool.nextVec2.zpp_pool=g:t.util.ZPP_PubPool.poolVec2=g,t.util.ZPP_PubPool.nextVec2=g,g.zpp_disp=!0;var b=v;null!=b.outer&&(b.outer.zpp_inner=null,b.outer=null),b._isimmutable=null,b._validate=null,b._invalidate=null,b.next=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=b}}return this.zpp_inner.wrap_gravity},e.phys.FluidProperties.prototype.toString=function(){return"{ density: "+1e3*this.zpp_inner.density+" viscosity: "+this.zpp_inner.viscosity+" gravity: "+i.string(this.zpp_inner.wrap_gravity)+" }"},e.phys.FluidProperties.prototype.__class__=e.phys.FluidProperties,e.phys.GravMassMode=l["nape.phys.GravMassMode"]=function(){if(!t.util.ZPP_Flags.internal)throw new n._Boot.HaxeError("Error: Cannot instantiate GravMassMode derp!")},e.phys.GravMassMode.__name__=["nape","phys","GravMassMode"],e.phys.GravMassMode.DEFAULT=null,e.phys.GravMassMode.get_DEFAULT=function(){return null==t.util.ZPP_Flags.GravMassMode_DEFAULT&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.GravMassMode_DEFAULT=new e.phys.GravMassMode,t.util.ZPP_Flags.internal=!1),t.util.ZPP_Flags.GravMassMode_DEFAULT},e.phys.GravMassMode.FIXED=null,e.phys.GravMassMode.get_FIXED=function(){return null==t.util.ZPP_Flags.GravMassMode_FIXED&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.GravMassMode_FIXED=new e.phys.GravMassMode,t.util.ZPP_Flags.internal=!1),t.util.ZPP_Flags.GravMassMode_FIXED},e.phys.GravMassMode.SCALED=null,e.phys.GravMassMode.get_SCALED=function(){return null==t.util.ZPP_Flags.GravMassMode_SCALED&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.GravMassMode_SCALED=new e.phys.GravMassMode,t.util.ZPP_Flags.internal=!1),t.util.ZPP_Flags.GravMassMode_SCALED},e.phys.GravMassMode.prototype.toString=function(){return null==t.util.ZPP_Flags.GravMassMode_DEFAULT&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.GravMassMode_DEFAULT=new e.phys.GravMassMode,t.util.ZPP_Flags.internal=!1),this==t.util.ZPP_Flags.GravMassMode_DEFAULT?"DEFAULT":(null==t.util.ZPP_Flags.GravMassMode_FIXED&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.GravMassMode_FIXED=new e.phys.GravMassMode,t.util.ZPP_Flags.internal=!1),this==t.util.ZPP_Flags.GravMassMode_FIXED?"FIXED":(null==t.util.ZPP_Flags.GravMassMode_SCALED&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.GravMassMode_SCALED=new e.phys.GravMassMode,t.util.ZPP_Flags.internal=!1),this==t.util.ZPP_Flags.GravMassMode_SCALED?"SCALED":""))},e.phys.GravMassMode.prototype.__class__=e.phys.GravMassMode,e.phys.InertiaMode=l["nape.phys.InertiaMode"]=function(){if(!t.util.ZPP_Flags.internal)throw new n._Boot.HaxeError("Error: Cannot instantiate InertiaMode derp!")},e.phys.InertiaMode.__name__=["nape","phys","InertiaMode"],e.phys.InertiaMode.DEFAULT=null,e.phys.InertiaMode.get_DEFAULT=function(){return null==t.util.ZPP_Flags.InertiaMode_DEFAULT&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.InertiaMode_DEFAULT=new e.phys.InertiaMode,t.util.ZPP_Flags.internal=!1),t.util.ZPP_Flags.InertiaMode_DEFAULT},e.phys.InertiaMode.FIXED=null,e.phys.InertiaMode.get_FIXED=function(){return null==t.util.ZPP_Flags.InertiaMode_FIXED&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.InertiaMode_FIXED=new e.phys.InertiaMode,t.util.ZPP_Flags.internal=!1),t.util.ZPP_Flags.InertiaMode_FIXED},e.phys.InertiaMode.prototype.toString=function(){return null==t.util.ZPP_Flags.InertiaMode_DEFAULT&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.InertiaMode_DEFAULT=new e.phys.InertiaMode,t.util.ZPP_Flags.internal=!1),this==t.util.ZPP_Flags.InertiaMode_DEFAULT?"DEFAULT":(null==t.util.ZPP_Flags.InertiaMode_FIXED&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.InertiaMode_FIXED=new e.phys.InertiaMode,t.util.ZPP_Flags.internal=!1),this==t.util.ZPP_Flags.InertiaMode_FIXED?"FIXED":"")},e.phys.InertiaMode.prototype.__class__=e.phys.InertiaMode,e.phys.InteractorIterator=l["nape.phys.InteractorIterator"]=function(){if(this.zpp_next=null,this.zpp_critical=!1,this.zpp_i=0,this.zpp_inner=null,!t.util.ZPP_InteractorList.internal)throw new n._Boot.HaxeError("Error: Cannot instantiate InteractorIterator derp!")},e.phys.InteractorIterator.__name__=["nape","phys","InteractorIterator"],e.phys.InteractorIterator.get=function(n){var i;if(null==e.phys.InteractorIterator.zpp_pool){t.util.ZPP_InteractorList.internal=!0;var r=new e.phys.InteractorIterator;t.util.ZPP_InteractorList.internal=!1,i=r}else{var o=e.phys.InteractorIterator.zpp_pool;e.phys.InteractorIterator.zpp_pool=o.zpp_next,i=o}return i.zpp_i=0,i.zpp_inner=n,i.zpp_critical=!1,i},e.phys.InteractorIterator.prototype.zpp_inner=null,e.phys.InteractorIterator.prototype.zpp_i=null,e.phys.InteractorIterator.prototype.zpp_critical=null,e.phys.InteractorIterator.prototype.zpp_next=null,e.phys.InteractorIterator.prototype.hasNext=function(){this.zpp_inner.zpp_inner.valmod();var t=this.zpp_inner;t.zpp_inner.valmod(),t.zpp_inner.zip_length&&(t.zpp_inner.zip_length=!1,t.zpp_inner.user_length=t.zpp_inner.inner.length);var n=t.zpp_inner.user_length;return this.zpp_critical=!0,this.zpp_i<n||(this.zpp_next=e.phys.InteractorIterator.zpp_pool,e.phys.InteractorIterator.zpp_pool=this,this.zpp_inner=null,!1)},e.phys.InteractorIterator.prototype.next=function(){return this.zpp_critical=!1,this.zpp_inner.at(this.zpp_i++)},e.phys.InteractorIterator.prototype.__class__=e.phys.InteractorIterator,e.phys.InteractorList=l["nape.phys.InteractorList"]=function(){this.zpp_inner=null,this.zpp_inner=new t.util.ZPP_InteractorList,this.zpp_inner.outer=this},e.phys.InteractorList.__name__=["nape","phys","InteractorList"],e.phys.InteractorList.fromArray=function(t){if(null==t)throw new n._Boot.HaxeError("Error: Cannot convert null Array to Nape list");for(var i=new e.phys.InteractorList,r=0;r<t.length;){var o=t[r];++r,i.push(o)}return i},e.phys.InteractorList.prototype.zpp_inner=null,Object.defineProperty(e.phys.InteractorList.prototype,"length",{get:e.phys.InteractorList.prototype.get_length}),e.phys.InteractorList.prototype.get_length=function(){return this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.user_length},e.phys.InteractorList.prototype.has=function(e){return this.zpp_inner.valmod(),this.zpp_inner.inner.has(e.zpp_inner_i)},e.phys.InteractorList.prototype.at=function(e){var t;if(this.zpp_inner.valmod(),e>=0?(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t=e>=this.zpp_inner.user_length):t=!0,t)throw new n._Boot.HaxeError("Error: Index out of bounds");if(this.zpp_inner.reverse_flag&&(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),e=this.zpp_inner.user_length-1-e),e<this.zpp_inner.at_index||null==this.zpp_inner.at_ite)this.zpp_inner.at_index=e,this.zpp_inner.at_ite=this.zpp_inner.inner.iterator_at(e);else for(;this.zpp_inner.at_index!=e;)this.zpp_inner.at_index++,this.zpp_inner.at_ite=this.zpp_inner.at_ite.next;return this.zpp_inner.at_ite.elt.outer_i},e.phys.InteractorList.prototype.push=function(e){if(this.zpp_inner.immutable)throw new n._Boot.HaxeError("Error: InteractorList is immutable");this.zpp_inner.modify_test(),this.zpp_inner.valmod();var t=null==this.zpp_inner.adder||this.zpp_inner.adder(e);if(t){if(this.zpp_inner.reverse_flag)this.zpp_inner.inner.add(e.zpp_inner_i);else{if(null==this.zpp_inner.push_ite){var i;if(null==this.zpp_inner.inner.head)i=null;else{var r=this.zpp_inner.inner;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),i=r.iterator_at(this.zpp_inner.user_length-1)}this.zpp_inner.push_ite=i}this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,e.zpp_inner_i)}this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(e)}return t},e.phys.InteractorList.prototype.unshift=function(e){if(this.zpp_inner.immutable)throw new n._Boot.HaxeError("Error: InteractorList is immutable");this.zpp_inner.modify_test(),this.zpp_inner.valmod();var t=null==this.zpp_inner.adder||this.zpp_inner.adder(e);if(t){if(this.zpp_inner.reverse_flag){if(null==this.zpp_inner.push_ite){var i;if(null==this.zpp_inner.inner.head)i=null;else{var r=this.zpp_inner.inner;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),i=r.iterator_at(this.zpp_inner.user_length-1)}this.zpp_inner.push_ite=i}this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,e.zpp_inner_i)}else this.zpp_inner.inner.add(e.zpp_inner_i);this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(e)}return t},e.phys.InteractorList.prototype.pop=function(){if(this.zpp_inner.immutable)throw new n._Boot.HaxeError("Error: InteractorList is immutable");if(this.zpp_inner.modify_test(),null==this.zpp_inner.inner.head)throw new n._Boot.HaxeError("Error: Cannot remove from empty list");this.zpp_inner.valmod();var e=null;if(this.zpp_inner.reverse_flag){var t=(e=this.zpp_inner.inner.head.elt).outer_i;null!=this.zpp_inner.subber&&this.zpp_inner.subber(t),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()}else{var i;if(null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null),this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),1==this.zpp_inner.user_length)i=null;else{var r=this.zpp_inner.inner;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),i=r.iterator_at(this.zpp_inner.user_length-2)}var o=(e=null==i?this.zpp_inner.inner.head.elt:i.next.elt).outer_i;null!=this.zpp_inner.subber&&this.zpp_inner.subber(o),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(i)}return this.zpp_inner.invalidate(),e.outer_i},e.phys.InteractorList.prototype.shift=function(){if(this.zpp_inner.immutable)throw new n._Boot.HaxeError("Error: InteractorList is immutable");if(this.zpp_inner.modify_test(),null==this.zpp_inner.inner.head)throw new n._Boot.HaxeError("Error: Cannot remove from empty list");this.zpp_inner.valmod();var e=null;if(this.zpp_inner.reverse_flag){var t;if(null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null),this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),1==this.zpp_inner.user_length)t=null;else{var i=this.zpp_inner.inner;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t=i.iterator_at(this.zpp_inner.user_length-2)}var r=(e=null==t?this.zpp_inner.inner.head.elt:t.next.elt).outer_i;null!=this.zpp_inner.subber&&this.zpp_inner.subber(r),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(t)}else{var o=(e=this.zpp_inner.inner.head.elt).outer_i;null!=this.zpp_inner.subber&&this.zpp_inner.subber(o),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()}return this.zpp_inner.invalidate(),e.outer_i},e.phys.InteractorList.prototype.add=function(e){return this.zpp_inner.reverse_flag?this.push(e):this.unshift(e)},e.phys.InteractorList.prototype.remove=function(e){if(this.zpp_inner.immutable)throw new n._Boot.HaxeError("Error: InteractorList is immutable");var t;this.zpp_inner.modify_test(),this.zpp_inner.valmod(),t=!1;for(var i=this.zpp_inner.inner.head;null!=i;){if(i.elt==e.zpp_inner_i){t=!0;break}i=i.next}return t&&(null!=this.zpp_inner.subber&&this.zpp_inner.subber(e),this.zpp_inner.dontremove||this.zpp_inner.inner.remove(e.zpp_inner_i),this.zpp_inner.invalidate()),t},e.phys.InteractorList.prototype.clear=function(){if(this.zpp_inner.immutable)throw new n._Boot.HaxeError("Error: InteractorList is immutable");if(this.zpp_inner.reverse_flag)for(;null!=this.zpp_inner.inner.head;)this.pop();else for(;null!=this.zpp_inner.inner.head;)this.shift()},e.phys.InteractorList.prototype.empty=function(){return null==this.zpp_inner.inner.head},e.phys.InteractorList.prototype.iterator=function(){return this.zpp_inner.valmod(),e.phys.InteractorIterator.get(this)},e.phys.InteractorList.prototype.copy=function(t){null==t&&(t=!1);var i=new e.phys.InteractorList;this.zpp_inner.valmod();for(var r=e.phys.InteractorIterator.get(this);;){r.zpp_inner.zpp_inner.valmod();var o=r.zpp_inner;o.zpp_inner.valmod(),o.zpp_inner.zip_length&&(o.zpp_inner.zip_length=!1,o.zpp_inner.user_length=o.zpp_inner.inner.length);var a,s=o.zpp_inner.user_length;if(r.zpp_critical=!0,r.zpp_i<s?a=!0:(r.zpp_next=e.phys.InteractorIterator.zpp_pool,e.phys.InteractorIterator.zpp_pool=r,r.zpp_inner=null,a=!1),!a)break;r.zpp_critical=!1;var l,p=r.zpp_inner.at(r.zpp_i++);if(t)throw new n._Boot.HaxeError("Error: Interactor is not a copyable type");l=p,i.push(l)}return i},e.phys.InteractorList.prototype.merge=function(t){if(null==t)throw new n._Boot.HaxeError("Error: Cannot merge with null list");t.zpp_inner.valmod();for(var i=e.phys.InteractorIterator.get(t);;){i.zpp_inner.zpp_inner.valmod();var r=i.zpp_inner;r.zpp_inner.valmod(),r.zpp_inner.zip_length&&(r.zpp_inner.zip_length=!1,r.zpp_inner.user_length=r.zpp_inner.inner.length);var o,a=r.zpp_inner.user_length;if(i.zpp_critical=!0,i.zpp_i<a?o=!0:(i.zpp_next=e.phys.InteractorIterator.zpp_pool,e.phys.InteractorIterator.zpp_pool=i,i.zpp_inner=null,o=!1),!o)break;i.zpp_critical=!1;var s=i.zpp_inner.at(i.zpp_i++);this.has(s)||(this.zpp_inner.reverse_flag?this.push(s):this.unshift(s))}},e.phys.InteractorList.prototype.toString=function(){var t="[",n=!0;this.zpp_inner.valmod();for(var i=e.phys.InteractorIterator.get(this);;){i.zpp_inner.zpp_inner.valmod();var r=i.zpp_inner;r.zpp_inner.valmod(),r.zpp_inner.zip_length&&(r.zpp_inner.zip_length=!1,r.zpp_inner.user_length=r.zpp_inner.inner.length);var o,a=r.zpp_inner.user_length;if(i.zpp_critical=!0,i.zpp_i<a?o=!0:(i.zpp_next=e.phys.InteractorIterator.zpp_pool,e.phys.InteractorIterator.zpp_pool=i,i.zpp_inner=null,o=!1),!o)break;i.zpp_critical=!1;var s=i.zpp_inner.at(i.zpp_i++);n||(t+=","),t+=null==s?"NULL":s.toString(),n=!1}return t+"]"},e.phys.InteractorList.prototype.foreach=function(t){if(null==t)throw new n._Boot.HaxeError("Error: Cannot execute null on list elements");this.zpp_inner.valmod();for(var i=e.phys.InteractorIterator.get(this);;){i.zpp_inner.zpp_inner.valmod();var r=i.zpp_inner;r.zpp_inner.valmod(),r.zpp_inner.zip_length&&(r.zpp_inner.zip_length=!1,r.zpp_inner.user_length=r.zpp_inner.inner.length);var o,a=r.zpp_inner.user_length;if(i.zpp_critical=!0,i.zpp_i<a?o=!0:(i.zpp_next=e.phys.InteractorIterator.zpp_pool,e.phys.InteractorIterator.zpp_pool=i,i.zpp_inner=null,o=!1),!o)break;try{i.zpp_critical=!1,t(i.zpp_inner.at(i.zpp_i++))}catch(t){t instanceof n._Boot.HaxeError&&t.val,i.zpp_next=e.phys.InteractorIterator.zpp_pool,e.phys.InteractorIterator.zpp_pool=i,i.zpp_inner=null;break}}return this},e.phys.InteractorList.prototype.filter=function(e){if(null==e)throw new n._Boot.HaxeError("Error: Cannot select elements of list with null");for(var t=0;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t<this.zpp_inner.user_length;){var i=this.at(t);try{e(i)?++t:this.remove(i)}catch(e){e instanceof n._Boot.HaxeError&&e.val;break}}return this},e.phys.InteractorList.prototype.__class__=e.phys.InteractorList,e.phys.MassMode=l["nape.phys.MassMode"]=function(){if(!t.util.ZPP_Flags.internal)throw new n._Boot.HaxeError("Error: Cannot instantiate MassMode derp!")},e.phys.MassMode.__name__=["nape","phys","MassMode"],e.phys.MassMode.DEFAULT=null,e.phys.MassMode.get_DEFAULT=function(){return null==t.util.ZPP_Flags.MassMode_DEFAULT&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.MassMode_DEFAULT=new e.phys.MassMode,t.util.ZPP_Flags.internal=!1),t.util.ZPP_Flags.MassMode_DEFAULT},e.phys.MassMode.FIXED=null,e.phys.MassMode.get_FIXED=function(){return null==t.util.ZPP_Flags.MassMode_FIXED&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.MassMode_FIXED=new e.phys.MassMode,t.util.ZPP_Flags.internal=!1),t.util.ZPP_Flags.MassMode_FIXED},e.phys.MassMode.prototype.toString=function(){return null==t.util.ZPP_Flags.MassMode_DEFAULT&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.MassMode_DEFAULT=new e.phys.MassMode,t.util.ZPP_Flags.internal=!1),this==t.util.ZPP_Flags.MassMode_DEFAULT?"DEFAULT":(null==t.util.ZPP_Flags.MassMode_FIXED&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.MassMode_FIXED=new e.phys.MassMode,t.util.ZPP_Flags.internal=!1),this==t.util.ZPP_Flags.MassMode_FIXED?"FIXED":"")},e.phys.MassMode.prototype.__class__=e.phys.MassMode,e.phys.Material=l["nape.phys.Material"]=function(e,i,r,o,a){if(null==a&&(a=.001),null==o&&(o=1),null==r&&(r=2),null==i&&(i=1),null==e&&(e=0),this.zpp_inner=null,null==t.phys.ZPP_Material.zpp_pool?this.zpp_inner=new t.phys.ZPP_Material:(this.zpp_inner=t.phys.ZPP_Material.zpp_pool,t.phys.ZPP_Material.zpp_pool=this.zpp_inner.next,this.zpp_inner.next=null),this.zpp_inner.outer=this,e!=this.zpp_inner.elasticity){if(e!=e)throw new n._Boot.HaxeError("Error: Material::elasticity cannot be NaN");this.zpp_inner.elasticity=e/1,this.zpp_inner.invalidate(t.phys.ZPP_Material.WAKE|t.phys.ZPP_Material.ARBITERS)}if(i!=this.zpp_inner.dynamicFriction){if(i!=i)throw new n._Boot.HaxeError("Error: Material::dynamicFriction cannot be NaN");if(i<0)throw new n._Boot.HaxeError("Error: Material::dynamicFriction cannot be negative");this.zpp_inner.dynamicFriction=i/1,this.zpp_inner.invalidate(t.phys.ZPP_Material.WAKE|t.phys.ZPP_Material.ANGDRAG|t.phys.ZPP_Material.ARBITERS)}if(r!=this.zpp_inner.staticFriction){if(r!=r)throw new n._Boot.HaxeError("Error: Material::staticFriction cannot be NaN");if(r<0)throw new n._Boot.HaxeError("Error: Material::staticFriction cannot be negative");this.zpp_inner.staticFriction=r/1,this.zpp_inner.invalidate(t.phys.ZPP_Material.WAKE|t.phys.ZPP_Material.ARBITERS)}if(o!=1e3*this.zpp_inner.density){if(o!=o)throw new n._Boot.HaxeError("Error: Material::density cannot be NaN");if(o<0)throw new n._Boot.HaxeError("Error: Material::density must be positive");if(o<0)throw new n._Boot.HaxeError("Error: Material::density cannot be negative");this.zpp_inner.density=o/1e3,this.zpp_inner.invalidate(t.phys.ZPP_Material.WAKE|t.phys.ZPP_Material.PROPS)}if(a!=this.zpp_inner.rollingFriction){if(a!=a)throw new n._Boot.HaxeError("Error: Material::rollingFriction cannot be NaN");if(a<0)throw new n._Boot.HaxeError("Error: Material::rollingFriction cannot be negative");this.zpp_inner.rollingFriction=a/1,this.zpp_inner.invalidate(t.phys.ZPP_Material.WAKE|t.phys.ZPP_Material.ARBITERS)}},e.phys.Material.__name__=["nape","phys","Material"],e.phys.Material.wood=function(){return new e.phys.Material(.4,.2,.38,.7,.005)},e.phys.Material.steel=function(){return new e.phys.Material(.2,.57,.74,7.8,.001)},e.phys.Material.ice=function(){return new e.phys.Material(.3,.03,.1,.9,1e-4)},e.phys.Material.rubber=function(){return new e.phys.Material(.8,1,1.4,1.5,.01)},e.phys.Material.glass=function(){return new e.phys.Material(.4,.4,.94,2.6,.002)},e.phys.Material.sand=function(){return new e.phys.Material(-1,.45,.6,1.6,16)},e.phys.Material.prototype.zpp_inner=null,Object.defineProperty(e.phys.Material.prototype,"userData",{get:e.phys.Material.prototype.get_userData}),e.phys.Material.prototype.get_userData=function(){return null==this.zpp_inner.userData&&(this.zpp_inner.userData={}),this.zpp_inner.userData},Object.defineProperty(e.phys.Material.prototype,"shapes",{get:e.phys.Material.prototype.get_shapes}),e.phys.Material.prototype.get_shapes=function(){return null==this.zpp_inner.wrap_shapes&&(this.zpp_inner.wrap_shapes=t.util.ZPP_ShapeList.get(this.zpp_inner.shapes,!0)),this.zpp_inner.wrap_shapes},e.phys.Material.prototype.copy=function(){var t=new e.phys.Material(this.zpp_inner.elasticity,this.zpp_inner.dynamicFriction,this.zpp_inner.staticFriction,1e3*this.zpp_inner.density,this.zpp_inner.rollingFriction);return null!=this.zpp_inner.userData&&(t.zpp_inner.userData=r.copy(this.zpp_inner.userData)),t},Object.defineProperty(e.phys.Material.prototype,"elasticity",{get:e.phys.Material.prototype.get_elasticity,set:e.phys.Material.prototype.set_elasticity}),e.phys.Material.prototype.get_elasticity=function(){return this.zpp_inner.elasticity},e.phys.Material.prototype.set_elasticity=function(e){if(e!=this.zpp_inner.elasticity){if(e!=e)throw new n._Boot.HaxeError("Error: Material::elasticity cannot be NaN");this.zpp_inner.elasticity=e/1,this.zpp_inner.invalidate(t.phys.ZPP_Material.WAKE|t.phys.ZPP_Material.ARBITERS)}return this.zpp_inner.elasticity},Object.defineProperty(e.phys.Material.prototype,"dynamicFriction",{get:e.phys.Material.prototype.get_dynamicFriction,set:e.phys.Material.prototype.set_dynamicFriction}),e.phys.Material.prototype.get_dynamicFriction=function(){return this.zpp_inner.dynamicFriction},e.phys.Material.prototype.set_dynamicFriction=function(e){if(e!=this.zpp_inner.dynamicFriction){if(e!=e)throw new n._Boot.HaxeError("Error: Material::dynamicFriction cannot be NaN");if(e<0)throw new n._Boot.HaxeError("Error: Material::dynamicFriction cannot be negative");this.zpp_inner.dynamicFriction=e/1,this.zpp_inner.invalidate(t.phys.ZPP_Material.WAKE|t.phys.ZPP_Material.ANGDRAG|t.phys.ZPP_Material.ARBITERS)}return this.zpp_inner.dynamicFriction},Object.defineProperty(e.phys.Material.prototype,"staticFriction",{get:e.phys.Material.prototype.get_staticFriction,set:e.phys.Material.prototype.set_staticFriction}),e.phys.Material.prototype.get_staticFriction=function(){return this.zpp_inner.staticFriction},e.phys.Material.prototype.set_staticFriction=function(e){if(e!=this.zpp_inner.staticFriction){if(e!=e)throw new n._Boot.HaxeError("Error: Material::staticFriction cannot be NaN");if(e<0)throw new n._Boot.HaxeError("Error: Material::staticFriction cannot be negative");this.zpp_inner.staticFriction=e/1,this.zpp_inner.invalidate(t.phys.ZPP_Material.WAKE|t.phys.ZPP_Material.ARBITERS)}return this.zpp_inner.staticFriction},Object.defineProperty(e.phys.Material.prototype,"density",{get:e.phys.Material.prototype.get_density,set:e.phys.Material.prototype.set_density}),e.phys.Material.prototype.get_density=function(){return 1e3*this.zpp_inner.density},e.phys.Material.prototype.set_density=function(e){if(e!=1e3*this.zpp_inner.density){if(e!=e)throw new n._Boot.HaxeError("Error: Material::density cannot be NaN");if(e<0)throw new n._Boot.HaxeError("Error: Material::density must be positive");if(e<0)throw new n._Boot.HaxeError("Error: Material::density cannot be negative");this.zpp_inner.density=e/1e3,this.zpp_inner.invalidate(t.phys.ZPP_Material.WAKE|t.phys.ZPP_Material.PROPS)}return 1e3*this.zpp_inner.density},Object.defineProperty(e.phys.Material.prototype,"rollingFriction",{get:e.phys.Material.prototype.get_rollingFriction,set:e.phys.Material.prototype.set_rollingFriction}),e.phys.Material.prototype.get_rollingFriction=function(){return this.zpp_inner.rollingFriction},e.phys.Material.prototype.set_rollingFriction=function(e){if(e!=this.zpp_inner.rollingFriction){if(e!=e)throw new n._Boot.HaxeError("Error: Material::rollingFriction cannot be NaN");if(e<0)throw new n._Boot.HaxeError("Error: Material::rollingFriction cannot be negative");this.zpp_inner.rollingFriction=e/1,this.zpp_inner.invalidate(t.phys.ZPP_Material.WAKE|t.phys.ZPP_Material.ARBITERS)}return this.zpp_inner.rollingFriction},e.phys.Material.prototype.toString=function(){return"{ elasticity: "+this.zpp_inner.elasticity+" dynamicFriction: "+this.zpp_inner.dynamicFriction+" staticFriction: "+this.zpp_inner.staticFriction+" density: "+1e3*this.zpp_inner.density+" rollingFriction: "+this.zpp_inner.rollingFriction+" }"},e.phys.Material.prototype.__class__=e.phys.Material,e.shape||(e.shape={}),e.shape.Shape=l["nape.shape.Shape"]=function(){if(this.zpp_inner=null,e.phys.Interactor.zpp_internalAlloc=!0,e.phys.Interactor.call(this),e.phys.Interactor.zpp_internalAlloc=!1,!e.shape.Shape.zpp_internalAlloc)throw new n._Boot.HaxeError("Error: Shape cannot be instantiated derp!")},e.shape.Shape.__name__=["nape","shape","Shape"],e.shape.Shape.__super__=e.phys.Interactor,e.phys.Interactor.prototype)e.shape.Shape.prototype[u]=e.phys.Interactor.prototype[u];for(var u in e.shape.Shape.prototype.zpp_inner=null,Object.defineProperty(e.shape.Shape.prototype,"type",{get:e.shape.Shape.prototype.get_type}),e.shape.Shape.prototype.get_type=function(){return t.shape.ZPP_Shape.types[this.zpp_inner.type]},e.shape.Shape.prototype.isCircle=function(){return 0==this.zpp_inner.type},e.shape.Shape.prototype.isPolygon=function(){return 1==this.zpp_inner.type},Object.defineProperty(e.shape.Shape.prototype,"body",{get:e.shape.Shape.prototype.get_body,set:e.shape.Shape.prototype.set_body}),e.shape.Shape.prototype.get_body=function(){return null!=this.zpp_inner.body?this.zpp_inner.body.outer:null},e.shape.Shape.prototype.set_body=function(e){if(this.zpp_inner.immutable_midstep("Shape::body"),(null!=this.zpp_inner.body?this.zpp_inner.body.outer:null)!=e&&(null!=this.zpp_inner.body&&(null!=this.zpp_inner.body?this.zpp_inner.body.outer:null).zpp_inner.wrap_shapes.remove(this),null!=e)){var t=e.zpp_inner.wrap_shapes;t.zpp_inner.reverse_flag?t.push(this):t.unshift(this)}return null!=this.zpp_inner.body?this.zpp_inner.body.outer:null},Object.defineProperty(e.shape.Shape.prototype,"castCircle",{get:e.shape.Shape.prototype.get_castCircle}),e.shape.Shape.prototype.get_castCircle=function(){return 0==this.zpp_inner.type?this.zpp_inner.circle.outer_zn:null},Object.defineProperty(e.shape.Shape.prototype,"castPolygon",{get:e.shape.Shape.prototype.get_castPolygon}),e.shape.Shape.prototype.get_castPolygon=function(){return 1==this.zpp_inner.type?this.zpp_inner.polygon.outer_zn:null},Object.defineProperty(e.shape.Shape.prototype,"worldCOM",{get:e.shape.Shape.prototype.get_worldCOM}),e.shape.Shape.prototype.get_worldCOM=function(){if(null==this.zpp_inner.wrap_worldCOM){var i,r=this.zpp_inner.worldCOMx,o=this.zpp_inner.worldCOMy;if(null==o&&(o=0),null==r&&(r=0),r!=r||o!=o)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null==t.util.ZPP_PubPool.poolVec2?i=new e.geom.Vec2:(i=t.util.ZPP_PubPool.poolVec2,t.util.ZPP_PubPool.poolVec2=i.zpp_pool,i.zpp_pool=null,i.zpp_disp=!1,i==t.util.ZPP_PubPool.nextVec2&&(t.util.ZPP_PubPool.nextVec2=null)),null==i.zpp_inner){var a;null==t.geom.ZPP_Vec2.zpp_pool?a=new t.geom.ZPP_Vec2:(a=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=a.next,a.next=null),a.weak=!1,a._immutable=!1,a.x=r,a.y=o,i.zpp_inner=a,i.zpp_inner.outer=i}else{if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var l,u=i.zpp_inner;if(u._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=u._isimmutable&&u._isimmutable(),r!=r||o!=o)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var h=i.zpp_inner;if(null!=h._validate&&h._validate(),i.zpp_inner.x==r){if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var c=i.zpp_inner;null!=c._validate&&c._validate(),l=i.zpp_inner.y==o}else l=!1;if(!l){i.zpp_inner.x=r,i.zpp_inner.y=o;var _=i.zpp_inner;null!=_._invalidate&&_._invalidate(_)}}i.zpp_inner.weak=!1,this.zpp_inner.wrap_worldCOM=i,this.zpp_inner.wrap_worldCOM.zpp_inner._inuse=!0,this.zpp_inner.wrap_worldCOM.zpp_inner._immutable=!0,this.zpp_inner.wrap_worldCOM.zpp_inner._validate=p(s=this.zpp_inner,s.getworldCOM)}return this.zpp_inner.wrap_worldCOM},Object.defineProperty(e.shape.Shape.prototype,"localCOM",{get:e.shape.Shape.prototype.get_localCOM,set:e.shape.Shape.prototype.set_localCOM}),e.shape.Shape.prototype.get_localCOM=function(){return null==this.zpp_inner.wrap_localCOM&&(0==this.zpp_inner.type?this.zpp_inner.circle.setupLocalCOM():this.zpp_inner.polygon.setupLocalCOM()),this.zpp_inner.wrap_localCOM},e.shape.Shape.prototype.set_localCOM=function(e){if(this.zpp_inner.immutable_midstep("Body::localCOM"),null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");if(null!=this.zpp_inner.body&&null!=this.zpp_inner.body.space&&1==this.zpp_inner.body.type)throw new n._Boot.HaxeError("Error: Cannot modify Shape belonging to a static Object once inside a Space");if(null==e)throw new n._Boot.HaxeError("Error: Shape::localCOM cannot be null");null==this.zpp_inner.wrap_localCOM&&(0==this.zpp_inner.type?this.zpp_inner.circle.setupLocalCOM():this.zpp_inner.polygon.setupLocalCOM());var i=this.zpp_inner.wrap_localCOM;if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var r=i.zpp_inner;if(r._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=r._isimmutable&&r._isimmutable(),null==e)throw new n._Boot.HaxeError("Error: Cannot assign null Vec2");if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var o=e.zpp_inner;null!=o._validate&&o._validate();var a=e.zpp_inner.x;if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var s=e.zpp_inner;null!=s._validate&&s._validate();var l=e.zpp_inner.y;if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var p,u=i.zpp_inner;if(u._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=u._isimmutable&&u._isimmutable(),a!=a||l!=l)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var h=i.zpp_inner;if(null!=h._validate&&h._validate(),i.zpp_inner.x==a){if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var c=i.zpp_inner;null!=c._validate&&c._validate(),p=i.zpp_inner.y==l}else p=!1;if(!p){i.zpp_inner.x=a,i.zpp_inner.y=l;var _=i.zpp_inner;null!=_._invalidate&&_._invalidate(_)}if(e.zpp_inner.weak){if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var d=e.zpp_inner;if(d._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=d._isimmutable&&d._isimmutable(),e.zpp_inner._inuse)throw new n._Boot.HaxeError("Error: This Vec2 is not disposable");var m=e.zpp_inner;e.zpp_inner.outer=null,e.zpp_inner=null;var P=e;P.zpp_pool=null,null!=t.util.ZPP_PubPool.nextVec2?t.util.ZPP_PubPool.nextVec2.zpp_pool=P:t.util.ZPP_PubPool.poolVec2=P,t.util.ZPP_PubPool.nextVec2=P,P.zpp_disp=!0;var f=m;null!=f.outer&&(f.outer.zpp_inner=null,f.outer=null),f._isimmutable=null,f._validate=null,f._invalidate=null,f.next=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=f}return null==this.zpp_inner.wrap_localCOM&&(0==this.zpp_inner.type?this.zpp_inner.circle.setupLocalCOM():this.zpp_inner.polygon.setupLocalCOM()),this.zpp_inner.wrap_localCOM},Object.defineProperty(e.shape.Shape.prototype,"area",{get:e.shape.Shape.prototype.get_area}),e.shape.Shape.prototype.get_area=function(){return this.zpp_inner.validate_area_inertia(),this.zpp_inner.area},Object.defineProperty(e.shape.Shape.prototype,"inertia",{get:e.shape.Shape.prototype.get_inertia}),e.shape.Shape.prototype.get_inertia=function(){return this.zpp_inner.validate_area_inertia(),this.zpp_inner.inertia},Object.defineProperty(e.shape.Shape.prototype,"angDrag",{get:e.shape.Shape.prototype.get_angDrag}),e.shape.Shape.prototype.get_angDrag=function(){return this.zpp_inner.validate_angDrag(),this.zpp_inner.angDrag},Object.defineProperty(e.shape.Shape.prototype,"material",{get:e.shape.Shape.prototype.get_material,set:e.shape.Shape.prototype.set_material}),e.shape.Shape.prototype.get_material=function(){return this.zpp_inner.material.wrapper()},e.shape.Shape.prototype.set_material=function(e){if(this.zpp_inner.immutable_midstep("Shape::material"),null==e)throw new n._Boot.HaxeError("Error: Cannot assign null as Shape material");return this.zpp_inner.setMaterial(e.zpp_inner),this.zpp_inner.material.wrapper()},Object.defineProperty(e.shape.Shape.prototype,"filter",{get:e.shape.Shape.prototype.get_filter,set:e.shape.Shape.prototype.set_filter}),e.shape.Shape.prototype.get_filter=function(){return this.zpp_inner.filter.wrapper()},e.shape.Shape.prototype.set_filter=function(e){if(this.zpp_inner.immutable_midstep("Shape::filter"),null==e)throw new n._Boot.HaxeError("Error: Cannot assign null as Shape filter");return this.zpp_inner.setFilter(e.zpp_inner),this.zpp_inner.filter.wrapper()},Object.defineProperty(e.shape.Shape.prototype,"fluidProperties",{get:e.shape.Shape.prototype.get_fluidProperties,set:e.shape.Shape.prototype.set_fluidProperties}),e.shape.Shape.prototype.get_fluidProperties=function(){return this.zpp_inner.immutable_midstep("Shape::fluidProperties"),null==this.zpp_inner.fluidProperties&&this.zpp_inner.setFluid((new e.phys.FluidProperties).zpp_inner),this.zpp_inner.fluidProperties.wrapper()},e.shape.Shape.prototype.set_fluidProperties=function(t){if(null==t)throw new n._Boot.HaxeError("Error: Cannot assign null as Shape fluidProperties, disable fluids by setting fluidEnabled to false");return this.zpp_inner.setFluid(t.zpp_inner),this.zpp_inner.immutable_midstep("Shape::fluidProperties"),null==this.zpp_inner.fluidProperties&&this.zpp_inner.setFluid((new e.phys.FluidProperties).zpp_inner),this.zpp_inner.fluidProperties.wrapper()},Object.defineProperty(e.shape.Shape.prototype,"fluidEnabled",{get:e.shape.Shape.prototype.get_fluidEnabled,set:e.shape.Shape.prototype.set_fluidEnabled}),e.shape.Shape.prototype.get_fluidEnabled=function(){return this.zpp_inner.fluidEnabled},e.shape.Shape.prototype.set_fluidEnabled=function(t){if(this.zpp_inner.immutable_midstep("Shape::fluidEnabled"),this.zpp_inner.fluidEnabled=t,t&&null==this.zpp_inner.fluidProperties){var i=new e.phys.FluidProperties;if(null==i)throw new n._Boot.HaxeError("Error: Cannot assign null as Shape fluidProperties, disable fluids by setting fluidEnabled to false");this.zpp_inner.setFluid(i.zpp_inner),this.zpp_inner.immutable_midstep("Shape::fluidProperties"),null==this.zpp_inner.fluidProperties&&this.zpp_inner.setFluid((new e.phys.FluidProperties).zpp_inner),this.zpp_inner.fluidProperties.wrapper()}return this.zpp_inner.wake(),this.zpp_inner.fluidEnabled},Object.defineProperty(e.shape.Shape.prototype,"sensorEnabled",{get:e.shape.Shape.prototype.get_sensorEnabled,set:e.shape.Shape.prototype.set_sensorEnabled}),e.shape.Shape.prototype.get_sensorEnabled=function(){return this.zpp_inner.sensorEnabled},e.shape.Shape.prototype.set_sensorEnabled=function(e){return this.zpp_inner.immutable_midstep("Shape::sensorEnabled"),this.zpp_inner.sensorEnabled=e,this.zpp_inner.wake(),this.zpp_inner.sensorEnabled},Object.defineProperty(e.shape.Shape.prototype,"bounds",{get:e.shape.Shape.prototype.get_bounds}),e.shape.Shape.prototype.get_bounds=function(){return this.zpp_inner.aabb.wrapper()},e.shape.Shape.prototype.translate=function(e){if(this.zpp_inner.immutable_midstep("Shape::translate()"),null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");if(null!=this.zpp_inner.body&&null!=this.zpp_inner.body.space&&1==this.zpp_inner.body.type)throw new n._Boot.HaxeError("Error: Cannot modify Shape belonging to a static Object once inside a Space");if(null==e)throw new n._Boot.HaxeError("Error: Cannot displace Shape by null Vec2");if(e.lsq()>0)if(0==this.zpp_inner.type){var i=this.zpp_inner.circle;if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var r=e.zpp_inner;null!=r._validate&&r._validate();var o=e.zpp_inner.x;if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var a=e.zpp_inner;null!=a._validate&&a._validate(),i.__translate(o,e.zpp_inner.y)}else{var s=this.zpp_inner.polygon;if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var l=e.zpp_inner;null!=l._validate&&l._validate();var p=e.zpp_inner.x;if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var u=e.zpp_inner;null!=u._validate&&u._validate(),s.__translate(p,e.zpp_inner.y)}if(e.zpp_inner.weak){if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var h=e.zpp_inner;if(h._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=h._isimmutable&&h._isimmutable(),e.zpp_inner._inuse)throw new n._Boot.HaxeError("Error: This Vec2 is not disposable");var c=e.zpp_inner;e.zpp_inner.outer=null,e.zpp_inner=null;var _=e;_.zpp_pool=null,null!=t.util.ZPP_PubPool.nextVec2?t.util.ZPP_PubPool.nextVec2.zpp_pool=_:t.util.ZPP_PubPool.poolVec2=_,t.util.ZPP_PubPool.nextVec2=_,_.zpp_disp=!0;var d=c;null!=d.outer&&(d.outer.zpp_inner=null,d.outer=null),d._isimmutable=null,d._validate=null,d._invalidate=null,d.next=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=d}return this},e.shape.Shape.prototype.scale=function(t,i){if(this.zpp_inner.immutable_midstep("Shape::scale()"),null!=this.zpp_inner.body&&null!=this.zpp_inner.body.space&&1==this.zpp_inner.body.type)throw new n._Boot.HaxeError("Error: Cannot modify Shape belonging to a static Object once inside a Space");if(t!=t||i!=i)throw new n._Boot.HaxeError("Error: Cannot scale Shape by NaN");if(0==t||0==i)throw new n._Boot.HaxeError("Error: Cannot Scale shape by a factor of 0");if(0==this.zpp_inner.type){var r=t*t-i*i;if(!(r*r<e.Config.epsilon*e.Config.epsilon))throw new n._Boot.HaxeError("Error: Cannot perform a non equal scaling on a Circle");this.zpp_inner.circle.__scale(t,i)}else this.zpp_inner.polygon.__scale(t,i);return this},e.shape.Shape.prototype.rotate=function(e){if(this.zpp_inner.immutable_midstep("Shape::rotate()"),null!=this.zpp_inner.body&&null!=this.zpp_inner.body.space&&1==this.zpp_inner.body.type)throw new n._Boot.HaxeError("Error: Cannot modify Shape belonging to a static Object once inside a Space");if(e!=e)throw new n._Boot.HaxeError("Error: Cannot rotate Shape by NaN");if(0!=e%(2*Math.PI)){var t=Math.cos(e),i=Math.sin(e);0==this.zpp_inner.type?this.zpp_inner.circle.__rotate(i,t):this.zpp_inner.polygon.__rotate(i,t)}return this},e.shape.Shape.prototype.transform=function(e){if(this.zpp_inner.immutable_midstep("Shape::transform()"),null!=this.zpp_inner.body&&null!=this.zpp_inner.body.space&&1==this.zpp_inner.body.type)throw new n._Boot.HaxeError("Error: Cannot modify Shape belonging to a static Object once inside a Space");if(null==e)throw new n._Boot.HaxeError("Error: Cannot transform Shape by null matrix");if(e.singular())throw new n._Boot.HaxeError("Error: Cannot transform Shape by a singular matrix");if(0==this.zpp_inner.type){if(!e.equiorthogonal())throw new n._Boot.HaxeError("Error: Cannot transform Circle by a non equiorthogonal matrix");this.zpp_inner.circle.__transform(e)}else this.zpp_inner.polygon.__transform(e);return this},e.shape.Shape.prototype.contains=function(e){if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");if(null==e)throw new n._Boot.HaxeError("Cannot check null point for containment");if(null==(null!=this.zpp_inner.body?this.zpp_inner.body.outer:null))throw new n._Boot.HaxeError("Error: Shape is not well defined without a Body");t.geom.ZPP_Geom.validateShape(this.zpp_inner);var i=e.zpp_inner;null!=i._validate&&i._validate();var r=t.geom.ZPP_Collide.shapeContains(this.zpp_inner,e.zpp_inner);if(e.zpp_inner.weak){if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var o=e.zpp_inner;if(o._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=o._isimmutable&&o._isimmutable(),e.zpp_inner._inuse)throw new n._Boot.HaxeError("Error: This Vec2 is not disposable");var a=e.zpp_inner;e.zpp_inner.outer=null,e.zpp_inner=null;var s=e;s.zpp_pool=null,null!=t.util.ZPP_PubPool.nextVec2?t.util.ZPP_PubPool.nextVec2.zpp_pool=s:t.util.ZPP_PubPool.poolVec2=s,t.util.ZPP_PubPool.nextVec2=s,s.zpp_disp=!0;var l=a;null!=l.outer&&(l.outer.zpp_inner=null,l.outer=null),l._isimmutable=null,l._validate=null,l._invalidate=null,l.next=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=l}return r},e.shape.Shape.prototype.copy=function(){return this.zpp_inner.copy()},e.shape.Shape.prototype.toString=function(){return(0==this.zpp_inner.type?"Circle":"Polygon")+"#"+this.zpp_inner_i.id},e.shape.Shape.prototype.__class__=e.shape.Shape,e.shape.Circle=l["nape.shape.Circle"]=function(i,r,o,a){if(this.zpp_inner_zn=null,e.shape.Shape.zpp_internalAlloc=!0,e.shape.Shape.call(this),e.shape.Shape.zpp_internalAlloc=!1,this.zpp_inner_zn=new t.shape.ZPP_Circle,this.zpp_inner_zn.outer=this,this.zpp_inner_zn.outer_zn=this,this.zpp_inner=this.zpp_inner_zn,this.zpp_inner_i=this.zpp_inner,this.zpp_inner_i.outer_i=this,this.zpp_inner.immutable_midstep("Circle::radius"),null!=this.zpp_inner.body&&1==this.zpp_inner.body.type&&null!=this.zpp_inner.body.space)throw new n._Boot.HaxeError("Error: Cannot modifiy radius of Circle contained in static object once added to space");if(i!=this.zpp_inner_zn.radius){if(i!=i)throw new n._Boot.HaxeError("Error: Circle::radius cannot be NaN");if(i<e.Config.epsilon)throw new n._Boot.HaxeError("Error: Circle::radius ("+i+") must be > Config.epsilon");if(i>1e100)throw new n._Boot.HaxeError("Error: Circle::radius ("+i+") must be < PR(Const).FMAX");this.zpp_inner_zn.radius=i,this.zpp_inner_zn.invalidate_radius()}if(null==r)this.zpp_inner.localCOMx=0,this.zpp_inner.localCOMy=0;else{if(null!=r&&r.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");if(null!=r&&r.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var s=r.zpp_inner;if(null!=s._validate&&s._validate(),this.zpp_inner.localCOMx=r.zpp_inner.x,null!=r&&r.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var l=r.zpp_inner;if(null!=l._validate&&l._validate(),this.zpp_inner.localCOMy=r.zpp_inner.y,r.zpp_inner.weak){if(null!=r&&r.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var p=r.zpp_inner;if(p._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=p._isimmutable&&p._isimmutable(),r.zpp_inner._inuse)throw new n._Boot.HaxeError("Error: This Vec2 is not disposable");var u=r.zpp_inner;r.zpp_inner.outer=null,r.zpp_inner=null;var h=r;h.zpp_pool=null,null!=t.util.ZPP_PubPool.nextVec2?t.util.ZPP_PubPool.nextVec2.zpp_pool=h:t.util.ZPP_PubPool.poolVec2=h,t.util.ZPP_PubPool.nextVec2=h,h.zpp_disp=!0;var c=u;null!=c.outer&&(c.outer.zpp_inner=null,c.outer=null),c._isimmutable=null,c._validate=null,c._invalidate=null,c.next=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=c}}if(null==o)null==t.phys.ZPP_Material.zpp_pool?this.zpp_inner.material=new t.phys.ZPP_Material:(this.zpp_inner.material=t.phys.ZPP_Material.zpp_pool,t.phys.ZPP_Material.zpp_pool=this.zpp_inner.material.next,this.zpp_inner.material.next=null);else{if(this.zpp_inner.immutable_midstep("Shape::material"),null==o)throw new n._Boot.HaxeError("Error: Cannot assign null as Shape material");this.zpp_inner.setMaterial(o.zpp_inner),this.zpp_inner.material.wrapper()}if(null==a)null==t.dynamics.ZPP_InteractionFilter.zpp_pool?this.zpp_inner.filter=new t.dynamics.ZPP_InteractionFilter:(this.zpp_inner.filter=t.dynamics.ZPP_InteractionFilter.zpp_pool,t.dynamics.ZPP_InteractionFilter.zpp_pool=this.zpp_inner.filter.next,this.zpp_inner.filter.next=null);else{if(this.zpp_inner.immutable_midstep("Shape::filter"),null==a)throw new n._Boot.HaxeError("Error: Cannot assign null as Shape filter");this.zpp_inner.setFilter(a.zpp_inner),this.zpp_inner.filter.wrapper()}this.zpp_inner_i.insert_cbtype(t.callbacks.ZPP_CbType.ANY_SHAPE.zpp_inner)},e.shape.Circle.__name__=["nape","shape","Circle"],e.shape.Circle.__super__=e.shape.Shape,e.shape.Shape.prototype)e.shape.Circle.prototype[u]=e.shape.Shape.prototype[u];for(var u in e.shape.Circle.prototype.zpp_inner_zn=null,Object.defineProperty(e.shape.Circle.prototype,"radius",{get:e.shape.Circle.prototype.get_radius,set:e.shape.Circle.prototype.set_radius}),e.shape.Circle.prototype.get_radius=function(){return this.zpp_inner_zn.radius},e.shape.Circle.prototype.set_radius=function(t){if(this.zpp_inner.immutable_midstep("Circle::radius"),null!=this.zpp_inner.body&&1==this.zpp_inner.body.type&&null!=this.zpp_inner.body.space)throw new n._Boot.HaxeError("Error: Cannot modifiy radius of Circle contained in static object once added to space");if(t!=this.zpp_inner_zn.radius){if(t!=t)throw new n._Boot.HaxeError("Error: Circle::radius cannot be NaN");if(t<e.Config.epsilon)throw new n._Boot.HaxeError("Error: Circle::radius ("+t+") must be > Config.epsilon");if(t>1e100)throw new n._Boot.HaxeError("Error: Circle::radius ("+t+") must be < PR(Const).FMAX");this.zpp_inner_zn.radius=t,this.zpp_inner_zn.invalidate_radius()}return this.zpp_inner_zn.radius},e.shape.Circle.prototype.__class__=e.shape.Circle,e.shape.Edge=l["nape.shape.Edge"]=function(){if(this.zpp_inner=null,!t.shape.ZPP_Edge.internal)throw new n._Boot.HaxeError("Error: Cannot instantiate an Edge derp!")},e.shape.Edge.__name__=["nape","shape","Edge"],e.shape.Edge.prototype.zpp_inner=null,Object.defineProperty(e.shape.Edge.prototype,"polygon",{get:e.shape.Edge.prototype.get_polygon}),e.shape.Edge.prototype.get_polygon=function(){if(null==this.zpp_inner.polygon)throw new n._Boot.HaxeError("Error: Edge not current in use");return this.zpp_inner.polygon.outer_zn},Object.defineProperty(e.shape.Edge.prototype,"localNormal",{get:e.shape.Edge.prototype.get_localNormal}),e.shape.Edge.prototype.get_localNormal=function(){if(null==this.zpp_inner.polygon)throw new n._Boot.HaxeError("Error: Edge not current in use");return null==this.zpp_inner.wrap_lnorm&&this.zpp_inner.getlnorm(),this.zpp_inner.wrap_lnorm},Object.defineProperty(e.shape.Edge.prototype,"worldNormal",{get:e.shape.Edge.prototype.get_worldNormal}),e.shape.Edge.prototype.get_worldNormal=function(){if(null==this.zpp_inner.polygon)throw new n._Boot.HaxeError("Error: Edge not current in use");return null==this.zpp_inner.wrap_gnorm&&this.zpp_inner.getgnorm(),this.zpp_inner.wrap_gnorm},Object.defineProperty(e.shape.Edge.prototype,"length",{get:e.shape.Edge.prototype.get_length}),e.shape.Edge.prototype.get_length=function(){if(null==this.zpp_inner.polygon)throw new n._Boot.HaxeError("Error: Edge not current in use");return this.zpp_inner.polygon.validate_laxi(),this.zpp_inner.length},Object.defineProperty(e.shape.Edge.prototype,"localProjection",{get:e.shape.Edge.prototype.get_localProjection}),e.shape.Edge.prototype.get_localProjection=function(){if(null==this.zpp_inner.polygon)throw new n._Boot.HaxeError("Error: Edge not current in use");return this.zpp_inner.polygon.validate_laxi(),this.zpp_inner.lprojection},Object.defineProperty(e.shape.Edge.prototype,"worldProjection",{get:e.shape.Edge.prototype.get_worldProjection}),e.shape.Edge.prototype.get_worldProjection=function(){if(null==this.zpp_inner.polygon)throw new n._Boot.HaxeError("Error: Edge not current in use");if(null==this.zpp_inner.polygon.body)throw new n._Boot.HaxeError("Error: Edge world projection only makes sense for Polygons contained within a rigid body");var e=this.zpp_inner.polygon;if(e.zip_gaxi&&null!=e.body){e.zip_gaxi=!1,e.validate_laxi();var t=e.body;if(t.zip_axis&&(t.zip_axis=!1,t.axisx=Math.sin(t.rot),t.axisy=Math.cos(t.rot)),e.zip_gverts&&null!=e.body){e.zip_gverts=!1,e.validate_lverts();var i=e.body;i.zip_axis&&(i.zip_axis=!1,i.axisx=Math.sin(i.rot),i.axisy=Math.cos(i.rot));for(var r=e.lverts.next,o=e.gverts.next;null!=o;){var a=o,s=r;r=r.next,a.x=e.body.posx+(e.body.axisy*s.x-e.body.axisx*s.y),a.y=e.body.posy+(s.x*e.body.axisx+s.y*e.body.axisy),o=o.next}}var l=e.edges.head,p=e.gverts.next,u=p;for(p=p.next;null!=p;){var h=p,c=l.elt;l=l.next,c.gp0=u,c.gp1=h,c.gnormx=e.body.axisy*c.lnormx-e.body.axisx*c.lnormy,c.gnormy=c.lnormx*e.body.axisx+c.lnormy*e.body.axisy,c.gprojection=e.body.posx*c.gnormx+e.body.posy*c.gnormy+c.lprojection,null!=c.wrap_gnorm&&(c.wrap_gnorm.zpp_inner.x=c.gnormx,c.wrap_gnorm.zpp_inner.y=c.gnormy),c.tp0=c.gp0.y*c.gnormx-c.gp0.x*c.gnormy,c.tp1=c.gp1.y*c.gnormx-c.gp1.x*c.gnormy,u=h,p=p.next}var _=e.gverts.next,d=l.elt;l=l.next,d.gp0=u,d.gp1=_,d.gnormx=e.body.axisy*d.lnormx-e.body.axisx*d.lnormy,d.gnormy=d.lnormx*e.body.axisx+d.lnormy*e.body.axisy,d.gprojection=e.body.posx*d.gnormx+e.body.posy*d.gnormy+d.lprojection,null!=d.wrap_gnorm&&(d.wrap_gnorm.zpp_inner.x=d.gnormx,d.wrap_gnorm.zpp_inner.y=d.gnormy),d.tp0=d.gp0.y*d.gnormx-d.gp0.x*d.gnormy,d.tp1=d.gp1.y*d.gnormx-d.gp1.x*d.gnormy}return this.zpp_inner.gprojection},Object.defineProperty(e.shape.Edge.prototype,"localVertex1",{get:e.shape.Edge.prototype.get_localVertex1}),e.shape.Edge.prototype.get_localVertex1=function(){if(null==this.zpp_inner.polygon)throw new n._Boot.HaxeError("Error: Edge not current in use");this.zpp_inner.polygon.validate_laxi();var i=this.zpp_inner.lp0;if(null==i.outer){i.outer=new e.geom.Vec2;var r=i.outer.zpp_inner;null!=r.outer&&(r.outer.zpp_inner=null,r.outer=null),r._isimmutable=null,r._validate=null,r._invalidate=null,r.next=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=r,i.outer.zpp_inner=i}return i.outer},Object.defineProperty(e.shape.Edge.prototype,"localVertex2",{get:e.shape.Edge.prototype.get_localVertex2}),e.shape.Edge.prototype.get_localVertex2=function(){if(null==this.zpp_inner.polygon)throw new n._Boot.HaxeError("Error: Edge not current in use");this.zpp_inner.polygon.validate_laxi();var i=this.zpp_inner.lp1;if(null==i.outer){i.outer=new e.geom.Vec2;var r=i.outer.zpp_inner;null!=r.outer&&(r.outer.zpp_inner=null,r.outer=null),r._isimmutable=null,r._validate=null,r._invalidate=null,r.next=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=r,i.outer.zpp_inner=i}return i.outer},Object.defineProperty(e.shape.Edge.prototype,"worldVertex1",{get:e.shape.Edge.prototype.get_worldVertex1}),e.shape.Edge.prototype.get_worldVertex1=function(){if(null==this.zpp_inner.polygon)throw new n._Boot.HaxeError("Error: Edge not current in use");var i=this.zpp_inner.polygon;if(i.zip_gaxi&&null!=i.body){i.zip_gaxi=!1,i.validate_laxi();var r=i.body;if(r.zip_axis&&(r.zip_axis=!1,r.axisx=Math.sin(r.rot),r.axisy=Math.cos(r.rot)),i.zip_gverts&&null!=i.body){i.zip_gverts=!1,i.validate_lverts();var o=i.body;o.zip_axis&&(o.zip_axis=!1,o.axisx=Math.sin(o.rot),o.axisy=Math.cos(o.rot));for(var a=i.lverts.next,s=i.gverts.next;null!=s;){var l=s,p=a;a=a.next,l.x=i.body.posx+(i.body.axisy*p.x-i.body.axisx*p.y),l.y=i.body.posy+(p.x*i.body.axisx+p.y*i.body.axisy),s=s.next}}var u=i.edges.head,h=i.gverts.next,c=h;for(h=h.next;null!=h;){var _=h,d=u.elt;u=u.next,d.gp0=c,d.gp1=_,d.gnormx=i.body.axisy*d.lnormx-i.body.axisx*d.lnormy,d.gnormy=d.lnormx*i.body.axisx+d.lnormy*i.body.axisy,d.gprojection=i.body.posx*d.gnormx+i.body.posy*d.gnormy+d.lprojection,null!=d.wrap_gnorm&&(d.wrap_gnorm.zpp_inner.x=d.gnormx,d.wrap_gnorm.zpp_inner.y=d.gnormy),d.tp0=d.gp0.y*d.gnormx-d.gp0.x*d.gnormy,d.tp1=d.gp1.y*d.gnormx-d.gp1.x*d.gnormy,c=_,h=h.next}var m=i.gverts.next,P=u.elt;u=u.next,P.gp0=c,P.gp1=m,P.gnormx=i.body.axisy*P.lnormx-i.body.axisx*P.lnormy,P.gnormy=P.lnormx*i.body.axisx+P.lnormy*i.body.axisy,P.gprojection=i.body.posx*P.gnormx+i.body.posy*P.gnormy+P.lprojection,null!=P.wrap_gnorm&&(P.wrap_gnorm.zpp_inner.x=P.gnormx,P.wrap_gnorm.zpp_inner.y=P.gnormy),P.tp0=P.gp0.y*P.gnormx-P.gp0.x*P.gnormy,P.tp1=P.gp1.y*P.gnormx-P.gp1.x*P.gnormy}var f=this.zpp_inner.gp0;if(null==f.outer){f.outer=new e.geom.Vec2;var x=f.outer.zpp_inner;null!=x.outer&&(x.outer.zpp_inner=null,x.outer=null),x._isimmutable=null,x._validate=null,x._invalidate=null,x.next=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=x,f.outer.zpp_inner=f}return f.outer},Object.defineProperty(e.shape.Edge.prototype,"worldVertex2",{get:e.shape.Edge.prototype.get_worldVertex2}),e.shape.Edge.prototype.get_worldVertex2=function(){if(null==this.zpp_inner.polygon)throw new n._Boot.HaxeError("Error: Edge not current in use");var i=this.zpp_inner.polygon;if(i.zip_gaxi&&null!=i.body){i.zip_gaxi=!1,i.validate_laxi();var r=i.body;if(r.zip_axis&&(r.zip_axis=!1,r.axisx=Math.sin(r.rot),r.axisy=Math.cos(r.rot)),i.zip_gverts&&null!=i.body){i.zip_gverts=!1,i.validate_lverts();var o=i.body;o.zip_axis&&(o.zip_axis=!1,o.axisx=Math.sin(o.rot),o.axisy=Math.cos(o.rot));for(var a=i.lverts.next,s=i.gverts.next;null!=s;){var l=s,p=a;a=a.next,l.x=i.body.posx+(i.body.axisy*p.x-i.body.axisx*p.y),l.y=i.body.posy+(p.x*i.body.axisx+p.y*i.body.axisy),s=s.next}}var u=i.edges.head,h=i.gverts.next,c=h;for(h=h.next;null!=h;){var _=h,d=u.elt;u=u.next,d.gp0=c,d.gp1=_,d.gnormx=i.body.axisy*d.lnormx-i.body.axisx*d.lnormy,d.gnormy=d.lnormx*i.body.axisx+d.lnormy*i.body.axisy,d.gprojection=i.body.posx*d.gnormx+i.body.posy*d.gnormy+d.lprojection,null!=d.wrap_gnorm&&(d.wrap_gnorm.zpp_inner.x=d.gnormx,d.wrap_gnorm.zpp_inner.y=d.gnormy),d.tp0=d.gp0.y*d.gnormx-d.gp0.x*d.gnormy,d.tp1=d.gp1.y*d.gnormx-d.gp1.x*d.gnormy,c=_,h=h.next}var m=i.gverts.next,P=u.elt;u=u.next,P.gp0=c,P.gp1=m,P.gnormx=i.body.axisy*P.lnormx-i.body.axisx*P.lnormy,P.gnormy=P.lnormx*i.body.axisx+P.lnormy*i.body.axisy,P.gprojection=i.body.posx*P.gnormx+i.body.posy*P.gnormy+P.lprojection,null!=P.wrap_gnorm&&(P.wrap_gnorm.zpp_inner.x=P.gnormx,P.wrap_gnorm.zpp_inner.y=P.gnormy),P.tp0=P.gp0.y*P.gnormx-P.gp0.x*P.gnormy,P.tp1=P.gp1.y*P.gnormx-P.gp1.x*P.gnormy}var f=this.zpp_inner.gp1;if(null==f.outer){f.outer=new e.geom.Vec2;var x=f.outer.zpp_inner;null!=x.outer&&(x.outer.zpp_inner=null,x.outer=null),x._isimmutable=null,x._validate=null,x._invalidate=null,x.next=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=x,f.outer.zpp_inner=f}return f.outer},e.shape.Edge.prototype.toString=function(){if(null==this.zpp_inner.polygon)return"Edge(object-pooled)";if(null==this.zpp_inner.polygon.body)return this.zpp_inner.polygon.validate_laxi(),"{ localNormal : { x: "+this.zpp_inner.lnormx+" y: "+this.zpp_inner.lnormy+" } }";var e=this.zpp_inner.polygon;if(e.zip_gaxi&&null!=e.body){e.zip_gaxi=!1,e.validate_laxi();var t=e.body;if(t.zip_axis&&(t.zip_axis=!1,t.axisx=Math.sin(t.rot),t.axisy=Math.cos(t.rot)),e.zip_gverts&&null!=e.body){e.zip_gverts=!1,e.validate_lverts();var n=e.body;n.zip_axis&&(n.zip_axis=!1,n.axisx=Math.sin(n.rot),n.axisy=Math.cos(n.rot));for(var i=e.lverts.next,r=e.gverts.next;null!=r;){var o=r,a=i;i=i.next,o.x=e.body.posx+(e.body.axisy*a.x-e.body.axisx*a.y),o.y=e.body.posy+(a.x*e.body.axisx+a.y*e.body.axisy),r=r.next}}var s=e.edges.head,l=e.gverts.next,p=l;for(l=l.next;null!=l;){var u=l,h=s.elt;s=s.next,h.gp0=p,h.gp1=u,h.gnormx=e.body.axisy*h.lnormx-e.body.axisx*h.lnormy,h.gnormy=h.lnormx*e.body.axisx+h.lnormy*e.body.axisy,h.gprojection=e.body.posx*h.gnormx+e.body.posy*h.gnormy+h.lprojection,null!=h.wrap_gnorm&&(h.wrap_gnorm.zpp_inner.x=h.gnormx,h.wrap_gnorm.zpp_inner.y=h.gnormy),h.tp0=h.gp0.y*h.gnormx-h.gp0.x*h.gnormy,h.tp1=h.gp1.y*h.gnormx-h.gp1.x*h.gnormy,p=u,l=l.next}var c=e.gverts.next,_=s.elt;s=s.next,_.gp0=p,_.gp1=c,_.gnormx=e.body.axisy*_.lnormx-e.body.axisx*_.lnormy,_.gnormy=_.lnormx*e.body.axisx+_.lnormy*e.body.axisy,_.gprojection=e.body.posx*_.gnormx+e.body.posy*_.gnormy+_.lprojection,null!=_.wrap_gnorm&&(_.wrap_gnorm.zpp_inner.x=_.gnormx,_.wrap_gnorm.zpp_inner.y=_.gnormy),_.tp0=_.gp0.y*_.gnormx-_.gp0.x*_.gnormy,_.tp1=_.gp1.y*_.gnormx-_.gp1.x*_.gnormy}return"{ localNormal : { x: "+this.zpp_inner.lnormx+" y: "+this.zpp_inner.lnormy+" } worldNormal : { x: "+this.zpp_inner.gnormx+" y: "+this.zpp_inner.gnormy+" } }"},e.shape.Edge.prototype.__class__=e.shape.Edge,e.shape.EdgeIterator=l["nape.shape.EdgeIterator"]=function(){if(this.zpp_next=null,this.zpp_critical=!1,this.zpp_i=0,this.zpp_inner=null,!t.util.ZPP_EdgeList.internal)throw new n._Boot.HaxeError("Error: Cannot instantiate EdgeIterator derp!")},e.shape.EdgeIterator.__name__=["nape","shape","EdgeIterator"],e.shape.EdgeIterator.get=function(n){var i;if(null==e.shape.EdgeIterator.zpp_pool){t.util.ZPP_EdgeList.internal=!0;var r=new e.shape.EdgeIterator;t.util.ZPP_EdgeList.internal=!1,i=r}else{var o=e.shape.EdgeIterator.zpp_pool;e.shape.EdgeIterator.zpp_pool=o.zpp_next,i=o}return i.zpp_i=0,i.zpp_inner=n,i.zpp_critical=!1,i},e.shape.EdgeIterator.prototype.zpp_inner=null,e.shape.EdgeIterator.prototype.zpp_i=null,e.shape.EdgeIterator.prototype.zpp_critical=null,e.shape.EdgeIterator.prototype.zpp_next=null,e.shape.EdgeIterator.prototype.hasNext=function(){this.zpp_inner.zpp_inner.valmod();var t=this.zpp_inner;t.zpp_inner.valmod(),t.zpp_inner.zip_length&&(t.zpp_inner.zip_length=!1,t.zpp_inner.user_length=t.zpp_inner.inner.length);var n=t.zpp_inner.user_length;return this.zpp_critical=!0,this.zpp_i<n||(this.zpp_next=e.shape.EdgeIterator.zpp_pool,e.shape.EdgeIterator.zpp_pool=this,this.zpp_inner=null,!1)},e.shape.EdgeIterator.prototype.next=function(){return this.zpp_critical=!1,this.zpp_inner.at(this.zpp_i++)},e.shape.EdgeIterator.prototype.__class__=e.shape.EdgeIterator,e.shape.EdgeList=l["nape.shape.EdgeList"]=function(){this.zpp_inner=null,this.zpp_inner=new t.util.ZPP_EdgeList,this.zpp_inner.outer=this},e.shape.EdgeList.__name__=["nape","shape","EdgeList"],e.shape.EdgeList.fromArray=function(t){if(null==t)throw new n._Boot.HaxeError("Error: Cannot convert null Array to Nape list");for(var i=new e.shape.EdgeList,r=0;r<t.length;){var o=t[r];++r,i.push(o)}return i},e.shape.EdgeList.prototype.zpp_inner=null,Object.defineProperty(e.shape.EdgeList.prototype,"length",{get:e.shape.EdgeList.prototype.get_length}),e.shape.EdgeList.prototype.get_length=function(){return this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.user_length},e.shape.EdgeList.prototype.has=function(e){return this.zpp_inner.valmod(),this.zpp_inner.inner.has(e.zpp_inner)},e.shape.EdgeList.prototype.at=function(e){var t;if(this.zpp_inner.valmod(),e>=0?(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t=e>=this.zpp_inner.user_length):t=!0,t)throw new n._Boot.HaxeError("Error: Index out of bounds");if(this.zpp_inner.reverse_flag&&(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),e==this.zpp_inner.user_length-1?e=e:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),e=this.zpp_inner.user_length-2-e)),e<this.zpp_inner.at_index||null==this.zpp_inner.at_ite)this.zpp_inner.at_index=e,this.zpp_inner.at_ite=this.zpp_inner.inner.iterator_at(e);else for(;this.zpp_inner.at_index!=e;)this.zpp_inner.at_index++,this.zpp_inner.at_ite=this.zpp_inner.at_ite.next;return this.zpp_inner.at_ite.elt.wrapper()},e.shape.EdgeList.prototype.push=function(e){if(this.zpp_inner.immutable)throw new n._Boot.HaxeError("Error: EdgeList is immutable");this.zpp_inner.modify_test(),this.zpp_inner.valmod();var t=null==this.zpp_inner.adder||this.zpp_inner.adder(e);if(t){if(this.zpp_inner.reverse_flag)this.zpp_inner.inner.add(e.zpp_inner);else{if(null==this.zpp_inner.push_ite){var i;if(null==this.zpp_inner.inner.head)i=null;else{var r=this.zpp_inner.inner;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),i=r.iterator_at(this.zpp_inner.user_length-1)}this.zpp_inner.push_ite=i}this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,e.zpp_inner)}this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(e)}return t},e.shape.EdgeList.prototype.unshift=function(e){if(this.zpp_inner.immutable)throw new n._Boot.HaxeError("Error: EdgeList is immutable");this.zpp_inner.modify_test(),this.zpp_inner.valmod();var t=null==this.zpp_inner.adder||this.zpp_inner.adder(e);if(t){if(this.zpp_inner.reverse_flag){if(null==this.zpp_inner.push_ite){var i;if(null==this.zpp_inner.inner.head)i=null;else{var r=this.zpp_inner.inner;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),i=r.iterator_at(this.zpp_inner.user_length-1)}this.zpp_inner.push_ite=i}this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,e.zpp_inner)}else this.zpp_inner.inner.add(e.zpp_inner);this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(e)}return t},e.shape.EdgeList.prototype.pop=function(){if(this.zpp_inner.immutable)throw new n._Boot.HaxeError("Error: EdgeList is immutable");if(this.zpp_inner.modify_test(),null==this.zpp_inner.inner.head)throw new n._Boot.HaxeError("Error: Cannot remove from empty list");this.zpp_inner.valmod();var e=null;if(this.zpp_inner.reverse_flag){var t=(e=this.zpp_inner.inner.head.elt).wrapper();null!=this.zpp_inner.subber&&this.zpp_inner.subber(t),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()}else{var i;if(null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null),this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),1==this.zpp_inner.user_length)i=null;else{var r=this.zpp_inner.inner;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),i=r.iterator_at(this.zpp_inner.user_length-2)}var o=(e=null==i?this.zpp_inner.inner.head.elt:i.next.elt).wrapper();null!=this.zpp_inner.subber&&this.zpp_inner.subber(o),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(i)}return this.zpp_inner.invalidate(),e.wrapper()},e.shape.EdgeList.prototype.shift=function(){if(this.zpp_inner.immutable)throw new n._Boot.HaxeError("Error: EdgeList is immutable");if(this.zpp_inner.modify_test(),null==this.zpp_inner.inner.head)throw new n._Boot.HaxeError("Error: Cannot remove from empty list");this.zpp_inner.valmod();var e=null;if(this.zpp_inner.reverse_flag){var t;if(null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null),this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),1==this.zpp_inner.user_length)t=null;else{var i=this.zpp_inner.inner;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t=i.iterator_at(this.zpp_inner.user_length-2)}var r=(e=null==t?this.zpp_inner.inner.head.elt:t.next.elt).wrapper();null!=this.zpp_inner.subber&&this.zpp_inner.subber(r),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(t)}else{var o=(e=this.zpp_inner.inner.head.elt).wrapper();null!=this.zpp_inner.subber&&this.zpp_inner.subber(o),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()}return this.zpp_inner.invalidate(),e.wrapper()},e.shape.EdgeList.prototype.add=function(e){return this.zpp_inner.reverse_flag?this.push(e):this.unshift(e)},e.shape.EdgeList.prototype.remove=function(e){if(this.zpp_inner.immutable)throw new n._Boot.HaxeError("Error: EdgeList is immutable");var t;this.zpp_inner.modify_test(),this.zpp_inner.valmod(),t=!1;for(var i=this.zpp_inner.inner.head;null!=i;){if(i.elt==e.zpp_inner){t=!0;break}i=i.next}return t&&(null!=this.zpp_inner.subber&&this.zpp_inner.subber(e),this.zpp_inner.dontremove||this.zpp_inner.inner.remove(e.zpp_inner),this.zpp_inner.invalidate()),t},e.shape.EdgeList.prototype.clear=function(){if(this.zpp_inner.immutable)throw new n._Boot.HaxeError("Error: EdgeList is immutable");if(this.zpp_inner.reverse_flag)for(;null!=this.zpp_inner.inner.head;)this.pop();else for(;null!=this.zpp_inner.inner.head;)this.shift()},e.shape.EdgeList.prototype.empty=function(){return null==this.zpp_inner.inner.head},e.shape.EdgeList.prototype.iterator=function(){return this.zpp_inner.valmod(),e.shape.EdgeIterator.get(this)},e.shape.EdgeList.prototype.copy=function(t){null==t&&(t=!1);var i=new e.shape.EdgeList;this.zpp_inner.valmod();for(var r=e.shape.EdgeIterator.get(this);;){r.zpp_inner.zpp_inner.valmod();var o=r.zpp_inner;o.zpp_inner.valmod(),o.zpp_inner.zip_length&&(o.zpp_inner.zip_length=!1,o.zpp_inner.user_length=o.zpp_inner.inner.length);var a,s=o.zpp_inner.user_length;if(r.zpp_critical=!0,r.zpp_i<s?a=!0:(r.zpp_next=e.shape.EdgeIterator.zpp_pool,e.shape.EdgeIterator.zpp_pool=r,r.zpp_inner=null,a=!1),!a)break;r.zpp_critical=!1;var l,p=r.zpp_inner.at(r.zpp_i++);if(t)throw new n._Boot.HaxeError("Error: Edge is not a copyable type");l=p,i.push(l)}return i},e.shape.EdgeList.prototype.merge=function(t){if(null==t)throw new n._Boot.HaxeError("Error: Cannot merge with null list");t.zpp_inner.valmod();for(var i=e.shape.EdgeIterator.get(t);;){i.zpp_inner.zpp_inner.valmod();var r=i.zpp_inner;r.zpp_inner.valmod(),r.zpp_inner.zip_length&&(r.zpp_inner.zip_length=!1,r.zpp_inner.user_length=r.zpp_inner.inner.length);var o,a=r.zpp_inner.user_length;if(i.zpp_critical=!0,i.zpp_i<a?o=!0:(i.zpp_next=e.shape.EdgeIterator.zpp_pool,e.shape.EdgeIterator.zpp_pool=i,i.zpp_inner=null,o=!1),!o)break;i.zpp_critical=!1;var s=i.zpp_inner.at(i.zpp_i++);this.has(s)||(this.zpp_inner.reverse_flag?this.push(s):this.unshift(s))}},e.shape.EdgeList.prototype.toString=function(){var t="[",n=!0;this.zpp_inner.valmod();for(var i=e.shape.EdgeIterator.get(this);;){i.zpp_inner.zpp_inner.valmod();var r=i.zpp_inner;r.zpp_inner.valmod(),r.zpp_inner.zip_length&&(r.zpp_inner.zip_length=!1,r.zpp_inner.user_length=r.zpp_inner.inner.length);var o,a=r.zpp_inner.user_length;if(i.zpp_critical=!0,i.zpp_i<a?o=!0:(i.zpp_next=e.shape.EdgeIterator.zpp_pool,e.shape.EdgeIterator.zpp_pool=i,i.zpp_inner=null,o=!1),!o)break;i.zpp_critical=!1;var s=i.zpp_inner.at(i.zpp_i++);n||(t+=","),t+=null==s?"NULL":s.toString(),n=!1}return t+"]"},e.shape.EdgeList.prototype.foreach=function(t){if(null==t)throw new n._Boot.HaxeError("Error: Cannot execute null on list elements");this.zpp_inner.valmod();for(var i=e.shape.EdgeIterator.get(this);;){i.zpp_inner.zpp_inner.valmod();var r=i.zpp_inner;r.zpp_inner.valmod(),r.zpp_inner.zip_length&&(r.zpp_inner.zip_length=!1,r.zpp_inner.user_length=r.zpp_inner.inner.length);var o,a=r.zpp_inner.user_length;if(i.zpp_critical=!0,i.zpp_i<a?o=!0:(i.zpp_next=e.shape.EdgeIterator.zpp_pool,e.shape.EdgeIterator.zpp_pool=i,i.zpp_inner=null,o=!1),!o)break;try{i.zpp_critical=!1,t(i.zpp_inner.at(i.zpp_i++))}catch(t){t instanceof n._Boot.HaxeError&&t.val,i.zpp_next=e.shape.EdgeIterator.zpp_pool,e.shape.EdgeIterator.zpp_pool=i,i.zpp_inner=null;break}}return this},e.shape.EdgeList.prototype.filter=function(e){if(null==e)throw new n._Boot.HaxeError("Error: Cannot select elements of list with null");for(var t=0;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t<this.zpp_inner.user_length;){var i=this.at(t);try{e(i)?++t:this.remove(i)}catch(e){e instanceof n._Boot.HaxeError&&e.val;break}}return this},e.shape.EdgeList.prototype.__class__=e.shape.EdgeList,e.shape.Polygon=l["nape.shape.Polygon"]=function(i,r,o){if(this.zpp_inner_zn=null,e.shape.Shape.zpp_internalAlloc=!0,e.shape.Shape.call(this),e.shape.Shape.zpp_internalAlloc=!1,null==i)throw new n._Boot.HaxeError("Error: localVerts cannot be null");if(this.zpp_inner_zn=new t.shape.ZPP_Polygon,this.zpp_inner_zn.outer=this,this.zpp_inner_zn.outer_zn=this,this.zpp_inner=this.zpp_inner_zn,this.zpp_inner_i=this.zpp_inner,this.zpp_inner_i.outer_i=this,i instanceof Array)for(var a=i,s=0;s<a.length;){var l=a[s];if(++s,null==l)throw new n._Boot.HaxeError("Error: Array<Vec2> contains null objects");if(!(l instanceof e.geom.Vec2))throw new n._Boot.HaxeError("Error: Array<Vec2> contains non Vec2 objects");var p=l;if(null!=p&&p.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");null==this.zpp_inner_zn.wrap_lverts&&this.zpp_inner_zn.getlverts();var u=this.zpp_inner_zn.wrap_lverts;if(null!=p&&p.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");if(p.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var h=p.zpp_inner;null!=h._validate&&h._validate();var c=p.zpp_inner.x;if(p.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var _=p.zpp_inner;null!=_._validate&&_._validate();var d,m=p.zpp_inner.y,P=!1;if(null==P&&(P=!1),null==m&&(m=0),null==c&&(c=0),c!=c||m!=m)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null==t.util.ZPP_PubPool.poolVec2?d=new e.geom.Vec2:(d=t.util.ZPP_PubPool.poolVec2,t.util.ZPP_PubPool.poolVec2=d.zpp_pool,d.zpp_pool=null,d.zpp_disp=!1,d==t.util.ZPP_PubPool.nextVec2&&(t.util.ZPP_PubPool.nextVec2=null)),null==d.zpp_inner){var f;null==t.geom.ZPP_Vec2.zpp_pool?f=new t.geom.ZPP_Vec2:(f=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=f.next,f.next=null),f.weak=!1,f._immutable=!1,f.x=c,f.y=m,d.zpp_inner=f,d.zpp_inner.outer=d}else{if(null!=d&&d.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var x,y=d.zpp_inner;if(y._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=y._isimmutable&&y._isimmutable(),c!=c||m!=m)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null!=d&&d.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var v=d.zpp_inner;if(null!=v._validate&&v._validate(),d.zpp_inner.x==c){if(null!=d&&d.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var g=d.zpp_inner;null!=g._validate&&g._validate(),x=d.zpp_inner.y==m}else x=!1;if(!x){d.zpp_inner.x=c,d.zpp_inner.y=m;var b=d.zpp_inner;null!=b._invalidate&&b._invalidate(b)}}d.zpp_inner.weak=P,u.push(d)}else if(i instanceof e.geom.Vec2List)for(var z=i.iterator();;){z.zpp_inner.zpp_inner.valmod();var w,Z=z.zpp_inner.zpp_gl();if(z.zpp_critical=!0,z.zpp_i<Z?w=!0:(z.zpp_next=e.geom.Vec2Iterator.zpp_pool,e.geom.Vec2Iterator.zpp_pool=z,z.zpp_inner=null,w=!1),!w)break;z.zpp_critical=!1;var E=z.zpp_inner.at(z.zpp_i++);if(null==E)throw new n._Boot.HaxeError("Error: Vec2List contains null objects");if(null!=E&&E.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");null==this.zpp_inner_zn.wrap_lverts&&this.zpp_inner_zn.getlverts();var M=this.zpp_inner_zn.wrap_lverts;if(null!=E&&E.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");if(E.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var S=E.zpp_inner;null!=S._validate&&S._validate();var C=E.zpp_inner.x;if(E.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var N=E.zpp_inner;null!=N._validate&&N._validate();var A,L=E.zpp_inner.y,B=!1;if(null==B&&(B=!1),null==L&&(L=0),null==C&&(C=0),C!=C||L!=L)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null==t.util.ZPP_PubPool.poolVec2?A=new e.geom.Vec2:(A=t.util.ZPP_PubPool.poolVec2,t.util.ZPP_PubPool.poolVec2=A.zpp_pool,A.zpp_pool=null,A.zpp_disp=!1,A==t.util.ZPP_PubPool.nextVec2&&(t.util.ZPP_PubPool.nextVec2=null)),null==A.zpp_inner){var T;null==t.geom.ZPP_Vec2.zpp_pool?T=new t.geom.ZPP_Vec2:(T=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=T.next,T.next=null),T.weak=!1,T._immutable=!1,T.x=C,T.y=L,A.zpp_inner=T,A.zpp_inner.outer=A}else{if(null!=A&&A.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var V,k=A.zpp_inner;if(k._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=k._isimmutable&&k._isimmutable(),C!=C||L!=L)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null!=A&&A.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var I=A.zpp_inner;if(null!=I._validate&&I._validate(),A.zpp_inner.x==C){if(null!=A&&A.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var O=A.zpp_inner;null!=O._validate&&O._validate(),V=A.zpp_inner.y==L}else V=!1;if(!V){A.zpp_inner.x=C,A.zpp_inner.y=L;var R=A.zpp_inner;null!=R._invalidate&&R._invalidate(R)}}A.zpp_inner.weak=B,M.push(A)}else{if(!(i instanceof e.geom.GeomPoly))throw new n._Boot.HaxeError("Error: Invalid type for polygon object, should be Array<Vec2>, Vec2List, GeomPoly or for flash10+ flash.Vector<Vec2>");var H=i;if(null!=H&&H.zpp_disp)throw new n._Boot.HaxeError("Error: GeomPoly has been disposed and cannot be used!");var F=H.zpp_inner.vertices;if(null!=F)for(var D=F;;){var G,U=D.x,j=D.y;if(null==j&&(j=0),null==U&&(U=0),U!=U||j!=j)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null==t.util.ZPP_PubPool.poolVec2?G=new e.geom.Vec2:(G=t.util.ZPP_PubPool.poolVec2,t.util.ZPP_PubPool.poolVec2=G.zpp_pool,G.zpp_pool=null,G.zpp_disp=!1,G==t.util.ZPP_PubPool.nextVec2&&(t.util.ZPP_PubPool.nextVec2=null)),null==G.zpp_inner){var W;null==t.geom.ZPP_Vec2.zpp_pool?W=new t.geom.ZPP_Vec2:(W=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=W.next,W.next=null),W.weak=!1,W._immutable=!1,W.x=U,W.y=j,G.zpp_inner=W,G.zpp_inner.outer=G}else{if(null!=G&&G.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var q,J=G.zpp_inner;if(J._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=J._isimmutable&&J._isimmutable(),U!=U||j!=j)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null!=G&&G.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var $=G.zpp_inner;if(null!=$._validate&&$._validate(),G.zpp_inner.x==U){if(null!=G&&G.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var X=G.zpp_inner;null!=X._validate&&X._validate(),q=G.zpp_inner.y==j}else q=!1;if(!q){G.zpp_inner.x=U,G.zpp_inner.y=j;var Y=G.zpp_inner;null!=Y._invalidate&&Y._invalidate(Y)}}G.zpp_inner.weak=!1;var K=G;D=D.next,null==this.zpp_inner_zn.wrap_lverts&&this.zpp_inner_zn.getlverts();var Q=this.zpp_inner_zn.wrap_lverts;if(null!=K&&K.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");if(K.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var ee=K.zpp_inner;null!=ee._validate&&ee._validate();var te=K.zpp_inner.x;if(K.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var ne=K.zpp_inner;null!=ne._validate&&ne._validate();var ie,re=K.zpp_inner.y,oe=!1;if(null==oe&&(oe=!1),null==re&&(re=0),null==te&&(te=0),te!=te||re!=re)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null==t.util.ZPP_PubPool.poolVec2?ie=new e.geom.Vec2:(ie=t.util.ZPP_PubPool.poolVec2,t.util.ZPP_PubPool.poolVec2=ie.zpp_pool,ie.zpp_pool=null,ie.zpp_disp=!1,ie==t.util.ZPP_PubPool.nextVec2&&(t.util.ZPP_PubPool.nextVec2=null)),null==ie.zpp_inner){var ae;null==t.geom.ZPP_Vec2.zpp_pool?ae=new t.geom.ZPP_Vec2:(ae=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=ae.next,ae.next=null),ae.weak=!1,ae._immutable=!1,ae.x=te,ae.y=re,ie.zpp_inner=ae,ie.zpp_inner.outer=ie}else{if(null!=ie&&ie.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var se,le=ie.zpp_inner;if(le._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=le._isimmutable&&le._isimmutable(),te!=te||re!=re)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null!=ie&&ie.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var pe=ie.zpp_inner;if(null!=pe._validate&&pe._validate(),ie.zpp_inner.x==te){if(null!=ie&&ie.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var ue=ie.zpp_inner;null!=ue._validate&&ue._validate(),se=ie.zpp_inner.y==re}else se=!1;if(!se){ie.zpp_inner.x=te,ie.zpp_inner.y=re;var he=ie.zpp_inner;null!=he._invalidate&&he._invalidate(he)}}if(ie.zpp_inner.weak=oe,Q.push(ie),null!=K&&K.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var ce=K.zpp_inner;if(ce._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=ce._isimmutable&&ce._isimmutable(),K.zpp_inner._inuse)throw new n._Boot.HaxeError("Error: This Vec2 is not disposable");var _e=K.zpp_inner;K.zpp_inner.outer=null,K.zpp_inner=null;var de=K;de.zpp_pool=null,null!=t.util.ZPP_PubPool.nextVec2?t.util.ZPP_PubPool.nextVec2.zpp_pool=de:t.util.ZPP_PubPool.poolVec2=de,t.util.ZPP_PubPool.nextVec2=de,de.zpp_disp=!0;var me=_e;if(null!=me.outer&&(me.outer.zpp_inner=null,me.outer=null),me._isimmutable=null,me._validate=null,me._invalidate=null,me.next=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=me,D==F)break}}if(i instanceof Array)for(var Pe=i,fe=0;fe<Pe.length;){var xe,ye=Pe[fe];if(ye.zpp_inner.weak){if(null!=ye&&ye.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var ve=ye.zpp_inner;if(ve._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=ve._isimmutable&&ve._isimmutable(),ye.zpp_inner._inuse)throw new n._Boot.HaxeError("Error: This Vec2 is not disposable");var ge=ye.zpp_inner;ye.zpp_inner.outer=null,ye.zpp_inner=null;var be=ye;be.zpp_pool=null,null!=t.util.ZPP_PubPool.nextVec2?t.util.ZPP_PubPool.nextVec2.zpp_pool=be:t.util.ZPP_PubPool.poolVec2=be,t.util.ZPP_PubPool.nextVec2=be,be.zpp_disp=!0;var ze=ge;null!=ze.outer&&(ze.outer.zpp_inner=null,ze.outer=null),ze._isimmutable=null,ze._validate=null,ze._invalidate=null,ze.next=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=ze,xe=!0}else xe=!1;xe?Pe.splice(fe,1):++fe}else if(i instanceof e.geom.Vec2List){var we=i;null!=we.zpp_inner._validate&&we.zpp_inner._validate();for(var Ze=we.zpp_inner.inner,Ee=null,Me=Ze.head;null!=Me;){var Se=Me.elt;if(Se.outer.zpp_inner.weak){if(Me=Ze.erase(Ee),Se.outer.zpp_inner.weak){var Ce=Se.outer;if(null!=Ce&&Ce.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var Ne=Ce.zpp_inner;if(Ne._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=Ne._isimmutable&&Ne._isimmutable(),Ce.zpp_inner._inuse)throw new n._Boot.HaxeError("Error: This Vec2 is not disposable");var Ae=Ce.zpp_inner;Ce.zpp_inner.outer=null,Ce.zpp_inner=null;var Le=Ce;Le.zpp_pool=null,null!=t.util.ZPP_PubPool.nextVec2?t.util.ZPP_PubPool.nextVec2.zpp_pool=Le:t.util.ZPP_PubPool.poolVec2=Le,t.util.ZPP_PubPool.nextVec2=Le,Le.zpp_disp=!0;var Be=Ae;null!=Be.outer&&(Be.outer.zpp_inner=null,Be.outer=null),Be._isimmutable=null,Be._validate=null,Be._invalidate=null,Be.next=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=Be}}else Ee=Me,Me=Me.next}}if(null==r)null==t.phys.ZPP_Material.zpp_pool?this.zpp_inner.material=new t.phys.ZPP_Material:(this.zpp_inner.material=t.phys.ZPP_Material.zpp_pool,t.phys.ZPP_Material.zpp_pool=this.zpp_inner.material.next,this.zpp_inner.material.next=null);else{if(this.zpp_inner.immutable_midstep("Shape::material"),null==r)throw new n._Boot.HaxeError("Error: Cannot assign null as Shape material");this.zpp_inner.setMaterial(r.zpp_inner),this.zpp_inner.material.wrapper()}if(null==o)null==t.dynamics.ZPP_InteractionFilter.zpp_pool?this.zpp_inner.filter=new t.dynamics.ZPP_InteractionFilter:(this.zpp_inner.filter=t.dynamics.ZPP_InteractionFilter.zpp_pool,t.dynamics.ZPP_InteractionFilter.zpp_pool=this.zpp_inner.filter.next,this.zpp_inner.filter.next=null);else{if(this.zpp_inner.immutable_midstep("Shape::filter"),null==o)throw new n._Boot.HaxeError("Error: Cannot assign null as Shape filter");this.zpp_inner.setFilter(o.zpp_inner),this.zpp_inner.filter.wrapper()}this.zpp_inner_i.insert_cbtype(t.callbacks.ZPP_CbType.ANY_SHAPE.zpp_inner)},e.shape.Polygon.__name__=["nape","shape","Polygon"],e.shape.Polygon.__super__=e.shape.Shape,e.shape.Shape.prototype)e.shape.Polygon.prototype[u]=e.shape.Shape.prototype[u];for(var u in e.shape.Polygon.rect=function(i,r,o,a,s){if(null==s&&(s=!1),i!=i||r!=r||o!=o||a!=a)throw new n._Boot.HaxeError("Error: Polygon.rect cannot accept NaN arguments");var l,p=i,u=r,h=s;if(null==h&&(h=!1),null==u&&(u=0),null==p&&(p=0),p!=p||u!=u)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null==t.util.ZPP_PubPool.poolVec2?l=new e.geom.Vec2:(l=t.util.ZPP_PubPool.poolVec2,t.util.ZPP_PubPool.poolVec2=l.zpp_pool,l.zpp_pool=null,l.zpp_disp=!1,l==t.util.ZPP_PubPool.nextVec2&&(t.util.ZPP_PubPool.nextVec2=null)),null==l.zpp_inner){var c;null==t.geom.ZPP_Vec2.zpp_pool?c=new t.geom.ZPP_Vec2:(c=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=c.next,c.next=null),c.weak=!1,c._immutable=!1,c.x=p,c.y=u,l.zpp_inner=c,l.zpp_inner.outer=l}else{if(null!=l&&l.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var _,d=l.zpp_inner;if(d._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=d._isimmutable&&d._isimmutable(),p!=p||u!=u)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null!=l&&l.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var m=l.zpp_inner;if(null!=m._validate&&m._validate(),l.zpp_inner.x==p){if(null!=l&&l.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var P=l.zpp_inner;null!=P._validate&&P._validate(),_=l.zpp_inner.y==u}else _=!1;if(!_){l.zpp_inner.x=p,l.zpp_inner.y=u;var f=l.zpp_inner;null!=f._invalidate&&f._invalidate(f)}}l.zpp_inner.weak=h;var x,y=i+o,v=r,g=s;if(null==g&&(g=!1),null==v&&(v=0),null==y&&(y=0),y!=y||v!=v)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null==t.util.ZPP_PubPool.poolVec2?x=new e.geom.Vec2:(x=t.util.ZPP_PubPool.poolVec2,t.util.ZPP_PubPool.poolVec2=x.zpp_pool,x.zpp_pool=null,x.zpp_disp=!1,x==t.util.ZPP_PubPool.nextVec2&&(t.util.ZPP_PubPool.nextVec2=null)),null==x.zpp_inner){var b;null==t.geom.ZPP_Vec2.zpp_pool?b=new t.geom.ZPP_Vec2:(b=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=b.next,b.next=null),b.weak=!1,b._immutable=!1,b.x=y,b.y=v,x.zpp_inner=b,x.zpp_inner.outer=x}else{if(null!=x&&x.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var z,w=x.zpp_inner;if(w._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=w._isimmutable&&w._isimmutable(),y!=y||v!=v)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null!=x&&x.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var Z=x.zpp_inner;if(null!=Z._validate&&Z._validate(),x.zpp_inner.x==y){if(null!=x&&x.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var E=x.zpp_inner;null!=E._validate&&E._validate(),z=x.zpp_inner.y==v}else z=!1;if(!z){x.zpp_inner.x=y,x.zpp_inner.y=v;var M=x.zpp_inner;null!=M._invalidate&&M._invalidate(M)}}x.zpp_inner.weak=g;var S,C=i+o,N=r+a,A=s;if(null==A&&(A=!1),null==N&&(N=0),null==C&&(C=0),C!=C||N!=N)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null==t.util.ZPP_PubPool.poolVec2?S=new e.geom.Vec2:(S=t.util.ZPP_PubPool.poolVec2,t.util.ZPP_PubPool.poolVec2=S.zpp_pool,S.zpp_pool=null,S.zpp_disp=!1,S==t.util.ZPP_PubPool.nextVec2&&(t.util.ZPP_PubPool.nextVec2=null)),null==S.zpp_inner){var L;null==t.geom.ZPP_Vec2.zpp_pool?L=new t.geom.ZPP_Vec2:(L=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=L.next,L.next=null),L.weak=!1,L._immutable=!1,L.x=C,L.y=N,S.zpp_inner=L,S.zpp_inner.outer=S}else{if(null!=S&&S.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var B,T=S.zpp_inner;if(T._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=T._isimmutable&&T._isimmutable(),C!=C||N!=N)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null!=S&&S.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var V=S.zpp_inner;if(null!=V._validate&&V._validate(),S.zpp_inner.x==C){if(null!=S&&S.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var k=S.zpp_inner;null!=k._validate&&k._validate(),B=S.zpp_inner.y==N}else B=!1;if(!B){S.zpp_inner.x=C,S.zpp_inner.y=N;var I=S.zpp_inner;null!=I._invalidate&&I._invalidate(I)}}S.zpp_inner.weak=A;var O,R=i,H=r+a,F=s;if(null==F&&(F=!1),null==H&&(H=0),null==R&&(R=0),R!=R||H!=H)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null==t.util.ZPP_PubPool.poolVec2?O=new e.geom.Vec2:(O=t.util.ZPP_PubPool.poolVec2,t.util.ZPP_PubPool.poolVec2=O.zpp_pool,O.zpp_pool=null,O.zpp_disp=!1,O==t.util.ZPP_PubPool.nextVec2&&(t.util.ZPP_PubPool.nextVec2=null)),null==O.zpp_inner){var D;null==t.geom.ZPP_Vec2.zpp_pool?D=new t.geom.ZPP_Vec2:(D=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=D.next,D.next=null),D.weak=!1,D._immutable=!1,D.x=R,D.y=H,O.zpp_inner=D,O.zpp_inner.outer=O}else{if(null!=O&&O.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var G,U=O.zpp_inner;if(U._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=U._isimmutable&&U._isimmutable(),R!=R||H!=H)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null!=O&&O.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var j=O.zpp_inner;if(null!=j._validate&&j._validate(),O.zpp_inner.x==R){if(null!=O&&O.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var W=O.zpp_inner;null!=W._validate&&W._validate(),G=O.zpp_inner.y==H}else G=!1;if(!G){O.zpp_inner.x=R,O.zpp_inner.y=H;var q=O.zpp_inner;null!=q._invalidate&&q._invalidate(q)}}return O.zpp_inner.weak=F,[l,x,S,O]},e.shape.Polygon.box=function(t,i,r){if(null==r&&(r=!1),t!=t||i!=i)throw new n._Boot.HaxeError("Error: Polygon.box cannot accept NaN arguments");return e.shape.Polygon.rect(-t/2,-i/2,t,i,r)},e.shape.Polygon.regular=function(i,r,o,a,s){if(null==s&&(s=!1),null==a&&(a=0),i!=i||r!=r||a!=a)throw new n._Boot.HaxeError("Error: Polygon.regular cannot accept NaN arguments");for(var l=[],p=2*Math.PI/o,u=0,h=o;u<h;){var c,_=u++*p+a,d=Math.cos(_)*i,m=Math.sin(_)*r,P=s;if(null==P&&(P=!1),null==m&&(m=0),null==d&&(d=0),d!=d||m!=m)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null==t.util.ZPP_PubPool.poolVec2?c=new e.geom.Vec2:(c=t.util.ZPP_PubPool.poolVec2,t.util.ZPP_PubPool.poolVec2=c.zpp_pool,c.zpp_pool=null,c.zpp_disp=!1,c==t.util.ZPP_PubPool.nextVec2&&(t.util.ZPP_PubPool.nextVec2=null)),null==c.zpp_inner){var f;null==t.geom.ZPP_Vec2.zpp_pool?f=new t.geom.ZPP_Vec2:(f=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=f.next,f.next=null),f.weak=!1,f._immutable=!1,f.x=d,f.y=m,c.zpp_inner=f,c.zpp_inner.outer=c}else{if(null!=c&&c.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var x,y=c.zpp_inner;if(y._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=y._isimmutable&&y._isimmutable(),d!=d||m!=m)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null!=c&&c.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var v=c.zpp_inner;if(null!=v._validate&&v._validate(),c.zpp_inner.x==d){if(null!=c&&c.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var g=c.zpp_inner;null!=g._validate&&g._validate(),x=c.zpp_inner.y==m}else x=!1;if(!x){c.zpp_inner.x=d,c.zpp_inner.y=m;var b=c.zpp_inner;null!=b._invalidate&&b._invalidate(b)}}c.zpp_inner.weak=P;var z=c;l.push(z)}return l},e.shape.Polygon.prototype.zpp_inner_zn=null,Object.defineProperty(e.shape.Polygon.prototype,"localVerts",{get:e.shape.Polygon.prototype.get_localVerts}),e.shape.Polygon.prototype.get_localVerts=function(){return null==this.zpp_inner_zn.wrap_lverts&&this.zpp_inner_zn.getlverts(),this.zpp_inner_zn.wrap_lverts},Object.defineProperty(e.shape.Polygon.prototype,"worldVerts",{get:e.shape.Polygon.prototype.get_worldVerts}),e.shape.Polygon.prototype.get_worldVerts=function(){return null==this.zpp_inner_zn.wrap_gverts&&this.zpp_inner_zn.getgverts(),this.zpp_inner_zn.wrap_gverts},Object.defineProperty(e.shape.Polygon.prototype,"edges",{get:e.shape.Polygon.prototype.get_edges}),e.shape.Polygon.prototype.get_edges=function(){return null==this.zpp_inner_zn.wrap_edges&&this.zpp_inner_zn.getedges(),this.zpp_inner_zn.wrap_edges},e.shape.Polygon.prototype.validity=function(){return this.zpp_inner_zn.valid()},e.shape.Polygon.prototype.__class__=e.shape.Polygon,e.shape.ShapeIterator=l["nape.shape.ShapeIterator"]=function(){if(this.zpp_next=null,this.zpp_critical=!1,this.zpp_i=0,this.zpp_inner=null,!t.util.ZPP_ShapeList.internal)throw new n._Boot.HaxeError("Error: Cannot instantiate ShapeIterator derp!")},e.shape.ShapeIterator.__name__=["nape","shape","ShapeIterator"],e.shape.ShapeIterator.get=function(n){var i;if(null==e.shape.ShapeIterator.zpp_pool){t.util.ZPP_ShapeList.internal=!0;var r=new e.shape.ShapeIterator;t.util.ZPP_ShapeList.internal=!1,i=r}else{var o=e.shape.ShapeIterator.zpp_pool;e.shape.ShapeIterator.zpp_pool=o.zpp_next,i=o}return i.zpp_i=0,i.zpp_inner=n,i.zpp_critical=!1,i},e.shape.ShapeIterator.prototype.zpp_inner=null,e.shape.ShapeIterator.prototype.zpp_i=null,e.shape.ShapeIterator.prototype.zpp_critical=null,e.shape.ShapeIterator.prototype.zpp_next=null,e.shape.ShapeIterator.prototype.hasNext=function(){this.zpp_inner.zpp_inner.valmod();var t=this.zpp_inner;t.zpp_inner.valmod(),t.zpp_inner.zip_length&&(t.zpp_inner.zip_length=!1,t.zpp_inner.user_length=t.zpp_inner.inner.length);var n=t.zpp_inner.user_length;return this.zpp_critical=!0,this.zpp_i<n||(this.zpp_next=e.shape.ShapeIterator.zpp_pool,e.shape.ShapeIterator.zpp_pool=this,this.zpp_inner=null,!1)},e.shape.ShapeIterator.prototype.next=function(){return this.zpp_critical=!1,this.zpp_inner.at(this.zpp_i++)},e.shape.ShapeIterator.prototype.__class__=e.shape.ShapeIterator,e.shape.ShapeList=l["nape.shape.ShapeList"]=function(){this.zpp_inner=null,this.zpp_inner=new t.util.ZPP_ShapeList,this.zpp_inner.outer=this},e.shape.ShapeList.__name__=["nape","shape","ShapeList"],e.shape.ShapeList.fromArray=function(t){if(null==t)throw new n._Boot.HaxeError("Error: Cannot convert null Array to Nape list");for(var i=new e.shape.ShapeList,r=0;r<t.length;){var o=t[r];++r,i.push(o)}return i},e.shape.ShapeList.prototype.zpp_inner=null,Object.defineProperty(e.shape.ShapeList.prototype,"length",{get:e.shape.ShapeList.prototype.get_length}),e.shape.ShapeList.prototype.get_length=function(){return this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.user_length},e.shape.ShapeList.prototype.has=function(e){return this.zpp_inner.valmod(),this.zpp_inner.inner.has(e.zpp_inner)},e.shape.ShapeList.prototype.at=function(e){var t;if(this.zpp_inner.valmod(),e>=0?(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t=e>=this.zpp_inner.user_length):t=!0,t)throw new n._Boot.HaxeError("Error: Index out of bounds");if(this.zpp_inner.reverse_flag&&(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),e=this.zpp_inner.user_length-1-e),e<this.zpp_inner.at_index||null==this.zpp_inner.at_ite)this.zpp_inner.at_index=e,this.zpp_inner.at_ite=this.zpp_inner.inner.iterator_at(e);else for(;this.zpp_inner.at_index!=e;)this.zpp_inner.at_index++,this.zpp_inner.at_ite=this.zpp_inner.at_ite.next;return this.zpp_inner.at_ite.elt.outer},e.shape.ShapeList.prototype.push=function(e){if(this.zpp_inner.immutable)throw new n._Boot.HaxeError("Error: ShapeList is immutable");this.zpp_inner.modify_test(),this.zpp_inner.valmod();var t=null==this.zpp_inner.adder||this.zpp_inner.adder(e);if(t){if(this.zpp_inner.reverse_flag)this.zpp_inner.inner.add(e.zpp_inner);else{if(null==this.zpp_inner.push_ite){var i;if(null==this.zpp_inner.inner.head)i=null;else{var r=this.zpp_inner.inner;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),i=r.iterator_at(this.zpp_inner.user_length-1)}this.zpp_inner.push_ite=i}this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,e.zpp_inner)}this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(e)}return t},e.shape.ShapeList.prototype.unshift=function(e){if(this.zpp_inner.immutable)throw new n._Boot.HaxeError("Error: ShapeList is immutable");this.zpp_inner.modify_test(),this.zpp_inner.valmod();var t=null==this.zpp_inner.adder||this.zpp_inner.adder(e);if(t){if(this.zpp_inner.reverse_flag){if(null==this.zpp_inner.push_ite){var i;if(null==this.zpp_inner.inner.head)i=null;else{var r=this.zpp_inner.inner;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),i=r.iterator_at(this.zpp_inner.user_length-1)}this.zpp_inner.push_ite=i}this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,e.zpp_inner)}else this.zpp_inner.inner.add(e.zpp_inner);this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(e)}return t},e.shape.ShapeList.prototype.pop=function(){if(this.zpp_inner.immutable)throw new n._Boot.HaxeError("Error: ShapeList is immutable");if(this.zpp_inner.modify_test(),null==this.zpp_inner.inner.head)throw new n._Boot.HaxeError("Error: Cannot remove from empty list");this.zpp_inner.valmod();var e=null;if(this.zpp_inner.reverse_flag){var t=(e=this.zpp_inner.inner.head.elt).outer;null!=this.zpp_inner.subber&&this.zpp_inner.subber(t),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()}else{var i;if(null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null),this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),1==this.zpp_inner.user_length)i=null;else{var r=this.zpp_inner.inner;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),i=r.iterator_at(this.zpp_inner.user_length-2)}var o=(e=null==i?this.zpp_inner.inner.head.elt:i.next.elt).outer;null!=this.zpp_inner.subber&&this.zpp_inner.subber(o),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(i)}return this.zpp_inner.invalidate(),e.outer},e.shape.ShapeList.prototype.shift=function(){if(this.zpp_inner.immutable)throw new n._Boot.HaxeError("Error: ShapeList is immutable");if(this.zpp_inner.modify_test(),null==this.zpp_inner.inner.head)throw new n._Boot.HaxeError("Error: Cannot remove from empty list");this.zpp_inner.valmod();var e=null;if(this.zpp_inner.reverse_flag){var t;if(null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null),this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),1==this.zpp_inner.user_length)t=null;else{var i=this.zpp_inner.inner;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t=i.iterator_at(this.zpp_inner.user_length-2)}var r=(e=null==t?this.zpp_inner.inner.head.elt:t.next.elt).outer;null!=this.zpp_inner.subber&&this.zpp_inner.subber(r),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(t)}else{var o=(e=this.zpp_inner.inner.head.elt).outer;null!=this.zpp_inner.subber&&this.zpp_inner.subber(o),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()}return this.zpp_inner.invalidate(),e.outer},e.shape.ShapeList.prototype.add=function(e){return this.zpp_inner.reverse_flag?this.push(e):this.unshift(e)},e.shape.ShapeList.prototype.remove=function(e){if(this.zpp_inner.immutable)throw new n._Boot.HaxeError("Error: ShapeList is immutable");var t;this.zpp_inner.modify_test(),this.zpp_inner.valmod(),t=!1;for(var i=this.zpp_inner.inner.head;null!=i;){if(i.elt==e.zpp_inner){t=!0;break}i=i.next}return t&&(null!=this.zpp_inner.subber&&this.zpp_inner.subber(e),this.zpp_inner.dontremove||this.zpp_inner.inner.remove(e.zpp_inner),this.zpp_inner.invalidate()),t},e.shape.ShapeList.prototype.clear=function(){if(this.zpp_inner.immutable)throw new n._Boot.HaxeError("Error: ShapeList is immutable");if(this.zpp_inner.reverse_flag)for(;null!=this.zpp_inner.inner.head;)this.pop();else for(;null!=this.zpp_inner.inner.head;)this.shift()},e.shape.ShapeList.prototype.empty=function(){return null==this.zpp_inner.inner.head},e.shape.ShapeList.prototype.iterator=function(){return this.zpp_inner.valmod(),e.shape.ShapeIterator.get(this)},e.shape.ShapeList.prototype.copy=function(t){null==t&&(t=!1);var i=new e.shape.ShapeList;this.zpp_inner.valmod();for(var r=e.shape.ShapeIterator.get(this);;){r.zpp_inner.zpp_inner.valmod();var o=r.zpp_inner;o.zpp_inner.valmod(),o.zpp_inner.zip_length&&(o.zpp_inner.zip_length=!1,o.zpp_inner.user_length=o.zpp_inner.inner.length);var a,s=o.zpp_inner.user_length;if(r.zpp_critical=!0,r.zpp_i<s?a=!0:(r.zpp_next=e.shape.ShapeIterator.zpp_pool,e.shape.ShapeIterator.zpp_pool=r,r.zpp_inner=null,a=!1),!a)break;r.zpp_critical=!1;var l,p=r.zpp_inner.at(r.zpp_i++);if(t)throw new n._Boot.HaxeError("Error: Shape is not a copyable type");l=p,i.push(l)}return i},e.shape.ShapeList.prototype.merge=function(t){if(null==t)throw new n._Boot.HaxeError("Error: Cannot merge with null list");t.zpp_inner.valmod();for(var i=e.shape.ShapeIterator.get(t);;){i.zpp_inner.zpp_inner.valmod();var r=i.zpp_inner;r.zpp_inner.valmod(),r.zpp_inner.zip_length&&(r.zpp_inner.zip_length=!1,r.zpp_inner.user_length=r.zpp_inner.inner.length);var o,a=r.zpp_inner.user_length;if(i.zpp_critical=!0,i.zpp_i<a?o=!0:(i.zpp_next=e.shape.ShapeIterator.zpp_pool,e.shape.ShapeIterator.zpp_pool=i,i.zpp_inner=null,o=!1),!o)break;i.zpp_critical=!1;var s=i.zpp_inner.at(i.zpp_i++);this.has(s)||(this.zpp_inner.reverse_flag?this.push(s):this.unshift(s))}},e.shape.ShapeList.prototype.toString=function(){var t="[",n=!0;this.zpp_inner.valmod();for(var i=e.shape.ShapeIterator.get(this);;){i.zpp_inner.zpp_inner.valmod();var r=i.zpp_inner;r.zpp_inner.valmod(),r.zpp_inner.zip_length&&(r.zpp_inner.zip_length=!1,r.zpp_inner.user_length=r.zpp_inner.inner.length);var o,a=r.zpp_inner.user_length;if(i.zpp_critical=!0,i.zpp_i<a?o=!0:(i.zpp_next=e.shape.ShapeIterator.zpp_pool,e.shape.ShapeIterator.zpp_pool=i,i.zpp_inner=null,o=!1),!o)break;i.zpp_critical=!1;var s=i.zpp_inner.at(i.zpp_i++);n||(t+=","),t+=null==s?"NULL":s.toString(),n=!1}return t+"]"},e.shape.ShapeList.prototype.foreach=function(t){if(null==t)throw new n._Boot.HaxeError("Error: Cannot execute null on list elements");this.zpp_inner.valmod();for(var i=e.shape.ShapeIterator.get(this);;){i.zpp_inner.zpp_inner.valmod();var r=i.zpp_inner;r.zpp_inner.valmod(),r.zpp_inner.zip_length&&(r.zpp_inner.zip_length=!1,r.zpp_inner.user_length=r.zpp_inner.inner.length);var o,a=r.zpp_inner.user_length;if(i.zpp_critical=!0,i.zpp_i<a?o=!0:(i.zpp_next=e.shape.ShapeIterator.zpp_pool,e.shape.ShapeIterator.zpp_pool=i,i.zpp_inner=null,o=!1),!o)break;try{i.zpp_critical=!1,t(i.zpp_inner.at(i.zpp_i++))}catch(t){t instanceof n._Boot.HaxeError&&t.val,i.zpp_next=e.shape.ShapeIterator.zpp_pool,e.shape.ShapeIterator.zpp_pool=i,i.zpp_inner=null;break}}return this},e.shape.ShapeList.prototype.filter=function(e){if(null==e)throw new n._Boot.HaxeError("Error: Cannot select elements of list with null");for(var t=0;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t<this.zpp_inner.user_length;){var i=this.at(t);try{e(i)?++t:this.remove(i)}catch(e){e instanceof n._Boot.HaxeError&&e.val;break}}return this},e.shape.ShapeList.prototype.__class__=e.shape.ShapeList,e.shape.ShapeType=l["nape.shape.ShapeType"]=function(){if(!t.util.ZPP_Flags.internal)throw new n._Boot.HaxeError("Error: Cannot instantiate ShapeType derp!")},e.shape.ShapeType.__name__=["nape","shape","ShapeType"],e.shape.ShapeType.CIRCLE=null,e.shape.ShapeType.get_CIRCLE=function(){return null==t.util.ZPP_Flags.ShapeType_CIRCLE&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.ShapeType_CIRCLE=new e.shape.ShapeType,t.util.ZPP_Flags.internal=!1),t.util.ZPP_Flags.ShapeType_CIRCLE},e.shape.ShapeType.POLYGON=null,e.shape.ShapeType.get_POLYGON=function(){return null==t.util.ZPP_Flags.ShapeType_POLYGON&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.ShapeType_POLYGON=new e.shape.ShapeType,t.util.ZPP_Flags.internal=!1),t.util.ZPP_Flags.ShapeType_POLYGON},e.shape.ShapeType.prototype.toString=function(){return null==t.util.ZPP_Flags.ShapeType_CIRCLE&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.ShapeType_CIRCLE=new e.shape.ShapeType,t.util.ZPP_Flags.internal=!1),this==t.util.ZPP_Flags.ShapeType_CIRCLE?"CIRCLE":(null==t.util.ZPP_Flags.ShapeType_POLYGON&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.ShapeType_POLYGON=new e.shape.ShapeType,t.util.ZPP_Flags.internal=!1),this==t.util.ZPP_Flags.ShapeType_POLYGON?"POLYGON":"")},e.shape.ShapeType.prototype.__class__=e.shape.ShapeType,e.shape.ValidationResult=l["nape.shape.ValidationResult"]=function(){if(!t.util.ZPP_Flags.internal)throw new n._Boot.HaxeError("Error: Cannot instantiate ValidationResult derp!")},e.shape.ValidationResult.__name__=["nape","shape","ValidationResult"],e.shape.ValidationResult.VALID=null,e.shape.ValidationResult.get_VALID=function(){return null==t.util.ZPP_Flags.ValidationResult_VALID&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.ValidationResult_VALID=new e.shape.ValidationResult,t.util.ZPP_Flags.internal=!1),t.util.ZPP_Flags.ValidationResult_VALID},e.shape.ValidationResult.DEGENERATE=null,e.shape.ValidationResult.get_DEGENERATE=function(){return null==t.util.ZPP_Flags.ValidationResult_DEGENERATE&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.ValidationResult_DEGENERATE=new e.shape.ValidationResult,t.util.ZPP_Flags.internal=!1),t.util.ZPP_Flags.ValidationResult_DEGENERATE},e.shape.ValidationResult.CONCAVE=null,e.shape.ValidationResult.get_CONCAVE=function(){return null==t.util.ZPP_Flags.ValidationResult_CONCAVE&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.ValidationResult_CONCAVE=new e.shape.ValidationResult,t.util.ZPP_Flags.internal=!1),t.util.ZPP_Flags.ValidationResult_CONCAVE},e.shape.ValidationResult.SELF_INTERSECTING=null,e.shape.ValidationResult.get_SELF_INTERSECTING=function(){return null==t.util.ZPP_Flags.ValidationResult_SELF_INTERSECTING&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.ValidationResult_SELF_INTERSECTING=new e.shape.ValidationResult,t.util.ZPP_Flags.internal=!1),t.util.ZPP_Flags.ValidationResult_SELF_INTERSECTING},e.shape.ValidationResult.prototype.toString=function(){return null==t.util.ZPP_Flags.ValidationResult_VALID&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.ValidationResult_VALID=new e.shape.ValidationResult,t.util.ZPP_Flags.internal=!1),this==t.util.ZPP_Flags.ValidationResult_VALID?"VALID":(null==t.util.ZPP_Flags.ValidationResult_DEGENERATE&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.ValidationResult_DEGENERATE=new e.shape.ValidationResult,t.util.ZPP_Flags.internal=!1),this==t.util.ZPP_Flags.ValidationResult_DEGENERATE?"DEGENERATE":(null==t.util.ZPP_Flags.ValidationResult_CONCAVE&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.ValidationResult_CONCAVE=new e.shape.ValidationResult,t.util.ZPP_Flags.internal=!1),this==t.util.ZPP_Flags.ValidationResult_CONCAVE?"CONCAVE":(null==t.util.ZPP_Flags.ValidationResult_SELF_INTERSECTING&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.ValidationResult_SELF_INTERSECTING=new e.shape.ValidationResult,t.util.ZPP_Flags.internal=!1),this==t.util.ZPP_Flags.ValidationResult_SELF_INTERSECTING?"SELF_INTERSECTING":"")))},e.shape.ValidationResult.prototype.__class__=e.shape.ValidationResult,e.space||(e.space={}),e.space.Broadphase=l["nape.space.Broadphase"]=function(){if(!t.util.ZPP_Flags.internal)throw new n._Boot.HaxeError("Error: Cannot instantiate Broadphase derp!")},e.space.Broadphase.__name__=["nape","space","Broadphase"],e.space.Broadphase.DYNAMIC_AABB_TREE=null,e.space.Broadphase.get_DYNAMIC_AABB_TREE=function(){return null==t.util.ZPP_Flags.Broadphase_DYNAMIC_AABB_TREE&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.Broadphase_DYNAMIC_AABB_TREE=new e.space.Broadphase,t.util.ZPP_Flags.internal=!1),t.util.ZPP_Flags.Broadphase_DYNAMIC_AABB_TREE},e.space.Broadphase.SWEEP_AND_PRUNE=null,e.space.Broadphase.get_SWEEP_AND_PRUNE=function(){return null==t.util.ZPP_Flags.Broadphase_SWEEP_AND_PRUNE&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.Broadphase_SWEEP_AND_PRUNE=new e.space.Broadphase,t.util.ZPP_Flags.internal=!1),t.util.ZPP_Flags.Broadphase_SWEEP_AND_PRUNE},e.space.Broadphase.prototype.toString=function(){return null==t.util.ZPP_Flags.Broadphase_DYNAMIC_AABB_TREE&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.Broadphase_DYNAMIC_AABB_TREE=new e.space.Broadphase,t.util.ZPP_Flags.internal=!1),this==t.util.ZPP_Flags.Broadphase_DYNAMIC_AABB_TREE?"DYNAMIC_AABB_TREE":(null==t.util.ZPP_Flags.Broadphase_SWEEP_AND_PRUNE&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.Broadphase_SWEEP_AND_PRUNE=new e.space.Broadphase,t.util.ZPP_Flags.internal=!1),this==t.util.ZPP_Flags.Broadphase_SWEEP_AND_PRUNE?"SWEEP_AND_PRUNE":"")},e.space.Broadphase.prototype.__class__=e.space.Broadphase,e.space.Space=l["nape.space.Space"]=function(e,i){if(this.zpp_inner=null,null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");if(this.zpp_inner=new t.space.ZPP_Space(null==e?null:e.zpp_inner,i),this.zpp_inner.outer=this,null!=e&&e.zpp_inner.weak){if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var r=e.zpp_inner;if(r._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=r._isimmutable&&r._isimmutable(),e.zpp_inner._inuse)throw new n._Boot.HaxeError("Error: This Vec2 is not disposable");var o=e.zpp_inner;e.zpp_inner.outer=null,e.zpp_inner=null;var a=e;a.zpp_pool=null,null!=t.util.ZPP_PubPool.nextVec2?t.util.ZPP_PubPool.nextVec2.zpp_pool=a:t.util.ZPP_PubPool.poolVec2=a,t.util.ZPP_PubPool.nextVec2=a,a.zpp_disp=!0;var s=o;null!=s.outer&&(s.outer.zpp_inner=null,s.outer=null),s._isimmutable=null,s._validate=null,s._invalidate=null,s.next=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=s}},e.space.Space.__name__=["nape","space","Space"],e.space.Space.prototype.zpp_inner=null,Object.defineProperty(e.space.Space.prototype,"userData",{get:e.space.Space.prototype.get_userData}),e.space.Space.prototype.get_userData=function(){return null==this.zpp_inner.userData&&(this.zpp_inner.userData={}),this.zpp_inner.userData},Object.defineProperty(e.space.Space.prototype,"gravity",{get:e.space.Space.prototype.get_gravity,set:e.space.Space.prototype.set_gravity}),e.space.Space.prototype.get_gravity=function(){return null==this.zpp_inner.wrap_gravity&&this.zpp_inner.getgravity(),this.zpp_inner.wrap_gravity},e.space.Space.prototype.set_gravity=function(e){if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");if(null==e)throw new n._Boot.HaxeError("Error: Space::gravity cannot be null");null==this.zpp_inner.wrap_gravity&&this.zpp_inner.getgravity();var i=this.zpp_inner.wrap_gravity;if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var r=i.zpp_inner;if(r._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=r._isimmutable&&r._isimmutable(),null==e)throw new n._Boot.HaxeError("Error: Cannot assign null Vec2");if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var o=e.zpp_inner;null!=o._validate&&o._validate();var a=e.zpp_inner.x;if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var s=e.zpp_inner;null!=s._validate&&s._validate();var l=e.zpp_inner.y;if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var p,u=i.zpp_inner;if(u._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=u._isimmutable&&u._isimmutable(),a!=a||l!=l)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var h=i.zpp_inner;if(null!=h._validate&&h._validate(),i.zpp_inner.x==a){if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var c=i.zpp_inner;null!=c._validate&&c._validate(),p=i.zpp_inner.y==l}else p=!1;if(!p){i.zpp_inner.x=a,i.zpp_inner.y=l;var _=i.zpp_inner;null!=_._invalidate&&_._invalidate(_)}if(e.zpp_inner.weak){if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var d=e.zpp_inner;if(d._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=d._isimmutable&&d._isimmutable(),e.zpp_inner._inuse)throw new n._Boot.HaxeError("Error: This Vec2 is not disposable");var m=e.zpp_inner;e.zpp_inner.outer=null,e.zpp_inner=null;var P=e;P.zpp_pool=null,null!=t.util.ZPP_PubPool.nextVec2?t.util.ZPP_PubPool.nextVec2.zpp_pool=P:t.util.ZPP_PubPool.poolVec2=P,t.util.ZPP_PubPool.nextVec2=P,P.zpp_disp=!0;var f=m;null!=f.outer&&(f.outer.zpp_inner=null,f.outer=null),f._isimmutable=null,f._validate=null,f._invalidate=null,f.next=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=f}return null==this.zpp_inner.wrap_gravity&&this.zpp_inner.getgravity(),this.zpp_inner.wrap_gravity},Object.defineProperty(e.space.Space.prototype,"broadphase",{get:e.space.Space.prototype.get_broadphase}),e.space.Space.prototype.get_broadphase=function(){return this.zpp_inner.bphase.is_sweep?(null==t.util.ZPP_Flags.Broadphase_SWEEP_AND_PRUNE&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.Broadphase_SWEEP_AND_PRUNE=new e.space.Broadphase,t.util.ZPP_Flags.internal=!1),t.util.ZPP_Flags.Broadphase_SWEEP_AND_PRUNE):(null==t.util.ZPP_Flags.Broadphase_DYNAMIC_AABB_TREE&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.Broadphase_DYNAMIC_AABB_TREE=new e.space.Broadphase,t.util.ZPP_Flags.internal=!1),t.util.ZPP_Flags.Broadphase_DYNAMIC_AABB_TREE)},Object.defineProperty(e.space.Space.prototype,"sortContacts",{get:e.space.Space.prototype.get_sortContacts,set:e.space.Space.prototype.set_sortContacts}),e.space.Space.prototype.get_sortContacts=function(){return this.zpp_inner.sortcontacts},e.space.Space.prototype.set_sortContacts=function(e){return this.zpp_inner.sortcontacts=e,this.zpp_inner.sortcontacts},Object.defineProperty(e.space.Space.prototype,"worldAngularDrag",{get:e.space.Space.prototype.get_worldAngularDrag,set:e.space.Space.prototype.set_worldAngularDrag}),e.space.Space.prototype.get_worldAngularDrag=function(){return this.zpp_inner.global_ang_drag},e.space.Space.prototype.set_worldAngularDrag=function(e){var t=e;if(t!=t)throw new n._Boot.HaxeError("Error: Space::worldAngularDrag cannot be NaN");return this.zpp_inner.global_ang_drag=t,this.zpp_inner.global_ang_drag},Object.defineProperty(e.space.Space.prototype,"worldLinearDrag",{get:e.space.Space.prototype.get_worldLinearDrag,set:e.space.Space.prototype.set_worldLinearDrag}),e.space.Space.prototype.get_worldLinearDrag=function(){return this.zpp_inner.global_lin_drag},e.space.Space.prototype.set_worldLinearDrag=function(e){var t=e;if(t!=t)throw new n._Boot.HaxeError("Error: Space::worldLinearDrag cannot be NaN");return this.zpp_inner.global_lin_drag=t,this.zpp_inner.global_lin_drag},Object.defineProperty(e.space.Space.prototype,"compounds",{get:e.space.Space.prototype.get_compounds}),e.space.Space.prototype.get_compounds=function(){return this.zpp_inner.wrap_compounds},Object.defineProperty(e.space.Space.prototype,"bodies",{get:e.space.Space.prototype.get_bodies}),e.space.Space.prototype.get_bodies=function(){return this.zpp_inner.wrap_bodies},Object.defineProperty(e.space.Space.prototype,"liveBodies",{get:e.space.Space.prototype.get_liveBodies}),e.space.Space.prototype.get_liveBodies=function(){return this.zpp_inner.wrap_live},Object.defineProperty(e.space.Space.prototype,"constraints",{get:e.space.Space.prototype.get_constraints}),e.space.Space.prototype.get_constraints=function(){return this.zpp_inner.wrap_constraints},Object.defineProperty(e.space.Space.prototype,"liveConstraints",{get:e.space.Space.prototype.get_liveConstraints}),e.space.Space.prototype.get_liveConstraints=function(){return this.zpp_inner.wrap_livecon},e.space.Space.prototype.visitBodies=function(t){if(null==t)throw new n._Boot.HaxeError("Error: lambda cannot be null for Space::visitBodies");var i=this.zpp_inner.wrap_bodies;i.zpp_inner.valmod();for(var r=e.phys.BodyIterator.get(i);;){r.zpp_inner.zpp_inner.valmod();var o=r.zpp_inner;o.zpp_inner.valmod(),o.zpp_inner.zip_length&&(o.zpp_inner.zip_length=!1,o.zpp_inner.user_length=o.zpp_inner.inner.length);var a,s=o.zpp_inner.user_length;if(r.zpp_critical=!0,r.zpp_i<s?a=!0:(r.zpp_next=e.phys.BodyIterator.zpp_pool,e.phys.BodyIterator.zpp_pool=r,r.zpp_inner=null,a=!1),!a)break;r.zpp_critical=!1,t(r.zpp_inner.at(r.zpp_i++))}var l=this.zpp_inner.wrap_compounds;l.zpp_inner.valmod();for(var p=e.phys.CompoundIterator.get(l);;){p.zpp_inner.zpp_inner.valmod();var u=p.zpp_inner;u.zpp_inner.valmod(),u.zpp_inner.zip_length&&(u.zpp_inner.zip_length=!1,u.zpp_inner.user_length=u.zpp_inner.inner.length);var h,c=u.zpp_inner.user_length;if(p.zpp_critical=!0,p.zpp_i<c?h=!0:(p.zpp_next=e.phys.CompoundIterator.zpp_pool,e.phys.CompoundIterator.zpp_pool=p,p.zpp_inner=null,h=!1),!h)break;p.zpp_critical=!1,p.zpp_inner.at(p.zpp_i++).visitBodies(t)}},e.space.Space.prototype.visitConstraints=function(t){if(null==t)throw new n._Boot.HaxeError("Error: lambda cannot be null for Space::visitConstraints");var i=this.zpp_inner.wrap_constraints;i.zpp_inner.valmod();for(var r=e.constraint.ConstraintIterator.get(i);;){r.zpp_inner.zpp_inner.valmod();var o=r.zpp_inner;o.zpp_inner.valmod(),o.zpp_inner.zip_length&&(o.zpp_inner.zip_length=!1,o.zpp_inner.user_length=o.zpp_inner.inner.length);var a,s=o.zpp_inner.user_length;if(r.zpp_critical=!0,r.zpp_i<s?a=!0:(r.zpp_next=e.constraint.ConstraintIterator.zpp_pool,e.constraint.ConstraintIterator.zpp_pool=r,r.zpp_inner=null,a=!1),!a)break;r.zpp_critical=!1,t(r.zpp_inner.at(r.zpp_i++))}var l=this.zpp_inner.wrap_compounds;l.zpp_inner.valmod();for(var p=e.phys.CompoundIterator.get(l);;){p.zpp_inner.zpp_inner.valmod();var u=p.zpp_inner;u.zpp_inner.valmod(),u.zpp_inner.zip_length&&(u.zpp_inner.zip_length=!1,u.zpp_inner.user_length=u.zpp_inner.inner.length);var h,c=u.zpp_inner.user_length;if(p.zpp_critical=!0,p.zpp_i<c?h=!0:(p.zpp_next=e.phys.CompoundIterator.zpp_pool,e.phys.CompoundIterator.zpp_pool=p,p.zpp_inner=null,h=!1),!h)break;p.zpp_critical=!1,p.zpp_inner.at(p.zpp_i++).visitConstraints(t)}},e.space.Space.prototype.visitCompounds=function(t){if(null==t)throw new n._Boot.HaxeError("Error: lambda cannot be null for Space::visitCompounds");var i=this.zpp_inner.wrap_compounds;i.zpp_inner.valmod();for(var r=e.phys.CompoundIterator.get(i);;){r.zpp_inner.zpp_inner.valmod();var o=r.zpp_inner;o.zpp_inner.valmod(),o.zpp_inner.zip_length&&(o.zpp_inner.zip_length=!1,o.zpp_inner.user_length=o.zpp_inner.inner.length);var a,s=o.zpp_inner.user_length;if(r.zpp_critical=!0,r.zpp_i<s?a=!0:(r.zpp_next=e.phys.CompoundIterator.zpp_pool,e.phys.CompoundIterator.zpp_pool=r,r.zpp_inner=null,a=!1),!a)break;r.zpp_critical=!1;var l=r.zpp_inner.at(r.zpp_i++);t(l),l.visitCompounds(t)}},Object.defineProperty(e.space.Space.prototype,"world",{get:e.space.Space.prototype.get_world}),e.space.Space.prototype.get_world=function(){return this.zpp_inner.__static},Object.defineProperty(e.space.Space.prototype,"arbiters",{get:e.space.Space.prototype.get_arbiters}),e.space.Space.prototype.get_arbiters=function(){if(null==this.zpp_inner.wrap_arbiters){var e=new t.dynamics.ZPP_SpaceArbiterList;e.space=this.zpp_inner,this.zpp_inner.wrap_arbiters=e}return this.zpp_inner.wrap_arbiters},Object.defineProperty(e.space.Space.prototype,"listeners",{get:e.space.Space.prototype.get_listeners}),e.space.Space.prototype.get_listeners=function(){return this.zpp_inner.wrap_listeners},e.space.Space.prototype.clear=function(){if(this.zpp_inner.midstep)throw new n._Boot.HaxeError("Error: Space::clear() cannot be called during space step()");this.zpp_inner.clear()},e.space.Space.prototype.step=function(e,t,i){if(null==i&&(i=10),null==t&&(t=10),e!=e)throw new n._Boot.HaxeError("Error: deltaTime cannot be NaN");if(e<=0)throw new n._Boot.HaxeError("Error: deltaTime must be strictly positive");if(t<=0)throw new n._Boot.HaxeError("Error: must use atleast one velocity iteration");if(i<=0)throw new n._Boot.HaxeError("Error: must use atleast one position iteration");this.zpp_inner.step(e,t,i)},Object.defineProperty(e.space.Space.prototype,"timeStamp",{get:e.space.Space.prototype.get_timeStamp}),e.space.Space.prototype.get_timeStamp=function(){return this.zpp_inner.stamp},Object.defineProperty(e.space.Space.prototype,"elapsedTime",{get:e.space.Space.prototype.get_elapsedTime}),e.space.Space.prototype.get_elapsedTime=function(){return this.zpp_inner.time},e.space.Space.prototype.interactionType=function(i,r){if(null==i||null==r)throw new n._Boot.HaxeError("Error: Cannot evaluate interaction type for null shapes");if(null==(null!=i.zpp_inner.body?i.zpp_inner.body.outer:null)||null==(null!=r.zpp_inner.body?r.zpp_inner.body.outer:null))throw new n._Boot.HaxeError("Error: Cannot evaluate interaction type for shapes not part of a Body");if(1==(null!=i.zpp_inner.body?i.zpp_inner.body.outer:null).zpp_inner.type&&1==(null!=r.zpp_inner.body?r.zpp_inner.body.outer:null).zpp_inner.type)return null;if((null!=i.zpp_inner.body?i.zpp_inner.body.outer:null)==(null!=r.zpp_inner.body?r.zpp_inner.body.outer:null))return null;var o=i.zpp_inner,a=r.zpp_inner;this.zpp_inner;var s,l=o.body,p=a.body;s=!1;for(var u,h,c=l.constraints.head;null!=c;){var _=c.elt;if(_.ignore&&_.pair_exists(l.id,p.id)){s=!0;break}c=c.next}if(s)h=!1;else{for(var d=o;null!=d&&null==d.group;)d=null!=d.ishape?d.ishape.body:null!=d.icompound?d.icompound.compound:d.ibody.compound;var m,P=null==d?null:d.group;if(null==P)m=!1;else{for(var f=a;null!=f&&null==f.group;)f=null!=f.ishape?f.ishape.body:null!=f.icompound?f.icompound.compound:f.ibody.compound;var x=null==f?null:f.group;if(null==x)m=!1;else{for(var y=!1;null!=P&&null!=x;){if(P==x){y=P.ignore;break}P.depth<x.depth?x=x.group:P=P.group}m=y}}h=!m}if(h){var v;if(o.sensorEnabled||a.sensorEnabled){var g=o.filter,b=a.filter;v=0!=(g.sensorMask&b.sensorGroup)&&0!=(b.sensorMask&g.sensorGroup)}else v=!1;if(v)u=2;else{var z;if(o.fluidEnabled||a.fluidEnabled){var w=o.filter,Z=a.filter;z=0!=(w.fluidMask&Z.fluidGroup)&&0!=(Z.fluidMask&w.fluidGroup)}else z=!1;if(!z||0==l.imass&&0==p.imass&&0==l.iinertia&&0==p.iinertia){var E=o.filter,M=a.filter;u=0==(E.collisionMask&M.collisionGroup)||0==(M.collisionMask&E.collisionGroup)||0==l.imass&&0==p.imass&&0==l.iinertia&&0==p.iinertia?-1:1}else u=0}}else u=-1;switch(u){case 0:return null==t.util.ZPP_Flags.InteractionType_FLUID&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.InteractionType_FLUID=new e.callbacks.InteractionType,t.util.ZPP_Flags.internal=!1),t.util.ZPP_Flags.InteractionType_FLUID;case 1:return null==t.util.ZPP_Flags.InteractionType_COLLISION&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.InteractionType_COLLISION=new e.callbacks.InteractionType,t.util.ZPP_Flags.internal=!1),t.util.ZPP_Flags.InteractionType_COLLISION;case 2:return null==t.util.ZPP_Flags.InteractionType_SENSOR&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.InteractionType_SENSOR=new e.callbacks.InteractionType,t.util.ZPP_Flags.internal=!1),t.util.ZPP_Flags.InteractionType_SENSOR;default:return null}},e.space.Space.prototype.shapesUnderPoint=function(e,i,r){if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");if(null==e)throw new n._Boot.HaxeError("Error: Cannot evaluate shapes under a null point :)");var o=this.zpp_inner;if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var a=e.zpp_inner;null!=a._validate&&a._validate();var s=e.zpp_inner.x;if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var l=e.zpp_inner;null!=l._validate&&l._validate();var p=o.shapesUnderPoint(s,e.zpp_inner.y,null==i?null:i.zpp_inner,r);if(e.zpp_inner.weak){if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var u=e.zpp_inner;if(u._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=u._isimmutable&&u._isimmutable(),e.zpp_inner._inuse)throw new n._Boot.HaxeError("Error: This Vec2 is not disposable");var h=e.zpp_inner;e.zpp_inner.outer=null,e.zpp_inner=null;var c=e;c.zpp_pool=null,null!=t.util.ZPP_PubPool.nextVec2?t.util.ZPP_PubPool.nextVec2.zpp_pool=c:t.util.ZPP_PubPool.poolVec2=c,t.util.ZPP_PubPool.nextVec2=c,c.zpp_disp=!0;var _=h;null!=_.outer&&(_.outer.zpp_inner=null,_.outer=null),_._isimmutable=null,_._validate=null,_._invalidate=null,_.next=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=_}return p},e.space.Space.prototype.bodiesUnderPoint=function(e,i,r){if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");if(null==e)throw new n._Boot.HaxeError("Error: Cannot evaluate objects under a null point :)");var o=this.zpp_inner;if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var a=e.zpp_inner;null!=a._validate&&a._validate();var s=e.zpp_inner.x;if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var l=e.zpp_inner;null!=l._validate&&l._validate();var p=o.bodiesUnderPoint(s,e.zpp_inner.y,null==i?null:i.zpp_inner,r);if(e.zpp_inner.weak){if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var u=e.zpp_inner;if(u._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=u._isimmutable&&u._isimmutable(),e.zpp_inner._inuse)throw new n._Boot.HaxeError("Error: This Vec2 is not disposable");var h=e.zpp_inner;e.zpp_inner.outer=null,e.zpp_inner=null;var c=e;c.zpp_pool=null,null!=t.util.ZPP_PubPool.nextVec2?t.util.ZPP_PubPool.nextVec2.zpp_pool=c:t.util.ZPP_PubPool.poolVec2=c,t.util.ZPP_PubPool.nextVec2=c,c.zpp_disp=!0;var _=h;null!=_.outer&&(_.outer.zpp_inner=null,_.outer=null),_._isimmutable=null,_._validate=null,_._invalidate=null,_.next=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=_}return p},e.space.Space.prototype.shapesInAABB=function(e,t,i,r,o){if(null==i&&(i=!0),null==t&&(t=!1),null==e)throw new n._Boot.HaxeError("Error: Cannot evaluate shapes in a null AABB :)");var a,s=e.zpp_inner;null!=s._validate&&s._validate();var l=e.zpp_inner;if(l.maxx-l.minx!=0){var p=e.zpp_inner;null!=p._validate&&p._validate();var u=e.zpp_inner;a=u.maxy-u.miny==0}else a=!0;if(a)throw new n._Boot.HaxeError("Error: Cannot evaluate shapes in degenerate AABB :/");return this.zpp_inner.shapesInAABB(e,i,t,null==r?null:r.zpp_inner,o)},e.space.Space.prototype.bodiesInAABB=function(e,t,i,r,o){if(null==i&&(i=!0),null==t&&(t=!1),null==e)throw new n._Boot.HaxeError("Error: Cannot evaluate objects in a null AABB :)");var a,s=e.zpp_inner;null!=s._validate&&s._validate();var l=e.zpp_inner;if(l.maxx-l.minx!=0){var p=e.zpp_inner;null!=p._validate&&p._validate();var u=e.zpp_inner;a=u.maxy-u.miny==0}else a=!0;if(a)throw new n._Boot.HaxeError("Error: Cannot evaluate objects in degenerate AABB :/");return this.zpp_inner.bodiesInAABB(e,i,t,null==r?null:r.zpp_inner,o)},e.space.Space.prototype.shapesInCircle=function(e,i,r,o,a){if(null==r&&(r=!1),null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");if(null==e)throw new n._Boot.HaxeError("Error: Cannot evaluate shapes at null circle :)");if(i!=i)throw new n._Boot.HaxeError("Error: Circle radius cannot be NaN");if(i<=0)throw new n._Boot.HaxeError("Error: Circle radius must be strictly positive");var s=this.zpp_inner.shapesInCircle(e,i,r,null==o?null:o.zpp_inner,a);if(e.zpp_inner.weak){if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var l=e.zpp_inner;if(l._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=l._isimmutable&&l._isimmutable(),e.zpp_inner._inuse)throw new n._Boot.HaxeError("Error: This Vec2 is not disposable");var p=e.zpp_inner;e.zpp_inner.outer=null,e.zpp_inner=null;var u=e;u.zpp_pool=null,null!=t.util.ZPP_PubPool.nextVec2?t.util.ZPP_PubPool.nextVec2.zpp_pool=u:t.util.ZPP_PubPool.poolVec2=u,t.util.ZPP_PubPool.nextVec2=u,u.zpp_disp=!0;var h=p;null!=h.outer&&(h.outer.zpp_inner=null,h.outer=null),h._isimmutable=null,h._validate=null,h._invalidate=null,h.next=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=h}return s},e.space.Space.prototype.bodiesInCircle=function(e,i,r,o,a){if(null==r&&(r=!1),null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");if(null==e)throw new n._Boot.HaxeError("Error: Cannot evaluate objects at null circle :)");if(i!=i)throw new n._Boot.HaxeError("Error: Circle radius cannot be NaN");if(i<=0)throw new n._Boot.HaxeError("Error: Circle radius must be strictly positive");var s=this.zpp_inner.bodiesInCircle(e,i,r,null==o?null:o.zpp_inner,a);if(e.zpp_inner.weak){if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var l=e.zpp_inner;if(l._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=l._isimmutable&&l._isimmutable(),e.zpp_inner._inuse)throw new n._Boot.HaxeError("Error: This Vec2 is not disposable");var p=e.zpp_inner;e.zpp_inner.outer=null,e.zpp_inner=null;var u=e;u.zpp_pool=null,null!=t.util.ZPP_PubPool.nextVec2?t.util.ZPP_PubPool.nextVec2.zpp_pool=u:t.util.ZPP_PubPool.poolVec2=u,t.util.ZPP_PubPool.nextVec2=u,u.zpp_disp=!0;var h=p;null!=h.outer&&(h.outer.zpp_inner=null,h.outer=null),h._isimmutable=null,h._validate=null,h._invalidate=null,h.next=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=h}return s},e.space.Space.prototype.shapesInShape=function(i,r,o,a){if(null==r&&(r=!1),null==i)throw new n._Boot.HaxeError("Error: Cannot evaluate shapes in a null shapes :)");if(null==(null!=i.zpp_inner.body?i.zpp_inner.body.outer:null))throw new n._Boot.HaxeError("Error: Query shape needs to be inside a Body to be well defined :)");if(1==i.zpp_inner.type){var s=i.zpp_inner.polygon.valid();if(null==t.util.ZPP_Flags.ValidationResult_VALID&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.ValidationResult_VALID=new e.shape.ValidationResult,t.util.ZPP_Flags.internal=!1),s!=t.util.ZPP_Flags.ValidationResult_VALID)throw new n._Boot.HaxeError("Error: Polygon query shape is invalid : "+s.toString())}return this.zpp_inner.shapesInShape(i.zpp_inner,r,null==o?null:o.zpp_inner,a)},e.space.Space.prototype.bodiesInShape=function(i,r,o,a){if(null==r&&(r=!1),null==i)throw new n._Boot.HaxeError("Error: Cannot evaluate bodies in a null shapes :)");if(null==(null!=i.zpp_inner.body?i.zpp_inner.body.outer:null))throw new n._Boot.HaxeError("Error: Query shape needs to be inside a Body to be well defined :)");if(1==i.zpp_inner.type){var s=i.zpp_inner.polygon.valid();if(null==t.util.ZPP_Flags.ValidationResult_VALID&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.ValidationResult_VALID=new e.shape.ValidationResult,t.util.ZPP_Flags.internal=!1),s!=t.util.ZPP_Flags.ValidationResult_VALID)throw new n._Boot.HaxeError("Error: Polygon query shape is invalid : "+s.toString())}return this.zpp_inner.bodiesInShape(i.zpp_inner,r,null==o?null:o.zpp_inner,a)},e.space.Space.prototype.shapesInBody=function(t,i,r){if(null==t)throw new n._Boot.HaxeError("Error: Cannot evaluate shapes in null body");var o=null==r?new e.shape.ShapeList:r,a=t.zpp_inner.wrap_shapes;a.zpp_inner.valmod();for(var s=e.shape.ShapeIterator.get(a);;){s.zpp_inner.zpp_inner.valmod();var l=s.zpp_inner;l.zpp_inner.valmod(),l.zpp_inner.zip_length&&(l.zpp_inner.zip_length=!1,l.zpp_inner.user_length=l.zpp_inner.inner.length);var p,u=l.zpp_inner.user_length;if(s.zpp_critical=!0,s.zpp_i<u?p=!0:(s.zpp_next=e.shape.ShapeIterator.zpp_pool,e.shape.ShapeIterator.zpp_pool=s,s.zpp_inner=null,p=!1),!p)break;s.zpp_critical=!1;var h=s.zpp_inner.at(s.zpp_i++);this.shapesInShape(h,!1,i,o)}return o},e.space.Space.prototype.bodiesInBody=function(t,i,r){if(null==t)throw new n._Boot.HaxeError("Error: Cannot evaluate shapes in null body");var o=null==r?new e.phys.BodyList:r,a=t.zpp_inner.wrap_shapes;a.zpp_inner.valmod();for(var s=e.shape.ShapeIterator.get(a);;){s.zpp_inner.zpp_inner.valmod();var l=s.zpp_inner;l.zpp_inner.valmod(),l.zpp_inner.zip_length&&(l.zpp_inner.zip_length=!1,l.zpp_inner.user_length=l.zpp_inner.inner.length);var p,u=l.zpp_inner.user_length;if(s.zpp_critical=!0,s.zpp_i<u?p=!0:(s.zpp_next=e.shape.ShapeIterator.zpp_pool,e.shape.ShapeIterator.zpp_pool=s,s.zpp_inner=null,p=!1),!p)break;s.zpp_critical=!1;var h=s.zpp_inner.at(s.zpp_i++);this.bodiesInShape(h,!1,i,o)}return o},e.space.Space.prototype.convexCast=function(e,t,i,r){if(null==i&&(i=!1),null==e)throw new n._Boot.HaxeError("Error: Cannot cast null shape :)");if(null==(null!=e.zpp_inner.body?e.zpp_inner.body.outer:null))throw new n._Boot.HaxeError("Error: Shape must belong to a body to be cast.");if(t<0||t!=t)throw new n._Boot.HaxeError("Error: deltaTime must be positive");return this.zpp_inner.convexCast(e.zpp_inner,t,r,i)},e.space.Space.prototype.convexMultiCast=function(e,t,i,r,o){if(null==i&&(i=!1),null==e)throw new n._Boot.HaxeError("Error: Cannot cast null shape :)");if(null==(null!=e.zpp_inner.body?e.zpp_inner.body.outer:null))throw new n._Boot.HaxeError("Error: Shape must belong to a body to be cast.");if(t<0||t!=t)throw new n._Boot.HaxeError("Error: deltaTime must be positive");return this.zpp_inner.convexMultiCast(e.zpp_inner,t,r,i,o)},e.space.Space.prototype.rayCast=function(e,t,i){if(null==t&&(t=!1),null==e)throw new n._Boot.HaxeError("Error: Cannot cast null ray :)");return this.zpp_inner.rayCast(e,t,i)},e.space.Space.prototype.rayMultiCast=function(e,t,i,r){if(null==t&&(t=!1),null==e)throw new n._Boot.HaxeError("Error: Cannot cast null ray :)");return this.zpp_inner.rayMultiCast(e,t,i,r)},e.space.Space.prototype.__class__=e.space.Space,e.util||(e.util={}),e.util.Debug=l["nape.util.Debug"]=function(){},e.util.Debug.__name__=["nape","util","Debug"],e.util.Debug.version=function(){return"Nape 2.0.19"},e.util.Debug.clearObjectPools=function(){for(;null!=e.constraint.ConstraintIterator.zpp_pool;){var n=e.constraint.ConstraintIterator.zpp_pool.zpp_next;e.constraint.ConstraintIterator.zpp_pool.zpp_next=null,e.constraint.ConstraintIterator.zpp_pool=n}for(;null!=e.phys.InteractorIterator.zpp_pool;){var i=e.phys.InteractorIterator.zpp_pool.zpp_next;e.phys.InteractorIterator.zpp_pool.zpp_next=null,e.phys.InteractorIterator.zpp_pool=i}for(;null!=e.phys.BodyIterator.zpp_pool;){var r=e.phys.BodyIterator.zpp_pool.zpp_next;e.phys.BodyIterator.zpp_pool.zpp_next=null,e.phys.BodyIterator.zpp_pool=r}for(;null!=e.phys.CompoundIterator.zpp_pool;){var o=e.phys.CompoundIterator.zpp_pool.zpp_next;e.phys.CompoundIterator.zpp_pool.zpp_next=null,e.phys.CompoundIterator.zpp_pool=o}for(;null!=e.callbacks.ListenerIterator.zpp_pool;){var a=e.callbacks.ListenerIterator.zpp_pool.zpp_next;e.callbacks.ListenerIterator.zpp_pool.zpp_next=null,e.callbacks.ListenerIterator.zpp_pool=a}for(;null!=e.callbacks.CbTypeIterator.zpp_pool;){var s=e.callbacks.CbTypeIterator.zpp_pool.zpp_next;e.callbacks.CbTypeIterator.zpp_pool.zpp_next=null,e.callbacks.CbTypeIterator.zpp_pool=s}for(;null!=e.geom.ConvexResultIterator.zpp_pool;){var l=e.geom.ConvexResultIterator.zpp_pool.zpp_next;e.geom.ConvexResultIterator.zpp_pool.zpp_next=null,e.geom.ConvexResultIterator.zpp_pool=l}for(;null!=e.geom.GeomPolyIterator.zpp_pool;){var p=e.geom.GeomPolyIterator.zpp_pool.zpp_next;e.geom.GeomPolyIterator.zpp_pool.zpp_next=null,e.geom.GeomPolyIterator.zpp_pool=p}for(;null!=e.geom.Vec2Iterator.zpp_pool;){var u=e.geom.Vec2Iterator.zpp_pool.zpp_next;e.geom.Vec2Iterator.zpp_pool.zpp_next=null,e.geom.Vec2Iterator.zpp_pool=u}for(;null!=e.geom.RayResultIterator.zpp_pool;){var h=e.geom.RayResultIterator.zpp_pool.zpp_next;e.geom.RayResultIterator.zpp_pool.zpp_next=null,e.geom.RayResultIterator.zpp_pool=h}for(;null!=e.shape.ShapeIterator.zpp_pool;){var c=e.shape.ShapeIterator.zpp_pool.zpp_next;e.shape.ShapeIterator.zpp_pool.zpp_next=null,e.shape.ShapeIterator.zpp_pool=c}for(;null!=e.shape.EdgeIterator.zpp_pool;){var _=e.shape.EdgeIterator.zpp_pool.zpp_next;e.shape.EdgeIterator.zpp_pool.zpp_next=null,e.shape.EdgeIterator.zpp_pool=_}for(;null!=e.dynamics.ContactIterator.zpp_pool;){var d=e.dynamics.ContactIterator.zpp_pool.zpp_next;e.dynamics.ContactIterator.zpp_pool.zpp_next=null,e.dynamics.ContactIterator.zpp_pool=d}for(;null!=e.dynamics.ArbiterIterator.zpp_pool;){var m=e.dynamics.ArbiterIterator.zpp_pool.zpp_next;e.dynamics.ArbiterIterator.zpp_pool.zpp_next=null,e.dynamics.ArbiterIterator.zpp_pool=m}for(;null!=e.dynamics.InteractionGroupIterator.zpp_pool;){var P=e.dynamics.InteractionGroupIterator.zpp_pool.zpp_next;e.dynamics.InteractionGroupIterator.zpp_pool.zpp_next=null,e.dynamics.InteractionGroupIterator.zpp_pool=P}for(;null!=t.util.ZNPNode_ZPP_CbType.zpp_pool;){var f=t.util.ZNPNode_ZPP_CbType.zpp_pool.next;t.util.ZNPNode_ZPP_CbType.zpp_pool.next=null,t.util.ZNPNode_ZPP_CbType.zpp_pool=f}for(;null!=t.util.ZNPNode_ZPP_CallbackSet.zpp_pool;){var x=t.util.ZNPNode_ZPP_CallbackSet.zpp_pool.next;t.util.ZNPNode_ZPP_CallbackSet.zpp_pool.next=null,t.util.ZNPNode_ZPP_CallbackSet.zpp_pool=x}for(;null!=t.phys.ZPP_Material.zpp_pool;){var y=t.phys.ZPP_Material.zpp_pool.next;t.phys.ZPP_Material.zpp_pool.next=null,t.phys.ZPP_Material.zpp_pool=y}for(;null!=t.util.ZNPNode_ZPP_Shape.zpp_pool;){var v=t.util.ZNPNode_ZPP_Shape.zpp_pool.next;t.util.ZNPNode_ZPP_Shape.zpp_pool.next=null,t.util.ZNPNode_ZPP_Shape.zpp_pool=v}for(;null!=t.phys.ZPP_FluidProperties.zpp_pool;){var g=t.phys.ZPP_FluidProperties.zpp_pool.next;t.phys.ZPP_FluidProperties.zpp_pool.next=null,t.phys.ZPP_FluidProperties.zpp_pool=g}for(;null!=t.util.ZNPNode_ZPP_Body.zpp_pool;){var b=t.util.ZNPNode_ZPP_Body.zpp_pool.next;t.util.ZNPNode_ZPP_Body.zpp_pool.next=null,t.util.ZNPNode_ZPP_Body.zpp_pool=b}for(;null!=t.util.ZNPNode_ZPP_Constraint.zpp_pool;){var z=t.util.ZNPNode_ZPP_Constraint.zpp_pool.next;t.util.ZNPNode_ZPP_Constraint.zpp_pool.next=null,t.util.ZNPNode_ZPP_Constraint.zpp_pool=z}for(;null!=t.util.ZNPNode_ZPP_Compound.zpp_pool;){var w=t.util.ZNPNode_ZPP_Compound.zpp_pool.next;t.util.ZNPNode_ZPP_Compound.zpp_pool.next=null,t.util.ZNPNode_ZPP_Compound.zpp_pool=w}for(;null!=t.util.ZNPNode_ZPP_Arbiter.zpp_pool;){var Z=t.util.ZNPNode_ZPP_Arbiter.zpp_pool.next;t.util.ZNPNode_ZPP_Arbiter.zpp_pool.next=null,t.util.ZNPNode_ZPP_Arbiter.zpp_pool=Z}for(;null!=t.util.ZPP_Set_ZPP_Body.zpp_pool;){var E=t.util.ZPP_Set_ZPP_Body.zpp_pool.next;t.util.ZPP_Set_ZPP_Body.zpp_pool.next=null,t.util.ZPP_Set_ZPP_Body.zpp_pool=E}for(;null!=t.callbacks.ZPP_CbSetPair.zpp_pool;){var M=t.callbacks.ZPP_CbSetPair.zpp_pool.next;t.callbacks.ZPP_CbSetPair.zpp_pool.next=null,t.callbacks.ZPP_CbSetPair.zpp_pool=M}for(;null!=t.util.ZNPNode_ZPP_InteractionListener.zpp_pool;){var S=t.util.ZNPNode_ZPP_InteractionListener.zpp_pool.next;t.util.ZNPNode_ZPP_InteractionListener.zpp_pool.next=null,t.util.ZNPNode_ZPP_InteractionListener.zpp_pool=S}for(;null!=t.util.ZNPNode_ZPP_CbSet.zpp_pool;){var C=t.util.ZNPNode_ZPP_CbSet.zpp_pool.next;t.util.ZNPNode_ZPP_CbSet.zpp_pool.next=null,t.util.ZNPNode_ZPP_CbSet.zpp_pool=C}for(;null!=t.util.ZNPNode_ZPP_Interactor.zpp_pool;){var N=t.util.ZNPNode_ZPP_Interactor.zpp_pool.next;t.util.ZNPNode_ZPP_Interactor.zpp_pool.next=null,t.util.ZNPNode_ZPP_Interactor.zpp_pool=N}for(;null!=t.util.ZNPNode_ZPP_BodyListener.zpp_pool;){var A=t.util.ZNPNode_ZPP_BodyListener.zpp_pool.next;t.util.ZNPNode_ZPP_BodyListener.zpp_pool.next=null,t.util.ZNPNode_ZPP_BodyListener.zpp_pool=A}for(;null!=t.callbacks.ZPP_Callback.zpp_pool;){var L=t.callbacks.ZPP_Callback.zpp_pool.next;t.callbacks.ZPP_Callback.zpp_pool.next=null,t.callbacks.ZPP_Callback.zpp_pool=L}for(;null!=t.callbacks.ZPP_CbSet.zpp_pool;){var B=t.callbacks.ZPP_CbSet.zpp_pool.next;t.callbacks.ZPP_CbSet.zpp_pool.next=null,t.callbacks.ZPP_CbSet.zpp_pool=B}for(;null!=t.util.ZNPNode_ZPP_CbSetPair.zpp_pool;){var T=t.util.ZNPNode_ZPP_CbSetPair.zpp_pool.next;t.util.ZNPNode_ZPP_CbSetPair.zpp_pool.next=null,t.util.ZNPNode_ZPP_CbSetPair.zpp_pool=T}for(;null!=t.util.ZNPNode_ZPP_ConstraintListener.zpp_pool;){var V=t.util.ZNPNode_ZPP_ConstraintListener.zpp_pool.next;t.util.ZNPNode_ZPP_ConstraintListener.zpp_pool.next=null,t.util.ZNPNode_ZPP_ConstraintListener.zpp_pool=V}for(;null!=t.geom.ZPP_GeomVert.zpp_pool;){var k=t.geom.ZPP_GeomVert.zpp_pool.next;t.geom.ZPP_GeomVert.zpp_pool.next=null,t.geom.ZPP_GeomVert.zpp_pool=k}for(;null!=t.geom.ZPP_GeomVertexIterator.zpp_pool;){var I=t.geom.ZPP_GeomVertexIterator.zpp_pool.next;t.geom.ZPP_GeomVertexIterator.zpp_pool.next=null,t.geom.ZPP_GeomVertexIterator.zpp_pool=I}for(;null!=t.geom.ZPP_Mat23.zpp_pool;){var O=t.geom.ZPP_Mat23.zpp_pool.next;t.geom.ZPP_Mat23.zpp_pool.next=null,t.geom.ZPP_Mat23.zpp_pool=O}for(;null!=t.util.ZPP_Set_ZPP_CbSetPair.zpp_pool;){var R=t.util.ZPP_Set_ZPP_CbSetPair.zpp_pool.next;t.util.ZPP_Set_ZPP_CbSetPair.zpp_pool.next=null,t.util.ZPP_Set_ZPP_CbSetPair.zpp_pool=R}for(;null!=t.geom.ZPP_CutVert.zpp_pool;){var H=t.geom.ZPP_CutVert.zpp_pool.next;t.geom.ZPP_CutVert.zpp_pool.next=null,t.geom.ZPP_CutVert.zpp_pool=H}for(;null!=t.geom.ZPP_CutInt.zpp_pool;){var F=t.geom.ZPP_CutInt.zpp_pool.next;t.geom.ZPP_CutInt.zpp_pool.next=null,t.geom.ZPP_CutInt.zpp_pool=F}for(;null!=t.util.ZNPNode_ZPP_CutInt.zpp_pool;){var D=t.util.ZNPNode_ZPP_CutInt.zpp_pool.next;t.util.ZNPNode_ZPP_CutInt.zpp_pool.next=null,t.util.ZNPNode_ZPP_CutInt.zpp_pool=D}for(;null!=t.util.ZNPNode_ZPP_CutVert.zpp_pool;){var G=t.util.ZNPNode_ZPP_CutVert.zpp_pool.next;t.util.ZNPNode_ZPP_CutVert.zpp_pool.next=null,t.util.ZNPNode_ZPP_CutVert.zpp_pool=G}for(;null!=t.geom.ZPP_Vec2.zpp_pool;){var U=t.geom.ZPP_Vec2.zpp_pool.next;t.geom.ZPP_Vec2.zpp_pool.next=null,t.geom.ZPP_Vec2.zpp_pool=U}for(;null!=t.util.ZNPNode_ZPP_PartitionVertex.zpp_pool;){var j=t.util.ZNPNode_ZPP_PartitionVertex.zpp_pool.next;t.util.ZNPNode_ZPP_PartitionVertex.zpp_pool.next=null,t.util.ZNPNode_ZPP_PartitionVertex.zpp_pool=j}for(;null!=t.geom.ZPP_PartitionVertex.zpp_pool;){var W=t.geom.ZPP_PartitionVertex.zpp_pool.next;t.geom.ZPP_PartitionVertex.zpp_pool.next=null,t.geom.ZPP_PartitionVertex.zpp_pool=W}for(;null!=t.util.ZPP_Set_ZPP_PartitionVertex.zpp_pool;){var q=t.util.ZPP_Set_ZPP_PartitionVertex.zpp_pool.next;t.util.ZPP_Set_ZPP_PartitionVertex.zpp_pool.next=null,t.util.ZPP_Set_ZPP_PartitionVertex.zpp_pool=q}for(;null!=t.geom.ZPP_SimplifyV.zpp_pool;){var J=t.geom.ZPP_SimplifyV.zpp_pool.next;t.geom.ZPP_SimplifyV.zpp_pool.next=null,t.geom.ZPP_SimplifyV.zpp_pool=J}for(;null!=t.geom.ZPP_SimplifyP.zpp_pool;){var $=t.geom.ZPP_SimplifyP.zpp_pool.next;t.geom.ZPP_SimplifyP.zpp_pool.next=null,t.geom.ZPP_SimplifyP.zpp_pool=$}for(;null!=t.geom.ZPP_PartitionedPoly.zpp_pool;){var X=t.geom.ZPP_PartitionedPoly.zpp_pool.next;t.geom.ZPP_PartitionedPoly.zpp_pool.next=null,t.geom.ZPP_PartitionedPoly.zpp_pool=X}for(;null!=t.util.ZNPNode_ZPP_SimplifyP.zpp_pool;){var Y=t.util.ZNPNode_ZPP_SimplifyP.zpp_pool.next;t.util.ZNPNode_ZPP_SimplifyP.zpp_pool.next=null,t.util.ZNPNode_ZPP_SimplifyP.zpp_pool=Y}for(;null!=t.util.ZNPNode_ZPP_PartitionedPoly.zpp_pool;){var K=t.util.ZNPNode_ZPP_PartitionedPoly.zpp_pool.next;t.util.ZNPNode_ZPP_PartitionedPoly.zpp_pool.next=null,t.util.ZNPNode_ZPP_PartitionedPoly.zpp_pool=K}for(;null!=t.geom.ZPP_PartitionPair.zpp_pool;){var Q=t.geom.ZPP_PartitionPair.zpp_pool.next;t.geom.ZPP_PartitionPair.zpp_pool.next=null,t.geom.ZPP_PartitionPair.zpp_pool=Q}for(;null!=t.util.ZPP_Set_ZPP_PartitionPair.zpp_pool;){var ee=t.util.ZPP_Set_ZPP_PartitionPair.zpp_pool.next;t.util.ZPP_Set_ZPP_PartitionPair.zpp_pool.next=null,t.util.ZPP_Set_ZPP_PartitionPair.zpp_pool=ee}for(;null!=t.util.ZNPNode_ZPP_GeomVert.zpp_pool;){var te=t.util.ZNPNode_ZPP_GeomVert.zpp_pool.next;t.util.ZNPNode_ZPP_GeomVert.zpp_pool.next=null,t.util.ZNPNode_ZPP_GeomVert.zpp_pool=te}for(;null!=t.geom.ZPP_AABB.zpp_pool;){var ne=t.geom.ZPP_AABB.zpp_pool.next;t.geom.ZPP_AABB.zpp_pool.next=null,t.geom.ZPP_AABB.zpp_pool=ne}for(;null!=t.util.ZPP_Set_ZPP_SimpleVert.zpp_pool;){var ie=t.util.ZPP_Set_ZPP_SimpleVert.zpp_pool.next;t.util.ZPP_Set_ZPP_SimpleVert.zpp_pool.next=null,t.util.ZPP_Set_ZPP_SimpleVert.zpp_pool=ie}for(;null!=t.geom.ZPP_SimpleVert.zpp_pool;){var re=t.geom.ZPP_SimpleVert.zpp_pool.next;t.geom.ZPP_SimpleVert.zpp_pool.next=null,t.geom.ZPP_SimpleVert.zpp_pool=re}for(;null!=t.geom.ZPP_SimpleSeg.zpp_pool;){var oe=t.geom.ZPP_SimpleSeg.zpp_pool.next;t.geom.ZPP_SimpleSeg.zpp_pool.next=null,t.geom.ZPP_SimpleSeg.zpp_pool=oe}for(;null!=t.util.ZPP_Set_ZPP_SimpleSeg.zpp_pool;){var ae=t.util.ZPP_Set_ZPP_SimpleSeg.zpp_pool.next;t.util.ZPP_Set_ZPP_SimpleSeg.zpp_pool.next=null,t.util.ZPP_Set_ZPP_SimpleSeg.zpp_pool=ae}for(;null!=t.util.ZPP_Set_ZPP_SimpleEvent.zpp_pool;){var se=t.util.ZPP_Set_ZPP_SimpleEvent.zpp_pool.next;t.util.ZPP_Set_ZPP_SimpleEvent.zpp_pool.next=null,t.util.ZPP_Set_ZPP_SimpleEvent.zpp_pool=se}for(;null!=t.geom.ZPP_SimpleEvent.zpp_pool;){var le=t.geom.ZPP_SimpleEvent.zpp_pool.next;t.geom.ZPP_SimpleEvent.zpp_pool.next=null,t.geom.ZPP_SimpleEvent.zpp_pool=le}for(;null!=t.util.Hashable2_Boolfalse.zpp_pool;){var pe=t.util.Hashable2_Boolfalse.zpp_pool.next;t.util.Hashable2_Boolfalse.zpp_pool.next=null,t.util.Hashable2_Boolfalse.zpp_pool=pe}for(;null!=t.geom.ZPP_ToiEvent.zpp_pool;){var ue=t.geom.ZPP_ToiEvent.zpp_pool.next;t.geom.ZPP_ToiEvent.zpp_pool.next=null,t.geom.ZPP_ToiEvent.zpp_pool=ue}for(;null!=t.util.ZNPNode_ZPP_SimpleVert.zpp_pool;){var he=t.util.ZNPNode_ZPP_SimpleVert.zpp_pool.next;t.util.ZNPNode_ZPP_SimpleVert.zpp_pool.next=null,t.util.ZNPNode_ZPP_SimpleVert.zpp_pool=he}for(;null!=t.util.ZNPNode_ZPP_SimpleEvent.zpp_pool;){var ce=t.util.ZNPNode_ZPP_SimpleEvent.zpp_pool.next;t.util.ZNPNode_ZPP_SimpleEvent.zpp_pool.next=null,t.util.ZNPNode_ZPP_SimpleEvent.zpp_pool=ce}for(;null!=t.geom.ZPP_MarchSpan.zpp_pool;){var _e=t.geom.ZPP_MarchSpan.zpp_pool.next;t.geom.ZPP_MarchSpan.zpp_pool.next=null,t.geom.ZPP_MarchSpan.zpp_pool=_e}for(;null!=t.geom.ZPP_MarchPair.zpp_pool;){var de=t.geom.ZPP_MarchPair.zpp_pool.next;t.geom.ZPP_MarchPair.zpp_pool.next=null,t.geom.ZPP_MarchPair.zpp_pool=de}for(;null!=t.util.ZNPNode_ZPP_Vec2.zpp_pool;){var me=t.util.ZNPNode_ZPP_Vec2.zpp_pool.next;t.util.ZNPNode_ZPP_Vec2.zpp_pool.next=null,t.util.ZNPNode_ZPP_Vec2.zpp_pool=me}for(;null!=t.shape.ZPP_Edge.zpp_pool;){var Pe=t.shape.ZPP_Edge.zpp_pool.next;t.shape.ZPP_Edge.zpp_pool.next=null,t.shape.ZPP_Edge.zpp_pool=Pe}for(;null!=t.util.ZNPNode_ZPP_AABBPair.zpp_pool;){var fe=t.util.ZNPNode_ZPP_AABBPair.zpp_pool.next;t.util.ZNPNode_ZPP_AABBPair.zpp_pool.next=null,t.util.ZNPNode_ZPP_AABBPair.zpp_pool=fe}for(;null!=t.util.ZNPNode_ZPP_Edge.zpp_pool;){var xe=t.util.ZNPNode_ZPP_Edge.zpp_pool.next;t.util.ZNPNode_ZPP_Edge.zpp_pool.next=null,t.util.ZNPNode_ZPP_Edge.zpp_pool=xe}for(;null!=t.space.ZPP_SweepData.zpp_pool;){var ye=t.space.ZPP_SweepData.zpp_pool.next;t.space.ZPP_SweepData.zpp_pool.next=null,t.space.ZPP_SweepData.zpp_pool=ye}for(;null!=t.space.ZPP_AABBNode.zpp_pool;){var ve=t.space.ZPP_AABBNode.zpp_pool.next;t.space.ZPP_AABBNode.zpp_pool.next=null,t.space.ZPP_AABBNode.zpp_pool=ve}for(;null!=t.space.ZPP_AABBPair.zpp_pool;){var ge=t.space.ZPP_AABBPair.zpp_pool.next;t.space.ZPP_AABBPair.zpp_pool.next=null,t.space.ZPP_AABBPair.zpp_pool=ge}for(;null!=t.util.ZNPNode_ZPP_AABBNode.zpp_pool;){var be=t.util.ZNPNode_ZPP_AABBNode.zpp_pool.next;t.util.ZNPNode_ZPP_AABBNode.zpp_pool.next=null,t.util.ZNPNode_ZPP_AABBNode.zpp_pool=be}for(;null!=t.dynamics.ZPP_Contact.zpp_pool;){var ze=t.dynamics.ZPP_Contact.zpp_pool.next;t.dynamics.ZPP_Contact.zpp_pool.next=null,t.dynamics.ZPP_Contact.zpp_pool=ze}for(;null!=t.util.ZNPNode_ZPP_Component.zpp_pool;){var we=t.util.ZNPNode_ZPP_Component.zpp_pool.next;t.util.ZNPNode_ZPP_Component.zpp_pool.next=null,t.util.ZNPNode_ZPP_Component.zpp_pool=we}for(;null!=t.space.ZPP_Island.zpp_pool;){var Ze=t.space.ZPP_Island.zpp_pool.next;t.space.ZPP_Island.zpp_pool.next=null,t.space.ZPP_Island.zpp_pool=Ze}for(;null!=t.space.ZPP_Component.zpp_pool;){var Ee=t.space.ZPP_Component.zpp_pool.next;t.space.ZPP_Component.zpp_pool.next=null,t.space.ZPP_Component.zpp_pool=Ee}for(;null!=t.space.ZPP_CallbackSet.zpp_pool;){var Me=t.space.ZPP_CallbackSet.zpp_pool.next;t.space.ZPP_CallbackSet.zpp_pool.next=null,t.space.ZPP_CallbackSet.zpp_pool=Me}for(;null!=t.dynamics.ZPP_SensorArbiter.zpp_pool;){var Se=t.dynamics.ZPP_SensorArbiter.zpp_pool.next;t.dynamics.ZPP_SensorArbiter.zpp_pool.next=null,t.dynamics.ZPP_SensorArbiter.zpp_pool=Se}for(;null!=t.dynamics.ZPP_FluidArbiter.zpp_pool;){var Ce=t.dynamics.ZPP_FluidArbiter.zpp_pool.next;t.dynamics.ZPP_FluidArbiter.zpp_pool.next=null,t.dynamics.ZPP_FluidArbiter.zpp_pool=Ce}for(;null!=t.util.ZPP_Set_ZPP_CbSet.zpp_pool;){var Ne=t.util.ZPP_Set_ZPP_CbSet.zpp_pool.next;t.util.ZPP_Set_ZPP_CbSet.zpp_pool.next=null,t.util.ZPP_Set_ZPP_CbSet.zpp_pool=Ne}for(;null!=t.util.ZNPNode_ZPP_FluidArbiter.zpp_pool;){var Ae=t.util.ZNPNode_ZPP_FluidArbiter.zpp_pool.next;t.util.ZNPNode_ZPP_FluidArbiter.zpp_pool.next=null,t.util.ZNPNode_ZPP_FluidArbiter.zpp_pool=Ae}for(;null!=t.dynamics.ZPP_ColArbiter.zpp_pool;){var Le=t.dynamics.ZPP_ColArbiter.zpp_pool.next;t.dynamics.ZPP_ColArbiter.zpp_pool.next=null,t.dynamics.ZPP_ColArbiter.zpp_pool=Le}for(;null!=t.util.ZNPNode_ZPP_SensorArbiter.zpp_pool;){var Be=t.util.ZNPNode_ZPP_SensorArbiter.zpp_pool.next;t.util.ZNPNode_ZPP_SensorArbiter.zpp_pool.next=null,t.util.ZNPNode_ZPP_SensorArbiter.zpp_pool=Be}for(;null!=t.util.ZNPNode_ZPP_Listener.zpp_pool;){var Te=t.util.ZNPNode_ZPP_Listener.zpp_pool.next;t.util.ZNPNode_ZPP_Listener.zpp_pool.next=null,t.util.ZNPNode_ZPP_Listener.zpp_pool=Te}for(;null!=t.util.ZNPNode_ZPP_ColArbiter.zpp_pool;){var Ve=t.util.ZNPNode_ZPP_ColArbiter.zpp_pool.next;t.util.ZNPNode_ZPP_ColArbiter.zpp_pool.next=null,t.util.ZNPNode_ZPP_ColArbiter.zpp_pool=Ve}for(;null!=t.util.ZNPNode_ZPP_InteractionGroup.zpp_pool;){var ke=t.util.ZNPNode_ZPP_InteractionGroup.zpp_pool.next;t.util.ZNPNode_ZPP_InteractionGroup.zpp_pool.next=null,t.util.ZNPNode_ZPP_InteractionGroup.zpp_pool=ke}for(;null!=t.util.ZNPNode_ZPP_ToiEvent.zpp_pool;){var Ie=t.util.ZNPNode_ZPP_ToiEvent.zpp_pool.next;t.util.ZNPNode_ZPP_ToiEvent.zpp_pool.next=null,t.util.ZNPNode_ZPP_ToiEvent.zpp_pool=Ie}for(;null!=t.dynamics.ZPP_InteractionFilter.zpp_pool;){var Oe=t.dynamics.ZPP_InteractionFilter.zpp_pool.next;t.dynamics.ZPP_InteractionFilter.zpp_pool.next=null,t.dynamics.ZPP_InteractionFilter.zpp_pool=Oe}for(;null!=t.util.ZNPNode_ConvexResult.zpp_pool;){var Re=t.util.ZNPNode_ConvexResult.zpp_pool.next;t.util.ZNPNode_ConvexResult.zpp_pool.next=null,t.util.ZNPNode_ConvexResult.zpp_pool=Re}for(;null!=t.util.ZNPNode_ZPP_GeomPoly.zpp_pool;){var He=t.util.ZNPNode_ZPP_GeomPoly.zpp_pool.next;t.util.ZNPNode_ZPP_GeomPoly.zpp_pool.next=null,t.util.ZNPNode_ZPP_GeomPoly.zpp_pool=He}for(;null!=t.util.ZNPNode_RayResult.zpp_pool;){var Fe=t.util.ZNPNode_RayResult.zpp_pool.next;t.util.ZNPNode_RayResult.zpp_pool.next=null,t.util.ZNPNode_RayResult.zpp_pool=Fe}for(;null!=t.util.ZPP_PubPool.poolGeomPoly;){var De=t.util.ZPP_PubPool.poolGeomPoly.zpp_pool;t.util.ZPP_PubPool.poolGeomPoly.zpp_pool=null,t.util.ZPP_PubPool.poolGeomPoly=De}for(;null!=t.util.ZPP_PubPool.poolVec2;){var Ge=t.util.ZPP_PubPool.poolVec2.zpp_pool;t.util.ZPP_PubPool.poolVec2.zpp_pool=null,t.util.ZPP_PubPool.poolVec2=Ge}for(;null!=t.util.ZPP_PubPool.poolVec3;){var Ue=t.util.ZPP_PubPool.poolVec3.zpp_pool;t.util.ZPP_PubPool.poolVec3.zpp_pool=null,t.util.ZPP_PubPool.poolVec3=Ue}},e.util.Debug.prototype.__class__=e.util.Debug,void 0===a&&(a={}),a.Main=l["sandbox.Main"]=function(){},a.Main.__name__=["sandbox","Main"],a.Main.main=function(){},a.Main.prototype.__class__=a.Main,void 0===t&&(t={}),t.ZPP_Const=l["zpp_nape.ZPP_Const"]=function(){},t.ZPP_Const.__name__=["zpp_nape","ZPP_Const"],t.ZPP_Const.POSINF=function(){return 1/0},t.ZPP_Const.NEGINF=function(){return-1/0},t.ZPP_Const.prototype.__class__=t.ZPP_Const,t.ZPP_ID=l["zpp_nape.ZPP_ID"]=function(){},t.ZPP_ID.__name__=["zpp_nape","ZPP_ID"],t.ZPP_ID.Constraint=function(){return t.ZPP_ID._Constraint++},t.ZPP_ID.Interactor=function(){return t.ZPP_ID._Interactor++},t.ZPP_ID.CbType=function(){return t.ZPP_ID._CbType++},t.ZPP_ID.CbSet=function(){return t.ZPP_ID._CbSet++},t.ZPP_ID.Listener=function(){return t.ZPP_ID._Listener++},t.ZPP_ID.ZPP_SimpleVert=function(){return t.ZPP_ID._ZPP_SimpleVert++},t.ZPP_ID.ZPP_SimpleSeg=function(){return t.ZPP_ID._ZPP_SimpleSeg++},t.ZPP_ID.Space=function(){return t.ZPP_ID._Space++},t.ZPP_ID.InteractionGroup=function(){return t.ZPP_ID._InteractionGroup++},t.ZPP_ID.prototype.__class__=t.ZPP_ID,t.callbacks||(t.callbacks={}),t.callbacks.ZPP_Callback=l["zpp_nape.callbacks.ZPP_Callback"]=function(){this.constraint=null,this.body=null,this.pre_swapped=!1,this.pre_arbiter=null,this.wrap_arbiters=null,this.set=null,this.int2=null,this.int1=null,this.length=0,this.prev=null,this.next=null,this.index=0,this.space=null,this.listener=null,this.event=0,this.outer_int=null,this.outer_con=null,this.outer_body=null,this.length=0},t.callbacks.ZPP_Callback.__name__=["zpp_nape","callbacks","ZPP_Callback"],t.callbacks.ZPP_Callback.prototype.outer_body=null,t.callbacks.ZPP_Callback.prototype.outer_con=null,t.callbacks.ZPP_Callback.prototype.outer_int=null,t.callbacks.ZPP_Callback.prototype.wrapper_body=function(){return null==this.outer_body&&(t.callbacks.ZPP_Callback.internal=!0,this.outer_body=new e.callbacks.BodyCallback,t.callbacks.ZPP_Callback.internal=!1,this.outer_body.zpp_inner=this),this.outer_body},t.callbacks.ZPP_Callback.prototype.wrapper_con=function(){return null==this.outer_con&&(t.callbacks.ZPP_Callback.internal=!0,this.outer_con=new e.callbacks.ConstraintCallback,t.callbacks.ZPP_Callback.internal=!1,this.outer_con.zpp_inner=this),this.outer_con},t.callbacks.ZPP_Callback.prototype.wrapper_int=function(){return null==this.outer_int&&(t.callbacks.ZPP_Callback.internal=!0,this.outer_int=new e.callbacks.InteractionCallback,t.callbacks.ZPP_Callback.internal=!1,this.outer_int.zpp_inner=this),null==this.wrap_arbiters?this.wrap_arbiters=t.util.ZPP_ArbiterList.get(this.set.arbiters,!0):this.wrap_arbiters.zpp_inner.inner=this.set.arbiters,this.wrap_arbiters.zpp_inner.zip_length=!0,this.wrap_arbiters.zpp_inner.at_ite=null,this.outer_int},t.callbacks.ZPP_Callback.prototype.event=null,t.callbacks.ZPP_Callback.prototype.listener=null,t.callbacks.ZPP_Callback.prototype.space=null,t.callbacks.ZPP_Callback.prototype.index=null,t.callbacks.ZPP_Callback.prototype.next=null,t.callbacks.ZPP_Callback.prototype.prev=null,t.callbacks.ZPP_Callback.prototype.length=null,t.callbacks.ZPP_Callback.prototype.push=function(e){null!=this.prev?this.prev.next=e:this.next=e,e.prev=this.prev,e.next=null,this.prev=e,this.length++},t.callbacks.ZPP_Callback.prototype.push_rev=function(e){null!=this.next?this.next.prev=e:this.prev=e,e.next=this.next,e.prev=null,this.next=e,this.length++},t.callbacks.ZPP_Callback.prototype.pop=function(){var e=this.next;return this.next=e.next,null==this.next?this.prev=null:this.next.prev=null,this.length--,e},t.callbacks.ZPP_Callback.prototype.pop_rev=function(){var e=this.prev;return this.prev=e.prev,null==this.prev?this.next=null:this.prev.next=null,this.length--,e},t.callbacks.ZPP_Callback.prototype.empty=function(){return null==this.next},t.callbacks.ZPP_Callback.prototype.clear=function(){for(;!this.empty();)this.pop()},t.callbacks.ZPP_Callback.prototype.splice=function(e){var t=e.next;return null==e.prev?(this.next=e.next,null!=this.next?this.next.prev=null:this.prev=null):(e.prev.next=e.next,null!=e.next?e.next.prev=e.prev:this.prev=e.prev),this.length--,t},t.callbacks.ZPP_Callback.prototype.rotateL=function(){this.push(this.pop())},t.callbacks.ZPP_Callback.prototype.rotateR=function(){this.push_rev(this.pop_rev())},t.callbacks.ZPP_Callback.prototype.cycleNext=function(e){return null==e.next?this.next:e.next},t.callbacks.ZPP_Callback.prototype.cyclePrev=function(e){return null==e.prev?this.prev:e.prev},t.callbacks.ZPP_Callback.prototype.at=function(e){for(var t=this.next;0!=e--;)t=t.next;return t},t.callbacks.ZPP_Callback.prototype.rev_at=function(e){for(var t=this.prev;0!=e--;)t=t.prev;return t},t.callbacks.ZPP_Callback.prototype.free=function(){this.int1=this.int2=null,this.body=null,this.constraint=null,this.listener=null,null!=this.wrap_arbiters&&(this.wrap_arbiters.zpp_inner.inner=null),this.set=null},t.callbacks.ZPP_Callback.prototype.alloc=function(){},t.callbacks.ZPP_Callback.prototype.int1=null,t.callbacks.ZPP_Callback.prototype.int2=null,t.callbacks.ZPP_Callback.prototype.set=null,t.callbacks.ZPP_Callback.prototype.wrap_arbiters=null,t.callbacks.ZPP_Callback.prototype.pre_arbiter=null,t.callbacks.ZPP_Callback.prototype.pre_swapped=null,t.callbacks.ZPP_Callback.prototype.genarbs=function(){null==this.wrap_arbiters?this.wrap_arbiters=t.util.ZPP_ArbiterList.get(this.set.arbiters,!0):this.wrap_arbiters.zpp_inner.inner=this.set.arbiters,this.wrap_arbiters.zpp_inner.zip_length=!0,this.wrap_arbiters.zpp_inner.at_ite=null},t.callbacks.ZPP_Callback.prototype.body=null,t.callbacks.ZPP_Callback.prototype.constraint=null,t.callbacks.ZPP_Callback.prototype.__class__=t.callbacks.ZPP_Callback,t.callbacks.ZPP_CbSet=l["zpp_nape.callbacks.ZPP_CbSet"]=function(){this.wrap_constraints=null,this.constraints=null,this.wrap_interactors=null,this.interactors=null,this.zip_conlisteners=!1,this.conlisteners=null,this.zip_bodylisteners=!1,this.bodylisteners=null,this.zip_listeners=!1,this.listeners=null,this.cbpairs=null,this.manager=null,this.id=0,this.next=null,this.count=0,this.cbTypes=null,this.cbTypes=new t.util.ZNPList_ZPP_CbType,this.listeners=new t.util.ZNPList_ZPP_InteractionListener,this.zip_listeners=!0,this.bodylisteners=new t.util.ZNPList_ZPP_BodyListener,this.zip_bodylisteners=!0,this.conlisteners=new t.util.ZNPList_ZPP_ConstraintListener,this.zip_conlisteners=!0,this.constraints=new t.util.ZNPList_ZPP_Constraint,this.interactors=new t.util.ZNPList_ZPP_Interactor,this.id=t.ZPP_ID.CbSet(),this.cbpairs=new t.util.ZNPList_ZPP_CbSetPair},t.callbacks.ZPP_CbSet.__name__=["zpp_nape","callbacks","ZPP_CbSet"],t.callbacks.ZPP_CbSet.setlt=function(e,t){for(var n=e.cbTypes.head,i=t.cbTypes.head;null!=n&&null!=i;){var r=n.elt,o=i.elt;if(r.id<o.id)return!0;if(o.id<r.id)return!1;n=n.next,i=i.next}return null!=i&&null==n},t.callbacks.ZPP_CbSet.get=function(e){var n;null==t.callbacks.ZPP_CbSet.zpp_pool?n=new t.callbacks.ZPP_CbSet:(n=t.callbacks.ZPP_CbSet.zpp_pool,t.callbacks.ZPP_CbSet.zpp_pool=n.next,n.next=null);for(var i=null,r=e.head;null!=r;){var o=r.elt;i=n.cbTypes.insert(i,o),o.cbsets.add(n),r=r.next}return n},t.callbacks.ZPP_CbSet.compatible=function(e,t,n){var i,r=e.options1,o=t.cbTypes;if(r.nonemptyintersection(o,r.includes)&&!r.nonemptyintersection(o,r.excludes)){var a=e.options2,s=n.cbTypes;i=a.nonemptyintersection(s,a.includes)&&!a.nonemptyintersection(s,a.excludes)}else i=!1;if(i)return!0;var l=e.options2,p=t.cbTypes;if(l.nonemptyintersection(p,l.includes)&&!l.nonemptyintersection(p,l.excludes)){var u=e.options1,h=n.cbTypes;return!!u.nonemptyintersection(h,u.includes)&&!u.nonemptyintersection(h,u.excludes)}return!1},t.callbacks.ZPP_CbSet.empty_intersection=function(e,n){e.manager;for(var i,r=null,o=(e.cbpairs.length<n.cbpairs.length?e.cbpairs:n.cbpairs).head;null!=o;){var a=o.elt;if(a.a==e&&a.b==n||a.a==n&&a.b==e){r=a;break}o=o.next}return null==r&&(null==t.callbacks.ZPP_CbSetPair.zpp_pool?i=new t.callbacks.ZPP_CbSetPair:(i=t.callbacks.ZPP_CbSetPair.zpp_pool,t.callbacks.ZPP_CbSetPair.zpp_pool=i.next,i.next=null),i.zip_listeners=!0,t.callbacks.ZPP_CbSet.setlt(e,n)?(i.a=e,i.b=n):(i.a=n,i.b=e),r=i,e.cbpairs.add(r),n!=e&&n.cbpairs.add(r)),r.zip_listeners&&(r.zip_listeners=!1,r.__validate()),null==r.listeners.head},t.callbacks.ZPP_CbSet.single_intersection=function(e,n,i){e.manager;for(var r,o=null,a=(e.cbpairs.length<n.cbpairs.length?e.cbpairs:n.cbpairs).head;null!=a;){var s=a.elt;if(s.a==e&&s.b==n||s.a==n&&s.b==e){o=s;break}a=a.next}null==o&&(null==t.callbacks.ZPP_CbSetPair.zpp_pool?r=new t.callbacks.ZPP_CbSetPair:(r=t.callbacks.ZPP_CbSetPair.zpp_pool,t.callbacks.ZPP_CbSetPair.zpp_pool=r.next,r.next=null),r.zip_listeners=!0,t.callbacks.ZPP_CbSet.setlt(e,n)?(r.a=e,r.b=n):(r.a=n,r.b=e),o=r,e.cbpairs.add(o),n!=e&&n.cbpairs.add(o)),o.zip_listeners&&(o.zip_listeners=!1,o.__validate());var l=o.listeners.head;return null!=l&&l.elt==i&&null==l.next},t.callbacks.ZPP_CbSet.find_all=function(e,n,i,r){e.manager;for(var o,a=null,s=(e.cbpairs.length<n.cbpairs.length?e.cbpairs:n.cbpairs).head;null!=s;){var l=s.elt;if(l.a==e&&l.b==n||l.a==n&&l.b==e){a=l;break}s=s.next}null==a&&(null==t.callbacks.ZPP_CbSetPair.zpp_pool?o=new t.callbacks.ZPP_CbSetPair:(o=t.callbacks.ZPP_CbSetPair.zpp_pool,t.callbacks.ZPP_CbSetPair.zpp_pool=o.next,o.next=null),o.zip_listeners=!0,t.callbacks.ZPP_CbSet.setlt(e,n)?(o.a=e,o.b=n):(o.a=n,o.b=e),a=o,e.cbpairs.add(a),n!=e&&n.cbpairs.add(a)),a.zip_listeners&&(a.zip_listeners=!1,a.__validate());for(var p=a.listeners.head;null!=p;){var u=p.elt;u.event==i&&r(u),p=p.next}},t.callbacks.ZPP_CbSet.prototype.cbTypes=null,t.callbacks.ZPP_CbSet.prototype.count=null,t.callbacks.ZPP_CbSet.prototype.next=null,t.callbacks.ZPP_CbSet.prototype.id=null,t.callbacks.ZPP_CbSet.prototype.manager=null,t.callbacks.ZPP_CbSet.prototype.cbpairs=null,t.callbacks.ZPP_CbSet.prototype.increment=function(){this.count++},t.callbacks.ZPP_CbSet.prototype.decrement=function(){return 0==--this.count},t.callbacks.ZPP_CbSet.prototype.invalidate_pairs=function(){for(var e=this.cbpairs.head;null!=e;)e.elt.zip_listeners=!0,e=e.next},t.callbacks.ZPP_CbSet.prototype.listeners=null,t.callbacks.ZPP_CbSet.prototype.zip_listeners=null,t.callbacks.ZPP_CbSet.prototype.invalidate_listeners=function(){this.zip_listeners=!0,this.invalidate_pairs()},t.callbacks.ZPP_CbSet.prototype.validate_listeners=function(){this.zip_listeners&&(this.zip_listeners=!1,this.realvalidate_listeners())},t.callbacks.ZPP_CbSet.prototype.realvalidate_listeners=function(){this.listeners.clear();for(var e=this.cbTypes.head;null!=e;){for(var n=e.elt,i=null,r=this.listeners.head,o=n.listeners.head;null!=o;){var a=o.elt;if(null!=r&&r.elt==a)o=o.next,i=r,r=r.next;else{var s;if(null!=r){var l=r.elt;s=a.precedence>l.precedence||a.precedence==l.precedence&&a.id>l.id}else s=!0;if(s){if(a.space==this.manager.space){var p,u=this.listeners;null==t.util.ZNPNode_ZPP_InteractionListener.zpp_pool?p=new t.util.ZNPNode_ZPP_InteractionListener:(p=t.util.ZNPNode_ZPP_InteractionListener.zpp_pool,t.util.ZNPNode_ZPP_InteractionListener.zpp_pool=p.next,p.next=null),p.elt=a;var h=p;null==i?(h.next=u.head,u.head=h):(h.next=i.next,i.next=h),u.pushmod=u.modified=!0,u.length++,i=h}o=o.next}else i=r,r=r.next}}e=e.next}},t.callbacks.ZPP_CbSet.prototype.bodylisteners=null,t.callbacks.ZPP_CbSet.prototype.zip_bodylisteners=null,t.callbacks.ZPP_CbSet.prototype.invalidate_bodylisteners=function(){this.zip_bodylisteners=!0},t.callbacks.ZPP_CbSet.prototype.validate_bodylisteners=function(){this.zip_bodylisteners&&(this.zip_bodylisteners=!1,this.realvalidate_bodylisteners())},t.callbacks.ZPP_CbSet.prototype.realvalidate_bodylisteners=function(){this.bodylisteners.clear();for(var e=this.cbTypes.head;null!=e;){for(var n=e.elt,i=null,r=this.bodylisteners.head,o=n.bodylisteners.head;null!=o;){var a=o.elt;if(null!=r&&r.elt==a)o=o.next,i=r,r=r.next;else{var s;if(null!=r){var l=r.elt;s=a.precedence>l.precedence||a.precedence==l.precedence&&a.id>l.id}else s=!0;if(s){var p=a.options;if(!p.nonemptyintersection(this.cbTypes,p.excludes)&&a.space==this.manager.space){var u,h=this.bodylisteners;null==t.util.ZNPNode_ZPP_BodyListener.zpp_pool?u=new t.util.ZNPNode_ZPP_BodyListener:(u=t.util.ZNPNode_ZPP_BodyListener.zpp_pool,t.util.ZNPNode_ZPP_BodyListener.zpp_pool=u.next,u.next=null),u.elt=a;var c=u;null==i?(c.next=h.head,h.head=c):(c.next=i.next,i.next=c),h.pushmod=h.modified=!0,h.length++,i=c}o=o.next}else i=r,r=r.next}}e=e.next}},t.callbacks.ZPP_CbSet.prototype.conlisteners=null,t.callbacks.ZPP_CbSet.prototype.zip_conlisteners=null,t.callbacks.ZPP_CbSet.prototype.invalidate_conlisteners=function(){this.zip_conlisteners=!0},t.callbacks.ZPP_CbSet.prototype.validate_conlisteners=function(){this.zip_conlisteners&&(this.zip_conlisteners=!1,this.realvalidate_conlisteners())},t.callbacks.ZPP_CbSet.prototype.realvalidate_conlisteners=function(){this.conlisteners.clear();for(var e=this.cbTypes.head;null!=e;){for(var n=e.elt,i=null,r=this.conlisteners.head,o=n.conlisteners.head;null!=o;){var a=o.elt;if(null!=r&&r.elt==a)o=o.next,i=r,r=r.next;else{var s;if(null!=r){var l=r.elt;s=a.precedence>l.precedence||a.precedence==l.precedence&&a.id>l.id}else s=!0;if(s){var p=a.options;if(!p.nonemptyintersection(this.cbTypes,p.excludes)&&a.space==this.manager.space){var u,h=this.conlisteners;null==t.util.ZNPNode_ZPP_ConstraintListener.zpp_pool?u=new t.util.ZNPNode_ZPP_ConstraintListener:(u=t.util.ZNPNode_ZPP_ConstraintListener.zpp_pool,t.util.ZNPNode_ZPP_ConstraintListener.zpp_pool=u.next,u.next=null),u.elt=a;var c=u;null==i?(c.next=h.head,h.head=c):(c.next=i.next,i.next=c),h.pushmod=h.modified=!0,h.length++,i=c}o=o.next}else i=r,r=r.next}}e=e.next}},t.callbacks.ZPP_CbSet.prototype.validate=function(){this.zip_listeners&&(this.zip_listeners=!1,this.realvalidate_listeners()),this.zip_bodylisteners&&(this.zip_bodylisteners=!1,this.realvalidate_bodylisteners()),this.zip_conlisteners&&(this.zip_conlisteners=!1,this.realvalidate_conlisteners())},t.callbacks.ZPP_CbSet.prototype.interactors=null,t.callbacks.ZPP_CbSet.prototype.wrap_interactors=null,t.callbacks.ZPP_CbSet.prototype.constraints=null,t.callbacks.ZPP_CbSet.prototype.wrap_constraints=null,t.callbacks.ZPP_CbSet.prototype.addConstraint=function(e){this.constraints.add(e)},t.callbacks.ZPP_CbSet.prototype.addInteractor=function(e){this.interactors.add(e)},t.callbacks.ZPP_CbSet.prototype.remConstraint=function(e){this.constraints.remove(e)},t.callbacks.ZPP_CbSet.prototype.remInteractor=function(e){this.interactors.remove(e)},t.callbacks.ZPP_CbSet.prototype.free=function(){for(this.listeners.clear(),this.zip_listeners=!0,this.bodylisteners.clear(),this.zip_bodylisteners=!0,this.conlisteners.clear(),this.zip_conlisteners=!0;null!=this.cbTypes.head;)this.cbTypes.pop_unsafe().cbsets.remove(this)},t.callbacks.ZPP_CbSet.prototype.alloc=function(){},t.callbacks.ZPP_CbSet.prototype.__class__=t.callbacks.ZPP_CbSet,t.callbacks.ZPP_CbSetPair=l["zpp_nape.callbacks.ZPP_CbSetPair"]=function(){this.listeners=null,this.zip_listeners=!1,this.next=null,this.b=null,this.a=null,this.listeners=new t.util.ZNPList_ZPP_InteractionListener},t.callbacks.ZPP_CbSetPair.__name__=["zpp_nape","callbacks","ZPP_CbSetPair"],t.callbacks.ZPP_CbSetPair.get=function(e,n){var i;return null==t.callbacks.ZPP_CbSetPair.zpp_pool?i=new t.callbacks.ZPP_CbSetPair:(i=t.callbacks.ZPP_CbSetPair.zpp_pool,t.callbacks.ZPP_CbSetPair.zpp_pool=i.next,i.next=null),i.zip_listeners=!0,t.callbacks.ZPP_CbSet.setlt(e,n)?(i.a=e,i.b=n):(i.a=n,i.b=e),i},t.callbacks.ZPP_CbSetPair.setlt=function(e,n){return!!t.callbacks.ZPP_CbSet.setlt(e.a,n.a)||e.a==n.a&&t.callbacks.ZPP_CbSet.setlt(e.b,n.b)},t.callbacks.ZPP_CbSetPair.prototype.a=null,t.callbacks.ZPP_CbSetPair.prototype.b=null,t.callbacks.ZPP_CbSetPair.prototype.next=null,t.callbacks.ZPP_CbSetPair.prototype.free=function(){this.a=this.b=null,this.listeners.clear()},t.callbacks.ZPP_CbSetPair.prototype.alloc=function(){this.zip_listeners=!0},t.callbacks.ZPP_CbSetPair.prototype.compatible=function(e){var t,n=e.options1,i=this.a.cbTypes;if(n.nonemptyintersection(i,n.includes)&&!n.nonemptyintersection(i,n.excludes)){var r=e.options2,o=this.b.cbTypes;t=r.nonemptyintersection(o,r.includes)&&!r.nonemptyintersection(o,r.excludes)}else t=!1;if(t)return!0;var a=e.options2,s=this.a.cbTypes;if(a.nonemptyintersection(s,a.includes)&&!a.nonemptyintersection(s,a.excludes)){var l=e.options1,p=this.b.cbTypes;return!!l.nonemptyintersection(p,l.includes)&&!l.nonemptyintersection(p,l.excludes)}return!1},t.callbacks.ZPP_CbSetPair.prototype.zip_listeners=null,t.callbacks.ZPP_CbSetPair.prototype.listeners=null,t.callbacks.ZPP_CbSetPair.prototype.invalidate=function(){this.zip_listeners=!0},t.callbacks.ZPP_CbSetPair.prototype.validate=function(){this.zip_listeners&&(this.zip_listeners=!1,this.__validate())},t.callbacks.ZPP_CbSetPair.prototype.__validate=function(){this.listeners.clear();for(var e=this.a.listeners.head,t=this.b.listeners.head;null!=e&&null!=t;){var n=e.elt,i=t.elt;if(n==i){var r,o,a=n.options1,s=this.a.cbTypes;if(a.nonemptyintersection(s,a.includes)&&!a.nonemptyintersection(s,a.excludes)){var l=n.options2,p=this.b.cbTypes;o=l.nonemptyintersection(p,l.includes)&&!l.nonemptyintersection(p,l.excludes)}else o=!1;if(o)r=!0;else{var u=n.options2,h=this.a.cbTypes;if(u.nonemptyintersection(h,u.includes)&&!u.nonemptyintersection(h,u.excludes)){var c=n.options1,_=this.b.cbTypes;r=c.nonemptyintersection(_,c.includes)&&!c.nonemptyintersection(_,c.excludes)}else r=!1}r&&this.listeners.add(n),e=e.next,t=t.next}else n.precedence>i.precedence||n.precedence==i.precedence&&n.id>i.id?e=e.next:t=t.next}},t.callbacks.ZPP_CbSetPair.prototype.empty_intersection=function(){return null==this.listeners.head},t.callbacks.ZPP_CbSetPair.prototype.single_intersection=function(e){var t=this.listeners.head;return null!=t&&t.elt==e&&null==t.next},t.callbacks.ZPP_CbSetPair.prototype.forall=function(e,t){for(var n=this.listeners.head;null!=n;){var i=n.elt;i.event==e&&t(i),n=n.next}},t.callbacks.ZPP_CbSetPair.prototype.__class__=t.callbacks.ZPP_CbSetPair,t.util||(t.util={}),t.util.ZNPList_ZPP_InteractionListener=l["zpp_nape.util.ZNPList_ZPP_InteractionListener"]=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null},t.util.ZNPList_ZPP_InteractionListener.__name__=["zpp_nape","util","ZNPList_ZPP_InteractionListener"],t.util.ZNPList_ZPP_InteractionListener.prototype.head=null,t.util.ZNPList_ZPP_InteractionListener.prototype.begin=function(){return this.head},t.util.ZNPList_ZPP_InteractionListener.prototype.modified=null,t.util.ZNPList_ZPP_InteractionListener.prototype.pushmod=null,t.util.ZNPList_ZPP_InteractionListener.prototype.length=null,t.util.ZNPList_ZPP_InteractionListener.prototype.setbegin=function(e){this.head=e,this.modified=!0,this.pushmod=!0},t.util.ZNPList_ZPP_InteractionListener.prototype.add=function(e){var n;null==t.util.ZNPNode_ZPP_InteractionListener.zpp_pool?n=new t.util.ZNPNode_ZPP_InteractionListener:(n=t.util.ZNPNode_ZPP_InteractionListener.zpp_pool,t.util.ZNPNode_ZPP_InteractionListener.zpp_pool=n.next,n.next=null),n.elt=e;var i=n;return i.next=this.head,this.head=i,this.modified=!0,this.length++,e},t.util.ZNPList_ZPP_InteractionListener.prototype.inlined_add=function(e){var n;null==t.util.ZNPNode_ZPP_InteractionListener.zpp_pool?n=new t.util.ZNPNode_ZPP_InteractionListener:(n=t.util.ZNPNode_ZPP_InteractionListener.zpp_pool,t.util.ZNPNode_ZPP_InteractionListener.zpp_pool=n.next,n.next=null),n.elt=e;var i=n;return i.next=this.head,this.head=i,this.modified=!0,this.length++,e},t.util.ZNPList_ZPP_InteractionListener.prototype.addAll=function(e){for(var t=e.head;null!=t;){var n=t.elt;this.add(n),t=t.next}},t.util.ZNPList_ZPP_InteractionListener.prototype.insert=function(e,n){var i;null==t.util.ZNPNode_ZPP_InteractionListener.zpp_pool?i=new t.util.ZNPNode_ZPP_InteractionListener:(i=t.util.ZNPNode_ZPP_InteractionListener.zpp_pool,t.util.ZNPNode_ZPP_InteractionListener.zpp_pool=i.next,i.next=null),i.elt=n;var r=i;return null==e?(r.next=this.head,this.head=r):(r.next=e.next,e.next=r),this.pushmod=this.modified=!0,this.length++,r},t.util.ZNPList_ZPP_InteractionListener.prototype.inlined_insert=function(e,n){var i;null==t.util.ZNPNode_ZPP_InteractionListener.zpp_pool?i=new t.util.ZNPNode_ZPP_InteractionListener:(i=t.util.ZNPNode_ZPP_InteractionListener.zpp_pool,t.util.ZNPNode_ZPP_InteractionListener.zpp_pool=i.next,i.next=null),i.elt=n;var r=i;return null==e?(r.next=this.head,this.head=r):(r.next=e.next,e.next=r),this.pushmod=this.modified=!0,this.length++,r},t.util.ZNPList_ZPP_InteractionListener.prototype.pop=function(){var e=this.head;this.head=e.next;var n=e;n.elt=null,n.next=t.util.ZNPNode_ZPP_InteractionListener.zpp_pool,t.util.ZNPNode_ZPP_InteractionListener.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},t.util.ZNPList_ZPP_InteractionListener.prototype.inlined_pop=function(){var e=this.head;this.head=e.next;var n=e;n.elt=null,n.next=t.util.ZNPNode_ZPP_InteractionListener.zpp_pool,t.util.ZNPNode_ZPP_InteractionListener.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},t.util.ZNPList_ZPP_InteractionListener.prototype.pop_unsafe=function(){var e=this.head.elt;return this.pop(),e},t.util.ZNPList_ZPP_InteractionListener.prototype.inlined_pop_unsafe=function(){var e=this.head.elt;return this.pop(),e},t.util.ZNPList_ZPP_InteractionListener.prototype.remove=function(e){for(var n=null,i=this.head;null!=i;){if(i.elt==e){var r,o;null==n?(o=(r=this.head).next,this.head=o,null==this.head&&(this.pushmod=!0)):(o=(r=n.next).next,n.next=o,null==o&&(this.pushmod=!0));var a=r;a.elt=null,a.next=t.util.ZNPNode_ZPP_InteractionListener.zpp_pool,t.util.ZNPNode_ZPP_InteractionListener.zpp_pool=a,this.modified=!0,this.length--,this.pushmod=!0;break}n=i,i=i.next}},t.util.ZNPList_ZPP_InteractionListener.prototype.try_remove=function(e){for(var t=null,n=this.head,i=!1;null!=n;){if(n.elt==e){this.erase(t),i=!0;break}t=n,n=n.next}return i},t.util.ZNPList_ZPP_InteractionListener.prototype.inlined_remove=function(e){for(var n=null,i=this.head;null!=i;){if(i.elt==e){var r,o;null==n?(o=(r=this.head).next,this.head=o,null==this.head&&(this.pushmod=!0)):(o=(r=n.next).next,n.next=o,null==o&&(this.pushmod=!0));var a=r;a.elt=null,a.next=t.util.ZNPNode_ZPP_InteractionListener.zpp_pool,t.util.ZNPNode_ZPP_InteractionListener.zpp_pool=a,this.modified=!0,this.length--,this.pushmod=!0;break}n=i,i=i.next}},t.util.ZNPList_ZPP_InteractionListener.prototype.inlined_try_remove=function(e){for(var n=null,i=this.head,r=!1;null!=i;){if(i.elt==e){var o,a;null==n?(a=(o=this.head).next,this.head=a,null==this.head&&(this.pushmod=!0)):(a=(o=n.next).next,n.next=a,null==a&&(this.pushmod=!0));var s=o;s.elt=null,s.next=t.util.ZNPNode_ZPP_InteractionListener.zpp_pool,t.util.ZNPNode_ZPP_InteractionListener.zpp_pool=s,this.modified=!0,this.length--,this.pushmod=!0,r=!0;break}n=i,i=i.next}return r},t.util.ZNPList_ZPP_InteractionListener.prototype.erase=function(e){var n,i;null==e?(i=(n=this.head).next,this.head=i,null==this.head&&(this.pushmod=!0)):(i=(n=e.next).next,e.next=i,null==i&&(this.pushmod=!0));var r=n;return r.elt=null,r.next=t.util.ZNPNode_ZPP_InteractionListener.zpp_pool,t.util.ZNPNode_ZPP_InteractionListener.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,i},t.util.ZNPList_ZPP_InteractionListener.prototype.inlined_erase=function(e){var n,i;null==e?(i=(n=this.head).next,this.head=i,null==this.head&&(this.pushmod=!0)):(i=(n=e.next).next,e.next=i,null==i&&(this.pushmod=!0));var r=n;return r.elt=null,r.next=t.util.ZNPNode_ZPP_InteractionListener.zpp_pool,t.util.ZNPNode_ZPP_InteractionListener.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,i},t.util.ZNPList_ZPP_InteractionListener.prototype.splice=function(e,t){for(;t-- >0&&null!=e.next;)this.erase(e);return e.next},t.util.ZNPList_ZPP_InteractionListener.prototype.clear=function(){for(;null!=this.head;){var e=this.head;this.head=e.next;var n=e;n.elt=null,n.next=t.util.ZNPNode_ZPP_InteractionListener.zpp_pool,t.util.ZNPNode_ZPP_InteractionListener.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},t.util.ZNPList_ZPP_InteractionListener.prototype.inlined_clear=function(){for(;null!=this.head;){var e=this.head;this.head=e.next;var n=e;n.elt=null,n.next=t.util.ZNPNode_ZPP_InteractionListener.zpp_pool,t.util.ZNPNode_ZPP_InteractionListener.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},t.util.ZNPList_ZPP_InteractionListener.prototype.reverse=function(){for(var e=this.head,t=null;null!=e;){var n=e.next;e.next=t,this.head=e,t=e,e=n}this.modified=!0,this.pushmod=!0},t.util.ZNPList_ZPP_InteractionListener.prototype.empty=function(){return null==this.head},t.util.ZNPList_ZPP_InteractionListener.prototype.size=function(){return this.length},t.util.ZNPList_ZPP_InteractionListener.prototype.has=function(e){var t;t=!1;for(var n=this.head;null!=n;){if(n.elt==e){t=!0;break}n=n.next}return t},t.util.ZNPList_ZPP_InteractionListener.prototype.inlined_has=function(e){var t;t=!1;for(var n=this.head;null!=n;){if(n.elt==e){t=!0;break}n=n.next}return t},t.util.ZNPList_ZPP_InteractionListener.prototype.front=function(){return this.head.elt},t.util.ZNPList_ZPP_InteractionListener.prototype.back=function(){for(var e=this.head,t=e;null!=t;)e=t,t=t.next;return e.elt},t.util.ZNPList_ZPP_InteractionListener.prototype.iterator_at=function(e){for(var t=this.head;e-- >0&&null!=t;)t=t.next;return t},t.util.ZNPList_ZPP_InteractionListener.prototype.at=function(e){var t=this.iterator_at(e);return null!=t?t.elt:null},t.util.ZNPList_ZPP_InteractionListener.prototype.__class__=t.util.ZNPList_ZPP_InteractionListener,t.util.ZNPList_ZPP_BodyListener=l["zpp_nape.util.ZNPList_ZPP_BodyListener"]=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null},t.util.ZNPList_ZPP_BodyListener.__name__=["zpp_nape","util","ZNPList_ZPP_BodyListener"],t.util.ZNPList_ZPP_BodyListener.prototype.head=null,t.util.ZNPList_ZPP_BodyListener.prototype.begin=function(){return this.head},t.util.ZNPList_ZPP_BodyListener.prototype.modified=null,t.util.ZNPList_ZPP_BodyListener.prototype.pushmod=null,t.util.ZNPList_ZPP_BodyListener.prototype.length=null,t.util.ZNPList_ZPP_BodyListener.prototype.setbegin=function(e){this.head=e,this.modified=!0,this.pushmod=!0},t.util.ZNPList_ZPP_BodyListener.prototype.add=function(e){var n;null==t.util.ZNPNode_ZPP_BodyListener.zpp_pool?n=new t.util.ZNPNode_ZPP_BodyListener:(n=t.util.ZNPNode_ZPP_BodyListener.zpp_pool,t.util.ZNPNode_ZPP_BodyListener.zpp_pool=n.next,n.next=null),n.elt=e;var i=n;return i.next=this.head,this.head=i,this.modified=!0,this.length++,e},t.util.ZNPList_ZPP_BodyListener.prototype.inlined_add=function(e){var n;null==t.util.ZNPNode_ZPP_BodyListener.zpp_pool?n=new t.util.ZNPNode_ZPP_BodyListener:(n=t.util.ZNPNode_ZPP_BodyListener.zpp_pool,t.util.ZNPNode_ZPP_BodyListener.zpp_pool=n.next,n.next=null),n.elt=e;var i=n;return i.next=this.head,this.head=i,this.modified=!0,this.length++,e},t.util.ZNPList_ZPP_BodyListener.prototype.addAll=function(e){for(var t=e.head;null!=t;){var n=t.elt;this.add(n),t=t.next}},t.util.ZNPList_ZPP_BodyListener.prototype.insert=function(e,n){var i;null==t.util.ZNPNode_ZPP_BodyListener.zpp_pool?i=new t.util.ZNPNode_ZPP_BodyListener:(i=t.util.ZNPNode_ZPP_BodyListener.zpp_pool,t.util.ZNPNode_ZPP_BodyListener.zpp_pool=i.next,i.next=null),i.elt=n;var r=i;return null==e?(r.next=this.head,this.head=r):(r.next=e.next,e.next=r),this.pushmod=this.modified=!0,this.length++,r},t.util.ZNPList_ZPP_BodyListener.prototype.inlined_insert=function(e,n){var i;null==t.util.ZNPNode_ZPP_BodyListener.zpp_pool?i=new t.util.ZNPNode_ZPP_BodyListener:(i=t.util.ZNPNode_ZPP_BodyListener.zpp_pool,t.util.ZNPNode_ZPP_BodyListener.zpp_pool=i.next,i.next=null),i.elt=n;var r=i;return null==e?(r.next=this.head,this.head=r):(r.next=e.next,e.next=r),this.pushmod=this.modified=!0,this.length++,r},t.util.ZNPList_ZPP_BodyListener.prototype.pop=function(){var e=this.head;this.head=e.next;var n=e;n.elt=null,n.next=t.util.ZNPNode_ZPP_BodyListener.zpp_pool,t.util.ZNPNode_ZPP_BodyListener.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},t.util.ZNPList_ZPP_BodyListener.prototype.inlined_pop=function(){var e=this.head;this.head=e.next;var n=e;n.elt=null,n.next=t.util.ZNPNode_ZPP_BodyListener.zpp_pool,t.util.ZNPNode_ZPP_BodyListener.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},t.util.ZNPList_ZPP_BodyListener.prototype.pop_unsafe=function(){var e=this.head.elt;return this.pop(),e},t.util.ZNPList_ZPP_BodyListener.prototype.inlined_pop_unsafe=function(){var e=this.head.elt;return this.pop(),e},t.util.ZNPList_ZPP_BodyListener.prototype.remove=function(e){for(var n=null,i=this.head;null!=i;){if(i.elt==e){var r,o;null==n?(o=(r=this.head).next,this.head=o,null==this.head&&(this.pushmod=!0)):(o=(r=n.next).next,n.next=o,null==o&&(this.pushmod=!0));var a=r;a.elt=null,a.next=t.util.ZNPNode_ZPP_BodyListener.zpp_pool,t.util.ZNPNode_ZPP_BodyListener.zpp_pool=a,this.modified=!0,this.length--,this.pushmod=!0;break}n=i,i=i.next}},t.util.ZNPList_ZPP_BodyListener.prototype.try_remove=function(e){for(var t=null,n=this.head,i=!1;null!=n;){if(n.elt==e){this.erase(t),i=!0;break}t=n,n=n.next}return i},t.util.ZNPList_ZPP_BodyListener.prototype.inlined_remove=function(e){for(var n=null,i=this.head;null!=i;){if(i.elt==e){var r,o;null==n?(o=(r=this.head).next,this.head=o,null==this.head&&(this.pushmod=!0)):(o=(r=n.next).next,n.next=o,null==o&&(this.pushmod=!0));var a=r;a.elt=null,a.next=t.util.ZNPNode_ZPP_BodyListener.zpp_pool,t.util.ZNPNode_ZPP_BodyListener.zpp_pool=a,this.modified=!0,this.length--,this.pushmod=!0;break}n=i,i=i.next}},t.util.ZNPList_ZPP_BodyListener.prototype.inlined_try_remove=function(e){for(var n=null,i=this.head,r=!1;null!=i;){if(i.elt==e){var o,a;null==n?(a=(o=this.head).next,this.head=a,null==this.head&&(this.pushmod=!0)):(a=(o=n.next).next,n.next=a,null==a&&(this.pushmod=!0));var s=o;s.elt=null,s.next=t.util.ZNPNode_ZPP_BodyListener.zpp_pool,t.util.ZNPNode_ZPP_BodyListener.zpp_pool=s,this.modified=!0,this.length--,this.pushmod=!0,r=!0;break}n=i,i=i.next}return r},t.util.ZNPList_ZPP_BodyListener.prototype.erase=function(e){var n,i;null==e?(i=(n=this.head).next,this.head=i,null==this.head&&(this.pushmod=!0)):(i=(n=e.next).next,e.next=i,null==i&&(this.pushmod=!0));var r=n;return r.elt=null,r.next=t.util.ZNPNode_ZPP_BodyListener.zpp_pool,t.util.ZNPNode_ZPP_BodyListener.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,i},t.util.ZNPList_ZPP_BodyListener.prototype.inlined_erase=function(e){var n,i;null==e?(i=(n=this.head).next,this.head=i,null==this.head&&(this.pushmod=!0)):(i=(n=e.next).next,e.next=i,null==i&&(this.pushmod=!0));var r=n;return r.elt=null,r.next=t.util.ZNPNode_ZPP_BodyListener.zpp_pool,t.util.ZNPNode_ZPP_BodyListener.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,i},t.util.ZNPList_ZPP_BodyListener.prototype.splice=function(e,t){for(;t-- >0&&null!=e.next;)this.erase(e);return e.next},t.util.ZNPList_ZPP_BodyListener.prototype.clear=function(){for(;null!=this.head;){var e=this.head;this.head=e.next;var n=e;n.elt=null,n.next=t.util.ZNPNode_ZPP_BodyListener.zpp_pool,t.util.ZNPNode_ZPP_BodyListener.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},t.util.ZNPList_ZPP_BodyListener.prototype.inlined_clear=function(){for(;null!=this.head;){var e=this.head;this.head=e.next;var n=e;n.elt=null,n.next=t.util.ZNPNode_ZPP_BodyListener.zpp_pool,t.util.ZNPNode_ZPP_BodyListener.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},t.util.ZNPList_ZPP_BodyListener.prototype.reverse=function(){for(var e=this.head,t=null;null!=e;){var n=e.next;e.next=t,this.head=e,t=e,e=n}this.modified=!0,this.pushmod=!0},t.util.ZNPList_ZPP_BodyListener.prototype.empty=function(){return null==this.head},t.util.ZNPList_ZPP_BodyListener.prototype.size=function(){return this.length},t.util.ZNPList_ZPP_BodyListener.prototype.has=function(e){var t;t=!1;for(var n=this.head;null!=n;){if(n.elt==e){t=!0;break}n=n.next}return t},t.util.ZNPList_ZPP_BodyListener.prototype.inlined_has=function(e){var t;t=!1;for(var n=this.head;null!=n;){if(n.elt==e){t=!0;break}n=n.next}return t},t.util.ZNPList_ZPP_BodyListener.prototype.front=function(){return this.head.elt},t.util.ZNPList_ZPP_BodyListener.prototype.back=function(){for(var e=this.head,t=e;null!=t;)e=t,t=t.next;return e.elt},t.util.ZNPList_ZPP_BodyListener.prototype.iterator_at=function(e){for(var t=this.head;e-- >0&&null!=t;)t=t.next;return t},t.util.ZNPList_ZPP_BodyListener.prototype.at=function(e){var t=this.iterator_at(e);return null!=t?t.elt:null},t.util.ZNPList_ZPP_BodyListener.prototype.__class__=t.util.ZNPList_ZPP_BodyListener,t.util.ZNPList_ZPP_ConstraintListener=l["zpp_nape.util.ZNPList_ZPP_ConstraintListener"]=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null},t.util.ZNPList_ZPP_ConstraintListener.__name__=["zpp_nape","util","ZNPList_ZPP_ConstraintListener"],t.util.ZNPList_ZPP_ConstraintListener.prototype.head=null,t.util.ZNPList_ZPP_ConstraintListener.prototype.begin=function(){return this.head},t.util.ZNPList_ZPP_ConstraintListener.prototype.modified=null,t.util.ZNPList_ZPP_ConstraintListener.prototype.pushmod=null,t.util.ZNPList_ZPP_ConstraintListener.prototype.length=null,t.util.ZNPList_ZPP_ConstraintListener.prototype.setbegin=function(e){this.head=e,this.modified=!0,this.pushmod=!0},t.util.ZNPList_ZPP_ConstraintListener.prototype.add=function(e){var n;null==t.util.ZNPNode_ZPP_ConstraintListener.zpp_pool?n=new t.util.ZNPNode_ZPP_ConstraintListener:(n=t.util.ZNPNode_ZPP_ConstraintListener.zpp_pool,t.util.ZNPNode_ZPP_ConstraintListener.zpp_pool=n.next,n.next=null),n.elt=e;var i=n;return i.next=this.head,this.head=i,this.modified=!0,this.length++,e},t.util.ZNPList_ZPP_ConstraintListener.prototype.inlined_add=function(e){var n;null==t.util.ZNPNode_ZPP_ConstraintListener.zpp_pool?n=new t.util.ZNPNode_ZPP_ConstraintListener:(n=t.util.ZNPNode_ZPP_ConstraintListener.zpp_pool,t.util.ZNPNode_ZPP_ConstraintListener.zpp_pool=n.next,n.next=null),n.elt=e;var i=n;return i.next=this.head,this.head=i,this.modified=!0,this.length++,e},t.util.ZNPList_ZPP_ConstraintListener.prototype.addAll=function(e){for(var t=e.head;null!=t;){var n=t.elt;this.add(n),t=t.next}},t.util.ZNPList_ZPP_ConstraintListener.prototype.insert=function(e,n){var i;null==t.util.ZNPNode_ZPP_ConstraintListener.zpp_pool?i=new t.util.ZNPNode_ZPP_ConstraintListener:(i=t.util.ZNPNode_ZPP_ConstraintListener.zpp_pool,t.util.ZNPNode_ZPP_ConstraintListener.zpp_pool=i.next,i.next=null),i.elt=n;var r=i;return null==e?(r.next=this.head,this.head=r):(r.next=e.next,e.next=r),this.pushmod=this.modified=!0,this.length++,r},t.util.ZNPList_ZPP_ConstraintListener.prototype.inlined_insert=function(e,n){var i;null==t.util.ZNPNode_ZPP_ConstraintListener.zpp_pool?i=new t.util.ZNPNode_ZPP_ConstraintListener:(i=t.util.ZNPNode_ZPP_ConstraintListener.zpp_pool,t.util.ZNPNode_ZPP_ConstraintListener.zpp_pool=i.next,i.next=null),i.elt=n;var r=i;return null==e?(r.next=this.head,this.head=r):(r.next=e.next,e.next=r),this.pushmod=this.modified=!0,this.length++,r},t.util.ZNPList_ZPP_ConstraintListener.prototype.pop=function(){var e=this.head;this.head=e.next;var n=e;n.elt=null,n.next=t.util.ZNPNode_ZPP_ConstraintListener.zpp_pool,t.util.ZNPNode_ZPP_ConstraintListener.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},t.util.ZNPList_ZPP_ConstraintListener.prototype.inlined_pop=function(){var e=this.head;this.head=e.next;var n=e;n.elt=null,n.next=t.util.ZNPNode_ZPP_ConstraintListener.zpp_pool,t.util.ZNPNode_ZPP_ConstraintListener.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},t.util.ZNPList_ZPP_ConstraintListener.prototype.pop_unsafe=function(){var e=this.head.elt;return this.pop(),e},t.util.ZNPList_ZPP_ConstraintListener.prototype.inlined_pop_unsafe=function(){var e=this.head.elt;return this.pop(),e},t.util.ZNPList_ZPP_ConstraintListener.prototype.remove=function(e){for(var n=null,i=this.head;null!=i;){if(i.elt==e){var r,o;null==n?(o=(r=this.head).next,this.head=o,null==this.head&&(this.pushmod=!0)):(o=(r=n.next).next,n.next=o,null==o&&(this.pushmod=!0));var a=r;a.elt=null,a.next=t.util.ZNPNode_ZPP_ConstraintListener.zpp_pool,t.util.ZNPNode_ZPP_ConstraintListener.zpp_pool=a,this.modified=!0,this.length--,this.pushmod=!0;break}n=i,i=i.next}},t.util.ZNPList_ZPP_ConstraintListener.prototype.try_remove=function(e){for(var t=null,n=this.head,i=!1;null!=n;){if(n.elt==e){this.erase(t),i=!0;break}t=n,n=n.next}return i},t.util.ZNPList_ZPP_ConstraintListener.prototype.inlined_remove=function(e){for(var n=null,i=this.head;null!=i;){if(i.elt==e){var r,o;null==n?(o=(r=this.head).next,this.head=o,null==this.head&&(this.pushmod=!0)):(o=(r=n.next).next,n.next=o,null==o&&(this.pushmod=!0));var a=r;a.elt=null,a.next=t.util.ZNPNode_ZPP_ConstraintListener.zpp_pool,t.util.ZNPNode_ZPP_ConstraintListener.zpp_pool=a,this.modified=!0,this.length--,this.pushmod=!0;break}n=i,i=i.next}},t.util.ZNPList_ZPP_ConstraintListener.prototype.inlined_try_remove=function(e){for(var n=null,i=this.head,r=!1;null!=i;){if(i.elt==e){var o,a;null==n?(a=(o=this.head).next,this.head=a,null==this.head&&(this.pushmod=!0)):(a=(o=n.next).next,n.next=a,null==a&&(this.pushmod=!0));var s=o;s.elt=null,s.next=t.util.ZNPNode_ZPP_ConstraintListener.zpp_pool,t.util.ZNPNode_ZPP_ConstraintListener.zpp_pool=s,this.modified=!0,this.length--,this.pushmod=!0,r=!0;break}n=i,i=i.next}return r},t.util.ZNPList_ZPP_ConstraintListener.prototype.erase=function(e){var n,i;null==e?(i=(n=this.head).next,this.head=i,null==this.head&&(this.pushmod=!0)):(i=(n=e.next).next,e.next=i,null==i&&(this.pushmod=!0));var r=n;return r.elt=null,r.next=t.util.ZNPNode_ZPP_ConstraintListener.zpp_pool,t.util.ZNPNode_ZPP_ConstraintListener.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,i},t.util.ZNPList_ZPP_ConstraintListener.prototype.inlined_erase=function(e){var n,i;null==e?(i=(n=this.head).next,this.head=i,null==this.head&&(this.pushmod=!0)):(i=(n=e.next).next,e.next=i,null==i&&(this.pushmod=!0));var r=n;return r.elt=null,r.next=t.util.ZNPNode_ZPP_ConstraintListener.zpp_pool,t.util.ZNPNode_ZPP_ConstraintListener.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,i},t.util.ZNPList_ZPP_ConstraintListener.prototype.splice=function(e,t){for(;t-- >0&&null!=e.next;)this.erase(e);return e.next},t.util.ZNPList_ZPP_ConstraintListener.prototype.clear=function(){for(;null!=this.head;){var e=this.head;this.head=e.next;var n=e;n.elt=null,n.next=t.util.ZNPNode_ZPP_ConstraintListener.zpp_pool,t.util.ZNPNode_ZPP_ConstraintListener.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},t.util.ZNPList_ZPP_ConstraintListener.prototype.inlined_clear=function(){for(;null!=this.head;){var e=this.head;this.head=e.next;var n=e;n.elt=null,n.next=t.util.ZNPNode_ZPP_ConstraintListener.zpp_pool,t.util.ZNPNode_ZPP_ConstraintListener.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},t.util.ZNPList_ZPP_ConstraintListener.prototype.reverse=function(){for(var e=this.head,t=null;null!=e;){var n=e.next;e.next=t,this.head=e,t=e,e=n}this.modified=!0,this.pushmod=!0},t.util.ZNPList_ZPP_ConstraintListener.prototype.empty=function(){return null==this.head},t.util.ZNPList_ZPP_ConstraintListener.prototype.size=function(){return this.length},t.util.ZNPList_ZPP_ConstraintListener.prototype.has=function(e){var t;t=!1;for(var n=this.head;null!=n;){if(n.elt==e){t=!0;break}n=n.next}return t},t.util.ZNPList_ZPP_ConstraintListener.prototype.inlined_has=function(e){var t;t=!1;for(var n=this.head;null!=n;){if(n.elt==e){t=!0;break}n=n.next}return t},t.util.ZNPList_ZPP_ConstraintListener.prototype.front=function(){return this.head.elt},t.util.ZNPList_ZPP_ConstraintListener.prototype.back=function(){for(var e=this.head,t=e;null!=t;)e=t,t=t.next;return e.elt},t.util.ZNPList_ZPP_ConstraintListener.prototype.iterator_at=function(e){for(var t=this.head;e-- >0&&null!=t;)t=t.next;return t},t.util.ZNPList_ZPP_ConstraintListener.prototype.at=function(e){var t=this.iterator_at(e);return null!=t?t.elt:null},t.util.ZNPList_ZPP_ConstraintListener.prototype.__class__=t.util.ZNPList_ZPP_ConstraintListener,t.util.ZNPList_ZPP_Constraint=l["zpp_nape.util.ZNPList_ZPP_Constraint"]=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null},t.util.ZNPList_ZPP_Constraint.__name__=["zpp_nape","util","ZNPList_ZPP_Constraint"],t.util.ZNPList_ZPP_Constraint.prototype.head=null,t.util.ZNPList_ZPP_Constraint.prototype.begin=function(){return this.head},t.util.ZNPList_ZPP_Constraint.prototype.modified=null,t.util.ZNPList_ZPP_Constraint.prototype.pushmod=null,t.util.ZNPList_ZPP_Constraint.prototype.length=null,t.util.ZNPList_ZPP_Constraint.prototype.setbegin=function(e){this.head=e,this.modified=!0,this.pushmod=!0},t.util.ZNPList_ZPP_Constraint.prototype.add=function(e){var n;null==t.util.ZNPNode_ZPP_Constraint.zpp_pool?n=new t.util.ZNPNode_ZPP_Constraint:(n=t.util.ZNPNode_ZPP_Constraint.zpp_pool,t.util.ZNPNode_ZPP_Constraint.zpp_pool=n.next,n.next=null),n.elt=e;var i=n;return i.next=this.head,this.head=i,this.modified=!0,this.length++,e},t.util.ZNPList_ZPP_Constraint.prototype.inlined_add=function(e){var n;null==t.util.ZNPNode_ZPP_Constraint.zpp_pool?n=new t.util.ZNPNode_ZPP_Constraint:(n=t.util.ZNPNode_ZPP_Constraint.zpp_pool,t.util.ZNPNode_ZPP_Constraint.zpp_pool=n.next,n.next=null),n.elt=e;var i=n;return i.next=this.head,this.head=i,this.modified=!0,this.length++,e},t.util.ZNPList_ZPP_Constraint.prototype.addAll=function(e){for(var t=e.head;null!=t;){var n=t.elt;this.add(n),t=t.next}},t.util.ZNPList_ZPP_Constraint.prototype.insert=function(e,n){var i;null==t.util.ZNPNode_ZPP_Constraint.zpp_pool?i=new t.util.ZNPNode_ZPP_Constraint:(i=t.util.ZNPNode_ZPP_Constraint.zpp_pool,t.util.ZNPNode_ZPP_Constraint.zpp_pool=i.next,i.next=null),i.elt=n;var r=i;return null==e?(r.next=this.head,this.head=r):(r.next=e.next,e.next=r),this.pushmod=this.modified=!0,this.length++,r},t.util.ZNPList_ZPP_Constraint.prototype.inlined_insert=function(e,n){var i;null==t.util.ZNPNode_ZPP_Constraint.zpp_pool?i=new t.util.ZNPNode_ZPP_Constraint:(i=t.util.ZNPNode_ZPP_Constraint.zpp_pool,t.util.ZNPNode_ZPP_Constraint.zpp_pool=i.next,i.next=null),i.elt=n;var r=i;return null==e?(r.next=this.head,this.head=r):(r.next=e.next,e.next=r),this.pushmod=this.modified=!0,this.length++,r},t.util.ZNPList_ZPP_Constraint.prototype.pop=function(){var e=this.head;this.head=e.next;var n=e;n.elt=null,n.next=t.util.ZNPNode_ZPP_Constraint.zpp_pool,t.util.ZNPNode_ZPP_Constraint.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},t.util.ZNPList_ZPP_Constraint.prototype.inlined_pop=function(){var e=this.head;this.head=e.next;var n=e;n.elt=null,n.next=t.util.ZNPNode_ZPP_Constraint.zpp_pool,t.util.ZNPNode_ZPP_Constraint.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},t.util.ZNPList_ZPP_Constraint.prototype.pop_unsafe=function(){var e=this.head.elt;return this.pop(),e},t.util.ZNPList_ZPP_Constraint.prototype.inlined_pop_unsafe=function(){var e=this.head.elt;return this.pop(),e},t.util.ZNPList_ZPP_Constraint.prototype.remove=function(e){for(var n=null,i=this.head;null!=i;){if(i.elt==e){var r,o;null==n?(o=(r=this.head).next,this.head=o,null==this.head&&(this.pushmod=!0)):(o=(r=n.next).next,n.next=o,null==o&&(this.pushmod=!0));var a=r;a.elt=null,a.next=t.util.ZNPNode_ZPP_Constraint.zpp_pool,t.util.ZNPNode_ZPP_Constraint.zpp_pool=a,this.modified=!0,this.length--,this.pushmod=!0;break}n=i,i=i.next}},t.util.ZNPList_ZPP_Constraint.prototype.try_remove=function(e){for(var t=null,n=this.head,i=!1;null!=n;){if(n.elt==e){this.erase(t),i=!0;break}t=n,n=n.next}return i},t.util.ZNPList_ZPP_Constraint.prototype.inlined_remove=function(e){for(var n=null,i=this.head;null!=i;){if(i.elt==e){var r,o;null==n?(o=(r=this.head).next,this.head=o,null==this.head&&(this.pushmod=!0)):(o=(r=n.next).next,n.next=o,null==o&&(this.pushmod=!0));var a=r;a.elt=null,a.next=t.util.ZNPNode_ZPP_Constraint.zpp_pool,t.util.ZNPNode_ZPP_Constraint.zpp_pool=a,this.modified=!0,this.length--,this.pushmod=!0;break}n=i,i=i.next}},t.util.ZNPList_ZPP_Constraint.prototype.inlined_try_remove=function(e){for(var n=null,i=this.head,r=!1;null!=i;){if(i.elt==e){var o,a;null==n?(a=(o=this.head).next,this.head=a,null==this.head&&(this.pushmod=!0)):(a=(o=n.next).next,n.next=a,null==a&&(this.pushmod=!0));var s=o;s.elt=null,s.next=t.util.ZNPNode_ZPP_Constraint.zpp_pool,t.util.ZNPNode_ZPP_Constraint.zpp_pool=s,this.modified=!0,this.length--,this.pushmod=!0,r=!0;break}n=i,i=i.next}return r},t.util.ZNPList_ZPP_Constraint.prototype.erase=function(e){var n,i;null==e?(i=(n=this.head).next,this.head=i,null==this.head&&(this.pushmod=!0)):(i=(n=e.next).next,e.next=i,null==i&&(this.pushmod=!0));var r=n;return r.elt=null,r.next=t.util.ZNPNode_ZPP_Constraint.zpp_pool,t.util.ZNPNode_ZPP_Constraint.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,i},t.util.ZNPList_ZPP_Constraint.prototype.inlined_erase=function(e){var n,i;null==e?(i=(n=this.head).next,this.head=i,null==this.head&&(this.pushmod=!0)):(i=(n=e.next).next,e.next=i,null==i&&(this.pushmod=!0));var r=n;return r.elt=null,r.next=t.util.ZNPNode_ZPP_Constraint.zpp_pool,t.util.ZNPNode_ZPP_Constraint.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,i},t.util.ZNPList_ZPP_Constraint.prototype.splice=function(e,t){for(;t-- >0&&null!=e.next;)this.erase(e);return e.next},t.util.ZNPList_ZPP_Constraint.prototype.clear=function(){for(;null!=this.head;){var e=this.head;this.head=e.next;var n=e;n.elt=null,n.next=t.util.ZNPNode_ZPP_Constraint.zpp_pool,t.util.ZNPNode_ZPP_Constraint.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},t.util.ZNPList_ZPP_Constraint.prototype.inlined_clear=function(){for(;null!=this.head;){var e=this.head;this.head=e.next;var n=e;n.elt=null,n.next=t.util.ZNPNode_ZPP_Constraint.zpp_pool,t.util.ZNPNode_ZPP_Constraint.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},t.util.ZNPList_ZPP_Constraint.prototype.reverse=function(){for(var e=this.head,t=null;null!=e;){var n=e.next;e.next=t,this.head=e,t=e,e=n}this.modified=!0,this.pushmod=!0},t.util.ZNPList_ZPP_Constraint.prototype.empty=function(){return null==this.head},t.util.ZNPList_ZPP_Constraint.prototype.size=function(){return this.length},t.util.ZNPList_ZPP_Constraint.prototype.has=function(e){var t;t=!1;for(var n=this.head;null!=n;){if(n.elt==e){t=!0;break}n=n.next}return t},t.util.ZNPList_ZPP_Constraint.prototype.inlined_has=function(e){var t;t=!1;for(var n=this.head;null!=n;){if(n.elt==e){t=!0;break}n=n.next}return t},t.util.ZNPList_ZPP_Constraint.prototype.front=function(){return this.head.elt},t.util.ZNPList_ZPP_Constraint.prototype.back=function(){for(var e=this.head,t=e;null!=t;)e=t,t=t.next;return e.elt},t.util.ZNPList_ZPP_Constraint.prototype.iterator_at=function(e){for(var t=this.head;e-- >0&&null!=t;)t=t.next;return t},t.util.ZNPList_ZPP_Constraint.prototype.at=function(e){var t=this.iterator_at(e);return null!=t?t.elt:null},t.util.ZNPList_ZPP_Constraint.prototype.__class__=t.util.ZNPList_ZPP_Constraint,t.util.ZNPList_ZPP_Interactor=l["zpp_nape.util.ZNPList_ZPP_Interactor"]=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null},t.util.ZNPList_ZPP_Interactor.__name__=["zpp_nape","util","ZNPList_ZPP_Interactor"],t.util.ZNPList_ZPP_Interactor.prototype.head=null,t.util.ZNPList_ZPP_Interactor.prototype.begin=function(){return this.head},t.util.ZNPList_ZPP_Interactor.prototype.modified=null,t.util.ZNPList_ZPP_Interactor.prototype.pushmod=null,t.util.ZNPList_ZPP_Interactor.prototype.length=null,t.util.ZNPList_ZPP_Interactor.prototype.setbegin=function(e){this.head=e,this.modified=!0,this.pushmod=!0},t.util.ZNPList_ZPP_Interactor.prototype.add=function(e){var n;null==t.util.ZNPNode_ZPP_Interactor.zpp_pool?n=new t.util.ZNPNode_ZPP_Interactor:(n=t.util.ZNPNode_ZPP_Interactor.zpp_pool,t.util.ZNPNode_ZPP_Interactor.zpp_pool=n.next,n.next=null),n.elt=e;var i=n;return i.next=this.head,this.head=i,this.modified=!0,this.length++,e},t.util.ZNPList_ZPP_Interactor.prototype.inlined_add=function(e){var n;null==t.util.ZNPNode_ZPP_Interactor.zpp_pool?n=new t.util.ZNPNode_ZPP_Interactor:(n=t.util.ZNPNode_ZPP_Interactor.zpp_pool,t.util.ZNPNode_ZPP_Interactor.zpp_pool=n.next,n.next=null),n.elt=e;var i=n;return i.next=this.head,this.head=i,this.modified=!0,this.length++,e},t.util.ZNPList_ZPP_Interactor.prototype.addAll=function(e){for(var t=e.head;null!=t;){var n=t.elt;this.add(n),t=t.next}},t.util.ZNPList_ZPP_Interactor.prototype.insert=function(e,n){var i;null==t.util.ZNPNode_ZPP_Interactor.zpp_pool?i=new t.util.ZNPNode_ZPP_Interactor:(i=t.util.ZNPNode_ZPP_Interactor.zpp_pool,t.util.ZNPNode_ZPP_Interactor.zpp_pool=i.next,i.next=null),i.elt=n;var r=i;return null==e?(r.next=this.head,this.head=r):(r.next=e.next,e.next=r),this.pushmod=this.modified=!0,this.length++,r},t.util.ZNPList_ZPP_Interactor.prototype.inlined_insert=function(e,n){var i;null==t.util.ZNPNode_ZPP_Interactor.zpp_pool?i=new t.util.ZNPNode_ZPP_Interactor:(i=t.util.ZNPNode_ZPP_Interactor.zpp_pool,t.util.ZNPNode_ZPP_Interactor.zpp_pool=i.next,i.next=null),i.elt=n;var r=i;return null==e?(r.next=this.head,this.head=r):(r.next=e.next,e.next=r),this.pushmod=this.modified=!0,this.length++,r},t.util.ZNPList_ZPP_Interactor.prototype.pop=function(){var e=this.head;this.head=e.next;var n=e;n.elt=null,n.next=t.util.ZNPNode_ZPP_Interactor.zpp_pool,t.util.ZNPNode_ZPP_Interactor.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},t.util.ZNPList_ZPP_Interactor.prototype.inlined_pop=function(){var e=this.head;this.head=e.next;var n=e;n.elt=null,n.next=t.util.ZNPNode_ZPP_Interactor.zpp_pool,t.util.ZNPNode_ZPP_Interactor.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},t.util.ZNPList_ZPP_Interactor.prototype.pop_unsafe=function(){var e=this.head.elt;return this.pop(),e},t.util.ZNPList_ZPP_Interactor.prototype.inlined_pop_unsafe=function(){var e=this.head.elt;return this.pop(),e},t.util.ZNPList_ZPP_Interactor.prototype.remove=function(e){for(var n=null,i=this.head;null!=i;){if(i.elt==e){var r,o;null==n?(o=(r=this.head).next,this.head=o,null==this.head&&(this.pushmod=!0)):(o=(r=n.next).next,n.next=o,null==o&&(this.pushmod=!0));var a=r;a.elt=null,a.next=t.util.ZNPNode_ZPP_Interactor.zpp_pool,t.util.ZNPNode_ZPP_Interactor.zpp_pool=a,this.modified=!0,this.length--,this.pushmod=!0;break}n=i,i=i.next}},t.util.ZNPList_ZPP_Interactor.prototype.try_remove=function(e){for(var t=null,n=this.head,i=!1;null!=n;){if(n.elt==e){this.erase(t),i=!0;break}t=n,n=n.next}return i},t.util.ZNPList_ZPP_Interactor.prototype.inlined_remove=function(e){for(var n=null,i=this.head;null!=i;){if(i.elt==e){var r,o;null==n?(o=(r=this.head).next,this.head=o,null==this.head&&(this.pushmod=!0)):(o=(r=n.next).next,n.next=o,null==o&&(this.pushmod=!0));var a=r;a.elt=null,a.next=t.util.ZNPNode_ZPP_Interactor.zpp_pool,t.util.ZNPNode_ZPP_Interactor.zpp_pool=a,this.modified=!0,this.length--,this.pushmod=!0;break}n=i,i=i.next}},t.util.ZNPList_ZPP_Interactor.prototype.inlined_try_remove=function(e){for(var n=null,i=this.head,r=!1;null!=i;){if(i.elt==e){var o,a;null==n?(a=(o=this.head).next,this.head=a,null==this.head&&(this.pushmod=!0)):(a=(o=n.next).next,n.next=a,null==a&&(this.pushmod=!0));var s=o;s.elt=null,s.next=t.util.ZNPNode_ZPP_Interactor.zpp_pool,t.util.ZNPNode_ZPP_Interactor.zpp_pool=s,this.modified=!0,this.length--,this.pushmod=!0,r=!0;break}n=i,i=i.next}return r},t.util.ZNPList_ZPP_Interactor.prototype.erase=function(e){var n,i;null==e?(i=(n=this.head).next,this.head=i,null==this.head&&(this.pushmod=!0)):(i=(n=e.next).next,e.next=i,null==i&&(this.pushmod=!0));var r=n;return r.elt=null,r.next=t.util.ZNPNode_ZPP_Interactor.zpp_pool,t.util.ZNPNode_ZPP_Interactor.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,i},t.util.ZNPList_ZPP_Interactor.prototype.inlined_erase=function(e){var n,i;null==e?(i=(n=this.head).next,this.head=i,null==this.head&&(this.pushmod=!0)):(i=(n=e.next).next,e.next=i,null==i&&(this.pushmod=!0));var r=n;return r.elt=null,r.next=t.util.ZNPNode_ZPP_Interactor.zpp_pool,t.util.ZNPNode_ZPP_Interactor.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,i},t.util.ZNPList_ZPP_Interactor.prototype.splice=function(e,t){for(;t-- >0&&null!=e.next;)this.erase(e);return e.next},t.util.ZNPList_ZPP_Interactor.prototype.clear=function(){for(;null!=this.head;){var e=this.head;this.head=e.next;var n=e;n.elt=null,n.next=t.util.ZNPNode_ZPP_Interactor.zpp_pool,t.util.ZNPNode_ZPP_Interactor.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},t.util.ZNPList_ZPP_Interactor.prototype.inlined_clear=function(){for(;null!=this.head;){var e=this.head;this.head=e.next;var n=e;n.elt=null,n.next=t.util.ZNPNode_ZPP_Interactor.zpp_pool,t.util.ZNPNode_ZPP_Interactor.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},t.util.ZNPList_ZPP_Interactor.prototype.reverse=function(){for(var e=this.head,t=null;null!=e;){var n=e.next;e.next=t,this.head=e,t=e,e=n}this.modified=!0,this.pushmod=!0},t.util.ZNPList_ZPP_Interactor.prototype.empty=function(){return null==this.head},t.util.ZNPList_ZPP_Interactor.prototype.size=function(){return this.length},t.util.ZNPList_ZPP_Interactor.prototype.has=function(e){var t;t=!1;for(var n=this.head;null!=n;){if(n.elt==e){t=!0;break}n=n.next}return t},t.util.ZNPList_ZPP_Interactor.prototype.inlined_has=function(e){var t;t=!1;for(var n=this.head;null!=n;){if(n.elt==e){t=!0;break}n=n.next}return t},t.util.ZNPList_ZPP_Interactor.prototype.front=function(){return this.head.elt},t.util.ZNPList_ZPP_Interactor.prototype.back=function(){for(var e=this.head,t=e;null!=t;)e=t,t=t.next;return e.elt},t.util.ZNPList_ZPP_Interactor.prototype.iterator_at=function(e){for(var t=this.head;e-- >0&&null!=t;)t=t.next;return t},t.util.ZNPList_ZPP_Interactor.prototype.at=function(e){var t=this.iterator_at(e);return null!=t?t.elt:null},t.util.ZNPList_ZPP_Interactor.prototype.__class__=t.util.ZNPList_ZPP_Interactor,t.util.ZNPList_ZPP_CbSet=l["zpp_nape.util.ZNPList_ZPP_CbSet"]=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null},t.util.ZNPList_ZPP_CbSet.__name__=["zpp_nape","util","ZNPList_ZPP_CbSet"],t.util.ZNPList_ZPP_CbSet.prototype.head=null,t.util.ZNPList_ZPP_CbSet.prototype.begin=function(){return this.head},t.util.ZNPList_ZPP_CbSet.prototype.modified=null,t.util.ZNPList_ZPP_CbSet.prototype.pushmod=null,t.util.ZNPList_ZPP_CbSet.prototype.length=null,t.util.ZNPList_ZPP_CbSet.prototype.setbegin=function(e){this.head=e,this.modified=!0,this.pushmod=!0},t.util.ZNPList_ZPP_CbSet.prototype.add=function(e){var n;null==t.util.ZNPNode_ZPP_CbSet.zpp_pool?n=new t.util.ZNPNode_ZPP_CbSet:(n=t.util.ZNPNode_ZPP_CbSet.zpp_pool,t.util.ZNPNode_ZPP_CbSet.zpp_pool=n.next,n.next=null),n.elt=e;var i=n;return i.next=this.head,this.head=i,this.modified=!0,this.length++,e},t.util.ZNPList_ZPP_CbSet.prototype.inlined_add=function(e){var n;null==t.util.ZNPNode_ZPP_CbSet.zpp_pool?n=new t.util.ZNPNode_ZPP_CbSet:(n=t.util.ZNPNode_ZPP_CbSet.zpp_pool,t.util.ZNPNode_ZPP_CbSet.zpp_pool=n.next,n.next=null),n.elt=e;var i=n;return i.next=this.head,this.head=i,this.modified=!0,this.length++,e},t.util.ZNPList_ZPP_CbSet.prototype.addAll=function(e){for(var t=e.head;null!=t;){var n=t.elt;this.add(n),t=t.next}},t.util.ZNPList_ZPP_CbSet.prototype.insert=function(e,n){var i;null==t.util.ZNPNode_ZPP_CbSet.zpp_pool?i=new t.util.ZNPNode_ZPP_CbSet:(i=t.util.ZNPNode_ZPP_CbSet.zpp_pool,t.util.ZNPNode_ZPP_CbSet.zpp_pool=i.next,i.next=null),i.elt=n;var r=i;return null==e?(r.next=this.head,this.head=r):(r.next=e.next,e.next=r),this.pushmod=this.modified=!0,this.length++,r},t.util.ZNPList_ZPP_CbSet.prototype.inlined_insert=function(e,n){var i;null==t.util.ZNPNode_ZPP_CbSet.zpp_pool?i=new t.util.ZNPNode_ZPP_CbSet:(i=t.util.ZNPNode_ZPP_CbSet.zpp_pool,t.util.ZNPNode_ZPP_CbSet.zpp_pool=i.next,i.next=null),i.elt=n;var r=i;return null==e?(r.next=this.head,this.head=r):(r.next=e.next,e.next=r),this.pushmod=this.modified=!0,this.length++,r},t.util.ZNPList_ZPP_CbSet.prototype.pop=function(){var e=this.head;this.head=e.next;var n=e;n.elt=null,n.next=t.util.ZNPNode_ZPP_CbSet.zpp_pool,t.util.ZNPNode_ZPP_CbSet.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},t.util.ZNPList_ZPP_CbSet.prototype.inlined_pop=function(){var e=this.head;this.head=e.next;var n=e;n.elt=null,n.next=t.util.ZNPNode_ZPP_CbSet.zpp_pool,t.util.ZNPNode_ZPP_CbSet.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},t.util.ZNPList_ZPP_CbSet.prototype.pop_unsafe=function(){var e=this.head.elt;return this.pop(),e},t.util.ZNPList_ZPP_CbSet.prototype.inlined_pop_unsafe=function(){var e=this.head.elt;return this.pop(),e},t.util.ZNPList_ZPP_CbSet.prototype.remove=function(e){for(var n=null,i=this.head;null!=i;){if(i.elt==e){var r,o;null==n?(o=(r=this.head).next,this.head=o,null==this.head&&(this.pushmod=!0)):(o=(r=n.next).next,n.next=o,null==o&&(this.pushmod=!0));var a=r;a.elt=null,a.next=t.util.ZNPNode_ZPP_CbSet.zpp_pool,t.util.ZNPNode_ZPP_CbSet.zpp_pool=a,this.modified=!0,this.length--,this.pushmod=!0;break}n=i,i=i.next}},t.util.ZNPList_ZPP_CbSet.prototype.try_remove=function(e){for(var t=null,n=this.head,i=!1;null!=n;){if(n.elt==e){this.erase(t),i=!0;break}t=n,n=n.next}return i},t.util.ZNPList_ZPP_CbSet.prototype.inlined_remove=function(e){for(var n=null,i=this.head;null!=i;){if(i.elt==e){var r,o;null==n?(o=(r=this.head).next,this.head=o,null==this.head&&(this.pushmod=!0)):(o=(r=n.next).next,n.next=o,null==o&&(this.pushmod=!0));var a=r;a.elt=null,a.next=t.util.ZNPNode_ZPP_CbSet.zpp_pool,t.util.ZNPNode_ZPP_CbSet.zpp_pool=a,this.modified=!0,this.length--,this.pushmod=!0;break}n=i,i=i.next}},t.util.ZNPList_ZPP_CbSet.prototype.inlined_try_remove=function(e){for(var n=null,i=this.head,r=!1;null!=i;){if(i.elt==e){var o,a;null==n?(a=(o=this.head).next,this.head=a,null==this.head&&(this.pushmod=!0)):(a=(o=n.next).next,n.next=a,null==a&&(this.pushmod=!0));var s=o;s.elt=null,s.next=t.util.ZNPNode_ZPP_CbSet.zpp_pool,t.util.ZNPNode_ZPP_CbSet.zpp_pool=s,this.modified=!0,this.length--,this.pushmod=!0,r=!0;break}n=i,i=i.next}return r},t.util.ZNPList_ZPP_CbSet.prototype.erase=function(e){var n,i;null==e?(i=(n=this.head).next,this.head=i,null==this.head&&(this.pushmod=!0)):(i=(n=e.next).next,e.next=i,null==i&&(this.pushmod=!0));var r=n;return r.elt=null,r.next=t.util.ZNPNode_ZPP_CbSet.zpp_pool,t.util.ZNPNode_ZPP_CbSet.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,i},t.util.ZNPList_ZPP_CbSet.prototype.inlined_erase=function(e){var n,i;null==e?(i=(n=this.head).next,this.head=i,null==this.head&&(this.pushmod=!0)):(i=(n=e.next).next,e.next=i,null==i&&(this.pushmod=!0));var r=n;return r.elt=null,r.next=t.util.ZNPNode_ZPP_CbSet.zpp_pool,t.util.ZNPNode_ZPP_CbSet.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,i},t.util.ZNPList_ZPP_CbSet.prototype.splice=function(e,t){for(;t-- >0&&null!=e.next;)this.erase(e);return e.next},t.util.ZNPList_ZPP_CbSet.prototype.clear=function(){for(;null!=this.head;){var e=this.head;this.head=e.next;var n=e;n.elt=null,n.next=t.util.ZNPNode_ZPP_CbSet.zpp_pool,t.util.ZNPNode_ZPP_CbSet.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},t.util.ZNPList_ZPP_CbSet.prototype.inlined_clear=function(){for(;null!=this.head;){var e=this.head;this.head=e.next;var n=e;n.elt=null,n.next=t.util.ZNPNode_ZPP_CbSet.zpp_pool,t.util.ZNPNode_ZPP_CbSet.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},t.util.ZNPList_ZPP_CbSet.prototype.reverse=function(){for(var e=this.head,t=null;null!=e;){var n=e.next;e.next=t,this.head=e,t=e,e=n}this.modified=!0,this.pushmod=!0},t.util.ZNPList_ZPP_CbSet.prototype.empty=function(){return null==this.head},t.util.ZNPList_ZPP_CbSet.prototype.size=function(){return this.length},t.util.ZNPList_ZPP_CbSet.prototype.has=function(e){var t;t=!1;for(var n=this.head;null!=n;){if(n.elt==e){t=!0;break}n=n.next}return t},t.util.ZNPList_ZPP_CbSet.prototype.inlined_has=function(e){var t;t=!1;for(var n=this.head;null!=n;){if(n.elt==e){t=!0;break}n=n.next}return t},t.util.ZNPList_ZPP_CbSet.prototype.front=function(){return this.head.elt},t.util.ZNPList_ZPP_CbSet.prototype.back=function(){for(var e=this.head,t=e;null!=t;)e=t,t=t.next;return e.elt},t.util.ZNPList_ZPP_CbSet.prototype.iterator_at=function(e){for(var t=this.head;e-- >0&&null!=t;)t=t.next;return t},t.util.ZNPList_ZPP_CbSet.prototype.at=function(e){var t=this.iterator_at(e);return null!=t?t.elt:null},t.util.ZNPList_ZPP_CbSet.prototype.__class__=t.util.ZNPList_ZPP_CbSet,t.callbacks.ZPP_CbType=l["zpp_nape.callbacks.ZPP_CbType"]=function(){this.conlisteners=null,this.bodylisteners=null,this.listeners=null,this.cbsets=null,this.id=0,this.userData=null,this.outer=null,this.id=t.ZPP_ID.CbType(),this.listeners=new t.util.ZNPList_ZPP_InteractionListener,this.bodylisteners=new t.util.ZNPList_ZPP_BodyListener,this.conlisteners=new t.util.ZNPList_ZPP_ConstraintListener,this.constraints=new t.util.ZNPList_ZPP_Constraint,this.interactors=new t.util.ZNPList_ZPP_Interactor,this.cbsets=new t.util.ZNPList_ZPP_CbSet},t.callbacks.ZPP_CbType.__name__=["zpp_nape","callbacks","ZPP_CbType"],t.callbacks.ZPP_CbType.setlt=function(e,t){return e.id<t.id},t.callbacks.ZPP_CbType.prototype.outer=null,t.callbacks.ZPP_CbType.prototype.userData=null,t.callbacks.ZPP_CbType.prototype.id=null,t.callbacks.ZPP_CbType.prototype.cbsets=null,t.callbacks.ZPP_CbType.prototype.interactors=null,t.callbacks.ZPP_CbType.prototype.wrap_interactors=null,t.callbacks.ZPP_CbType.prototype.constraints=null,t.callbacks.ZPP_CbType.prototype.wrap_constraints=null,t.callbacks.ZPP_CbType.prototype.addConstraint=function(e){this.constraints.add(e)},t.callbacks.ZPP_CbType.prototype.addInteractor=function(e){this.interactors.add(e)},t.callbacks.ZPP_CbType.prototype.remConstraint=function(e){this.constraints.remove(e)},t.callbacks.ZPP_CbType.prototype.remInteractor=function(e){this.interactors.remove(e)},t.callbacks.ZPP_CbType.prototype.listeners=null,t.callbacks.ZPP_CbType.prototype.addint=function(e){for(var n=null,i=this.listeners.head;null!=i;){var r=i.elt;if(e.precedence>r.precedence||e.precedence==r.precedence&&e.id>r.id)break;n=i,i=i.next}var o,a=this.listeners;null==t.util.ZNPNode_ZPP_InteractionListener.zpp_pool?o=new t.util.ZNPNode_ZPP_InteractionListener:(o=t.util.ZNPNode_ZPP_InteractionListener.zpp_pool,t.util.ZNPNode_ZPP_InteractionListener.zpp_pool=o.next,o.next=null),o.elt=e;var s=o;null==n?(s.next=a.head,a.head=s):(s.next=n.next,n.next=s),a.pushmod=a.modified=!0,a.length++;for(var l=this.cbsets.head;null!=l;){var p=l.elt;p.zip_listeners=!0,p.invalidate_pairs(),l=l.next}},t.callbacks.ZPP_CbType.prototype.removeint=function(e){this.listeners.remove(e);for(var t=this.cbsets.head;null!=t;){var n=t.elt;n.zip_listeners=!0,n.invalidate_pairs(),t=t.next}},t.callbacks.ZPP_CbType.prototype.invalidateint=function(){for(var e=this.cbsets.head;null!=e;){var t=e.elt;t.zip_listeners=!0,t.invalidate_pairs(),e=e.next}},t.callbacks.ZPP_CbType.prototype.bodylisteners=null,t.callbacks.ZPP_CbType.prototype.addbody=function(e){for(var n=null,i=this.bodylisteners.head;null!=i;){var r=i.elt;if(e.precedence>r.precedence||e.precedence==r.precedence&&e.id>r.id)break;n=i,i=i.next}var o,a=this.bodylisteners;null==t.util.ZNPNode_ZPP_BodyListener.zpp_pool?o=new t.util.ZNPNode_ZPP_BodyListener:(o=t.util.ZNPNode_ZPP_BodyListener.zpp_pool,t.util.ZNPNode_ZPP_BodyListener.zpp_pool=o.next,o.next=null),o.elt=e;var s=o;null==n?(s.next=a.head,a.head=s):(s.next=n.next,n.next=s),a.pushmod=a.modified=!0,a.length++;for(var l=this.cbsets.head;null!=l;)l.elt.zip_bodylisteners=!0,l=l.next},t.callbacks.ZPP_CbType.prototype.removebody=function(e){this.bodylisteners.remove(e);for(var t=this.cbsets.head;null!=t;)t.elt.zip_bodylisteners=!0,t=t.next},t.callbacks.ZPP_CbType.prototype.invalidatebody=function(){for(var e=this.cbsets.head;null!=e;)e.elt.zip_bodylisteners=!0,e=e.next},t.callbacks.ZPP_CbType.prototype.conlisteners=null,t.callbacks.ZPP_CbType.prototype.addconstraint=function(e){for(var n=null,i=this.conlisteners.head;null!=i;){var r=i.elt;if(e.precedence>r.precedence||e.precedence==r.precedence&&e.id>r.id)break;n=i,i=i.next}var o,a=this.conlisteners;null==t.util.ZNPNode_ZPP_ConstraintListener.zpp_pool?o=new t.util.ZNPNode_ZPP_ConstraintListener:(o=t.util.ZNPNode_ZPP_ConstraintListener.zpp_pool,t.util.ZNPNode_ZPP_ConstraintListener.zpp_pool=o.next,o.next=null),o.elt=e;var s=o;null==n?(s.next=a.head,a.head=s):(s.next=n.next,n.next=s),a.pushmod=a.modified=!0,a.length++;for(var l=this.cbsets.head;null!=l;)l.elt.zip_conlisteners=!0,l=l.next},t.callbacks.ZPP_CbType.prototype.removeconstraint=function(e){this.conlisteners.remove(e);for(var t=this.cbsets.head;null!=t;)t.elt.zip_conlisteners=!0,t=t.next},t.callbacks.ZPP_CbType.prototype.invalidateconstraint=function(){for(var e=this.cbsets.head;null!=e;)e.elt.zip_conlisteners=!0,e=e.next},t.callbacks.ZPP_CbType.prototype.__class__=t.callbacks.ZPP_CbType,t.util.ZPP_Flags=l["zpp_nape.util.ZPP_Flags"]=function(){},t.util.ZPP_Flags.__name__=["zpp_nape","util","ZPP_Flags"],t.util.ZPP_Flags.GravMassMode_DEFAULT=null,t.util.ZPP_Flags.GravMassMode_FIXED=null,t.util.ZPP_Flags.GravMassMode_SCALED=null,t.util.ZPP_Flags.InertiaMode_DEFAULT=null,t.util.ZPP_Flags.InertiaMode_FIXED=null,t.util.ZPP_Flags.MassMode_DEFAULT=null,t.util.ZPP_Flags.MassMode_FIXED=null,t.util.ZPP_Flags.BodyType_STATIC=null,t.util.ZPP_Flags.BodyType_DYNAMIC=null,t.util.ZPP_Flags.BodyType_KINEMATIC=null,t.util.ZPP_Flags.ListenerType_BODY=null,t.util.ZPP_Flags.PreFlag_ACCEPT=null,t.util.ZPP_Flags.ListenerType_CONSTRAINT=null,t.util.ZPP_Flags.PreFlag_IGNORE=null,t.util.ZPP_Flags.ListenerType_INTERACTION=null,t.util.ZPP_Flags.PreFlag_ACCEPT_ONCE=null,t.util.ZPP_Flags.ListenerType_PRE=null,t.util.ZPP_Flags.PreFlag_IGNORE_ONCE=null,t.util.ZPP_Flags.CbEvent_BEGIN=null,t.util.ZPP_Flags.InteractionType_COLLISION=null,t.util.ZPP_Flags.CbEvent_ONGOING=null,t.util.ZPP_Flags.InteractionType_SENSOR=null,t.util.ZPP_Flags.CbEvent_END=null,t.util.ZPP_Flags.InteractionType_FLUID=null,t.util.ZPP_Flags.CbEvent_WAKE=null,t.util.ZPP_Flags.InteractionType_ANY=null,t.util.ZPP_Flags.CbEvent_SLEEP=null,t.util.ZPP_Flags.CbEvent_BREAK=null,t.util.ZPP_Flags.CbEvent_PRE=null,t.util.ZPP_Flags.Winding_UNDEFINED=null,t.util.ZPP_Flags.Winding_CLOCKWISE=null,t.util.ZPP_Flags.Winding_ANTICLOCKWISE=null,t.util.ZPP_Flags.ValidationResult_VALID=null,t.util.ZPP_Flags.ValidationResult_DEGENERATE=null,t.util.ZPP_Flags.ValidationResult_CONCAVE=null,t.util.ZPP_Flags.ValidationResult_SELF_INTERSECTING=null,t.util.ZPP_Flags.ShapeType_CIRCLE=null,t.util.ZPP_Flags.ShapeType_POLYGON=null,t.util.ZPP_Flags.Broadphase_DYNAMIC_AABB_TREE=null,t.util.ZPP_Flags.Broadphase_SWEEP_AND_PRUNE=null,t.util.ZPP_Flags.ArbiterType_COLLISION=null,t.util.ZPP_Flags.ArbiterType_SENSOR=null,t.util.ZPP_Flags.ArbiterType_FLUID=null,t.util.ZPP_Flags.prototype.__class__=t.util.ZPP_Flags,t.callbacks.ZPP_Listener=l["zpp_nape.callbacks.ZPP_Listener"]=function(){this.space=null,this.interaction=null,this.constraint=null,this.body=null,this.precedence=0,this.event=0,this.type=0,this.id=0,this.outer=null,this.id=t.ZPP_ID.Listener()},t.callbacks.ZPP_Listener.__name__=["zpp_nape","callbacks","ZPP_Listener"],t.callbacks.ZPP_Listener.setlt=function(e,t){return!(e.precedence<=t.precedence)||e.precedence==t.precedence&&e.id>t.id},t.callbacks.ZPP_Listener.prototype.outer=null,t.callbacks.ZPP_Listener.prototype.id=null,t.callbacks.ZPP_Listener.prototype.type=null,t.callbacks.ZPP_Listener.prototype.event=null,t.callbacks.ZPP_Listener.prototype.precedence=null,t.callbacks.ZPP_Listener.prototype.body=null,t.callbacks.ZPP_Listener.prototype.constraint=null,t.callbacks.ZPP_Listener.prototype.interaction=null,t.callbacks.ZPP_Listener.prototype.space=null,t.callbacks.ZPP_Listener.prototype.swapEvent=function(e){},t.callbacks.ZPP_Listener.prototype.invalidate_precedence=function(){},t.callbacks.ZPP_Listener.prototype.addedToSpace=function(){},t.callbacks.ZPP_Listener.prototype.removedFromSpace=function(){},t.callbacks.ZPP_Listener.prototype.__class__=t.callbacks.ZPP_Listener,t.callbacks.ZPP_BodyListener=l["zpp_nape.callbacks.ZPP_BodyListener"]=function(e,n,i){this.handler=null,this.options=null,this.outer_zn=null,t.callbacks.ZPP_Listener.call(this),this.event=n,this.handler=i,this.body=this,this.type=0,this.options=e.zpp_inner},t.callbacks.ZPP_BodyListener.__name__=["zpp_nape","callbacks","ZPP_BodyListener"],t.callbacks.ZPP_BodyListener.__super__=t.callbacks.ZPP_Listener,t.callbacks.ZPP_Listener.prototype)t.callbacks.ZPP_BodyListener.prototype[u]=t.callbacks.ZPP_Listener.prototype[u];for(var u in t.callbacks.ZPP_BodyListener.prototype.outer_zn=null,t.callbacks.ZPP_BodyListener.prototype.options=null,t.callbacks.ZPP_BodyListener.prototype.handler=null,t.callbacks.ZPP_BodyListener.prototype.immutable_options=function(){if(null!=this.space&&this.space.midstep)throw new n._Boot.HaxeError("Error: Cannot change listener type options during space.step()")},t.callbacks.ZPP_BodyListener.prototype.addedToSpace=function(){this.options.handler=p(this,this.cbtype_change);for(var e=this.options.includes.head;null!=e;){for(var n=e.elt,i=null,r=n.bodylisteners.head;null!=r;){var o=r.elt;if(this.precedence>o.precedence||this.precedence==o.precedence&&this.id>o.id)break;i=r,r=r.next}var a,s=n.bodylisteners;null==t.util.ZNPNode_ZPP_BodyListener.zpp_pool?a=new t.util.ZNPNode_ZPP_BodyListener:(a=t.util.ZNPNode_ZPP_BodyListener.zpp_pool,t.util.ZNPNode_ZPP_BodyListener.zpp_pool=a.next,a.next=null),a.elt=this;var l=a;null==i?(l.next=s.head,s.head=l):(l.next=i.next,i.next=l),s.pushmod=s.modified=!0,s.length++;for(var u=n.cbsets.head;null!=u;)u.elt.zip_bodylisteners=!0,u=u.next;e=e.next}},t.callbacks.ZPP_BodyListener.prototype.removedFromSpace=function(){for(var e=this.options.includes.head;null!=e;){var t=e.elt;t.bodylisteners.remove(this);for(var n=t.cbsets.head;null!=n;)n.elt.zip_bodylisteners=!0,n=n.next;e=e.next}this.options.handler=null},t.callbacks.ZPP_BodyListener.prototype.cbtype_change=function(e,n,i){this.removedFromSpace();var r=this.options;if(n)if(i){for(var o=null,a=r.includes.head;null!=a;){var s=a.elt;if(e.id<s.id)break;o=a,a=a.next}var l,p=r.includes;null==t.util.ZNPNode_ZPP_CbType.zpp_pool?l=new t.util.ZNPNode_ZPP_CbType:(l=t.util.ZNPNode_ZPP_CbType.zpp_pool,t.util.ZNPNode_ZPP_CbType.zpp_pool=l.next,l.next=null),l.elt=e;var u=l;null==o?(u.next=p.head,p.head=u):(u.next=o.next,o.next=u),p.pushmod=p.modified=!0,p.length++}else r.includes.remove(e);else if(i){for(var h=null,c=r.excludes.head;null!=c;){var _=c.elt;if(e.id<_.id)break;h=c,c=c.next}var d,m=r.excludes;null==t.util.ZNPNode_ZPP_CbType.zpp_pool?d=new t.util.ZNPNode_ZPP_CbType:(d=t.util.ZNPNode_ZPP_CbType.zpp_pool,t.util.ZNPNode_ZPP_CbType.zpp_pool=d.next,d.next=null),d.elt=e;var P=d;null==h?(P.next=m.head,m.head=P):(P.next=h.next,h.next=P),m.pushmod=m.modified=!0,m.length++}else r.excludes.remove(e);this.addedToSpace()},t.callbacks.ZPP_BodyListener.prototype.invalidate_precedence=function(){null!=this.space&&(this.removedFromSpace(),this.addedToSpace())},t.callbacks.ZPP_BodyListener.prototype.swapEvent=function(e){if(2!=e&&3!=e)throw new n._Boot.HaxeError("Error: BodyListener event must be either WAKE or SLEEP only");this.removedFromSpace(),this.event=e,this.addedToSpace()},t.callbacks.ZPP_BodyListener.prototype.__class__=t.callbacks.ZPP_BodyListener,t.callbacks.ZPP_ConstraintListener=l["zpp_nape.callbacks.ZPP_ConstraintListener"]=function(e,n,i){this.handler=null,this.options=null,this.outer_zn=null,t.callbacks.ZPP_Listener.call(this),this.event=n,this.handler=i,this.constraint=this,this.type=1,this.options=e.zpp_inner},t.callbacks.ZPP_ConstraintListener.__name__=["zpp_nape","callbacks","ZPP_ConstraintListener"],t.callbacks.ZPP_ConstraintListener.__super__=t.callbacks.ZPP_Listener,t.callbacks.ZPP_Listener.prototype)t.callbacks.ZPP_ConstraintListener.prototype[u]=t.callbacks.ZPP_Listener.prototype[u];for(var u in t.callbacks.ZPP_ConstraintListener.prototype.outer_zn=null,t.callbacks.ZPP_ConstraintListener.prototype.options=null,t.callbacks.ZPP_ConstraintListener.prototype.handler=null,t.callbacks.ZPP_ConstraintListener.prototype.immutable_options=function(){if(null!=this.space&&this.space.midstep)throw new n._Boot.HaxeError("Error: Cannot change listener type options during space.step()")},t.callbacks.ZPP_ConstraintListener.prototype.addedToSpace=function(){this.options.handler=p(this,this.cbtype_change);for(var e=this.options.includes.head;null!=e;){for(var n=e.elt,i=null,r=n.conlisteners.head;null!=r;){var o=r.elt;if(this.precedence>o.precedence||this.precedence==o.precedence&&this.id>o.id)break;i=r,r=r.next}var a,s=n.conlisteners;null==t.util.ZNPNode_ZPP_ConstraintListener.zpp_pool?a=new t.util.ZNPNode_ZPP_ConstraintListener:(a=t.util.ZNPNode_ZPP_ConstraintListener.zpp_pool,t.util.ZNPNode_ZPP_ConstraintListener.zpp_pool=a.next,a.next=null),a.elt=this;var l=a;null==i?(l.next=s.head,s.head=l):(l.next=i.next,i.next=l),s.pushmod=s.modified=!0,s.length++;for(var u=n.cbsets.head;null!=u;)u.elt.zip_conlisteners=!0,u=u.next;e=e.next}},t.callbacks.ZPP_ConstraintListener.prototype.removedFromSpace=function(){for(var e=this.options.includes.head;null!=e;){var t=e.elt;t.conlisteners.remove(this);for(var n=t.cbsets.head;null!=n;)n.elt.zip_conlisteners=!0,n=n.next;e=e.next}this.options.handler=null},t.callbacks.ZPP_ConstraintListener.prototype.cbtype_change=function(e,n,i){this.removedFromSpace();var r=this.options;if(n)if(i){for(var o=null,a=r.includes.head;null!=a;){var s=a.elt;if(e.id<s.id)break;o=a,a=a.next}var l,p=r.includes;null==t.util.ZNPNode_ZPP_CbType.zpp_pool?l=new t.util.ZNPNode_ZPP_CbType:(l=t.util.ZNPNode_ZPP_CbType.zpp_pool,t.util.ZNPNode_ZPP_CbType.zpp_pool=l.next,l.next=null),l.elt=e;var u=l;null==o?(u.next=p.head,p.head=u):(u.next=o.next,o.next=u),p.pushmod=p.modified=!0,p.length++}else r.includes.remove(e);else if(i){for(var h=null,c=r.excludes.head;null!=c;){var _=c.elt;if(e.id<_.id)break;h=c,c=c.next}var d,m=r.excludes;null==t.util.ZNPNode_ZPP_CbType.zpp_pool?d=new t.util.ZNPNode_ZPP_CbType:(d=t.util.ZNPNode_ZPP_CbType.zpp_pool,t.util.ZNPNode_ZPP_CbType.zpp_pool=d.next,d.next=null),d.elt=e;var P=d;null==h?(P.next=m.head,m.head=P):(P.next=h.next,h.next=P),m.pushmod=m.modified=!0,m.length++}else r.excludes.remove(e);this.addedToSpace()},t.callbacks.ZPP_ConstraintListener.prototype.invalidate_precedence=function(){null!=this.space&&(this.removedFromSpace(),this.addedToSpace())},t.callbacks.ZPP_ConstraintListener.prototype.swapEvent=function(e){if(2!=e&&3!=e&&4!=e)throw new n._Boot.HaxeError("Error: ConstraintListener event must be either WAKE or SLEEP only");this.removedFromSpace(),this.event=e,this.addedToSpace()},t.callbacks.ZPP_ConstraintListener.prototype.__class__=t.callbacks.ZPP_ConstraintListener,t.util.ZNPList_ZPP_CbType=l["zpp_nape.util.ZNPList_ZPP_CbType"]=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null},t.util.ZNPList_ZPP_CbType.__name__=["zpp_nape","util","ZNPList_ZPP_CbType"],t.util.ZNPList_ZPP_CbType.prototype.head=null,t.util.ZNPList_ZPP_CbType.prototype.begin=function(){return this.head},t.util.ZNPList_ZPP_CbType.prototype.modified=null,t.util.ZNPList_ZPP_CbType.prototype.pushmod=null,t.util.ZNPList_ZPP_CbType.prototype.length=null,t.util.ZNPList_ZPP_CbType.prototype.setbegin=function(e){this.head=e,this.modified=!0,this.pushmod=!0},t.util.ZNPList_ZPP_CbType.prototype.add=function(e){var n;null==t.util.ZNPNode_ZPP_CbType.zpp_pool?n=new t.util.ZNPNode_ZPP_CbType:(n=t.util.ZNPNode_ZPP_CbType.zpp_pool,t.util.ZNPNode_ZPP_CbType.zpp_pool=n.next,n.next=null),n.elt=e;var i=n;return i.next=this.head,this.head=i,this.modified=!0,this.length++,e},t.util.ZNPList_ZPP_CbType.prototype.inlined_add=function(e){var n;null==t.util.ZNPNode_ZPP_CbType.zpp_pool?n=new t.util.ZNPNode_ZPP_CbType:(n=t.util.ZNPNode_ZPP_CbType.zpp_pool,t.util.ZNPNode_ZPP_CbType.zpp_pool=n.next,n.next=null),n.elt=e;var i=n;return i.next=this.head,this.head=i,this.modified=!0,this.length++,e},t.util.ZNPList_ZPP_CbType.prototype.addAll=function(e){for(var t=e.head;null!=t;){var n=t.elt;this.add(n),t=t.next}},t.util.ZNPList_ZPP_CbType.prototype.insert=function(e,n){var i;null==t.util.ZNPNode_ZPP_CbType.zpp_pool?i=new t.util.ZNPNode_ZPP_CbType:(i=t.util.ZNPNode_ZPP_CbType.zpp_pool,t.util.ZNPNode_ZPP_CbType.zpp_pool=i.next,i.next=null),i.elt=n;var r=i;return null==e?(r.next=this.head,this.head=r):(r.next=e.next,e.next=r),this.pushmod=this.modified=!0,this.length++,r},t.util.ZNPList_ZPP_CbType.prototype.inlined_insert=function(e,n){var i;null==t.util.ZNPNode_ZPP_CbType.zpp_pool?i=new t.util.ZNPNode_ZPP_CbType:(i=t.util.ZNPNode_ZPP_CbType.zpp_pool,t.util.ZNPNode_ZPP_CbType.zpp_pool=i.next,i.next=null),i.elt=n;var r=i;return null==e?(r.next=this.head,this.head=r):(r.next=e.next,e.next=r),this.pushmod=this.modified=!0,this.length++,r},t.util.ZNPList_ZPP_CbType.prototype.pop=function(){var e=this.head;this.head=e.next;var n=e;n.elt=null,n.next=t.util.ZNPNode_ZPP_CbType.zpp_pool,t.util.ZNPNode_ZPP_CbType.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},t.util.ZNPList_ZPP_CbType.prototype.inlined_pop=function(){var e=this.head;this.head=e.next;var n=e;n.elt=null,n.next=t.util.ZNPNode_ZPP_CbType.zpp_pool,t.util.ZNPNode_ZPP_CbType.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},t.util.ZNPList_ZPP_CbType.prototype.pop_unsafe=function(){var e=this.head.elt;return this.pop(),e},t.util.ZNPList_ZPP_CbType.prototype.inlined_pop_unsafe=function(){var e=this.head.elt;return this.pop(),e},t.util.ZNPList_ZPP_CbType.prototype.remove=function(e){for(var n=null,i=this.head;null!=i;){if(i.elt==e){var r,o;null==n?(o=(r=this.head).next,this.head=o,null==this.head&&(this.pushmod=!0)):(o=(r=n.next).next,n.next=o,null==o&&(this.pushmod=!0));var a=r;a.elt=null,a.next=t.util.ZNPNode_ZPP_CbType.zpp_pool,t.util.ZNPNode_ZPP_CbType.zpp_pool=a,this.modified=!0,this.length--,this.pushmod=!0;break}n=i,i=i.next}},t.util.ZNPList_ZPP_CbType.prototype.try_remove=function(e){for(var t=null,n=this.head,i=!1;null!=n;){if(n.elt==e){this.erase(t),i=!0;break}t=n,n=n.next}return i},t.util.ZNPList_ZPP_CbType.prototype.inlined_remove=function(e){for(var n=null,i=this.head;null!=i;){if(i.elt==e){var r,o;null==n?(o=(r=this.head).next,this.head=o,null==this.head&&(this.pushmod=!0)):(o=(r=n.next).next,n.next=o,null==o&&(this.pushmod=!0));var a=r;a.elt=null,a.next=t.util.ZNPNode_ZPP_CbType.zpp_pool,t.util.ZNPNode_ZPP_CbType.zpp_pool=a,this.modified=!0,this.length--,this.pushmod=!0;break}n=i,i=i.next}},t.util.ZNPList_ZPP_CbType.prototype.inlined_try_remove=function(e){for(var n=null,i=this.head,r=!1;null!=i;){if(i.elt==e){var o,a;null==n?(a=(o=this.head).next,this.head=a,null==this.head&&(this.pushmod=!0)):(a=(o=n.next).next,n.next=a,null==a&&(this.pushmod=!0));var s=o;s.elt=null,s.next=t.util.ZNPNode_ZPP_CbType.zpp_pool,t.util.ZNPNode_ZPP_CbType.zpp_pool=s,this.modified=!0,this.length--,this.pushmod=!0,r=!0;break}n=i,i=i.next}return r},t.util.ZNPList_ZPP_CbType.prototype.erase=function(e){var n,i;null==e?(i=(n=this.head).next,this.head=i,null==this.head&&(this.pushmod=!0)):(i=(n=e.next).next,e.next=i,null==i&&(this.pushmod=!0));var r=n;return r.elt=null,r.next=t.util.ZNPNode_ZPP_CbType.zpp_pool,t.util.ZNPNode_ZPP_CbType.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,i},t.util.ZNPList_ZPP_CbType.prototype.inlined_erase=function(e){var n,i;null==e?(i=(n=this.head).next,this.head=i,null==this.head&&(this.pushmod=!0)):(i=(n=e.next).next,e.next=i,null==i&&(this.pushmod=!0));var r=n;return r.elt=null,r.next=t.util.ZNPNode_ZPP_CbType.zpp_pool,t.util.ZNPNode_ZPP_CbType.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,i},t.util.ZNPList_ZPP_CbType.prototype.splice=function(e,t){for(;t-- >0&&null!=e.next;)this.erase(e);return e.next},t.util.ZNPList_ZPP_CbType.prototype.clear=function(){for(;null!=this.head;){var e=this.head;this.head=e.next;var n=e;n.elt=null,n.next=t.util.ZNPNode_ZPP_CbType.zpp_pool,t.util.ZNPNode_ZPP_CbType.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},t.util.ZNPList_ZPP_CbType.prototype.inlined_clear=function(){for(;null!=this.head;){var e=this.head;this.head=e.next;var n=e;n.elt=null,n.next=t.util.ZNPNode_ZPP_CbType.zpp_pool,t.util.ZNPNode_ZPP_CbType.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},t.util.ZNPList_ZPP_CbType.prototype.reverse=function(){for(var e=this.head,t=null;null!=e;){var n=e.next;e.next=t,this.head=e,t=e,e=n}this.modified=!0,this.pushmod=!0},t.util.ZNPList_ZPP_CbType.prototype.empty=function(){return null==this.head},t.util.ZNPList_ZPP_CbType.prototype.size=function(){return this.length},t.util.ZNPList_ZPP_CbType.prototype.has=function(e){var t;t=!1;for(var n=this.head;null!=n;){if(n.elt==e){t=!0;break}n=n.next}return t},t.util.ZNPList_ZPP_CbType.prototype.inlined_has=function(e){var t;t=!1;for(var n=this.head;null!=n;){if(n.elt==e){t=!0;break}n=n.next}return t},t.util.ZNPList_ZPP_CbType.prototype.front=function(){return this.head.elt},t.util.ZNPList_ZPP_CbType.prototype.back=function(){for(var e=this.head,t=e;null!=t;)e=t,t=t.next;return e.elt},t.util.ZNPList_ZPP_CbType.prototype.iterator_at=function(e){for(var t=this.head;e-- >0&&null!=t;)t=t.next;return t},t.util.ZNPList_ZPP_CbType.prototype.at=function(e){var t=this.iterator_at(e);return null!=t?t.elt:null},t.util.ZNPList_ZPP_CbType.prototype.__class__=t.util.ZNPList_ZPP_CbType,t.callbacks.ZPP_InteractionListener=l["zpp_nape.callbacks.ZPP_InteractionListener"]=function(e,n,i,r){this.handlerp=null,this.pure=!1,this.allowSleepingCallbacks=!1,this.handleri=null,this.options2=null,this.options1=null,this.itype=0,this.outer_znp=null,this.outer_zni=null,t.callbacks.ZPP_Listener.call(this),this.type=r,this.interaction=this,this.event=i,this.options1=e.zpp_inner,this.options2=n.zpp_inner,this.allowSleepingCallbacks=!1},t.callbacks.ZPP_InteractionListener.__name__=["zpp_nape","callbacks","ZPP_InteractionListener"],t.callbacks.ZPP_InteractionListener.__super__=t.callbacks.ZPP_Listener,t.callbacks.ZPP_Listener.prototype)t.callbacks.ZPP_InteractionListener.prototype[u]=t.callbacks.ZPP_Listener.prototype[u];for(var u in t.callbacks.ZPP_InteractionListener.prototype.outer_zni=null,t.callbacks.ZPP_InteractionListener.prototype.outer_znp=null,t.callbacks.ZPP_InteractionListener.prototype.itype=null,t.callbacks.ZPP_InteractionListener.prototype.options1=null,t.callbacks.ZPP_InteractionListener.prototype.options2=null,t.callbacks.ZPP_InteractionListener.prototype.handleri=null,t.callbacks.ZPP_InteractionListener.prototype.allowSleepingCallbacks=null,t.callbacks.ZPP_InteractionListener.prototype.pure=null,t.callbacks.ZPP_InteractionListener.prototype.handlerp=null,t.callbacks.ZPP_InteractionListener.prototype.setInteractionType=function(e){this.itype=e},t.callbacks.ZPP_InteractionListener.prototype.wake=function(){for(var e=this.options1.includes.head,t=this.options2.includes.head;null!=e&&null!=t;){var n=e.elt,i=t.elt;if(n==i){for(var r=n.interactors.head;null!=r;)r.elt.wake(),r=r.next;e=e.next,t=t.next}else if(n.id<i.id){for(var o=n.interactors.head;null!=o;)o.elt.wake(),o=o.next;e=e.next}else{for(var a=i.interactors.head;null!=a;)a.elt.wake(),a=a.next;t=t.next}}for(;null!=e;){for(var s=e.elt.interactors.head;null!=s;)s.elt.wake(),s=s.next;e=e.next}for(;null!=t;){for(var l=t.elt.interactors.head;null!=l;)l.elt.wake(),l=l.next;t=t.next}},t.callbacks.ZPP_InteractionListener.prototype.CbSetset=function(e,n,i){for(var r=t.callbacks.ZPP_InteractionListener.UCbSet,o=t.callbacks.ZPP_InteractionListener.VCbSet,a=t.callbacks.ZPP_InteractionListener.WCbSet,s=e.head,l=n.head;null!=s&&null!=l;){var p=s.elt,u=l.elt;if(p==u){var h;null==t.util.ZNPNode_ZPP_CbSet.zpp_pool?h=new t.util.ZNPNode_ZPP_CbSet:(h=t.util.ZNPNode_ZPP_CbSet.zpp_pool,t.util.ZNPNode_ZPP_CbSet.zpp_pool=h.next,h.next=null),h.elt=p;var c=h;c.next=a.head,a.head=c,a.modified=!0,a.length++,s=s.next,l=l.next}else if(t.callbacks.ZPP_CbSet.setlt(p,u)){var _;null==t.util.ZNPNode_ZPP_CbSet.zpp_pool?_=new t.util.ZNPNode_ZPP_CbSet:(_=t.util.ZNPNode_ZPP_CbSet.zpp_pool,t.util.ZNPNode_ZPP_CbSet.zpp_pool=_.next,_.next=null),_.elt=p;var d=_;d.next=r.head,r.head=d,r.modified=!0,r.length++,s=s.next}else{var m;null==t.util.ZNPNode_ZPP_CbSet.zpp_pool?m=new t.util.ZNPNode_ZPP_CbSet:(m=t.util.ZNPNode_ZPP_CbSet.zpp_pool,t.util.ZNPNode_ZPP_CbSet.zpp_pool=m.next,m.next=null),m.elt=u;var P=m;P.next=o.head,o.head=P,o.modified=!0,o.length++,l=l.next}}for(;null!=s;){var f,x=s.elt;null==t.util.ZNPNode_ZPP_CbSet.zpp_pool?f=new t.util.ZNPNode_ZPP_CbSet:(f=t.util.ZNPNode_ZPP_CbSet.zpp_pool,t.util.ZNPNode_ZPP_CbSet.zpp_pool=f.next,f.next=null),f.elt=x;var y=f;y.next=r.head,r.head=y,r.modified=!0,r.length++,s=s.next}for(;null!=l;){var v,g=l.elt;null==t.util.ZNPNode_ZPP_CbSet.zpp_pool?v=new t.util.ZNPNode_ZPP_CbSet:(v=t.util.ZNPNode_ZPP_CbSet.zpp_pool,t.util.ZNPNode_ZPP_CbSet.zpp_pool=v.next,v.next=null),v.elt=g;var b=v;b.next=o.head,o.head=b,o.modified=!0,o.length++,l=l.next}for(;null!=r.head;)for(var z=r.pop_unsafe(),w=n.head;null!=w;)i(z,w.elt),w=w.next;for(;null!=o.head;)for(var Z=o.pop_unsafe(),E=a.head;null!=E;)i(Z,E.elt),E=E.next;for(;null!=a.head;){var M=a.pop_unsafe();i(M,M);for(var S=a.head;null!=S;)i(M,S.elt),S=S.next}},t.callbacks.ZPP_InteractionListener.prototype.CbTypeset=function(e,n,i){for(var r=t.callbacks.ZPP_InteractionListener.UCbType,o=t.callbacks.ZPP_InteractionListener.VCbType,a=t.callbacks.ZPP_InteractionListener.WCbType,s=e.head,l=n.head;null!=s&&null!=l;){var p=s.elt,u=l.elt;if(p==u){var h;null==t.util.ZNPNode_ZPP_CbType.zpp_pool?h=new t.util.ZNPNode_ZPP_CbType:(h=t.util.ZNPNode_ZPP_CbType.zpp_pool,t.util.ZNPNode_ZPP_CbType.zpp_pool=h.next,h.next=null),h.elt=p;var c=h;c.next=a.head,a.head=c,a.modified=!0,a.length++,s=s.next,l=l.next}else if(p.id<u.id){var _;null==t.util.ZNPNode_ZPP_CbType.zpp_pool?_=new t.util.ZNPNode_ZPP_CbType:(_=t.util.ZNPNode_ZPP_CbType.zpp_pool,t.util.ZNPNode_ZPP_CbType.zpp_pool=_.next,_.next=null),_.elt=p;var d=_;d.next=r.head,r.head=d,r.modified=!0,r.length++,s=s.next}else{var m;null==t.util.ZNPNode_ZPP_CbType.zpp_pool?m=new t.util.ZNPNode_ZPP_CbType:(m=t.util.ZNPNode_ZPP_CbType.zpp_pool,t.util.ZNPNode_ZPP_CbType.zpp_pool=m.next,m.next=null),m.elt=u;var P=m;P.next=o.head,o.head=P,o.modified=!0,o.length++,l=l.next}}for(;null!=s;){var f,x=s.elt;null==t.util.ZNPNode_ZPP_CbType.zpp_pool?f=new t.util.ZNPNode_ZPP_CbType:(f=t.util.ZNPNode_ZPP_CbType.zpp_pool,t.util.ZNPNode_ZPP_CbType.zpp_pool=f.next,f.next=null),f.elt=x;var y=f;y.next=r.head,r.head=y,r.modified=!0,r.length++,s=s.next}for(;null!=l;){var v,g=l.elt;null==t.util.ZNPNode_ZPP_CbType.zpp_pool?v=new t.util.ZNPNode_ZPP_CbType:(v=t.util.ZNPNode_ZPP_CbType.zpp_pool,t.util.ZNPNode_ZPP_CbType.zpp_pool=v.next,v.next=null),v.elt=g;var b=v;b.next=o.head,o.head=b,o.modified=!0,o.length++,l=l.next}for(;null!=r.head;)for(var z=r.pop_unsafe(),w=n.head;null!=w;)i(z,w.elt),w=w.next;for(;null!=o.head;)for(var Z=o.pop_unsafe(),E=a.head;null!=E;)i(Z,E.elt),E=E.next;for(;null!=a.head;){var M=a.pop_unsafe();i(M,M);for(var S=a.head;null!=S;)i(M,S.elt),S=S.next}},t.callbacks.ZPP_InteractionListener.prototype.with_uniquesets=function(e){var n;null==t.util.ZPP_Set_ZPP_CbSetPair.zpp_pool?n=new t.util.ZPP_Set_ZPP_CbSetPair:(n=t.util.ZPP_Set_ZPP_CbSetPair.zpp_pool,t.util.ZPP_Set_ZPP_CbSetPair.zpp_pool=n.next,n.next=null),n.lt=t.callbacks.ZPP_CbSetPair.setlt;for(var i=this.options2.includes,r=t.callbacks.ZPP_InteractionListener.UCbType,o=t.callbacks.ZPP_InteractionListener.VCbType,a=t.callbacks.ZPP_InteractionListener.WCbType,s=this.options1.includes.head,l=i.head;null!=s&&null!=l;){var p=s.elt,u=l.elt;if(p==u){var h;null==t.util.ZNPNode_ZPP_CbType.zpp_pool?h=new t.util.ZNPNode_ZPP_CbType:(h=t.util.ZNPNode_ZPP_CbType.zpp_pool,t.util.ZNPNode_ZPP_CbType.zpp_pool=h.next,h.next=null),h.elt=p;var c=h;c.next=a.head,a.head=c,a.modified=!0,a.length++,s=s.next,l=l.next}else if(p.id<u.id){var _;null==t.util.ZNPNode_ZPP_CbType.zpp_pool?_=new t.util.ZNPNode_ZPP_CbType:(_=t.util.ZNPNode_ZPP_CbType.zpp_pool,t.util.ZNPNode_ZPP_CbType.zpp_pool=_.next,_.next=null),_.elt=p;var d=_;d.next=r.head,r.head=d,r.modified=!0,r.length++,s=s.next}else{var m;null==t.util.ZNPNode_ZPP_CbType.zpp_pool?m=new t.util.ZNPNode_ZPP_CbType:(m=t.util.ZNPNode_ZPP_CbType.zpp_pool,t.util.ZNPNode_ZPP_CbType.zpp_pool=m.next,m.next=null),m.elt=u;var P=m;P.next=o.head,o.head=P,o.modified=!0,o.length++,l=l.next}}for(;null!=s;){var f,x=s.elt;null==t.util.ZNPNode_ZPP_CbType.zpp_pool?f=new t.util.ZNPNode_ZPP_CbType:(f=t.util.ZNPNode_ZPP_CbType.zpp_pool,t.util.ZNPNode_ZPP_CbType.zpp_pool=f.next,f.next=null),f.elt=x;var y=f;y.next=r.head,r.head=y,r.modified=!0,r.length++,s=s.next}for(;null!=l;){var v,g=l.elt;null==t.util.ZNPNode_ZPP_CbType.zpp_pool?v=new t.util.ZNPNode_ZPP_CbType:(v=t.util.ZNPNode_ZPP_CbType.zpp_pool,t.util.ZNPNode_ZPP_CbType.zpp_pool=v.next,v.next=null),v.elt=g;var b=v;b.next=o.head,o.head=b,o.modified=!0,o.length++,l=l.next}for(;null!=r.head;)for(var z=r.pop_unsafe(),w=i.head;null!=w;){for(var Z=w.elt.cbsets,E=t.callbacks.ZPP_InteractionListener.UCbSet,M=t.callbacks.ZPP_InteractionListener.VCbSet,S=t.callbacks.ZPP_InteractionListener.WCbSet,C=z.cbsets.head,N=Z.head;null!=C&&null!=N;){var A=C.elt,L=N.elt;if(A==L){var B;null==t.util.ZNPNode_ZPP_CbSet.zpp_pool?B=new t.util.ZNPNode_ZPP_CbSet:(B=t.util.ZNPNode_ZPP_CbSet.zpp_pool,t.util.ZNPNode_ZPP_CbSet.zpp_pool=B.next,B.next=null),B.elt=A;var T=B;T.next=S.head,S.head=T,S.modified=!0,S.length++,C=C.next,N=N.next}else if(t.callbacks.ZPP_CbSet.setlt(A,L)){var V;null==t.util.ZNPNode_ZPP_CbSet.zpp_pool?V=new t.util.ZNPNode_ZPP_CbSet:(V=t.util.ZNPNode_ZPP_CbSet.zpp_pool,t.util.ZNPNode_ZPP_CbSet.zpp_pool=V.next,V.next=null),V.elt=A;var k=V;k.next=E.head,E.head=k,E.modified=!0,E.length++,C=C.next}else{var I;null==t.util.ZNPNode_ZPP_CbSet.zpp_pool?I=new t.util.ZNPNode_ZPP_CbSet:(I=t.util.ZNPNode_ZPP_CbSet.zpp_pool,t.util.ZNPNode_ZPP_CbSet.zpp_pool=I.next,I.next=null),I.elt=L;var O=I;O.next=M.head,M.head=O,M.modified=!0,M.length++,N=N.next}}for(;null!=C;){var R,H=C.elt;null==t.util.ZNPNode_ZPP_CbSet.zpp_pool?R=new t.util.ZNPNode_ZPP_CbSet:(R=t.util.ZNPNode_ZPP_CbSet.zpp_pool,t.util.ZNPNode_ZPP_CbSet.zpp_pool=R.next,R.next=null),R.elt=H;var F=R;F.next=E.head,E.head=F,E.modified=!0,E.length++,C=C.next}for(;null!=N;){var D,G=N.elt;null==t.util.ZNPNode_ZPP_CbSet.zpp_pool?D=new t.util.ZNPNode_ZPP_CbSet:(D=t.util.ZNPNode_ZPP_CbSet.zpp_pool,t.util.ZNPNode_ZPP_CbSet.zpp_pool=D.next,D.next=null),D.elt=G;var U=D;U.next=M.head,M.head=U,M.modified=!0,M.length++,N=N.next}for(;null!=E.head;)for(var j=E.pop_unsafe(),W=Z.head;null!=W;){var q,J=W.elt;j.validate(),J.validate(),t.callbacks.ZPP_CbSet.single_intersection(j,J,this)&&(null==t.callbacks.ZPP_CbSetPair.zpp_pool?q=new t.callbacks.ZPP_CbSetPair:(q=t.callbacks.ZPP_CbSetPair.zpp_pool,t.callbacks.ZPP_CbSetPair.zpp_pool=q.next,q.next=null),q.zip_listeners=!0,t.callbacks.ZPP_CbSet.setlt(j,J)?(q.a=j,q.b=J):(q.a=J,q.b=j),n.try_insert(q)),W=W.next}for(;null!=M.head;)for(var $=M.pop_unsafe(),X=S.head;null!=X;){var Y,K=X.elt;$.validate(),K.validate(),t.callbacks.ZPP_CbSet.single_intersection($,K,this)&&(null==t.callbacks.ZPP_CbSetPair.zpp_pool?Y=new t.callbacks.ZPP_CbSetPair:(Y=t.callbacks.ZPP_CbSetPair.zpp_pool,t.callbacks.ZPP_CbSetPair.zpp_pool=Y.next,Y.next=null),Y.zip_listeners=!0,t.callbacks.ZPP_CbSet.setlt($,K)?(Y.a=$,Y.b=K):(Y.a=K,Y.b=$),n.try_insert(Y)),X=X.next}for(;null!=S.head;){var Q,ee=S.pop_unsafe();ee.validate(),ee.validate(),t.callbacks.ZPP_CbSet.single_intersection(ee,ee,this)&&(null==t.callbacks.ZPP_CbSetPair.zpp_pool?Q=new t.callbacks.ZPP_CbSetPair:(Q=t.callbacks.ZPP_CbSetPair.zpp_pool,t.callbacks.ZPP_CbSetPair.zpp_pool=Q.next,Q.next=null),Q.zip_listeners=!0,t.callbacks.ZPP_CbSet.setlt(ee,ee),Q.a=ee,Q.b=ee,n.try_insert(Q));for(var te=S.head;null!=te;){var ne,ie=te.elt;ee.validate(),ie.validate(),t.callbacks.ZPP_CbSet.single_intersection(ee,ie,this)&&(null==t.callbacks.ZPP_CbSetPair.zpp_pool?ne=new t.callbacks.ZPP_CbSetPair:(ne=t.callbacks.ZPP_CbSetPair.zpp_pool,t.callbacks.ZPP_CbSetPair.zpp_pool=ne.next,ne.next=null),ne.zip_listeners=!0,t.callbacks.ZPP_CbSet.setlt(ee,ie)?(ne.a=ee,ne.b=ie):(ne.a=ie,ne.b=ee),n.try_insert(ne)),te=te.next}}w=w.next}for(;null!=o.head;)for(var re=o.pop_unsafe(),oe=a.head;null!=oe;){for(var ae=oe.elt.cbsets,se=t.callbacks.ZPP_InteractionListener.UCbSet,le=t.callbacks.ZPP_InteractionListener.VCbSet,pe=t.callbacks.ZPP_InteractionListener.WCbSet,ue=re.cbsets.head,he=ae.head;null!=ue&&null!=he;){var ce=ue.elt,_e=he.elt;if(ce==_e){var de;null==t.util.ZNPNode_ZPP_CbSet.zpp_pool?de=new t.util.ZNPNode_ZPP_CbSet:(de=t.util.ZNPNode_ZPP_CbSet.zpp_pool,t.util.ZNPNode_ZPP_CbSet.zpp_pool=de.next,de.next=null),de.elt=ce;var me=de;me.next=pe.head,pe.head=me,pe.modified=!0,pe.length++,ue=ue.next,he=he.next}else if(t.callbacks.ZPP_CbSet.setlt(ce,_e)){var Pe;null==t.util.ZNPNode_ZPP_CbSet.zpp_pool?Pe=new t.util.ZNPNode_ZPP_CbSet:(Pe=t.util.ZNPNode_ZPP_CbSet.zpp_pool,t.util.ZNPNode_ZPP_CbSet.zpp_pool=Pe.next,Pe.next=null),Pe.elt=ce;var fe=Pe;fe.next=se.head,se.head=fe,se.modified=!0,se.length++,ue=ue.next}else{var xe;null==t.util.ZNPNode_ZPP_CbSet.zpp_pool?xe=new t.util.ZNPNode_ZPP_CbSet:(xe=t.util.ZNPNode_ZPP_CbSet.zpp_pool,t.util.ZNPNode_ZPP_CbSet.zpp_pool=xe.next,xe.next=null),xe.elt=_e;var ye=xe;ye.next=le.head,le.head=ye,le.modified=!0,le.length++,he=he.next}}for(;null!=ue;){var ve,ge=ue.elt;null==t.util.ZNPNode_ZPP_CbSet.zpp_pool?ve=new t.util.ZNPNode_ZPP_CbSet:(ve=t.util.ZNPNode_ZPP_CbSet.zpp_pool,t.util.ZNPNode_ZPP_CbSet.zpp_pool=ve.next,ve.next=null),ve.elt=ge;var be=ve;be.next=se.head,se.head=be,se.modified=!0,se.length++,ue=ue.next}for(;null!=he;){var ze,we=he.elt;null==t.util.ZNPNode_ZPP_CbSet.zpp_pool?ze=new t.util.ZNPNode_ZPP_CbSet:(ze=t.util.ZNPNode_ZPP_CbSet.zpp_pool,t.util.ZNPNode_ZPP_CbSet.zpp_pool=ze.next,ze.next=null),ze.elt=we;var Ze=ze;Ze.next=le.head,le.head=Ze,le.modified=!0,le.length++,he=he.next}for(;null!=se.head;)for(var Ee=se.pop_unsafe(),Me=ae.head;null!=Me;){var Se,Ce=Me.elt;Ee.validate(),Ce.validate(),t.callbacks.ZPP_CbSet.single_intersection(Ee,Ce,this)&&(null==t.callbacks.ZPP_CbSetPair.zpp_pool?Se=new t.callbacks.ZPP_CbSetPair:(Se=t.callbacks.ZPP_CbSetPair.zpp_pool,t.callbacks.ZPP_CbSetPair.zpp_pool=Se.next,Se.next=null),Se.zip_listeners=!0,t.callbacks.ZPP_CbSet.setlt(Ee,Ce)?(Se.a=Ee,Se.b=Ce):(Se.a=Ce,Se.b=Ee),n.try_insert(Se)),Me=Me.next}for(;null!=le.head;)for(var Ne=le.pop_unsafe(),Ae=pe.head;null!=Ae;){var Le,Be=Ae.elt;Ne.validate(),Be.validate(),t.callbacks.ZPP_CbSet.single_intersection(Ne,Be,this)&&(null==t.callbacks.ZPP_CbSetPair.zpp_pool?Le=new t.callbacks.ZPP_CbSetPair:(Le=t.callbacks.ZPP_CbSetPair.zpp_pool,t.callbacks.ZPP_CbSetPair.zpp_pool=Le.next,Le.next=null),Le.zip_listeners=!0,t.callbacks.ZPP_CbSet.setlt(Ne,Be)?(Le.a=Ne,Le.b=Be):(Le.a=Be,Le.b=Ne),n.try_insert(Le)),Ae=Ae.next}for(;null!=pe.head;){var Te,Ve=pe.pop_unsafe();Ve.validate(),Ve.validate(),t.callbacks.ZPP_CbSet.single_intersection(Ve,Ve,this)&&(null==t.callbacks.ZPP_CbSetPair.zpp_pool?Te=new t.callbacks.ZPP_CbSetPair:(Te=t.callbacks.ZPP_CbSetPair.zpp_pool,t.callbacks.ZPP_CbSetPair.zpp_pool=Te.next,Te.next=null),Te.zip_listeners=!0,t.callbacks.ZPP_CbSet.setlt(Ve,Ve),Te.a=Ve,Te.b=Ve,n.try_insert(Te));for(var ke=pe.head;null!=ke;){var Ie,Oe=ke.elt;Ve.validate(),Oe.validate(),t.callbacks.ZPP_CbSet.single_intersection(Ve,Oe,this)&&(null==t.callbacks.ZPP_CbSetPair.zpp_pool?Ie=new t.callbacks.ZPP_CbSetPair:(Ie=t.callbacks.ZPP_CbSetPair.zpp_pool,t.callbacks.ZPP_CbSetPair.zpp_pool=Ie.next,Ie.next=null),Ie.zip_listeners=!0,t.callbacks.ZPP_CbSet.setlt(Ve,Oe)?(Ie.a=Ve,Ie.b=Oe):(Ie.a=Oe,Ie.b=Ve),n.try_insert(Ie)),ke=ke.next}}oe=oe.next}for(;null!=a.head;){for(var Re=a.pop_unsafe(),He=Re.cbsets,Fe=t.callbacks.ZPP_InteractionListener.UCbSet,De=t.callbacks.ZPP_InteractionListener.VCbSet,Ge=t.callbacks.ZPP_InteractionListener.WCbSet,Ue=Re.cbsets.head,je=He.head;null!=Ue&&null!=je;){var We=Ue.elt,qe=je.elt;if(We==qe){var Je;null==t.util.ZNPNode_ZPP_CbSet.zpp_pool?Je=new t.util.ZNPNode_ZPP_CbSet:(Je=t.util.ZNPNode_ZPP_CbSet.zpp_pool,t.util.ZNPNode_ZPP_CbSet.zpp_pool=Je.next,Je.next=null),Je.elt=We;var $e=Je;$e.next=Ge.head,Ge.head=$e,Ge.modified=!0,Ge.length++,Ue=Ue.next,je=je.next}else if(t.callbacks.ZPP_CbSet.setlt(We,qe)){var Xe;null==t.util.ZNPNode_ZPP_CbSet.zpp_pool?Xe=new t.util.ZNPNode_ZPP_CbSet:(Xe=t.util.ZNPNode_ZPP_CbSet.zpp_pool,t.util.ZNPNode_ZPP_CbSet.zpp_pool=Xe.next,Xe.next=null),Xe.elt=We;var Ye=Xe;Ye.next=Fe.head,Fe.head=Ye,Fe.modified=!0,Fe.length++,Ue=Ue.next}else{var Ke;null==t.util.ZNPNode_ZPP_CbSet.zpp_pool?Ke=new t.util.ZNPNode_ZPP_CbSet:(Ke=t.util.ZNPNode_ZPP_CbSet.zpp_pool,t.util.ZNPNode_ZPP_CbSet.zpp_pool=Ke.next,Ke.next=null),Ke.elt=qe;var Qe=Ke;Qe.next=De.head,De.head=Qe,De.modified=!0,De.length++,je=je.next}}for(;null!=Ue;){var et,tt=Ue.elt;null==t.util.ZNPNode_ZPP_CbSet.zpp_pool?et=new t.util.ZNPNode_ZPP_CbSet:(et=t.util.ZNPNode_ZPP_CbSet.zpp_pool,t.util.ZNPNode_ZPP_CbSet.zpp_pool=et.next,et.next=null),et.elt=tt;var nt=et;nt.next=Fe.head,Fe.head=nt,Fe.modified=!0,Fe.length++,Ue=Ue.next}for(;null!=je;){var it,rt=je.elt;null==t.util.ZNPNode_ZPP_CbSet.zpp_pool?it=new t.util.ZNPNode_ZPP_CbSet:(it=t.util.ZNPNode_ZPP_CbSet.zpp_pool,t.util.ZNPNode_ZPP_CbSet.zpp_pool=it.next,it.next=null),it.elt=rt;var ot=it;ot.next=De.head,De.head=ot,De.modified=!0,De.length++,je=je.next}for(;null!=Fe.head;)for(var at=Fe.pop_unsafe(),st=He.head;null!=st;){var lt,pt=st.elt;at.validate(),pt.validate(),t.callbacks.ZPP_CbSet.single_intersection(at,pt,this)&&(null==t.callbacks.ZPP_CbSetPair.zpp_pool?lt=new t.callbacks.ZPP_CbSetPair:(lt=t.callbacks.ZPP_CbSetPair.zpp_pool,t.callbacks.ZPP_CbSetPair.zpp_pool=lt.next,lt.next=null),lt.zip_listeners=!0,t.callbacks.ZPP_CbSet.setlt(at,pt)?(lt.a=at,lt.b=pt):(lt.a=pt,lt.b=at),n.try_insert(lt)),st=st.next}for(;null!=De.head;)for(var ut=De.pop_unsafe(),ht=Ge.head;null!=ht;){var ct,_t=ht.elt;ut.validate(),_t.validate(),t.callbacks.ZPP_CbSet.single_intersection(ut,_t,this)&&(null==t.callbacks.ZPP_CbSetPair.zpp_pool?ct=new t.callbacks.ZPP_CbSetPair:(ct=t.callbacks.ZPP_CbSetPair.zpp_pool,t.callbacks.ZPP_CbSetPair.zpp_pool=ct.next,ct.next=null),ct.zip_listeners=!0,t.callbacks.ZPP_CbSet.setlt(ut,_t)?(ct.a=ut,ct.b=_t):(ct.a=_t,ct.b=ut),n.try_insert(ct)),ht=ht.next}for(;null!=Ge.head;){var dt,mt=Ge.pop_unsafe();mt.validate(),mt.validate(),t.callbacks.ZPP_CbSet.single_intersection(mt,mt,this)&&(null==t.callbacks.ZPP_CbSetPair.zpp_pool?dt=new t.callbacks.ZPP_CbSetPair:(dt=t.callbacks.ZPP_CbSetPair.zpp_pool,t.callbacks.ZPP_CbSetPair.zpp_pool=dt.next,dt.next=null),dt.zip_listeners=!0,t.callbacks.ZPP_CbSet.setlt(mt,mt),dt.a=mt,dt.b=mt,n.try_insert(dt));for(var Pt=Ge.head;null!=Pt;){var ft,xt=Pt.elt;mt.validate(),xt.validate(),t.callbacks.ZPP_CbSet.single_intersection(mt,xt,this)&&(null==t.callbacks.ZPP_CbSetPair.zpp_pool?ft=new t.callbacks.ZPP_CbSetPair:(ft=t.callbacks.ZPP_CbSetPair.zpp_pool,t.callbacks.ZPP_CbSetPair.zpp_pool=ft.next,ft.next=null),ft.zip_listeners=!0,t.callbacks.ZPP_CbSet.setlt(mt,xt)?(ft.a=mt,ft.b=xt):(ft.a=xt,ft.b=mt),n.try_insert(ft)),Pt=Pt.next}}for(var yt=a.head;null!=yt;){for(var vt=yt.elt.cbsets,gt=t.callbacks.ZPP_InteractionListener.UCbSet,bt=t.callbacks.ZPP_InteractionListener.VCbSet,zt=t.callbacks.ZPP_InteractionListener.WCbSet,wt=Re.cbsets.head,Zt=vt.head;null!=wt&&null!=Zt;){var Et=wt.elt,Mt=Zt.elt;if(Et==Mt){var St;null==t.util.ZNPNode_ZPP_CbSet.zpp_pool?St=new t.util.ZNPNode_ZPP_CbSet:(St=t.util.ZNPNode_ZPP_CbSet.zpp_pool,t.util.ZNPNode_ZPP_CbSet.zpp_pool=St.next,St.next=null),St.elt=Et;var Ct=St;Ct.next=zt.head,zt.head=Ct,zt.modified=!0,zt.length++,wt=wt.next,Zt=Zt.next}else if(t.callbacks.ZPP_CbSet.setlt(Et,Mt)){var Nt;null==t.util.ZNPNode_ZPP_CbSet.zpp_pool?Nt=new t.util.ZNPNode_ZPP_CbSet:(Nt=t.util.ZNPNode_ZPP_CbSet.zpp_pool,t.util.ZNPNode_ZPP_CbSet.zpp_pool=Nt.next,Nt.next=null),Nt.elt=Et;var At=Nt;At.next=gt.head,gt.head=At,gt.modified=!0,gt.length++,wt=wt.next}else{var Lt;null==t.util.ZNPNode_ZPP_CbSet.zpp_pool?Lt=new t.util.ZNPNode_ZPP_CbSet:(Lt=t.util.ZNPNode_ZPP_CbSet.zpp_pool,t.util.ZNPNode_ZPP_CbSet.zpp_pool=Lt.next,Lt.next=null),Lt.elt=Mt;var Bt=Lt;Bt.next=bt.head,bt.head=Bt,bt.modified=!0,bt.length++,Zt=Zt.next}}for(;null!=wt;){var Tt,Vt=wt.elt;null==t.util.ZNPNode_ZPP_CbSet.zpp_pool?Tt=new t.util.ZNPNode_ZPP_CbSet:(Tt=t.util.ZNPNode_ZPP_CbSet.zpp_pool,t.util.ZNPNode_ZPP_CbSet.zpp_pool=Tt.next,Tt.next=null),Tt.elt=Vt;var kt=Tt;kt.next=gt.head,gt.head=kt,gt.modified=!0,gt.length++,wt=wt.next}for(;null!=Zt;){var It,Ot=Zt.elt;null==t.util.ZNPNode_ZPP_CbSet.zpp_pool?It=new t.util.ZNPNode_ZPP_CbSet:(It=t.util.ZNPNode_ZPP_CbSet.zpp_pool,t.util.ZNPNode_ZPP_CbSet.zpp_pool=It.next,It.next=null),It.elt=Ot;var Rt=It;Rt.next=bt.head,bt.head=Rt,bt.modified=!0,bt.length++,Zt=Zt.next}for(;null!=gt.head;)for(var Ht=gt.pop_unsafe(),Ft=vt.head;null!=Ft;){var Dt,Gt=Ft.elt;Ht.validate(),Gt.validate(),t.callbacks.ZPP_CbSet.single_intersection(Ht,Gt,this)&&(null==t.callbacks.ZPP_CbSetPair.zpp_pool?Dt=new t.callbacks.ZPP_CbSetPair:(Dt=t.callbacks.ZPP_CbSetPair.zpp_pool,t.callbacks.ZPP_CbSetPair.zpp_pool=Dt.next,Dt.next=null),Dt.zip_listeners=!0,t.callbacks.ZPP_CbSet.setlt(Ht,Gt)?(Dt.a=Ht,Dt.b=Gt):(Dt.a=Gt,Dt.b=Ht),n.try_insert(Dt)),Ft=Ft.next}for(;null!=bt.head;)for(var Ut=bt.pop_unsafe(),jt=zt.head;null!=jt;){var Wt,qt=jt.elt;Ut.validate(),qt.validate(),t.callbacks.ZPP_CbSet.single_intersection(Ut,qt,this)&&(null==t.callbacks.ZPP_CbSetPair.zpp_pool?Wt=new t.callbacks.ZPP_CbSetPair:(Wt=t.callbacks.ZPP_CbSetPair.zpp_pool,t.callbacks.ZPP_CbSetPair.zpp_pool=Wt.next,Wt.next=null),Wt.zip_listeners=!0,t.callbacks.ZPP_CbSet.setlt(Ut,qt)?(Wt.a=Ut,Wt.b=qt):(Wt.a=qt,Wt.b=Ut),n.try_insert(Wt)),jt=jt.next}for(;null!=zt.head;){var Jt,$t=zt.pop_unsafe();$t.validate(),$t.validate(),t.callbacks.ZPP_CbSet.single_intersection($t,$t,this)&&(null==t.callbacks.ZPP_CbSetPair.zpp_pool?Jt=new t.callbacks.ZPP_CbSetPair:(Jt=t.callbacks.ZPP_CbSetPair.zpp_pool,t.callbacks.ZPP_CbSetPair.zpp_pool=Jt.next,Jt.next=null),Jt.zip_listeners=!0,t.callbacks.ZPP_CbSet.setlt($t,$t),Jt.a=$t,Jt.b=$t,n.try_insert(Jt));for(var Xt=zt.head;null!=Xt;){var Yt,Kt=Xt.elt;$t.validate(),Kt.validate(),t.callbacks.ZPP_CbSet.single_intersection($t,Kt,this)&&(null==t.callbacks.ZPP_CbSetPair.zpp_pool?Yt=new t.callbacks.ZPP_CbSetPair:(Yt=t.callbacks.ZPP_CbSetPair.zpp_pool,t.callbacks.ZPP_CbSetPair.zpp_pool=Yt.next,Yt.next=null),Yt.zip_listeners=!0,t.callbacks.ZPP_CbSet.setlt($t,Kt)?(Yt.a=$t,Yt.b=Kt):(Yt.a=Kt,Yt.b=$t),n.try_insert(Yt)),Xt=Xt.next}}yt=yt.next}}if(null!=n.parent){for(var Qt=n.parent;null!=Qt;)if(null!=Qt.prev)Qt=Qt.prev;else if(null!=Qt.next)Qt=Qt.next;else{var en=Qt.data;e?this.space.freshListenerType(en.a,en.b):this.space.nullListenerType(en.a,en.b);var tn=en;tn.a=tn.b=null,tn.listeners.clear(),tn.next=t.callbacks.ZPP_CbSetPair.zpp_pool,t.callbacks.ZPP_CbSetPair.zpp_pool=tn;var nn=Qt.parent;null!=nn&&(Qt==nn.prev?nn.prev=null:nn.next=null,Qt.parent=null);var rn=Qt;rn.data=null,rn.lt=null,rn.swapped=null,rn.next=t.util.ZPP_Set_ZPP_CbSetPair.zpp_pool,t.util.ZPP_Set_ZPP_CbSetPair.zpp_pool=rn,Qt=nn}n.parent=null}var on=n;on.data=null,on.lt=null,on.swapped=null,on.next=t.util.ZPP_Set_ZPP_CbSetPair.zpp_pool,t.util.ZPP_Set_ZPP_CbSetPair.zpp_pool=on},t.callbacks.ZPP_InteractionListener.prototype.with_union=function(e){for(var t=this.options1.includes.head,n=this.options2.includes.head;null!=t&&null!=n;){var i=t.elt,r=n.elt;i==r?(e(i),t=t.next,n=n.next):i.id<r.id?(e(i),t=t.next):(e(r),n=n.next)}for(;null!=t;)e(t.elt),t=t.next;for(;null!=n;)e(n.elt),n=n.next},t.callbacks.ZPP_InteractionListener.prototype.addedToSpace=function(){for(var e=3==this.type,n=this.options1.includes.head,i=this.options2.includes.head;null!=n&&null!=i;){var r=n.elt,o=i.elt;if(r==o){for(var a=null,s=r.listeners.head;null!=s;){var l=s.elt;if(this.precedence>l.precedence||this.precedence==l.precedence&&this.id>l.id)break;a=s,s=s.next}var u,h=r.listeners;null==t.util.ZNPNode_ZPP_InteractionListener.zpp_pool?u=new t.util.ZNPNode_ZPP_InteractionListener:(u=t.util.ZNPNode_ZPP_InteractionListener.zpp_pool,t.util.ZNPNode_ZPP_InteractionListener.zpp_pool=u.next,u.next=null),u.elt=this;var c=u;null==a?(c.next=h.head,h.head=c):(c.next=a.next,a.next=c),h.pushmod=h.modified=!0,h.length++;for(var _=r.cbsets.head;null!=_;){var d=_.elt;d.zip_listeners=!0,d.invalidate_pairs(),_=_.next}if(e)for(var m=r.interactors.head;null!=m;)m.elt.wake(),m=m.next;n=n.next,i=i.next}else if(r.id<o.id){for(var P=null,f=r.listeners.head;null!=f;){var x=f.elt;if(this.precedence>x.precedence||this.precedence==x.precedence&&this.id>x.id)break;P=f,f=f.next}var y,v=r.listeners;null==t.util.ZNPNode_ZPP_InteractionListener.zpp_pool?y=new t.util.ZNPNode_ZPP_InteractionListener:(y=t.util.ZNPNode_ZPP_InteractionListener.zpp_pool,t.util.ZNPNode_ZPP_InteractionListener.zpp_pool=y.next,y.next=null),y.elt=this;var g=y;null==P?(g.next=v.head,v.head=g):(g.next=P.next,P.next=g),v.pushmod=v.modified=!0,v.length++;for(var b=r.cbsets.head;null!=b;){var z=b.elt;z.zip_listeners=!0,z.invalidate_pairs(),b=b.next}if(e)for(var w=r.interactors.head;null!=w;)w.elt.wake(),w=w.next;n=n.next}else{for(var Z=null,E=o.listeners.head;null!=E;){var M=E.elt;if(this.precedence>M.precedence||this.precedence==M.precedence&&this.id>M.id)break;Z=E,E=E.next}var S,C=o.listeners;null==t.util.ZNPNode_ZPP_InteractionListener.zpp_pool?S=new t.util.ZNPNode_ZPP_InteractionListener:(S=t.util.ZNPNode_ZPP_InteractionListener.zpp_pool,t.util.ZNPNode_ZPP_InteractionListener.zpp_pool=S.next,S.next=null),S.elt=this;var N=S;null==Z?(N.next=C.head,C.head=N):(N.next=Z.next,Z.next=N),C.pushmod=C.modified=!0,C.length++;for(var A=o.cbsets.head;null!=A;){var L=A.elt;L.zip_listeners=!0,L.invalidate_pairs(),A=A.next}if(e)for(var B=o.interactors.head;null!=B;)B.elt.wake(),B=B.next;i=i.next}}for(;null!=n;){for(var T=n.elt,V=null,k=T.listeners.head;null!=k;){var I=k.elt;if(this.precedence>I.precedence||this.precedence==I.precedence&&this.id>I.id)break;V=k,k=k.next}var O,R=T.listeners;null==t.util.ZNPNode_ZPP_InteractionListener.zpp_pool?O=new t.util.ZNPNode_ZPP_InteractionListener:(O=t.util.ZNPNode_ZPP_InteractionListener.zpp_pool,t.util.ZNPNode_ZPP_InteractionListener.zpp_pool=O.next,O.next=null),O.elt=this;var H=O;null==V?(H.next=R.head,R.head=H):(H.next=V.next,V.next=H),R.pushmod=R.modified=!0,R.length++;for(var F=T.cbsets.head;null!=F;){var D=F.elt;D.zip_listeners=!0,D.invalidate_pairs(),F=F.next}if(e)for(var G=T.interactors.head;null!=G;)G.elt.wake(),G=G.next;n=n.next}for(;null!=i;){for(var U=i.elt,j=null,W=U.listeners.head;null!=W;){var q=W.elt;if(this.precedence>q.precedence||this.precedence==q.precedence&&this.id>q.id)break;j=W,W=W.next}var J,$=U.listeners;null==t.util.ZNPNode_ZPP_InteractionListener.zpp_pool?J=new t.util.ZNPNode_ZPP_InteractionListener:(J=t.util.ZNPNode_ZPP_InteractionListener.zpp_pool,t.util.ZNPNode_ZPP_InteractionListener.zpp_pool=J.next,J.next=null),J.elt=this;var X=J;null==j?(X.next=$.head,$.head=X):(X.next=j.next,j.next=X),$.pushmod=$.modified=!0,$.length++;for(var Y=U.cbsets.head;null!=Y;){var K=Y.elt;K.zip_listeners=!0,K.invalidate_pairs(),Y=Y.next}if(e)for(var Q=U.interactors.head;null!=Q;)Q.elt.wake(),Q=Q.next;i=i.next}this.options1.handler=p(this,this.cbtype_change1),this.options2.handler=p(this,this.cbtype_change2),this.with_uniquesets(!0)},t.callbacks.ZPP_InteractionListener.prototype.removedFromSpace=function(){this.with_uniquesets(!1);for(var e=3==this.type,t=this.options1.includes.head,n=this.options2.includes.head;null!=t&&null!=n;){var i=t.elt,r=n.elt;if(i==r){i.listeners.remove(this);for(var o=i.cbsets.head;null!=o;){var a=o.elt;a.zip_listeners=!0,a.invalidate_pairs(),o=o.next}if(e)for(var s=i.interactors.head;null!=s;)s.elt.wake(),s=s.next;t=t.next,n=n.next}else if(i.id<r.id){i.listeners.remove(this);for(var l=i.cbsets.head;null!=l;){var p=l.elt;p.zip_listeners=!0,p.invalidate_pairs(),l=l.next}if(e)for(var u=i.interactors.head;null!=u;)u.elt.wake(),u=u.next;t=t.next}else{r.listeners.remove(this);for(var h=r.cbsets.head;null!=h;){var c=h.elt;c.zip_listeners=!0,c.invalidate_pairs(),h=h.next}if(e)for(var _=r.interactors.head;null!=_;)_.elt.wake(),_=_.next;n=n.next}}for(;null!=t;){var d=t.elt;d.listeners.remove(this);for(var m=d.cbsets.head;null!=m;){var P=m.elt;P.zip_listeners=!0,P.invalidate_pairs(),m=m.next}if(e)for(var f=d.interactors.head;null!=f;)f.elt.wake(),f=f.next;t=t.next}for(;null!=n;){var x=n.elt;x.listeners.remove(this);for(var y=x.cbsets.head;null!=y;){var v=y.elt;v.zip_listeners=!0,v.invalidate_pairs(),y=y.next}if(e)for(var g=x.interactors.head;null!=g;)g.elt.wake(),g=g.next;n=n.next}this.options1.handler=null,this.options2.handler=null},t.callbacks.ZPP_InteractionListener.prototype.invalidate_precedence=function(){if(null!=this.space){for(var e=3==this.type,n=this.options1.includes.head,i=this.options2.includes.head;null!=n&&null!=i;){var r=n.elt,o=i.elt;if(r==o){r.listeners.remove(this);for(var a=r.cbsets.head;null!=a;){var s=a.elt;s.zip_listeners=!0,s.invalidate_pairs(),a=a.next}for(var l=null,p=r.listeners.head;null!=p;){var u=p.elt;if(this.precedence>u.precedence||this.precedence==u.precedence&&this.id>u.id)break;l=p,p=p.next}var h,c=r.listeners;null==t.util.ZNPNode_ZPP_InteractionListener.zpp_pool?h=new t.util.ZNPNode_ZPP_InteractionListener:(h=t.util.ZNPNode_ZPP_InteractionListener.zpp_pool,t.util.ZNPNode_ZPP_InteractionListener.zpp_pool=h.next,h.next=null),h.elt=this;var _=h;null==l?(_.next=c.head,c.head=_):(_.next=l.next,l.next=_),c.pushmod=c.modified=!0,c.length++;for(var d=r.cbsets.head;null!=d;){var m=d.elt;m.zip_listeners=!0,m.invalidate_pairs(),d=d.next}if(e)for(var P=r.interactors.head;null!=P;)P.elt.wake(),P=P.next;n=n.next,i=i.next}else if(r.id<o.id){r.listeners.remove(this);for(var f=r.cbsets.head;null!=f;){var x=f.elt;x.zip_listeners=!0,x.invalidate_pairs(),f=f.next}for(var y=null,v=r.listeners.head;null!=v;){var g=v.elt;if(this.precedence>g.precedence||this.precedence==g.precedence&&this.id>g.id)break;y=v,v=v.next}var b,z=r.listeners;null==t.util.ZNPNode_ZPP_InteractionListener.zpp_pool?b=new t.util.ZNPNode_ZPP_InteractionListener:(b=t.util.ZNPNode_ZPP_InteractionListener.zpp_pool,t.util.ZNPNode_ZPP_InteractionListener.zpp_pool=b.next,b.next=null),b.elt=this;var w=b;null==y?(w.next=z.head,z.head=w):(w.next=y.next,y.next=w),z.pushmod=z.modified=!0,z.length++;for(var Z=r.cbsets.head;null!=Z;){var E=Z.elt;E.zip_listeners=!0,E.invalidate_pairs(),Z=Z.next}if(e)for(var M=r.interactors.head;null!=M;)M.elt.wake(),M=M.next;n=n.next}else{o.listeners.remove(this);for(var S=o.cbsets.head;null!=S;){var C=S.elt;C.zip_listeners=!0,C.invalidate_pairs(),S=S.next}for(var N=null,A=o.listeners.head;null!=A;){var L=A.elt;if(this.precedence>L.precedence||this.precedence==L.precedence&&this.id>L.id)break;N=A,A=A.next}var B,T=o.listeners;null==t.util.ZNPNode_ZPP_InteractionListener.zpp_pool?B=new t.util.ZNPNode_ZPP_InteractionListener:(B=t.util.ZNPNode_ZPP_InteractionListener.zpp_pool,t.util.ZNPNode_ZPP_InteractionListener.zpp_pool=B.next,B.next=null),B.elt=this;var V=B;null==N?(V.next=T.head,T.head=V):(V.next=N.next,N.next=V),T.pushmod=T.modified=!0,T.length++;for(var k=o.cbsets.head;null!=k;){var I=k.elt;I.zip_listeners=!0,I.invalidate_pairs(),k=k.next}if(e)for(var O=o.interactors.head;null!=O;)O.elt.wake(),O=O.next;i=i.next}}for(;null!=n;){var R=n.elt;R.listeners.remove(this);for(var H=R.cbsets.head;null!=H;){var F=H.elt;F.zip_listeners=!0,F.invalidate_pairs(),H=H.next}for(var D=null,G=R.listeners.head;null!=G;){var U=G.elt;if(this.precedence>U.precedence||this.precedence==U.precedence&&this.id>U.id)break;D=G,G=G.next}var j,W=R.listeners;null==t.util.ZNPNode_ZPP_InteractionListener.zpp_pool?j=new t.util.ZNPNode_ZPP_InteractionListener:(j=t.util.ZNPNode_ZPP_InteractionListener.zpp_pool,t.util.ZNPNode_ZPP_InteractionListener.zpp_pool=j.next,j.next=null),j.elt=this;var q=j;null==D?(q.next=W.head,W.head=q):(q.next=D.next,D.next=q),W.pushmod=W.modified=!0,W.length++;for(var J=R.cbsets.head;null!=J;){var $=J.elt;$.zip_listeners=!0,$.invalidate_pairs(),J=J.next}if(e)for(var X=R.interactors.head;null!=X;)X.elt.wake(),X=X.next;n=n.next}for(;null!=i;){var Y=i.elt;Y.listeners.remove(this);for(var K=Y.cbsets.head;null!=K;){var Q=K.elt;Q.zip_listeners=!0,Q.invalidate_pairs(),K=K.next}for(var ee=null,te=Y.listeners.head;null!=te;){var ne=te.elt;if(this.precedence>ne.precedence||this.precedence==ne.precedence&&this.id>ne.id)break;ee=te,te=te.next}var ie,re=Y.listeners;null==t.util.ZNPNode_ZPP_InteractionListener.zpp_pool?ie=new t.util.ZNPNode_ZPP_InteractionListener:(ie=t.util.ZNPNode_ZPP_InteractionListener.zpp_pool,t.util.ZNPNode_ZPP_InteractionListener.zpp_pool=ie.next,ie.next=null),ie.elt=this;var oe=ie;null==ee?(oe.next=re.head,re.head=oe):(oe.next=ee.next,ee.next=oe),re.pushmod=re.modified=!0,re.length++;for(var ae=Y.cbsets.head;null!=ae;){var se=ae.elt;se.zip_listeners=!0,se.invalidate_pairs(),ae=ae.next}if(e)for(var le=Y.interactors.head;null!=le;)le.elt.wake(),le=le.next;i=i.next}}},t.callbacks.ZPP_InteractionListener.prototype.cbtype_change1=function(e,t,n){this.cbtype_change(this.options1,e,t,n)},t.callbacks.ZPP_InteractionListener.prototype.cbtype_change2=function(e,t,n){this.cbtype_change(this.options2,e,t,n)},t.callbacks.ZPP_InteractionListener.prototype.cbtype_change=function(e,n,i,r){if(this.removedFromSpace(),i)if(r){for(var o=null,a=e.includes.head;null!=a;){var s=a.elt;if(n.id<s.id)break;o=a,a=a.next}var l,p=e.includes;null==t.util.ZNPNode_ZPP_CbType.zpp_pool?l=new t.util.ZNPNode_ZPP_CbType:(l=t.util.ZNPNode_ZPP_CbType.zpp_pool,t.util.ZNPNode_ZPP_CbType.zpp_pool=l.next,l.next=null),l.elt=n;var u=l;null==o?(u.next=p.head,p.head=u):(u.next=o.next,o.next=u),p.pushmod=p.modified=!0,p.length++}else e.includes.remove(n);else if(r){for(var h=null,c=e.excludes.head;null!=c;){var _=c.elt;if(n.id<_.id)break;h=c,c=c.next}var d,m=e.excludes;null==t.util.ZNPNode_ZPP_CbType.zpp_pool?d=new t.util.ZNPNode_ZPP_CbType:(d=t.util.ZNPNode_ZPP_CbType.zpp_pool,t.util.ZNPNode_ZPP_CbType.zpp_pool=d.next,d.next=null),d.elt=n;var P=d;null==h?(P.next=m.head,m.head=P):(P.next=h.next,h.next=P),m.pushmod=m.modified=!0,m.length++}else e.excludes.remove(n);this.addedToSpace()},t.callbacks.ZPP_InteractionListener.prototype.swapEvent=function(e){if(3==this.type)throw new n._Boot.HaxeError("Error: PreListener event can only be PRE");if(0!=e&&1!=e&&6!=e)throw new n._Boot.HaxeError("Error: InteractionListener event must be either BEGIN, END, ONGOING");this.removedFromSpace(),this.event=e,this.addedToSpace()},t.callbacks.ZPP_InteractionListener.prototype.__class__=t.callbacks.ZPP_InteractionListener,t.callbacks.ZPP_OptionType=l["zpp_nape.callbacks.ZPP_OptionType"]=function(){this.wrap_excludes=null,this.wrap_includes=null,this.excludes=null,this.includes=null,this.handler=null,this.outer=null,this.includes=new t.util.ZNPList_ZPP_CbType,this.excludes=new t.util.ZNPList_ZPP_CbType},t.callbacks.ZPP_OptionType.__name__=["zpp_nape","callbacks","ZPP_OptionType"],t.callbacks.ZPP_OptionType.argument=function(t){return null==t?new e.callbacks.OptionType:t instanceof e.callbacks.OptionType?t:(new e.callbacks.OptionType).including(t)},t.callbacks.ZPP_OptionType.prototype.outer=null,t.callbacks.ZPP_OptionType.prototype.handler=null,t.callbacks.ZPP_OptionType.prototype.includes=null,t.callbacks.ZPP_OptionType.prototype.excludes=null,t.callbacks.ZPP_OptionType.prototype.wrap_includes=null,t.callbacks.ZPP_OptionType.prototype.wrap_excludes=null,t.callbacks.ZPP_OptionType.prototype.setup_includes=function(){this.wrap_includes=t.util.ZPP_CbTypeList.get(this.includes,!0)},t.callbacks.ZPP_OptionType.prototype.setup_excludes=function(){this.wrap_excludes=t.util.ZPP_CbTypeList.get(this.excludes,!0)},t.callbacks.ZPP_OptionType.prototype.excluded=function(e){return this.nonemptyintersection(e,this.excludes)},t.callbacks.ZPP_OptionType.prototype.included=function(e){return this.nonemptyintersection(e,this.includes)},t.callbacks.ZPP_OptionType.prototype.compatible=function(e){return!!this.nonemptyintersection(e,this.includes)&&!this.nonemptyintersection(e,this.excludes)},t.callbacks.ZPP_OptionType.prototype.nonemptyintersection=function(e,t){for(var n=!1,i=e.head,r=t.head;null!=r&&null!=i;){var o=r.elt,a=i.elt;if(o==a){n=!0;break}o.id<a.id?r=r.next:i=i.next}return n},t.callbacks.ZPP_OptionType.prototype.effect_change=function(e,n,i){if(n)if(i){for(var r=null,o=this.includes.head;null!=o;){var a=o.elt;if(e.id<a.id)break;r=o,o=o.next}var s,l=this.includes;null==t.util.ZNPNode_ZPP_CbType.zpp_pool?s=new t.util.ZNPNode_ZPP_CbType:(s=t.util.ZNPNode_ZPP_CbType.zpp_pool,t.util.ZNPNode_ZPP_CbType.zpp_pool=s.next,s.next=null),s.elt=e;var p=s;null==r?(p.next=l.head,l.head=p):(p.next=r.next,r.next=p),l.pushmod=l.modified=!0,l.length++}else this.includes.remove(e);else if(i){for(var u=null,h=this.excludes.head;null!=h;){var c=h.elt;if(e.id<c.id)break;u=h,h=h.next}var _,d=this.excludes;null==t.util.ZNPNode_ZPP_CbType.zpp_pool?_=new t.util.ZNPNode_ZPP_CbType:(_=t.util.ZNPNode_ZPP_CbType.zpp_pool,t.util.ZNPNode_ZPP_CbType.zpp_pool=_.next,_.next=null),_.elt=e;var m=_;null==u?(m.next=d.head,d.head=m):(m.next=u.next,u.next=m),d.pushmod=d.modified=!0,d.length++}else this.excludes.remove(e)},t.callbacks.ZPP_OptionType.prototype.append_type=function(e,n){if(e==this.includes){if(!this.includes.has(n))if(this.excludes.has(n))null!=this.handler?this.handler(n,!1,!1):this.excludes.remove(n);else if(null!=this.handler)this.handler(n,!0,!0);else{for(var i=null,r=this.includes.head;null!=r;){var o=r.elt;if(n.id<o.id)break;i=r,r=r.next}var a,s=this.includes;null==t.util.ZNPNode_ZPP_CbType.zpp_pool?a=new t.util.ZNPNode_ZPP_CbType:(a=t.util.ZNPNode_ZPP_CbType.zpp_pool,t.util.ZNPNode_ZPP_CbType.zpp_pool=a.next,a.next=null),a.elt=n;var l=a;null==i?(l.next=s.head,s.head=l):(l.next=i.next,i.next=l),s.pushmod=s.modified=!0,s.length++}}else if(!this.excludes.has(n))if(this.includes.has(n))null!=this.handler?this.handler(n,!0,!1):this.includes.remove(n);else if(null!=this.handler)this.handler(n,!1,!0);else{for(var p=null,u=this.excludes.head;null!=u;){var h=u.elt;if(n.id<h.id)break;p=u,u=u.next}var c,_=this.excludes;null==t.util.ZNPNode_ZPP_CbType.zpp_pool?c=new t.util.ZNPNode_ZPP_CbType:(c=t.util.ZNPNode_ZPP_CbType.zpp_pool,t.util.ZNPNode_ZPP_CbType.zpp_pool=c.next,c.next=null),c.elt=n;var d=c;null==p?(d.next=_.head,_.head=d):(d.next=p.next,p.next=d),_.pushmod=_.modified=!0,_.length++}},t.callbacks.ZPP_OptionType.prototype.set=function(e){if(e!=this){for(;null!=this.includes.head;)this.append_type(this.excludes,this.includes.head.elt);for(;null!=this.excludes.head;)this.append_type(this.includes,this.excludes.head.elt);for(var t=e.excludes.head;null!=t;){var n=t.elt;this.append_type(this.excludes,n),t=t.next}for(var i=e.includes.head;null!=i;){var r=i.elt;this.append_type(this.includes,r),i=i.next}}return this},t.callbacks.ZPP_OptionType.prototype.append=function(t,i){if(null==i)throw new n._Boot.HaxeError("Error: Cannot append null, only CbType and CbType list values");if(i instanceof e.callbacks.CbType){var r=i;this.append_type(t,r.zpp_inner)}else if(i instanceof e.callbacks.CbTypeList){var o=i;o.zpp_inner.valmod();for(var a=e.callbacks.CbTypeIterator.get(o);;){a.zpp_inner.zpp_inner.valmod();var s=a.zpp_inner;s.zpp_inner.valmod(),s.zpp_inner.zip_length&&(s.zpp_inner.zip_length=!1,s.zpp_inner.user_length=s.zpp_inner.inner.length);var l,p=s.zpp_inner.user_length;if(a.zpp_critical=!0,a.zpp_i<p?l=!0:(a.zpp_next=e.callbacks.CbTypeIterator.zpp_pool,e.callbacks.CbTypeIterator.zpp_pool=a,a.zpp_inner=null,l=!1),!l)break;a.zpp_critical=!1;var u=a.zpp_inner.at(a.zpp_i++);this.append_type(t,u.zpp_inner)}}else{if(!(i instanceof Array))throw new n._Boot.HaxeError("Error: Cannot append non-CbType or CbType list value");for(var h=i,c=0;c<h.length;){var _=h[c];if(++c,!(_ instanceof e.callbacks.CbType))throw new n._Boot.HaxeError("Error: Cannot append non-CbType or CbType list value");var d=_;this.append_type(t,d.zpp_inner)}}},t.callbacks.ZPP_OptionType.prototype.__class__=t.callbacks.ZPP_OptionType,t.constraint||(t.constraint={}),t.constraint.ZPP_Constraint=l["zpp_nape.constraint.ZPP_Constraint"]=function(){this.pre_dt=0,this.wrap_cbTypes=null,this.cbSet=null,this.cbTypes=null,this.__velocity=!1,this.ignore=!1,this.component=null,this.removeOnBreak=!1,this.breakUnderError=!1,this.breakUnderForce=!1,this.maxError=0,this.maxForce=0,this.damping=0,this.frequency=0,this.stiff=!1,this.active=!1,this.space=null,this.compound=null,this.userData=null,this.id=0,this.outer=null,this.__velocity=!1,this.id=t.ZPP_ID.Constraint(),this.stiff=!0,this.active=!0,this.ignore=!1,this.frequency=10,this.damping=1,this.maxForce=1/0,this.maxError=1/0,this.breakUnderForce=!1,this.removeOnBreak=!0,this.pre_dt=-1,this.cbTypes=new t.util.ZNPList_ZPP_CbType},t.constraint.ZPP_Constraint.__name__=["zpp_nape","constraint","ZPP_Constraint"],t.constraint.ZPP_Constraint.prototype.outer=null,t.constraint.ZPP_Constraint.prototype.clear=function(){},t.constraint.ZPP_Constraint.prototype.id=null,t.constraint.ZPP_Constraint.prototype.userData=null,t.constraint.ZPP_Constraint.prototype.compound=null,t.constraint.ZPP_Constraint.prototype.space=null,t.constraint.ZPP_Constraint.prototype.active=null,t.constraint.ZPP_Constraint.prototype.stiff=null,t.constraint.ZPP_Constraint.prototype.frequency=null,t.constraint.ZPP_Constraint.prototype.damping=null,t.constraint.ZPP_Constraint.prototype.maxForce=null,t.constraint.ZPP_Constraint.prototype.maxError=null,t.constraint.ZPP_Constraint.prototype.breakUnderForce=null,t.constraint.ZPP_Constraint.prototype.breakUnderError=null,t.constraint.ZPP_Constraint.prototype.removeOnBreak=null,t.constraint.ZPP_Constraint.prototype.component=null,t.constraint.ZPP_Constraint.prototype.ignore=null,t.constraint.ZPP_Constraint.prototype.__velocity=null,t.constraint.ZPP_Constraint.prototype.immutable_midstep=function(e){if(null!=this.space&&this.space.midstep)throw new n._Boot.HaxeError("Error: Constraint::"+e+" cannot be set during space step()")},t.constraint.ZPP_Constraint.prototype.cbTypes=null,t.constraint.ZPP_Constraint.prototype.cbSet=null,t.constraint.ZPP_Constraint.prototype.wrap_cbTypes=null,t.constraint.ZPP_Constraint.prototype.setupcbTypes=function(){this.wrap_cbTypes=t.util.ZPP_CbTypeList.get(this.cbTypes),this.wrap_cbTypes.zpp_inner.adder=p(this,this.wrap_cbTypes_adder),this.wrap_cbTypes.zpp_inner.subber=p(this,this.wrap_cbTypes_subber),this.wrap_cbTypes.zpp_inner.dontremove=!0,this.wrap_cbTypes.zpp_inner._modifiable=p(this,this.immutable_cbTypes)},t.constraint.ZPP_Constraint.prototype.immutable_cbTypes=function(){this.immutable_midstep("Constraint::cbTypes")},t.constraint.ZPP_Constraint.prototype.wrap_cbTypes_subber=function(e){var t=e.zpp_inner;this.cbTypes.has(t)&&(null!=this.space&&(this.dealloc_cbSet(),t.constraints.remove(this)),this.cbTypes.remove(t),null!=this.space&&(this.alloc_cbSet(),this.wake()))},t.constraint.ZPP_Constraint.prototype.wrap_cbTypes_adder=function(e){return this.insert_cbtype(e.zpp_inner),!1},t.constraint.ZPP_Constraint.prototype.insert_cbtype=function(e){if(!this.cbTypes.has(e)){null!=this.space&&(this.dealloc_cbSet(),e.constraints.add(this));for(var n=null,i=this.cbTypes.head;null!=i;){var r=i.elt;if(e.id<r.id)break;n=i,i=i.next}var o,a=this.cbTypes;null==t.util.ZNPNode_ZPP_CbType.zpp_pool?o=new t.util.ZNPNode_ZPP_CbType:(o=t.util.ZNPNode_ZPP_CbType.zpp_pool,t.util.ZNPNode_ZPP_CbType.zpp_pool=o.next,o.next=null),o.elt=e;var s=o;null==n?(s.next=a.head,a.head=s):(s.next=n.next,n.next=s),a.pushmod=a.modified=!0,a.length++,null!=this.space&&(this.alloc_cbSet(),this.wake())}},t.constraint.ZPP_Constraint.prototype.alloc_cbSet=function(){null!=(this.cbSet=this.space.cbsets.get(this.cbTypes))&&(this.cbSet.count++,this.cbSet.constraints.add(this))},t.constraint.ZPP_Constraint.prototype.dealloc_cbSet=function(){if(null!=this.cbSet){if(this.cbSet.constraints.remove(this),0==--this.cbSet.count){this.space.cbsets.remove(this.cbSet);var e=this.cbSet;for(e.listeners.clear(),e.zip_listeners=!0,e.bodylisteners.clear(),e.zip_bodylisteners=!0,e.conlisteners.clear(),e.zip_conlisteners=!0;null!=e.cbTypes.head;)e.cbTypes.pop_unsafe().cbsets.remove(e);e.next=t.callbacks.ZPP_CbSet.zpp_pool,t.callbacks.ZPP_CbSet.zpp_pool=e}this.cbSet=null}},t.constraint.ZPP_Constraint.prototype.activate=function(){null!=this.space&&this.activeInSpace()},t.constraint.ZPP_Constraint.prototype.deactivate=function(){null!=this.space&&this.inactiveOrOutSpace()},t.constraint.ZPP_Constraint.prototype.addedToSpace=function(){this.active&&this.activeInSpace(),this.activeBodies();for(var e=this.cbTypes.head;null!=e;)e.elt.constraints.add(this),e=e.next},t.constraint.ZPP_Constraint.prototype.removedFromSpace=function(){this.active&&this.inactiveOrOutSpace(),this.inactiveBodies();for(var e=this.cbTypes.head;null!=e;)e.elt.constraints.remove(this),e=e.next},t.constraint.ZPP_Constraint.prototype.activeInSpace=function(){this.alloc_cbSet(),null==t.space.ZPP_Component.zpp_pool?this.component=new t.space.ZPP_Component:(this.component=t.space.ZPP_Component.zpp_pool,t.space.ZPP_Component.zpp_pool=this.component.next,this.component.next=null),this.component.isBody=!1,this.component.constraint=this},t.constraint.ZPP_Constraint.prototype.inactiveOrOutSpace=function(){this.dealloc_cbSet();var e=this.component;e.body=null,e.constraint=null,e.next=t.space.ZPP_Component.zpp_pool,t.space.ZPP_Component.zpp_pool=e,this.component=null},t.constraint.ZPP_Constraint.prototype.activeBodies=function(){},t.constraint.ZPP_Constraint.prototype.inactiveBodies=function(){},t.constraint.ZPP_Constraint.prototype.clearcache=function(){},t.constraint.ZPP_Constraint.prototype.validate=function(){},t.constraint.ZPP_Constraint.prototype.wake_connected=function(){},t.constraint.ZPP_Constraint.prototype.forest=function(){},t.constraint.ZPP_Constraint.prototype.pair_exists=function(e,t){return!1},t.constraint.ZPP_Constraint.prototype.broken=function(){},t.constraint.ZPP_Constraint.prototype.warmStart=function(){},t.constraint.ZPP_Constraint.prototype.pre_dt=null,t.constraint.ZPP_Constraint.prototype.preStep=function(e){return!1},t.constraint.ZPP_Constraint.prototype.applyImpulseVel=function(){return!1},t.constraint.ZPP_Constraint.prototype.applyImpulsePos=function(){return!1},t.constraint.ZPP_Constraint.prototype.wake=function(){null!=this.space&&this.space.wake_constraint(this)},t.constraint.ZPP_Constraint.prototype.draw=function(e){},t.constraint.ZPP_Constraint.prototype.copy=function(e,t){return null},t.constraint.ZPP_Constraint.prototype.copyto=function(t){var i=this.outer;null==i.zpp_inner.wrap_cbTypes&&i.zpp_inner.setupcbTypes();var r=i.zpp_inner.wrap_cbTypes;r.zpp_inner.valmod();for(var o=e.callbacks.CbTypeIterator.get(r);;){o.zpp_inner.zpp_inner.valmod();var a=o.zpp_inner;a.zpp_inner.valmod(),a.zpp_inner.zip_length&&(a.zpp_inner.zip_length=!1,a.zpp_inner.user_length=a.zpp_inner.inner.length);var s,l=a.zpp_inner.user_length;if(o.zpp_critical=!0,o.zpp_i<l?s=!0:(o.zpp_next=e.callbacks.CbTypeIterator.zpp_pool,e.callbacks.CbTypeIterator.zpp_pool=o,o.zpp_inner=null,s=!1),!s)break;o.zpp_critical=!1;var p=o.zpp_inner.at(o.zpp_i++);null==t.zpp_inner.wrap_cbTypes&&t.zpp_inner.setupcbTypes();var u=t.zpp_inner.wrap_cbTypes;u.zpp_inner.reverse_flag?u.push(p):u.unshift(p)}t.zpp_inner.removeOnBreak=i.zpp_inner.removeOnBreak;var h=i.zpp_inner.breakUnderError;t.zpp_inner.breakUnderError!=h&&(t.zpp_inner.breakUnderError=h,t.zpp_inner.wake());var c=i.zpp_inner.breakUnderForce;t.zpp_inner.breakUnderForce!=c&&(t.zpp_inner.breakUnderForce=c,t.zpp_inner.wake());var _=i.zpp_inner.maxError;if(_!=_)throw new n._Boot.HaxeError("Error: Constraint::maxError cannot be NaN");if(_<0)throw new n._Boot.HaxeError("Error: Constraint::maxError must be >=0");t.zpp_inner.maxError!=_&&(t.zpp_inner.maxError=_,t.zpp_inner.wake());var d=i.zpp_inner.maxForce;if(d!=d)throw new n._Boot.HaxeError("Error: Constraint::maxForce cannot be NaN");if(d<0)throw new n._Boot.HaxeError("Error: Constraint::maxForce must be >=0");t.zpp_inner.maxForce!=d&&(t.zpp_inner.maxForce=d,t.zpp_inner.wake());var m=i.zpp_inner.damping;if(m!=m)throw new n._Boot.HaxeError("Error: Constraint::Damping cannot be Nan");if(m<0)throw new n._Boot.HaxeError("Error: Constraint::Damping must be >=0");t.zpp_inner.damping!=m&&(t.zpp_inner.damping=m,t.zpp_inner.stiff||t.zpp_inner.wake());var P=i.zpp_inner.frequency;if(P!=P)throw new n._Boot.HaxeError("Error: Constraint::Frequency cannot be NaN");if(P<=0)throw new n._Boot.HaxeError("Error: Constraint::Frequency must be >0");t.zpp_inner.frequency!=P&&(t.zpp_inner.frequency=P,t.zpp_inner.stiff||t.zpp_inner.wake());var f=i.zpp_inner.stiff;t.zpp_inner.stiff!=f&&(t.zpp_inner.stiff=f,t.zpp_inner.wake());var x=i.zpp_inner.ignore;t.zpp_inner.ignore!=x&&(t.zpp_inner.ignore=x,t.zpp_inner.wake());var y=i.zpp_inner.active;t.zpp_inner.active!=y&&(null!=t.zpp_inner.component&&(t.zpp_inner.component.woken=!1),t.zpp_inner.clearcache(),y?(t.zpp_inner.active=y,t.zpp_inner.activate(),null!=t.zpp_inner.space&&(null!=t.zpp_inner.component&&(t.zpp_inner.component.sleeping=!0),t.zpp_inner.space.wake_constraint(t.zpp_inner,!0))):(null!=t.zpp_inner.space&&(t.zpp_inner.wake(),t.zpp_inner.space.live_constraints.remove(t.zpp_inner)),t.zpp_inner.active=y,t.zpp_inner.deactivate()))},t.constraint.ZPP_Constraint.prototype.__class__=t.constraint.ZPP_Constraint,t.constraint.ZPP_AngleJoint=l["zpp_nape.constraint.ZPP_AngleJoint"]=function(){this.stepped=!1,this.bias=0,this.gamma=0,this.jMax=0,this.jAcc=0,this.kMass=0,this.b2=null,this.b1=null,this.scale=0,this.equal=!1,this.slack=!1,this.jointMax=0,this.jointMin=0,this.ratio=0,this.outer_zn=null,t.constraint.ZPP_Constraint.call(this),this.ratio=1,this.jAcc=0,this.slack=!1,this.jMax=1/0,this.stepped=!1},t.constraint.ZPP_AngleJoint.__name__=["zpp_nape","constraint","ZPP_AngleJoint"],t.constraint.ZPP_AngleJoint.__super__=t.constraint.ZPP_Constraint,t.constraint.ZPP_Constraint.prototype)t.constraint.ZPP_AngleJoint.prototype[u]=t.constraint.ZPP_Constraint.prototype[u];for(var u in t.constraint.ZPP_AngleJoint.prototype.outer_zn=null,t.constraint.ZPP_AngleJoint.prototype.ratio=null,t.constraint.ZPP_AngleJoint.prototype.jointMin=null,t.constraint.ZPP_AngleJoint.prototype.jointMax=null,t.constraint.ZPP_AngleJoint.prototype.slack=null,t.constraint.ZPP_AngleJoint.prototype.equal=null,t.constraint.ZPP_AngleJoint.prototype.scale=null,t.constraint.ZPP_AngleJoint.prototype.is_slack=function(){var e,t=this.ratio*this.b2.rot-this.b1.rot;return this.equal?(t-=this.jointMax,e=!1,this.scale=1):t<this.jointMin?(t=this.jointMin-t,this.scale=-1,e=!1):t>this.jointMax?(t-=this.jointMax,this.scale=1,e=!1):(this.scale=0,t=0,e=!0),e},t.constraint.ZPP_AngleJoint.prototype.bodyImpulse=function(t){return this.stepped?t==this.b1?e.geom.Vec3.get(0,0,-this.scale*this.jAcc):e.geom.Vec3.get(0,0,this.ratio*this.scale*this.jAcc):e.geom.Vec3.get(0,0,0)},t.constraint.ZPP_AngleJoint.prototype.activeBodies=function(){null!=this.b1&&this.b1.constraints.add(this),this.b2!=this.b1&&null!=this.b2&&this.b2.constraints.add(this)},t.constraint.ZPP_AngleJoint.prototype.inactiveBodies=function(){null!=this.b1&&this.b1.constraints.remove(this),this.b2!=this.b1&&null!=this.b2&&this.b2.constraints.remove(this)},t.constraint.ZPP_AngleJoint.prototype.b1=null,t.constraint.ZPP_AngleJoint.prototype.b2=null,t.constraint.ZPP_AngleJoint.prototype.kMass=null,t.constraint.ZPP_AngleJoint.prototype.jAcc=null,t.constraint.ZPP_AngleJoint.prototype.jMax=null,t.constraint.ZPP_AngleJoint.prototype.gamma=null,t.constraint.ZPP_AngleJoint.prototype.bias=null,t.constraint.ZPP_AngleJoint.prototype.stepped=null,t.constraint.ZPP_AngleJoint.prototype.copy=function(n,i){var r=new e.constraint.AngleJoint(null,null,this.jointMin,this.jointMax,this.ratio);if(this.copyto(r),null!=n&&null!=this.b1){for(var o=null,a=0;a<n.length;){var s=n[a];if(++a,s.id==this.b1.id){o=s.bc;break}}null!=o?r.zpp_inner_zn.b1=o.zpp_inner:i.push(t.constraint.ZPP_CopyHelper.todo(this.b1.id,(function(e){r.zpp_inner_zn.b1=e.zpp_inner})))}if(null!=n&&null!=this.b2){for(var l=null,p=0;p<n.length;){var u=n[p];if(++p,u.id==this.b2.id){l=u.bc;break}}null!=l?r.zpp_inner_zn.b2=l.zpp_inner:i.push(t.constraint.ZPP_CopyHelper.todo(this.b2.id,(function(e){r.zpp_inner_zn.b2=e.zpp_inner})))}return r},t.constraint.ZPP_AngleJoint.prototype.validate=function(){if(null==this.b1||null==this.b2)throw new n._Boot.HaxeError("Error: AngleJoint cannot be simulated null bodies");if(this.b1==this.b2)throw new n._Boot.HaxeError("Error: AngleJoint cannot be simulated with body1 == body2");if(this.b1.space!=this.space||this.b2.space!=this.space)throw new n._Boot.HaxeError("Error: Constraints must have each body within the same space to which the constraint has been assigned");if(this.jointMin>this.jointMax)throw new n._Boot.HaxeError("Error: AngleJoint must have jointMin <= jointMax");if(2!=this.b1.type&&2!=this.b2.type)throw new n._Boot.HaxeError("Error: Constraints cannot have both bodies non-dynamic")},t.constraint.ZPP_AngleJoint.prototype.wake_connected=function(){null!=this.b1&&2==this.b1.type&&this.b1.wake(),null!=this.b2&&2==this.b2.type&&this.b2.wake()},t.constraint.ZPP_AngleJoint.prototype.forest=function(){if(2==this.b1.type){var e,t;if(this.b1.component==this.b1.component.parent)e=this.b1.component;else{for(var n=this.b1.component,i=null;n!=n.parent;){var r=n.parent;n.parent=i,i=n,n=r}for(;null!=i;){var o=i.parent;i.parent=n,i=o}e=n}if(this.component==this.component.parent)t=this.component;else{for(var a=this.component,s=null;a!=a.parent;){var l=a.parent;a.parent=s,s=a,a=l}for(;null!=s;){var p=s.parent;s.parent=a,s=p}t=a}e!=t&&(e.rank<t.rank?e.parent=t:e.rank>t.rank?t.parent=e:(t.parent=e,e.rank++))}if(2==this.b2.type){var u,h;if(this.b2.component==this.b2.component.parent)u=this.b2.component;else{for(var c=this.b2.component,_=null;c!=c.parent;){var d=c.parent;c.parent=_,_=c,c=d}for(;null!=_;){var m=_.parent;_.parent=c,_=m}u=c}if(this.component==this.component.parent)h=this.component;else{for(var P=this.component,f=null;P!=P.parent;){var x=P.parent;P.parent=f,f=P,P=x}for(;null!=f;){var y=f.parent;f.parent=P,f=y}h=P}u!=h&&(u.rank<h.rank?u.parent=h:u.rank>h.rank?h.parent=u:(h.parent=u,u.rank++))}},t.constraint.ZPP_AngleJoint.prototype.pair_exists=function(e,t){return this.b1.id==e&&this.b2.id==t||this.b1.id==t&&this.b2.id==e},t.constraint.ZPP_AngleJoint.prototype.clearcache=function(){this.jAcc=0,this.pre_dt=-1,this.slack=!1},t.constraint.ZPP_AngleJoint.prototype.preStep=function(e){-1==this.pre_dt&&(this.pre_dt=e);var t=e/this.pre_dt;this.pre_dt=e,this.stepped=!0,this.equal=this.jointMin==this.jointMax;var n=this.ratio*this.b2.rot-this.b1.rot;this.equal?(n-=this.jointMax,this.slack=!1,this.scale=1):n<this.jointMin?(n=this.jointMin-n,this.scale=-1,this.slack=!1):n>this.jointMax?(n-=this.jointMax,this.scale=1,this.slack=!1):(this.scale=0,n=0,this.slack=!0);var i=n;if(!this.slack){if(this.kMass=this.b1.sinertia+this.ratio*this.ratio*this.b2.sinertia,0!=this.kMass?this.kMass=1/this.kMass:this.jAcc=0,this.stiff)this.bias=0,this.gamma=0;else{if(this.breakUnderError&&i*i>this.maxError*this.maxError)return!0;var r=2*Math.PI*this.frequency;this.gamma=1/(e*r*(2*this.damping+r*e));var o=1/(1+this.gamma),a=e*r*r*this.gamma;this.gamma*=o,this.kMass*=o,this.bias=-i*a,this.bias<-this.maxError?this.bias=-this.maxError:this.bias>this.maxError&&(this.bias=this.maxError)}this.jAcc*=t,this.jMax=this.maxForce*e}return!1},t.constraint.ZPP_AngleJoint.prototype.warmStart=function(){this.slack||(this.b1.angvel-=this.scale*this.b1.iinertia*this.jAcc,this.b2.angvel+=this.ratio*this.scale*this.b2.iinertia*this.jAcc)},t.constraint.ZPP_AngleJoint.prototype.applyImpulseVel=function(){if(this.slack)return!1;var e=this.scale*(this.ratio*(this.b2.angvel+this.b2.kinangvel)-this.b1.angvel-this.b1.kinangvel),t=this.kMass*(this.bias-e)-this.jAcc*this.gamma,n=this.jAcc;return this.jAcc+=t,!this.equal&&this.jAcc>0&&(this.jAcc=0),!(!this.breakUnderForce||!(this.jAcc>this.jMax||this.jAcc<-this.jMax))||(this.stiff||(this.jAcc>this.jMax?this.jAcc=this.jMax:this.jAcc<-this.jMax&&(this.jAcc=-this.jMax)),t=this.jAcc-n,this.b1.angvel-=this.scale*this.b1.iinertia*t,this.b2.angvel+=this.ratio*this.scale*this.b2.iinertia*t,!1)},t.constraint.ZPP_AngleJoint.prototype.applyImpulsePos=function(){var e,t,n=this.ratio*this.b2.rot-this.b1.rot;this.equal?(n-=this.jointMax,t=!1,this.scale=1):n<this.jointMin?(n=this.jointMin-n,this.scale=-1,t=!1):n>this.jointMax?(n-=this.jointMax,this.scale=1,t=!1):(this.scale=0,n=0,t=!0);var i=n;if(!t){if(this.breakUnderError&&i*i>this.maxError*this.maxError)return!0;if(e=-(i*=.5)*this.kMass,this.equal||e<0){var r=this.b1,o=-this.scale*e*this.b1.iinertia;if(r.rot+=o,o*o>1e-4)r.axisx=Math.sin(r.rot),r.axisy=Math.cos(r.rot);else{var a=o*o,s=1-.5*a,l=1-a*a/8,p=(s*r.axisx+o*r.axisy)*l;r.axisy=(s*r.axisy-o*r.axisx)*l,r.axisx=p}var u=this.b2,h=this.ratio*this.scale*e*this.b2.iinertia;if(u.rot+=h,h*h>1e-4)u.axisx=Math.sin(u.rot),u.axisy=Math.cos(u.rot);else{var c=h*h,_=1-.5*c,d=1-c*c/8,m=(_*u.axisx+h*u.axisy)*d;u.axisy=(_*u.axisy-h*u.axisx)*d,u.axisx=m}}}return!1},t.constraint.ZPP_AngleJoint.prototype.draw=function(e){},t.constraint.ZPP_AngleJoint.prototype.__class__=t.constraint.ZPP_AngleJoint,t.constraint.ZPP_CopyHelper=l["zpp_nape.constraint.ZPP_CopyHelper"]=function(){this.cb=null,this.bc=null,this.id=0},t.constraint.ZPP_CopyHelper.__name__=["zpp_nape","constraint","ZPP_CopyHelper"],t.constraint.ZPP_CopyHelper.dict=function(e,n){var i=new t.constraint.ZPP_CopyHelper;return i.id=e,i.bc=n,i},t.constraint.ZPP_CopyHelper.todo=function(e,n){var i=new t.constraint.ZPP_CopyHelper;return i.id=e,i.cb=n,i},t.constraint.ZPP_CopyHelper.prototype.id=null,t.constraint.ZPP_CopyHelper.prototype.bc=null,t.constraint.ZPP_CopyHelper.prototype.cb=null,t.constraint.ZPP_CopyHelper.prototype.__class__=t.constraint.ZPP_CopyHelper,t.constraint.ZPP_DistanceJoint=l["zpp_nape.constraint.ZPP_DistanceJoint"]=function(){this.stepped=!1,this.bias=0,this.gamma=0,this.jMax=0,this.jAcc=0,this.kMass=0,this.wrap_a2=null,this.a2rely=0,this.a2relx=0,this.a2localy=0,this.a2localx=0,this.b2=null,this.wrap_a1=null,this.a1rely=0,this.a1relx=0,this.a1localy=0,this.a1localx=0,this.b1=null,this.cx2=0,this.cx1=0,this.ny=0,this.nx=0,this.equal=!1,this.slack=!1,this.jointMax=0,this.jointMin=0,this.outer_zn=null,t.constraint.ZPP_Constraint.call(this),this.a1localx=0,this.a1localy=0,this.a1relx=0,this.a1rely=0,this.a2localx=0,this.a2localy=0,this.a2relx=0,this.a2rely=0,this.jAcc=0,this.jMax=1/0,this.stepped=!1,this.cx1=this.cx2=0},t.constraint.ZPP_DistanceJoint.__name__=["zpp_nape","constraint","ZPP_DistanceJoint"],t.constraint.ZPP_DistanceJoint.__super__=t.constraint.ZPP_Constraint,t.constraint.ZPP_Constraint.prototype)t.constraint.ZPP_DistanceJoint.prototype[u]=t.constraint.ZPP_Constraint.prototype[u];for(var u in t.constraint.ZPP_DistanceJoint.prototype.outer_zn=null,t.constraint.ZPP_DistanceJoint.prototype.jointMin=null,t.constraint.ZPP_DistanceJoint.prototype.jointMax=null,t.constraint.ZPP_DistanceJoint.prototype.slack=null,t.constraint.ZPP_DistanceJoint.prototype.equal=null,t.constraint.ZPP_DistanceJoint.prototype.is_slack=function(){var t;this.a1relx=this.b1.axisy*this.a1localx-this.b1.axisx*this.a1localy,this.a1rely=this.a1localx*this.b1.axisx+this.a1localy*this.b1.axisy,this.a2relx=this.b2.axisy*this.a2localx-this.b2.axisx*this.a2localy,this.a2rely=this.a2localx*this.b2.axisx+this.a2localy*this.b2.axisy;var n=0,i=0,r=(n=this.b2.posx+this.a2relx-(this.b1.posx+this.a1relx))*n+(i=this.b2.posy+this.a2rely-(this.b1.posy+this.a1rely))*i;if(r<e.Config.epsilon)n=0,i=0,r=0,t=!0;else{var o=1/(r=Math.sqrt(r));n*=o,i*=o,this.equal?(r-=this.jointMax,t=!1):r<this.jointMin?(r=this.jointMin-r,n=-n,i=-i,t=!1):r>this.jointMax?(r-=this.jointMax,t=!1):(n=0,i=0,r=0,t=!0)}return t},t.constraint.ZPP_DistanceJoint.prototype.nx=null,t.constraint.ZPP_DistanceJoint.prototype.ny=null,t.constraint.ZPP_DistanceJoint.prototype.cx1=null,t.constraint.ZPP_DistanceJoint.prototype.cx2=null,t.constraint.ZPP_DistanceJoint.prototype.bodyImpulse=function(t){return this.stepped?t==this.b1?e.geom.Vec3.get(-this.jAcc*this.nx,-this.jAcc*this.ny,-this.cx1*this.jAcc):e.geom.Vec3.get(this.jAcc*this.nx,this.jAcc*this.ny,this.cx2*this.jAcc):e.geom.Vec3.get(0,0,0)},t.constraint.ZPP_DistanceJoint.prototype.activeBodies=function(){null!=this.b1&&this.b1.constraints.add(this),this.b2!=this.b1&&null!=this.b2&&this.b2.constraints.add(this)},t.constraint.ZPP_DistanceJoint.prototype.inactiveBodies=function(){null!=this.b1&&this.b1.constraints.remove(this),this.b2!=this.b1&&null!=this.b2&&this.b2.constraints.remove(this)},t.constraint.ZPP_DistanceJoint.prototype.b1=null,t.constraint.ZPP_DistanceJoint.prototype.a1localx=null,t.constraint.ZPP_DistanceJoint.prototype.a1localy=null,t.constraint.ZPP_DistanceJoint.prototype.a1relx=null,t.constraint.ZPP_DistanceJoint.prototype.a1rely=null,t.constraint.ZPP_DistanceJoint.prototype.validate_a1=function(){this.wrap_a1.zpp_inner.x=this.a1localx,this.wrap_a1.zpp_inner.y=this.a1localy},t.constraint.ZPP_DistanceJoint.prototype.invalidate_a1=function(e){this.immutable_midstep("Constraint::a1"),this.a1localx=e.x,this.a1localy=e.y,this.wake()},t.constraint.ZPP_DistanceJoint.prototype.setup_a1=function(){var i,r=this.a1localx,o=this.a1localy;if(null==o&&(o=0),null==r&&(r=0),r!=r||o!=o)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null==t.util.ZPP_PubPool.poolVec2?i=new e.geom.Vec2:(i=t.util.ZPP_PubPool.poolVec2,t.util.ZPP_PubPool.poolVec2=i.zpp_pool,i.zpp_pool=null,i.zpp_disp=!1,i==t.util.ZPP_PubPool.nextVec2&&(t.util.ZPP_PubPool.nextVec2=null)),null==i.zpp_inner){var a;null==t.geom.ZPP_Vec2.zpp_pool?a=new t.geom.ZPP_Vec2:(a=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=a.next,a.next=null),a.weak=!1,a._immutable=!1,a.x=r,a.y=o,i.zpp_inner=a,i.zpp_inner.outer=i}else{if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var s,l=i.zpp_inner;if(l._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=l._isimmutable&&l._isimmutable(),r!=r||o!=o)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var u=i.zpp_inner;if(null!=u._validate&&u._validate(),i.zpp_inner.x==r){if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var h=i.zpp_inner;null!=h._validate&&h._validate(),s=i.zpp_inner.y==o}else s=!1;if(!s){i.zpp_inner.x=r,i.zpp_inner.y=o;var c=i.zpp_inner;null!=c._invalidate&&c._invalidate(c)}}i.zpp_inner.weak=!1,this.wrap_a1=i,this.wrap_a1.zpp_inner._inuse=!0,this.wrap_a1.zpp_inner._validate=p(this,this.validate_a1),this.wrap_a1.zpp_inner._invalidate=p(this,this.invalidate_a1)},t.constraint.ZPP_DistanceJoint.prototype.wrap_a1=null,t.constraint.ZPP_DistanceJoint.prototype.b2=null,t.constraint.ZPP_DistanceJoint.prototype.a2localx=null,t.constraint.ZPP_DistanceJoint.prototype.a2localy=null,t.constraint.ZPP_DistanceJoint.prototype.a2relx=null,t.constraint.ZPP_DistanceJoint.prototype.a2rely=null,t.constraint.ZPP_DistanceJoint.prototype.validate_a2=function(){this.wrap_a2.zpp_inner.x=this.a2localx,this.wrap_a2.zpp_inner.y=this.a2localy},t.constraint.ZPP_DistanceJoint.prototype.invalidate_a2=function(e){this.immutable_midstep("Constraint::a2"),this.a2localx=e.x,this.a2localy=e.y,this.wake()},t.constraint.ZPP_DistanceJoint.prototype.setup_a2=function(){var i,r=this.a2localx,o=this.a2localy;if(null==o&&(o=0),null==r&&(r=0),r!=r||o!=o)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null==t.util.ZPP_PubPool.poolVec2?i=new e.geom.Vec2:(i=t.util.ZPP_PubPool.poolVec2,t.util.ZPP_PubPool.poolVec2=i.zpp_pool,i.zpp_pool=null,i.zpp_disp=!1,i==t.util.ZPP_PubPool.nextVec2&&(t.util.ZPP_PubPool.nextVec2=null)),null==i.zpp_inner){var a;null==t.geom.ZPP_Vec2.zpp_pool?a=new t.geom.ZPP_Vec2:(a=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=a.next,a.next=null),a.weak=!1,a._immutable=!1,a.x=r,a.y=o,i.zpp_inner=a,i.zpp_inner.outer=i}else{if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var s,l=i.zpp_inner;if(l._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=l._isimmutable&&l._isimmutable(),r!=r||o!=o)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var u=i.zpp_inner;if(null!=u._validate&&u._validate(),i.zpp_inner.x==r){if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var h=i.zpp_inner;null!=h._validate&&h._validate(),s=i.zpp_inner.y==o}else s=!1;if(!s){i.zpp_inner.x=r,i.zpp_inner.y=o;var c=i.zpp_inner;null!=c._invalidate&&c._invalidate(c)}}i.zpp_inner.weak=!1,this.wrap_a2=i,this.wrap_a2.zpp_inner._inuse=!0,this.wrap_a2.zpp_inner._validate=p(this,this.validate_a2),this.wrap_a2.zpp_inner._invalidate=p(this,this.invalidate_a2)},t.constraint.ZPP_DistanceJoint.prototype.wrap_a2=null,t.constraint.ZPP_DistanceJoint.prototype.kMass=null,t.constraint.ZPP_DistanceJoint.prototype.jAcc=null,t.constraint.ZPP_DistanceJoint.prototype.jMax=null,t.constraint.ZPP_DistanceJoint.prototype.gamma=null,t.constraint.ZPP_DistanceJoint.prototype.bias=null,t.constraint.ZPP_DistanceJoint.prototype.stepped=null,t.constraint.ZPP_DistanceJoint.prototype.copy=function(n,i){var r=this.outer_zn;null==r.zpp_inner_zn.wrap_a1&&r.zpp_inner_zn.setup_a1();var o=r.zpp_inner_zn.wrap_a1,a=this.outer_zn;null==a.zpp_inner_zn.wrap_a2&&a.zpp_inner_zn.setup_a2();var s=new e.constraint.DistanceJoint(null,null,o,a.zpp_inner_zn.wrap_a2,this.jointMin,this.jointMax);if(this.copyto(s),null!=n&&null!=this.b1){for(var l=null,p=0;p<n.length;){var u=n[p];if(++p,u.id==this.b1.id){l=u.bc;break}}null!=l?s.zpp_inner_zn.b1=l.zpp_inner:i.push(t.constraint.ZPP_CopyHelper.todo(this.b1.id,(function(e){s.zpp_inner_zn.b1=e.zpp_inner})))}if(null!=n&&null!=this.b2){for(var h=null,c=0;c<n.length;){var _=n[c];if(++c,_.id==this.b2.id){h=_.bc;break}}null!=h?s.zpp_inner_zn.b2=h.zpp_inner:i.push(t.constraint.ZPP_CopyHelper.todo(this.b2.id,(function(e){s.zpp_inner_zn.b2=e.zpp_inner})))}return s},t.constraint.ZPP_DistanceJoint.prototype.validate=function(){if(null==this.b1||null==this.b2)throw new n._Boot.HaxeError("Error: DistanceJoint cannot be simulated null bodies");if(this.b1==this.b2)throw new n._Boot.HaxeError("Error: DistanceJoint cannot be simulated with body1 == body2");if(this.b1.space!=this.space||this.b2.space!=this.space)throw new n._Boot.HaxeError("Error: Constraints must have each body within the same space to which the constraint has been assigned");if(this.jointMin>this.jointMax)throw new n._Boot.HaxeError("Error: DistanceJoint must have jointMin <= jointMax");if(2!=this.b1.type&&2!=this.b2.type)throw new n._Boot.HaxeError("Error: Constraints cannot have both bodies non-dynamic")},t.constraint.ZPP_DistanceJoint.prototype.wake_connected=function(){null!=this.b1&&2==this.b1.type&&this.b1.wake(),null!=this.b2&&2==this.b2.type&&this.b2.wake()},t.constraint.ZPP_DistanceJoint.prototype.forest=function(){if(2==this.b1.type){var e,t;if(this.b1.component==this.b1.component.parent)e=this.b1.component;else{for(var n=this.b1.component,i=null;n!=n.parent;){var r=n.parent;n.parent=i,i=n,n=r}for(;null!=i;){var o=i.parent;i.parent=n,i=o}e=n}if(this.component==this.component.parent)t=this.component;else{for(var a=this.component,s=null;a!=a.parent;){var l=a.parent;a.parent=s,s=a,a=l}for(;null!=s;){var p=s.parent;s.parent=a,s=p}t=a}e!=t&&(e.rank<t.rank?e.parent=t:e.rank>t.rank?t.parent=e:(t.parent=e,e.rank++))}if(2==this.b2.type){var u,h;if(this.b2.component==this.b2.component.parent)u=this.b2.component;else{for(var c=this.b2.component,_=null;c!=c.parent;){var d=c.parent;c.parent=_,_=c,c=d}for(;null!=_;){var m=_.parent;_.parent=c,_=m}u=c}if(this.component==this.component.parent)h=this.component;else{for(var P=this.component,f=null;P!=P.parent;){var x=P.parent;P.parent=f,f=P,P=x}for(;null!=f;){var y=f.parent;f.parent=P,f=y}h=P}u!=h&&(u.rank<h.rank?u.parent=h:u.rank>h.rank?h.parent=u:(h.parent=u,u.rank++))}},t.constraint.ZPP_DistanceJoint.prototype.pair_exists=function(e,t){return this.b1.id==e&&this.b2.id==t||this.b1.id==t&&this.b2.id==e},t.constraint.ZPP_DistanceJoint.prototype.clearcache=function(){this.jAcc=0,this.pre_dt=-1},t.constraint.ZPP_DistanceJoint.prototype.preStep=function(t){-1==this.pre_dt&&(this.pre_dt=t);var n=t/this.pre_dt;this.pre_dt=t,this.stepped=!0,this.equal=this.jointMin==this.jointMax,this.a1relx=this.b1.axisy*this.a1localx-this.b1.axisx*this.a1localy,this.a1rely=this.a1localx*this.b1.axisx+this.a1localy*this.b1.axisy,this.a2relx=this.b2.axisy*this.a2localx-this.b2.axisx*this.a2localy,this.a2rely=this.a2localx*this.b2.axisx+this.a2localy*this.b2.axisy,this.nx=this.b2.posx+this.a2relx-(this.b1.posx+this.a1relx),this.ny=this.b2.posy+this.a2rely-(this.b1.posy+this.a1rely);var i=this.nx*this.nx+this.ny*this.ny;if(i<e.Config.epsilon)this.nx=0,this.ny=0,i=0,this.slack=!0;else{var r=1/(i=Math.sqrt(i));this.nx*=r,this.ny*=r,this.equal?(i-=this.jointMax,this.slack=!1):i<this.jointMin?(i=this.jointMin-i,this.nx=-this.nx,this.ny=-this.ny,this.slack=!1):i>this.jointMax?(i-=this.jointMax,this.slack=!1):(this.nx=0,this.ny=0,i=0,this.slack=!0)}var o=i;if(!this.slack){if(this.cx1=this.ny*this.a1relx-this.nx*this.a1rely,this.cx2=this.ny*this.a2relx-this.nx*this.a2rely,this.kMass=this.b1.smass+this.b2.smass+this.cx1*this.cx1*this.b1.sinertia+this.cx2*this.cx2*this.b2.sinertia,0!=this.kMass?this.kMass=1/this.kMass:this.jAcc=0,this.stiff)this.bias=0,this.gamma=0;else{if(this.breakUnderError&&o*o>this.maxError*this.maxError)return!0;var a=2*Math.PI*this.frequency;this.gamma=1/(t*a*(2*this.damping+a*t));var s=1/(1+this.gamma),l=t*a*a*this.gamma;this.gamma*=s,this.kMass*=s,this.bias=-o*l,this.bias<-this.maxError?this.bias=-this.maxError:this.bias>this.maxError&&(this.bias=this.maxError)}this.jAcc*=n,this.jMax=this.maxForce*t}return!1},t.constraint.ZPP_DistanceJoint.prototype.warmStart=function(){if(!this.slack){var e=this.b1.imass*this.jAcc;this.b1.velx-=this.nx*e,this.b1.vely-=this.ny*e;var t=this.b2.imass*this.jAcc;this.b2.velx+=this.nx*t,this.b2.vely+=this.ny*t,this.b1.angvel-=this.cx1*this.b1.iinertia*this.jAcc,this.b2.angvel+=this.cx2*this.b2.iinertia*this.jAcc}},t.constraint.ZPP_DistanceJoint.prototype.applyImpulseVel=function(){if(this.slack)return!1;var e=this.nx*(this.b2.velx+this.b2.kinvelx-this.b1.velx-this.b1.kinvelx)+this.ny*(this.b2.vely+this.b2.kinvely-this.b1.vely-this.b1.kinvely)+(this.b2.angvel+this.b2.kinangvel)*this.cx2-(this.b1.angvel+this.b1.kinangvel)*this.cx1,t=this.kMass*(this.bias-e)-this.jAcc*this.gamma,n=this.jAcc;if(this.jAcc+=t,!this.equal&&this.jAcc>0&&(this.jAcc=0),this.breakUnderForce&&this.jAcc<-this.jMax)return!0;this.stiff||this.jAcc<-this.jMax&&(this.jAcc=-this.jMax),t=this.jAcc-n;var i=this.b1.imass*t;this.b1.velx-=this.nx*i,this.b1.vely-=this.ny*i;var r=this.b2.imass*t;return this.b2.velx+=this.nx*r,this.b2.vely+=this.ny*r,this.b1.angvel-=this.cx1*this.b1.iinertia*t,this.b2.angvel+=this.cx2*this.b2.iinertia*t,!1},t.constraint.ZPP_DistanceJoint.prototype.applyImpulsePos=function(){var t,n,i,r,o,a;n=this.b1.axisy*this.a1localx-this.b1.axisx*this.a1localy,i=this.a1localx*this.b1.axisx+this.a1localy*this.b1.axisy,r=this.b2.axisy*this.a2localx-this.b2.axisx*this.a2localy,o=this.a2localx*this.b2.axisx+this.a2localy*this.b2.axisy;var s=0,l=0,p=(s=this.b2.posx+r-(this.b1.posx+n))*s+(l=this.b2.posy+o-(this.b1.posy+i))*l;if(p<e.Config.epsilon)s=0,l=0,p=0,a=!0;else{var u=1/(p=Math.sqrt(p));s*=u,l*=u,this.equal?(p-=this.jointMax,a=!1):p<this.jointMin?(p=this.jointMin-p,s=-s,l=-l,a=!1):p>this.jointMax?(p-=this.jointMax,a=!1):(s=0,l=0,p=0,a=!0)}var h=p;if(!a){if(this.breakUnderError&&h*h>this.maxError*this.maxError)return!0;if(h*h<e.Config.constraintLinearSlop*e.Config.constraintLinearSlop)return!1;if((h*=.5)*h>6){var c=this.b1.smass+this.b2.smass;if(c>e.Config.epsilon&&(t=-h*(c=.75/c),this.equal||t<0)){var _=t*this.b1.imass;this.b1.posx-=s*_,this.b1.posy-=l*_;var d=t*this.b2.imass;this.b2.posx+=s*d,this.b2.posy+=l*d;var m=(s=this.b2.posx+r-(this.b1.posx+n))*s+(l=this.b2.posy+o-(this.b1.posy+i))*l;if(m<e.Config.epsilon)s=0,l=0,m=0,a=!0;else{var P=1/(m=Math.sqrt(m));s*=P,l*=P,this.equal?(m-=this.jointMax,a=!1):m<this.jointMin?(m=this.jointMin-m,s=-s,l=-l,a=!1):m>this.jointMax?(m-=this.jointMax,a=!1):(s=0,l=0,m=0,a=!0)}h=m,h*=.5}}var f=l*n-s*i,x=l*r-s*o,y=this.b1.smass+this.b2.smass+f*f*this.b1.sinertia+x*x*this.b2.sinertia;if(0!=y&&(y=1/y),t=-h*y,this.equal||t<0){var v=this.b1.imass*t;this.b1.posx-=s*v,this.b1.posy-=l*v;var g=this.b2.imass*t;this.b2.posx+=s*g,this.b2.posy+=l*g;var b=this.b1,z=-f*this.b1.iinertia*t;if(b.rot+=z,z*z>1e-4)b.axisx=Math.sin(b.rot),b.axisy=Math.cos(b.rot);else{var w=z*z,Z=1-.5*w,E=1-w*w/8,M=(Z*b.axisx+z*b.axisy)*E;b.axisy=(Z*b.axisy-z*b.axisx)*E,b.axisx=M}var S=this.b2,C=x*this.b2.iinertia*t;if(S.rot+=C,C*C>1e-4)S.axisx=Math.sin(S.rot),S.axisy=Math.cos(S.rot);else{var N=C*C,A=1-.5*N,L=1-N*N/8,B=(A*S.axisx+C*S.axisy)*L;S.axisy=(A*S.axisy-C*S.axisx)*L,S.axisx=B}}}return!1},t.constraint.ZPP_DistanceJoint.prototype.draw=function(e){},t.constraint.ZPP_DistanceJoint.prototype.__class__=t.constraint.ZPP_DistanceJoint,t.constraint.ZPP_LineJoint=l["zpp_nape.constraint.ZPP_LineJoint"]=function(){this.biasy=0,this.biasx=0,this.jAccy=0,this.jAccx=0,this.kMassc=0,this.kMassb=0,this.kMassa=0,this.wrap_n=null,this.nrely=0,this.nrelx=0,this.nlocaly=0,this.nlocalx=0,this.wrap_a2=null,this.a2rely=0,this.a2relx=0,this.a2localy=0,this.a2localx=0,this.wrap_a1=null,this.a1rely=0,this.a1relx=0,this.a1localy=0,this.a1localx=0,this.cx2=0,this.cx1=0,this.dot2=0,this.dot1=0,this.equal=!1,this.jointMax=0,this.jointMin=0,this.scale=0,this.outer_zn=null,t.constraint.ZPP_Constraint.call(this),this.a1localx=0,this.a1localy=0,this.a1relx=0,this.a1rely=0,this.a2localx=0,this.a2localy=0,this.a2relx=0,this.a2rely=0,this.nlocalx=0,this.nlocaly=0,this.nrelx=0,this.nrely=0,this.jAccx=0,this.jAccy=0,this.jMax=1/0,this.jointMin=-1/0,this.jointMax=1/0,this.stepped=!1},t.constraint.ZPP_LineJoint.__name__=["zpp_nape","constraint","ZPP_LineJoint"],t.constraint.ZPP_LineJoint.__super__=t.constraint.ZPP_Constraint,t.constraint.ZPP_Constraint.prototype)t.constraint.ZPP_LineJoint.prototype[u]=t.constraint.ZPP_Constraint.prototype[u];for(var u in t.constraint.ZPP_LineJoint.prototype.outer_zn=null,t.constraint.ZPP_LineJoint.prototype.scale=null,t.constraint.ZPP_LineJoint.prototype.jointMin=null,t.constraint.ZPP_LineJoint.prototype.jointMax=null,t.constraint.ZPP_LineJoint.prototype.equal=null,t.constraint.ZPP_LineJoint.prototype.dot1=null,t.constraint.ZPP_LineJoint.prototype.dot2=null,t.constraint.ZPP_LineJoint.prototype.cx1=null,t.constraint.ZPP_LineJoint.prototype.cx2=null,t.constraint.ZPP_LineJoint.prototype.bodyImpulse=function(t){if(this.stepped){var n=this.scale*this.nrelx*this.jAccy-this.nrely*this.jAccx,i=this.nrelx*this.jAccx+this.scale*this.nrely*this.jAccy;return t==this.b1?e.geom.Vec3.get(-n,-i,this.scale*this.cx1*i-this.dot1*n):e.geom.Vec3.get(n,i,this.scale*this.cx1*i-this.dot1*n)}return e.geom.Vec3.get(0,0,0)},t.constraint.ZPP_LineJoint.prototype.activeBodies=function(){null!=this.b1&&this.b1.constraints.add(this),this.b2!=this.b1&&null!=this.b2&&this.b2.constraints.add(this)},t.constraint.ZPP_LineJoint.prototype.inactiveBodies=function(){null!=this.b1&&this.b1.constraints.remove(this),this.b2!=this.b1&&null!=this.b2&&this.b2.constraints.remove(this)},t.constraint.ZPP_LineJoint.prototype.b1=null,t.constraint.ZPP_LineJoint.prototype.a1localx=null,t.constraint.ZPP_LineJoint.prototype.a1localy=null,t.constraint.ZPP_LineJoint.prototype.a1relx=null,t.constraint.ZPP_LineJoint.prototype.a1rely=null,t.constraint.ZPP_LineJoint.prototype.validate_a1=function(){this.wrap_a1.zpp_inner.x=this.a1localx,this.wrap_a1.zpp_inner.y=this.a1localy},t.constraint.ZPP_LineJoint.prototype.invalidate_a1=function(e){this.immutable_midstep("Constraint::a1"),this.a1localx=e.x,this.a1localy=e.y,this.wake()},t.constraint.ZPP_LineJoint.prototype.setup_a1=function(){var i,r=this.a1localx,o=this.a1localy;if(null==o&&(o=0),null==r&&(r=0),r!=r||o!=o)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null==t.util.ZPP_PubPool.poolVec2?i=new e.geom.Vec2:(i=t.util.ZPP_PubPool.poolVec2,t.util.ZPP_PubPool.poolVec2=i.zpp_pool,i.zpp_pool=null,i.zpp_disp=!1,i==t.util.ZPP_PubPool.nextVec2&&(t.util.ZPP_PubPool.nextVec2=null)),null==i.zpp_inner){var a;null==t.geom.ZPP_Vec2.zpp_pool?a=new t.geom.ZPP_Vec2:(a=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=a.next,a.next=null),a.weak=!1,a._immutable=!1,a.x=r,a.y=o,i.zpp_inner=a,i.zpp_inner.outer=i}else{if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var s,l=i.zpp_inner;if(l._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=l._isimmutable&&l._isimmutable(),r!=r||o!=o)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var u=i.zpp_inner;if(null!=u._validate&&u._validate(),i.zpp_inner.x==r){if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var h=i.zpp_inner;null!=h._validate&&h._validate(),s=i.zpp_inner.y==o}else s=!1;if(!s){i.zpp_inner.x=r,i.zpp_inner.y=o;var c=i.zpp_inner;null!=c._invalidate&&c._invalidate(c)}}i.zpp_inner.weak=!1,this.wrap_a1=i,this.wrap_a1.zpp_inner._inuse=!0,this.wrap_a1.zpp_inner._validate=p(this,this.validate_a1),this.wrap_a1.zpp_inner._invalidate=p(this,this.invalidate_a1)},t.constraint.ZPP_LineJoint.prototype.wrap_a1=null,t.constraint.ZPP_LineJoint.prototype.b2=null,t.constraint.ZPP_LineJoint.prototype.a2localx=null,t.constraint.ZPP_LineJoint.prototype.a2localy=null,t.constraint.ZPP_LineJoint.prototype.a2relx=null,t.constraint.ZPP_LineJoint.prototype.a2rely=null,t.constraint.ZPP_LineJoint.prototype.validate_a2=function(){this.wrap_a2.zpp_inner.x=this.a2localx,this.wrap_a2.zpp_inner.y=this.a2localy},t.constraint.ZPP_LineJoint.prototype.invalidate_a2=function(e){this.immutable_midstep("Constraint::a2"),this.a2localx=e.x,this.a2localy=e.y,this.wake()},t.constraint.ZPP_LineJoint.prototype.setup_a2=function(){var i,r=this.a2localx,o=this.a2localy;if(null==o&&(o=0),null==r&&(r=0),r!=r||o!=o)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null==t.util.ZPP_PubPool.poolVec2?i=new e.geom.Vec2:(i=t.util.ZPP_PubPool.poolVec2,t.util.ZPP_PubPool.poolVec2=i.zpp_pool,i.zpp_pool=null,i.zpp_disp=!1,i==t.util.ZPP_PubPool.nextVec2&&(t.util.ZPP_PubPool.nextVec2=null)),null==i.zpp_inner){var a;null==t.geom.ZPP_Vec2.zpp_pool?a=new t.geom.ZPP_Vec2:(a=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=a.next,a.next=null),a.weak=!1,a._immutable=!1,a.x=r,a.y=o,i.zpp_inner=a,i.zpp_inner.outer=i}else{if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var s,l=i.zpp_inner;if(l._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=l._isimmutable&&l._isimmutable(),r!=r||o!=o)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var u=i.zpp_inner;if(null!=u._validate&&u._validate(),i.zpp_inner.x==r){if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var h=i.zpp_inner;null!=h._validate&&h._validate(),s=i.zpp_inner.y==o}else s=!1;if(!s){i.zpp_inner.x=r,i.zpp_inner.y=o;var c=i.zpp_inner;null!=c._invalidate&&c._invalidate(c)}}i.zpp_inner.weak=!1,this.wrap_a2=i,this.wrap_a2.zpp_inner._inuse=!0,this.wrap_a2.zpp_inner._validate=p(this,this.validate_a2),this.wrap_a2.zpp_inner._invalidate=p(this,this.invalidate_a2)},t.constraint.ZPP_LineJoint.prototype.wrap_a2=null,t.constraint.ZPP_LineJoint.prototype.zip_n=null,t.constraint.ZPP_LineJoint.prototype.nlocalx=null,t.constraint.ZPP_LineJoint.prototype.nlocaly=null,t.constraint.ZPP_LineJoint.prototype.nrelx=null,t.constraint.ZPP_LineJoint.prototype.nrely=null,t.constraint.ZPP_LineJoint.prototype.validate_n=function(){this.wrap_n.zpp_inner.x=this.nlocalx,this.wrap_n.zpp_inner.y=this.nlocaly},t.constraint.ZPP_LineJoint.prototype.invalidate_n=function(e){this.immutable_midstep("Constraint::n"),this.nlocalx=e.x,this.nlocaly=e.y,this.zip_n=!0,this.wake()},t.constraint.ZPP_LineJoint.prototype.setup_n=function(){var i,r=this.nlocalx,o=this.nlocaly;if(null==o&&(o=0),null==r&&(r=0),r!=r||o!=o)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null==t.util.ZPP_PubPool.poolVec2?i=new e.geom.Vec2:(i=t.util.ZPP_PubPool.poolVec2,t.util.ZPP_PubPool.poolVec2=i.zpp_pool,i.zpp_pool=null,i.zpp_disp=!1,i==t.util.ZPP_PubPool.nextVec2&&(t.util.ZPP_PubPool.nextVec2=null)),null==i.zpp_inner){var a;null==t.geom.ZPP_Vec2.zpp_pool?a=new t.geom.ZPP_Vec2:(a=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=a.next,a.next=null),a.weak=!1,a._immutable=!1,a.x=r,a.y=o,i.zpp_inner=a,i.zpp_inner.outer=i}else{if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var s,l=i.zpp_inner;if(l._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=l._isimmutable&&l._isimmutable(),r!=r||o!=o)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var u=i.zpp_inner;if(null!=u._validate&&u._validate(),i.zpp_inner.x==r){if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var h=i.zpp_inner;null!=h._validate&&h._validate(),s=i.zpp_inner.y==o}else s=!1;if(!s){i.zpp_inner.x=r,i.zpp_inner.y=o;var c=i.zpp_inner;null!=c._invalidate&&c._invalidate(c)}}i.zpp_inner.weak=!1,this.wrap_n=i,this.wrap_n.zpp_inner._inuse=!0,this.wrap_n.zpp_inner._validate=p(this,this.validate_n),this.wrap_n.zpp_inner._invalidate=p(this,this.invalidate_n)},t.constraint.ZPP_LineJoint.prototype.wrap_n=null,t.constraint.ZPP_LineJoint.prototype.validate_norm=function(){if(this.zip_n){this.zip_n=!1;var e=this.nlocalx*this.nlocalx+this.nlocaly*this.nlocaly,t=1/Math.sqrt(e);this.nlocalx*=t,this.nlocaly*=t}},t.constraint.ZPP_LineJoint.prototype.kMassa=null,t.constraint.ZPP_LineJoint.prototype.kMassb=null,t.constraint.ZPP_LineJoint.prototype.kMassc=null,t.constraint.ZPP_LineJoint.prototype.jAccx=null,t.constraint.ZPP_LineJoint.prototype.jAccy=null,t.constraint.ZPP_LineJoint.prototype.jMax=null,t.constraint.ZPP_LineJoint.prototype.gamma=null,t.constraint.ZPP_LineJoint.prototype.biasx=null,t.constraint.ZPP_LineJoint.prototype.biasy=null,t.constraint.ZPP_LineJoint.prototype.stepped=null,t.constraint.ZPP_LineJoint.prototype.copy=function(n,i){var r=this.outer_zn;null==r.zpp_inner_zn.wrap_a1&&r.zpp_inner_zn.setup_a1();var o=r.zpp_inner_zn.wrap_a1,a=this.outer_zn;null==a.zpp_inner_zn.wrap_a2&&a.zpp_inner_zn.setup_a2();var s=a.zpp_inner_zn.wrap_a2,l=this.outer_zn;null==l.zpp_inner_zn.wrap_n&&l.zpp_inner_zn.setup_n();var p=new e.constraint.LineJoint(null,null,o,s,l.zpp_inner_zn.wrap_n,this.jointMin,this.jointMax);if(this.copyto(p),null!=n&&null!=this.b1){for(var u=null,h=0;h<n.length;){var c=n[h];if(++h,c.id==this.b1.id){u=c.bc;break}}null!=u?p.zpp_inner_zn.b1=u.zpp_inner:i.push(t.constraint.ZPP_CopyHelper.todo(this.b1.id,(function(e){p.zpp_inner_zn.b1=e.zpp_inner})))}if(null!=n&&null!=this.b2){for(var _=null,d=0;d<n.length;){var m=n[d];if(++d,m.id==this.b2.id){_=m.bc;break}}null!=_?p.zpp_inner_zn.b2=_.zpp_inner:i.push(t.constraint.ZPP_CopyHelper.todo(this.b2.id,(function(e){p.zpp_inner_zn.b2=e.zpp_inner})))}return p},t.constraint.ZPP_LineJoint.prototype.validate=function(){if(null==this.b1||null==this.b2)throw new n._Boot.HaxeError("Error: AngleJoint cannot be simulated null bodies");if(this.b1==this.b2)throw new n._Boot.HaxeError("Error: DistanceJoint cannot be simulated with body1 == body2");if(this.b1.space!=this.space||this.b2.space!=this.space)throw new n._Boot.HaxeError("Error: Constraints must have each body within the same space to which the constraint has been assigned");if(this.jointMin>this.jointMax)throw new n._Boot.HaxeError("Error: DistanceJoint must have jointMin <= jointMax");if(this.nlocalx*this.nlocalx+this.nlocaly*this.nlocaly<e.Config.epsilon)throw new n._Boot.HaxeError("Error: DistanceJoint direction must be non-degenerate");if(2!=this.b1.type&&2!=this.b2.type)throw new n._Boot.HaxeError("Error: Constraints cannot have both bodies non-dynamic")},t.constraint.ZPP_LineJoint.prototype.wake_connected=function(){null!=this.b1&&2==this.b1.type&&this.b1.wake(),null!=this.b2&&2==this.b2.type&&this.b2.wake()},t.constraint.ZPP_LineJoint.prototype.forest=function(){if(2==this.b1.type){var e,t;if(this.b1.component==this.b1.component.parent)e=this.b1.component;else{for(var n=this.b1.component,i=null;n!=n.parent;){var r=n.parent;n.parent=i,i=n,n=r}for(;null!=i;){var o=i.parent;i.parent=n,i=o}e=n}if(this.component==this.component.parent)t=this.component;else{for(var a=this.component,s=null;a!=a.parent;){var l=a.parent;a.parent=s,s=a,a=l}for(;null!=s;){var p=s.parent;s.parent=a,s=p}t=a}e!=t&&(e.rank<t.rank?e.parent=t:e.rank>t.rank?t.parent=e:(t.parent=e,e.rank++))}if(2==this.b2.type){var u,h;if(this.b2.component==this.b2.component.parent)u=this.b2.component;else{for(var c=this.b2.component,_=null;c!=c.parent;){var d=c.parent;c.parent=_,_=c,c=d}for(;null!=_;){var m=_.parent;_.parent=c,_=m}u=c}if(this.component==this.component.parent)h=this.component;else{for(var P=this.component,f=null;P!=P.parent;){var x=P.parent;P.parent=f,f=P,P=x}for(;null!=f;){var y=f.parent;f.parent=P,f=y}h=P}u!=h&&(u.rank<h.rank?u.parent=h:u.rank>h.rank?h.parent=u:(h.parent=u,u.rank++))}},t.constraint.ZPP_LineJoint.prototype.pair_exists=function(e,t){return this.b1.id==e&&this.b2.id==t||this.b1.id==t&&this.b2.id==e},t.constraint.ZPP_LineJoint.prototype.clearcache=function(){this.jAccx=0,this.jAccy=0,this.pre_dt=-1},t.constraint.ZPP_LineJoint.prototype.preStep=function(e){-1==this.pre_dt&&(this.pre_dt=e);var t=e/this.pre_dt;this.pre_dt=e,this.equal=this.jointMin==this.jointMax,this.stepped=!0,this.validate_norm(),this.a1relx=this.b1.axisy*this.a1localx-this.b1.axisx*this.a1localy,this.a1rely=this.a1localx*this.b1.axisx+this.a1localy*this.b1.axisy,this.nrelx=this.b1.axisy*this.nlocalx-this.b1.axisx*this.nlocaly,this.nrely=this.nlocalx*this.b1.axisx+this.nlocaly*this.b1.axisy,this.a2relx=this.b2.axisy*this.a2localx-this.b2.axisx*this.a2localy,this.a2rely=this.a2localx*this.b2.axisx+this.a2localy*this.b2.axisy;var n,i,r,o,a,s=0;n=this.b2.posx+this.a2relx-this.b1.posx-this.a1relx,r=(i=this.b2.posy+this.a2rely-this.b1.posy-this.a1rely)*this.nrelx-n*this.nrely,s=this.nrelx*n+this.nrely*i,this.equal?(s-=this.jointMin,this.scale=1):s>this.jointMax?(s-=this.jointMax,this.scale=1):s<this.jointMin?(s=this.jointMin-s,this.scale=-1):(s=0,this.scale=0),o=n+this.a1relx,a=i+this.a1rely,this.dot1=this.nrelx*o+this.nrely*a,this.cx1=a*this.nrelx-o*this.nrely,this.dot2=this.nrelx*this.a2relx+this.nrely*this.a2rely,this.cx2=this.a2rely*this.nrelx-this.a2relx*this.nrely,this.kMassa=this.b1.smass+this.b2.smass+this.dot1*this.dot1*this.b1.sinertia+this.dot2*this.dot2*this.b2.sinertia,this.kMassb=-this.scale*(this.dot1*this.cx1*this.b1.sinertia+this.dot2*this.cx2*this.b2.sinertia),this.kMassc=this.scale*this.scale*(this.b1.smass+this.b2.smass+this.cx1*this.cx1*this.b1.sinertia+this.cx2*this.cx2*this.b2.sinertia);var l,p=this.kMassa*this.kMassc-this.kMassb*this.kMassb;if(p!=p)this.kMassa=this.kMassb=this.kMassc=0,l=3;else if(0==p){var u=0;0!=this.kMassa?this.kMassa=1/this.kMassa:(this.kMassa=0,u|=1),0!=this.kMassc?this.kMassc=1/this.kMassc:(this.kMassc=0,u|=2),this.kMassb=0,l=u}else{p=1/p;var h=this.kMassc*p;this.kMassc=this.kMassa*p,this.kMassa=h,this.kMassb*=-p,l=0}if(0!=(1&l)&&(this.jAccx=0),0!=(2&l)&&(this.jAccy=0),this.stiff)this.gamma=0,this.biasx=0,this.biasy=0;else{if(this.breakUnderError&&r*r+s*s>this.maxError*this.maxError)return!0;var c,_=2*Math.PI*this.frequency;this.gamma=1/(e*_*(2*this.damping+_*e));var d=1/(1+this.gamma);c=e*_*_*this.gamma,this.gamma*=d;var m=d;this.kMassa*=m,this.kMassb*=m,this.kMassc*=m,this.biasx=r,this.biasy=s;var P=-c;this.biasx*=P,this.biasy*=P;var f=this.maxError,x=this.biasx*this.biasx+this.biasy*this.biasy;if(x>f*f){var y=f*(1/Math.sqrt(x));this.biasx*=y,this.biasy*=y}}var v=t;return this.jAccx*=v,this.jAccy*=v,this.jMax=this.maxForce*e,!1},t.constraint.ZPP_LineJoint.prototype.warmStart=function(){var e=this.scale*this.nrelx*this.jAccy-this.nrely*this.jAccx,t=this.nrelx*this.jAccx+this.scale*this.nrely*this.jAccy,n=this.b1.imass;this.b1.velx-=e*n,this.b1.vely-=t*n;var i=this.b2.imass;this.b2.velx+=e*i,this.b2.vely+=t*i,this.b1.angvel+=(this.scale*this.cx1*this.jAccy-this.dot1*this.jAccx)*this.b1.iinertia,this.b2.angvel+=(this.dot2*this.jAccx-this.scale*this.cx2*this.jAccy)*this.b2.iinertia},t.constraint.ZPP_LineJoint.prototype.applyImpulseVel=function(){var e,t,n=0,i=0;n=this.b2.velx-this.b1.velx,i=this.b2.vely-this.b1.vely,n+=this.b2.kinvelx-this.b1.kinvelx,e=(i+=this.b2.kinvely-this.b1.kinvely)*this.nrelx-n*this.nrely+(this.b2.angvel+this.b2.kinangvel)*this.dot2-(this.b1.angvel+this.b1.kinangvel)*this.dot1,t=this.scale*(this.nrelx*n+this.nrely*i-(this.b2.angvel+this.b2.kinangvel)*this.cx2+(this.b1.angvel+this.b1.kinangvel)*this.cx1);var r=0,o=0;r=this.biasx-e,o=this.biasy-t;var a=this.kMassa*r+this.kMassb*o;o=this.kMassb*r+this.kMassc*o,r=a;var s,l,p=this.gamma;if(r-=this.jAccx*p,o-=this.jAccy*p,s=this.jAccx,l=this.jAccy,this.jAccx+=1*r,this.jAccy+=1*o,this.jAccy>0&&(this.jAccy=0),this.breakUnderForce){if(this.jAccx*this.jAccx+this.jAccy*this.jAccy>this.jMax*this.jMax)return!0}else if(!this.stiff){var u=this.jMax,h=this.jAccx*this.jAccx+this.jAccy*this.jAccy;if(h>u*u){var c=u*(1/Math.sqrt(h));this.jAccx*=c,this.jAccy*=c}}r=this.jAccx-s,o=this.jAccy-l;var _=this.scale*this.nrelx*o-this.nrely*r,d=this.nrelx*r+this.scale*this.nrely*o,m=this.b1.imass;this.b1.velx-=_*m,this.b1.vely-=d*m;var P=this.b2.imass;return this.b2.velx+=_*P,this.b2.vely+=d*P,this.b1.angvel+=(this.scale*this.cx1*o-this.dot1*r)*this.b1.iinertia,this.b2.angvel+=(this.dot2*r-this.scale*this.cx2*o)*this.b2.iinertia,!1},t.constraint.ZPP_LineJoint.prototype.applyImpulsePos=function(){var t,n,i,r,o,a;t=this.b1.axisy*this.nlocalx-this.b1.axisx*this.nlocaly,n=this.nlocalx*this.b1.axisx+this.nlocaly*this.b1.axisy,i=this.b1.axisy*this.a1localx-this.b1.axisx*this.a1localy,r=this.a1localx*this.b1.axisx+this.a1localy*this.b1.axisy,o=this.b2.axisy*this.a2localx-this.b2.axisx*this.a2localy,a=this.a2localx*this.b2.axisx+this.a2localy*this.b2.axisy;var s,l=0,p=0,u=0,h=0;if(l=this.b2.posx+o-this.b1.posx-i,u=(p=this.b2.posy+a-this.b1.posy-r)*t-l*n,h=t*l+n*p,this.equal?(h-=this.jointMin,s=1):h>this.jointMax?(h-=this.jointMax,s=1):h<this.jointMin?(h=this.jointMin-h,s=-1):(h=0,s=0),this.breakUnderError&&u*u+h*h>this.maxError*this.maxError)return!0;if(u*u+h*h<e.Config.constraintLinearSlop*e.Config.constraintLinearSlop)return!1;var c,_,d,m,P,f,x,y,v,g=0,b=0;if((u*=.5)*u+(h*=.5)*h>6){var z=this.b1.smass+this.b2.smass;if(z>e.Config.epsilon){var w=(z=.8/z)*(n*u-s*t*h),Z=z*(t*u*s-n*u),E=this.b1.imass;this.b1.posx-=w*E,this.b1.posy-=Z*E;var M=this.b2.imass;this.b2.posx+=w*M,this.b2.posy+=Z*M,l=this.b2.posx+o-this.b1.posx-i,u=(p=this.b2.posy+a-this.b1.posy-r)*t-l*n,h=t*l+n*p,this.equal?(h-=this.jointMin,s=1):h>this.jointMax?(h-=this.jointMax,s=1):h<this.jointMin?(h=this.jointMin-h,s=-1):(h=0,s=0),u*=.5,h*=.5}}c=t*(y=l+i)+n*(v=p+r),d=v*t-y*n,_=t*o+n*a,m=a*t-o*n,P=this.b1.smass+this.b2.smass+c*c*this.b1.sinertia+_*_*this.b2.sinertia,f=-s*(c*d*this.b1.sinertia+_*m*this.b2.sinertia),g=-u,b=-h;var S=P*(x=s*s*(this.b1.smass+this.b2.smass+d*d*this.b1.sinertia+m*m*this.b2.sinertia))-f*f;if(S!=S)g=b=0;else if(0==S)0!=P?g/=P:g=0,0!=x?b/=x:b=0;else{var C=(S=1/S)*(x*g-f*b);b=S*(P*b-f*g),g=C}b>0&&(b=0);var N=s*t*b-n*g,A=t*g+s*n*b,L=this.b1.imass;this.b1.posx-=N*L,this.b1.posy-=A*L;var B=this.b2.imass;this.b2.posx+=N*B,this.b2.posy+=A*B;var T=this.b1,V=(s*d*b-c*g)*this.b1.iinertia;if(T.rot+=V,V*V>1e-4)T.axisx=Math.sin(T.rot),T.axisy=Math.cos(T.rot);else{var k=V*V,I=1-.5*k,O=1-k*k/8,R=(I*T.axisx+V*T.axisy)*O;T.axisy=(I*T.axisy-V*T.axisx)*O,T.axisx=R}var H=this.b2,F=(_*g-s*m*b)*this.b2.iinertia;if(H.rot+=F,F*F>1e-4)H.axisx=Math.sin(H.rot),H.axisy=Math.cos(H.rot);else{var D=F*F,G=1-.5*D,U=1-D*D/8,j=(G*H.axisx+F*H.axisy)*U;H.axisy=(G*H.axisy-F*H.axisx)*U,H.axisx=j}return!1},t.constraint.ZPP_LineJoint.prototype.draw=function(e){},t.constraint.ZPP_LineJoint.prototype.__class__=t.constraint.ZPP_LineJoint,t.constraint.ZPP_MotorJoint=l["zpp_nape.constraint.ZPP_MotorJoint"]=function(){this.stepped=!1,this.jMax=0,this.jAcc=0,this.kMass=0,this.b2=null,this.b1=null,this.rate=0,this.ratio=0,this.outer_zn=null,t.constraint.ZPP_Constraint.call(this),this.jAcc=0,this.stepped=!1,this.__velocity=!0},t.constraint.ZPP_MotorJoint.__name__=["zpp_nape","constraint","ZPP_MotorJoint"],t.constraint.ZPP_MotorJoint.__super__=t.constraint.ZPP_Constraint,t.constraint.ZPP_Constraint.prototype)t.constraint.ZPP_MotorJoint.prototype[u]=t.constraint.ZPP_Constraint.prototype[u];for(var u in t.constraint.ZPP_MotorJoint.prototype.outer_zn=null,t.constraint.ZPP_MotorJoint.prototype.ratio=null,t.constraint.ZPP_MotorJoint.prototype.rate=null,t.constraint.ZPP_MotorJoint.prototype.bodyImpulse=function(t){return this.stepped?t==this.b1?e.geom.Vec3.get(0,0,-this.jAcc):e.geom.Vec3.get(0,0,this.ratio*this.jAcc):e.geom.Vec3.get(0,0,0)},t.constraint.ZPP_MotorJoint.prototype.activeBodies=function(){null!=this.b1&&this.b1.constraints.add(this),this.b2!=this.b1&&null!=this.b2&&this.b2.constraints.add(this)},t.constraint.ZPP_MotorJoint.prototype.inactiveBodies=function(){null!=this.b1&&this.b1.constraints.remove(this),this.b2!=this.b1&&null!=this.b2&&this.b2.constraints.remove(this)},t.constraint.ZPP_MotorJoint.prototype.b1=null,t.constraint.ZPP_MotorJoint.prototype.b2=null,t.constraint.ZPP_MotorJoint.prototype.kMass=null,t.constraint.ZPP_MotorJoint.prototype.jAcc=null,t.constraint.ZPP_MotorJoint.prototype.jMax=null,t.constraint.ZPP_MotorJoint.prototype.stepped=null,t.constraint.ZPP_MotorJoint.prototype.copy=function(n,i){var r=new e.constraint.MotorJoint(null,null,this.rate,this.ratio);if(this.copyto(r),null!=n&&null!=this.b1){for(var o=null,a=0;a<n.length;){var s=n[a];if(++a,s.id==this.b1.id){o=s.bc;break}}null!=o?r.zpp_inner_zn.b1=o.zpp_inner:i.push(t.constraint.ZPP_CopyHelper.todo(this.b1.id,(function(e){r.zpp_inner_zn.b1=e.zpp_inner})))}if(null!=n&&null!=this.b2){for(var l=null,p=0;p<n.length;){var u=n[p];if(++p,u.id==this.b2.id){l=u.bc;break}}null!=l?r.zpp_inner_zn.b2=l.zpp_inner:i.push(t.constraint.ZPP_CopyHelper.todo(this.b2.id,(function(e){r.zpp_inner_zn.b2=e.zpp_inner})))}return r},t.constraint.ZPP_MotorJoint.prototype.validate=function(){if(null==this.b1||null==this.b2)throw new n._Boot.HaxeError("Error: AngleJoint cannot be simulated null bodies");if(this.b1==this.b2)throw new n._Boot.HaxeError("Error: MotorJoint cannot be simulated with body1 == body2");if(this.b1.space!=this.space||this.b2.space!=this.space)throw new n._Boot.HaxeError("Error: Constraints must have each body within the same space to which the constraint has been assigned");if(2!=this.b1.type&&2!=this.b2.type)throw new n._Boot.HaxeError("Error: Constraints cannot have both bodies non-dynamic")},t.constraint.ZPP_MotorJoint.prototype.wake_connected=function(){null!=this.b1&&2==this.b1.type&&this.b1.wake(),null!=this.b2&&2==this.b2.type&&this.b2.wake()},t.constraint.ZPP_MotorJoint.prototype.forest=function(){if(2==this.b1.type){var e,t;if(this.b1.component==this.b1.component.parent)e=this.b1.component;else{for(var n=this.b1.component,i=null;n!=n.parent;){var r=n.parent;n.parent=i,i=n,n=r}for(;null!=i;){var o=i.parent;i.parent=n,i=o}e=n}if(this.component==this.component.parent)t=this.component;else{for(var a=this.component,s=null;a!=a.parent;){var l=a.parent;a.parent=s,s=a,a=l}for(;null!=s;){var p=s.parent;s.parent=a,s=p}t=a}e!=t&&(e.rank<t.rank?e.parent=t:e.rank>t.rank?t.parent=e:(t.parent=e,e.rank++))}if(2==this.b2.type){var u,h;if(this.b2.component==this.b2.component.parent)u=this.b2.component;else{for(var c=this.b2.component,_=null;c!=c.parent;){var d=c.parent;c.parent=_,_=c,c=d}for(;null!=_;){var m=_.parent;_.parent=c,_=m}u=c}if(this.component==this.component.parent)h=this.component;else{for(var P=this.component,f=null;P!=P.parent;){var x=P.parent;P.parent=f,f=P,P=x}for(;null!=f;){var y=f.parent;f.parent=P,f=y}h=P}u!=h&&(u.rank<h.rank?u.parent=h:u.rank>h.rank?h.parent=u:(h.parent=u,u.rank++))}},t.constraint.ZPP_MotorJoint.prototype.pair_exists=function(e,t){return this.b1.id==e&&this.b2.id==t||this.b1.id==t&&this.b2.id==e},t.constraint.ZPP_MotorJoint.prototype.clearcache=function(){this.jAcc=0,this.pre_dt=-1},t.constraint.ZPP_MotorJoint.prototype.preStep=function(e){-1==this.pre_dt&&(this.pre_dt=e);var t=e/this.pre_dt;return this.pre_dt=e,this.stepped=!0,this.kMass=this.b1.sinertia+this.ratio*this.ratio*this.b2.sinertia,this.kMass=1/this.kMass,this.jAcc*=t,this.jMax=this.maxForce*e,!1},t.constraint.ZPP_MotorJoint.prototype.warmStart=function(){this.b1.angvel-=this.b1.iinertia*this.jAcc,this.b2.angvel+=this.ratio*this.b2.iinertia*this.jAcc},t.constraint.ZPP_MotorJoint.prototype.applyImpulseVel=function(){var e=this.ratio*(this.b2.angvel+this.b2.kinangvel)-this.b1.angvel-this.b1.kinangvel-this.rate,t=-this.kMass*e,n=this.jAcc;if(this.jAcc+=t,this.breakUnderForce){if(this.jAcc>this.jMax||this.jAcc<-this.jMax)return!0}else this.jAcc<-this.jMax?this.jAcc=-this.jMax:this.jAcc>this.jMax&&(this.jAcc=this.jMax);return t=this.jAcc-n,this.b1.angvel-=this.b1.iinertia*t,this.b2.angvel+=this.ratio*this.b2.iinertia*t,!1},t.constraint.ZPP_MotorJoint.prototype.applyImpulsePos=function(){return!1},t.constraint.ZPP_MotorJoint.prototype.__class__=t.constraint.ZPP_MotorJoint,t.constraint.ZPP_PivotJoint=l["zpp_nape.constraint.ZPP_PivotJoint"]=function(){this.stepped=!1,this.biasy=0,this.biasx=0,this.gamma=0,this.jMax=0,this.jAccy=0,this.jAccx=0,this.kMassc=0,this.kMassb=0,this.kMassa=0,this.wrap_a2=null,this.a2rely=0,this.a2relx=0,this.a2localy=0,this.a2localx=0,this.b2=null,this.wrap_a1=null,this.a1rely=0,this.a1relx=0,this.a1localy=0,this.a1localx=0,this.b1=null,this.outer_zn=null,t.constraint.ZPP_Constraint.call(this),this.stepped=!1,this.jAccx=0,this.jAccy=0,this.jMax=1/0,this.a1localx=0,this.a1localy=0,this.a1relx=0,this.a1rely=0,this.a2localx=0,this.a2localy=0,this.a2relx=0,this.a2rely=0},t.constraint.ZPP_PivotJoint.__name__=["zpp_nape","constraint","ZPP_PivotJoint"],t.constraint.ZPP_PivotJoint.__super__=t.constraint.ZPP_Constraint,t.constraint.ZPP_Constraint.prototype)t.constraint.ZPP_PivotJoint.prototype[u]=t.constraint.ZPP_Constraint.prototype[u];for(var u in t.constraint.ZPP_PivotJoint.prototype.outer_zn=null,t.constraint.ZPP_PivotJoint.prototype.bodyImpulse=function(t){return this.stepped?t==this.b1?e.geom.Vec3.get(-this.jAccx,-this.jAccy,-(this.jAccy*this.a1relx-this.jAccx*this.a1rely)):e.geom.Vec3.get(this.jAccx,this.jAccy,this.jAccy*this.a2relx-this.jAccx*this.a2rely):e.geom.Vec3.get(0,0,0)},t.constraint.ZPP_PivotJoint.prototype.activeBodies=function(){null!=this.b1&&this.b1.constraints.add(this),this.b2!=this.b1&&null!=this.b2&&this.b2.constraints.add(this)},t.constraint.ZPP_PivotJoint.prototype.inactiveBodies=function(){null!=this.b1&&this.b1.constraints.remove(this),this.b2!=this.b1&&null!=this.b2&&this.b2.constraints.remove(this)},t.constraint.ZPP_PivotJoint.prototype.b1=null,t.constraint.ZPP_PivotJoint.prototype.a1localx=null,t.constraint.ZPP_PivotJoint.prototype.a1localy=null,t.constraint.ZPP_PivotJoint.prototype.a1relx=null,t.constraint.ZPP_PivotJoint.prototype.a1rely=null,t.constraint.ZPP_PivotJoint.prototype.validate_a1=function(){this.wrap_a1.zpp_inner.x=this.a1localx,this.wrap_a1.zpp_inner.y=this.a1localy},t.constraint.ZPP_PivotJoint.prototype.invalidate_a1=function(e){this.immutable_midstep("Constraint::a1"),this.a1localx=e.x,this.a1localy=e.y,this.wake()},t.constraint.ZPP_PivotJoint.prototype.setup_a1=function(){var i,r=this.a1localx,o=this.a1localy;if(null==o&&(o=0),null==r&&(r=0),r!=r||o!=o)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null==t.util.ZPP_PubPool.poolVec2?i=new e.geom.Vec2:(i=t.util.ZPP_PubPool.poolVec2,t.util.ZPP_PubPool.poolVec2=i.zpp_pool,i.zpp_pool=null,i.zpp_disp=!1,i==t.util.ZPP_PubPool.nextVec2&&(t.util.ZPP_PubPool.nextVec2=null)),null==i.zpp_inner){var a;null==t.geom.ZPP_Vec2.zpp_pool?a=new t.geom.ZPP_Vec2:(a=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=a.next,a.next=null),a.weak=!1,a._immutable=!1,a.x=r,a.y=o,i.zpp_inner=a,i.zpp_inner.outer=i}else{if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var s,l=i.zpp_inner;if(l._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=l._isimmutable&&l._isimmutable(),r!=r||o!=o)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var u=i.zpp_inner;if(null!=u._validate&&u._validate(),i.zpp_inner.x==r){if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var h=i.zpp_inner;null!=h._validate&&h._validate(),s=i.zpp_inner.y==o}else s=!1;if(!s){i.zpp_inner.x=r,i.zpp_inner.y=o;var c=i.zpp_inner;null!=c._invalidate&&c._invalidate(c)}}i.zpp_inner.weak=!1,this.wrap_a1=i,this.wrap_a1.zpp_inner._inuse=!0,this.wrap_a1.zpp_inner._validate=p(this,this.validate_a1),this.wrap_a1.zpp_inner._invalidate=p(this,this.invalidate_a1)},t.constraint.ZPP_PivotJoint.prototype.wrap_a1=null,t.constraint.ZPP_PivotJoint.prototype.b2=null,t.constraint.ZPP_PivotJoint.prototype.a2localx=null,t.constraint.ZPP_PivotJoint.prototype.a2localy=null,t.constraint.ZPP_PivotJoint.prototype.a2relx=null,t.constraint.ZPP_PivotJoint.prototype.a2rely=null,t.constraint.ZPP_PivotJoint.prototype.validate_a2=function(){this.wrap_a2.zpp_inner.x=this.a2localx,this.wrap_a2.zpp_inner.y=this.a2localy},t.constraint.ZPP_PivotJoint.prototype.invalidate_a2=function(e){this.immutable_midstep("Constraint::a2"),this.a2localx=e.x,this.a2localy=e.y,this.wake()},t.constraint.ZPP_PivotJoint.prototype.setup_a2=function(){var i,r=this.a2localx,o=this.a2localy;if(null==o&&(o=0),null==r&&(r=0),r!=r||o!=o)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null==t.util.ZPP_PubPool.poolVec2?i=new e.geom.Vec2:(i=t.util.ZPP_PubPool.poolVec2,t.util.ZPP_PubPool.poolVec2=i.zpp_pool,i.zpp_pool=null,i.zpp_disp=!1,i==t.util.ZPP_PubPool.nextVec2&&(t.util.ZPP_PubPool.nextVec2=null)),null==i.zpp_inner){var a;null==t.geom.ZPP_Vec2.zpp_pool?a=new t.geom.ZPP_Vec2:(a=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=a.next,a.next=null),a.weak=!1,a._immutable=!1,a.x=r,a.y=o,i.zpp_inner=a,i.zpp_inner.outer=i}else{if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var s,l=i.zpp_inner;if(l._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=l._isimmutable&&l._isimmutable(),r!=r||o!=o)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var u=i.zpp_inner;if(null!=u._validate&&u._validate(),i.zpp_inner.x==r){if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var h=i.zpp_inner;null!=h._validate&&h._validate(),s=i.zpp_inner.y==o}else s=!1;if(!s){i.zpp_inner.x=r,i.zpp_inner.y=o;var c=i.zpp_inner;null!=c._invalidate&&c._invalidate(c)}}i.zpp_inner.weak=!1,this.wrap_a2=i,this.wrap_a2.zpp_inner._inuse=!0,this.wrap_a2.zpp_inner._validate=p(this,this.validate_a2),this.wrap_a2.zpp_inner._invalidate=p(this,this.invalidate_a2)},t.constraint.ZPP_PivotJoint.prototype.wrap_a2=null,t.constraint.ZPP_PivotJoint.prototype.kMassa=null,t.constraint.ZPP_PivotJoint.prototype.kMassb=null,t.constraint.ZPP_PivotJoint.prototype.kMassc=null,t.constraint.ZPP_PivotJoint.prototype.jAccx=null,t.constraint.ZPP_PivotJoint.prototype.jAccy=null,t.constraint.ZPP_PivotJoint.prototype.jMax=null,t.constraint.ZPP_PivotJoint.prototype.gamma=null,t.constraint.ZPP_PivotJoint.prototype.biasx=null,t.constraint.ZPP_PivotJoint.prototype.biasy=null,t.constraint.ZPP_PivotJoint.prototype.stepped=null,t.constraint.ZPP_PivotJoint.prototype.copy=function(n,i){var r=this.outer_zn;null==r.zpp_inner_zn.wrap_a1&&r.zpp_inner_zn.setup_a1();var o=r.zpp_inner_zn.wrap_a1,a=this.outer_zn;null==a.zpp_inner_zn.wrap_a2&&a.zpp_inner_zn.setup_a2();var s=new e.constraint.PivotJoint(null,null,o,a.zpp_inner_zn.wrap_a2);if(this.copyto(s),null!=n&&null!=this.b1){for(var l=null,p=0;p<n.length;){var u=n[p];if(++p,u.id==this.b1.id){l=u.bc;break}}null!=l?s.zpp_inner_zn.b1=l.zpp_inner:i.push(t.constraint.ZPP_CopyHelper.todo(this.b1.id,(function(e){s.zpp_inner_zn.b1=e.zpp_inner})))}if(null!=n&&null!=this.b2){for(var h=null,c=0;c<n.length;){var _=n[c];if(++c,_.id==this.b2.id){h=_.bc;break}}null!=h?s.zpp_inner_zn.b2=h.zpp_inner:i.push(t.constraint.ZPP_CopyHelper.todo(this.b2.id,(function(e){s.zpp_inner_zn.b2=e.zpp_inner})))}return s},t.constraint.ZPP_PivotJoint.prototype.validate=function(){if(null==this.b1||null==this.b2)throw new n._Boot.HaxeError("Error: PivotJoint cannot be simulated null bodies");if(this.b1==this.b2)throw new n._Boot.HaxeError("Error: PivotJoint cannot be simulated with body1 == body2 (body1=body2="+this.b1.outer.toString()+")");if(this.b1.space!=this.space||this.b2.space!=this.space)throw new n._Boot.HaxeError("Error: Constraints must have each body within the same space to which the constraint has been assigned (body1="+this.b1.outer.toString()+", body2="+this.b2.outer.toString()+")");if(2!=this.b1.type&&2!=this.b2.type)throw new n._Boot.HaxeError("Error: Constraints cannot have both bodies non-dynamic (body1="+this.b1.outer.toString()+", body2="+this.b2.outer.toString()+")")},t.constraint.ZPP_PivotJoint.prototype.wake_connected=function(){null!=this.b1&&2==this.b1.type&&this.b1.wake(),null!=this.b2&&2==this.b2.type&&this.b2.wake()},t.constraint.ZPP_PivotJoint.prototype.forest=function(){if(2==this.b1.type){var e,t;if(this.b1.component==this.b1.component.parent)e=this.b1.component;else{for(var n=this.b1.component,i=null;n!=n.parent;){var r=n.parent;n.parent=i,i=n,n=r}for(;null!=i;){var o=i.parent;i.parent=n,i=o}e=n}if(this.component==this.component.parent)t=this.component;else{for(var a=this.component,s=null;a!=a.parent;){var l=a.parent;a.parent=s,s=a,a=l}for(;null!=s;){var p=s.parent;s.parent=a,s=p}t=a}e!=t&&(e.rank<t.rank?e.parent=t:e.rank>t.rank?t.parent=e:(t.parent=e,e.rank++))}if(2==this.b2.type){var u,h;if(this.b2.component==this.b2.component.parent)u=this.b2.component;else{for(var c=this.b2.component,_=null;c!=c.parent;){var d=c.parent;c.parent=_,_=c,c=d}for(;null!=_;){var m=_.parent;_.parent=c,_=m}u=c}if(this.component==this.component.parent)h=this.component;else{for(var P=this.component,f=null;P!=P.parent;){var x=P.parent;P.parent=f,f=P,P=x}for(;null!=f;){var y=f.parent;f.parent=P,f=y}h=P}u!=h&&(u.rank<h.rank?u.parent=h:u.rank>h.rank?h.parent=u:(h.parent=u,u.rank++))}},t.constraint.ZPP_PivotJoint.prototype.pair_exists=function(e,t){return this.b1.id==e&&this.b2.id==t||this.b1.id==t&&this.b2.id==e},t.constraint.ZPP_PivotJoint.prototype.clearcache=function(){this.jAccx=0,this.jAccy=0,this.pre_dt=-1},t.constraint.ZPP_PivotJoint.prototype.preStep=function(e){-1==this.pre_dt&&(this.pre_dt=e);var t=e/this.pre_dt;this.pre_dt=e,this.stepped=!0,this.a1relx=this.b1.axisy*this.a1localx-this.b1.axisx*this.a1localy,this.a1rely=this.a1localx*this.b1.axisx+this.a1localy*this.b1.axisy,this.a2relx=this.b2.axisy*this.a2localx-this.b2.axisx*this.a2localy,this.a2rely=this.a2localx*this.b2.axisx+this.a2localy*this.b2.axisy;var n=this.b1.smass+this.b2.smass;if(this.kMassa=n,this.kMassb=0,this.kMassc=n,0!=this.b1.sinertia){var i=this.a1relx*this.b1.sinertia,r=this.a1rely*this.b1.sinertia;this.kMassa+=r*this.a1rely,this.kMassb+=-r*this.a1relx,this.kMassc+=i*this.a1relx}if(0!=this.b2.sinertia){var o=this.a2relx*this.b2.sinertia,a=this.a2rely*this.b2.sinertia;this.kMassa+=a*this.a2rely,this.kMassb+=-a*this.a2relx,this.kMassc+=o*this.a2relx}var s,l=this.kMassa*this.kMassc-this.kMassb*this.kMassb;if(l!=l)this.kMassa=this.kMassb=this.kMassc=0,s=3;else if(0==l){var p=0;0!=this.kMassa?this.kMassa=1/this.kMassa:(this.kMassa=0,p|=1),0!=this.kMassc?this.kMassc=1/this.kMassc:(this.kMassc=0,p|=2),this.kMassb=0,s=p}else{l=1/l;var u=this.kMassc*l;this.kMassc=this.kMassa*l,this.kMassa=u,this.kMassb*=-l,s=0}if(0!=(1&s)&&(this.jAccx=0),0!=(2&s)&&(this.jAccy=0),this.stiff)this.biasx=0,this.biasy=0,this.gamma=0;else{var h,c=2*Math.PI*this.frequency;this.gamma=1/(e*c*(2*this.damping+c*e));var _=1/(1+this.gamma);h=e*c*c*this.gamma,this.gamma*=_;var d=_;if(this.kMassa*=d,this.kMassb*=d,this.kMassc*=d,this.biasx=this.b2.posx+this.a2relx-(this.b1.posx+this.a1relx),this.biasy=this.b2.posy+this.a2rely-(this.b1.posy+this.a1rely),this.breakUnderError&&this.biasx*this.biasx+this.biasy*this.biasy>this.maxError*this.maxError)return!0;var m=-h;this.biasx*=m,this.biasy*=m;var P=this.maxError,f=this.biasx*this.biasx+this.biasy*this.biasy;if(f>P*P){var x=P*(1/Math.sqrt(f));this.biasx*=x,this.biasy*=x}}var y=t;return this.jAccx*=y,this.jAccy*=y,this.jMax=this.maxForce*e,!1},t.constraint.ZPP_PivotJoint.prototype.warmStart=function(){var e=this.b1.imass;this.b1.velx-=this.jAccx*e,this.b1.vely-=this.jAccy*e;var t=this.b2.imass;this.b2.velx+=this.jAccx*t,this.b2.vely+=this.jAccy*t,this.b1.angvel-=(this.jAccy*this.a1relx-this.jAccx*this.a1rely)*this.b1.iinertia,this.b2.angvel+=(this.jAccy*this.a2relx-this.jAccx*this.a2rely)*this.b2.iinertia},t.constraint.ZPP_PivotJoint.prototype.applyImpulseVel=function(){var e,t;e=this.b2.velx+this.b2.kinvelx-this.a2rely*(this.b2.angvel+this.b2.kinangvel)-(this.b1.velx+this.b1.kinvelx-this.a1rely*(this.b1.angvel+this.b1.kinangvel)),t=this.b2.vely+this.b2.kinvely+this.a2relx*(this.b2.angvel+this.b2.kinangvel)-(this.b1.vely+this.b1.kinvely+this.a1relx*(this.b1.angvel+this.b1.kinangvel));var n=0,i=0;n=this.biasx-e,i=this.biasy-t;var r=this.kMassa*n+this.kMassb*i;i=this.kMassb*n+this.kMassc*i,n=r;var o,a,s=this.gamma;if(n-=this.jAccx*s,i-=this.jAccy*s,o=this.jAccx,a=this.jAccy,this.jAccx+=1*n,this.jAccy+=1*i,this.breakUnderForce){if(this.jAccx*this.jAccx+this.jAccy*this.jAccy>this.jMax*this.jMax)return!0}else if(!this.stiff){var l=this.jMax,p=this.jAccx*this.jAccx+this.jAccy*this.jAccy;if(p>l*l){var u=l*(1/Math.sqrt(p));this.jAccx*=u,this.jAccy*=u}}n=this.jAccx-o,i=this.jAccy-a;var h=this.b1.imass;this.b1.velx-=n*h,this.b1.vely-=i*h;var c=this.b2.imass;return this.b2.velx+=n*c,this.b2.vely+=i*c,this.b1.angvel-=(i*this.a1relx-n*this.a1rely)*this.b1.iinertia,this.b2.angvel+=(i*this.a2relx-n*this.a2rely)*this.b2.iinertia,!1},t.constraint.ZPP_PivotJoint.prototype.applyImpulsePos=function(){var t,n,i,r;t=this.b1.axisy*this.a1localx-this.b1.axisx*this.a1localy,n=this.a1localx*this.b1.axisx+this.a1localy*this.b1.axisy,i=this.b2.axisy*this.a2localx-this.b2.axisx*this.a2localy,r=this.a2localx*this.b2.axisx+this.a2localy*this.b2.axisy;var o=0,a=0;if(o=this.b2.posx+i-(this.b1.posx+t),a=this.b2.posy+r-(this.b1.posy+n),this.breakUnderError&&o*o+a*a>this.maxError*this.maxError)return!0;if(o*o+a*a<e.Config.constraintLinearSlop*e.Config.constraintLinearSlop)return!1;var s=0,l=0;if((o*=.5)*o+(a*=.5)*a>6){var p=this.b1.smass+this.b2.smass;if(p>e.Config.epsilon){var u=(s=-o*(p=.75/p))*s+(l=-a*p)*l;if(u>400){var h=1/Math.sqrt(u)*20;s*=h,l*=h}var c=this.b1.imass;this.b1.posx-=s*c,this.b1.posy-=l*c;var _=this.b2.imass;this.b2.posx+=s*_,this.b2.posy+=l*_,o=this.b2.posx+i-(this.b1.posx+t),a=this.b2.posy+r-(this.b1.posy+n),o*=.5,a*=.5}}var d=0,m=0,P=0,f=this.b1.smass+this.b2.smass;if(d=f,m=0,P=f,0!=this.b1.sinertia){var x=t*this.b1.sinertia,y=n*this.b1.sinertia;d+=y*n,m+=-y*t,P+=x*t}if(0!=this.b2.sinertia){var v=i*this.b2.sinertia,g=r*this.b2.sinertia;d+=g*r,m+=-g*i,P+=v*i}var b=(s=-o)*s+(l=-a)*l;if(b>36){var z=1/Math.sqrt(b)*6;s*=z,l*=z}var w=d*P-m*m;if(w!=w)s=l=0;else if(0==w)0!=d?s/=d:s=0,0!=P?l/=P:l=0;else{var Z=(w=1/w)*(P*s-m*l);l=w*(d*l-m*s),s=Z}var E=this.b1.imass;this.b1.posx-=s*E,this.b1.posy-=l*E;var M=this.b2.imass;this.b2.posx+=s*M,this.b2.posy+=l*M;var S=this.b1,C=-(l*t-s*n)*this.b1.iinertia;if(S.rot+=C,C*C>1e-4)S.axisx=Math.sin(S.rot),S.axisy=Math.cos(S.rot);else{var N=C*C,A=1-.5*N,L=1-N*N/8,B=(A*S.axisx+C*S.axisy)*L;S.axisy=(A*S.axisy-C*S.axisx)*L,S.axisx=B}var T=this.b2,V=(l*i-s*r)*this.b2.iinertia;if(T.rot+=V,V*V>1e-4)T.axisx=Math.sin(T.rot),T.axisy=Math.cos(T.rot);else{var k=V*V,I=1-.5*k,O=1-k*k/8,R=(I*T.axisx+V*T.axisy)*O;T.axisy=(I*T.axisy-V*T.axisx)*O,T.axisx=R}return!1},t.constraint.ZPP_PivotJoint.prototype.draw=function(e){},t.constraint.ZPP_PivotJoint.prototype.__class__=t.constraint.ZPP_PivotJoint,t.constraint.ZPP_PulleyJoint=l["zpp_nape.constraint.ZPP_PulleyJoint"]=function(){this.stepped=!1,this.bias=0,this.gamma=0,this.jMax=0,this.jAcc=0,this.kMass=0,this.wrap_a4=null,this.a4rely=0,this.a4relx=0,this.a4localy=0,this.a4localx=0,this.b4=null,this.wrap_a3=null,this.a3rely=0,this.a3relx=0,this.a3localy=0,this.a3localx=0,this.b3=null,this.wrap_a2=null,this.a2rely=0,this.a2relx=0,this.a2localy=0,this.a2localx=0,this.b2=null,this.wrap_a1=null,this.a1rely=0,this.a1relx=0,this.a1localy=0,this.a1localx=0,this.b1=null,this.cx4=0,this.cx3=0,this.cx2=0,this.cx1=0,this.n34y=0,this.n34x=0,this.n12y=0,this.n12x=0,this.equal=!1,this.slack=!1,this.jointMax=0,this.jointMin=0,this.ratio=1,this.outer_zn=null,t.constraint.ZPP_Constraint.call(this),this.a1localx=0,this.a1localy=0,this.a1relx=0,this.a1rely=0,this.a2localx=0,this.a2localy=0,this.a2relx=0,this.a2rely=0,this.a3localx=0,this.a3localy=0,this.a3relx=0,this.a3rely=0,this.a4localx=0,this.a4localy=0,this.a4relx=0,this.a4rely=0,this.n12x=1,this.n12y=0,this.n34x=1,this.n34y=0,this.jAcc=0,this.jMax=1/0,this.stepped=!1,this.cx1=this.cx2=this.cx3=this.cx4=0},t.constraint.ZPP_PulleyJoint.__name__=["zpp_nape","constraint","ZPP_PulleyJoint"],t.constraint.ZPP_PulleyJoint.__super__=t.constraint.ZPP_Constraint,t.constraint.ZPP_Constraint.prototype)t.constraint.ZPP_PulleyJoint.prototype[u]=t.constraint.ZPP_Constraint.prototype[u];for(var u in t.constraint.ZPP_PulleyJoint.prototype.outer_zn=null,t.constraint.ZPP_PulleyJoint.prototype.ratio=null,t.constraint.ZPP_PulleyJoint.prototype.jointMin=null,t.constraint.ZPP_PulleyJoint.prototype.jointMax=null,t.constraint.ZPP_PulleyJoint.prototype.slack=null,t.constraint.ZPP_PulleyJoint.prototype.equal=null,t.constraint.ZPP_PulleyJoint.prototype.is_slack=function(){var e;this.a1relx=this.b1.axisy*this.a1localx-this.b1.axisx*this.a1localy,this.a1rely=this.a1localx*this.b1.axisx+this.a1localy*this.b1.axisy,this.a2relx=this.b2.axisy*this.a2localx-this.b2.axisx*this.a2localy,this.a2rely=this.a2localx*this.b2.axisx+this.a2localy*this.b2.axisy,this.a3relx=this.b3.axisy*this.a3localx-this.b3.axisx*this.a3localy,this.a3rely=this.a3localx*this.b3.axisx+this.a3localy*this.b3.axisy,this.a4relx=this.b4.axisy*this.a4localx-this.b4.axisx*this.a4localy,this.a4rely=this.a4localx*this.b4.axisx+this.a4localy*this.b4.axisy;var t,n,i,r,o=0,a=0;t=this.b2.posx+this.a2relx-(this.b1.posx+this.a1relx),n=this.b2.posy+this.a2rely-(this.b1.posy+this.a1rely),i=this.b4.posx+this.a4relx-(this.b3.posx+this.a3relx),r=this.b4.posy+this.a4rely-(this.b3.posy+this.a3rely);var s=Math.sqrt(t*t+n*n),l=Math.sqrt(i*i+r*r);if(0!=l){var p=1/l;o=i*p,a=r*p;var u=this.ratio;o*=u,a*=u}else{var h=this.ratio/Math.sqrt(o*o+a*a);o*=h,a*=h}var c=s+this.ratio*l;return this.equal?(c-=this.jointMax,e=!1):c<this.jointMin?(c=this.jointMin-c,o=-o,a=-a,e=!1):c>this.jointMax?(c-=this.jointMax,e=!1):(o=0,a=0,c=0,e=!0),e},t.constraint.ZPP_PulleyJoint.prototype.n12x=null,t.constraint.ZPP_PulleyJoint.prototype.n12y=null,t.constraint.ZPP_PulleyJoint.prototype.n34x=null,t.constraint.ZPP_PulleyJoint.prototype.n34y=null,t.constraint.ZPP_PulleyJoint.prototype.cx1=null,t.constraint.ZPP_PulleyJoint.prototype.cx2=null,t.constraint.ZPP_PulleyJoint.prototype.cx3=null,t.constraint.ZPP_PulleyJoint.prototype.cx4=null,t.constraint.ZPP_PulleyJoint.prototype.bodyImpulse=function(t){if(this.stepped){var i=e.geom.Vec3.get();if(t==this.b1){var r=i;if(null!=r&&r.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");var o=r.zpp_inner;if(null!=o._validate&&o._validate(),null!=r&&r.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");if(r.zpp_inner.immutable)throw new n._Boot.HaxeError("Error: Vec3 is immutable");if(r.zpp_inner.x=r.zpp_inner.x-this.jAcc*this.n12x,null!=r&&r.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");var a=r.zpp_inner;null!=a._validate&&a._validate();var s=i;if(null!=s&&s.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");var l=s.zpp_inner;if(null!=l._validate&&l._validate(),null!=s&&s.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");if(s.zpp_inner.immutable)throw new n._Boot.HaxeError("Error: Vec3 is immutable");if(s.zpp_inner.y=s.zpp_inner.y-this.jAcc*this.n12y,null!=s&&s.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");var p=s.zpp_inner;null!=p._validate&&p._validate();var u=i;if(null!=u&&u.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");var h=u.zpp_inner;if(null!=h._validate&&h._validate(),null!=u&&u.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");if(u.zpp_inner.immutable)throw new n._Boot.HaxeError("Error: Vec3 is immutable");if(u.zpp_inner.z=u.zpp_inner.z-this.cx1*this.jAcc,null!=u&&u.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");var c=u.zpp_inner;null!=c._validate&&c._validate()}if(t==this.b2){var _=i;if(null!=_&&_.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");var d=_.zpp_inner;if(null!=d._validate&&d._validate(),null!=_&&_.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");if(_.zpp_inner.immutable)throw new n._Boot.HaxeError("Error: Vec3 is immutable");if(_.zpp_inner.x=_.zpp_inner.x+this.jAcc*this.n12x,null!=_&&_.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");var m=_.zpp_inner;null!=m._validate&&m._validate();var P=i;if(null!=P&&P.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");var f=P.zpp_inner;if(null!=f._validate&&f._validate(),null!=P&&P.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");if(P.zpp_inner.immutable)throw new n._Boot.HaxeError("Error: Vec3 is immutable");if(P.zpp_inner.y=P.zpp_inner.y+this.jAcc*this.n12y,null!=P&&P.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");var x=P.zpp_inner;null!=x._validate&&x._validate();var y=i;if(null!=y&&y.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");var v=y.zpp_inner;if(null!=v._validate&&v._validate(),null!=y&&y.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");if(y.zpp_inner.immutable)throw new n._Boot.HaxeError("Error: Vec3 is immutable");if(y.zpp_inner.z=y.zpp_inner.z+this.cx2*this.jAcc,null!=y&&y.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");var g=y.zpp_inner;null!=g._validate&&g._validate()}if(t==this.b3){var b=i;if(null!=b&&b.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");var z=b.zpp_inner;if(null!=z._validate&&z._validate(),null!=b&&b.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");if(b.zpp_inner.immutable)throw new n._Boot.HaxeError("Error: Vec3 is immutable");if(b.zpp_inner.x=b.zpp_inner.x-this.jAcc*this.n34x,null!=b&&b.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");var w=b.zpp_inner;null!=w._validate&&w._validate();var Z=i;if(null!=Z&&Z.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");var E=Z.zpp_inner;if(null!=E._validate&&E._validate(),null!=Z&&Z.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");if(Z.zpp_inner.immutable)throw new n._Boot.HaxeError("Error: Vec3 is immutable");if(Z.zpp_inner.y=Z.zpp_inner.y-this.jAcc*this.n34y,null!=Z&&Z.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");var M=Z.zpp_inner;null!=M._validate&&M._validate();var S=i;if(null!=S&&S.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");var C=S.zpp_inner;if(null!=C._validate&&C._validate(),null!=S&&S.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");if(S.zpp_inner.immutable)throw new n._Boot.HaxeError("Error: Vec3 is immutable");if(S.zpp_inner.z=S.zpp_inner.z-this.cx3*this.jAcc,null!=S&&S.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");var N=S.zpp_inner;null!=N._validate&&N._validate()}if(t==this.b4){var A=i;if(null!=A&&A.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");var L=A.zpp_inner;if(null!=L._validate&&L._validate(),null!=A&&A.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");if(A.zpp_inner.immutable)throw new n._Boot.HaxeError("Error: Vec3 is immutable");if(A.zpp_inner.x=A.zpp_inner.x+this.jAcc*this.n34x,null!=A&&A.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");var B=A.zpp_inner;null!=B._validate&&B._validate();var T=i;if(null!=T&&T.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");var V=T.zpp_inner;if(null!=V._validate&&V._validate(),null!=T&&T.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");if(T.zpp_inner.immutable)throw new n._Boot.HaxeError("Error: Vec3 is immutable");if(T.zpp_inner.y=T.zpp_inner.y+this.jAcc*this.n34y,null!=T&&T.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");var k=T.zpp_inner;null!=k._validate&&k._validate();var I=i;if(null!=I&&I.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");var O=I.zpp_inner;if(null!=O._validate&&O._validate(),null!=I&&I.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");if(I.zpp_inner.immutable)throw new n._Boot.HaxeError("Error: Vec3 is immutable");if(I.zpp_inner.z=I.zpp_inner.z+this.cx4*this.jAcc,null!=I&&I.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");var R=I.zpp_inner;null!=R._validate&&R._validate()}return i}return e.geom.Vec3.get(0,0,0)},t.constraint.ZPP_PulleyJoint.prototype.activeBodies=function(){null!=this.b1&&this.b1.constraints.add(this),this.b2!=this.b1&&null!=this.b2&&this.b2.constraints.add(this),this.b3!=this.b1&&this.b3!=this.b2&&null!=this.b3&&this.b3.constraints.add(this),this.b4!=this.b1&&this.b4!=this.b2&&this.b4!=this.b3&&null!=this.b4&&this.b4.constraints.add(this)},t.constraint.ZPP_PulleyJoint.prototype.inactiveBodies=function(){null!=this.b1&&this.b1.constraints.remove(this),this.b2!=this.b1&&null!=this.b2&&this.b2.constraints.remove(this),this.b3!=this.b1&&this.b3!=this.b2&&null!=this.b3&&this.b3.constraints.remove(this),this.b4!=this.b1&&this.b4!=this.b2&&this.b4!=this.b3&&null!=this.b4&&this.b4.constraints.remove(this)},t.constraint.ZPP_PulleyJoint.prototype.b1=null,t.constraint.ZPP_PulleyJoint.prototype.a1localx=null,t.constraint.ZPP_PulleyJoint.prototype.a1localy=null,t.constraint.ZPP_PulleyJoint.prototype.a1relx=null,t.constraint.ZPP_PulleyJoint.prototype.a1rely=null,t.constraint.ZPP_PulleyJoint.prototype.validate_a1=function(){this.wrap_a1.zpp_inner.x=this.a1localx,this.wrap_a1.zpp_inner.y=this.a1localy},t.constraint.ZPP_PulleyJoint.prototype.invalidate_a1=function(e){this.immutable_midstep("Constraint::a1"),this.a1localx=e.x,this.a1localy=e.y,this.wake()},t.constraint.ZPP_PulleyJoint.prototype.setup_a1=function(){var i,r=this.a1localx,o=this.a1localy;if(null==o&&(o=0),null==r&&(r=0),r!=r||o!=o)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null==t.util.ZPP_PubPool.poolVec2?i=new e.geom.Vec2:(i=t.util.ZPP_PubPool.poolVec2,t.util.ZPP_PubPool.poolVec2=i.zpp_pool,i.zpp_pool=null,i.zpp_disp=!1,i==t.util.ZPP_PubPool.nextVec2&&(t.util.ZPP_PubPool.nextVec2=null)),null==i.zpp_inner){var a;null==t.geom.ZPP_Vec2.zpp_pool?a=new t.geom.ZPP_Vec2:(a=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=a.next,a.next=null),a.weak=!1,a._immutable=!1,a.x=r,a.y=o,i.zpp_inner=a,i.zpp_inner.outer=i}else{if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var s,l=i.zpp_inner;if(l._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=l._isimmutable&&l._isimmutable(),r!=r||o!=o)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var u=i.zpp_inner;if(null!=u._validate&&u._validate(),i.zpp_inner.x==r){if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var h=i.zpp_inner;null!=h._validate&&h._validate(),s=i.zpp_inner.y==o}else s=!1;if(!s){i.zpp_inner.x=r,i.zpp_inner.y=o;var c=i.zpp_inner;null!=c._invalidate&&c._invalidate(c)}}i.zpp_inner.weak=!1,this.wrap_a1=i,this.wrap_a1.zpp_inner._inuse=!0,this.wrap_a1.zpp_inner._validate=p(this,this.validate_a1),this.wrap_a1.zpp_inner._invalidate=p(this,this.invalidate_a1)},t.constraint.ZPP_PulleyJoint.prototype.wrap_a1=null,t.constraint.ZPP_PulleyJoint.prototype.b2=null,t.constraint.ZPP_PulleyJoint.prototype.a2localx=null,t.constraint.ZPP_PulleyJoint.prototype.a2localy=null,t.constraint.ZPP_PulleyJoint.prototype.a2relx=null,t.constraint.ZPP_PulleyJoint.prototype.a2rely=null,t.constraint.ZPP_PulleyJoint.prototype.validate_a2=function(){this.wrap_a2.zpp_inner.x=this.a2localx,this.wrap_a2.zpp_inner.y=this.a2localy},t.constraint.ZPP_PulleyJoint.prototype.invalidate_a2=function(e){this.immutable_midstep("Constraint::a2"),this.a2localx=e.x,this.a2localy=e.y,this.wake()},t.constraint.ZPP_PulleyJoint.prototype.setup_a2=function(){var i,r=this.a2localx,o=this.a2localy;if(null==o&&(o=0),null==r&&(r=0),r!=r||o!=o)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null==t.util.ZPP_PubPool.poolVec2?i=new e.geom.Vec2:(i=t.util.ZPP_PubPool.poolVec2,t.util.ZPP_PubPool.poolVec2=i.zpp_pool,i.zpp_pool=null,i.zpp_disp=!1,i==t.util.ZPP_PubPool.nextVec2&&(t.util.ZPP_PubPool.nextVec2=null)),null==i.zpp_inner){var a;null==t.geom.ZPP_Vec2.zpp_pool?a=new t.geom.ZPP_Vec2:(a=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=a.next,a.next=null),a.weak=!1,a._immutable=!1,a.x=r,a.y=o,i.zpp_inner=a,i.zpp_inner.outer=i}else{if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var s,l=i.zpp_inner;if(l._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=l._isimmutable&&l._isimmutable(),r!=r||o!=o)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var u=i.zpp_inner;if(null!=u._validate&&u._validate(),i.zpp_inner.x==r){if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var h=i.zpp_inner;null!=h._validate&&h._validate(),s=i.zpp_inner.y==o}else s=!1;if(!s){i.zpp_inner.x=r,i.zpp_inner.y=o;var c=i.zpp_inner;null!=c._invalidate&&c._invalidate(c)}}i.zpp_inner.weak=!1,this.wrap_a2=i,this.wrap_a2.zpp_inner._inuse=!0,this.wrap_a2.zpp_inner._validate=p(this,this.validate_a2),this.wrap_a2.zpp_inner._invalidate=p(this,this.invalidate_a2)},t.constraint.ZPP_PulleyJoint.prototype.wrap_a2=null,t.constraint.ZPP_PulleyJoint.prototype.b3=null,t.constraint.ZPP_PulleyJoint.prototype.a3localx=null,t.constraint.ZPP_PulleyJoint.prototype.a3localy=null,t.constraint.ZPP_PulleyJoint.prototype.a3relx=null,t.constraint.ZPP_PulleyJoint.prototype.a3rely=null,t.constraint.ZPP_PulleyJoint.prototype.validate_a3=function(){this.wrap_a3.zpp_inner.x=this.a3localx,this.wrap_a3.zpp_inner.y=this.a3localy},t.constraint.ZPP_PulleyJoint.prototype.invalidate_a3=function(e){this.immutable_midstep("Constraint::a3"),this.a3localx=e.x,this.a3localy=e.y,this.wake()},t.constraint.ZPP_PulleyJoint.prototype.setup_a3=function(){var i,r=this.a3localx,o=this.a3localy;if(null==o&&(o=0),null==r&&(r=0),r!=r||o!=o)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null==t.util.ZPP_PubPool.poolVec2?i=new e.geom.Vec2:(i=t.util.ZPP_PubPool.poolVec2,t.util.ZPP_PubPool.poolVec2=i.zpp_pool,i.zpp_pool=null,i.zpp_disp=!1,i==t.util.ZPP_PubPool.nextVec2&&(t.util.ZPP_PubPool.nextVec2=null)),null==i.zpp_inner){var a;null==t.geom.ZPP_Vec2.zpp_pool?a=new t.geom.ZPP_Vec2:(a=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=a.next,a.next=null),a.weak=!1,a._immutable=!1,a.x=r,a.y=o,i.zpp_inner=a,i.zpp_inner.outer=i}else{if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var s,l=i.zpp_inner;if(l._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=l._isimmutable&&l._isimmutable(),r!=r||o!=o)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var u=i.zpp_inner;if(null!=u._validate&&u._validate(),i.zpp_inner.x==r){if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var h=i.zpp_inner;null!=h._validate&&h._validate(),s=i.zpp_inner.y==o}else s=!1;if(!s){i.zpp_inner.x=r,i.zpp_inner.y=o;var c=i.zpp_inner;null!=c._invalidate&&c._invalidate(c)}}i.zpp_inner.weak=!1,this.wrap_a3=i,this.wrap_a3.zpp_inner._inuse=!0,this.wrap_a3.zpp_inner._validate=p(this,this.validate_a3),this.wrap_a3.zpp_inner._invalidate=p(this,this.invalidate_a3)},t.constraint.ZPP_PulleyJoint.prototype.wrap_a3=null,t.constraint.ZPP_PulleyJoint.prototype.b4=null,t.constraint.ZPP_PulleyJoint.prototype.a4localx=null,t.constraint.ZPP_PulleyJoint.prototype.a4localy=null,t.constraint.ZPP_PulleyJoint.prototype.a4relx=null,t.constraint.ZPP_PulleyJoint.prototype.a4rely=null,t.constraint.ZPP_PulleyJoint.prototype.validate_a4=function(){this.wrap_a4.zpp_inner.x=this.a4localx,this.wrap_a4.zpp_inner.y=this.a4localy},t.constraint.ZPP_PulleyJoint.prototype.invalidate_a4=function(e){this.immutable_midstep("Constraint::a4"),this.a4localx=e.x,this.a4localy=e.y,this.wake()},t.constraint.ZPP_PulleyJoint.prototype.setup_a4=function(){var i,r=this.a4localx,o=this.a4localy;if(null==o&&(o=0),null==r&&(r=0),r!=r||o!=o)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null==t.util.ZPP_PubPool.poolVec2?i=new e.geom.Vec2:(i=t.util.ZPP_PubPool.poolVec2,t.util.ZPP_PubPool.poolVec2=i.zpp_pool,i.zpp_pool=null,i.zpp_disp=!1,i==t.util.ZPP_PubPool.nextVec2&&(t.util.ZPP_PubPool.nextVec2=null)),null==i.zpp_inner){var a;null==t.geom.ZPP_Vec2.zpp_pool?a=new t.geom.ZPP_Vec2:(a=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=a.next,a.next=null),a.weak=!1,a._immutable=!1,a.x=r,a.y=o,i.zpp_inner=a,i.zpp_inner.outer=i}else{if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var s,l=i.zpp_inner;if(l._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=l._isimmutable&&l._isimmutable(),r!=r||o!=o)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var u=i.zpp_inner;if(null!=u._validate&&u._validate(),i.zpp_inner.x==r){if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var h=i.zpp_inner;null!=h._validate&&h._validate(),s=i.zpp_inner.y==o}else s=!1;if(!s){i.zpp_inner.x=r,i.zpp_inner.y=o;var c=i.zpp_inner;null!=c._invalidate&&c._invalidate(c)}}i.zpp_inner.weak=!1,this.wrap_a4=i,this.wrap_a4.zpp_inner._inuse=!0,this.wrap_a4.zpp_inner._validate=p(this,this.validate_a4),this.wrap_a4.zpp_inner._invalidate=p(this,this.invalidate_a4)},t.constraint.ZPP_PulleyJoint.prototype.wrap_a4=null,t.constraint.ZPP_PulleyJoint.prototype.kMass=null,t.constraint.ZPP_PulleyJoint.prototype.jAcc=null,t.constraint.ZPP_PulleyJoint.prototype.jMax=null,t.constraint.ZPP_PulleyJoint.prototype.gamma=null,t.constraint.ZPP_PulleyJoint.prototype.bias=null,t.constraint.ZPP_PulleyJoint.prototype.stepped=null,t.constraint.ZPP_PulleyJoint.prototype.copy=function(n,i){var r=this.outer_zn;null==r.zpp_inner_zn.wrap_a1&&r.zpp_inner_zn.setup_a1();var o=r.zpp_inner_zn.wrap_a1,a=this.outer_zn;null==a.zpp_inner_zn.wrap_a2&&a.zpp_inner_zn.setup_a2();var s=a.zpp_inner_zn.wrap_a2,l=this.outer_zn;null==l.zpp_inner_zn.wrap_a3&&l.zpp_inner_zn.setup_a3();var p=l.zpp_inner_zn.wrap_a3,u=this.outer_zn;null==u.zpp_inner_zn.wrap_a4&&u.zpp_inner_zn.setup_a4();var h=new e.constraint.PulleyJoint(null,null,null,null,o,s,p,u.zpp_inner_zn.wrap_a4,this.jointMin,this.jointMax,this.ratio);if(this.copyto(h),null!=n&&null!=this.b1){for(var c=null,_=0;_<n.length;){var d=n[_];if(++_,d.id==this.b1.id){c=d.bc;break}}null!=c?h.zpp_inner_zn.b1=c.zpp_inner:i.push(t.constraint.ZPP_CopyHelper.todo(this.b1.id,(function(e){h.zpp_inner_zn.b1=e.zpp_inner})))}if(null!=n&&null!=this.b2){for(var m=null,P=0;P<n.length;){var f=n[P];if(++P,f.id==this.b2.id){m=f.bc;break}}null!=m?h.zpp_inner_zn.b2=m.zpp_inner:i.push(t.constraint.ZPP_CopyHelper.todo(this.b2.id,(function(e){h.zpp_inner_zn.b2=e.zpp_inner})))}if(null!=n&&null!=this.b3){for(var x=null,y=0;y<n.length;){var v=n[y];if(++y,v.id==this.b3.id){x=v.bc;break}}null!=x?h.zpp_inner_zn.b3=x.zpp_inner:i.push(t.constraint.ZPP_CopyHelper.todo(this.b3.id,(function(e){h.zpp_inner_zn.b3=e.zpp_inner})))}if(null!=n&&null!=this.b4){for(var g=null,b=0;b<n.length;){var z=n[b];if(++b,z.id==this.b4.id){g=z.bc;break}}null!=g?h.zpp_inner_zn.b4=g.zpp_inner:i.push(t.constraint.ZPP_CopyHelper.todo(this.b4.id,(function(e){h.zpp_inner_zn.b4=e.zpp_inner})))}return h},t.constraint.ZPP_PulleyJoint.prototype.validate=function(){if(null==this.b1||null==this.b2||null==this.b3||null==this.b4)throw new n._Boot.HaxeError("Error: PulleyJoint cannot be simulated with null bodies");if(this.b1==this.b2||this.b3==this.b4)throw new n._Boot.HaxeError("Error: PulleyJoint cannot have body1==body2 or body3==body4");if(this.b1.space!=this.space||this.b2.space!=this.space||this.b3.space!=this.space||this.b4.space!=this.space)throw new n._Boot.HaxeError("Error: Constraints must have each body within the same space to which the constraint has been assigned");if(this.jointMin>this.jointMax)throw new n._Boot.HaxeError("Error: PulleyJoint must have jointMin <= jointMax");if(2!=this.b1.type&&2!=this.b2.type)throw new n._Boot.HaxeError("Error: PulleyJoint cannot have both bodies in a linked pair non-dynamic");if(2!=this.b3.type&&2!=this.b4.type)throw new n._Boot.HaxeError("Error: PulleyJoint cannot have both bodies in a linked pair non-dynamic")},t.constraint.ZPP_PulleyJoint.prototype.wake_connected=function(){null!=this.b1&&2==this.b1.type&&this.b1.wake(),null!=this.b2&&2==this.b2.type&&this.b2.wake(),null!=this.b3&&2==this.b3.type&&this.b3.wake(),null!=this.b4&&2==this.b4.type&&this.b4.wake()},t.constraint.ZPP_PulleyJoint.prototype.forest=function(){if(2==this.b1.type){var e,t;if(this.b1.component==this.b1.component.parent)e=this.b1.component;else{for(var n=this.b1.component,i=null;n!=n.parent;){var r=n.parent;n.parent=i,i=n,n=r}for(;null!=i;){var o=i.parent;i.parent=n,i=o}e=n}if(this.component==this.component.parent)t=this.component;else{for(var a=this.component,s=null;a!=a.parent;){var l=a.parent;a.parent=s,s=a,a=l}for(;null!=s;){var p=s.parent;s.parent=a,s=p}t=a}e!=t&&(e.rank<t.rank?e.parent=t:e.rank>t.rank?t.parent=e:(t.parent=e,e.rank++))}if(2==this.b2.type){var u,h;if(this.b2.component==this.b2.component.parent)u=this.b2.component;else{for(var c=this.b2.component,_=null;c!=c.parent;){var d=c.parent;c.parent=_,_=c,c=d}for(;null!=_;){var m=_.parent;_.parent=c,_=m}u=c}if(this.component==this.component.parent)h=this.component;else{for(var P=this.component,f=null;P!=P.parent;){var x=P.parent;P.parent=f,f=P,P=x}for(;null!=f;){var y=f.parent;f.parent=P,f=y}h=P}u!=h&&(u.rank<h.rank?u.parent=h:u.rank>h.rank?h.parent=u:(h.parent=u,u.rank++))}if(2==this.b3.type){var v,g;if(this.b3.component==this.b3.component.parent)v=this.b3.component;else{for(var b=this.b3.component,z=null;b!=b.parent;){var w=b.parent;b.parent=z,z=b,b=w}for(;null!=z;){var Z=z.parent;z.parent=b,z=Z}v=b}if(this.component==this.component.parent)g=this.component;else{for(var E=this.component,M=null;E!=E.parent;){var S=E.parent;E.parent=M,M=E,E=S}for(;null!=M;){var C=M.parent;M.parent=E,M=C}g=E}v!=g&&(v.rank<g.rank?v.parent=g:v.rank>g.rank?g.parent=v:(g.parent=v,v.rank++))}if(2==this.b4.type){var N,A;if(this.b4.component==this.b4.component.parent)N=this.b4.component;else{for(var L=this.b4.component,B=null;L!=L.parent;){var T=L.parent;L.parent=B,B=L,L=T}for(;null!=B;){var V=B.parent;B.parent=L,B=V}N=L}if(this.component==this.component.parent)A=this.component;else{for(var k=this.component,I=null;k!=k.parent;){var O=k.parent;k.parent=I,I=k,k=O}for(;null!=I;){var R=I.parent;I.parent=k,I=R}A=k}N!=A&&(N.rank<A.rank?N.parent=A:N.rank>A.rank?A.parent=N:(A.parent=N,N.rank++))}},t.constraint.ZPP_PulleyJoint.prototype.pair_exists=function(e,t){return this.b1.id==e&&(this.b2.id==t||this.b3.id==t||this.b4.id==t)||this.b2.id==e&&(this.b3.id==t||this.b4.id==t||this.b1.id==t)||this.b3.id==e&&(this.b4.id==t||this.b1.id==t||this.b2.id==t)||this.b4.id==e&&(this.b1.id==t||this.b2.id==t||this.b3.id==t)},t.constraint.ZPP_PulleyJoint.prototype.clearcache=function(){this.jAcc=0,this.pre_dt=-1},t.constraint.ZPP_PulleyJoint.prototype.preStep=function(e){-1==this.pre_dt&&(this.pre_dt=e);var t,n,i,r,o=e/this.pre_dt;this.pre_dt=e,this.stepped=!0,this.equal=this.jointMin==this.jointMax,this.a1relx=this.b1.axisy*this.a1localx-this.b1.axisx*this.a1localy,this.a1rely=this.a1localx*this.b1.axisx+this.a1localy*this.b1.axisy,this.a2relx=this.b2.axisy*this.a2localx-this.b2.axisx*this.a2localy,this.a2rely=this.a2localx*this.b2.axisx+this.a2localy*this.b2.axisy,this.a3relx=this.b3.axisy*this.a3localx-this.b3.axisx*this.a3localy,this.a3rely=this.a3localx*this.b3.axisx+this.a3localy*this.b3.axisy,this.a4relx=this.b4.axisy*this.a4localx-this.b4.axisx*this.a4localy,this.a4rely=this.a4localx*this.b4.axisx+this.a4localy*this.b4.axisy,t=this.b2.posx+this.a2relx-(this.b1.posx+this.a1relx),n=this.b2.posy+this.a2rely-(this.b1.posy+this.a1rely),i=this.b4.posx+this.a4relx-(this.b3.posx+this.a3relx),r=this.b4.posy+this.a4rely-(this.b3.posy+this.a3rely);var a=Math.sqrt(t*t+n*n),s=Math.sqrt(i*i+r*r);if(0!=a){var l=1/a;this.n12x=t*l,this.n12y=n*l}if(0!=s){var p=1/s;this.n34x=i*p,this.n34y=r*p;var u=this.ratio;this.n34x*=u,this.n34y*=u}else{var h=this.ratio/Math.sqrt(this.n34x*this.n34x+this.n34y*this.n34y);this.n34x*=h,this.n34y*=h}var c=a+this.ratio*s;this.equal?(c-=this.jointMax,this.slack=!1):c<this.jointMin?(c=this.jointMin-c,this.n12x=-this.n12x,this.n12y=-this.n12y,this.n34x=-this.n34x,this.n34y=-this.n34y,this.slack=!1):c>this.jointMax?(c-=this.jointMax,this.slack=!1):(this.n12x=0,this.n12y=0,this.n34x=0,this.n34y=0,c=0,this.slack=!0);var _=c;if(!this.slack){this.cx1=this.n12y*this.a1relx-this.n12x*this.a1rely,this.cx2=this.n12y*this.a2relx-this.n12x*this.a2rely,this.cx3=this.n34y*this.a3relx-this.n34x*this.a3rely,this.cx4=this.n34y*this.a4relx-this.n34x*this.a4rely;var d=this.ratio*this.ratio,m=this.b1.smass+this.b2.smass+d*(this.b3.smass+this.b4.smass)+this.b1.sinertia*this.cx1*this.cx1+this.b2.sinertia*this.cx2*this.cx2+this.b3.sinertia*this.cx3*this.cx3+this.b4.sinertia*this.cx4*this.cx4;if(this.b1==this.b4&&(m-=2*((this.n12x*this.n34x+this.n12y*this.n34y)*this.b1.smass+this.cx1*this.cx4*this.b1.sinertia)),this.b1==this.b3&&(m+=2*((this.n12x*this.n34x+this.n12y*this.n34y)*this.b1.smass+this.cx1*this.cx3*this.b1.sinertia)),this.b2==this.b3&&(m-=2*((this.n12x*this.n34x+this.n12y*this.n34y)*this.b2.smass+this.cx2*this.cx3*this.b2.sinertia)),this.b2==this.b4&&(m+=2*((this.n12x*this.n34x+this.n12y*this.n34y)*this.b2.smass+this.cx2*this.cx4*this.b2.sinertia)),this.kMass=m,0!=this.kMass?this.kMass=1/this.kMass:this.jAcc=0,this.stiff)this.bias=0,this.gamma=0;else{if(this.breakUnderError&&_*_>this.maxError*this.maxError)return!0;var P=2*Math.PI*this.frequency;this.gamma=1/(e*P*(2*this.damping+P*e));var f=1/(1+this.gamma),x=e*P*P*this.gamma;this.gamma*=f,this.kMass*=f,this.bias=-_*x,this.bias<-this.maxError?this.bias=-this.maxError:this.bias>this.maxError&&(this.bias=this.maxError)}this.jAcc*=o,this.jMax=this.maxForce*e}return!1},t.constraint.ZPP_PulleyJoint.prototype.warmStart=function(){if(!this.slack){var e=this.b1.imass*this.jAcc;this.b1.velx-=this.n12x*e,this.b1.vely-=this.n12y*e;var t=this.b2.imass*this.jAcc;this.b2.velx+=this.n12x*t,this.b2.vely+=this.n12y*t;var n=this.b3.imass*this.jAcc;this.b3.velx-=this.n34x*n,this.b3.vely-=this.n34y*n;var i=this.b4.imass*this.jAcc;this.b4.velx+=this.n34x*i,this.b4.vely+=this.n34y*i,this.b1.angvel-=this.cx1*this.b1.iinertia*this.jAcc,this.b2.angvel+=this.cx2*this.b2.iinertia*this.jAcc,this.b3.angvel-=this.cx3*this.b3.iinertia*this.jAcc,this.b4.angvel+=this.cx4*this.b4.iinertia*this.jAcc}},t.constraint.ZPP_PulleyJoint.prototype.applyImpulseVel=function(){if(this.slack)return!1;var e=this.n12x*(this.b2.velx+this.b2.kinvelx-this.b1.velx-this.b1.kinvelx)+this.n12y*(this.b2.vely+this.b2.kinvely-this.b1.vely-this.b1.kinvely)+this.n34x*(this.b4.velx+this.b4.kinvelx-this.b3.velx-this.b3.kinvelx)+this.n34y*(this.b4.vely+this.b4.kinvely-this.b3.vely-this.b3.kinvely)+(this.b2.angvel+this.b2.kinangvel)*this.cx2-(this.b1.angvel+this.b1.kinangvel)*this.cx1+(this.b4.angvel+this.b4.kinangvel)*this.cx4-(this.b3.angvel+this.b3.kinangvel)*this.cx3,t=this.kMass*(this.bias-e)-this.jAcc*this.gamma,n=this.jAcc;if(this.jAcc+=t,!this.equal&&this.jAcc>0&&(this.jAcc=0),this.breakUnderForce&&this.jAcc<-this.jMax)return!0;this.stiff||this.jAcc<-this.jMax&&(this.jAcc=-this.jMax),t=this.jAcc-n;var i=this.b1.imass*t;this.b1.velx-=this.n12x*i,this.b1.vely-=this.n12y*i;var r=this.b2.imass*t;this.b2.velx+=this.n12x*r,this.b2.vely+=this.n12y*r;var o=this.b3.imass*t;this.b3.velx-=this.n34x*o,this.b3.vely-=this.n34y*o;var a=this.b4.imass*t;return this.b4.velx+=this.n34x*a,this.b4.vely+=this.n34y*a,this.b1.angvel-=this.cx1*this.b1.iinertia*t,this.b2.angvel+=this.cx2*this.b2.iinertia*t,this.b3.angvel-=this.cx3*this.b3.iinertia*t,this.b4.angvel+=this.cx4*this.b4.iinertia*t,!1},t.constraint.ZPP_PulleyJoint.prototype.applyImpulsePos=function(){var t,n,i,r,o,a,s,l,p,u;n=this.b1.axisy*this.a1localx-this.b1.axisx*this.a1localy,i=this.a1localx*this.b1.axisx+this.a1localy*this.b1.axisy,r=this.b2.axisy*this.a2localx-this.b2.axisx*this.a2localy,o=this.a2localx*this.b2.axisx+this.a2localy*this.b2.axisy,a=this.b3.axisy*this.a3localx-this.b3.axisx*this.a3localy,s=this.a3localx*this.b3.axisx+this.a3localy*this.b3.axisy,l=this.b4.axisy*this.a4localx-this.b4.axisx*this.a4localy,p=this.a4localx*this.b4.axisx+this.a4localy*this.b4.axisy;var h,c,_,d,m=0,P=0,f=0,x=0;m=this.n12x,P=this.n12y,f=this.n34x,x=this.n34y,h=this.b2.posx+r-(this.b1.posx+n),c=this.b2.posy+o-(this.b1.posy+i),_=this.b4.posx+l-(this.b3.posx+a),d=this.b4.posy+p-(this.b3.posy+s);var y=Math.sqrt(h*h+c*c),v=Math.sqrt(_*_+d*d);if(0!=y){var g=1/y;m=h*g,P=c*g}if(0!=v){var b=1/v;f=_*b,x=d*b;var z=this.ratio;f*=z,x*=z}else{var w=this.ratio/Math.sqrt(f*f+x*x);f*=w,x*=w}var Z=y+this.ratio*v;this.equal?(Z-=this.jointMax,u=!1):Z<this.jointMin?(Z=this.jointMin-Z,m=-m,P=-P,f=-f,x=-x,u=!1):Z>this.jointMax?(Z-=this.jointMax,u=!1):(m=0,P=0,f=0,x=0,Z=0,u=!0);var E=Z;if(!u){if(this.breakUnderError&&E*E>this.maxError*this.maxError)return!0;if(E*E<e.Config.constraintLinearSlop*e.Config.constraintLinearSlop)return!1;if((E*=.5)*E>6){var M=this.b1.smass+this.b2.smass;if(M>e.Config.epsilon&&(t=-E*(M=.75/M),this.equal||t<0)){var S=t*this.b1.imass;this.b1.posx-=m*S,this.b1.posy-=P*S;var C=t*this.b2.imass;this.b2.posx+=m*C,this.b2.posy+=P*C;var N=t*this.b3.imass;this.b3.posx-=f*N,this.b3.posy-=x*N;var A,L,B,T,V=t*this.b4.imass;this.b4.posx+=f*V,this.b4.posy+=x*V,A=this.b2.posx+r-(this.b1.posx+n),L=this.b2.posy+o-(this.b1.posy+i),B=this.b4.posx+l-(this.b3.posx+a),T=this.b4.posy+p-(this.b3.posy+s);var k=Math.sqrt(A*A+L*L),I=Math.sqrt(B*B+T*T);if(0!=k){var O=1/k;m=A*O,P=L*O}if(0!=I){var R=1/I;f=B*R,x=T*R;var H=this.ratio;f*=H,x*=H}else{var F=this.ratio/Math.sqrt(f*f+x*x);f*=F,x*=F}var D=k+this.ratio*I;this.equal?(D-=this.jointMax,u=!1):D<this.jointMin?(D=this.jointMin-D,m=-m,P=-P,f=-f,x=-x,u=!1):D>this.jointMax?(D-=this.jointMax,u=!1):(m=0,P=0,f=0,x=0,D=0,u=!0),E=D,E*=.5}}var G=P*n-m*i,U=P*r-m*o,j=x*a-f*s,W=x*l-f*p,q=this.ratio*this.ratio,J=this.b1.smass+this.b2.smass+q*(this.b3.smass+this.b4.smass)+this.b1.sinertia*G*G+this.b2.sinertia*U*U+this.b3.sinertia*j*j+this.b4.sinertia*W*W;this.b1==this.b4&&(J-=2*((m*f+P*x)*this.b1.smass+G*W*this.b1.sinertia)),this.b1==this.b3&&(J+=2*((m*f+P*x)*this.b1.smass+G*j*this.b1.sinertia)),this.b2==this.b3&&(J-=2*((m*f+P*x)*this.b2.smass+U*j*this.b2.sinertia)),this.b2==this.b4&&(J+=2*((m*f+P*x)*this.b2.smass+U*W*this.b2.sinertia));var $=J;if(0!=$&&($=1/$),t=-E*$,this.equal||t<0){var X=this.b1.imass*t;this.b1.posx-=m*X,this.b1.posy-=P*X;var Y=this.b2.imass*t;this.b2.posx+=m*Y,this.b2.posy+=P*Y;var K=this.b3.imass*t;this.b3.posx-=f*K,this.b3.posy-=x*K;var Q=this.b4.imass*t;this.b4.posx+=f*Q,this.b4.posy+=x*Q;var ee=this.b1,te=-G*this.b1.iinertia*t;if(ee.rot+=te,te*te>1e-4)ee.axisx=Math.sin(ee.rot),ee.axisy=Math.cos(ee.rot);else{var ne=te*te,ie=1-.5*ne,re=1-ne*ne/8,oe=(ie*ee.axisx+te*ee.axisy)*re;ee.axisy=(ie*ee.axisy-te*ee.axisx)*re,ee.axisx=oe}var ae=this.b2,se=U*this.b2.iinertia*t;if(ae.rot+=se,se*se>1e-4)ae.axisx=Math.sin(ae.rot),ae.axisy=Math.cos(ae.rot);else{var le=se*se,pe=1-.5*le,ue=1-le*le/8,he=(pe*ae.axisx+se*ae.axisy)*ue;ae.axisy=(pe*ae.axisy-se*ae.axisx)*ue,ae.axisx=he}var ce=this.b3,_e=-j*this.b3.iinertia*t;if(ce.rot+=_e,_e*_e>1e-4)ce.axisx=Math.sin(ce.rot),ce.axisy=Math.cos(ce.rot);else{var de=_e*_e,me=1-.5*de,Pe=1-de*de/8,fe=(me*ce.axisx+_e*ce.axisy)*Pe;ce.axisy=(me*ce.axisy-_e*ce.axisx)*Pe,ce.axisx=fe}var xe=this.b4,ye=W*this.b4.iinertia*t;if(xe.rot+=ye,ye*ye>1e-4)xe.axisx=Math.sin(xe.rot),xe.axisy=Math.cos(xe.rot);else{var ve=ye*ye,ge=1-.5*ve,be=1-ve*ve/8,ze=(ge*xe.axisx+ye*xe.axisy)*be;xe.axisy=(ge*xe.axisy-ye*xe.axisx)*be,xe.axisx=ze}}}return!1},t.constraint.ZPP_PulleyJoint.prototype.draw=function(e){},t.constraint.ZPP_PulleyJoint.prototype.__class__=t.constraint.ZPP_PulleyJoint,t.constraint.ZPP_UserConstraint=l["zpp_nape.constraint.ZPP_UserConstraint"]=function(n,i){this.jOld=null,this.J=null,this.vec3=null,this.Keff=null,this.jMax=0,this.velonly=!1,this.gamma=0,this.soft=0,this.y=null,this.L=null,this.stepped=!1,this.bias=null,this.jAcc=null,this.dim=0,this.bodies=null,this.outer_zn=null,t.constraint.ZPP_Constraint.call(this),this.bodies=[],this.dim=n,this.velonly=i,this.jAcc=[],this.bias=[],this.L=[],this.J=[],this.jOld=[],this.y=[],this.Keff=[],this.vec3=e.geom.Vec3.get(0,0,0);for(var r=0,o=n;r<o;){var a=r++,s=this.bias[a]=this.J[a]=this.jOld[a]=this.y[a]=0;this.jAcc[a]=s;for(var l=0,p=n;l<p;){var u=l++;this.L[a*n+u]=0}}this.stepped=!1},t.constraint.ZPP_UserConstraint.__name__=["zpp_nape","constraint","ZPP_UserConstraint"],t.constraint.ZPP_UserConstraint.__super__=t.constraint.ZPP_Constraint,t.constraint.ZPP_Constraint.prototype)t.constraint.ZPP_UserConstraint.prototype[u]=t.constraint.ZPP_Constraint.prototype[u];for(var u in t.constraint.ZPP_UserConstraint.prototype.outer_zn=null,t.constraint.ZPP_UserConstraint.prototype.bindVec2_invalidate=function(e){this.outer_zn.__invalidate()},t.constraint.ZPP_UserConstraint.prototype.bodies=null,t.constraint.ZPP_UserConstraint.prototype.dim=null,t.constraint.ZPP_UserConstraint.prototype.jAcc=null,t.constraint.ZPP_UserConstraint.prototype.bias=null,t.constraint.ZPP_UserConstraint.prototype.addBody=function(e){for(var n=null,i=0,r=this.bodies;i<r.length;){var o=r[i];if(++i,o.body==e){n=o;break}}null==n?(this.bodies.push(new t.constraint.ZPP_UserBody(1,e)),this.active&&null!=this.space&&null!=e&&e.constraints.add(this)):n.cnt++},t.constraint.ZPP_UserConstraint.prototype.remBody=function(e){for(var t=null,n=0|this.bodies.length,i=0;i<n;){var r=this.bodies[i];if(r.body==e){r.cnt--,0==r.cnt&&(n>0&&(this.bodies[i]=this.bodies[n-1]),this.bodies.pop(),this.active&&null!=this.space&&null!=e&&e.constraints.remove(this)),t=r;break}++i}return null!=t},t.constraint.ZPP_UserConstraint.prototype.bodyImpulse=function(t){for(var n=0,i=this.dim;n<i;){var r=n++;this.J[r]=this.jAcc[r]}var o=e.geom.Vec3.get(0,0,0);return this.stepped&&this.outer_zn.__impulse(this.J,t.outer,o),o},t.constraint.ZPP_UserConstraint.prototype.activeBodies=function(){for(var e=0,t=this.bodies;e<t.length;){var n=t[e];++e,null!=n.body&&n.body.constraints.add(this)}},t.constraint.ZPP_UserConstraint.prototype.inactiveBodies=function(){for(var e=0,t=this.bodies;e<t.length;){var n=t[e];++e,null!=n.body&&n.body.constraints.remove(this)}},t.constraint.ZPP_UserConstraint.prototype.stepped=null,t.constraint.ZPP_UserConstraint.prototype.copy=function(e,t){var i=this.outer_zn.__copy();throw this.copyto(i),new n._Boot.HaxeError("not done yet")},t.constraint.ZPP_UserConstraint.prototype.validate=function(){for(var e=0,t=this.bodies;e<t.length;){var i=t[e];if(++e,i.body.space!=this.space)throw new n._Boot.HaxeError("Error: Constraints must have each body within the same sapce to which the constraint has been assigned")}this.outer_zn.__validate()},t.constraint.ZPP_UserConstraint.prototype.wake_connected=function(){for(var e=0,t=this.bodies;e<t.length;){var n=t[e];++e,2==n.body.type&&n.body.wake()}},t.constraint.ZPP_UserConstraint.prototype.forest=function(){for(var e=0,t=this.bodies;e<t.length;){var n=t[e];if(++e,2==n.body.type){var i,r;if(n.body.component==n.body.component.parent)i=n.body.component;else{for(var o=n.body.component,a=null;o!=o.parent;){var s=o.parent;o.parent=a,a=o,o=s}for(;null!=a;){var l=a.parent;a.parent=o,a=l}i=o}if(this.component==this.component.parent)r=this.component;else{for(var p=this.component,u=null;p!=p.parent;){var h=p.parent;p.parent=u,u=p,p=h}for(;null!=u;){var c=u.parent;u.parent=p,u=c}r=p}i!=r&&(i.rank<r.rank?i.parent=r:i.rank>r.rank?r.parent=i:(r.parent=i,i.rank++))}}},t.constraint.ZPP_UserConstraint.prototype.pair_exists=function(e,t){for(var n=!1,i=0|this.bodies.length,r=0,o=i;r<o;){for(var a=r++,s=this.bodies[a].body,l=a+1,p=i;l<p;){var u=l++,h=this.bodies[u].body;if(s.id==e&&h.id==t||s.id==t&&h.id==e){n=!0;break}}if(n)break}return n},t.constraint.ZPP_UserConstraint.prototype.broken=function(){this.outer_zn.__broken()},t.constraint.ZPP_UserConstraint.prototype.clearcache=function(){for(var e=0,t=this.dim;e<t;){var n=e++;this.jAcc[n]=0}this.pre_dt=-1},t.constraint.ZPP_UserConstraint.prototype.lsq=function(e){for(var t=0,n=0,i=this.dim;n<i;){var r=n++;t+=e[r]*e[r]}return t},t.constraint.ZPP_UserConstraint.prototype._clamp=function(e,t){var n=this.lsq(e);if(n>t*t)for(var i=t/Math.sqrt(n),r=0,o=this.dim;r<o;)e[r++]*=i},t.constraint.ZPP_UserConstraint.prototype.L=null,t.constraint.ZPP_UserConstraint.prototype.solve=function(e){for(var t=0,n=0,i=this.dim;n<i;){for(var r=n++,o=0,a=0,s=r-1;a<s;){var l=a++;o+=this.L[r*this.dim+l]*this.L[r*this.dim+l]}var p=Math.sqrt(e[t++]-o);if(this.L[r*this.dim+r]=p,0!=p){p=1/p;for(var u=r+1,h=this.dim;u<h;){for(var c=u++,_=0,d=0,m=r-1;d<m;){var P=d++;_+=this.L[c*this.dim+P]*this.L[r*this.dim+P]}this.L[c*this.dim+r]=p*(e[t++]-_)}}else{for(var f=r+1,x=this.dim;f<x;){var y=f++;this.L[y*this.dim+r]=0}t+=this.dim-r-1}}return this.L},t.constraint.ZPP_UserConstraint.prototype.y=null,t.constraint.ZPP_UserConstraint.prototype.transform=function(e,t){for(var n=0,i=this.dim;n<i;){var r=n++,o=t[r],a=e[r*this.dim+r];if(0!=a){for(var s=0,l=r;s<l;){var p=s++;o-=e[r*this.dim+p]*this.y[p]}this.y[r]=o/a}else this.y[r]=0}for(var u=0,h=this.dim;u<h;){var c=u++,_=this.dim-1-c,d=e[_*this.dim+_];if(0!=d){for(var m=this.y[_],P=_+1,f=this.dim;P<f;){var x=P++;m-=e[x*this.dim+_]*t[x]}t[_]=m/d}else t[_]=0}},t.constraint.ZPP_UserConstraint.prototype.soft=null,t.constraint.ZPP_UserConstraint.prototype.gamma=null,t.constraint.ZPP_UserConstraint.prototype.velonly=null,t.constraint.ZPP_UserConstraint.prototype.jMax=null,t.constraint.ZPP_UserConstraint.prototype.Keff=null,t.constraint.ZPP_UserConstraint.prototype.preStep=function(e){-1==this.pre_dt&&(this.pre_dt=e);var t=e/this.pre_dt;if(this.pre_dt=e,this.stepped=!0,this.outer_zn.__prepare(),this.outer_zn.__eff_mass(this.Keff),this.L=this.solve(this.Keff),this.stiff||this.velonly){for(var n=0,i=this.dim;n<i;){var r=n++;this.bias[r]=0}this.gamma=0,this.soft=1}else{var o=2*Math.PI*this.frequency;this.gamma=1/(e*o*(2*this.damping+o*e));var a=1/(1+this.gamma),s=e*o*o*this.gamma;if(this.gamma*=a,this.soft=a,this.outer_zn.__position(this.bias),this.breakUnderError&&this.lsq(this.bias)>this.maxError*this.maxError)return!0;for(var l=0,p=this.dim;l<p;){var u=l++;this.bias[u]*=-s}this._clamp(this.bias,this.maxError)}for(var h=0,c=this.dim;h<c;){var _=h++;this.jAcc[_]*=t}return this.jMax=this.maxForce*e,!1},t.constraint.ZPP_UserConstraint.prototype.vec3=null,t.constraint.ZPP_UserConstraint.prototype.warmStart=function(){for(var e=0,t=this.bodies;e<t.length;){var i=t[e];++e;var r=i.body;this.outer_zn.__impulse(this.jAcc,r.outer,this.vec3);var o=r.imass,a=r,s=a.velx,l=this.vec3;if(null!=l&&l.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");var p=l.zpp_inner;null!=p._validate&&p._validate(),a.velx=s+l.zpp_inner.x*o;var u=r,h=u.vely,c=this.vec3;if(null!=c&&c.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");var _=c.zpp_inner;null!=_._validate&&_._validate(),u.vely=h+c.zpp_inner.y*o;var d=r,m=d.angvel,P=this.vec3;if(null!=P&&P.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");var f=P.zpp_inner;null!=f._validate&&f._validate(),d.angvel=m+P.zpp_inner.z*r.iinertia}},t.constraint.ZPP_UserConstraint.prototype.J=null,t.constraint.ZPP_UserConstraint.prototype.jOld=null,t.constraint.ZPP_UserConstraint.prototype.applyImpulseVel=function(){this.outer_zn.__velocity(this.J);for(var e=0,t=this.dim;e<t;){var i=e++;this.J[i]=this.bias[i]-this.J[i]}this.transform(this.L,this.J);for(var r=0,o=this.dim;r<o;){var a=r++;this.jOld[a]=this.jAcc[a],this.jAcc[a]+=this.J[a]=this.J[a]*this.soft-this.jAcc[a]*this.gamma}if(this.outer_zn.__clamp(this.jAcc),(this.breakUnderForce||!this.stiff)&&this.lsq(this.jAcc)>this.jMax*this.jMax){if(this.breakUnderForce)return!0;this.stiff||this._clamp(this.jAcc,this.jMax)}for(var s=0,l=this.dim;s<l;){var p=s++;this.J[p]=this.jAcc[p]-this.jOld[p]}for(var u=0,h=this.bodies;u<h.length;){var c=h[u];++u;var _=c.body;this.outer_zn.__impulse(this.J,_.outer,this.vec3);var d=_.imass,m=_,P=m.velx,f=this.vec3;if(null!=f&&f.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");var x=f.zpp_inner;null!=x._validate&&x._validate(),m.velx=P+f.zpp_inner.x*d;var y=_,v=y.vely,g=this.vec3;if(null!=g&&g.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");var b=g.zpp_inner;null!=b._validate&&b._validate(),y.vely=v+g.zpp_inner.y*d;var z=_,w=z.angvel,Z=this.vec3;if(null!=Z&&Z.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");var E=Z.zpp_inner;null!=E._validate&&E._validate(),z.angvel=w+Z.zpp_inner.z*_.iinertia}return!1},t.constraint.ZPP_UserConstraint.prototype.applyImpulsePos=function(){if(this.velonly)return!1;this.outer_zn.__prepare(),this.outer_zn.__position(this.J);var t=this.lsq(this.J);if(this.breakUnderError&&t>this.maxError*this.maxError)return!0;if(t<e.Config.constraintLinearSlop*e.Config.constraintLinearSlop)return!1;for(var i=0,r=this.dim;i<r;){var o=i++;this.J[o]*=-1}this.outer_zn.__eff_mass(this.Keff),this.transform(this.solve(this.Keff),this.J),this.outer_zn.__clamp(this.J);for(var a=0,s=this.bodies;a<s.length;){var l=s[a];++a;var p=l.body;this.outer_zn.__impulse(this.J,p.outer,this.vec3);var u=p.imass,h=p,c=h.posx,_=this.vec3;if(null!=_&&_.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");var d=_.zpp_inner;null!=d._validate&&d._validate(),h.posx=c+_.zpp_inner.x*u;var m=p,P=m.posy,f=this.vec3;if(null!=f&&f.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");var x=f.zpp_inner;null!=x._validate&&x._validate(),m.posy=P+f.zpp_inner.y*u;var y=this.vec3;if(null!=y&&y.zpp_disp)throw new n._Boot.HaxeError("Error: Vec3 has been disposed and cannot be used!");var v=y.zpp_inner;null!=v._validate&&v._validate();var g=y.zpp_inner.z*p.iinertia;if(p.rot+=g,g*g>1e-4)p.axisx=Math.sin(p.rot),p.axisy=Math.cos(p.rot);else{var b=g*g,z=1-.5*b,w=1-b*b/8,Z=(z*p.axisx+g*p.axisy)*w;p.axisy=(z*p.axisy-g*p.axisx)*w,p.axisx=Z}}return!1},t.constraint.ZPP_UserConstraint.prototype.draw=function(e){this.outer_zn.__draw(e)},t.constraint.ZPP_UserConstraint.prototype.__class__=t.constraint.ZPP_UserConstraint,t.constraint.ZPP_UserBody=l["zpp_nape.constraint.ZPP_UserBody"]=function(e,t){this.body=null,this.cnt=0,this.cnt=e,this.body=t},t.constraint.ZPP_UserBody.__name__=["zpp_nape","constraint","ZPP_UserBody"],t.constraint.ZPP_UserBody.prototype.cnt=null,t.constraint.ZPP_UserBody.prototype.body=null,t.constraint.ZPP_UserBody.prototype.__class__=t.constraint.ZPP_UserBody,t.constraint.ZPP_WeldJoint=l["zpp_nape.constraint.ZPP_WeldJoint"]=function(){this.stepped=!1,this.biasz=0,this.biasy=0,this.biasx=0,this.gamma=0,this.jMax=0,this.jAccz=0,this.jAccy=0,this.jAccx=0,this.kMassf=0,this.kMasse=0,this.kMassc=0,this.kMassd=0,this.kMassb=0,this.kMassa=0,this.phase=0,this.wrap_a2=null,this.a2rely=0,this.a2relx=0,this.a2localy=0,this.a2localx=0,this.b2=null,this.wrap_a1=null,this.a1rely=0,this.a1relx=0,this.a1localy=0,this.a1localx=0,this.b1=null,this.outer_zn=null,t.constraint.ZPP_Constraint.call(this),this.phase=0,this.jAccx=0,this.jAccy=0,this.jAccz=0,this.jMax=1/0,this.stepped=!1,this.a1localx=0,this.a1localy=0,this.a1relx=0,this.a1rely=0,this.a2localx=0,this.a2localy=0,this.a2relx=0,this.a2rely=0},t.constraint.ZPP_WeldJoint.__name__=["zpp_nape","constraint","ZPP_WeldJoint"],t.constraint.ZPP_WeldJoint.__super__=t.constraint.ZPP_Constraint,t.constraint.ZPP_Constraint.prototype)t.constraint.ZPP_WeldJoint.prototype[u]=t.constraint.ZPP_Constraint.prototype[u];for(var u in t.constraint.ZPP_WeldJoint.prototype.outer_zn=null,t.constraint.ZPP_WeldJoint.prototype.bodyImpulse=function(t){return this.stepped?t==this.b1?e.geom.Vec3.get(-this.jAccx,-this.jAccy,-(this.jAccy*this.a1relx-this.jAccx*this.a1rely+this.jAccz)):e.geom.Vec3.get(this.jAccx,this.jAccy,this.jAccy*this.a2relx-this.jAccx*this.a2rely+this.jAccz):e.geom.Vec3.get(0,0,0)},t.constraint.ZPP_WeldJoint.prototype.activeBodies=function(){null!=this.b1&&this.b1.constraints.add(this),this.b2!=this.b1&&null!=this.b2&&this.b2.constraints.add(this)},t.constraint.ZPP_WeldJoint.prototype.inactiveBodies=function(){null!=this.b1&&this.b1.constraints.remove(this),this.b2!=this.b1&&null!=this.b2&&this.b2.constraints.remove(this)},t.constraint.ZPP_WeldJoint.prototype.b1=null,t.constraint.ZPP_WeldJoint.prototype.a1localx=null,t.constraint.ZPP_WeldJoint.prototype.a1localy=null,t.constraint.ZPP_WeldJoint.prototype.a1relx=null,t.constraint.ZPP_WeldJoint.prototype.a1rely=null,t.constraint.ZPP_WeldJoint.prototype.validate_a1=function(){this.wrap_a1.zpp_inner.x=this.a1localx,this.wrap_a1.zpp_inner.y=this.a1localy},t.constraint.ZPP_WeldJoint.prototype.invalidate_a1=function(e){this.immutable_midstep("Constraint::a1"),this.a1localx=e.x,this.a1localy=e.y,this.wake()},t.constraint.ZPP_WeldJoint.prototype.setup_a1=function(){var i,r=this.a1localx,o=this.a1localy;if(null==o&&(o=0),null==r&&(r=0),r!=r||o!=o)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null==t.util.ZPP_PubPool.poolVec2?i=new e.geom.Vec2:(i=t.util.ZPP_PubPool.poolVec2,t.util.ZPP_PubPool.poolVec2=i.zpp_pool,i.zpp_pool=null,i.zpp_disp=!1,i==t.util.ZPP_PubPool.nextVec2&&(t.util.ZPP_PubPool.nextVec2=null)),null==i.zpp_inner){var a;null==t.geom.ZPP_Vec2.zpp_pool?a=new t.geom.ZPP_Vec2:(a=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=a.next,a.next=null),a.weak=!1,a._immutable=!1,a.x=r,a.y=o,i.zpp_inner=a,i.zpp_inner.outer=i}else{if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var s,l=i.zpp_inner;if(l._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=l._isimmutable&&l._isimmutable(),r!=r||o!=o)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var u=i.zpp_inner;if(null!=u._validate&&u._validate(),i.zpp_inner.x==r){if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var h=i.zpp_inner;null!=h._validate&&h._validate(),s=i.zpp_inner.y==o}else s=!1;if(!s){i.zpp_inner.x=r,i.zpp_inner.y=o;var c=i.zpp_inner;null!=c._invalidate&&c._invalidate(c)}}i.zpp_inner.weak=!1,this.wrap_a1=i,this.wrap_a1.zpp_inner._inuse=!0,this.wrap_a1.zpp_inner._validate=p(this,this.validate_a1),this.wrap_a1.zpp_inner._invalidate=p(this,this.invalidate_a1)},t.constraint.ZPP_WeldJoint.prototype.wrap_a1=null,t.constraint.ZPP_WeldJoint.prototype.b2=null,t.constraint.ZPP_WeldJoint.prototype.a2localx=null,t.constraint.ZPP_WeldJoint.prototype.a2localy=null,t.constraint.ZPP_WeldJoint.prototype.a2relx=null,t.constraint.ZPP_WeldJoint.prototype.a2rely=null,t.constraint.ZPP_WeldJoint.prototype.validate_a2=function(){this.wrap_a2.zpp_inner.x=this.a2localx,this.wrap_a2.zpp_inner.y=this.a2localy},t.constraint.ZPP_WeldJoint.prototype.invalidate_a2=function(e){this.immutable_midstep("Constraint::a2"),this.a2localx=e.x,this.a2localy=e.y,this.wake()},t.constraint.ZPP_WeldJoint.prototype.setup_a2=function(){var i,r=this.a2localx,o=this.a2localy;if(null==o&&(o=0),null==r&&(r=0),r!=r||o!=o)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null==t.util.ZPP_PubPool.poolVec2?i=new e.geom.Vec2:(i=t.util.ZPP_PubPool.poolVec2,t.util.ZPP_PubPool.poolVec2=i.zpp_pool,i.zpp_pool=null,i.zpp_disp=!1,i==t.util.ZPP_PubPool.nextVec2&&(t.util.ZPP_PubPool.nextVec2=null)),null==i.zpp_inner){var a;null==t.geom.ZPP_Vec2.zpp_pool?a=new t.geom.ZPP_Vec2:(a=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=a.next,a.next=null),a.weak=!1,a._immutable=!1,a.x=r,a.y=o,i.zpp_inner=a,i.zpp_inner.outer=i}else{if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var s,l=i.zpp_inner;if(l._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=l._isimmutable&&l._isimmutable(),r!=r||o!=o)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var u=i.zpp_inner;if(null!=u._validate&&u._validate(),i.zpp_inner.x==r){if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var h=i.zpp_inner;null!=h._validate&&h._validate(),s=i.zpp_inner.y==o}else s=!1;if(!s){i.zpp_inner.x=r,i.zpp_inner.y=o;var c=i.zpp_inner;null!=c._invalidate&&c._invalidate(c)}}i.zpp_inner.weak=!1,this.wrap_a2=i,this.wrap_a2.zpp_inner._inuse=!0,this.wrap_a2.zpp_inner._validate=p(this,this.validate_a2),this.wrap_a2.zpp_inner._invalidate=p(this,this.invalidate_a2)},t.constraint.ZPP_WeldJoint.prototype.wrap_a2=null,t.constraint.ZPP_WeldJoint.prototype.phase=null,t.constraint.ZPP_WeldJoint.prototype.kMassa=null,t.constraint.ZPP_WeldJoint.prototype.kMassb=null,t.constraint.ZPP_WeldJoint.prototype.kMassd=null,t.constraint.ZPP_WeldJoint.prototype.kMassc=null,t.constraint.ZPP_WeldJoint.prototype.kMasse=null,t.constraint.ZPP_WeldJoint.prototype.kMassf=null,t.constraint.ZPP_WeldJoint.prototype.jAccx=null,t.constraint.ZPP_WeldJoint.prototype.jAccy=null,t.constraint.ZPP_WeldJoint.prototype.jAccz=null,t.constraint.ZPP_WeldJoint.prototype.jMax=null,t.constraint.ZPP_WeldJoint.prototype.gamma=null,t.constraint.ZPP_WeldJoint.prototype.biasx=null,t.constraint.ZPP_WeldJoint.prototype.biasy=null,t.constraint.ZPP_WeldJoint.prototype.biasz=null,t.constraint.ZPP_WeldJoint.prototype.stepped=null,t.constraint.ZPP_WeldJoint.prototype.copy=function(n,i){var r=this.outer_zn;null==r.zpp_inner_zn.wrap_a1&&r.zpp_inner_zn.setup_a1();var o=r.zpp_inner_zn.wrap_a1,a=this.outer_zn;null==a.zpp_inner_zn.wrap_a2&&a.zpp_inner_zn.setup_a2();var s=new e.constraint.WeldJoint(null,null,o,a.zpp_inner_zn.wrap_a2);if(this.copyto(s),null!=n&&null!=this.b1){for(var l=null,p=0;p<n.length;){var u=n[p];if(++p,u.id==this.b1.id){l=u.bc;break}}null!=l?s.zpp_inner_zn.b1=l.zpp_inner:i.push(t.constraint.ZPP_CopyHelper.todo(this.b1.id,(function(e){s.zpp_inner_zn.b1=e.zpp_inner})))}if(null!=n&&null!=this.b2){for(var h=null,c=0;c<n.length;){var _=n[c];if(++c,_.id==this.b2.id){h=_.bc;break}}null!=h?s.zpp_inner_zn.b2=h.zpp_inner:i.push(t.constraint.ZPP_CopyHelper.todo(this.b2.id,(function(e){s.zpp_inner_zn.b2=e.zpp_inner})))}return s},t.constraint.ZPP_WeldJoint.prototype.validate=function(){if(null==this.b1||null==this.b2)throw new n._Boot.HaxeError("Error: AngleJoint cannot be simulated null bodies");if(this.b1==this.b2)throw new n._Boot.HaxeError("Error: WeldJoint cannot be simulated with body1 == body2");if(this.b1.space!=this.space||this.b2.space!=this.space)throw new n._Boot.HaxeError("Error: Constraints must have each body within the same space to which the constraint has been assigned");if(2!=this.b1.type&&2!=this.b2.type)throw new n._Boot.HaxeError("Error: Constraints cannot have both bodies non-dynamic")},t.constraint.ZPP_WeldJoint.prototype.wake_connected=function(){null!=this.b1&&2==this.b1.type&&this.b1.wake(),null!=this.b2&&2==this.b2.type&&this.b2.wake()},t.constraint.ZPP_WeldJoint.prototype.forest=function(){if(2==this.b1.type){var e,t;if(this.b1.component==this.b1.component.parent)e=this.b1.component;else{for(var n=this.b1.component,i=null;n!=n.parent;){var r=n.parent;n.parent=i,i=n,n=r}for(;null!=i;){var o=i.parent;i.parent=n,i=o}e=n}if(this.component==this.component.parent)t=this.component;else{for(var a=this.component,s=null;a!=a.parent;){var l=a.parent;a.parent=s,s=a,a=l}for(;null!=s;){var p=s.parent;s.parent=a,s=p}t=a}e!=t&&(e.rank<t.rank?e.parent=t:e.rank>t.rank?t.parent=e:(t.parent=e,e.rank++))}if(2==this.b2.type){var u,h;if(this.b2.component==this.b2.component.parent)u=this.b2.component;else{for(var c=this.b2.component,_=null;c!=c.parent;){var d=c.parent;c.parent=_,_=c,c=d}for(;null!=_;){var m=_.parent;_.parent=c,_=m}u=c}if(this.component==this.component.parent)h=this.component;else{for(var P=this.component,f=null;P!=P.parent;){var x=P.parent;P.parent=f,f=P,P=x}for(;null!=f;){var y=f.parent;f.parent=P,f=y}h=P}u!=h&&(u.rank<h.rank?u.parent=h:u.rank>h.rank?h.parent=u:(h.parent=u,u.rank++))}},t.constraint.ZPP_WeldJoint.prototype.pair_exists=function(e,t){return this.b1.id==e&&this.b2.id==t||this.b1.id==t&&this.b2.id==e},t.constraint.ZPP_WeldJoint.prototype.clearcache=function(){this.jAccx=0,this.jAccy=0,this.jAccz=0,this.pre_dt=-1},t.constraint.ZPP_WeldJoint.prototype.preStep=function(e){-1==this.pre_dt&&(this.pre_dt=e);var t=e/this.pre_dt;this.pre_dt=e,this.stepped=!0,this.a1relx=this.b1.axisy*this.a1localx-this.b1.axisx*this.a1localy,this.a1rely=this.a1localx*this.b1.axisx+this.a1localy*this.b1.axisy,this.a2relx=this.b2.axisy*this.a2localx-this.b2.axisx*this.a2localy,this.a2rely=this.a2localx*this.b2.axisx+this.a2localy*this.b2.axisy;var n=this.b1.smass+this.b2.smass;if(this.kMassa=n,this.kMassb=0,this.kMassd=n,this.kMassc=0,this.kMasse=0,this.kMassf=0,0!=this.b1.sinertia){var i=this.a1relx*this.b1.sinertia,r=this.a1rely*this.b1.sinertia;this.kMassa+=r*this.a1rely,this.kMassb+=-r*this.a1relx,this.kMassd+=i*this.a1relx,this.kMassc+=-r,this.kMasse+=i,this.kMassf+=this.b1.sinertia}if(0!=this.b2.sinertia){var o=this.a2relx*this.b2.sinertia,a=this.a2rely*this.b2.sinertia;this.kMassa+=a*this.a2rely,this.kMassb+=-a*this.a2relx,this.kMassd+=o*this.a2relx,this.kMassc+=-a,this.kMasse+=o,this.kMassf+=this.b2.sinertia}var s,l=this.kMassa*(this.kMassd*this.kMassf-this.kMasse*this.kMasse)+this.kMassb*(this.kMassc*this.kMasse-this.kMassb*this.kMassf)+this.kMassc*(this.kMassb*this.kMasse-this.kMassc*this.kMassd);if(l!=l)this.kMassa=0,this.kMassb=0,this.kMassd=0,this.kMassc=0,this.kMasse=0,this.kMassf=0,s=7;else if(0==l){var p=0;0!=this.kMassa?this.kMassa=1/this.kMassa:(this.kMassa=0,p|=1),0!=this.kMassd?this.kMassd=1/this.kMassd:(this.kMassd=0,p|=2),0!=this.kMassf?this.kMassf=1/this.kMassf:(this.kMassf=0,p|=4),this.kMassb=this.kMassc=this.kMasse=0,s=p}else{var u=(l=1/l)*(this.kMassd*this.kMassf-this.kMasse*this.kMasse),h=l*(this.kMasse*this.kMassc-this.kMassb*this.kMassf),c=l*(this.kMassa*this.kMassf-this.kMassc*this.kMassc),_=l*(this.kMassb*this.kMasse-this.kMassc*this.kMassd),d=l*(this.kMassb*this.kMassc-this.kMassa*this.kMasse),m=l*(this.kMassa*this.kMassd-this.kMassb*this.kMassb);this.kMassa=u,this.kMassb=h,this.kMassd=c,this.kMassc=_,this.kMasse=d,this.kMassf=m,s=0}if(0!=(1&s)&&(this.jAccx=0),0!=(2&s)&&(this.jAccy=0),0!=(4&s)&&(this.jAccz=0),this.stiff)this.biasx=0,this.biasy=0,this.biasz=0,this.gamma=0;else{var P,f=2*Math.PI*this.frequency;this.gamma=1/(e*f*(2*this.damping+f*e));var x=1/(1+this.gamma);P=e*f*f*this.gamma,this.gamma*=x;var y=x;if(this.kMassa*=y,this.kMassb*=y,this.kMassd*=y,this.kMassc*=y,this.kMasse*=y,this.kMassf*=y,this.biasx=this.b2.posx+this.a2relx-(this.b1.posx+this.a1relx),this.biasy=this.b2.posy+this.a2rely-(this.b1.posy+this.a1rely),this.biasz=this.b2.rot-this.b1.rot-this.phase,this.breakUnderError&&this.biasx*this.biasx+this.biasy*this.biasy+this.biasz*this.biasz>this.maxError*this.maxError)return!0;var v=-P,g=v;this.biasx*=g,this.biasy*=g,this.biasz*=v;var b=this.maxError,z=this.biasx*this.biasx+this.biasy*this.biasy+this.biasz*this.biasz;if(z>b*b){var w=b*(1/Math.sqrt(z)),Z=w;this.biasx*=Z,this.biasy*=Z,this.biasz*=w}}var E=t,M=E;return this.jAccx*=M,this.jAccy*=M,this.jAccz*=E,this.jMax=this.maxForce*e,!1},t.constraint.ZPP_WeldJoint.prototype.warmStart=function(){var e=this.b1.imass;this.b1.velx-=this.jAccx*e,this.b1.vely-=this.jAccy*e;var t=this.b2.imass;this.b2.velx+=this.jAccx*t,this.b2.vely+=this.jAccy*t,this.b1.angvel-=(this.jAccy*this.a1relx-this.jAccx*this.a1rely+this.jAccz)*this.b1.iinertia,this.b2.angvel+=(this.jAccy*this.a2relx-this.jAccx*this.a2rely+this.jAccz)*this.b2.iinertia},t.constraint.ZPP_WeldJoint.prototype.applyImpulseVel=function(){var e,t,n;e=this.b2.velx+this.b2.kinvelx-this.a2rely*(this.b2.angvel+this.b2.kinangvel)-(this.b1.velx+this.b1.kinvelx-this.a1rely*(this.b1.angvel+this.b1.kinangvel)),t=this.b2.vely+this.b2.kinvely+this.a2relx*(this.b2.angvel+this.b2.kinangvel)-(this.b1.vely+this.b1.kinvely+this.a1relx*(this.b1.angvel+this.b1.kinangvel)),n=this.b2.angvel+this.b2.kinangvel-this.b1.angvel-this.b1.kinangvel;var i=0,r=0,o=0;i=this.biasx-e,r=this.biasy-t,o=this.biasz-n;var a=this.kMassa*i+this.kMassb*r+this.kMassc*o,s=this.kMassb*i+this.kMassd*r+this.kMasse*o;o=this.kMassc*i+this.kMasse*r+this.kMassf*o,i=a,r=s;var l,p,u,h=this.gamma,c=h;if(i-=this.jAccx*c,r-=this.jAccy*c,o-=this.jAccz*h,l=this.jAccx,p=this.jAccy,u=this.jAccz,this.jAccx+=1*i,this.jAccy+=1*r,this.jAccz+=1*o,this.breakUnderForce){if(this.jAccx*this.jAccx+this.jAccy*this.jAccy+this.jAccz*this.jAccz>this.jMax*this.jMax)return!0}else if(!this.stiff){var _=this.jMax,d=this.jAccx*this.jAccx+this.jAccy*this.jAccy+this.jAccz*this.jAccz;if(d>_*_){var m=_*(1/Math.sqrt(d)),P=m;this.jAccx*=P,this.jAccy*=P,this.jAccz*=m}}i=this.jAccx-l,r=this.jAccy-p,o=this.jAccz-u;var f=this.b1.imass;this.b1.velx-=i*f,this.b1.vely-=r*f;var x=this.b2.imass;return this.b2.velx+=i*x,this.b2.vely+=r*x,this.b1.angvel-=(r*this.a1relx-i*this.a1rely+o)*this.b1.iinertia,this.b2.angvel+=(r*this.a2relx-i*this.a2rely+o)*this.b2.iinertia,!1},t.constraint.ZPP_WeldJoint.prototype.applyImpulsePos=function(){var t,n,i,r;t=this.b1.axisy*this.a1localx-this.b1.axisx*this.a1localy,n=this.a1localx*this.b1.axisx+this.a1localy*this.b1.axisy,i=this.b2.axisy*this.a2localx-this.b2.axisx*this.a2localy,r=this.a2localx*this.b2.axisx+this.a2localy*this.b2.axisy;var o=0,a=0,s=0;o=this.b2.posx+i-(this.b1.posx+t),a=this.b2.posy+r-(this.b1.posy+n),s=this.b2.rot-this.b1.rot-this.phase;var l=0,p=0,u=0;if(this.breakUnderError&&o*o+a*a+s*s>this.maxError*this.maxError)return!0;var h=!0;o*o+a*a<e.Config.constraintLinearSlop*e.Config.constraintLinearSlop&&(h=!1,o=0,a=0);var c=e.Config.constraintAngularSlop;if(s*s<c*c){if(!h)return!1;s=0}if(s*=.5,(o*=.5)*o+(a*=.5)*a>6){var _=this.b1.smass+this.b2.smass;if(_>e.Config.epsilon){var d=(l=-o*(_=.75/_))*l+(p=-a*_)*p;if(d>400){var m=1/Math.sqrt(d)*20;l*=m,p*=m}var P=this.b1.imass;this.b1.posx-=l*P,this.b1.posy-=p*P;var f=this.b2.imass;this.b2.posx+=l*f,this.b2.posy+=p*f,o=this.b2.posx+i-(this.b1.posx+t),a=this.b2.posy+r-(this.b1.posy+n),s=this.b2.rot-this.b1.rot-this.phase,o*=.5,a*=.5,s*=.5}}var x=0,y=0,v=0,g=0,b=0,z=0,w=this.b1.smass+this.b2.smass;if(x=w,y=0,v=w,g=0,b=0,z=0,0!=this.b1.sinertia){var Z=t*this.b1.sinertia,E=n*this.b1.sinertia;x+=E*n,y+=-E*t,v+=Z*t,g+=-E,b+=Z,z+=this.b1.sinertia}if(0!=this.b2.sinertia){var M=i*this.b2.sinertia,S=r*this.b2.sinertia;x+=S*r,y+=-S*i,v+=M*i,g+=-S,b+=M,z+=this.b2.sinertia}u=-s;var C=(l=-o)*l+(p=-a)*p;if(C>36){var N=1/Math.sqrt(C)*6;l*=N,p*=N}var A=x*(v*z-b*b)+y*(g*b-y*z)+g*(y*b-g*v);if(A!=A)l=p=u=0;else if(0==A)0!=x?l/=x:l=0,0!=v?p/=v:p=0,0!=z?u/=z:u=0;else{var L=b*g-y*z,B=y*b-g*v,T=y*g-x*b,V=(A=1/A)*(l*(v*z-b*b)+p*L+u*B),k=A*(l*L+p*(x*z-g*g)+u*T);u=A*(l*B+p*T+u*(x*v-y*y)),l=V,p=k}var I=this.b1.imass;this.b1.posx-=l*I,this.b1.posy-=p*I;var O=this.b2.imass;this.b2.posx+=l*O,this.b2.posy+=p*O;var R=this.b1,H=-(p*t-l*n+u)*this.b1.iinertia;if(R.rot+=H,H*H>1e-4)R.axisx=Math.sin(R.rot),R.axisy=Math.cos(R.rot);else{var F=H*H,D=1-.5*F,G=1-F*F/8,U=(D*R.axisx+H*R.axisy)*G;R.axisy=(D*R.axisy-H*R.axisx)*G,R.axisx=U}var j=this.b2,W=(p*i-l*r+u)*this.b2.iinertia;if(j.rot+=W,W*W>1e-4)j.axisx=Math.sin(j.rot),j.axisy=Math.cos(j.rot);else{var q=W*W,J=1-.5*q,$=1-q*q/8,X=(J*j.axisx+W*j.axisy)*$;j.axisy=(J*j.axisy-W*j.axisx)*$,j.axisx=X}return!1},t.constraint.ZPP_WeldJoint.prototype.draw=function(e){},t.constraint.ZPP_WeldJoint.prototype.__class__=t.constraint.ZPP_WeldJoint,t.dynamics||(t.dynamics={}),t.dynamics.ZPP_Arbiter=l["zpp_nape.dynamics.ZPP_Arbiter"]=function(){this.sensorarb=null,this.fluidarb=null,this.colarb=null,this.type=0,this.pair=null,this.ws2=null,this.ws1=null,this.b2=null,this.b1=null,this.invalidated=!1,this.immState=0,this.fresh=!1,this.continuous=!1,this.presentable=!1,this.intchange=!1,this.present=0,this.sleeping=!1,this.cleared=!1,this.active=!1,this.endGenerated=0,this.sleep_stamp=0,this.up_stamp=0,this.stamp=0,this.di=0,this.id=0,this.hnext=null,this.outer=null},t.dynamics.ZPP_Arbiter.__name__=["zpp_nape","dynamics","ZPP_Arbiter"],t.dynamics.ZPP_Arbiter.prototype.outer=null,t.dynamics.ZPP_Arbiter.prototype.wrapper=function(){return null==this.outer&&(t.dynamics.ZPP_Arbiter.internal=!0,this.type==t.dynamics.ZPP_Arbiter.COL?(this.colarb.outer_zn=new e.dynamics.CollisionArbiter,this.outer=this.colarb.outer_zn):this.type==t.dynamics.ZPP_Arbiter.FLUID?(this.fluidarb.outer_zn=new e.dynamics.FluidArbiter,this.outer=this.fluidarb.outer_zn):this.outer=new e.dynamics.Arbiter,this.outer.zpp_inner=this,t.dynamics.ZPP_Arbiter.internal=!1),this.outer},t.dynamics.ZPP_Arbiter.prototype.inactiveme=function(){return!this.active},t.dynamics.ZPP_Arbiter.prototype.hnext=null,t.dynamics.ZPP_Arbiter.prototype.id=null,t.dynamics.ZPP_Arbiter.prototype.di=null,t.dynamics.ZPP_Arbiter.prototype.stamp=null,t.dynamics.ZPP_Arbiter.prototype.up_stamp=null,t.dynamics.ZPP_Arbiter.prototype.sleep_stamp=null,t.dynamics.ZPP_Arbiter.prototype.endGenerated=null,t.dynamics.ZPP_Arbiter.prototype.active=null,t.dynamics.ZPP_Arbiter.prototype.cleared=null,t.dynamics.ZPP_Arbiter.prototype.sleeping=null,t.dynamics.ZPP_Arbiter.prototype.present=null,t.dynamics.ZPP_Arbiter.prototype.intchange=null,t.dynamics.ZPP_Arbiter.prototype.presentable=null,t.dynamics.ZPP_Arbiter.prototype.continuous=null,t.dynamics.ZPP_Arbiter.prototype.fresh=null,t.dynamics.ZPP_Arbiter.prototype.immState=null,t.dynamics.ZPP_Arbiter.prototype.acting=function(){return!!this.active&&0!=(1&this.immState)},t.dynamics.ZPP_Arbiter.prototype.invalidated=null,t.dynamics.ZPP_Arbiter.prototype.b1=null,t.dynamics.ZPP_Arbiter.prototype.b2=null,t.dynamics.ZPP_Arbiter.prototype.ws1=null,t.dynamics.ZPP_Arbiter.prototype.ws2=null,t.dynamics.ZPP_Arbiter.prototype.pair=null,t.dynamics.ZPP_Arbiter.prototype.swap_features=function(){var e=this.b1;this.b1=this.b2,this.b2=e;var t=this.ws1;this.ws1=this.ws2,this.ws2=t;var n=this.colarb.s1;this.colarb.s1=this.colarb.s2,this.colarb.s2=n},t.dynamics.ZPP_Arbiter.prototype.type=null,t.dynamics.ZPP_Arbiter.prototype.colarb=null,t.dynamics.ZPP_Arbiter.prototype.fluidarb=null,t.dynamics.ZPP_Arbiter.prototype.sensorarb=null,t.dynamics.ZPP_Arbiter.prototype.lazyRetire=function(e,n){if(this.cleared=!0,null==n||this.b2==n)for(var i=this.b1.arbiters,r=null,o=i.head;null!=o;){if(o.elt==this){var a,s;null==r?(s=(a=i.head).next,i.head=s,null==i.head&&(i.pushmod=!0)):(s=(a=r.next).next,r.next=s,null==s&&(i.pushmod=!0));var l=a;l.elt=null,l.next=t.util.ZNPNode_ZPP_Arbiter.zpp_pool,t.util.ZNPNode_ZPP_Arbiter.zpp_pool=l,i.modified=!0,i.length--,i.pushmod=!0;break}r=o,o=o.next}if(null==n||this.b1==n)for(var p=this.b2.arbiters,u=null,h=p.head;null!=h;){if(h.elt==this){var c,_;null==u?(_=(c=p.head).next,p.head=_,null==p.head&&(p.pushmod=!0)):(_=(c=u.next).next,u.next=_,null==_&&(p.pushmod=!0));var d=c;d.elt=null,d.next=t.util.ZNPNode_ZPP_Arbiter.zpp_pool,t.util.ZNPNode_ZPP_Arbiter.zpp_pool=d,p.modified=!0,p.length--,p.pushmod=!0;break}u=h,h=h.next}null!=this.pair&&(this.pair.arb=null,this.pair=null),this.active=!1,e.f_arbiters.modified=!0},t.dynamics.ZPP_Arbiter.prototype.sup_assign=function(e,n,i,r){this.b1=e.body,this.ws1=e,this.b2=n.body,this.ws2=n,this.id=i,this.di=r;var o,a=this.b1.arbiters;null==t.util.ZNPNode_ZPP_Arbiter.zpp_pool?o=new t.util.ZNPNode_ZPP_Arbiter:(o=t.util.ZNPNode_ZPP_Arbiter.zpp_pool,t.util.ZNPNode_ZPP_Arbiter.zpp_pool=o.next,o.next=null),o.elt=this;var s=o;s.next=a.head,a.head=s,a.modified=!0,a.length++;var l,p=this.b2.arbiters;null==t.util.ZNPNode_ZPP_Arbiter.zpp_pool?l=new t.util.ZNPNode_ZPP_Arbiter:(l=t.util.ZNPNode_ZPP_Arbiter.zpp_pool,t.util.ZNPNode_ZPP_Arbiter.zpp_pool=l.next,l.next=null),l.elt=this;var u=l;u.next=p.head,p.head=u,p.modified=!0,p.length++,this.active=!0,this.present=0,this.cleared=!1,this.sleeping=!1,this.fresh=!1,this.presentable=!1},t.dynamics.ZPP_Arbiter.prototype.sup_retire=function(){if(!this.cleared){for(var e=this.b1.arbiters,n=null,i=e.head;null!=i;){if(i.elt==this){var r,o;null==n?(o=(r=e.head).next,e.head=o,null==e.head&&(e.pushmod=!0)):(o=(r=n.next).next,n.next=o,null==o&&(e.pushmod=!0));var a=r;a.elt=null,a.next=t.util.ZNPNode_ZPP_Arbiter.zpp_pool,t.util.ZNPNode_ZPP_Arbiter.zpp_pool=a,e.modified=!0,e.length--,e.pushmod=!0;break}n=i,i=i.next}for(var s=this.b2.arbiters,l=null,p=s.head;null!=p;){if(p.elt==this){var u,h;null==l?(h=(u=s.head).next,s.head=h,null==s.head&&(s.pushmod=!0)):(h=(u=l.next).next,l.next=h,null==h&&(s.pushmod=!0));var c=u;c.elt=null,c.next=t.util.ZNPNode_ZPP_Arbiter.zpp_pool,t.util.ZNPNode_ZPP_Arbiter.zpp_pool=c,s.modified=!0,s.length--,s.pushmod=!0;break}l=p,p=p.next}null!=this.pair&&(this.pair.arb=null,this.pair=null)}this.b1=this.b2=null,this.active=!1,this.intchange=!1},t.dynamics.ZPP_Arbiter.prototype.__class__=t.dynamics.ZPP_Arbiter,t.dynamics.ZPP_SensorArbiter=l["zpp_nape.dynamics.ZPP_SensorArbiter"]=function(){this.next=null,t.dynamics.ZPP_Arbiter.call(this),this.type=t.dynamics.ZPP_Arbiter.SENSOR,this.sensorarb=this},t.dynamics.ZPP_SensorArbiter.__name__=["zpp_nape","dynamics","ZPP_SensorArbiter"],t.dynamics.ZPP_SensorArbiter.__super__=t.dynamics.ZPP_Arbiter,t.dynamics.ZPP_Arbiter.prototype)t.dynamics.ZPP_SensorArbiter.prototype[u]=t.dynamics.ZPP_Arbiter.prototype[u];for(var u in t.dynamics.ZPP_SensorArbiter.prototype.next=null,t.dynamics.ZPP_SensorArbiter.prototype.alloc=function(){},t.dynamics.ZPP_SensorArbiter.prototype.free=function(){},t.dynamics.ZPP_SensorArbiter.prototype.assign=function(e,n,i,r){this.b1=e.body,this.ws1=e,this.b2=n.body,this.ws2=n,this.id=i,this.di=r;var o,a=this.b1.arbiters;null==t.util.ZNPNode_ZPP_Arbiter.zpp_pool?o=new t.util.ZNPNode_ZPP_Arbiter:(o=t.util.ZNPNode_ZPP_Arbiter.zpp_pool,t.util.ZNPNode_ZPP_Arbiter.zpp_pool=o.next,o.next=null),o.elt=this;var s=o;s.next=a.head,a.head=s,a.modified=!0,a.length++;var l,p=this.b2.arbiters;null==t.util.ZNPNode_ZPP_Arbiter.zpp_pool?l=new t.util.ZNPNode_ZPP_Arbiter:(l=t.util.ZNPNode_ZPP_Arbiter.zpp_pool,t.util.ZNPNode_ZPP_Arbiter.zpp_pool=l.next,l.next=null),l.elt=this;var u=l;u.next=p.head,p.head=u,p.modified=!0,p.length++,this.active=!0,this.present=0,this.cleared=!1,this.sleeping=!1,this.fresh=!1,this.presentable=!1},t.dynamics.ZPP_SensorArbiter.prototype.retire=function(){if(!this.cleared){for(var e=this.b1.arbiters,n=null,i=e.head;null!=i;){if(i.elt==this){var r,o;null==n?(o=(r=e.head).next,e.head=o,null==e.head&&(e.pushmod=!0)):(o=(r=n.next).next,n.next=o,null==o&&(e.pushmod=!0));var a=r;a.elt=null,a.next=t.util.ZNPNode_ZPP_Arbiter.zpp_pool,t.util.ZNPNode_ZPP_Arbiter.zpp_pool=a,e.modified=!0,e.length--,e.pushmod=!0;break}n=i,i=i.next}for(var s=this.b2.arbiters,l=null,p=s.head;null!=p;){if(p.elt==this){var u,h;null==l?(h=(u=s.head).next,s.head=h,null==s.head&&(s.pushmod=!0)):(h=(u=l.next).next,l.next=h,null==h&&(s.pushmod=!0));var c=u;c.elt=null,c.next=t.util.ZNPNode_ZPP_Arbiter.zpp_pool,t.util.ZNPNode_ZPP_Arbiter.zpp_pool=c,s.modified=!0,s.length--,s.pushmod=!0;break}l=p,p=p.next}null!=this.pair&&(this.pair.arb=null,this.pair=null)}this.b1=this.b2=null,this.active=!1,this.intchange=!1,this.next=t.dynamics.ZPP_SensorArbiter.zpp_pool,t.dynamics.ZPP_SensorArbiter.zpp_pool=this},t.dynamics.ZPP_SensorArbiter.prototype.makemutable=function(){},t.dynamics.ZPP_SensorArbiter.prototype.makeimmutable=function(){},t.dynamics.ZPP_SensorArbiter.prototype.__class__=t.dynamics.ZPP_SensorArbiter,t.dynamics.ZPP_FluidArbiter=l["zpp_nape.dynamics.ZPP_FluidArbiter"]=function(){this.pre_dt=0,this.mutable=!1,this.wrap_position=null,this.buoyy=0,this.buoyx=0,this.ny=0,this.nx=0,this.lgamma=0,this.dampy=0,this.dampx=0,this.vMassc=0,this.vMassb=0,this.vMassa=0,this.agamma=0,this.adamp=0,this.wMass=0,this.nodrag=!1,this.r2y=0,this.r2x=0,this.r1y=0,this.r1x=0,this.overlap=0,this.centroidy=0,this.centroidx=0,this.next=null,this.outer_zn=null,t.dynamics.ZPP_Arbiter.call(this),this.type=t.dynamics.ZPP_Arbiter.FLUID,this.fluidarb=this,this.buoyx=0,this.buoyy=0,this.pre_dt=-1},t.dynamics.ZPP_FluidArbiter.__name__=["zpp_nape","dynamics","ZPP_FluidArbiter"],t.dynamics.ZPP_FluidArbiter.__super__=t.dynamics.ZPP_Arbiter,t.dynamics.ZPP_Arbiter.prototype)t.dynamics.ZPP_FluidArbiter.prototype[u]=t.dynamics.ZPP_Arbiter.prototype[u];for(var u in t.dynamics.ZPP_FluidArbiter.prototype.outer_zn=null,t.dynamics.ZPP_FluidArbiter.prototype.next=null,t.dynamics.ZPP_FluidArbiter.prototype.alloc=function(){},t.dynamics.ZPP_FluidArbiter.prototype.free=function(){},t.dynamics.ZPP_FluidArbiter.prototype.centroidx=null,t.dynamics.ZPP_FluidArbiter.prototype.centroidy=null,t.dynamics.ZPP_FluidArbiter.prototype.overlap=null,t.dynamics.ZPP_FluidArbiter.prototype.r1x=null,t.dynamics.ZPP_FluidArbiter.prototype.r1y=null,t.dynamics.ZPP_FluidArbiter.prototype.r2x=null,t.dynamics.ZPP_FluidArbiter.prototype.r2y=null,t.dynamics.ZPP_FluidArbiter.prototype.nodrag=null,t.dynamics.ZPP_FluidArbiter.prototype.wMass=null,t.dynamics.ZPP_FluidArbiter.prototype.adamp=null,t.dynamics.ZPP_FluidArbiter.prototype.agamma=null,t.dynamics.ZPP_FluidArbiter.prototype.vMassa=null,t.dynamics.ZPP_FluidArbiter.prototype.vMassb=null,t.dynamics.ZPP_FluidArbiter.prototype.vMassc=null,t.dynamics.ZPP_FluidArbiter.prototype.dampx=null,t.dynamics.ZPP_FluidArbiter.prototype.dampy=null,t.dynamics.ZPP_FluidArbiter.prototype.lgamma=null,t.dynamics.ZPP_FluidArbiter.prototype.nx=null,t.dynamics.ZPP_FluidArbiter.prototype.ny=null,t.dynamics.ZPP_FluidArbiter.prototype.buoyx=null,t.dynamics.ZPP_FluidArbiter.prototype.buoyy=null,t.dynamics.ZPP_FluidArbiter.prototype.position_validate=function(){if(!this.active)throw new n._Boot.HaxeError("Error: Arbiter not currently in use");this.wrap_position.zpp_inner.x=this.centroidx,this.wrap_position.zpp_inner.y=this.centroidy},t.dynamics.ZPP_FluidArbiter.prototype.position_invalidate=function(e){this.centroidx=e.x,this.centroidy=e.y},t.dynamics.ZPP_FluidArbiter.prototype.wrap_position=null,t.dynamics.ZPP_FluidArbiter.prototype.getposition=function(){var i;if(null==t.util.ZPP_PubPool.poolVec2?i=new e.geom.Vec2:(i=t.util.ZPP_PubPool.poolVec2,t.util.ZPP_PubPool.poolVec2=i.zpp_pool,i.zpp_pool=null,i.zpp_disp=!1,i==t.util.ZPP_PubPool.nextVec2&&(t.util.ZPP_PubPool.nextVec2=null)),null==i.zpp_inner){var r;null==t.geom.ZPP_Vec2.zpp_pool?r=new t.geom.ZPP_Vec2:(r=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=r.next,r.next=null),r.weak=!1,r._immutable=!1,r.x=0,r.y=0,i.zpp_inner=r,i.zpp_inner.outer=i}else{if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var o,a=i.zpp_inner;if(a._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=a._isimmutable&&a._isimmutable(),null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var s=i.zpp_inner;if(null!=s._validate&&s._validate(),0==i.zpp_inner.x){if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var l=i.zpp_inner;null!=l._validate&&l._validate(),o=0==i.zpp_inner.y}else o=!1;if(!o){i.zpp_inner.x=0,i.zpp_inner.y=0;var u=i.zpp_inner;null!=u._invalidate&&u._invalidate(u)}}i.zpp_inner.weak=!1,this.wrap_position=i,this.wrap_position.zpp_inner._inuse=!0,this.wrap_position.zpp_inner._immutable=!this.mutable,this.wrap_position.zpp_inner._validate=p(this,this.position_validate),this.wrap_position.zpp_inner._invalidate=p(this,this.position_invalidate)},t.dynamics.ZPP_FluidArbiter.prototype.assign=function(e,n,i,r){this.b1=e.body,this.ws1=e,this.b2=n.body,this.ws2=n,this.id=i,this.di=r;var o,a=this.b1.arbiters;null==t.util.ZNPNode_ZPP_Arbiter.zpp_pool?o=new t.util.ZNPNode_ZPP_Arbiter:(o=t.util.ZNPNode_ZPP_Arbiter.zpp_pool,t.util.ZNPNode_ZPP_Arbiter.zpp_pool=o.next,o.next=null),o.elt=this;var s=o;s.next=a.head,a.head=s,a.modified=!0,a.length++;var l,p=this.b2.arbiters;null==t.util.ZNPNode_ZPP_Arbiter.zpp_pool?l=new t.util.ZNPNode_ZPP_Arbiter:(l=t.util.ZNPNode_ZPP_Arbiter.zpp_pool,t.util.ZNPNode_ZPP_Arbiter.zpp_pool=l.next,l.next=null),l.elt=this;var u=l;u.next=p.head,p.head=u,p.modified=!0,p.length++,this.active=!0,this.present=0,this.cleared=!1,this.sleeping=!1,this.fresh=!1,this.presentable=!1,this.nx=0,this.ny=1,this.dampx=0,this.dampy=0,this.adamp=0},t.dynamics.ZPP_FluidArbiter.prototype.retire=function(){if(!this.cleared){for(var e=this.b1.arbiters,n=null,i=e.head;null!=i;){if(i.elt==this){var r,o;null==n?(o=(r=e.head).next,e.head=o,null==e.head&&(e.pushmod=!0)):(o=(r=n.next).next,n.next=o,null==o&&(e.pushmod=!0));var a=r;a.elt=null,a.next=t.util.ZNPNode_ZPP_Arbiter.zpp_pool,t.util.ZNPNode_ZPP_Arbiter.zpp_pool=a,e.modified=!0,e.length--,e.pushmod=!0;break}n=i,i=i.next}for(var s=this.b2.arbiters,l=null,p=s.head;null!=p;){if(p.elt==this){var u,h;null==l?(h=(u=s.head).next,s.head=h,null==s.head&&(s.pushmod=!0)):(h=(u=l.next).next,l.next=h,null==h&&(s.pushmod=!0));var c=u;c.elt=null,c.next=t.util.ZNPNode_ZPP_Arbiter.zpp_pool,t.util.ZNPNode_ZPP_Arbiter.zpp_pool=c,s.modified=!0,s.length--,s.pushmod=!0;break}l=p,p=p.next}null!=this.pair&&(this.pair.arb=null,this.pair=null)}this.b1=this.b2=null,this.active=!1,this.intchange=!1,this.next=t.dynamics.ZPP_FluidArbiter.zpp_pool,t.dynamics.ZPP_FluidArbiter.zpp_pool=this,this.pre_dt=-1},t.dynamics.ZPP_FluidArbiter.prototype.mutable=null,t.dynamics.ZPP_FluidArbiter.prototype.makemutable=function(){this.mutable=!0,null!=this.wrap_position&&(this.wrap_position.zpp_inner._immutable=!1)},t.dynamics.ZPP_FluidArbiter.prototype.makeimmutable=function(){this.mutable=!1,null!=this.wrap_position&&(this.wrap_position.zpp_inner._immutable=!0)},t.dynamics.ZPP_FluidArbiter.prototype.inject=function(e,t,n){this.overlap=e,this.centroidx=t,this.centroidy=n},t.dynamics.ZPP_FluidArbiter.prototype.pre_dt=null,t.dynamics.ZPP_FluidArbiter.prototype.preStep=function(t,n){-1==this.pre_dt&&(this.pre_dt=n);var i=n/this.pre_dt;this.pre_dt=n,this.r1x=this.centroidx-this.b1.posx,this.r1y=this.centroidy-this.b1.posy,this.r2x=this.centroidx-this.b2.posx,this.r2y=this.centroidy-this.b2.posy;var r=0,o=0;this.ws1.fluidEnabled&&null!=this.ws1.fluidProperties.wrap_gravity?(r=this.ws1.fluidProperties.gravityx,o=this.ws1.fluidProperties.gravityy):(r=t.gravityx,o=t.gravityy);var a=0,s=0;this.ws2.fluidEnabled&&null!=this.ws2.fluidProperties.wrap_gravity?(a=this.ws2.fluidProperties.gravityx,s=this.ws2.fluidProperties.gravityy):(a=t.gravityx,s=t.gravityy);var l=0,p=0;if(this.ws1.fluidEnabled&&this.ws2.fluidEnabled){var u=this.overlap*this.ws1.fluidProperties.density,h=this.overlap*this.ws2.fluidProperties.density;if(u>h){var c=u+h;l-=r*c,p-=o*c}else if(u<h){var _=u+h;l+=a*_,p+=s*_}else{var d=0,m=0;if(d=r+a,m=o+s,d*=.5,m*=.5,this.ws1.worldCOMx*d+this.ws1.worldCOMy*m>this.ws2.worldCOMx*d+this.ws2.worldCOMy*m){var P=u+h;l-=d*P,p-=m*P}else{var f=u+h;l+=d*f,p+=m*f}}}else if(this.ws1.fluidEnabled){var x=this.overlap*this.ws1.fluidProperties.density;l-=r*x,p-=o*x}else if(this.ws2.fluidEnabled){var y=this.overlap*this.ws2.fluidProperties.density;l+=a*y,p+=s*y}if(l*=n,p*=n,this.buoyx=l,this.buoyy=p,2==this.b1.type){var v=this.b1.imass;this.b1.velx-=l*v,this.b1.vely-=p*v,this.b1.angvel-=(p*this.r1x-l*this.r1y)*this.b1.iinertia}if(2==this.b2.type){var g=this.b2.imass;this.b2.velx+=l*g,this.b2.vely+=p*g,this.b2.angvel+=(p*this.r2x-l*this.r2y)*this.b2.iinertia}if(this.ws1.fluidEnabled&&0!=this.ws1.fluidProperties.viscosity||this.ws2.fluidEnabled&&0!=this.ws2.fluidProperties.viscosity){this.nodrag=!1;var b=0;if(this.ws1.fluidEnabled&&(this.ws2.validate_angDrag(),b+=this.ws1.fluidProperties.viscosity*this.ws2.angDrag*this.overlap/this.ws2.area),this.ws2.fluidEnabled&&(this.ws1.validate_angDrag(),b+=this.ws2.fluidProperties.viscosity*this.ws1.angDrag*this.overlap/this.ws1.area),0!=b){var z=this.b1.sinertia+this.b2.sinertia;this.wMass=0!=z?1/z:0,b*=4e-4;var w=2*Math.PI*b;this.agamma=1/(n*w*(2+w*n));var Z=1/(1+this.agamma);this.agamma,this.agamma*=Z,this.wMass*=Z}else this.wMass=0,this.agamma=0;var E=this.b2.velx+this.b2.kinvelx-this.r2y*(this.b2.angvel+this.b2.kinangvel)-(this.b1.velx+this.b1.kinvelx-this.r1y*(this.b2.angvel+this.b2.kinangvel)),M=this.b2.vely+this.b2.kinvely+this.r2x*(this.b2.angvel+this.b2.kinangvel)-(this.b1.vely+this.b1.kinvely+this.r1x*(this.b1.angvel+this.b1.kinangvel));if(!(E*E+M*M<e.Config.epsilon*e.Config.epsilon)){var S=E*E+M*M,C=1/Math.sqrt(S);E*=C,M*=C,this.nx=E,this.ny=M}var N=0;if(this.ws1.fluidEnabled){var A=-this.ws1.fluidProperties.viscosity*this.overlap/this.ws2.area;if(0==this.ws2.type)N-=A*this.ws2.circle.radius*e.Config.fluidLinearDrag/(2*this.ws2.circle.radius*Math.PI);else{for(var L=0,B=0,T=this.ws2.polygon.edges.head;null!=T;){var V=T.elt;L+=V.length;var k=A*V.length*(V.gnormx*this.nx+V.gnormy*this.ny);k>0&&(k=k*=-e.Config.fluidVacuumDrag),B-=.5*k*e.Config.fluidLinearDrag,T=T.next}N+=B/L}}if(this.ws2.fluidEnabled){var I=-this.ws2.fluidProperties.viscosity*this.overlap/this.ws1.area;if(0==this.ws1.type)N-=I*this.ws1.circle.radius*e.Config.fluidLinearDrag/(2*this.ws1.circle.radius*Math.PI);else{for(var O=0,R=0,H=this.ws1.polygon.edges.head;null!=H;){var F=H.elt;O+=F.length;var D=I*F.length*(F.gnormx*this.nx+F.gnormy*this.ny);D>0&&(D=D*=-e.Config.fluidVacuumDrag),R-=.5*D*e.Config.fluidLinearDrag,H=H.next}N+=R/O}}if(0!=N){var G=this.b1.smass+this.b2.smass,U=0,j=0,W=0;if(U=G,j=0,W=G,0!=this.b1.sinertia){var q=this.r1x*this.b1.sinertia,J=this.r1y*this.b1.sinertia;U+=J*this.r1y,j+=-J*this.r1x,W+=q*this.r1x}if(0!=this.b2.sinertia){var $=this.r2x*this.b2.sinertia,X=this.r2y*this.b2.sinertia;U+=X*this.r2y,j+=-X*this.r2x,W+=$*this.r2x}var Y=U*W-j*j;if(Y!=Y)U=j=W=0;else if(0==Y)0!=U?U=1/U:U=0,0!=W?W=1/W:W=0,j=0;else{var K=W*(Y=1/Y);W=U*Y,U=K,j*=-Y}this.vMassa=U,this.vMassb=j,this.vMassc=W;var Q=2*Math.PI*N;this.lgamma=1/(n*Q*(2+Q*n));var ee=1/(1+this.lgamma);this.lgamma,this.lgamma*=ee;var te=ee;this.vMassa*=te,this.vMassb*=te,this.vMassc*=te}else this.vMassa=0,this.vMassb=0,this.vMassc=0,this.lgamma=0}else this.nodrag=!0,this.dampx=0,this.dampy=0,this.adamp=0;var ne=i;this.dampx*=ne,this.dampy*=ne,this.adamp*=i},t.dynamics.ZPP_FluidArbiter.prototype.warmStart=function(){var e=this.b1.imass;this.b1.velx-=this.dampx*e,this.b1.vely-=this.dampy*e;var t=this.b2.imass;this.b2.velx+=this.dampx*t,this.b2.vely+=this.dampy*t,this.b1.angvel-=this.b1.iinertia*(this.dampy*this.r1x-this.dampx*this.r1y),this.b2.angvel+=this.b2.iinertia*(this.dampy*this.r2x-this.dampx*this.r2y),this.b1.angvel-=this.adamp*this.b1.iinertia,this.b2.angvel+=this.adamp*this.b2.iinertia},t.dynamics.ZPP_FluidArbiter.prototype.applyImpulseVel=function(){if(!this.nodrag){var e=this.b1.angvel+this.b1.kinangvel,t=this.b2.angvel+this.b2.kinangvel,n=this.b1.velx+this.b1.kinvelx-this.r1y*e-(this.b2.velx+this.b2.kinvelx-this.r2y*t),i=this.b1.vely+this.b1.kinvely+this.r1x*e-(this.b2.vely+this.b2.kinvely+this.r2x*t),r=this.vMassa*n+this.vMassb*i;i=this.vMassb*n+this.vMassc*i,n=r;var o=this.lgamma;n-=this.dampx*o,i-=this.dampy*o,this.dampx+=1*n,this.dampy+=1*i;var a=this.b1.imass;this.b1.velx-=n*a,this.b1.vely-=i*a;var s=this.b2.imass;this.b2.velx+=n*s,this.b2.vely+=i*s,this.b1.angvel-=this.b1.iinertia*(i*this.r1x-n*this.r1y),this.b2.angvel+=this.b2.iinertia*(i*this.r2x-n*this.r2y);var l=(e-t)*this.wMass-this.adamp*this.agamma;this.adamp+=l,this.b1.angvel-=l*this.b1.iinertia,this.b2.angvel+=l*this.b2.iinertia}},t.dynamics.ZPP_FluidArbiter.prototype.__class__=t.dynamics.ZPP_FluidArbiter,t.dynamics.ZPP_ColArbiter=l["zpp_nape.dynamics.ZPP_ColArbiter"]=function(){this.pre_dt=0,this.mutable=!1,this.stat=!1,this.next=null,this.hpc2=!1,this.hc2=!1,this.oc2=null,this.c2=null,this.oc1=null,this.c1=null,this.__ref_vertex=0,this.__ref_edge2=null,this.__ref_edge1=null,this.biasCoef=0,this.rev=!1,this.radius=0,this.lproj=0,this.lnormy=0,this.lnormx=0,this.surfacey=0,this.surfacex=0,this.k2y=0,this.k2x=0,this.k1y=0,this.k1x=0,this.rt2b=0,this.rn2b=0,this.rt2a=0,this.rn2a=0,this.rt1b=0,this.rn1b=0,this.rt1a=0,this.rn1a=0,this.jrAcc=0,this.rMass=0,this.Kc=0,this.Kb=0,this.Ka=0,this.kMassc=0,this.kMassb=0,this.kMassa=0,this.wrap_normal=null,this.ny=0,this.nx=0,this.innards=null,this.wrap_contacts=null,this.contacts=null,this.s2=null,this.s1=null,this.userdef_rfric=!1,this.userdef_restitution=!1,this.userdef_stat_fric=!1,this.userdef_dyn_fric=!1,this.rfric=0,this.restitution=0,this.stat_fric=0,this.dyn_fric=0,this.outer_zn=null,t.dynamics.ZPP_Arbiter.call(this),this.pre_dt=-1,this.contacts=new t.dynamics.ZPP_Contact,this.innards=new t.dynamics.ZPP_IContact,this.type=t.dynamics.ZPP_Arbiter.COL,this.colarb=this},t.dynamics.ZPP_ColArbiter.__name__=["zpp_nape","dynamics","ZPP_ColArbiter"],t.dynamics.ZPP_ColArbiter.__super__=t.dynamics.ZPP_Arbiter,t.dynamics.ZPP_Arbiter.prototype)t.dynamics.ZPP_ColArbiter.prototype[u]=t.dynamics.ZPP_Arbiter.prototype[u];for(var u in t.dynamics.ZPP_ColArbiter.prototype.outer_zn=null,t.dynamics.ZPP_ColArbiter.prototype.dyn_fric=null,t.dynamics.ZPP_ColArbiter.prototype.stat_fric=null,t.dynamics.ZPP_ColArbiter.prototype.restitution=null,t.dynamics.ZPP_ColArbiter.prototype.rfric=null,t.dynamics.ZPP_ColArbiter.prototype.userdef_dyn_fric=null,t.dynamics.ZPP_ColArbiter.prototype.userdef_stat_fric=null,t.dynamics.ZPP_ColArbiter.prototype.userdef_restitution=null,t.dynamics.ZPP_ColArbiter.prototype.userdef_rfric=null,t.dynamics.ZPP_ColArbiter.prototype.s1=null,t.dynamics.ZPP_ColArbiter.prototype.s2=null,t.dynamics.ZPP_ColArbiter.prototype.contacts=null,t.dynamics.ZPP_ColArbiter.prototype.wrap_contacts=null,t.dynamics.ZPP_ColArbiter.prototype.innards=null,t.dynamics.ZPP_ColArbiter.prototype.nx=null,t.dynamics.ZPP_ColArbiter.prototype.ny=null,t.dynamics.ZPP_ColArbiter.prototype.normal_validate=function(){if(this.cleared)throw new n._Boot.HaxeError("Error: Arbiter not currently in use");this.wrap_normal.zpp_inner.x=this.nx,this.wrap_normal.zpp_inner.y=this.ny,this.ws1.id>this.ws2.id&&(this.wrap_normal.zpp_inner.x=-this.wrap_normal.zpp_inner.x,this.wrap_normal.zpp_inner.y=-this.wrap_normal.zpp_inner.y)},t.dynamics.ZPP_ColArbiter.prototype.wrap_normal=null,t.dynamics.ZPP_ColArbiter.prototype.getnormal=function(){var i;if(null==t.util.ZPP_PubPool.poolVec2?i=new e.geom.Vec2:(i=t.util.ZPP_PubPool.poolVec2,t.util.ZPP_PubPool.poolVec2=i.zpp_pool,i.zpp_pool=null,i.zpp_disp=!1,i==t.util.ZPP_PubPool.nextVec2&&(t.util.ZPP_PubPool.nextVec2=null)),null==i.zpp_inner){var r;null==t.geom.ZPP_Vec2.zpp_pool?r=new t.geom.ZPP_Vec2:(r=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=r.next,r.next=null),r.weak=!1,r._immutable=!1,r.x=0,r.y=0,i.zpp_inner=r,i.zpp_inner.outer=i}else{if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var o,a=i.zpp_inner;if(a._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=a._isimmutable&&a._isimmutable(),null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var s=i.zpp_inner;if(null!=s._validate&&s._validate(),0==i.zpp_inner.x){if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var l=i.zpp_inner;null!=l._validate&&l._validate(),o=0==i.zpp_inner.y}else o=!1;if(!o){i.zpp_inner.x=0,i.zpp_inner.y=0;var u=i.zpp_inner;null!=u._invalidate&&u._invalidate(u)}}i.zpp_inner.weak=!1,this.wrap_normal=i,this.wrap_normal.zpp_inner._immutable=!0,this.wrap_normal.zpp_inner._inuse=!0,this.wrap_normal.zpp_inner._validate=p(this,this.normal_validate)},t.dynamics.ZPP_ColArbiter.prototype.kMassa=null,t.dynamics.ZPP_ColArbiter.prototype.kMassb=null,t.dynamics.ZPP_ColArbiter.prototype.kMassc=null,t.dynamics.ZPP_ColArbiter.prototype.Ka=null,t.dynamics.ZPP_ColArbiter.prototype.Kb=null,t.dynamics.ZPP_ColArbiter.prototype.Kc=null,t.dynamics.ZPP_ColArbiter.prototype.rMass=null,t.dynamics.ZPP_ColArbiter.prototype.jrAcc=null,t.dynamics.ZPP_ColArbiter.prototype.rn1a=null,t.dynamics.ZPP_ColArbiter.prototype.rt1a=null,t.dynamics.ZPP_ColArbiter.prototype.rn1b=null,t.dynamics.ZPP_ColArbiter.prototype.rt1b=null,t.dynamics.ZPP_ColArbiter.prototype.rn2a=null,t.dynamics.ZPP_ColArbiter.prototype.rt2a=null,t.dynamics.ZPP_ColArbiter.prototype.rn2b=null,t.dynamics.ZPP_ColArbiter.prototype.rt2b=null,t.dynamics.ZPP_ColArbiter.prototype.k1x=null,t.dynamics.ZPP_ColArbiter.prototype.k1y=null,t.dynamics.ZPP_ColArbiter.prototype.k2x=null,t.dynamics.ZPP_ColArbiter.prototype.k2y=null,t.dynamics.ZPP_ColArbiter.prototype.surfacex=null,t.dynamics.ZPP_ColArbiter.prototype.surfacey=null,t.dynamics.ZPP_ColArbiter.prototype.ptype=null,t.dynamics.ZPP_ColArbiter.prototype.lnormx=null,t.dynamics.ZPP_ColArbiter.prototype.lnormy=null,t.dynamics.ZPP_ColArbiter.prototype.lproj=null,t.dynamics.ZPP_ColArbiter.prototype.radius=null,t.dynamics.ZPP_ColArbiter.prototype.rev=null,t.dynamics.ZPP_ColArbiter.prototype.biasCoef=null,t.dynamics.ZPP_ColArbiter.prototype.__ref_edge1=null,t.dynamics.ZPP_ColArbiter.prototype.__ref_edge2=null,t.dynamics.ZPP_ColArbiter.prototype.__ref_vertex=null,t.dynamics.ZPP_ColArbiter.prototype.c1=null,t.dynamics.ZPP_ColArbiter.prototype.oc1=null,t.dynamics.ZPP_ColArbiter.prototype.c2=null,t.dynamics.ZPP_ColArbiter.prototype.oc2=null,t.dynamics.ZPP_ColArbiter.prototype.hc2=null,t.dynamics.ZPP_ColArbiter.prototype.hpc2=null,t.dynamics.ZPP_ColArbiter.prototype.next=null,t.dynamics.ZPP_ColArbiter.prototype.alloc=function(){},t.dynamics.ZPP_ColArbiter.prototype.free=function(){this.userdef_dyn_fric=!1,this.userdef_stat_fric=!1,this.userdef_restitution=!1,this.userdef_rfric=!1,this.__ref_edge1=this.__ref_edge2=null},t.dynamics.ZPP_ColArbiter.prototype.stat=null,t.dynamics.ZPP_ColArbiter.prototype.injectContact=function(e,n,i,r,o,a,s){null==s&&(s=!1);for(var l=null,p=this.contacts.next;null!=p;){var u=p;if(a==u.hash){l=u;break}p=p.next}if(null==l){null==t.dynamics.ZPP_Contact.zpp_pool?l=new t.dynamics.ZPP_Contact:(l=t.dynamics.ZPP_Contact.zpp_pool,t.dynamics.ZPP_Contact.zpp_pool=l.next,l.next=null);var h=l.inner;h.jnAcc=h.jtAcc=0,l.hash=a,l.fresh=!0,l.arbiter=this,this.jrAcc=0;var c=this.contacts;l._inuse=!0;var _=l;_.next=c.next,c.next=_,c.modified=!0,c.length++,this.innards.add(h)}else l.fresh=!1;return l.px=e,l.py=n,this.nx=i,this.ny=r,l.dist=o,l.stamp=this.stamp,l.posOnly=s,l},t.dynamics.ZPP_ColArbiter.prototype.assign=function(e,n,i,r){this.b1=e.body,this.ws1=e,this.b2=n.body,this.ws2=n,this.id=i,this.di=r;var o,a=this.b1.arbiters;null==t.util.ZNPNode_ZPP_Arbiter.zpp_pool?o=new t.util.ZNPNode_ZPP_Arbiter:(o=t.util.ZNPNode_ZPP_Arbiter.zpp_pool,t.util.ZNPNode_ZPP_Arbiter.zpp_pool=o.next,o.next=null),o.elt=this;var s=o;s.next=a.head,a.head=s,a.modified=!0,a.length++;var l,p=this.b2.arbiters;null==t.util.ZNPNode_ZPP_Arbiter.zpp_pool?l=new t.util.ZNPNode_ZPP_Arbiter:(l=t.util.ZNPNode_ZPP_Arbiter.zpp_pool,t.util.ZNPNode_ZPP_Arbiter.zpp_pool=l.next,l.next=null),l.elt=this;var u=l;u.next=p.head,p.head=u,p.modified=!0,p.length++,this.active=!0,this.present=0,this.cleared=!1,this.sleeping=!1,this.fresh=!1,this.presentable=!1,this.s1=e,this.s2=n,this.userdef_restitution||(this.s1.material.elasticity<=-1/0||this.s2.material.elasticity<=-1/0?this.restitution=0:this.s1.material.elasticity>=1/0||this.s2.material.elasticity>=1/0?this.restitution=1:this.restitution=(this.s1.material.elasticity+this.s2.material.elasticity)/2,this.restitution<0&&(this.restitution=0),this.restitution>1&&(this.restitution=1)),this.userdef_dyn_fric||(this.dyn_fric=Math.sqrt(this.s1.material.dynamicFriction*this.s2.material.dynamicFriction)),this.userdef_stat_fric||(this.stat_fric=Math.sqrt(this.s1.material.staticFriction*this.s2.material.staticFriction)),this.userdef_rfric||(this.rfric=Math.sqrt(this.s1.material.rollingFriction*this.s2.material.rollingFriction))},t.dynamics.ZPP_ColArbiter.prototype.calcProperties=function(){this.userdef_restitution||(this.s1.material.elasticity<=-1/0||this.s2.material.elasticity<=-1/0?this.restitution=0:this.s1.material.elasticity>=1/0||this.s2.material.elasticity>=1/0?this.restitution=1:this.restitution=(this.s1.material.elasticity+this.s2.material.elasticity)/2,this.restitution<0&&(this.restitution=0),this.restitution>1&&(this.restitution=1)),this.userdef_dyn_fric||(this.dyn_fric=Math.sqrt(this.s1.material.dynamicFriction*this.s2.material.dynamicFriction)),this.userdef_stat_fric||(this.stat_fric=Math.sqrt(this.s1.material.staticFriction*this.s2.material.staticFriction)),this.userdef_rfric||(this.rfric=Math.sqrt(this.s1.material.rollingFriction*this.s2.material.rollingFriction))},t.dynamics.ZPP_ColArbiter.prototype.validate_props=function(){this.invalidated&&(this.invalidated=!1,this.userdef_restitution||(this.s1.material.elasticity<=-1/0||this.s2.material.elasticity<=-1/0?this.restitution=0:this.s1.material.elasticity>=1/0||this.s2.material.elasticity>=1/0?this.restitution=1:this.restitution=(this.s1.material.elasticity+this.s2.material.elasticity)/2,this.restitution<0&&(this.restitution=0),this.restitution>1&&(this.restitution=1)),this.userdef_dyn_fric||(this.dyn_fric=Math.sqrt(this.s1.material.dynamicFriction*this.s2.material.dynamicFriction)),this.userdef_stat_fric||(this.stat_fric=Math.sqrt(this.s1.material.staticFriction*this.s2.material.staticFriction)),this.userdef_rfric||(this.rfric=Math.sqrt(this.s1.material.rollingFriction*this.s2.material.rollingFriction)))},t.dynamics.ZPP_ColArbiter.prototype.retire=function(){if(!this.cleared){for(var e=this.b1.arbiters,n=null,i=e.head;null!=i;){if(i.elt==this){var r,o;null==n?(o=(r=e.head).next,e.head=o,null==e.head&&(e.pushmod=!0)):(o=(r=n.next).next,n.next=o,null==o&&(e.pushmod=!0));var a=r;a.elt=null,a.next=t.util.ZNPNode_ZPP_Arbiter.zpp_pool,t.util.ZNPNode_ZPP_Arbiter.zpp_pool=a,e.modified=!0,e.length--,e.pushmod=!0;break}n=i,i=i.next}for(var s=this.b2.arbiters,l=null,p=s.head;null!=p;){if(p.elt==this){var u,h;null==l?(h=(u=s.head).next,s.head=h,null==s.head&&(s.pushmod=!0)):(h=(u=l.next).next,l.next=h,null==h&&(s.pushmod=!0));var c=u;c.elt=null,c.next=t.util.ZNPNode_ZPP_Arbiter.zpp_pool,t.util.ZNPNode_ZPP_Arbiter.zpp_pool=c,s.modified=!0,s.length--,s.pushmod=!0;break}l=p,p=p.next}null!=this.pair&&(this.pair.arb=null,this.pair=null)}for(this.b1=this.b2=null,this.active=!1,this.intchange=!1;null!=this.contacts.next;){var _=this.contacts,d=_.next;_.pop();var m=d;m.arbiter=null,m.next=t.dynamics.ZPP_Contact.zpp_pool,t.dynamics.ZPP_Contact.zpp_pool=m;var P=this.innards,f=P.next;P.next=f.next,f._inuse=!1,null==P.next&&(P.pushmod=!0),P.modified=!0,P.length--}var x=this;x.userdef_dyn_fric=!1,x.userdef_stat_fric=!1,x.userdef_restitution=!1,x.userdef_rfric=!1,x.__ref_edge1=x.__ref_edge2=null,x.next=t.dynamics.ZPP_ColArbiter.zpp_pool,t.dynamics.ZPP_ColArbiter.zpp_pool=x,this.pre_dt=-1},t.dynamics.ZPP_ColArbiter.prototype.mutable=null,t.dynamics.ZPP_ColArbiter.prototype.makemutable=function(){this.mutable=!0,null!=this.wrap_normal&&(this.wrap_normal.zpp_inner._immutable=!1),null!=this.wrap_contacts&&(this.wrap_contacts.zpp_inner.immutable=!1)},t.dynamics.ZPP_ColArbiter.prototype.makeimmutable=function(){this.mutable=!1,null!=this.wrap_normal&&(this.wrap_normal.zpp_inner._immutable=!0),null!=this.wrap_contacts&&(this.wrap_contacts.zpp_inner.immutable=!0)},t.dynamics.ZPP_ColArbiter.prototype.contacts_adder=function(e){throw new n._Boot.HaxeError("Error: Cannot add new contacts, information required is far too specific and detailed :)")},t.dynamics.ZPP_ColArbiter.prototype.contacts_subber=function(e){for(var n=null,i=null,r=this.innards.next,o=this.contacts.next;null!=o;){var a=o;if(a==e.zpp_inner){this.contacts.erase(n),this.innards.erase(i);var s=a;s.arbiter=null,s.next=t.dynamics.ZPP_Contact.zpp_pool,t.dynamics.ZPP_Contact.zpp_pool=s;break}n=o,i=r,r=r.next,o=o.next}},t.dynamics.ZPP_ColArbiter.prototype.setupcontacts=function(){this.wrap_contacts=t.util.ZPP_ContactList.get(this.contacts,!0),this.wrap_contacts.zpp_inner.immutable=!this.mutable,this.wrap_contacts.zpp_inner.adder=p(this,this.contacts_adder),this.wrap_contacts.zpp_inner.dontremove=!0,this.wrap_contacts.zpp_inner.subber=p(this,this.contacts_subber)},t.dynamics.ZPP_ColArbiter.prototype.cleanupContacts=function(){var n=!0,i=null,r=null,o=this.innards.next;this.hc2=!1;for(var a=this.contacts.next;null!=a;){var s=a;if(s.stamp+e.Config.arbiterExpirationDelay<this.stamp){var l,p,u=this.contacts;null==i?(p=(l=u.next).next,u.next=p,null==u.next&&(u.pushmod=!0)):(p=(l=i.next).next,i.next=p,null==p&&(u.pushmod=!0)),l._inuse=!1,u.modified=!0,u.length--,u.pushmod=!0,a=p;var h,c,_=this.innards;null==r?(c=(h=_.next).next,_.next=c,null==_.next&&(_.pushmod=!0)):(c=(h=r.next).next,r.next=c,null==c&&(_.pushmod=!0)),h._inuse=!1,_.modified=!0,_.length--,_.pushmod=!0,o=c;var d=s;d.arbiter=null,d.next=t.dynamics.ZPP_Contact.zpp_pool,t.dynamics.ZPP_Contact.zpp_pool=d}else{var m=s.inner,P=s.active;s.active=s.stamp==this.stamp,s.active&&(n?(n=!1,this.c1=m,this.oc1=s):(this.hc2=!0,this.c2=m,this.oc2=s)),P!=s.active&&(this.contacts.modified=!0),i=a,r=o,o=o.next,a=a.next}}if(this.hc2){if(this.hpc2=!0,this.oc1.posOnly){var f=this.c1;this.c1=this.c2,this.c2=f;var x=this.oc1;this.oc1=this.oc2,this.oc2=x,this.hc2=!1}else this.oc2.posOnly&&(this.hc2=!1);this.oc1.posOnly&&(n=!0)}else this.hpc2=!1;return n},t.dynamics.ZPP_ColArbiter.prototype.pre_dt=null,t.dynamics.ZPP_ColArbiter.prototype.preStep=function(n){this.invalidated&&(this.invalidated=!1,this.userdef_restitution||(this.s1.material.elasticity<=-1/0||this.s2.material.elasticity<=-1/0?this.restitution=0:this.s1.material.elasticity>=1/0||this.s2.material.elasticity>=1/0?this.restitution=1:this.restitution=(this.s1.material.elasticity+this.s2.material.elasticity)/2,this.restitution<0&&(this.restitution=0),this.restitution>1&&(this.restitution=1)),this.userdef_dyn_fric||(this.dyn_fric=Math.sqrt(this.s1.material.dynamicFriction*this.s2.material.dynamicFriction)),this.userdef_stat_fric||(this.stat_fric=Math.sqrt(this.s1.material.staticFriction*this.s2.material.staticFriction)),this.userdef_rfric||(this.rfric=Math.sqrt(this.s1.material.rollingFriction*this.s2.material.rollingFriction))),-1==this.pre_dt&&(this.pre_dt=n);var i=n/this.pre_dt;this.pre_dt=n;var r=this.b1.smass+this.b2.smass;this.hc2=!1;var o=!0,a=2!=this.b1.type||2!=this.b2.type?this.continuous?e.Config.contactContinuousStaticBiasCoef:e.Config.contactStaticBiasCoef:this.continuous?e.Config.contactContinuousBiasCoef:e.Config.contactBiasCoef;this.biasCoef=a,this.continuous=!1;for(var s=null,l=null,p=this.innards.next,u=this.contacts.next;null!=u;){var h=u;if(h.stamp+e.Config.arbiterExpirationDelay<this.stamp){var c,_,d=this.contacts;null==s?(_=(c=d.next).next,d.next=_,null==d.next&&(d.pushmod=!0)):(_=(c=s.next).next,s.next=_,null==_&&(d.pushmod=!0)),c._inuse=!1,d.modified=!0,d.length--,d.pushmod=!0,u=_;var m,P,f=this.innards;null==l?(P=(m=f.next).next,f.next=P,null==f.next&&(f.pushmod=!0)):(P=(m=l.next).next,l.next=P,null==P&&(f.pushmod=!0)),m._inuse=!1,f.modified=!0,f.length--,f.pushmod=!0,p=P;var x=h;x.arbiter=null,x.next=t.dynamics.ZPP_Contact.zpp_pool,t.dynamics.ZPP_Contact.zpp_pool=x}else{var y=h.inner,v=h.active;if(h.active=h.stamp==this.stamp,h.active){o?(o=!1,this.c1=y,this.oc1=h):(this.hc2=!0,this.c2=y,this.oc2=h),y.r2x=h.px-this.b2.posx,y.r2y=h.py-this.b2.posy,y.r1x=h.px-this.b1.posx,y.r1y=h.py-this.b1.posy;var g=y.r2x*this.nx+y.r2y*this.ny,b=r+this.b2.sinertia*(g*g),z=y.r1x*this.nx+y.r1y*this.ny;b+=this.b1.sinertia*(z*z),y.tMass=b<e.Config.epsilon*e.Config.epsilon?0:1/b;var w=this.ny*y.r2x-this.nx*y.r2y,Z=r+this.b2.sinertia*(w*w),E=this.ny*y.r1x-this.nx*y.r1y;Z+=this.b1.sinertia*(E*E),y.nMass=Z<e.Config.epsilon*e.Config.epsilon?0:1/Z;var M=0,S=0,C=this.b2.angvel+this.b2.kinangvel;M=this.b2.velx+this.b2.kinvelx-y.r2y*C,S=this.b2.vely+this.b2.kinvely+y.r2x*C,C=this.b1.angvel+this.b1.kinangvel,M-=this.b1.velx+this.b1.kinvelx-y.r1y*C,S-=this.b1.vely+this.b1.kinvely+y.r1x*C;var N=this.nx*M+this.ny*S;h.elasticity=this.restitution,y.bounce=N*h.elasticity,y.bounce>-e.Config.elasticThreshold&&(y.bounce=0),N=S*this.nx-M*this.ny;var A=e.Config.staticFrictionThreshold;y.friction=N*N>A*A?this.dyn_fric:this.stat_fric,y.jnAcc*=i,y.jtAcc*=i}v!=h.active&&(this.contacts.modified=!0),s=u,l=p,p=p.next,u=u.next}}if(this.hc2){if(this.hpc2=!0,this.oc1.posOnly){var L=this.c1;this.c1=this.c2,this.c2=L;var B=this.oc1;this.oc1=this.oc2,this.oc2=B,this.hc2=!1}else this.oc2.posOnly&&(this.hc2=!1);this.oc1.posOnly&&(o=!0)}else this.hpc2=!1;if(this.jrAcc*=i,o||(this.rn1a=this.ny*this.c1.r1x-this.nx*this.c1.r1y,this.rt1a=this.c1.r1x*this.nx+this.c1.r1y*this.ny,this.rn1b=this.ny*this.c1.r2x-this.nx*this.c1.r2y,this.rt1b=this.c1.r2x*this.nx+this.c1.r2y*this.ny,this.k1x=this.b2.kinvelx-this.c1.r2y*this.b2.kinangvel-(this.b1.kinvelx-this.c1.r1y*this.b1.kinangvel),this.k1y=this.b2.kinvely+this.c1.r2x*this.b2.kinangvel-(this.b1.kinvely+this.c1.r1x*this.b1.kinangvel)),this.hc2)if(this.rn2a=this.ny*this.c2.r1x-this.nx*this.c2.r1y,this.rt2a=this.c2.r1x*this.nx+this.c2.r1y*this.ny,this.rn2b=this.ny*this.c2.r2x-this.nx*this.c2.r2y,this.rt2b=this.c2.r2x*this.nx+this.c2.r2y*this.ny,this.k2x=this.b2.kinvelx-this.c2.r2y*this.b2.kinangvel-(this.b1.kinvelx-this.c2.r1y*this.b1.kinangvel),this.k2y=this.b2.kinvely+this.c2.r2x*this.b2.kinangvel-(this.b1.kinvely+this.c2.r1x*this.b1.kinangvel),this.kMassa=r+this.b1.sinertia*this.rn1a*this.rn1a+this.b2.sinertia*this.rn1b*this.rn1b,this.kMassb=r+this.b1.sinertia*this.rn1a*this.rn2a+this.b2.sinertia*this.rn1b*this.rn2b,this.kMassc=r+this.b1.sinertia*this.rn2a*this.rn2a+this.b2.sinertia*this.rn2b*this.rn2b,this.kMassa*this.kMassa+2*this.kMassb*this.kMassb+this.kMassc*this.kMassc<e.Config.illConditionedThreshold*(this.kMassa*this.kMassc-this.kMassb*this.kMassb)){this.Ka=this.kMassa,this.Kb=this.kMassb,this.Kc=this.kMassc;var T=this.kMassa*this.kMassc-this.kMassb*this.kMassb;if(T!=T)this.kMassa=this.kMassb=this.kMassc=0;else if(0==T)0!=this.kMassa?this.kMassa=1/this.kMassa:this.kMassa=0,0!=this.kMassc?this.kMassc=1/this.kMassc:this.kMassc=0,this.kMassb=0;else{T=1/T;var V=this.kMassc*T;this.kMassc=this.kMassa*T,this.kMassa=V,this.kMassb*=-T}}else{if(this.hc2=!1,this.oc2.dist<this.oc1.dist){var k=this.c1;this.c1=this.c2,this.c2=k}this.oc2.active=!1,this.contacts.modified=!0}return this.surfacex=this.b2.svelx,this.surfacey=this.b2.svely,this.surfacex+=1*this.b1.svelx,this.surfacey+=1*this.b1.svely,this.surfacex=-this.surfacex,this.surfacey=-this.surfacey,this.rMass=this.b1.sinertia+this.b2.sinertia,0!=this.rMass&&(this.rMass=1/this.rMass),o},t.dynamics.ZPP_ColArbiter.prototype.warmStart=function(){var e=this.nx*this.c1.jnAcc-this.ny*this.c1.jtAcc,t=this.ny*this.c1.jnAcc+this.nx*this.c1.jtAcc,n=this.b1.imass;this.b1.velx-=e*n,this.b1.vely-=t*n,this.b1.angvel-=this.b1.iinertia*(t*this.c1.r1x-e*this.c1.r1y);var i=this.b2.imass;if(this.b2.velx+=e*i,this.b2.vely+=t*i,this.b2.angvel+=this.b2.iinertia*(t*this.c1.r2x-e*this.c1.r2y),this.hc2){var r=this.nx*this.c2.jnAcc-this.ny*this.c2.jtAcc,o=this.ny*this.c2.jnAcc+this.nx*this.c2.jtAcc,a=this.b1.imass;this.b1.velx-=r*a,this.b1.vely-=o*a,this.b1.angvel-=this.b1.iinertia*(o*this.c2.r1x-r*this.c2.r1y);var s=this.b2.imass;this.b2.velx+=r*s,this.b2.vely+=o*s,this.b2.angvel+=this.b2.iinertia*(o*this.c2.r2x-r*this.c2.r2y)}this.b2.angvel+=this.jrAcc*this.b2.iinertia,this.b1.angvel-=this.jrAcc*this.b1.iinertia},t.dynamics.ZPP_ColArbiter.prototype.applyImpulseVel=function(){var e=this.k1x+this.b2.velx-this.c1.r2y*this.b2.angvel-(this.b1.velx-this.c1.r1y*this.b1.angvel),t=this.k1y+this.b2.vely+this.c1.r2x*this.b2.angvel-(this.b1.vely+this.c1.r1x*this.b1.angvel),n=(t*this.nx-e*this.ny+this.surfacex)*this.c1.tMass,i=this.c1.friction*this.c1.jnAcc,r=this.c1.jtAcc,o=r-n;o>i?o=i:o<-i&&(o=-i),n=o-r,this.c1.jtAcc=o;var a=-this.ny*n,s=this.nx*n;if(this.b2.velx+=a*this.b2.imass,this.b2.vely+=s*this.b2.imass,this.b1.velx-=a*this.b1.imass,this.b1.vely-=s*this.b1.imass,this.b2.angvel+=this.rt1b*n*this.b2.iinertia,this.b1.angvel-=this.rt1a*n*this.b1.iinertia,this.hc2){var l=this.k2x+this.b2.velx-this.c2.r2y*this.b2.angvel-(this.b1.velx-this.c2.r1y*this.b1.angvel),p=this.k2y+this.b2.vely+this.c2.r2x*this.b2.angvel-(this.b1.vely+this.c2.r1x*this.b1.angvel);n=(p*this.nx-l*this.ny+this.surfacex)*this.c2.tMass,i=this.c2.friction*this.c2.jnAcc,(o=(r=this.c2.jtAcc)-n)>i?o=i:o<-i&&(o=-i),n=o-r,this.c2.jtAcc=o,a=-this.ny*n,s=this.nx*n,this.b2.velx+=a*this.b2.imass,this.b2.vely+=s*this.b2.imass,this.b1.velx-=a*this.b1.imass,this.b1.vely-=s*this.b1.imass,this.b2.angvel+=this.rt2b*n*this.b2.iinertia,this.b1.angvel-=this.rt2a*n*this.b1.iinertia,e=this.k1x+this.b2.velx-this.c1.r2y*this.b2.angvel-(this.b1.velx-this.c1.r1y*this.b1.angvel),t=this.k1y+this.b2.vely+this.c1.r2x*this.b2.angvel-(this.b1.vely+this.c1.r1x*this.b1.angvel),l=this.k2x+this.b2.velx-this.c2.r2y*this.b2.angvel-(this.b1.velx-this.c2.r1y*this.b1.angvel),p=this.k2y+this.b2.vely+this.c2.r2x*this.b2.angvel-(this.b1.vely+this.c2.r1x*this.b1.angvel);var u=this.c1.jnAcc,h=this.c2.jnAcc,c=e*this.nx+t*this.ny+this.surfacey+this.c1.bounce-(this.Ka*u+this.Kb*h),_=l*this.nx+p*this.ny+this.surfacey+this.c2.bounce-(this.Kb*u+this.Kc*h),d=-(this.kMassa*c+this.kMassb*_),m=-(this.kMassb*c+this.kMassc*_);d>=0&&m>=0?(c=d-u,_=m-h,this.c1.jnAcc=d,this.c2.jnAcc=m):(d=-this.c1.nMass*c)>=0&&this.Kb*d+_>=0?(c=d-u,_=-h,this.c1.jnAcc=d,this.c2.jnAcc=0):(m=-this.c2.nMass*_)>=0&&this.Kb*m+c>=0?(c=-u,_=m-h,this.c1.jnAcc=0,this.c2.jnAcc=m):c>=0&&_>=0?(c=-u,_=-h,this.c1.jnAcc=this.c2.jnAcc=0):(c=0,_=0),n=c+_,a=this.nx*n,s=this.ny*n,this.b2.velx+=a*this.b2.imass,this.b2.vely+=s*this.b2.imass,this.b1.velx-=a*this.b1.imass,this.b1.vely-=s*this.b1.imass,this.b2.angvel+=(this.rn1b*c+this.rn2b*_)*this.b2.iinertia,this.b1.angvel-=(this.rn1a*c+this.rn2a*_)*this.b1.iinertia}else 0!=this.radius&&(n=(this.b2.angvel-this.b1.angvel)*this.rMass,i=this.rfric*this.c1.jnAcc,r=this.jrAcc,this.jrAcc-=n,this.jrAcc>i?this.jrAcc=i:this.jrAcc<-i&&(this.jrAcc=-i),n=this.jrAcc-r,this.b2.angvel+=n*this.b2.iinertia,this.b1.angvel-=n*this.b1.iinertia),e=this.k1x+this.b2.velx-this.c1.r2y*this.b2.angvel-(this.b1.velx-this.c1.r1y*this.b1.angvel),t=this.k1y+this.b2.vely+this.c1.r2x*this.b2.angvel-(this.b1.vely+this.c1.r1x*this.b1.angvel),n=(this.c1.bounce+(this.nx*e+this.ny*t)+this.surfacey)*this.c1.nMass,(o=(r=this.c1.jnAcc)-n)<0&&(o=0),n=o-r,this.c1.jnAcc=o,a=this.nx*n,s=this.ny*n,this.b2.velx+=a*this.b2.imass,this.b2.vely+=s*this.b2.imass,this.b1.velx-=a*this.b1.imass,this.b1.vely-=s*this.b1.imass,this.b2.angvel+=this.rn1b*n*this.b2.iinertia,this.b1.angvel-=this.rn1a*n*this.b1.iinertia},t.dynamics.ZPP_ColArbiter.prototype.applyImpulsePos=function(){if(2==this.ptype){var t=this.c1,n=0,i=0;n=this.b2.axisy*t.lr2x-this.b2.axisx*t.lr2y,i=t.lr2x*this.b2.axisx+t.lr2y*this.b2.axisy,n+=1*this.b2.posx,i+=1*this.b2.posy;var r=0,o=0;r=this.b1.axisy*t.lr1x-this.b1.axisx*t.lr1y,o=t.lr1x*this.b1.axisx+t.lr1y*this.b1.axisy;var a=0,s=0;a=n-(r+=1*this.b1.posx),s=i-(o+=1*this.b1.posy);var l=Math.sqrt(a*a+s*s),p=this.radius-e.Config.collisionSlop,u=l-p;if(a*this.nx+s*this.ny<0&&(a=-a,s=-s,u-=this.radius),u<0)if(l<e.Config.epsilon)0!=this.b1.smass?this.b1.posx+=10*e.Config.epsilon:this.b2.posx+=10*e.Config.epsilon;else{var h=1/l;a*=h;var c=.5*(r+n),_=.5*(o+i),d=l-p,m=(s*=h)*(r=c-this.b1.posx)-a*(o=_-this.b1.posy),P=s*(n=c-this.b2.posx)-a*(i=_-this.b2.posy),f=this.b2.smass+P*P*this.b2.sinertia+this.b1.smass+m*m*this.b1.sinertia;if(0!=f){var x,y,v=-this.biasCoef*d/f;x=a*v,y=s*v;var g=this.b1.imass;this.b1.posx-=x*g,this.b1.posy-=y*g;var b=this.b1,z=-m*this.b1.iinertia*v;if(b.rot+=z,z*z>1e-4)b.axisx=Math.sin(b.rot),b.axisy=Math.cos(b.rot);else{var w=z*z,Z=1-.5*w,E=1-w*w/8,M=(Z*b.axisx+z*b.axisy)*E;b.axisy=(Z*b.axisy-z*b.axisx)*E,b.axisx=M}var S=this.b2.imass;this.b2.posx+=x*S,this.b2.posy+=y*S;var C=this.b2,N=P*this.b2.iinertia*v;if(C.rot+=N,N*N>1e-4)C.axisx=Math.sin(C.rot),C.axisy=Math.cos(C.rot);else{var A=N*N,L=1-.5*A,B=1-A*A/8,T=(L*C.axisx+N*C.axisy)*B;C.axisy=(L*C.axisy-N*C.axisx)*B,C.axisx=T}}}}else{var V,k=0,I=0,O=0,R=0,H=0,F=0;0==this.ptype?(k=this.b1.axisy*this.lnormx-this.b1.axisx*this.lnormy,I=this.lnormx*this.b1.axisx+this.lnormy*this.b1.axisy,V=this.lproj+(k*this.b1.posx+I*this.b1.posy),O=this.b2.axisy*this.c1.lr1x-this.b2.axisx*this.c1.lr1y,R=this.c1.lr1x*this.b2.axisx+this.c1.lr1y*this.b2.axisy,O+=1*this.b2.posx,R+=1*this.b2.posy,this.hpc2&&(H=this.b2.axisy*this.c2.lr1x-this.b2.axisx*this.c2.lr1y,F=this.c2.lr1x*this.b2.axisx+this.c2.lr1y*this.b2.axisy,H+=1*this.b2.posx,F+=1*this.b2.posy)):(k=this.b2.axisy*this.lnormx-this.b2.axisx*this.lnormy,I=this.lnormx*this.b2.axisx+this.lnormy*this.b2.axisy,V=this.lproj+(k*this.b2.posx+I*this.b2.posy),O=this.b1.axisy*this.c1.lr1x-this.b1.axisx*this.c1.lr1y,R=this.c1.lr1x*this.b1.axisx+this.c1.lr1y*this.b1.axisy,O+=1*this.b1.posx,R+=1*this.b1.posy,this.hpc2&&(H=this.b1.axisy*this.c2.lr1x-this.b1.axisx*this.c2.lr1y,F=this.c2.lr1x*this.b1.axisx+this.c2.lr1y*this.b1.axisy,H+=1*this.b1.posx,F+=1*this.b1.posy));var D=O*k+R*I-V-this.radius;D+=e.Config.collisionSlop;var G,U,j,W,q=0;if(this.hpc2&&(q=H*k+F*I-V-this.radius,q+=e.Config.collisionSlop),D<0||q<0)if(this.rev&&(k=-k,I=-I),G=O-this.b1.posx,U=R-this.b1.posy,j=O-this.b2.posx,W=R-this.b2.posy,this.hpc2){var J,$,X,Y=I*G-k*U,K=I*j-k*W,Q=I*(H-this.b1.posx)-k*(F-this.b1.posy),ee=I*(H-this.b2.posx)-k*(F-this.b2.posy),te=this.b1.smass+this.b2.smass;this.kMassa=te+this.b1.sinertia*Y*Y+this.b2.sinertia*K*K,this.kMassb=te+this.b1.sinertia*Y*Q+this.b2.sinertia*K*ee,this.kMassc=te+this.b1.sinertia*Q*Q+this.b2.sinertia*ee*ee,J=this.kMassa,$=this.kMassb,X=this.kMassc;for(var ne=D*this.biasCoef,ie=q*this.biasCoef;;){var re=0,oe=0;re=-(re=ne),oe=-(oe=ie);var ae=this.kMassa*this.kMassc-this.kMassb*this.kMassb;if(ae!=ae)re=oe=0;else if(0==ae)0!=this.kMassa?re/=this.kMassa:re=0,0!=this.kMassc?oe/=this.kMassc:oe=0;else{var se=(ae=1/ae)*(this.kMassc*re-this.kMassb*oe);oe=ae*(this.kMassa*oe-this.kMassb*re),re=se}if(re>=0&&oe>=0){var le=(re+oe)*this.b1.imass;this.b1.posx-=k*le,this.b1.posy-=I*le;var pe=this.b1,ue=-this.b1.iinertia*(Y*re+Q*oe);if(pe.rot+=ue,ue*ue>1e-4)pe.axisx=Math.sin(pe.rot),pe.axisy=Math.cos(pe.rot);else{var he=ue*ue,ce=1-.5*he,_e=1-he*he/8,de=(ce*pe.axisx+ue*pe.axisy)*_e;pe.axisy=(ce*pe.axisy-ue*pe.axisx)*_e,pe.axisx=de}var me=(re+oe)*this.b2.imass;this.b2.posx+=k*me,this.b2.posy+=I*me;var Pe=this.b2,fe=this.b2.iinertia*(K*re+ee*oe);if(Pe.rot+=fe,fe*fe>1e-4)Pe.axisx=Math.sin(Pe.rot),Pe.axisy=Math.cos(Pe.rot);else{var xe=fe*fe,ye=1-.5*xe,ve=1-xe*xe/8,ge=(ye*Pe.axisx+fe*Pe.axisy)*ve;Pe.axisy=(ye*Pe.axisy-fe*Pe.axisx)*ve,Pe.axisx=ge}break}if(oe=0,(re=-ne/J)>=0&&$*re+ie>=0){var be=(re+oe)*this.b1.imass;this.b1.posx-=k*be,this.b1.posy-=I*be;var ze=this.b1,we=-this.b1.iinertia*(Y*re+Q*oe);if(ze.rot+=we,we*we>1e-4)ze.axisx=Math.sin(ze.rot),ze.axisy=Math.cos(ze.rot);else{var Ze=we*we,Ee=1-.5*Ze,Me=1-Ze*Ze/8,Se=(Ee*ze.axisx+we*ze.axisy)*Me;ze.axisy=(Ee*ze.axisy-we*ze.axisx)*Me,ze.axisx=Se}var Ce=(re+oe)*this.b2.imass;this.b2.posx+=k*Ce,this.b2.posy+=I*Ce;var Ne=this.b2,Ae=this.b2.iinertia*(K*re+ee*oe);if(Ne.rot+=Ae,Ae*Ae>1e-4)Ne.axisx=Math.sin(Ne.rot),Ne.axisy=Math.cos(Ne.rot);else{var Le=Ae*Ae,Be=1-.5*Le,Te=1-Le*Le/8,Ve=(Be*Ne.axisx+Ae*Ne.axisy)*Te;Ne.axisy=(Be*Ne.axisy-Ae*Ne.axisx)*Te,Ne.axisx=Ve}break}if(re=0,(oe=-ie/X)>=0&&$*oe+ne>=0){var ke=(re+oe)*this.b1.imass;this.b1.posx-=k*ke,this.b1.posy-=I*ke;var Ie=this.b1,Oe=-this.b1.iinertia*(Y*re+Q*oe);if(Ie.rot+=Oe,Oe*Oe>1e-4)Ie.axisx=Math.sin(Ie.rot),Ie.axisy=Math.cos(Ie.rot);else{var Re=Oe*Oe,He=1-.5*Re,Fe=1-Re*Re/8,De=(He*Ie.axisx+Oe*Ie.axisy)*Fe;Ie.axisy=(He*Ie.axisy-Oe*Ie.axisx)*Fe,Ie.axisx=De}var Ge=(re+oe)*this.b2.imass;this.b2.posx+=k*Ge,this.b2.posy+=I*Ge;var Ue=this.b2,je=this.b2.iinertia*(K*re+ee*oe);if(Ue.rot+=je,je*je>1e-4)Ue.axisx=Math.sin(Ue.rot),Ue.axisy=Math.cos(Ue.rot);else{var We=je*je,qe=1-.5*We,Je=1-We*We/8,$e=(qe*Ue.axisx+je*Ue.axisy)*Je;Ue.axisy=(qe*Ue.axisy-je*Ue.axisx)*Je,Ue.axisx=$e}break}break}}else{var Xe=I*G-k*U,Ye=I*j-k*W,Ke=this.b2.smass+Ye*Ye*this.b2.sinertia+this.b1.smass+Xe*Xe*this.b1.sinertia;if(0!=Ke){var Qe,et,tt=-this.biasCoef*D/Ke;Qe=k*tt,et=I*tt;var nt=this.b1.imass;this.b1.posx-=Qe*nt,this.b1.posy-=et*nt;var it=this.b1,rt=-Xe*this.b1.iinertia*tt;if(it.rot+=rt,rt*rt>1e-4)it.axisx=Math.sin(it.rot),it.axisy=Math.cos(it.rot);else{var ot=rt*rt,at=1-.5*ot,st=1-ot*ot/8,lt=(at*it.axisx+rt*it.axisy)*st;it.axisy=(at*it.axisy-rt*it.axisx)*st,it.axisx=lt}var pt=this.b2.imass;this.b2.posx+=Qe*pt,this.b2.posy+=et*pt;var ut=this.b2,ht=Ye*this.b2.iinertia*tt;if(ut.rot+=ht,ht*ht>1e-4)ut.axisx=Math.sin(ut.rot),ut.axisy=Math.cos(ut.rot);else{var ct=ht*ht,_t=1-.5*ct,dt=1-ct*ct/8,mt=(_t*ut.axisx+ht*ut.axisy)*dt;ut.axisy=(_t*ut.axisy-ht*ut.axisx)*dt,ut.axisx=mt}}}}},t.dynamics.ZPP_ColArbiter.prototype.__class__=t.dynamics.ZPP_ColArbiter,t.dynamics.ZPP_Contact=l["zpp_nape.dynamics.ZPP_Contact"]=function(){this.length=0,this.pushmod=!1,this.modified=!1,this._inuse=!1,this.next=null,this.elasticity=0,this.dist=0,this.fresh=!1,this.hash=0,this.stamp=0,this.posOnly=!1,this.active=!1,this.inner=null,this.arbiter=null,this.wrap_position=null,this.py=0,this.px=0,this.outer=null,this.inner=new t.dynamics.ZPP_IContact},t.dynamics.ZPP_Contact.__name__=["zpp_nape","dynamics","ZPP_Contact"],t.dynamics.ZPP_Contact.prototype.outer=null,t.dynamics.ZPP_Contact.prototype.wrapper=function(){return null==this.outer&&(t.dynamics.ZPP_Contact.internal=!0,this.outer=new e.dynamics.Contact,t.dynamics.ZPP_Contact.internal=!1,this.outer.zpp_inner=this),this.outer},t.dynamics.ZPP_Contact.prototype.px=null,t.dynamics.ZPP_Contact.prototype.py=null,t.dynamics.ZPP_Contact.prototype.position_validate=function(){if(this.inactiveme())throw new n._Boot.HaxeError("Error: Contact not currently in use");this.wrap_position.zpp_inner.x=this.px,this.wrap_position.zpp_inner.y=this.py},t.dynamics.ZPP_Contact.prototype.wrap_position=null,t.dynamics.ZPP_Contact.prototype.getposition=function(){var i;if(null==t.util.ZPP_PubPool.poolVec2?i=new e.geom.Vec2:(i=t.util.ZPP_PubPool.poolVec2,t.util.ZPP_PubPool.poolVec2=i.zpp_pool,i.zpp_pool=null,i.zpp_disp=!1,i==t.util.ZPP_PubPool.nextVec2&&(t.util.ZPP_PubPool.nextVec2=null)),null==i.zpp_inner){var r;null==t.geom.ZPP_Vec2.zpp_pool?r=new t.geom.ZPP_Vec2:(r=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=r.next,r.next=null),r.weak=!1,r._immutable=!1,r.x=0,r.y=0,i.zpp_inner=r,i.zpp_inner.outer=i}else{if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var o,a=i.zpp_inner;if(a._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=a._isimmutable&&a._isimmutable(),null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var s=i.zpp_inner;if(null!=s._validate&&s._validate(),0==i.zpp_inner.x){if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var l=i.zpp_inner;null!=l._validate&&l._validate(),o=0==i.zpp_inner.y}else o=!1;if(!o){i.zpp_inner.x=0,i.zpp_inner.y=0;var u=i.zpp_inner;null!=u._invalidate&&u._invalidate(u)}}i.zpp_inner.weak=!1,this.wrap_position=i,this.wrap_position.zpp_inner._inuse=!0,this.wrap_position.zpp_inner._immutable=!0,this.wrap_position.zpp_inner._validate=p(this,this.position_validate)},t.dynamics.ZPP_Contact.prototype.inactiveme=function(){return!(this.active&&null!=this.arbiter&&this.arbiter.active)},t.dynamics.ZPP_Contact.prototype.arbiter=null,t.dynamics.ZPP_Contact.prototype.inner=null,t.dynamics.ZPP_Contact.prototype.active=null,t.dynamics.ZPP_Contact.prototype.posOnly=null,t.dynamics.ZPP_Contact.prototype.stamp=null,t.dynamics.ZPP_Contact.prototype.hash=null,t.dynamics.ZPP_Contact.prototype.fresh=null,t.dynamics.ZPP_Contact.prototype.dist=null,t.dynamics.ZPP_Contact.prototype.elasticity=null,t.dynamics.ZPP_Contact.prototype.free=function(){this.arbiter=null},t.dynamics.ZPP_Contact.prototype.alloc=function(){},t.dynamics.ZPP_Contact.prototype.next=null,t.dynamics.ZPP_Contact.prototype.elem=function(){return this},t.dynamics.ZPP_Contact.prototype.begin=function(){return this.next},t.dynamics.ZPP_Contact.prototype._inuse=null,t.dynamics.ZPP_Contact.prototype.modified=null,t.dynamics.ZPP_Contact.prototype.pushmod=null,t.dynamics.ZPP_Contact.prototype.length=null,t.dynamics.ZPP_Contact.prototype.setbegin=function(e){this.next=e,this.modified=!0,this.pushmod=!0},t.dynamics.ZPP_Contact.prototype.add=function(e){e._inuse=!0;var t=e;return t.next=this.next,this.next=t,this.modified=!0,this.length++,e},t.dynamics.ZPP_Contact.prototype.inlined_add=function(e){e._inuse=!0;var t=e;return t.next=this.next,this.next=t,this.modified=!0,this.length++,e},t.dynamics.ZPP_Contact.prototype.addAll=function(e){for(var t=e.next;null!=t;){var n=t;this.add(n),t=t.next}},t.dynamics.ZPP_Contact.prototype.insert=function(e,t){t._inuse=!0;var n=t;return null==e?(n.next=this.next,this.next=n):(n.next=e.next,e.next=n),this.pushmod=this.modified=!0,this.length++,n},t.dynamics.ZPP_Contact.prototype.inlined_insert=function(e,t){t._inuse=!0;var n=t;return null==e?(n.next=this.next,this.next=n):(n.next=e.next,e.next=n),this.pushmod=this.modified=!0,this.length++,n},t.dynamics.ZPP_Contact.prototype.pop=function(){var e=this.next;this.next=e.next,e._inuse=!1,null==this.next&&(this.pushmod=!0),this.modified=!0,this.length--},t.dynamics.ZPP_Contact.prototype.inlined_pop=function(){var e=this.next;this.next=e.next,e._inuse=!1,null==this.next&&(this.pushmod=!0),this.modified=!0,this.length--},t.dynamics.ZPP_Contact.prototype.pop_unsafe=function(){var e=this.next;return this.pop(),e},t.dynamics.ZPP_Contact.prototype.inlined_pop_unsafe=function(){var e=this.next;return this.pop(),e},t.dynamics.ZPP_Contact.prototype.remove=function(e){for(var t=null,n=this.next;null!=n;){if(n==e){var i,r;null==t?(r=(i=this.next).next,this.next=r,null==this.next&&(this.pushmod=!0)):(r=(i=t.next).next,t.next=r,null==r&&(this.pushmod=!0)),i._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0;break}t=n,n=n.next}},t.dynamics.ZPP_Contact.prototype.try_remove=function(e){for(var t=null,n=this.next,i=!1;null!=n;){if(n==e){this.erase(t),i=!0;break}t=n,n=n.next}return i},t.dynamics.ZPP_Contact.prototype.inlined_remove=function(e){for(var t=null,n=this.next;null!=n;){if(n==e){var i,r;null==t?(r=(i=this.next).next,this.next=r,null==this.next&&(this.pushmod=!0)):(r=(i=t.next).next,t.next=r,null==r&&(this.pushmod=!0)),i._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0;break}t=n,n=n.next}},t.dynamics.ZPP_Contact.prototype.inlined_try_remove=function(e){for(var t=null,n=this.next,i=!1;null!=n;){if(n==e){var r,o;null==t?(o=(r=this.next).next,this.next=o,null==this.next&&(this.pushmod=!0)):(o=(r=t.next).next,t.next=o,null==o&&(this.pushmod=!0)),r._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0,i=!0;break}t=n,n=n.next}return i},t.dynamics.ZPP_Contact.prototype.erase=function(e){var t,n;return null==e?(n=(t=this.next).next,this.next=n,null==this.next&&(this.pushmod=!0)):(n=(t=e.next).next,e.next=n,null==n&&(this.pushmod=!0)),t._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0,n},t.dynamics.ZPP_Contact.prototype.inlined_erase=function(e){var t,n;return null==e?(n=(t=this.next).next,this.next=n,null==this.next&&(this.pushmod=!0)):(n=(t=e.next).next,e.next=n,null==n&&(this.pushmod=!0)),t._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0,n},t.dynamics.ZPP_Contact.prototype.splice=function(e,t){for(;t-- >0&&null!=e.next;)this.erase(e);return e.next},t.dynamics.ZPP_Contact.prototype.clear=function(){},t.dynamics.ZPP_Contact.prototype.inlined_clear=function(){},t.dynamics.ZPP_Contact.prototype.reverse=function(){for(var e=this.next,t=null;null!=e;){var n=e.next;e.next=t,this.next=e,t=e,e=n}this.modified=!0,this.pushmod=!0},t.dynamics.ZPP_Contact.prototype.empty=function(){return null==this.next},t.dynamics.ZPP_Contact.prototype.size=function(){return this.length},t.dynamics.ZPP_Contact.prototype.has=function(e){var t;t=!1;for(var n=this.next;null!=n;){if(n==e){t=!0;break}n=n.next}return t},t.dynamics.ZPP_Contact.prototype.inlined_has=function(e){var t;t=!1;for(var n=this.next;null!=n;){if(n==e){t=!0;break}n=n.next}return t},t.dynamics.ZPP_Contact.prototype.front=function(){return this.next},t.dynamics.ZPP_Contact.prototype.back=function(){for(var e=this.next,t=e;null!=t;)e=t,t=t.next;return e},t.dynamics.ZPP_Contact.prototype.iterator_at=function(e){for(var t=this.next;e-- >0&&null!=t;)t=t.next;return t},t.dynamics.ZPP_Contact.prototype.at=function(e){var t=this.iterator_at(e);return null!=t?t:null},t.dynamics.ZPP_Contact.prototype.__class__=t.dynamics.ZPP_Contact,t.dynamics.ZPP_IContact=l["zpp_nape.dynamics.ZPP_IContact"]=function(){this.length=0,this.pushmod=!1,this.modified=!1,this._inuse=!1,this.next=null,this.lr2y=0,this.lr2x=0,this.lr1y=0,this.lr1x=0,this.jtAcc=0,this.jnAcc=0,this.friction=0,this.bounce=0,this.tMass=0,this.nMass=0,this.r2y=0,this.r2x=0,this.r1y=0,this.r1x=0},t.dynamics.ZPP_IContact.__name__=["zpp_nape","dynamics","ZPP_IContact"],t.dynamics.ZPP_IContact.prototype.r1x=null,t.dynamics.ZPP_IContact.prototype.r1y=null,t.dynamics.ZPP_IContact.prototype.r2x=null,t.dynamics.ZPP_IContact.prototype.r2y=null,t.dynamics.ZPP_IContact.prototype.nMass=null,t.dynamics.ZPP_IContact.prototype.tMass=null,t.dynamics.ZPP_IContact.prototype.bounce=null,t.dynamics.ZPP_IContact.prototype.friction=null,t.dynamics.ZPP_IContact.prototype.jnAcc=null,t.dynamics.ZPP_IContact.prototype.jtAcc=null,t.dynamics.ZPP_IContact.prototype.lr1x=null,t.dynamics.ZPP_IContact.prototype.lr1y=null,t.dynamics.ZPP_IContact.prototype.lr2x=null,t.dynamics.ZPP_IContact.prototype.lr2y=null,t.dynamics.ZPP_IContact.prototype.next=null,t.dynamics.ZPP_IContact.prototype.elem=function(){return this},t.dynamics.ZPP_IContact.prototype.begin=function(){return this.next},t.dynamics.ZPP_IContact.prototype._inuse=null,t.dynamics.ZPP_IContact.prototype.modified=null,t.dynamics.ZPP_IContact.prototype.pushmod=null,t.dynamics.ZPP_IContact.prototype.length=null,t.dynamics.ZPP_IContact.prototype.setbegin=function(e){this.next=e,this.modified=!0,this.pushmod=!0},t.dynamics.ZPP_IContact.prototype.add=function(e){e._inuse=!0;var t=e;return t.next=this.next,this.next=t,this.modified=!0,this.length++,e},t.dynamics.ZPP_IContact.prototype.inlined_add=function(e){e._inuse=!0;var t=e;return t.next=this.next,this.next=t,this.modified=!0,this.length++,e},t.dynamics.ZPP_IContact.prototype.addAll=function(e){for(var t=e.next;null!=t;){var n=t;this.add(n),t=t.next}},t.dynamics.ZPP_IContact.prototype.insert=function(e,t){t._inuse=!0;var n=t;return null==e?(n.next=this.next,this.next=n):(n.next=e.next,e.next=n),this.pushmod=this.modified=!0,this.length++,n},t.dynamics.ZPP_IContact.prototype.inlined_insert=function(e,t){t._inuse=!0;var n=t;return null==e?(n.next=this.next,this.next=n):(n.next=e.next,e.next=n),this.pushmod=this.modified=!0,this.length++,n},t.dynamics.ZPP_IContact.prototype.pop=function(){var e=this.next;this.next=e.next,e._inuse=!1,null==this.next&&(this.pushmod=!0),this.modified=!0,this.length--},t.dynamics.ZPP_IContact.prototype.inlined_pop=function(){var e=this.next;this.next=e.next,e._inuse=!1,null==this.next&&(this.pushmod=!0),this.modified=!0,this.length--},t.dynamics.ZPP_IContact.prototype.pop_unsafe=function(){var e=this.next;return this.pop(),e},t.dynamics.ZPP_IContact.prototype.inlined_pop_unsafe=function(){var e=this.next;return this.pop(),e},t.dynamics.ZPP_IContact.prototype.remove=function(e){for(var t=null,n=this.next;null!=n;){if(n==e){var i,r;null==t?(r=(i=this.next).next,this.next=r,null==this.next&&(this.pushmod=!0)):(r=(i=t.next).next,t.next=r,null==r&&(this.pushmod=!0)),i._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0;break}t=n,n=n.next}},t.dynamics.ZPP_IContact.prototype.try_remove=function(e){for(var t=null,n=this.next,i=!1;null!=n;){if(n==e){this.erase(t),i=!0;break}t=n,n=n.next}return i},t.dynamics.ZPP_IContact.prototype.inlined_remove=function(e){for(var t=null,n=this.next;null!=n;){if(n==e){var i,r;null==t?(r=(i=this.next).next,this.next=r,null==this.next&&(this.pushmod=!0)):(r=(i=t.next).next,t.next=r,null==r&&(this.pushmod=!0)),i._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0;break}t=n,n=n.next}},t.dynamics.ZPP_IContact.prototype.inlined_try_remove=function(e){for(var t=null,n=this.next,i=!1;null!=n;){if(n==e){var r,o;null==t?(o=(r=this.next).next,this.next=o,null==this.next&&(this.pushmod=!0)):(o=(r=t.next).next,t.next=o,null==o&&(this.pushmod=!0)),r._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0,i=!0;break}t=n,n=n.next}return i},t.dynamics.ZPP_IContact.prototype.erase=function(e){var t,n;return null==e?(n=(t=this.next).next,this.next=n,null==this.next&&(this.pushmod=!0)):(n=(t=e.next).next,e.next=n,null==n&&(this.pushmod=!0)),t._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0,n},t.dynamics.ZPP_IContact.prototype.inlined_erase=function(e){var t,n;return null==e?(n=(t=this.next).next,this.next=n,null==this.next&&(this.pushmod=!0)):(n=(t=e.next).next,e.next=n,null==n&&(this.pushmod=!0)),t._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0,n},t.dynamics.ZPP_IContact.prototype.splice=function(e,t){for(;t-- >0&&null!=e.next;)this.erase(e);return e.next},t.dynamics.ZPP_IContact.prototype.clear=function(){},t.dynamics.ZPP_IContact.prototype.inlined_clear=function(){},t.dynamics.ZPP_IContact.prototype.reverse=function(){for(var e=this.next,t=null;null!=e;){var n=e.next;e.next=t,this.next=e,t=e,e=n}this.modified=!0,this.pushmod=!0},t.dynamics.ZPP_IContact.prototype.empty=function(){return null==this.next},t.dynamics.ZPP_IContact.prototype.size=function(){return this.length},t.dynamics.ZPP_IContact.prototype.has=function(e){var t;t=!1;for(var n=this.next;null!=n;){if(n==e){t=!0;break}n=n.next}return t},t.dynamics.ZPP_IContact.prototype.inlined_has=function(e){var t;t=!1;for(var n=this.next;null!=n;){if(n==e){t=!0;break}n=n.next}return t},t.dynamics.ZPP_IContact.prototype.front=function(){return this.next},t.dynamics.ZPP_IContact.prototype.back=function(){for(var e=this.next,t=e;null!=t;)e=t,t=t.next;return e},t.dynamics.ZPP_IContact.prototype.iterator_at=function(e){for(var t=this.next;e-- >0&&null!=t;)t=t.next;return t},t.dynamics.ZPP_IContact.prototype.at=function(e){var t=this.iterator_at(e);return null!=t?t:null},t.dynamics.ZPP_IContact.prototype.__class__=t.dynamics.ZPP_IContact,t.dynamics.ZPP_InteractionFilter=l["zpp_nape.dynamics.ZPP_InteractionFilter"]=function(){this.fluidMask=0,this.fluidGroup=0,this.sensorMask=0,this.sensorGroup=0,this.collisionMask=0,this.collisionGroup=0,this.wrap_shapes=null,this.shapes=null,this.outer=null,this.userData=null,this.next=null,this.shapes=new t.util.ZNPList_ZPP_Shape,this.collisionGroup=this.sensorGroup=this.fluidGroup=1,this.collisionMask=this.sensorMask=this.fluidMask=-1},t.dynamics.ZPP_InteractionFilter.__name__=["zpp_nape","dynamics","ZPP_InteractionFilter"],t.dynamics.ZPP_InteractionFilter.prototype.next=null,t.dynamics.ZPP_InteractionFilter.prototype.userData=null,t.dynamics.ZPP_InteractionFilter.prototype.outer=null,t.dynamics.ZPP_InteractionFilter.prototype.wrapper=function(){if(null==this.outer){this.outer=new e.dynamics.InteractionFilter;var n=this.outer.zpp_inner;n.outer=null,n.next=t.dynamics.ZPP_InteractionFilter.zpp_pool,t.dynamics.ZPP_InteractionFilter.zpp_pool=n,this.outer.zpp_inner=this}return this.outer},t.dynamics.ZPP_InteractionFilter.prototype.free=function(){this.outer=null},t.dynamics.ZPP_InteractionFilter.prototype.alloc=function(){},t.dynamics.ZPP_InteractionFilter.prototype.shapes=null,t.dynamics.ZPP_InteractionFilter.prototype.wrap_shapes=null,t.dynamics.ZPP_InteractionFilter.prototype.feature_cons=function(){this.shapes=new t.util.ZNPList_ZPP_Shape},t.dynamics.ZPP_InteractionFilter.prototype.addShape=function(e){this.shapes.add(e)},t.dynamics.ZPP_InteractionFilter.prototype.remShape=function(e){this.shapes.remove(e)},t.dynamics.ZPP_InteractionFilter.prototype.copy=function(){var e;return null==t.dynamics.ZPP_InteractionFilter.zpp_pool?e=new t.dynamics.ZPP_InteractionFilter:(e=t.dynamics.ZPP_InteractionFilter.zpp_pool,t.dynamics.ZPP_InteractionFilter.zpp_pool=e.next,e.next=null),e.collisionGroup=this.collisionGroup,e.collisionMask=this.collisionMask,e.sensorGroup=this.sensorGroup,e.sensorMask=this.sensorMask,e.fluidGroup=this.fluidGroup,e.fluidMask=this.fluidMask,e},t.dynamics.ZPP_InteractionFilter.prototype.collisionGroup=null,t.dynamics.ZPP_InteractionFilter.prototype.collisionMask=null,t.dynamics.ZPP_InteractionFilter.prototype.shouldCollide=function(e){return 0!=(this.collisionMask&e.collisionGroup)&&0!=(e.collisionMask&this.collisionGroup)},t.dynamics.ZPP_InteractionFilter.prototype.sensorGroup=null,t.dynamics.ZPP_InteractionFilter.prototype.sensorMask=null,t.dynamics.ZPP_InteractionFilter.prototype.shouldSense=function(e){return 0!=(this.sensorMask&e.sensorGroup)&&0!=(e.sensorMask&this.sensorGroup)},t.dynamics.ZPP_InteractionFilter.prototype.fluidGroup=null,t.dynamics.ZPP_InteractionFilter.prototype.fluidMask=null,t.dynamics.ZPP_InteractionFilter.prototype.shouldFlow=function(e){return 0!=(this.fluidMask&e.fluidGroup)&&0!=(e.fluidMask&this.fluidGroup)},t.dynamics.ZPP_InteractionFilter.prototype.invalidate=function(){for(var e=this.shapes.head;null!=e;)e.elt.invalidate_filter(),e=e.next},t.dynamics.ZPP_InteractionFilter.prototype.__class__=t.dynamics.ZPP_InteractionFilter,t.dynamics.ZPP_InteractionGroup=l["zpp_nape.dynamics.ZPP_InteractionGroup"]=function(){this.depth=0,this.wrap_interactors=null,this.interactors=null,this.wrap_groups=null,this.groups=null,this.group=null,this.ignore=!1,this.outer=null,this.depth=0,this.groups=new t.util.ZNPList_ZPP_InteractionGroup,this.interactors=new t.util.ZNPList_ZPP_Interactor},t.dynamics.ZPP_InteractionGroup.__name__=["zpp_nape","dynamics","ZPP_InteractionGroup"],t.dynamics.ZPP_InteractionGroup.prototype.outer=null,t.dynamics.ZPP_InteractionGroup.prototype.ignore=null,t.dynamics.ZPP_InteractionGroup.prototype.group=null,t.dynamics.ZPP_InteractionGroup.prototype.setGroup=function(e){this.group!=e&&(null!=this.group&&(this.group.groups.remove(this),this.depth=0,this.group.invalidate(!0)),this.group=e,null!=e?(e.groups.add(this),this.depth=e.depth+1,e.invalidate(!0)):this.invalidate(!0))},t.dynamics.ZPP_InteractionGroup.prototype.groups=null,t.dynamics.ZPP_InteractionGroup.prototype.wrap_groups=null,t.dynamics.ZPP_InteractionGroup.prototype.interactors=null,t.dynamics.ZPP_InteractionGroup.prototype.wrap_interactors=null,t.dynamics.ZPP_InteractionGroup.prototype.depth=null,t.dynamics.ZPP_InteractionGroup.prototype.invalidate=function(e){if(null==e&&(e=!1),e||this.ignore){for(var t=this.interactors.head;null!=t;){var n=t.elt;null!=n.ibody?n.ibody.wake():null!=n.ishape?n.ishape.body.wake():n.icompound.wake(),t=t.next}for(var i=this.groups.head;null!=i;)i.elt.invalidate(e),i=i.next}},t.dynamics.ZPP_InteractionGroup.prototype.addGroup=function(e){this.groups.add(e),e.depth=this.depth+1},t.dynamics.ZPP_InteractionGroup.prototype.remGroup=function(e){this.groups.remove(e),e.depth=0},t.dynamics.ZPP_InteractionGroup.prototype.addInteractor=function(e){this.interactors.add(e)},t.dynamics.ZPP_InteractionGroup.prototype.remInteractor=function(e,t){this.interactors.remove(e)},t.dynamics.ZPP_InteractionGroup.prototype.__class__=t.dynamics.ZPP_InteractionGroup,t.dynamics.ZPP_SpaceArbiterList=l["zpp_nape.dynamics.ZPP_SpaceArbiterList"]=function(){this.at_index_3=0,this.at_index_2=0,this.at_index_1=0,this.at_index_0=0,this.ite_3=null,this.ite_2=null,this.ite_1=null,this.ite_0=null,this.lengths=null,this.zip_length=!1,this._length=0,this.space=null,e.dynamics.ArbiterList.call(this),this.at_index_0=0,this.at_index_1=0,this.at_index_2=0,this.at_index_3=0,this.zip_length=!0,this._length=0,this.lengths=[],this.lengths.push(0),this.lengths.push(0),this.lengths.push(0),this.lengths.push(0)},t.dynamics.ZPP_SpaceArbiterList.__name__=["zpp_nape","dynamics","ZPP_SpaceArbiterList"],t.dynamics.ZPP_SpaceArbiterList.__super__=e.dynamics.ArbiterList,e.dynamics.ArbiterList.prototype)t.dynamics.ZPP_SpaceArbiterList.prototype[u]=e.dynamics.ArbiterList.prototype[u];for(var u in t.dynamics.ZPP_SpaceArbiterList.prototype.space=null,t.dynamics.ZPP_SpaceArbiterList.prototype._length=null,t.dynamics.ZPP_SpaceArbiterList.prototype.zip_length=null,t.dynamics.ZPP_SpaceArbiterList.prototype.zpp_gl=function(){if(this.zpp_vm(),this.zip_length){this._length=0;for(var e=0,t=0,n=this.space.c_arbiters_true.head;null!=n;)n.elt.active&&++t,n=n.next;this.lengths[e++]=t,this._length+=t;for(var i=0,r=this.space.c_arbiters_false.head;null!=r;)r.elt.active&&++i,r=r.next;this.lengths[e++]=i,this._length+=i;for(var o=0,a=this.space.f_arbiters.head;null!=a;)a.elt.active&&++o,a=a.next;this.lengths[e++]=o,this._length+=o;for(var s=0,l=this.space.s_arbiters.head;null!=l;)l.elt.active&&++s,l=l.next;this.lengths[e++]=s,this._length+=s,this.zip_length=!1}return this._length},t.dynamics.ZPP_SpaceArbiterList.prototype.lengths=null,t.dynamics.ZPP_SpaceArbiterList.prototype.ite_0=null,t.dynamics.ZPP_SpaceArbiterList.prototype.ite_1=null,t.dynamics.ZPP_SpaceArbiterList.prototype.ite_2=null,t.dynamics.ZPP_SpaceArbiterList.prototype.ite_3=null,t.dynamics.ZPP_SpaceArbiterList.prototype.at_index_0=null,t.dynamics.ZPP_SpaceArbiterList.prototype.at_index_1=null,t.dynamics.ZPP_SpaceArbiterList.prototype.at_index_2=null,t.dynamics.ZPP_SpaceArbiterList.prototype.at_index_3=null,t.dynamics.ZPP_SpaceArbiterList.prototype.zpp_vm=function(){var e=!1;this.space.c_arbiters_true.modified&&(e=!0,this.space.c_arbiters_true.modified=!1),this.space.c_arbiters_false.modified&&(e=!0,this.space.c_arbiters_false.modified=!1),this.space.f_arbiters.modified&&(e=!0,this.space.f_arbiters.modified=!1),this.space.s_arbiters.modified&&(e=!0,this.space.s_arbiters.modified=!1),e&&(this.zip_length=!0,this._length=0,this.ite_0=null,this.ite_1=null,this.ite_2=null,this.ite_3=null)},t.dynamics.ZPP_SpaceArbiterList.prototype.push=function(e){throw new n._Boot.HaxeError("Error: ArbiterList is immutable")},t.dynamics.ZPP_SpaceArbiterList.prototype.pop=function(){throw new n._Boot.HaxeError("Error: ArbiterList is immutable")},t.dynamics.ZPP_SpaceArbiterList.prototype.unshift=function(e){throw new n._Boot.HaxeError("Error: ArbiterList is immutable")},t.dynamics.ZPP_SpaceArbiterList.prototype.shift=function(){throw new n._Boot.HaxeError("Error: ArbiterList is immutable")},t.dynamics.ZPP_SpaceArbiterList.prototype.remove=function(e){throw new n._Boot.HaxeError("Error: ArbiterList is immutable")},t.dynamics.ZPP_SpaceArbiterList.prototype.clear=function(){throw new n._Boot.HaxeError("Error: ArbiterList is immutable")},t.dynamics.ZPP_SpaceArbiterList.prototype.at=function(e){if(this.zpp_vm(),e<0||e>=this.zpp_gl())throw new n._Boot.HaxeError("Error: Index out of bounds");var t=null,i=0;if(null==t)if(e<i+this.lengths[0]){var r=e-i;if(r<this.at_index_0||null==this.ite_0)for(this.at_index_0=0,this.ite_0=this.space.c_arbiters_true.head;!this.ite_0.elt.active;)this.ite_0=this.ite_0.next;for(;this.at_index_0!=r;)for(this.at_index_0++,this.ite_0=this.ite_0.next;!this.ite_0.elt.active;)this.ite_0=this.ite_0.next;t=this.ite_0.elt.wrapper()}else i+=this.lengths[0];if(null==t)if(e<i+this.lengths[1]){var o=e-i;if(o<this.at_index_1||null==this.ite_1)for(this.at_index_1=0,this.ite_1=this.space.c_arbiters_false.head;!this.ite_1.elt.active;)this.ite_1=this.ite_1.next;for(;this.at_index_1!=o;)for(this.at_index_1++,this.ite_1=this.ite_1.next;!this.ite_1.elt.active;)this.ite_1=this.ite_1.next;t=this.ite_1.elt.wrapper()}else i+=this.lengths[1];if(null==t)if(e<i+this.lengths[2]){var a=e-i;if(a<this.at_index_2||null==this.ite_2)for(this.at_index_2=0,this.ite_2=this.space.f_arbiters.head;!this.ite_2.elt.active;)this.ite_2=this.ite_2.next;for(;this.at_index_2!=a;)for(this.at_index_2++,this.ite_2=this.ite_2.next;!this.ite_2.elt.active;)this.ite_2=this.ite_2.next;t=this.ite_2.elt.wrapper()}else i+=this.lengths[2];if(null==t)if(e<i+this.lengths[3]){var s=e-i;if(s<this.at_index_3||null==this.ite_3)for(this.at_index_3=0,this.ite_3=this.space.s_arbiters.head;!this.ite_3.elt.active;)this.ite_3=this.ite_3.next;for(;this.at_index_3!=s;)for(this.at_index_3++,this.ite_3=this.ite_3.next;!this.ite_3.elt.active;)this.ite_3=this.ite_3.next;t=this.ite_3.elt.wrapper()}else i+=this.lengths[3];return t},t.dynamics.ZPP_SpaceArbiterList.prototype.__class__=t.dynamics.ZPP_SpaceArbiterList,t.geom||(t.geom={}),t.geom.ZPP_AABB=l["zpp_nape.geom.ZPP_AABB"]=function(){this.wrap_max=null,this.maxy=0,this.maxx=0,this.wrap_min=null,this.miny=0,this.minx=0,this.next=null,this.outer=null,this._immutable=!1,this._validate=null,this._invalidate=null},t.geom.ZPP_AABB.__name__=["zpp_nape","geom","ZPP_AABB"],t.geom.ZPP_AABB.get=function(e,n,i,r){var o;return null==t.geom.ZPP_AABB.zpp_pool?o=new t.geom.ZPP_AABB:(o=t.geom.ZPP_AABB.zpp_pool,t.geom.ZPP_AABB.zpp_pool=o.next,o.next=null),o.minx=e,o.miny=n,o.maxx=i,o.maxy=r,o},t.geom.ZPP_AABB.prototype._invalidate=null,t.geom.ZPP_AABB.prototype._validate=null,t.geom.ZPP_AABB.prototype._immutable=null,t.geom.ZPP_AABB.prototype.validate=function(){null!=this._validate&&this._validate()},t.geom.ZPP_AABB.prototype.invalidate=function(){null!=this._invalidate&&this._invalidate(this)},t.geom.ZPP_AABB.prototype.outer=null,t.geom.ZPP_AABB.prototype.wrapper=function(){if(null==this.outer){this.outer=new e.geom.AABB;var n=this.outer.zpp_inner;null!=n.outer&&(n.outer.zpp_inner=null,n.outer=null),n.wrap_min=n.wrap_max=null,n._invalidate=null,n._validate=null,n.next=t.geom.ZPP_AABB.zpp_pool,t.geom.ZPP_AABB.zpp_pool=n,this.outer.zpp_inner=this}return this.outer},t.geom.ZPP_AABB.prototype.next=null,t.geom.ZPP_AABB.prototype.alloc=function(){},t.geom.ZPP_AABB.prototype.free=function(){null!=this.outer&&(this.outer.zpp_inner=null,this.outer=null),this.wrap_min=this.wrap_max=null,this._invalidate=null,this._validate=null},t.geom.ZPP_AABB.prototype.copy=function(){var e,n=this.minx,i=this.miny,r=this.maxx,o=this.maxy;return null==t.geom.ZPP_AABB.zpp_pool?e=new t.geom.ZPP_AABB:(e=t.geom.ZPP_AABB.zpp_pool,t.geom.ZPP_AABB.zpp_pool=e.next,e.next=null),e.minx=n,e.miny=i,e.maxx=r,e.maxy=o,e},t.geom.ZPP_AABB.prototype.width=function(){return this.maxx-this.minx},t.geom.ZPP_AABB.prototype.height=function(){return this.maxy-this.miny},t.geom.ZPP_AABB.prototype.perimeter=function(){return 2*(this.maxx-this.minx+(this.maxy-this.miny))},t.geom.ZPP_AABB.prototype.minx=null,t.geom.ZPP_AABB.prototype.miny=null,t.geom.ZPP_AABB.prototype.wrap_min=null,t.geom.ZPP_AABB.prototype.getmin=function(){if(null==this.wrap_min){var i,r=this.minx,o=this.miny;if(null==o&&(o=0),null==r&&(r=0),r!=r||o!=o)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null==t.util.ZPP_PubPool.poolVec2?i=new e.geom.Vec2:(i=t.util.ZPP_PubPool.poolVec2,t.util.ZPP_PubPool.poolVec2=i.zpp_pool,i.zpp_pool=null,i.zpp_disp=!1,i==t.util.ZPP_PubPool.nextVec2&&(t.util.ZPP_PubPool.nextVec2=null)),null==i.zpp_inner){var a;null==t.geom.ZPP_Vec2.zpp_pool?a=new t.geom.ZPP_Vec2:(a=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=a.next,a.next=null),a.weak=!1,a._immutable=!1,a.x=r,a.y=o,i.zpp_inner=a,i.zpp_inner.outer=i}else{if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var s,l=i.zpp_inner;if(l._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=l._isimmutable&&l._isimmutable(),r!=r||o!=o)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var u=i.zpp_inner;if(null!=u._validate&&u._validate(),i.zpp_inner.x==r){if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var h=i.zpp_inner;null!=h._validate&&h._validate(),s=i.zpp_inner.y==o}else s=!1;if(!s){i.zpp_inner.x=r,i.zpp_inner.y=o;var c=i.zpp_inner;null!=c._invalidate&&c._invalidate(c)}}i.zpp_inner.weak=!1,this.wrap_min=i,this.wrap_min.zpp_inner._inuse=!0,this._immutable?this.wrap_min.zpp_inner._immutable=!0:this.wrap_min.zpp_inner._invalidate=p(this,this.mod_min),this.wrap_min.zpp_inner._validate=p(this,this.dom_min)}return this.wrap_min},t.geom.ZPP_AABB.prototype.dom_min=function(){null!=this._validate&&this._validate(),this.wrap_min.zpp_inner.x=this.minx,this.wrap_min.zpp_inner.y=this.miny},t.geom.ZPP_AABB.prototype.mod_min=function(e){e.x==this.minx&&e.y==this.miny||(this.minx=e.x,this.miny=e.y,null!=this._invalidate&&this._invalidate(this))},t.geom.ZPP_AABB.prototype.maxx=null,t.geom.ZPP_AABB.prototype.maxy=null,t.geom.ZPP_AABB.prototype.wrap_max=null,t.geom.ZPP_AABB.prototype.getmax=function(){if(null==this.wrap_max){var i,r=this.maxx,o=this.maxy;if(null==o&&(o=0),null==r&&(r=0),r!=r||o!=o)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null==t.util.ZPP_PubPool.poolVec2?i=new e.geom.Vec2:(i=t.util.ZPP_PubPool.poolVec2,t.util.ZPP_PubPool.poolVec2=i.zpp_pool,i.zpp_pool=null,i.zpp_disp=!1,i==t.util.ZPP_PubPool.nextVec2&&(t.util.ZPP_PubPool.nextVec2=null)),null==i.zpp_inner){var a;null==t.geom.ZPP_Vec2.zpp_pool?a=new t.geom.ZPP_Vec2:(a=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=a.next,a.next=null),a.weak=!1,a._immutable=!1,a.x=r,a.y=o,i.zpp_inner=a,i.zpp_inner.outer=i}else{if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var s,l=i.zpp_inner;if(l._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=l._isimmutable&&l._isimmutable(),r!=r||o!=o)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var u=i.zpp_inner;if(null!=u._validate&&u._validate(),i.zpp_inner.x==r){if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var h=i.zpp_inner;null!=h._validate&&h._validate(),s=i.zpp_inner.y==o}else s=!1;if(!s){i.zpp_inner.x=r,i.zpp_inner.y=o;var c=i.zpp_inner;null!=c._invalidate&&c._invalidate(c)}}i.zpp_inner.weak=!1,this.wrap_max=i,this.wrap_max.zpp_inner._inuse=!0,this._immutable?this.wrap_max.zpp_inner._immutable=!0:this.wrap_max.zpp_inner._invalidate=p(this,this.mod_max),this.wrap_max.zpp_inner._validate=p(this,this.dom_max)}return this.wrap_max},t.geom.ZPP_AABB.prototype.dom_max=function(){null!=this._validate&&this._validate(),this.wrap_max.zpp_inner.x=this.maxx,this.wrap_max.zpp_inner.y=this.maxy},t.geom.ZPP_AABB.prototype.mod_max=function(e){e.x==this.maxx&&e.y==this.maxy||(this.maxx=e.x,this.maxy=e.y,null!=this._invalidate&&this._invalidate(this))},t.geom.ZPP_AABB.prototype.intersectX=function(e){return!(e.minx>this.maxx||this.minx>e.maxx)},t.geom.ZPP_AABB.prototype.intersectY=function(e){return!(e.miny>this.maxy||this.miny>e.maxy)},t.geom.ZPP_AABB.prototype.intersect=function(e){return e.miny<=this.maxy&&this.miny<=e.maxy&&e.minx<=this.maxx&&this.minx<=e.maxx},t.geom.ZPP_AABB.prototype.combine=function(e){e.minx<this.minx&&(this.minx=e.minx),e.maxx>this.maxx&&(this.maxx=e.maxx),e.miny<this.miny&&(this.miny=e.miny),e.maxy>this.maxy&&(this.maxy=e.maxy)},t.geom.ZPP_AABB.prototype.contains=function(e){return e.minx>=this.minx&&e.miny>=this.miny&&e.maxx<=this.maxx&&e.maxy<=this.maxy},t.geom.ZPP_AABB.prototype.containsPoint=function(e){return e.x>=this.minx&&e.x<=this.maxx&&e.y>=this.miny&&e.y<=this.maxy},t.geom.ZPP_AABB.prototype.setCombine=function(e,t){this.minx=e.minx<t.minx?e.minx:t.minx,this.miny=e.miny<t.miny?e.miny:t.miny,this.maxx=e.maxx>t.maxx?e.maxx:t.maxx,this.maxy=e.maxy>t.maxy?e.maxy:t.maxy},t.geom.ZPP_AABB.prototype.setExpand=function(e,t){this.minx=e.minx-t,this.miny=e.miny-t,this.maxx=e.maxx+t,this.maxy=e.maxy+t},t.geom.ZPP_AABB.prototype.setExpandPoint=function(e,t){e<this.minx&&(this.minx=e),e>this.maxx&&(this.maxx=e),t<this.miny&&(this.miny=t),t>this.maxy&&(this.maxy=t)},t.geom.ZPP_AABB.prototype.toString=function(){return"{ x: "+this.minx+" y: "+this.miny+" w: "+(this.maxx-this.minx)+" h: "+(this.maxy-this.miny)+" }"},t.geom.ZPP_AABB.prototype.__class__=t.geom.ZPP_AABB,t.util.ZNPList_ZPP_Vec2=l["zpp_nape.util.ZNPList_ZPP_Vec2"]=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null},t.util.ZNPList_ZPP_Vec2.__name__=["zpp_nape","util","ZNPList_ZPP_Vec2"],t.util.ZNPList_ZPP_Vec2.prototype.head=null,t.util.ZNPList_ZPP_Vec2.prototype.begin=function(){return this.head},t.util.ZNPList_ZPP_Vec2.prototype.modified=null,t.util.ZNPList_ZPP_Vec2.prototype.pushmod=null,t.util.ZNPList_ZPP_Vec2.prototype.length=null,t.util.ZNPList_ZPP_Vec2.prototype.setbegin=function(e){this.head=e,this.modified=!0,this.pushmod=!0},t.util.ZNPList_ZPP_Vec2.prototype.add=function(e){var n;null==t.util.ZNPNode_ZPP_Vec2.zpp_pool?n=new t.util.ZNPNode_ZPP_Vec2:(n=t.util.ZNPNode_ZPP_Vec2.zpp_pool,t.util.ZNPNode_ZPP_Vec2.zpp_pool=n.next,n.next=null),n.elt=e;var i=n;return i.next=this.head,this.head=i,this.modified=!0,this.length++,e},t.util.ZNPList_ZPP_Vec2.prototype.inlined_add=function(e){var n;null==t.util.ZNPNode_ZPP_Vec2.zpp_pool?n=new t.util.ZNPNode_ZPP_Vec2:(n=t.util.ZNPNode_ZPP_Vec2.zpp_pool,t.util.ZNPNode_ZPP_Vec2.zpp_pool=n.next,n.next=null),n.elt=e;var i=n;return i.next=this.head,this.head=i,this.modified=!0,this.length++,e},t.util.ZNPList_ZPP_Vec2.prototype.addAll=function(e){for(var t=e.head;null!=t;){var n=t.elt;this.add(n),t=t.next}},t.util.ZNPList_ZPP_Vec2.prototype.insert=function(e,n){var i;null==t.util.ZNPNode_ZPP_Vec2.zpp_pool?i=new t.util.ZNPNode_ZPP_Vec2:(i=t.util.ZNPNode_ZPP_Vec2.zpp_pool,t.util.ZNPNode_ZPP_Vec2.zpp_pool=i.next,i.next=null),i.elt=n;var r=i;return null==e?(r.next=this.head,this.head=r):(r.next=e.next,e.next=r),this.pushmod=this.modified=!0,this.length++,r},t.util.ZNPList_ZPP_Vec2.prototype.inlined_insert=function(e,n){var i;null==t.util.ZNPNode_ZPP_Vec2.zpp_pool?i=new t.util.ZNPNode_ZPP_Vec2:(i=t.util.ZNPNode_ZPP_Vec2.zpp_pool,t.util.ZNPNode_ZPP_Vec2.zpp_pool=i.next,i.next=null),i.elt=n;var r=i;return null==e?(r.next=this.head,this.head=r):(r.next=e.next,e.next=r),this.pushmod=this.modified=!0,this.length++,r},t.util.ZNPList_ZPP_Vec2.prototype.pop=function(){var e=this.head;this.head=e.next;var n=e;n.elt=null,n.next=t.util.ZNPNode_ZPP_Vec2.zpp_pool,t.util.ZNPNode_ZPP_Vec2.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},t.util.ZNPList_ZPP_Vec2.prototype.inlined_pop=function(){var e=this.head;this.head=e.next;var n=e;n.elt=null,n.next=t.util.ZNPNode_ZPP_Vec2.zpp_pool,t.util.ZNPNode_ZPP_Vec2.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},t.util.ZNPList_ZPP_Vec2.prototype.pop_unsafe=function(){var e=this.head.elt;return this.pop(),e},t.util.ZNPList_ZPP_Vec2.prototype.inlined_pop_unsafe=function(){var e=this.head.elt;return this.pop(),e},t.util.ZNPList_ZPP_Vec2.prototype.remove=function(e){for(var n=null,i=this.head;null!=i;){if(i.elt==e){var r,o;null==n?(o=(r=this.head).next,this.head=o,null==this.head&&(this.pushmod=!0)):(o=(r=n.next).next,n.next=o,null==o&&(this.pushmod=!0));var a=r;a.elt=null,a.next=t.util.ZNPNode_ZPP_Vec2.zpp_pool,t.util.ZNPNode_ZPP_Vec2.zpp_pool=a,this.modified=!0,this.length--,this.pushmod=!0;break}n=i,i=i.next}},t.util.ZNPList_ZPP_Vec2.prototype.try_remove=function(e){for(var t=null,n=this.head,i=!1;null!=n;){if(n.elt==e){this.erase(t),i=!0;break}t=n,n=n.next}return i},t.util.ZNPList_ZPP_Vec2.prototype.inlined_remove=function(e){for(var n=null,i=this.head;null!=i;){if(i.elt==e){var r,o;null==n?(o=(r=this.head).next,this.head=o,null==this.head&&(this.pushmod=!0)):(o=(r=n.next).next,n.next=o,null==o&&(this.pushmod=!0));var a=r;a.elt=null,a.next=t.util.ZNPNode_ZPP_Vec2.zpp_pool,t.util.ZNPNode_ZPP_Vec2.zpp_pool=a,this.modified=!0,this.length--,this.pushmod=!0;break}n=i,i=i.next}},t.util.ZNPList_ZPP_Vec2.prototype.inlined_try_remove=function(e){for(var n=null,i=this.head,r=!1;null!=i;){if(i.elt==e){var o,a;null==n?(a=(o=this.head).next,this.head=a,null==this.head&&(this.pushmod=!0)):(a=(o=n.next).next,n.next=a,null==a&&(this.pushmod=!0));var s=o;s.elt=null,s.next=t.util.ZNPNode_ZPP_Vec2.zpp_pool,t.util.ZNPNode_ZPP_Vec2.zpp_pool=s,this.modified=!0,this.length--,this.pushmod=!0,r=!0;break}n=i,i=i.next}return r},t.util.ZNPList_ZPP_Vec2.prototype.erase=function(e){var n,i;null==e?(i=(n=this.head).next,this.head=i,null==this.head&&(this.pushmod=!0)):(i=(n=e.next).next,e.next=i,null==i&&(this.pushmod=!0));var r=n;return r.elt=null,r.next=t.util.ZNPNode_ZPP_Vec2.zpp_pool,t.util.ZNPNode_ZPP_Vec2.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,i},t.util.ZNPList_ZPP_Vec2.prototype.inlined_erase=function(e){var n,i;null==e?(i=(n=this.head).next,this.head=i,null==this.head&&(this.pushmod=!0)):(i=(n=e.next).next,e.next=i,null==i&&(this.pushmod=!0));var r=n;return r.elt=null,r.next=t.util.ZNPNode_ZPP_Vec2.zpp_pool,t.util.ZNPNode_ZPP_Vec2.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,i},t.util.ZNPList_ZPP_Vec2.prototype.splice=function(e,t){for(;t-- >0&&null!=e.next;)this.erase(e);return e.next},t.util.ZNPList_ZPP_Vec2.prototype.clear=function(){for(;null!=this.head;){var e=this.head;this.head=e.next;var n=e;n.elt=null,n.next=t.util.ZNPNode_ZPP_Vec2.zpp_pool,t.util.ZNPNode_ZPP_Vec2.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},t.util.ZNPList_ZPP_Vec2.prototype.inlined_clear=function(){for(;null!=this.head;){var e=this.head;this.head=e.next;var n=e;n.elt=null,n.next=t.util.ZNPNode_ZPP_Vec2.zpp_pool,t.util.ZNPNode_ZPP_Vec2.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},t.util.ZNPList_ZPP_Vec2.prototype.reverse=function(){for(var e=this.head,t=null;null!=e;){var n=e.next;e.next=t,this.head=e,t=e,e=n}this.modified=!0,this.pushmod=!0},t.util.ZNPList_ZPP_Vec2.prototype.empty=function(){return null==this.head},t.util.ZNPList_ZPP_Vec2.prototype.size=function(){return this.length},t.util.ZNPList_ZPP_Vec2.prototype.has=function(e){var t;t=!1;for(var n=this.head;null!=n;){if(n.elt==e){t=!0;break}n=n.next}return t},t.util.ZNPList_ZPP_Vec2.prototype.inlined_has=function(e){var t;t=!1;for(var n=this.head;null!=n;){if(n.elt==e){t=!0;break}n=n.next}return t},t.util.ZNPList_ZPP_Vec2.prototype.front=function(){return this.head.elt},t.util.ZNPList_ZPP_Vec2.prototype.back=function(){for(var e=this.head,t=e;null!=t;)e=t,t=t.next;return e.elt},t.util.ZNPList_ZPP_Vec2.prototype.iterator_at=function(e){for(var t=this.head;e-- >0&&null!=t;)t=t.next;return t},t.util.ZNPList_ZPP_Vec2.prototype.at=function(e){var t=this.iterator_at(e);return null!=t?t.elt:null},t.util.ZNPList_ZPP_Vec2.prototype.__class__=t.util.ZNPList_ZPP_Vec2,t.geom.ZPP_Collide=l["zpp_nape.geom.ZPP_Collide"]=function(){},t.geom.ZPP_Collide.__name__=["zpp_nape","geom","ZPP_Collide"],t.geom.ZPP_Collide.circleContains=function(e,t){var n,i;return(n=t.x-e.worldCOMx)*n+(i=t.y-e.worldCOMy)*i<e.radius*e.radius},t.geom.ZPP_Collide.polyContains=function(e,t){var n;n=!0;for(var i=e.edges.head;null!=i;){var r=i.elt;if(!(r.gnormx*t.x+r.gnormy*t.y<=r.gprojection)){n=!1;break}i=i.next}return n},t.geom.ZPP_Collide.shapeContains=function(e,n){return 0==e.type?t.geom.ZPP_Collide.circleContains(e.circle,n):t.geom.ZPP_Collide.polyContains(e.polygon,n)},t.geom.ZPP_Collide.bodyContains=function(e,n){var i;i=!1;for(var r=e.shapes.head;null!=r;){var o=r.elt;if(t.geom.ZPP_Collide.shapeContains(o,n)){i=!0;break}r=r.next}return i},t.geom.ZPP_Collide.containTest=function(e,t){var n=e.aabb,i=t.aabb;if(i.minx>=n.minx&&i.miny>=n.miny&&i.maxx<=n.maxx&&i.maxy<=n.maxy){if(0==e.type){if(0==t.type){var r,o,a=e.circle.radius+-t.circle.radius;return(r=t.circle.worldCOMx-e.circle.worldCOMx)*r+(o=t.circle.worldCOMy-e.circle.worldCOMy)*o<=a*a}var s;s=!0;for(var l=t.polygon.gverts.next;null!=l;){var p,u,h=l,c=e.circle.radius;if(!((p=h.x-e.circle.worldCOMx)*p+(u=h.y-e.circle.worldCOMy)*u<=c*c)){s=!1;break}l=l.next}return s}if(0==t.type){var _;_=!0;for(var d=e.polygon.edges.head;null!=d;){var m=d.elt;if(!(m.gnormx*t.circle.worldCOMx+m.gnormy*t.circle.worldCOMy+t.circle.radius<=m.gprojection)){_=!1;break}d=d.next}return _}var P;P=!0;for(var f=e.polygon.edges.head;null!=f;){for(var x=f.elt,y=-1e100,v=t.polygon.gverts.next;null!=v;){var g=v,b=x.gnormx*g.x+x.gnormy*g.y;b>y&&(y=b),v=v.next}if(!(y<=x.gprojection)){P=!1;break}f=f.next}return P}return!1},t.geom.ZPP_Collide.contactCollide=function(n,i,r,o){if(1==i.type){if(1==n.type){for(var a=!0,s=-1e100,l=-1,p=null,u=null,h=n.polygon.edges.head;null!=h;){for(var c=h.elt,_=1e100,d=i.polygon.gverts.next;null!=d;){var m=d,P=c.gnormx*m.x+c.gnormy*m.y;if(P<_&&(_=P),_-c.gprojection<=s)break;d=d.next}if((_-=c.gprojection)>=0){a=!1;break}_>s&&(s=_,p=c,l=1),h=h.next}if(a){for(var f=i.polygon.edges.head;null!=f;){for(var x=f.elt,y=1e100,v=n.polygon.gverts.next;null!=v;){var g=v,b=x.gnormx*g.x+x.gnormy*g.y;if(b<y&&(y=b),y-x.gprojection<=s)break;v=v.next}if((y-=x.gprojection)>=0){a=!1;break}y>s&&(s=y,u=x,l=2),f=f.next}if(a){var z,w,Z;1==l?(z=i.polygon,w=p,Z=1):(z=n.polygon,w=u,Z=-1);for(var E=null,M=1e100,S=z.edges.head;null!=S;){var C=S.elt,N=w.gnormx*C.gnormx+w.gnormy*C.gnormy;N<M&&(M=N,E=C),S=S.next}var A=0,L=0;A=E.gp0.x,L=E.gp0.y;var B,T,V=0,k=0;B=(V=E.gp1.x)-A,T=(k=E.gp1.y)-L;var I=w.gnormy*A-w.gnormx*L,O=w.gnormy*V-w.gnormx*k,R=1/(O-I),H=(-w.tp1-I)*R;H>e.Config.epsilon&&(A+=B*H,L+=T*H);var F=(-w.tp0-O)*R;F<-e.Config.epsilon&&(V+=B*F,k+=T*F);var D=0,G=0,U=Z;D=w.gnormx*U,G=w.gnormy*U,r.lnormx=w.lnormx,r.lnormy=w.lnormy,r.lproj=w.lprojection,r.radius=0,r.rev=o!=(-1==Z),r.ptype=r.rev?1:0;var j=A*w.gnormx+L*w.gnormy-w.gprojection,W=V*w.gnormx+k*w.gnormy-w.gprojection;if(j>0&&W>0)return!1;o&&(D=-D,G=-G);var q=A-w.gnormx*j*.5,J=L-w.gnormy*j*.5,$=r.rev?1:0,X=j>0;null==X&&(X=!1);for(var Y=null,K=r.contacts.next;null!=K;){var Q=K;if($==Q.hash){Y=Q;break}K=K.next}if(null==Y){null==t.dynamics.ZPP_Contact.zpp_pool?Y=new t.dynamics.ZPP_Contact:(Y=t.dynamics.ZPP_Contact.zpp_pool,t.dynamics.ZPP_Contact.zpp_pool=Y.next,Y.next=null);var ee=Y.inner;ee.jnAcc=ee.jtAcc=0,Y.hash=$,Y.fresh=!0,Y.arbiter=r,r.jrAcc=0;var te=r.contacts;Y._inuse=!0;var ne=Y;ne.next=te.next,te.next=ne,te.modified=!0,te.length++,r.innards.add(ee)}else Y.fresh=!1;Y.px=q,Y.py=J,r.nx=D,r.ny=G,Y.dist=j,Y.stamp=r.stamp,Y.posOnly=X;var ie=Y;A-=1*z.body.posx,L-=1*z.body.posy,ie.inner.lr1x=A*z.body.axisy+L*z.body.axisx,ie.inner.lr1y=L*z.body.axisy-A*z.body.axisx;var re=V-w.gnormx*W*.5,oe=k-w.gnormy*W*.5,ae=r.rev?0:1,se=W>0;null==se&&(se=!1);for(var le=null,pe=r.contacts.next;null!=pe;){var ue=pe;if(ae==ue.hash){le=ue;break}pe=pe.next}if(null==le){null==t.dynamics.ZPP_Contact.zpp_pool?le=new t.dynamics.ZPP_Contact:(le=t.dynamics.ZPP_Contact.zpp_pool,t.dynamics.ZPP_Contact.zpp_pool=le.next,le.next=null);var he=le.inner;he.jnAcc=he.jtAcc=0,le.hash=ae,le.fresh=!0,le.arbiter=r,r.jrAcc=0;var ce=r.contacts;le._inuse=!0;var _e=le;_e.next=ce.next,ce.next=_e,ce.modified=!0,ce.length++,r.innards.add(he)}else le.fresh=!1;return le.px=re,le.py=oe,r.nx=D,r.ny=G,le.dist=W,le.stamp=r.stamp,le.posOnly=se,ie=le,V-=1*z.body.posx,k-=1*z.body.posy,ie.inner.lr1x=V*z.body.axisy+k*z.body.axisx,ie.inner.lr1y=k*z.body.axisy-V*z.body.axisx,1==l?(r.__ref_edge1=w,r.__ref_edge2=E):(r.__ref_edge2=w,r.__ref_edge1=E),!0}return!1}return!1}for(var de=-1e100,me=!0,Pe=null,fe=null,xe=i.polygon.gverts.next,ye=i.polygon.edges.head;null!=ye;){var ve=ye.elt,ge=ve.gnormx*n.circle.worldCOMx+ve.gnormy*n.circle.worldCOMy-ve.gprojection-n.circle.radius;if(ge>0){me=!1;break}ge>de&&(de=ge,Pe=ve,fe=xe),xe=xe.next,ye=ye.next}if(me){var be=fe,ze=null==fe.next?i.polygon.gverts.next:fe.next,we=n.circle.worldCOMy*Pe.gnormx-n.circle.worldCOMx*Pe.gnormy;if(we<=be.y*Pe.gnormx-be.x*Pe.gnormy){var Ze,Ee,Me,Se=n.circle.radius,Ce=(Ze=be.x-n.circle.worldCOMx)*Ze+(Ee=be.y-n.circle.worldCOMy)*Ee;if(Ce>Se*Se)Me=null;else if(Ce<e.Config.epsilon*e.Config.epsilon){for(var Ne=n.circle.worldCOMx,Ae=n.circle.worldCOMy,Le=null,Be=r.contacts.next;null!=Be;){var Te=Be;if(0==Te.hash){Le=Te;break}Be=Be.next}if(null==Le){null==t.dynamics.ZPP_Contact.zpp_pool?Le=new t.dynamics.ZPP_Contact:(Le=t.dynamics.ZPP_Contact.zpp_pool,t.dynamics.ZPP_Contact.zpp_pool=Le.next,Le.next=null);var Ve=Le.inner;Ve.jnAcc=Ve.jtAcc=0,Le.hash=0,Le.fresh=!0,Le.arbiter=r,r.jrAcc=0;var ke=r.contacts;Le._inuse=!0;var Ie=Le;Ie.next=ke.next,ke.next=Ie,ke.modified=!0,ke.length++,r.innards.add(Ve)}else Le.fresh=!1;Le.px=Ne,Le.py=Ae,r.nx=1,r.ny=0,Le.dist=-Se,Le.stamp=r.stamp,Le.posOnly=!1,Me=Le}else{var Oe=1/Math.sqrt(Ce),Re=Oe<e.Config.epsilon?1e100:1/Oe,He=.5+(n.circle.radius-.5*Se)*Oe;if(o){for(var Fe=n.circle.worldCOMx+Ze*He,De=n.circle.worldCOMy+Ee*He,Ge=null,Ue=r.contacts.next;null!=Ue;){var je=Ue;if(0==je.hash){Ge=je;break}Ue=Ue.next}if(null==Ge){null==t.dynamics.ZPP_Contact.zpp_pool?Ge=new t.dynamics.ZPP_Contact:(Ge=t.dynamics.ZPP_Contact.zpp_pool,t.dynamics.ZPP_Contact.zpp_pool=Ge.next,Ge.next=null);var We=Ge.inner;We.jnAcc=We.jtAcc=0,Ge.hash=0,Ge.fresh=!0,Ge.arbiter=r,r.jrAcc=0;var qe=r.contacts;Ge._inuse=!0;var Je=Ge;Je.next=qe.next,qe.next=Je,qe.modified=!0,qe.length++,r.innards.add(We)}else Ge.fresh=!1;Ge.px=Fe,Ge.py=De,r.nx=-Ze*Oe,r.ny=-Ee*Oe,Ge.dist=Re-Se,Ge.stamp=r.stamp,Ge.posOnly=!1,Me=Ge}else{for(var $e=n.circle.worldCOMx+Ze*He,Xe=n.circle.worldCOMy+Ee*He,Ye=null,Ke=r.contacts.next;null!=Ke;){var Qe=Ke;if(0==Qe.hash){Ye=Qe;break}Ke=Ke.next}if(null==Ye){null==t.dynamics.ZPP_Contact.zpp_pool?Ye=new t.dynamics.ZPP_Contact:(Ye=t.dynamics.ZPP_Contact.zpp_pool,t.dynamics.ZPP_Contact.zpp_pool=Ye.next,Ye.next=null);var et=Ye.inner;et.jnAcc=et.jtAcc=0,Ye.hash=0,Ye.fresh=!0,Ye.arbiter=r,r.jrAcc=0;var tt=r.contacts;Ye._inuse=!0;var nt=Ye;nt.next=tt.next,tt.next=nt,tt.modified=!0,tt.length++,r.innards.add(et)}else Ye.fresh=!1;Ye.px=$e,Ye.py=Xe,r.nx=Ze*Oe,r.ny=Ee*Oe,Ye.dist=Re-Se,Ye.stamp=r.stamp,Ye.posOnly=!1,Me=Ye}}if(null!=Me){var it,rt,ot=Me.inner;r.ptype=2,it=be.x-i.polygon.body.posx,rt=be.y-i.polygon.body.posy,r.__ref_edge1=Pe,r.__ref_vertex=-1,o?(ot.lr1x=it*i.polygon.body.axisy+rt*i.polygon.body.axisx,ot.lr1y=rt*i.polygon.body.axisy-it*i.polygon.body.axisx,ot.lr2x=n.circle.localCOMx,ot.lr2y=n.circle.localCOMy):(ot.lr2x=it*i.polygon.body.axisy+rt*i.polygon.body.axisx,ot.lr2y=rt*i.polygon.body.axisy-it*i.polygon.body.axisx,ot.lr1x=n.circle.localCOMx,ot.lr1y=n.circle.localCOMy),r.radius=n.circle.radius}return null!=Me}if(we>=ze.y*Pe.gnormx-ze.x*Pe.gnormy){var at,st,lt,pt=n.circle.radius,ut=(at=ze.x-n.circle.worldCOMx)*at+(st=ze.y-n.circle.worldCOMy)*st;if(ut>pt*pt)lt=null;else if(ut<e.Config.epsilon*e.Config.epsilon){for(var ht=n.circle.worldCOMx,ct=n.circle.worldCOMy,_t=null,dt=r.contacts.next;null!=dt;){var mt=dt;if(0==mt.hash){_t=mt;break}dt=dt.next}if(null==_t){null==t.dynamics.ZPP_Contact.zpp_pool?_t=new t.dynamics.ZPP_Contact:(_t=t.dynamics.ZPP_Contact.zpp_pool,t.dynamics.ZPP_Contact.zpp_pool=_t.next,_t.next=null);var Pt=_t.inner;Pt.jnAcc=Pt.jtAcc=0,_t.hash=0,_t.fresh=!0,_t.arbiter=r,r.jrAcc=0;var ft=r.contacts;_t._inuse=!0;var xt=_t;xt.next=ft.next,ft.next=xt,ft.modified=!0,ft.length++,r.innards.add(Pt)}else _t.fresh=!1;_t.px=ht,_t.py=ct,r.nx=1,r.ny=0,_t.dist=-pt,_t.stamp=r.stamp,_t.posOnly=!1,lt=_t}else{var yt=1/Math.sqrt(ut),vt=yt<e.Config.epsilon?1e100:1/yt,gt=.5+(n.circle.radius-.5*pt)*yt;if(o){for(var bt=n.circle.worldCOMx+at*gt,zt=n.circle.worldCOMy+st*gt,wt=null,Zt=r.contacts.next;null!=Zt;){var Et=Zt;if(0==Et.hash){wt=Et;break}Zt=Zt.next}if(null==wt){null==t.dynamics.ZPP_Contact.zpp_pool?wt=new t.dynamics.ZPP_Contact:(wt=t.dynamics.ZPP_Contact.zpp_pool,t.dynamics.ZPP_Contact.zpp_pool=wt.next,wt.next=null);var Mt=wt.inner;Mt.jnAcc=Mt.jtAcc=0,wt.hash=0,wt.fresh=!0,wt.arbiter=r,r.jrAcc=0;var St=r.contacts;wt._inuse=!0;var Ct=wt;Ct.next=St.next,St.next=Ct,St.modified=!0,St.length++,r.innards.add(Mt)}else wt.fresh=!1;wt.px=bt,wt.py=zt,r.nx=-at*yt,r.ny=-st*yt,wt.dist=vt-pt,wt.stamp=r.stamp,wt.posOnly=!1,lt=wt}else{for(var Nt=n.circle.worldCOMx+at*gt,At=n.circle.worldCOMy+st*gt,Lt=null,Bt=r.contacts.next;null!=Bt;){var Tt=Bt;if(0==Tt.hash){Lt=Tt;break}Bt=Bt.next}if(null==Lt){null==t.dynamics.ZPP_Contact.zpp_pool?Lt=new t.dynamics.ZPP_Contact:(Lt=t.dynamics.ZPP_Contact.zpp_pool,t.dynamics.ZPP_Contact.zpp_pool=Lt.next,Lt.next=null);var Vt=Lt.inner;Vt.jnAcc=Vt.jtAcc=0,Lt.hash=0,Lt.fresh=!0,Lt.arbiter=r,r.jrAcc=0;var kt=r.contacts;Lt._inuse=!0;var It=Lt;It.next=kt.next,kt.next=It,kt.modified=!0,kt.length++,r.innards.add(Vt)}else Lt.fresh=!1;Lt.px=Nt,Lt.py=At,r.nx=at*yt,r.ny=st*yt,Lt.dist=vt-pt,Lt.stamp=r.stamp,Lt.posOnly=!1,lt=Lt}}if(null!=lt){var Ot,Rt,Ht=lt.inner;r.ptype=2,Ot=ze.x-i.polygon.body.posx,Rt=ze.y-i.polygon.body.posy,r.__ref_edge1=Pe,r.__ref_vertex=1,o?(Ht.lr1x=Ot*i.polygon.body.axisy+Rt*i.polygon.body.axisx,Ht.lr1y=Rt*i.polygon.body.axisy-Ot*i.polygon.body.axisx,Ht.lr2x=n.circle.localCOMx,Ht.lr2y=n.circle.localCOMy):(Ht.lr2x=Ot*i.polygon.body.axisy+Rt*i.polygon.body.axisx,Ht.lr2y=Rt*i.polygon.body.axisy-Ot*i.polygon.body.axisx,Ht.lr1x=n.circle.localCOMx,Ht.lr1y=n.circle.localCOMy),r.radius=n.circle.radius}return null!=lt}var Ft,Dt,Gt,Ut,jt,Wt=n.circle.radius+.5*de;if(Ft=Pe.gnormx*Wt,Dt=Pe.gnormy*Wt,Gt=n.circle.worldCOMx-Ft,Ut=n.circle.worldCOMy-Dt,o){for(var qt=Pe.gnormx,Jt=Pe.gnormy,$t=null,Xt=r.contacts.next;null!=Xt;){var Yt=Xt;if(0==Yt.hash){$t=Yt;break}Xt=Xt.next}if(null==$t){null==t.dynamics.ZPP_Contact.zpp_pool?$t=new t.dynamics.ZPP_Contact:($t=t.dynamics.ZPP_Contact.zpp_pool,t.dynamics.ZPP_Contact.zpp_pool=$t.next,$t.next=null);var Kt=$t.inner;Kt.jnAcc=Kt.jtAcc=0,$t.hash=0,$t.fresh=!0,$t.arbiter=r,r.jrAcc=0;var Qt=r.contacts;$t._inuse=!0;var en=$t;en.next=Qt.next,Qt.next=en,Qt.modified=!0,Qt.length++,r.innards.add(Kt)}else $t.fresh=!1;$t.px=Gt,$t.py=Ut,r.nx=qt,r.ny=Jt,$t.dist=de,$t.stamp=r.stamp,$t.posOnly=!1,jt=$t}else{for(var tn=-Pe.gnormx,nn=-Pe.gnormy,rn=null,on=r.contacts.next;null!=on;){var an=on;if(0==an.hash){rn=an;break}on=on.next}if(null==rn){null==t.dynamics.ZPP_Contact.zpp_pool?rn=new t.dynamics.ZPP_Contact:(rn=t.dynamics.ZPP_Contact.zpp_pool,t.dynamics.ZPP_Contact.zpp_pool=rn.next,rn.next=null);var sn=rn.inner;sn.jnAcc=sn.jtAcc=0,rn.hash=0,rn.fresh=!0,rn.arbiter=r,r.jrAcc=0;var ln=r.contacts;rn._inuse=!0;var pn=rn;pn.next=ln.next,ln.next=pn,ln.modified=!0,ln.length++,r.innards.add(sn)}else rn.fresh=!1;rn.px=Gt,rn.py=Ut,r.nx=tn,r.ny=nn,rn.dist=de,rn.stamp=r.stamp,rn.posOnly=!1,jt=rn}return r.ptype=o?0:1,r.lnormx=Pe.lnormx,r.lnormy=Pe.lnormy,r.rev=!o,r.lproj=Pe.lprojection,r.radius=n.circle.radius,jt.inner.lr1x=n.circle.localCOMx,jt.inner.lr1y=n.circle.localCOMy,r.__ref_edge1=Pe,r.__ref_vertex=0,!0}return!1}var un,hn,cn,_n=n.circle.radius+i.circle.radius,dn=(un=i.circle.worldCOMx-n.circle.worldCOMx)*un+(hn=i.circle.worldCOMy-n.circle.worldCOMy)*hn;if(dn>_n*_n)cn=null;else if(dn<e.Config.epsilon*e.Config.epsilon){for(var mn=n.circle.worldCOMx,Pn=n.circle.worldCOMy,fn=null,xn=r.contacts.next;null!=xn;){var yn=xn;if(0==yn.hash){fn=yn;break}xn=xn.next}if(null==fn){null==t.dynamics.ZPP_Contact.zpp_pool?fn=new t.dynamics.ZPP_Contact:(fn=t.dynamics.ZPP_Contact.zpp_pool,t.dynamics.ZPP_Contact.zpp_pool=fn.next,fn.next=null);var vn=fn.inner;vn.jnAcc=vn.jtAcc=0,fn.hash=0,fn.fresh=!0,fn.arbiter=r,r.jrAcc=0;var gn=r.contacts;fn._inuse=!0;var bn=fn;bn.next=gn.next,gn.next=bn,gn.modified=!0,gn.length++,r.innards.add(vn)}else fn.fresh=!1;fn.px=mn,fn.py=Pn,r.nx=1,r.ny=0,fn.dist=-_n,fn.stamp=r.stamp,fn.posOnly=!1,cn=fn}else{var zn=1/Math.sqrt(dn),wn=zn<e.Config.epsilon?1e100:1/zn,Zn=.5+(n.circle.radius-.5*_n)*zn;if(o){for(var En=n.circle.worldCOMx+un*Zn,Mn=n.circle.worldCOMy+hn*Zn,Sn=null,Cn=r.contacts.next;null!=Cn;){var Nn=Cn;if(0==Nn.hash){Sn=Nn;break}Cn=Cn.next}if(null==Sn){null==t.dynamics.ZPP_Contact.zpp_pool?Sn=new t.dynamics.ZPP_Contact:(Sn=t.dynamics.ZPP_Contact.zpp_pool,t.dynamics.ZPP_Contact.zpp_pool=Sn.next,Sn.next=null);var An=Sn.inner;An.jnAcc=An.jtAcc=0,Sn.hash=0,Sn.fresh=!0,Sn.arbiter=r,r.jrAcc=0;var Ln=r.contacts;Sn._inuse=!0;var Bn=Sn;Bn.next=Ln.next,Ln.next=Bn,Ln.modified=!0,Ln.length++,r.innards.add(An)}else Sn.fresh=!1;Sn.px=En,Sn.py=Mn,r.nx=-un*zn,r.ny=-hn*zn,Sn.dist=wn-_n,Sn.stamp=r.stamp,Sn.posOnly=!1,cn=Sn}else{for(var Tn=n.circle.worldCOMx+un*Zn,Vn=n.circle.worldCOMy+hn*Zn,kn=null,In=r.contacts.next;null!=In;){var On=In;if(0==On.hash){kn=On;break}In=In.next}if(null==kn){null==t.dynamics.ZPP_Contact.zpp_pool?kn=new t.dynamics.ZPP_Contact:(kn=t.dynamics.ZPP_Contact.zpp_pool,t.dynamics.ZPP_Contact.zpp_pool=kn.next,kn.next=null);var Rn=kn.inner;Rn.jnAcc=Rn.jtAcc=0,kn.hash=0,kn.fresh=!0,kn.arbiter=r,r.jrAcc=0;var Hn=r.contacts;kn._inuse=!0;var Fn=kn;Fn.next=Hn.next,Hn.next=Fn,Hn.modified=!0,Hn.length++,r.innards.add(Rn)}else kn.fresh=!1;kn.px=Tn,kn.py=Vn,r.nx=un*zn,r.ny=hn*zn,kn.dist=wn-_n,kn.stamp=r.stamp,kn.posOnly=!1,cn=kn}}if(null!=cn){var Dn=cn.inner;return o?(Dn.lr1x=i.circle.localCOMx,Dn.lr1y=i.circle.localCOMy,Dn.lr2x=n.circle.localCOMx,Dn.lr2y=n.circle.localCOMy):(Dn.lr1x=n.circle.localCOMx,Dn.lr1y=n.circle.localCOMy,Dn.lr2x=i.circle.localCOMx,Dn.lr2y=i.circle.localCOMy),r.radius=n.circle.radius+i.circle.radius,r.ptype=2,!0}return!1},t.geom.ZPP_Collide.testCollide_safe=function(e,n){if(0==n.type){var i=e;e=n,n=i}return t.geom.ZPP_Collide.testCollide(e,n)},t.geom.ZPP_Collide.testCollide=function(e,t){if(1==t.type){if(1==e.type){for(var n=!0,i=e.polygon.edges.head;null!=i;){for(var r=i.elt,o=1e100,a=t.polygon.gverts.next;null!=a;){var s=a,l=r.gnormx*s.x+r.gnormy*s.y;l<o&&(o=l),a=a.next}if((o-=r.gprojection)>0){n=!1;break}i=i.next}if(n){for(var p=t.polygon.edges.head;null!=p;){for(var u=p.elt,h=1e100,c=e.polygon.gverts.next;null!=c;){var _=c,d=u.gnormx*_.x+u.gnormy*_.y;d<h&&(h=d),c=c.next}if((h-=u.gprojection)>0){n=!1;break}p=p.next}return n}return!1}for(var m=null,P=null,f=!0,x=-1e100,y=t.polygon.gverts.next,v=t.polygon.edges.head;null!=v;){var g=v.elt,b=g.gnormx*e.circle.worldCOMx+g.gnormy*e.circle.worldCOMy-g.gprojection-e.circle.radius;if(b>0){f=!1;break}b>x&&(x=b,m=g,P=y),y=y.next,v=v.next}if(f){var z=P,w=null==P.next?t.polygon.gverts.next:P.next,Z=e.circle.worldCOMy*m.gnormx-e.circle.worldCOMx*m.gnormy;if(Z<=z.y*m.gnormx-z.x*m.gnormy){var E,M,S=e.circle.radius;return(E=z.x-e.circle.worldCOMx)*E+(M=z.y-e.circle.worldCOMy)*M<=S*S}if(Z>=w.y*m.gnormx-w.x*m.gnormy){var C,N,A=e.circle.radius;return(C=w.x-e.circle.worldCOMx)*C+(N=w.y-e.circle.worldCOMy)*N<=A*A}return!0}return!1}var L,B,T=e.circle.radius+t.circle.radius;return(L=t.circle.worldCOMx-e.circle.worldCOMx)*L+(B=t.circle.worldCOMy-e.circle.worldCOMy)*B<=T*T},t.geom.ZPP_Collide.flowCollide=function(i,r,o){if(1==r.type){if(1==i.type){for(var a=[],s=[],l=!0,p=!0,u=i.polygon.edges.head;null!=u;){for(var h=u.elt,c=1e100,_=0,d=r.polygon.gverts.next;null!=d;){var m=d,P=h.gnormx*m.x+h.gnormy*m.y;P<c&&(c=P),P>=h.gprojection+e.Config.epsilon&&(s[_]=!0,p=!1),++_,d=d.next}if((c-=h.gprojection)>0){l=!1;break}u=u.next}if(p){var f=r.polygon;if(f.zip_worldCOM&&null!=f.body){if(f.zip_worldCOM=!1,f.zip_localCOM){if(f.zip_localCOM=!1,1==f.type){var x=f.polygon;if(null==x.lverts.next)throw new n._Boot.HaxeError("Error: An empty polygon has no meaningful localCOM");if(null==x.lverts.next.next)x.localCOMx=x.lverts.next.x,x.localCOMy=x.lverts.next.y;else if(null==x.lverts.next.next.next)x.localCOMx=x.lverts.next.x,x.localCOMy=x.lverts.next.y,x.localCOMx+=1*x.lverts.next.next.x,x.localCOMy+=1*x.lverts.next.next.y,x.localCOMx*=.5,x.localCOMy*=.5;else{x.localCOMx=0,x.localCOMy=0;var y=0,v=x.lverts.next,g=v,b=v=v.next;for(v=v.next;null!=v;){var z=v;y+=b.x*(z.y-g.y);var w=z.y*b.x-z.x*b.y;x.localCOMx+=(b.x+z.x)*w,x.localCOMy+=(b.y+z.y)*w,g=b,b=z,v=v.next}var Z=v=x.lverts.next;y+=b.x*(Z.y-g.y);var E=Z.y*b.x-Z.x*b.y;x.localCOMx+=(b.x+Z.x)*E,x.localCOMy+=(b.y+Z.y)*E,g=b,b=Z;var M=v=v.next;y+=b.x*(M.y-g.y);var S=M.y*b.x-M.x*b.y;x.localCOMx+=(b.x+M.x)*S,x.localCOMy+=(b.y+M.y)*S;var C=y=1/(3*y);x.localCOMx*=C,x.localCOMy*=C}}null!=f.wrap_localCOM&&(f.wrap_localCOM.zpp_inner.x=f.localCOMx,f.wrap_localCOM.zpp_inner.y=f.localCOMy)}var N=f.body;N.zip_axis&&(N.zip_axis=!1,N.axisx=Math.sin(N.rot),N.axisy=Math.cos(N.rot)),f.worldCOMx=f.body.posx+(f.body.axisy*f.localCOMx-f.body.axisx*f.localCOMy),f.worldCOMy=f.body.posy+(f.localCOMx*f.body.axisx+f.localCOMy*f.body.axisy)}return o.overlap=r.polygon.area,o.centroidx=r.polygon.worldCOMx,o.centroidy=r.polygon.worldCOMy,!0}if(l){p=!0;for(var A=r.polygon.edges.head;null!=A;){for(var L=A.elt,B=1e100,T=0,V=i.polygon.gverts.next;null!=V;){var k=V,I=L.gnormx*k.x+L.gnormy*k.y;I<B&&(B=I),I>=L.gprojection+e.Config.epsilon&&(a[T]=!0,p=!1),++T,V=V.next}if((B-=L.gprojection)>0){l=!1;break}A=A.next}if(p){var O=i.polygon;if(O.zip_worldCOM&&null!=O.body){if(O.zip_worldCOM=!1,O.zip_localCOM){if(O.zip_localCOM=!1,1==O.type){var R=O.polygon;if(null==R.lverts.next)throw new n._Boot.HaxeError("Error: An empty polygon has no meaningful localCOM");if(null==R.lverts.next.next)R.localCOMx=R.lverts.next.x,R.localCOMy=R.lverts.next.y;else if(null==R.lverts.next.next.next)R.localCOMx=R.lverts.next.x,R.localCOMy=R.lverts.next.y,R.localCOMx+=1*R.lverts.next.next.x,R.localCOMy+=1*R.lverts.next.next.y,R.localCOMx*=.5,R.localCOMy*=.5;else{R.localCOMx=0,R.localCOMy=0;var H=0,F=R.lverts.next,D=F,G=F=F.next;for(F=F.next;null!=F;){var U=F;H+=G.x*(U.y-D.y);var j=U.y*G.x-U.x*G.y;R.localCOMx+=(G.x+U.x)*j,R.localCOMy+=(G.y+U.y)*j,D=G,G=U,F=F.next}var W=F=R.lverts.next;H+=G.x*(W.y-D.y);var q=W.y*G.x-W.x*G.y;R.localCOMx+=(G.x+W.x)*q,R.localCOMy+=(G.y+W.y)*q,D=G,G=W;var J=F=F.next;H+=G.x*(J.y-D.y);var $=J.y*G.x-J.x*G.y;R.localCOMx+=(G.x+J.x)*$,R.localCOMy+=(G.y+J.y)*$;var X=H=1/(3*H);R.localCOMx*=X,R.localCOMy*=X}}null!=O.wrap_localCOM&&(O.wrap_localCOM.zpp_inner.x=O.localCOMx,O.wrap_localCOM.zpp_inner.y=O.localCOMy)}var Y=O.body;Y.zip_axis&&(Y.zip_axis=!1,Y.axisx=Math.sin(Y.rot),Y.axisy=Math.cos(Y.rot)),O.worldCOMx=O.body.posx+(O.body.axisy*O.localCOMx-O.body.axisx*O.localCOMy),O.worldCOMy=O.body.posy+(O.localCOMx*O.body.axisx+O.localCOMy*O.body.axisy)}return o.overlap=i.polygon.area,o.centroidx=i.polygon.worldCOMx,o.centroidy=i.polygon.worldCOMy,!0}if(l){for(;null!=t.geom.ZPP_Collide.flowpoly.head;){var K=t.geom.ZPP_Collide.flowpoly.pop_unsafe();if(!K._inuse){var Q=K;null!=Q.outer&&(Q.outer.zpp_inner=null,Q.outer=null),Q._isimmutable=null,Q._validate=null,Q._invalidate=null,Q.next=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=Q}}for(var ee=null,te=!1,ne=i.polygon.gverts.next,ie=0,re=r.polygon.gverts.next,oe=0,ae=0,se=r.polygon.edgeCnt;ae<se;){var le=ae++;if(!s[le]){oe=le;break}re=re.next}if(null==re){re=r.polygon.gverts.next,te=!0;for(var pe=0,ue=i.polygon.edgeCnt;pe<ue;){var he=pe++;if(!a[he]){ie=he;break}ne=ne.next}null==ne?ne=i.polygon.gverts.next:(t.geom.ZPP_Collide.flowpoly.add(ne),ee=t.geom.ZPP_Collide.flowpoly.head.elt)}else t.geom.ZPP_Collide.flowpoly.add(re),ee=t.geom.ZPP_Collide.flowpoly.head.elt;var ce=1;if(null==t.geom.ZPP_Collide.flowpoly.head){for(var _e=!0,de=i.polygon.gverts.next,me=de,Pe=de.next;null!=Pe;){for(var fe=Pe,xe=2,ye=r.polygon.gverts.next,ve=ye,ge=ye.next;null!=ge;){var be,ze,we,Ze,Ee=ge,Me=0;be=me.x-ve.x,ze=me.y-ve.y,we=fe.x-me.x;var Se,Ce,Ne,Ae=(Ze=fe.y-me.y)*(Se=Ee.x-ve.x)-we*(Ce=Ee.y-ve.y);if(Ae*Ae>e.Config.epsilon*e.Config.epsilon){var Le=(Ce*be-Se*ze)*(Ae=1/Ae);if(Le>e.Config.epsilon&&Le<1-e.Config.epsilon){var Be=(Ze*be-we*ze)*Ae;Be>e.Config.epsilon&&Be<1-e.Config.epsilon?(Me=Le,Ne=!0):Ne=!1}else Ne=!1}else Ne=!1;Ne&&Me<xe&&(xe=Me,re=ye),ye=ge,ve=Ee,ge=ge.next}for(;;){var Te,Ve,ke,Ie,Oe=ge=r.polygon.gverts.next,Re=0;Te=me.x-ve.x,Ve=me.y-ve.y,ke=fe.x-me.x;var He,Fe,De,Ge=(Ie=fe.y-me.y)*(He=Oe.x-ve.x)-ke*(Fe=Oe.y-ve.y);if(Ge*Ge>e.Config.epsilon*e.Config.epsilon){var Ue=(Fe*Te-He*Ve)*(Ge=1/Ge);if(Ue>e.Config.epsilon&&Ue<1-e.Config.epsilon){var je=(Ie*Te-ke*Ve)*Ge;je>e.Config.epsilon&&je<1-e.Config.epsilon?(Re=Ue,De=!0):De=!1}else De=!1}else De=!1;De&&Re<xe&&(xe=Re,re=ye);break}if(2!=xe){var We,qe,Je,$e=xe;We=me.x+(fe.x-me.x)*$e,qe=me.y+(fe.y-me.y)*$e,null==t.geom.ZPP_Vec2.zpp_pool?Je=new t.geom.ZPP_Vec2:(Je=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=Je.next,Je.next=null),Je.weak=!1,Je._immutable=!1,Je.x=We,Je.y=qe,ee=Je,t.geom.ZPP_Collide.flowpoly.add(ee),te=!0,ne=de,_e=!1;break}de=Pe,me=fe,Pe=Pe.next}if(_e)for(;;){for(var Xe=Pe=i.polygon.gverts.next,Ye=2,Ke=r.polygon.gverts.next,Qe=Ke,et=Ke.next;null!=et;){var tt,nt,it,rt,ot=et,at=0;tt=me.x-Qe.x,nt=me.y-Qe.y,it=Xe.x-me.x;var st,lt,pt,ut=(rt=Xe.y-me.y)*(st=ot.x-Qe.x)-it*(lt=ot.y-Qe.y);if(ut*ut>e.Config.epsilon*e.Config.epsilon){var ht=(lt*tt-st*nt)*(ut=1/ut);if(ht>e.Config.epsilon&&ht<1-e.Config.epsilon){var ct=(rt*tt-it*nt)*ut;ct>e.Config.epsilon&&ct<1-e.Config.epsilon?(at=ht,pt=!0):pt=!1}else pt=!1}else pt=!1;pt&&at<Ye&&(Ye=at,re=Ke),Ke=et,Qe=ot,et=et.next}for(;;){var _t,dt,mt,Pt,ft=et=r.polygon.gverts.next,xt=0;_t=me.x-Qe.x,dt=me.y-Qe.y,mt=Xe.x-me.x;var yt,vt,gt,bt=(Pt=Xe.y-me.y)*(yt=ft.x-Qe.x)-mt*(vt=ft.y-Qe.y);if(bt*bt>e.Config.epsilon*e.Config.epsilon){var zt=(vt*_t-yt*dt)*(bt=1/bt);if(zt>e.Config.epsilon&&zt<1-e.Config.epsilon){var wt=(Pt*_t-mt*dt)*bt;wt>e.Config.epsilon&&wt<1-e.Config.epsilon?(xt=zt,gt=!0):gt=!1}else gt=!1}else gt=!1;gt&&xt<Ye&&(Ye=xt,re=Ke);break}if(2!=Ye){var Zt,Et,Mt,St=Ye;Zt=me.x+(Xe.x-me.x)*St,Et=me.y+(Xe.y-me.y)*St,null==t.geom.ZPP_Vec2.zpp_pool?Mt=new t.geom.ZPP_Vec2:(Mt=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=Mt.next,Mt.next=null),Mt.weak=!1,Mt._immutable=!1,Mt.x=Zt,Mt.y=Et,ee=Mt,t.geom.ZPP_Collide.flowpoly.add(ee),te=!0,ne=de;break}break}ce=2}for(;;)if(te)if(++ie,null==(ne=ne.next)&&(ne=i.polygon.gverts.next,ie=0),a[ie]){var Ct=t.geom.ZPP_Collide.flowpoly.head.elt,Nt=ne,At=re,Lt=re.next;null==Lt&&(Lt=r.polygon.gverts.next);for(var Bt=-1,Tt=null,Vt=0,kt=0,It=Lt,Ot=Lt;;){var Rt,Ht,Ft,Dt,Gt=Ot,Ut=0;Rt=At.x-Ct.x,Ht=At.y-Ct.y,Ft=Gt.x-At.x;var jt,Wt,qt,Jt=(Dt=Gt.y-At.y)*(jt=Nt.x-Ct.x)-Ft*(Wt=Nt.y-Ct.y);if(Jt*Jt>e.Config.epsilon*e.Config.epsilon){var $t=(Wt*Rt-jt*Ht)*(Jt=1/Jt);if($t>e.Config.epsilon&&$t<1-e.Config.epsilon){var Xt=(Dt*Rt-Ft*Ht)*Jt;Xt>e.Config.epsilon&&Xt<1-e.Config.epsilon?(Ut=$t,qt=!0):qt=!1}else qt=!1}else qt=!1;if(qt&&Ut>=Bt){if(Tt=re,Vt=oe,++kt==ce){Bt=Ut,Ot=It;break}Bt=Ut}At=Gt,re=Ot,++oe>=r.polygon.edgeCnt&&(oe=0),null==(Ot=Ot.next)&&(Ot=r.polygon.gverts.next);break}for(;Ot!=It;){var Yt,Kt,Qt,en,tn=Ot,nn=0;Yt=At.x-Ct.x,Kt=At.y-Ct.y,Qt=tn.x-At.x;var rn,on,an,sn=(en=tn.y-At.y)*(rn=Nt.x-Ct.x)-Qt*(on=Nt.y-Ct.y);if(sn*sn>e.Config.epsilon*e.Config.epsilon){var ln=(on*Yt-rn*Kt)*(sn=1/sn);if(ln>e.Config.epsilon&&ln<1-e.Config.epsilon){var pn=(en*Yt-Qt*Kt)*sn;pn>e.Config.epsilon&&pn<1-e.Config.epsilon?(nn=ln,an=!0):an=!1}else an=!1}else an=!1;if(an&&nn>=Bt){if(Tt=re,Vt=oe,++kt==ce){Bt=nn,Ot=It;break}Bt=nn}At=tn,re=Ot,++oe>=r.polygon.edgeCnt&&(oe=0),null==(Ot=Ot.next)&&(Ot=r.polygon.gverts.next)}if(null==Tt)break;var un=Tt,hn=Tt.next;null==hn&&(hn=r.polygon.gverts.next);var cn,_n,dn,mn,Pn,fn=hn,xn=Bt;if(cn=un.x+(fn.x-un.x)*xn,_n=un.y+(fn.y-un.y)*xn,null!=ee)dn=(mn=cn-ee.x)*mn+(Pn=_n-ee.y)*Pn<e.Config.epsilon;else dn=!1;if(dn)break;var yn,vn=t.geom.ZPP_Collide.flowpoly;null==t.geom.ZPP_Vec2.zpp_pool?yn=new t.geom.ZPP_Vec2:(yn=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=yn.next,yn.next=null),yn.weak=!1,yn._immutable=!1,yn.x=cn,yn.y=_n,vn.add(yn),null==ee&&(ee=t.geom.ZPP_Collide.flowpoly.head.elt),re=Tt,oe=Vt,te=!te,ce=2}else{var gn,bn,zn,wn=ne;if(null!=ee)gn=(bn=wn.x-ee.x)*bn+(zn=wn.y-ee.y)*zn<e.Config.epsilon;else gn=!1;if(gn)break;t.geom.ZPP_Collide.flowpoly.add(wn),null==ee&&(ee=t.geom.ZPP_Collide.flowpoly.head.elt),ce=1}else if(++oe,null==(re=re.next)&&(re=r.polygon.gverts.next,oe=0),s[oe]){var Zn=t.geom.ZPP_Collide.flowpoly.head.elt,En=re,Mn=ne,Sn=ne.next;null==Sn&&(Sn=i.polygon.gverts.next);for(var Cn=-1,Nn=null,An=0,Ln=0,Bn=Sn,Tn=Sn;;){var Vn,kn,In,On,Rn=Tn,Hn=0;Vn=Mn.x-Zn.x,kn=Mn.y-Zn.y,In=Rn.x-Mn.x;var Fn,Dn,Gn,Un=(On=Rn.y-Mn.y)*(Fn=En.x-Zn.x)-In*(Dn=En.y-Zn.y);if(Un*Un>e.Config.epsilon*e.Config.epsilon){var jn=(Dn*Vn-Fn*kn)*(Un=1/Un);if(jn>e.Config.epsilon&&jn<1-e.Config.epsilon){var Wn=(On*Vn-In*kn)*Un;Wn>e.Config.epsilon&&Wn<1-e.Config.epsilon?(Hn=jn,Gn=!0):Gn=!1}else Gn=!1}else Gn=!1;if(Gn&&Hn>=Cn){if(Nn=ne,An=ie,++Ln==ce){Cn=Hn,Tn=Bn;break}Cn=Hn}Mn=Rn,ne=Tn,++ie>=i.polygon.edgeCnt&&(ie=0),null==(Tn=Tn.next)&&(Tn=i.polygon.gverts.next);break}for(;Tn!=Bn;){var qn,Jn,$n,Xn,Yn=Tn,Kn=0;qn=Mn.x-Zn.x,Jn=Mn.y-Zn.y,$n=Yn.x-Mn.x;var Qn,ei,ti,ni=(Xn=Yn.y-Mn.y)*(Qn=En.x-Zn.x)-$n*(ei=En.y-Zn.y);if(ni*ni>e.Config.epsilon*e.Config.epsilon){var ii=(ei*qn-Qn*Jn)*(ni=1/ni);if(ii>e.Config.epsilon&&ii<1-e.Config.epsilon){var ri=(Xn*qn-$n*Jn)*ni;ri>e.Config.epsilon&&ri<1-e.Config.epsilon?(Kn=ii,ti=!0):ti=!1}else ti=!1}else ti=!1;if(ti&&Kn>=Cn){if(Nn=ne,An=ie,++Ln==ce){Cn=Kn,Tn=Bn;break}Cn=Kn}Mn=Yn,ne=Tn,++ie>=i.polygon.edgeCnt&&(ie=0),null==(Tn=Tn.next)&&(Tn=i.polygon.gverts.next)}if(null==Nn)break;var oi=Nn,ai=Nn.next;null==ai&&(ai=i.polygon.gverts.next);var si,li,pi,ui,hi,ci=ai,_i=Cn;if(si=oi.x+(ci.x-oi.x)*_i,li=oi.y+(ci.y-oi.y)*_i,null!=ee)pi=(ui=si-ee.x)*ui+(hi=li-ee.y)*hi<e.Config.epsilon;else pi=!1;if(pi)break;var di,mi=t.geom.ZPP_Collide.flowpoly;null==t.geom.ZPP_Vec2.zpp_pool?di=new t.geom.ZPP_Vec2:(di=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=di.next,di.next=null),di.weak=!1,di._immutable=!1,di.x=si,di.y=li,mi.add(di),null==ee&&(ee=t.geom.ZPP_Collide.flowpoly.head.elt),ne=Nn,ie=An,te=!te,ce=2}else{var Pi,fi,xi,yi=re;if(null!=ee)Pi=(fi=yi.x-ee.x)*fi+(xi=yi.y-ee.y)*xi<e.Config.epsilon;else Pi=!1;if(Pi)break;t.geom.ZPP_Collide.flowpoly.add(yi),null==ee&&(ee=t.geom.ZPP_Collide.flowpoly.head.elt),ce=1}if(null!=t.geom.ZPP_Collide.flowpoly.head&&null!=t.geom.ZPP_Collide.flowpoly.head.next&&null!=t.geom.ZPP_Collide.flowpoly.head.next.next){var vi=0,gi=0,bi=0;gi=0,bi=0,vi=0;var zi=t.geom.ZPP_Collide.flowpoly.head,wi=zi.elt,Zi=(zi=zi.next).elt;for(zi=zi.next;null!=zi;){var Ei=zi.elt;vi+=Zi.x*(Ei.y-wi.y);var Mi=Ei.y*Zi.x-Ei.x*Zi.y;gi+=(Zi.x+Ei.x)*Mi,bi+=(Zi.y+Ei.y)*Mi,wi=Zi,Zi=Ei,zi=zi.next}var Si=(zi=t.geom.ZPP_Collide.flowpoly.head).elt;vi+=Zi.x*(Si.y-wi.y);var Ci=Si.y*Zi.x-Si.x*Zi.y;gi+=(Zi.x+Si.x)*Ci,bi+=(Zi.y+Si.y)*Ci,wi=Zi,Zi=Si;var Ni=(zi=zi.next).elt;vi+=Zi.x*(Ni.y-wi.y);var Ai=Ni.y*Zi.x-Ni.x*Zi.y;gi+=(Zi.x+Ni.x)*Ai,bi+=(Zi.y+Ni.y)*Ai;var Li=1/(6*(vi*=.5));return gi*=Li,bi*=Li,o.overlap=-vi,o.centroidx=gi,o.centroidy=bi,!0}return!1}return!1}return!1}for(var Bi=[],Ti=!0,Vi=null,ki=null,Ii=-1e100,Oi=!0,Ri=r.polygon.gverts.next,Hi=0,Fi=r.polygon.edges.head;null!=Fi;){var Di=Fi.elt,Gi=Di.gnormx*i.circle.worldCOMx+Di.gnormy*i.circle.worldCOMy;if(Gi>Di.gprojection+i.circle.radius){Oi=!1;break}Gi+i.circle.radius>Di.gprojection+e.Config.epsilon&&(Ti=!1,Bi[Hi]=!0),(Gi-=Di.gprojection+i.circle.radius)>Ii&&(Ii=Gi,Vi=Di,ki=Ri),Ri=Ri.next,++Hi,Fi=Fi.next}if(Oi){if(Ti)return o.overlap=i.circle.area,o.centroidx=i.circle.worldCOMx,o.centroidy=i.circle.worldCOMy,!0;var Ui,ji=ki,Wi=null==ki.next?r.polygon.gverts.next:ki.next,qi=i.circle.worldCOMy*Vi.gnormx-i.circle.worldCOMx*Vi.gnormy;if(qi<=ji.y*Vi.gnormx-ji.x*Vi.gnormy){var Ji,$i,Xi=i.circle.radius;Ui=(Ji=ji.x-i.circle.worldCOMx)*Ji+($i=ji.y-i.circle.worldCOMy)*$i<=Xi*Xi}else if(qi>=Wi.y*Vi.gnormx-Wi.x*Vi.gnormy){var Yi,Ki,Qi=i.circle.radius;Ui=(Yi=Wi.x-i.circle.worldCOMx)*Yi+(Ki=Wi.y-i.circle.worldCOMy)*Ki<=Qi*Qi}else Ui=!0;if(Ui){for(var er=[],tr=0,nr=!0,ir=null,rr=0,or=r.polygon.gverts.next;null!=or;){var ar,sr,lr=or,pr=(ar=lr.x-i.circle.worldCOMx)*ar+(sr=lr.y-i.circle.worldCOMy)*sr;(er[tr]=pr<=i.circle.radius*i.circle.radius)?(rr=tr,ir=or):nr=!1,++tr,or=or.next}if(nr){var ur=r.polygon;if(ur.zip_worldCOM&&null!=ur.body){if(ur.zip_worldCOM=!1,ur.zip_localCOM){if(ur.zip_localCOM=!1,1==ur.type){var hr=ur.polygon;if(null==hr.lverts.next)throw new n._Boot.HaxeError("Error: An empty polygon has no meaningful localCOM");if(null==hr.lverts.next.next)hr.localCOMx=hr.lverts.next.x,hr.localCOMy=hr.lverts.next.y;else if(null==hr.lverts.next.next.next)hr.localCOMx=hr.lverts.next.x,hr.localCOMy=hr.lverts.next.y,hr.localCOMx+=1*hr.lverts.next.next.x,hr.localCOMy+=1*hr.lverts.next.next.y,hr.localCOMx*=.5,hr.localCOMy*=.5;else{hr.localCOMx=0,hr.localCOMy=0;var cr=0,_r=hr.lverts.next,dr=_r,mr=_r=_r.next;for(_r=_r.next;null!=_r;){var Pr=_r;cr+=mr.x*(Pr.y-dr.y);var fr=Pr.y*mr.x-Pr.x*mr.y;hr.localCOMx+=(mr.x+Pr.x)*fr,hr.localCOMy+=(mr.y+Pr.y)*fr,dr=mr,mr=Pr,_r=_r.next}var xr=_r=hr.lverts.next;cr+=mr.x*(xr.y-dr.y);var yr=xr.y*mr.x-xr.x*mr.y;hr.localCOMx+=(mr.x+xr.x)*yr,hr.localCOMy+=(mr.y+xr.y)*yr,dr=mr,mr=xr;var vr=_r=_r.next;cr+=mr.x*(vr.y-dr.y);var gr=vr.y*mr.x-vr.x*mr.y;hr.localCOMx+=(mr.x+vr.x)*gr,hr.localCOMy+=(mr.y+vr.y)*gr;var br=cr=1/(3*cr);hr.localCOMx*=br,hr.localCOMy*=br}}null!=ur.wrap_localCOM&&(ur.wrap_localCOM.zpp_inner.x=ur.localCOMx,ur.wrap_localCOM.zpp_inner.y=ur.localCOMy)}var zr=ur.body;zr.zip_axis&&(zr.zip_axis=!1,zr.axisx=Math.sin(zr.rot),zr.axisy=Math.cos(zr.rot)),ur.worldCOMx=ur.body.posx+(ur.body.axisy*ur.localCOMx-ur.body.axisx*ur.localCOMy),ur.worldCOMy=ur.body.posy+(ur.localCOMx*ur.body.axisx+ur.localCOMy*ur.body.axisy)}return o.overlap=r.polygon.area,o.centroidx=r.polygon.worldCOMx,o.centroidy=r.polygon.worldCOMy,!0}for(;null!=t.geom.ZPP_Collide.flowpoly.head;){var wr=t.geom.ZPP_Collide.flowpoly.pop_unsafe();if(!wr._inuse){var Zr=wr;null!=Zr.outer&&(Zr.outer.zpp_inner=null,Zr.outer=null),Zr._isimmutable=null,Zr._validate=null,Zr._invalidate=null,Zr.next=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=Zr}}t.geom.ZPP_Collide.flowsegs.clear();var Er=null,Mr=1;for(null==ir?(ir=r.polygon.gverts.next,Mr=2):(Er=ir,t.geom.ZPP_Collide.flowpoly.add(Er));0!=Mr;)if(1==Mr)if(null==(ir=ir.next)&&(ir=r.polygon.gverts.next),++rr>=r.polygon.edgeCnt&&(rr=0),er[rr]){var Sr,Cr;if((Sr=Er.x-ir.x)*Sr+(Cr=Er.y-ir.y)*Cr<e.Config.epsilon)break;t.geom.ZPP_Collide.flowpoly.add(ir)}else{var Nr,Ar,Lr,Br,Tr,Vr,kr,Ir,Or=t.geom.ZPP_Collide.flowpoly.head.elt,Rr=ir,Hr=(Nr=Rr.x-Or.x)*Nr+(Ar=Rr.y-Or.y)*Ar,Fr=2*((Lr=Or.x-i.circle.worldCOMx)*Nr+(Br=Or.y-i.circle.worldCOMy)*Ar),Dr=Lr*Lr+Br*Br-i.circle.radius*i.circle.radius,Gr=Math.sqrt(Fr*Fr-4*Hr*Dr),Ur=(-Fr-Gr)*(Hr=1/(2*Hr)),jr=Ur<e.Config.epsilon?(-Fr+Gr)*Hr:Ur;if(Tr=Or.x+(Rr.x-Or.x)*jr,Vr=Or.y+(Rr.y-Or.y)*jr,(kr=Er.x-Tr)*kr+(Ir=Er.y-Vr)*Ir<e.Config.epsilon)break;var Wr,qr=t.geom.ZPP_Collide.flowpoly;null==t.geom.ZPP_Vec2.zpp_pool?Wr=new t.geom.ZPP_Vec2:(Wr=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=Wr.next,Wr.next=null),Wr.weak=!1,Wr._immutable=!1,Wr.x=Tr,Wr.y=Vr,qr.add(Wr),Mr=2}else if(2==Mr){var Jr=ir.next;null==Jr&&(Jr=r.polygon.gverts.next);var $r=ir;Mr=0;for(var Xr=Jr,Yr=Jr;;){var Kr=Yr,Qr=rr+1;if(Qr==r.polygon.edgeCnt&&(Qr=0),Bi[rr]){if(er[Qr]){var eo,to,no,io,ro,oo,ao,so,lo,po=(eo=Kr.x-$r.x)*eo+(to=Kr.y-$r.y)*to,uo=2*((no=$r.x-i.circle.worldCOMx)*eo+(io=$r.y-i.circle.worldCOMy)*to),ho=no*no+io*io-i.circle.radius*i.circle.radius,co=Math.sqrt(uo*uo-4*po*ho),_o=(-uo-co)*(po=1/(2*po)),mo=_o<e.Config.epsilon?(-uo+co)*po:_o;if(ro=$r.x+(Kr.x-$r.x)*mo,oo=$r.y+(Kr.y-$r.y)*mo,(ao=Er.x-ro)*ao+(so=Er.y-oo)*so<e.Config.epsilon){Mr=0,Yr=Xr;break}null==t.geom.ZPP_Vec2.zpp_pool?lo=new t.geom.ZPP_Vec2:(lo=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=lo.next,lo.next=null),lo.weak=!1,lo._immutable=!1,lo.x=ro,lo.y=oo;var Po=lo;t.geom.ZPP_Collide.flowsegs.add(t.geom.ZPP_Collide.flowpoly.head.elt),t.geom.ZPP_Collide.flowsegs.add(Po),t.geom.ZPP_Collide.flowpoly.add(Po),Mr=1,Yr=Xr;break}var fo,xo,yo,vo,go,bo=0,zo=0,wo=(fo=Kr.x-$r.x)*fo+(xo=Kr.y-$r.y)*xo,Zo=2*((yo=$r.x-i.circle.worldCOMx)*fo+(vo=$r.y-i.circle.worldCOMy)*xo),Eo=Zo*Zo-4*wo*(yo*yo+vo*vo-i.circle.radius*i.circle.radius);if(Eo*Eo<e.Config.epsilon?(bo=Eo<0?10:zo=-Zo/(2*wo),go=!1):(bo=(-Zo-(Eo=Math.sqrt(Eo)))*(wo=1/(2*wo)),zo=(-Zo+Eo)*wo,go=!0),bo<1-e.Config.epsilon&&zo>e.Config.epsilon){var Mo,So,Co,No,Ao,Lo,Bo=bo;if(Mo=$r.x+(Kr.x-$r.x)*Bo,So=$r.y+(Kr.y-$r.y)*Bo,null!=Er)Co=(Ao=Er.x-Mo)*Ao+(Lo=Er.y-So)*Lo<e.Config.epsilon;else Co=!1;if(Co){Mr=0,Yr=Xr;break}null==t.geom.ZPP_Vec2.zpp_pool?No=new t.geom.ZPP_Vec2:(No=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=No.next,No.next=null),No.weak=!1,No._immutable=!1,No.x=Mo,No.y=So;var To=No;if(null!=t.geom.ZPP_Collide.flowpoly.head&&(t.geom.ZPP_Collide.flowsegs.add(t.geom.ZPP_Collide.flowpoly.head.elt),t.geom.ZPP_Collide.flowsegs.add(To)),t.geom.ZPP_Collide.flowpoly.add(To),null==Er&&(Er=t.geom.ZPP_Collide.flowpoly.head.elt),go){var Vo,ko,Io=zo;Vo=$r.x+(Kr.x-$r.x)*Io,ko=$r.y+(Kr.y-$r.y)*Io;var Oo,Ro=t.geom.ZPP_Collide.flowpoly;null==t.geom.ZPP_Vec2.zpp_pool?Oo=new t.geom.ZPP_Vec2:(Oo=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=Oo.next,Oo.next=null),Oo.weak=!1,Oo._immutable=!1,Oo.x=Vo,Oo.y=ko,Ro.add(Oo)}}}$r=Kr,ir=Yr,rr=Qr,null==(Yr=Yr.next)&&(Yr=r.polygon.gverts.next);break}for(;Yr!=Xr;){var Ho=Yr,Fo=rr+1;if(Fo==r.polygon.edgeCnt&&(Fo=0),Bi[rr]){if(er[Fo]){var Do,Go,Uo,jo,Wo,qo,Jo,$o,Xo,Yo=(Do=Ho.x-$r.x)*Do+(Go=Ho.y-$r.y)*Go,Ko=2*((Uo=$r.x-i.circle.worldCOMx)*Do+(jo=$r.y-i.circle.worldCOMy)*Go),Qo=Uo*Uo+jo*jo-i.circle.radius*i.circle.radius,ea=Math.sqrt(Ko*Ko-4*Yo*Qo),ta=(-Ko-ea)*(Yo=1/(2*Yo)),na=ta<e.Config.epsilon?(-Ko+ea)*Yo:ta;if(Wo=$r.x+(Ho.x-$r.x)*na,qo=$r.y+(Ho.y-$r.y)*na,(Jo=Er.x-Wo)*Jo+($o=Er.y-qo)*$o<e.Config.epsilon){Mr=0,Yr=Xr;break}null==t.geom.ZPP_Vec2.zpp_pool?Xo=new t.geom.ZPP_Vec2:(Xo=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=Xo.next,Xo.next=null),Xo.weak=!1,Xo._immutable=!1,Xo.x=Wo,Xo.y=qo;var ia=Xo;t.geom.ZPP_Collide.flowsegs.add(t.geom.ZPP_Collide.flowpoly.head.elt),t.geom.ZPP_Collide.flowsegs.add(ia),t.geom.ZPP_Collide.flowpoly.add(ia),Mr=1,Yr=Xr;break}var ra,oa,aa,sa,la,pa=0,ua=0,ha=(ra=Ho.x-$r.x)*ra+(oa=Ho.y-$r.y)*oa,ca=2*((aa=$r.x-i.circle.worldCOMx)*ra+(sa=$r.y-i.circle.worldCOMy)*oa),_a=ca*ca-4*ha*(aa*aa+sa*sa-i.circle.radius*i.circle.radius);if(_a*_a<e.Config.epsilon?(pa=_a<0?10:ua=-ca/(2*ha),la=!1):(pa=(-ca-(_a=Math.sqrt(_a)))*(ha=1/(2*ha)),ua=(-ca+_a)*ha,la=!0),pa<1-e.Config.epsilon&&ua>e.Config.epsilon){var da,ma,Pa,fa,xa,ya,va=pa;if(da=$r.x+(Ho.x-$r.x)*va,ma=$r.y+(Ho.y-$r.y)*va,null!=Er)Pa=(xa=Er.x-da)*xa+(ya=Er.y-ma)*ya<e.Config.epsilon;else Pa=!1;if(Pa){Mr=0,Yr=Xr;break}null==t.geom.ZPP_Vec2.zpp_pool?fa=new t.geom.ZPP_Vec2:(fa=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=fa.next,fa.next=null),fa.weak=!1,fa._immutable=!1,fa.x=da,fa.y=ma;var ga=fa;if(null!=t.geom.ZPP_Collide.flowpoly.head&&(t.geom.ZPP_Collide.flowsegs.add(t.geom.ZPP_Collide.flowpoly.head.elt),t.geom.ZPP_Collide.flowsegs.add(ga)),t.geom.ZPP_Collide.flowpoly.add(ga),null==Er&&(Er=t.geom.ZPP_Collide.flowpoly.head.elt),la){var ba,za,wa=ua;ba=$r.x+(Ho.x-$r.x)*wa,za=$r.y+(Ho.y-$r.y)*wa;var Za,Ea=t.geom.ZPP_Collide.flowpoly;null==t.geom.ZPP_Vec2.zpp_pool?Za=new t.geom.ZPP_Vec2:(Za=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=Za.next,Za.next=null),Za.weak=!1,Za._immutable=!1,Za.x=ba,Za.y=za,Ea.add(Za)}}}$r=Ho,ir=Yr,rr=Fo,null==(Yr=Yr.next)&&(Yr=r.polygon.gverts.next)}}if(null==t.geom.ZPP_Collide.flowpoly.head)return!1;if(null==t.geom.ZPP_Collide.flowpoly.head.next){for(var Ma=!0,Sa=r.polygon.edges.head;null!=Sa;){var Ca=Sa.elt;if(Ca.gnormx*i.circle.worldCOMx+Ca.gnormy*i.circle.worldCOMy>Ca.gprojection){Ma=!1;break}Sa=Sa.next}return!!Ma&&(o.overlap=i.circle.area,o.centroidx=i.circle.worldCOMx,o.centroidy=i.circle.worldCOMy,!0)}var Na=0,Aa=0,La=0;if(null!=t.geom.ZPP_Collide.flowpoly.head.next.next){var Ba=0,Ta=0,Va=0;Ta=0,Va=0,Ba=0;var ka=t.geom.ZPP_Collide.flowpoly.head,Ia=ka.elt,Oa=(ka=ka.next).elt;for(ka=ka.next;null!=ka;){var Ra=ka.elt;Ba+=Oa.x*(Ra.y-Ia.y);var Ha=Ra.y*Oa.x-Ra.x*Oa.y;Ta+=(Oa.x+Ra.x)*Ha,Va+=(Oa.y+Ra.y)*Ha,Ia=Oa,Oa=Ra,ka=ka.next}var Fa=(ka=t.geom.ZPP_Collide.flowpoly.head).elt;Ba+=Oa.x*(Fa.y-Ia.y);var Da=Fa.y*Oa.x-Fa.x*Oa.y;Ta+=(Oa.x+Fa.x)*Da,Va+=(Oa.y+Fa.y)*Da,Ia=Oa,Oa=Fa;var Ga=(ka=ka.next).elt;Ba+=Oa.x*(Ga.y-Ia.y);var Ua=Ga.y*Oa.x-Ga.x*Oa.y;Ta+=(Oa.x+Ga.x)*Ua,Va+=(Oa.y+Ga.y)*Ua;var ja=1/(6*(Ba*=.5)),Wa=-Ba;Na+=(Ta*=ja)*Wa,Aa+=(Va*=ja)*Wa,La-=Ba}else t.geom.ZPP_Collide.flowsegs.add(t.geom.ZPP_Collide.flowpoly.head.elt),t.geom.ZPP_Collide.flowsegs.add(t.geom.ZPP_Collide.flowpoly.head.next.elt);for(;null!=t.geom.ZPP_Collide.flowsegs.head;){var qa=t.geom.ZPP_Collide.flowsegs.pop_unsafe(),Ja=t.geom.ZPP_Collide.flowsegs.pop_unsafe(),$a=0,Xa=0,Ya=($a=Ja.x-qa.x)*$a+(Xa=Ja.y-qa.y)*Xa,Ka=1/Math.sqrt(Ya),Qa=$a*=Ka;$a=-(Xa*=Ka),Xa=Qa;var es=0,ts=0;es=qa.x+Ja.x,ts=qa.y+Ja.y,es*=.5,ts*=.5;var ns,is,rs=$a*(es-=1*i.circle.worldCOMx)+Xa*(ts-=1*i.circle.worldCOMy),os=rs/i.circle.radius,as=Math.sqrt(1-os*os),ss=Math.acos(os);ns=i.circle.radius*(i.circle.radius*ss-rs*as),is=.6666666666666666*i.circle.radius*as*as*as/(ss-os*as),es=i.circle.worldCOMx,ts=i.circle.worldCOMy,Na+=(es+=$a*is)*ns,Aa+=(ts+=Xa*is)*ns,La+=ns}var ls=1/La;return Na*=ls,Aa*=ls,o.overlap=La,o.centroidx=Na,o.centroidy=Aa,!0}return!1}return!1}var ps,us,hs=i.circle,cs=r.circle;ps=cs.worldCOMx-hs.worldCOMx,us=cs.worldCOMy-hs.worldCOMy;var _s=hs.radius+cs.radius,ds=ps*ps+us*us;if(ds>_s*_s)return!1;if(ds<e.Config.epsilon*e.Config.epsilon)return hs.radius<cs.radius?(o.overlap=hs.area,o.centroidx=hs.worldCOMx,o.centroidy=hs.worldCOMy):(o.overlap=cs.area,o.centroidx=cs.worldCOMx,o.centroidy=cs.worldCOMy),!0;var ms=Math.sqrt(ds),Ps=1/ms,fs=.5*(ms-(cs.radius*cs.radius-hs.radius*hs.radius)*Ps);if(fs<=-hs.radius)o.overlap=hs.area,o.centroidx=hs.worldCOMx,o.centroidy=hs.worldCOMy;else{var xs=ms-fs;if(xs<=-cs.radius)o.overlap=cs.area,o.centroidx=cs.worldCOMx,o.centroidy=cs.worldCOMy;else{var ys,vs,gs,bs=fs,zs=bs/hs.radius,ws=Math.sqrt(1-zs*zs),Zs=Math.acos(zs);ys=hs.radius*(hs.radius*Zs-bs*ws),vs=.6666666666666666*hs.radius*ws*ws*ws/(Zs-zs*ws);var Es=xs,Ms=Es/cs.radius,Ss=Math.sqrt(1-Ms*Ms),Cs=Math.acos(Ms),Ns=ys+(gs=cs.radius*(cs.radius*Cs-Es*Ss)),As=(vs*ys+(ms-.6666666666666666*cs.radius*Ss*Ss*Ss/(Cs-Ms*Ss))*gs)/Ns*Ps;o.overlap=Ns,o.centroidx=hs.worldCOMx+ps*As,o.centroidy=hs.worldCOMy+us*As}}return!0},t.geom.ZPP_Collide.prototype.__class__=t.geom.ZPP_Collide,t.geom.ZPP_Convex=l["zpp_nape.geom.ZPP_Convex"]=function(){},t.geom.ZPP_Convex.__name__=["zpp_nape","geom","ZPP_Convex"],t.geom.ZPP_Convex.isinner=function(e,t,n){var i,r,o;return i=e.x-t.x,r=e.y-t.y,o=n.x-t.x,(n.y-t.y)*i-o*r>=0},t.geom.ZPP_Convex.optimise=function(e){var n=e.vertices,i=e.vertices;if(null!=n)for(var r=n;r.sort(),(r=r.next)!=i;);var o=e.vertices,a=e.vertices;if(null!=o)for(var s=o;;){for(var l=s,p=l.prev,u=null,h=l.diagonals.head;null!=h;){var c=h.elt,_=null==h.next?l.next:h.next.elt;if(t.geom.ZPP_Convex.isinner(_,l,p)){for(var d=!0,m=c,P=m.prev,f=null,x=m.diagonals.head;null!=x;){var y=x.elt;if(y==l){var v=null==x.next?m.next:x.next.elt;d=t.geom.ZPP_Convex.isinner(v,m,P);break}P=y,f=x,x=x.next}d?(h=l.diagonals.erase(u),m.diagonals.erase(f)):(p=c,u=h,h=h.next)}else u=h,p=c,h=h.next}if((s=s.next)==a)break}},t.geom.ZPP_Convex.prototype.__class__=t.geom.ZPP_Convex,t.geom.ZPP_ConvexRayResult=l["zpp_nape.geom.ZPP_ConvexRayResult"]=function(){this.toiDistance=0,this.next=null,this.inner=!1,this.ray=null,this.position=null,this.convex=null,this.shape=null,this.normal=null},t.geom.ZPP_ConvexRayResult.__name__=["zpp_nape","geom","ZPP_ConvexRayResult"],t.geom.ZPP_ConvexRayResult.getRay=function(n,i,r,o){var a;null==t.geom.ZPP_ConvexRayResult.rayPool?(t.geom.ZPP_ConvexRayResult.internal=!0,(a=new e.geom.RayResult).zpp_inner=new t.geom.ZPP_ConvexRayResult,a.zpp_inner.ray=a,t.geom.ZPP_ConvexRayResult.internal=!1):(a=t.geom.ZPP_ConvexRayResult.rayPool.ray,t.geom.ZPP_ConvexRayResult.rayPool=t.geom.ZPP_ConvexRayResult.rayPool.next,a.zpp_inner.next=null);var s=a.zpp_inner;return s.normal=n,n.zpp_inner._immutable=!0,s.toiDistance=i,s.inner=r,s.shape=o,a},t.geom.ZPP_ConvexRayResult.getConvex=function(n,i,r,o){var a;null==t.geom.ZPP_ConvexRayResult.convexPool?(t.geom.ZPP_ConvexRayResult.internal=!0,(a=new e.geom.ConvexResult).zpp_inner=new t.geom.ZPP_ConvexRayResult,a.zpp_inner.convex=a,t.geom.ZPP_ConvexRayResult.internal=!1):(a=t.geom.ZPP_ConvexRayResult.convexPool.convex,t.geom.ZPP_ConvexRayResult.convexPool=t.geom.ZPP_ConvexRayResult.convexPool.next,a.zpp_inner.next=null);var s=a.zpp_inner;return s.normal=n,s.position=i,n.zpp_inner._immutable=!0,i.zpp_inner._immutable=!0,s.toiDistance=r,s.shape=o,a},t.geom.ZPP_ConvexRayResult.prototype.normal=null,t.geom.ZPP_ConvexRayResult.prototype.shape=null,t.geom.ZPP_ConvexRayResult.prototype.convex=null,t.geom.ZPP_ConvexRayResult.prototype.position=null,t.geom.ZPP_ConvexRayResult.prototype.ray=null,t.geom.ZPP_ConvexRayResult.prototype.inner=null,t.geom.ZPP_ConvexRayResult.prototype.next=null,t.geom.ZPP_ConvexRayResult.prototype.toiDistance=null,t.geom.ZPP_ConvexRayResult.prototype.disposed=function(){if(null!=this.next)throw new n._Boot.HaxeError("Error: This object has been disposed of and cannot be used")},t.geom.ZPP_ConvexRayResult.prototype.free=function(){this.normal.zpp_inner._immutable=!1;var e=this.normal;if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var i=e.zpp_inner;if(i._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=i._isimmutable&&i._isimmutable(),e.zpp_inner._inuse)throw new n._Boot.HaxeError("Error: This Vec2 is not disposable");var r=e.zpp_inner;e.zpp_inner.outer=null,e.zpp_inner=null;var o=e;o.zpp_pool=null,null!=t.util.ZPP_PubPool.nextVec2?t.util.ZPP_PubPool.nextVec2.zpp_pool=o:t.util.ZPP_PubPool.poolVec2=o,t.util.ZPP_PubPool.nextVec2=o,o.zpp_disp=!0;var a=r;if(null!=a.outer&&(a.outer.zpp_inner=null,a.outer=null),a._isimmutable=null,a._validate=null,a._invalidate=null,a.next=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=a,null!=this.position){this.position.zpp_inner._immutable=!1;var s=this.position;if(null!=s&&s.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var l=s.zpp_inner;if(l._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=l._isimmutable&&l._isimmutable(),s.zpp_inner._inuse)throw new n._Boot.HaxeError("Error: This Vec2 is not disposable");var p=s.zpp_inner;s.zpp_inner.outer=null,s.zpp_inner=null;var u=s;u.zpp_pool=null,null!=t.util.ZPP_PubPool.nextVec2?t.util.ZPP_PubPool.nextVec2.zpp_pool=u:t.util.ZPP_PubPool.poolVec2=u,t.util.ZPP_PubPool.nextVec2=u,u.zpp_disp=!0;var h=p;null!=h.outer&&(h.outer.zpp_inner=null,h.outer=null),h._isimmutable=null,h._validate=null,h._invalidate=null,h.next=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=h}this.shape=null,this.toiDistance=0,null!=this.convex?(this.next=t.geom.ZPP_ConvexRayResult.convexPool,t.geom.ZPP_ConvexRayResult.convexPool=this):(this.next=t.geom.ZPP_ConvexRayResult.rayPool,t.geom.ZPP_ConvexRayResult.rayPool=this)},t.geom.ZPP_ConvexRayResult.prototype.__class__=t.geom.ZPP_ConvexRayResult,t.geom.ZPP_CutVert=l["zpp_nape.geom.ZPP_CutVert"]=function(){this.used=!1,this.rank=0,this.parent=null,this.positive=!1,this.value=0,this.vert=null,this.posy=0,this.posx=0,this.next=null,this.prev=null},t.geom.ZPP_CutVert.__name__=["zpp_nape","geom","ZPP_CutVert"],t.geom.ZPP_CutVert.path=function(e){var n;return null==t.geom.ZPP_CutVert.zpp_pool?n=new t.geom.ZPP_CutVert:(n=t.geom.ZPP_CutVert.zpp_pool,t.geom.ZPP_CutVert.zpp_pool=n.next,n.next=null),n.vert=e,n.parent=n,n.rank=0,n.used=!1,n},t.geom.ZPP_CutVert.prototype.prev=null,t.geom.ZPP_CutVert.prototype.next=null,t.geom.ZPP_CutVert.prototype.posx=null,t.geom.ZPP_CutVert.prototype.posy=null,t.geom.ZPP_CutVert.prototype.vert=null,t.geom.ZPP_CutVert.prototype.value=null,t.geom.ZPP_CutVert.prototype.positive=null,t.geom.ZPP_CutVert.prototype.parent=null,t.geom.ZPP_CutVert.prototype.rank=null,t.geom.ZPP_CutVert.prototype.used=null,t.geom.ZPP_CutVert.prototype.alloc=function(){},t.geom.ZPP_CutVert.prototype.free=function(){this.vert=null,this.parent=null},t.geom.ZPP_CutVert.prototype.__class__=t.geom.ZPP_CutVert,t.geom.ZPP_CutInt=l["zpp_nape.geom.ZPP_CutInt"]=function(){this.path1=null,this.start=null,this.end=null,this.path0=null,this.vertex=!1,this.virtualint=!1,this.time=0,this.next=null},t.geom.ZPP_CutInt.__name__=["zpp_nape","geom","ZPP_CutInt"],t.geom.ZPP_CutInt.get=function(e,n,i,r,o,a,s){var l;return null==s&&(s=!1),null==a&&(a=!1),null==t.geom.ZPP_CutInt.zpp_pool?l=new t.geom.ZPP_CutInt:(l=t.geom.ZPP_CutInt.zpp_pool,t.geom.ZPP_CutInt.zpp_pool=l.next,l.next=null),l.virtualint=a,l.end=n,l.start=i,l.path0=r,l.path1=o,l.time=e,l.vertex=s,l},t.geom.ZPP_CutInt.prototype.next=null,t.geom.ZPP_CutInt.prototype.time=null,t.geom.ZPP_CutInt.prototype.virtualint=null,t.geom.ZPP_CutInt.prototype.vertex=null,t.geom.ZPP_CutInt.prototype.path0=null,t.geom.ZPP_CutInt.prototype.end=null,t.geom.ZPP_CutInt.prototype.start=null,t.geom.ZPP_CutInt.prototype.path1=null,t.geom.ZPP_CutInt.prototype.alloc=function(){},t.geom.ZPP_CutInt.prototype.free=function(){this.end=this.start=null,this.path0=this.path1=null},t.geom.ZPP_CutInt.prototype.__class__=t.geom.ZPP_CutInt,t.geom.ZPP_Cutter=l["zpp_nape.geom.ZPP_Cutter"]=function(){},t.geom.ZPP_Cutter.__name__=["zpp_nape","geom","ZPP_Cutter"],t.geom.ZPP_Cutter.run=function(i,r,o,a,s,l){var p,u;if(null!=r&&r.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var h=r.zpp_inner;if(null!=h._validate&&h._validate(),p=r.zpp_inner.x,null!=r&&r.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var c,_,d=r.zpp_inner;if(null!=d._validate&&d._validate(),u=r.zpp_inner.y,null!=o&&o.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var m=o.zpp_inner;if(null!=m._validate&&m._validate(),c=o.zpp_inner.x-p,null!=o&&o.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var P=o.zpp_inner;null!=P._validate&&P._validate();for(var f=a?0:-1/0,x=s?1:1/0,y=-(u*c-p*(_=o.zpp_inner.y-u)),v=null,g=!1,b=i;;){var z;null==t.geom.ZPP_CutVert.zpp_pool?z=new t.geom.ZPP_CutVert:(z=t.geom.ZPP_CutVert.zpp_pool,t.geom.ZPP_CutVert.zpp_pool=z.next,z.next=null),z.vert=b,z.posx=z.vert.x,z.posy=z.vert.y,z.value=z.posy*c-z.posx*_+y,z.positive=z.value>0,0==z.value&&(g=!0);var w=z;if(null==v?v=w.prev=w.next=w:(w.prev=v,w.next=v.next,v.next.prev=w,v.next=w),v=w,(b=b.next)==i)break}if(g){var Z=null,E=v;if(null!=v)for(var M=v;;){var S=M;if(0!=S.value){Z=S;break}if((M=M.next)==E)break}var C=0,N=0,A=(C=c)*C+(N=_)*N,L=1/Math.sqrt(A),B=C*=L;C=-(N*=L),N=B;for(var T=null,V=Z;;)if(0==V.value||null!=T&&V!=T.next){var k=T.value*V.value;if(0!=k){var I,O=T.next;if(k>0)I=T.positive;else{var R=O.next,H=0,F=0;H=O.posx+R.posx,F=O.posy+R.posy;var D=(H*=.5)+1e-8*C,G=(F*=.5)+1e-8*N,U=!1,j=i;if(null!=i)for(var W=i;;){var q=W,J=q.prev;if((q.y<G&&J.y>=G||J.y<G&&q.y>=G)&&(q.x<=D||J.x<=D)&&q.x+(G-q.y)/(J.y-q.y)*(J.x-q.x)<D&&(U=!U),(W=W.next)==j)break}I=U}var $=V;if(null!=O)for(var X=O;X.positive=I,(X=X.next)!=$;);if(T=V,(V=V.next)==Z)break}else if((V=V.next)==Z)break}else if(T=V,(V=V.next)==Z)break;for(;;){if(0!=V.value&&(null==T||V==T.next)){T=V,V=V.next;break}var Y=T.value*V.value;if(0==Y){V=V.next;break}var K,Q=T.next;if(Y>0)K=T.positive;else{var ee=Q.next,te=0,ne=0;te=Q.posx+ee.posx,ne=Q.posy+ee.posy;var ie=(te*=.5)+1e-8*C,re=(ne*=.5)+1e-8*N,oe=!1,ae=i;if(null!=i)for(var se=i;;){var le=se,pe=le.prev;if((le.y<re&&pe.y>=re||pe.y<re&&le.y>=re)&&(le.x<=ie||pe.x<=ie)&&le.x+(re-le.y)/(pe.y-le.y)*(pe.x-le.x)<ie&&(oe=!oe),(se=se.next)==ae)break}K=oe}var ue=V;if(null!=Q)for(var he=Q;he.positive=K,(he=he.next)!=ue;);T=V,V=V.next;break}}null==t.geom.ZPP_Cutter.ints&&(t.geom.ZPP_Cutter.ints=new t.util.ZNPList_ZPP_CutInt),null==t.geom.ZPP_Cutter.paths&&(t.geom.ZPP_Cutter.paths=new t.util.ZNPList_ZPP_CutVert);var ce,_e=null,de=v.posx,me=v.posy;null==t.geom.ZPP_GeomVert.zpp_pool?ce=new t.geom.ZPP_GeomVert:(ce=t.geom.ZPP_GeomVert.zpp_pool,t.geom.ZPP_GeomVert.zpp_pool=ce.next,ce.next=null),ce.forced=!1,ce.x=de,ce.y=me;var Pe=ce;null==_e?_e=Pe.prev=Pe.next=Pe:(Pe.next=_e,Pe.prev=_e.prev,_e.prev.next=Pe,_e.prev=Pe);var fe,xe=_e;null==t.geom.ZPP_CutVert.zpp_pool?fe=new t.geom.ZPP_CutVert:(fe=t.geom.ZPP_CutVert.zpp_pool,t.geom.ZPP_CutVert.zpp_pool=fe.next,fe.next=null),fe.vert=_e,fe.parent=fe,fe.rank=0,fe.used=!1;var ye=fe;t.geom.ZPP_Cutter.paths.add(ye);for(var ve=v;;){var ge,be=ve.next,ze=be.posx,we=be.posy;null==t.geom.ZPP_GeomVert.zpp_pool?ge=new t.geom.ZPP_GeomVert:(ge=t.geom.ZPP_GeomVert.zpp_pool,t.geom.ZPP_GeomVert.zpp_pool=ge.next,ge.next=null),ge.forced=!1,ge.x=ze,ge.y=we;var Ze=ge;if(ve.positive==be.positive){var Ee=Ze;null==_e?_e=Ee.prev=Ee.next=Ee:(Ee.next=_e,Ee.prev=_e.prev,_e.prev.next=Ee,_e.prev=Ee)}else{var Me,Se,Ce=_*(Me=be.posx-ve.posx)-c*(Se=be.posy-ve.posy);Ce=1/Ce;var Ne,Ae,Le=(Se*(Ne=p-ve.posx)-Me*(Ae=u-ve.posy))*Ce;if(Le<f||Le>x){var Be,Te=t.geom.ZPP_Cutter.ints,Ve=!0;null==Ve&&(Ve=!1),null==t.geom.ZPP_CutInt.zpp_pool?Be=new t.geom.ZPP_CutInt:(Be=t.geom.ZPP_CutInt.zpp_pool,t.geom.ZPP_CutInt.zpp_pool=Be.next,Be.next=null),Be.virtualint=Ve,Be.end=null,Be.start=null,Be.path0=null,Be.path1=null,Be.time=Le,Be.vertex=!1,Te.add(Be);var ke=Ze;null==_e?_e=ke.prev=ke.next=ke:(ke.next=_e,ke.prev=_e.prev,_e.prev.next=ke,_e.prev=ke)}else if(0==ve.value){var Ie=_e.prev;_e=null;var Oe,Re=Ie.x,He=Ie.y;null==t.geom.ZPP_GeomVert.zpp_pool?Oe=new t.geom.ZPP_GeomVert:(Oe=t.geom.ZPP_GeomVert.zpp_pool,t.geom.ZPP_GeomVert.zpp_pool=Oe.next,Oe.next=null),Oe.forced=!1,Oe.x=Re,Oe.y=He;var Fe=Oe;null==_e?_e=Fe.prev=Fe.next=Fe:(Fe.next=_e,Fe.prev=_e.prev,_e.prev.next=Fe,_e.prev=Fe);var De=Ze;null==_e?_e=De.prev=De.next=De:(De.next=_e,De.prev=_e.prev,_e.prev.next=De,_e.prev=De);var Ge,Ue=t.geom.ZPP_Cutter.paths.head.elt,je=t.geom.ZPP_Cutter.paths;null==t.geom.ZPP_CutVert.zpp_pool?Ge=new t.geom.ZPP_CutVert:(Ge=t.geom.ZPP_CutVert.zpp_pool,t.geom.ZPP_CutVert.zpp_pool=Ge.next,Ge.next=null),Ge.vert=_e,Ge.parent=Ge,Ge.rank=0,Ge.used=!1,je.add(Ge);var We,qe=t.geom.ZPP_Cutter.paths.head.elt,Je=t.geom.ZPP_Cutter.ints,$e=!0;null==$e&&($e=!1),null==t.geom.ZPP_CutInt.zpp_pool?We=new t.geom.ZPP_CutInt:(We=t.geom.ZPP_CutInt.zpp_pool,t.geom.ZPP_CutInt.zpp_pool=We.next,We.next=null),We.virtualint=$e,We.end=Ie,We.start=_e,We.path0=Ue,We.path1=qe,We.time=Le,We.vertex=!1,Je.add(We)}else if(0==be.value){var Xe=Ze;null==_e?_e=Xe.prev=Xe.next=Xe:(Xe.next=_e,Xe.prev=_e.prev,_e.prev.next=Xe,_e.prev=Xe);var Ye=_e.prev;_e=null;var Ke,Qe=be.posx,et=be.posy;null==t.geom.ZPP_GeomVert.zpp_pool?Ke=new t.geom.ZPP_GeomVert:(Ke=t.geom.ZPP_GeomVert.zpp_pool,t.geom.ZPP_GeomVert.zpp_pool=Ke.next,Ke.next=null),Ke.forced=!1,Ke.x=Qe,Ke.y=et;var tt=Ke;null==_e?_e=tt.prev=tt.next=tt:(tt.next=_e,tt.prev=_e.prev,_e.prev.next=tt,_e.prev=tt);var nt,it=t.geom.ZPP_Cutter.paths.head.elt,rt=t.geom.ZPP_Cutter.paths;null==t.geom.ZPP_CutVert.zpp_pool?nt=new t.geom.ZPP_CutVert:(nt=t.geom.ZPP_CutVert.zpp_pool,t.geom.ZPP_CutVert.zpp_pool=nt.next,nt.next=null),nt.vert=_e,nt.parent=nt,nt.rank=0,nt.used=!1,rt.add(nt);var ot,at=t.geom.ZPP_Cutter.paths.head.elt,st=t.geom.ZPP_Cutter.ints,lt=!0;null==lt&&(lt=!1),null==t.geom.ZPP_CutInt.zpp_pool?ot=new t.geom.ZPP_CutInt:(ot=t.geom.ZPP_CutInt.zpp_pool,t.geom.ZPP_CutInt.zpp_pool=ot.next,ot.next=null),ot.virtualint=lt,ot.end=Ye,ot.start=_e,ot.path0=it,ot.path1=at,ot.time=Le,ot.vertex=!1,st.add(ot)}else{var pt,ut=(_*Ne-c*Ae)*Ce,ht=0,ct=0;ht=ve.posx,ct=ve.posy,ht+=Me*ut,ct+=Se*ut,null==t.geom.ZPP_GeomVert.zpp_pool?pt=new t.geom.ZPP_GeomVert:(pt=t.geom.ZPP_GeomVert.zpp_pool,t.geom.ZPP_GeomVert.zpp_pool=pt.next,pt.next=null),pt.forced=!1,pt.x=ht,pt.y=ct;var _t=pt;null==_e?_e=_t.prev=_t.next=_t:(_t.next=_e,_t.prev=_e.prev,_e.prev.next=_t,_e.prev=_t);var dt,mt=_e.prev;_e=null,null==t.geom.ZPP_GeomVert.zpp_pool?dt=new t.geom.ZPP_GeomVert:(dt=t.geom.ZPP_GeomVert.zpp_pool,t.geom.ZPP_GeomVert.zpp_pool=dt.next,dt.next=null),dt.forced=!1,dt.x=ht,dt.y=ct;var Pt=dt;null==_e?_e=Pt.prev=Pt.next=Pt:(Pt.next=_e,Pt.prev=_e.prev,_e.prev.next=Pt,_e.prev=Pt);var ft=Ze;null==_e?_e=ft.prev=ft.next=ft:(ft.next=_e,ft.prev=_e.prev,_e.prev.next=ft,_e.prev=ft);var xt,yt=t.geom.ZPP_Cutter.paths.head.elt,vt=t.geom.ZPP_Cutter.paths;null==t.geom.ZPP_CutVert.zpp_pool?xt=new t.geom.ZPP_CutVert:(xt=t.geom.ZPP_CutVert.zpp_pool,t.geom.ZPP_CutVert.zpp_pool=xt.next,xt.next=null),xt.vert=_e,xt.parent=xt,xt.rank=0,xt.used=!1,vt.add(xt);var gt,bt=t.geom.ZPP_Cutter.paths.head.elt,zt=t.geom.ZPP_Cutter.ints,wt=!1;null==wt&&(wt=!1),null==t.geom.ZPP_CutInt.zpp_pool?gt=new t.geom.ZPP_CutInt:(gt=t.geom.ZPP_CutInt.zpp_pool,t.geom.ZPP_CutInt.zpp_pool=gt.next,gt.next=null),gt.virtualint=wt,gt.end=mt,gt.start=_e,gt.path0=yt,gt.path1=bt,gt.time=Le,gt.vertex=!1,zt.add(gt)}}if((ve=ve.next)==v)break}var Zt=_e.prev;Zt.next.prev=xe.prev,xe.prev.next=Zt.next,Zt.next=xe,xe.prev=Zt;var Et,Mt,St=t.geom.ZPP_Cutter.paths.head.elt;if(ye==ye.parent)Et=ye;else{for(var Ct=ye,Nt=null;Ct!=Ct.parent;){var At=Ct.parent;Ct.parent=Nt,Nt=Ct,Ct=At}for(;null!=Nt;){var Lt=Nt.parent;Nt.parent=Ct,Nt=Lt}Et=Ct}if(St==St.parent)Mt=St;else{for(var Bt=St,Tt=null;Bt!=Bt.parent;){var Vt=Bt.parent;Bt.parent=Tt,Tt=Bt,Bt=Vt}for(;null!=Tt;){var kt=Tt.parent;Tt.parent=Bt,Tt=kt}Mt=Bt}Et!=Mt&&(Et.rank<Mt.rank?Et.parent=Mt:Et.rank>Mt.rank?Mt.parent=Et:(Mt.parent=Et,Et.rank++));var It=t.geom.ZPP_Cutter.ints;if(null!=It.head&&null!=It.head.next){for(var Ot,Rt,Ht,Ft=It.head,Dt=null,Gt=null,Ut=null,jt=null,Wt=1;;){for(Ot=0,Gt=Ft,Dt=Ft=null;null!=Gt;){for(++Ot,Ut=Gt,Rt=0,Ht=Wt;null!=Ut&&Rt<Wt;)++Rt,Ut=Ut.next;for(;Rt>0||Ht>0&&null!=Ut;)0==Rt?(jt=Ut,Ut=Ut.next,--Ht):0==Ht||null==Ut||Gt.elt.time<Ut.elt.time?(jt=Gt,Gt=Gt.next,--Rt):(jt=Ut,Ut=Ut.next,--Ht),null!=Dt?Dt.next=jt:Ft=jt,Dt=jt;Gt=Ut}if(Dt.next=null,Wt<<=1,!(Ot>1))break}It.head=Ft,It.modified=!0,It.pushmod=!0}for(;null!=t.geom.ZPP_Cutter.ints.head;){var qt=t.geom.ZPP_Cutter.ints.pop_unsafe(),Jt=t.geom.ZPP_Cutter.ints.pop_unsafe();if(qt.virtualint||Jt.virtualint){if(qt.virtualint&&!Jt.virtualint){var $t,Xt,Yt;if(null!=Jt.end&&Jt.end.prev==Jt.end){Jt.end.next=Jt.end.prev=null;var Kt=Jt.end;if(null!=Kt.wrap){Kt.wrap.zpp_inner._inuse=!1;var Qt=Kt.wrap;if(null!=Qt&&Qt.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var en=Qt.zpp_inner;if(en._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=en._isimmutable&&en._isimmutable(),Qt.zpp_inner._inuse)throw new n._Boot.HaxeError("Error: This Vec2 is not disposable");var tn=Qt.zpp_inner;Qt.zpp_inner.outer=null,Qt.zpp_inner=null;var nn=Qt;nn.zpp_pool=null,null!=t.util.ZPP_PubPool.nextVec2?t.util.ZPP_PubPool.nextVec2.zpp_pool=nn:t.util.ZPP_PubPool.poolVec2=nn,t.util.ZPP_PubPool.nextVec2=nn,nn.zpp_disp=!0;var rn=tn;null!=rn.outer&&(rn.outer.zpp_inner=null,rn.outer=null),rn._isimmutable=null,rn._validate=null,rn._invalidate=null,rn.next=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=rn,Kt.wrap=null}Kt.prev=Kt.next=null,Kt.next=t.geom.ZPP_GeomVert.zpp_pool,t.geom.ZPP_GeomVert.zpp_pool=Kt,$t=null}else{var on=Jt.end.prev;Jt.end.prev.next=Jt.end.next,Jt.end.next.prev=Jt.end.prev,Jt.end.next=Jt.end.prev=null;var an=Jt.end;if(null!=an.wrap){an.wrap.zpp_inner._inuse=!1;var sn=an.wrap;if(null!=sn&&sn.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var ln=sn.zpp_inner;if(ln._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=ln._isimmutable&&ln._isimmutable(),sn.zpp_inner._inuse)throw new n._Boot.HaxeError("Error: This Vec2 is not disposable");var pn=sn.zpp_inner;sn.zpp_inner.outer=null,sn.zpp_inner=null;var un=sn;un.zpp_pool=null,null!=t.util.ZPP_PubPool.nextVec2?t.util.ZPP_PubPool.nextVec2.zpp_pool=un:t.util.ZPP_PubPool.poolVec2=un,t.util.ZPP_PubPool.nextVec2=un,un.zpp_disp=!0;var hn=pn;null!=hn.outer&&(hn.outer.zpp_inner=null,hn.outer=null),hn._isimmutable=null,hn._validate=null,hn._invalidate=null,hn.next=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=hn,an.wrap=null}an.prev=an.next=null,an.next=t.geom.ZPP_GeomVert.zpp_pool,t.geom.ZPP_GeomVert.zpp_pool=an,Jt.end=null,$t=on}if(Jt.end=$t,!Jt.vertex)if(Jt.end!=Jt.path0.vert){var cn;if(Jt.start.x=Jt.end.x,Jt.start.y=Jt.end.y,null!=Jt.end&&Jt.end.prev==Jt.end){Jt.end.next=Jt.end.prev=null;var _n=Jt.end;if(null!=_n.wrap){_n.wrap.zpp_inner._inuse=!1;var dn=_n.wrap;if(null!=dn&&dn.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var mn=dn.zpp_inner;if(mn._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=mn._isimmutable&&mn._isimmutable(),dn.zpp_inner._inuse)throw new n._Boot.HaxeError("Error: This Vec2 is not disposable");var Pn=dn.zpp_inner;dn.zpp_inner.outer=null,dn.zpp_inner=null;var fn=dn;fn.zpp_pool=null,null!=t.util.ZPP_PubPool.nextVec2?t.util.ZPP_PubPool.nextVec2.zpp_pool=fn:t.util.ZPP_PubPool.poolVec2=fn,t.util.ZPP_PubPool.nextVec2=fn,fn.zpp_disp=!0;var xn=Pn;null!=xn.outer&&(xn.outer.zpp_inner=null,xn.outer=null),xn._isimmutable=null,xn._validate=null,xn._invalidate=null,xn.next=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=xn,_n.wrap=null}_n.prev=_n.next=null,_n.next=t.geom.ZPP_GeomVert.zpp_pool,t.geom.ZPP_GeomVert.zpp_pool=_n,cn=null}else{var yn=Jt.end.prev;Jt.end.prev.next=Jt.end.next,Jt.end.next.prev=Jt.end.prev,Jt.end.next=Jt.end.prev=null;var vn=Jt.end;if(null!=vn.wrap){vn.wrap.zpp_inner._inuse=!1;var gn=vn.wrap;if(null!=gn&&gn.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var bn=gn.zpp_inner;if(bn._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=bn._isimmutable&&bn._isimmutable(),gn.zpp_inner._inuse)throw new n._Boot.HaxeError("Error: This Vec2 is not disposable");var zn=gn.zpp_inner;gn.zpp_inner.outer=null,gn.zpp_inner=null;var wn=gn;wn.zpp_pool=null,null!=t.util.ZPP_PubPool.nextVec2?t.util.ZPP_PubPool.nextVec2.zpp_pool=wn:t.util.ZPP_PubPool.poolVec2=wn,t.util.ZPP_PubPool.nextVec2=wn,wn.zpp_disp=!0;var Zn=zn;null!=Zn.outer&&(Zn.outer.zpp_inner=null,Zn.outer=null),Zn._isimmutable=null,Zn._validate=null,Zn._invalidate=null,Zn.next=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=Zn,vn.wrap=null}vn.prev=vn.next=null,vn.next=t.geom.ZPP_GeomVert.zpp_pool,t.geom.ZPP_GeomVert.zpp_pool=vn,Jt.end=null,cn=yn}Jt.end=cn}else{var En=Jt.start.next;if(Jt.start.x=En.x,Jt.start.y=En.y,null!=En&&En.prev==En){En.next=En.prev=null;var Mn=En;if(null!=Mn.wrap){Mn.wrap.zpp_inner._inuse=!1;var Sn=Mn.wrap;if(null!=Sn&&Sn.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var Cn=Sn.zpp_inner;if(Cn._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=Cn._isimmutable&&Cn._isimmutable(),Sn.zpp_inner._inuse)throw new n._Boot.HaxeError("Error: This Vec2 is not disposable");var Nn=Sn.zpp_inner;Sn.zpp_inner.outer=null,Sn.zpp_inner=null;var An=Sn;An.zpp_pool=null,null!=t.util.ZPP_PubPool.nextVec2?t.util.ZPP_PubPool.nextVec2.zpp_pool=An:t.util.ZPP_PubPool.poolVec2=An,t.util.ZPP_PubPool.nextVec2=An,An.zpp_disp=!0;var Ln=Nn;null!=Ln.outer&&(Ln.outer.zpp_inner=null,Ln.outer=null),Ln._isimmutable=null,Ln._validate=null,Ln._invalidate=null,Ln.next=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=Ln,Mn.wrap=null}Mn.prev=Mn.next=null,Mn.next=t.geom.ZPP_GeomVert.zpp_pool,t.geom.ZPP_GeomVert.zpp_pool=Mn,En=null}else{En.prev.next=En.next,En.next.prev=En.prev,En.next=En.prev=null;var Bn=En;if(null!=Bn.wrap){Bn.wrap.zpp_inner._inuse=!1;var Tn=Bn.wrap;if(null!=Tn&&Tn.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var Vn=Tn.zpp_inner;if(Vn._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=Vn._isimmutable&&Vn._isimmutable(),Tn.zpp_inner._inuse)throw new n._Boot.HaxeError("Error: This Vec2 is not disposable");var kn=Tn.zpp_inner;Tn.zpp_inner.outer=null,Tn.zpp_inner=null;var In=Tn;In.zpp_pool=null,null!=t.util.ZPP_PubPool.nextVec2?t.util.ZPP_PubPool.nextVec2.zpp_pool=In:t.util.ZPP_PubPool.poolVec2=In,t.util.ZPP_PubPool.nextVec2=In,In.zpp_disp=!0;var On=kn;null!=On.outer&&(On.outer.zpp_inner=null,On.outer=null),On._isimmutable=null,On._validate=null,On._invalidate=null,On.next=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=On,Bn.wrap=null}Bn.prev=Bn.next=null,Bn.next=t.geom.ZPP_GeomVert.zpp_pool,t.geom.ZPP_GeomVert.zpp_pool=Bn}}if(Jt.end.next.prev=Jt.start.prev,Jt.start.prev.next=Jt.end.next,Jt.end.next=Jt.start,Jt.start.prev=Jt.end,Jt.path0==Jt.path0.parent)Xt=Jt.path0;else{for(var Rn=Jt.path0,Hn=null;Rn!=Rn.parent;){var Fn=Rn.parent;Rn.parent=Hn,Hn=Rn,Rn=Fn}for(;null!=Hn;){var Dn=Hn.parent;Hn.parent=Rn,Hn=Dn}Xt=Rn}if(Jt.path1==Jt.path1.parent)Yt=Jt.path1;else{for(var Gn=Jt.path1,Un=null;Gn!=Gn.parent;){var jn=Gn.parent;Gn.parent=Un,Un=Gn,Gn=jn}for(;null!=Un;){var Wn=Un.parent;Un.parent=Gn,Un=Wn}Yt=Gn}Xt!=Yt&&(Xt.rank<Yt.rank?Xt.parent=Yt:Xt.rank>Yt.rank?Yt.parent=Xt:(Yt.parent=Xt,Xt.rank++))}else if(Jt.virtualint&&!qt.virtualint){var qn,Jn,$n;if(null!=qt.end&&qt.end.prev==qt.end){qt.end.next=qt.end.prev=null;var Xn=qt.end;if(null!=Xn.wrap){Xn.wrap.zpp_inner._inuse=!1;var Yn=Xn.wrap;if(null!=Yn&&Yn.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var Kn=Yn.zpp_inner;if(Kn._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=Kn._isimmutable&&Kn._isimmutable(),Yn.zpp_inner._inuse)throw new n._Boot.HaxeError("Error: This Vec2 is not disposable");var Qn=Yn.zpp_inner;Yn.zpp_inner.outer=null,Yn.zpp_inner=null;var ei=Yn;ei.zpp_pool=null,null!=t.util.ZPP_PubPool.nextVec2?t.util.ZPP_PubPool.nextVec2.zpp_pool=ei:t.util.ZPP_PubPool.poolVec2=ei,t.util.ZPP_PubPool.nextVec2=ei,ei.zpp_disp=!0;var ti=Qn;null!=ti.outer&&(ti.outer.zpp_inner=null,ti.outer=null),ti._isimmutable=null,ti._validate=null,ti._invalidate=null,ti.next=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=ti,Xn.wrap=null}Xn.prev=Xn.next=null,Xn.next=t.geom.ZPP_GeomVert.zpp_pool,t.geom.ZPP_GeomVert.zpp_pool=Xn,qn=null}else{var ni=qt.end.prev;qt.end.prev.next=qt.end.next,qt.end.next.prev=qt.end.prev,qt.end.next=qt.end.prev=null;var ii=qt.end;if(null!=ii.wrap){ii.wrap.zpp_inner._inuse=!1;var ri=ii.wrap;if(null!=ri&&ri.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var oi=ri.zpp_inner;if(oi._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=oi._isimmutable&&oi._isimmutable(),ri.zpp_inner._inuse)throw new n._Boot.HaxeError("Error: This Vec2 is not disposable");var ai=ri.zpp_inner;ri.zpp_inner.outer=null,ri.zpp_inner=null;var si=ri;si.zpp_pool=null,null!=t.util.ZPP_PubPool.nextVec2?t.util.ZPP_PubPool.nextVec2.zpp_pool=si:t.util.ZPP_PubPool.poolVec2=si,t.util.ZPP_PubPool.nextVec2=si,si.zpp_disp=!0;var li=ai;null!=li.outer&&(li.outer.zpp_inner=null,li.outer=null),li._isimmutable=null,li._validate=null,li._invalidate=null,li.next=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=li,ii.wrap=null}ii.prev=ii.next=null,ii.next=t.geom.ZPP_GeomVert.zpp_pool,t.geom.ZPP_GeomVert.zpp_pool=ii,qt.end=null,qn=ni}if(qt.end=qn,!qt.vertex)if(qt.end!=qt.path0.vert){var pi;if(qt.start.x=qt.end.x,qt.start.y=qt.end.y,null!=qt.end&&qt.end.prev==qt.end){qt.end.next=qt.end.prev=null;var ui=qt.end;if(null!=ui.wrap){ui.wrap.zpp_inner._inuse=!1;var hi=ui.wrap;if(null!=hi&&hi.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var ci=hi.zpp_inner;if(ci._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=ci._isimmutable&&ci._isimmutable(),hi.zpp_inner._inuse)throw new n._Boot.HaxeError("Error: This Vec2 is not disposable");var _i=hi.zpp_inner;hi.zpp_inner.outer=null,hi.zpp_inner=null;var di=hi;di.zpp_pool=null,null!=t.util.ZPP_PubPool.nextVec2?t.util.ZPP_PubPool.nextVec2.zpp_pool=di:t.util.ZPP_PubPool.poolVec2=di,t.util.ZPP_PubPool.nextVec2=di,di.zpp_disp=!0;var mi=_i;null!=mi.outer&&(mi.outer.zpp_inner=null,mi.outer=null),mi._isimmutable=null,mi._validate=null,mi._invalidate=null,mi.next=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=mi,ui.wrap=null}ui.prev=ui.next=null,ui.next=t.geom.ZPP_GeomVert.zpp_pool,t.geom.ZPP_GeomVert.zpp_pool=ui,pi=null}else{var Pi=qt.end.prev;qt.end.prev.next=qt.end.next,qt.end.next.prev=qt.end.prev,qt.end.next=qt.end.prev=null;var fi=qt.end;if(null!=fi.wrap){fi.wrap.zpp_inner._inuse=!1;var xi=fi.wrap;if(null!=xi&&xi.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var yi=xi.zpp_inner;if(yi._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=yi._isimmutable&&yi._isimmutable(),xi.zpp_inner._inuse)throw new n._Boot.HaxeError("Error: This Vec2 is not disposable");var vi=xi.zpp_inner;xi.zpp_inner.outer=null,xi.zpp_inner=null;var gi=xi;gi.zpp_pool=null,null!=t.util.ZPP_PubPool.nextVec2?t.util.ZPP_PubPool.nextVec2.zpp_pool=gi:t.util.ZPP_PubPool.poolVec2=gi,t.util.ZPP_PubPool.nextVec2=gi,gi.zpp_disp=!0;var bi=vi;null!=bi.outer&&(bi.outer.zpp_inner=null,bi.outer=null),bi._isimmutable=null,bi._validate=null,bi._invalidate=null,bi.next=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=bi,fi.wrap=null}fi.prev=fi.next=null,fi.next=t.geom.ZPP_GeomVert.zpp_pool,t.geom.ZPP_GeomVert.zpp_pool=fi,qt.end=null,pi=Pi}qt.end=pi}else{var zi=qt.start.next;if(qt.start.x=zi.x,qt.start.y=zi.y,null!=zi&&zi.prev==zi){zi.next=zi.prev=null;var wi=zi;if(null!=wi.wrap){wi.wrap.zpp_inner._inuse=!1;var Zi=wi.wrap;if(null!=Zi&&Zi.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var Ei=Zi.zpp_inner;if(Ei._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=Ei._isimmutable&&Ei._isimmutable(),Zi.zpp_inner._inuse)throw new n._Boot.HaxeError("Error: This Vec2 is not disposable");var Mi=Zi.zpp_inner;Zi.zpp_inner.outer=null,Zi.zpp_inner=null;var Si=Zi;Si.zpp_pool=null,null!=t.util.ZPP_PubPool.nextVec2?t.util.ZPP_PubPool.nextVec2.zpp_pool=Si:t.util.ZPP_PubPool.poolVec2=Si,t.util.ZPP_PubPool.nextVec2=Si,Si.zpp_disp=!0;var Ci=Mi;null!=Ci.outer&&(Ci.outer.zpp_inner=null,Ci.outer=null),Ci._isimmutable=null,Ci._validate=null,Ci._invalidate=null,Ci.next=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=Ci,wi.wrap=null}wi.prev=wi.next=null,wi.next=t.geom.ZPP_GeomVert.zpp_pool,t.geom.ZPP_GeomVert.zpp_pool=wi,zi=null}else{zi.prev.next=zi.next,zi.next.prev=zi.prev,zi.next=zi.prev=null;var Ni=zi;if(null!=Ni.wrap){Ni.wrap.zpp_inner._inuse=!1;var Ai=Ni.wrap;if(null!=Ai&&Ai.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var Li=Ai.zpp_inner;if(Li._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=Li._isimmutable&&Li._isimmutable(),Ai.zpp_inner._inuse)throw new n._Boot.HaxeError("Error: This Vec2 is not disposable");var Bi=Ai.zpp_inner;Ai.zpp_inner.outer=null,Ai.zpp_inner=null;var Ti=Ai;Ti.zpp_pool=null,null!=t.util.ZPP_PubPool.nextVec2?t.util.ZPP_PubPool.nextVec2.zpp_pool=Ti:t.util.ZPP_PubPool.poolVec2=Ti,t.util.ZPP_PubPool.nextVec2=Ti,Ti.zpp_disp=!0;var Vi=Bi;null!=Vi.outer&&(Vi.outer.zpp_inner=null,Vi.outer=null),Vi._isimmutable=null,Vi._validate=null,Vi._invalidate=null,Vi.next=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=Vi,Ni.wrap=null}Ni.prev=Ni.next=null,Ni.next=t.geom.ZPP_GeomVert.zpp_pool,t.geom.ZPP_GeomVert.zpp_pool=Ni}}if(qt.end.next.prev=qt.start.prev,qt.start.prev.next=qt.end.next,qt.end.next=qt.start,qt.start.prev=qt.end,qt.path0==qt.path0.parent)Jn=qt.path0;else{for(var ki=qt.path0,Ii=null;ki!=ki.parent;){var Oi=ki.parent;ki.parent=Ii,Ii=ki,ki=Oi}for(;null!=Ii;){var Ri=Ii.parent;Ii.parent=ki,Ii=Ri}Jn=ki}if(qt.path1==qt.path1.parent)$n=qt.path1;else{for(var Hi=qt.path1,Fi=null;Hi!=Hi.parent;){var Di=Hi.parent;Hi.parent=Fi,Fi=Hi,Hi=Di}for(;null!=Fi;){var Gi=Fi.parent;Fi.parent=Hi,Fi=Gi}$n=Hi}Jn!=$n&&(Jn.rank<$n.rank?Jn.parent=$n:Jn.rank>$n.rank?$n.parent=Jn:($n.parent=Jn,Jn.rank++))}}else{var Ui,ji,Wi,qi;if(qt.end.next.prev=Jt.start.prev,Jt.start.prev.next=qt.end.next,qt.end.next=Jt.start,Jt.start.prev=qt.end,Jt.end.next.prev=qt.start.prev,qt.start.prev.next=Jt.end.next,Jt.end.next=qt.start,qt.start.prev=Jt.end,qt.path0==qt.path0.parent)Ui=qt.path0;else{for(var Ji=qt.path0,$i=null;Ji!=Ji.parent;){var Xi=Ji.parent;Ji.parent=$i,$i=Ji,Ji=Xi}for(;null!=$i;){var Yi=$i.parent;$i.parent=Ji,$i=Yi}Ui=Ji}if(Jt.path1==Jt.path1.parent)ji=Jt.path1;else{for(var Ki=Jt.path1,Qi=null;Ki!=Ki.parent;){var er=Ki.parent;Ki.parent=Qi,Qi=Ki,Ki=er}for(;null!=Qi;){var tr=Qi.parent;Qi.parent=Ki,Qi=tr}ji=Ki}if(Ui!=ji&&(Ui.rank<ji.rank?Ui.parent=ji:Ui.rank>ji.rank?ji.parent=Ui:(ji.parent=Ui,Ui.rank++)),qt.path1==qt.path1.parent)Wi=qt.path1;else{for(var nr=qt.path1,ir=null;nr!=nr.parent;){var rr=nr.parent;nr.parent=ir,ir=nr,nr=rr}for(;null!=ir;){var or=ir.parent;ir.parent=nr,ir=or}Wi=nr}if(Jt.path0==Jt.path0.parent)qi=Jt.path0;else{for(var ar=Jt.path0,sr=null;ar!=ar.parent;){var lr=ar.parent;ar.parent=sr,sr=ar,ar=lr}for(;null!=sr;){var pr=sr.parent;sr.parent=ar,sr=pr}qi=ar}Wi!=qi&&(Wi.rank<qi.rank?Wi.parent=qi:Wi.rank>qi.rank?qi.parent=Wi:(qi.parent=Wi,Wi.rank++))}var ur=qt;ur.end=ur.start=null,ur.path0=ur.path1=null,ur.next=t.geom.ZPP_CutInt.zpp_pool,t.geom.ZPP_CutInt.zpp_pool=ur;var hr=Jt;hr.end=hr.start=null,hr.path0=hr.path1=null,hr.next=t.geom.ZPP_CutInt.zpp_pool,t.geom.ZPP_CutInt.zpp_pool=hr}for(var cr=null==l?new e.geom.GeomPolyList:l,_r=t.geom.ZPP_Cutter.paths.head;null!=_r;){var dr,mr=_r.elt;if(mr==mr.parent)dr=mr;else{for(var Pr=mr,fr=null;Pr!=Pr.parent;){var xr=Pr.parent;Pr.parent=fr,fr=Pr,Pr=xr}for(;null!=fr;){var yr=fr.parent;fr.parent=Pr,fr=yr}dr=Pr}if(dr.used)_r=_r.next;else{dr.used=!0;for(var vr=dr.vert,gr=!0;null!=dr.vert&&(gr||vr!=dr.vert);)if(gr=!1,vr.x==vr.next.x&&vr.y==vr.next.y)if(vr==dr.vert&&(dr.vert=vr.next==vr?null:vr.next,gr=!0),null!=vr&&vr.prev==vr)vr.next=vr.prev=null,vr=vr=null;else{var br=vr.next;vr.prev.next=vr.next,vr.next.prev=vr.prev,vr.next=vr.prev=null,vr=null,vr=br}else vr=vr.next;if(null!=dr.vert){var zr=e.geom.GeomPoly.get();zr.zpp_inner.vertices=dr.vert,cr.zpp_inner.reverse_flag?cr.push(zr):cr.unshift(zr)}_r=_r.next}}for(;null!=t.geom.ZPP_Cutter.paths.head;){var wr=t.geom.ZPP_Cutter.paths.pop_unsafe();wr.vert=null,wr.parent=null,wr.next=t.geom.ZPP_CutVert.zpp_pool,t.geom.ZPP_CutVert.zpp_pool=wr}for(;null!=v;)if(null!=v&&v.prev==v){v.next=v.prev=null;var Zr=v;Zr.vert=null,Zr.parent=null,Zr.next=t.geom.ZPP_CutVert.zpp_pool,t.geom.ZPP_CutVert.zpp_pool=Zr,v=v=null}else{var Er=v.next;v.prev.next=v.next,v.next.prev=v.prev,v.next=v.prev=null;var Mr=v;Mr.vert=null,Mr.parent=null,Mr.next=t.geom.ZPP_CutVert.zpp_pool,t.geom.ZPP_CutVert.zpp_pool=Mr,v=null,v=Er}return cr},t.geom.ZPP_Cutter.prototype.__class__=t.geom.ZPP_Cutter,t.geom.ZPP_Geom=l["zpp_nape.geom.ZPP_Geom"]=function(){},t.geom.ZPP_Geom.__name__=["zpp_nape","geom","ZPP_Geom"],t.geom.ZPP_Geom.validateShape=function(e){if(1==e.type){var t=e.polygon;if(t.zip_gaxi&&null!=t.body){t.zip_gaxi=!1,t.validate_laxi();var i=t.body;if(i.zip_axis&&(i.zip_axis=!1,i.axisx=Math.sin(i.rot),i.axisy=Math.cos(i.rot)),t.zip_gverts&&null!=t.body){t.zip_gverts=!1,t.validate_lverts();var r=t.body;r.zip_axis&&(r.zip_axis=!1,r.axisx=Math.sin(r.rot),r.axisy=Math.cos(r.rot));for(var o=t.lverts.next,a=t.gverts.next;null!=a;){var s=a,l=o;o=o.next,s.x=t.body.posx+(t.body.axisy*l.x-t.body.axisx*l.y),s.y=t.body.posy+(l.x*t.body.axisx+l.y*t.body.axisy),a=a.next}}var p=t.edges.head,u=t.gverts.next,h=u;for(u=u.next;null!=u;){var c=u,_=p.elt;p=p.next,_.gp0=h,_.gp1=c,_.gnormx=t.body.axisy*_.lnormx-t.body.axisx*_.lnormy,_.gnormy=_.lnormx*t.body.axisx+_.lnormy*t.body.axisy,_.gprojection=t.body.posx*_.gnormx+t.body.posy*_.gnormy+_.lprojection,null!=_.wrap_gnorm&&(_.wrap_gnorm.zpp_inner.x=_.gnormx,_.wrap_gnorm.zpp_inner.y=_.gnormy),_.tp0=_.gp0.y*_.gnormx-_.gp0.x*_.gnormy,_.tp1=_.gp1.y*_.gnormx-_.gp1.x*_.gnormy,h=c,u=u.next}var d=t.gverts.next,m=p.elt;p=p.next,m.gp0=h,m.gp1=d,m.gnormx=t.body.axisy*m.lnormx-t.body.axisx*m.lnormy,m.gnormy=m.lnormx*t.body.axisx+m.lnormy*t.body.axisy,m.gprojection=t.body.posx*m.gnormx+t.body.posy*m.gnormy+m.lprojection,null!=m.wrap_gnorm&&(m.wrap_gnorm.zpp_inner.x=m.gnormx,m.wrap_gnorm.zpp_inner.y=m.gnormy),m.tp0=m.gp0.y*m.gnormx-m.gp0.x*m.gnormy,m.tp1=m.gp1.y*m.gnormx-m.gp1.x*m.gnormy}}if(e.zip_aabb&&null!=e.body)if(e.zip_aabb=!1,0==e.type){var P=e.circle;if(P.zip_worldCOM&&null!=P.body){if(P.zip_worldCOM=!1,P.zip_localCOM){if(P.zip_localCOM=!1,1==P.type){var f=P.polygon;if(null==f.lverts.next)throw new n._Boot.HaxeError("Error: An empty polygon has no meaningful localCOM");if(null==f.lverts.next.next)f.localCOMx=f.lverts.next.x,f.localCOMy=f.lverts.next.y;else if(null==f.lverts.next.next.next)f.localCOMx=f.lverts.next.x,f.localCOMy=f.lverts.next.y,f.localCOMx+=1*f.lverts.next.next.x,f.localCOMy+=1*f.lverts.next.next.y,f.localCOMx*=.5,f.localCOMy*=.5;else{f.localCOMx=0,f.localCOMy=0;var x=0,y=f.lverts.next,v=y,g=y=y.next;for(y=y.next;null!=y;){var b=y;x+=g.x*(b.y-v.y);var z=b.y*g.x-b.x*g.y;f.localCOMx+=(g.x+b.x)*z,f.localCOMy+=(g.y+b.y)*z,v=g,g=b,y=y.next}var w=y=f.lverts.next;x+=g.x*(w.y-v.y);var Z=w.y*g.x-w.x*g.y;f.localCOMx+=(g.x+w.x)*Z,f.localCOMy+=(g.y+w.y)*Z,v=g,g=w;var E=y=y.next;x+=g.x*(E.y-v.y);var M=E.y*g.x-E.x*g.y;f.localCOMx+=(g.x+E.x)*M,f.localCOMy+=(g.y+E.y)*M;var S=x=1/(3*x);f.localCOMx*=S,f.localCOMy*=S}}null!=P.wrap_localCOM&&(P.wrap_localCOM.zpp_inner.x=P.localCOMx,P.wrap_localCOM.zpp_inner.y=P.localCOMy)}var C=P.body;C.zip_axis&&(C.zip_axis=!1,C.axisx=Math.sin(C.rot),C.axisy=Math.cos(C.rot)),P.worldCOMx=P.body.posx+(P.body.axisy*P.localCOMx-P.body.axisx*P.localCOMy),P.worldCOMy=P.body.posy+(P.localCOMx*P.body.axisx+P.localCOMy*P.body.axisy)}var N=P.radius,A=P.radius;P.aabb.minx=P.worldCOMx-N,P.aabb.miny=P.worldCOMy-A,P.aabb.maxx=P.worldCOMx+N,P.aabb.maxy=P.worldCOMy+A}else{var L=e.polygon;if(L.zip_gverts&&null!=L.body){L.zip_gverts=!1,L.validate_lverts();var B=L.body;B.zip_axis&&(B.zip_axis=!1,B.axisx=Math.sin(B.rot),B.axisy=Math.cos(B.rot));for(var T=L.lverts.next,V=L.gverts.next;null!=V;){var k=V,I=T;T=T.next,k.x=L.body.posx+(L.body.axisy*I.x-L.body.axisx*I.y),k.y=L.body.posy+(I.x*L.body.axisx+I.y*L.body.axisy),V=V.next}}if(null==L.lverts.next)throw new n._Boot.HaxeError("Error: An empty polygon has no meaningful bounds");var O=L.gverts.next;L.aabb.minx=O.x,L.aabb.miny=O.y,L.aabb.maxx=O.x,L.aabb.maxy=O.y;for(var R=L.gverts.next.next;null!=R;){var H=R;H.x<L.aabb.minx&&(L.aabb.minx=H.x),H.x>L.aabb.maxx&&(L.aabb.maxx=H.x),H.y<L.aabb.miny&&(L.aabb.miny=H.y),H.y>L.aabb.maxy&&(L.aabb.maxy=H.y),R=R.next}}if(e.zip_worldCOM&&null!=e.body){if(e.zip_worldCOM=!1,e.zip_localCOM){if(e.zip_localCOM=!1,1==e.type){var F=e.polygon;if(null==F.lverts.next)throw new n._Boot.HaxeError("Error: An empty polygon has no meaningful localCOM");if(null==F.lverts.next.next)F.localCOMx=F.lverts.next.x,F.localCOMy=F.lverts.next.y;else if(null==F.lverts.next.next.next)F.localCOMx=F.lverts.next.x,F.localCOMy=F.lverts.next.y,F.localCOMx+=1*F.lverts.next.next.x,F.localCOMy+=1*F.lverts.next.next.y,F.localCOMx*=.5,F.localCOMy*=.5;else{F.localCOMx=0,F.localCOMy=0;var D=0,G=F.lverts.next,U=G,j=G=G.next;for(G=G.next;null!=G;){var W=G;D+=j.x*(W.y-U.y);var q=W.y*j.x-W.x*j.y;F.localCOMx+=(j.x+W.x)*q,F.localCOMy+=(j.y+W.y)*q,U=j,j=W,G=G.next}var J=G=F.lverts.next;D+=j.x*(J.y-U.y);var $=J.y*j.x-J.x*j.y;F.localCOMx+=(j.x+J.x)*$,F.localCOMy+=(j.y+J.y)*$,U=j,j=J;var X=G=G.next;D+=j.x*(X.y-U.y);var Y=X.y*j.x-X.x*j.y;F.localCOMx+=(j.x+X.x)*Y,F.localCOMy+=(j.y+X.y)*Y;var K=D=1/(3*D);F.localCOMx*=K,F.localCOMy*=K}}null!=e.wrap_localCOM&&(e.wrap_localCOM.zpp_inner.x=e.localCOMx,e.wrap_localCOM.zpp_inner.y=e.localCOMy)}var Q=e.body;Q.zip_axis&&(Q.zip_axis=!1,Q.axisx=Math.sin(Q.rot),Q.axisy=Math.cos(Q.rot)),e.worldCOMx=e.body.posx+(e.body.axisy*e.localCOMx-e.body.axisx*e.localCOMy),e.worldCOMy=e.body.posy+(e.localCOMx*e.body.axisx+e.localCOMy*e.body.axisy)}},t.geom.ZPP_Geom.prototype.__class__=t.geom.ZPP_Geom,t.geom.ZPP_GeomVert=l["zpp_nape.geom.ZPP_GeomVert"]=function(){this.forced=!1,this.wrap=null,this.next=null,this.prev=null,this.y=0,this.x=0},t.geom.ZPP_GeomVert.__name__=["zpp_nape","geom","ZPP_GeomVert"],t.geom.ZPP_GeomVert.get=function(e,n){var i;return null==t.geom.ZPP_GeomVert.zpp_pool?i=new t.geom.ZPP_GeomVert:(i=t.geom.ZPP_GeomVert.zpp_pool,t.geom.ZPP_GeomVert.zpp_pool=i.next,i.next=null),i.forced=!1,i.x=e,i.y=n,i},t.geom.ZPP_GeomVert.prototype.x=null,t.geom.ZPP_GeomVert.prototype.y=null,t.geom.ZPP_GeomVert.prototype.prev=null,t.geom.ZPP_GeomVert.prototype.next=null,t.geom.ZPP_GeomVert.prototype.wrap=null,t.geom.ZPP_GeomVert.prototype.forced=null,t.geom.ZPP_GeomVert.prototype.free=function(){if(null!=this.wrap){this.wrap.zpp_inner._inuse=!1;var e=this.wrap;if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var i=e.zpp_inner;if(i._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=i._isimmutable&&i._isimmutable(),e.zpp_inner._inuse)throw new n._Boot.HaxeError("Error: This Vec2 is not disposable");var r=e.zpp_inner;e.zpp_inner.outer=null,e.zpp_inner=null;var o=e;o.zpp_pool=null,null!=t.util.ZPP_PubPool.nextVec2?t.util.ZPP_PubPool.nextVec2.zpp_pool=o:t.util.ZPP_PubPool.poolVec2=o,t.util.ZPP_PubPool.nextVec2=o,o.zpp_disp=!0;var a=r;null!=a.outer&&(a.outer.zpp_inner=null,a.outer=null),a._isimmutable=null,a._validate=null,a._invalidate=null,a.next=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=a,this.wrap=null}this.prev=this.next=null},t.geom.ZPP_GeomVert.prototype.alloc=function(){this.forced=!1},t.geom.ZPP_GeomVert.prototype.wrapper=function(){if(null==this.wrap){var i,r=this.x,o=this.y;if(null==o&&(o=0),null==r&&(r=0),r!=r||o!=o)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null==t.util.ZPP_PubPool.poolVec2?i=new e.geom.Vec2:(i=t.util.ZPP_PubPool.poolVec2,t.util.ZPP_PubPool.poolVec2=i.zpp_pool,i.zpp_pool=null,i.zpp_disp=!1,i==t.util.ZPP_PubPool.nextVec2&&(t.util.ZPP_PubPool.nextVec2=null)),null==i.zpp_inner){var a;null==t.geom.ZPP_Vec2.zpp_pool?a=new t.geom.ZPP_Vec2:(a=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=a.next,a.next=null),a.weak=!1,a._immutable=!1,a.x=r,a.y=o,i.zpp_inner=a,i.zpp_inner.outer=i}else{if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var s,l=i.zpp_inner;if(l._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=l._isimmutable&&l._isimmutable(),r!=r||o!=o)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var u=i.zpp_inner;if(null!=u._validate&&u._validate(),i.zpp_inner.x==r){if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var h=i.zpp_inner;null!=h._validate&&h._validate(),s=i.zpp_inner.y==o}else s=!1;if(!s){i.zpp_inner.x=r,i.zpp_inner.y=o;var c=i.zpp_inner;null!=c._invalidate&&c._invalidate(c)}}i.zpp_inner.weak=!1,this.wrap=i,this.wrap.zpp_inner._inuse=!0,this.wrap.zpp_inner._invalidate=p(this,this.modwrap),this.wrap.zpp_inner._validate=p(this,this.getwrap)}return this.wrap},t.geom.ZPP_GeomVert.prototype.modwrap=function(e){this.x=e.x,this.y=e.y},t.geom.ZPP_GeomVert.prototype.getwrap=function(){this.wrap.zpp_inner.x=this.x,this.wrap.zpp_inner.y=this.y},t.geom.ZPP_GeomVert.prototype.__class__=t.geom.ZPP_GeomVert,t.geom.ZPP_GeomPoly=l["zpp_nape.geom.ZPP_GeomPoly"]=function(e){this.vertices=null,this.outer=null,this.outer=e},t.geom.ZPP_GeomPoly.__name__=["zpp_nape","geom","ZPP_GeomPoly"],t.geom.ZPP_GeomPoly.prototype.outer=null,t.geom.ZPP_GeomPoly.prototype.vertices=null,t.geom.ZPP_GeomPoly.prototype.__class__=t.geom.ZPP_GeomPoly,t.geom.ZPP_GeomVertexIterator=l["zpp_nape.geom.ZPP_GeomVertexIterator"]=function(){this.next=null,this.outer=null,this.forward=!1,this.first=!1,this.start=null,this.ptr=null,t.geom.ZPP_GeomVertexIterator.internal=!0,this.outer=new e.geom.GeomVertexIterator,t.geom.ZPP_GeomVertexIterator.internal=!1},t.geom.ZPP_GeomVertexIterator.__name__=["zpp_nape","geom","ZPP_GeomVertexIterator"],t.geom.ZPP_GeomVertexIterator.get=function(e,n){var i;return null==t.geom.ZPP_GeomVertexIterator.zpp_pool?i=new t.geom.ZPP_GeomVertexIterator:(i=t.geom.ZPP_GeomVertexIterator.zpp_pool,t.geom.ZPP_GeomVertexIterator.zpp_pool=i.next,i.next=null),i.outer.zpp_inner=i,i.ptr=e,i.forward=n,i.start=e,i.first=null!=e,i.outer},t.geom.ZPP_GeomVertexIterator.prototype.ptr=null,t.geom.ZPP_GeomVertexIterator.prototype.start=null,t.geom.ZPP_GeomVertexIterator.prototype.first=null,t.geom.ZPP_GeomVertexIterator.prototype.forward=null,t.geom.ZPP_GeomVertexIterator.prototype.outer=null,t.geom.ZPP_GeomVertexIterator.prototype.next=null,t.geom.ZPP_GeomVertexIterator.prototype.free=function(){this.outer.zpp_inner=null,this.ptr=this.start=null},t.geom.ZPP_GeomVertexIterator.prototype.alloc=function(){},t.geom.ZPP_GeomVertexIterator.prototype.__class__=t.geom.ZPP_GeomVertexIterator,t.geom.ZPP_MarchSpan=l["zpp_nape.geom.ZPP_MarchSpan"]=function(){this.next=null,this.out=!1,this.rank=0,this.parent=null,this.parent=this},t.geom.ZPP_MarchSpan.__name__=["zpp_nape","geom","ZPP_MarchSpan"],t.geom.ZPP_MarchSpan.prototype.parent=null,t.geom.ZPP_MarchSpan.prototype.rank=null,t.geom.ZPP_MarchSpan.prototype.out=null,t.geom.ZPP_MarchSpan.prototype.next=null,t.geom.ZPP_MarchSpan.prototype.free=function(){this.parent=this},t.geom.ZPP_MarchSpan.prototype.alloc=function(){this.out=!1,this.rank=0},t.geom.ZPP_MarchSpan.prototype.__class__=t.geom.ZPP_MarchSpan,t.geom.ZPP_MarchPair=l["zpp_nape.geom.ZPP_MarchPair"]=function(){this.next=null,this.spanr=null,this.span2=null,this.span1=null,this.pd=null,this.okeyr=0,this.keyr=0,this.pr=null,this.okey2=0,this.key2=0,this.p2=null,this.okey1=0,this.key1=0,this.p1=null},t.geom.ZPP_MarchPair.__name__=["zpp_nape","geom","ZPP_MarchPair"],t.geom.ZPP_MarchPair.prototype.p1=null,t.geom.ZPP_MarchPair.prototype.key1=null,t.geom.ZPP_MarchPair.prototype.okey1=null,t.geom.ZPP_MarchPair.prototype.p2=null,t.geom.ZPP_MarchPair.prototype.key2=null,t.geom.ZPP_MarchPair.prototype.okey2=null,t.geom.ZPP_MarchPair.prototype.pr=null,t.geom.ZPP_MarchPair.prototype.keyr=null,t.geom.ZPP_MarchPair.prototype.okeyr=null,t.geom.ZPP_MarchPair.prototype.pd=null,t.geom.ZPP_MarchPair.prototype.span1=null,t.geom.ZPP_MarchPair.prototype.span2=null,t.geom.ZPP_MarchPair.prototype.spanr=null,t.geom.ZPP_MarchPair.prototype.next=null,t.geom.ZPP_MarchPair.prototype.free=function(){this.p1=this.p2=this.pr=this.pd=null,this.span1=this.span2=this.spanr=null},t.geom.ZPP_MarchPair.prototype.alloc=function(){},t.geom.ZPP_MarchPair.prototype.__class__=t.geom.ZPP_MarchPair,t.geom.ZPP_MarchingSquares=l["zpp_nape.geom.ZPP_MarchingSquares"]=function(){},t.geom.ZPP_MarchingSquares.__name__=["zpp_nape","geom","ZPP_MarchingSquares"],t.geom.ZPP_MarchingSquares.isos=null,t.geom.ZPP_MarchingSquares.ints=null,t.geom.ZPP_MarchingSquares.map=null,t.geom.ZPP_MarchingSquares.run=function(e,i,r,o,a,s,l,p,u){if(null!=s&&s.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var h=s.zpp_inner;null!=h._validate&&h._validate();var c=(o-i)/s.zpp_inner.x,_=0|c;if(null!=s&&s.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var d=s.zpp_inner;null!=d._validate&&d._validate();var m=(a-r)/s.zpp_inner.y,P=0|m;c!=_&&++_,m!=P&&++P,p&&(null==t.geom.ZPP_MarchingSquares.map?t.geom.ZPP_MarchingSquares.map=new t.util.ZNPArray2_ZPP_MarchPair(_,P):t.geom.ZPP_MarchingSquares.map.resize(_,P,null)),null==t.geom.ZPP_MarchingSquares.isos?t.geom.ZPP_MarchingSquares.isos=new t.util.ZNPArray2_Float(_+1,P+1):t.geom.ZPP_MarchingSquares.isos.resize(_+1,P+1,0);for(var f=0,x=P+1;f<x;){var y,v=f++;if(0==v)y=r;else if(v<=P){if(null!=s&&s.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var g=s.zpp_inner;null!=g._validate&&g._validate(),y=r+s.zpp_inner.y*v}else y=a;for(var b=0,z=_+1;b<z;){var w,Z=b++;if(0==Z)w=i;else if(Z<=_){if(null!=s&&s.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var E=s.zpp_inner;null!=E._validate&&E._validate(),w=i+s.zpp_inner.x*Z}else w=o;var M=t.geom.ZPP_MarchingSquares.isos,S=e(w,y);M.list[v*M.width+Z]=S}}null==t.geom.ZPP_MarchingSquares.ints?t.geom.ZPP_MarchingSquares.ints=new t.util.ZNPArray2_ZPP_GeomVert(_+1,1+(P<<1)):t.geom.ZPP_MarchingSquares.ints.resize(_+1,1+(P<<1),null);var C=null;p&&(null==t.geom.ZPP_MarchSpan.zpp_pool?C=new t.geom.ZPP_MarchSpan:(C=t.geom.ZPP_MarchSpan.zpp_pool,t.geom.ZPP_MarchSpan.zpp_pool=C.next,C.next=null),C.out=!1,C.rank=0);for(var N=r,A=0,L=P;A<L;){var B,T=A++,V=N;if(T==P-1)B=a;else{if(null!=s&&s.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var k=s.zpp_inner;null!=k._validate&&k._validate(),B=r+s.zpp_inner.y*(T+1)}N=B;for(var I=i,O=null,R=0,H=_;R<H;){var F,D=R++,G=I;if(D==_-1)F=o;else{if(null!=s&&s.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var U=s.zpp_inner;null!=U._validate&&U._validate(),F=i+s.zpp_inner.x*(D+1)}I=F;var j=0==D||!p,W=0==T||!p,q=D==_-1||!p,J=T==P-1||!p,$=t.geom.ZPP_MarchingSquares.me.marchSquare(e,t.geom.ZPP_MarchingSquares.isos,t.geom.ZPP_MarchingSquares.ints,G,V,F,B,D,T,j,W,q,J,l);if(null!=$)if(p){var X=null!=$.p2&&14!=$.okey2?$.p2:$.p1;$.pd=0==(128&(X==$.p2?$.okey2:$.okey1))?X.prev:X.prev.prev;var Y,K=t.geom.ZPP_MarchingSquares.map;if(K.list[T*K.width+D]=$,null!=O){t.geom.ZPP_MarchingSquares.me;var Q=$.key1,ee=1&Q|(192&Q)>>5,te=0;0!=(1&ee)&&++te,0!=(2&ee)&&++te,0!=(4&ee)&&++te,Y=te>=2}else Y=!1;if(Y)t.geom.ZPP_MarchingSquares.me.combLR(O,$),$.span1=O.spanr;else{null==t.geom.ZPP_MarchSpan.zpp_pool?$.span1=new t.geom.ZPP_MarchSpan:($.span1=t.geom.ZPP_MarchSpan.zpp_pool,t.geom.ZPP_MarchSpan.zpp_pool=$.span1.next,$.span1.next=null);var ne=$.span1;ne.out=!1,ne.rank=0,$.span1.next=C,C=$.span1}if(null!=$.p2){null==t.geom.ZPP_MarchSpan.zpp_pool?$.span2=new t.geom.ZPP_MarchSpan:($.span2=t.geom.ZPP_MarchSpan.zpp_pool,t.geom.ZPP_MarchSpan.zpp_pool=$.span2.next,$.span2.next=null);var ie=$.span2;ie.out=!1,ie.rank=0,$.span2.next=C,C=$.span2,$.spanr=$.span2}else $.spanr=$.span1;t.geom.ZPP_MarchingSquares.me;var re=(28&$.keyr)>>2,oe=0;0!=(1&re)&&++oe,0!=(2&re)&&++oe,0!=(4&re)&&++oe,O=oe>=2?$:null}else{t.geom.ZPP_MarchingSquares.me.output(u,$.p1),null!=$.p2&&t.geom.ZPP_MarchingSquares.me.output(u,$.p2);var ae=$;ae.p1=ae.p2=ae.pr=ae.pd=null,ae.span1=ae.span2=ae.spanr=null,ae.next=t.geom.ZPP_MarchPair.zpp_pool,t.geom.ZPP_MarchPair.zpp_pool=ae}else O=null}}if(p){for(var se=1,le=P;se<le;)for(var pe=se++,ue=null,he=0,ce=_;he<ce;){var _e=he++,de=t.geom.ZPP_MarchingSquares.map,me=de.list[pe*de.width+_e];if(null!=me){var Pe=null!=me.p2&&14==me.okey2?me.okey2:me.okey1;t.geom.ZPP_MarchingSquares.me;var fe=7&Pe,xe=0;if(0!=(1&fe)&&++xe,0!=(2&fe)&&++xe,0!=(4&fe)&&++xe,xe<2)ue=null;else{var ye=t.geom.ZPP_MarchingSquares.map,ve=ye.list[(pe-1)*ye.width+_e];if(null!=ve){var ge=null!=ve.p2&&56==ve.okey2?ve.okey2:ve.okey1;t.geom.ZPP_MarchingSquares.me;var be=(112&ge)>>4,ze=0;if(0!=(1&be)&&++ze,0!=(2&be)&&++ze,0!=(4&be)&&++ze,ze<2)ue=null;else{var we,Ze,Ee=null!=ve.p2&&56==ve.okey2?ve.span2:ve.span1,Me=null!=me.p2&&14==me.okey2?me.span2:me.span1;if(Ee==Ee.parent)we=Ee;else{for(var Se=Ee,Ce=null;Se!=Se.parent;){var Ne=Se.parent;Se.parent=Ce,Ce=Se,Se=Ne}for(;null!=Ce;){var Ae=Ce.parent;Ce.parent=Se,Ce=Ae}we=Se}if(Me==Me.parent)Ze=Me;else{for(var Le=Me,Be=null;Le!=Le.parent;){var Te=Le.parent;Le.parent=Be,Be=Le,Le=Te}for(;null!=Be;){var Ve=Be.parent;Be.parent=Le,Be=Ve}Ze=Le}if(we==Ze)ue!=Me&&t.geom.ZPP_MarchingSquares.me.combUD_virtual(ve,me);else{var ke,Ie;if(Ee==Ee.parent)ke=Ee;else{for(var Oe=Ee,Re=null;Oe!=Oe.parent;){var He=Oe.parent;Oe.parent=Re,Re=Oe,Oe=He}for(;null!=Re;){var Fe=Re.parent;Re.parent=Oe,Re=Fe}ke=Oe}if(Me==Me.parent)Ie=Me;else{for(var De=Me,Ge=null;De!=De.parent;){var Ue=De.parent;De.parent=Ge,Ge=De,De=Ue}for(;null!=Ge;){var je=Ge.parent;Ge.parent=De,Ge=je}Ie=De}ke!=Ie&&(ke.rank<Ie.rank?ke.parent=Ie:ke.rank>Ie.rank?Ie.parent=ke:(Ie.parent=ke,ke.rank++)),t.geom.ZPP_MarchingSquares.me.combUD(ve,me)}ue=0!=(4&(Me==me.span2?me.okey2:me.okey1))?Me:null}}else ue=null}}else ue=null}for(var We=0,qe=P;We<qe;)for(var Je=We++,$e=0,Xe=_;$e<Xe;){var Ye=$e++,Ke=t.geom.ZPP_MarchingSquares.map,Qe=Ke.list[Je*Ke.width+Ye];if(null!=Qe){var et;if(Qe.span1==Qe.span1.parent)et=Qe.span1;else{for(var tt=Qe.span1,nt=null;tt!=tt.parent;){var it=tt.parent;tt.parent=nt,nt=tt,tt=it}for(;null!=nt;){var rt=nt.parent;nt.parent=tt,nt=rt}et=tt}if(et.out||(et.out=!0,t.geom.ZPP_MarchingSquares.me.output(u,Qe.p1)),null!=Qe.p2){if(Qe.span2==Qe.span2.parent)et=Qe.span2;else{for(var ot=Qe.span2,at=null;ot!=ot.parent;){var st=ot.parent;ot.parent=at,at=ot,ot=st}for(;null!=at;){var lt=at.parent;at.parent=ot,at=lt}et=ot}et.out||(et.out=!0,t.geom.ZPP_MarchingSquares.me.output(u,Qe.p2))}var pt=Qe;pt.p1=pt.p2=pt.pr=pt.pd=null,pt.span1=pt.span2=pt.spanr=null,pt.next=t.geom.ZPP_MarchPair.zpp_pool,t.geom.ZPP_MarchPair.zpp_pool=pt;var ut=t.geom.ZPP_MarchingSquares.map;ut.list[Je*ut.width+Ye]=null}}for(;null!=C;){var ht=C;C=ht.next;var ct=ht;ct.parent=ct,ct.next=t.geom.ZPP_MarchSpan.zpp_pool,t.geom.ZPP_MarchSpan.zpp_pool=ct}}},t.geom.ZPP_MarchingSquares.ISO=function(e,t,n){return e(t,n)},t.geom.ZPP_MarchingSquares.prototype.output=function(t,n){var i;if(null==n||n.next==n||n.next==n.prev)i=!0;else{var r=0,o=n;if(null!=n)for(var a=n;;){var s=a;if(r+=s.x*(s.next.y-s.prev.y),(a=a.next)==o)break}var l=.5*r;i=l*l<e.Config.epsilon*e.Config.epsilon}if(i)for(;null!=n;)if(null!=n&&n.prev==n)n.next=n.prev=null,n=n=null;else{var p=n.next;n.prev.next=n.next,n.next.prev=n.prev,n.next=n.prev=null,n=null,n=p}else{var u=e.geom.GeomPoly.get();u.zpp_inner.vertices=n,t.zpp_inner.reverse_flag?t.push(u):t.unshift(u)}},t.geom.ZPP_MarchingSquares.prototype.linkright=function(e,t){var n=7&t;return 0==n?e:3==n?e.next.next:e.next},t.geom.ZPP_MarchingSquares.prototype.linkleft=function(e,t){return 0==(1&t)?e.prev:e},t.geom.ZPP_MarchingSquares.prototype.linkdown=function(e,t){return 0==(128&t)?e.prev:e.prev.prev},t.geom.ZPP_MarchingSquares.prototype.linkup=function(e,t){return e},t.geom.ZPP_MarchingSquares.prototype.combLR=function(e,i){var r=e.pr,o=7&e.okeyr,a=0==o?r:3==o?r.next.next:r.next,s=i.p1,l=0==(1&i.okey1)?s.prev:s,p=a.next,u=l.prev;if(0!=(4&e.keyr)){i.pr==i.p1&&(i.pr=a.prev),i.p1=a.prev,a.prev.next=l.next,l.next.prev=a.prev;var h=a;if(null!=h.wrap){h.wrap.zpp_inner._inuse=!1;var c=h.wrap;if(null!=c&&c.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var _=c.zpp_inner;if(_._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=_._isimmutable&&_._isimmutable(),c.zpp_inner._inuse)throw new n._Boot.HaxeError("Error: This Vec2 is not disposable");var d=c.zpp_inner;c.zpp_inner.outer=null,c.zpp_inner=null;var m=c;m.zpp_pool=null,null!=t.util.ZPP_PubPool.nextVec2?t.util.ZPP_PubPool.nextVec2.zpp_pool=m:t.util.ZPP_PubPool.poolVec2=m,t.util.ZPP_PubPool.nextVec2=m,m.zpp_disp=!0;var P=d;null!=P.outer&&(P.outer.zpp_inner=null,P.outer=null),P._isimmutable=null,P._validate=null,P._invalidate=null,P.next=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=P,h.wrap=null}h.prev=h.next=null,h.next=t.geom.ZPP_GeomVert.zpp_pool,t.geom.ZPP_GeomVert.zpp_pool=h}else a.next=l.next,l.next.prev=a;var f=l;if(null!=f.wrap){f.wrap.zpp_inner._inuse=!1;var x=f.wrap;if(null!=x&&x.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var y=x.zpp_inner;if(y._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=y._isimmutable&&y._isimmutable(),x.zpp_inner._inuse)throw new n._Boot.HaxeError("Error: This Vec2 is not disposable");var v=x.zpp_inner;x.zpp_inner.outer=null,x.zpp_inner=null;var g=x;g.zpp_pool=null,null!=t.util.ZPP_PubPool.nextVec2?t.util.ZPP_PubPool.nextVec2.zpp_pool=g:t.util.ZPP_PubPool.poolVec2=g,t.util.ZPP_PubPool.nextVec2=g,g.zpp_disp=!0;var b=v;null!=b.outer&&(b.outer.zpp_inner=null,b.outer=null),b._isimmutable=null,b._validate=null,b._invalidate=null,b.next=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=b,f.wrap=null}if(f.prev=f.next=null,f.next=t.geom.ZPP_GeomVert.zpp_pool,t.geom.ZPP_GeomVert.zpp_pool=f,0!=(16&e.keyr)){i.pd=p.next,p.next.prev=u.prev,u.prev.next=p.next;var z=p;if(null!=z.wrap){z.wrap.zpp_inner._inuse=!1;var w=z.wrap;if(null!=w&&w.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var Z=w.zpp_inner;if(Z._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=Z._isimmutable&&Z._isimmutable(),w.zpp_inner._inuse)throw new n._Boot.HaxeError("Error: This Vec2 is not disposable");var E=w.zpp_inner;w.zpp_inner.outer=null,w.zpp_inner=null;var M=w;M.zpp_pool=null,null!=t.util.ZPP_PubPool.nextVec2?t.util.ZPP_PubPool.nextVec2.zpp_pool=M:t.util.ZPP_PubPool.poolVec2=M,t.util.ZPP_PubPool.nextVec2=M,M.zpp_disp=!0;var S=E;null!=S.outer&&(S.outer.zpp_inner=null,S.outer=null),S._isimmutable=null,S._validate=null,S._invalidate=null,S.next=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=S,z.wrap=null}z.prev=z.next=null,z.next=t.geom.ZPP_GeomVert.zpp_pool,t.geom.ZPP_GeomVert.zpp_pool=z}else p.prev=u.prev,u.prev.next=p;var C=u;if(null!=C.wrap){C.wrap.zpp_inner._inuse=!1;var N=C.wrap;if(null!=N&&N.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var A=N.zpp_inner;if(A._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=A._isimmutable&&A._isimmutable(),N.zpp_inner._inuse)throw new n._Boot.HaxeError("Error: This Vec2 is not disposable");var L=N.zpp_inner;N.zpp_inner.outer=null,N.zpp_inner=null;var B=N;B.zpp_pool=null,null!=t.util.ZPP_PubPool.nextVec2?t.util.ZPP_PubPool.nextVec2.zpp_pool=B:t.util.ZPP_PubPool.poolVec2=B,t.util.ZPP_PubPool.nextVec2=B,B.zpp_disp=!0;var T=L;null!=T.outer&&(T.outer.zpp_inner=null,T.outer=null),T._isimmutable=null,T._validate=null,T._invalidate=null,T.next=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=T,C.wrap=null}C.prev=C.next=null,C.next=t.geom.ZPP_GeomVert.zpp_pool,t.geom.ZPP_GeomVert.zpp_pool=C},t.geom.ZPP_MarchingSquares.prototype.combUD=function(e,i){null!=e.p2&&56==e.key2?e.p2:e.p1;var r=null!=i.p2&&14==i.key2?i.p2:i.p1,o=e.pd,a=r,s=o.prev,l=a.next;a.next=o.next,o.next.prev=a;var p=o;if(null!=p.wrap){p.wrap.zpp_inner._inuse=!1;var u=p.wrap;if(null!=u&&u.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var h=u.zpp_inner;if(h._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=h._isimmutable&&h._isimmutable(),u.zpp_inner._inuse)throw new n._Boot.HaxeError("Error: This Vec2 is not disposable");var c=u.zpp_inner;u.zpp_inner.outer=null,u.zpp_inner=null;var _=u;_.zpp_pool=null,null!=t.util.ZPP_PubPool.nextVec2?t.util.ZPP_PubPool.nextVec2.zpp_pool=_:t.util.ZPP_PubPool.poolVec2=_,t.util.ZPP_PubPool.nextVec2=_,_.zpp_disp=!0;var d=c;null!=d.outer&&(d.outer.zpp_inner=null,d.outer=null),d._isimmutable=null,d._validate=null,d._invalidate=null,d.next=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=d,p.wrap=null}p.prev=p.next=null,p.next=t.geom.ZPP_GeomVert.zpp_pool,t.geom.ZPP_GeomVert.zpp_pool=p,l.prev=s.prev,s.prev.next=l,s==e.p1&&(e.p1=l);var m=s;if(null!=m.wrap){m.wrap.zpp_inner._inuse=!1;var P=m.wrap;if(null!=P&&P.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var f=P.zpp_inner;if(f._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=f._isimmutable&&f._isimmutable(),P.zpp_inner._inuse)throw new n._Boot.HaxeError("Error: This Vec2 is not disposable");var x=P.zpp_inner;P.zpp_inner.outer=null,P.zpp_inner=null;var y=P;y.zpp_pool=null,null!=t.util.ZPP_PubPool.nextVec2?t.util.ZPP_PubPool.nextVec2.zpp_pool=y:t.util.ZPP_PubPool.poolVec2=y,t.util.ZPP_PubPool.nextVec2=y,y.zpp_disp=!0;var v=x;null!=v.outer&&(v.outer.zpp_inner=null,v.outer=null),v._isimmutable=null,v._validate=null,v._invalidate=null,v.next=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=v,m.wrap=null}m.prev=m.next=null,m.next=t.geom.ZPP_GeomVert.zpp_pool,t.geom.ZPP_GeomVert.zpp_pool=m},t.geom.ZPP_MarchingSquares.prototype.combUD_virtual=function(e,t){null!=e.p2&&56==e.key2?e.p2:e.p1;var n=null!=t.p2&&14==t.key2?t.p2:t.p1,i=e.pd,r=n,o=i.prev,a=r.next;i.forced=r.forced=o.forced=a.forced=!0},t.geom.ZPP_MarchingSquares.prototype.combLeft=function(e){var t=1&e|(192&e)>>5,n=0;return 0!=(1&t)&&++n,0!=(2&t)&&++n,0!=(4&t)&&++n,n>=2},t.geom.ZPP_MarchingSquares.prototype.combRight=function(e){var t=(28&e)>>2,n=0;return 0!=(1&t)&&++n,0!=(2&t)&&++n,0!=(4&t)&&++n,n>=2},t.geom.ZPP_MarchingSquares.prototype.combUp=function(e){var t=7&e,n=0;return 0!=(1&t)&&++n,0!=(2&t)&&++n,0!=(4&t)&&++n,n>=2},t.geom.ZPP_MarchingSquares.prototype.combDown=function(e){var t=(112&e)>>4,n=0;return 0!=(1&t)&&++n,0!=(2&t)&&++n,0!=(4&t)&&++n,n>=2},t.geom.ZPP_MarchingSquares.prototype.comb=function(e){var t=0;return 0!=(1&e)&&++t,0!=(2&e)&&++t,0!=(4&e)&&++t,t>=2},t.geom.ZPP_MarchingSquares.prototype.marchSquare=function(e,n,i,r,o,a,s,l,p,u,h,c,_,d){var m=0,P=n.list[p*n.width+l];P<0&&(m|=8);var f=n.list[p*n.width+(l+1)];f<0&&(m|=4);var x=n.list[(p+1)*n.width+(l+1)];x<0&&(m|=2);var y,v=n.list[(p+1)*n.width+l];if(v<0&&(m|=1),0==m)return null;if(null==t.geom.ZPP_MarchPair.zpp_pool?y=new t.geom.ZPP_MarchPair:(y=t.geom.ZPP_MarchPair.zpp_pool,t.geom.ZPP_MarchPair.zpp_pool=y.next,y.next=null),10!=m&&5!=m){var g=t.geom.ZPP_MarchingSquares.look_march[m];y.okey1=g;for(var b=0;b<8;){var z=b++;if(0!=(g&1<<z)){var w,Z=null;if(0==z)null==t.geom.ZPP_GeomVert.zpp_pool?w=new t.geom.ZPP_GeomVert:(w=t.geom.ZPP_GeomVert.zpp_pool,t.geom.ZPP_GeomVert.zpp_pool=w.next,w.next=null),w.forced=!1,w.x=r,w.y=o,Z=w,(u||h)&&(Z.forced=!0);else if(2==z){var E;null==t.geom.ZPP_GeomVert.zpp_pool?E=new t.geom.ZPP_GeomVert:(E=t.geom.ZPP_GeomVert.zpp_pool,t.geom.ZPP_GeomVert.zpp_pool=E.next,E.next=null),E.forced=!1,E.x=a,E.y=o,Z=E,(c||h)&&(Z.forced=!0)}else if(4==z){var M;null==t.geom.ZPP_GeomVert.zpp_pool?M=new t.geom.ZPP_GeomVert:(M=t.geom.ZPP_GeomVert.zpp_pool,t.geom.ZPP_GeomVert.zpp_pool=M.next,M.next=null),M.forced=!1,M.x=a,M.y=s,Z=M,(c||_)&&(Z.forced=!0)}else if(6==z){var S;null==t.geom.ZPP_GeomVert.zpp_pool?S=new t.geom.ZPP_GeomVert:(S=t.geom.ZPP_GeomVert.zpp_pool,t.geom.ZPP_GeomVert.zpp_pool=S.next,S.next=null),S.forced=!1,S.x=r,S.y=s,Z=S,(u||_)&&(Z.forced=!0)}else if(1==z){if(null==(Z=i.list[(p<<1)*i.width+l])){var C,N=this.xlerp(r,a,o,P,f,e,d);null==t.geom.ZPP_GeomVert.zpp_pool?C=new t.geom.ZPP_GeomVert:(C=t.geom.ZPP_GeomVert.zpp_pool,t.geom.ZPP_GeomVert.zpp_pool=C.next,C.next=null),C.forced=!1,C.x=N,C.y=o,Z=C,i.list[(p<<1)*i.width+l]=Z}else{var A,L=Z.x,B=Z.y;null==t.geom.ZPP_GeomVert.zpp_pool?A=new t.geom.ZPP_GeomVert:(A=t.geom.ZPP_GeomVert.zpp_pool,t.geom.ZPP_GeomVert.zpp_pool=A.next,A.next=null),A.forced=!1,A.x=L,A.y=B,Z=A}h&&(Z.forced=!0),Z.x!=r&&Z.x!=a||(Z.x==r&&0!=(1&g)||Z.x==a&&0!=(4&g))&&(g^=2)}else if(5==z){if(null==(Z=i.list[(2+(p<<1))*i.width+l])){var T,V=this.xlerp(r,a,s,v,x,e,d);null==t.geom.ZPP_GeomVert.zpp_pool?T=new t.geom.ZPP_GeomVert:(T=t.geom.ZPP_GeomVert.zpp_pool,t.geom.ZPP_GeomVert.zpp_pool=T.next,T.next=null),T.forced=!1,T.x=V,T.y=s,Z=T,i.list[(2+(p<<1))*i.width+l]=Z}else{var k,I=Z.x,O=Z.y;null==t.geom.ZPP_GeomVert.zpp_pool?k=new t.geom.ZPP_GeomVert:(k=t.geom.ZPP_GeomVert.zpp_pool,t.geom.ZPP_GeomVert.zpp_pool=k.next,k.next=null),k.forced=!1,k.x=I,k.y=O,Z=k}_&&(Z.forced=!0),Z.x!=r&&Z.x!=a||(Z.x==r&&0!=(64&g)||Z.x==a&&0!=(16&g))&&(g^=32)}else if(3==z){if(null==(Z=i.list[(1+(p<<1))*i.width+(l+1)])){var R,H=this.ylerp(o,s,a,f,x,e,d);null==t.geom.ZPP_GeomVert.zpp_pool?R=new t.geom.ZPP_GeomVert:(R=t.geom.ZPP_GeomVert.zpp_pool,t.geom.ZPP_GeomVert.zpp_pool=R.next,R.next=null),R.forced=!1,R.x=a,R.y=H,Z=R,i.list[(1+(p<<1))*i.width+(l+1)]=Z}else{var F,D=Z.x,G=Z.y;null==t.geom.ZPP_GeomVert.zpp_pool?F=new t.geom.ZPP_GeomVert:(F=t.geom.ZPP_GeomVert.zpp_pool,t.geom.ZPP_GeomVert.zpp_pool=F.next,F.next=null),F.forced=!1,F.x=D,F.y=G,Z=F}c&&(Z.forced=!0),Z.y!=o&&Z.y!=s||(Z.y==o&&0!=(4&g)||Z.y==s&&0!=(16&g))&&(g^=8)}else{if(null==(Z=i.list[(1+(p<<1))*i.width+l])){var U,j=this.ylerp(o,s,r,P,v,e,d);null==t.geom.ZPP_GeomVert.zpp_pool?U=new t.geom.ZPP_GeomVert:(U=t.geom.ZPP_GeomVert.zpp_pool,t.geom.ZPP_GeomVert.zpp_pool=U.next,U.next=null),U.forced=!1,U.x=r,U.y=j,Z=U,i.list[(1+(p<<1))*i.width+l]=Z}else{var W,q=Z.x,J=Z.y;null==t.geom.ZPP_GeomVert.zpp_pool?W=new t.geom.ZPP_GeomVert:(W=t.geom.ZPP_GeomVert.zpp_pool,t.geom.ZPP_GeomVert.zpp_pool=W.next,W.next=null),W.forced=!1,W.x=q,W.y=J,Z=W}u&&(Z.forced=!0),Z.y!=o&&Z.y!=s||(Z.y==o&&0!=(1&g)||Z.y==s&&0!=(64&g))&&(g^=128)}var $=Z;null==y.p1?y.p1=$.prev=$.next=$:($.prev=y.p1,$.next=y.p1.next,y.p1.next.prev=$,y.p1.next=$),y.p1=$}}y.p1=y.p1.next,y.key1=g,1!=g&&4!=g&&16!=g&&64!=g&&3!=g&&12!=g&&48!=g&&192!=g&&129!=g&&6!=g&&24!=g&&96!=g&&5!=g&&20!=g&&80!=g&&65!=g&&17!=g&&68!=g||(g=0,y.key1=0,y.p1=null),0==g?y=null:(y.pr=y.p1,y.okeyr=y.okey1,y.keyr=y.key1)}else{var X=e(.5*(r+a),.5*(o+s))<0;if(10==m)if(X){var Y=187;y.okey1=Y;for(var K=0;K<8;){var Q=K++;if(0!=(Y&1<<Q)){var ee,te=null;if(0==Q)null==t.geom.ZPP_GeomVert.zpp_pool?ee=new t.geom.ZPP_GeomVert:(ee=t.geom.ZPP_GeomVert.zpp_pool,t.geom.ZPP_GeomVert.zpp_pool=ee.next,ee.next=null),ee.forced=!1,ee.x=r,ee.y=o,te=ee,(u||h)&&(te.forced=!0);else if(2==Q){var ne;null==t.geom.ZPP_GeomVert.zpp_pool?ne=new t.geom.ZPP_GeomVert:(ne=t.geom.ZPP_GeomVert.zpp_pool,t.geom.ZPP_GeomVert.zpp_pool=ne.next,ne.next=null),ne.forced=!1,ne.x=a,ne.y=o,te=ne,(c||h)&&(te.forced=!0)}else if(4==Q){var ie;null==t.geom.ZPP_GeomVert.zpp_pool?ie=new t.geom.ZPP_GeomVert:(ie=t.geom.ZPP_GeomVert.zpp_pool,t.geom.ZPP_GeomVert.zpp_pool=ie.next,ie.next=null),ie.forced=!1,ie.x=a,ie.y=s,te=ie,(c||_)&&(te.forced=!0)}else if(6==Q){var re;null==t.geom.ZPP_GeomVert.zpp_pool?re=new t.geom.ZPP_GeomVert:(re=t.geom.ZPP_GeomVert.zpp_pool,t.geom.ZPP_GeomVert.zpp_pool=re.next,re.next=null),re.forced=!1,re.x=r,re.y=s,te=re,(u||_)&&(te.forced=!0)}else if(1==Q){if(null==(te=i.list[(p<<1)*i.width+l])){var oe,ae=this.xlerp(r,a,o,P,f,e,d);null==t.geom.ZPP_GeomVert.zpp_pool?oe=new t.geom.ZPP_GeomVert:(oe=t.geom.ZPP_GeomVert.zpp_pool,t.geom.ZPP_GeomVert.zpp_pool=oe.next,oe.next=null),oe.forced=!1,oe.x=ae,oe.y=o,te=oe,i.list[(p<<1)*i.width+l]=te}else{var se,le=te.x,pe=te.y;null==t.geom.ZPP_GeomVert.zpp_pool?se=new t.geom.ZPP_GeomVert:(se=t.geom.ZPP_GeomVert.zpp_pool,t.geom.ZPP_GeomVert.zpp_pool=se.next,se.next=null),se.forced=!1,se.x=le,se.y=pe,te=se}h&&(te.forced=!0),te.x!=r&&te.x!=a||(te.x==r&&0!=(1&Y)||te.x==a&&0!=(4&Y))&&(Y^=2)}else if(5==Q){if(null==(te=i.list[(2+(p<<1))*i.width+l])){var ue,he=this.xlerp(r,a,s,v,x,e,d);null==t.geom.ZPP_GeomVert.zpp_pool?ue=new t.geom.ZPP_GeomVert:(ue=t.geom.ZPP_GeomVert.zpp_pool,t.geom.ZPP_GeomVert.zpp_pool=ue.next,ue.next=null),ue.forced=!1,ue.x=he,ue.y=s,te=ue,i.list[(2+(p<<1))*i.width+l]=te}else{var ce,_e=te.x,de=te.y;null==t.geom.ZPP_GeomVert.zpp_pool?ce=new t.geom.ZPP_GeomVert:(ce=t.geom.ZPP_GeomVert.zpp_pool,t.geom.ZPP_GeomVert.zpp_pool=ce.next,ce.next=null),ce.forced=!1,ce.x=_e,ce.y=de,te=ce}_&&(te.forced=!0),te.x!=r&&te.x!=a||(te.x==r&&0!=(64&Y)||te.x==a&&0!=(16&Y))&&(Y^=32)}else if(3==Q){if(null==(te=i.list[(1+(p<<1))*i.width+(l+1)])){var me,Pe=this.ylerp(o,s,a,f,x,e,d);null==t.geom.ZPP_GeomVert.zpp_pool?me=new t.geom.ZPP_GeomVert:(me=t.geom.ZPP_GeomVert.zpp_pool,t.geom.ZPP_GeomVert.zpp_pool=me.next,me.next=null),me.forced=!1,me.x=a,me.y=Pe,te=me,i.list[(1+(p<<1))*i.width+(l+1)]=te}else{var fe,xe=te.x,ye=te.y;null==t.geom.ZPP_GeomVert.zpp_pool?fe=new t.geom.ZPP_GeomVert:(fe=t.geom.ZPP_GeomVert.zpp_pool,t.geom.ZPP_GeomVert.zpp_pool=fe.next,fe.next=null),fe.forced=!1,fe.x=xe,fe.y=ye,te=fe}c&&(te.forced=!0),te.y!=o&&te.y!=s||(te.y==o&&0!=(4&Y)||te.y==s&&0!=(16&Y))&&(Y^=8)}else{if(null==(te=i.list[(1+(p<<1))*i.width+l])){var ve,ge=this.ylerp(o,s,r,P,v,e,d);null==t.geom.ZPP_GeomVert.zpp_pool?ve=new t.geom.ZPP_GeomVert:(ve=t.geom.ZPP_GeomVert.zpp_pool,t.geom.ZPP_GeomVert.zpp_pool=ve.next,ve.next=null),ve.forced=!1,ve.x=r,ve.y=ge,te=ve,i.list[(1+(p<<1))*i.width+l]=te}else{var be,ze=te.x,we=te.y;null==t.geom.ZPP_GeomVert.zpp_pool?be=new t.geom.ZPP_GeomVert:(be=t.geom.ZPP_GeomVert.zpp_pool,t.geom.ZPP_GeomVert.zpp_pool=be.next,be.next=null),be.forced=!1,be.x=ze,be.y=we,te=be}u&&(te.forced=!0),te.y!=o&&te.y!=s||(te.y==o&&0!=(1&Y)||te.y==s&&0!=(64&Y))&&(Y^=128)}var Ze=te;null==y.p1?y.p1=Ze.prev=Ze.next=Ze:(Ze.prev=y.p1,Ze.next=y.p1.next,y.p1.next.prev=Ze,y.p1.next=Ze),y.p1=Ze}}y.p1=y.p1.next,y.key1=Y,1!=Y&&4!=Y&&16!=Y&&64!=Y&&3!=Y&&12!=Y&&48!=Y&&192!=Y&&129!=Y&&6!=Y&&24!=Y&&96!=Y&&5!=Y&&20!=Y&&80!=Y&&65!=Y&&17!=Y&&68!=Y||(Y=0,y.key1=0,y.p1=null),0==Y?y=null:(y.pr=y.p1,y.okeyr=y.okey1,y.keyr=y.key1)}else{var Ee=131;y.okey1=Ee;for(var Me=0;Me<8;){var Se=Me++;if(0!=(Ee&1<<Se)){var Ce,Ne=null;if(0==Se)null==t.geom.ZPP_GeomVert.zpp_pool?Ce=new t.geom.ZPP_GeomVert:(Ce=t.geom.ZPP_GeomVert.zpp_pool,t.geom.ZPP_GeomVert.zpp_pool=Ce.next,Ce.next=null),Ce.forced=!1,Ce.x=r,Ce.y=o,Ne=Ce,(u||h)&&(Ne.forced=!0);else if(2==Se){var Ae;null==t.geom.ZPP_GeomVert.zpp_pool?Ae=new t.geom.ZPP_GeomVert:(Ae=t.geom.ZPP_GeomVert.zpp_pool,t.geom.ZPP_GeomVert.zpp_pool=Ae.next,Ae.next=null),Ae.forced=!1,Ae.x=a,Ae.y=o,Ne=Ae,(c||h)&&(Ne.forced=!0)}else if(4==Se){var Le;null==t.geom.ZPP_GeomVert.zpp_pool?Le=new t.geom.ZPP_GeomVert:(Le=t.geom.ZPP_GeomVert.zpp_pool,t.geom.ZPP_GeomVert.zpp_pool=Le.next,Le.next=null),Le.forced=!1,Le.x=a,Le.y=s,Ne=Le,(c||_)&&(Ne.forced=!0)}else if(6==Se){var Be;null==t.geom.ZPP_GeomVert.zpp_pool?Be=new t.geom.ZPP_GeomVert:(Be=t.geom.ZPP_GeomVert.zpp_pool,t.geom.ZPP_GeomVert.zpp_pool=Be.next,Be.next=null),Be.forced=!1,Be.x=r,Be.y=s,Ne=Be,(u||_)&&(Ne.forced=!0)}else if(1==Se){if(null==(Ne=i.list[(p<<1)*i.width+l])){var Te,Ve=this.xlerp(r,a,o,P,f,e,d);null==t.geom.ZPP_GeomVert.zpp_pool?Te=new t.geom.ZPP_GeomVert:(Te=t.geom.ZPP_GeomVert.zpp_pool,t.geom.ZPP_GeomVert.zpp_pool=Te.next,Te.next=null),Te.forced=!1,Te.x=Ve,Te.y=o,Ne=Te,i.list[(p<<1)*i.width+l]=Ne}else{var ke,Ie=Ne.x,Oe=Ne.y;null==t.geom.ZPP_GeomVert.zpp_pool?ke=new t.geom.ZPP_GeomVert:(ke=t.geom.ZPP_GeomVert.zpp_pool,t.geom.ZPP_GeomVert.zpp_pool=ke.next,ke.next=null),ke.forced=!1,ke.x=Ie,ke.y=Oe,Ne=ke}h&&(Ne.forced=!0),Ne.x!=r&&Ne.x!=a||(Ne.x==r&&0!=(1&Ee)||Ne.x==a&&0!=(4&Ee))&&(Ee^=2)}else if(5==Se){if(null==(Ne=i.list[(2+(p<<1))*i.width+l])){var Re,He=this.xlerp(r,a,s,v,x,e,d);null==t.geom.ZPP_GeomVert.zpp_pool?Re=new t.geom.ZPP_GeomVert:(Re=t.geom.ZPP_GeomVert.zpp_pool,t.geom.ZPP_GeomVert.zpp_pool=Re.next,Re.next=null),Re.forced=!1,Re.x=He,Re.y=s,Ne=Re,i.list[(2+(p<<1))*i.width+l]=Ne}else{var Fe,De=Ne.x,Ge=Ne.y;null==t.geom.ZPP_GeomVert.zpp_pool?Fe=new t.geom.ZPP_GeomVert:(Fe=t.geom.ZPP_GeomVert.zpp_pool,t.geom.ZPP_GeomVert.zpp_pool=Fe.next,Fe.next=null),Fe.forced=!1,Fe.x=De,Fe.y=Ge,Ne=Fe}_&&(Ne.forced=!0),Ne.x!=r&&Ne.x!=a||(Ne.x==r&&0!=(64&Ee)||Ne.x==a&&0!=(16&Ee))&&(Ee^=32)}else if(3==Se){if(null==(Ne=i.list[(1+(p<<1))*i.width+(l+1)])){var Ue,je=this.ylerp(o,s,a,f,x,e,d);null==t.geom.ZPP_GeomVert.zpp_pool?Ue=new t.geom.ZPP_GeomVert:(Ue=t.geom.ZPP_GeomVert.zpp_pool,t.geom.ZPP_GeomVert.zpp_pool=Ue.next,Ue.next=null),Ue.forced=!1,Ue.x=a,Ue.y=je,Ne=Ue,i.list[(1+(p<<1))*i.width+(l+1)]=Ne}else{var We,qe=Ne.x,Je=Ne.y;null==t.geom.ZPP_GeomVert.zpp_pool?We=new t.geom.ZPP_GeomVert:(We=t.geom.ZPP_GeomVert.zpp_pool,t.geom.ZPP_GeomVert.zpp_pool=We.next,We.next=null),We.forced=!1,We.x=qe,We.y=Je,Ne=We}c&&(Ne.forced=!0),Ne.y!=o&&Ne.y!=s||(Ne.y==o&&0!=(4&Ee)||Ne.y==s&&0!=(16&Ee))&&(Ee^=8)}else{if(null==(Ne=i.list[(1+(p<<1))*i.width+l])){var $e,Xe=this.ylerp(o,s,r,P,v,e,d);null==t.geom.ZPP_GeomVert.zpp_pool?$e=new t.geom.ZPP_GeomVert:($e=t.geom.ZPP_GeomVert.zpp_pool,t.geom.ZPP_GeomVert.zpp_pool=$e.next,$e.next=null),$e.forced=!1,$e.x=r,$e.y=Xe,Ne=$e,i.list[(1+(p<<1))*i.width+l]=Ne}else{var Ye,Ke=Ne.x,Qe=Ne.y;null==t.geom.ZPP_GeomVert.zpp_pool?Ye=new t.geom.ZPP_GeomVert:(Ye=t.geom.ZPP_GeomVert.zpp_pool,t.geom.ZPP_GeomVert.zpp_pool=Ye.next,Ye.next=null),Ye.forced=!1,Ye.x=Ke,Ye.y=Qe,Ne=Ye}u&&(Ne.forced=!0),Ne.y!=o&&Ne.y!=s||(Ne.y==o&&0!=(1&Ee)||Ne.y==s&&0!=(64&Ee))&&(Ee^=128)}var et=Ne;null==y.p1?y.p1=et.prev=et.next=et:(et.prev=y.p1,et.next=y.p1.next,y.p1.next.prev=et,y.p1.next=et),y.p1=et}}if(y.p1=y.p1.next,y.key1=Ee,1!=Ee&&4!=Ee&&16!=Ee&&64!=Ee&&3!=Ee&&12!=Ee&&48!=Ee&&192!=Ee&&129!=Ee&&6!=Ee&&24!=Ee&&96!=Ee&&5!=Ee&&20!=Ee&&80!=Ee&&65!=Ee&&17!=Ee&&68!=Ee||(Ee=0,y.key1=0,y.p1=null),0!=Ee){var tt=56;y.okey2=tt;for(var nt=0;nt<8;){var it=nt++;if(0!=(tt&1<<it)){var rt,ot=null;if(0==it)null==t.geom.ZPP_GeomVert.zpp_pool?rt=new t.geom.ZPP_GeomVert:(rt=t.geom.ZPP_GeomVert.zpp_pool,t.geom.ZPP_GeomVert.zpp_pool=rt.next,rt.next=null),rt.forced=!1,rt.x=r,rt.y=o,ot=rt,(u||h)&&(ot.forced=!0);else if(2==it){var at;null==t.geom.ZPP_GeomVert.zpp_pool?at=new t.geom.ZPP_GeomVert:(at=t.geom.ZPP_GeomVert.zpp_pool,t.geom.ZPP_GeomVert.zpp_pool=at.next,at.next=null),at.forced=!1,at.x=a,at.y=o,ot=at,(c||h)&&(ot.forced=!0)}else if(4==it){var st;null==t.geom.ZPP_GeomVert.zpp_pool?st=new t.geom.ZPP_GeomVert:(st=t.geom.ZPP_GeomVert.zpp_pool,t.geom.ZPP_GeomVert.zpp_pool=st.next,st.next=null),st.forced=!1,st.x=a,st.y=s,ot=st,(c||_)&&(ot.forced=!0)}else if(6==it){var lt;null==t.geom.ZPP_GeomVert.zpp_pool?lt=new t.geom.ZPP_GeomVert:(lt=t.geom.ZPP_GeomVert.zpp_pool,t.geom.ZPP_GeomVert.zpp_pool=lt.next,lt.next=null),lt.forced=!1,lt.x=r,lt.y=s,ot=lt,(u||_)&&(ot.forced=!0)}else if(1==it){if(null==(ot=i.list[(p<<1)*i.width+l])){var pt,ut=this.xlerp(r,a,o,P,f,e,d);null==t.geom.ZPP_GeomVert.zpp_pool?pt=new t.geom.ZPP_GeomVert:(pt=t.geom.ZPP_GeomVert.zpp_pool,t.geom.ZPP_GeomVert.zpp_pool=pt.next,pt.next=null),pt.forced=!1,pt.x=ut,pt.y=o,ot=pt,i.list[(p<<1)*i.width+l]=ot}else{var ht,ct=ot.x,_t=ot.y;null==t.geom.ZPP_GeomVert.zpp_pool?ht=new t.geom.ZPP_GeomVert:(ht=t.geom.ZPP_GeomVert.zpp_pool,t.geom.ZPP_GeomVert.zpp_pool=ht.next,ht.next=null),ht.forced=!1,ht.x=ct,ht.y=_t,ot=ht}h&&(ot.forced=!0),ot.x!=r&&ot.x!=a||(ot.x==r&&0!=(1&tt)||ot.x==a&&0!=(4&tt))&&(tt^=2)}else if(5==it){if(null==(ot=i.list[(2+(p<<1))*i.width+l])){var dt,mt=this.xlerp(r,a,s,v,x,e,d);null==t.geom.ZPP_GeomVert.zpp_pool?dt=new t.geom.ZPP_GeomVert:(dt=t.geom.ZPP_GeomVert.zpp_pool,t.geom.ZPP_GeomVert.zpp_pool=dt.next,dt.next=null),dt.forced=!1,dt.x=mt,dt.y=s,ot=dt,i.list[(2+(p<<1))*i.width+l]=ot}else{var Pt,ft=ot.x,xt=ot.y;null==t.geom.ZPP_GeomVert.zpp_pool?Pt=new t.geom.ZPP_GeomVert:(Pt=t.geom.ZPP_GeomVert.zpp_pool,t.geom.ZPP_GeomVert.zpp_pool=Pt.next,Pt.next=null),Pt.forced=!1,Pt.x=ft,Pt.y=xt,ot=Pt}_&&(ot.forced=!0),ot.x!=r&&ot.x!=a||(ot.x==r&&0!=(64&tt)||ot.x==a&&0!=(16&tt))&&(tt^=32)}else if(3==it){if(null==(ot=i.list[(1+(p<<1))*i.width+(l+1)])){var yt,vt=this.ylerp(o,s,a,f,x,e,d);null==t.geom.ZPP_GeomVert.zpp_pool?yt=new t.geom.ZPP_GeomVert:(yt=t.geom.ZPP_GeomVert.zpp_pool,t.geom.ZPP_GeomVert.zpp_pool=yt.next,yt.next=null),yt.forced=!1,yt.x=a,yt.y=vt,ot=yt,i.list[(1+(p<<1))*i.width+(l+1)]=ot}else{var gt,bt=ot.x,zt=ot.y;null==t.geom.ZPP_GeomVert.zpp_pool?gt=new t.geom.ZPP_GeomVert:(gt=t.geom.ZPP_GeomVert.zpp_pool,t.geom.ZPP_GeomVert.zpp_pool=gt.next,gt.next=null),gt.forced=!1,gt.x=bt,gt.y=zt,ot=gt}c&&(ot.forced=!0),ot.y!=o&&ot.y!=s||(ot.y==o&&0!=(4&tt)||ot.y==s&&0!=(16&tt))&&(tt^=8)}else{if(null==(ot=i.list[(1+(p<<1))*i.width+l])){var wt,Zt=this.ylerp(o,s,r,P,v,e,d);null==t.geom.ZPP_GeomVert.zpp_pool?wt=new t.geom.ZPP_GeomVert:(wt=t.geom.ZPP_GeomVert.zpp_pool,t.geom.ZPP_GeomVert.zpp_pool=wt.next,wt.next=null),wt.forced=!1,wt.x=r,wt.y=Zt,ot=wt,i.list[(1+(p<<1))*i.width+l]=ot}else{var Et,Mt=ot.x,St=ot.y;null==t.geom.ZPP_GeomVert.zpp_pool?Et=new t.geom.ZPP_GeomVert:(Et=t.geom.ZPP_GeomVert.zpp_pool,t.geom.ZPP_GeomVert.zpp_pool=Et.next,Et.next=null),Et.forced=!1,Et.x=Mt,Et.y=St,ot=Et}u&&(ot.forced=!0),ot.y!=o&&ot.y!=s||(ot.y==o&&0!=(1&tt)||ot.y==s&&0!=(64&tt))&&(tt^=128)}var Ct=ot;null==y.p2?y.p2=Ct.prev=Ct.next=Ct:(Ct.prev=y.p2,Ct.next=y.p2.next,y.p2.next.prev=Ct,y.p2.next=Ct),y.p2=Ct}}y.p2=y.p2.next,y.key2=tt,1!=tt&&4!=tt&&16!=tt&&64!=tt&&3!=tt&&12!=tt&&48!=tt&&192!=tt&&129!=tt&&6!=tt&&24!=tt&&96!=tt&&5!=tt&&20!=tt&&80!=tt&&65!=tt&&17!=tt&&68!=tt||(tt=0,y.key2=0,y.p2=null),0==tt?(y.pr=y.p1,y.okeyr=y.okey1,y.keyr=y.key1):(y.pr=y.p2,y.okeyr=y.okey2,y.keyr=y.key2)}else{var Nt=56;y.okey1=Nt;for(var At=0;At<8;){var Lt=At++;if(0!=(Nt&1<<Lt)){var Bt,Tt=null;if(0==Lt)null==t.geom.ZPP_GeomVert.zpp_pool?Bt=new t.geom.ZPP_GeomVert:(Bt=t.geom.ZPP_GeomVert.zpp_pool,t.geom.ZPP_GeomVert.zpp_pool=Bt.next,Bt.next=null),Bt.forced=!1,Bt.x=r,Bt.y=o,Tt=Bt,(u||h)&&(Tt.forced=!0);else if(2==Lt){var Vt;null==t.geom.ZPP_GeomVert.zpp_pool?Vt=new t.geom.ZPP_GeomVert:(Vt=t.geom.ZPP_GeomVert.zpp_pool,t.geom.ZPP_GeomVert.zpp_pool=Vt.next,Vt.next=null),Vt.forced=!1,Vt.x=a,Vt.y=o,Tt=Vt,(c||h)&&(Tt.forced=!0)}else if(4==Lt){var kt;null==t.geom.ZPP_GeomVert.zpp_pool?kt=new t.geom.ZPP_GeomVert:(kt=t.geom.ZPP_GeomVert.zpp_pool,t.geom.ZPP_GeomVert.zpp_pool=kt.next,kt.next=null),kt.forced=!1,kt.x=a,kt.y=s,Tt=kt,(c||_)&&(Tt.forced=!0)}else if(6==Lt){var It;null==t.geom.ZPP_GeomVert.zpp_pool?It=new t.geom.ZPP_GeomVert:(It=t.geom.ZPP_GeomVert.zpp_pool,t.geom.ZPP_GeomVert.zpp_pool=It.next,It.next=null),It.forced=!1,It.x=r,It.y=s,Tt=It,(u||_)&&(Tt.forced=!0)}else if(1==Lt){if(null==(Tt=i.list[(p<<1)*i.width+l])){var Ot,Rt=this.xlerp(r,a,o,P,f,e,d);null==t.geom.ZPP_GeomVert.zpp_pool?Ot=new t.geom.ZPP_GeomVert:(Ot=t.geom.ZPP_GeomVert.zpp_pool,t.geom.ZPP_GeomVert.zpp_pool=Ot.next,Ot.next=null),Ot.forced=!1,Ot.x=Rt,Ot.y=o,Tt=Ot,i.list[(p<<1)*i.width+l]=Tt}else{var Ht,Ft=Tt.x,Dt=Tt.y;null==t.geom.ZPP_GeomVert.zpp_pool?Ht=new t.geom.ZPP_GeomVert:(Ht=t.geom.ZPP_GeomVert.zpp_pool,t.geom.ZPP_GeomVert.zpp_pool=Ht.next,Ht.next=null),Ht.forced=!1,Ht.x=Ft,Ht.y=Dt,Tt=Ht}h&&(Tt.forced=!0),Tt.x!=r&&Tt.x!=a||(Tt.x==r&&0!=(1&Nt)||Tt.x==a&&0!=(4&Nt))&&(Nt^=2)}else if(5==Lt){if(null==(Tt=i.list[(2+(p<<1))*i.width+l])){var Gt,Ut=this.xlerp(r,a,s,v,x,e,d);null==t.geom.ZPP_GeomVert.zpp_pool?Gt=new t.geom.ZPP_GeomVert:(Gt=t.geom.ZPP_GeomVert.zpp_pool,t.geom.ZPP_GeomVert.zpp_pool=Gt.next,Gt.next=null),Gt.forced=!1,Gt.x=Ut,Gt.y=s,Tt=Gt,i.list[(2+(p<<1))*i.width+l]=Tt}else{var jt,Wt=Tt.x,qt=Tt.y;null==t.geom.ZPP_GeomVert.zpp_pool?jt=new t.geom.ZPP_GeomVert:(jt=t.geom.ZPP_GeomVert.zpp_pool,t.geom.ZPP_GeomVert.zpp_pool=jt.next,jt.next=null),jt.forced=!1,jt.x=Wt,jt.y=qt,Tt=jt}_&&(Tt.forced=!0),Tt.x!=r&&Tt.x!=a||(Tt.x==r&&0!=(64&Nt)||Tt.x==a&&0!=(16&Nt))&&(Nt^=32)}else if(3==Lt){if(null==(Tt=i.list[(1+(p<<1))*i.width+(l+1)])){var Jt,$t=this.ylerp(o,s,a,f,x,e,d);null==t.geom.ZPP_GeomVert.zpp_pool?Jt=new t.geom.ZPP_GeomVert:(Jt=t.geom.ZPP_GeomVert.zpp_pool,t.geom.ZPP_GeomVert.zpp_pool=Jt.next,Jt.next=null),Jt.forced=!1,Jt.x=a,Jt.y=$t,Tt=Jt,i.list[(1+(p<<1))*i.width+(l+1)]=Tt}else{var Xt,Yt=Tt.x,Kt=Tt.y;null==t.geom.ZPP_GeomVert.zpp_pool?Xt=new t.geom.ZPP_GeomVert:(Xt=t.geom.ZPP_GeomVert.zpp_pool,t.geom.ZPP_GeomVert.zpp_pool=Xt.next,Xt.next=null),Xt.forced=!1,Xt.x=Yt,Xt.y=Kt,Tt=Xt}c&&(Tt.forced=!0),Tt.y!=o&&Tt.y!=s||(Tt.y==o&&0!=(4&Nt)||Tt.y==s&&0!=(16&Nt))&&(Nt^=8)}else{if(null==(Tt=i.list[(1+(p<<1))*i.width+l])){var Qt,en=this.ylerp(o,s,r,P,v,e,d);null==t.geom.ZPP_GeomVert.zpp_pool?Qt=new t.geom.ZPP_GeomVert:(Qt=t.geom.ZPP_GeomVert.zpp_pool,t.geom.ZPP_GeomVert.zpp_pool=Qt.next,Qt.next=null),Qt.forced=!1,Qt.x=r,Qt.y=en,Tt=Qt,i.list[(1+(p<<1))*i.width+l]=Tt}else{var tn,nn=Tt.x,rn=Tt.y;null==t.geom.ZPP_GeomVert.zpp_pool?tn=new t.geom.ZPP_GeomVert:(tn=t.geom.ZPP_GeomVert.zpp_pool,t.geom.ZPP_GeomVert.zpp_pool=tn.next,tn.next=null),tn.forced=!1,tn.x=nn,tn.y=rn,Tt=tn}u&&(Tt.forced=!0),Tt.y!=o&&Tt.y!=s||(Tt.y==o&&0!=(1&Nt)||Tt.y==s&&0!=(64&Nt))&&(Nt^=128)}var on=Tt;null==y.p1?y.p1=on.prev=on.next=on:(on.prev=y.p1,on.next=y.p1.next,y.p1.next.prev=on,y.p1.next=on),y.p1=on}}y.p1=y.p1.next,y.key1=Nt,1!=Nt&&4!=Nt&&16!=Nt&&64!=Nt&&3!=Nt&&12!=Nt&&48!=Nt&&192!=Nt&&129!=Nt&&6!=Nt&&24!=Nt&&96!=Nt&&5!=Nt&&20!=Nt&&80!=Nt&&65!=Nt&&17!=Nt&&68!=Nt||(Nt=0,y.key1=0,y.p1=null),0==Nt?y=null:(y.pr=y.p1,y.okeyr=y.okey1,y.keyr=y.key1)}}else if(X){var an=238;y.okey1=an;for(var sn=0;sn<8;){var ln=sn++;if(0!=(an&1<<ln)){var pn,un=null;if(0==ln)null==t.geom.ZPP_GeomVert.zpp_pool?pn=new t.geom.ZPP_GeomVert:(pn=t.geom.ZPP_GeomVert.zpp_pool,t.geom.ZPP_GeomVert.zpp_pool=pn.next,pn.next=null),pn.forced=!1,pn.x=r,pn.y=o,un=pn,(u||h)&&(un.forced=!0);else if(2==ln){var hn;null==t.geom.ZPP_GeomVert.zpp_pool?hn=new t.geom.ZPP_GeomVert:(hn=t.geom.ZPP_GeomVert.zpp_pool,t.geom.ZPP_GeomVert.zpp_pool=hn.next,hn.next=null),hn.forced=!1,hn.x=a,hn.y=o,un=hn,(c||h)&&(un.forced=!0)}else if(4==ln){var cn;null==t.geom.ZPP_GeomVert.zpp_pool?cn=new t.geom.ZPP_GeomVert:(cn=t.geom.ZPP_GeomVert.zpp_pool,t.geom.ZPP_GeomVert.zpp_pool=cn.next,cn.next=null),cn.forced=!1,cn.x=a,cn.y=s,un=cn,(c||_)&&(un.forced=!0)}else if(6==ln){var _n;null==t.geom.ZPP_GeomVert.zpp_pool?_n=new t.geom.ZPP_GeomVert:(_n=t.geom.ZPP_GeomVert.zpp_pool,t.geom.ZPP_GeomVert.zpp_pool=_n.next,_n.next=null),_n.forced=!1,_n.x=r,_n.y=s,un=_n,(u||_)&&(un.forced=!0)}else if(1==ln){if(null==(un=i.list[(p<<1)*i.width+l])){var dn,mn=this.xlerp(r,a,o,P,f,e,d);null==t.geom.ZPP_GeomVert.zpp_pool?dn=new t.geom.ZPP_GeomVert:(dn=t.geom.ZPP_GeomVert.zpp_pool,t.geom.ZPP_GeomVert.zpp_pool=dn.next,dn.next=null),dn.forced=!1,dn.x=mn,dn.y=o,un=dn,i.list[(p<<1)*i.width+l]=un}else{var Pn,fn=un.x,xn=un.y;null==t.geom.ZPP_GeomVert.zpp_pool?Pn=new t.geom.ZPP_GeomVert:(Pn=t.geom.ZPP_GeomVert.zpp_pool,t.geom.ZPP_GeomVert.zpp_pool=Pn.next,Pn.next=null),Pn.forced=!1,Pn.x=fn,Pn.y=xn,un=Pn}h&&(un.forced=!0),un.x!=r&&un.x!=a||(un.x==r&&0!=(1&an)||un.x==a&&0!=(4&an))&&(an^=2)}else if(5==ln){if(null==(un=i.list[(2+(p<<1))*i.width+l])){var yn,vn=this.xlerp(r,a,s,v,x,e,d);null==t.geom.ZPP_GeomVert.zpp_pool?yn=new t.geom.ZPP_GeomVert:(yn=t.geom.ZPP_GeomVert.zpp_pool,t.geom.ZPP_GeomVert.zpp_pool=yn.next,yn.next=null),yn.forced=!1,yn.x=vn,yn.y=s,un=yn,i.list[(2+(p<<1))*i.width+l]=un}else{var gn,bn=un.x,zn=un.y;null==t.geom.ZPP_GeomVert.zpp_pool?gn=new t.geom.ZPP_GeomVert:(gn=t.geom.ZPP_GeomVert.zpp_pool,t.geom.ZPP_GeomVert.zpp_pool=gn.next,gn.next=null),gn.forced=!1,gn.x=bn,gn.y=zn,un=gn}_&&(un.forced=!0),un.x!=r&&un.x!=a||(un.x==r&&0!=(64&an)||un.x==a&&0!=(16&an))&&(an^=32)}else if(3==ln){if(null==(un=i.list[(1+(p<<1))*i.width+(l+1)])){var wn,Zn=this.ylerp(o,s,a,f,x,e,d);null==t.geom.ZPP_GeomVert.zpp_pool?wn=new t.geom.ZPP_GeomVert:(wn=t.geom.ZPP_GeomVert.zpp_pool,t.geom.ZPP_GeomVert.zpp_pool=wn.next,wn.next=null),wn.forced=!1,wn.x=a,wn.y=Zn,un=wn,i.list[(1+(p<<1))*i.width+(l+1)]=un}else{var En,Mn=un.x,Sn=un.y;null==t.geom.ZPP_GeomVert.zpp_pool?En=new t.geom.ZPP_GeomVert:(En=t.geom.ZPP_GeomVert.zpp_pool,t.geom.ZPP_GeomVert.zpp_pool=En.next,En.next=null),En.forced=!1,En.x=Mn,En.y=Sn,un=En}c&&(un.forced=!0),un.y!=o&&un.y!=s||(un.y==o&&0!=(4&an)||un.y==s&&0!=(16&an))&&(an^=8)}else{if(null==(un=i.list[(1+(p<<1))*i.width+l])){var Cn,Nn=this.ylerp(o,s,r,P,v,e,d);null==t.geom.ZPP_GeomVert.zpp_pool?Cn=new t.geom.ZPP_GeomVert:(Cn=t.geom.ZPP_GeomVert.zpp_pool,t.geom.ZPP_GeomVert.zpp_pool=Cn.next,Cn.next=null),Cn.forced=!1,Cn.x=r,Cn.y=Nn,un=Cn,i.list[(1+(p<<1))*i.width+l]=un}else{var An,Ln=un.x,Bn=un.y;null==t.geom.ZPP_GeomVert.zpp_pool?An=new t.geom.ZPP_GeomVert:(An=t.geom.ZPP_GeomVert.zpp_pool,t.geom.ZPP_GeomVert.zpp_pool=An.next,An.next=null),An.forced=!1,An.x=Ln,An.y=Bn,un=An}u&&(un.forced=!0),un.y!=o&&un.y!=s||(un.y==o&&0!=(1&an)||un.y==s&&0!=(64&an))&&(an^=128)}var Tn=un;null==y.p1?y.p1=Tn.prev=Tn.next=Tn:(Tn.prev=y.p1,Tn.next=y.p1.next,y.p1.next.prev=Tn,y.p1.next=Tn),y.p1=Tn}}y.p1=y.p1.next,y.key1=an,1!=an&&4!=an&&16!=an&&64!=an&&3!=an&&12!=an&&48!=an&&192!=an&&129!=an&&6!=an&&24!=an&&96!=an&&5!=an&&20!=an&&80!=an&&65!=an&&17!=an&&68!=an||(an=0,y.key1=0,y.p1=null),0==an?y=null:(y.pr=y.p1,y.okeyr=y.okey1,y.keyr=y.key1)}else{var Vn=224;y.okey1=Vn;for(var kn=0;kn<8;){var In=kn++;if(0!=(Vn&1<<In)){var On,Rn=null;if(0==In)null==t.geom.ZPP_GeomVert.zpp_pool?On=new t.geom.ZPP_GeomVert:(On=t.geom.ZPP_GeomVert.zpp_pool,t.geom.ZPP_GeomVert.zpp_pool=On.next,On.next=null),On.forced=!1,On.x=r,On.y=o,Rn=On,(u||h)&&(Rn.forced=!0);else if(2==In){var Hn;null==t.geom.ZPP_GeomVert.zpp_pool?Hn=new t.geom.ZPP_GeomVert:(Hn=t.geom.ZPP_GeomVert.zpp_pool,t.geom.ZPP_GeomVert.zpp_pool=Hn.next,Hn.next=null),Hn.forced=!1,Hn.x=a,Hn.y=o,Rn=Hn,(c||h)&&(Rn.forced=!0)}else if(4==In){var Fn;null==t.geom.ZPP_GeomVert.zpp_pool?Fn=new t.geom.ZPP_GeomVert:(Fn=t.geom.ZPP_GeomVert.zpp_pool,t.geom.ZPP_GeomVert.zpp_pool=Fn.next,Fn.next=null),Fn.forced=!1,Fn.x=a,Fn.y=s,Rn=Fn,(c||_)&&(Rn.forced=!0)}else if(6==In){var Dn;null==t.geom.ZPP_GeomVert.zpp_pool?Dn=new t.geom.ZPP_GeomVert:(Dn=t.geom.ZPP_GeomVert.zpp_pool,t.geom.ZPP_GeomVert.zpp_pool=Dn.next,Dn.next=null),Dn.forced=!1,Dn.x=r,Dn.y=s,Rn=Dn,(u||_)&&(Rn.forced=!0)}else if(1==In){if(null==(Rn=i.list[(p<<1)*i.width+l])){var Gn,Un=this.xlerp(r,a,o,P,f,e,d);null==t.geom.ZPP_GeomVert.zpp_pool?Gn=new t.geom.ZPP_GeomVert:(Gn=t.geom.ZPP_GeomVert.zpp_pool,t.geom.ZPP_GeomVert.zpp_pool=Gn.next,Gn.next=null),Gn.forced=!1,Gn.x=Un,Gn.y=o,Rn=Gn,i.list[(p<<1)*i.width+l]=Rn}else{var jn,Wn=Rn.x,qn=Rn.y;null==t.geom.ZPP_GeomVert.zpp_pool?jn=new t.geom.ZPP_GeomVert:(jn=t.geom.ZPP_GeomVert.zpp_pool,t.geom.ZPP_GeomVert.zpp_pool=jn.next,jn.next=null),jn.forced=!1,jn.x=Wn,jn.y=qn,Rn=jn}h&&(Rn.forced=!0),Rn.x!=r&&Rn.x!=a||(Rn.x==r&&0!=(1&Vn)||Rn.x==a&&0!=(4&Vn))&&(Vn^=2)}else if(5==In){if(null==(Rn=i.list[(2+(p<<1))*i.width+l])){var Jn,$n=this.xlerp(r,a,s,v,x,e,d);null==t.geom.ZPP_GeomVert.zpp_pool?Jn=new t.geom.ZPP_GeomVert:(Jn=t.geom.ZPP_GeomVert.zpp_pool,t.geom.ZPP_GeomVert.zpp_pool=Jn.next,Jn.next=null),Jn.forced=!1,Jn.x=$n,Jn.y=s,Rn=Jn,i.list[(2+(p<<1))*i.width+l]=Rn}else{var Xn,Yn=Rn.x,Kn=Rn.y;null==t.geom.ZPP_GeomVert.zpp_pool?Xn=new t.geom.ZPP_GeomVert:(Xn=t.geom.ZPP_GeomVert.zpp_pool,t.geom.ZPP_GeomVert.zpp_pool=Xn.next,Xn.next=null),Xn.forced=!1,Xn.x=Yn,Xn.y=Kn,Rn=Xn}_&&(Rn.forced=!0),Rn.x!=r&&Rn.x!=a||(Rn.x==r&&0!=(64&Vn)||Rn.x==a&&0!=(16&Vn))&&(Vn^=32)}else if(3==In){if(null==(Rn=i.list[(1+(p<<1))*i.width+(l+1)])){var Qn,ei=this.ylerp(o,s,a,f,x,e,d);null==t.geom.ZPP_GeomVert.zpp_pool?Qn=new t.geom.ZPP_GeomVert:(Qn=t.geom.ZPP_GeomVert.zpp_pool,t.geom.ZPP_GeomVert.zpp_pool=Qn.next,Qn.next=null),Qn.forced=!1,Qn.x=a,Qn.y=ei,Rn=Qn,i.list[(1+(p<<1))*i.width+(l+1)]=Rn}else{var ti,ni=Rn.x,ii=Rn.y;null==t.geom.ZPP_GeomVert.zpp_pool?ti=new t.geom.ZPP_GeomVert:(ti=t.geom.ZPP_GeomVert.zpp_pool,t.geom.ZPP_GeomVert.zpp_pool=ti.next,ti.next=null),ti.forced=!1,ti.x=ni,ti.y=ii,Rn=ti}c&&(Rn.forced=!0),Rn.y!=o&&Rn.y!=s||(Rn.y==o&&0!=(4&Vn)||Rn.y==s&&0!=(16&Vn))&&(Vn^=8)}else{if(null==(Rn=i.list[(1+(p<<1))*i.width+l])){var ri,oi=this.ylerp(o,s,r,P,v,e,d);null==t.geom.ZPP_GeomVert.zpp_pool?ri=new t.geom.ZPP_GeomVert:(ri=t.geom.ZPP_GeomVert.zpp_pool,t.geom.ZPP_GeomVert.zpp_pool=ri.next,ri.next=null),ri.forced=!1,ri.x=r,ri.y=oi,Rn=ri,i.list[(1+(p<<1))*i.width+l]=Rn}else{var ai,si=Rn.x,li=Rn.y;null==t.geom.ZPP_GeomVert.zpp_pool?ai=new t.geom.ZPP_GeomVert:(ai=t.geom.ZPP_GeomVert.zpp_pool,t.geom.ZPP_GeomVert.zpp_pool=ai.next,ai.next=null),ai.forced=!1,ai.x=si,ai.y=li,Rn=ai}u&&(Rn.forced=!0),Rn.y!=o&&Rn.y!=s||(Rn.y==o&&0!=(1&Vn)||Rn.y==s&&0!=(64&Vn))&&(Vn^=128)}var pi=Rn;null==y.p1?y.p1=pi.prev=pi.next=pi:(pi.prev=y.p1,pi.next=y.p1.next,y.p1.next.prev=pi,y.p1.next=pi),y.p1=pi}}if(y.p1=y.p1.next,y.key1=Vn,1!=Vn&&4!=Vn&&16!=Vn&&64!=Vn&&3!=Vn&&12!=Vn&&48!=Vn&&192!=Vn&&129!=Vn&&6!=Vn&&24!=Vn&&96!=Vn&&5!=Vn&&20!=Vn&&80!=Vn&&65!=Vn&&17!=Vn&&68!=Vn||(Vn=0,y.key1=0,y.p1=null),0!=Vn){var ui=14;y.okey2=ui;for(var hi=0;hi<8;){var ci=hi++;if(0!=(ui&1<<ci)){var _i,di=null;if(0==ci)null==t.geom.ZPP_GeomVert.zpp_pool?_i=new t.geom.ZPP_GeomVert:(_i=t.geom.ZPP_GeomVert.zpp_pool,t.geom.ZPP_GeomVert.zpp_pool=_i.next,_i.next=null),_i.forced=!1,_i.x=r,_i.y=o,di=_i,(u||h)&&(di.forced=!0);else if(2==ci){var mi;null==t.geom.ZPP_GeomVert.zpp_pool?mi=new t.geom.ZPP_GeomVert:(mi=t.geom.ZPP_GeomVert.zpp_pool,t.geom.ZPP_GeomVert.zpp_pool=mi.next,mi.next=null),mi.forced=!1,mi.x=a,mi.y=o,di=mi,(c||h)&&(di.forced=!0)}else if(4==ci){var Pi;null==t.geom.ZPP_GeomVert.zpp_pool?Pi=new t.geom.ZPP_GeomVert:(Pi=t.geom.ZPP_GeomVert.zpp_pool,t.geom.ZPP_GeomVert.zpp_pool=Pi.next,Pi.next=null),Pi.forced=!1,Pi.x=a,Pi.y=s,di=Pi,(c||_)&&(di.forced=!0)}else if(6==ci){var fi;null==t.geom.ZPP_GeomVert.zpp_pool?fi=new t.geom.ZPP_GeomVert:(fi=t.geom.ZPP_GeomVert.zpp_pool,t.geom.ZPP_GeomVert.zpp_pool=fi.next,fi.next=null),fi.forced=!1,fi.x=r,fi.y=s,di=fi,(u||_)&&(di.forced=!0)}else if(1==ci){if(null==(di=i.list[(p<<1)*i.width+l])){var xi,yi=this.xlerp(r,a,o,P,f,e,d);null==t.geom.ZPP_GeomVert.zpp_pool?xi=new t.geom.ZPP_GeomVert:(xi=t.geom.ZPP_GeomVert.zpp_pool,t.geom.ZPP_GeomVert.zpp_pool=xi.next,xi.next=null),xi.forced=!1,xi.x=yi,xi.y=o,di=xi,i.list[(p<<1)*i.width+l]=di}else{var vi,gi=di.x,bi=di.y;null==t.geom.ZPP_GeomVert.zpp_pool?vi=new t.geom.ZPP_GeomVert:(vi=t.geom.ZPP_GeomVert.zpp_pool,t.geom.ZPP_GeomVert.zpp_pool=vi.next,vi.next=null),vi.forced=!1,vi.x=gi,vi.y=bi,di=vi}h&&(di.forced=!0),di.x!=r&&di.x!=a||(di.x==r&&0!=(1&ui)||di.x==a&&0!=(4&ui))&&(ui^=2)}else if(5==ci){if(null==(di=i.list[(2+(p<<1))*i.width+l])){var zi,wi=this.xlerp(r,a,s,v,x,e,d);null==t.geom.ZPP_GeomVert.zpp_pool?zi=new t.geom.ZPP_GeomVert:(zi=t.geom.ZPP_GeomVert.zpp_pool,t.geom.ZPP_GeomVert.zpp_pool=zi.next,zi.next=null),zi.forced=!1,zi.x=wi,zi.y=s,di=zi,i.list[(2+(p<<1))*i.width+l]=di}else{var Zi,Ei=di.x,Mi=di.y;null==t.geom.ZPP_GeomVert.zpp_pool?Zi=new t.geom.ZPP_GeomVert:(Zi=t.geom.ZPP_GeomVert.zpp_pool,t.geom.ZPP_GeomVert.zpp_pool=Zi.next,Zi.next=null),Zi.forced=!1,Zi.x=Ei,Zi.y=Mi,di=Zi}_&&(di.forced=!0),di.x!=r&&di.x!=a||(di.x==r&&0!=(64&ui)||di.x==a&&0!=(16&ui))&&(ui^=32)}else if(3==ci){if(null==(di=i.list[(1+(p<<1))*i.width+(l+1)])){var Si,Ci=this.ylerp(o,s,a,f,x,e,d);null==t.geom.ZPP_GeomVert.zpp_pool?Si=new t.geom.ZPP_GeomVert:(Si=t.geom.ZPP_GeomVert.zpp_pool,t.geom.ZPP_GeomVert.zpp_pool=Si.next,Si.next=null),Si.forced=!1,Si.x=a,Si.y=Ci,di=Si,i.list[(1+(p<<1))*i.width+(l+1)]=di}else{var Ni,Ai=di.x,Li=di.y;null==t.geom.ZPP_GeomVert.zpp_pool?Ni=new t.geom.ZPP_GeomVert:(Ni=t.geom.ZPP_GeomVert.zpp_pool,t.geom.ZPP_GeomVert.zpp_pool=Ni.next,Ni.next=null),Ni.forced=!1,Ni.x=Ai,Ni.y=Li,di=Ni}c&&(di.forced=!0),di.y!=o&&di.y!=s||(di.y==o&&0!=(4&ui)||di.y==s&&0!=(16&ui))&&(ui^=8)}else{if(null==(di=i.list[(1+(p<<1))*i.width+l])){var Bi,Ti=this.ylerp(o,s,r,P,v,e,d);null==t.geom.ZPP_GeomVert.zpp_pool?Bi=new t.geom.ZPP_GeomVert:(Bi=t.geom.ZPP_GeomVert.zpp_pool,t.geom.ZPP_GeomVert.zpp_pool=Bi.next,Bi.next=null),Bi.forced=!1,Bi.x=r,Bi.y=Ti,di=Bi,i.list[(1+(p<<1))*i.width+l]=di}else{var Vi,ki=di.x,Ii=di.y;null==t.geom.ZPP_GeomVert.zpp_pool?Vi=new t.geom.ZPP_GeomVert:(Vi=t.geom.ZPP_GeomVert.zpp_pool,t.geom.ZPP_GeomVert.zpp_pool=Vi.next,Vi.next=null),Vi.forced=!1,Vi.x=ki,Vi.y=Ii,di=Vi}u&&(di.forced=!0),di.y!=o&&di.y!=s||(di.y==o&&0!=(1&ui)||di.y==s&&0!=(64&ui))&&(ui^=128)}var Oi=di;null==y.p2?y.p2=Oi.prev=Oi.next=Oi:(Oi.prev=y.p2,Oi.next=y.p2.next,y.p2.next.prev=Oi,y.p2.next=Oi),y.p2=Oi}}y.p2=y.p2.next,y.key2=ui,1!=ui&&4!=ui&&16!=ui&&64!=ui&&3!=ui&&12!=ui&&48!=ui&&192!=ui&&129!=ui&&6!=ui&&24!=ui&&96!=ui&&5!=ui&&20!=ui&&80!=ui&&65!=ui&&17!=ui&&68!=ui||(ui=0,y.key2=0,y.p2=null),0==ui?(y.pr=y.p1,y.okeyr=y.okey1,y.keyr=y.key1):(y.pr=y.p2,y.okeyr=y.okey2,y.keyr=y.key2)}else{var Ri=14;y.okey1=Ri;for(var Hi=0;Hi<8;){var Fi=Hi++;if(0!=(Ri&1<<Fi)){var Di,Gi=null;if(0==Fi)null==t.geom.ZPP_GeomVert.zpp_pool?Di=new t.geom.ZPP_GeomVert:(Di=t.geom.ZPP_GeomVert.zpp_pool,t.geom.ZPP_GeomVert.zpp_pool=Di.next,Di.next=null),Di.forced=!1,Di.x=r,Di.y=o,Gi=Di,(u||h)&&(Gi.forced=!0);else if(2==Fi){var Ui;null==t.geom.ZPP_GeomVert.zpp_pool?Ui=new t.geom.ZPP_GeomVert:(Ui=t.geom.ZPP_GeomVert.zpp_pool,t.geom.ZPP_GeomVert.zpp_pool=Ui.next,Ui.next=null),Ui.forced=!1,Ui.x=a,Ui.y=o,Gi=Ui,(c||h)&&(Gi.forced=!0)}else if(4==Fi){var ji;null==t.geom.ZPP_GeomVert.zpp_pool?ji=new t.geom.ZPP_GeomVert:(ji=t.geom.ZPP_GeomVert.zpp_pool,t.geom.ZPP_GeomVert.zpp_pool=ji.next,ji.next=null),ji.forced=!1,ji.x=a,ji.y=s,Gi=ji,(c||_)&&(Gi.forced=!0)}else if(6==Fi){var Wi;null==t.geom.ZPP_GeomVert.zpp_pool?Wi=new t.geom.ZPP_GeomVert:(Wi=t.geom.ZPP_GeomVert.zpp_pool,t.geom.ZPP_GeomVert.zpp_pool=Wi.next,Wi.next=null),Wi.forced=!1,Wi.x=r,Wi.y=s,Gi=Wi,(u||_)&&(Gi.forced=!0)}else if(1==Fi){if(null==(Gi=i.list[(p<<1)*i.width+l])){var qi,Ji=this.xlerp(r,a,o,P,f,e,d);null==t.geom.ZPP_GeomVert.zpp_pool?qi=new t.geom.ZPP_GeomVert:(qi=t.geom.ZPP_GeomVert.zpp_pool,t.geom.ZPP_GeomVert.zpp_pool=qi.next,qi.next=null),qi.forced=!1,qi.x=Ji,qi.y=o,Gi=qi,i.list[(p<<1)*i.width+l]=Gi}else{var $i,Xi=Gi.x,Yi=Gi.y;null==t.geom.ZPP_GeomVert.zpp_pool?$i=new t.geom.ZPP_GeomVert:($i=t.geom.ZPP_GeomVert.zpp_pool,t.geom.ZPP_GeomVert.zpp_pool=$i.next,$i.next=null),$i.forced=!1,$i.x=Xi,$i.y=Yi,Gi=$i}h&&(Gi.forced=!0),Gi.x!=r&&Gi.x!=a||(Gi.x==r&&0!=(1&Ri)||Gi.x==a&&0!=(4&Ri))&&(Ri^=2)}else if(5==Fi){if(null==(Gi=i.list[(2+(p<<1))*i.width+l])){var Ki,Qi=this.xlerp(r,a,s,v,x,e,d);null==t.geom.ZPP_GeomVert.zpp_pool?Ki=new t.geom.ZPP_GeomVert:(Ki=t.geom.ZPP_GeomVert.zpp_pool,t.geom.ZPP_GeomVert.zpp_pool=Ki.next,Ki.next=null),Ki.forced=!1,Ki.x=Qi,Ki.y=s,Gi=Ki,i.list[(2+(p<<1))*i.width+l]=Gi}else{var er,tr=Gi.x,nr=Gi.y;null==t.geom.ZPP_GeomVert.zpp_pool?er=new t.geom.ZPP_GeomVert:(er=t.geom.ZPP_GeomVert.zpp_pool,t.geom.ZPP_GeomVert.zpp_pool=er.next,er.next=null),er.forced=!1,er.x=tr,er.y=nr,Gi=er}_&&(Gi.forced=!0),Gi.x!=r&&Gi.x!=a||(Gi.x==r&&0!=(64&Ri)||Gi.x==a&&0!=(16&Ri))&&(Ri^=32)}else if(3==Fi){if(null==(Gi=i.list[(1+(p<<1))*i.width+(l+1)])){var ir,rr=this.ylerp(o,s,a,f,x,e,d);null==t.geom.ZPP_GeomVert.zpp_pool?ir=new t.geom.ZPP_GeomVert:(ir=t.geom.ZPP_GeomVert.zpp_pool,t.geom.ZPP_GeomVert.zpp_pool=ir.next,ir.next=null),ir.forced=!1,ir.x=a,ir.y=rr,Gi=ir,i.list[(1+(p<<1))*i.width+(l+1)]=Gi}else{var or,ar=Gi.x,sr=Gi.y;null==t.geom.ZPP_GeomVert.zpp_pool?or=new t.geom.ZPP_GeomVert:(or=t.geom.ZPP_GeomVert.zpp_pool,t.geom.ZPP_GeomVert.zpp_pool=or.next,or.next=null),or.forced=!1,or.x=ar,or.y=sr,Gi=or}c&&(Gi.forced=!0),Gi.y!=o&&Gi.y!=s||(Gi.y==o&&0!=(4&Ri)||Gi.y==s&&0!=(16&Ri))&&(Ri^=8)}else{if(null==(Gi=i.list[(1+(p<<1))*i.width+l])){var lr,pr=this.ylerp(o,s,r,P,v,e,d);null==t.geom.ZPP_GeomVert.zpp_pool?lr=new t.geom.ZPP_GeomVert:(lr=t.geom.ZPP_GeomVert.zpp_pool,t.geom.ZPP_GeomVert.zpp_pool=lr.next,lr.next=null),lr.forced=!1,lr.x=r,lr.y=pr,Gi=lr,i.list[(1+(p<<1))*i.width+l]=Gi}else{var ur,hr=Gi.x,cr=Gi.y;null==t.geom.ZPP_GeomVert.zpp_pool?ur=new t.geom.ZPP_GeomVert:(ur=t.geom.ZPP_GeomVert.zpp_pool,t.geom.ZPP_GeomVert.zpp_pool=ur.next,ur.next=null),ur.forced=!1,ur.x=hr,ur.y=cr,Gi=ur}u&&(Gi.forced=!0),Gi.y!=o&&Gi.y!=s||(Gi.y==o&&0!=(1&Ri)||Gi.y==s&&0!=(64&Ri))&&(Ri^=128)}var _r=Gi;null==y.p1?y.p1=_r.prev=_r.next=_r:(_r.prev=y.p1,_r.next=y.p1.next,y.p1.next.prev=_r,y.p1.next=_r),y.p1=_r}}y.p1=y.p1.next,y.key1=Ri,1!=Ri&&4!=Ri&&16!=Ri&&64!=Ri&&3!=Ri&&12!=Ri&&48!=Ri&&192!=Ri&&129!=Ri&&6!=Ri&&24!=Ri&&96!=Ri&&5!=Ri&&20!=Ri&&80!=Ri&&65!=Ri&&17!=Ri&&68!=Ri||(Ri=0,y.key1=0,y.p1=null),0==Ri?y=null:(y.pr=y.p1,y.okeyr=y.okey1,y.keyr=y.key1)}}}return y},t.geom.ZPP_MarchingSquares.prototype.lerp=function(t,n,i,r){if(0==i)return t;if(0==r)return n;var o=i-r,a=o*o<e.Config.epsilon*e.Config.epsilon?.5:i/o;return a<0?a=0:a>1&&(a=1),t+a*(n-t)},t.geom.ZPP_MarchingSquares.prototype.xlerp=function(t,n,i,r,o,a,s){var l;if(0==r)l=t;else if(0==o)l=n;else{var p=r-o,u=p*p<e.Config.epsilon*e.Config.epsilon?.5:r/p;u<0?u=0:u>1&&(u=1),l=t+u*(n-t)}for(;0!=s--&&t<l&&l<n;){var h=a(l,i);if(0==h)break;if(r*h<0?(n=l,o=h):(t=l,r=h),0==r)l=t;else if(0==o)l=n;else{var c=r-o,_=c*c<e.Config.epsilon*e.Config.epsilon?.5:r/c;_<0?_=0:_>1&&(_=1),l=t+_*(n-t)}}return l},t.geom.ZPP_MarchingSquares.prototype.ylerp=function(t,n,i,r,o,a,s){var l;if(0==r)l=t;else if(0==o)l=n;else{var p=r-o,u=p*p<e.Config.epsilon*e.Config.epsilon?.5:r/p;u<0?u=0:u>1&&(u=1),l=t+u*(n-t)}for(;0!=s--&&t<l&&l<n;){var h=a(i,l);if(0==h)break;if(r*h<0?(n=l,o=h):(t=l,r=h),0==r)l=t;else if(0==o)l=n;else{var c=r-o,_=c*c<e.Config.epsilon*e.Config.epsilon?.5:r/c;_<0?_=0:_>1&&(_=1),l=t+_*(n-t)}}return l},t.geom.ZPP_MarchingSquares.prototype.__class__=t.geom.ZPP_MarchingSquares,t.geom.ZPP_Mat23=l["zpp_nape.geom.ZPP_Mat23"]=function(){this.next=null,this._invalidate=null,this.ty=0,this.tx=0,this.d=0,this.c=0,this.b=0,this.a=0,this.outer=null},t.geom.ZPP_Mat23.__name__=["zpp_nape","geom","ZPP_Mat23"],t.geom.ZPP_Mat23.get=function(){var e;return null==t.geom.ZPP_Mat23.zpp_pool?e=new t.geom.ZPP_Mat23:(e=t.geom.ZPP_Mat23.zpp_pool,t.geom.ZPP_Mat23.zpp_pool=e.next,e.next=null),e},t.geom.ZPP_Mat23.identity=function(){var e=t.geom.ZPP_Mat23.get();return e.setas(1,0,0,1,0,0),e},t.geom.ZPP_Mat23.prototype.outer=null,t.geom.ZPP_Mat23.prototype.wrapper=function(){if(null==this.outer){this.outer=new e.geom.Mat23;var n=this.outer.zpp_inner;n.next=t.geom.ZPP_Mat23.zpp_pool,t.geom.ZPP_Mat23.zpp_pool=n,this.outer.zpp_inner=this}return this.outer},t.geom.ZPP_Mat23.prototype.a=null,t.geom.ZPP_Mat23.prototype.b=null,t.geom.ZPP_Mat23.prototype.c=null,t.geom.ZPP_Mat23.prototype.d=null,t.geom.ZPP_Mat23.prototype.tx=null,t.geom.ZPP_Mat23.prototype.ty=null,t.geom.ZPP_Mat23.prototype._invalidate=null,t.geom.ZPP_Mat23.prototype.invalidate=function(){null!=this._invalidate&&this._invalidate()},t.geom.ZPP_Mat23.prototype.set=function(e){this.setas(e.a,e.b,e.c,e.d,e.tx,e.ty)},t.geom.ZPP_Mat23.prototype.setas=function(e,t,n,i,r,o){this.tx=r,this.ty=o,this.a=e,this.b=t,this.c=n,this.d=i},t.geom.ZPP_Mat23.prototype.next=null,t.geom.ZPP_Mat23.prototype.free=function(){},t.geom.ZPP_Mat23.prototype.alloc=function(){},t.geom.ZPP_Mat23.prototype.__class__=t.geom.ZPP_Mat23,t.geom.ZPP_MatMN=l["zpp_nape.geom.ZPP_MatMN"]=function(e,t){this.x=null,this.n=0,this.m=0,this.outer=null,this.m=e,this.n=t,this.x=[];for(var n=0,i=e*t;n<i;)n++,this.x.push(0)},t.geom.ZPP_MatMN.__name__=["zpp_nape","geom","ZPP_MatMN"],t.geom.ZPP_MatMN.prototype.outer=null,t.geom.ZPP_MatMN.prototype.m=null,t.geom.ZPP_MatMN.prototype.n=null,t.geom.ZPP_MatMN.prototype.x=null,t.geom.ZPP_MatMN.prototype.__class__=t.geom.ZPP_MatMN,t.geom.ZPP_Monotone=l["zpp_nape.geom.ZPP_Monotone"]=function(){},t.geom.ZPP_Monotone.__name__=["zpp_nape","geom","ZPP_Monotone"],t.geom.ZPP_Monotone.bisector=function(e){var n,i,r,o,a,s=e.prev,l=e.next;n=e.x-s.x,i=e.y-s.y,r=l.x-e.x,o=l.y-e.y,null==t.geom.ZPP_Vec2.zpp_pool?a=new t.geom.ZPP_Vec2:(a=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=a.next,a.next=null),a.weak=!1,a._immutable=!1,a.x=-i-o,a.y=n+r;var p=a,u=p.x*p.x+p.y*p.y,h=1/Math.sqrt(u);return p.x*=h,p.y*=h,o*n-r*i<0&&(p.x=-p.x,p.y=-p.y),p},t.geom.ZPP_Monotone.below=function(e,n){if(e.y<n.y)return!0;if(e.y>n.y)return!1;if(e.x<n.x)return!0;if(e.x>n.x)return!1;var i=t.geom.ZPP_Monotone.bisector(e),r=t.geom.ZPP_Monotone.bisector(n);i.x+=1*e.x,i.y+=1*e.y,r.x+=1*n.x,r.y+=1*n.y;var o=i.x<r.x||i.x==r.x&&i.y<r.y,a=i;null!=a.outer&&(a.outer.zpp_inner=null,a.outer=null),a._isimmutable=null,a._validate=null,a._invalidate=null,a.next=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=a;var s=r;return null!=s.outer&&(s.outer.zpp_inner=null,s.outer=null),s._isimmutable=null,s._validate=null,s._invalidate=null,s.next=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=s,o},t.geom.ZPP_Monotone.above=function(e,n){return t.geom.ZPP_Monotone.below(n,e)},t.geom.ZPP_Monotone.left_vertex=function(e){var t=e.prev;return t.y>e.y||t.y==e.y&&e.next.y<e.y},t.geom.ZPP_Monotone.isMonotone=function(e){var t=e,n=e,i=e.next,r=e;if(null!=i)for(var o=i;;){var a=o;if(a.y<t.y&&(t=a),a.y>n.y&&(n=a),(o=o.next)==r)break}var s=!0,l=t;if(n!=t.next){var p=t.next,u=n;if(null!=p)for(var h=p;;){var c=h;if(c.y<l.y){s=!1;break}if(l=c,(h=h.next)==u)break}}if(!s)return!1;if(l=t,n!=t.prev){var _=t.prev,d=n;if(null!=_)for(var m=_;;){var P=m;if(P.y<l.y){s=!1;break}if(l=P,(m=m.prev)==d)break}}return s},t.geom.ZPP_Monotone.sharedPPoly=null,t.geom.ZPP_Monotone.getShared=function(){return null==t.geom.ZPP_Monotone.sharedPPoly&&(t.geom.ZPP_Monotone.sharedPPoly=new t.geom.ZPP_PartitionedPoly),t.geom.ZPP_Monotone.sharedPPoly},t.geom.ZPP_Monotone.decompose=function(e,i){if(null==i?i=new t.geom.ZPP_PartitionedPoly(e):i.init(e),null==i.vertices)return i;null==t.geom.ZPP_Monotone.queue&&(t.geom.ZPP_Monotone.queue=new t.util.ZNPList_ZPP_PartitionVertex);var r=i.vertices,o=i.vertices;if(null!=r)for(var a=r;;){var s,l,p,u=a;t.geom.ZPP_Monotone.queue.add(u),s=u.next.x-u.x,l=u.next.y-u.y,p=u.prev.x-u.x;var h=(u.prev.y-u.y)*s-p*l>0;if(u.type=t.geom.ZPP_Monotone.below(u.prev,u)?t.geom.ZPP_Monotone.below(u.next,u)?h?0:3:4:t.geom.ZPP_Monotone.below(u,u.next)?h?1:2:4,(a=a.next)==o)break}var c=t.geom.ZPP_Monotone.queue;if(null!=c.head&&null!=c.head.next){for(var _,d,m,P=c.head,f=null,x=null,y=null,v=null,g=1;;){for(_=0,x=P,f=P=null;null!=x;){for(++_,y=x,d=0,m=g;null!=y&&d<g;)++d,y=y.next;for(;d>0||m>0&&null!=y;)0==d?(v=y,y=y.next,--m):0==m||null==y||t.geom.ZPP_Monotone.above(x.elt,y.elt)?(v=x,x=x.next,--d):(v=y,y=y.next,--m),null!=f?f.next=v:P=v,f=v;x=y}if(f.next=null,g<<=1,!(_>1))break}c.head=P,c.modified=!0,c.pushmod=!0}for(null==t.geom.ZPP_Monotone.edges&&(null==t.util.ZPP_Set_ZPP_PartitionVertex.zpp_pool?t.geom.ZPP_Monotone.edges=new t.util.ZPP_Set_ZPP_PartitionVertex:(t.geom.ZPP_Monotone.edges=t.util.ZPP_Set_ZPP_PartitionVertex.zpp_pool,t.util.ZPP_Set_ZPP_PartitionVertex.zpp_pool=t.geom.ZPP_Monotone.edges.next,t.geom.ZPP_Monotone.edges.next=null),t.geom.ZPP_Monotone.edges.lt=t.geom.ZPP_PartitionVertex.edge_lt,t.geom.ZPP_Monotone.edges.swapped=t.geom.ZPP_PartitionVertex.edge_swap);null!=t.geom.ZPP_Monotone.queue.head;){var b=t.geom.ZPP_Monotone.queue.pop_unsafe();switch(b.type){case 0:b.helper=b,b.node=t.geom.ZPP_Monotone.edges.insert(b);break;case 1:var z=b.prev;if(null==z.helper)throw new n._Boot.HaxeError("Fatal error (1): Polygon is not weakly-simple and clockwise");2==z.helper.type&&i.add_diagonal(b,z.helper),t.geom.ZPP_Monotone.edges.remove_node(z.node),z.helper=null;break;case 2:var w=b.prev;if(null==w.helper)throw new n._Boot.HaxeError("Fatal error (3): Polygon is not weakly-simple and clockwise");2==w.helper.type&&i.add_diagonal(b,w.helper),t.geom.ZPP_Monotone.edges.remove_node(w.node),w.helper=null;var Z=null;if(!t.geom.ZPP_Monotone.edges.empty()){for(var E=t.geom.ZPP_Monotone.edges.parent;null!=E.prev;)E=E.prev;for(;null!=E;){var M=E.data;if(!t.geom.ZPP_PartitionVertex.vert_lt(M,b)){Z=M;break}if(null!=E.next)for(E=E.next;null!=E.prev;)E=E.prev;else{for(;null!=E.parent&&E==E.parent.next;)E=E.parent;E=E.parent}}}var S=Z;if(null!=S){if(null==S.helper)throw new n._Boot.HaxeError("Fatal error (4): Polygon is not weakly-simple and clockwise");2==S.helper.type&&i.add_diagonal(b,S.helper),S.helper=b}break;case 3:var C=null;if(!t.geom.ZPP_Monotone.edges.empty()){for(var N=t.geom.ZPP_Monotone.edges.parent;null!=N.prev;)N=N.prev;for(;null!=N;){var A=N.data;if(!t.geom.ZPP_PartitionVertex.vert_lt(A,b)){C=A;break}if(null!=N.next)for(N=N.next;null!=N.prev;)N=N.prev;else{for(;null!=N.parent&&N==N.parent.next;)N=N.parent;N=N.parent}}}var L=C;if(null!=L){if(null==L.helper)throw new n._Boot.HaxeError("Fatal error (2): Polygon is not weakly-simple and clockwise");i.add_diagonal(b,L.helper),L.helper=b}b.node=t.geom.ZPP_Monotone.edges.insert(b),b.helper=b;break;case 4:var B=b.prev;if(t.geom.ZPP_Monotone.left_vertex(b)){if(null==B.helper)throw new n._Boot.HaxeError("Fatal error (5): Polygon is not weakly-simple and clockwise");2==B.helper.type&&i.add_diagonal(b,B.helper),t.geom.ZPP_Monotone.edges.remove_node(B.node),B.helper=null,b.node=t.geom.ZPP_Monotone.edges.insert(b),b.helper=b}else{var T=null;if(!t.geom.ZPP_Monotone.edges.empty()){for(var V=t.geom.ZPP_Monotone.edges.parent;null!=V.prev;)V=V.prev;for(;null!=V;){var k=V.data;if(!t.geom.ZPP_PartitionVertex.vert_lt(k,b)){T=k;break}if(null!=V.next)for(V=V.next;null!=V.prev;)V=V.prev;else{for(;null!=V.parent&&V==V.parent.next;)V=V.parent;V=V.parent}}}var I=T;if(null==I||null==I.helper)throw new n._Boot.HaxeError("Fatal error (6): Polygon is not weakly-simple and clockwise");2==I.helper.type&&i.add_diagonal(b,I.helper),I.helper=b}}}return i},t.geom.ZPP_Monotone.prototype.__class__=t.geom.ZPP_Monotone,t.geom.ZPP_PartitionVertex=l["zpp_nape.geom.ZPP_PartitionVertex"]=function(){this.node=null,this.prev=null,this.next=null,this.rightchain=!1,this.helper=null,this.type=0,this.diagonals=null,this.forced=!1,this.y=0,this.x=0,this.mag=0,this.id=0,this.id=t.geom.ZPP_PartitionVertex.nextId++,this.diagonals=new t.util.ZNPList_ZPP_PartitionVertex},t.geom.ZPP_PartitionVertex.__name__=["zpp_nape","geom","ZPP_PartitionVertex"],t.geom.ZPP_PartitionVertex.get=function(e){var n;return null==t.geom.ZPP_PartitionVertex.zpp_pool?n=new t.geom.ZPP_PartitionVertex:(n=t.geom.ZPP_PartitionVertex.zpp_pool,t.geom.ZPP_PartitionVertex.zpp_pool=n.next,n.next=null),n.x=e.x,n.y=e.y,n},t.geom.ZPP_PartitionVertex.rightdistance=function(e,t){var n,i,r,o=e.next.y>e.y;return n=e.next.x-e.x,i=e.next.y-e.y,r=t.x-e.x,(o?-1:1)*((t.y-e.y)*n-r*i)},t.geom.ZPP_PartitionVertex.vert_lt=function(e,n){if(n==e||n==e.next)return!0;if(e.y==e.next.y){var i=e.x,r=e.next.x;return(i<r?i:r)<=n.x}return t.geom.ZPP_PartitionVertex.rightdistance(e,n)<=0},t.geom.ZPP_PartitionVertex.edge_swap=function(e,t){var n=e.node;e.node=t.node,t.node=n},t.geom.ZPP_PartitionVertex.edge_lt=function(e,n){if(e==n&&e.next==n.next)return!1;if(e==n.next)return!t.geom.ZPP_PartitionVertex.vert_lt(e,n);if(n==e.next)return t.geom.ZPP_PartitionVertex.vert_lt(n,e);if(e.y==e.next.y){if(n.y==n.next.y){var i=e.x,r=e.next.x,o=n.x,a=n.next.x;return(i>r?i:r)>(o>a?o:a)}return t.geom.ZPP_PartitionVertex.rightdistance(n,e)>0||t.geom.ZPP_PartitionVertex.rightdistance(n,e.next)>0}var s=t.geom.ZPP_PartitionVertex.rightdistance(e,n),l=t.geom.ZPP_PartitionVertex.rightdistance(e,n.next);if(0==s&&0==l){var p=e.x,u=e.next.x,h=n.x,c=n.next.x;return(p>u?p:u)>(h>c?h:c)}if(s*l>=0)return s<0||l<0;var _=t.geom.ZPP_PartitionVertex.rightdistance(n,e),d=t.geom.ZPP_PartitionVertex.rightdistance(n,e.next);return _*d>=0&&(_>0||d>0)},t.geom.ZPP_PartitionVertex.prototype.id=null,t.geom.ZPP_PartitionVertex.prototype.mag=null,t.geom.ZPP_PartitionVertex.prototype.x=null,t.geom.ZPP_PartitionVertex.prototype.y=null,t.geom.ZPP_PartitionVertex.prototype.forced=null,t.geom.ZPP_PartitionVertex.prototype.diagonals=null,t.geom.ZPP_PartitionVertex.prototype.type=null,t.geom.ZPP_PartitionVertex.prototype.helper=null,t.geom.ZPP_PartitionVertex.prototype.rightchain=null,t.geom.ZPP_PartitionVertex.prototype.next=null,t.geom.ZPP_PartitionVertex.prototype.prev=null,t.geom.ZPP_PartitionVertex.prototype.alloc=function(){},t.geom.ZPP_PartitionVertex.prototype.free=function(){this.helper=null},t.geom.ZPP_PartitionVertex.prototype.copy=function(){var e;return null==t.geom.ZPP_PartitionVertex.zpp_pool?e=new t.geom.ZPP_PartitionVertex:(e=t.geom.ZPP_PartitionVertex.zpp_pool,t.geom.ZPP_PartitionVertex.zpp_pool=e.next,e.next=null),e.x=this.x,e.y=this.y,e.forced=this.forced,e},t.geom.ZPP_PartitionVertex.prototype.sort=function(){var e=0,t=0,n=0;e=this.prev.x-this.x,t=this.prev.y-this.y,n=this.next.x-this.x;var i=(this.next.y-this.y)*e-n*t,r=i>0?-1:0==i?0:1,o=this.diagonals;if(null!=o.head&&null!=o.head.next){for(var a,s,l,p=o.head,u=null,h=null,c=null,_=null,d=1;;){for(a=0,h=p,u=p=null;null!=h;){for(++a,c=h,s=0,l=d;null!=c&&s<d;)++s,c=c.next;for(;s>0||l>0&&null!=c;){if(0==s)_=c,c=c.next,--l;else if(0==l||null==c)_=h,h=h.next,--s;else{var m;if(1==r){e=h.elt.x-this.x,t=h.elt.y-this.y,n=c.elt.x-this.x;var P=(c.elt.y-this.y)*e-n*t;m=1==(P>0?-1:0==P?0:1)}else{e=this.prev.x-this.x,t=this.prev.y-this.y,n=h.elt.x-this.x;var f=(h.elt.y-this.y)*e-n*t,x=f>0?-1:0==f?0:1;e=this.prev.x-this.x,t=this.prev.y-this.y,n=c.elt.x-this.x;var y=(c.elt.y-this.y)*e-n*t,v=y>0?-1:0==y?0:1;if(x*v==1||x*v==0&&(1==x||1==v)){e=h.elt.x-this.x,t=h.elt.y-this.y,n=c.elt.x-this.x;var g=(c.elt.y-this.y)*e-n*t;m=1==(g>0?-1:0==g?0:1)}else if(-1==x||-1==v)m=-1==v;else if(0==x&&0==v){e=this.x-this.prev.x,t=this.y-this.prev.y;var b=e*(n=h.elt.x-this.x)+t*(h.elt.y-this.y),z=e*(n=c.elt.x-this.x)+t*(c.elt.y-this.y);m=b<0&&z>0||!(z<0&&b>0)}else m=!0}m?(_=h,h=h.next,--s):(_=c,c=c.next,--l)}null!=u?u.next=_:p=_,u=_}h=c}if(u.next=null,d<<=1,!(a>1))break}o.head=p,o.modified=!0,o.pushmod=!0}},t.geom.ZPP_PartitionVertex.prototype.node=null,t.geom.ZPP_PartitionVertex.prototype.__class__=t.geom.ZPP_PartitionVertex,t.geom.ZPP_PartitionedPoly=l["zpp_nape.geom.ZPP_PartitionedPoly"]=function(e){this.next=null,this.vertices=null,this.init(e)},t.geom.ZPP_PartitionedPoly.__name__=["zpp_nape","geom","ZPP_PartitionedPoly"],t.geom.ZPP_PartitionedPoly.sharedPPList=null,t.geom.ZPP_PartitionedPoly.getSharedPP=function(){return null==t.geom.ZPP_PartitionedPoly.sharedPPList&&(t.geom.ZPP_PartitionedPoly.sharedPPList=new t.util.ZNPList_ZPP_PartitionedPoly),t.geom.ZPP_PartitionedPoly.sharedPPList},t.geom.ZPP_PartitionedPoly.sharedGVList=null,t.geom.ZPP_PartitionedPoly.getShared=function(){return null==t.geom.ZPP_PartitionedPoly.sharedGVList&&(t.geom.ZPP_PartitionedPoly.sharedGVList=new t.util.ZNPList_ZPP_GeomVert),t.geom.ZPP_PartitionedPoly.sharedGVList},t.geom.ZPP_PartitionedPoly.prototype.vertices=null,t.geom.ZPP_PartitionedPoly.prototype.eq=function(t,n){var i,r;return(i=t.x-n.x)*i+(r=t.y-n.y)*r<e.Config.epsilon*e.Config.epsilon},t.geom.ZPP_PartitionedPoly.prototype.next=null,t.geom.ZPP_PartitionedPoly.prototype.alloc=function(){},t.geom.ZPP_PartitionedPoly.prototype.free=function(){},t.geom.ZPP_PartitionedPoly.prototype.init=function(e){if(null!=e){var n=0,i=e;if(null!=e)for(var r=e;;){var o=r;if(n+=o.x*(o.next.y-o.prev.y),(r=r.next)==i)break}for(var a=.5*n>0,s=e;;){var l;if(a){var p;null==t.geom.ZPP_PartitionVertex.zpp_pool?p=new t.geom.ZPP_PartitionVertex:(p=t.geom.ZPP_PartitionVertex.zpp_pool,t.geom.ZPP_PartitionVertex.zpp_pool=p.next,p.next=null),p.x=s.x,p.y=s.y;var u=p;null==this.vertices?this.vertices=u.prev=u.next=u:(u.prev=this.vertices,u.next=this.vertices.next,this.vertices.next.prev=u,this.vertices.next=u),l=u}else{var h;null==t.geom.ZPP_PartitionVertex.zpp_pool?h=new t.geom.ZPP_PartitionVertex:(h=t.geom.ZPP_PartitionVertex.zpp_pool,t.geom.ZPP_PartitionVertex.zpp_pool=h.next,h.next=null),h.x=s.x,h.y=s.y;var c=h;null==this.vertices?this.vertices=c.prev=c.next=c:(c.next=this.vertices,c.prev=this.vertices.prev,this.vertices.prev.next=c,this.vertices.prev=c),l=c}if(this.vertices=l,this.vertices.forced=s.forced,(s=s.next)==e)break}this.remove_collinear_vertices()}},t.geom.ZPP_PartitionedPoly.prototype.remove_collinear_vertices=function(){for(var n,i=this.vertices,r=!0;r||i!=this.vertices;)if(r=!1,this.eq(i,i.next)){if(i==this.vertices&&(this.vertices=i.next,r=!0),i.forced&&(i.next.forced=!0),null!=i&&i.prev==i){i.next=i.prev=null;var o=i;o.helper=null,o.next=t.geom.ZPP_PartitionVertex.zpp_pool,t.geom.ZPP_PartitionVertex.zpp_pool=o,i=i=null}else{var a=i.next;i.prev.next=i.next,i.next.prev=i.prev,i.next=i.prev=null;var s=i;s.helper=null,s.next=t.geom.ZPP_PartitionVertex.zpp_pool,t.geom.ZPP_PartitionVertex.zpp_pool=s,i=null,i=a}if(null==i){this.vertices=null;break}}else i=i.next;if(null==this.vertices)return!0;for(;;){for(n=!1,i=this.vertices,r=!0;r||i!=this.vertices;){r=!1;var l,p,u,h=i.prev;l=i.x-h.x,p=i.y-h.y,u=i.next.x-i.x;var c=(i.next.y-i.y)*l-u*p;if(c*c>=e.Config.epsilon*e.Config.epsilon)i=i.next;else{if(i==this.vertices&&(this.vertices=i.next,r=!0),null!=i&&i.prev==i){i.next=i.prev=null;var _=i;_.helper=null,_.next=t.geom.ZPP_PartitionVertex.zpp_pool,t.geom.ZPP_PartitionVertex.zpp_pool=_,i=i=null}else{var d=i.next;i.prev.next=i.next,i.next.prev=i.prev,i.next=i.prev=null;var m=i;m.helper=null,m.next=t.geom.ZPP_PartitionVertex.zpp_pool,t.geom.ZPP_PartitionVertex.zpp_pool=m,i=null,i=d}if(n=!0,null==i){n=!1,this.vertices=null;break}}}if(!n)break}return null==this.vertices},t.geom.ZPP_PartitionedPoly.prototype.add_diagonal=function(e,t){e.diagonals.add(t),t.diagonals.add(e),e.forced=t.forced=!0},t.geom.ZPP_PartitionedPoly.prototype.extract_partitions=function(e){if(null==e&&(e=new t.util.ZNPList_ZPP_PartitionedPoly),null!=this.vertices){var n=this.vertices,i=this.vertices;if(null!=n)for(var r=n;r.sort(),(r=r.next)!=i;);for(this.pull_partitions(this.vertices,e);null!=this.vertices;){var o;if(null!=this.vertices&&this.vertices.prev==this.vertices){this.vertices.next=this.vertices.prev=null;var a=this.vertices;a.helper=null,a.next=t.geom.ZPP_PartitionVertex.zpp_pool,t.geom.ZPP_PartitionVertex.zpp_pool=a,o=this.vertices=null}else{var s=this.vertices.next;this.vertices.prev.next=this.vertices.next,this.vertices.next.prev=this.vertices.prev,this.vertices.next=this.vertices.prev=null;var l=this.vertices;l.helper=null,l.next=t.geom.ZPP_PartitionVertex.zpp_pool,t.geom.ZPP_PartitionVertex.zpp_pool=l,this.vertices=null,o=s}this.vertices=o}for(var p=null,u=e.head;null!=u;)u.elt.remove_collinear_vertices()?e.erase(p):(p=u,u=u.next)}return e},t.geom.ZPP_PartitionedPoly.prototype.pull_partitions=function(e,n){var i;null==t.geom.ZPP_PartitionedPoly.zpp_pool?i=new t.geom.ZPP_PartitionedPoly:(i=t.geom.ZPP_PartitionedPoly.zpp_pool,t.geom.ZPP_PartitionedPoly.zpp_pool=i.next,i.next=null);for(var r=e;;){var o;null==t.geom.ZPP_PartitionVertex.zpp_pool?o=new t.geom.ZPP_PartitionVertex:(o=t.geom.ZPP_PartitionVertex.zpp_pool,t.geom.ZPP_PartitionVertex.zpp_pool=o.next,o.next=null),o.x=r.x,o.y=r.y,o.forced=r.forced;var a=o;if(null==i.vertices?i.vertices=a.prev=a.next=a:(a.prev=i.vertices,a.next=i.vertices.next,i.vertices.next.prev=a,i.vertices.next=a),i.vertices=a,i.vertices.forced=r.forced,null!=r.diagonals.head){var s=r.diagonals,l=s.head.elt;if(s.pop(),l==e)break;r=this.pull_partitions(r,n)}else r=r.next;if(r==e)break}var p=0,u=i.vertices,h=i.vertices;if(null!=u)for(var c=u;;){var _=c;if(p+=_.x*(_.next.y-_.prev.y),(c=c.next)==h)break}return.5*p!=0&&n.add(i),r},t.geom.ZPP_PartitionedPoly.prototype.extract=function(e){if(null==e&&(e=new t.util.ZNPList_ZPP_GeomVert),null!=this.vertices){var n=this.vertices,i=this.vertices;if(null!=n)for(var r=n;r.sort(),(r=r.next)!=i;);for(this.pull(this.vertices,e);null!=this.vertices;){var o;if(null!=this.vertices&&this.vertices.prev==this.vertices){this.vertices.next=this.vertices.prev=null;var a=this.vertices;a.helper=null,a.next=t.geom.ZPP_PartitionVertex.zpp_pool,t.geom.ZPP_PartitionVertex.zpp_pool=a,o=this.vertices=null}else{var s=this.vertices.next;this.vertices.prev.next=this.vertices.next,this.vertices.next.prev=this.vertices.prev,this.vertices.next=this.vertices.prev=null;var l=this.vertices;l.helper=null,l.next=t.geom.ZPP_PartitionVertex.zpp_pool,t.geom.ZPP_PartitionVertex.zpp_pool=l,this.vertices=null,o=s}this.vertices=o}}return e},t.geom.ZPP_PartitionedPoly.prototype.pull=function(n,i){for(var r=null,o=n;;){var a,s=o.x,l=o.y;null==t.geom.ZPP_GeomVert.zpp_pool?a=new t.geom.ZPP_GeomVert:(a=t.geom.ZPP_GeomVert.zpp_pool,t.geom.ZPP_GeomVert.zpp_pool=a.next,a.next=null),a.forced=!1,a.x=s,a.y=l;var p=a;if(null==r?r=p.prev=p.next=p:(p.prev=r,p.next=r.next,r.next.prev=p,r.next=p),(r=p).forced=o.forced,null!=o.diagonals.head){var u=o.diagonals,h=u.head.elt;if(u.pop(),h==n)break;o=this.pull(o,i)}else o=o.next;if(o==n)break}var c=0,_=r;if(null!=r)for(var d=r;;){var m=d;if(c+=m.x*(m.next.y-m.prev.y),(d=d.next)==_)break}var P=.5*c;if(P*P>=e.Config.epsilon*e.Config.epsilon){for(var f=r,x=!0;x||f!=r;){var y,v;if(x=!1,(y=f.x-f.next.x)*y+(v=f.y-f.next.y)*v<e.Config.epsilon*e.Config.epsilon){if(f==r&&(r=f.next,x=!0),f.forced&&(f.next.forced=!0),null!=f&&f.prev==f)f.next=f.prev=null,f=f=null;else{var g=f.next;f.prev.next=f.next,f.next.prev=f.prev,f.next=f.prev=null,f=null,f=g}if(null==f){r=null;break}}else f=f.next}if(null!=r)for(var b;;){for(b=!1,f=r,x=!0;x||f!=r;){x=!1;var z,w,Z,E=f.prev;z=f.x-E.x,w=f.y-E.y,Z=f.next.x-f.x;var M=(f.next.y-f.y)*z-Z*w;if(M*M>=e.Config.epsilon*e.Config.epsilon)f=f.next;else{if(f==r&&(r=f.next,x=!0),null!=f&&f.prev==f)f.next=f.prev=null,f=f=null;else{var S=f.next;f.prev.next=f.next,f.next.prev=f.prev,f.next=f.prev=null,f=null,f=S}if(b=!0,null==f){b=!1,r=null;break}}}if(!b)break}null!=r&&i.add(r)}return o},t.geom.ZPP_PartitionedPoly.prototype.__class__=t.geom.ZPP_PartitionedPoly,t.geom.ZPP_Ray=l["zpp_nape.geom.ZPP_Ray"]=function(){var i,r;if(this.zip_dir=!1,this.absnormaly=0,this.absnormalx=0,this.normaly=0,this.normalx=0,this.idiry=0,this.idirx=0,this.diry=0,this.dirx=0,this.originy=0,this.originx=0,this.userData=null,this.maxdist=0,this.direction=null,this.origin=null,null==t.util.ZPP_PubPool.poolVec2?i=new e.geom.Vec2:(i=t.util.ZPP_PubPool.poolVec2,t.util.ZPP_PubPool.poolVec2=i.zpp_pool,i.zpp_pool=null,i.zpp_disp=!1,i==t.util.ZPP_PubPool.nextVec2&&(t.util.ZPP_PubPool.nextVec2=null)),null==i.zpp_inner){var o;null==t.geom.ZPP_Vec2.zpp_pool?o=new t.geom.ZPP_Vec2:(o=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=o.next,o.next=null),o.weak=!1,o._immutable=!1,o.x=0,o.y=0,i.zpp_inner=o,i.zpp_inner.outer=i}else{if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var a,s=i.zpp_inner;if(s._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=s._isimmutable&&s._isimmutable(),null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var l=i.zpp_inner;if(null!=l._validate&&l._validate(),0==i.zpp_inner.x){if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var u=i.zpp_inner;null!=u._validate&&u._validate(),a=0==i.zpp_inner.y}else a=!1;if(!a){i.zpp_inner.x=0,i.zpp_inner.y=0;var h=i.zpp_inner;null!=h._invalidate&&h._invalidate(h)}}if(i.zpp_inner.weak=!1,this.origin=i,this.origin.zpp_inner._invalidate=p(this,this.origin_invalidate),null==t.util.ZPP_PubPool.poolVec2?r=new e.geom.Vec2:(r=t.util.ZPP_PubPool.poolVec2,t.util.ZPP_PubPool.poolVec2=r.zpp_pool,r.zpp_pool=null,r.zpp_disp=!1,r==t.util.ZPP_PubPool.nextVec2&&(t.util.ZPP_PubPool.nextVec2=null)),null==r.zpp_inner){var c;null==t.geom.ZPP_Vec2.zpp_pool?c=new t.geom.ZPP_Vec2:(c=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=c.next,c.next=null),c.weak=!1,c._immutable=!1,c.x=0,c.y=0,r.zpp_inner=c,r.zpp_inner.outer=r}else{if(null!=r&&r.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var _,d=r.zpp_inner;if(d._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=d._isimmutable&&d._isimmutable(),null!=r&&r.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var m=r.zpp_inner;if(null!=m._validate&&m._validate(),0==r.zpp_inner.x){if(null!=r&&r.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var P=r.zpp_inner;null!=P._validate&&P._validate(),_=0==r.zpp_inner.y}else _=!1;if(!_){r.zpp_inner.x=0,r.zpp_inner.y=0;var f=r.zpp_inner;null!=f._invalidate&&f._invalidate(f)}}r.zpp_inner.weak=!1,this.direction=r,this.direction.zpp_inner._invalidate=p(this,this.direction_invalidate),this.originx=0,this.originy=0,this.dirx=0,this.diry=0,this.zip_dir=!1},t.geom.ZPP_Ray.__name__=["zpp_nape","geom","ZPP_Ray"],t.geom.ZPP_Ray.prototype.origin=null,t.geom.ZPP_Ray.prototype.direction=null,t.geom.ZPP_Ray.prototype.maxdist=null,t.geom.ZPP_Ray.prototype.userData=null,t.geom.ZPP_Ray.prototype.originx=null,t.geom.ZPP_Ray.prototype.originy=null,t.geom.ZPP_Ray.prototype.dirx=null,t.geom.ZPP_Ray.prototype.diry=null,t.geom.ZPP_Ray.prototype.idirx=null,t.geom.ZPP_Ray.prototype.idiry=null,t.geom.ZPP_Ray.prototype.normalx=null,t.geom.ZPP_Ray.prototype.normaly=null,t.geom.ZPP_Ray.prototype.absnormalx=null,t.geom.ZPP_Ray.prototype.absnormaly=null,t.geom.ZPP_Ray.prototype.origin_invalidate=function(e){this.originx=e.x,this.originy=e.y},t.geom.ZPP_Ray.prototype.direction_invalidate=function(e){this.dirx=e.x,this.diry=e.y,this.zip_dir=!0},t.geom.ZPP_Ray.prototype.zip_dir=null,t.geom.ZPP_Ray.prototype.invalidate_dir=function(){this.zip_dir=!0},t.geom.ZPP_Ray.prototype.validate_dir=function(){if(this.zip_dir){if(this.zip_dir=!1,this.dirx*this.dirx+this.diry*this.diry<e.Config.epsilon)throw new n._Boot.HaxeError("Error: Ray::direction is degenerate");var t=this.dirx*this.dirx+this.diry*this.diry,i=1/Math.sqrt(t);this.dirx*=i,this.diry*=i,this.idirx=1/this.dirx,this.idiry=1/this.diry,this.normalx=-this.diry,this.normaly=this.dirx;var r=this.normalx;this.absnormalx=r<0?-r:r;var o=this.normaly;this.absnormaly=o<0?-o:o}},t.geom.ZPP_Ray.prototype.rayAABB=function(){var e,n=this.originx,i=n,r=this.originy,o=r;if(this.maxdist>=1/0?(this.dirx>0?i=1/0:this.dirx<0&&(i=-1/0),this.diry>0?o=1/0:this.diry<0&&(o=-1/0)):(i+=this.maxdist*this.dirx,o+=this.maxdist*this.diry),i<n){var a=n;n=i,i=a}if(o<r){var s=r;r=o,o=s}return null==t.geom.ZPP_AABB.zpp_pool?e=new t.geom.ZPP_AABB:(e=t.geom.ZPP_AABB.zpp_pool,t.geom.ZPP_AABB.zpp_pool=e.next,e.next=null),e.minx=n,e.miny=r,e.maxx=i,e.maxy=o,e},t.geom.ZPP_Ray.prototype.aabbtest=function(e){var t=this.normalx*(this.originx-.5*(e.minx+e.maxx))+this.normaly*(this.originy-.5*(e.miny+e.maxy));return(t<0?-t:t)<.5*this.absnormalx*(e.maxx-e.minx)+.5*this.absnormaly*(e.maxy-e.miny)},t.geom.ZPP_Ray.prototype.aabbsect=function(e){var t=this.originx>=e.minx&&this.originx<=e.maxx,n=this.originy>=e.miny&&this.originy<=e.maxy;if(t&&n)return 0;for(var i=-1;!(this.dirx>=0&&this.originx>=e.maxx||this.dirx<=0&&this.originx<=e.minx||this.diry>=0&&this.originy>=e.maxy||this.diry<=0&&this.originy<=e.miny);){if(this.dirx>0){var r=(e.minx-this.originx)*this.idirx;if(r>=0&&r<=this.maxdist){var o=this.originy+r*this.diry;if(o>=e.miny&&o<=e.maxy){i=r;break}}}else if(this.dirx<0){var a=(e.maxx-this.originx)*this.idirx;if(a>=0&&a<=this.maxdist){var s=this.originy+a*this.diry;if(s>=e.miny&&s<=e.maxy){i=a;break}}}if(this.diry>0){var l=(e.miny-this.originy)*this.idiry;if(l>=0&&l<=this.maxdist){var p=this.originx+l*this.dirx;if(p>=e.minx&&p<=e.maxx){i=l;break}}}else if(this.diry<0){var u=(e.maxy-this.originy)*this.idiry;if(u>=0&&u<=this.maxdist){var h=this.originx+u*this.dirx;if(h>=e.minx&&h<=e.maxx){i=u;break}}}break}return i},t.geom.ZPP_Ray.prototype.circlesect=function(i,r,o){if(i.zip_worldCOM&&null!=i.body){if(i.zip_worldCOM=!1,i.zip_localCOM){if(i.zip_localCOM=!1,1==i.type){var a=i.polygon;if(null==a.lverts.next)throw new n._Boot.HaxeError("Error: An empty polygon has no meaningful localCOM");if(null==a.lverts.next.next)a.localCOMx=a.lverts.next.x,a.localCOMy=a.lverts.next.y;else if(null==a.lverts.next.next.next)a.localCOMx=a.lverts.next.x,a.localCOMy=a.lverts.next.y,a.localCOMx+=1*a.lverts.next.next.x,a.localCOMy+=1*a.lverts.next.next.y,a.localCOMx*=.5,a.localCOMy*=.5;else{a.localCOMx=0,a.localCOMy=0;var s=0,l=a.lverts.next,p=l,u=l=l.next;for(l=l.next;null!=l;){var h=l;s+=u.x*(h.y-p.y);var c=h.y*u.x-h.x*u.y;a.localCOMx+=(u.x+h.x)*c,a.localCOMy+=(u.y+h.y)*c,p=u,u=h,l=l.next}var _=l=a.lverts.next;s+=u.x*(_.y-p.y);var d=_.y*u.x-_.x*u.y;a.localCOMx+=(u.x+_.x)*d,a.localCOMy+=(u.y+_.y)*d,p=u,u=_;var m=l=l.next;s+=u.x*(m.y-p.y);var P=m.y*u.x-m.x*u.y;a.localCOMx+=(u.x+m.x)*P,a.localCOMy+=(u.y+m.y)*P;var f=s=1/(3*s);a.localCOMx*=f,a.localCOMy*=f}}null!=i.wrap_localCOM&&(i.wrap_localCOM.zpp_inner.x=i.localCOMx,i.wrap_localCOM.zpp_inner.y=i.localCOMy)}var x=i.body;x.zip_axis&&(x.zip_axis=!1,x.axisx=Math.sin(x.rot),x.axisy=Math.cos(x.rot)),i.worldCOMx=i.body.posx+(i.body.axisy*i.localCOMx-i.body.axisx*i.localCOMy),i.worldCOMy=i.body.posy+(i.localCOMx*i.body.axisx+i.localCOMy*i.body.axisy)}var y,v;y=this.originx-i.worldCOMx,v=this.originy-i.worldCOMy;var g=this.dirx*this.dirx+this.diry*this.diry,b=2*(y*this.dirx+v*this.diry),z=y*y+v*v-i.radius*i.radius,w=b*b-4*g*z;if(0==w){var Z=-b/2*g;if((!r||z>0)&&Z>0&&Z<o&&Z<=this.maxdist){var E=0,M=0;E=this.originx,M=this.originy;var S=Z;E+=this.dirx*S,M+=this.diry*S;var C=(E-=1*i.worldCOMx)*E+(M-=1*i.worldCOMy)*M,N=1/Math.sqrt(C);E*=N,M*=N,z<=0&&(E=-E,M=-M);var A,L=E,B=M;if(null==B&&(B=0),null==L&&(L=0),L!=L||B!=B)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null==t.util.ZPP_PubPool.poolVec2?A=new e.geom.Vec2:(A=t.util.ZPP_PubPool.poolVec2,t.util.ZPP_PubPool.poolVec2=A.zpp_pool,A.zpp_pool=null,A.zpp_disp=!1,A==t.util.ZPP_PubPool.nextVec2&&(t.util.ZPP_PubPool.nextVec2=null)),null==A.zpp_inner){var T;null==t.geom.ZPP_Vec2.zpp_pool?T=new t.geom.ZPP_Vec2:(T=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=T.next,T.next=null),T.weak=!1,T._immutable=!1,T.x=L,T.y=B,A.zpp_inner=T,A.zpp_inner.outer=A}else{if(null!=A&&A.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var V,k=A.zpp_inner;if(k._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=k._isimmutable&&k._isimmutable(),L!=L||B!=B)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null!=A&&A.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var I=A.zpp_inner;if(null!=I._validate&&I._validate(),A.zpp_inner.x==L){if(null!=A&&A.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var O=A.zpp_inner;null!=O._validate&&O._validate(),V=A.zpp_inner.y==B}else V=!1;if(!V){A.zpp_inner.x=L,A.zpp_inner.y=B;var R=A.zpp_inner;null!=R._invalidate&&R._invalidate(R)}}return A.zpp_inner.weak=!1,t.geom.ZPP_ConvexRayResult.getRay(A,Z,z<=0,i.outer)}return null}var H=(-b-(w=Math.sqrt(w)))*(g=1/(2*g)),F=(-b+w)*g;if(H>0){if(H<o&&H<=this.maxdist){var D=0,G=0;D=this.originx,G=this.originy;var U=H;D+=this.dirx*U,G+=this.diry*U;var j,W=(D-=1*i.worldCOMx)*D+(G-=1*i.worldCOMy)*G,q=1/Math.sqrt(W),J=D*=q,$=G*=q;if(null==$&&($=0),null==J&&(J=0),J!=J||$!=$)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null==t.util.ZPP_PubPool.poolVec2?j=new e.geom.Vec2:(j=t.util.ZPP_PubPool.poolVec2,t.util.ZPP_PubPool.poolVec2=j.zpp_pool,j.zpp_pool=null,j.zpp_disp=!1,j==t.util.ZPP_PubPool.nextVec2&&(t.util.ZPP_PubPool.nextVec2=null)),null==j.zpp_inner){var X;null==t.geom.ZPP_Vec2.zpp_pool?X=new t.geom.ZPP_Vec2:(X=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=X.next,X.next=null),X.weak=!1,X._immutable=!1,X.x=J,X.y=$,j.zpp_inner=X,j.zpp_inner.outer=j}else{if(null!=j&&j.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var Y,K=j.zpp_inner;if(K._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=K._isimmutable&&K._isimmutable(),J!=J||$!=$)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null!=j&&j.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var Q=j.zpp_inner;if(null!=Q._validate&&Q._validate(),j.zpp_inner.x==J){if(null!=j&&j.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var ee=j.zpp_inner;null!=ee._validate&&ee._validate(),Y=j.zpp_inner.y==$}else Y=!1;if(!Y){j.zpp_inner.x=J,j.zpp_inner.y=$;var te=j.zpp_inner;null!=te._invalidate&&te._invalidate(te)}}return j.zpp_inner.weak=!1,t.geom.ZPP_ConvexRayResult.getRay(j,H,!1,i.outer)}return null}if(F>0&&r){if(F<o&&F<=this.maxdist){var ne=0,ie=0;ne=this.originx,ie=this.originy;var re=F;ne+=this.dirx*re,ie+=this.diry*re;var oe,ae=(ne-=1*i.worldCOMx)*ne+(ie-=1*i.worldCOMy)*ie,se=1/Math.sqrt(ae),le=ne=-(ne*=se),pe=ie=-(ie*=se);if(null==pe&&(pe=0),null==le&&(le=0),le!=le||pe!=pe)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null==t.util.ZPP_PubPool.poolVec2?oe=new e.geom.Vec2:(oe=t.util.ZPP_PubPool.poolVec2,t.util.ZPP_PubPool.poolVec2=oe.zpp_pool,oe.zpp_pool=null,oe.zpp_disp=!1,oe==t.util.ZPP_PubPool.nextVec2&&(t.util.ZPP_PubPool.nextVec2=null)),null==oe.zpp_inner){var ue;null==t.geom.ZPP_Vec2.zpp_pool?ue=new t.geom.ZPP_Vec2:(ue=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=ue.next,ue.next=null),ue.weak=!1,ue._immutable=!1,ue.x=le,ue.y=pe,oe.zpp_inner=ue,oe.zpp_inner.outer=oe}else{if(null!=oe&&oe.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var he,ce=oe.zpp_inner;if(ce._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=ce._isimmutable&&ce._isimmutable(),le!=le||pe!=pe)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null!=oe&&oe.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var _e=oe.zpp_inner;if(null!=_e._validate&&_e._validate(),oe.zpp_inner.x==le){if(null!=oe&&oe.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var de=oe.zpp_inner;null!=de._validate&&de._validate(),he=oe.zpp_inner.y==pe}else he=!1;if(!he){oe.zpp_inner.x=le,oe.zpp_inner.y=pe;var me=oe.zpp_inner;null!=me._invalidate&&me._invalidate(me)}}return oe.zpp_inner.weak=!1,t.geom.ZPP_ConvexRayResult.getRay(oe,F,!0,i.outer)}return null}return null},t.geom.ZPP_Ray.prototype.circlesect2=function(i,r,o){if(i.zip_worldCOM&&null!=i.body){if(i.zip_worldCOM=!1,i.zip_localCOM){if(i.zip_localCOM=!1,1==i.type){var a=i.polygon;if(null==a.lverts.next)throw new n._Boot.HaxeError("Error: An empty polygon has no meaningful localCOM");if(null==a.lverts.next.next)a.localCOMx=a.lverts.next.x,a.localCOMy=a.lverts.next.y;else if(null==a.lverts.next.next.next)a.localCOMx=a.lverts.next.x,a.localCOMy=a.lverts.next.y,a.localCOMx+=1*a.lverts.next.next.x,a.localCOMy+=1*a.lverts.next.next.y,a.localCOMx*=.5,a.localCOMy*=.5;else{a.localCOMx=0,a.localCOMy=0;var s=0,l=a.lverts.next,p=l,u=l=l.next;for(l=l.next;null!=l;){var h=l;s+=u.x*(h.y-p.y);var c=h.y*u.x-h.x*u.y;a.localCOMx+=(u.x+h.x)*c,a.localCOMy+=(u.y+h.y)*c,p=u,u=h,l=l.next}var _=l=a.lverts.next;s+=u.x*(_.y-p.y);var d=_.y*u.x-_.x*u.y;a.localCOMx+=(u.x+_.x)*d,a.localCOMy+=(u.y+_.y)*d,p=u,u=_;var m=l=l.next;s+=u.x*(m.y-p.y);var P=m.y*u.x-m.x*u.y;a.localCOMx+=(u.x+m.x)*P,a.localCOMy+=(u.y+m.y)*P;var f=s=1/(3*s);a.localCOMx*=f,a.localCOMy*=f}}null!=i.wrap_localCOM&&(i.wrap_localCOM.zpp_inner.x=i.localCOMx,i.wrap_localCOM.zpp_inner.y=i.localCOMy)}var x=i.body;x.zip_axis&&(x.zip_axis=!1,x.axisx=Math.sin(x.rot),x.axisy=Math.cos(x.rot)),i.worldCOMx=i.body.posx+(i.body.axisy*i.localCOMx-i.body.axisx*i.localCOMy),i.worldCOMy=i.body.posy+(i.localCOMx*i.body.axisx+i.localCOMy*i.body.axisy)}var y,v;y=this.originx-i.worldCOMx,v=this.originy-i.worldCOMy;var g=this.dirx*this.dirx+this.diry*this.diry,b=2*(y*this.dirx+v*this.diry),z=y*y+v*v-i.radius*i.radius,w=b*b-4*g*z;if(0==w){var Z=-b/2*g;if((!r||z>0)&&Z>0&&Z<=this.maxdist){var E=0,M=0;E=this.originx,M=this.originy;var S=Z;E+=this.dirx*S,M+=this.diry*S;var C=(E-=1*i.worldCOMx)*E+(M-=1*i.worldCOMy)*M,N=1/Math.sqrt(C);E*=N,M*=N,z<=0&&(E=-E,M=-M);var A,L=E,B=M;if(null==B&&(B=0),null==L&&(L=0),L!=L||B!=B)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null==t.util.ZPP_PubPool.poolVec2?A=new e.geom.Vec2:(A=t.util.ZPP_PubPool.poolVec2,t.util.ZPP_PubPool.poolVec2=A.zpp_pool,A.zpp_pool=null,A.zpp_disp=!1,A==t.util.ZPP_PubPool.nextVec2&&(t.util.ZPP_PubPool.nextVec2=null)),null==A.zpp_inner){var T;null==t.geom.ZPP_Vec2.zpp_pool?T=new t.geom.ZPP_Vec2:(T=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=T.next,T.next=null),T.weak=!1,T._immutable=!1,T.x=L,T.y=B,A.zpp_inner=T,A.zpp_inner.outer=A}else{if(null!=A&&A.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var V,k=A.zpp_inner;if(k._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=k._isimmutable&&k._isimmutable(),L!=L||B!=B)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null!=A&&A.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var I=A.zpp_inner;if(null!=I._validate&&I._validate(),A.zpp_inner.x==L){if(null!=A&&A.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var O=A.zpp_inner;null!=O._validate&&O._validate(),V=A.zpp_inner.y==B}else V=!1;if(!V){A.zpp_inner.x=L,A.zpp_inner.y=B;var R=A.zpp_inner;null!=R._invalidate&&R._invalidate(R)}}A.zpp_inner.weak=!1;for(var H=t.geom.ZPP_ConvexRayResult.getRay(A,Z,z<=0,i.outer),F=null,D=o.zpp_inner.inner.head;null!=D;){var G=D.elt;if(null!=H.zpp_inner.next)throw new n._Boot.HaxeError("Error: This object has been disposed of and cannot be used");if(null!=G.zpp_inner.next)throw new n._Boot.HaxeError("Error: This object has been disposed of and cannot be used");if(H.zpp_inner.toiDistance<G.zpp_inner.toiDistance)break;F=D,D=D.next}var U,j=o.zpp_inner.inner;null==t.util.ZNPNode_RayResult.zpp_pool?U=new t.util.ZNPNode_RayResult:(U=t.util.ZNPNode_RayResult.zpp_pool,t.util.ZNPNode_RayResult.zpp_pool=U.next,U.next=null),U.elt=H;var W=U;null==F?(W.next=j.head,j.head=W):(W.next=F.next,F.next=W),j.pushmod=j.modified=!0,j.length++}}else{var q=(-b-(w=Math.sqrt(w)))*(g=1/(2*g)),J=(-b+w)*g;if(q>0&&q<=this.maxdist){var $=0,X=0;$=this.originx,X=this.originy;var Y=q;$+=this.dirx*Y,X+=this.diry*Y;var K,Q=($-=1*i.worldCOMx)*$+(X-=1*i.worldCOMy)*X,ee=1/Math.sqrt(Q),te=$*=ee,ne=X*=ee;if(null==ne&&(ne=0),null==te&&(te=0),te!=te||ne!=ne)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null==t.util.ZPP_PubPool.poolVec2?K=new e.geom.Vec2:(K=t.util.ZPP_PubPool.poolVec2,t.util.ZPP_PubPool.poolVec2=K.zpp_pool,K.zpp_pool=null,K.zpp_disp=!1,K==t.util.ZPP_PubPool.nextVec2&&(t.util.ZPP_PubPool.nextVec2=null)),null==K.zpp_inner){var ie;null==t.geom.ZPP_Vec2.zpp_pool?ie=new t.geom.ZPP_Vec2:(ie=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=ie.next,ie.next=null),ie.weak=!1,ie._immutable=!1,ie.x=te,ie.y=ne,K.zpp_inner=ie,K.zpp_inner.outer=K}else{if(null!=K&&K.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var re,oe=K.zpp_inner;if(oe._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=oe._isimmutable&&oe._isimmutable(),te!=te||ne!=ne)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null!=K&&K.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var ae=K.zpp_inner;if(null!=ae._validate&&ae._validate(),K.zpp_inner.x==te){if(null!=K&&K.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var se=K.zpp_inner;null!=se._validate&&se._validate(),re=K.zpp_inner.y==ne}else re=!1;if(!re){K.zpp_inner.x=te,K.zpp_inner.y=ne;var le=K.zpp_inner;null!=le._invalidate&&le._invalidate(le)}}K.zpp_inner.weak=!1;for(var pe=t.geom.ZPP_ConvexRayResult.getRay(K,q,!1,i.outer),ue=null,he=o.zpp_inner.inner.head;null!=he;){var ce=he.elt;if(null!=pe.zpp_inner.next)throw new n._Boot.HaxeError("Error: This object has been disposed of and cannot be used");if(null!=ce.zpp_inner.next)throw new n._Boot.HaxeError("Error: This object has been disposed of and cannot be used");if(pe.zpp_inner.toiDistance<ce.zpp_inner.toiDistance)break;ue=he,he=he.next}var _e,de=o.zpp_inner.inner;null==t.util.ZNPNode_RayResult.zpp_pool?_e=new t.util.ZNPNode_RayResult:(_e=t.util.ZNPNode_RayResult.zpp_pool,t.util.ZNPNode_RayResult.zpp_pool=_e.next,_e.next=null),_e.elt=pe;var me=_e;null==ue?(me.next=de.head,de.head=me):(me.next=ue.next,ue.next=me),de.pushmod=de.modified=!0,de.length++}if(J>0&&J<=this.maxdist&&r){var Pe=0,fe=0;Pe=this.originx,fe=this.originy;var xe=J;Pe+=this.dirx*xe,fe+=this.diry*xe;var ye,ve=(Pe-=1*i.worldCOMx)*Pe+(fe-=1*i.worldCOMy)*fe,ge=1/Math.sqrt(ve),be=Pe=-(Pe*=ge),ze=fe=-(fe*=ge);if(null==ze&&(ze=0),null==be&&(be=0),be!=be||ze!=ze)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null==t.util.ZPP_PubPool.poolVec2?ye=new e.geom.Vec2:(ye=t.util.ZPP_PubPool.poolVec2,t.util.ZPP_PubPool.poolVec2=ye.zpp_pool,ye.zpp_pool=null,ye.zpp_disp=!1,ye==t.util.ZPP_PubPool.nextVec2&&(t.util.ZPP_PubPool.nextVec2=null)),null==ye.zpp_inner){var we;null==t.geom.ZPP_Vec2.zpp_pool?we=new t.geom.ZPP_Vec2:(we=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=we.next,we.next=null),we.weak=!1,we._immutable=!1,we.x=be,we.y=ze,ye.zpp_inner=we,ye.zpp_inner.outer=ye}else{if(null!=ye&&ye.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var Ze,Ee=ye.zpp_inner;if(Ee._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=Ee._isimmutable&&Ee._isimmutable(),be!=be||ze!=ze)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null!=ye&&ye.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var Me=ye.zpp_inner;if(null!=Me._validate&&Me._validate(),ye.zpp_inner.x==be){if(null!=ye&&ye.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var Se=ye.zpp_inner;null!=Se._validate&&Se._validate(),Ze=ye.zpp_inner.y==ze}else Ze=!1;if(!Ze){ye.zpp_inner.x=be,ye.zpp_inner.y=ze;var Ce=ye.zpp_inner;null!=Ce._invalidate&&Ce._invalidate(Ce)}}ye.zpp_inner.weak=!1;for(var Ne=t.geom.ZPP_ConvexRayResult.getRay(ye,J,!0,i.outer),Ae=null,Le=o.zpp_inner.inner.head;null!=Le;){var Be=Le.elt;if(null!=Ne.zpp_inner.next)throw new n._Boot.HaxeError("Error: This object has been disposed of and cannot be used");if(null!=Be.zpp_inner.next)throw new n._Boot.HaxeError("Error: This object has been disposed of and cannot be used");if(Ne.zpp_inner.toiDistance<Be.zpp_inner.toiDistance)break;Ae=Le,Le=Le.next}var Te,Ve=o.zpp_inner.inner;null==t.util.ZNPNode_RayResult.zpp_pool?Te=new t.util.ZNPNode_RayResult:(Te=t.util.ZNPNode_RayResult.zpp_pool,t.util.ZNPNode_RayResult.zpp_pool=Te.next,Te.next=null),Te.elt=Ne;var ke=Te;null==Ae?(ke.next=Ve.head,Ve.head=ke):(ke.next=Ae.next,Ae.next=ke),Ve.pushmod=Ve.modified=!0,Ve.length++}}},t.geom.ZPP_Ray.prototype.polysect=function(i,r,o){for(var a=o,s=null,l=i.edges.head,p=i.gverts.next,u=p,h=p.next;null!=h;){var c=h,_=l.elt;if(r||_.gnormx*this.dirx+_.gnormy*this.diry<0){var d,m,P,f;d=c.x-u.x,m=c.y-u.y,P=u.x-this.originx,f=u.y-this.originy;var x=m*this.dirx-d*this.diry;if(x*x>e.Config.epsilon){var y=(m*P-d*f)*(x=1/x);if(y>0&&y<a&&y<=this.maxdist){var v=(this.diry*P-this.dirx*f)*x;v>-e.Config.epsilon&&v<1+e.Config.epsilon&&(a=y,s=l.elt)}}}l=l.next,p=h,u=c,h=h.next}for(;;){var g=h=i.gverts.next,b=l.elt;if(r||b.gnormx*this.dirx+b.gnormy*this.diry<0){var z,w,Z,E;z=g.x-u.x,w=g.y-u.y,Z=u.x-this.originx,E=u.y-this.originy;var M=w*this.dirx-z*this.diry;if(M*M>e.Config.epsilon){var S=(w*Z-z*E)*(M=1/M);if(S>0&&S<a&&S<=this.maxdist){var C=(this.diry*Z-this.dirx*E)*M;C>-e.Config.epsilon&&C<1+e.Config.epsilon&&(a=S,s=l.elt)}}}l=l.next;break}if(null!=s){var N=0,A=0;N=s.gnormx,A=s.gnormy;var L=N*this.dirx+A*this.diry>0;L&&(N=-N,A=-A);var B,T=N,V=A;if(null==V&&(V=0),null==T&&(T=0),T!=T||V!=V)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null==t.util.ZPP_PubPool.poolVec2?B=new e.geom.Vec2:(B=t.util.ZPP_PubPool.poolVec2,t.util.ZPP_PubPool.poolVec2=B.zpp_pool,B.zpp_pool=null,B.zpp_disp=!1,B==t.util.ZPP_PubPool.nextVec2&&(t.util.ZPP_PubPool.nextVec2=null)),null==B.zpp_inner){var k;null==t.geom.ZPP_Vec2.zpp_pool?k=new t.geom.ZPP_Vec2:(k=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=k.next,k.next=null),k.weak=!1,k._immutable=!1,k.x=T,k.y=V,B.zpp_inner=k,B.zpp_inner.outer=B}else{if(null!=B&&B.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var I,O=B.zpp_inner;if(O._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=O._isimmutable&&O._isimmutable(),T!=T||V!=V)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null!=B&&B.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var R=B.zpp_inner;if(null!=R._validate&&R._validate(),B.zpp_inner.x==T){if(null!=B&&B.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var H=B.zpp_inner;null!=H._validate&&H._validate(),I=B.zpp_inner.y==V}else I=!1;if(!I){B.zpp_inner.x=T,B.zpp_inner.y=V;var F=B.zpp_inner;null!=F._invalidate&&F._invalidate(F)}}return B.zpp_inner.weak=!1,t.geom.ZPP_ConvexRayResult.getRay(B,a,L,i.outer)}return null},t.geom.ZPP_Ray.prototype.polysect2=function(i,r,o){for(var a=1/0,s=-1,l=null,p=null,u=i.edges.head,h=i.gverts.next,c=h,_=h.next;null!=_;){var d=_,m=u.elt;if(r||m.gnormx*this.dirx+m.gnormy*this.diry<0){var P,f,x,y;P=d.x-c.x,f=d.y-c.y,x=c.x-this.originx,y=c.y-this.originy;var v=f*this.dirx-P*this.diry;if(v*v>e.Config.epsilon){var g=(f*x-P*y)*(v=1/v);if(g>0&&g<=this.maxdist&&(g<a||g>s)){var b=(this.diry*x-this.dirx*y)*v;b>-e.Config.epsilon&&b<1+e.Config.epsilon&&(g<a&&(a=g,l=u.elt),g>s&&(s=g,p=u.elt))}}}u=u.next,h=_,c=d,_=_.next}for(;;){var z=_=i.gverts.next,w=u.elt;if(r||w.gnormx*this.dirx+w.gnormy*this.diry<0){var Z,E,M,S;Z=z.x-c.x,E=z.y-c.y,M=c.x-this.originx,S=c.y-this.originy;var C=E*this.dirx-Z*this.diry;if(C*C>e.Config.epsilon){var N=(E*M-Z*S)*(C=1/C);if(N>0&&N<=this.maxdist&&(N<a||N>s)){var A=(this.diry*M-this.dirx*S)*C;A>-e.Config.epsilon&&A<1+e.Config.epsilon&&(N<a&&(a=N,l=u.elt),N>s&&(s=N,p=u.elt))}}}u=u.next;break}if(null!=l){var L=0,B=0;L=l.gnormx,B=l.gnormy;var T=L*this.dirx+B*this.diry>0;T&&(L=-L,B=-B);var V,k=L,I=B;if(null==I&&(I=0),null==k&&(k=0),k!=k||I!=I)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null==t.util.ZPP_PubPool.poolVec2?V=new e.geom.Vec2:(V=t.util.ZPP_PubPool.poolVec2,t.util.ZPP_PubPool.poolVec2=V.zpp_pool,V.zpp_pool=null,V.zpp_disp=!1,V==t.util.ZPP_PubPool.nextVec2&&(t.util.ZPP_PubPool.nextVec2=null)),null==V.zpp_inner){var O;null==t.geom.ZPP_Vec2.zpp_pool?O=new t.geom.ZPP_Vec2:(O=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=O.next,O.next=null),O.weak=!1,O._immutable=!1,O.x=k,O.y=I,V.zpp_inner=O,V.zpp_inner.outer=V}else{if(null!=V&&V.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var R,H=V.zpp_inner;if(H._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=H._isimmutable&&H._isimmutable(),k!=k||I!=I)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null!=V&&V.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var F=V.zpp_inner;if(null!=F._validate&&F._validate(),V.zpp_inner.x==k){if(null!=V&&V.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var D=V.zpp_inner;null!=D._validate&&D._validate(),R=V.zpp_inner.y==I}else R=!1;if(!R){V.zpp_inner.x=k,V.zpp_inner.y=I;var G=V.zpp_inner;null!=G._invalidate&&G._invalidate(G)}}V.zpp_inner.weak=!1;for(var U=t.geom.ZPP_ConvexRayResult.getRay(V,a,T,i.outer),j=null,W=o.zpp_inner.inner.head;null!=W;){var q=W.elt;if(null!=U.zpp_inner.next)throw new n._Boot.HaxeError("Error: This object has been disposed of and cannot be used");if(null!=q.zpp_inner.next)throw new n._Boot.HaxeError("Error: This object has been disposed of and cannot be used");if(U.zpp_inner.toiDistance<q.zpp_inner.toiDistance)break;j=W,W=W.next}var J,$=o.zpp_inner.inner;null==t.util.ZNPNode_RayResult.zpp_pool?J=new t.util.ZNPNode_RayResult:(J=t.util.ZNPNode_RayResult.zpp_pool,t.util.ZNPNode_RayResult.zpp_pool=J.next,J.next=null),J.elt=U;var X=J;null==j?(X.next=$.head,$.head=X):(X.next=j.next,j.next=X),$.pushmod=$.modified=!0,$.length++}if(null!=p&&l!=p){var Y=0,K=0;Y=p.gnormx,K=p.gnormy;var Q=Y*this.dirx+K*this.diry>0;Q&&(Y=-Y,K=-K);var ee,te=Y,ne=K;if(null==ne&&(ne=0),null==te&&(te=0),te!=te||ne!=ne)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null==t.util.ZPP_PubPool.poolVec2?ee=new e.geom.Vec2:(ee=t.util.ZPP_PubPool.poolVec2,t.util.ZPP_PubPool.poolVec2=ee.zpp_pool,ee.zpp_pool=null,ee.zpp_disp=!1,ee==t.util.ZPP_PubPool.nextVec2&&(t.util.ZPP_PubPool.nextVec2=null)),null==ee.zpp_inner){var ie;null==t.geom.ZPP_Vec2.zpp_pool?ie=new t.geom.ZPP_Vec2:(ie=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=ie.next,ie.next=null),ie.weak=!1,ie._immutable=!1,ie.x=te,ie.y=ne,ee.zpp_inner=ie,ee.zpp_inner.outer=ee}else{if(null!=ee&&ee.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var re,oe=ee.zpp_inner;if(oe._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=oe._isimmutable&&oe._isimmutable(),te!=te||ne!=ne)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null!=ee&&ee.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var ae=ee.zpp_inner;if(null!=ae._validate&&ae._validate(),ee.zpp_inner.x==te){if(null!=ee&&ee.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var se=ee.zpp_inner;null!=se._validate&&se._validate(),re=ee.zpp_inner.y==ne}else re=!1;if(!re){ee.zpp_inner.x=te,ee.zpp_inner.y=ne;var le=ee.zpp_inner;null!=le._invalidate&&le._invalidate(le)}}ee.zpp_inner.weak=!1;for(var pe=t.geom.ZPP_ConvexRayResult.getRay(ee,s,Q,i.outer),ue=null,he=o.zpp_inner.inner.head;null!=he;){var ce=he.elt;if(null!=pe.zpp_inner.next)throw new n._Boot.HaxeError("Error: This object has been disposed of and cannot be used");if(null!=ce.zpp_inner.next)throw new n._Boot.HaxeError("Error: This object has been disposed of and cannot be used");if(pe.zpp_inner.toiDistance<ce.zpp_inner.toiDistance)break;ue=he,he=he.next}var _e,de=o.zpp_inner.inner;null==t.util.ZNPNode_RayResult.zpp_pool?_e=new t.util.ZNPNode_RayResult:(_e=t.util.ZNPNode_RayResult.zpp_pool,t.util.ZNPNode_RayResult.zpp_pool=_e.next,_e.next=null),_e.elt=pe;var me=_e;null==ue?(me.next=de.head,de.head=me):(me.next=ue.next,ue.next=me),de.pushmod=de.modified=!0,de.length++}},t.geom.ZPP_Ray.prototype.__class__=t.geom.ZPP_Ray,t.geom.ZPP_SimpleVert=l["zpp_nape.geom.ZPP_SimpleVert"]=function(){this.node=null,this.next=null,this.id=0,this.links=null,this.y=0,this.x=0,this.forced=!1,this.id=t.ZPP_ID.ZPP_SimpleVert(),null==t.util.ZPP_Set_ZPP_SimpleVert.zpp_pool?this.links=new t.util.ZPP_Set_ZPP_SimpleVert:(this.links=t.util.ZPP_Set_ZPP_SimpleVert.zpp_pool,t.util.ZPP_Set_ZPP_SimpleVert.zpp_pool=this.links.next,this.links.next=null),this.links.lt=t.geom.ZPP_SimpleVert.less_xy},t.geom.ZPP_SimpleVert.__name__=["zpp_nape","geom","ZPP_SimpleVert"],t.geom.ZPP_SimpleVert.less_xy=function(e,t){return e.y<t.y||e.y==t.y&&e.x<t.x},t.geom.ZPP_SimpleVert.swap_nodes=function(e,t){var n=e.node;e.node=t.node,t.node=n},t.geom.ZPP_SimpleVert.get=function(e,n){var i;return null==t.geom.ZPP_SimpleVert.zpp_pool?i=new t.geom.ZPP_SimpleVert:(i=t.geom.ZPP_SimpleVert.zpp_pool,t.geom.ZPP_SimpleVert.zpp_pool=i.next,i.next=null),i.x=e,i.y=n,i},t.geom.ZPP_SimpleVert.prototype.forced=null,t.geom.ZPP_SimpleVert.prototype.x=null,t.geom.ZPP_SimpleVert.prototype.y=null,t.geom.ZPP_SimpleVert.prototype.links=null,t.geom.ZPP_SimpleVert.prototype.id=null,t.geom.ZPP_SimpleVert.prototype.next=null,t.geom.ZPP_SimpleVert.prototype.node=null,t.geom.ZPP_SimpleVert.prototype.free=function(){this.links.clear(),this.node=null,this.forced=!1},t.geom.ZPP_SimpleVert.prototype.alloc=function(){},t.geom.ZPP_SimpleVert.prototype.__class__=t.geom.ZPP_SimpleVert,t.geom.ZPP_SimpleSeg=l["zpp_nape.geom.ZPP_SimpleSeg"]=function(){this.node=null,this.prev=null,this.next=null,this.id=0,this.vertices=null,this.right=null,this.left=null,this.id=t.ZPP_ID.ZPP_SimpleSeg(),null==t.util.ZPP_Set_ZPP_SimpleVert.zpp_pool?this.vertices=new t.util.ZPP_Set_ZPP_SimpleVert:(this.vertices=t.util.ZPP_Set_ZPP_SimpleVert.zpp_pool,t.util.ZPP_Set_ZPP_SimpleVert.zpp_pool=this.vertices.next,this.vertices.next=null),this.vertices.lt=p(this,this.less_xy)},t.geom.ZPP_SimpleSeg.__name__=["zpp_nape","geom","ZPP_SimpleSeg"],t.geom.ZPP_SimpleSeg.get=function(e,n){var i;return null==t.geom.ZPP_SimpleSeg.zpp_pool?i=new t.geom.ZPP_SimpleSeg:(i=t.geom.ZPP_SimpleSeg.zpp_pool,t.geom.ZPP_SimpleSeg.zpp_pool=i.next,i.next=null),i.left=e,i.right=n,i.vertices.insert(e),i.vertices.insert(n),i},t.geom.ZPP_SimpleSeg.prototype.left=null,t.geom.ZPP_SimpleSeg.prototype.right=null,t.geom.ZPP_SimpleSeg.prototype.vertices=null,t.geom.ZPP_SimpleSeg.prototype.id=null,t.geom.ZPP_SimpleSeg.prototype.next=null,t.geom.ZPP_SimpleSeg.prototype.free=function(){this.left=this.right=null,this.prev=null,this.node=null,this.vertices.clear()},t.geom.ZPP_SimpleSeg.prototype.alloc=function(){},t.geom.ZPP_SimpleSeg.prototype.prev=null,t.geom.ZPP_SimpleSeg.prototype.node=null,t.geom.ZPP_SimpleSeg.prototype.less_xy=function(e,t){return e.x<t.x||e.x==t.x&&e.y<t.y},t.geom.ZPP_SimpleSeg.prototype.__class__=t.geom.ZPP_SimpleSeg,t.geom.ZPP_SimpleEvent=l["zpp_nape.geom.ZPP_SimpleEvent"]=function(){this.next=null,this.node=null,this.segment2=null,this.segment=null,this.vertex=null,this.type=0},t.geom.ZPP_SimpleEvent.__name__=["zpp_nape","geom","ZPP_SimpleEvent"],t.geom.ZPP_SimpleEvent.swap_nodes=function(e,t){var n=e.node;e.node=t.node,t.node=n},t.geom.ZPP_SimpleEvent.less_xy=function(e,t){return e.vertex.x<t.vertex.x||!(e.vertex.x>t.vertex.x)&&(e.vertex.y<t.vertex.y||!(e.vertex.y>t.vertex.y)&&e.type<t.type)},t.geom.ZPP_SimpleEvent.get=function(e){var n;return null==t.geom.ZPP_SimpleEvent.zpp_pool?n=new t.geom.ZPP_SimpleEvent:(n=t.geom.ZPP_SimpleEvent.zpp_pool,t.geom.ZPP_SimpleEvent.zpp_pool=n.next,n.next=null),n.vertex=e,n},t.geom.ZPP_SimpleEvent.prototype.type=null,t.geom.ZPP_SimpleEvent.prototype.vertex=null,t.geom.ZPP_SimpleEvent.prototype.segment=null,t.geom.ZPP_SimpleEvent.prototype.segment2=null,t.geom.ZPP_SimpleEvent.prototype.node=null,t.geom.ZPP_SimpleEvent.prototype.next=null,t.geom.ZPP_SimpleEvent.prototype.free=function(){this.vertex=null,this.segment=this.segment2=null,this.node=null},t.geom.ZPP_SimpleEvent.prototype.alloc=function(){},t.geom.ZPP_SimpleEvent.prototype.__class__=t.geom.ZPP_SimpleEvent,t.geom.ZPP_SimpleSweep=l["zpp_nape.geom.ZPP_SimpleSweep"]=function(){this.tree=null,this.sweepx=0,null==t.util.ZPP_Set_ZPP_SimpleSeg.zpp_pool?this.tree=new t.util.ZPP_Set_ZPP_SimpleSeg:(this.tree=t.util.ZPP_Set_ZPP_SimpleSeg.zpp_pool,t.util.ZPP_Set_ZPP_SimpleSeg.zpp_pool=this.tree.next,this.tree.next=null),this.tree.lt=p(this,this.edge_lt),this.tree.swapped=p(this,this.swap_nodes)},t.geom.ZPP_SimpleSweep.__name__=["zpp_nape","geom","ZPP_SimpleSweep"],t.geom.ZPP_SimpleSweep.prototype.sweepx=null,t.geom.ZPP_SimpleSweep.prototype.tree=null,t.geom.ZPP_SimpleSweep.prototype.swap_nodes=function(e,t){var n=e.node;e.node=t.node,t.node=n},t.geom.ZPP_SimpleSweep.prototype.edge_lt=function(e,t){var n,i,r=0,o=0,a=0,s=0;if(e.left==t.left&&e.right==t.right)return!1;if(e.left==t.right)return e.left.x==e.right.x?e.left.y<e.right.y?e.left.y>t.left.y:e.right.y>t.left.y:(n=e.right.x<e.left.x,r=e.right.x-e.left.x,o=e.right.y-e.left.y,a=t.left.x-e.left.x,s=t.left.y-e.left.y,(n?o*a-r*s:s*r-a*o)<0);if(e.right==t.left)return t.left.x==t.right.x?i=t.left.y<t.right.y?t.left.y>e.left.y:t.right.y>e.left.y:(n=t.right.x<t.left.x,r=t.right.x-t.left.x,o=t.right.y-t.left.y,a=e.left.x-t.left.x,s=e.left.y-t.left.y,i=(n?o*a-r*s:s*r-a*o)<0),!i;if(e.left==t.left)return e.left.x==e.right.x?e.left.y<e.right.y?e.left.y>t.right.y:e.right.y>t.right.y:(n=e.right.x<e.left.x,r=e.right.x-e.left.x,o=e.right.y-e.left.y,a=t.right.x-e.left.x,s=t.right.y-e.left.y,(n?o*a-r*s:s*r-a*o)<0);if(e.right==t.right)return e.left.x==e.right.x?e.left.y<e.right.y?e.left.y>t.left.y:e.right.y>t.left.y:(n=e.right.x<e.left.x,r=e.right.x-e.left.x,o=e.right.y-e.left.y,a=t.left.x-e.left.x,s=t.left.y-e.left.y,(n?o*a-r*s:s*r-a*o)<0);if(e.left.x==e.right.x){if(t.left.x==t.right.x){var l=e.left.y<e.right.y?e.right:e.left,p=t.left.y<t.right.y?t.right:t.left;return l.y>p.y}n=t.right.x<t.left.x,r=t.right.x-t.left.x,o=t.right.y-t.left.y,a=e.left.x-t.left.x,s=e.left.y-t.left.y;var u=n?o*a-r*s:s*r-a*o;return n=t.right.x<t.left.x,r=t.right.x-t.left.x,o=t.right.y-t.left.y,a=e.right.x-t.left.x,s=e.right.y-t.left.y,u*(n?o*a-r*s:s*r-a*o)>=0?u>=0:this.sweepx>=e.left.x}if(t.left.x==t.right.x){n=e.right.x<e.left.x,r=e.right.x-e.left.x,o=e.right.y-e.left.y,a=t.left.x-e.left.x,s=t.left.y-e.left.y;var h=n?o*a-r*s:s*r-a*o;return n=e.right.x<e.left.x,r=e.right.x-e.left.x,o=e.right.y-e.left.y,a=t.right.x-e.left.x,s=t.right.y-e.left.y,h*(n?o*a-r*s:s*r-a*o)>=0?h<0:this.sweepx<t.left.x}n=e.right.x<e.left.x,r=e.right.x-e.left.x,o=e.right.y-e.left.y,a=t.left.x-e.left.x,s=t.left.y-e.left.y;var c=(n?o*a-r*s:s*r-a*o)<0;if(n=e.right.x<e.left.x,r=e.right.x-e.left.x,o=e.right.y-e.left.y,a=t.right.x-e.left.x,s=t.right.y-e.left.y,c==(n?o*a-r*s:s*r-a*o)<0)return c;n=t.right.x<t.left.x,r=t.right.x-t.left.x,o=t.right.y-t.left.y,a=e.left.x-t.left.x,s=e.left.y-t.left.y;var _=(n?o*a-r*s:s*r-a*o)>=0;return n=t.right.x<t.left.x,r=t.right.x-t.left.x,o=t.right.y-t.left.y,a=e.right.x-t.left.x,s=e.right.y-t.left.y,_==(n?o*a-r*s:s*r-a*o)>=0?_:(this.sweepx-e.left.x)/(e.right.x-e.left.x)*(e.right.y-e.left.y)+e.left.y>(this.sweepx-t.left.x)/(t.right.x-t.left.x)*(t.right.y-t.left.y)+t.left.y},t.geom.ZPP_SimpleSweep.prototype.clear=function(){this.tree.clear()},t.geom.ZPP_SimpleSweep.prototype.add=function(e){e.node=this.tree.insert(e);var t=this.tree.successor_node(e.node),n=this.tree.predecessor_node(e.node);return null!=t&&(e.next=t.data,t.data.prev=e),null!=n&&(e.prev=n.data,n.data.next=e),e},t.geom.ZPP_SimpleSweep.prototype.remove=function(e){var t=this.tree.successor_node(e.node),n=this.tree.predecessor_node(e.node);null!=t&&(t.data.prev=e.prev),null!=n&&(n.data.next=e.next),this.tree.remove_node(e.node),e.node=null},t.geom.ZPP_SimpleSweep.prototype.intersect=function(e,t){return!(null==e||null==t||e.left==t.left||e.left==t.right||e.right==t.left||e.right==t.right||((t.left.x-e.left.x)*(e.right.y-e.left.y)-(e.right.x-e.left.x)*(t.left.y-e.left.y))*((t.right.x-e.left.x)*(e.right.y-e.left.y)-(e.right.x-e.left.x)*(t.right.y-e.left.y))>0||((e.left.x-t.left.x)*(t.right.y-t.left.y)-(t.right.x-t.left.x)*(e.left.y-t.left.y))*((e.right.x-t.left.x)*(t.right.y-t.left.y)-(t.right.x-t.left.x)*(e.right.y-t.left.y))>0)},t.geom.ZPP_SimpleSweep.prototype.intersection=function(e,i){if(null==e||null==i)return null;if(e.left==i.left||e.left==i.right||e.right==i.left||e.right==i.right)return null;var r,o,a,s;r=e.right.x-e.left.x,o=e.right.y-e.left.y,a=i.right.x-i.left.x;var l=(s=i.right.y-i.left.y)*r-a*o;if(0==l)return null;l=1/l;var p,u,h=(s*(p=i.left.x-e.left.x)-a*(u=i.left.y-e.left.y))*l;if(h<0||h>1)return null;var c,_,d=(o*p-r*u)*l;if(d<0||d>1)return null;if(0==d||1==d||0==h||1==h){var m=0==d;if(1==d&&m)throw new n._Boot.HaxeError("corner case 1a");if(1==d&&(m=!0),0==h&&m)throw new n._Boot.HaxeError("corner case 1b");if(0==h&&(m=!0),1==h&&m)throw new n._Boot.HaxeError("corner case 1c");c=0==d?i.left:1==d?i.right:0==h?e.left:e.right}else{var P,f=.5*(e.left.x+r*h+i.left.x+a*d),x=.5*(e.left.y+o*h+i.left.y+s*d);null==t.geom.ZPP_SimpleVert.zpp_pool?P=new t.geom.ZPP_SimpleVert:(P=t.geom.ZPP_SimpleVert.zpp_pool,t.geom.ZPP_SimpleVert.zpp_pool=P.next,P.next=null),P.x=f,P.y=x,c=P}null==t.geom.ZPP_SimpleEvent.zpp_pool?_=new t.geom.ZPP_SimpleEvent:(_=t.geom.ZPP_SimpleEvent.zpp_pool,t.geom.ZPP_SimpleEvent.zpp_pool=_.next,_.next=null),_.vertex=c;var y=_;return y.type=0,y.segment=e,y.segment2=i,y},t.geom.ZPP_SimpleSweep.prototype.__class__=t.geom.ZPP_SimpleSweep,t.geom.ZPP_Simple=l["zpp_nape.geom.ZPP_Simple"]=function(){},t.geom.ZPP_Simple.__name__=["zpp_nape","geom","ZPP_Simple"],t.geom.ZPP_Simple.decompose=function(e,i){null==t.geom.ZPP_Simple.sweep&&(t.geom.ZPP_Simple.sweep=new t.geom.ZPP_SimpleSweep,t.geom.ZPP_Simple.inthash=new t.util.FastHash2_Hashable2_Boolfalse),null==t.geom.ZPP_Simple.vertices&&(null==t.util.ZPP_Set_ZPP_SimpleVert.zpp_pool?t.geom.ZPP_Simple.vertices=new t.util.ZPP_Set_ZPP_SimpleVert:(t.geom.ZPP_Simple.vertices=t.util.ZPP_Set_ZPP_SimpleVert.zpp_pool,t.util.ZPP_Set_ZPP_SimpleVert.zpp_pool=t.geom.ZPP_Simple.vertices.next,t.geom.ZPP_Simple.vertices.next=null),t.geom.ZPP_Simple.vertices.lt=t.geom.ZPP_SimpleVert.less_xy,t.geom.ZPP_Simple.vertices.swapped=t.geom.ZPP_SimpleVert.swap_nodes),null==t.geom.ZPP_Simple.queue&&(null==t.util.ZPP_Set_ZPP_SimpleEvent.zpp_pool?t.geom.ZPP_Simple.queue=new t.util.ZPP_Set_ZPP_SimpleEvent:(t.geom.ZPP_Simple.queue=t.util.ZPP_Set_ZPP_SimpleEvent.zpp_pool,t.util.ZPP_Set_ZPP_SimpleEvent.zpp_pool=t.geom.ZPP_Simple.queue.next,t.geom.ZPP_Simple.queue.next=null),t.geom.ZPP_Simple.queue.lt=t.geom.ZPP_SimpleEvent.less_xy,t.geom.ZPP_Simple.queue.swapped=t.geom.ZPP_SimpleEvent.swap_nodes);var r,o=null,a=null,s=e;if(null!=e)for(var l=e;;){var p,u=l,h=u.x,c=u.y;null==t.geom.ZPP_SimpleVert.zpp_pool?p=new t.geom.ZPP_SimpleVert:(p=t.geom.ZPP_SimpleVert.zpp_pool,t.geom.ZPP_SimpleVert.zpp_pool=p.next,p.next=null),p.x=h,p.y=c;for(var _=p,d=t.geom.ZPP_Simple.vertices.parent;null!=d;)if(t.geom.ZPP_Simple.vertices.lt(_,d.data))d=d.prev;else{if(!t.geom.ZPP_Simple.vertices.lt(d.data,_))break;d=d.next}var m=d;if(null!=m){var P=_;P.links.clear(),P.node=null,P.forced=!1,P.next=t.geom.ZPP_SimpleVert.zpp_pool,t.geom.ZPP_SimpleVert.zpp_pool=P,_=m.data}else _.node=t.geom.ZPP_Simple.vertices.insert(_);if(null!=a){var f;null==t.geom.ZPP_SimpleEvent.zpp_pool?f=new t.geom.ZPP_SimpleEvent:(f=t.geom.ZPP_SimpleEvent.zpp_pool,t.geom.ZPP_SimpleEvent.zpp_pool=f.next,f.next=null),f.vertex=a;var x,y=f;null==t.geom.ZPP_SimpleEvent.zpp_pool?x=new t.geom.ZPP_SimpleEvent:(x=t.geom.ZPP_SimpleEvent.zpp_pool,t.geom.ZPP_SimpleEvent.zpp_pool=x.next,x.next=null),x.vertex=_;var v,g=x;t.geom.ZPP_SimpleEvent.less_xy(y,g)?(y.type=1,g.type=2,v=t.geom.ZPP_SimpleSeg.get(a,_)):(y.type=2,g.type=1,v=t.geom.ZPP_SimpleSeg.get(_,a)),y.segment=g.segment=v,t.geom.ZPP_Simple.queue.insert(y),t.geom.ZPP_Simple.queue.insert(g),a.links.insert(_),_.links.insert(a)}if(a=_,null==o&&(o=_),(l=l.next)==s)break}null==t.geom.ZPP_SimpleEvent.zpp_pool?r=new t.geom.ZPP_SimpleEvent:(r=t.geom.ZPP_SimpleEvent.zpp_pool,t.geom.ZPP_SimpleEvent.zpp_pool=r.next,r.next=null),r.vertex=a;var b,z=r;null==t.geom.ZPP_SimpleEvent.zpp_pool?b=new t.geom.ZPP_SimpleEvent:(b=t.geom.ZPP_SimpleEvent.zpp_pool,t.geom.ZPP_SimpleEvent.zpp_pool=b.next,b.next=null),b.vertex=o;var w,Z=b;for(t.geom.ZPP_SimpleEvent.less_xy(z,Z)?(z.type=1,Z.type=2,w=t.geom.ZPP_SimpleSeg.get(a,o)):(z.type=2,Z.type=1,w=t.geom.ZPP_SimpleSeg.get(o,a)),z.segment=Z.segment=w,t.geom.ZPP_Simple.queue.insert(z),t.geom.ZPP_Simple.queue.insert(Z),a.links.insert(o),o.links.insert(a),null==t.geom.ZPP_Simple.ints&&(null==t.util.ZPP_Set_ZPP_SimpleEvent.zpp_pool?t.geom.ZPP_Simple.ints=new t.util.ZPP_Set_ZPP_SimpleEvent:(t.geom.ZPP_Simple.ints=t.util.ZPP_Set_ZPP_SimpleEvent.zpp_pool,t.util.ZPP_Set_ZPP_SimpleEvent.zpp_pool=t.geom.ZPP_Simple.ints.next,t.geom.ZPP_Simple.ints.next=null),t.geom.ZPP_Simple.ints.lt=t.geom.ZPP_SimpleEvent.less_xy);!t.geom.ZPP_Simple.queue.empty();){var E=t.geom.ZPP_Simple.queue.pop_front();if(t.geom.ZPP_Simple.sweep.sweepx=E.vertex.x,1==E.type){var M=E.segment;if(t.geom.ZPP_Simple.sweep.add(M),null!=M.next&&null!=M&&!(M.next.id<M.id?t.geom.ZPP_Simple.inthash.has(M.next.id,M.id):t.geom.ZPP_Simple.inthash.has(M.id,M.next.id))){var S=t.geom.ZPP_Simple.sweep.intersection(M.next,M);if(null!=S)if(S.vertex.x>=t.geom.ZPP_Simple.sweep.sweepx){for(var C=t.geom.ZPP_Simple.queue.parent;null!=C;)if(t.geom.ZPP_Simple.queue.lt(S,C.data))C=C.prev;else{if(!t.geom.ZPP_Simple.queue.lt(C.data,S))break;C=C.next}var N=C;if(null==N){for(var A=t.geom.ZPP_Simple.ints.parent;null!=A;)if(t.geom.ZPP_Simple.ints.lt(S,A.data))A=A.prev;else{if(!t.geom.ZPP_Simple.ints.lt(A.data,S))break;A=A.next}var L=A;if(null!=L){var B=S.vertex;B.links.clear(),B.node=null,B.forced=!1,B.next=t.geom.ZPP_SimpleVert.zpp_pool,t.geom.ZPP_SimpleVert.zpp_pool=B,S.vertex=L.data.vertex,L.data=S,t.geom.ZPP_Simple.queue.insert(S)}else t.geom.ZPP_Simple.queue.insert(S),t.geom.ZPP_Simple.ints.insert(S);if(M.next.id<M.id){var T,V=t.geom.ZPP_Simple.inthash,k=M.next.id,I=M.id;null==t.util.Hashable2_Boolfalse.zpp_pool?T=new t.util.Hashable2_Boolfalse:(T=t.util.Hashable2_Boolfalse.zpp_pool,t.util.Hashable2_Boolfalse.zpp_pool=T.next,T.next=null),T.id=k,T.di=I;var O=T;O.value=!0,V.add(O)}else{var R,H=t.geom.ZPP_Simple.inthash,F=M.id,D=M.next.id;null==t.util.Hashable2_Boolfalse.zpp_pool?R=new t.util.Hashable2_Boolfalse:(R=t.util.Hashable2_Boolfalse.zpp_pool,t.util.Hashable2_Boolfalse.zpp_pool=R.next,R.next=null),R.id=F,R.di=D;var G=R;G.value=!0,H.add(G)}}else{var U=N.data;if(U.segment!=S.segment||S.segment2!=U.segment2)throw new n._Boot.HaxeError("corner case 2, shiiiit.");var j=S.vertex;j.links.clear(),j.node=null,j.forced=!1,j.next=t.geom.ZPP_SimpleVert.zpp_pool,t.geom.ZPP_SimpleVert.zpp_pool=j;var W=S;W.vertex=null,W.segment=W.segment2=null,W.node=null,W.next=t.geom.ZPP_SimpleEvent.zpp_pool,t.geom.ZPP_SimpleEvent.zpp_pool=W}}else{var q=S.vertex;q.links.clear(),q.node=null,q.forced=!1,q.next=t.geom.ZPP_SimpleVert.zpp_pool,t.geom.ZPP_SimpleVert.zpp_pool=q;var J=S;J.vertex=null,J.segment=J.segment2=null,J.node=null,J.next=t.geom.ZPP_SimpleEvent.zpp_pool,t.geom.ZPP_SimpleEvent.zpp_pool=J}}if(null!=M&&null!=M.prev&&!(M.id<M.prev.id?t.geom.ZPP_Simple.inthash.has(M.id,M.prev.id):t.geom.ZPP_Simple.inthash.has(M.prev.id,M.id))){var $=t.geom.ZPP_Simple.sweep.intersection(M,M.prev);if(null!=$)if($.vertex.x>=t.geom.ZPP_Simple.sweep.sweepx){for(var X=t.geom.ZPP_Simple.queue.parent;null!=X;)if(t.geom.ZPP_Simple.queue.lt($,X.data))X=X.prev;else{if(!t.geom.ZPP_Simple.queue.lt(X.data,$))break;X=X.next}var Y=X;if(null==Y){for(var K=t.geom.ZPP_Simple.ints.parent;null!=K;)if(t.geom.ZPP_Simple.ints.lt($,K.data))K=K.prev;else{if(!t.geom.ZPP_Simple.ints.lt(K.data,$))break;K=K.next}var Q=K;if(null!=Q){var ee=$.vertex;ee.links.clear(),ee.node=null,ee.forced=!1,ee.next=t.geom.ZPP_SimpleVert.zpp_pool,t.geom.ZPP_SimpleVert.zpp_pool=ee,$.vertex=Q.data.vertex,Q.data=$,t.geom.ZPP_Simple.queue.insert($)}else t.geom.ZPP_Simple.queue.insert($),t.geom.ZPP_Simple.ints.insert($);if(M.id<M.prev.id){var te,ne=t.geom.ZPP_Simple.inthash,ie=M.id,re=M.prev.id;null==t.util.Hashable2_Boolfalse.zpp_pool?te=new t.util.Hashable2_Boolfalse:(te=t.util.Hashable2_Boolfalse.zpp_pool,t.util.Hashable2_Boolfalse.zpp_pool=te.next,te.next=null),te.id=ie,te.di=re;var oe=te;oe.value=!0,ne.add(oe)}else{var ae,se=t.geom.ZPP_Simple.inthash,le=M.prev.id,pe=M.id;null==t.util.Hashable2_Boolfalse.zpp_pool?ae=new t.util.Hashable2_Boolfalse:(ae=t.util.Hashable2_Boolfalse.zpp_pool,t.util.Hashable2_Boolfalse.zpp_pool=ae.next,ae.next=null),ae.id=le,ae.di=pe;var ue=ae;ue.value=!0,se.add(ue)}}else{var he=Y.data;if(he.segment!=$.segment||$.segment2!=he.segment2)throw new n._Boot.HaxeError("corner case 2, shiiiit.");var ce=$.vertex;ce.links.clear(),ce.node=null,ce.forced=!1,ce.next=t.geom.ZPP_SimpleVert.zpp_pool,t.geom.ZPP_SimpleVert.zpp_pool=ce;var _e=$;_e.vertex=null,_e.segment=_e.segment2=null,_e.node=null,_e.next=t.geom.ZPP_SimpleEvent.zpp_pool,t.geom.ZPP_SimpleEvent.zpp_pool=_e}}else{var de=$.vertex;de.links.clear(),de.node=null,de.forced=!1,de.next=t.geom.ZPP_SimpleVert.zpp_pool,t.geom.ZPP_SimpleVert.zpp_pool=de;var me=$;me.vertex=null,me.segment=me.segment2=null,me.node=null,me.next=t.geom.ZPP_SimpleEvent.zpp_pool,t.geom.ZPP_SimpleEvent.zpp_pool=me}}}else if(2==E.type){var Pe=E.segment;if(null!=Pe.node){var fe=Pe.next,xe=Pe.prev;t.geom.ZPP_Simple.sweep.remove(Pe);var ye=Pe;if(ye.left=ye.right=null,ye.prev=null,ye.node=null,ye.vertices.clear(),ye.next=t.geom.ZPP_SimpleSeg.zpp_pool,t.geom.ZPP_SimpleSeg.zpp_pool=ye,null!=fe&&null!=xe&&!(fe.id<xe.id?t.geom.ZPP_Simple.inthash.has(fe.id,xe.id):t.geom.ZPP_Simple.inthash.has(xe.id,fe.id))){var ve=t.geom.ZPP_Simple.sweep.intersection(fe,xe);if(null!=ve)if(ve.vertex.x>=t.geom.ZPP_Simple.sweep.sweepx){for(var ge=t.geom.ZPP_Simple.queue.parent;null!=ge;)if(t.geom.ZPP_Simple.queue.lt(ve,ge.data))ge=ge.prev;else{if(!t.geom.ZPP_Simple.queue.lt(ge.data,ve))break;ge=ge.next}var be=ge;if(null==be){for(var ze=t.geom.ZPP_Simple.ints.parent;null!=ze;)if(t.geom.ZPP_Simple.ints.lt(ve,ze.data))ze=ze.prev;else{if(!t.geom.ZPP_Simple.ints.lt(ze.data,ve))break;ze=ze.next}var we=ze;if(null!=we){var Ze=ve.vertex;Ze.links.clear(),Ze.node=null,Ze.forced=!1,Ze.next=t.geom.ZPP_SimpleVert.zpp_pool,t.geom.ZPP_SimpleVert.zpp_pool=Ze,ve.vertex=we.data.vertex,we.data=ve,t.geom.ZPP_Simple.queue.insert(ve)}else t.geom.ZPP_Simple.queue.insert(ve),t.geom.ZPP_Simple.ints.insert(ve);if(fe.id<xe.id){var Ee,Me=t.geom.ZPP_Simple.inthash,Se=fe.id,Ce=xe.id;null==t.util.Hashable2_Boolfalse.zpp_pool?Ee=new t.util.Hashable2_Boolfalse:(Ee=t.util.Hashable2_Boolfalse.zpp_pool,t.util.Hashable2_Boolfalse.zpp_pool=Ee.next,Ee.next=null),Ee.id=Se,Ee.di=Ce;var Ne=Ee;Ne.value=!0,Me.add(Ne)}else{var Ae,Le=t.geom.ZPP_Simple.inthash,Be=xe.id,Te=fe.id;null==t.util.Hashable2_Boolfalse.zpp_pool?Ae=new t.util.Hashable2_Boolfalse:(Ae=t.util.Hashable2_Boolfalse.zpp_pool,t.util.Hashable2_Boolfalse.zpp_pool=Ae.next,Ae.next=null),Ae.id=Be,Ae.di=Te;var Ve=Ae;Ve.value=!0,Le.add(Ve)}}else{var ke=be.data;if(ke.segment!=ve.segment||ve.segment2!=ke.segment2)throw new n._Boot.HaxeError("corner case 2, shiiiit.");var Ie=ve.vertex;Ie.links.clear(),Ie.node=null,Ie.forced=!1,Ie.next=t.geom.ZPP_SimpleVert.zpp_pool,t.geom.ZPP_SimpleVert.zpp_pool=Ie;var Oe=ve;Oe.vertex=null,Oe.segment=Oe.segment2=null,Oe.node=null,Oe.next=t.geom.ZPP_SimpleEvent.zpp_pool,t.geom.ZPP_SimpleEvent.zpp_pool=Oe}}else{var Re=ve.vertex;Re.links.clear(),Re.node=null,Re.forced=!1,Re.next=t.geom.ZPP_SimpleVert.zpp_pool,t.geom.ZPP_SimpleVert.zpp_pool=Re;var He=ve;He.vertex=null,He.segment=He.segment2=null,He.node=null,He.next=t.geom.ZPP_SimpleEvent.zpp_pool,t.geom.ZPP_SimpleEvent.zpp_pool=He}}}}else{var Fe=E.vertex,De=null==Fe.node,Ge=E.segment,Ue=E.segment2;if(Ue.next!=Ge){var je=Ge;Ge=Ue,Ue=je}for(var We=Ge.vertices.parent;null!=We;)if(Ge.vertices.lt(Fe,We.data))We=We.prev;else{if(!Ge.vertices.lt(We.data,Fe))break;We=We.next}for(var qe=null==We,Je=Ue.vertices.parent;null!=Je;)if(Ue.vertices.lt(Fe,Je.data))Je=Je.prev;else{if(!Ue.vertices.lt(Je.data,Fe))break;Je=Je.next}var $e=null==Je;if(qe){var Xe=Ge.vertices.insert(Fe),Ye=Fe==Ge.left?Fe:Ge.vertices.predecessor_node(Xe).data,Ke=Fe==Ge.right?Fe:Ge.vertices.successor_node(Xe).data;Ye.links.remove(Ke),Fe!=Ye&&Ye.links.insert(Fe),Ke.links.remove(Ye),Fe!=Ke&&Ke.links.insert(Fe),Fe!=Ye&&Fe.links.insert(Ye),Fe!=Ke&&Fe.links.insert(Ke)}if($e){var Qe=Ue.vertices.insert(Fe),et=Fe==Ue.left?Fe:Ue.vertices.predecessor_node(Qe).data,tt=Fe==Ue.right?Fe:Ue.vertices.successor_node(Qe).data;et.links.remove(tt),Fe!=et&&et.links.insert(Fe),tt.links.remove(et),Fe!=tt&&tt.links.insert(Fe),Fe!=et&&Fe.links.insert(et),Fe!=tt&&Fe.links.insert(tt)}if(De&&(Fe.node=t.geom.ZPP_Simple.vertices.insert(Fe)),Fe.forced=!0,De){var nt=Ge.node,it=Ue.node;nt.data=Ue,it.data=Ge,Ge.node=it,Ue.node=nt,Ue.next=Ge.next,Ge.next=Ue,Ge.prev=Ue.prev,Ue.prev=Ge,null!=Ge.prev&&(Ge.prev.next=Ge),null!=Ue.next&&(Ue.next.prev=Ue)}if(null!=Ue.next&&null!=Ue&&!(Ue.next.id<Ue.id?t.geom.ZPP_Simple.inthash.has(Ue.next.id,Ue.id):t.geom.ZPP_Simple.inthash.has(Ue.id,Ue.next.id))){var rt=t.geom.ZPP_Simple.sweep.intersection(Ue.next,Ue);if(null!=rt)if(rt.vertex.x>=t.geom.ZPP_Simple.sweep.sweepx){for(var ot=t.geom.ZPP_Simple.queue.parent;null!=ot;)if(t.geom.ZPP_Simple.queue.lt(rt,ot.data))ot=ot.prev;else{if(!t.geom.ZPP_Simple.queue.lt(ot.data,rt))break;ot=ot.next}var at=ot;if(null==at){for(var st=t.geom.ZPP_Simple.ints.parent;null!=st;)if(t.geom.ZPP_Simple.ints.lt(rt,st.data))st=st.prev;else{if(!t.geom.ZPP_Simple.ints.lt(st.data,rt))break;st=st.next}var lt=st;if(null!=lt){var pt=rt.vertex;pt.links.clear(),pt.node=null,pt.forced=!1,pt.next=t.geom.ZPP_SimpleVert.zpp_pool,t.geom.ZPP_SimpleVert.zpp_pool=pt,rt.vertex=lt.data.vertex,lt.data=rt,t.geom.ZPP_Simple.queue.insert(rt)}else t.geom.ZPP_Simple.queue.insert(rt),t.geom.ZPP_Simple.ints.insert(rt);if(Ue.next.id<Ue.id){var ut,ht=t.geom.ZPP_Simple.inthash,ct=Ue.next.id,_t=Ue.id;null==t.util.Hashable2_Boolfalse.zpp_pool?ut=new t.util.Hashable2_Boolfalse:(ut=t.util.Hashable2_Boolfalse.zpp_pool,t.util.Hashable2_Boolfalse.zpp_pool=ut.next,ut.next=null),ut.id=ct,ut.di=_t;var dt=ut;dt.value=!0,ht.add(dt)}else{var mt,Pt=t.geom.ZPP_Simple.inthash,ft=Ue.id,xt=Ue.next.id;null==t.util.Hashable2_Boolfalse.zpp_pool?mt=new t.util.Hashable2_Boolfalse:(mt=t.util.Hashable2_Boolfalse.zpp_pool,t.util.Hashable2_Boolfalse.zpp_pool=mt.next,mt.next=null),mt.id=ft,mt.di=xt;var yt=mt;yt.value=!0,Pt.add(yt)}}else{var vt=at.data;if(vt.segment!=rt.segment||rt.segment2!=vt.segment2)throw new n._Boot.HaxeError("corner case 2, shiiiit.");var gt=rt.vertex;gt.links.clear(),gt.node=null,gt.forced=!1,gt.next=t.geom.ZPP_SimpleVert.zpp_pool,t.geom.ZPP_SimpleVert.zpp_pool=gt;var bt=rt;bt.vertex=null,bt.segment=bt.segment2=null,bt.node=null,bt.next=t.geom.ZPP_SimpleEvent.zpp_pool,t.geom.ZPP_SimpleEvent.zpp_pool=bt}}else{var zt=rt.vertex;zt.links.clear(),zt.node=null,zt.forced=!1,zt.next=t.geom.ZPP_SimpleVert.zpp_pool,t.geom.ZPP_SimpleVert.zpp_pool=zt;var wt=rt;wt.vertex=null,wt.segment=wt.segment2=null,wt.node=null,wt.next=t.geom.ZPP_SimpleEvent.zpp_pool,t.geom.ZPP_SimpleEvent.zpp_pool=wt}}if(null!=Ge&&null!=Ge.prev&&!(Ge.id<Ge.prev.id?t.geom.ZPP_Simple.inthash.has(Ge.id,Ge.prev.id):t.geom.ZPP_Simple.inthash.has(Ge.prev.id,Ge.id))){var Zt=t.geom.ZPP_Simple.sweep.intersection(Ge,Ge.prev);if(null!=Zt)if(Zt.vertex.x>=t.geom.ZPP_Simple.sweep.sweepx){for(var Et=t.geom.ZPP_Simple.queue.parent;null!=Et;)if(t.geom.ZPP_Simple.queue.lt(Zt,Et.data))Et=Et.prev;else{if(!t.geom.ZPP_Simple.queue.lt(Et.data,Zt))break;Et=Et.next}var Mt=Et;if(null==Mt){for(var St=t.geom.ZPP_Simple.ints.parent;null!=St;)if(t.geom.ZPP_Simple.ints.lt(Zt,St.data))St=St.prev;else{if(!t.geom.ZPP_Simple.ints.lt(St.data,Zt))break;St=St.next}var Ct=St;if(null!=Ct){var Nt=Zt.vertex;Nt.links.clear(),Nt.node=null,Nt.forced=!1,Nt.next=t.geom.ZPP_SimpleVert.zpp_pool,t.geom.ZPP_SimpleVert.zpp_pool=Nt,Zt.vertex=Ct.data.vertex,Ct.data=Zt,t.geom.ZPP_Simple.queue.insert(Zt)}else t.geom.ZPP_Simple.queue.insert(Zt),t.geom.ZPP_Simple.ints.insert(Zt);if(Ge.id<Ge.prev.id){var At,Lt=t.geom.ZPP_Simple.inthash,Bt=Ge.id,Tt=Ge.prev.id;null==t.util.Hashable2_Boolfalse.zpp_pool?At=new t.util.Hashable2_Boolfalse:(At=t.util.Hashable2_Boolfalse.zpp_pool,t.util.Hashable2_Boolfalse.zpp_pool=At.next,At.next=null),At.id=Bt,At.di=Tt;var Vt=At;Vt.value=!0,Lt.add(Vt)}else{var kt,It=t.geom.ZPP_Simple.inthash,Ot=Ge.prev.id,Rt=Ge.id;null==t.util.Hashable2_Boolfalse.zpp_pool?kt=new t.util.Hashable2_Boolfalse:(kt=t.util.Hashable2_Boolfalse.zpp_pool,t.util.Hashable2_Boolfalse.zpp_pool=kt.next,kt.next=null),kt.id=Ot,kt.di=Rt;var Ht=kt;Ht.value=!0,It.add(Ht)}}else{var Ft=Mt.data;if(Ft.segment!=Zt.segment||Zt.segment2!=Ft.segment2)throw new n._Boot.HaxeError("corner case 2, shiiiit.");var Dt=Zt.vertex;Dt.links.clear(),Dt.node=null,Dt.forced=!1,Dt.next=t.geom.ZPP_SimpleVert.zpp_pool,t.geom.ZPP_SimpleVert.zpp_pool=Dt;var Gt=Zt;Gt.vertex=null,Gt.segment=Gt.segment2=null,Gt.node=null,Gt.next=t.geom.ZPP_SimpleEvent.zpp_pool,t.geom.ZPP_SimpleEvent.zpp_pool=Gt}}else{var Ut=Zt.vertex;Ut.links.clear(),Ut.node=null,Ut.forced=!1,Ut.next=t.geom.ZPP_SimpleVert.zpp_pool,t.geom.ZPP_SimpleVert.zpp_pool=Ut;var jt=Zt;jt.vertex=null,jt.segment=jt.segment2=null,jt.node=null,jt.next=t.geom.ZPP_SimpleEvent.zpp_pool,t.geom.ZPP_SimpleEvent.zpp_pool=jt}}t.geom.ZPP_Simple.ints.remove(E)}var Wt=E;Wt.vertex=null,Wt.segment=Wt.segment2=null,Wt.node=null,Wt.next=t.geom.ZPP_SimpleEvent.zpp_pool,t.geom.ZPP_SimpleEvent.zpp_pool=Wt}for(var qt=0,Jt=t.geom.ZPP_Simple.inthash.table.length;qt<Jt;){var $t=qt++,Xt=t.geom.ZPP_Simple.inthash.table[$t];if(null!=Xt){for(;null!=Xt;){var Yt=Xt.hnext;Xt.hnext=null;var Kt=Xt;Kt.next=t.util.Hashable2_Boolfalse.zpp_pool,t.util.Hashable2_Boolfalse.zpp_pool=Kt,Xt=Yt}t.geom.ZPP_Simple.inthash.table[$t]=null}}for(null==i&&(i=new t.util.ZNPList_ZPP_GeomVert);!t.geom.ZPP_Simple.vertices.empty();)t.geom.ZPP_Simple.clip_polygon(t.geom.ZPP_Simple.vertices,i);return i},t.geom.ZPP_Simple.clip_polygon=function(e,n){var i,r,o,a=null,s=e.first(),l=s,p=s.links.parent,u=null==p.prev?p.next:p.prev,h=p.data,c=u.data;i=s.x-h.x,r=s.y-h.y,o=c.x-s.x,(c.y-s.y)*i-o*r<0&&(c=h);var _,d=s.x,m=s.y;null==t.geom.ZPP_GeomVert.zpp_pool?_=new t.geom.ZPP_GeomVert:(_=t.geom.ZPP_GeomVert.zpp_pool,t.geom.ZPP_GeomVert.zpp_pool=_.next,_.next=null),_.forced=!1,_.x=d,_.y=m;var P=_;for(null==a?a=P.prev=P.next=P:(P.prev=a,P.next=a.next,a.next.prev=P,a.next=P),(a=P).forced=s.forced;;){if(s.links.remove(c),c.links.remove(s),c==l){if(s.links.empty()){e.remove(s);var f=s;f.links.clear(),f.node=null,f.forced=!1,f.next=t.geom.ZPP_SimpleVert.zpp_pool,t.geom.ZPP_SimpleVert.zpp_pool=f}break}var x,y=c.x,v=c.y;null==t.geom.ZPP_GeomVert.zpp_pool?x=new t.geom.ZPP_GeomVert:(x=t.geom.ZPP_GeomVert.zpp_pool,t.geom.ZPP_GeomVert.zpp_pool=x.next,x.next=null),x.forced=!1,x.x=y,x.y=v;var g=x;if(null==a?a=g.prev=g.next=g:(g.prev=a,g.next=a.next,a.next.prev=g,a.next=g),(a=g).forced=c.forced,c.links.singular()){if(s.links.empty()){e.remove(s);var b=s;b.links.clear(),b.node=null,b.forced=!1,b.next=t.geom.ZPP_SimpleVert.zpp_pool,t.geom.ZPP_SimpleVert.zpp_pool=b}s=c,c=c.links.parent.data}else{var z=null,w=0;if(!c.links.empty()){for(var Z=c.links.parent;null!=Z.prev;)Z=Z.prev;for(;null!=Z;){var E=Z.data;if(null==z){var M,S,C;z=E,M=c.x-s.x,S=c.y-s.y,C=E.x-c.x,w=(E.y-c.y)*M-C*S}else{var N,A,L;N=c.x-s.x,A=c.y-s.y,L=E.x-c.x;var B=(E.y-c.y)*N-L*A;if(B>0&&w<=0)z=E,w=B;else if(w*B>=0){var T,V,k;T=c.x-E.x,V=c.y-E.y,k=z.x-c.x,(z.y-c.y)*T-k*V>0&&(z=E,w=B)}}if(null!=Z.next)for(Z=Z.next;null!=Z.prev;)Z=Z.prev;else{for(;null!=Z.parent&&Z==Z.parent.next;)Z=Z.parent;Z=Z.parent}}}if(s.links.empty()){e.remove(s);var I=s;I.links.clear(),I.node=null,I.forced=!1,I.next=t.geom.ZPP_SimpleVert.zpp_pool,t.geom.ZPP_SimpleVert.zpp_pool=I}s=c,c=z}}e.remove(l);var O=l;O.links.clear(),O.node=null,O.forced=!1,O.next=t.geom.ZPP_SimpleVert.zpp_pool,t.geom.ZPP_SimpleVert.zpp_pool=O,n.add(a)},t.geom.ZPP_Simple.isSimple=function(e){null==t.geom.ZPP_Simple.sweep&&(t.geom.ZPP_Simple.sweep=new t.geom.ZPP_SimpleSweep,t.geom.ZPP_Simple.inthash=new t.util.FastHash2_Hashable2_Boolfalse);var n=t.geom.ZPP_Simple.list_vertices;null==n&&(n=t.geom.ZPP_Simple.list_vertices=new t.util.ZNPList_ZPP_SimpleVert);var i=e;if(null!=e)for(var r=e;;){var o,a=r,s=a.x,l=a.y;if(null==t.geom.ZPP_SimpleVert.zpp_pool?o=new t.geom.ZPP_SimpleVert:(o=t.geom.ZPP_SimpleVert.zpp_pool,t.geom.ZPP_SimpleVert.zpp_pool=o.next,o.next=null),o.x=s,o.y=l,n.add(o),(r=r.next)==i)break}var p=t.geom.ZPP_Simple.list_queue;null==p&&(p=t.geom.ZPP_Simple.list_queue=new t.util.ZNPList_ZPP_SimpleEvent);var u=n.head,h=u.elt;for(u=u.next;null!=u;){var c,_=u.elt;null==t.geom.ZPP_SimpleEvent.zpp_pool?c=new t.geom.ZPP_SimpleEvent:(c=t.geom.ZPP_SimpleEvent.zpp_pool,t.geom.ZPP_SimpleEvent.zpp_pool=c.next,c.next=null),c.vertex=h;var d,m=p.add(c);null==t.geom.ZPP_SimpleEvent.zpp_pool?d=new t.geom.ZPP_SimpleEvent:(d=t.geom.ZPP_SimpleEvent.zpp_pool,t.geom.ZPP_SimpleEvent.zpp_pool=d.next,d.next=null),d.vertex=_;var P,f=p.add(d);t.geom.ZPP_SimpleEvent.less_xy(m,f)?(m.type=1,f.type=2,P=t.geom.ZPP_SimpleSeg.get(h,_)):(m.type=2,f.type=1,P=t.geom.ZPP_SimpleSeg.get(_,h)),m.segment=f.segment=P,h=_,u=u.next}var x,y=n.head.elt;null==t.geom.ZPP_SimpleEvent.zpp_pool?x=new t.geom.ZPP_SimpleEvent:(x=t.geom.ZPP_SimpleEvent.zpp_pool,t.geom.ZPP_SimpleEvent.zpp_pool=x.next,x.next=null),x.vertex=h;var v,g=p.add(x);null==t.geom.ZPP_SimpleEvent.zpp_pool?v=new t.geom.ZPP_SimpleEvent:(v=t.geom.ZPP_SimpleEvent.zpp_pool,t.geom.ZPP_SimpleEvent.zpp_pool=v.next,v.next=null),v.vertex=y;var b,z=p.add(v);t.geom.ZPP_SimpleEvent.less_xy(g,z)?(g.type=1,z.type=2,b=t.geom.ZPP_SimpleSeg.get(h,y)):(g.type=2,z.type=1,b=t.geom.ZPP_SimpleSeg.get(y,h)),g.segment=z.segment=b;var w=p;if(null!=w.head&&null!=w.head.next){for(var Z,E,M,S=w.head,C=null,N=null,A=null,L=null,B=1;;){for(Z=0,N=S,C=S=null;null!=N;){for(++Z,A=N,E=0,M=B;null!=A&&E<B;)++E,A=A.next;for(;E>0||M>0&&null!=A;)0==E?(L=A,A=A.next,--M):0==M||null==A||t.geom.ZPP_SimpleEvent.less_xy(N.elt,A.elt)?(L=N,N=N.next,--E):(L=A,A=A.next,--M),null!=C?C.next=L:S=L,C=L;N=A}if(C.next=null,B<<=1,!(Z>1))break}w.head=S,w.modified=!0,w.pushmod=!0}for(var T=!0;null!=p.head;){var V=p.pop_unsafe(),k=V.segment;if(1==V.type){if(t.geom.ZPP_Simple.sweep.add(k),t.geom.ZPP_Simple.sweep.intersect(k,k.next)||t.geom.ZPP_Simple.sweep.intersect(k,k.prev)){T=!1;break}}else if(2==V.type){if(t.geom.ZPP_Simple.sweep.intersect(k.prev,k.next)){T=!1;break}t.geom.ZPP_Simple.sweep.remove(k);var I=k;I.left=I.right=null,I.prev=null,I.node=null,I.vertices.clear(),I.next=t.geom.ZPP_SimpleSeg.zpp_pool,t.geom.ZPP_SimpleSeg.zpp_pool=I}var O=V;O.vertex=null,O.segment=O.segment2=null,O.node=null,O.next=t.geom.ZPP_SimpleEvent.zpp_pool,t.geom.ZPP_SimpleEvent.zpp_pool=O}for(;null!=p.head;){var R=p.pop_unsafe();if(2==R.type){var H=R.segment;H.left=H.right=null,H.prev=null,H.node=null,H.vertices.clear(),H.next=t.geom.ZPP_SimpleSeg.zpp_pool,t.geom.ZPP_SimpleSeg.zpp_pool=H}var F=R;F.vertex=null,F.segment=F.segment2=null,F.node=null,F.next=t.geom.ZPP_SimpleEvent.zpp_pool,t.geom.ZPP_SimpleEvent.zpp_pool=F}for(t.geom.ZPP_Simple.sweep.clear();null!=n.head;){var D=n.pop_unsafe();D.links.clear(),D.node=null,D.forced=!1,D.next=t.geom.ZPP_SimpleVert.zpp_pool,t.geom.ZPP_SimpleVert.zpp_pool=D}return T},t.geom.ZPP_Simple.prototype.__class__=t.geom.ZPP_Simple,t.geom.ZPP_SimplifyV=l["zpp_nape.geom.ZPP_SimplifyV"]=function(){this.forced=!1,this.flag=!1,this.prev=null,this.next=null,this.y=0,this.x=0},t.geom.ZPP_SimplifyV.__name__=["zpp_nape","geom","ZPP_SimplifyV"],t.geom.ZPP_SimplifyV.get=function(e){var n;return null==t.geom.ZPP_SimplifyV.zpp_pool?n=new t.geom.ZPP_SimplifyV:(n=t.geom.ZPP_SimplifyV.zpp_pool,t.geom.ZPP_SimplifyV.zpp_pool=n.next,n.next=null),n.x=e.x,n.y=e.y,n.flag=!1,n},t.geom.ZPP_SimplifyV.prototype.x=null,t.geom.ZPP_SimplifyV.prototype.y=null,t.geom.ZPP_SimplifyV.prototype.next=null,t.geom.ZPP_SimplifyV.prototype.prev=null,t.geom.ZPP_SimplifyV.prototype.flag=null,t.geom.ZPP_SimplifyV.prototype.forced=null,t.geom.ZPP_SimplifyV.prototype.free=function(){},t.geom.ZPP_SimplifyV.prototype.alloc=function(){},t.geom.ZPP_SimplifyV.prototype.__class__=t.geom.ZPP_SimplifyV,t.geom.ZPP_SimplifyP=l["zpp_nape.geom.ZPP_SimplifyP"]=function(){this.max=null,this.min=null,this.next=null},t.geom.ZPP_SimplifyP.__name__=["zpp_nape","geom","ZPP_SimplifyP"],t.geom.ZPP_SimplifyP.get=function(e,n){var i;return null==t.geom.ZPP_SimplifyP.zpp_pool?i=new t.geom.ZPP_SimplifyP:(i=t.geom.ZPP_SimplifyP.zpp_pool,t.geom.ZPP_SimplifyP.zpp_pool=i.next,i.next=null),i.min=e,i.max=n,i},t.geom.ZPP_SimplifyP.prototype.next=null,t.geom.ZPP_SimplifyP.prototype.min=null,t.geom.ZPP_SimplifyP.prototype.max=null,t.geom.ZPP_SimplifyP.prototype.free=function(){this.min=this.max=null},t.geom.ZPP_SimplifyP.prototype.alloc=function(){},t.geom.ZPP_SimplifyP.prototype.__class__=t.geom.ZPP_SimplifyP,t.geom.ZPP_Simplify=l["zpp_nape.geom.ZPP_Simplify"]=function(){},t.geom.ZPP_Simplify.__name__=["zpp_nape","geom","ZPP_Simplify"],t.geom.ZPP_Simplify.lessval=function(e,t){return e.x-t.x+(e.y-t.y)},t.geom.ZPP_Simplify.less=function(e,t){return e.x-t.x+(e.y-t.y)<0},t.geom.ZPP_Simplify.distance=function(e,t,n){var i,r;i=n.x-t.x,r=n.y-t.y;var o=0,a=0;if(o=e.x-t.x,a=e.y-t.y,0==i*i+r*r)return o*o+a*a;var s,l,p=(o*i+a*r)/(i*i+r*r);return p<=0?o*o+a*a:p>=1?(s=e.x-n.x)*s+(l=e.y-n.y)*l:(o-=i*p)*o+(a-=r*p)*a},t.geom.ZPP_Simplify.simplify=function(e,n){var i=null,r=null,o=null;n*=n,null==t.geom.ZPP_Simplify.stack&&(t.geom.ZPP_Simplify.stack=new t.util.ZNPList_ZPP_SimplifyP);for(var a=null,s=null,l=e;;){var p;null==t.geom.ZPP_SimplifyV.zpp_pool?p=new t.geom.ZPP_SimplifyV:(p=t.geom.ZPP_SimplifyV.zpp_pool,t.geom.ZPP_SimplifyV.zpp_pool=p.next,p.next=null),p.x=l.x,p.y=l.y,p.flag=!1;var u=p;if(u.forced=l.forced,u.forced){if(u.flag=!0,null!=a){var h,c=t.geom.ZPP_Simplify.stack;null==t.geom.ZPP_SimplifyP.zpp_pool?h=new t.geom.ZPP_SimplifyP:(h=t.geom.ZPP_SimplifyP.zpp_pool,t.geom.ZPP_SimplifyP.zpp_pool=h.next,h.next=null),h.min=a,h.max=u,c.add(h)}else s=u;a=u}var _=u;if(null==i?i=_.prev=_.next=_:(_.prev=i,_.next=i.next,i.next.prev=_,i.next=_),i=_,null==r?(r=i,o=i):(i.x-r.x+(i.y-r.y)<0&&(r=i),o.x-i.x+(o.y-i.y)<0&&(o=i)),(l=l.next)==e)break}if(null==t.geom.ZPP_Simplify.stack.head)if(null==s){r.flag=o.flag=!0;var d,m=t.geom.ZPP_Simplify.stack;null==t.geom.ZPP_SimplifyP.zpp_pool?d=new t.geom.ZPP_SimplifyP:(d=t.geom.ZPP_SimplifyP.zpp_pool,t.geom.ZPP_SimplifyP.zpp_pool=d.next,d.next=null),d.min=r,d.max=o,m.add(d);var P,f=t.geom.ZPP_Simplify.stack;null==t.geom.ZPP_SimplifyP.zpp_pool?P=new t.geom.ZPP_SimplifyP:(P=t.geom.ZPP_SimplifyP.zpp_pool,t.geom.ZPP_SimplifyP.zpp_pool=P.next,P.next=null),P.min=o,P.max=r,f.add(P)}else{var x=r.x-s.x+(r.y-s.y);x<0&&(x=-x);var y=o.x-s.x+(o.y-s.y);if(y<0&&(y=-y),x>y){r.flag=s.flag=!0;var v,g=t.geom.ZPP_Simplify.stack;null==t.geom.ZPP_SimplifyP.zpp_pool?v=new t.geom.ZPP_SimplifyP:(v=t.geom.ZPP_SimplifyP.zpp_pool,t.geom.ZPP_SimplifyP.zpp_pool=v.next,v.next=null),v.min=r,v.max=s,g.add(v);var b,z=t.geom.ZPP_Simplify.stack;null==t.geom.ZPP_SimplifyP.zpp_pool?b=new t.geom.ZPP_SimplifyP:(b=t.geom.ZPP_SimplifyP.zpp_pool,t.geom.ZPP_SimplifyP.zpp_pool=b.next,b.next=null),b.min=s,b.max=r,z.add(b)}else{o.flag=s.flag=!0;var w,Z=t.geom.ZPP_Simplify.stack;null==t.geom.ZPP_SimplifyP.zpp_pool?w=new t.geom.ZPP_SimplifyP:(w=t.geom.ZPP_SimplifyP.zpp_pool,t.geom.ZPP_SimplifyP.zpp_pool=w.next,w.next=null),w.min=o,w.max=s,Z.add(w);var E,M=t.geom.ZPP_Simplify.stack;null==t.geom.ZPP_SimplifyP.zpp_pool?E=new t.geom.ZPP_SimplifyP:(E=t.geom.ZPP_SimplifyP.zpp_pool,t.geom.ZPP_SimplifyP.zpp_pool=E.next,E.next=null),E.min=s,E.max=o,M.add(E)}}else{var S,C=t.geom.ZPP_Simplify.stack;null==t.geom.ZPP_SimplifyP.zpp_pool?S=new t.geom.ZPP_SimplifyP:(S=t.geom.ZPP_SimplifyP.zpp_pool,t.geom.ZPP_SimplifyP.zpp_pool=S.next,S.next=null),S.min=a,S.max=s,C.add(S)}for(;null!=t.geom.ZPP_Simplify.stack.head;){var N=t.geom.ZPP_Simplify.stack.pop_unsafe(),A=N.min,L=N.max,B=N;B.min=B.max=null,B.next=t.geom.ZPP_SimplifyP.zpp_pool,t.geom.ZPP_SimplifyP.zpp_pool=B;for(var T=n,V=null,k=A.next;k!=L;){var I=t.geom.ZPP_Simplify.distance(k,A,L);I>T&&(T=I,V=k),k=k.next}if(null!=V){V.flag=!0;var O,R=t.geom.ZPP_Simplify.stack;null==t.geom.ZPP_SimplifyP.zpp_pool?O=new t.geom.ZPP_SimplifyP:(O=t.geom.ZPP_SimplifyP.zpp_pool,t.geom.ZPP_SimplifyP.zpp_pool=O.next,O.next=null),O.min=A,O.max=V,R.add(O);var H,F=t.geom.ZPP_Simplify.stack;null==t.geom.ZPP_SimplifyP.zpp_pool?H=new t.geom.ZPP_SimplifyP:(H=t.geom.ZPP_SimplifyP.zpp_pool,t.geom.ZPP_SimplifyP.zpp_pool=H.next,H.next=null),H.min=V,H.max=L,F.add(H)}}for(var D=null;null!=i;){if(i.flag){var G,U=i.x,j=i.y;null==t.geom.ZPP_GeomVert.zpp_pool?G=new t.geom.ZPP_GeomVert:(G=t.geom.ZPP_GeomVert.zpp_pool,t.geom.ZPP_GeomVert.zpp_pool=G.next,G.next=null),G.forced=!1,G.x=U,G.y=j;var W=G;null==D?D=W.prev=W.next=W:(W.prev=D,W.next=D.next,D.next.prev=W,D.next=W),(D=W).forced=i.forced}if(null!=i&&i.prev==i){i.next=i.prev=null;var q=i;q.next=t.geom.ZPP_SimplifyV.zpp_pool,t.geom.ZPP_SimplifyV.zpp_pool=q,i=i=null}else{var J=i.next;i.prev.next=i.next,i.next.prev=i.prev,i.next=i.prev=null;var $=i;$.next=t.geom.ZPP_SimplifyV.zpp_pool,t.geom.ZPP_SimplifyV.zpp_pool=$,i=null,i=J}}return D},t.geom.ZPP_Simplify.prototype.__class__=t.geom.ZPP_Simplify,t.geom.ZPP_ToiEvent=l["zpp_nape.geom.ZPP_ToiEvent"]=function(){this.kinematic=!1,this.failed=!1,this.slipped=!1,this.axis=null,this.c2=null,this.c1=null,this.frozen2=!1,this.frozen1=!1,this.arbiter=null,this.s2=null,this.s1=null,this.toi=0,this.next=null,this.c1=new t.geom.ZPP_Vec2,this.c2=new t.geom.ZPP_Vec2,this.axis=new t.geom.ZPP_Vec2},t.geom.ZPP_ToiEvent.__name__=["zpp_nape","geom","ZPP_ToiEvent"],t.geom.ZPP_ToiEvent.prototype.next=null,t.geom.ZPP_ToiEvent.prototype.alloc=function(){this.failed=!1,this.s1=this.s2=null,this.arbiter=null},t.geom.ZPP_ToiEvent.prototype.free=function(){},t.geom.ZPP_ToiEvent.prototype.toi=null,t.geom.ZPP_ToiEvent.prototype.s1=null,t.geom.ZPP_ToiEvent.prototype.s2=null,t.geom.ZPP_ToiEvent.prototype.arbiter=null,t.geom.ZPP_ToiEvent.prototype.frozen1=null,t.geom.ZPP_ToiEvent.prototype.frozen2=null,t.geom.ZPP_ToiEvent.prototype.c1=null,t.geom.ZPP_ToiEvent.prototype.c2=null,t.geom.ZPP_ToiEvent.prototype.axis=null,t.geom.ZPP_ToiEvent.prototype.slipped=null,t.geom.ZPP_ToiEvent.prototype.failed=null,t.geom.ZPP_ToiEvent.prototype.kinematic=null,t.geom.ZPP_ToiEvent.prototype.__class__=t.geom.ZPP_ToiEvent,t.geom.ZPP_SweepDistance=l["zpp_nape.geom.ZPP_SweepDistance"]=function(){},t.geom.ZPP_SweepDistance.__name__=["zpp_nape","geom","ZPP_SweepDistance"],t.geom.ZPP_SweepDistance.dynamicSweep=function(t,n,i,r,o){null==o&&(o=!1);var a,s,l=t.s1,p=t.s2,u=l.body,h=p.body;a=h.velx-u.velx,s=h.vely-u.vely;var c=u.angvel;c<0&&(c=-c);var _=h.angvel;_<0&&(_=-_);var d=l.sweepCoef*c+p.sweepCoef*_;if(!o&&!t.kinematic&&a*a+s*s<e.Config.dynamicSweepLinearThreshold*e.Config.dynamicSweepLinearThreshold&&d<e.Config.dynamicSweepAngularThreshold)return t.toi=-1,void(t.failed=!0);for(var m=t.c1,P=t.c2,f=t.axis,x=i,y=0;;){var v=x*n,g=v-u.sweepTime;if(0!=g){u.sweepTime=v;var b=g;if(u.posx+=u.velx*b,u.posy+=u.vely*b,0!=u.angvel){var z=u.sweep_angvel*g;if(u.rot+=z,z*z>1e-4)u.axisx=Math.sin(u.rot),u.axisy=Math.cos(u.rot);else{var w=z*z,Z=1-.5*w,E=1-w*w/8,M=(Z*u.axisx+z*u.axisy)*E;u.axisy=(Z*u.axisy-z*u.axisx)*E,u.axisx=M}}}if(0==l.type)l.worldCOMx=u.posx+(u.axisy*l.localCOMx-u.axisx*l.localCOMy),l.worldCOMy=u.posy+(l.localCOMx*u.axisx+l.localCOMy*u.axisy);else{for(var S=l.polygon,C=S.lverts.next,N=S.gverts.next;null!=N;){var A=N,L=C;C=C.next,A.x=u.posx+(u.axisy*L.x-u.axisx*L.y),A.y=u.posy+(L.x*u.axisx+L.y*u.axisy),N=N.next}var B=S.edges.head,T=S.gverts.next,V=T;for(T=T.next;null!=T;){var k=T,I=B.elt;B=B.next,I.gnormx=u.axisy*I.lnormx-u.axisx*I.lnormy,I.gnormy=I.lnormx*u.axisx+I.lnormy*u.axisy,I.gprojection=u.posx*I.gnormx+u.posy*I.gnormy+I.lprojection,I.tp0=V.y*I.gnormx-V.x*I.gnormy,I.tp1=k.y*I.gnormx-k.x*I.gnormy,V=k,T=T.next}var O=S.gverts.next,R=B.elt;B=B.next,R.gnormx=u.axisy*R.lnormx-u.axisx*R.lnormy,R.gnormy=R.lnormx*u.axisx+R.lnormy*u.axisy,R.gprojection=u.posx*R.gnormx+u.posy*R.gnormy+R.lprojection,R.tp0=V.y*R.gnormx-V.x*R.gnormy,R.tp1=O.y*R.gnormx-O.x*R.gnormy}var H=x*n,F=H-h.sweepTime;if(0!=F){h.sweepTime=H;var D=F;if(h.posx+=h.velx*D,h.posy+=h.vely*D,0!=h.angvel){var G=h.sweep_angvel*F;if(h.rot+=G,G*G>1e-4)h.axisx=Math.sin(h.rot),h.axisy=Math.cos(h.rot);else{var U=G*G,j=1-.5*U,W=1-U*U/8,q=(j*h.axisx+G*h.axisy)*W;h.axisy=(j*h.axisy-G*h.axisx)*W,h.axisx=q}}}if(0==p.type)p.worldCOMx=h.posx+(h.axisy*p.localCOMx-h.axisx*p.localCOMy),p.worldCOMy=h.posy+(p.localCOMx*h.axisx+p.localCOMy*h.axisy);else{for(var J=p.polygon,$=J.lverts.next,X=J.gverts.next;null!=X;){var Y=X,K=$;$=$.next,Y.x=h.posx+(h.axisy*K.x-h.axisx*K.y),Y.y=h.posy+(K.x*h.axisx+K.y*h.axisy),X=X.next}var Q=J.edges.head,ee=J.gverts.next,te=ee;for(ee=ee.next;null!=ee;){var ne=ee,ie=Q.elt;Q=Q.next,ie.gnormx=h.axisy*ie.lnormx-h.axisx*ie.lnormy,ie.gnormy=ie.lnormx*h.axisx+ie.lnormy*h.axisy,ie.gprojection=h.posx*ie.gnormx+h.posy*ie.gnormy+ie.lprojection,ie.tp0=te.y*ie.gnormx-te.x*ie.gnormy,ie.tp1=ne.y*ie.gnormx-ne.x*ie.gnormy,te=ne,ee=ee.next}var re=J.gverts.next,oe=Q.elt;Q=Q.next,oe.gnormx=h.axisy*oe.lnormx-h.axisx*oe.lnormy,oe.gnormy=oe.lnormx*h.axisx+oe.lnormy*h.axisy,oe.gprojection=h.posx*oe.gnormx+h.posy*oe.gnormy+oe.lprojection,oe.tp0=te.y*oe.gnormx-te.x*oe.gnormy,oe.tp1=re.y*oe.gnormx-re.x*oe.gnormy}var ae,se=l,le=p,pe=m,ue=P;if(0==se.type&&0==le.type){var he,ce=se.circle,_e=le.circle,de=0,me=0;de=_e.worldCOMx-ce.worldCOMx,me=_e.worldCOMy-ce.worldCOMy;var Pe=Math.sqrt(de*de+me*me);if((he=Pe-(ce.radius+_e.radius))<1e100){if(0==Pe)de=1,me=0;else{var fe=1/Pe;de*=fe,me*=fe}var xe=ce.radius;pe.x=ce.worldCOMx+de*xe,pe.y=ce.worldCOMy+me*xe;var ye=-_e.radius;ue.x=_e.worldCOMx+de*ye,ue.y=_e.worldCOMy+me*ye,f.x=de,f.y=me}ae=he}else{var ve=!1;if(0==se.type&&1==le.type){var ge=se;se=le,le=ge;var be=pe;pe=ue,ue=be,ve=!0}if(1==se.type&&0==le.type){for(var ze=se.polygon,we=le.circle,Ze=-1e100,Ee=null,Me=ze.edges.head;null!=Me;){var Se=Me.elt,Ce=Se.gnormx*we.worldCOMx+Se.gnormy*we.worldCOMy-Se.gprojection-we.radius;if(Ce>1e100){Ze=Ce;break}Ce>0?Ce>Ze&&(Ze=Ce,Ee=Se):Ze<0&&Ce>Ze&&(Ze=Ce,Ee=Se),Me=Me.next}if(Ze<1e100){var Ne=Ee.gp0,Ae=Ee.gp1,Le=we.worldCOMy*Ee.gnormx-we.worldCOMx*Ee.gnormy;if(Le<=Ne.y*Ee.gnormx-Ne.x*Ee.gnormy){var Be=0,Te=0;Be=we.worldCOMx-Ne.x,Te=we.worldCOMy-Ne.y;var Ve=Math.sqrt(Be*Be+Te*Te);if((Ze=Ve-we.radius)<1e100){if(0==Ve)Be=1,Te=0;else{var ke=1/Ve;Be*=ke,Te*=ke}pe.x=Ne.x+0*Be,pe.y=Ne.y+0*Te;var Ie=-we.radius;ue.x=we.worldCOMx+Be*Ie,ue.y=we.worldCOMy+Te*Ie,f.x=Be,f.y=Te}}else if(Le>=Ae.y*Ee.gnormx-Ae.x*Ee.gnormy){var Oe=0,Re=0;Oe=we.worldCOMx-Ae.x,Re=we.worldCOMy-Ae.y;var He=Math.sqrt(Oe*Oe+Re*Re);if((Ze=He-we.radius)<1e100){if(0==He)Oe=1,Re=0;else{var Fe=1/He;Oe*=Fe,Re*=Fe}pe.x=Ae.x+0*Oe,pe.y=Ae.y+0*Re;var De=-we.radius;ue.x=we.worldCOMx+Oe*De,ue.y=we.worldCOMy+Re*De,f.x=Oe,f.y=Re}}else{var Ge=-we.radius;ue.x=we.worldCOMx+Ee.gnormx*Ge,ue.y=we.worldCOMy+Ee.gnormy*Ge;var Ue=-Ze;pe.x=ue.x+Ee.gnormx*Ue,pe.y=ue.y+Ee.gnormy*Ue,f.x=Ee.gnormx,f.y=Ee.gnormy}}ve&&(f.x=-f.x,f.y=-f.y),ae=Ze}else{for(var je=se.polygon,We=le.polygon,qe=-1e100,Je=null,$e=null,Xe=0,Ye=je.edges.head;null!=Ye;){for(var Ke=Ye.elt,Qe=1e100,et=We.gverts.next;null!=et;){var tt=et,nt=Ke.gnormx*tt.x+Ke.gnormy*tt.y;nt<Qe&&(Qe=nt),et=et.next}if((Qe-=Ke.gprojection)>1e100){qe=Qe;break}Qe>0?Qe>qe&&(qe=Qe,Je=Ke,Xe=1):qe<0&&Qe>qe&&(qe=Qe,Je=Ke,Xe=1),Ye=Ye.next}if(qe<1e100){for(var it=We.edges.head;null!=it;){for(var rt=it.elt,ot=1e100,at=je.gverts.next;null!=at;){var st=at,lt=rt.gnormx*st.x+rt.gnormy*st.y;lt<ot&&(ot=lt),at=at.next}if((ot-=rt.gprojection)>1e100){qe=ot;break}ot>0?ot>qe&&(qe=ot,$e=rt,Xe=2):qe<0&&ot>qe&&(qe=ot,$e=rt,Xe=2),it=it.next}if(qe<1e100){var pt,ut;if(1==Xe)pt=We,ut=Je;else{pt=je,ut=$e;var ht=pe;pe=ue,ue=ht,ve=!ve}for(var ct=null,_t=1e100,dt=pt.edges.head;null!=dt;){var mt=dt.elt,Pt=ut.gnormx*mt.gnormx+ut.gnormy*mt.gnormy;Pt<_t&&(_t=Pt,ct=mt),dt=dt.next}if(ve?(f.x=-ut.gnormx,f.y=-ut.gnormy):(f.x=ut.gnormx,f.y=ut.gnormy),qe>=0){var ft,xt,yt,vt,gt=ut.gp0,bt=ut.gp1,zt=ct.gp0,wt=ct.gp1,Zt=1/((ft=bt.x-gt.x)*ft+(xt=bt.y-gt.y)*xt),Et=1/((yt=wt.x-zt.x)*yt+(vt=wt.y-zt.y)*vt),Mt=-(ft*(gt.x-zt.x)+xt*(gt.y-zt.y))*Zt,St=-(ft*(gt.x-wt.x)+xt*(gt.y-wt.y))*Zt,Ct=-(yt*(zt.x-gt.x)+vt*(zt.y-gt.y))*Et,Nt=-(yt*(zt.x-bt.x)+vt*(zt.y-bt.y))*Et;Mt<0?Mt=0:Mt>1&&(Mt=1),St<0?St=0:St>1&&(St=1),Ct<0?Ct=0:Ct>1&&(Ct=1),Nt<0?Nt=0:Nt>1&&(Nt=1);var At,Lt,Bt=Mt;At=gt.x+ft*Bt,Lt=gt.y+xt*Bt;var Tt,Vt,kt=St;Tt=gt.x+ft*kt,Vt=gt.y+xt*kt;var It,Ot,Rt=Ct;It=zt.x+yt*Rt,Ot=zt.y+vt*Rt;var Ht,Ft,Dt=Nt;Ht=zt.x+yt*Dt,Ft=zt.y+vt*Dt;var Gt,Ut,jt,Wt,qt,Jt,$t,Xt,Yt=(Gt=At-zt.x)*Gt+(Ut=Lt-zt.y)*Ut,Kt=(jt=Tt-wt.x)*jt+(Wt=Vt-wt.y)*Wt,Qt=(qt=It-gt.x)*qt+(Jt=Ot-gt.y)*Jt,en=($t=Ht-bt.x)*$t+(Xt=Ft-bt.y)*Xt,tn=0,nn=0,rn=null;Yt<Kt?(tn=At,nn=Lt,rn=zt):(tn=Tt,nn=Vt,rn=wt,Yt=Kt);var on=0,an=0,sn=null;if(Qt<en?(on=It,an=Ot,sn=gt):(on=Ht,an=Ft,sn=bt,Qt=en),Yt<Qt?(pe.x=tn,pe.y=nn,ue.x=rn.x,ue.y=rn.y,qe=Math.sqrt(Yt)):(ue.x=on,ue.y=an,pe.x=sn.x,pe.y=sn.y,qe=Math.sqrt(Qt)),0!=qe){f.x=ue.x-pe.x,f.y=ue.y-pe.y;var ln=1/qe;f.x*=ln,f.y*=ln,ve&&(f.x=-f.x,f.y=-f.y)}ae=qe}else{var pn=0,un=0;pn=ct.gp0.x,un=ct.gp0.y;var hn,cn,_n=0,dn=0;hn=(_n=ct.gp1.x)-pn,cn=(dn=ct.gp1.y)-un;var mn=ut.gnormy*pn-ut.gnormx*un,Pn=ut.gnormy*_n-ut.gnormx*dn,fn=1/(Pn-mn),xn=(-ut.tp1-mn)*fn;xn>e.Config.epsilon&&(pn+=hn*xn,un+=cn*xn);var yn=(-ut.tp0-Pn)*fn;yn<-e.Config.epsilon&&(_n+=hn*yn,dn+=cn*yn);var vn=pn*ut.gnormx+un*ut.gnormy-ut.gprojection,gn=_n*ut.gnormx+dn*ut.gnormy-ut.gprojection;if(vn<gn){ue.x=pn,ue.y=un;var bn=-vn;pe.x=ue.x+ut.gnormx*bn,pe.y=ue.y+ut.gnormy*bn,ae=vn}else{ue.x=_n,ue.y=dn;var zn=-gn;pe.x=ue.x+ut.gnormx*zn,pe.y=ue.y+ut.gnormy*zn,ae=gn}}}else ae=1e100}else ae=1e100}}var wn=ae+r,Zn=a*f.x+s*f.y;if(wn<e.Config.distanceThresholdCCD){if(o)break;var En,Mn,Sn,Cn;En=m.x-u.posx,Mn=m.y-u.posy,Sn=P.x-h.posx,Cn=P.y-h.posy;var Nn=Zn-u.sweep_angvel*(f.y*En-f.x*Mn)+h.sweep_angvel*(f.y*Sn-f.x*Cn);if(Nn>0&&(t.slipped=!0),Nn<=0||wn<.5*e.Config.distanceThresholdCCD)break}var An=(d-Zn)*n;if(An<=0){x=-1;break}var Ln=wn/An;if(Ln<1e-6&&(Ln=1e-6),(x+=Ln)>=1){var Bn=(x=1)*n,Tn=Bn-u.sweepTime;if(0!=Tn){u.sweepTime=Bn;var Vn=Tn;if(u.posx+=u.velx*Vn,u.posy+=u.vely*Vn,0!=u.angvel){var kn=u.sweep_angvel*Tn;if(u.rot+=kn,kn*kn>1e-4)u.axisx=Math.sin(u.rot),u.axisy=Math.cos(u.rot);else{var In=kn*kn,On=1-.5*In,Rn=1-In*In/8,Hn=(On*u.axisx+kn*u.axisy)*Rn;u.axisy=(On*u.axisy-kn*u.axisx)*Rn,u.axisx=Hn}}}if(0==l.type)l.worldCOMx=u.posx+(u.axisy*l.localCOMx-u.axisx*l.localCOMy),l.worldCOMy=u.posy+(l.localCOMx*u.axisx+l.localCOMy*u.axisy);else{for(var Fn=l.polygon,Dn=Fn.lverts.next,Gn=Fn.gverts.next;null!=Gn;){var Un=Gn,jn=Dn;Dn=Dn.next,Un.x=u.posx+(u.axisy*jn.x-u.axisx*jn.y),Un.y=u.posy+(jn.x*u.axisx+jn.y*u.axisy),Gn=Gn.next}var Wn=Fn.edges.head,qn=Fn.gverts.next,Jn=qn;for(qn=qn.next;null!=qn;){var $n=qn,Xn=Wn.elt;Wn=Wn.next,Xn.gnormx=u.axisy*Xn.lnormx-u.axisx*Xn.lnormy,Xn.gnormy=Xn.lnormx*u.axisx+Xn.lnormy*u.axisy,Xn.gprojection=u.posx*Xn.gnormx+u.posy*Xn.gnormy+Xn.lprojection,Xn.tp0=Jn.y*Xn.gnormx-Jn.x*Xn.gnormy,Xn.tp1=$n.y*Xn.gnormx-$n.x*Xn.gnormy,Jn=$n,qn=qn.next}var Yn=Fn.gverts.next,Kn=Wn.elt;Wn=Wn.next,Kn.gnormx=u.axisy*Kn.lnormx-u.axisx*Kn.lnormy,Kn.gnormy=Kn.lnormx*u.axisx+Kn.lnormy*u.axisy,Kn.gprojection=u.posx*Kn.gnormx+u.posy*Kn.gnormy+Kn.lprojection,Kn.tp0=Jn.y*Kn.gnormx-Jn.x*Kn.gnormy,Kn.tp1=Yn.y*Kn.gnormx-Yn.x*Kn.gnormy}var Qn=x*n,ei=Qn-h.sweepTime;if(0!=ei){h.sweepTime=Qn;var ti=ei;if(h.posx+=h.velx*ti,h.posy+=h.vely*ti,0!=h.angvel){var ni=h.sweep_angvel*ei;if(h.rot+=ni,ni*ni>1e-4)h.axisx=Math.sin(h.rot),h.axisy=Math.cos(h.rot);else{var ii=ni*ni,ri=1-.5*ii,oi=1-ii*ii/8,ai=(ri*h.axisx+ni*h.axisy)*oi;h.axisy=(ri*h.axisy-ni*h.axisx)*oi,h.axisx=ai}}}if(0==p.type)p.worldCOMx=h.posx+(h.axisy*p.localCOMx-h.axisx*p.localCOMy),p.worldCOMy=h.posy+(p.localCOMx*h.axisx+p.localCOMy*h.axisy);else{for(var si=p.polygon,li=si.lverts.next,pi=si.gverts.next;null!=pi;){var ui=pi,hi=li;li=li.next,ui.x=h.posx+(h.axisy*hi.x-h.axisx*hi.y),ui.y=h.posy+(hi.x*h.axisx+hi.y*h.axisy),pi=pi.next}var ci=si.edges.head,_i=si.gverts.next,di=_i;for(_i=_i.next;null!=_i;){var mi=_i,Pi=ci.elt;ci=ci.next,Pi.gnormx=h.axisy*Pi.lnormx-h.axisx*Pi.lnormy,Pi.gnormy=Pi.lnormx*h.axisx+Pi.lnormy*h.axisy,Pi.gprojection=h.posx*Pi.gnormx+h.posy*Pi.gnormy+Pi.lprojection,Pi.tp0=di.y*Pi.gnormx-di.x*Pi.gnormy,Pi.tp1=mi.y*Pi.gnormx-mi.x*Pi.gnormy,di=mi,_i=_i.next}var fi=si.gverts.next,xi=ci.elt;ci=ci.next,xi.gnormx=h.axisy*xi.lnormx-h.axisx*xi.lnormy,xi.gnormy=xi.lnormx*h.axisx+xi.lnormy*h.axisy,xi.gprojection=h.posx*xi.gnormx+h.posy*xi.gnormy+xi.lprojection,xi.tp0=di.y*xi.gnormx-di.x*xi.gnormy,xi.tp1=fi.y*xi.gnormx-fi.x*xi.gnormy}var yi,vi=l,gi=p,bi=m,zi=P;if(0==vi.type&&0==gi.type){var wi,Zi=vi.circle,Ei=gi.circle,Mi=0,Si=0;Mi=Ei.worldCOMx-Zi.worldCOMx,Si=Ei.worldCOMy-Zi.worldCOMy;var Ci=Math.sqrt(Mi*Mi+Si*Si);if((wi=Ci-(Zi.radius+Ei.radius))<1e100){if(0==Ci)Mi=1,Si=0;else{var Ni=1/Ci;Mi*=Ni,Si*=Ni}var Ai=Zi.radius;bi.x=Zi.worldCOMx+Mi*Ai,bi.y=Zi.worldCOMy+Si*Ai;var Li=-Ei.radius;zi.x=Ei.worldCOMx+Mi*Li,zi.y=Ei.worldCOMy+Si*Li,f.x=Mi,f.y=Si}yi=wi}else{var Bi=!1;if(0==vi.type&&1==gi.type){var Ti=vi;vi=gi,gi=Ti;var Vi=bi;bi=zi,zi=Vi,Bi=!0}if(1==vi.type&&0==gi.type){for(var ki=vi.polygon,Ii=gi.circle,Oi=-1e100,Ri=null,Hi=ki.edges.head;null!=Hi;){var Fi=Hi.elt,Di=Fi.gnormx*Ii.worldCOMx+Fi.gnormy*Ii.worldCOMy-Fi.gprojection-Ii.radius;if(Di>1e100){Oi=Di;break}Di>0?Di>Oi&&(Oi=Di,Ri=Fi):Oi<0&&Di>Oi&&(Oi=Di,Ri=Fi),Hi=Hi.next}if(Oi<1e100){var Gi=Ri.gp0,Ui=Ri.gp1,ji=Ii.worldCOMy*Ri.gnormx-Ii.worldCOMx*Ri.gnormy;if(ji<=Gi.y*Ri.gnormx-Gi.x*Ri.gnormy){var Wi=0,qi=0;Wi=Ii.worldCOMx-Gi.x,qi=Ii.worldCOMy-Gi.y;var Ji=Math.sqrt(Wi*Wi+qi*qi);if((Oi=Ji-Ii.radius)<1e100){if(0==Ji)Wi=1,qi=0;else{var $i=1/Ji;Wi*=$i,qi*=$i}bi.x=Gi.x+0*Wi,bi.y=Gi.y+0*qi;var Xi=-Ii.radius;zi.x=Ii.worldCOMx+Wi*Xi,zi.y=Ii.worldCOMy+qi*Xi,f.x=Wi,f.y=qi}}else if(ji>=Ui.y*Ri.gnormx-Ui.x*Ri.gnormy){var Yi=0,Ki=0;Yi=Ii.worldCOMx-Ui.x,Ki=Ii.worldCOMy-Ui.y;var Qi=Math.sqrt(Yi*Yi+Ki*Ki);if((Oi=Qi-Ii.radius)<1e100){if(0==Qi)Yi=1,Ki=0;else{var er=1/Qi;Yi*=er,Ki*=er}bi.x=Ui.x+0*Yi,bi.y=Ui.y+0*Ki;var tr=-Ii.radius;zi.x=Ii.worldCOMx+Yi*tr,zi.y=Ii.worldCOMy+Ki*tr,f.x=Yi,f.y=Ki}}else{var nr=-Ii.radius;zi.x=Ii.worldCOMx+Ri.gnormx*nr,zi.y=Ii.worldCOMy+Ri.gnormy*nr;var ir=-Oi;bi.x=zi.x+Ri.gnormx*ir,bi.y=zi.y+Ri.gnormy*ir,f.x=Ri.gnormx,f.y=Ri.gnormy}}Bi&&(f.x=-f.x,f.y=-f.y),yi=Oi}else{for(var rr=vi.polygon,or=gi.polygon,ar=-1e100,sr=null,lr=null,pr=0,ur=rr.edges.head;null!=ur;){for(var hr=ur.elt,cr=1e100,_r=or.gverts.next;null!=_r;){var dr=_r,mr=hr.gnormx*dr.x+hr.gnormy*dr.y;mr<cr&&(cr=mr),_r=_r.next}if((cr-=hr.gprojection)>1e100){ar=cr;break}cr>0?cr>ar&&(ar=cr,sr=hr,pr=1):ar<0&&cr>ar&&(ar=cr,sr=hr,pr=1),ur=ur.next}if(ar<1e100){for(var Pr=or.edges.head;null!=Pr;){for(var fr=Pr.elt,xr=1e100,yr=rr.gverts.next;null!=yr;){var vr=yr,gr=fr.gnormx*vr.x+fr.gnormy*vr.y;gr<xr&&(xr=gr),yr=yr.next}if((xr-=fr.gprojection)>1e100){ar=xr;break}xr>0?xr>ar&&(ar=xr,lr=fr,pr=2):ar<0&&xr>ar&&(ar=xr,lr=fr,pr=2),Pr=Pr.next}if(ar<1e100){var br,zr;if(1==pr)br=or,zr=sr;else{br=rr,zr=lr;var wr=bi;bi=zi,zi=wr,Bi=!Bi}for(var Zr=null,Er=1e100,Mr=br.edges.head;null!=Mr;){var Sr=Mr.elt,Cr=zr.gnormx*Sr.gnormx+zr.gnormy*Sr.gnormy;Cr<Er&&(Er=Cr,Zr=Sr),Mr=Mr.next}if(Bi?(f.x=-zr.gnormx,f.y=-zr.gnormy):(f.x=zr.gnormx,f.y=zr.gnormy),ar>=0){var Nr,Ar,Lr,Br,Tr=zr.gp0,Vr=zr.gp1,kr=Zr.gp0,Ir=Zr.gp1,Or=1/((Nr=Vr.x-Tr.x)*Nr+(Ar=Vr.y-Tr.y)*Ar),Rr=1/((Lr=Ir.x-kr.x)*Lr+(Br=Ir.y-kr.y)*Br),Hr=-(Nr*(Tr.x-kr.x)+Ar*(Tr.y-kr.y))*Or,Fr=-(Nr*(Tr.x-Ir.x)+Ar*(Tr.y-Ir.y))*Or,Dr=-(Lr*(kr.x-Tr.x)+Br*(kr.y-Tr.y))*Rr,Gr=-(Lr*(kr.x-Vr.x)+Br*(kr.y-Vr.y))*Rr;Hr<0?Hr=0:Hr>1&&(Hr=1),Fr<0?Fr=0:Fr>1&&(Fr=1),Dr<0?Dr=0:Dr>1&&(Dr=1),Gr<0?Gr=0:Gr>1&&(Gr=1);var Ur,jr,Wr=Hr;Ur=Tr.x+Nr*Wr,jr=Tr.y+Ar*Wr;var qr,Jr,$r=Fr;qr=Tr.x+Nr*$r,Jr=Tr.y+Ar*$r;var Xr,Yr,Kr=Dr;Xr=kr.x+Lr*Kr,Yr=kr.y+Br*Kr;var Qr,eo,to=Gr;Qr=kr.x+Lr*to,eo=kr.y+Br*to;var no,io,ro,oo,ao,so,lo,po,uo=(no=Ur-kr.x)*no+(io=jr-kr.y)*io,ho=(ro=qr-Ir.x)*ro+(oo=Jr-Ir.y)*oo,co=(ao=Xr-Tr.x)*ao+(so=Yr-Tr.y)*so,_o=(lo=Qr-Vr.x)*lo+(po=eo-Vr.y)*po,mo=0,Po=0,fo=null;uo<ho?(mo=Ur,Po=jr,fo=kr):(mo=qr,Po=Jr,fo=Ir,uo=ho);var xo=0,yo=0,vo=null;if(co<_o?(xo=Xr,yo=Yr,vo=Tr):(xo=Qr,yo=eo,vo=Vr,co=_o),uo<co?(bi.x=mo,bi.y=Po,zi.x=fo.x,zi.y=fo.y,ar=Math.sqrt(uo)):(zi.x=xo,zi.y=yo,bi.x=vo.x,bi.y=vo.y,ar=Math.sqrt(co)),0!=ar){f.x=zi.x-bi.x,f.y=zi.y-bi.y;var go=1/ar;f.x*=go,f.y*=go,Bi&&(f.x=-f.x,f.y=-f.y)}yi=ar}else{var bo=0,zo=0;bo=Zr.gp0.x,zo=Zr.gp0.y;var wo,Zo,Eo=0,Mo=0;wo=(Eo=Zr.gp1.x)-bo,Zo=(Mo=Zr.gp1.y)-zo;var So=zr.gnormy*bo-zr.gnormx*zo,Co=zr.gnormy*Eo-zr.gnormx*Mo,No=1/(Co-So),Ao=(-zr.tp1-So)*No;Ao>e.Config.epsilon&&(bo+=wo*Ao,zo+=Zo*Ao);var Lo=(-zr.tp0-Co)*No;Lo<-e.Config.epsilon&&(Eo+=wo*Lo,Mo+=Zo*Lo);var Bo=bo*zr.gnormx+zo*zr.gnormy-zr.gprojection,To=Eo*zr.gnormx+Mo*zr.gnormy-zr.gprojection;if(Bo<To){zi.x=bo,zi.y=zo;var Vo=-Bo;bi.x=zi.x+zr.gnormx*Vo,bi.y=zi.y+zr.gnormy*Vo,yi=Bo}else{zi.x=Eo,zi.y=Mo;var ko=-To;bi.x=zi.x+zr.gnormx*ko,bi.y=zi.y+zr.gnormy*ko,yi=To}}}else yi=1e100}else yi=1e100}}var Io=yi+r,Oo=a*f.x+s*f.y;if(Io<e.Config.distanceThresholdCCD){if(o)break;var Ro,Ho,Fo,Do;Ro=m.x-u.posx,Ho=m.y-u.posy,Fo=P.x-h.posx,Do=P.y-h.posy;var Go=Oo-u.sweep_angvel*(f.y*Ro-f.x*Ho)+h.sweep_angvel*(f.y*Fo-f.x*Do);if(Go>0&&(t.slipped=!0),Go<=0||Io<.5*e.Config.distanceThresholdCCD)break}x=-1;break}if(++y>=40){wn>r&&(t.failed=!0);break}}t.toi=x},t.geom.ZPP_SweepDistance.staticSweep=function(t,n,i,r){var o,a,s=t.s1,l=t.s2,p=s.body;l.body,o=-p.velx,a=-p.vely;var u=p.sweep_angvel;u<0&&(u=-u);for(var h=s.sweepCoef*u,c=t.c1,_=t.c2,d=t.axis,m=i,P=0;;){var f=m*n,x=f-p.sweepTime;if(0!=x){p.sweepTime=f;var y=x;if(p.posx+=p.velx*y,p.posy+=p.vely*y,0!=p.angvel){var v=p.sweep_angvel*x;if(p.rot+=v,v*v>1e-4)p.axisx=Math.sin(p.rot),p.axisy=Math.cos(p.rot);else{var g=v*v,b=1-.5*g,z=1-g*g/8,w=(b*p.axisx+v*p.axisy)*z;p.axisy=(b*p.axisy-v*p.axisx)*z,p.axisx=w}}}if(0==s.type)s.worldCOMx=p.posx+(p.axisy*s.localCOMx-p.axisx*s.localCOMy),s.worldCOMy=p.posy+(s.localCOMx*p.axisx+s.localCOMy*p.axisy);else{for(var Z=s.polygon,E=Z.lverts.next,M=Z.gverts.next;null!=M;){var S=M,C=E;E=E.next,S.x=p.posx+(p.axisy*C.x-p.axisx*C.y),S.y=p.posy+(C.x*p.axisx+C.y*p.axisy),M=M.next}var N=Z.edges.head,A=Z.gverts.next,L=A;for(A=A.next;null!=A;){var B=A,T=N.elt;N=N.next,T.gnormx=p.axisy*T.lnormx-p.axisx*T.lnormy,T.gnormy=T.lnormx*p.axisx+T.lnormy*p.axisy,T.gprojection=p.posx*T.gnormx+p.posy*T.gnormy+T.lprojection,T.tp0=L.y*T.gnormx-L.x*T.gnormy,T.tp1=B.y*T.gnormx-B.x*T.gnormy,L=B,A=A.next}var V=Z.gverts.next,k=N.elt;N=N.next,k.gnormx=p.axisy*k.lnormx-p.axisx*k.lnormy,k.gnormy=k.lnormx*p.axisx+k.lnormy*p.axisy,k.gprojection=p.posx*k.gnormx+p.posy*k.gnormy+k.lprojection,k.tp0=L.y*k.gnormx-L.x*k.gnormy,k.tp1=V.y*k.gnormx-V.x*k.gnormy}var I,O=s,R=l,H=c,F=_;if(0==O.type&&0==R.type){var D,G=O.circle,U=R.circle,j=0,W=0;j=U.worldCOMx-G.worldCOMx,W=U.worldCOMy-G.worldCOMy;var q=Math.sqrt(j*j+W*W);if((D=q-(G.radius+U.radius))<1e100){if(0==q)j=1,W=0;else{var J=1/q;j*=J,W*=J}var $=G.radius;H.x=G.worldCOMx+j*$,H.y=G.worldCOMy+W*$;var X=-U.radius;F.x=U.worldCOMx+j*X,F.y=U.worldCOMy+W*X,d.x=j,d.y=W}I=D}else{var Y=!1;if(0==O.type&&1==R.type){var K=O;O=R,R=K;var Q=H;H=F,F=Q,Y=!0}if(1==O.type&&0==R.type){for(var ee=O.polygon,te=R.circle,ne=-1e100,ie=null,re=ee.edges.head;null!=re;){var oe=re.elt,ae=oe.gnormx*te.worldCOMx+oe.gnormy*te.worldCOMy-oe.gprojection-te.radius;if(ae>1e100){ne=ae;break}ae>0?ae>ne&&(ne=ae,ie=oe):ne<0&&ae>ne&&(ne=ae,ie=oe),re=re.next}if(ne<1e100){var se=ie.gp0,le=ie.gp1,pe=te.worldCOMy*ie.gnormx-te.worldCOMx*ie.gnormy;if(pe<=se.y*ie.gnormx-se.x*ie.gnormy){var ue=0,he=0;ue=te.worldCOMx-se.x,he=te.worldCOMy-se.y;var ce=Math.sqrt(ue*ue+he*he);if((ne=ce-te.radius)<1e100){if(0==ce)ue=1,he=0;else{var _e=1/ce;ue*=_e,he*=_e}H.x=se.x+0*ue,H.y=se.y+0*he;var de=-te.radius;F.x=te.worldCOMx+ue*de,F.y=te.worldCOMy+he*de,d.x=ue,d.y=he}}else if(pe>=le.y*ie.gnormx-le.x*ie.gnormy){var me=0,Pe=0;me=te.worldCOMx-le.x,Pe=te.worldCOMy-le.y;var fe=Math.sqrt(me*me+Pe*Pe);if((ne=fe-te.radius)<1e100){if(0==fe)me=1,Pe=0;else{var xe=1/fe;me*=xe,Pe*=xe}H.x=le.x+0*me,H.y=le.y+0*Pe;var ye=-te.radius;F.x=te.worldCOMx+me*ye,F.y=te.worldCOMy+Pe*ye,d.x=me,d.y=Pe}}else{var ve=-te.radius;F.x=te.worldCOMx+ie.gnormx*ve,F.y=te.worldCOMy+ie.gnormy*ve;var ge=-ne;H.x=F.x+ie.gnormx*ge,H.y=F.y+ie.gnormy*ge,d.x=ie.gnormx,d.y=ie.gnormy}}Y&&(d.x=-d.x,d.y=-d.y),I=ne}else{for(var be=O.polygon,ze=R.polygon,we=-1e100,Ze=null,Ee=null,Me=0,Se=be.edges.head;null!=Se;){for(var Ce=Se.elt,Ne=1e100,Ae=ze.gverts.next;null!=Ae;){var Le=Ae,Be=Ce.gnormx*Le.x+Ce.gnormy*Le.y;Be<Ne&&(Ne=Be),Ae=Ae.next}if((Ne-=Ce.gprojection)>1e100){we=Ne;break}Ne>0?Ne>we&&(we=Ne,Ze=Ce,Me=1):we<0&&Ne>we&&(we=Ne,Ze=Ce,Me=1),Se=Se.next}if(we<1e100){for(var Te=ze.edges.head;null!=Te;){for(var Ve=Te.elt,ke=1e100,Ie=be.gverts.next;null!=Ie;){var Oe=Ie,Re=Ve.gnormx*Oe.x+Ve.gnormy*Oe.y;Re<ke&&(ke=Re),Ie=Ie.next}if((ke-=Ve.gprojection)>1e100){we=ke;break}ke>0?ke>we&&(we=ke,Ee=Ve,Me=2):we<0&&ke>we&&(we=ke,Ee=Ve,Me=2),Te=Te.next}if(we<1e100){var He,Fe;if(1==Me)He=ze,Fe=Ze;else{He=be,Fe=Ee;var De=H;H=F,F=De,Y=!Y}for(var Ge=null,Ue=1e100,je=He.edges.head;null!=je;){var We=je.elt,qe=Fe.gnormx*We.gnormx+Fe.gnormy*We.gnormy;qe<Ue&&(Ue=qe,Ge=We),je=je.next}if(Y?(d.x=-Fe.gnormx,d.y=-Fe.gnormy):(d.x=Fe.gnormx,d.y=Fe.gnormy),we>=0){var Je,$e,Xe,Ye,Ke=Fe.gp0,Qe=Fe.gp1,et=Ge.gp0,tt=Ge.gp1,nt=1/((Je=Qe.x-Ke.x)*Je+($e=Qe.y-Ke.y)*$e),it=1/((Xe=tt.x-et.x)*Xe+(Ye=tt.y-et.y)*Ye),rt=-(Je*(Ke.x-et.x)+$e*(Ke.y-et.y))*nt,ot=-(Je*(Ke.x-tt.x)+$e*(Ke.y-tt.y))*nt,at=-(Xe*(et.x-Ke.x)+Ye*(et.y-Ke.y))*it,st=-(Xe*(et.x-Qe.x)+Ye*(et.y-Qe.y))*it;rt<0?rt=0:rt>1&&(rt=1),ot<0?ot=0:ot>1&&(ot=1),at<0?at=0:at>1&&(at=1),st<0?st=0:st>1&&(st=1);var lt,pt,ut=rt;lt=Ke.x+Je*ut,pt=Ke.y+$e*ut;var ht,ct,_t=ot;ht=Ke.x+Je*_t,ct=Ke.y+$e*_t;var dt,mt,Pt=at;dt=et.x+Xe*Pt,mt=et.y+Ye*Pt;var ft,xt,yt=st;ft=et.x+Xe*yt,xt=et.y+Ye*yt;var vt,gt,bt,zt,wt,Zt,Et,Mt,St=(vt=lt-et.x)*vt+(gt=pt-et.y)*gt,Ct=(bt=ht-tt.x)*bt+(zt=ct-tt.y)*zt,Nt=(wt=dt-Ke.x)*wt+(Zt=mt-Ke.y)*Zt,At=(Et=ft-Qe.x)*Et+(Mt=xt-Qe.y)*Mt,Lt=0,Bt=0,Tt=null;St<Ct?(Lt=lt,Bt=pt,Tt=et):(Lt=ht,Bt=ct,Tt=tt,St=Ct);var Vt=0,kt=0,It=null;if(Nt<At?(Vt=dt,kt=mt,It=Ke):(Vt=ft,kt=xt,It=Qe,Nt=At),St<Nt?(H.x=Lt,H.y=Bt,F.x=Tt.x,F.y=Tt.y,we=Math.sqrt(St)):(F.x=Vt,F.y=kt,H.x=It.x,H.y=It.y,we=Math.sqrt(Nt)),0!=we){d.x=F.x-H.x,d.y=F.y-H.y;var Ot=1/we;d.x*=Ot,d.y*=Ot,Y&&(d.x=-d.x,d.y=-d.y)}I=we}else{var Rt=0,Ht=0;Rt=Ge.gp0.x,Ht=Ge.gp0.y;var Ft,Dt,Gt=0,Ut=0;Ft=(Gt=Ge.gp1.x)-Rt,Dt=(Ut=Ge.gp1.y)-Ht;var jt=Fe.gnormy*Rt-Fe.gnormx*Ht,Wt=Fe.gnormy*Gt-Fe.gnormx*Ut,qt=1/(Wt-jt),Jt=(-Fe.tp1-jt)*qt;Jt>e.Config.epsilon&&(Rt+=Ft*Jt,Ht+=Dt*Jt);var $t=(-Fe.tp0-Wt)*qt;$t<-e.Config.epsilon&&(Gt+=Ft*$t,Ut+=Dt*$t);var Xt=Rt*Fe.gnormx+Ht*Fe.gnormy-Fe.gprojection,Yt=Gt*Fe.gnormx+Ut*Fe.gnormy-Fe.gprojection;if(Xt<Yt){F.x=Rt,F.y=Ht;var Kt=-Xt;H.x=F.x+Fe.gnormx*Kt,H.y=F.y+Fe.gnormy*Kt,I=Xt}else{F.x=Gt,F.y=Ut;var Qt=-Yt;H.x=F.x+Fe.gnormx*Qt,H.y=F.y+Fe.gnormy*Qt,I=Yt}}}else I=1e100}else I=1e100}}var en=I+r,tn=o*d.x+a*d.y;if(en<e.Config.distanceThresholdCCD){var nn,rn;nn=c.x-p.posx,rn=c.y-p.posy;var on=tn-p.sweep_angvel*(d.y*nn-d.x*rn);if(on>0&&(t.slipped=!0),on<=0||en<.5*e.Config.distanceThresholdCCD)break}var an=(h-tn)*n;if(an<=0){m=-1;break}var sn=en/an;if(sn<1e-6&&(sn=1e-6),(m+=sn)>=1){var ln=(m=1)*n,pn=ln-p.sweepTime;if(0!=pn){p.sweepTime=ln;var un=pn;if(p.posx+=p.velx*un,p.posy+=p.vely*un,0!=p.angvel){var hn=p.sweep_angvel*pn;if(p.rot+=hn,hn*hn>1e-4)p.axisx=Math.sin(p.rot),p.axisy=Math.cos(p.rot);else{var cn=hn*hn,_n=1-.5*cn,dn=1-cn*cn/8,mn=(_n*p.axisx+hn*p.axisy)*dn;p.axisy=(_n*p.axisy-hn*p.axisx)*dn,p.axisx=mn}}}if(0==s.type)s.worldCOMx=p.posx+(p.axisy*s.localCOMx-p.axisx*s.localCOMy),s.worldCOMy=p.posy+(s.localCOMx*p.axisx+s.localCOMy*p.axisy);else{for(var Pn=s.polygon,fn=Pn.lverts.next,xn=Pn.gverts.next;null!=xn;){var yn=xn,vn=fn;fn=fn.next,yn.x=p.posx+(p.axisy*vn.x-p.axisx*vn.y),yn.y=p.posy+(vn.x*p.axisx+vn.y*p.axisy),xn=xn.next}var gn=Pn.edges.head,bn=Pn.gverts.next,zn=bn;for(bn=bn.next;null!=bn;){var wn=bn,Zn=gn.elt;gn=gn.next,Zn.gnormx=p.axisy*Zn.lnormx-p.axisx*Zn.lnormy,Zn.gnormy=Zn.lnormx*p.axisx+Zn.lnormy*p.axisy,Zn.gprojection=p.posx*Zn.gnormx+p.posy*Zn.gnormy+Zn.lprojection,Zn.tp0=zn.y*Zn.gnormx-zn.x*Zn.gnormy,Zn.tp1=wn.y*Zn.gnormx-wn.x*Zn.gnormy,zn=wn,bn=bn.next}var En=Pn.gverts.next,Mn=gn.elt;gn=gn.next,Mn.gnormx=p.axisy*Mn.lnormx-p.axisx*Mn.lnormy,Mn.gnormy=Mn.lnormx*p.axisx+Mn.lnormy*p.axisy,Mn.gprojection=p.posx*Mn.gnormx+p.posy*Mn.gnormy+Mn.lprojection,Mn.tp0=zn.y*Mn.gnormx-zn.x*Mn.gnormy,Mn.tp1=En.y*Mn.gnormx-En.x*Mn.gnormy}var Sn,Cn=s,Nn=l,An=c,Ln=_;if(0==Cn.type&&0==Nn.type){var Bn,Tn=Cn.circle,Vn=Nn.circle,kn=0,In=0;kn=Vn.worldCOMx-Tn.worldCOMx,In=Vn.worldCOMy-Tn.worldCOMy;var On=Math.sqrt(kn*kn+In*In);if((Bn=On-(Tn.radius+Vn.radius))<1e100){if(0==On)kn=1,In=0;else{var Rn=1/On;kn*=Rn,In*=Rn}var Hn=Tn.radius;An.x=Tn.worldCOMx+kn*Hn,An.y=Tn.worldCOMy+In*Hn;var Fn=-Vn.radius;Ln.x=Vn.worldCOMx+kn*Fn,Ln.y=Vn.worldCOMy+In*Fn,d.x=kn,d.y=In}Sn=Bn}else{var Dn=!1;if(0==Cn.type&&1==Nn.type){var Gn=Cn;Cn=Nn,Nn=Gn;var Un=An;An=Ln,Ln=Un,Dn=!0}if(1==Cn.type&&0==Nn.type){for(var jn=Cn.polygon,Wn=Nn.circle,qn=-1e100,Jn=null,$n=jn.edges.head;null!=$n;){var Xn=$n.elt,Yn=Xn.gnormx*Wn.worldCOMx+Xn.gnormy*Wn.worldCOMy-Xn.gprojection-Wn.radius;if(Yn>1e100){qn=Yn;break}Yn>0?Yn>qn&&(qn=Yn,Jn=Xn):qn<0&&Yn>qn&&(qn=Yn,Jn=Xn),$n=$n.next}if(qn<1e100){var Kn=Jn.gp0,Qn=Jn.gp1,ei=Wn.worldCOMy*Jn.gnormx-Wn.worldCOMx*Jn.gnormy;if(ei<=Kn.y*Jn.gnormx-Kn.x*Jn.gnormy){var ti=0,ni=0;ti=Wn.worldCOMx-Kn.x,ni=Wn.worldCOMy-Kn.y;var ii=Math.sqrt(ti*ti+ni*ni);if((qn=ii-Wn.radius)<1e100){if(0==ii)ti=1,ni=0;else{var ri=1/ii;ti*=ri,ni*=ri}An.x=Kn.x+0*ti,An.y=Kn.y+0*ni;var oi=-Wn.radius;Ln.x=Wn.worldCOMx+ti*oi,Ln.y=Wn.worldCOMy+ni*oi,d.x=ti,d.y=ni}}else if(ei>=Qn.y*Jn.gnormx-Qn.x*Jn.gnormy){var ai=0,si=0;ai=Wn.worldCOMx-Qn.x,si=Wn.worldCOMy-Qn.y;var li=Math.sqrt(ai*ai+si*si);if((qn=li-Wn.radius)<1e100){if(0==li)ai=1,si=0;else{var pi=1/li;ai*=pi,si*=pi}An.x=Qn.x+0*ai,An.y=Qn.y+0*si;var ui=-Wn.radius;Ln.x=Wn.worldCOMx+ai*ui,Ln.y=Wn.worldCOMy+si*ui,d.x=ai,d.y=si}}else{var hi=-Wn.radius;Ln.x=Wn.worldCOMx+Jn.gnormx*hi,Ln.y=Wn.worldCOMy+Jn.gnormy*hi;var ci=-qn;An.x=Ln.x+Jn.gnormx*ci,An.y=Ln.y+Jn.gnormy*ci,d.x=Jn.gnormx,d.y=Jn.gnormy}}Dn&&(d.x=-d.x,d.y=-d.y),Sn=qn}else{for(var _i=Cn.polygon,di=Nn.polygon,mi=-1e100,Pi=null,fi=null,xi=0,yi=_i.edges.head;null!=yi;){for(var vi=yi.elt,gi=1e100,bi=di.gverts.next;null!=bi;){var zi=bi,wi=vi.gnormx*zi.x+vi.gnormy*zi.y;wi<gi&&(gi=wi),bi=bi.next}if((gi-=vi.gprojection)>1e100){mi=gi;break}gi>0?gi>mi&&(mi=gi,Pi=vi,xi=1):mi<0&&gi>mi&&(mi=gi,Pi=vi,xi=1),yi=yi.next}if(mi<1e100){for(var Zi=di.edges.head;null!=Zi;){for(var Ei=Zi.elt,Mi=1e100,Si=_i.gverts.next;null!=Si;){var Ci=Si,Ni=Ei.gnormx*Ci.x+Ei.gnormy*Ci.y;Ni<Mi&&(Mi=Ni),Si=Si.next}if((Mi-=Ei.gprojection)>1e100){mi=Mi;break}Mi>0?Mi>mi&&(mi=Mi,fi=Ei,xi=2):mi<0&&Mi>mi&&(mi=Mi,fi=Ei,xi=2),Zi=Zi.next}if(mi<1e100){var Ai,Li;if(1==xi)Ai=di,Li=Pi;else{Ai=_i,Li=fi;var Bi=An;An=Ln,Ln=Bi,Dn=!Dn}for(var Ti=null,Vi=1e100,ki=Ai.edges.head;null!=ki;){var Ii=ki.elt,Oi=Li.gnormx*Ii.gnormx+Li.gnormy*Ii.gnormy;Oi<Vi&&(Vi=Oi,Ti=Ii),ki=ki.next}if(Dn?(d.x=-Li.gnormx,d.y=-Li.gnormy):(d.x=Li.gnormx,d.y=Li.gnormy),mi>=0){var Ri,Hi,Fi,Di,Gi=Li.gp0,Ui=Li.gp1,ji=Ti.gp0,Wi=Ti.gp1,qi=1/((Ri=Ui.x-Gi.x)*Ri+(Hi=Ui.y-Gi.y)*Hi),Ji=1/((Fi=Wi.x-ji.x)*Fi+(Di=Wi.y-ji.y)*Di),$i=-(Ri*(Gi.x-ji.x)+Hi*(Gi.y-ji.y))*qi,Xi=-(Ri*(Gi.x-Wi.x)+Hi*(Gi.y-Wi.y))*qi,Yi=-(Fi*(ji.x-Gi.x)+Di*(ji.y-Gi.y))*Ji,Ki=-(Fi*(ji.x-Ui.x)+Di*(ji.y-Ui.y))*Ji;$i<0?$i=0:$i>1&&($i=1),Xi<0?Xi=0:Xi>1&&(Xi=1),Yi<0?Yi=0:Yi>1&&(Yi=1),Ki<0?Ki=0:Ki>1&&(Ki=1);var Qi,er,tr=$i;Qi=Gi.x+Ri*tr,er=Gi.y+Hi*tr;var nr,ir,rr=Xi;nr=Gi.x+Ri*rr,ir=Gi.y+Hi*rr;var or,ar,sr=Yi;or=ji.x+Fi*sr,ar=ji.y+Di*sr;var lr,pr,ur=Ki;lr=ji.x+Fi*ur,pr=ji.y+Di*ur;var hr,cr,_r,dr,mr,Pr,fr,xr,yr=(hr=Qi-ji.x)*hr+(cr=er-ji.y)*cr,vr=(_r=nr-Wi.x)*_r+(dr=ir-Wi.y)*dr,gr=(mr=or-Gi.x)*mr+(Pr=ar-Gi.y)*Pr,br=(fr=lr-Ui.x)*fr+(xr=pr-Ui.y)*xr,zr=0,wr=0,Zr=null;yr<vr?(zr=Qi,wr=er,Zr=ji):(zr=nr,wr=ir,Zr=Wi,yr=vr);var Er=0,Mr=0,Sr=null;if(gr<br?(Er=or,Mr=ar,Sr=Gi):(Er=lr,Mr=pr,Sr=Ui,gr=br),yr<gr?(An.x=zr,An.y=wr,Ln.x=Zr.x,Ln.y=Zr.y,mi=Math.sqrt(yr)):(Ln.x=Er,Ln.y=Mr,An.x=Sr.x,An.y=Sr.y,mi=Math.sqrt(gr)),0!=mi){d.x=Ln.x-An.x,d.y=Ln.y-An.y;var Cr=1/mi;d.x*=Cr,d.y*=Cr,Dn&&(d.x=-d.x,d.y=-d.y)}Sn=mi}else{var Nr=0,Ar=0;Nr=Ti.gp0.x,Ar=Ti.gp0.y;var Lr,Br,Tr=0,Vr=0;Lr=(Tr=Ti.gp1.x)-Nr,Br=(Vr=Ti.gp1.y)-Ar;var kr=Li.gnormy*Nr-Li.gnormx*Ar,Ir=Li.gnormy*Tr-Li.gnormx*Vr,Or=1/(Ir-kr),Rr=(-Li.tp1-kr)*Or;Rr>e.Config.epsilon&&(Nr+=Lr*Rr,Ar+=Br*Rr);var Hr=(-Li.tp0-Ir)*Or;Hr<-e.Config.epsilon&&(Tr+=Lr*Hr,Vr+=Br*Hr);var Fr=Nr*Li.gnormx+Ar*Li.gnormy-Li.gprojection,Dr=Tr*Li.gnormx+Vr*Li.gnormy-Li.gprojection;if(Fr<Dr){Ln.x=Nr,Ln.y=Ar;var Gr=-Fr;An.x=Ln.x+Li.gnormx*Gr,An.y=Ln.y+Li.gnormy*Gr,Sn=Fr}else{Ln.x=Tr,Ln.y=Vr;var Ur=-Dr;An.x=Ln.x+Li.gnormx*Ur,An.y=Ln.y+Li.gnormy*Ur,Sn=Dr}}}else Sn=1e100}else Sn=1e100}}var jr=Sn+r,Wr=o*d.x+a*d.y;if(jr<e.Config.distanceThresholdCCD){var qr,Jr;qr=c.x-p.posx,Jr=c.y-p.posy;var $r=Wr-p.sweep_angvel*(d.y*qr-d.x*Jr);if($r>0&&(t.slipped=!0),$r<=0||jr<.5*e.Config.distanceThresholdCCD)break}m=-1;break}if(++P>=40){en>r&&(t.failed=!0);break}}t.toi=m},t.geom.ZPP_SweepDistance.distanceBody=function(n,i,r,o){var a,s,l;null==t.geom.ZPP_Vec2.zpp_pool?a=new t.geom.ZPP_Vec2:(a=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=a.next,a.next=null),a.weak=!1,null==t.geom.ZPP_Vec2.zpp_pool?s=new t.geom.ZPP_Vec2:(s=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=s.next,s.next=null),s.weak=!1,null==t.geom.ZPP_Vec2.zpp_pool?l=new t.geom.ZPP_Vec2:(l=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=l.next,l.next=null),l.weak=!1;for(var p=1e100,u=n.shapes.head;null!=u;){for(var h=u.elt,c=i.shapes.head;null!=c;){var _,d=h,m=c.elt,P=a,f=s,x=p;if(null==x&&(x=1e100),0==d.type&&0==m.type){var y,v=d.circle,g=m.circle,b=0,z=0;b=g.worldCOMx-v.worldCOMx,z=g.worldCOMy-v.worldCOMy;var w=Math.sqrt(b*b+z*z);if((y=w-(v.radius+g.radius))<x){if(0==w)b=1,z=0;else{var Z=1/w;b*=Z,z*=Z}var E=v.radius;P.x=v.worldCOMx+b*E,P.y=v.worldCOMy+z*E;var M=-g.radius;f.x=g.worldCOMx+b*M,f.y=g.worldCOMy+z*M,l.x=b,l.y=z}_=y}else{var S=!1;if(0==d.type&&1==m.type){var C=d;d=m,m=C;var N=P;P=f,f=N,S=!0}if(1==d.type&&0==m.type){for(var A=d.polygon,L=m.circle,B=-1e100,T=null,V=A.edges.head;null!=V;){var k=V.elt,I=k.gnormx*L.worldCOMx+k.gnormy*L.worldCOMy-k.gprojection-L.radius;if(I>x){B=I;break}I>0?I>B&&(B=I,T=k):B<0&&I>B&&(B=I,T=k),V=V.next}if(B<x){var O=T.gp0,R=T.gp1,H=L.worldCOMy*T.gnormx-L.worldCOMx*T.gnormy;if(H<=O.y*T.gnormx-O.x*T.gnormy){var F=0,D=0;F=L.worldCOMx-O.x,D=L.worldCOMy-O.y;var G=Math.sqrt(F*F+D*D);if((B=G-L.radius)<x){if(0==G)F=1,D=0;else{var U=1/G;F*=U,D*=U}P.x=O.x+0*F,P.y=O.y+0*D;var j=-L.radius;f.x=L.worldCOMx+F*j,f.y=L.worldCOMy+D*j,l.x=F,l.y=D}}else if(H>=R.y*T.gnormx-R.x*T.gnormy){var W=0,q=0;W=L.worldCOMx-R.x,q=L.worldCOMy-R.y;var J=Math.sqrt(W*W+q*q);if((B=J-L.radius)<x){if(0==J)W=1,q=0;else{var $=1/J;W*=$,q*=$}P.x=R.x+0*W,P.y=R.y+0*q;var X=-L.radius;f.x=L.worldCOMx+W*X,f.y=L.worldCOMy+q*X,l.x=W,l.y=q}}else{var Y=-L.radius;f.x=L.worldCOMx+T.gnormx*Y,f.y=L.worldCOMy+T.gnormy*Y;var K=-B;P.x=f.x+T.gnormx*K,P.y=f.y+T.gnormy*K,l.x=T.gnormx,l.y=T.gnormy}}S&&(l.x=-l.x,l.y=-l.y),_=B}else{for(var Q=d.polygon,ee=m.polygon,te=-1e100,ne=null,ie=null,re=0,oe=Q.edges.head;null!=oe;){for(var ae=oe.elt,se=1e100,le=ee.gverts.next;null!=le;){var pe=le,ue=ae.gnormx*pe.x+ae.gnormy*pe.y;ue<se&&(se=ue),le=le.next}if((se-=ae.gprojection)>x){te=se;break}se>0?se>te&&(te=se,ne=ae,re=1):te<0&&se>te&&(te=se,ne=ae,re=1),oe=oe.next}if(te<x){for(var he=ee.edges.head;null!=he;){for(var ce=he.elt,_e=1e100,de=Q.gverts.next;null!=de;){var me=de,Pe=ce.gnormx*me.x+ce.gnormy*me.y;Pe<_e&&(_e=Pe),de=de.next}if((_e-=ce.gprojection)>x){te=_e;break}_e>0?_e>te&&(te=_e,ie=ce,re=2):te<0&&_e>te&&(te=_e,ie=ce,re=2),he=he.next}if(te<x){var fe,xe;if(1==re)fe=ee,xe=ne;else{fe=Q,xe=ie;var ye=P;P=f,f=ye,S=!S}for(var ve=null,ge=1e100,be=fe.edges.head;null!=be;){var ze=be.elt,we=xe.gnormx*ze.gnormx+xe.gnormy*ze.gnormy;we<ge&&(ge=we,ve=ze),be=be.next}if(S?(l.x=-xe.gnormx,l.y=-xe.gnormy):(l.x=xe.gnormx,l.y=xe.gnormy),te>=0){var Ze,Ee,Me,Se,Ce=xe.gp0,Ne=xe.gp1,Ae=ve.gp0,Le=ve.gp1,Be=1/((Ze=Ne.x-Ce.x)*Ze+(Ee=Ne.y-Ce.y)*Ee),Te=1/((Me=Le.x-Ae.x)*Me+(Se=Le.y-Ae.y)*Se),Ve=-(Ze*(Ce.x-Ae.x)+Ee*(Ce.y-Ae.y))*Be,ke=-(Ze*(Ce.x-Le.x)+Ee*(Ce.y-Le.y))*Be,Ie=-(Me*(Ae.x-Ce.x)+Se*(Ae.y-Ce.y))*Te,Oe=-(Me*(Ae.x-Ne.x)+Se*(Ae.y-Ne.y))*Te;Ve<0?Ve=0:Ve>1&&(Ve=1),ke<0?ke=0:ke>1&&(ke=1),Ie<0?Ie=0:Ie>1&&(Ie=1),Oe<0?Oe=0:Oe>1&&(Oe=1);var Re,He,Fe=Ve;Re=Ce.x+Ze*Fe,He=Ce.y+Ee*Fe;var De,Ge,Ue=ke;De=Ce.x+Ze*Ue,Ge=Ce.y+Ee*Ue;var je,We,qe=Ie;je=Ae.x+Me*qe,We=Ae.y+Se*qe;var Je,$e,Xe=Oe;Je=Ae.x+Me*Xe,$e=Ae.y+Se*Xe;var Ye,Ke,Qe,et,tt,nt,it,rt,ot=(Ye=Re-Ae.x)*Ye+(Ke=He-Ae.y)*Ke,at=(Qe=De-Le.x)*Qe+(et=Ge-Le.y)*et,st=(tt=je-Ce.x)*tt+(nt=We-Ce.y)*nt,lt=(it=Je-Ne.x)*it+(rt=$e-Ne.y)*rt,pt=0,ut=0,ht=null;ot<at?(pt=Re,ut=He,ht=Ae):(pt=De,ut=Ge,ht=Le,ot=at);var ct=0,_t=0,dt=null;if(st<lt?(ct=je,_t=We,dt=Ce):(ct=Je,_t=$e,dt=Ne,st=lt),ot<st?(P.x=pt,P.y=ut,f.x=ht.x,f.y=ht.y,te=Math.sqrt(ot)):(f.x=ct,f.y=_t,P.x=dt.x,P.y=dt.y,te=Math.sqrt(st)),0!=te){l.x=f.x-P.x,l.y=f.y-P.y;var mt=1/te;l.x*=mt,l.y*=mt,S&&(l.x=-l.x,l.y=-l.y)}_=te}else{var Pt=0,ft=0;Pt=ve.gp0.x,ft=ve.gp0.y;var xt,yt,vt=0,gt=0;xt=(vt=ve.gp1.x)-Pt,yt=(gt=ve.gp1.y)-ft;var bt=xe.gnormy*Pt-xe.gnormx*ft,zt=xe.gnormy*vt-xe.gnormx*gt,wt=1/(zt-bt),Zt=(-xe.tp1-bt)*wt;Zt>e.Config.epsilon&&(Pt+=xt*Zt,ft+=yt*Zt);var Et=(-xe.tp0-zt)*wt;Et<-e.Config.epsilon&&(vt+=xt*Et,gt+=yt*Et);var Mt=Pt*xe.gnormx+ft*xe.gnormy-xe.gprojection,St=vt*xe.gnormx+gt*xe.gnormy-xe.gprojection;if(Mt<St){f.x=Pt,f.y=ft;var Ct=-Mt;P.x=f.x+xe.gnormx*Ct,P.y=f.y+xe.gnormy*Ct,_=Mt}else{f.x=vt,f.y=gt;var Nt=-St;P.x=f.x+xe.gnormx*Nt,P.y=f.y+xe.gnormy*Nt,_=St}}}else _=x}else _=x}}_<p&&(p=_,r.x=a.x,r.y=a.y,o.x=s.x,o.y=s.y),c=c.next}u=u.next}var At=a;null!=At.outer&&(At.outer.zpp_inner=null,At.outer=null),At._isimmutable=null,At._validate=null,At._invalidate=null,At.next=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=At;var Lt=s;null!=Lt.outer&&(Lt.outer.zpp_inner=null,Lt.outer=null),Lt._isimmutable=null,Lt._validate=null,Lt._invalidate=null,Lt.next=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=Lt;var Bt=l;return null!=Bt.outer&&(Bt.outer.zpp_inner=null,Bt.outer=null),Bt._isimmutable=null,Bt._validate=null,Bt._invalidate=null,Bt.next=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=Bt,p},t.geom.ZPP_SweepDistance.distance=function(t,n,i,r,o,a){if(null==a&&(a=1e100),0==t.type&&0==n.type){var s,l=t.circle,p=n.circle,u=0,h=0;u=p.worldCOMx-l.worldCOMx,h=p.worldCOMy-l.worldCOMy;var c=Math.sqrt(u*u+h*h);if((s=c-(l.radius+p.radius))<a){if(0==c)u=1,h=0;else{var _=1/c;u*=_,h*=_}var d=l.radius;i.x=l.worldCOMx+u*d,i.y=l.worldCOMy+h*d;var m=-p.radius;r.x=p.worldCOMx+u*m,r.y=p.worldCOMy+h*m,o.x=u,o.y=h}return s}var P=!1;if(0==t.type&&1==n.type){var f=t;t=n,n=f;var x=i;i=r,r=x,P=!0}if(1==t.type&&0==n.type){for(var y=t.polygon,v=n.circle,g=-1e100,b=null,z=y.edges.head;null!=z;){var w=z.elt,Z=w.gnormx*v.worldCOMx+w.gnormy*v.worldCOMy-w.gprojection-v.radius;if(Z>a){g=Z;break}Z>0?Z>g&&(g=Z,b=w):g<0&&Z>g&&(g=Z,b=w),z=z.next}if(g<a){var E=b.gp0,M=b.gp1,S=v.worldCOMy*b.gnormx-v.worldCOMx*b.gnormy;if(S<=E.y*b.gnormx-E.x*b.gnormy){var C=0,N=0;C=v.worldCOMx-E.x,N=v.worldCOMy-E.y;var A=Math.sqrt(C*C+N*N);if((g=A-v.radius)<a){if(0==A)C=1,N=0;else{var L=1/A;C*=L,N*=L}i.x=E.x+0*C,i.y=E.y+0*N;var B=-v.radius;r.x=v.worldCOMx+C*B,r.y=v.worldCOMy+N*B,o.x=C,o.y=N}}else if(S>=M.y*b.gnormx-M.x*b.gnormy){var T=0,V=0;T=v.worldCOMx-M.x,V=v.worldCOMy-M.y;var k=Math.sqrt(T*T+V*V);if((g=k-v.radius)<a){if(0==k)T=1,V=0;else{var I=1/k;T*=I,V*=I}i.x=M.x+0*T,i.y=M.y+0*V;var O=-v.radius;r.x=v.worldCOMx+T*O,r.y=v.worldCOMy+V*O,o.x=T,o.y=V}}else{var R=-v.radius;r.x=v.worldCOMx+b.gnormx*R,r.y=v.worldCOMy+b.gnormy*R;var H=-g;i.x=r.x+b.gnormx*H,i.y=r.y+b.gnormy*H,o.x=b.gnormx,o.y=b.gnormy}}return P&&(o.x=-o.x,o.y=-o.y),g}for(var F=t.polygon,D=n.polygon,G=-1e100,U=null,j=null,W=0,q=F.edges.head;null!=q;){for(var J=q.elt,$=1e100,X=D.gverts.next;null!=X;){var Y=X,K=J.gnormx*Y.x+J.gnormy*Y.y;K<$&&($=K),X=X.next}if(($-=J.gprojection)>a){G=$;break}$>0?$>G&&(G=$,U=J,W=1):G<0&&$>G&&(G=$,U=J,W=1),q=q.next}if(G<a){for(var Q=D.edges.head;null!=Q;){for(var ee=Q.elt,te=1e100,ne=F.gverts.next;null!=ne;){var ie=ne,re=ee.gnormx*ie.x+ee.gnormy*ie.y;re<te&&(te=re),ne=ne.next}if((te-=ee.gprojection)>a){G=te;break}te>0?te>G&&(G=te,j=ee,W=2):G<0&&te>G&&(G=te,j=ee,W=2),Q=Q.next}if(G<a){var oe,ae;if(1==W)oe=D,ae=U;else{oe=F,ae=j;var se=i;i=r,r=se,P=!P}for(var le=null,pe=1e100,ue=oe.edges.head;null!=ue;){var he=ue.elt,ce=ae.gnormx*he.gnormx+ae.gnormy*he.gnormy;ce<pe&&(pe=ce,le=he),ue=ue.next}if(P?(o.x=-ae.gnormx,o.y=-ae.gnormy):(o.x=ae.gnormx,o.y=ae.gnormy),G>=0){var _e,de,me,Pe,fe=ae.gp0,xe=ae.gp1,ye=le.gp0,ve=le.gp1,ge=1/((_e=xe.x-fe.x)*_e+(de=xe.y-fe.y)*de),be=1/((me=ve.x-ye.x)*me+(Pe=ve.y-ye.y)*Pe),ze=-(_e*(fe.x-ye.x)+de*(fe.y-ye.y))*ge,we=-(_e*(fe.x-ve.x)+de*(fe.y-ve.y))*ge,Ze=-(me*(ye.x-fe.x)+Pe*(ye.y-fe.y))*be,Ee=-(me*(ye.x-xe.x)+Pe*(ye.y-xe.y))*be;ze<0?ze=0:ze>1&&(ze=1),we<0?we=0:we>1&&(we=1),Ze<0?Ze=0:Ze>1&&(Ze=1),Ee<0?Ee=0:Ee>1&&(Ee=1);var Me,Se,Ce=ze;Me=fe.x+_e*Ce,Se=fe.y+de*Ce;var Ne,Ae,Le=we;Ne=fe.x+_e*Le,Ae=fe.y+de*Le;var Be,Te,Ve=Ze;Be=ye.x+me*Ve,Te=ye.y+Pe*Ve;var ke,Ie,Oe=Ee;ke=ye.x+me*Oe,Ie=ye.y+Pe*Oe;var Re,He,Fe,De,Ge,Ue,je,We,qe=(Re=Me-ye.x)*Re+(He=Se-ye.y)*He,Je=(Fe=Ne-ve.x)*Fe+(De=Ae-ve.y)*De,$e=(Ge=Be-fe.x)*Ge+(Ue=Te-fe.y)*Ue,Xe=(je=ke-xe.x)*je+(We=Ie-xe.y)*We,Ye=0,Ke=0,Qe=null;qe<Je?(Ye=Me,Ke=Se,Qe=ye):(Ye=Ne,Ke=Ae,Qe=ve,qe=Je);var et=0,tt=0,nt=null;if($e<Xe?(et=Be,tt=Te,nt=fe):(et=ke,tt=Ie,nt=xe,$e=Xe),qe<$e?(i.x=Ye,i.y=Ke,r.x=Qe.x,r.y=Qe.y,G=Math.sqrt(qe)):(r.x=et,r.y=tt,i.x=nt.x,i.y=nt.y,G=Math.sqrt($e)),0!=G){o.x=r.x-i.x,o.y=r.y-i.y;var it=1/G;o.x*=it,o.y*=it,P&&(o.x=-o.x,o.y=-o.y)}return G}var rt=0,ot=0;rt=le.gp0.x,ot=le.gp0.y;var at,st,lt=0,pt=0;at=(lt=le.gp1.x)-rt,st=(pt=le.gp1.y)-ot;var ut=ae.gnormy*rt-ae.gnormx*ot,ht=ae.gnormy*lt-ae.gnormx*pt,ct=1/(ht-ut),_t=(-ae.tp1-ut)*ct;_t>e.Config.epsilon&&(rt+=at*_t,ot+=st*_t);var dt=(-ae.tp0-ht)*ct;dt<-e.Config.epsilon&&(lt+=at*dt,pt+=st*dt);var mt=rt*ae.gnormx+ot*ae.gnormy-ae.gprojection,Pt=lt*ae.gnormx+pt*ae.gnormy-ae.gprojection;if(mt<Pt){r.x=rt,r.y=ot;var ft=-mt;return i.x=r.x+ae.gnormx*ft,i.y=r.y+ae.gnormy*ft,mt}r.x=lt,r.y=pt;var xt=-Pt;return i.x=r.x+ae.gnormx*xt,i.y=r.y+ae.gnormy*xt,Pt}return a}return a},t.geom.ZPP_SweepDistance.prototype.__class__=t.geom.ZPP_SweepDistance,t.geom.ZPP_PartitionPair=l["zpp_nape.geom.ZPP_PartitionPair"]=function(){this.node=null,this.di=0,this.id=0,this.b=null,this.a=null,this.length=0,this.pushmod=!1,this.modified=!1,this._inuse=!1,this.next=null},t.geom.ZPP_PartitionPair.__name__=["zpp_nape","geom","ZPP_PartitionPair"],t.geom.ZPP_PartitionPair.get=function(e,n){var i;return null==t.geom.ZPP_PartitionPair.zpp_pool?i=new t.geom.ZPP_PartitionPair:(i=t.geom.ZPP_PartitionPair.zpp_pool,t.geom.ZPP_PartitionPair.zpp_pool=i.next,i.next=null),i.a=e,i.b=n,e.id<n.id?(i.id=e.id,i.di=n.id):(i.id=n.id,i.di=e.id),i},t.geom.ZPP_PartitionPair.edge_swap=function(e,t){var n=e.node;e.node=t.node,t.node=n},t.geom.ZPP_PartitionPair.edge_lt=function(e,t){return!(e.id>=t.id)||e.id==t.id&&e.di<t.di},t.geom.ZPP_PartitionPair.prototype.next=null,t.geom.ZPP_PartitionPair.prototype.elem=function(){return this},t.geom.ZPP_PartitionPair.prototype.begin=function(){return this.next},t.geom.ZPP_PartitionPair.prototype._inuse=null,t.geom.ZPP_PartitionPair.prototype.modified=null,t.geom.ZPP_PartitionPair.prototype.pushmod=null,t.geom.ZPP_PartitionPair.prototype.length=null,t.geom.ZPP_PartitionPair.prototype.setbegin=function(e){this.next=e,this.modified=!0,this.pushmod=!0},t.geom.ZPP_PartitionPair.prototype.add=function(e){e._inuse=!0;var t=e;return t.next=this.next,this.next=t,this.modified=!0,this.length++,e},t.geom.ZPP_PartitionPair.prototype.inlined_add=function(e){e._inuse=!0;var t=e;return t.next=this.next,this.next=t,this.modified=!0,this.length++,e},t.geom.ZPP_PartitionPair.prototype.addAll=function(e){for(var t=e.next;null!=t;){var n=t;this.add(n),t=t.next}},t.geom.ZPP_PartitionPair.prototype.insert=function(e,t){t._inuse=!0;var n=t;return null==e?(n.next=this.next,this.next=n):(n.next=e.next,e.next=n),this.pushmod=this.modified=!0,this.length++,n},t.geom.ZPP_PartitionPair.prototype.inlined_insert=function(e,t){t._inuse=!0;var n=t;return null==e?(n.next=this.next,this.next=n):(n.next=e.next,e.next=n),this.pushmod=this.modified=!0,this.length++,n},t.geom.ZPP_PartitionPair.prototype.pop=function(){var e=this.next;this.next=e.next,e._inuse=!1,null==this.next&&(this.pushmod=!0),this.modified=!0,this.length--},t.geom.ZPP_PartitionPair.prototype.inlined_pop=function(){var e=this.next;this.next=e.next,e._inuse=!1,null==this.next&&(this.pushmod=!0),this.modified=!0,this.length--},t.geom.ZPP_PartitionPair.prototype.pop_unsafe=function(){var e=this.next;return this.pop(),e},t.geom.ZPP_PartitionPair.prototype.inlined_pop_unsafe=function(){var e=this.next;return this.pop(),e},t.geom.ZPP_PartitionPair.prototype.remove=function(e){for(var t=null,n=this.next;null!=n;){if(n==e){var i,r;null==t?(r=(i=this.next).next,this.next=r,null==this.next&&(this.pushmod=!0)):(r=(i=t.next).next,t.next=r,null==r&&(this.pushmod=!0)),i._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0;break}t=n,n=n.next}},t.geom.ZPP_PartitionPair.prototype.try_remove=function(e){for(var t=null,n=this.next,i=!1;null!=n;){if(n==e){this.erase(t),i=!0;break}t=n,n=n.next}return i},t.geom.ZPP_PartitionPair.prototype.inlined_remove=function(e){for(var t=null,n=this.next;null!=n;){if(n==e){var i,r;null==t?(r=(i=this.next).next,this.next=r,null==this.next&&(this.pushmod=!0)):(r=(i=t.next).next,t.next=r,null==r&&(this.pushmod=!0)),i._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0;break}t=n,n=n.next}},t.geom.ZPP_PartitionPair.prototype.inlined_try_remove=function(e){for(var t=null,n=this.next,i=!1;null!=n;){if(n==e){var r,o;null==t?(o=(r=this.next).next,this.next=o,null==this.next&&(this.pushmod=!0)):(o=(r=t.next).next,t.next=o,null==o&&(this.pushmod=!0)),r._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0,i=!0;break}t=n,n=n.next}return i},t.geom.ZPP_PartitionPair.prototype.erase=function(e){var t,n;return null==e?(n=(t=this.next).next,this.next=n,null==this.next&&(this.pushmod=!0)):(n=(t=e.next).next,e.next=n,null==n&&(this.pushmod=!0)),t._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0,n},t.geom.ZPP_PartitionPair.prototype.inlined_erase=function(e){var t,n;return null==e?(n=(t=this.next).next,this.next=n,null==this.next&&(this.pushmod=!0)):(n=(t=e.next).next,e.next=n,null==n&&(this.pushmod=!0)),t._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0,n},t.geom.ZPP_PartitionPair.prototype.splice=function(e,t){for(;t-- >0&&null!=e.next;)this.erase(e);return e.next},t.geom.ZPP_PartitionPair.prototype.clear=function(){},t.geom.ZPP_PartitionPair.prototype.inlined_clear=function(){},t.geom.ZPP_PartitionPair.prototype.reverse=function(){for(var e=this.next,t=null;null!=e;){var n=e.next;e.next=t,this.next=e,t=e,e=n}this.modified=!0,this.pushmod=!0},t.geom.ZPP_PartitionPair.prototype.empty=function(){return null==this.next},t.geom.ZPP_PartitionPair.prototype.size=function(){return this.length},t.geom.ZPP_PartitionPair.prototype.has=function(e){var t;t=!1;for(var n=this.next;null!=n;){if(n==e){t=!0;break}n=n.next}return t},t.geom.ZPP_PartitionPair.prototype.inlined_has=function(e){var t;t=!1;for(var n=this.next;null!=n;){if(n==e){t=!0;break}n=n.next}return t},t.geom.ZPP_PartitionPair.prototype.front=function(){return this.next},t.geom.ZPP_PartitionPair.prototype.back=function(){for(var e=this.next,t=e;null!=t;)e=t,t=t.next;return e},t.geom.ZPP_PartitionPair.prototype.iterator_at=function(e){for(var t=this.next;e-- >0&&null!=t;)t=t.next;return t},t.geom.ZPP_PartitionPair.prototype.at=function(e){var t=this.iterator_at(e);return null!=t?t:null},t.geom.ZPP_PartitionPair.prototype.free=function(){this.a=this.b=null,this.node=null},t.geom.ZPP_PartitionPair.prototype.alloc=function(){},t.geom.ZPP_PartitionPair.prototype.a=null,t.geom.ZPP_PartitionPair.prototype.b=null,t.geom.ZPP_PartitionPair.prototype.id=null,t.geom.ZPP_PartitionPair.prototype.di=null,t.geom.ZPP_PartitionPair.prototype.node=null,t.geom.ZPP_PartitionPair.prototype.__class__=t.geom.ZPP_PartitionPair,t.geom.ZPP_Triangular=l["zpp_nape.geom.ZPP_Triangular"]=function(){},t.geom.ZPP_Triangular.__name__=["zpp_nape","geom","ZPP_Triangular"],t.geom.ZPP_Triangular.lt=function(e,t){return e.y<t.y||e.y==t.y&&e.x<t.x},t.geom.ZPP_Triangular.right_turn=function(e,t,n){var i,r,o;return i=n.x-t.x,r=n.y-t.y,o=t.x-e.x,(t.y-e.y)*i-o*r},t.geom.ZPP_Triangular.delaunay=function(e,t,n,i){var r,o,a,s=0,l=0,p=0;return s=n.x-t.x,l=n.y-t.y,p=t.x-e.x,(t.y-e.y)*s-p*l>=0?a=!0:(s=i.x-n.x,l=i.y-n.y,p=n.x-t.x,a=(n.y-t.y)*s-p*l>=0),a?o=!0:(s=e.x-i.x,l=e.y-i.y,p=i.x-n.x,o=(i.y-n.y)*s-p*l>=0),o?r=!0:(s=t.x-e.x,l=t.y-e.y,p=e.x-i.x,r=(e.y-i.y)*s-p*l>=0),!!r||t.x*(n.y*i.mag-n.mag*i.y)-n.x*(t.y*i.mag-t.mag*i.y)+i.x*(t.y*n.mag-t.mag*n.y)-(e.x*(n.y*i.mag-n.mag*i.y)-n.x*(e.y*i.mag-e.mag*i.y)+i.x*(e.y*n.mag-e.mag*n.y))+(e.x*(t.y*i.mag-t.mag*i.y)-t.x*(e.y*i.mag-e.mag*i.y)+i.x*(e.y*t.mag-e.mag*t.y))-(e.x*(t.y*n.mag-t.mag*n.y)-t.x*(e.y*n.mag-e.mag*n.y)+n.x*(e.y*t.mag-e.mag*t.y))>0},t.geom.ZPP_Triangular.optimise=function(e){var n,i=e.vertices,r=e.vertices;if(null!=i)for(var o=i;;){var a=o;if(a.sort(),a.mag=a.x*a.x+a.y*a.y,(o=o.next)==r)break}null==t.geom.ZPP_Triangular.edgeSet&&(null==t.util.ZPP_Set_ZPP_PartitionPair.zpp_pool?t.geom.ZPP_Triangular.edgeSet=new t.util.ZPP_Set_ZPP_PartitionPair:(t.geom.ZPP_Triangular.edgeSet=t.util.ZPP_Set_ZPP_PartitionPair.zpp_pool,t.util.ZPP_Set_ZPP_PartitionPair.zpp_pool=t.geom.ZPP_Triangular.edgeSet.next,t.geom.ZPP_Triangular.edgeSet.next=null),t.geom.ZPP_Triangular.edgeSet.lt=t.geom.ZPP_PartitionPair.edge_lt,t.geom.ZPP_Triangular.edgeSet.swapped=t.geom.ZPP_PartitionPair.edge_swap),null==t.geom.ZPP_PartitionPair.zpp_pool?n=new t.geom.ZPP_PartitionPair:(n=t.geom.ZPP_PartitionPair.zpp_pool,t.geom.ZPP_PartitionPair.zpp_pool=n.next,n.next=null);var s=e.vertices,l=e.vertices;if(null!=s)for(var p=s;;){var u=p,h=u.next;u.diagonals.reverse();for(var c=u.diagonals.head;null!=c;){var _=c.elt;if(_.id<u.id)h=_,c=c.next;else{var d=null==c.next?u.prev:c.next.elt;if(!t.geom.ZPP_Triangular.delaunay(u,h,_,d)){var m;null==t.geom.ZPP_PartitionPair.zpp_pool?m=new t.geom.ZPP_PartitionPair:(m=t.geom.ZPP_PartitionPair.zpp_pool,t.geom.ZPP_PartitionPair.zpp_pool=m.next,m.next=null),m.a=u,m.b=_,u.id<_.id?(m.id=u.id,m.di=_.id):(m.id=_.id,m.di=u.id);var P=m;n.add(P),P.node=t.geom.ZPP_Triangular.edgeSet.insert(P)}h=_,c=c.next}}if((p=p.next)==l)break}for(;null!=n.next;){for(var f=n.pop_unsafe(),x=f.a,y=f.b,v=x.next,g=null,b=x.diagonals.head;null!=b;){var z=b.elt;if(z==y){g=null==(b=b.next)?x.prev:b.elt;break}v=z,b=b.next}if(x.diagonals.remove(y),y.diagonals.remove(x),y==v.next)v.diagonals.add(g);else for(var w=v.diagonals.head;null!=w;){if(w.elt==y){v.diagonals.insert(w,g);break}w=w.next}if(x==g.next)g.diagonals.add(v);else for(var Z=g.diagonals.head;null!=Z;){if(Z.elt==x){g.diagonals.insert(Z,v);break}Z=Z.next}t.geom.ZPP_Triangular.edgeSet.remove_node(f.node);var E=f;E.a=E.b=null,E.node=null,E.next=t.geom.ZPP_PartitionPair.zpp_pool,t.geom.ZPP_PartitionPair.zpp_pool=E}var M=n;M.a=M.b=null,M.node=null,M.next=t.geom.ZPP_PartitionPair.zpp_pool,t.geom.ZPP_PartitionPair.zpp_pool=M},t.geom.ZPP_Triangular.triangulate=function(e){var n=e.vertices,i=e.vertices,r=e.vertices.next,o=e.vertices;if(null!=r)for(var a=r;;){var s=a;if((s.y<n.y||s.y==n.y&&s.x<n.x)&&(n=s),(i.y<s.y||i.y==s.y&&i.x<s.x)&&(i=s),(a=a.next)==o)break}null==t.geom.ZPP_Triangular.queue&&(t.geom.ZPP_Triangular.queue=new t.util.ZNPList_ZPP_PartitionVertex);var l=i.prev,p=i.next;for(t.geom.ZPP_Triangular.queue.add(i);l!=n||p!=n;)l==n||p!=n&&(l.y<p.y||l.y==p.y&&l.x<p.x)?(t.geom.ZPP_Triangular.queue.add(p),p.rightchain=!1,p=p.next):(t.geom.ZPP_Triangular.queue.add(l),l.rightchain=!0,l=l.prev);t.geom.ZPP_Triangular.queue.add(n),null==t.geom.ZPP_Triangular.stack&&(t.geom.ZPP_Triangular.stack=new t.util.ZNPList_ZPP_PartitionVertex),t.geom.ZPP_Triangular.stack.add(t.geom.ZPP_Triangular.queue.pop_unsafe());var u=t.geom.ZPP_Triangular.queue.pop_unsafe();for(t.geom.ZPP_Triangular.stack.add(u);;){var h=t.geom.ZPP_Triangular.queue.pop_unsafe();if(null==t.geom.ZPP_Triangular.queue.head)break;if(h.rightchain!=t.geom.ZPP_Triangular.stack.head.elt.rightchain){for(;;){var c=t.geom.ZPP_Triangular.stack.pop_unsafe();if(null==t.geom.ZPP_Triangular.stack.head)break;e.add_diagonal(c,h)}t.geom.ZPP_Triangular.stack.add(u)}else{for(var _=t.geom.ZPP_Triangular.stack.pop_unsafe();null!=t.geom.ZPP_Triangular.stack.head;){var d,m,P,f=t.geom.ZPP_Triangular.stack.head.elt;d=h.x-_.x,m=h.y-_.y,P=_.x-f.x;var x=(_.y-f.y)*d-P*m;if(h.rightchain&&x>=0||!h.rightchain&&x<=0)break;e.add_diagonal(f,h),_=f,t.geom.ZPP_Triangular.stack.pop()}t.geom.ZPP_Triangular.stack.add(_)}t.geom.ZPP_Triangular.stack.add(h),u=h}if(null!=t.geom.ZPP_Triangular.stack.head)for(t.geom.ZPP_Triangular.stack.pop();null!=t.geom.ZPP_Triangular.stack.head;){var y=t.geom.ZPP_Triangular.stack.pop_unsafe();if(null==t.geom.ZPP_Triangular.stack.head)break;e.add_diagonal(i,y)}return e},t.geom.ZPP_Triangular.prototype.__class__=t.geom.ZPP_Triangular,t.geom.ZPP_Vec2=l["zpp_nape.geom.ZPP_Vec2"]=function(){this.y=0,this.x=0,this.length=0,this.pushmod=!1,this.modified=!1,this._inuse=!1,this.next=null,this.weak=!1,this.outer=null,this._isimmutable=null,this._immutable=!1,this._validate=null,this._invalidate=null},t.geom.ZPP_Vec2.__name__=["zpp_nape","geom","ZPP_Vec2"],t.geom.ZPP_Vec2.get=function(e,n,i){var r;return null==i&&(i=!1),null==t.geom.ZPP_Vec2.zpp_pool?r=new t.geom.ZPP_Vec2:(r=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=r.next,r.next=null),r.weak=!1,r._immutable=i,r.x=e,r.y=n,r},t.geom.ZPP_Vec2.prototype._invalidate=null,t.geom.ZPP_Vec2.prototype._validate=null,t.geom.ZPP_Vec2.prototype.validate=function(){null!=this._validate&&this._validate()},t.geom.ZPP_Vec2.prototype.invalidate=function(){null!=this._invalidate&&this._invalidate(this)},t.geom.ZPP_Vec2.prototype._immutable=null,t.geom.ZPP_Vec2.prototype._isimmutable=null,t.geom.ZPP_Vec2.prototype.immutable=function(){if(this._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");null!=this._isimmutable&&this._isimmutable()},t.geom.ZPP_Vec2.prototype.outer=null,t.geom.ZPP_Vec2.prototype.wrapper=function(){if(null==this.outer){this.outer=new e.geom.Vec2;var n=this.outer.zpp_inner;null!=n.outer&&(n.outer.zpp_inner=null,n.outer=null),n._isimmutable=null,n._validate=null,n._invalidate=null,n.next=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=n,this.outer.zpp_inner=this}return this.outer},t.geom.ZPP_Vec2.prototype.weak=null,t.geom.ZPP_Vec2.prototype.free=function(){null!=this.outer&&(this.outer.zpp_inner=null,this.outer=null),this._isimmutable=null,this._validate=null,this._invalidate=null},t.geom.ZPP_Vec2.prototype.alloc=function(){this.weak=!1},t.geom.ZPP_Vec2.prototype.next=null,t.geom.ZPP_Vec2.prototype.elem=function(){return this},t.geom.ZPP_Vec2.prototype.begin=function(){return this.next},t.geom.ZPP_Vec2.prototype._inuse=null,t.geom.ZPP_Vec2.prototype.modified=null,t.geom.ZPP_Vec2.prototype.pushmod=null,t.geom.ZPP_Vec2.prototype.length=null,t.geom.ZPP_Vec2.prototype.setbegin=function(e){this.next=e,this.modified=!0,this.pushmod=!0},t.geom.ZPP_Vec2.prototype.add=function(e){e._inuse=!0;var t=e;return t.next=this.next,this.next=t,this.modified=!0,this.length++,e},t.geom.ZPP_Vec2.prototype.inlined_add=function(e){e._inuse=!0;var t=e;return t.next=this.next,this.next=t,this.modified=!0,this.length++,e},t.geom.ZPP_Vec2.prototype.addAll=function(e){for(var t=e.next;null!=t;){var n=t;this.add(n),t=t.next}},t.geom.ZPP_Vec2.prototype.insert=function(e,t){t._inuse=!0;var n=t;return null==e?(n.next=this.next,this.next=n):(n.next=e.next,e.next=n),this.pushmod=this.modified=!0,this.length++,n},t.geom.ZPP_Vec2.prototype.inlined_insert=function(e,t){t._inuse=!0;var n=t;return null==e?(n.next=this.next,this.next=n):(n.next=e.next,e.next=n),this.pushmod=this.modified=!0,this.length++,n},t.geom.ZPP_Vec2.prototype.pop=function(){var e=this.next;this.next=e.next,e._inuse=!1,null==this.next&&(this.pushmod=!0),this.modified=!0,this.length--},t.geom.ZPP_Vec2.prototype.inlined_pop=function(){var e=this.next;this.next=e.next,e._inuse=!1,null==this.next&&(this.pushmod=!0),this.modified=!0,this.length--},t.geom.ZPP_Vec2.prototype.pop_unsafe=function(){var e=this.next;return this.pop(),e},t.geom.ZPP_Vec2.prototype.inlined_pop_unsafe=function(){var e=this.next;return this.pop(),e},t.geom.ZPP_Vec2.prototype.remove=function(e){for(var t=null,n=this.next;null!=n;){if(n==e){var i,r;null==t?(r=(i=this.next).next,this.next=r,null==this.next&&(this.pushmod=!0)):(r=(i=t.next).next,t.next=r,null==r&&(this.pushmod=!0)),i._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0;break}t=n,n=n.next}},t.geom.ZPP_Vec2.prototype.try_remove=function(e){for(var t=null,n=this.next,i=!1;null!=n;){if(n==e){this.erase(t),i=!0;break}t=n,n=n.next}return i},t.geom.ZPP_Vec2.prototype.inlined_remove=function(e){for(var t=null,n=this.next;null!=n;){if(n==e){var i,r;null==t?(r=(i=this.next).next,this.next=r,null==this.next&&(this.pushmod=!0)):(r=(i=t.next).next,t.next=r,null==r&&(this.pushmod=!0)),i._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0;break}t=n,n=n.next}},t.geom.ZPP_Vec2.prototype.inlined_try_remove=function(e){for(var t=null,n=this.next,i=!1;null!=n;){if(n==e){var r,o;null==t?(o=(r=this.next).next,this.next=o,null==this.next&&(this.pushmod=!0)):(o=(r=t.next).next,t.next=o,null==o&&(this.pushmod=!0)),r._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0,i=!0;break}t=n,n=n.next}return i},t.geom.ZPP_Vec2.prototype.erase=function(e){var t,n;return null==e?(n=(t=this.next).next,this.next=n,null==this.next&&(this.pushmod=!0)):(n=(t=e.next).next,e.next=n,null==n&&(this.pushmod=!0)),t._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0,n},t.geom.ZPP_Vec2.prototype.inlined_erase=function(e){var t,n;return null==e?(n=(t=this.next).next,this.next=n,null==this.next&&(this.pushmod=!0)):(n=(t=e.next).next,e.next=n,null==n&&(this.pushmod=!0)),t._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0,n},t.geom.ZPP_Vec2.prototype.splice=function(e,t){for(;t-- >0&&null!=e.next;)this.erase(e);return e.next},t.geom.ZPP_Vec2.prototype.clear=function(){},t.geom.ZPP_Vec2.prototype.inlined_clear=function(){},t.geom.ZPP_Vec2.prototype.reverse=function(){for(var e=this.next,t=null;null!=e;){var n=e.next;e.next=t,this.next=e,t=e,e=n}this.modified=!0,this.pushmod=!0},t.geom.ZPP_Vec2.prototype.empty=function(){return null==this.next},t.geom.ZPP_Vec2.prototype.size=function(){return this.length},t.geom.ZPP_Vec2.prototype.has=function(e){var t;t=!1;for(var n=this.next;null!=n;){if(n==e){t=!0;break}n=n.next}return t},t.geom.ZPP_Vec2.prototype.inlined_has=function(e){var t;t=!1;for(var n=this.next;null!=n;){if(n==e){t=!0;break}n=n.next}return t},t.geom.ZPP_Vec2.prototype.front=function(){return this.next},t.geom.ZPP_Vec2.prototype.back=function(){for(var e=this.next,t=e;null!=t;)e=t,t=t.next;return e},t.geom.ZPP_Vec2.prototype.iterator_at=function(e){for(var t=this.next;e-- >0&&null!=t;)t=t.next;return t},t.geom.ZPP_Vec2.prototype.at=function(e){var t=this.iterator_at(e);return null!=t?t:null},t.geom.ZPP_Vec2.prototype.x=null,t.geom.ZPP_Vec2.prototype.y=null,t.geom.ZPP_Vec2.prototype.copy=function(){var e,n=this.x,i=this.y;return null==t.geom.ZPP_Vec2.zpp_pool?e=new t.geom.ZPP_Vec2:(e=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=e.next,e.next=null),e.weak=!1,e._immutable=!1,e.x=n,e.y=i,e},t.geom.ZPP_Vec2.prototype.toString=function(){return"{ x: "+this.x+" y: "+this.y+" }"},t.geom.ZPP_Vec2.prototype.__class__=t.geom.ZPP_Vec2,t.geom.ZPP_Vec3=l["zpp_nape.geom.ZPP_Vec3"]=function(){this._validate=null,this.immutable=!1,this.z=0,this.y=0,this.x=0,this.outer=null,this.immutable=!1,this._validate=null},t.geom.ZPP_Vec3.__name__=["zpp_nape","geom","ZPP_Vec3"],t.geom.ZPP_Vec3.prototype.outer=null,t.geom.ZPP_Vec3.prototype.x=null,t.geom.ZPP_Vec3.prototype.y=null,t.geom.ZPP_Vec3.prototype.z=null,t.geom.ZPP_Vec3.prototype.immutable=null,t.geom.ZPP_Vec3.prototype._validate=null,t.geom.ZPP_Vec3.prototype.validate=function(){null!=this._validate&&this._validate()},t.geom.ZPP_Vec3.prototype.__class__=t.geom.ZPP_Vec3,t.geom.ZPP_VecMath=l["zpp_nape.geom.ZPP_VecMath"]=function(){},t.geom.ZPP_VecMath.__name__=["zpp_nape","geom","ZPP_VecMath"],t.geom.ZPP_VecMath.vec_dsq=function(e,t,n,i){var r,o;return(r=e-n)*r+(o=t-i)*o},t.geom.ZPP_VecMath.vec_distance=function(e,t,n,i){var r,o;return r=e-n,o=t-i,Math.sqrt(r*r+o*o)},t.geom.ZPP_VecMath.prototype.__class__=t.geom.ZPP_VecMath,t.phys||(t.phys={}),t.phys.ZPP_Interactor=l["zpp_nape.phys.ZPP_Interactor"]=function(){this.wrap_cbTypes=null,this.cbSet=null,this.cbTypes=null,this.group=null,this.cbsets=null,this.icompound=null,this.ibody=null,this.ishape=null,this.userData=null,this.id=0,this.outer_i=null,this.id=t.ZPP_ID.Interactor(),this.cbsets=new t.util.ZNPList_ZPP_CallbackSet,this.cbTypes=new t.util.ZNPList_ZPP_CbType},t.phys.ZPP_Interactor.__name__=["zpp_nape","phys","ZPP_Interactor"],t.phys.ZPP_Interactor.get=function(e,t){for(var n=e.id<t.id?e.id:t.id,i=e.id<t.id?t.id:e.id,r=null,o=(e.cbsets.length<t.cbsets.length?e.cbsets:t.cbsets).head;null!=o;){var a=o.elt;if(a.id==n&&a.di==i){r=a;break}o=o.next}return r},t.phys.ZPP_Interactor.int_callback=function(e,t,n){var i,r=e.int1,o=e.int2,a=t.options1,s=r.cbTypes;if(a.nonemptyintersection(s,a.includes)&&!a.nonemptyintersection(s,a.excludes)){var l=t.options2,p=o.cbTypes;i=l.nonemptyintersection(p,l.includes)&&!l.nonemptyintersection(p,l.excludes)}else i=!1;i?(n.int1=r,n.int2=o):(n.int1=o,n.int2=r)},t.phys.ZPP_Interactor.prototype.outer_i=null,t.phys.ZPP_Interactor.prototype.id=null,t.phys.ZPP_Interactor.prototype.userData=null,t.phys.ZPP_Interactor.prototype.ishape=null,t.phys.ZPP_Interactor.prototype.ibody=null,t.phys.ZPP_Interactor.prototype.icompound=null,t.phys.ZPP_Interactor.prototype.isShape=function(){return null!=this.ishape},t.phys.ZPP_Interactor.prototype.isBody=function(){return null!=this.ibody},t.phys.ZPP_Interactor.prototype.isCompound=function(){return null!=this.icompound},t.phys.ZPP_Interactor.prototype.__iaddedToSpace=function(){null!=this.group&&this.group.interactors.add(this);for(var e=this.cbTypes.head;null!=e;)e.elt.interactors.add(this),e=e.next;this.alloc_cbSet()},t.phys.ZPP_Interactor.prototype.__iremovedFromSpace=function(){null!=this.group&&this.group.interactors.remove(this);for(var e=this.cbTypes.head;null!=e;)e.elt.interactors.remove(this),e=e.next;this.dealloc_cbSet()},t.phys.ZPP_Interactor.prototype.wake=function(){if(null!=this.ishape){var e=this.ishape.body;null!=e&&null!=e.space&&e.space.non_inlined_wake(e)}else null!=this.ibody?null!=this.ibody.space&&this.ibody.space.non_inlined_wake(this.ibody):null!=this.icompound.space&&this.icompound.space.wakeCompound(this.icompound)},t.phys.ZPP_Interactor.prototype.cbsets=null,t.phys.ZPP_Interactor.prototype.getSpace=function(){return null!=this.ishape?null==this.ishape.body?null:this.ishape.body.space:null!=this.ibody?this.ibody.space:this.icompound.space},t.phys.ZPP_Interactor.prototype.group=null,t.phys.ZPP_Interactor.prototype.cbTypes=null,t.phys.ZPP_Interactor.prototype.cbSet=null,t.phys.ZPP_Interactor.prototype.wrap_cbTypes=null,t.phys.ZPP_Interactor.prototype.setupcbTypes=function(){this.wrap_cbTypes=t.util.ZPP_CbTypeList.get(this.cbTypes),this.wrap_cbTypes.zpp_inner.adder=p(this,this.wrap_cbTypes_adder),this.wrap_cbTypes.zpp_inner.subber=p(this,this.wrap_cbTypes_subber),this.wrap_cbTypes.zpp_inner.dontremove=!0,this.wrap_cbTypes.zpp_inner._modifiable=p(this,this.immutable_cbTypes)},t.phys.ZPP_Interactor.prototype.immutable_cbTypes=function(){this.immutable_midstep("Interactor::cbTypes")},t.phys.ZPP_Interactor.prototype.wrap_cbTypes_subber=function(e){var t=e.zpp_inner;if(this.cbTypes.has(t)){var n=null!=this.ishape?null==this.ishape.body?null:this.ishape.body.space:null!=this.ibody?this.ibody.space:this.icompound.space;null!=n&&(this.dealloc_cbSet(),t.interactors.remove(this)),this.cbTypes.remove(t),null!=n&&(this.alloc_cbSet(),this.wake())}},t.phys.ZPP_Interactor.prototype.wrap_cbTypes_adder=function(e){return this.insert_cbtype(e.zpp_inner),!1},t.phys.ZPP_Interactor.prototype.insert_cbtype=function(e){if(!this.cbTypes.has(e)){var n=null!=this.ishape?null==this.ishape.body?null:this.ishape.body.space:null!=this.ibody?this.ibody.space:this.icompound.space;null!=n&&(this.dealloc_cbSet(),e.interactors.add(this));for(var i=null,r=this.cbTypes.head;null!=r;){var o=r.elt;if(e.id<o.id)break;i=r,r=r.next}var a,s=this.cbTypes;null==t.util.ZNPNode_ZPP_CbType.zpp_pool?a=new t.util.ZNPNode_ZPP_CbType:(a=t.util.ZNPNode_ZPP_CbType.zpp_pool,t.util.ZNPNode_ZPP_CbType.zpp_pool=a.next,a.next=null),a.elt=e;var l=a;null==i?(l.next=s.head,s.head=l):(l.next=i.next,i.next=l),s.pushmod=s.modified=!0,s.length++,null!=n&&(this.alloc_cbSet(),this.wake())}},t.phys.ZPP_Interactor.prototype.alloc_cbSet=function(){var e=null!=this.ishape?null==this.ishape.body?null:this.ishape.body.space:null!=this.ibody?this.ibody.space:this.icompound.space;null!=(this.cbSet=e.cbsets.get(this.cbTypes))&&(this.cbSet.count++,this.cbSet.interactors.add(this),this.cbSet.validate(),e.freshInteractorType(this))},t.phys.ZPP_Interactor.prototype.dealloc_cbSet=function(){var e=null!=this.ishape?null==this.ishape.body?null:this.ishape.body.space:null!=this.ibody?this.ibody.space:this.icompound.space;if(null!=this.cbSet){if(this.cbSet.interactors.remove(this),e.nullInteractorType(this),0==--this.cbSet.count){e.cbsets.remove(this.cbSet);var n=this.cbSet;for(n.listeners.clear(),n.zip_listeners=!0,n.bodylisteners.clear(),n.zip_bodylisteners=!0,n.conlisteners.clear(),n.zip_conlisteners=!0;null!=n.cbTypes.head;)n.cbTypes.pop_unsafe().cbsets.remove(n);n.next=t.callbacks.ZPP_CbSet.zpp_pool,t.callbacks.ZPP_CbSet.zpp_pool=n}this.cbSet=null}},t.phys.ZPP_Interactor.prototype.setGroup=function(e){if(this.group!=e){var t=null!=(null!=this.ishape?null==this.ishape.body?null:this.ishape.body.space:null!=this.ibody?this.ibody.space:this.icompound.space);t&&null!=this.group&&this.group.interactors.remove(this),this.group=e,t&&null!=e&&e.interactors.add(this),t&&(null!=this.ishape?this.ishape.body.wake():null!=this.ibody?this.ibody.wake():this.icompound.wake())}},t.phys.ZPP_Interactor.prototype.immutable_midstep=function(e){if(null!=this.ibody){var t=this.ibody;if(null!=t.space&&t.space.midstep)throw new n._Boot.HaxeError("Error: "+e+" cannot be set during a space step()")}else null!=this.ishape?this.ishape.__immutable_midstep(e):this.icompound.__imutable_midstep(e)},t.phys.ZPP_Interactor.prototype.lookup_group=function(){for(var e=this;null!=e&&null==e.group;)e=null!=e.ishape?e.ishape.body:null!=e.icompound?e.icompound.compound:e.ibody.compound;return null==e?null:e.group},t.phys.ZPP_Interactor.prototype.copyto=function(t){t.zpp_inner_i.group=this.group;var n=this.outer_i;null==n.zpp_inner_i.wrap_cbTypes&&n.zpp_inner_i.setupcbTypes();var i=n.zpp_inner_i.wrap_cbTypes;i.zpp_inner.valmod();for(var o=e.callbacks.CbTypeIterator.get(i);;){o.zpp_inner.zpp_inner.valmod();var a=o.zpp_inner;a.zpp_inner.valmod(),a.zpp_inner.zip_length&&(a.zpp_inner.zip_length=!1,a.zpp_inner.user_length=a.zpp_inner.inner.length);var s,l=a.zpp_inner.user_length;if(o.zpp_critical=!0,o.zpp_i<l?s=!0:(o.zpp_next=e.callbacks.CbTypeIterator.zpp_pool,e.callbacks.CbTypeIterator.zpp_pool=o,o.zpp_inner=null,s=!1),!s)break;o.zpp_critical=!1;var p=o.zpp_inner.at(o.zpp_i++);null==t.zpp_inner_i.wrap_cbTypes&&t.zpp_inner_i.setupcbTypes();var u=t.zpp_inner_i.wrap_cbTypes;u.zpp_inner.reverse_flag?u.push(p):u.unshift(p)}null!=this.userData&&(t.zpp_inner_i.userData=r.copy(this.userData))},t.phys.ZPP_Interactor.prototype.__class__=t.phys.ZPP_Interactor,t.phys.ZPP_Body=l["zpp_nape.phys.ZPP_Body"]=function(){var e;this.wrap_worldCOM=null,this.wrap_localCOM=null,this.zip_worldCOM=!1,this.worldCOMy=0,this.worldCOMx=0,this.zip_localCOM=!1,this.localCOMy=0,this.localCOMx=0,this.zip_aabb=!1,this.aabb=null,this.norotate=!1,this.sinertia=0,this.iinertia=0,this.cinertia=0,this.zip_inertia=!1,this.inertia=0,this.inertiaMode=0,this.zip_gravMassScale=!1,this.gravMassScale=0,this.gravMassMode=0,this.zip_gravMass=!1,this.gravMass=0,this.nomove=!1,this.cmass=0,this.smass=0,this.imass=0,this.massMode=0,this.zip_mass=!1,this.mass=0,this.zip_axis=!1,this.axisy=0,this.axisx=0,this.rot=0,this.pre_rot=0,this.kinangvel=0,this.torque=0,this.angvel=0,this.wrapcvel=null,this.wrap_svel=null,this.svely=0,this.svelx=0,this.wrap_kinvel=null,this.kinvely=0,this.kinvelx=0,this.wrap_force=null,this.forcey=0,this.forcex=0,this.wrap_vel=null,this.vely=0,this.velx=0,this.wrap_pos=null,this.posy=0,this.posx=0,this.pre_posy=0,this.pre_posx=0,this.disableCCD=!1,this.bulletEnabled=!1,this.bullet=!1,this.sweepRadius=0,this.sweepFrozen=!1,this.sweep_angvel=0,this.sweepTime=0,this.graph_depth=0,this.component=null,this.wrap_constraints=null,this.constraints=null,this.wrap_arbiters=null,this.arbiters=null,this.space=null,this.wrap_shapes=null,this.shapes=null,this.compound=null,this.type=0,this.world=!1,this.outer=null,t.phys.ZPP_Interactor.call(this),this.ibody=this,this.world=!1,this.bulletEnabled=!1,this.sweepTime=0,this.sweep_angvel=0,this.norotate=this.nomove=!1,this.disableCCD=!1,this.posx=0,this.posy=0,this.rot=0,this.axisx=0,this.axisy=1,this.svelx=0,this.svely=0,this.velx=0,this.vely=0,this.kinvelx=0,this.kinvely=0,this.forcex=0,this.forcey=0,this.torque=this.angvel=this.kinangvel=0,this.pre_posx=1/0,this.pre_posy=1/0,this.pre_rot=1/0,this.localCOMx=0,this.localCOMy=0,this.worldCOMx=0,this.worldCOMy=0,this.zip_aabb=!0,null==t.geom.ZPP_AABB.zpp_pool?e=new t.geom.ZPP_AABB:(e=t.geom.ZPP_AABB.zpp_pool,t.geom.ZPP_AABB.zpp_pool=e.next,e.next=null),e.minx=0,e.miny=0,e.maxx=0,e.maxy=0,this.aabb=e,this.aabb._immutable=!0,this.aabb._validate=p(this,this.aabb_validate),this.massMode=0,this.gravMassMode=0,this.gravMassScale=1,this.inertiaMode=0,this.arbiters=new t.util.ZNPList_ZPP_Arbiter,this.constraints=new t.util.ZNPList_ZPP_Constraint,this.shapes=new t.util.ZNPList_ZPP_Shape,this.wrap_shapes=t.util.ZPP_ShapeList.get(this.shapes),this.wrap_shapes.zpp_inner.adder=p(this,this.shapes_adder),this.wrap_shapes.zpp_inner.subber=p(this,this.shapes_subber),this.wrap_shapes.zpp_inner._invalidate=p(this,this.shapes_invalidate),this.wrap_shapes.zpp_inner._modifiable=p(this,this.shapes_modifiable),this.kinematicDelaySleep=!1},t.phys.ZPP_Body.__name__=["zpp_nape","phys","ZPP_Body"],t.phys.ZPP_Body.__super__=t.phys.ZPP_Interactor,t.phys.ZPP_Interactor.prototype)t.phys.ZPP_Body.prototype[u]=t.phys.ZPP_Interactor.prototype[u];for(var u in t.phys.ZPP_Body.bodysetlt=function(e,t){return e.id<t.id},t.phys.ZPP_Body.__static=function(){null==t.util.ZPP_Flags.BodyType_STATIC&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.BodyType_STATIC=new e.phys.BodyType,t.util.ZPP_Flags.internal=!1);var n=new e.phys.Body(t.util.ZPP_Flags.BodyType_STATIC),i=n.zpp_inner;return i.world=!0,i.wrap_shapes.zpp_inner.immutable=!0,i.smass=i.imass=i.cmass=i.mass=i.gravMass=0,i.sinertia=i.iinertia=i.cinertia=i.inertia=0,i.cbTypes.clear(),n},t.phys.ZPP_Body.prototype.outer=null,t.phys.ZPP_Body.prototype.world=null,t.phys.ZPP_Body.prototype.type=null,t.phys.ZPP_Body.prototype.isStatic=function(){return 1==this.type},t.phys.ZPP_Body.prototype.isDynamic=function(){return 2==this.type},t.phys.ZPP_Body.prototype.isKinematic=function(){return 3==this.type},t.phys.ZPP_Body.prototype.invalidate_type=function(){this.invalidate_mass(),this.invalidate_inertia()},t.phys.ZPP_Body.prototype.compound=null,t.phys.ZPP_Body.prototype.shapes=null,t.phys.ZPP_Body.prototype.wrap_shapes=null,t.phys.ZPP_Body.prototype.invalidate_shapes=function(){this.zip_aabb=!0,this.zip_localCOM=!0,this.zip_worldCOM=!0,this.invalidate_mass(),this.invalidate_inertia()},t.phys.ZPP_Body.prototype.space=null,t.phys.ZPP_Body.prototype.arbiters=null,t.phys.ZPP_Body.prototype.wrap_arbiters=null,t.phys.ZPP_Body.prototype.constraints=null,t.phys.ZPP_Body.prototype.wrap_constraints=null,t.phys.ZPP_Body.prototype.component=null,t.phys.ZPP_Body.prototype.graph_depth=null,t.phys.ZPP_Body.prototype.init_bodysetlist=function(){null==t.phys.ZPP_Body.bodyset&&(t.phys.ZPP_Body.bodyset=new t.util.ZPP_Set_ZPP_Body,t.phys.ZPP_Body.bodyset.lt=t.phys.ZPP_Body.bodysetlt,t.phys.ZPP_Body.bodystack=new t.util.ZNPList_ZPP_Body)},t.phys.ZPP_Body.prototype.connectedBodies_cont=function(e){t.phys.ZPP_Body.bodyset.try_insert_bool(e.zpp_inner)&&(t.phys.ZPP_Body.bodystack.add(e.zpp_inner),e.zpp_inner.graph_depth=t.phys.ZPP_Body.cur_graph_depth+1)},t.phys.ZPP_Body.prototype.connectedBodies=function(n,i){null==t.phys.ZPP_Body.bodyset&&(t.phys.ZPP_Body.bodyset=new t.util.ZPP_Set_ZPP_Body,t.phys.ZPP_Body.bodyset.lt=t.phys.ZPP_Body.bodysetlt,t.phys.ZPP_Body.bodystack=new t.util.ZNPList_ZPP_Body);var r=null==i?new e.phys.BodyList:i;for(t.phys.ZPP_Body.bodystack.add(this),t.phys.ZPP_Body.bodyset.insert(this),this.graph_depth=0;null!=t.phys.ZPP_Body.bodystack.head;){var o=t.phys.ZPP_Body.bodystack.pop_unsafe();if(o.graph_depth!=n){t.phys.ZPP_Body.cur_graph_depth=o.graph_depth;for(var a=o.constraints.head;null!=a;)a.elt.outer.visitBodies(p(this,this.connectedBodies_cont)),a=a.next}}var s=t.phys.ZPP_Body.bodyset;if(null!=s.parent){for(var l=s.parent;null!=l;)if(null!=l.prev)l=l.prev;else if(null!=l.next)l=l.next;else{var u=l.data;if(u!=this){var h=u.outer;r.zpp_inner.reverse_flag?r.push(h):r.unshift(h)}var c=l.parent;null!=c&&(l==c.prev?c.prev=null:c.next=null,l.parent=null);var _=l;_.data=null,_.lt=null,_.swapped=null,_.next=t.util.ZPP_Set_ZPP_Body.zpp_pool,t.util.ZPP_Set_ZPP_Body.zpp_pool=_,l=c}s.parent=null}return r},t.phys.ZPP_Body.prototype.interactingBodies=function(n,i,r){null==t.phys.ZPP_Body.bodyset&&(t.phys.ZPP_Body.bodyset=new t.util.ZPP_Set_ZPP_Body,t.phys.ZPP_Body.bodyset.lt=t.phys.ZPP_Body.bodysetlt,t.phys.ZPP_Body.bodystack=new t.util.ZNPList_ZPP_Body);var o=null==r?new e.phys.BodyList:r;for(t.phys.ZPP_Body.bodyset.insert(this),t.phys.ZPP_Body.bodystack.add(this),this.graph_depth=0;null!=t.phys.ZPP_Body.bodystack.head;){var a=t.phys.ZPP_Body.bodystack.pop_unsafe();if(a.graph_depth!=i)for(var s=a.arbiters.head;null!=s;){var l=s.elt;if(0!=(l.type&n)){var p=l.b1==a?l.b2:l.b1;t.phys.ZPP_Body.bodyset.try_insert_bool(p)&&(t.phys.ZPP_Body.bodystack.add(p),p.graph_depth=a.graph_depth+1)}s=s.next}}var u=t.phys.ZPP_Body.bodyset;if(null!=u.parent){for(var h=u.parent;null!=h;)if(null!=h.prev)h=h.prev;else if(null!=h.next)h=h.next;else{var c=h.data;if(c!=this){var _=c.outer;o.zpp_inner.reverse_flag?o.push(_):o.unshift(_)}var d=h.parent;null!=d&&(h==d.prev?d.prev=null:d.next=null,h.parent=null);var m=h;m.data=null,m.lt=null,m.swapped=null,m.next=t.util.ZPP_Set_ZPP_Body.zpp_pool,t.util.ZPP_Set_ZPP_Body.zpp_pool=m,h=d}u.parent=null}return o},t.phys.ZPP_Body.prototype.atRest=function(t){if(2!=this.type)return this.component.sleeping;var n,i,r,o=e.Config.linearSleepThreshold;if(o*=o,this.velx*this.velx+this.vely*this.vely>o)n=!1;else if((i=this.posx-this.pre_posx)*i+(r=this.posy-this.pre_posy)*r>.25*o*t*t)n=!1;else{var a,s,l=(a=this.aabb.maxx-this.aabb.minx)*a+(s=this.aabb.maxy-this.aabb.miny)*s,p=e.Config.angularSleepThreshold;if(p*=p,4*this.angvel*this.angvel*l>p)n=!1;else{var u=this.rot-this.pre_rot;n=!(u*u*l>p*t*t)}}return n||(this.component.waket=this.space.stamp),this.component.waket+e.Config.sleepDelay<this.space.stamp},t.phys.ZPP_Body.prototype.refreshArbiters=function(){for(var e=this.arbiters.head;null!=e;)e.elt.invalidated=!0,e=e.next},t.phys.ZPP_Body.prototype.sweepTime=null,t.phys.ZPP_Body.prototype.sweep_angvel=null,t.phys.ZPP_Body.prototype.sweepFrozen=null,t.phys.ZPP_Body.prototype.sweepRadius=null,t.phys.ZPP_Body.prototype.bullet=null,t.phys.ZPP_Body.prototype.bulletEnabled=null,t.phys.ZPP_Body.prototype.disableCCD=null,t.phys.ZPP_Body.prototype.sweepIntegrate=function(e){var t=e-this.sweepTime;if(0!=t){this.sweepTime=e;var n=t;if(this.posx+=this.velx*n,this.posy+=this.vely*n,0!=this.angvel){var i=this.sweep_angvel*t;if(this.rot+=i,i*i>1e-4)this.axisx=Math.sin(this.rot),this.axisy=Math.cos(this.rot);else{var r=i*i,o=1-.5*r,a=1-r*r/8,s=(o*this.axisx+i*this.axisy)*a;this.axisy=(o*this.axisy-i*this.axisx)*a,this.axisx=s}}}},t.phys.ZPP_Body.prototype.sweepValidate=function(e){if(0==e.type)e.worldCOMx=this.posx+(this.axisy*e.localCOMx-this.axisx*e.localCOMy),e.worldCOMy=this.posy+(e.localCOMx*this.axisx+e.localCOMy*this.axisy);else{for(var t=e.polygon,n=t.lverts.next,i=t.gverts.next;null!=i;){var r=i,o=n;n=n.next,r.x=this.posx+(this.axisy*o.x-this.axisx*o.y),r.y=this.posy+(o.x*this.axisx+o.y*this.axisy),i=i.next}var a=t.edges.head,s=t.gverts.next,l=s;for(s=s.next;null!=s;){var p=s,u=a.elt;a=a.next,u.gnormx=this.axisy*u.lnormx-this.axisx*u.lnormy,u.gnormy=u.lnormx*this.axisx+u.lnormy*this.axisy,u.gprojection=this.posx*u.gnormx+this.posy*u.gnormy+u.lprojection,u.tp0=l.y*u.gnormx-l.x*u.gnormy,u.tp1=p.y*u.gnormx-p.x*u.gnormy,l=p,s=s.next}var h=t.gverts.next,c=a.elt;a=a.next,c.gnormx=this.axisy*c.lnormx-this.axisx*c.lnormy,c.gnormy=c.lnormx*this.axisx+c.lnormy*this.axisy,c.gprojection=this.posx*c.gnormx+this.posy*c.gnormy+c.lprojection,c.tp0=l.y*c.gnormx-l.x*c.gnormy,c.tp1=h.y*c.gnormx-h.x*c.gnormy}},t.phys.ZPP_Body.prototype.pre_posx=null,t.phys.ZPP_Body.prototype.pre_posy=null,t.phys.ZPP_Body.prototype.posx=null,t.phys.ZPP_Body.prototype.posy=null,t.phys.ZPP_Body.prototype.wrap_pos=null,t.phys.ZPP_Body.prototype.velx=null,t.phys.ZPP_Body.prototype.vely=null,t.phys.ZPP_Body.prototype.wrap_vel=null,t.phys.ZPP_Body.prototype.forcex=null,t.phys.ZPP_Body.prototype.forcey=null,t.phys.ZPP_Body.prototype.wrap_force=null,t.phys.ZPP_Body.prototype.kinvelx=null,t.phys.ZPP_Body.prototype.kinvely=null,t.phys.ZPP_Body.prototype.wrap_kinvel=null,t.phys.ZPP_Body.prototype.svelx=null,t.phys.ZPP_Body.prototype.svely=null,t.phys.ZPP_Body.prototype.wrap_svel=null,t.phys.ZPP_Body.prototype.invalidate_pos=function(){for(var e=this.shapes.head;null!=e;){var t=e.elt;1==t.type&&(t.polygon.invalidate_gverts(),t.polygon.invalidate_gaxi()),t.invalidate_worldCOM(),e=e.next}this.zip_worldCOM=!0},t.phys.ZPP_Body.prototype.pos_invalidate=function(e){if(this.immutable_midstep("Body::position"),1==this.type&&null!=this.space)throw new n._Boot.HaxeError("Error: Cannot move a static object once inside a Space");if(this.posx!=e.x||this.posy!=e.y){this.posx=e.x,this.posy=e.y;for(var t=this.shapes.head;null!=t;){var i=t.elt;1==i.type&&(i.polygon.invalidate_gverts(),i.polygon.invalidate_gaxi()),i.invalidate_worldCOM(),t=t.next}this.zip_worldCOM=!0,this.wake()}},t.phys.ZPP_Body.prototype.pos_validate=function(){this.wrap_pos.zpp_inner.x=this.posx,this.wrap_pos.zpp_inner.y=this.posy},t.phys.ZPP_Body.prototype.vel_invalidate=function(e){if(1==this.type)throw new n._Boot.HaxeError("Error: Static body cannot have its velocity set.");this.velx=e.x,this.vely=e.y,this.wake()},t.phys.ZPP_Body.prototype.vel_validate=function(){this.wrap_vel.zpp_inner.x=this.velx,this.wrap_vel.zpp_inner.y=this.vely},t.phys.ZPP_Body.prototype.kinvel_invalidate=function(e){this.kinvelx=e.x,this.kinvely=e.y,this.wake()},t.phys.ZPP_Body.prototype.kinvel_validate=function(){this.wrap_kinvel.zpp_inner.x=this.kinvelx,this.wrap_kinvel.zpp_inner.y=this.kinvely},t.phys.ZPP_Body.prototype.svel_invalidate=function(e){this.svelx=e.x,this.svely=e.y,this.wake()},t.phys.ZPP_Body.prototype.svel_validate=function(){this.wrap_svel.zpp_inner.x=this.svelx,this.wrap_svel.zpp_inner.y=this.svely},t.phys.ZPP_Body.prototype.force_invalidate=function(e){if(2!=this.type)throw new n._Boot.HaxeError("Error: Non-dynamic body cannot have force applied.");this.forcex=e.x,this.forcey=e.y,this.wake()},t.phys.ZPP_Body.prototype.force_validate=function(){this.wrap_force.zpp_inner.x=this.forcex,this.wrap_force.zpp_inner.y=this.forcey},t.phys.ZPP_Body.prototype.setupPosition=function(){var i,r=this.posx,o=this.posy;if(null==o&&(o=0),null==r&&(r=0),r!=r||o!=o)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null==t.util.ZPP_PubPool.poolVec2?i=new e.geom.Vec2:(i=t.util.ZPP_PubPool.poolVec2,t.util.ZPP_PubPool.poolVec2=i.zpp_pool,i.zpp_pool=null,i.zpp_disp=!1,i==t.util.ZPP_PubPool.nextVec2&&(t.util.ZPP_PubPool.nextVec2=null)),null==i.zpp_inner){var a;null==t.geom.ZPP_Vec2.zpp_pool?a=new t.geom.ZPP_Vec2:(a=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=a.next,a.next=null),a.weak=!1,a._immutable=!1,a.x=r,a.y=o,i.zpp_inner=a,i.zpp_inner.outer=i}else{if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var s,l=i.zpp_inner;if(l._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=l._isimmutable&&l._isimmutable(),r!=r||o!=o)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var u=i.zpp_inner;if(null!=u._validate&&u._validate(),i.zpp_inner.x==r){if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var h=i.zpp_inner;null!=h._validate&&h._validate(),s=i.zpp_inner.y==o}else s=!1;if(!s){i.zpp_inner.x=r,i.zpp_inner.y=o;var c=i.zpp_inner;null!=c._invalidate&&c._invalidate(c)}}i.zpp_inner.weak=!1,this.wrap_pos=i,this.wrap_pos.zpp_inner._inuse=!0,this.world?this.wrap_pos.zpp_inner._immutable=!0:(this.wrap_pos.zpp_inner._invalidate=p(this,this.pos_invalidate),this.wrap_pos.zpp_inner._validate=p(this,this.pos_validate))},t.phys.ZPP_Body.prototype.setupVelocity=function(){var i,r=this.velx,o=this.vely;if(null==o&&(o=0),null==r&&(r=0),r!=r||o!=o)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null==t.util.ZPP_PubPool.poolVec2?i=new e.geom.Vec2:(i=t.util.ZPP_PubPool.poolVec2,t.util.ZPP_PubPool.poolVec2=i.zpp_pool,i.zpp_pool=null,i.zpp_disp=!1,i==t.util.ZPP_PubPool.nextVec2&&(t.util.ZPP_PubPool.nextVec2=null)),null==i.zpp_inner){var a;null==t.geom.ZPP_Vec2.zpp_pool?a=new t.geom.ZPP_Vec2:(a=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=a.next,a.next=null),a.weak=!1,a._immutable=!1,a.x=r,a.y=o,i.zpp_inner=a,i.zpp_inner.outer=i}else{if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var s,l=i.zpp_inner;if(l._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=l._isimmutable&&l._isimmutable(),r!=r||o!=o)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var u=i.zpp_inner;if(null!=u._validate&&u._validate(),i.zpp_inner.x==r){if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var h=i.zpp_inner;null!=h._validate&&h._validate(),s=i.zpp_inner.y==o}else s=!1;if(!s){i.zpp_inner.x=r,i.zpp_inner.y=o;var c=i.zpp_inner;null!=c._invalidate&&c._invalidate(c)}}i.zpp_inner.weak=!1,this.wrap_vel=i,this.wrap_vel.zpp_inner._inuse=!0,this.world?this.wrap_vel.zpp_inner._immutable=!0:(this.wrap_vel.zpp_inner._invalidate=p(this,this.vel_invalidate),this.wrap_vel.zpp_inner._validate=p(this,this.vel_validate))},t.phys.ZPP_Body.prototype.setupkinvel=function(){var i,r=this.kinvelx,o=this.kinvely;if(null==o&&(o=0),null==r&&(r=0),r!=r||o!=o)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null==t.util.ZPP_PubPool.poolVec2?i=new e.geom.Vec2:(i=t.util.ZPP_PubPool.poolVec2,t.util.ZPP_PubPool.poolVec2=i.zpp_pool,i.zpp_pool=null,i.zpp_disp=!1,i==t.util.ZPP_PubPool.nextVec2&&(t.util.ZPP_PubPool.nextVec2=null)),null==i.zpp_inner){var a;null==t.geom.ZPP_Vec2.zpp_pool?a=new t.geom.ZPP_Vec2:(a=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=a.next,a.next=null),a.weak=!1,a._immutable=!1,a.x=r,a.y=o,i.zpp_inner=a,i.zpp_inner.outer=i}else{if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var s,l=i.zpp_inner;if(l._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=l._isimmutable&&l._isimmutable(),r!=r||o!=o)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var u=i.zpp_inner;if(null!=u._validate&&u._validate(),i.zpp_inner.x==r){if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var h=i.zpp_inner;null!=h._validate&&h._validate(),s=i.zpp_inner.y==o}else s=!1;if(!s){i.zpp_inner.x=r,i.zpp_inner.y=o;var c=i.zpp_inner;null!=c._invalidate&&c._invalidate(c)}}i.zpp_inner.weak=!1,this.wrap_kinvel=i,this.wrap_kinvel.zpp_inner._inuse=!0,this.world?this.wrap_kinvel.zpp_inner._immutable=!0:(this.wrap_kinvel.zpp_inner._invalidate=p(this,this.kinvel_invalidate),this.wrap_kinvel.zpp_inner._validate=p(this,this.kinvel_validate))},t.phys.ZPP_Body.prototype.setupsvel=function(){var i,r=this.svelx,o=this.svely;if(null==o&&(o=0),null==r&&(r=0),r!=r||o!=o)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null==t.util.ZPP_PubPool.poolVec2?i=new e.geom.Vec2:(i=t.util.ZPP_PubPool.poolVec2,t.util.ZPP_PubPool.poolVec2=i.zpp_pool,i.zpp_pool=null,i.zpp_disp=!1,i==t.util.ZPP_PubPool.nextVec2&&(t.util.ZPP_PubPool.nextVec2=null)),null==i.zpp_inner){var a;null==t.geom.ZPP_Vec2.zpp_pool?a=new t.geom.ZPP_Vec2:(a=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=a.next,a.next=null),a.weak=!1,a._immutable=!1,a.x=r,a.y=o,i.zpp_inner=a,i.zpp_inner.outer=i}else{if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var s,l=i.zpp_inner;if(l._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=l._isimmutable&&l._isimmutable(),r!=r||o!=o)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var u=i.zpp_inner;if(null!=u._validate&&u._validate(),i.zpp_inner.x==r){if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var h=i.zpp_inner;null!=h._validate&&h._validate(),s=i.zpp_inner.y==o}else s=!1;if(!s){i.zpp_inner.x=r,i.zpp_inner.y=o;var c=i.zpp_inner;null!=c._invalidate&&c._invalidate(c)}}i.zpp_inner.weak=!1,this.wrap_svel=i,this.wrap_svel.zpp_inner._inuse=!0,this.world?this.wrap_svel.zpp_inner._immutable=!0:(this.wrap_svel.zpp_inner._invalidate=p(this,this.svel_invalidate),this.wrap_svel.zpp_inner._validate=p(this,this.svel_validate))},t.phys.ZPP_Body.prototype.setupForce=function(){var i,r=this.forcex,o=this.forcey;if(null==o&&(o=0),null==r&&(r=0),r!=r||o!=o)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null==t.util.ZPP_PubPool.poolVec2?i=new e.geom.Vec2:(i=t.util.ZPP_PubPool.poolVec2,t.util.ZPP_PubPool.poolVec2=i.zpp_pool,i.zpp_pool=null,i.zpp_disp=!1,i==t.util.ZPP_PubPool.nextVec2&&(t.util.ZPP_PubPool.nextVec2=null)),null==i.zpp_inner){var a;null==t.geom.ZPP_Vec2.zpp_pool?a=new t.geom.ZPP_Vec2:(a=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=a.next,a.next=null),a.weak=!1,a._immutable=!1,a.x=r,a.y=o,i.zpp_inner=a,i.zpp_inner.outer=i}else{if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var s,l=i.zpp_inner;if(l._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=l._isimmutable&&l._isimmutable(),r!=r||o!=o)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var u=i.zpp_inner;if(null!=u._validate&&u._validate(),i.zpp_inner.x==r){if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var h=i.zpp_inner;null!=h._validate&&h._validate(),s=i.zpp_inner.y==o}else s=!1;if(!s){i.zpp_inner.x=r,i.zpp_inner.y=o;var c=i.zpp_inner;null!=c._invalidate&&c._invalidate(c)}}i.zpp_inner.weak=!1,this.wrap_force=i,this.wrap_force.zpp_inner._inuse=!0,this.world?this.wrap_force.zpp_inner._immutable=!0:(this.wrap_force.zpp_inner._invalidate=p(this,this.force_invalidate),this.wrap_force.zpp_inner._validate=p(this,this.force_validate))},t.phys.ZPP_Body.prototype.cvel_validate=function(){this.wrapcvel.zpp_inner.x=this.velx+this.kinvelx,this.wrapcvel.zpp_inner.y=this.vely+this.kinvely,this.wrapcvel.zpp_inner.z=this.angvel+this.kinangvel},t.phys.ZPP_Body.prototype.wrapcvel=null,t.phys.ZPP_Body.prototype.setup_cvel=function(){this.wrapcvel=e.geom.Vec3.get(),this.wrapcvel.zpp_inner.immutable=!0,this.wrapcvel.zpp_inner._validate=p(this,this.cvel_validate)},t.phys.ZPP_Body.prototype.angvel=null,t.phys.ZPP_Body.prototype.torque=null,t.phys.ZPP_Body.prototype.kinangvel=null,t.phys.ZPP_Body.prototype.pre_rot=null,t.phys.ZPP_Body.prototype.rot=null,t.phys.ZPP_Body.prototype.invalidate_rot=function(){this.zip_axis=!0;for(var e=this.shapes.head;null!=e;){var t=e.elt;1==t.type&&(t.polygon.invalidate_gverts(),t.polygon.invalidate_gaxi()),t.invalidate_worldCOM(),e=e.next}this.zip_worldCOM=!0},t.phys.ZPP_Body.prototype.axisx=null,t.phys.ZPP_Body.prototype.axisy=null,t.phys.ZPP_Body.prototype.zip_axis=null,t.phys.ZPP_Body.prototype.validate_axis=function(){this.zip_axis&&(this.zip_axis=!1,this.axisx=Math.sin(this.rot),this.axisy=Math.cos(this.rot))},t.phys.ZPP_Body.prototype.quick_validate_axis=function(){this.axisx=Math.sin(this.rot),this.axisy=Math.cos(this.rot)},t.phys.ZPP_Body.prototype.delta_rot=function(e){if(this.rot+=e,e*e>1e-4)this.axisx=Math.sin(this.rot),this.axisy=Math.cos(this.rot);else{var t=e*e,n=1-.5*t,i=1-t*t/8,r=(n*this.axisx+e*this.axisy)*i;this.axisy=(n*this.axisy-e*this.axisx)*i,this.axisx=r}},t.phys.ZPP_Body.prototype.kinematicDelaySleep=null,t.phys.ZPP_Body.prototype.mass=null,t.phys.ZPP_Body.prototype.zip_mass=null,t.phys.ZPP_Body.prototype.massMode=null,t.phys.ZPP_Body.prototype.imass=null,t.phys.ZPP_Body.prototype.smass=null,t.phys.ZPP_Body.prototype.cmass=null,t.phys.ZPP_Body.prototype.nomove=null,t.phys.ZPP_Body.prototype.invalidate_mass=function(){this.zip_mass=!0,this.invalidate_gravMass()},t.phys.ZPP_Body.prototype.validate_mass=function(){if(this.zip_mass||(this.massMode,0)){if(this.zip_mass=!1,0==this.massMode){this.cmass=0;for(var e=this.shapes.head;null!=e;){var t=e.elt;t.refmaterial.density=t.material.density,t.validate_area_inertia(),this.cmass+=t.area*t.material.density,e=e.next}}2!=this.type||this.nomove?(this.mass=1/0,this.imass=this.smass=0):(this.mass=this.cmass,this.imass=this.smass=1/this.mass)}},t.phys.ZPP_Body.prototype.gravMass=null,t.phys.ZPP_Body.prototype.zip_gravMass=null,t.phys.ZPP_Body.prototype.gravMassMode=null,t.phys.ZPP_Body.prototype.gravMassScale=null,t.phys.ZPP_Body.prototype.zip_gravMassScale=null,t.phys.ZPP_Body.prototype.invalidate_gravMass=function(){1!=this.gravMassMode&&(this.zip_gravMass=!0),2!=this.gravMassMode&&(this.zip_gravMassScale=!0),this.wake()},t.phys.ZPP_Body.prototype.validate_gravMass=function(){this.zip_gravMass&&(this.zip_gravMass=!1,this.validate_mass(),0==this.gravMassMode?(this.validate_mass(),this.gravMass=this.cmass):2==this.gravMassMode&&(this.validate_mass(),this.gravMass=this.cmass*this.gravMassScale))},t.phys.ZPP_Body.prototype.invalidate_gravMassScale=function(){2!=this.gravMassMode?this.zip_gravMassScale=!0:this.invalidate_gravMass()},t.phys.ZPP_Body.prototype.validate_gravMassScale=function(){this.zip_gravMassScale&&(this.zip_gravMassScale=!1,0==this.gravMassMode?this.gravMassScale=1:1==this.gravMassMode&&(this.validate_mass(),this.gravMassScale=this.gravMass/this.cmass))},t.phys.ZPP_Body.prototype.inertiaMode=null,t.phys.ZPP_Body.prototype.inertia=null,t.phys.ZPP_Body.prototype.zip_inertia=null,t.phys.ZPP_Body.prototype.cinertia=null,t.phys.ZPP_Body.prototype.iinertia=null,t.phys.ZPP_Body.prototype.sinertia=null,t.phys.ZPP_Body.prototype.norotate=null,t.phys.ZPP_Body.prototype.invalidate_inertia=function(){this.zip_inertia=!0,this.wake()},t.phys.ZPP_Body.prototype.validate_inertia=function(){if(this.zip_inertia||(this.inertiaMode,0)){if(this.zip_inertia=!1,0==this.inertiaMode){this.cinertia=0;for(var e=this.shapes.head;null!=e;){var t=e.elt;t.refmaterial.density=t.material.density,t.validate_area_inertia(),this.cinertia+=t.inertia*t.area*t.material.density,e=e.next}}2!=this.type||this.norotate?(this.inertia=1/0,this.sinertia=this.iinertia=0):(this.inertia=this.cinertia,this.sinertia=this.iinertia=1/this.inertia)}},t.phys.ZPP_Body.prototype.invalidate_wake=function(){this.wake()},t.phys.ZPP_Body.prototype.aabb=null,t.phys.ZPP_Body.prototype.zip_aabb=null,t.phys.ZPP_Body.prototype.validate_aabb=function(){if(null==this.shapes.head)throw new n._Boot.HaxeError("Error: Body bounds only makes sense if it contains shapes");if(this.zip_aabb){this.zip_aabb=!1,this.aabb.minx=1/0,this.aabb.miny=1/0,this.aabb.maxx=-1/0,this.aabb.maxy=-1/0;for(var e=this.shapes.head;null!=e;){var t=e.elt;if(t.zip_aabb&&null!=t.body)if(t.zip_aabb=!1,0==t.type){var i=t.circle;if(i.zip_worldCOM&&null!=i.body){if(i.zip_worldCOM=!1,i.zip_localCOM){if(i.zip_localCOM=!1,1==i.type){var r=i.polygon;if(null==r.lverts.next)throw new n._Boot.HaxeError("Error: An empty polygon has no meaningful localCOM");if(null==r.lverts.next.next)r.localCOMx=r.lverts.next.x,r.localCOMy=r.lverts.next.y;else if(null==r.lverts.next.next.next)r.localCOMx=r.lverts.next.x,r.localCOMy=r.lverts.next.y,r.localCOMx+=1*r.lverts.next.next.x,r.localCOMy+=1*r.lverts.next.next.y,r.localCOMx*=.5,r.localCOMy*=.5;else{r.localCOMx=0,r.localCOMy=0;var o=0,a=r.lverts.next,s=a,l=a=a.next;for(a=a.next;null!=a;){var p=a;o+=l.x*(p.y-s.y);var u=p.y*l.x-p.x*l.y;r.localCOMx+=(l.x+p.x)*u,r.localCOMy+=(l.y+p.y)*u,s=l,l=p,a=a.next}var h=a=r.lverts.next;o+=l.x*(h.y-s.y);var c=h.y*l.x-h.x*l.y;r.localCOMx+=(l.x+h.x)*c,r.localCOMy+=(l.y+h.y)*c,s=l,l=h;var _=a=a.next;o+=l.x*(_.y-s.y);var d=_.y*l.x-_.x*l.y;r.localCOMx+=(l.x+_.x)*d,r.localCOMy+=(l.y+_.y)*d;var m=o=1/(3*o);r.localCOMx*=m,r.localCOMy*=m}}null!=i.wrap_localCOM&&(i.wrap_localCOM.zpp_inner.x=i.localCOMx,i.wrap_localCOM.zpp_inner.y=i.localCOMy)}var P=i.body;P.zip_axis&&(P.zip_axis=!1,P.axisx=Math.sin(P.rot),P.axisy=Math.cos(P.rot)),i.worldCOMx=i.body.posx+(i.body.axisy*i.localCOMx-i.body.axisx*i.localCOMy),i.worldCOMy=i.body.posy+(i.localCOMx*i.body.axisx+i.localCOMy*i.body.axisy)}var f=i.radius,x=i.radius;i.aabb.minx=i.worldCOMx-f,i.aabb.miny=i.worldCOMy-x,i.aabb.maxx=i.worldCOMx+f,i.aabb.maxy=i.worldCOMy+x}else{var y=t.polygon;if(y.zip_gverts&&null!=y.body){y.zip_gverts=!1,y.validate_lverts();var v=y.body;v.zip_axis&&(v.zip_axis=!1,v.axisx=Math.sin(v.rot),v.axisy=Math.cos(v.rot));for(var g=y.lverts.next,b=y.gverts.next;null!=b;){var z=b,w=g;g=g.next,z.x=y.body.posx+(y.body.axisy*w.x-y.body.axisx*w.y),z.y=y.body.posy+(w.x*y.body.axisx+w.y*y.body.axisy),b=b.next}}if(null==y.lverts.next)throw new n._Boot.HaxeError("Error: An empty polygon has no meaningful bounds");var Z=y.gverts.next;y.aabb.minx=Z.x,y.aabb.miny=Z.y,y.aabb.maxx=Z.x,y.aabb.maxy=Z.y;for(var E=y.gverts.next.next;null!=E;){var M=E;M.x<y.aabb.minx&&(y.aabb.minx=M.x),M.x>y.aabb.maxx&&(y.aabb.maxx=M.x),M.y<y.aabb.miny&&(y.aabb.miny=M.y),M.y>y.aabb.maxy&&(y.aabb.maxy=M.y),E=E.next}}var S=this.aabb,C=t.aabb;C.minx<S.minx&&(S.minx=C.minx),C.maxx>S.maxx&&(S.maxx=C.maxx),C.miny<S.miny&&(S.miny=C.miny),C.maxy>S.maxy&&(S.maxy=C.maxy),e=e.next}}},t.phys.ZPP_Body.prototype.invalidate_aabb=function(){this.zip_aabb=!0},t.phys.ZPP_Body.prototype.localCOMx=null,t.phys.ZPP_Body.prototype.localCOMy=null,t.phys.ZPP_Body.prototype.zip_localCOM=null,t.phys.ZPP_Body.prototype.worldCOMx=null,t.phys.ZPP_Body.prototype.worldCOMy=null,t.phys.ZPP_Body.prototype.zip_worldCOM=null,t.phys.ZPP_Body.prototype.wrap_localCOM=null,t.phys.ZPP_Body.prototype.wrap_worldCOM=null,t.phys.ZPP_Body.prototype.invalidate_localCOM=function(){this.zip_localCOM=!0,this.zip_worldCOM=!0},t.phys.ZPP_Body.prototype.invalidate_worldCOM=function(){this.zip_worldCOM=!0},t.phys.ZPP_Body.prototype.validate_localCOM=function(){if(this.zip_localCOM){this.zip_localCOM=!1;for(var e=0,t=0,i=0,r=this.shapes.head;null!=r;){var o=r.elt;if(o.zip_localCOM){if(o.zip_localCOM=!1,1==o.type){var a=o.polygon;if(null==a.lverts.next)throw new n._Boot.HaxeError("Error: An empty polygon has no meaningful localCOM");if(null==a.lverts.next.next)a.localCOMx=a.lverts.next.x,a.localCOMy=a.lverts.next.y;else if(null==a.lverts.next.next.next)a.localCOMx=a.lverts.next.x,a.localCOMy=a.lverts.next.y,a.localCOMx+=1*a.lverts.next.next.x,a.localCOMy+=1*a.lverts.next.next.y,a.localCOMx*=.5,a.localCOMy*=.5;else{a.localCOMx=0,a.localCOMy=0;var s=0,l=a.lverts.next,p=l,u=l=l.next;for(l=l.next;null!=l;){var h=l;s+=u.x*(h.y-p.y);var c=h.y*u.x-h.x*u.y;a.localCOMx+=(u.x+h.x)*c,a.localCOMy+=(u.y+h.y)*c,p=u,u=h,l=l.next}var _=l=a.lverts.next;s+=u.x*(_.y-p.y);var d=_.y*u.x-_.x*u.y;a.localCOMx+=(u.x+_.x)*d,a.localCOMy+=(u.y+_.y)*d,p=u,u=_;var m=l=l.next;s+=u.x*(m.y-p.y);var P=m.y*u.x-m.x*u.y;a.localCOMx+=(u.x+m.x)*P,a.localCOMy+=(u.y+m.y)*P;var f=s=1/(3*s);a.localCOMx*=f,a.localCOMy*=f}}null!=o.wrap_localCOM&&(o.wrap_localCOM.zpp_inner.x=o.localCOMx,o.wrap_localCOM.zpp_inner.y=o.localCOMy)}o.validate_area_inertia();var x=o.area*o.material.density;e+=o.localCOMx*x,t+=o.localCOMy*x,i+=o.area*o.material.density,r=r.next}if(0!=i){var y=1/i;this.localCOMx=e*y,this.localCOMy=t*y}null!=this.wrap_localCOM&&(this.wrap_localCOM.zpp_inner.x=this.localCOMx,this.wrap_localCOM.zpp_inner.y=this.localCOMy),this.zip_mass&&0==this.massMode&&(this.zip_mass=!1,this.cmass=i,2==this.type?(this.mass=this.cmass,this.imass=this.smass=1/this.mass):(this.mass=1/0,this.imass=this.smass=0))}},t.phys.ZPP_Body.prototype.validate_worldCOM=function(){this.zip_worldCOM&&(this.zip_worldCOM=!1,this.validate_localCOM(),this.zip_axis&&(this.zip_axis=!1,this.axisx=Math.sin(this.rot),this.axisy=Math.cos(this.rot)),this.worldCOMx=this.posx+(this.axisy*this.localCOMx-this.axisx*this.localCOMy),this.worldCOMy=this.posy+(this.localCOMx*this.axisx+this.localCOMy*this.axisy),null!=this.wrap_worldCOM&&(this.wrap_worldCOM.zpp_inner.x=this.worldCOMx,this.wrap_worldCOM.zpp_inner.y=this.worldCOMy))},t.phys.ZPP_Body.prototype.getlocalCOM=function(){if(null==this.shapes.head)throw new n._Boot.HaxeError("Error: localCOM only makes sense when Body has Shapes");this.validate_localCOM()},t.phys.ZPP_Body.prototype.getworldCOM=function(){if(null==this.shapes.head)throw new n._Boot.HaxeError("Error: worldCOM only makes sense when Body has Shapes");this.validate_worldCOM()},t.phys.ZPP_Body.prototype.__immutable_midstep=function(e){if(null!=this.space&&this.space.midstep)throw new n._Boot.HaxeError("Error: "+e+" cannot be set during a space step()")},t.phys.ZPP_Body.prototype.clear=function(){if(null!=this.space)throw new n._Boot.HaxeError("Error: Cannot clear a Body if it is currently being used by a Space!");if(null!=this.constraints.head)throw new n._Boot.HaxeError("Error: Cannot clear a Body if it is currently being used by a constraint!");for(;null!=this.shapes.head;){var e=this.shapes.pop_unsafe();e.removedFromBody(),e.body=null}this.invalidate_shapes(),this.pre_posx=0,this.pre_posy=0,this.posx=0,this.posy=0,this.velx=0,this.vely=0,this.forcex=0,this.forcey=0,this.kinvelx=0,this.kinvely=0,this.svelx=0,this.svely=0,this.angvel=this.torque=this.kinangvel=this.pre_rot=this.rot=0;for(var t=this.shapes.head;null!=t;){var i=t.elt;1==i.type&&(i.polygon.invalidate_gverts(),i.polygon.invalidate_gaxi()),i.invalidate_worldCOM(),t=t.next}this.zip_worldCOM=!0,this.zip_axis=!0;for(var r=this.shapes.head;null!=r;){var o=r.elt;1==o.type&&(o.polygon.invalidate_gverts(),o.polygon.invalidate_gaxi()),o.invalidate_worldCOM(),r=r.next}this.zip_worldCOM=!0,this.axisx=0,this.axisy=1,this.zip_axis=!1,this.massMode=0,this.gravMassMode=0,this.gravMassScale=1,this.inertiaMode=0,this.norotate=!1,this.nomove=!1},t.phys.ZPP_Body.prototype.aabb_validate=function(){if(null==this.shapes.head)throw new n._Boot.HaxeError("Error: bounds only makes sense when Body has shapes");if(null==this.shapes.head)throw new n._Boot.HaxeError("Error: Body bounds only makes sense if it contains shapes");if(this.zip_aabb){this.zip_aabb=!1,this.aabb.minx=1/0,this.aabb.miny=1/0,this.aabb.maxx=-1/0,this.aabb.maxy=-1/0;for(var e=this.shapes.head;null!=e;){var t=e.elt;if(t.zip_aabb&&null!=t.body)if(t.zip_aabb=!1,0==t.type){var i=t.circle;if(i.zip_worldCOM&&null!=i.body){if(i.zip_worldCOM=!1,i.zip_localCOM){if(i.zip_localCOM=!1,1==i.type){var r=i.polygon;if(null==r.lverts.next)throw new n._Boot.HaxeError("Error: An empty polygon has no meaningful localCOM");if(null==r.lverts.next.next)r.localCOMx=r.lverts.next.x,r.localCOMy=r.lverts.next.y;else if(null==r.lverts.next.next.next)r.localCOMx=r.lverts.next.x,r.localCOMy=r.lverts.next.y,r.localCOMx+=1*r.lverts.next.next.x,r.localCOMy+=1*r.lverts.next.next.y,r.localCOMx*=.5,r.localCOMy*=.5;else{r.localCOMx=0,r.localCOMy=0;var o=0,a=r.lverts.next,s=a,l=a=a.next;for(a=a.next;null!=a;){var p=a;o+=l.x*(p.y-s.y);var u=p.y*l.x-p.x*l.y;r.localCOMx+=(l.x+p.x)*u,r.localCOMy+=(l.y+p.y)*u,s=l,l=p,a=a.next}var h=a=r.lverts.next;o+=l.x*(h.y-s.y);var c=h.y*l.x-h.x*l.y;r.localCOMx+=(l.x+h.x)*c,r.localCOMy+=(l.y+h.y)*c,s=l,l=h;var _=a=a.next;o+=l.x*(_.y-s.y);var d=_.y*l.x-_.x*l.y;r.localCOMx+=(l.x+_.x)*d,r.localCOMy+=(l.y+_.y)*d;var m=o=1/(3*o);r.localCOMx*=m,r.localCOMy*=m}}null!=i.wrap_localCOM&&(i.wrap_localCOM.zpp_inner.x=i.localCOMx,i.wrap_localCOM.zpp_inner.y=i.localCOMy)}var P=i.body;P.zip_axis&&(P.zip_axis=!1,P.axisx=Math.sin(P.rot),P.axisy=Math.cos(P.rot)),i.worldCOMx=i.body.posx+(i.body.axisy*i.localCOMx-i.body.axisx*i.localCOMy),i.worldCOMy=i.body.posy+(i.localCOMx*i.body.axisx+i.localCOMy*i.body.axisy)}var f=i.radius,x=i.radius;i.aabb.minx=i.worldCOMx-f,i.aabb.miny=i.worldCOMy-x,i.aabb.maxx=i.worldCOMx+f,i.aabb.maxy=i.worldCOMy+x}else{var y=t.polygon;if(y.zip_gverts&&null!=y.body){y.zip_gverts=!1,y.validate_lverts();var v=y.body;v.zip_axis&&(v.zip_axis=!1,v.axisx=Math.sin(v.rot),v.axisy=Math.cos(v.rot));for(var g=y.lverts.next,b=y.gverts.next;null!=b;){var z=b,w=g;g=g.next,z.x=y.body.posx+(y.body.axisy*w.x-y.body.axisx*w.y),z.y=y.body.posy+(w.x*y.body.axisx+w.y*y.body.axisy),b=b.next}}if(null==y.lverts.next)throw new n._Boot.HaxeError("Error: An empty polygon has no meaningful bounds");var Z=y.gverts.next;y.aabb.minx=Z.x,y.aabb.miny=Z.y,y.aabb.maxx=Z.x,y.aabb.maxy=Z.y;for(var E=y.gverts.next.next;null!=E;){var M=E;M.x<y.aabb.minx&&(y.aabb.minx=M.x),M.x>y.aabb.maxx&&(y.aabb.maxx=M.x),M.y<y.aabb.miny&&(y.aabb.miny=M.y),M.y>y.aabb.maxy&&(y.aabb.maxy=M.y),E=E.next}}var S=this.aabb,C=t.aabb;C.minx<S.minx&&(S.minx=C.minx),C.maxx>S.maxx&&(S.maxx=C.maxx),C.miny<S.miny&&(S.miny=C.miny),C.maxy>S.maxy&&(S.maxy=C.maxy),e=e.next}}},t.phys.ZPP_Body.prototype.shapes_adder=function(e){if(e.zpp_inner.body!=this){if(null!=e.zpp_inner.body&&e.zpp_inner.body.wrap_shapes.remove(e),e.zpp_inner.body=this,e.zpp_inner.addedToBody(),null!=this.space){var t=this.space,n=e.zpp_inner,i=n.body;i.world||(i.component.waket=t.stamp+(t.midstep?0:1),3==i.type&&(i.kinematicDelaySleep=!0),i.component.sleeping&&t.really_wake(i,!1)),t.bphase.insert(n),n.addedToSpace()}return 1==e.zpp_inner.type&&(e.zpp_inner.polygon.invalidate_gaxi(),e.zpp_inner.polygon.invalidate_gverts()),!0}return!1},t.phys.ZPP_Body.prototype.shapes_subber=function(e){null!=this.space&&this.space.removed_shape(e.zpp_inner),e.zpp_inner.body=null,e.zpp_inner.removedFromBody()},t.phys.ZPP_Body.prototype.shapes_invalidate=function(e){this.invalidate_shapes()},t.phys.ZPP_Body.prototype.shapes_modifiable=function(){if(this.immutable_midstep("Body::shapes"),1==this.type&&null!=this.space)throw new n._Boot.HaxeError("Error: Cannot modifiy shapes of static object once added to Space")},t.phys.ZPP_Body.prototype.addedToSpace=function(){null==t.space.ZPP_Component.zpp_pool?this.component=new t.space.ZPP_Component:(this.component=t.space.ZPP_Component.zpp_pool,t.space.ZPP_Component.zpp_pool=this.component.next,this.component.next=null),this.component.isBody=!0,this.component.body=this,this.__iaddedToSpace()},t.phys.ZPP_Body.prototype.removedFromSpace=function(){for(;null!=this.arbiters.head;){var e=this.arbiters.pop_unsafe(),n=this.space;if(e.cleared=!0,e.b2==this)for(var i=e.b1.arbiters,r=null,o=i.head;null!=o;){if(o.elt==e){var a,s;null==r?(s=(a=i.head).next,i.head=s,null==i.head&&(i.pushmod=!0)):(s=(a=r.next).next,r.next=s,null==s&&(i.pushmod=!0));var l=a;l.elt=null,l.next=t.util.ZNPNode_ZPP_Arbiter.zpp_pool,t.util.ZNPNode_ZPP_Arbiter.zpp_pool=l,i.modified=!0,i.length--,i.pushmod=!0;break}r=o,o=o.next}if(e.b1==this)for(var p=e.b2.arbiters,u=null,h=p.head;null!=h;){if(h.elt==e){var c,_;null==u?(_=(c=p.head).next,p.head=_,null==p.head&&(p.pushmod=!0)):(_=(c=u.next).next,u.next=_,null==_&&(p.pushmod=!0));var d=c;d.elt=null,d.next=t.util.ZNPNode_ZPP_Arbiter.zpp_pool,t.util.ZNPNode_ZPP_Arbiter.zpp_pool=d,p.modified=!0,p.length--,p.pushmod=!0;break}u=h,h=h.next}null!=e.pair&&(e.pair.arb=null,e.pair=null),e.active=!1,n.f_arbiters.modified=!0}var m=this.component;m.body=null,m.constraint=null,m.next=t.space.ZPP_Component.zpp_pool,t.space.ZPP_Component.zpp_pool=m,this.component=null,this.__iremovedFromSpace()},t.phys.ZPP_Body.prototype.copy=function(){var t=(new e.phys.Body).zpp_inner;t.type=this.type,t.bulletEnabled=this.bulletEnabled,t.disableCCD=this.disableCCD;for(var n=this.shapes.head;null!=n;){var i=n.elt,r=t.outer.zpp_inner.wrap_shapes,o=i.outer.copy();r.zpp_inner.reverse_flag?r.push(o):r.unshift(o),n=n.next}if(t.posx=this.posx,t.posy=this.posy,t.velx=this.velx,t.vely=this.vely,t.forcex=this.forcex,t.forcey=this.forcey,t.rot=this.rot,t.angvel=this.angvel,t.torque=this.torque,t.kinvelx=this.kinvelx,t.kinvely=this.kinvely,t.kinangvel=this.kinangvel,t.svelx=this.svelx,t.svely=this.svely,this.zip_axis){t.zip_axis=!0;for(var a=t.shapes.head;null!=a;){var s=a.elt;1==s.type&&(s.polygon.invalidate_gverts(),s.polygon.invalidate_gaxi()),s.invalidate_worldCOM(),a=a.next}t.zip_worldCOM=!0}else t.axisx=this.axisx,t.axisy=this.axisy;return t.rot=this.rot,t.massMode=this.massMode,t.gravMassMode=this.gravMassMode,t.inertiaMode=this.inertiaMode,t.norotate=this.norotate,t.nomove=this.nomove,t.cmass=this.cmass,t.cinertia=this.cinertia,this.zip_mass?t.invalidate_mass():t.mass=this.mass,this.zip_gravMass?t.invalidate_gravMass():t.gravMass=this.gravMass,this.zip_gravMassScale?t.invalidate_gravMassScale():t.gravMassScale=this.gravMassScale,this.zip_inertia?t.invalidate_inertia():t.inertia=this.inertia,this.zip_aabb?t.zip_aabb=!0:(t.aabb.minx=this.aabb.minx,t.aabb.miny=this.aabb.miny,t.aabb.maxx=this.aabb.maxx,t.aabb.maxy=this.aabb.maxy),this.zip_localCOM?(t.zip_localCOM=!0,t.zip_worldCOM=!0):(t.localCOMx=this.localCOMx,t.localCOMy=this.localCOMy),this.zip_worldCOM?t.zip_worldCOM=!0:(t.worldCOMx=this.worldCOMx,t.worldCOMy=this.worldCOMy),this.copyto(t.outer),t.outer},t.phys.ZPP_Body.prototype.__class__=t.phys.ZPP_Body,t.phys.ZPP_Compound=l["zpp_nape.phys.ZPP_Compound"]=function(){this.space=null,this.compound=null,this.depth=0,this.wrap_compounds=null,this.wrap_constraints=null,this.wrap_bodies=null,this.compounds=null,this.constraints=null,this.bodies=null,this.outer=null,t.phys.ZPP_Interactor.call(this),this.icompound=this,this.depth=1,this.bodies=new t.util.ZNPList_ZPP_Body,this.wrap_bodies=t.util.ZPP_BodyList.get(this.bodies),this.wrap_bodies.zpp_inner.adder=p(this,this.bodies_adder),this.wrap_bodies.zpp_inner.subber=p(this,this.bodies_subber),this.wrap_bodies.zpp_inner._modifiable=p(this,this.bodies_modifiable),this.constraints=new t.util.ZNPList_ZPP_Constraint,this.wrap_constraints=t.util.ZPP_ConstraintList.get(this.constraints),this.wrap_constraints.zpp_inner.adder=p(this,this.constraints_adder),this.wrap_constraints.zpp_inner.subber=p(this,this.constraints_subber),this.wrap_constraints.zpp_inner._modifiable=p(this,this.constraints_modifiable),this.compounds=new t.util.ZNPList_ZPP_Compound,this.wrap_compounds=t.util.ZPP_CompoundList.get(this.compounds),this.wrap_compounds.zpp_inner.adder=p(this,this.compounds_adder),this.wrap_compounds.zpp_inner.subber=p(this,this.compounds_subber),this.wrap_compounds.zpp_inner._modifiable=p(this,this.compounds_modifiable)},t.phys.ZPP_Compound.__name__=["zpp_nape","phys","ZPP_Compound"],t.phys.ZPP_Compound.__super__=t.phys.ZPP_Interactor,t.phys.ZPP_Interactor.prototype)t.phys.ZPP_Compound.prototype[u]=t.phys.ZPP_Interactor.prototype[u];for(var u in t.phys.ZPP_Compound.prototype.outer=null,t.phys.ZPP_Compound.prototype.bodies=null,t.phys.ZPP_Compound.prototype.constraints=null,t.phys.ZPP_Compound.prototype.compounds=null,t.phys.ZPP_Compound.prototype.wrap_bodies=null,t.phys.ZPP_Compound.prototype.wrap_constraints=null,t.phys.ZPP_Compound.prototype.wrap_compounds=null,t.phys.ZPP_Compound.prototype.depth=null,t.phys.ZPP_Compound.prototype.compound=null,t.phys.ZPP_Compound.prototype.space=null,t.phys.ZPP_Compound.prototype.__imutable_midstep=function(e){if(null!=this.space&&this.space.midstep)throw new n._Boot.HaxeError("Error: "+e+" cannot be set during space step()")},t.phys.ZPP_Compound.prototype.addedToSpace=function(){this.__iaddedToSpace()},t.phys.ZPP_Compound.prototype.removedFromSpace=function(){this.__iremovedFromSpace()},t.phys.ZPP_Compound.prototype.breakApart=function(){for(null!=this.space&&(this.__iremovedFromSpace(),this.space.nullInteractorType(this)),null!=this.compound?this.compound.compounds.remove(this):null!=this.space&&this.space.compounds.remove(this);null!=this.bodies.head;){var e=this.bodies.pop_unsafe();null!=(e.compound=this.compound)?this.compound.bodies.add(e):null!=this.space&&this.space.bodies.add(e),null!=this.space&&this.space.freshInteractorType(e)}for(;null!=this.constraints.head;){var t=this.constraints.pop_unsafe();null!=(t.compound=this.compound)?this.compound.constraints.add(t):null!=this.space&&this.space.constraints.add(t)}for(;null!=this.compounds.head;){var n=this.compounds.pop_unsafe();null!=(n.compound=this.compound)?this.compound.compounds.add(n):null!=this.space&&this.space.compounds.add(n),null!=this.space&&this.space.freshInteractorType(n)}this.compound=null,this.space=null},t.phys.ZPP_Compound.prototype.bodies_adder=function(e){return e.zpp_inner.compound!=this&&(null!=e.zpp_inner.compound?e.zpp_inner.compound.wrap_bodies.remove(e):null!=e.zpp_inner.space&&e.zpp_inner.space.wrap_bodies.remove(e),e.zpp_inner.compound=this,null!=this.space&&this.space.addBody(e.zpp_inner),!0)},t.phys.ZPP_Compound.prototype.bodies_subber=function(e){e.zpp_inner.compound=null,null!=this.space&&this.space.remBody(e.zpp_inner)},t.phys.ZPP_Compound.prototype.bodies_modifiable=function(){this.immutable_midstep("Compound::bodies")},t.phys.ZPP_Compound.prototype.constraints_adder=function(e){return e.zpp_inner.compound!=this&&(null!=e.zpp_inner.compound?e.zpp_inner.compound.wrap_constraints.remove(e):null!=e.zpp_inner.space&&e.zpp_inner.space.wrap_constraints.remove(e),e.zpp_inner.compound=this,null!=this.space&&this.space.addConstraint(e.zpp_inner),!0)},t.phys.ZPP_Compound.prototype.constraints_subber=function(e){e.zpp_inner.compound=null,null!=this.space&&this.space.remConstraint(e.zpp_inner)},t.phys.ZPP_Compound.prototype.constraints_modifiable=function(){this.immutable_midstep("Compound::constraints")},t.phys.ZPP_Compound.prototype.compounds_adder=function(e){for(var t=this;null!=t&&t!=e.zpp_inner;)t=t.compound;if(t==e.zpp_inner)throw new n._Boot.HaxeError("Error: Assignment would cause a cycle in the Compound tree: assigning "+e.toString()+".compound = "+this.outer.toString());return e.zpp_inner.compound!=this&&(null!=e.zpp_inner.compound?e.zpp_inner.compound.wrap_compounds.remove(e):null!=e.zpp_inner.space&&e.zpp_inner.space.wrap_compounds.remove(e),e.zpp_inner.compound=this,e.zpp_inner.depth=this.depth+1,null!=this.space&&this.space.addCompound(e.zpp_inner),!0)},t.phys.ZPP_Compound.prototype.compounds_subber=function(e){e.zpp_inner.compound=null,e.zpp_inner.depth=1,null!=this.space&&this.space.remCompound(e.zpp_inner)},t.phys.ZPP_Compound.prototype.compounds_modifiable=function(){this.immutable_midstep("Compound::compounds")},t.phys.ZPP_Compound.prototype.copy=function(n,i){var r=null==n;null==n&&(n=[]),null==i&&(i=[]);for(var o=new e.phys.Compound,a=this.compounds.head;null!=a;){var s=a.elt.copy(n,i);if(s.zpp_inner.immutable_midstep("Compound::compound"),(null==s.zpp_inner.compound?null:s.zpp_inner.compound.outer)!=o&&(null!=(null==s.zpp_inner.compound?null:s.zpp_inner.compound.outer)&&(null==s.zpp_inner.compound?null:s.zpp_inner.compound.outer).zpp_inner.wrap_compounds.remove(s),null!=o)){var l=o.zpp_inner.wrap_compounds;l.zpp_inner.reverse_flag?l.push(s):l.unshift(s)}s.zpp_inner.compound,a=a.next}for(var p=this.bodies.head;null!=p;){var u=p.elt,h=u.outer.copy();if(n.push(t.constraint.ZPP_CopyHelper.dict(u.id,h)),(null==h.zpp_inner.compound?null:h.zpp_inner.compound.outer)!=o&&(null!=(null==h.zpp_inner.compound?null:h.zpp_inner.compound.outer)&&(null==h.zpp_inner.compound?null:h.zpp_inner.compound.outer).zpp_inner.wrap_bodies.remove(h),null!=o)){var c=o.zpp_inner.wrap_bodies;c.zpp_inner.reverse_flag?c.push(h):c.unshift(h)}h.zpp_inner.compound,p=p.next}for(var _=this.constraints.head;null!=_;){var d=_.elt.copy(n,i);if((null==d.zpp_inner.compound?null:d.zpp_inner.compound.outer)!=o&&(null!=(null==d.zpp_inner.compound?null:d.zpp_inner.compound.outer)&&(null==d.zpp_inner.compound?null:d.zpp_inner.compound.outer).zpp_inner.wrap_constraints.remove(d),null!=o)){var m=o.zpp_inner.wrap_constraints;m.zpp_inner.reverse_flag?m.push(d):m.unshift(d)}d.zpp_inner.compound,_=_.next}if(r)for(;i.length>0;)for(var P=i.pop(),f=0;f<n.length;){var x=n[f];if(++f,x.id==P.id){P.cb(x.bc);break}}return this.copyto(o),o},t.phys.ZPP_Compound.prototype.__class__=t.phys.ZPP_Compound,t.phys.ZPP_FluidProperties=l["zpp_nape.phys.ZPP_FluidProperties"]=function(){this.wrap_gravity=null,this.gravityy=0,this.gravityx=0,this.density=0,this.viscosity=0,this.wrap_shapes=null,this.shapes=null,this.outer=null,this.userData=null,this.next=null,this.shapes=new t.util.ZNPList_ZPP_Shape,this.density=this.viscosity=1,this.wrap_gravity=null,this.gravityx=0,this.gravityy=0},t.phys.ZPP_FluidProperties.__name__=["zpp_nape","phys","ZPP_FluidProperties"],t.phys.ZPP_FluidProperties.prototype.next=null,t.phys.ZPP_FluidProperties.prototype.userData=null,t.phys.ZPP_FluidProperties.prototype.outer=null,t.phys.ZPP_FluidProperties.prototype.wrapper=function(){if(null==this.outer){this.outer=new e.phys.FluidProperties;var n=this.outer.zpp_inner;n.outer=null,n.next=t.phys.ZPP_FluidProperties.zpp_pool,t.phys.ZPP_FluidProperties.zpp_pool=n,this.outer.zpp_inner=this}return this.outer},t.phys.ZPP_FluidProperties.prototype.free=function(){this.outer=null},t.phys.ZPP_FluidProperties.prototype.alloc=function(){},t.phys.ZPP_FluidProperties.prototype.shapes=null,t.phys.ZPP_FluidProperties.prototype.wrap_shapes=null,t.phys.ZPP_FluidProperties.prototype.feature_cons=function(){this.shapes=new t.util.ZNPList_ZPP_Shape},t.phys.ZPP_FluidProperties.prototype.addShape=function(e){this.shapes.add(e)},t.phys.ZPP_FluidProperties.prototype.remShape=function(e){this.shapes.remove(e)},t.phys.ZPP_FluidProperties.prototype.copy=function(){var e;return null==t.phys.ZPP_FluidProperties.zpp_pool?e=new t.phys.ZPP_FluidProperties:(e=t.phys.ZPP_FluidProperties.zpp_pool,t.phys.ZPP_FluidProperties.zpp_pool=e.next,e.next=null),e.viscosity=this.viscosity,e.density=this.density,e},t.phys.ZPP_FluidProperties.prototype.viscosity=null,t.phys.ZPP_FluidProperties.prototype.density=null,t.phys.ZPP_FluidProperties.prototype.gravityx=null,t.phys.ZPP_FluidProperties.prototype.gravityy=null,t.phys.ZPP_FluidProperties.prototype.wrap_gravity=null,t.phys.ZPP_FluidProperties.prototype.gravity_invalidate=function(e){this.gravityx=e.x,this.gravityy=e.y,this.invalidate()},t.phys.ZPP_FluidProperties.prototype.gravity_validate=function(){this.wrap_gravity.zpp_inner.x=this.gravityx,this.wrap_gravity.zpp_inner.y=this.gravityy},t.phys.ZPP_FluidProperties.prototype.getgravity=function(){var i,r=this.gravityx,o=this.gravityy;if(null==o&&(o=0),null==r&&(r=0),r!=r||o!=o)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null==t.util.ZPP_PubPool.poolVec2?i=new e.geom.Vec2:(i=t.util.ZPP_PubPool.poolVec2,t.util.ZPP_PubPool.poolVec2=i.zpp_pool,i.zpp_pool=null,i.zpp_disp=!1,i==t.util.ZPP_PubPool.nextVec2&&(t.util.ZPP_PubPool.nextVec2=null)),null==i.zpp_inner){var a;null==t.geom.ZPP_Vec2.zpp_pool?a=new t.geom.ZPP_Vec2:(a=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=a.next,a.next=null),a.weak=!1,a._immutable=!1,a.x=r,a.y=o,i.zpp_inner=a,i.zpp_inner.outer=i}else{if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var s,l=i.zpp_inner;if(l._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=l._isimmutable&&l._isimmutable(),r!=r||o!=o)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var u=i.zpp_inner;if(null!=u._validate&&u._validate(),i.zpp_inner.x==r){if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var h=i.zpp_inner;null!=h._validate&&h._validate(),s=i.zpp_inner.y==o}else s=!1;if(!s){i.zpp_inner.x=r,i.zpp_inner.y=o;var c=i.zpp_inner;null!=c._invalidate&&c._invalidate(c)}}i.zpp_inner.weak=!1,this.wrap_gravity=i,this.wrap_gravity.zpp_inner._inuse=!0,this.wrap_gravity.zpp_inner._invalidate=p(this,this.gravity_invalidate),this.wrap_gravity.zpp_inner._validate=p(this,this.gravity_validate)},t.phys.ZPP_FluidProperties.prototype.invalidate=function(){for(var e=this.shapes.head;null!=e;)e.elt.invalidate_fluidprops(),e=e.next},t.phys.ZPP_FluidProperties.prototype.__class__=t.phys.ZPP_FluidProperties,t.phys.ZPP_Material=l["zpp_nape.phys.ZPP_Material"]=function(){this.rollingFriction=0,this.elasticity=0,this.density=0,this.staticFriction=0,this.dynamicFriction=0,this.wrap_shapes=null,this.shapes=null,this.outer=null,this.userData=null,this.next=null,this.shapes=new t.util.ZNPList_ZPP_Shape,this.elasticity=0,this.dynamicFriction=1,this.staticFriction=2,this.density=.001,this.rollingFriction=.01},t.phys.ZPP_Material.__name__=["zpp_nape","phys","ZPP_Material"],t.phys.ZPP_Material.prototype.next=null,t.phys.ZPP_Material.prototype.userData=null,t.phys.ZPP_Material.prototype.outer=null,t.phys.ZPP_Material.prototype.wrapper=function(){if(null==this.outer){this.outer=new e.phys.Material;var n=this.outer.zpp_inner;n.outer=null,n.next=t.phys.ZPP_Material.zpp_pool,t.phys.ZPP_Material.zpp_pool=n,this.outer.zpp_inner=this}return this.outer},t.phys.ZPP_Material.prototype.free=function(){this.outer=null},t.phys.ZPP_Material.prototype.alloc=function(){},t.phys.ZPP_Material.prototype.shapes=null,t.phys.ZPP_Material.prototype.wrap_shapes=null,t.phys.ZPP_Material.prototype.feature_cons=function(){this.shapes=new t.util.ZNPList_ZPP_Shape},t.phys.ZPP_Material.prototype.addShape=function(e){this.shapes.add(e)},t.phys.ZPP_Material.prototype.remShape=function(e){this.shapes.remove(e)},t.phys.ZPP_Material.prototype.dynamicFriction=null,t.phys.ZPP_Material.prototype.staticFriction=null,t.phys.ZPP_Material.prototype.density=null,t.phys.ZPP_Material.prototype.elasticity=null,t.phys.ZPP_Material.prototype.rollingFriction=null,t.phys.ZPP_Material.prototype.copy=function(){var e=new t.phys.ZPP_Material;return e.dynamicFriction=this.dynamicFriction,e.staticFriction=this.staticFriction,e.density=this.density,e.elasticity=this.elasticity,e.rollingFriction=this.rollingFriction,e},t.phys.ZPP_Material.prototype.set=function(e){this.dynamicFriction=e.dynamicFriction,this.staticFriction=e.staticFriction,this.density=e.density,this.elasticity=e.elasticity,this.rollingFriction=e.rollingFriction},t.phys.ZPP_Material.prototype.invalidate=function(e){for(var t=this.shapes.head;null!=t;)t.elt.invalidate_material(e),t=t.next},t.phys.ZPP_Material.prototype.__class__=t.phys.ZPP_Material,t.shape||(t.shape={}),t.shape.ZPP_Shape=l["zpp_nape.shape.ZPP_Shape"]=function(e){var n;this.zip_aabb=!1,this.aabb=null,this.pairs=null,this.node=null,this.sweep=null,this.sensorEnabled=!1,this.fluidEnabled=!1,this.fluidProperties=null,this.filter=null,this.material=null,this.refmaterial=null,this.polygon=null,this.circle=null,this.sweepCoef=0,this.zip_sweepRadius=!1,this.sweepRadius=0,this.wrap_worldCOM=null,this.wrap_localCOM=null,this.zip_worldCOM=!1,this.worldCOMy=0,this.worldCOMx=0,this.zip_localCOM=!1,this.localCOMy=0,this.localCOMx=0,this.zip_angDrag=!1,this.angDrag=0,this.inertia=0,this.zip_area_inertia=!1,this.area=0,this.type=0,this.body=null,this.outer=null,t.phys.ZPP_Interactor.call(this),this.pairs=new t.util.ZNPList_ZPP_AABBPair,this.ishape=this,this.type=e,null==t.geom.ZPP_AABB.zpp_pool?n=new t.geom.ZPP_AABB:(n=t.geom.ZPP_AABB.zpp_pool,t.geom.ZPP_AABB.zpp_pool=n.next,n.next=null),n.minx=0,n.miny=0,n.maxx=0,n.maxy=0,this.aabb=n,this.aabb._immutable=!0,this.aabb._validate=p(this,this.aabb_validate),this.zip_area_inertia=this.zip_angDrag=this.zip_localCOM=this.zip_sweepRadius=!0,this.localCOMx=0,this.localCOMy=0,this.worldCOMx=0,this.worldCOMy=0,this.fluidEnabled=!1,this.sensorEnabled=!1,this.fluidProperties=null,this.body=null,this.refmaterial=new t.phys.ZPP_Material,this.sweepRadius=this.sweepCoef=0},t.shape.ZPP_Shape.__name__=["zpp_nape","shape","ZPP_Shape"],t.shape.ZPP_Shape.__super__=t.phys.ZPP_Interactor,t.phys.ZPP_Interactor.prototype)t.shape.ZPP_Shape.prototype[u]=t.phys.ZPP_Interactor.prototype[u];for(var u in t.shape.ZPP_Shape.prototype.outer=null,t.shape.ZPP_Shape.prototype.body=null,t.shape.ZPP_Shape.prototype.type=null,t.shape.ZPP_Shape.prototype.isCircle=function(){return 0==this.type},t.shape.ZPP_Shape.prototype.isPolygon=function(){return 1==this.type},t.shape.ZPP_Shape.prototype.area=null,t.shape.ZPP_Shape.prototype.zip_area_inertia=null,t.shape.ZPP_Shape.prototype.inertia=null,t.shape.ZPP_Shape.prototype.angDrag=null,t.shape.ZPP_Shape.prototype.zip_angDrag=null,t.shape.ZPP_Shape.prototype.localCOMx=null,t.shape.ZPP_Shape.prototype.localCOMy=null,t.shape.ZPP_Shape.prototype.zip_localCOM=null,t.shape.ZPP_Shape.prototype.worldCOMx=null,t.shape.ZPP_Shape.prototype.worldCOMy=null,t.shape.ZPP_Shape.prototype.zip_worldCOM=null,t.shape.ZPP_Shape.prototype.wrap_localCOM=null,t.shape.ZPP_Shape.prototype.wrap_worldCOM=null,t.shape.ZPP_Shape.prototype.sweepRadius=null,t.shape.ZPP_Shape.prototype.zip_sweepRadius=null,t.shape.ZPP_Shape.prototype.sweepCoef=null,t.shape.ZPP_Shape.prototype.invalidate_sweepRadius=function(){this.zip_sweepRadius=!0},t.shape.ZPP_Shape.prototype.validate_sweepRadius=function(){this.zip_sweepRadius&&(this.zip_sweepRadius=!1,0==this.type?this.circle.__validate_sweepRadius():this.polygon.__validate_sweepRadius())},t.shape.ZPP_Shape.prototype.circle=null,t.shape.ZPP_Shape.prototype.polygon=null,t.shape.ZPP_Shape.prototype.refmaterial=null,t.shape.ZPP_Shape.prototype.material=null,t.shape.ZPP_Shape.prototype.filter=null,t.shape.ZPP_Shape.prototype.fluidProperties=null,t.shape.ZPP_Shape.prototype.fluidEnabled=null,t.shape.ZPP_Shape.prototype.sensorEnabled=null,t.shape.ZPP_Shape.prototype.sweep=null,t.shape.ZPP_Shape.prototype.node=null,t.shape.ZPP_Shape.prototype.pairs=null,t.shape.ZPP_Shape.prototype.clear=function(){0==this.type?this.circle.__clear():this.polygon.__clear()},t.shape.ZPP_Shape.prototype.aabb=null,t.shape.ZPP_Shape.prototype.zip_aabb=null,t.shape.ZPP_Shape.prototype.validate_aabb=function(){if(this.zip_aabb&&null!=this.body)if(this.zip_aabb=!1,0==this.type){var e=this.circle;if(e.zip_worldCOM&&null!=e.body){if(e.zip_worldCOM=!1,e.zip_localCOM){if(e.zip_localCOM=!1,1==e.type){var t=e.polygon;if(null==t.lverts.next)throw new n._Boot.HaxeError("Error: An empty polygon has no meaningful localCOM");if(null==t.lverts.next.next)t.localCOMx=t.lverts.next.x,t.localCOMy=t.lverts.next.y;else if(null==t.lverts.next.next.next)t.localCOMx=t.lverts.next.x,t.localCOMy=t.lverts.next.y,t.localCOMx+=1*t.lverts.next.next.x,t.localCOMy+=1*t.lverts.next.next.y,t.localCOMx*=.5,t.localCOMy*=.5;else{t.localCOMx=0,t.localCOMy=0;var i=0,r=t.lverts.next,o=r,a=r=r.next;for(r=r.next;null!=r;){var s=r;i+=a.x*(s.y-o.y);var l=s.y*a.x-s.x*a.y;t.localCOMx+=(a.x+s.x)*l,t.localCOMy+=(a.y+s.y)*l,o=a,a=s,r=r.next}var p=r=t.lverts.next;i+=a.x*(p.y-o.y);var u=p.y*a.x-p.x*a.y;t.localCOMx+=(a.x+p.x)*u,t.localCOMy+=(a.y+p.y)*u,o=a,a=p;var h=r=r.next;i+=a.x*(h.y-o.y);var c=h.y*a.x-h.x*a.y;t.localCOMx+=(a.x+h.x)*c,t.localCOMy+=(a.y+h.y)*c;var _=i=1/(3*i);t.localCOMx*=_,t.localCOMy*=_}}null!=e.wrap_localCOM&&(e.wrap_localCOM.zpp_inner.x=e.localCOMx,e.wrap_localCOM.zpp_inner.y=e.localCOMy)}var d=e.body;d.zip_axis&&(d.zip_axis=!1,d.axisx=Math.sin(d.rot),d.axisy=Math.cos(d.rot)),e.worldCOMx=e.body.posx+(e.body.axisy*e.localCOMx-e.body.axisx*e.localCOMy),e.worldCOMy=e.body.posy+(e.localCOMx*e.body.axisx+e.localCOMy*e.body.axisy)}var m=e.radius,P=e.radius;e.aabb.minx=e.worldCOMx-m,e.aabb.miny=e.worldCOMy-P,e.aabb.maxx=e.worldCOMx+m,e.aabb.maxy=e.worldCOMy+P}else{var f=this.polygon;if(f.zip_gverts&&null!=f.body){f.zip_gverts=!1,f.validate_lverts();var x=f.body;x.zip_axis&&(x.zip_axis=!1,x.axisx=Math.sin(x.rot),x.axisy=Math.cos(x.rot));for(var y=f.lverts.next,v=f.gverts.next;null!=v;){var g=v,b=y;y=y.next,g.x=f.body.posx+(f.body.axisy*b.x-f.body.axisx*b.y),g.y=f.body.posy+(b.x*f.body.axisx+b.y*f.body.axisy),v=v.next}}if(null==f.lverts.next)throw new n._Boot.HaxeError("Error: An empty polygon has no meaningful bounds");var z=f.gverts.next;f.aabb.minx=z.x,f.aabb.miny=z.y,f.aabb.maxx=z.x,f.aabb.maxy=z.y;for(var w=f.gverts.next.next;null!=w;){var Z=w;Z.x<f.aabb.minx&&(f.aabb.minx=Z.x),Z.x>f.aabb.maxx&&(f.aabb.maxx=Z.x),Z.y<f.aabb.miny&&(f.aabb.miny=Z.y),Z.y>f.aabb.maxy&&(f.aabb.maxy=Z.y),w=w.next}}},t.shape.ZPP_Shape.prototype.force_validate_aabb=function(){if(0==this.type){var e=this.circle;e.worldCOMx=e.body.posx+(e.body.axisy*e.localCOMx-e.body.axisx*e.localCOMy),e.worldCOMy=e.body.posy+(e.localCOMx*e.body.axisx+e.localCOMy*e.body.axisy),e.aabb.minx=e.worldCOMx-e.radius,e.aabb.miny=e.worldCOMy-e.radius,e.aabb.maxx=e.worldCOMx+e.radius,e.aabb.maxy=e.worldCOMy+e.radius}else{var t=this.polygon,n=t.lverts.next,i=t.gverts.next,r=n;n=n.next,i.x=t.body.posx+(t.body.axisy*r.x-t.body.axisx*r.y),i.y=t.body.posy+(r.x*t.body.axisx+r.y*t.body.axisy),t.aabb.minx=i.x,t.aabb.miny=i.y,t.aabb.maxx=i.x,t.aabb.maxy=i.y;for(var o=t.gverts.next.next;null!=o;){var a=o,s=n;n=n.next,a.x=t.body.posx+(t.body.axisy*s.x-t.body.axisx*s.y),a.y=t.body.posy+(s.x*t.body.axisx+s.y*t.body.axisy),a.x<t.aabb.minx&&(t.aabb.minx=a.x),a.x>t.aabb.maxx&&(t.aabb.maxx=a.x),a.y<t.aabb.miny&&(t.aabb.miny=a.y),a.y>t.aabb.maxy&&(t.aabb.maxy=a.y),o=o.next}}},t.shape.ZPP_Shape.prototype.invalidate_aabb=function(){this.zip_aabb=!0,null!=this.body&&(this.body.zip_aabb=!0)},t.shape.ZPP_Shape.prototype.validate_area_inertia=function(){this.zip_area_inertia&&(this.zip_area_inertia=!1,0==this.type?this.circle.__validate_area_inertia():this.polygon.__validate_area_inertia())},t.shape.ZPP_Shape.prototype.validate_angDrag=function(){(this.zip_angDrag||this.refmaterial.dynamicFriction!=this.material.dynamicFriction)&&(this.zip_angDrag=!1,this.refmaterial.dynamicFriction=this.material.dynamicFriction,0==this.type?this.circle.__validate_angDrag():this.polygon.__validate_angDrag())},t.shape.ZPP_Shape.prototype.validate_localCOM=function(){if(this.zip_localCOM){if(this.zip_localCOM=!1,1==this.type){var e=this.polygon;if(null==e.lverts.next)throw new n._Boot.HaxeError("Error: An empty polygon has no meaningful localCOM");if(null==e.lverts.next.next)e.localCOMx=e.lverts.next.x,e.localCOMy=e.lverts.next.y;else if(null==e.lverts.next.next.next)e.localCOMx=e.lverts.next.x,e.localCOMy=e.lverts.next.y,e.localCOMx+=1*e.lverts.next.next.x,e.localCOMy+=1*e.lverts.next.next.y,e.localCOMx*=.5,e.localCOMy*=.5;else{e.localCOMx=0,e.localCOMy=0;var t=0,i=e.lverts.next,r=i,o=i=i.next;for(i=i.next;null!=i;){var a=i;t+=o.x*(a.y-r.y);var s=a.y*o.x-a.x*o.y;e.localCOMx+=(o.x+a.x)*s,e.localCOMy+=(o.y+a.y)*s,r=o,o=a,i=i.next}var l=i=e.lverts.next;t+=o.x*(l.y-r.y);var p=l.y*o.x-l.x*o.y;e.localCOMx+=(o.x+l.x)*p,e.localCOMy+=(o.y+l.y)*p,r=o,o=l;var u=i=i.next;t+=o.x*(u.y-r.y);var h=u.y*o.x-u.x*o.y;e.localCOMx+=(o.x+u.x)*h,e.localCOMy+=(o.y+u.y)*h;var c=t=1/(3*t);e.localCOMx*=c,e.localCOMy*=c}}null!=this.wrap_localCOM&&(this.wrap_localCOM.zpp_inner.x=this.localCOMx,this.wrap_localCOM.zpp_inner.y=this.localCOMy)}},t.shape.ZPP_Shape.prototype.validate_worldCOM=function(){if(this.zip_worldCOM&&null!=this.body){if(this.zip_worldCOM=!1,this.zip_localCOM){if(this.zip_localCOM=!1,1==this.type){var e=this.polygon;if(null==e.lverts.next)throw new n._Boot.HaxeError("Error: An empty polygon has no meaningful localCOM");if(null==e.lverts.next.next)e.localCOMx=e.lverts.next.x,e.localCOMy=e.lverts.next.y;else if(null==e.lverts.next.next.next)e.localCOMx=e.lverts.next.x,e.localCOMy=e.lverts.next.y,e.localCOMx+=1*e.lverts.next.next.x,e.localCOMy+=1*e.lverts.next.next.y,e.localCOMx*=.5,e.localCOMy*=.5;else{e.localCOMx=0,e.localCOMy=0;var t=0,i=e.lverts.next,r=i,o=i=i.next;for(i=i.next;null!=i;){var a=i;t+=o.x*(a.y-r.y);var s=a.y*o.x-a.x*o.y;e.localCOMx+=(o.x+a.x)*s,e.localCOMy+=(o.y+a.y)*s,r=o,o=a,i=i.next}var l=i=e.lverts.next;t+=o.x*(l.y-r.y);var p=l.y*o.x-l.x*o.y;e.localCOMx+=(o.x+l.x)*p,e.localCOMy+=(o.y+l.y)*p,r=o,o=l;var u=i=i.next;t+=o.x*(u.y-r.y);var h=u.y*o.x-u.x*o.y;e.localCOMx+=(o.x+u.x)*h,e.localCOMy+=(o.y+u.y)*h;var c=t=1/(3*t);e.localCOMx*=c,e.localCOMy*=c}}null!=this.wrap_localCOM&&(this.wrap_localCOM.zpp_inner.x=this.localCOMx,this.wrap_localCOM.zpp_inner.y=this.localCOMy)}var _=this.body;_.zip_axis&&(_.zip_axis=!1,_.axisx=Math.sin(_.rot),_.axisy=Math.cos(_.rot)),this.worldCOMx=this.body.posx+(this.body.axisy*this.localCOMx-this.body.axisx*this.localCOMy),this.worldCOMy=this.body.posy+(this.localCOMx*this.body.axisx+this.localCOMy*this.body.axisy)}},t.shape.ZPP_Shape.prototype.getworldCOM=function(){if(null==this.body)throw new n._Boot.HaxeError("Error: worldCOM only makes sense when Shape belongs to a Body");if(this.zip_worldCOM&&null!=this.body){if(this.zip_worldCOM=!1,this.zip_localCOM){if(this.zip_localCOM=!1,1==this.type){var e=this.polygon;if(null==e.lverts.next)throw new n._Boot.HaxeError("Error: An empty polygon has no meaningful localCOM");if(null==e.lverts.next.next)e.localCOMx=e.lverts.next.x,e.localCOMy=e.lverts.next.y;else if(null==e.lverts.next.next.next)e.localCOMx=e.lverts.next.x,e.localCOMy=e.lverts.next.y,e.localCOMx+=1*e.lverts.next.next.x,e.localCOMy+=1*e.lverts.next.next.y,e.localCOMx*=.5,e.localCOMy*=.5;else{e.localCOMx=0,e.localCOMy=0;var t=0,i=e.lverts.next,r=i,o=i=i.next;for(i=i.next;null!=i;){var a=i;t+=o.x*(a.y-r.y);var s=a.y*o.x-a.x*o.y;e.localCOMx+=(o.x+a.x)*s,e.localCOMy+=(o.y+a.y)*s,r=o,o=a,i=i.next}var l=i=e.lverts.next;t+=o.x*(l.y-r.y);var p=l.y*o.x-l.x*o.y;e.localCOMx+=(o.x+l.x)*p,e.localCOMy+=(o.y+l.y)*p,r=o,o=l;var u=i=i.next;t+=o.x*(u.y-r.y);var h=u.y*o.x-u.x*o.y;e.localCOMx+=(o.x+u.x)*h,e.localCOMy+=(o.y+u.y)*h;var c=t=1/(3*t);e.localCOMx*=c,e.localCOMy*=c}}null!=this.wrap_localCOM&&(this.wrap_localCOM.zpp_inner.x=this.localCOMx,this.wrap_localCOM.zpp_inner.y=this.localCOMy)}var _=this.body;_.zip_axis&&(_.zip_axis=!1,_.axisx=Math.sin(_.rot),_.axisy=Math.cos(_.rot)),this.worldCOMx=this.body.posx+(this.body.axisy*this.localCOMx-this.body.axisx*this.localCOMy),this.worldCOMy=this.body.posy+(this.localCOMx*this.body.axisx+this.localCOMy*this.body.axisy)}this.wrap_worldCOM.zpp_inner.x=this.worldCOMx,this.wrap_worldCOM.zpp_inner.y=this.worldCOMy},t.shape.ZPP_Shape.prototype.invalidate_area_inertia=function(){if(this.zip_area_inertia=!0,null!=this.body){var e=this.body;e.zip_localCOM=!0,e.zip_worldCOM=!0,this.body.invalidate_mass(),this.body.invalidate_inertia()}},t.shape.ZPP_Shape.prototype.invalidate_angDrag=function(){this.zip_angDrag=!0},t.shape.ZPP_Shape.prototype.invalidate_localCOM=function(){if(this.zip_localCOM=!0,this.invalidate_area_inertia(),0==this.type&&(this.zip_sweepRadius=!0),this.invalidate_angDrag(),this.invalidate_worldCOM(),null!=this.body){var e=this.body;e.zip_localCOM=!0,e.zip_worldCOM=!0}},t.shape.ZPP_Shape.prototype.invalidate_worldCOM=function(){this.zip_worldCOM=!0,this.zip_aabb=!0,null!=this.body&&(this.body.zip_aabb=!0)},t.shape.ZPP_Shape.prototype.invalidate_material=function(e){if(0!=(e&t.phys.ZPP_Material.WAKE)&&this.wake(),0!=(e&t.phys.ZPP_Material.ARBITERS)&&null!=this.body&&this.body.refreshArbiters(),0!=(e&t.phys.ZPP_Material.PROPS)&&null!=this.body){var n=this.body;n.zip_localCOM=!0,n.zip_worldCOM=!0,this.body.invalidate_mass(),this.body.invalidate_inertia()}0!=(e&t.phys.ZPP_Material.ANGDRAG)&&this.invalidate_angDrag(),this.refmaterial.set(this.material)},t.shape.ZPP_Shape.prototype.invalidate_filter=function(){this.wake()},t.shape.ZPP_Shape.prototype.invalidate_fluidprops=function(){this.fluidEnabled&&this.wake()},t.shape.ZPP_Shape.prototype.aabb_validate=function(){if(null==this.body)throw new n._Boot.HaxeError("Error: bounds only makes sense when Shape belongs to a Body");if(this.zip_aabb&&null!=this.body)if(this.zip_aabb=!1,0==this.type){var e=this.circle;if(e.zip_worldCOM&&null!=e.body){if(e.zip_worldCOM=!1,e.zip_localCOM){if(e.zip_localCOM=!1,1==e.type){var t=e.polygon;if(null==t.lverts.next)throw new n._Boot.HaxeError("Error: An empty polygon has no meaningful localCOM");if(null==t.lverts.next.next)t.localCOMx=t.lverts.next.x,t.localCOMy=t.lverts.next.y;else if(null==t.lverts.next.next.next)t.localCOMx=t.lverts.next.x,t.localCOMy=t.lverts.next.y,t.localCOMx+=1*t.lverts.next.next.x,t.localCOMy+=1*t.lverts.next.next.y,t.localCOMx*=.5,t.localCOMy*=.5;else{t.localCOMx=0,t.localCOMy=0;var i=0,r=t.lverts.next,o=r,a=r=r.next;for(r=r.next;null!=r;){var s=r;i+=a.x*(s.y-o.y);var l=s.y*a.x-s.x*a.y;t.localCOMx+=(a.x+s.x)*l,t.localCOMy+=(a.y+s.y)*l,o=a,a=s,r=r.next}var p=r=t.lverts.next;i+=a.x*(p.y-o.y);var u=p.y*a.x-p.x*a.y;t.localCOMx+=(a.x+p.x)*u,t.localCOMy+=(a.y+p.y)*u,o=a,a=p;var h=r=r.next;i+=a.x*(h.y-o.y);var c=h.y*a.x-h.x*a.y;t.localCOMx+=(a.x+h.x)*c,t.localCOMy+=(a.y+h.y)*c;var _=i=1/(3*i);t.localCOMx*=_,t.localCOMy*=_}}null!=e.wrap_localCOM&&(e.wrap_localCOM.zpp_inner.x=e.localCOMx,e.wrap_localCOM.zpp_inner.y=e.localCOMy)}var d=e.body;d.zip_axis&&(d.zip_axis=!1,d.axisx=Math.sin(d.rot),d.axisy=Math.cos(d.rot)),e.worldCOMx=e.body.posx+(e.body.axisy*e.localCOMx-e.body.axisx*e.localCOMy),e.worldCOMy=e.body.posy+(e.localCOMx*e.body.axisx+e.localCOMy*e.body.axisy)}var m=e.radius,P=e.radius;e.aabb.minx=e.worldCOMx-m,e.aabb.miny=e.worldCOMy-P,e.aabb.maxx=e.worldCOMx+m,e.aabb.maxy=e.worldCOMy+P}else{var f=this.polygon;if(f.zip_gverts&&null!=f.body){f.zip_gverts=!1,f.validate_lverts();var x=f.body;x.zip_axis&&(x.zip_axis=!1,x.axisx=Math.sin(x.rot),x.axisy=Math.cos(x.rot));for(var y=f.lverts.next,v=f.gverts.next;null!=v;){var g=v,b=y;y=y.next,g.x=f.body.posx+(f.body.axisy*b.x-f.body.axisx*b.y),g.y=f.body.posy+(b.x*f.body.axisx+b.y*f.body.axisy),v=v.next}}if(null==f.lverts.next)throw new n._Boot.HaxeError("Error: An empty polygon has no meaningful bounds");var z=f.gverts.next;f.aabb.minx=z.x,f.aabb.miny=z.y,f.aabb.maxx=z.x,f.aabb.maxy=z.y;for(var w=f.gverts.next.next;null!=w;){var Z=w;Z.x<f.aabb.minx&&(f.aabb.minx=Z.x),Z.x>f.aabb.maxx&&(f.aabb.maxx=Z.x),Z.y<f.aabb.miny&&(f.aabb.miny=Z.y),Z.y>f.aabb.maxy&&(f.aabb.maxy=Z.y),w=w.next}}},t.shape.ZPP_Shape.prototype.setMaterial=function(e){this.material!=e&&(null!=this.body&&null!=this.body.space&&null!=this.material&&this.material.shapes.remove(this),this.material=e,null!=this.body&&null!=this.body.space&&e.shapes.add(this),this.wake(),null!=this.body&&this.body.refreshArbiters())},t.shape.ZPP_Shape.prototype.setFilter=function(e){this.filter!=e&&(null!=this.body&&null!=this.body.space&&null!=this.filter&&this.filter.shapes.remove(this),this.filter=e,null!=this.body&&null!=this.body.space&&e.shapes.add(this),this.wake())},t.shape.ZPP_Shape.prototype.setFluid=function(e){this.fluidProperties!=e&&(null!=this.body&&null!=this.body.space&&null!=this.fluidProperties&&this.fluidProperties.shapes.remove(this),this.fluidProperties=e,null!=this.body&&null!=this.body.space&&e.shapes.add(this),this.fluidEnabled&&this.wake())},t.shape.ZPP_Shape.prototype.__immutable_midstep=function(e){if(null!=this.body&&null!=this.body.space&&this.body.space.midstep)throw new n._Boot.HaxeError("Error: "+e+" cannot be set during a space step()")},t.shape.ZPP_Shape.prototype.addedToBody=function(){this.invalidate_worldCOM(),this.zip_aabb=!0,null!=this.body&&(this.body.zip_aabb=!0)},t.shape.ZPP_Shape.prototype.removedFromBody=function(){},t.shape.ZPP_Shape.prototype.addedToSpace=function(){this.__iaddedToSpace(),this.material.shapes.add(this),this.filter.shapes.add(this),null!=this.fluidProperties&&this.fluidProperties.shapes.add(this)},t.shape.ZPP_Shape.prototype.removedFromSpace=function(){this.__iremovedFromSpace(),this.material.shapes.remove(this),this.filter.shapes.remove(this),null!=this.fluidProperties&&this.fluidProperties.shapes.remove(this)},t.shape.ZPP_Shape.prototype.copy=function(){var e=null;e=0==this.type?this.circle.__copy():this.polygon.__copy(),this.zip_area_inertia?e.invalidate_area_inertia():(e.area=this.area,e.inertia=this.inertia),this.zip_sweepRadius?e.zip_sweepRadius=!0:(e.sweepRadius=this.sweepRadius,e.sweepCoef=this.sweepCoef),this.zip_angDrag?e.invalidate_angDrag():e.angDrag=this.angDrag,this.zip_aabb?(e.zip_aabb=!0,null!=e.body&&(e.body.zip_aabb=!0)):(e.aabb.minx=this.aabb.minx,e.aabb.miny=this.aabb.miny,e.aabb.maxx=this.aabb.maxx,e.aabb.maxy=this.aabb.maxy);var n=e.material;n.outer=null,n.next=t.phys.ZPP_Material.zpp_pool,t.phys.ZPP_Material.zpp_pool=n;var i=e.filter;return i.outer=null,i.next=t.dynamics.ZPP_InteractionFilter.zpp_pool,t.dynamics.ZPP_InteractionFilter.zpp_pool=i,e.material=this.material,e.filter=this.filter,null!=this.fluidProperties&&(e.fluidProperties=this.fluidProperties),e.fluidEnabled=this.fluidEnabled,e.sensorEnabled=this.sensorEnabled,null!=this.userData&&(e.userData=r.copy(this.userData)),this.copyto(e.outer),e.outer},t.shape.ZPP_Shape.prototype.__class__=t.shape.ZPP_Shape,t.shape.ZPP_Circle=l["zpp_nape.shape.ZPP_Circle"]=function(){this.radius=0,this.outer_zn=null,t.shape.ZPP_Shape.call(this,0),this.circle=this,this.zip_localCOM=!1},t.shape.ZPP_Circle.__name__=["zpp_nape","shape","ZPP_Circle"],t.shape.ZPP_Circle.__super__=t.shape.ZPP_Shape,t.shape.ZPP_Shape.prototype)t.shape.ZPP_Circle.prototype[u]=t.shape.ZPP_Shape.prototype[u];for(var u in t.shape.ZPP_Circle.prototype.outer_zn=null,t.shape.ZPP_Circle.prototype.radius=null,t.shape.ZPP_Circle.prototype.__clear=function(){},t.shape.ZPP_Circle.prototype.invalidate_radius=function(){this.invalidate_area_inertia(),this.invalidate_angDrag(),this.zip_aabb=!0,null!=this.body&&(this.body.zip_aabb=!0),null!=this.body&&this.body.wake()},t.shape.ZPP_Circle.prototype.localCOM_validate=function(){this.wrap_localCOM.zpp_inner.x=this.localCOMx,this.wrap_localCOM.zpp_inner.y=this.localCOMy},t.shape.ZPP_Circle.prototype.localCOM_invalidate=function(e){this.localCOMx=e.x,this.localCOMy=e.y,this.invalidate_localCOM(),null!=this.body&&this.body.wake()},t.shape.ZPP_Circle.prototype.localCOM_immutable=function(){if(null!=this.body&&1==this.body.type&&null!=this.body.space)throw new n._Boot.HaxeError("Error: Cannot modify localCOM of Circle added to a static Body whilst within a Space")},t.shape.ZPP_Circle.prototype.setupLocalCOM=function(){var i,r=this.localCOMx,o=this.localCOMy;if(null==o&&(o=0),null==r&&(r=0),r!=r||o!=o)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null==t.util.ZPP_PubPool.poolVec2?i=new e.geom.Vec2:(i=t.util.ZPP_PubPool.poolVec2,t.util.ZPP_PubPool.poolVec2=i.zpp_pool,i.zpp_pool=null,i.zpp_disp=!1,i==t.util.ZPP_PubPool.nextVec2&&(t.util.ZPP_PubPool.nextVec2=null)),null==i.zpp_inner){var a;null==t.geom.ZPP_Vec2.zpp_pool?a=new t.geom.ZPP_Vec2:(a=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=a.next,a.next=null),a.weak=!1,a._immutable=!1,a.x=r,a.y=o,i.zpp_inner=a,i.zpp_inner.outer=i}else{if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var s,l=i.zpp_inner;if(l._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=l._isimmutable&&l._isimmutable(),r!=r||o!=o)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var u=i.zpp_inner;if(null!=u._validate&&u._validate(),i.zpp_inner.x==r){if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var h=i.zpp_inner;null!=h._validate&&h._validate(),s=i.zpp_inner.y==o}else s=!1;if(!s){i.zpp_inner.x=r,i.zpp_inner.y=o;var c=i.zpp_inner;null!=c._invalidate&&c._invalidate(c)}}i.zpp_inner.weak=!1,this.wrap_localCOM=i,this.wrap_localCOM.zpp_inner._inuse=!0,this.wrap_localCOM.zpp_inner._validate=p(this,this.localCOM_validate),this.wrap_localCOM.zpp_inner._invalidate=p(this,this.localCOM_invalidate),this.wrap_localCOM.zpp_inner._isimmutable=p(this,this.localCOM_immutable)},t.shape.ZPP_Circle.prototype.__validate_aabb=function(){if(this.zip_worldCOM&&null!=this.body){if(this.zip_worldCOM=!1,this.zip_localCOM){if(this.zip_localCOM=!1,1==this.type){var e=this.polygon;if(null==e.lverts.next)throw new n._Boot.HaxeError("Error: An empty polygon has no meaningful localCOM");if(null==e.lverts.next.next)e.localCOMx=e.lverts.next.x,e.localCOMy=e.lverts.next.y;else if(null==e.lverts.next.next.next)e.localCOMx=e.lverts.next.x,e.localCOMy=e.lverts.next.y,e.localCOMx+=1*e.lverts.next.next.x,e.localCOMy+=1*e.lverts.next.next.y,e.localCOMx*=.5,e.localCOMy*=.5;else{e.localCOMx=0,e.localCOMy=0;var t=0,i=e.lverts.next,r=i,o=i=i.next;for(i=i.next;null!=i;){var a=i;t+=o.x*(a.y-r.y);var s=a.y*o.x-a.x*o.y;e.localCOMx+=(o.x+a.x)*s,e.localCOMy+=(o.y+a.y)*s,r=o,o=a,i=i.next}var l=i=e.lverts.next;t+=o.x*(l.y-r.y);var p=l.y*o.x-l.x*o.y;e.localCOMx+=(o.x+l.x)*p,e.localCOMy+=(o.y+l.y)*p,r=o,o=l;var u=i=i.next;t+=o.x*(u.y-r.y);var h=u.y*o.x-u.x*o.y;e.localCOMx+=(o.x+u.x)*h,e.localCOMy+=(o.y+u.y)*h;var c=t=1/(3*t);e.localCOMx*=c,e.localCOMy*=c}}null!=this.wrap_localCOM&&(this.wrap_localCOM.zpp_inner.x=this.localCOMx,this.wrap_localCOM.zpp_inner.y=this.localCOMy)}var _=this.body;_.zip_axis&&(_.zip_axis=!1,_.axisx=Math.sin(_.rot),_.axisy=Math.cos(_.rot)),this.worldCOMx=this.body.posx+(this.body.axisy*this.localCOMx-this.body.axisx*this.localCOMy),this.worldCOMy=this.body.posy+(this.localCOMx*this.body.axisx+this.localCOMy*this.body.axisy)}var d=this.radius,m=this.radius;this.aabb.minx=this.worldCOMx-d,this.aabb.miny=this.worldCOMy-m,this.aabb.maxx=this.worldCOMx+d,this.aabb.maxy=this.worldCOMy+m},t.shape.ZPP_Circle.prototype._force_validate_aabb=function(){this.worldCOMx=this.body.posx+(this.body.axisy*this.localCOMx-this.body.axisx*this.localCOMy),this.worldCOMy=this.body.posy+(this.localCOMx*this.body.axisx+this.localCOMy*this.body.axisy),this.aabb.minx=this.worldCOMx-this.radius,this.aabb.miny=this.worldCOMy-this.radius,this.aabb.maxx=this.worldCOMx+this.radius,this.aabb.maxy=this.worldCOMy+this.radius},t.shape.ZPP_Circle.prototype.__validate_sweepRadius=function(){this.sweepCoef=Math.sqrt(this.localCOMx*this.localCOMx+this.localCOMy*this.localCOMy),this.sweepRadius=this.sweepCoef+this.radius},t.shape.ZPP_Circle.prototype.__validate_area_inertia=function(){var e=this.radius*this.radius;this.area=e*Math.PI,this.inertia=.5*e+(this.localCOMx*this.localCOMx+this.localCOMy*this.localCOMy)},t.shape.ZPP_Circle.prototype.__validate_angDrag=function(){var t=this.localCOMx*this.localCOMx+this.localCOMy*this.localCOMy,n=this.radius*this.radius,i=this.material.dynamicFriction*e.Config.fluidAngularDragFriction;this.angDrag=(t+2*n)*i+.5*e.Config.fluidAngularDrag*(1+e.Config.fluidVacuumDrag)*t,this.angDrag/=2*(t+.5*n)},t.shape.ZPP_Circle.prototype.__scale=function(e,t){var n=((e<0?-e:e)+(t<0?-t:t))/2;this.radius*=n<0?-n:n,this.invalidate_radius(),this.localCOMx*this.localCOMx+this.localCOMy*this.localCOMy>0&&(this.localCOMx*=e,this.localCOMy*=t,this.invalidate_localCOM())},t.shape.ZPP_Circle.prototype.__translate=function(e,t){this.localCOMx+=1*e,this.localCOMy+=1*t,this.invalidate_localCOM()},t.shape.ZPP_Circle.prototype.__rotate=function(e,t){var n,i;this.localCOMx*this.localCOMx+this.localCOMy*this.localCOMy>0&&(n=t*this.localCOMx-e*this.localCOMy,i=this.localCOMx*e+this.localCOMy*t,this.localCOMx=n,this.localCOMy=i,this.invalidate_localCOM())},t.shape.ZPP_Circle.prototype.__transform=function(e){var t=e.zpp_inner.a*e.zpp_inner.d-e.zpp_inner.b*e.zpp_inner.c;t<0&&(t=-t),this.radius*=Math.sqrt(t);var n=e.zpp_inner.a*this.localCOMx+e.zpp_inner.b*this.localCOMy+e.zpp_inner.tx;this.localCOMy=e.zpp_inner.c*this.localCOMx+e.zpp_inner.d*this.localCOMy+e.zpp_inner.ty,this.localCOMx=n,this.invalidate_radius(),this.invalidate_localCOM()},t.shape.ZPP_Circle.prototype.__copy=function(){var t=new e.shape.Circle(this.radius).zpp_inner_zn;return t.localCOMx=this.localCOMx,t.localCOMy=this.localCOMy,t.zip_localCOM=!1,t},t.shape.ZPP_Circle.prototype.__class__=t.shape.ZPP_Circle,t.shape.ZPP_Edge=l["zpp_nape.shape.ZPP_Edge"]=function(){this.tp1=0,this.tp0=0,this.gp1=null,this.lp1=null,this.gp0=null,this.lp0=null,this.gprojection=0,this.lprojection=0,this.length=0,this.wrap_gnorm=null,this.gnormy=0,this.gnormx=0,this.wrap_lnorm=null,this.lnormy=0,this.lnormx=0,this.outer=null,this.polygon=null,this.next=null,this.lnormx=0,this.lnormy=0,this.gnormx=0,this.gnormy=0,this.length=0,this.lprojection=0,this.gprojection=0},t.shape.ZPP_Edge.__name__=["zpp_nape","shape","ZPP_Edge"],t.shape.ZPP_Edge.prototype.next=null,t.shape.ZPP_Edge.prototype.free=function(){this.polygon=null},t.shape.ZPP_Edge.prototype.alloc=function(){},t.shape.ZPP_Edge.prototype.polygon=null,t.shape.ZPP_Edge.prototype.outer=null,t.shape.ZPP_Edge.prototype.wrapper=function(){return null==this.outer&&(t.shape.ZPP_Edge.internal=!0,this.outer=new e.shape.Edge,t.shape.ZPP_Edge.internal=!1,this.outer.zpp_inner=this),this.outer},t.shape.ZPP_Edge.prototype.lnormx=null,t.shape.ZPP_Edge.prototype.lnormy=null,t.shape.ZPP_Edge.prototype.wrap_lnorm=null,t.shape.ZPP_Edge.prototype.gnormx=null,t.shape.ZPP_Edge.prototype.gnormy=null,t.shape.ZPP_Edge.prototype.wrap_gnorm=null,t.shape.ZPP_Edge.prototype.length=null,t.shape.ZPP_Edge.prototype.lprojection=null,t.shape.ZPP_Edge.prototype.gprojection=null,t.shape.ZPP_Edge.prototype.lp0=null,t.shape.ZPP_Edge.prototype.gp0=null,t.shape.ZPP_Edge.prototype.lp1=null,t.shape.ZPP_Edge.prototype.gp1=null,t.shape.ZPP_Edge.prototype.tp0=null,t.shape.ZPP_Edge.prototype.tp1=null,t.shape.ZPP_Edge.prototype.lnorm_validate=function(){if(null==this.polygon)throw new n._Boot.HaxeError("Error: Edge not currently in use");this.polygon.validate_laxi(),this.wrap_lnorm.zpp_inner.x=this.lnormx,this.wrap_lnorm.zpp_inner.y=this.lnormy},t.shape.ZPP_Edge.prototype.gnorm_validate=function(){if(null==this.polygon)throw new n._Boot.HaxeError("Error: Edge not currently in use");if(null==this.polygon.body)throw new n._Boot.HaxeError("Error: Edge worldNormal only makes sense if the parent Polygon is contained within a rigid body");var e=this.polygon;if(e.zip_gaxi&&null!=e.body){e.zip_gaxi=!1,e.validate_laxi();var t=e.body;if(t.zip_axis&&(t.zip_axis=!1,t.axisx=Math.sin(t.rot),t.axisy=Math.cos(t.rot)),e.zip_gverts&&null!=e.body){e.zip_gverts=!1,e.validate_lverts();var i=e.body;i.zip_axis&&(i.zip_axis=!1,i.axisx=Math.sin(i.rot),i.axisy=Math.cos(i.rot));for(var r=e.lverts.next,o=e.gverts.next;null!=o;){var a=o,s=r;r=r.next,a.x=e.body.posx+(e.body.axisy*s.x-e.body.axisx*s.y),a.y=e.body.posy+(s.x*e.body.axisx+s.y*e.body.axisy),o=o.next}}var l=e.edges.head,p=e.gverts.next,u=p;for(p=p.next;null!=p;){var h=p,c=l.elt;l=l.next,c.gp0=u,c.gp1=h,c.gnormx=e.body.axisy*c.lnormx-e.body.axisx*c.lnormy,c.gnormy=c.lnormx*e.body.axisx+c.lnormy*e.body.axisy,c.gprojection=e.body.posx*c.gnormx+e.body.posy*c.gnormy+c.lprojection,null!=c.wrap_gnorm&&(c.wrap_gnorm.zpp_inner.x=c.gnormx,c.wrap_gnorm.zpp_inner.y=c.gnormy),c.tp0=c.gp0.y*c.gnormx-c.gp0.x*c.gnormy,c.tp1=c.gp1.y*c.gnormx-c.gp1.x*c.gnormy,u=h,p=p.next}var _=e.gverts.next,d=l.elt;l=l.next,d.gp0=u,d.gp1=_,d.gnormx=e.body.axisy*d.lnormx-e.body.axisx*d.lnormy,d.gnormy=d.lnormx*e.body.axisx+d.lnormy*e.body.axisy,d.gprojection=e.body.posx*d.gnormx+e.body.posy*d.gnormy+d.lprojection,null!=d.wrap_gnorm&&(d.wrap_gnorm.zpp_inner.x=d.gnormx,d.wrap_gnorm.zpp_inner.y=d.gnormy),d.tp0=d.gp0.y*d.gnormx-d.gp0.x*d.gnormy,d.tp1=d.gp1.y*d.gnormx-d.gp1.x*d.gnormy}this.wrap_gnorm.zpp_inner.x=this.gnormx,this.wrap_gnorm.zpp_inner.y=this.gnormy},t.shape.ZPP_Edge.prototype.getlnorm=function(){var i,r=this.lnormx,o=this.lnormy;if(null==o&&(o=0),null==r&&(r=0),r!=r||o!=o)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null==t.util.ZPP_PubPool.poolVec2?i=new e.geom.Vec2:(i=t.util.ZPP_PubPool.poolVec2,t.util.ZPP_PubPool.poolVec2=i.zpp_pool,i.zpp_pool=null,i.zpp_disp=!1,i==t.util.ZPP_PubPool.nextVec2&&(t.util.ZPP_PubPool.nextVec2=null)),null==i.zpp_inner){var a;null==t.geom.ZPP_Vec2.zpp_pool?a=new t.geom.ZPP_Vec2:(a=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=a.next,a.next=null),a.weak=!1,a._immutable=!1,a.x=r,a.y=o,i.zpp_inner=a,i.zpp_inner.outer=i}else{if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var s,l=i.zpp_inner;if(l._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=l._isimmutable&&l._isimmutable(),r!=r||o!=o)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var u=i.zpp_inner;if(null!=u._validate&&u._validate(),i.zpp_inner.x==r){if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var h=i.zpp_inner;null!=h._validate&&h._validate(),s=i.zpp_inner.y==o}else s=!1;if(!s){i.zpp_inner.x=r,i.zpp_inner.y=o;var c=i.zpp_inner;null!=c._invalidate&&c._invalidate(c)}}i.zpp_inner.weak=!1,this.wrap_lnorm=i,this.wrap_lnorm.zpp_inner._immutable=!0,this.wrap_lnorm.zpp_inner._validate=p(this,this.lnorm_validate)},t.shape.ZPP_Edge.prototype.getgnorm=function(){var i,r=this.gnormx,o=this.gnormy;if(null==o&&(o=0),null==r&&(r=0),r!=r||o!=o)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null==t.util.ZPP_PubPool.poolVec2?i=new e.geom.Vec2:(i=t.util.ZPP_PubPool.poolVec2,t.util.ZPP_PubPool.poolVec2=i.zpp_pool,i.zpp_pool=null,i.zpp_disp=!1,i==t.util.ZPP_PubPool.nextVec2&&(t.util.ZPP_PubPool.nextVec2=null)),null==i.zpp_inner){var a;null==t.geom.ZPP_Vec2.zpp_pool?a=new t.geom.ZPP_Vec2:(a=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=a.next,a.next=null),a.weak=!1,a._immutable=!1,a.x=r,a.y=o,i.zpp_inner=a,i.zpp_inner.outer=i}else{if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var s,l=i.zpp_inner;if(l._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=l._isimmutable&&l._isimmutable(),r!=r||o!=o)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var u=i.zpp_inner;if(null!=u._validate&&u._validate(),i.zpp_inner.x==r){if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var h=i.zpp_inner;null!=h._validate&&h._validate(),s=i.zpp_inner.y==o}else s=!1;if(!s){i.zpp_inner.x=r,i.zpp_inner.y=o;var c=i.zpp_inner;null!=c._invalidate&&c._invalidate(c)}}i.zpp_inner.weak=!1,this.wrap_gnorm=i,this.wrap_gnorm.zpp_inner._immutable=!0,this.wrap_gnorm.zpp_inner._validate=p(this,this.gnorm_validate)},t.shape.ZPP_Edge.prototype.__class__=t.shape.ZPP_Edge,t.shape.ZPP_Polygon=l["zpp_nape.shape.ZPP_Polygon"]=function(){this.zip_sanitation=!1,this.zip_valid=!1,this.zip_gaxi=!1,this.zip_gverts=!1,this.zip_laxi=!1,this.zip_lverts=!1,this.reverse_flag=!1,this.edgeCnt=0,this.wrap_edges=null,this.edges=null,this.wrap_gverts=null,this.gverts=null,this.wrap_lverts=null,this.lverts=null,this.outer_zn=null,t.shape.ZPP_Shape.call(this,1),this.polygon=this,this.lverts=new t.geom.ZPP_Vec2,this.gverts=new t.geom.ZPP_Vec2,this.edges=new t.util.ZNPList_ZPP_Edge,this.edgeCnt=0},t.shape.ZPP_Polygon.__name__=["zpp_nape","shape","ZPP_Polygon"],t.shape.ZPP_Polygon.__super__=t.shape.ZPP_Shape,t.shape.ZPP_Shape.prototype)t.shape.ZPP_Polygon.prototype[u]=t.shape.ZPP_Shape.prototype[u];for(var u in t.shape.ZPP_Polygon.prototype.outer_zn=null,t.shape.ZPP_Polygon.prototype.lverts=null,t.shape.ZPP_Polygon.prototype.wrap_lverts=null,t.shape.ZPP_Polygon.prototype.gverts=null,t.shape.ZPP_Polygon.prototype.wrap_gverts=null,t.shape.ZPP_Polygon.prototype.edges=null,t.shape.ZPP_Polygon.prototype.wrap_edges=null,t.shape.ZPP_Polygon.prototype.edgeCnt=null,t.shape.ZPP_Polygon.prototype.reverse_flag=null,t.shape.ZPP_Polygon.prototype.__clear=function(){},t.shape.ZPP_Polygon.prototype.lverts_pa_invalidate=function(e){this.invalidate_lverts()},t.shape.ZPP_Polygon.prototype.lverts_pa_immutable=function(){if(null!=this.body&&1==this.body.type&&null!=this.body.space)throw new n._Boot.HaxeError("Error: Cannot modify local vertex of Polygon added to a static body whilst within a Space")},t.shape.ZPP_Polygon.prototype.gverts_pa_validate=function(){if(null==this.body)throw new n._Boot.HaxeError("Error: World vertex only makes sense when Polygon is contained in a rigid body");if(this.zip_gverts&&null!=this.body){this.zip_gverts=!1,this.validate_lverts();var e=this.body;e.zip_axis&&(e.zip_axis=!1,e.axisx=Math.sin(e.rot),e.axisy=Math.cos(e.rot));for(var t=this.lverts.next,i=this.gverts.next;null!=i;){var r=i,o=t;t=t.next,r.x=this.body.posx+(this.body.axisy*o.x-this.body.axisx*o.y),r.y=this.body.posy+(o.x*this.body.axisx+o.y*this.body.axisy),i=i.next}}},t.shape.ZPP_Polygon.prototype.lverts_post_adder=function(e){e.zpp_inner._invalidate=p(this,this.lverts_pa_invalidate),e.zpp_inner._isimmutable=p(this,this.lverts_pa_immutable);for(var n=null,i=null,r=this.lverts.next;null!=r&&r!=e.zpp_inner;)n=null==n?this.gverts.next:n.next,i=null==i?this.edges.head:i.next,r=r.next;var o;null==t.geom.ZPP_Vec2.zpp_pool?o=new t.geom.ZPP_Vec2:(o=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=o.next,o.next=null),o.weak=!1,o._immutable=!0,o.x=0,o.y=0;var a,s,l,u=o;this.gverts.insert(n,u),null!=this.lverts.next.next&&(null==this.lverts.next.next.next?(null==t.shape.ZPP_Edge.zpp_pool?a=new t.shape.ZPP_Edge:(a=t.shape.ZPP_Edge.zpp_pool,t.shape.ZPP_Edge.zpp_pool=a.next,a.next=null),a.polygon=this,this.edges.add(a),null==t.shape.ZPP_Edge.zpp_pool?s=new t.shape.ZPP_Edge:(s=t.shape.ZPP_Edge.zpp_pool,t.shape.ZPP_Edge.zpp_pool=s.next,s.next=null),s.polygon=this,this.edges.add(s),this.edgeCnt+=2):(null==t.shape.ZPP_Edge.zpp_pool?l=new t.shape.ZPP_Edge:(l=t.shape.ZPP_Edge.zpp_pool,t.shape.ZPP_Edge.zpp_pool=l.next,l.next=null),l.polygon=this,this.edges.insert(i,l),this.edgeCnt++)),u._validate=p(this,this.gverts_pa_validate)},t.shape.ZPP_Polygon.prototype.lverts_subber=function(e){this.cleanup_lvert(e.zpp_inner)},t.shape.ZPP_Polygon.prototype.lverts_invalidate=function(e){this.invalidate_lverts()},t.shape.ZPP_Polygon.prototype.lverts_validate=function(){this.validate_lverts()},t.shape.ZPP_Polygon.prototype.lverts_modifiable=function(){if(this.immutable_midstep("Polygon::localVerts"),null!=this.body&&1==this.body.type&&null!=this.body.space)throw new n._Boot.HaxeError("Error: Cannot modifiy shapes of static object once added to Space")},t.shape.ZPP_Polygon.prototype.gverts_validate=function(){if(this.zip_gverts&&null!=this.body){this.zip_gverts=!1,this.validate_lverts();var e=this.body;e.zip_axis&&(e.zip_axis=!1,e.axisx=Math.sin(e.rot),e.axisy=Math.cos(e.rot));for(var t=this.lverts.next,n=this.gverts.next;null!=n;){var i=n,r=t;t=t.next,i.x=this.body.posx+(this.body.axisy*r.x-this.body.axisx*r.y),i.y=this.body.posy+(r.x*this.body.axisx+r.y*this.body.axisy),n=n.next}}},t.shape.ZPP_Polygon.prototype.edges_validate=function(){this.validate_lverts()},t.shape.ZPP_Polygon.prototype.getlverts=function(){this.wrap_lverts=t.util.ZPP_MixVec2List.get(this.lverts),this.wrap_lverts.zpp_inner.post_adder=p(this,this.lverts_post_adder),this.wrap_lverts.zpp_inner.subber=p(this,this.lverts_subber),this.wrap_lverts.zpp_inner._invalidate=p(this,this.lverts_invalidate),this.wrap_lverts.zpp_inner._validate=p(this,this.lverts_validate),this.wrap_lverts.zpp_inner._modifiable=p(this,this.lverts_modifiable),this.wrap_lverts.zpp_inner.reverse_flag=this.reverse_flag},t.shape.ZPP_Polygon.prototype.getgverts=function(){this.wrap_gverts=t.util.ZPP_MixVec2List.get(this.gverts,!0),this.wrap_gverts.zpp_inner.reverse_flag=this.reverse_flag,this.wrap_gverts.zpp_inner._validate=p(this,this.gverts_validate)},t.shape.ZPP_Polygon.prototype.getedges=function(){this.wrap_edges=t.util.ZPP_EdgeList.get(this.edges,!0),this.wrap_edges.zpp_inner.reverse_flag=this.reverse_flag,this.wrap_edges.zpp_inner._validate=p(this,this.edges_validate)},t.shape.ZPP_Polygon.prototype.zip_lverts=null,t.shape.ZPP_Polygon.prototype.invalidate_lverts=function(){this.invalidate_laxi(),this.invalidate_area_inertia(),this.invalidate_angDrag(),this.invalidate_localCOM(),this.invalidate_gverts(),this.zip_lverts=!0,this.zip_valid=!0,this.zip_sanitation=!0,null!=this.body&&this.body.wake()},t.shape.ZPP_Polygon.prototype.zip_laxi=null,t.shape.ZPP_Polygon.prototype.invalidate_laxi=function(){this.invalidate_gaxi(),this.zip_sweepRadius=!0,this.zip_laxi=!0},t.shape.ZPP_Polygon.prototype.zip_gverts=null,t.shape.ZPP_Polygon.prototype.invalidate_gverts=function(){this.zip_aabb=!0,null!=this.body&&(this.body.zip_aabb=!0),this.zip_gverts=!0},t.shape.ZPP_Polygon.prototype.zip_gaxi=null,t.shape.ZPP_Polygon.prototype.invalidate_gaxi=function(){this.zip_gaxi=!0},t.shape.ZPP_Polygon.prototype.zip_valid=null,t.shape.ZPP_Polygon.prototype.validation=null,t.shape.ZPP_Polygon.prototype.valid=function(){if(this.zip_valid){if(this.zip_valid=!1,this.zip_sanitation&&(this.zip_sanitation=!1,this.splice_collinear_real()),this.lverts.length<3)return null==t.util.ZPP_Flags.ValidationResult_DEGENERATE&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.ValidationResult_DEGENERATE=new e.shape.ValidationResult,t.util.ZPP_Flags.internal=!1),this.validation=t.util.ZPP_Flags.ValidationResult_DEGENERATE;if(this.validate_lverts(),this.validate_area_inertia(),this.area<e.Config.epsilon)return null==t.util.ZPP_Flags.ValidationResult_DEGENERATE&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.ValidationResult_DEGENERATE=new e.shape.ValidationResult,t.util.ZPP_Flags.internal=!1),this.validation=t.util.ZPP_Flags.ValidationResult_DEGENERATE;var n=!1,i=!1,r=!0,o=this.lverts.next,a=o,s=o=o.next;for(o=o.next;null!=o;){var l,p,u,h=o;l=h.x-s.x,p=h.y-s.y,u=s.x-a.x;var c=(s.y-a.y)*l-u*p;if(c>e.Config.epsilon?i=!0:c<-e.Config.epsilon&&(n=!0),i&&n){r=!1;break}a=s,s=h,o=o.next}if(r){for(var _=o=this.lverts.next;;){var d,m,P;d=_.x-s.x,m=_.y-s.y,P=s.x-a.x;var f=(s.y-a.y)*d-P*m;if(f>e.Config.epsilon?i=!0:f<-e.Config.epsilon&&(n=!0),i&&n){r=!1;break}break}if(r){a=s,s=_;for(var x=o=o.next;;){var y,v,g;y=x.x-s.x,v=x.y-s.y,g=s.x-a.x;var b=(s.y-a.y)*y-g*v;if(b>e.Config.epsilon?i=!0:b<-e.Config.epsilon&&(n=!0),i&&n)break;break}}}if(i&&n)return null==t.util.ZPP_Flags.ValidationResult_CONCAVE&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.ValidationResult_CONCAVE=new e.shape.ValidationResult,t.util.ZPP_Flags.internal=!1),this.validation=t.util.ZPP_Flags.ValidationResult_CONCAVE;var z=!0,w=!0,Z=this.lverts.next,E=Z;for(Z=Z.next;null!=Z;){var M=Z;if(!z){w=!1;break}var S=!0,C=this.lverts.next,N=C;for(C=C.next;null!=C;){var A=C;if(E!=N&&E!=A&&M!=N&&M!=A){var L,B,T,V;L=E.x-N.x,B=E.y-N.y,T=M.x-E.x;var k,I,O=(V=M.y-E.y)*(k=A.x-N.x)-T*(I=A.y-N.y);if(O*O>e.Config.epsilon){var R=(I*L-k*B)*(O=1/O);if(R>e.Config.epsilon&&R<1-e.Config.epsilon){var H=(V*L-T*B)*O;if(H>e.Config.epsilon&&H<1-e.Config.epsilon){z=!1,S=!1;break}}}N=A,C=C.next}else N=A,C=C.next}if(S)for(;;){var F,D,G,U,j=this.lverts.next;if(E==N||E==j||M==N||M==j)break;F=E.x-N.x,D=E.y-N.y,G=M.x-E.x;var W,q,J=(U=M.y-E.y)*(W=j.x-N.x)-G*(q=j.y-N.y);if(J*J>e.Config.epsilon){var $=(q*F-W*D)*(J=1/J);if($>e.Config.epsilon&&$<1-e.Config.epsilon){var X=(U*F-G*D)*J;if(X>e.Config.epsilon&&X<1-e.Config.epsilon){z=!1;break}}}break}E=M,Z=Z.next}if(w)for(;;){var Y=this.lverts.next;if(!z)break;var K=!0,Q=this.lverts.next,ee=Q;for(Q=Q.next;null!=Q;){var te=Q;if(E!=ee&&E!=te&&Y!=ee&&Y!=te){var ne,ie,re,oe;ne=E.x-ee.x,ie=E.y-ee.y,re=Y.x-E.x;var ae,se,le=(oe=Y.y-E.y)*(ae=te.x-ee.x)-re*(se=te.y-ee.y);if(le*le>e.Config.epsilon){var pe=(se*ne-ae*ie)*(le=1/le);if(pe>e.Config.epsilon&&pe<1-e.Config.epsilon){var ue=(oe*ne-re*ie)*le;if(ue>e.Config.epsilon&&ue<1-e.Config.epsilon){z=!1,K=!1;break}}}ee=te,Q=Q.next}else ee=te,Q=Q.next}if(K)for(;;){var he,ce,_e,de,me=this.lverts.next;if(E==ee||E==me||Y==ee||Y==me)break;he=E.x-ee.x,ce=E.y-ee.y,_e=Y.x-E.x;var Pe,fe,xe=(de=Y.y-E.y)*(Pe=me.x-ee.x)-_e*(fe=me.y-ee.y);if(xe*xe>e.Config.epsilon){var ye=(fe*he-Pe*ce)*(xe=1/xe);if(ye>e.Config.epsilon&&ye<1-e.Config.epsilon){var ve=(de*he-_e*ce)*xe;if(ve>e.Config.epsilon&&ve<1-e.Config.epsilon){z=!1;break}}}break}break}return z?(null==t.util.ZPP_Flags.ValidationResult_VALID&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.ValidationResult_VALID=new e.shape.ValidationResult,t.util.ZPP_Flags.internal=!1),this.validation=t.util.ZPP_Flags.ValidationResult_VALID):(null==t.util.ZPP_Flags.ValidationResult_SELF_INTERSECTING&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.ValidationResult_SELF_INTERSECTING=new e.shape.ValidationResult,t.util.ZPP_Flags.internal=!1),this.validation=t.util.ZPP_Flags.ValidationResult_SELF_INTERSECTING)}return this.validation},t.shape.ZPP_Polygon.prototype.validate_lverts=function(){this.zip_lverts&&(this.zip_lverts=!1,this.lverts.length>2&&(this.validate_area_inertia(),this.area<0&&(this.reverse_vertices(),this.area=-this.area)))},t.shape.ZPP_Polygon.prototype.cleanup_lvert=function(e){for(var n=null,i=null,r=this.lverts.next;null!=r&&r!=e;)n=null==n?this.gverts.next:n.next,i=null==i?this.edges.head:i.next,r=r.next;var o=null==n?this.gverts.next:n.next;this.gverts.erase(n);var a=o;if(null!=a.outer&&(a.outer.zpp_inner=null,a.outer=null),a._isimmutable=null,a._validate=null,a._invalidate=null,a.next=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=a,2==this.edgeCnt){var s=this.edges.pop_unsafe(),l=s;l.polygon=null,l.next=t.shape.ZPP_Edge.zpp_pool,t.shape.ZPP_Edge.zpp_pool=l;var p=s=this.edges.pop_unsafe();p.polygon=null,p.next=t.shape.ZPP_Edge.zpp_pool,t.shape.ZPP_Edge.zpp_pool=p,this.edgeCnt=0}else if(0!=this.edgeCnt){var u=null==i?this.edges.head.elt:i.next.elt;this.edges.erase(i);var h=u;h.polygon=null,h.next=t.shape.ZPP_Edge.zpp_pool,t.shape.ZPP_Edge.zpp_pool=h,this.edgeCnt--}},t.shape.ZPP_Polygon.prototype.zip_sanitation=null,t.shape.ZPP_Polygon.prototype.splice_collinear=function(){this.zip_sanitation&&(this.zip_sanitation=!1,this.splice_collinear_real())},t.shape.ZPP_Polygon.prototype.splice_collinear_real=function(){if(null!=this.lverts.next&&null!=this.lverts.next.next&&null!=this.lverts.next.next.next){for(var t=null,n=this.lverts.next;null!=n;){var i,r,o=n,a=null==n.next?this.lverts.next:n.next;(i=o.x-a.x)*i+(r=o.y-a.y)*r<e.Config.epsilon*e.Config.epsilon?(this.cleanup_lvert(n),n=this.lverts.erase(t)):(t=n,n=n.next)}if(null!=this.lverts.next)for(var s;;){s=!1;for(var l=this.lverts.next;null!=l;){var p,u,h,c=null==l.next?this.lverts.next:l.next,_=l,d=c,m=null==c.next?this.lverts.next:c.next;p=d.x-_.x,u=d.y-_.y,h=m.x-d.x;var P=(m.y-d.y)*p-h*u;P*P>=e.Config.epsilon*e.Config.epsilon||(this.cleanup_lvert(c),this.lverts.erase(null==l.next?null:l),s=!0),l=l.next}if(!s)break}}},t.shape.ZPP_Polygon.prototype.reverse_vertices=function(){this.lverts.reverse(),this.gverts.reverse(),this.edges.reverse();var e=this.edges.iterator_at(this.edgeCnt-1),t=this.edges.pop_unsafe();this.edges.insert(e,t),this.reverse_flag=!this.reverse_flag,null!=this.wrap_lverts&&(this.wrap_lverts.zpp_inner.reverse_flag=this.reverse_flag),null!=this.wrap_gverts&&(this.wrap_gverts.zpp_inner.reverse_flag=this.reverse_flag),null!=this.wrap_edges&&(this.wrap_edges.zpp_inner.reverse_flag=this.reverse_flag)},t.shape.ZPP_Polygon.prototype.validate_laxi=function(){if(this.zip_laxi){this.zip_laxi=!1,this.validate_lverts();var e=this.edges.head,t=this.lverts.next,n=t;for(t=t.next;null!=t;){var i=t,r=e.elt;e=e.next,r.lp0=n,r.lp1=i;var o=0,a=0;o=n.x-i.x,a=n.y-i.y;var s=Math.sqrt(o*o+a*a);r.length=s;var l=1/s,p=o*=l;o=-(a*=l),a=p,r.lprojection=o*n.x+a*n.y,r.lnormx=o,r.lnormy=a,null!=r.wrap_lnorm&&(r.wrap_lnorm.zpp_inner.x=o,r.wrap_lnorm.zpp_inner.y=a),n=i,t=t.next}var u=this.lverts.next,h=e.elt;e=e.next,h.lp0=n,h.lp1=u;var c=0,_=0;c=n.x-u.x,_=n.y-u.y;var d=Math.sqrt(c*c+_*_);h.length=d;var m=1/d,P=c*=m;c=-(_*=m),_=P,h.lprojection=c*n.x+_*n.y,h.lnormx=c,h.lnormy=_,null!=h.wrap_lnorm&&(h.wrap_lnorm.zpp_inner.x=c,h.wrap_lnorm.zpp_inner.y=_)}},t.shape.ZPP_Polygon.prototype.validate_gverts=function(){if(this.zip_gverts&&null!=this.body){this.zip_gverts=!1,this.validate_lverts();var e=this.body;e.zip_axis&&(e.zip_axis=!1,e.axisx=Math.sin(e.rot),e.axisy=Math.cos(e.rot));for(var t=this.lverts.next,n=this.gverts.next;null!=n;){var i=n,r=t;t=t.next,i.x=this.body.posx+(this.body.axisy*r.x-this.body.axisx*r.y),i.y=this.body.posy+(r.x*this.body.axisx+r.y*this.body.axisy),n=n.next}}},t.shape.ZPP_Polygon.prototype.validate_gaxi=function(){if(this.zip_gaxi&&null!=this.body){this.zip_gaxi=!1,this.validate_laxi();var e=this.body;if(e.zip_axis&&(e.zip_axis=!1,e.axisx=Math.sin(e.rot),e.axisy=Math.cos(e.rot)),this.zip_gverts&&null!=this.body){this.zip_gverts=!1,this.validate_lverts();var t=this.body;t.zip_axis&&(t.zip_axis=!1,t.axisx=Math.sin(t.rot),t.axisy=Math.cos(t.rot));for(var n=this.lverts.next,i=this.gverts.next;null!=i;){var r=i,o=n;n=n.next,r.x=this.body.posx+(this.body.axisy*o.x-this.body.axisx*o.y),r.y=this.body.posy+(o.x*this.body.axisx+o.y*this.body.axisy),i=i.next}}var a=this.edges.head,s=this.gverts.next,l=s;for(s=s.next;null!=s;){var p=s,u=a.elt;a=a.next,u.gp0=l,u.gp1=p,u.gnormx=this.body.axisy*u.lnormx-this.body.axisx*u.lnormy,u.gnormy=u.lnormx*this.body.axisx+u.lnormy*this.body.axisy,u.gprojection=this.body.posx*u.gnormx+this.body.posy*u.gnormy+u.lprojection,null!=u.wrap_gnorm&&(u.wrap_gnorm.zpp_inner.x=u.gnormx,u.wrap_gnorm.zpp_inner.y=u.gnormy),u.tp0=u.gp0.y*u.gnormx-u.gp0.x*u.gnormy,u.tp1=u.gp1.y*u.gnormx-u.gp1.x*u.gnormy,l=p,s=s.next}var h=this.gverts.next,c=a.elt;a=a.next,c.gp0=l,c.gp1=h,c.gnormx=this.body.axisy*c.lnormx-this.body.axisx*c.lnormy,c.gnormy=c.lnormx*this.body.axisx+c.lnormy*this.body.axisy,c.gprojection=this.body.posx*c.gnormx+this.body.posy*c.gnormy+c.lprojection,null!=c.wrap_gnorm&&(c.wrap_gnorm.zpp_inner.x=c.gnormx,c.wrap_gnorm.zpp_inner.y=c.gnormy),c.tp0=c.gp0.y*c.gnormx-c.gp0.x*c.gnormy,c.tp1=c.gp1.y*c.gnormx-c.gp1.x*c.gnormy}},t.shape.ZPP_Polygon.prototype.__validate_aabb=function(){if(this.zip_gverts&&null!=this.body){this.zip_gverts=!1,this.validate_lverts();var e=this.body;e.zip_axis&&(e.zip_axis=!1,e.axisx=Math.sin(e.rot),e.axisy=Math.cos(e.rot));for(var t=this.lverts.next,i=this.gverts.next;null!=i;){var r=i,o=t;t=t.next,r.x=this.body.posx+(this.body.axisy*o.x-this.body.axisx*o.y),r.y=this.body.posy+(o.x*this.body.axisx+o.y*this.body.axisy),i=i.next}}if(null==this.lverts.next)throw new n._Boot.HaxeError("Error: An empty polygon has no meaningful bounds");var a=this.gverts.next;this.aabb.minx=a.x,this.aabb.miny=a.y,this.aabb.maxx=a.x,this.aabb.maxy=a.y;for(var s=this.gverts.next.next;null!=s;){var l=s;l.x<this.aabb.minx&&(this.aabb.minx=l.x),l.x>this.aabb.maxx&&(this.aabb.maxx=l.x),l.y<this.aabb.miny&&(this.aabb.miny=l.y),l.y>this.aabb.maxy&&(this.aabb.maxy=l.y),s=s.next}},t.shape.ZPP_Polygon.prototype._force_validate_aabb=function(){var e=this.lverts.next,t=this.gverts.next,n=e;e=e.next,t.x=this.body.posx+(this.body.axisy*n.x-this.body.axisx*n.y),t.y=this.body.posy+(n.x*this.body.axisx+n.y*this.body.axisy),this.aabb.minx=t.x,this.aabb.miny=t.y,this.aabb.maxx=t.x,this.aabb.maxy=t.y;for(var i=this.gverts.next.next;null!=i;){var r=i,o=e;e=e.next,r.x=this.body.posx+(this.body.axisy*o.x-this.body.axisx*o.y),r.y=this.body.posy+(o.x*this.body.axisx+o.y*this.body.axisy),r.x<this.aabb.minx&&(this.aabb.minx=r.x),r.x>this.aabb.maxx&&(this.aabb.maxx=r.x),r.y<this.aabb.miny&&(this.aabb.miny=r.y),r.y>this.aabb.maxy&&(this.aabb.maxy=r.y),i=i.next}},t.shape.ZPP_Polygon.prototype.__validate_sweepRadius=function(){var e=0,t=0;this.validate_laxi();for(var n=this.lverts.next;null!=n;){var i=n,r=i.x*i.x+i.y*i.y;r>e&&(e=r),n=n.next}for(var o=this.edges.head;null!=o;){var a=o.elt;if(a.lprojection<t&&(t=a.lprojection)<0)break;o=o.next}t<0&&(t=0),this.sweepRadius=Math.sqrt(e),this.sweepCoef=this.sweepRadius-t},t.shape.ZPP_Polygon.prototype.__validate_area_inertia=function(){if(null==this.lverts.next||null==this.lverts.next.next||null==this.lverts.next.next.next)this.area=0,this.inertia=0;else{this.area=0;var e=0,t=0,n=this.lverts.next,i=n,r=n=n.next;for(n=n.next;null!=n;){var o=n,a=r.y*i.x-r.x*i.y;e+=a*(r.x*r.x+r.y*r.y+(r.x*i.x+r.y*i.y)+(i.x*i.x+i.y*i.y)),t+=a,this.area+=r.x*(o.y-i.y),i=r,r=o,n=n.next}var s=n=this.lverts.next,l=r.y*i.x-r.x*i.y;e+=l*(r.x*r.x+r.y*r.y+(r.x*i.x+r.y*i.y)+(i.x*i.x+i.y*i.y)),t+=l,this.area+=r.x*(s.y-i.y),i=r,r=s;var p=n=n.next,u=r.y*i.x-r.x*i.y;e+=u*(r.x*r.x+r.y*r.y+(r.x*i.x+r.y*i.y)+(i.x*i.x+i.y*i.y)),t+=u,this.area+=r.x*(p.y-i.y),this.inertia=e/(6*t),this.area*=.5,this.area<0&&(this.area=-this.area,this.reverse_vertices())}},t.shape.ZPP_Polygon.prototype.__validate_angDrag=function(){if(this.lverts.length<3)throw new n._Boot.HaxeError("Error: Polygon's with less than 3 vertices have no meaningful angDrag");this.validate_area_inertia(),this.validate_laxi();for(var t=0,i=this.edges.head,r=0,o=this.lverts.next,a=o,s=o.next;null!=s;){var l,p,u=s,h=i.elt;i=i.next,r+=h.length,l=u.x-a.x,p=u.y-a.y,t+=h.length*e.Config.fluidAngularDragFriction*this.material.dynamicFriction*h.lprojection*h.lprojection;var c=-(a.y*h.lnormx-a.x*h.lnormy)/(p*h.lnormx-l*h.lnormy);if(c>0){var _=c>1?1:c,d=0,m=0;d=a.x,m=a.y,d+=l*_,m+=p*_;var P=h.lnormy*a.x-h.lnormx*a.y,f=h.lnormy*d-h.lnormx*m;t+=(f*f*f-P*P*P)/(3*(f-P))*_*h.length*e.Config.fluidAngularDrag}if(c<1){var x=c<0?0:c,y=0,v=0;y=a.x,v=a.y,y+=l*x,v+=p*x;var g=h.lnormy*y-h.lnormx*v,b=h.lnormy*u.x-h.lnormx*u.y;t+=(b*b*b-g*g*g)/(3*(b-g))*e.Config.fluidVacuumDrag*(1-x)*h.length*e.Config.fluidAngularDrag}o=s,a=u,s=s.next}for(;;){var z,w,Z=s=this.lverts.next,E=i.elt;i=i.next,r+=E.length,z=Z.x-a.x,w=Z.y-a.y,t+=E.length*e.Config.fluidAngularDragFriction*this.material.dynamicFriction*E.lprojection*E.lprojection;var M=-(a.y*E.lnormx-a.x*E.lnormy)/(w*E.lnormx-z*E.lnormy);if(M>0){var S=M>1?1:M,C=0,N=0;C=a.x,N=a.y,C+=z*S,N+=w*S;var A=E.lnormy*a.x-E.lnormx*a.y,L=E.lnormy*C-E.lnormx*N;t+=(L*L*L-A*A*A)/(3*(L-A))*S*E.length*e.Config.fluidAngularDrag}if(M<1){var B=M<0?0:M,T=0,V=0;T=a.x,V=a.y,T+=z*B,V+=w*B;var k=E.lnormy*T-E.lnormx*V,I=E.lnormy*Z.x-E.lnormx*Z.y;t+=(I*I*I-k*k*k)/(3*(I-k))*e.Config.fluidVacuumDrag*(1-B)*E.length*e.Config.fluidAngularDrag}break}this.angDrag=t/(this.inertia*r)},t.shape.ZPP_Polygon.prototype.__validate_localCOM=function(){if(null==this.lverts.next)throw new n._Boot.HaxeError("Error: An empty polygon has no meaningful localCOM");if(null==this.lverts.next.next)this.localCOMx=this.lverts.next.x,this.localCOMy=this.lverts.next.y;else if(null==this.lverts.next.next.next)this.localCOMx=this.lverts.next.x,this.localCOMy=this.lverts.next.y,this.localCOMx+=1*this.lverts.next.next.x,this.localCOMy+=1*this.lverts.next.next.y,this.localCOMx*=.5,this.localCOMy*=.5;else{this.localCOMx=0,this.localCOMy=0;var e=0,t=this.lverts.next,i=t,r=t=t.next;for(t=t.next;null!=t;){var o=t;e+=r.x*(o.y-i.y);var a=o.y*r.x-o.x*r.y;this.localCOMx+=(r.x+o.x)*a,this.localCOMy+=(r.y+o.y)*a,i=r,r=o,t=t.next}var s=t=this.lverts.next;e+=r.x*(s.y-i.y);var l=s.y*r.x-s.x*r.y;this.localCOMx+=(r.x+s.x)*l,this.localCOMy+=(r.y+s.y)*l,i=r,r=s;var p=t=t.next;e+=r.x*(p.y-i.y);var u=p.y*r.x-p.x*r.y;this.localCOMx+=(r.x+p.x)*u,this.localCOMy+=(r.y+p.y)*u;var h=e=1/(3*e);this.localCOMx*=h,this.localCOMy*=h}},t.shape.ZPP_Polygon.prototype.localCOM_validate=function(){if(null==this.lverts.next)throw new n._Boot.HaxeError("Error: An empty polygon does not have any meaningful localCOM");if(this.zip_localCOM){if(this.zip_localCOM=!1,1==this.type){var e=this.polygon;if(null==e.lverts.next)throw new n._Boot.HaxeError("Error: An empty polygon has no meaningful localCOM");if(null==e.lverts.next.next)e.localCOMx=e.lverts.next.x,e.localCOMy=e.lverts.next.y;else if(null==e.lverts.next.next.next)e.localCOMx=e.lverts.next.x,e.localCOMy=e.lverts.next.y,e.localCOMx+=1*e.lverts.next.next.x,e.localCOMy+=1*e.lverts.next.next.y,e.localCOMx*=.5,e.localCOMy*=.5;else{e.localCOMx=0,e.localCOMy=0;var t=0,i=e.lverts.next,r=i,o=i=i.next;for(i=i.next;null!=i;){var a=i;t+=o.x*(a.y-r.y);var s=a.y*o.x-a.x*o.y;e.localCOMx+=(o.x+a.x)*s,e.localCOMy+=(o.y+a.y)*s,r=o,o=a,i=i.next}var l=i=e.lverts.next;t+=o.x*(l.y-r.y);var p=l.y*o.x-l.x*o.y;e.localCOMx+=(o.x+l.x)*p,e.localCOMy+=(o.y+l.y)*p,r=o,o=l;var u=i=i.next;t+=o.x*(u.y-r.y);var h=u.y*o.x-u.x*o.y;e.localCOMx+=(o.x+u.x)*h,e.localCOMy+=(o.y+u.y)*h;var c=t=1/(3*t);e.localCOMx*=c,e.localCOMy*=c}}null!=this.wrap_localCOM&&(this.wrap_localCOM.zpp_inner.x=this.localCOMx,this.wrap_localCOM.zpp_inner.y=this.localCOMy)}},t.shape.ZPP_Polygon.prototype.localCOM_invalidate=function(e){if(this.zip_localCOM){if(this.zip_localCOM=!1,1==this.type){var t=this.polygon;if(null==t.lverts.next)throw new n._Boot.HaxeError("Error: An empty polygon has no meaningful localCOM");if(null==t.lverts.next.next)t.localCOMx=t.lverts.next.x,t.localCOMy=t.lverts.next.y;else if(null==t.lverts.next.next.next)t.localCOMx=t.lverts.next.x,t.localCOMy=t.lverts.next.y,t.localCOMx+=1*t.lverts.next.next.x,t.localCOMy+=1*t.lverts.next.next.y,t.localCOMx*=.5,t.localCOMy*=.5;else{t.localCOMx=0,t.localCOMy=0;var i=0,r=t.lverts.next,o=r,a=r=r.next;for(r=r.next;null!=r;){var s=r;i+=a.x*(s.y-o.y);var l=s.y*a.x-s.x*a.y;t.localCOMx+=(a.x+s.x)*l,t.localCOMy+=(a.y+s.y)*l,o=a,a=s,r=r.next}var p=r=t.lverts.next;i+=a.x*(p.y-o.y);var u=p.y*a.x-p.x*a.y;t.localCOMx+=(a.x+p.x)*u,t.localCOMy+=(a.y+p.y)*u,o=a,a=p;var h=r=r.next;i+=a.x*(h.y-o.y);var c=h.y*a.x-h.x*a.y;t.localCOMx+=(a.x+h.x)*c,t.localCOMy+=(a.y+h.y)*c;var _=i=1/(3*i);t.localCOMx*=_,t.localCOMy*=_}}null!=this.wrap_localCOM&&(this.wrap_localCOM.zpp_inner.x=this.localCOMx,this.wrap_localCOM.zpp_inner.y=this.localCOMy)}var d,m;d=e.x-this.localCOMx,m=e.y-this.localCOMy;for(var P=this.lverts.next;null!=P;){var f=P;f.x+=1*d,f.y+=1*m,P=P.next}this.invalidate_lverts()},t.shape.ZPP_Polygon.prototype.setupLocalCOM=function(){var i,r=this.localCOMx,o=this.localCOMy;if(null==o&&(o=0),null==r&&(r=0),r!=r||o!=o)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null==t.util.ZPP_PubPool.poolVec2?i=new e.geom.Vec2:(i=t.util.ZPP_PubPool.poolVec2,t.util.ZPP_PubPool.poolVec2=i.zpp_pool,i.zpp_pool=null,i.zpp_disp=!1,i==t.util.ZPP_PubPool.nextVec2&&(t.util.ZPP_PubPool.nextVec2=null)),null==i.zpp_inner){var a;null==t.geom.ZPP_Vec2.zpp_pool?a=new t.geom.ZPP_Vec2:(a=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=a.next,a.next=null),a.weak=!1,a._immutable=!1,a.x=r,a.y=o,i.zpp_inner=a,i.zpp_inner.outer=i}else{if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var s,l=i.zpp_inner;if(l._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=l._isimmutable&&l._isimmutable(),r!=r||o!=o)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var u=i.zpp_inner;if(null!=u._validate&&u._validate(),i.zpp_inner.x==r){if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var h=i.zpp_inner;null!=h._validate&&h._validate(),s=i.zpp_inner.y==o}else s=!1;if(!s){i.zpp_inner.x=r,i.zpp_inner.y=o;var c=i.zpp_inner;null!=c._invalidate&&c._invalidate(c)}}i.zpp_inner.weak=!1,this.wrap_localCOM=i,this.wrap_localCOM.zpp_inner._inuse=!0,this.wrap_localCOM.zpp_inner._validate=p(this,this.localCOM_validate),this.wrap_localCOM.zpp_inner._invalidate=p(this,this.localCOM_invalidate)},t.shape.ZPP_Polygon.prototype.__translate=function(e,t){for(var n=this.lverts.next;null!=n;){var i=n;i.x+=1*e,i.y+=1*t,n=n.next}this.invalidate_lverts()},t.shape.ZPP_Polygon.prototype.__scale=function(e,t){for(var n=this.lverts.next;null!=n;){var i=n;i.x*=e,i.y*=t,n=n.next}this.invalidate_lverts()},t.shape.ZPP_Polygon.prototype.__rotate=function(e,t){for(var n=this.lverts.next;null!=n;){var i,r,o=n;i=t*o.x-e*o.y,r=o.x*e+o.y*t,o.x=i,o.y=r,n=n.next}this.invalidate_lverts()},t.shape.ZPP_Polygon.prototype.__transform=function(e){for(var t=this.lverts.next;null!=t;){var n=t,i=e.zpp_inner.a*n.x+e.zpp_inner.b*n.y+e.zpp_inner.tx;n.y=e.zpp_inner.c*n.x+e.zpp_inner.d*n.y+e.zpp_inner.ty,n.x=i,t=t.next}this.invalidate_lverts()},t.shape.ZPP_Polygon.prototype.__copy=function(){var t=this.outer_zn;return null==t.zpp_inner_zn.wrap_lverts&&t.zpp_inner_zn.getlverts(),new e.shape.Polygon(t.zpp_inner_zn.wrap_lverts).zpp_inner_zn},t.shape.ZPP_Polygon.prototype.__class__=t.shape.ZPP_Polygon,t.space||(t.space={}),t.space.ZPP_Broadphase=l["zpp_nape.space.ZPP_Broadphase"]=function(){this.circShape=null,this.matrix=null,this.aabbShape=null,this.dynab=null,this.sweep=null,this.is_sweep=!1,this.space=null},t.space.ZPP_Broadphase.__name__=["zpp_nape","space","ZPP_Broadphase"],t.space.ZPP_Broadphase.prototype.space=null,t.space.ZPP_Broadphase.prototype.is_sweep=null,t.space.ZPP_Broadphase.prototype.sweep=null,t.space.ZPP_Broadphase.prototype.dynab=null,t.space.ZPP_Broadphase.prototype.insert=function(e){this.is_sweep?this.sweep.__insert(e):this.dynab.__insert(e)},t.space.ZPP_Broadphase.prototype.remove=function(e){this.is_sweep?this.sweep.__remove(e):this.dynab.__remove(e)},t.space.ZPP_Broadphase.prototype.sync=function(e){if(this.is_sweep){if(!this.sweep.space.continuous&&e.zip_aabb&&null!=e.body)if(e.zip_aabb=!1,0==e.type){var t=e.circle;if(t.zip_worldCOM&&null!=t.body){if(t.zip_worldCOM=!1,t.zip_localCOM){if(t.zip_localCOM=!1,1==t.type){var i=t.polygon;if(null==i.lverts.next)throw new n._Boot.HaxeError("Error: An empty polygon has no meaningful localCOM");if(null==i.lverts.next.next)i.localCOMx=i.lverts.next.x,i.localCOMy=i.lverts.next.y;else if(null==i.lverts.next.next.next)i.localCOMx=i.lverts.next.x,i.localCOMy=i.lverts.next.y,i.localCOMx+=1*i.lverts.next.next.x,i.localCOMy+=1*i.lverts.next.next.y,i.localCOMx*=.5,i.localCOMy*=.5;else{i.localCOMx=0,i.localCOMy=0;var r=0,o=i.lverts.next,a=o,s=o=o.next;for(o=o.next;null!=o;){var l=o;r+=s.x*(l.y-a.y);var p=l.y*s.x-l.x*s.y;i.localCOMx+=(s.x+l.x)*p,i.localCOMy+=(s.y+l.y)*p,a=s,s=l,o=o.next}var u=o=i.lverts.next;r+=s.x*(u.y-a.y);var h=u.y*s.x-u.x*s.y;i.localCOMx+=(s.x+u.x)*h,i.localCOMy+=(s.y+u.y)*h,a=s,s=u;var c=o=o.next;r+=s.x*(c.y-a.y);var _=c.y*s.x-c.x*s.y;i.localCOMx+=(s.x+c.x)*_,i.localCOMy+=(s.y+c.y)*_;var d=r=1/(3*r);i.localCOMx*=d,i.localCOMy*=d}}null!=t.wrap_localCOM&&(t.wrap_localCOM.zpp_inner.x=t.localCOMx,t.wrap_localCOM.zpp_inner.y=t.localCOMy)}var m=t.body;m.zip_axis&&(m.zip_axis=!1,m.axisx=Math.sin(m.rot),m.axisy=Math.cos(m.rot)),t.worldCOMx=t.body.posx+(t.body.axisy*t.localCOMx-t.body.axisx*t.localCOMy),t.worldCOMy=t.body.posy+(t.localCOMx*t.body.axisx+t.localCOMy*t.body.axisy)}var P=t.radius,f=t.radius;t.aabb.minx=t.worldCOMx-P,t.aabb.miny=t.worldCOMy-f,t.aabb.maxx=t.worldCOMx+P,t.aabb.maxy=t.worldCOMy+f}else{var x=e.polygon;if(x.zip_gverts&&null!=x.body){x.zip_gverts=!1,x.validate_lverts();var y=x.body;y.zip_axis&&(y.zip_axis=!1,y.axisx=Math.sin(y.rot),y.axisy=Math.cos(y.rot));for(var v=x.lverts.next,g=x.gverts.next;null!=g;){var b=g,z=v;v=v.next,b.x=x.body.posx+(x.body.axisy*z.x-x.body.axisx*z.y),b.y=x.body.posy+(z.x*x.body.axisx+z.y*x.body.axisy),g=g.next}}if(null==x.lverts.next)throw new n._Boot.HaxeError("Error: An empty polygon has no meaningful bounds");var w=x.gverts.next;x.aabb.minx=w.x,x.aabb.miny=w.y,x.aabb.maxx=w.x,x.aabb.maxy=w.y;for(var Z=x.gverts.next.next;null!=Z;){var E=Z;E.x<x.aabb.minx&&(x.aabb.minx=E.x),E.x>x.aabb.maxx&&(x.aabb.maxx=E.x),E.y<x.aabb.miny&&(x.aabb.miny=E.y),E.y>x.aabb.maxy&&(x.aabb.maxy=E.y),Z=Z.next}}}else{var M=this.dynab,S=e.node;if(!S.synced){if(!M.space.continuous&&e.zip_aabb&&null!=e.body)if(e.zip_aabb=!1,0==e.type){var C=e.circle;if(C.zip_worldCOM&&null!=C.body){if(C.zip_worldCOM=!1,C.zip_localCOM){if(C.zip_localCOM=!1,1==C.type){var N=C.polygon;if(null==N.lverts.next)throw new n._Boot.HaxeError("Error: An empty polygon has no meaningful localCOM");if(null==N.lverts.next.next)N.localCOMx=N.lverts.next.x,N.localCOMy=N.lverts.next.y;else if(null==N.lverts.next.next.next)N.localCOMx=N.lverts.next.x,N.localCOMy=N.lverts.next.y,N.localCOMx+=1*N.lverts.next.next.x,N.localCOMy+=1*N.lverts.next.next.y,N.localCOMx*=.5,N.localCOMy*=.5;else{N.localCOMx=0,N.localCOMy=0;var A=0,L=N.lverts.next,B=L,T=L=L.next;for(L=L.next;null!=L;){var V=L;A+=T.x*(V.y-B.y);var k=V.y*T.x-V.x*T.y;N.localCOMx+=(T.x+V.x)*k,N.localCOMy+=(T.y+V.y)*k,B=T,T=V,L=L.next}var I=L=N.lverts.next;A+=T.x*(I.y-B.y);var O=I.y*T.x-I.x*T.y;N.localCOMx+=(T.x+I.x)*O,N.localCOMy+=(T.y+I.y)*O,B=T,T=I;var R=L=L.next;A+=T.x*(R.y-B.y);var H=R.y*T.x-R.x*T.y;N.localCOMx+=(T.x+R.x)*H,N.localCOMy+=(T.y+R.y)*H;var F=A=1/(3*A);N.localCOMx*=F,N.localCOMy*=F}}null!=C.wrap_localCOM&&(C.wrap_localCOM.zpp_inner.x=C.localCOMx,C.wrap_localCOM.zpp_inner.y=C.localCOMy)}var D=C.body;D.zip_axis&&(D.zip_axis=!1,D.axisx=Math.sin(D.rot),D.axisy=Math.cos(D.rot)),C.worldCOMx=C.body.posx+(C.body.axisy*C.localCOMx-C.body.axisx*C.localCOMy),C.worldCOMy=C.body.posy+(C.localCOMx*C.body.axisx+C.localCOMy*C.body.axisy)}var G=C.radius,U=C.radius;C.aabb.minx=C.worldCOMx-G,C.aabb.miny=C.worldCOMy-U,C.aabb.maxx=C.worldCOMx+G,C.aabb.maxy=C.worldCOMy+U}else{var j=e.polygon;if(j.zip_gverts&&null!=j.body){j.zip_gverts=!1,j.validate_lverts();var W=j.body;W.zip_axis&&(W.zip_axis=!1,W.axisx=Math.sin(W.rot),W.axisy=Math.cos(W.rot));for(var q=j.lverts.next,J=j.gverts.next;null!=J;){var $=J,X=q;q=q.next,$.x=j.body.posx+(j.body.axisy*X.x-j.body.axisx*X.y),$.y=j.body.posy+(X.x*j.body.axisx+X.y*j.body.axisy),J=J.next}}if(null==j.lverts.next)throw new n._Boot.HaxeError("Error: An empty polygon has no meaningful bounds");var Y=j.gverts.next;j.aabb.minx=Y.x,j.aabb.miny=Y.y,j.aabb.maxx=Y.x,j.aabb.maxy=Y.y;for(var K=j.gverts.next.next;null!=K;){var Q=K;Q.x<j.aabb.minx&&(j.aabb.minx=Q.x),Q.x>j.aabb.maxx&&(j.aabb.maxx=Q.x),Q.y<j.aabb.miny&&(j.aabb.miny=Q.y),Q.y>j.aabb.maxy&&(j.aabb.maxy=Q.y),K=K.next}}var ee;if(S.dyn==(1!=e.body.type&&!e.body.component.sleeping)){var te=S.aabb,ne=e.aabb;ee=!(ne.minx>=te.minx&&ne.miny>=te.miny&&ne.maxx<=te.maxx&&ne.maxy<=te.maxy)}else ee=!0;ee&&(S.synced=!0,S.snext=M.syncs,M.syncs=S)}}},t.space.ZPP_Broadphase.prototype.broadphase=function(e,t){},t.space.ZPP_Broadphase.prototype.clear=function(){},t.space.ZPP_Broadphase.prototype.shapesUnderPoint=function(e,t,n,i){return null},t.space.ZPP_Broadphase.prototype.bodiesUnderPoint=function(e,t,n,i){return null},t.space.ZPP_Broadphase.prototype.aabbShape=null,t.space.ZPP_Broadphase.prototype.matrix=null,t.space.ZPP_Broadphase.prototype.updateAABBShape=function(i){if(null==this.aabbShape){null==t.util.ZPP_Flags.BodyType_STATIC&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.BodyType_STATIC=new e.phys.BodyType,t.util.ZPP_Flags.internal=!1);var r=new e.phys.Body(t.util.ZPP_Flags.BodyType_STATIC).zpp_inner.wrap_shapes,o=this.aabbShape=new e.shape.Polygon(e.shape.Polygon.rect(i.minx,i.miny,i.maxx-i.minx,i.maxy-i.miny));r.zpp_inner.reverse_flag?r.push(o):r.unshift(o)}else{var a=this.aabbShape.zpp_inner.aabb,s=(i.maxx-i.minx)/(a.maxx-a.minx),l=(i.maxy-i.miny)/(a.maxy-a.miny);null==this.matrix&&(this.matrix=new e.geom.Mat23);var p=this.matrix;if(s!=s)throw new n._Boot.HaxeError("Error: Mat23::a cannot be NaN");p.zpp_inner.a=s;var u=p.zpp_inner;null!=u._invalidate&&u._invalidate();var h=this.matrix,c=this.matrix;c.zpp_inner.c=0;var _=c.zpp_inner;null!=_._invalidate&&_._invalidate();var d=c.zpp_inner.c;if(d!=d)throw new n._Boot.HaxeError("Error: Mat23::b cannot be NaN");h.zpp_inner.b=d;var m=h.zpp_inner;null!=m._invalidate&&m._invalidate();var P=this.matrix;if(l!=l)throw new n._Boot.HaxeError("Error: Mat23::d cannot be NaN");P.zpp_inner.d=l;var f=P.zpp_inner;null!=f._invalidate&&f._invalidate();var x=this.matrix,y=i.minx-s*a.minx;if(y!=y)throw new n._Boot.HaxeError("Error: Mat23::tx cannot be NaN");x.zpp_inner.tx=y;var v=x.zpp_inner;null!=v._invalidate&&v._invalidate();var g=this.matrix,b=i.miny-l*a.miny;if(b!=b)throw new n._Boot.HaxeError("Error: Mat23::ty cannot be NaN");g.zpp_inner.ty=b;var z=g.zpp_inner;null!=z._invalidate&&z._invalidate(),this.aabbShape.transform(this.matrix)}var w=this.aabbShape.zpp_inner;if(w.zip_aabb&&null!=w.body)if(w.zip_aabb=!1,0==w.type){var Z=w.circle;if(Z.zip_worldCOM&&null!=Z.body){if(Z.zip_worldCOM=!1,Z.zip_localCOM){if(Z.zip_localCOM=!1,1==Z.type){var E=Z.polygon;if(null==E.lverts.next)throw new n._Boot.HaxeError("Error: An empty polygon has no meaningful localCOM");if(null==E.lverts.next.next)E.localCOMx=E.lverts.next.x,E.localCOMy=E.lverts.next.y;else if(null==E.lverts.next.next.next)E.localCOMx=E.lverts.next.x,E.localCOMy=E.lverts.next.y,E.localCOMx+=1*E.lverts.next.next.x,E.localCOMy+=1*E.lverts.next.next.y,E.localCOMx*=.5,E.localCOMy*=.5;else{E.localCOMx=0,E.localCOMy=0;var M=0,S=E.lverts.next,C=S,N=S=S.next;for(S=S.next;null!=S;){var A=S;M+=N.x*(A.y-C.y);var L=A.y*N.x-A.x*N.y;E.localCOMx+=(N.x+A.x)*L,E.localCOMy+=(N.y+A.y)*L,C=N,N=A,S=S.next}var B=S=E.lverts.next;M+=N.x*(B.y-C.y);var T=B.y*N.x-B.x*N.y;E.localCOMx+=(N.x+B.x)*T,E.localCOMy+=(N.y+B.y)*T,C=N,N=B;var V=S=S.next;M+=N.x*(V.y-C.y);var k=V.y*N.x-V.x*N.y;E.localCOMx+=(N.x+V.x)*k,E.localCOMy+=(N.y+V.y)*k;var I=M=1/(3*M);E.localCOMx*=I,E.localCOMy*=I}}null!=Z.wrap_localCOM&&(Z.wrap_localCOM.zpp_inner.x=Z.localCOMx,Z.wrap_localCOM.zpp_inner.y=Z.localCOMy)}var O=Z.body;O.zip_axis&&(O.zip_axis=!1,O.axisx=Math.sin(O.rot),O.axisy=Math.cos(O.rot)),Z.worldCOMx=Z.body.posx+(Z.body.axisy*Z.localCOMx-Z.body.axisx*Z.localCOMy),Z.worldCOMy=Z.body.posy+(Z.localCOMx*Z.body.axisx+Z.localCOMy*Z.body.axisy)}var R=Z.radius,H=Z.radius;Z.aabb.minx=Z.worldCOMx-R,Z.aabb.miny=Z.worldCOMy-H,Z.aabb.maxx=Z.worldCOMx+R,Z.aabb.maxy=Z.worldCOMy+H}else{var F=w.polygon;if(F.zip_gverts&&null!=F.body){F.zip_gverts=!1,F.validate_lverts();var D=F.body;D.zip_axis&&(D.zip_axis=!1,D.axisx=Math.sin(D.rot),D.axisy=Math.cos(D.rot));for(var G=F.lverts.next,U=F.gverts.next;null!=U;){var j=U,W=G;G=G.next,j.x=F.body.posx+(F.body.axisy*W.x-F.body.axisx*W.y),j.y=F.body.posy+(W.x*F.body.axisx+W.y*F.body.axisy),U=U.next}}if(null==F.lverts.next)throw new n._Boot.HaxeError("Error: An empty polygon has no meaningful bounds");var q=F.gverts.next;F.aabb.minx=q.x,F.aabb.miny=q.y,F.aabb.maxx=q.x,F.aabb.maxy=q.y;for(var J=F.gverts.next.next;null!=J;){var $=J;$.x<F.aabb.minx&&(F.aabb.minx=$.x),$.x>F.aabb.maxx&&(F.aabb.maxx=$.x),$.y<F.aabb.miny&&(F.aabb.miny=$.y),$.y>F.aabb.maxy&&(F.aabb.maxy=$.y),J=J.next}}var X=this.aabbShape.zpp_inner.polygon;if(X.zip_gaxi&&null!=X.body){X.zip_gaxi=!1,X.validate_laxi();var Y=X.body;if(Y.zip_axis&&(Y.zip_axis=!1,Y.axisx=Math.sin(Y.rot),Y.axisy=Math.cos(Y.rot)),X.zip_gverts&&null!=X.body){X.zip_gverts=!1,X.validate_lverts();var K=X.body;K.zip_axis&&(K.zip_axis=!1,K.axisx=Math.sin(K.rot),K.axisy=Math.cos(K.rot));for(var Q=X.lverts.next,ee=X.gverts.next;null!=ee;){var te=ee,ne=Q;Q=Q.next,te.x=X.body.posx+(X.body.axisy*ne.x-X.body.axisx*ne.y),te.y=X.body.posy+(ne.x*X.body.axisx+ne.y*X.body.axisy),ee=ee.next}}var ie=X.edges.head,re=X.gverts.next,oe=re;for(re=re.next;null!=re;){var ae=re,se=ie.elt;ie=ie.next,se.gp0=oe,se.gp1=ae,se.gnormx=X.body.axisy*se.lnormx-X.body.axisx*se.lnormy,se.gnormy=se.lnormx*X.body.axisx+se.lnormy*X.body.axisy,se.gprojection=X.body.posx*se.gnormx+X.body.posy*se.gnormy+se.lprojection,null!=se.wrap_gnorm&&(se.wrap_gnorm.zpp_inner.x=se.gnormx,se.wrap_gnorm.zpp_inner.y=se.gnormy),se.tp0=se.gp0.y*se.gnormx-se.gp0.x*se.gnormy,se.tp1=se.gp1.y*se.gnormx-se.gp1.x*se.gnormy,oe=ae,re=re.next}var le=X.gverts.next,pe=ie.elt;ie=ie.next,pe.gp0=oe,pe.gp1=le,pe.gnormx=X.body.axisy*pe.lnormx-X.body.axisx*pe.lnormy,pe.gnormy=pe.lnormx*X.body.axisx+pe.lnormy*X.body.axisy,pe.gprojection=X.body.posx*pe.gnormx+X.body.posy*pe.gnormy+pe.lprojection,null!=pe.wrap_gnorm&&(pe.wrap_gnorm.zpp_inner.x=pe.gnormx,pe.wrap_gnorm.zpp_inner.y=pe.gnormy),pe.tp0=pe.gp0.y*pe.gnormx-pe.gp0.x*pe.gnormy,pe.tp1=pe.gp1.y*pe.gnormx-pe.gp1.x*pe.gnormy}},t.space.ZPP_Broadphase.prototype.shapesInAABB=function(e,t,n,i,r){return null},t.space.ZPP_Broadphase.prototype.bodiesInAABB=function(e,t,n,i,r){return null},t.space.ZPP_Broadphase.prototype.circShape=null,t.space.ZPP_Broadphase.prototype.updateCircShape=function(i,r,o){if(null==this.circShape){null==t.util.ZPP_Flags.BodyType_STATIC&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.BodyType_STATIC=new e.phys.BodyType,t.util.ZPP_Flags.internal=!1);var a,s=new e.phys.Body(t.util.ZPP_Flags.BodyType_STATIC).zpp_inner.wrap_shapes,l=i,p=r;if(null==p&&(p=0),null==l&&(l=0),l!=l||p!=p)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null==t.util.ZPP_PubPool.poolVec2?a=new e.geom.Vec2:(a=t.util.ZPP_PubPool.poolVec2,t.util.ZPP_PubPool.poolVec2=a.zpp_pool,a.zpp_pool=null,a.zpp_disp=!1,a==t.util.ZPP_PubPool.nextVec2&&(t.util.ZPP_PubPool.nextVec2=null)),null==a.zpp_inner){var u;null==t.geom.ZPP_Vec2.zpp_pool?u=new t.geom.ZPP_Vec2:(u=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=u.next,u.next=null),u.weak=!1,u._immutable=!1,u.x=l,u.y=p,a.zpp_inner=u,a.zpp_inner.outer=a}else{if(null!=a&&a.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var h,c=a.zpp_inner;if(c._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=c._isimmutable&&c._isimmutable(),l!=l||p!=p)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null!=a&&a.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var _=a.zpp_inner;if(null!=_._validate&&_._validate(),a.zpp_inner.x==l){if(null!=a&&a.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var d=a.zpp_inner;null!=d._validate&&d._validate(),h=a.zpp_inner.y==p}else h=!1;if(!h){a.zpp_inner.x=l,a.zpp_inner.y=p;var m=a.zpp_inner;null!=m._invalidate&&m._invalidate(m)}}a.zpp_inner.weak=!1;var P=this.circShape=new e.shape.Circle(o,a);s.zpp_inner.reverse_flag?s.push(P):s.unshift(P)}else{var f=this.circShape.zpp_inner.circle,x=o/f.radius;null==this.matrix&&(this.matrix=new e.geom.Mat23);var y=this.matrix,v=this.matrix;if(x!=x)throw new n._Boot.HaxeError("Error: Mat23::d cannot be NaN");v.zpp_inner.d=x;var g=v.zpp_inner;null!=g._invalidate&&g._invalidate();var b=v.zpp_inner.d;if(b!=b)throw new n._Boot.HaxeError("Error: Mat23::a cannot be NaN");y.zpp_inner.a=b;var z=y.zpp_inner;null!=z._invalidate&&z._invalidate();var w=this.matrix,Z=this.matrix;Z.zpp_inner.c=0;var E=Z.zpp_inner;null!=E._invalidate&&E._invalidate();var M=Z.zpp_inner.c;if(M!=M)throw new n._Boot.HaxeError("Error: Mat23::b cannot be NaN");w.zpp_inner.b=M;var S=w.zpp_inner;null!=S._invalidate&&S._invalidate();var C=this.matrix,N=i-x*f.localCOMx;if(N!=N)throw new n._Boot.HaxeError("Error: Mat23::tx cannot be NaN");C.zpp_inner.tx=N;var A=C.zpp_inner;null!=A._invalidate&&A._invalidate();var L=this.matrix,B=r-x*f.localCOMy;if(B!=B)throw new n._Boot.HaxeError("Error: Mat23::ty cannot be NaN");L.zpp_inner.ty=B;var T=L.zpp_inner;null!=T._invalidate&&T._invalidate(),this.circShape.transform(this.matrix)}var V=this.circShape.zpp_inner;if(V.zip_aabb&&null!=V.body)if(V.zip_aabb=!1,0==V.type){var k=V.circle;if(k.zip_worldCOM&&null!=k.body){if(k.zip_worldCOM=!1,k.zip_localCOM){if(k.zip_localCOM=!1,1==k.type){var I=k.polygon;if(null==I.lverts.next)throw new n._Boot.HaxeError("Error: An empty polygon has no meaningful localCOM");if(null==I.lverts.next.next)I.localCOMx=I.lverts.next.x,I.localCOMy=I.lverts.next.y;else if(null==I.lverts.next.next.next)I.localCOMx=I.lverts.next.x,I.localCOMy=I.lverts.next.y,I.localCOMx+=1*I.lverts.next.next.x,I.localCOMy+=1*I.lverts.next.next.y,I.localCOMx*=.5,I.localCOMy*=.5;else{I.localCOMx=0,I.localCOMy=0;var O=0,R=I.lverts.next,H=R,F=R=R.next;for(R=R.next;null!=R;){var D=R;O+=F.x*(D.y-H.y);var G=D.y*F.x-D.x*F.y;I.localCOMx+=(F.x+D.x)*G,I.localCOMy+=(F.y+D.y)*G,H=F,F=D,R=R.next}var U=R=I.lverts.next;O+=F.x*(U.y-H.y);var j=U.y*F.x-U.x*F.y;I.localCOMx+=(F.x+U.x)*j,I.localCOMy+=(F.y+U.y)*j,H=F,F=U;var W=R=R.next;O+=F.x*(W.y-H.y);var q=W.y*F.x-W.x*F.y;I.localCOMx+=(F.x+W.x)*q,I.localCOMy+=(F.y+W.y)*q;var J=O=1/(3*O);I.localCOMx*=J,I.localCOMy*=J}}null!=k.wrap_localCOM&&(k.wrap_localCOM.zpp_inner.x=k.localCOMx,k.wrap_localCOM.zpp_inner.y=k.localCOMy)}var $=k.body;$.zip_axis&&($.zip_axis=!1,$.axisx=Math.sin($.rot),$.axisy=Math.cos($.rot)),k.worldCOMx=k.body.posx+(k.body.axisy*k.localCOMx-k.body.axisx*k.localCOMy),k.worldCOMy=k.body.posy+(k.localCOMx*k.body.axisx+k.localCOMy*k.body.axisy)}var X=k.radius,Y=k.radius;k.aabb.minx=k.worldCOMx-X,k.aabb.miny=k.worldCOMy-Y,k.aabb.maxx=k.worldCOMx+X,k.aabb.maxy=k.worldCOMy+Y}else{var K=V.polygon;if(K.zip_gverts&&null!=K.body){K.zip_gverts=!1,K.validate_lverts();var Q=K.body;Q.zip_axis&&(Q.zip_axis=!1,Q.axisx=Math.sin(Q.rot),Q.axisy=Math.cos(Q.rot));for(var ee=K.lverts.next,te=K.gverts.next;null!=te;){var ne=te,ie=ee;ee=ee.next,ne.x=K.body.posx+(K.body.axisy*ie.x-K.body.axisx*ie.y),ne.y=K.body.posy+(ie.x*K.body.axisx+ie.y*K.body.axisy),te=te.next}}if(null==K.lverts.next)throw new n._Boot.HaxeError("Error: An empty polygon has no meaningful bounds");var re=K.gverts.next;K.aabb.minx=re.x,K.aabb.miny=re.y,K.aabb.maxx=re.x,K.aabb.maxy=re.y;for(var oe=K.gverts.next.next;null!=oe;){var ae=oe;ae.x<K.aabb.minx&&(K.aabb.minx=ae.x),ae.x>K.aabb.maxx&&(K.aabb.maxx=ae.x),ae.y<K.aabb.miny&&(K.aabb.miny=ae.y),ae.y>K.aabb.maxy&&(K.aabb.maxy=ae.y),oe=oe.next}}},t.space.ZPP_Broadphase.prototype.shapesInCircle=function(e,t,n,i,r,o){return null},t.space.ZPP_Broadphase.prototype.bodiesInCircle=function(e,t,n,i,r,o){return null},t.space.ZPP_Broadphase.prototype.validateShape=function(e){if(1==e.type){var t=e.polygon;if(t.zip_gaxi&&null!=t.body){t.zip_gaxi=!1,t.validate_laxi();var i=t.body;if(i.zip_axis&&(i.zip_axis=!1,i.axisx=Math.sin(i.rot),i.axisy=Math.cos(i.rot)),t.zip_gverts&&null!=t.body){t.zip_gverts=!1,t.validate_lverts();var r=t.body;r.zip_axis&&(r.zip_axis=!1,r.axisx=Math.sin(r.rot),r.axisy=Math.cos(r.rot));for(var o=t.lverts.next,a=t.gverts.next;null!=a;){var s=a,l=o;o=o.next,s.x=t.body.posx+(t.body.axisy*l.x-t.body.axisx*l.y),s.y=t.body.posy+(l.x*t.body.axisx+l.y*t.body.axisy),a=a.next}}var p=t.edges.head,u=t.gverts.next,h=u;for(u=u.next;null!=u;){var c=u,_=p.elt;p=p.next,_.gp0=h,_.gp1=c,_.gnormx=t.body.axisy*_.lnormx-t.body.axisx*_.lnormy,_.gnormy=_.lnormx*t.body.axisx+_.lnormy*t.body.axisy,_.gprojection=t.body.posx*_.gnormx+t.body.posy*_.gnormy+_.lprojection,null!=_.wrap_gnorm&&(_.wrap_gnorm.zpp_inner.x=_.gnormx,_.wrap_gnorm.zpp_inner.y=_.gnormy),_.tp0=_.gp0.y*_.gnormx-_.gp0.x*_.gnormy,_.tp1=_.gp1.y*_.gnormx-_.gp1.x*_.gnormy,h=c,u=u.next}var d=t.gverts.next,m=p.elt;p=p.next,m.gp0=h,m.gp1=d,m.gnormx=t.body.axisy*m.lnormx-t.body.axisx*m.lnormy,m.gnormy=m.lnormx*t.body.axisx+m.lnormy*t.body.axisy,m.gprojection=t.body.posx*m.gnormx+t.body.posy*m.gnormy+m.lprojection,null!=m.wrap_gnorm&&(m.wrap_gnorm.zpp_inner.x=m.gnormx,m.wrap_gnorm.zpp_inner.y=m.gnormy),m.tp0=m.gp0.y*m.gnormx-m.gp0.x*m.gnormy,m.tp1=m.gp1.y*m.gnormx-m.gp1.x*m.gnormy}}if(e.zip_aabb&&null!=e.body)if(e.zip_aabb=!1,0==e.type){var P=e.circle;if(P.zip_worldCOM&&null!=P.body){if(P.zip_worldCOM=!1,P.zip_localCOM){if(P.zip_localCOM=!1,1==P.type){var f=P.polygon;if(null==f.lverts.next)throw new n._Boot.HaxeError("Error: An empty polygon has no meaningful localCOM");if(null==f.lverts.next.next)f.localCOMx=f.lverts.next.x,f.localCOMy=f.lverts.next.y;else if(null==f.lverts.next.next.next)f.localCOMx=f.lverts.next.x,f.localCOMy=f.lverts.next.y,f.localCOMx+=1*f.lverts.next.next.x,f.localCOMy+=1*f.lverts.next.next.y,f.localCOMx*=.5,f.localCOMy*=.5;else{f.localCOMx=0,f.localCOMy=0;var x=0,y=f.lverts.next,v=y,g=y=y.next;for(y=y.next;null!=y;){var b=y;x+=g.x*(b.y-v.y);var z=b.y*g.x-b.x*g.y;f.localCOMx+=(g.x+b.x)*z,f.localCOMy+=(g.y+b.y)*z,v=g,g=b,y=y.next}var w=y=f.lverts.next;x+=g.x*(w.y-v.y);var Z=w.y*g.x-w.x*g.y;f.localCOMx+=(g.x+w.x)*Z,f.localCOMy+=(g.y+w.y)*Z,v=g,g=w;var E=y=y.next;x+=g.x*(E.y-v.y);var M=E.y*g.x-E.x*g.y;f.localCOMx+=(g.x+E.x)*M,f.localCOMy+=(g.y+E.y)*M;var S=x=1/(3*x);f.localCOMx*=S,f.localCOMy*=S}}null!=P.wrap_localCOM&&(P.wrap_localCOM.zpp_inner.x=P.localCOMx,P.wrap_localCOM.zpp_inner.y=P.localCOMy)}var C=P.body;C.zip_axis&&(C.zip_axis=!1,C.axisx=Math.sin(C.rot),C.axisy=Math.cos(C.rot)),P.worldCOMx=P.body.posx+(P.body.axisy*P.localCOMx-P.body.axisx*P.localCOMy),P.worldCOMy=P.body.posy+(P.localCOMx*P.body.axisx+P.localCOMy*P.body.axisy)}var N=P.radius,A=P.radius;P.aabb.minx=P.worldCOMx-N,P.aabb.miny=P.worldCOMy-A,P.aabb.maxx=P.worldCOMx+N,P.aabb.maxy=P.worldCOMy+A}else{var L=e.polygon;if(L.zip_gverts&&null!=L.body){L.zip_gverts=!1,L.validate_lverts();var B=L.body;B.zip_axis&&(B.zip_axis=!1,B.axisx=Math.sin(B.rot),B.axisy=Math.cos(B.rot));for(var T=L.lverts.next,V=L.gverts.next;null!=V;){var k=V,I=T;T=T.next,k.x=L.body.posx+(L.body.axisy*I.x-L.body.axisx*I.y),k.y=L.body.posy+(I.x*L.body.axisx+I.y*L.body.axisy),V=V.next}}if(null==L.lverts.next)throw new n._Boot.HaxeError("Error: An empty polygon has no meaningful bounds");var O=L.gverts.next;L.aabb.minx=O.x,L.aabb.miny=O.y,L.aabb.maxx=O.x,L.aabb.maxy=O.y;for(var R=L.gverts.next.next;null!=R;){var H=R;H.x<L.aabb.minx&&(L.aabb.minx=H.x),H.x>L.aabb.maxx&&(L.aabb.maxx=H.x),H.y<L.aabb.miny&&(L.aabb.miny=H.y),H.y>L.aabb.maxy&&(L.aabb.maxy=H.y),R=R.next}}if(e.zip_worldCOM&&null!=e.body){if(e.zip_worldCOM=!1,e.zip_localCOM){if(e.zip_localCOM=!1,1==e.type){var F=e.polygon;if(null==F.lverts.next)throw new n._Boot.HaxeError("Error: An empty polygon has no meaningful localCOM");if(null==F.lverts.next.next)F.localCOMx=F.lverts.next.x,F.localCOMy=F.lverts.next.y;else if(null==F.lverts.next.next.next)F.localCOMx=F.lverts.next.x,F.localCOMy=F.lverts.next.y,F.localCOMx+=1*F.lverts.next.next.x,F.localCOMy+=1*F.lverts.next.next.y,F.localCOMx*=.5,F.localCOMy*=.5;else{F.localCOMx=0,F.localCOMy=0;var D=0,G=F.lverts.next,U=G,j=G=G.next;for(G=G.next;null!=G;){var W=G;D+=j.x*(W.y-U.y);var q=W.y*j.x-W.x*j.y;F.localCOMx+=(j.x+W.x)*q,F.localCOMy+=(j.y+W.y)*q,U=j,j=W,G=G.next}var J=G=F.lverts.next;D+=j.x*(J.y-U.y);var $=J.y*j.x-J.x*j.y;F.localCOMx+=(j.x+J.x)*$,F.localCOMy+=(j.y+J.y)*$,U=j,j=J;var X=G=G.next;D+=j.x*(X.y-U.y);var Y=X.y*j.x-X.x*j.y;F.localCOMx+=(j.x+X.x)*Y,F.localCOMy+=(j.y+X.y)*Y;var K=D=1/(3*D);F.localCOMx*=K,F.localCOMy*=K}}null!=e.wrap_localCOM&&(e.wrap_localCOM.zpp_inner.x=e.localCOMx,e.wrap_localCOM.zpp_inner.y=e.localCOMy)}var Q=e.body;Q.zip_axis&&(Q.zip_axis=!1,Q.axisx=Math.sin(Q.rot),Q.axisy=Math.cos(Q.rot)),e.worldCOMx=e.body.posx+(e.body.axisy*e.localCOMx-e.body.axisx*e.localCOMy),e.worldCOMy=e.body.posy+(e.localCOMx*e.body.axisx+e.localCOMy*e.body.axisy)}},t.space.ZPP_Broadphase.prototype.shapesInShape=function(e,t,n,i){return null},t.space.ZPP_Broadphase.prototype.bodiesInShape=function(e,t,n,i){return null},t.space.ZPP_Broadphase.prototype.rayCast=function(e,t,n){return null},t.space.ZPP_Broadphase.prototype.rayMultiCast=function(e,t,n,i){return null},t.space.ZPP_Broadphase.prototype.__class__=t.space.ZPP_Broadphase,t.space.ZPP_AABBNode=l["zpp_nape.space.ZPP_AABBNode"]=function(){this.first_sync=!1,this.synced=!1,this.snext=null,this.moved=!1,this.mnext=null,this.next=null,this.rayt=0,this.height=0,this.child2=null,this.child1=null,this.parent=null,this.dyn=!1,this.shape=null,this.aabb=null,this.height=-1},t.space.ZPP_AABBNode.__name__=["zpp_nape","space","ZPP_AABBNode"],t.space.ZPP_AABBNode.prototype.aabb=null,t.space.ZPP_AABBNode.prototype.shape=null,t.space.ZPP_AABBNode.prototype.dyn=null,t.space.ZPP_AABBNode.prototype.parent=null,t.space.ZPP_AABBNode.prototype.child1=null,t.space.ZPP_AABBNode.prototype.child2=null,t.space.ZPP_AABBNode.prototype.height=null,t.space.ZPP_AABBNode.prototype.rayt=null,t.space.ZPP_AABBNode.prototype.next=null,t.space.ZPP_AABBNode.prototype.alloc=function(){null==t.geom.ZPP_AABB.zpp_pool?this.aabb=new t.geom.ZPP_AABB:(this.aabb=t.geom.ZPP_AABB.zpp_pool,t.geom.ZPP_AABB.zpp_pool=this.aabb.next,this.aabb.next=null),this.moved=!1,this.synced=!1,this.first_sync=!1},t.space.ZPP_AABBNode.prototype.free=function(){this.height=-1;var e=this.aabb;null!=e.outer&&(e.outer.zpp_inner=null,e.outer=null),e.wrap_min=e.wrap_max=null,e._invalidate=null,e._validate=null,e.next=t.geom.ZPP_AABB.zpp_pool,t.geom.ZPP_AABB.zpp_pool=e,this.child1=this.child2=this.parent=null,this.next=null,this.snext=null,this.mnext=null},t.space.ZPP_AABBNode.prototype.mnext=null,t.space.ZPP_AABBNode.prototype.moved=null,t.space.ZPP_AABBNode.prototype.snext=null,t.space.ZPP_AABBNode.prototype.synced=null,t.space.ZPP_AABBNode.prototype.first_sync=null,t.space.ZPP_AABBNode.prototype.isLeaf=function(){return null==this.child1},t.space.ZPP_AABBNode.prototype.__class__=t.space.ZPP_AABBNode,t.space.ZPP_AABBPair=l["zpp_nape.space.ZPP_AABBPair"]=function(){this.next=null,this.arb=null,this.di=0,this.id=0,this.sleeping=!1,this.first=!1,this.n2=null,this.n1=null},t.space.ZPP_AABBPair.__name__=["zpp_nape","space","ZPP_AABBPair"],t.space.ZPP_AABBPair.prototype.n1=null,t.space.ZPP_AABBPair.prototype.n2=null,t.space.ZPP_AABBPair.prototype.first=null,t.space.ZPP_AABBPair.prototype.sleeping=null,t.space.ZPP_AABBPair.prototype.id=null,t.space.ZPP_AABBPair.prototype.di=null,t.space.ZPP_AABBPair.prototype.arb=null,t.space.ZPP_AABBPair.prototype.next=null,t.space.ZPP_AABBPair.prototype.alloc=function(){},t.space.ZPP_AABBPair.prototype.free=function(){this.n1=this.n2=null,this.sleeping=!1},t.space.ZPP_AABBPair.prototype.__class__=t.space.ZPP_AABBPair,t.space.ZPP_AABBTree=l["zpp_nape.space.ZPP_AABBTree"]=function(){this.root=null},t.space.ZPP_AABBTree.__name__=["zpp_nape","space","ZPP_AABBTree"],t.space.ZPP_AABBTree.prototype.root=null,t.space.ZPP_AABBTree.prototype.clear=function(){if(null!=this.root){var e=null;for(this.root.next=e,e=this.root;null!=e;){var n=e;e=n.next,n.next=null;var i=n;null==i.child1?(i.shape.node=null,i.shape.removedFromSpace(),i.shape=null):(null!=i.child1&&(i.child1.next=e,e=i.child1),null!=i.child2&&(i.child2.next=e,e=i.child2));var r=i;r.height=-1;var o=r.aabb;null!=o.outer&&(o.outer.zpp_inner=null,o.outer=null),o.wrap_min=o.wrap_max=null,o._invalidate=null,o._validate=null,o.next=t.geom.ZPP_AABB.zpp_pool,t.geom.ZPP_AABB.zpp_pool=o,r.child1=r.child2=r.parent=null,r.next=null,r.snext=null,r.mnext=null,r.next=t.space.ZPP_AABBNode.zpp_pool,t.space.ZPP_AABBNode.zpp_pool=r}this.root=null}},t.space.ZPP_AABBTree.prototype.insertLeaf=function(e){if(null==this.root)this.root=e,this.root.parent=null;else{for(var n=e.aabb,i=this.root;null!=i.child1;){var r=i.child1,o=i.child2,a=i.aabb,s=2*(a.maxx-a.minx+(a.maxy-a.miny)),l=t.space.ZPP_AABBTree.tmpaabb,p=i.aabb;l.minx=p.minx<n.minx?p.minx:n.minx,l.miny=p.miny<n.miny?p.miny:n.miny,l.maxx=p.maxx>n.maxx?p.maxx:n.maxx,l.maxy=p.maxy>n.maxy?p.maxy:n.maxy;var u,h=t.space.ZPP_AABBTree.tmpaabb,c=2*(h.maxx-h.minx+(h.maxy-h.miny)),_=2*c,d=2*(c-s),m=t.space.ZPP_AABBTree.tmpaabb,P=r.aabb;if(m.minx=n.minx<P.minx?n.minx:P.minx,m.miny=n.miny<P.miny?n.miny:P.miny,m.maxx=n.maxx>P.maxx?n.maxx:P.maxx,m.maxy=n.maxy>P.maxy?n.maxy:P.maxy,null==r.child1){var f=t.space.ZPP_AABBTree.tmpaabb;u=2*(f.maxx-f.minx+(f.maxy-f.miny))+d}else{var x=r.aabb,y=2*(x.maxx-x.minx+(x.maxy-x.miny)),v=t.space.ZPP_AABBTree.tmpaabb;u=2*(v.maxx-v.minx+(v.maxy-v.miny))-y+d}var g,b=t.space.ZPP_AABBTree.tmpaabb,z=o.aabb;if(b.minx=n.minx<z.minx?n.minx:z.minx,b.miny=n.miny<z.miny?n.miny:z.miny,b.maxx=n.maxx>z.maxx?n.maxx:z.maxx,b.maxy=n.maxy>z.maxy?n.maxy:z.maxy,null==o.child1){var w=t.space.ZPP_AABBTree.tmpaabb;g=2*(w.maxx-w.minx+(w.maxy-w.miny))+d}else{var Z=o.aabb,E=2*(Z.maxx-Z.minx+(Z.maxy-Z.miny)),M=t.space.ZPP_AABBTree.tmpaabb;g=2*(M.maxx-M.minx+(M.maxy-M.miny))-E+d}if(_<u&&_<g)break;i=u<g?r:o}var S,C=i,N=C.parent;null==t.space.ZPP_AABBNode.zpp_pool?S=new t.space.ZPP_AABBNode:(S=t.space.ZPP_AABBNode.zpp_pool,t.space.ZPP_AABBNode.zpp_pool=S.next,S.next=null),null==t.geom.ZPP_AABB.zpp_pool?S.aabb=new t.geom.ZPP_AABB:(S.aabb=t.geom.ZPP_AABB.zpp_pool,t.geom.ZPP_AABB.zpp_pool=S.aabb.next,S.aabb.next=null),S.moved=!1,S.synced=!1,S.first_sync=!1,S.parent=N;var A=S.aabb,L=C.aabb;for(A.minx=n.minx<L.minx?n.minx:L.minx,A.miny=n.miny<L.miny?n.miny:L.miny,A.maxx=n.maxx>L.maxx?n.maxx:L.maxx,A.maxy=n.maxy>L.maxy?n.maxy:L.maxy,S.height=C.height+1,null!=N?(N.child1==C?N.child1=S:N.child2=S,S.child1=C,S.child2=e,C.parent=S,e.parent=S):(S.child1=C,S.child2=e,C.parent=S,e.parent=S,this.root=S),i=e.parent;null!=i;){if(null==i.child1||i.height<2)i=i;else{var B=i.child1,T=i.child2,V=T.height-B.height;if(V>1){var k=T.child1,I=T.child2;if(T.child1=i,T.parent=i.parent,i.parent=T,null!=T.parent?T.parent.child1==i?T.parent.child1=T:T.parent.child2=T:this.root=T,k.height>I.height){T.child2=k,i.child2=I,I.parent=i;var O=i.aabb,R=B.aabb,H=I.aabb;O.minx=R.minx<H.minx?R.minx:H.minx,O.miny=R.miny<H.miny?R.miny:H.miny,O.maxx=R.maxx>H.maxx?R.maxx:H.maxx,O.maxy=R.maxy>H.maxy?R.maxy:H.maxy;var F=T.aabb,D=i.aabb,G=k.aabb;F.minx=D.minx<G.minx?D.minx:G.minx,F.miny=D.miny<G.miny?D.miny:G.miny,F.maxx=D.maxx>G.maxx?D.maxx:G.maxx,F.maxy=D.maxy>G.maxy?D.maxy:G.maxy;var U=B.height,j=I.height;i.height=1+(U>j?U:j);var W=i.height,q=k.height;T.height=1+(W>q?W:q)}else{T.child2=I,i.child2=k,k.parent=i;var J=i.aabb,$=B.aabb,X=k.aabb;J.minx=$.minx<X.minx?$.minx:X.minx,J.miny=$.miny<X.miny?$.miny:X.miny,J.maxx=$.maxx>X.maxx?$.maxx:X.maxx,J.maxy=$.maxy>X.maxy?$.maxy:X.maxy;var Y=T.aabb,K=i.aabb,Q=I.aabb;Y.minx=K.minx<Q.minx?K.minx:Q.minx,Y.miny=K.miny<Q.miny?K.miny:Q.miny,Y.maxx=K.maxx>Q.maxx?K.maxx:Q.maxx,Y.maxy=K.maxy>Q.maxy?K.maxy:Q.maxy;var ee=B.height,te=k.height;i.height=1+(ee>te?ee:te);var ne=i.height,ie=I.height;T.height=1+(ne>ie?ne:ie)}i=T}else if(V<-1){var re=B.child1,oe=B.child2;if(B.child1=i,B.parent=i.parent,i.parent=B,null!=B.parent?B.parent.child1==i?B.parent.child1=B:B.parent.child2=B:this.root=B,re.height>oe.height){B.child2=re,i.child1=oe,oe.parent=i;var ae=i.aabb,se=T.aabb,le=oe.aabb;ae.minx=se.minx<le.minx?se.minx:le.minx,ae.miny=se.miny<le.miny?se.miny:le.miny,ae.maxx=se.maxx>le.maxx?se.maxx:le.maxx,ae.maxy=se.maxy>le.maxy?se.maxy:le.maxy;var pe=B.aabb,ue=i.aabb,he=re.aabb;pe.minx=ue.minx<he.minx?ue.minx:he.minx,pe.miny=ue.miny<he.miny?ue.miny:he.miny,pe.maxx=ue.maxx>he.maxx?ue.maxx:he.maxx,pe.maxy=ue.maxy>he.maxy?ue.maxy:he.maxy;var ce=T.height,_e=oe.height;i.height=1+(ce>_e?ce:_e);var de=i.height,me=re.height;B.height=1+(de>me?de:me)}else{B.child2=oe,i.child1=re,re.parent=i;var Pe=i.aabb,fe=T.aabb,xe=re.aabb;Pe.minx=fe.minx<xe.minx?fe.minx:xe.minx,Pe.miny=fe.miny<xe.miny?fe.miny:xe.miny,Pe.maxx=fe.maxx>xe.maxx?fe.maxx:xe.maxx,Pe.maxy=fe.maxy>xe.maxy?fe.maxy:xe.maxy;var ye=B.aabb,ve=i.aabb,ge=oe.aabb;ye.minx=ve.minx<ge.minx?ve.minx:ge.minx,ye.miny=ve.miny<ge.miny?ve.miny:ge.miny,ye.maxx=ve.maxx>ge.maxx?ve.maxx:ge.maxx,ye.maxy=ve.maxy>ge.maxy?ve.maxy:ge.maxy;var be=T.height,ze=re.height;i.height=1+(be>ze?be:ze);var we=i.height,Ze=oe.height;B.height=1+(we>Ze?we:Ze)}i=B}else i=i}var Ee=i.child1,Me=i.child2,Se=Ee.height,Ce=Me.height;i.height=1+(Se>Ce?Se:Ce);var Ne=i.aabb,Ae=Ee.aabb,Le=Me.aabb;Ne.minx=Ae.minx<Le.minx?Ae.minx:Le.minx,Ne.miny=Ae.miny<Le.miny?Ae.miny:Le.miny,Ne.maxx=Ae.maxx>Le.maxx?Ae.maxx:Le.maxx,Ne.maxy=Ae.maxy>Le.maxy?Ae.maxy:Le.maxy,i=i.parent}}},t.space.ZPP_AABBTree.prototype.inlined_insertLeaf=function(e){if(null==this.root)this.root=e,this.root.parent=null;else{for(var n=e.aabb,i=this.root;null!=i.child1;){var r=i.child1,o=i.child2,a=i.aabb,s=2*(a.maxx-a.minx+(a.maxy-a.miny)),l=t.space.ZPP_AABBTree.tmpaabb,p=i.aabb;l.minx=p.minx<n.minx?p.minx:n.minx,l.miny=p.miny<n.miny?p.miny:n.miny,l.maxx=p.maxx>n.maxx?p.maxx:n.maxx,l.maxy=p.maxy>n.maxy?p.maxy:n.maxy;var u,h=t.space.ZPP_AABBTree.tmpaabb,c=2*(h.maxx-h.minx+(h.maxy-h.miny)),_=2*c,d=2*(c-s),m=t.space.ZPP_AABBTree.tmpaabb,P=r.aabb;if(m.minx=n.minx<P.minx?n.minx:P.minx,m.miny=n.miny<P.miny?n.miny:P.miny,m.maxx=n.maxx>P.maxx?n.maxx:P.maxx,m.maxy=n.maxy>P.maxy?n.maxy:P.maxy,null==r.child1){var f=t.space.ZPP_AABBTree.tmpaabb;u=2*(f.maxx-f.minx+(f.maxy-f.miny))+d}else{var x=r.aabb,y=2*(x.maxx-x.minx+(x.maxy-x.miny)),v=t.space.ZPP_AABBTree.tmpaabb;u=2*(v.maxx-v.minx+(v.maxy-v.miny))-y+d}var g,b=t.space.ZPP_AABBTree.tmpaabb,z=o.aabb;if(b.minx=n.minx<z.minx?n.minx:z.minx,b.miny=n.miny<z.miny?n.miny:z.miny,b.maxx=n.maxx>z.maxx?n.maxx:z.maxx,b.maxy=n.maxy>z.maxy?n.maxy:z.maxy,null==o.child1){var w=t.space.ZPP_AABBTree.tmpaabb;g=2*(w.maxx-w.minx+(w.maxy-w.miny))+d}else{var Z=o.aabb,E=2*(Z.maxx-Z.minx+(Z.maxy-Z.miny)),M=t.space.ZPP_AABBTree.tmpaabb;g=2*(M.maxx-M.minx+(M.maxy-M.miny))-E+d}if(_<u&&_<g)break;i=u<g?r:o}var S,C=i,N=C.parent;null==t.space.ZPP_AABBNode.zpp_pool?S=new t.space.ZPP_AABBNode:(S=t.space.ZPP_AABBNode.zpp_pool,t.space.ZPP_AABBNode.zpp_pool=S.next,S.next=null),null==t.geom.ZPP_AABB.zpp_pool?S.aabb=new t.geom.ZPP_AABB:(S.aabb=t.geom.ZPP_AABB.zpp_pool,t.geom.ZPP_AABB.zpp_pool=S.aabb.next,S.aabb.next=null),S.moved=!1,S.synced=!1,S.first_sync=!1,S.parent=N;var A=S.aabb,L=C.aabb;for(A.minx=n.minx<L.minx?n.minx:L.minx,A.miny=n.miny<L.miny?n.miny:L.miny,A.maxx=n.maxx>L.maxx?n.maxx:L.maxx,A.maxy=n.maxy>L.maxy?n.maxy:L.maxy,S.height=C.height+1,null!=N?(N.child1==C?N.child1=S:N.child2=S,S.child1=C,S.child2=e,C.parent=S,e.parent=S):(S.child1=C,S.child2=e,C.parent=S,e.parent=S,this.root=S),i=e.parent;null!=i;){if(null==i.child1||i.height<2)i=i;else{var B=i.child1,T=i.child2,V=T.height-B.height;if(V>1){var k=T.child1,I=T.child2;if(T.child1=i,T.parent=i.parent,i.parent=T,null!=T.parent?T.parent.child1==i?T.parent.child1=T:T.parent.child2=T:this.root=T,k.height>I.height){T.child2=k,i.child2=I,I.parent=i;var O=i.aabb,R=B.aabb,H=I.aabb;O.minx=R.minx<H.minx?R.minx:H.minx,O.miny=R.miny<H.miny?R.miny:H.miny,O.maxx=R.maxx>H.maxx?R.maxx:H.maxx,O.maxy=R.maxy>H.maxy?R.maxy:H.maxy;var F=T.aabb,D=i.aabb,G=k.aabb;F.minx=D.minx<G.minx?D.minx:G.minx,F.miny=D.miny<G.miny?D.miny:G.miny,F.maxx=D.maxx>G.maxx?D.maxx:G.maxx,F.maxy=D.maxy>G.maxy?D.maxy:G.maxy;var U=B.height,j=I.height;i.height=1+(U>j?U:j);var W=i.height,q=k.height;T.height=1+(W>q?W:q)}else{T.child2=I,i.child2=k,k.parent=i;var J=i.aabb,$=B.aabb,X=k.aabb;J.minx=$.minx<X.minx?$.minx:X.minx,J.miny=$.miny<X.miny?$.miny:X.miny,J.maxx=$.maxx>X.maxx?$.maxx:X.maxx,J.maxy=$.maxy>X.maxy?$.maxy:X.maxy;var Y=T.aabb,K=i.aabb,Q=I.aabb;Y.minx=K.minx<Q.minx?K.minx:Q.minx,Y.miny=K.miny<Q.miny?K.miny:Q.miny,Y.maxx=K.maxx>Q.maxx?K.maxx:Q.maxx,Y.maxy=K.maxy>Q.maxy?K.maxy:Q.maxy;var ee=B.height,te=k.height;i.height=1+(ee>te?ee:te);var ne=i.height,ie=I.height;T.height=1+(ne>ie?ne:ie)}i=T}else if(V<-1){var re=B.child1,oe=B.child2;if(B.child1=i,B.parent=i.parent,i.parent=B,null!=B.parent?B.parent.child1==i?B.parent.child1=B:B.parent.child2=B:this.root=B,re.height>oe.height){B.child2=re,i.child1=oe,oe.parent=i;var ae=i.aabb,se=T.aabb,le=oe.aabb;ae.minx=se.minx<le.minx?se.minx:le.minx,ae.miny=se.miny<le.miny?se.miny:le.miny,ae.maxx=se.maxx>le.maxx?se.maxx:le.maxx,ae.maxy=se.maxy>le.maxy?se.maxy:le.maxy;var pe=B.aabb,ue=i.aabb,he=re.aabb;pe.minx=ue.minx<he.minx?ue.minx:he.minx,pe.miny=ue.miny<he.miny?ue.miny:he.miny,pe.maxx=ue.maxx>he.maxx?ue.maxx:he.maxx,pe.maxy=ue.maxy>he.maxy?ue.maxy:he.maxy;var ce=T.height,_e=oe.height;i.height=1+(ce>_e?ce:_e);var de=i.height,me=re.height;B.height=1+(de>me?de:me)}else{B.child2=oe,i.child1=re,re.parent=i;var Pe=i.aabb,fe=T.aabb,xe=re.aabb;Pe.minx=fe.minx<xe.minx?fe.minx:xe.minx,Pe.miny=fe.miny<xe.miny?fe.miny:xe.miny,Pe.maxx=fe.maxx>xe.maxx?fe.maxx:xe.maxx,Pe.maxy=fe.maxy>xe.maxy?fe.maxy:xe.maxy;var ye=B.aabb,ve=i.aabb,ge=oe.aabb;ye.minx=ve.minx<ge.minx?ve.minx:ge.minx,ye.miny=ve.miny<ge.miny?ve.miny:ge.miny,ye.maxx=ve.maxx>ge.maxx?ve.maxx:ge.maxx,ye.maxy=ve.maxy>ge.maxy?ve.maxy:ge.maxy;var be=T.height,ze=re.height;i.height=1+(be>ze?be:ze);var we=i.height,Ze=oe.height;B.height=1+(we>Ze?we:Ze)}i=B}else i=i}var Ee=i.child1,Me=i.child2,Se=Ee.height,Ce=Me.height;i.height=1+(Se>Ce?Se:Ce);var Ne=i.aabb,Ae=Ee.aabb,Le=Me.aabb;Ne.minx=Ae.minx<Le.minx?Ae.minx:Le.minx,Ne.miny=Ae.miny<Le.miny?Ae.miny:Le.miny,Ne.maxx=Ae.maxx>Le.maxx?Ae.maxx:Le.maxx,Ne.maxy=Ae.maxy>Le.maxy?Ae.maxy:Le.maxy,i=i.parent}}},t.space.ZPP_AABBTree.prototype.removeLeaf=function(e){if(e==this.root)this.root=null;else{var n=e.parent,i=n.parent,r=n.child1==e?n.child2:n.child1;if(null!=i){i.child1==n?i.child1=r:i.child2=r,r.parent=i;var o=n;o.height=-1;var a=o.aabb;null!=a.outer&&(a.outer.zpp_inner=null,a.outer=null),a.wrap_min=a.wrap_max=null,a._invalidate=null,a._validate=null,a.next=t.geom.ZPP_AABB.zpp_pool,t.geom.ZPP_AABB.zpp_pool=a,o.child1=o.child2=o.parent=null,o.next=null,o.snext=null,o.mnext=null,o.next=t.space.ZPP_AABBNode.zpp_pool,t.space.ZPP_AABBNode.zpp_pool=o;for(var s=i;null!=s;){if(null==s.child1||s.height<2)s=s;else{var l=s.child1,p=s.child2,u=p.height-l.height;if(u>1){var h=p.child1,c=p.child2;if(p.child1=s,p.parent=s.parent,s.parent=p,null!=p.parent?p.parent.child1==s?p.parent.child1=p:p.parent.child2=p:this.root=p,h.height>c.height){p.child2=h,s.child2=c,c.parent=s;var _=s.aabb,d=l.aabb,m=c.aabb;_.minx=d.minx<m.minx?d.minx:m.minx,_.miny=d.miny<m.miny?d.miny:m.miny,_.maxx=d.maxx>m.maxx?d.maxx:m.maxx,_.maxy=d.maxy>m.maxy?d.maxy:m.maxy;var P=p.aabb,f=s.aabb,x=h.aabb;P.minx=f.minx<x.minx?f.minx:x.minx,P.miny=f.miny<x.miny?f.miny:x.miny,P.maxx=f.maxx>x.maxx?f.maxx:x.maxx,P.maxy=f.maxy>x.maxy?f.maxy:x.maxy;var y=l.height,v=c.height;s.height=1+(y>v?y:v);var g=s.height,b=h.height;p.height=1+(g>b?g:b)}else{p.child2=c,s.child2=h,h.parent=s;var z=s.aabb,w=l.aabb,Z=h.aabb;z.minx=w.minx<Z.minx?w.minx:Z.minx,z.miny=w.miny<Z.miny?w.miny:Z.miny,z.maxx=w.maxx>Z.maxx?w.maxx:Z.maxx,z.maxy=w.maxy>Z.maxy?w.maxy:Z.maxy;var E=p.aabb,M=s.aabb,S=c.aabb;E.minx=M.minx<S.minx?M.minx:S.minx,E.miny=M.miny<S.miny?M.miny:S.miny,E.maxx=M.maxx>S.maxx?M.maxx:S.maxx,E.maxy=M.maxy>S.maxy?M.maxy:S.maxy;var C=l.height,N=h.height;s.height=1+(C>N?C:N);var A=s.height,L=c.height;p.height=1+(A>L?A:L)}s=p}else if(u<-1){var B=l.child1,T=l.child2;if(l.child1=s,l.parent=s.parent,s.parent=l,null!=l.parent?l.parent.child1==s?l.parent.child1=l:l.parent.child2=l:this.root=l,B.height>T.height){l.child2=B,s.child1=T,T.parent=s;var V=s.aabb,k=p.aabb,I=T.aabb;V.minx=k.minx<I.minx?k.minx:I.minx,V.miny=k.miny<I.miny?k.miny:I.miny,V.maxx=k.maxx>I.maxx?k.maxx:I.maxx,V.maxy=k.maxy>I.maxy?k.maxy:I.maxy;var O=l.aabb,R=s.aabb,H=B.aabb;O.minx=R.minx<H.minx?R.minx:H.minx,O.miny=R.miny<H.miny?R.miny:H.miny,O.maxx=R.maxx>H.maxx?R.maxx:H.maxx,O.maxy=R.maxy>H.maxy?R.maxy:H.maxy;var F=p.height,D=T.height;s.height=1+(F>D?F:D);var G=s.height,U=B.height;l.height=1+(G>U?G:U)}else{l.child2=T,s.child1=B,B.parent=s;var j=s.aabb,W=p.aabb,q=B.aabb;j.minx=W.minx<q.minx?W.minx:q.minx,j.miny=W.miny<q.miny?W.miny:q.miny,j.maxx=W.maxx>q.maxx?W.maxx:q.maxx,j.maxy=W.maxy>q.maxy?W.maxy:q.maxy;var J=l.aabb,$=s.aabb,X=T.aabb;J.minx=$.minx<X.minx?$.minx:X.minx,J.miny=$.miny<X.miny?$.miny:X.miny,J.maxx=$.maxx>X.maxx?$.maxx:X.maxx,J.maxy=$.maxy>X.maxy?$.maxy:X.maxy;var Y=p.height,K=B.height;s.height=1+(Y>K?Y:K);var Q=s.height,ee=T.height;l.height=1+(Q>ee?Q:ee)}s=l}else s=s}var te=s.child1,ne=s.child2,ie=s.aabb,re=te.aabb,oe=ne.aabb;ie.minx=re.minx<oe.minx?re.minx:oe.minx,ie.miny=re.miny<oe.miny?re.miny:oe.miny,ie.maxx=re.maxx>oe.maxx?re.maxx:oe.maxx,ie.maxy=re.maxy>oe.maxy?re.maxy:oe.maxy;var ae=te.height,se=ne.height;s.height=1+(ae>se?ae:se),s=s.parent}}else{this.root=r,r.parent=null;var le=n;le.height=-1;var pe=le.aabb;null!=pe.outer&&(pe.outer.zpp_inner=null,pe.outer=null),pe.wrap_min=pe.wrap_max=null,pe._invalidate=null,pe._validate=null,pe.next=t.geom.ZPP_AABB.zpp_pool,t.geom.ZPP_AABB.zpp_pool=pe,le.child1=le.child2=le.parent=null,le.next=null,le.snext=null,le.mnext=null,le.next=t.space.ZPP_AABBNode.zpp_pool,t.space.ZPP_AABBNode.zpp_pool=le}}},t.space.ZPP_AABBTree.prototype.inlined_removeLeaf=function(e){if(e!=this.root){var n=e.parent,i=n.parent,r=n.child1==e?n.child2:n.child1;if(null!=i){i.child1==n?i.child1=r:i.child2=r,r.parent=i;var o=n;o.height=-1;var a=o.aabb;null!=a.outer&&(a.outer.zpp_inner=null,a.outer=null),a.wrap_min=a.wrap_max=null,a._invalidate=null,a._validate=null,a.next=t.geom.ZPP_AABB.zpp_pool,t.geom.ZPP_AABB.zpp_pool=a,o.child1=o.child2=o.parent=null,o.next=null,o.snext=null,o.mnext=null,o.next=t.space.ZPP_AABBNode.zpp_pool,t.space.ZPP_AABBNode.zpp_pool=o;for(var s=i;null!=s;){if(null==s.child1||s.height<2)s=s;else{var l=s.child1,p=s.child2,u=p.height-l.height;if(u>1){var h=p.child1,c=p.child2;if(p.child1=s,p.parent=s.parent,s.parent=p,null!=p.parent?p.parent.child1==s?p.parent.child1=p:p.parent.child2=p:this.root=p,h.height>c.height){p.child2=h,s.child2=c,c.parent=s;var _=s.aabb,d=l.aabb,m=c.aabb;_.minx=d.minx<m.minx?d.minx:m.minx,_.miny=d.miny<m.miny?d.miny:m.miny,_.maxx=d.maxx>m.maxx?d.maxx:m.maxx,_.maxy=d.maxy>m.maxy?d.maxy:m.maxy;var P=p.aabb,f=s.aabb,x=h.aabb;P.minx=f.minx<x.minx?f.minx:x.minx,P.miny=f.miny<x.miny?f.miny:x.miny,P.maxx=f.maxx>x.maxx?f.maxx:x.maxx,P.maxy=f.maxy>x.maxy?f.maxy:x.maxy;var y=l.height,v=c.height;s.height=1+(y>v?y:v);var g=s.height,b=h.height;p.height=1+(g>b?g:b)}else{p.child2=c,s.child2=h,h.parent=s;var z=s.aabb,w=l.aabb,Z=h.aabb;z.minx=w.minx<Z.minx?w.minx:Z.minx,z.miny=w.miny<Z.miny?w.miny:Z.miny,z.maxx=w.maxx>Z.maxx?w.maxx:Z.maxx,z.maxy=w.maxy>Z.maxy?w.maxy:Z.maxy;var E=p.aabb,M=s.aabb,S=c.aabb;E.minx=M.minx<S.minx?M.minx:S.minx,E.miny=M.miny<S.miny?M.miny:S.miny,E.maxx=M.maxx>S.maxx?M.maxx:S.maxx,E.maxy=M.maxy>S.maxy?M.maxy:S.maxy;var C=l.height,N=h.height;s.height=1+(C>N?C:N);var A=s.height,L=c.height;p.height=1+(A>L?A:L)}s=p}else if(u<-1){var B=l.child1,T=l.child2;if(l.child1=s,l.parent=s.parent,s.parent=l,null!=l.parent?l.parent.child1==s?l.parent.child1=l:l.parent.child2=l:this.root=l,B.height>T.height){l.child2=B,s.child1=T,T.parent=s;var V=s.aabb,k=p.aabb,I=T.aabb;V.minx=k.minx<I.minx?k.minx:I.minx,V.miny=k.miny<I.miny?k.miny:I.miny,V.maxx=k.maxx>I.maxx?k.maxx:I.maxx,V.maxy=k.maxy>I.maxy?k.maxy:I.maxy;var O=l.aabb,R=s.aabb,H=B.aabb;O.minx=R.minx<H.minx?R.minx:H.minx,O.miny=R.miny<H.miny?R.miny:H.miny,O.maxx=R.maxx>H.maxx?R.maxx:H.maxx,O.maxy=R.maxy>H.maxy?R.maxy:H.maxy;var F=p.height,D=T.height;s.height=1+(F>D?F:D);var G=s.height,U=B.height;l.height=1+(G>U?G:U)}else{l.child2=T,s.child1=B,B.parent=s;var j=s.aabb,W=p.aabb,q=B.aabb;j.minx=W.minx<q.minx?W.minx:q.minx,j.miny=W.miny<q.miny?W.miny:q.miny,j.maxx=W.maxx>q.maxx?W.maxx:q.maxx,j.maxy=W.maxy>q.maxy?W.maxy:q.maxy;var J=l.aabb,$=s.aabb,X=T.aabb;J.minx=$.minx<X.minx?$.minx:X.minx,J.miny=$.miny<X.miny?$.miny:X.miny,J.maxx=$.maxx>X.maxx?$.maxx:X.maxx,J.maxy=$.maxy>X.maxy?$.maxy:X.maxy;var Y=p.height,K=B.height;s.height=1+(Y>K?Y:K);var Q=s.height,ee=T.height;l.height=1+(Q>ee?Q:ee)}s=l}else s=s}var te=s.child1,ne=s.child2,ie=s.aabb,re=te.aabb,oe=ne.aabb;ie.minx=re.minx<oe.minx?re.minx:oe.minx,ie.miny=re.miny<oe.miny?re.miny:oe.miny,ie.maxx=re.maxx>oe.maxx?re.maxx:oe.maxx,ie.maxy=re.maxy>oe.maxy?re.maxy:oe.maxy;var ae=te.height,se=ne.height;s.height=1+(ae>se?ae:se),s=s.parent}}else{this.root=r,r.parent=null;var le=n;le.height=-1;var pe=le.aabb;null!=pe.outer&&(pe.outer.zpp_inner=null,pe.outer=null),pe.wrap_min=pe.wrap_max=null,pe._invalidate=null,pe._validate=null,pe.next=t.geom.ZPP_AABB.zpp_pool,t.geom.ZPP_AABB.zpp_pool=pe,le.child1=le.child2=le.parent=null,le.next=null,le.snext=null,le.mnext=null,le.next=t.space.ZPP_AABBNode.zpp_pool,t.space.ZPP_AABBNode.zpp_pool=le}}else this.root=null},t.space.ZPP_AABBTree.prototype.balance=function(e){if(null==e.child1||e.height<2)return e;var t=e.child1,n=e.child2,i=n.height-t.height;if(i>1){var r=n.child1,o=n.child2;if(n.child1=e,n.parent=e.parent,e.parent=n,null!=n.parent?n.parent.child1==e?n.parent.child1=n:n.parent.child2=n:this.root=n,r.height>o.height){n.child2=r,e.child2=o,o.parent=e;var a=e.aabb,s=t.aabb,l=o.aabb;a.minx=s.minx<l.minx?s.minx:l.minx,a.miny=s.miny<l.miny?s.miny:l.miny,a.maxx=s.maxx>l.maxx?s.maxx:l.maxx,a.maxy=s.maxy>l.maxy?s.maxy:l.maxy;var p=n.aabb,u=e.aabb,h=r.aabb;p.minx=u.minx<h.minx?u.minx:h.minx,p.miny=u.miny<h.miny?u.miny:h.miny,p.maxx=u.maxx>h.maxx?u.maxx:h.maxx,p.maxy=u.maxy>h.maxy?u.maxy:h.maxy;var c=t.height,_=o.height;e.height=1+(c>_?c:_);var d=e.height,m=r.height;n.height=1+(d>m?d:m)}else{n.child2=o,e.child2=r,r.parent=e;var P=e.aabb,f=t.aabb,x=r.aabb;P.minx=f.minx<x.minx?f.minx:x.minx,P.miny=f.miny<x.miny?f.miny:x.miny,P.maxx=f.maxx>x.maxx?f.maxx:x.maxx,P.maxy=f.maxy>x.maxy?f.maxy:x.maxy;var y=n.aabb,v=e.aabb,g=o.aabb;y.minx=v.minx<g.minx?v.minx:g.minx,y.miny=v.miny<g.miny?v.miny:g.miny,y.maxx=v.maxx>g.maxx?v.maxx:g.maxx,y.maxy=v.maxy>g.maxy?v.maxy:g.maxy;var b=t.height,z=r.height;e.height=1+(b>z?b:z);var w=e.height,Z=o.height;n.height=1+(w>Z?w:Z)}return n}if(i<-1){var E=t.child1,M=t.child2;if(t.child1=e,t.parent=e.parent,e.parent=t,null!=t.parent?t.parent.child1==e?t.parent.child1=t:t.parent.child2=t:this.root=t,E.height>M.height){t.child2=E,e.child1=M,M.parent=e;var S=e.aabb,C=n.aabb,N=M.aabb;S.minx=C.minx<N.minx?C.minx:N.minx,S.miny=C.miny<N.miny?C.miny:N.miny,S.maxx=C.maxx>N.maxx?C.maxx:N.maxx,S.maxy=C.maxy>N.maxy?C.maxy:N.maxy;var A=t.aabb,L=e.aabb,B=E.aabb;A.minx=L.minx<B.minx?L.minx:B.minx,A.miny=L.miny<B.miny?L.miny:B.miny,A.maxx=L.maxx>B.maxx?L.maxx:B.maxx,A.maxy=L.maxy>B.maxy?L.maxy:B.maxy;var T=n.height,V=M.height;e.height=1+(T>V?T:V);var k=e.height,I=E.height;t.height=1+(k>I?k:I)}else{t.child2=M,e.child1=E,E.parent=e;var O=e.aabb,R=n.aabb,H=E.aabb;O.minx=R.minx<H.minx?R.minx:H.minx,O.miny=R.miny<H.miny?R.miny:H.miny,O.maxx=R.maxx>H.maxx?R.maxx:H.maxx,O.maxy=R.maxy>H.maxy?R.maxy:H.maxy;var F=t.aabb,D=e.aabb,G=M.aabb;F.minx=D.minx<G.minx?D.minx:G.minx,F.miny=D.miny<G.miny?D.miny:G.miny,F.maxx=D.maxx>G.maxx?D.maxx:G.maxx,F.maxy=D.maxy>G.maxy?D.maxy:G.maxy;var U=n.height,j=E.height;e.height=1+(U>j?U:j);var W=e.height,q=M.height;t.height=1+(W>q?W:q)}return t}return e},t.space.ZPP_AABBTree.prototype.__class__=t.space.ZPP_AABBTree,t.space.ZPP_DynAABBPhase=l["zpp_nape.space.ZPP_DynAABBPhase"]=function(e){this.openlist=null,this.failed=null,this.treeStack2=null,this.treeStack=null,this.moves=null,this.syncs=null,this.pairs=null,this.dtree=null,this.stree=null,t.space.ZPP_Broadphase.call(this),this.space=e,this.is_sweep=!1,this.dynab=this,this.stree=new t.space.ZPP_AABBTree,this.dtree=new t.space.ZPP_AABBTree},t.space.ZPP_DynAABBPhase.__name__=["zpp_nape","space","ZPP_DynAABBPhase"],t.space.ZPP_DynAABBPhase.__super__=t.space.ZPP_Broadphase,t.space.ZPP_Broadphase.prototype)t.space.ZPP_DynAABBPhase.prototype[u]=t.space.ZPP_Broadphase.prototype[u];for(var u in t.space.ZPP_DynAABBPhase.prototype.stree=null,t.space.ZPP_DynAABBPhase.prototype.dtree=null,t.space.ZPP_DynAABBPhase.prototype.pairs=null,t.space.ZPP_DynAABBPhase.prototype.syncs=null,t.space.ZPP_DynAABBPhase.prototype.moves=null,t.space.ZPP_DynAABBPhase.prototype.dyn=function(e){return 1!=e.body.type&&!e.body.component.sleeping},t.space.ZPP_DynAABBPhase.prototype.__insert=function(e){var n;null==t.space.ZPP_AABBNode.zpp_pool?n=new t.space.ZPP_AABBNode:(n=t.space.ZPP_AABBNode.zpp_pool,t.space.ZPP_AABBNode.zpp_pool=n.next,n.next=null),null==t.geom.ZPP_AABB.zpp_pool?n.aabb=new t.geom.ZPP_AABB:(n.aabb=t.geom.ZPP_AABB.zpp_pool,t.geom.ZPP_AABB.zpp_pool=n.aabb.next,n.aabb.next=null),n.moved=!1,n.synced=!1,n.first_sync=!1,n.shape=e,e.node=n,n.synced=!0,n.first_sync=!0,n.snext=this.syncs,this.syncs=n},t.space.ZPP_DynAABBPhase.prototype.__remove=function(e){var n=e.node;if(n.first_sync||(n.dyn?this.dtree.removeLeaf(n):this.stree.removeLeaf(n)),e.node=null,n.synced){for(var i=null,r=this.syncs;null!=r&&r!=n;)i=r,r=r.snext;null==i?this.syncs=r.snext:i.snext=r.snext,r.snext=null,n.synced=!1}if(n.moved){for(var o=null,a=this.moves;null!=a&&a!=n;)o=a,a=a.mnext;null==o?this.moves=a.mnext:o.mnext=a.mnext,a.mnext=null,n.moved=!1}for(var s=null,l=this.pairs;null!=l;){var p=l.next;if(l.n1!=n&&l.n2!=n)s=l,l=p;else{null==s?this.pairs=p:s.next=p,null!=l.arb&&(l.arb.pair=null),l.arb=null,l.n1.shape.pairs.remove(l),l.n2.shape.pairs.remove(l);var u=l;u.n1=u.n2=null,u.sleeping=!1,u.next=t.space.ZPP_AABBPair.zpp_pool,t.space.ZPP_AABBPair.zpp_pool=u,l=p}}for(;null!=e.pairs.head;){var h=e.pairs.pop_unsafe();h.n1==n?h.n2.shape.pairs.remove(h):h.n1.shape.pairs.remove(h),null!=h.arb&&(h.arb.pair=null),h.arb=null;var c=h;c.n1=c.n2=null,c.sleeping=!1,c.next=t.space.ZPP_AABBPair.zpp_pool,t.space.ZPP_AABBPair.zpp_pool=c}var _=n;_.height=-1;var d=_.aabb;null!=d.outer&&(d.outer.zpp_inner=null,d.outer=null),d.wrap_min=d.wrap_max=null,d._invalidate=null,d._validate=null,d.next=t.geom.ZPP_AABB.zpp_pool,t.geom.ZPP_AABB.zpp_pool=d,_.child1=_.child2=_.parent=null,_.next=null,_.snext=null,_.mnext=null,_.next=t.space.ZPP_AABBNode.zpp_pool,t.space.ZPP_AABBNode.zpp_pool=_},t.space.ZPP_DynAABBPhase.prototype.__sync=function(e){var t=e.node;if(!t.synced){if(!this.space.continuous&&e.zip_aabb&&null!=e.body)if(e.zip_aabb=!1,0==e.type){var i=e.circle;if(i.zip_worldCOM&&null!=i.body){if(i.zip_worldCOM=!1,i.zip_localCOM){if(i.zip_localCOM=!1,1==i.type){var r=i.polygon;if(null==r.lverts.next)throw new n._Boot.HaxeError("Error: An empty polygon has no meaningful localCOM");if(null==r.lverts.next.next)r.localCOMx=r.lverts.next.x,r.localCOMy=r.lverts.next.y;else if(null==r.lverts.next.next.next)r.localCOMx=r.lverts.next.x,r.localCOMy=r.lverts.next.y,r.localCOMx+=1*r.lverts.next.next.x,r.localCOMy+=1*r.lverts.next.next.y,r.localCOMx*=.5,r.localCOMy*=.5;else{r.localCOMx=0,r.localCOMy=0;var o=0,a=r.lverts.next,s=a,l=a=a.next;for(a=a.next;null!=a;){var p=a;o+=l.x*(p.y-s.y);var u=p.y*l.x-p.x*l.y;r.localCOMx+=(l.x+p.x)*u,r.localCOMy+=(l.y+p.y)*u,s=l,l=p,a=a.next}var h=a=r.lverts.next;o+=l.x*(h.y-s.y);var c=h.y*l.x-h.x*l.y;r.localCOMx+=(l.x+h.x)*c,r.localCOMy+=(l.y+h.y)*c,s=l,l=h;var _=a=a.next;o+=l.x*(_.y-s.y);var d=_.y*l.x-_.x*l.y;r.localCOMx+=(l.x+_.x)*d,r.localCOMy+=(l.y+_.y)*d;var m=o=1/(3*o);r.localCOMx*=m,r.localCOMy*=m}}null!=i.wrap_localCOM&&(i.wrap_localCOM.zpp_inner.x=i.localCOMx,i.wrap_localCOM.zpp_inner.y=i.localCOMy)}var P=i.body;P.zip_axis&&(P.zip_axis=!1,P.axisx=Math.sin(P.rot),P.axisy=Math.cos(P.rot)),i.worldCOMx=i.body.posx+(i.body.axisy*i.localCOMx-i.body.axisx*i.localCOMy),i.worldCOMy=i.body.posy+(i.localCOMx*i.body.axisx+i.localCOMy*i.body.axisy)}var f=i.radius,x=i.radius;i.aabb.minx=i.worldCOMx-f,i.aabb.miny=i.worldCOMy-x,i.aabb.maxx=i.worldCOMx+f,i.aabb.maxy=i.worldCOMy+x}else{var y=e.polygon;if(y.zip_gverts&&null!=y.body){y.zip_gverts=!1,y.validate_lverts();var v=y.body;v.zip_axis&&(v.zip_axis=!1,v.axisx=Math.sin(v.rot),v.axisy=Math.cos(v.rot));for(var g=y.lverts.next,b=y.gverts.next;null!=b;){var z=b,w=g;g=g.next,z.x=y.body.posx+(y.body.axisy*w.x-y.body.axisx*w.y),z.y=y.body.posy+(w.x*y.body.axisx+w.y*y.body.axisy),b=b.next}}if(null==y.lverts.next)throw new n._Boot.HaxeError("Error: An empty polygon has no meaningful bounds");var Z=y.gverts.next;y.aabb.minx=Z.x,y.aabb.miny=Z.y,y.aabb.maxx=Z.x,y.aabb.maxy=Z.y;for(var E=y.gverts.next.next;null!=E;){var M=E;M.x<y.aabb.minx&&(y.aabb.minx=M.x),M.x>y.aabb.maxx&&(y.aabb.maxx=M.x),M.y<y.aabb.miny&&(y.aabb.miny=M.y),M.y>y.aabb.maxy&&(y.aabb.maxy=M.y),E=E.next}}var S;if(t.dyn==(1!=e.body.type&&!e.body.component.sleeping)){var C=t.aabb,N=e.aabb;S=!(N.minx>=C.minx&&N.miny>=C.miny&&N.maxx<=C.maxx&&N.maxy<=C.maxy)}else S=!0;S&&(t.synced=!0,t.snext=this.syncs,this.syncs=t)}},t.space.ZPP_DynAABBPhase.prototype.sync_broadphase=function(){if(this.space.validation(),null!=this.syncs)if(null==this.moves){for(var e=this.syncs;null!=e;){var i=e.shape;if(e.first_sync)e.first_sync=!1;else{var r=e.dyn?this.dtree:this.stree;if(e==r.root)r.root=null;else{var o=e.parent,a=o.parent,s=o.child1==e?o.child2:o.child1;if(null!=a){a.child1==o?a.child1=s:a.child2=s,s.parent=a;var l=o;l.height=-1;var p=l.aabb;null!=p.outer&&(p.outer.zpp_inner=null,p.outer=null),p.wrap_min=p.wrap_max=null,p._invalidate=null,p._validate=null,p.next=t.geom.ZPP_AABB.zpp_pool,t.geom.ZPP_AABB.zpp_pool=p,l.child1=l.child2=l.parent=null,l.next=null,l.snext=null,l.mnext=null,l.next=t.space.ZPP_AABBNode.zpp_pool,t.space.ZPP_AABBNode.zpp_pool=l;for(var u=a;null!=u;){if(null==u.child1||u.height<2)u=u;else{var h=u.child1,c=u.child2,_=c.height-h.height;if(_>1){var d=c.child1,m=c.child2;if(c.child1=u,c.parent=u.parent,u.parent=c,null!=c.parent?c.parent.child1==u?c.parent.child1=c:c.parent.child2=c:r.root=c,d.height>m.height){c.child2=d,u.child2=m,m.parent=u;var P=u.aabb,f=h.aabb,x=m.aabb;P.minx=f.minx<x.minx?f.minx:x.minx,P.miny=f.miny<x.miny?f.miny:x.miny,P.maxx=f.maxx>x.maxx?f.maxx:x.maxx,P.maxy=f.maxy>x.maxy?f.maxy:x.maxy;var y=c.aabb,v=u.aabb,g=d.aabb;y.minx=v.minx<g.minx?v.minx:g.minx,y.miny=v.miny<g.miny?v.miny:g.miny,y.maxx=v.maxx>g.maxx?v.maxx:g.maxx,y.maxy=v.maxy>g.maxy?v.maxy:g.maxy;var b=h.height,z=m.height;u.height=1+(b>z?b:z);var w=u.height,Z=d.height;c.height=1+(w>Z?w:Z)}else{c.child2=m,u.child2=d,d.parent=u;var E=u.aabb,M=h.aabb,S=d.aabb;E.minx=M.minx<S.minx?M.minx:S.minx,E.miny=M.miny<S.miny?M.miny:S.miny,E.maxx=M.maxx>S.maxx?M.maxx:S.maxx,E.maxy=M.maxy>S.maxy?M.maxy:S.maxy;var C=c.aabb,N=u.aabb,A=m.aabb;C.minx=N.minx<A.minx?N.minx:A.minx,C.miny=N.miny<A.miny?N.miny:A.miny,C.maxx=N.maxx>A.maxx?N.maxx:A.maxx,C.maxy=N.maxy>A.maxy?N.maxy:A.maxy;var L=h.height,B=d.height;u.height=1+(L>B?L:B);var T=u.height,V=m.height;c.height=1+(T>V?T:V)}u=c}else if(_<-1){var k=h.child1,I=h.child2;if(h.child1=u,h.parent=u.parent,u.parent=h,null!=h.parent?h.parent.child1==u?h.parent.child1=h:h.parent.child2=h:r.root=h,k.height>I.height){h.child2=k,u.child1=I,I.parent=u;var O=u.aabb,R=c.aabb,H=I.aabb;O.minx=R.minx<H.minx?R.minx:H.minx,O.miny=R.miny<H.miny?R.miny:H.miny,O.maxx=R.maxx>H.maxx?R.maxx:H.maxx,O.maxy=R.maxy>H.maxy?R.maxy:H.maxy;var F=h.aabb,D=u.aabb,G=k.aabb;F.minx=D.minx<G.minx?D.minx:G.minx,F.miny=D.miny<G.miny?D.miny:G.miny,F.maxx=D.maxx>G.maxx?D.maxx:G.maxx,F.maxy=D.maxy>G.maxy?D.maxy:G.maxy;var U=c.height,j=I.height;u.height=1+(U>j?U:j);var W=u.height,q=k.height;h.height=1+(W>q?W:q)}else{h.child2=I,u.child1=k,k.parent=u;var J=u.aabb,$=c.aabb,X=k.aabb;J.minx=$.minx<X.minx?$.minx:X.minx,J.miny=$.miny<X.miny?$.miny:X.miny,J.maxx=$.maxx>X.maxx?$.maxx:X.maxx,J.maxy=$.maxy>X.maxy?$.maxy:X.maxy;var Y=h.aabb,K=u.aabb,Q=I.aabb;Y.minx=K.minx<Q.minx?K.minx:Q.minx,Y.miny=K.miny<Q.miny?K.miny:Q.miny,Y.maxx=K.maxx>Q.maxx?K.maxx:Q.maxx,Y.maxy=K.maxy>Q.maxy?K.maxy:Q.maxy;var ee=c.height,te=k.height;u.height=1+(ee>te?ee:te);var ne=u.height,ie=I.height;h.height=1+(ne>ie?ne:ie)}u=h}else u=u}var re=u.child1,oe=u.child2,ae=u.aabb,se=re.aabb,le=oe.aabb;ae.minx=se.minx<le.minx?se.minx:le.minx,ae.miny=se.miny<le.miny?se.miny:le.miny,ae.maxx=se.maxx>le.maxx?se.maxx:le.maxx,ae.maxy=se.maxy>le.maxy?se.maxy:le.maxy;var pe=re.height,ue=oe.height;u.height=1+(pe>ue?pe:ue),u=u.parent}}else{r.root=s,s.parent=null;var he=o;he.height=-1;var ce=he.aabb;null!=ce.outer&&(ce.outer.zpp_inner=null,ce.outer=null),ce.wrap_min=ce.wrap_max=null,ce._invalidate=null,ce._validate=null,ce.next=t.geom.ZPP_AABB.zpp_pool,t.geom.ZPP_AABB.zpp_pool=ce,he.child1=he.child2=he.parent=null,he.next=null,he.snext=null,he.mnext=null,he.next=t.space.ZPP_AABBNode.zpp_pool,t.space.ZPP_AABBNode.zpp_pool=he}}}var _e=e.aabb;if(!this.space.continuous&&i.zip_aabb&&null!=i.body)if(i.zip_aabb=!1,0==i.type){var de=i.circle;if(de.zip_worldCOM&&null!=de.body){if(de.zip_worldCOM=!1,de.zip_localCOM){if(de.zip_localCOM=!1,1==de.type){var me=de.polygon;if(null==me.lverts.next)throw new n._Boot.HaxeError("Error: An empty polygon has no meaningful localCOM");if(null==me.lverts.next.next)me.localCOMx=me.lverts.next.x,me.localCOMy=me.lverts.next.y;else if(null==me.lverts.next.next.next)me.localCOMx=me.lverts.next.x,me.localCOMy=me.lverts.next.y,me.localCOMx+=1*me.lverts.next.next.x,me.localCOMy+=1*me.lverts.next.next.y,me.localCOMx*=.5,me.localCOMy*=.5;else{me.localCOMx=0,me.localCOMy=0;var Pe=0,fe=me.lverts.next,xe=fe,ye=fe=fe.next;for(fe=fe.next;null!=fe;){var ve=fe;Pe+=ye.x*(ve.y-xe.y);var ge=ve.y*ye.x-ve.x*ye.y;me.localCOMx+=(ye.x+ve.x)*ge,me.localCOMy+=(ye.y+ve.y)*ge,xe=ye,ye=ve,fe=fe.next}var be=fe=me.lverts.next;Pe+=ye.x*(be.y-xe.y);var ze=be.y*ye.x-be.x*ye.y;me.localCOMx+=(ye.x+be.x)*ze,me.localCOMy+=(ye.y+be.y)*ze,xe=ye,ye=be;var we=fe=fe.next;Pe+=ye.x*(we.y-xe.y);var Ze=we.y*ye.x-we.x*ye.y;me.localCOMx+=(ye.x+we.x)*Ze,me.localCOMy+=(ye.y+we.y)*Ze;var Ee=Pe=1/(3*Pe);me.localCOMx*=Ee,me.localCOMy*=Ee}}null!=de.wrap_localCOM&&(de.wrap_localCOM.zpp_inner.x=de.localCOMx,de.wrap_localCOM.zpp_inner.y=de.localCOMy)}var Me=de.body;Me.zip_axis&&(Me.zip_axis=!1,Me.axisx=Math.sin(Me.rot),Me.axisy=Math.cos(Me.rot)),de.worldCOMx=de.body.posx+(de.body.axisy*de.localCOMx-de.body.axisx*de.localCOMy),de.worldCOMy=de.body.posy+(de.localCOMx*de.body.axisx+de.localCOMy*de.body.axisy)}var Se=de.radius,Ce=de.radius;de.aabb.minx=de.worldCOMx-Se,de.aabb.miny=de.worldCOMy-Ce,de.aabb.maxx=de.worldCOMx+Se,de.aabb.maxy=de.worldCOMy+Ce}else{var Ne=i.polygon;if(Ne.zip_gverts&&null!=Ne.body){Ne.zip_gverts=!1,Ne.validate_lverts();var Ae=Ne.body;Ae.zip_axis&&(Ae.zip_axis=!1,Ae.axisx=Math.sin(Ae.rot),Ae.axisy=Math.cos(Ae.rot));for(var Le=Ne.lverts.next,Be=Ne.gverts.next;null!=Be;){var Te=Be,Ve=Le;Le=Le.next,Te.x=Ne.body.posx+(Ne.body.axisy*Ve.x-Ne.body.axisx*Ve.y),Te.y=Ne.body.posy+(Ve.x*Ne.body.axisx+Ve.y*Ne.body.axisy),Be=Be.next}}if(null==Ne.lverts.next)throw new n._Boot.HaxeError("Error: An empty polygon has no meaningful bounds");var ke=Ne.gverts.next;Ne.aabb.minx=ke.x,Ne.aabb.miny=ke.y,Ne.aabb.maxx=ke.x,Ne.aabb.maxy=ke.y;for(var Ie=Ne.gverts.next.next;null!=Ie;){var Oe=Ie;Oe.x<Ne.aabb.minx&&(Ne.aabb.minx=Oe.x),Oe.x>Ne.aabb.maxx&&(Ne.aabb.maxx=Oe.x),Oe.y<Ne.aabb.miny&&(Ne.aabb.miny=Oe.y),Oe.y>Ne.aabb.maxy&&(Ne.aabb.maxy=Oe.y),Ie=Ie.next}}var Re=i.aabb;_e.minx=Re.minx-3,_e.miny=Re.miny-3,_e.maxx=Re.maxx+3,_e.maxy=Re.maxy+3;var He=(e.dyn=1!=i.body.type&&!i.body.component.sleeping)?this.dtree:this.stree;if(null==He.root)He.root=e,He.root.parent=null;else{for(var Fe=e.aabb,De=He.root;null!=De.child1;){var Ge=De.child1,Ue=De.child2,je=De.aabb,We=2*(je.maxx-je.minx+(je.maxy-je.miny)),qe=t.space.ZPP_AABBTree.tmpaabb,Je=De.aabb;qe.minx=Je.minx<Fe.minx?Je.minx:Fe.minx,qe.miny=Je.miny<Fe.miny?Je.miny:Fe.miny,qe.maxx=Je.maxx>Fe.maxx?Je.maxx:Fe.maxx,qe.maxy=Je.maxy>Fe.maxy?Je.maxy:Fe.maxy;var $e,Xe=t.space.ZPP_AABBTree.tmpaabb,Ye=2*(Xe.maxx-Xe.minx+(Xe.maxy-Xe.miny)),Ke=2*Ye,Qe=2*(Ye-We),et=t.space.ZPP_AABBTree.tmpaabb,tt=Ge.aabb;if(et.minx=Fe.minx<tt.minx?Fe.minx:tt.minx,et.miny=Fe.miny<tt.miny?Fe.miny:tt.miny,et.maxx=Fe.maxx>tt.maxx?Fe.maxx:tt.maxx,et.maxy=Fe.maxy>tt.maxy?Fe.maxy:tt.maxy,null==Ge.child1){var nt=t.space.ZPP_AABBTree.tmpaabb;$e=2*(nt.maxx-nt.minx+(nt.maxy-nt.miny))+Qe}else{var it=Ge.aabb,rt=2*(it.maxx-it.minx+(it.maxy-it.miny)),ot=t.space.ZPP_AABBTree.tmpaabb;$e=2*(ot.maxx-ot.minx+(ot.maxy-ot.miny))-rt+Qe}var at,st=t.space.ZPP_AABBTree.tmpaabb,lt=Ue.aabb;if(st.minx=Fe.minx<lt.minx?Fe.minx:lt.minx,st.miny=Fe.miny<lt.miny?Fe.miny:lt.miny,st.maxx=Fe.maxx>lt.maxx?Fe.maxx:lt.maxx,st.maxy=Fe.maxy>lt.maxy?Fe.maxy:lt.maxy,null==Ue.child1){var pt=t.space.ZPP_AABBTree.tmpaabb;at=2*(pt.maxx-pt.minx+(pt.maxy-pt.miny))+Qe}else{var ut=Ue.aabb,ht=2*(ut.maxx-ut.minx+(ut.maxy-ut.miny)),ct=t.space.ZPP_AABBTree.tmpaabb;at=2*(ct.maxx-ct.minx+(ct.maxy-ct.miny))-ht+Qe}if(Ke<$e&&Ke<at)break;De=$e<at?Ge:Ue}var _t,dt=De,mt=dt.parent;null==t.space.ZPP_AABBNode.zpp_pool?_t=new t.space.ZPP_AABBNode:(_t=t.space.ZPP_AABBNode.zpp_pool,t.space.ZPP_AABBNode.zpp_pool=_t.next,_t.next=null),null==t.geom.ZPP_AABB.zpp_pool?_t.aabb=new t.geom.ZPP_AABB:(_t.aabb=t.geom.ZPP_AABB.zpp_pool,t.geom.ZPP_AABB.zpp_pool=_t.aabb.next,_t.aabb.next=null),_t.moved=!1,_t.synced=!1,_t.first_sync=!1,_t.parent=mt;var Pt=_t.aabb,ft=dt.aabb;for(Pt.minx=Fe.minx<ft.minx?Fe.minx:ft.minx,Pt.miny=Fe.miny<ft.miny?Fe.miny:ft.miny,Pt.maxx=Fe.maxx>ft.maxx?Fe.maxx:ft.maxx,Pt.maxy=Fe.maxy>ft.maxy?Fe.maxy:ft.maxy,_t.height=dt.height+1,null!=mt?(mt.child1==dt?mt.child1=_t:mt.child2=_t,_t.child1=dt,_t.child2=e,dt.parent=_t,e.parent=_t):(_t.child1=dt,_t.child2=e,dt.parent=_t,e.parent=_t,He.root=_t),De=e.parent;null!=De;){if(null==De.child1||De.height<2)De=De;else{var xt=De.child1,yt=De.child2,vt=yt.height-xt.height;if(vt>1){var gt=yt.child1,bt=yt.child2;if(yt.child1=De,yt.parent=De.parent,De.parent=yt,null!=yt.parent?yt.parent.child1==De?yt.parent.child1=yt:yt.parent.child2=yt:He.root=yt,gt.height>bt.height){yt.child2=gt,De.child2=bt,bt.parent=De;var zt=De.aabb,wt=xt.aabb,Zt=bt.aabb;zt.minx=wt.minx<Zt.minx?wt.minx:Zt.minx,zt.miny=wt.miny<Zt.miny?wt.miny:Zt.miny,zt.maxx=wt.maxx>Zt.maxx?wt.maxx:Zt.maxx,zt.maxy=wt.maxy>Zt.maxy?wt.maxy:Zt.maxy;var Et=yt.aabb,Mt=De.aabb,St=gt.aabb;Et.minx=Mt.minx<St.minx?Mt.minx:St.minx,Et.miny=Mt.miny<St.miny?Mt.miny:St.miny,Et.maxx=Mt.maxx>St.maxx?Mt.maxx:St.maxx,Et.maxy=Mt.maxy>St.maxy?Mt.maxy:St.maxy;var Ct=xt.height,Nt=bt.height;De.height=1+(Ct>Nt?Ct:Nt);var At=De.height,Lt=gt.height;yt.height=1+(At>Lt?At:Lt)}else{yt.child2=bt,De.child2=gt,gt.parent=De;var Bt=De.aabb,Tt=xt.aabb,Vt=gt.aabb;Bt.minx=Tt.minx<Vt.minx?Tt.minx:Vt.minx,Bt.miny=Tt.miny<Vt.miny?Tt.miny:Vt.miny,Bt.maxx=Tt.maxx>Vt.maxx?Tt.maxx:Vt.maxx,Bt.maxy=Tt.maxy>Vt.maxy?Tt.maxy:Vt.maxy;var kt=yt.aabb,It=De.aabb,Ot=bt.aabb;kt.minx=It.minx<Ot.minx?It.minx:Ot.minx,kt.miny=It.miny<Ot.miny?It.miny:Ot.miny,kt.maxx=It.maxx>Ot.maxx?It.maxx:Ot.maxx,kt.maxy=It.maxy>Ot.maxy?It.maxy:Ot.maxy;var Rt=xt.height,Ht=gt.height;De.height=1+(Rt>Ht?Rt:Ht);var Ft=De.height,Dt=bt.height;yt.height=1+(Ft>Dt?Ft:Dt)}De=yt}else if(vt<-1){var Gt=xt.child1,Ut=xt.child2;if(xt.child1=De,xt.parent=De.parent,De.parent=xt,null!=xt.parent?xt.parent.child1==De?xt.parent.child1=xt:xt.parent.child2=xt:He.root=xt,Gt.height>Ut.height){xt.child2=Gt,De.child1=Ut,Ut.parent=De;var jt=De.aabb,Wt=yt.aabb,qt=Ut.aabb;jt.minx=Wt.minx<qt.minx?Wt.minx:qt.minx,jt.miny=Wt.miny<qt.miny?Wt.miny:qt.miny,jt.maxx=Wt.maxx>qt.maxx?Wt.maxx:qt.maxx,jt.maxy=Wt.maxy>qt.maxy?Wt.maxy:qt.maxy;var Jt=xt.aabb,$t=De.aabb,Xt=Gt.aabb;Jt.minx=$t.minx<Xt.minx?$t.minx:Xt.minx,Jt.miny=$t.miny<Xt.miny?$t.miny:Xt.miny,Jt.maxx=$t.maxx>Xt.maxx?$t.maxx:Xt.maxx,Jt.maxy=$t.maxy>Xt.maxy?$t.maxy:Xt.maxy;var Yt=yt.height,Kt=Ut.height;De.height=1+(Yt>Kt?Yt:Kt);var Qt=De.height,en=Gt.height;xt.height=1+(Qt>en?Qt:en)}else{xt.child2=Ut,De.child1=Gt,Gt.parent=De;var tn=De.aabb,nn=yt.aabb,rn=Gt.aabb;tn.minx=nn.minx<rn.minx?nn.minx:rn.minx,tn.miny=nn.miny<rn.miny?nn.miny:rn.miny,tn.maxx=nn.maxx>rn.maxx?nn.maxx:rn.maxx,tn.maxy=nn.maxy>rn.maxy?nn.maxy:rn.maxy;var on=xt.aabb,an=De.aabb,sn=Ut.aabb;on.minx=an.minx<sn.minx?an.minx:sn.minx,on.miny=an.miny<sn.miny?an.miny:sn.miny,on.maxx=an.maxx>sn.maxx?an.maxx:sn.maxx,on.maxy=an.maxy>sn.maxy?an.maxy:sn.maxy;var ln=yt.height,pn=Gt.height;De.height=1+(ln>pn?ln:pn);var un=De.height,hn=Ut.height;xt.height=1+(un>hn?un:hn)}De=xt}else De=De}var cn=De.child1,_n=De.child2,dn=cn.height,mn=_n.height;De.height=1+(dn>mn?dn:mn);var Pn=De.aabb,fn=cn.aabb,xn=_n.aabb;Pn.minx=fn.minx<xn.minx?fn.minx:xn.minx,Pn.miny=fn.miny<xn.miny?fn.miny:xn.miny,Pn.maxx=fn.maxx>xn.maxx?fn.maxx:xn.maxx,Pn.maxy=fn.maxy>xn.maxy?fn.maxy:xn.maxy,De=De.parent}}e.synced=!1,e.moved=!0,e.mnext=e.snext,e.snext=null,e=e.mnext}var yn=this.syncs;this.syncs=this.moves,this.moves=yn}else for(;null!=this.syncs;){var vn=this.syncs;this.syncs=vn.snext,vn.snext=null;var gn=vn,bn=gn.shape;if(gn.first_sync)gn.first_sync=!1;else{var zn=gn.dyn?this.dtree:this.stree;if(gn==zn.root)zn.root=null;else{var wn=gn.parent,Zn=wn.parent,En=wn.child1==gn?wn.child2:wn.child1;if(null!=Zn){Zn.child1==wn?Zn.child1=En:Zn.child2=En,En.parent=Zn;var Mn=wn;Mn.height=-1;var Sn=Mn.aabb;null!=Sn.outer&&(Sn.outer.zpp_inner=null,Sn.outer=null),Sn.wrap_min=Sn.wrap_max=null,Sn._invalidate=null,Sn._validate=null,Sn.next=t.geom.ZPP_AABB.zpp_pool,t.geom.ZPP_AABB.zpp_pool=Sn,Mn.child1=Mn.child2=Mn.parent=null,Mn.next=null,Mn.snext=null,Mn.mnext=null,Mn.next=t.space.ZPP_AABBNode.zpp_pool,t.space.ZPP_AABBNode.zpp_pool=Mn;for(var Cn=Zn;null!=Cn;){if(null==Cn.child1||Cn.height<2)Cn=Cn;else{var Nn=Cn.child1,An=Cn.child2,Ln=An.height-Nn.height;if(Ln>1){var Bn=An.child1,Tn=An.child2;if(An.child1=Cn,An.parent=Cn.parent,Cn.parent=An,null!=An.parent?An.parent.child1==Cn?An.parent.child1=An:An.parent.child2=An:zn.root=An,Bn.height>Tn.height){An.child2=Bn,Cn.child2=Tn,Tn.parent=Cn;var Vn=Cn.aabb,kn=Nn.aabb,In=Tn.aabb;Vn.minx=kn.minx<In.minx?kn.minx:In.minx,Vn.miny=kn.miny<In.miny?kn.miny:In.miny,Vn.maxx=kn.maxx>In.maxx?kn.maxx:In.maxx,Vn.maxy=kn.maxy>In.maxy?kn.maxy:In.maxy;var On=An.aabb,Rn=Cn.aabb,Hn=Bn.aabb;On.minx=Rn.minx<Hn.minx?Rn.minx:Hn.minx,On.miny=Rn.miny<Hn.miny?Rn.miny:Hn.miny,On.maxx=Rn.maxx>Hn.maxx?Rn.maxx:Hn.maxx,On.maxy=Rn.maxy>Hn.maxy?Rn.maxy:Hn.maxy;var Fn=Nn.height,Dn=Tn.height;Cn.height=1+(Fn>Dn?Fn:Dn);var Gn=Cn.height,Un=Bn.height;An.height=1+(Gn>Un?Gn:Un)}else{An.child2=Tn,Cn.child2=Bn,Bn.parent=Cn;var jn=Cn.aabb,Wn=Nn.aabb,qn=Bn.aabb;jn.minx=Wn.minx<qn.minx?Wn.minx:qn.minx,jn.miny=Wn.miny<qn.miny?Wn.miny:qn.miny,jn.maxx=Wn.maxx>qn.maxx?Wn.maxx:qn.maxx,jn.maxy=Wn.maxy>qn.maxy?Wn.maxy:qn.maxy;var Jn=An.aabb,$n=Cn.aabb,Xn=Tn.aabb;Jn.minx=$n.minx<Xn.minx?$n.minx:Xn.minx,Jn.miny=$n.miny<Xn.miny?$n.miny:Xn.miny,Jn.maxx=$n.maxx>Xn.maxx?$n.maxx:Xn.maxx,Jn.maxy=$n.maxy>Xn.maxy?$n.maxy:Xn.maxy;var Yn=Nn.height,Kn=Bn.height;Cn.height=1+(Yn>Kn?Yn:Kn);var Qn=Cn.height,ei=Tn.height;An.height=1+(Qn>ei?Qn:ei)}Cn=An}else if(Ln<-1){var ti=Nn.child1,ni=Nn.child2;if(Nn.child1=Cn,Nn.parent=Cn.parent,Cn.parent=Nn,null!=Nn.parent?Nn.parent.child1==Cn?Nn.parent.child1=Nn:Nn.parent.child2=Nn:zn.root=Nn,ti.height>ni.height){Nn.child2=ti,Cn.child1=ni,ni.parent=Cn;var ii=Cn.aabb,ri=An.aabb,oi=ni.aabb;ii.minx=ri.minx<oi.minx?ri.minx:oi.minx,ii.miny=ri.miny<oi.miny?ri.miny:oi.miny,ii.maxx=ri.maxx>oi.maxx?ri.maxx:oi.maxx,ii.maxy=ri.maxy>oi.maxy?ri.maxy:oi.maxy;var ai=Nn.aabb,si=Cn.aabb,li=ti.aabb;ai.minx=si.minx<li.minx?si.minx:li.minx,ai.miny=si.miny<li.miny?si.miny:li.miny,ai.maxx=si.maxx>li.maxx?si.maxx:li.maxx,ai.maxy=si.maxy>li.maxy?si.maxy:li.maxy;var pi=An.height,ui=ni.height;Cn.height=1+(pi>ui?pi:ui);var hi=Cn.height,ci=ti.height;Nn.height=1+(hi>ci?hi:ci)}else{Nn.child2=ni,Cn.child1=ti,ti.parent=Cn;var _i=Cn.aabb,di=An.aabb,mi=ti.aabb;_i.minx=di.minx<mi.minx?di.minx:mi.minx,_i.miny=di.miny<mi.miny?di.miny:mi.miny,_i.maxx=di.maxx>mi.maxx?di.maxx:mi.maxx,_i.maxy=di.maxy>mi.maxy?di.maxy:mi.maxy;var Pi=Nn.aabb,fi=Cn.aabb,xi=ni.aabb;Pi.minx=fi.minx<xi.minx?fi.minx:xi.minx,Pi.miny=fi.miny<xi.miny?fi.miny:xi.miny,Pi.maxx=fi.maxx>xi.maxx?fi.maxx:xi.maxx,Pi.maxy=fi.maxy>xi.maxy?fi.maxy:xi.maxy;var yi=An.height,vi=ti.height;Cn.height=1+(yi>vi?yi:vi);var gi=Cn.height,bi=ni.height;Nn.height=1+(gi>bi?gi:bi)}Cn=Nn}else Cn=Cn}var zi=Cn.child1,wi=Cn.child2,Zi=Cn.aabb,Ei=zi.aabb,Mi=wi.aabb;Zi.minx=Ei.minx<Mi.minx?Ei.minx:Mi.minx,Zi.miny=Ei.miny<Mi.miny?Ei.miny:Mi.miny,Zi.maxx=Ei.maxx>Mi.maxx?Ei.maxx:Mi.maxx,Zi.maxy=Ei.maxy>Mi.maxy?Ei.maxy:Mi.maxy;var Si=zi.height,Ci=wi.height;Cn.height=1+(Si>Ci?Si:Ci),Cn=Cn.parent}}else{zn.root=En,En.parent=null;var Ni=wn;Ni.height=-1;var Ai=Ni.aabb;null!=Ai.outer&&(Ai.outer.zpp_inner=null,Ai.outer=null),Ai.wrap_min=Ai.wrap_max=null,Ai._invalidate=null,Ai._validate=null,Ai.next=t.geom.ZPP_AABB.zpp_pool,t.geom.ZPP_AABB.zpp_pool=Ai,Ni.child1=Ni.child2=Ni.parent=null,Ni.next=null,Ni.snext=null,Ni.mnext=null,Ni.next=t.space.ZPP_AABBNode.zpp_pool,t.space.ZPP_AABBNode.zpp_pool=Ni}}}var Li=gn.aabb;if(!this.space.continuous&&bn.zip_aabb&&null!=bn.body)if(bn.zip_aabb=!1,0==bn.type){var Bi=bn.circle;if(Bi.zip_worldCOM&&null!=Bi.body){if(Bi.zip_worldCOM=!1,Bi.zip_localCOM){if(Bi.zip_localCOM=!1,1==Bi.type){var Ti=Bi.polygon;if(null==Ti.lverts.next)throw new n._Boot.HaxeError("Error: An empty polygon has no meaningful localCOM");if(null==Ti.lverts.next.next)Ti.localCOMx=Ti.lverts.next.x,Ti.localCOMy=Ti.lverts.next.y;else if(null==Ti.lverts.next.next.next)Ti.localCOMx=Ti.lverts.next.x,Ti.localCOMy=Ti.lverts.next.y,Ti.localCOMx+=1*Ti.lverts.next.next.x,Ti.localCOMy+=1*Ti.lverts.next.next.y,Ti.localCOMx*=.5,Ti.localCOMy*=.5;else{Ti.localCOMx=0,Ti.localCOMy=0;var Vi=0,ki=Ti.lverts.next,Ii=ki,Oi=ki=ki.next;for(ki=ki.next;null!=ki;){var Ri=ki;Vi+=Oi.x*(Ri.y-Ii.y);var Hi=Ri.y*Oi.x-Ri.x*Oi.y;Ti.localCOMx+=(Oi.x+Ri.x)*Hi,Ti.localCOMy+=(Oi.y+Ri.y)*Hi,Ii=Oi,Oi=Ri,ki=ki.next}var Fi=ki=Ti.lverts.next;Vi+=Oi.x*(Fi.y-Ii.y);var Di=Fi.y*Oi.x-Fi.x*Oi.y;Ti.localCOMx+=(Oi.x+Fi.x)*Di,Ti.localCOMy+=(Oi.y+Fi.y)*Di,Ii=Oi,Oi=Fi;var Gi=ki=ki.next;Vi+=Oi.x*(Gi.y-Ii.y);var Ui=Gi.y*Oi.x-Gi.x*Oi.y;Ti.localCOMx+=(Oi.x+Gi.x)*Ui,Ti.localCOMy+=(Oi.y+Gi.y)*Ui;var ji=Vi=1/(3*Vi);Ti.localCOMx*=ji,Ti.localCOMy*=ji}}null!=Bi.wrap_localCOM&&(Bi.wrap_localCOM.zpp_inner.x=Bi.localCOMx,Bi.wrap_localCOM.zpp_inner.y=Bi.localCOMy)}var Wi=Bi.body;Wi.zip_axis&&(Wi.zip_axis=!1,Wi.axisx=Math.sin(Wi.rot),Wi.axisy=Math.cos(Wi.rot)),Bi.worldCOMx=Bi.body.posx+(Bi.body.axisy*Bi.localCOMx-Bi.body.axisx*Bi.localCOMy),Bi.worldCOMy=Bi.body.posy+(Bi.localCOMx*Bi.body.axisx+Bi.localCOMy*Bi.body.axisy)}var qi=Bi.radius,Ji=Bi.radius;Bi.aabb.minx=Bi.worldCOMx-qi,Bi.aabb.miny=Bi.worldCOMy-Ji,Bi.aabb.maxx=Bi.worldCOMx+qi,Bi.aabb.maxy=Bi.worldCOMy+Ji}else{var $i=bn.polygon;if($i.zip_gverts&&null!=$i.body){$i.zip_gverts=!1,$i.validate_lverts();var Xi=$i.body;Xi.zip_axis&&(Xi.zip_axis=!1,Xi.axisx=Math.sin(Xi.rot),Xi.axisy=Math.cos(Xi.rot));for(var Yi=$i.lverts.next,Ki=$i.gverts.next;null!=Ki;){var Qi=Ki,er=Yi;Yi=Yi.next,Qi.x=$i.body.posx+($i.body.axisy*er.x-$i.body.axisx*er.y),Qi.y=$i.body.posy+(er.x*$i.body.axisx+er.y*$i.body.axisy),Ki=Ki.next}}if(null==$i.lverts.next)throw new n._Boot.HaxeError("Error: An empty polygon has no meaningful bounds");var tr=$i.gverts.next;$i.aabb.minx=tr.x,$i.aabb.miny=tr.y,$i.aabb.maxx=tr.x,$i.aabb.maxy=tr.y;for(var nr=$i.gverts.next.next;null!=nr;){var ir=nr;ir.x<$i.aabb.minx&&($i.aabb.minx=ir.x),ir.x>$i.aabb.maxx&&($i.aabb.maxx=ir.x),ir.y<$i.aabb.miny&&($i.aabb.miny=ir.y),ir.y>$i.aabb.maxy&&($i.aabb.maxy=ir.y),nr=nr.next}}var rr=bn.aabb;Li.minx=rr.minx-3,Li.miny=rr.miny-3,Li.maxx=rr.maxx+3,Li.maxy=rr.maxy+3;var or=(gn.dyn=1!=bn.body.type&&!bn.body.component.sleeping)?this.dtree:this.stree;if(null==or.root)or.root=gn,or.root.parent=null;else{for(var ar=gn.aabb,sr=or.root;null!=sr.child1;){var lr=sr.child1,pr=sr.child2,ur=sr.aabb,hr=2*(ur.maxx-ur.minx+(ur.maxy-ur.miny)),cr=t.space.ZPP_AABBTree.tmpaabb,_r=sr.aabb;cr.minx=_r.minx<ar.minx?_r.minx:ar.minx,cr.miny=_r.miny<ar.miny?_r.miny:ar.miny,cr.maxx=_r.maxx>ar.maxx?_r.maxx:ar.maxx,cr.maxy=_r.maxy>ar.maxy?_r.maxy:ar.maxy;var dr,mr=t.space.ZPP_AABBTree.tmpaabb,Pr=2*(mr.maxx-mr.minx+(mr.maxy-mr.miny)),fr=2*Pr,xr=2*(Pr-hr),yr=t.space.ZPP_AABBTree.tmpaabb,vr=lr.aabb;if(yr.minx=ar.minx<vr.minx?ar.minx:vr.minx,yr.miny=ar.miny<vr.miny?ar.miny:vr.miny,yr.maxx=ar.maxx>vr.maxx?ar.maxx:vr.maxx,yr.maxy=ar.maxy>vr.maxy?ar.maxy:vr.maxy,null==lr.child1){var gr=t.space.ZPP_AABBTree.tmpaabb;dr=2*(gr.maxx-gr.minx+(gr.maxy-gr.miny))+xr}else{var br=lr.aabb,zr=2*(br.maxx-br.minx+(br.maxy-br.miny)),wr=t.space.ZPP_AABBTree.tmpaabb;dr=2*(wr.maxx-wr.minx+(wr.maxy-wr.miny))-zr+xr}var Zr,Er=t.space.ZPP_AABBTree.tmpaabb,Mr=pr.aabb;if(Er.minx=ar.minx<Mr.minx?ar.minx:Mr.minx,Er.miny=ar.miny<Mr.miny?ar.miny:Mr.miny,Er.maxx=ar.maxx>Mr.maxx?ar.maxx:Mr.maxx,Er.maxy=ar.maxy>Mr.maxy?ar.maxy:Mr.maxy,null==pr.child1){var Sr=t.space.ZPP_AABBTree.tmpaabb;Zr=2*(Sr.maxx-Sr.minx+(Sr.maxy-Sr.miny))+xr}else{var Cr=pr.aabb,Nr=2*(Cr.maxx-Cr.minx+(Cr.maxy-Cr.miny)),Ar=t.space.ZPP_AABBTree.tmpaabb;Zr=2*(Ar.maxx-Ar.minx+(Ar.maxy-Ar.miny))-Nr+xr}if(fr<dr&&fr<Zr)break;sr=dr<Zr?lr:pr}var Lr,Br=sr,Tr=Br.parent;null==t.space.ZPP_AABBNode.zpp_pool?Lr=new t.space.ZPP_AABBNode:(Lr=t.space.ZPP_AABBNode.zpp_pool,t.space.ZPP_AABBNode.zpp_pool=Lr.next,Lr.next=null),null==t.geom.ZPP_AABB.zpp_pool?Lr.aabb=new t.geom.ZPP_AABB:(Lr.aabb=t.geom.ZPP_AABB.zpp_pool,t.geom.ZPP_AABB.zpp_pool=Lr.aabb.next,Lr.aabb.next=null),Lr.moved=!1,Lr.synced=!1,Lr.first_sync=!1,Lr.parent=Tr;var Vr=Lr.aabb,kr=Br.aabb;for(Vr.minx=ar.minx<kr.minx?ar.minx:kr.minx,Vr.miny=ar.miny<kr.miny?ar.miny:kr.miny,Vr.maxx=ar.maxx>kr.maxx?ar.maxx:kr.maxx,Vr.maxy=ar.maxy>kr.maxy?ar.maxy:kr.maxy,Lr.height=Br.height+1,null!=Tr?(Tr.child1==Br?Tr.child1=Lr:Tr.child2=Lr,Lr.child1=Br,Lr.child2=gn,Br.parent=Lr,gn.parent=Lr):(Lr.child1=Br,Lr.child2=gn,Br.parent=Lr,gn.parent=Lr,or.root=Lr),sr=gn.parent;null!=sr;){if(null==sr.child1||sr.height<2)sr=sr;else{var Ir=sr.child1,Or=sr.child2,Rr=Or.height-Ir.height;if(Rr>1){var Hr=Or.child1,Fr=Or.child2;if(Or.child1=sr,Or.parent=sr.parent,sr.parent=Or,null!=Or.parent?Or.parent.child1==sr?Or.parent.child1=Or:Or.parent.child2=Or:or.root=Or,Hr.height>Fr.height){Or.child2=Hr,sr.child2=Fr,Fr.parent=sr;var Dr=sr.aabb,Gr=Ir.aabb,Ur=Fr.aabb;Dr.minx=Gr.minx<Ur.minx?Gr.minx:Ur.minx,Dr.miny=Gr.miny<Ur.miny?Gr.miny:Ur.miny,Dr.maxx=Gr.maxx>Ur.maxx?Gr.maxx:Ur.maxx,Dr.maxy=Gr.maxy>Ur.maxy?Gr.maxy:Ur.maxy;var jr=Or.aabb,Wr=sr.aabb,qr=Hr.aabb;jr.minx=Wr.minx<qr.minx?Wr.minx:qr.minx,jr.miny=Wr.miny<qr.miny?Wr.miny:qr.miny,jr.maxx=Wr.maxx>qr.maxx?Wr.maxx:qr.maxx,jr.maxy=Wr.maxy>qr.maxy?Wr.maxy:qr.maxy;var Jr=Ir.height,$r=Fr.height;sr.height=1+(Jr>$r?Jr:$r);var Xr=sr.height,Yr=Hr.height;Or.height=1+(Xr>Yr?Xr:Yr)}else{Or.child2=Fr,sr.child2=Hr,Hr.parent=sr;var Kr=sr.aabb,Qr=Ir.aabb,eo=Hr.aabb;Kr.minx=Qr.minx<eo.minx?Qr.minx:eo.minx,Kr.miny=Qr.miny<eo.miny?Qr.miny:eo.miny,Kr.maxx=Qr.maxx>eo.maxx?Qr.maxx:eo.maxx,Kr.maxy=Qr.maxy>eo.maxy?Qr.maxy:eo.maxy;var to=Or.aabb,no=sr.aabb,io=Fr.aabb;to.minx=no.minx<io.minx?no.minx:io.minx,to.miny=no.miny<io.miny?no.miny:io.miny,to.maxx=no.maxx>io.maxx?no.maxx:io.maxx,to.maxy=no.maxy>io.maxy?no.maxy:io.maxy;var ro=Ir.height,oo=Hr.height;sr.height=1+(ro>oo?ro:oo);var ao=sr.height,so=Fr.height;Or.height=1+(ao>so?ao:so)}sr=Or}else if(Rr<-1){var lo=Ir.child1,po=Ir.child2;if(Ir.child1=sr,Ir.parent=sr.parent,sr.parent=Ir,null!=Ir.parent?Ir.parent.child1==sr?Ir.parent.child1=Ir:Ir.parent.child2=Ir:or.root=Ir,lo.height>po.height){Ir.child2=lo,sr.child1=po,po.parent=sr;var uo=sr.aabb,ho=Or.aabb,co=po.aabb;uo.minx=ho.minx<co.minx?ho.minx:co.minx,uo.miny=ho.miny<co.miny?ho.miny:co.miny,uo.maxx=ho.maxx>co.maxx?ho.maxx:co.maxx,uo.maxy=ho.maxy>co.maxy?ho.maxy:co.maxy;var _o=Ir.aabb,mo=sr.aabb,Po=lo.aabb;_o.minx=mo.minx<Po.minx?mo.minx:Po.minx,_o.miny=mo.miny<Po.miny?mo.miny:Po.miny,_o.maxx=mo.maxx>Po.maxx?mo.maxx:Po.maxx,_o.maxy=mo.maxy>Po.maxy?mo.maxy:Po.maxy;var fo=Or.height,xo=po.height;sr.height=1+(fo>xo?fo:xo);var yo=sr.height,vo=lo.height;Ir.height=1+(yo>vo?yo:vo)}else{Ir.child2=po,sr.child1=lo,lo.parent=sr;var go=sr.aabb,bo=Or.aabb,zo=lo.aabb;go.minx=bo.minx<zo.minx?bo.minx:zo.minx,go.miny=bo.miny<zo.miny?bo.miny:zo.miny,go.maxx=bo.maxx>zo.maxx?bo.maxx:zo.maxx,go.maxy=bo.maxy>zo.maxy?bo.maxy:zo.maxy;var wo=Ir.aabb,Zo=sr.aabb,Eo=po.aabb;wo.minx=Zo.minx<Eo.minx?Zo.minx:Eo.minx,wo.miny=Zo.miny<Eo.miny?Zo.miny:Eo.miny,wo.maxx=Zo.maxx>Eo.maxx?Zo.maxx:Eo.maxx,wo.maxy=Zo.maxy>Eo.maxy?Zo.maxy:Eo.maxy;var Mo=Or.height,So=lo.height;sr.height=1+(Mo>So?Mo:So);var Co=sr.height,No=po.height;Ir.height=1+(Co>No?Co:No)}sr=Ir}else sr=sr}var Ao=sr.child1,Lo=sr.child2,Bo=Ao.height,To=Lo.height;sr.height=1+(Bo>To?Bo:To);var Vo=sr.aabb,ko=Ao.aabb,Io=Lo.aabb;Vo.minx=ko.minx<Io.minx?ko.minx:Io.minx,Vo.miny=ko.miny<Io.miny?ko.miny:Io.miny,Vo.maxx=ko.maxx>Io.maxx?ko.maxx:Io.maxx,Vo.maxy=ko.maxy>Io.maxy?ko.maxy:Io.maxy,sr=sr.parent}}gn.synced=!1,gn.moved||(gn.moved=!0,gn.mnext=this.moves,this.moves=gn)}},t.space.ZPP_DynAABBPhase.prototype.broadphase=function(e,i){for(var r=this.syncs;null!=r;){var o=r.shape;if(r.first_sync)r.first_sync=!1;else{var a=r.dyn?this.dtree:this.stree;if(r==a.root)a.root=null;else{var s=r.parent,l=s.parent,p=s.child1==r?s.child2:s.child1;if(null!=l){l.child1==s?l.child1=p:l.child2=p,p.parent=l;var u=s;u.height=-1;var h=u.aabb;null!=h.outer&&(h.outer.zpp_inner=null,h.outer=null),h.wrap_min=h.wrap_max=null,h._invalidate=null,h._validate=null,h.next=t.geom.ZPP_AABB.zpp_pool,t.geom.ZPP_AABB.zpp_pool=h,u.child1=u.child2=u.parent=null,u.next=null,u.snext=null,u.mnext=null,u.next=t.space.ZPP_AABBNode.zpp_pool,t.space.ZPP_AABBNode.zpp_pool=u;for(var c=l;null!=c;){if(null==c.child1||c.height<2)c=c;else{var _=c.child1,d=c.child2,m=d.height-_.height;if(m>1){var P=d.child1,f=d.child2;if(d.child1=c,d.parent=c.parent,c.parent=d,null!=d.parent?d.parent.child1==c?d.parent.child1=d:d.parent.child2=d:a.root=d,P.height>f.height){d.child2=P,c.child2=f,f.parent=c;var x=c.aabb,y=_.aabb,v=f.aabb;x.minx=y.minx<v.minx?y.minx:v.minx,x.miny=y.miny<v.miny?y.miny:v.miny,x.maxx=y.maxx>v.maxx?y.maxx:v.maxx,x.maxy=y.maxy>v.maxy?y.maxy:v.maxy;var g=d.aabb,b=c.aabb,z=P.aabb;g.minx=b.minx<z.minx?b.minx:z.minx,g.miny=b.miny<z.miny?b.miny:z.miny,g.maxx=b.maxx>z.maxx?b.maxx:z.maxx,g.maxy=b.maxy>z.maxy?b.maxy:z.maxy;var w=_.height,Z=f.height;c.height=1+(w>Z?w:Z);var E=c.height,M=P.height;d.height=1+(E>M?E:M)}else{d.child2=f,c.child2=P,P.parent=c;var S=c.aabb,C=_.aabb,N=P.aabb;S.minx=C.minx<N.minx?C.minx:N.minx,S.miny=C.miny<N.miny?C.miny:N.miny,S.maxx=C.maxx>N.maxx?C.maxx:N.maxx,S.maxy=C.maxy>N.maxy?C.maxy:N.maxy;var A=d.aabb,L=c.aabb,B=f.aabb;A.minx=L.minx<B.minx?L.minx:B.minx,A.miny=L.miny<B.miny?L.miny:B.miny,A.maxx=L.maxx>B.maxx?L.maxx:B.maxx,A.maxy=L.maxy>B.maxy?L.maxy:B.maxy;var T=_.height,V=P.height;c.height=1+(T>V?T:V);var k=c.height,I=f.height;d.height=1+(k>I?k:I)}c=d}else if(m<-1){var O=_.child1,R=_.child2;if(_.child1=c,_.parent=c.parent,c.parent=_,null!=_.parent?_.parent.child1==c?_.parent.child1=_:_.parent.child2=_:a.root=_,O.height>R.height){_.child2=O,c.child1=R,R.parent=c;var H=c.aabb,F=d.aabb,D=R.aabb;H.minx=F.minx<D.minx?F.minx:D.minx,H.miny=F.miny<D.miny?F.miny:D.miny,H.maxx=F.maxx>D.maxx?F.maxx:D.maxx,H.maxy=F.maxy>D.maxy?F.maxy:D.maxy;var G=_.aabb,U=c.aabb,j=O.aabb;G.minx=U.minx<j.minx?U.minx:j.minx,G.miny=U.miny<j.miny?U.miny:j.miny,G.maxx=U.maxx>j.maxx?U.maxx:j.maxx,G.maxy=U.maxy>j.maxy?U.maxy:j.maxy;var W=d.height,q=R.height;c.height=1+(W>q?W:q);var J=c.height,$=O.height;_.height=1+(J>$?J:$)}else{_.child2=R,c.child1=O,O.parent=c;var X=c.aabb,Y=d.aabb,K=O.aabb;X.minx=Y.minx<K.minx?Y.minx:K.minx,X.miny=Y.miny<K.miny?Y.miny:K.miny,X.maxx=Y.maxx>K.maxx?Y.maxx:K.maxx,X.maxy=Y.maxy>K.maxy?Y.maxy:K.maxy;var Q=_.aabb,ee=c.aabb,te=R.aabb;Q.minx=ee.minx<te.minx?ee.minx:te.minx,Q.miny=ee.miny<te.miny?ee.miny:te.miny,Q.maxx=ee.maxx>te.maxx?ee.maxx:te.maxx,Q.maxy=ee.maxy>te.maxy?ee.maxy:te.maxy;var ne=d.height,ie=O.height;c.height=1+(ne>ie?ne:ie);var re=c.height,oe=R.height;_.height=1+(re>oe?re:oe)}c=_}else c=c}var ae=c.child1,se=c.child2,le=c.aabb,pe=ae.aabb,ue=se.aabb;le.minx=pe.minx<ue.minx?pe.minx:ue.minx,le.miny=pe.miny<ue.miny?pe.miny:ue.miny,le.maxx=pe.maxx>ue.maxx?pe.maxx:ue.maxx,le.maxy=pe.maxy>ue.maxy?pe.maxy:ue.maxy;var he=ae.height,ce=se.height;c.height=1+(he>ce?he:ce),c=c.parent}}else{a.root=p,p.parent=null;var _e=s;_e.height=-1;var de=_e.aabb;null!=de.outer&&(de.outer.zpp_inner=null,de.outer=null),de.wrap_min=de.wrap_max=null,de._invalidate=null,de._validate=null,de.next=t.geom.ZPP_AABB.zpp_pool,t.geom.ZPP_AABB.zpp_pool=de,_e.child1=_e.child2=_e.parent=null,_e.next=null,_e.snext=null,_e.mnext=null,_e.next=t.space.ZPP_AABBNode.zpp_pool,t.space.ZPP_AABBNode.zpp_pool=_e}}}var me=r.aabb;if(!e.continuous&&o.zip_aabb&&null!=o.body)if(o.zip_aabb=!1,0==o.type){var Pe=o.circle;if(Pe.zip_worldCOM&&null!=Pe.body){if(Pe.zip_worldCOM=!1,Pe.zip_localCOM){if(Pe.zip_localCOM=!1,1==Pe.type){var fe=Pe.polygon;if(null==fe.lverts.next)throw new n._Boot.HaxeError("Error: An empty polygon has no meaningful localCOM");if(null==fe.lverts.next.next)fe.localCOMx=fe.lverts.next.x,fe.localCOMy=fe.lverts.next.y;else if(null==fe.lverts.next.next.next)fe.localCOMx=fe.lverts.next.x,fe.localCOMy=fe.lverts.next.y,fe.localCOMx+=1*fe.lverts.next.next.x,fe.localCOMy+=1*fe.lverts.next.next.y,fe.localCOMx*=.5,fe.localCOMy*=.5;else{fe.localCOMx=0,fe.localCOMy=0;var xe=0,ye=fe.lverts.next,ve=ye,ge=ye=ye.next;for(ye=ye.next;null!=ye;){var be=ye;xe+=ge.x*(be.y-ve.y);var ze=be.y*ge.x-be.x*ge.y;fe.localCOMx+=(ge.x+be.x)*ze,fe.localCOMy+=(ge.y+be.y)*ze,ve=ge,ge=be,ye=ye.next}var we=ye=fe.lverts.next;xe+=ge.x*(we.y-ve.y);var Ze=we.y*ge.x-we.x*ge.y;fe.localCOMx+=(ge.x+we.x)*Ze,fe.localCOMy+=(ge.y+we.y)*Ze,ve=ge,ge=we;var Ee=ye=ye.next;xe+=ge.x*(Ee.y-ve.y);var Me=Ee.y*ge.x-Ee.x*ge.y;fe.localCOMx+=(ge.x+Ee.x)*Me,fe.localCOMy+=(ge.y+Ee.y)*Me;var Se=xe=1/(3*xe);fe.localCOMx*=Se,fe.localCOMy*=Se}}null!=Pe.wrap_localCOM&&(Pe.wrap_localCOM.zpp_inner.x=Pe.localCOMx,Pe.wrap_localCOM.zpp_inner.y=Pe.localCOMy)}var Ce=Pe.body;Ce.zip_axis&&(Ce.zip_axis=!1,Ce.axisx=Math.sin(Ce.rot),Ce.axisy=Math.cos(Ce.rot)),Pe.worldCOMx=Pe.body.posx+(Pe.body.axisy*Pe.localCOMx-Pe.body.axisx*Pe.localCOMy),Pe.worldCOMy=Pe.body.posy+(Pe.localCOMx*Pe.body.axisx+Pe.localCOMy*Pe.body.axisy)}var Ne=Pe.radius,Ae=Pe.radius;Pe.aabb.minx=Pe.worldCOMx-Ne,Pe.aabb.miny=Pe.worldCOMy-Ae,Pe.aabb.maxx=Pe.worldCOMx+Ne,Pe.aabb.maxy=Pe.worldCOMy+Ae}else{var Le=o.polygon;if(Le.zip_gverts&&null!=Le.body){Le.zip_gverts=!1,Le.validate_lverts();var Be=Le.body;Be.zip_axis&&(Be.zip_axis=!1,Be.axisx=Math.sin(Be.rot),Be.axisy=Math.cos(Be.rot));for(var Te=Le.lverts.next,Ve=Le.gverts.next;null!=Ve;){var ke=Ve,Ie=Te;Te=Te.next,ke.x=Le.body.posx+(Le.body.axisy*Ie.x-Le.body.axisx*Ie.y),ke.y=Le.body.posy+(Ie.x*Le.body.axisx+Ie.y*Le.body.axisy),Ve=Ve.next}}if(null==Le.lverts.next)throw new n._Boot.HaxeError("Error: An empty polygon has no meaningful bounds");var Oe=Le.gverts.next;Le.aabb.minx=Oe.x,Le.aabb.miny=Oe.y,Le.aabb.maxx=Oe.x,Le.aabb.maxy=Oe.y;for(var Re=Le.gverts.next.next;null!=Re;){var He=Re;He.x<Le.aabb.minx&&(Le.aabb.minx=He.x),He.x>Le.aabb.maxx&&(Le.aabb.maxx=He.x),He.y<Le.aabb.miny&&(Le.aabb.miny=He.y),He.y>Le.aabb.maxy&&(Le.aabb.maxy=He.y),Re=Re.next}}var Fe=o.aabb;me.minx=Fe.minx-3,me.miny=Fe.miny-3,me.maxx=Fe.maxx+3,me.maxy=Fe.maxy+3;var De=(r.dyn=1!=o.body.type&&!o.body.component.sleeping)?this.dtree:this.stree;if(null==De.root)De.root=r,De.root.parent=null;else{for(var Ge=r.aabb,Ue=De.root;null!=Ue.child1;){var je=Ue.child1,We=Ue.child2,qe=Ue.aabb,Je=2*(qe.maxx-qe.minx+(qe.maxy-qe.miny)),$e=t.space.ZPP_AABBTree.tmpaabb,Xe=Ue.aabb;$e.minx=Xe.minx<Ge.minx?Xe.minx:Ge.minx,$e.miny=Xe.miny<Ge.miny?Xe.miny:Ge.miny,$e.maxx=Xe.maxx>Ge.maxx?Xe.maxx:Ge.maxx,$e.maxy=Xe.maxy>Ge.maxy?Xe.maxy:Ge.maxy;var Ye,Ke=t.space.ZPP_AABBTree.tmpaabb,Qe=2*(Ke.maxx-Ke.minx+(Ke.maxy-Ke.miny)),et=2*Qe,tt=2*(Qe-Je),nt=t.space.ZPP_AABBTree.tmpaabb,it=je.aabb;if(nt.minx=Ge.minx<it.minx?Ge.minx:it.minx,nt.miny=Ge.miny<it.miny?Ge.miny:it.miny,nt.maxx=Ge.maxx>it.maxx?Ge.maxx:it.maxx,nt.maxy=Ge.maxy>it.maxy?Ge.maxy:it.maxy,null==je.child1){var rt=t.space.ZPP_AABBTree.tmpaabb;Ye=2*(rt.maxx-rt.minx+(rt.maxy-rt.miny))+tt}else{var ot=je.aabb,at=2*(ot.maxx-ot.minx+(ot.maxy-ot.miny)),st=t.space.ZPP_AABBTree.tmpaabb;Ye=2*(st.maxx-st.minx+(st.maxy-st.miny))-at+tt}var lt,pt=t.space.ZPP_AABBTree.tmpaabb,ut=We.aabb;if(pt.minx=Ge.minx<ut.minx?Ge.minx:ut.minx,pt.miny=Ge.miny<ut.miny?Ge.miny:ut.miny,pt.maxx=Ge.maxx>ut.maxx?Ge.maxx:ut.maxx,pt.maxy=Ge.maxy>ut.maxy?Ge.maxy:ut.maxy,null==We.child1){var ht=t.space.ZPP_AABBTree.tmpaabb;lt=2*(ht.maxx-ht.minx+(ht.maxy-ht.miny))+tt}else{var ct=We.aabb,_t=2*(ct.maxx-ct.minx+(ct.maxy-ct.miny)),dt=t.space.ZPP_AABBTree.tmpaabb;lt=2*(dt.maxx-dt.minx+(dt.maxy-dt.miny))-_t+tt}if(et<Ye&&et<lt)break;Ue=Ye<lt?je:We}var mt,Pt=Ue,ft=Pt.parent;null==t.space.ZPP_AABBNode.zpp_pool?mt=new t.space.ZPP_AABBNode:(mt=t.space.ZPP_AABBNode.zpp_pool,t.space.ZPP_AABBNode.zpp_pool=mt.next,mt.next=null),null==t.geom.ZPP_AABB.zpp_pool?mt.aabb=new t.geom.ZPP_AABB:(mt.aabb=t.geom.ZPP_AABB.zpp_pool,t.geom.ZPP_AABB.zpp_pool=mt.aabb.next,mt.aabb.next=null),mt.moved=!1,mt.synced=!1,mt.first_sync=!1,mt.parent=ft;var xt=mt.aabb,yt=Pt.aabb;for(xt.minx=Ge.minx<yt.minx?Ge.minx:yt.minx,xt.miny=Ge.miny<yt.miny?Ge.miny:yt.miny,xt.maxx=Ge.maxx>yt.maxx?Ge.maxx:yt.maxx,xt.maxy=Ge.maxy>yt.maxy?Ge.maxy:yt.maxy,mt.height=Pt.height+1,null!=ft?(ft.child1==Pt?ft.child1=mt:ft.child2=mt,mt.child1=Pt,mt.child2=r,Pt.parent=mt,r.parent=mt):(mt.child1=Pt,mt.child2=r,Pt.parent=mt,r.parent=mt,De.root=mt),Ue=r.parent;null!=Ue;){if(null==Ue.child1||Ue.height<2)Ue=Ue;else{var vt=Ue.child1,gt=Ue.child2,bt=gt.height-vt.height;if(bt>1){var zt=gt.child1,wt=gt.child2;if(gt.child1=Ue,gt.parent=Ue.parent,Ue.parent=gt,null!=gt.parent?gt.parent.child1==Ue?gt.parent.child1=gt:gt.parent.child2=gt:De.root=gt,zt.height>wt.height){gt.child2=zt,Ue.child2=wt,wt.parent=Ue;var Zt=Ue.aabb,Et=vt.aabb,Mt=wt.aabb;Zt.minx=Et.minx<Mt.minx?Et.minx:Mt.minx,Zt.miny=Et.miny<Mt.miny?Et.miny:Mt.miny,Zt.maxx=Et.maxx>Mt.maxx?Et.maxx:Mt.maxx,Zt.maxy=Et.maxy>Mt.maxy?Et.maxy:Mt.maxy;var St=gt.aabb,Ct=Ue.aabb,Nt=zt.aabb;St.minx=Ct.minx<Nt.minx?Ct.minx:Nt.minx,St.miny=Ct.miny<Nt.miny?Ct.miny:Nt.miny,St.maxx=Ct.maxx>Nt.maxx?Ct.maxx:Nt.maxx,St.maxy=Ct.maxy>Nt.maxy?Ct.maxy:Nt.maxy;var At=vt.height,Lt=wt.height;Ue.height=1+(At>Lt?At:Lt);var Bt=Ue.height,Tt=zt.height;gt.height=1+(Bt>Tt?Bt:Tt)}else{gt.child2=wt,Ue.child2=zt,zt.parent=Ue;var Vt=Ue.aabb,kt=vt.aabb,It=zt.aabb;Vt.minx=kt.minx<It.minx?kt.minx:It.minx,Vt.miny=kt.miny<It.miny?kt.miny:It.miny,Vt.maxx=kt.maxx>It.maxx?kt.maxx:It.maxx,Vt.maxy=kt.maxy>It.maxy?kt.maxy:It.maxy;var Ot=gt.aabb,Rt=Ue.aabb,Ht=wt.aabb;Ot.minx=Rt.minx<Ht.minx?Rt.minx:Ht.minx,Ot.miny=Rt.miny<Ht.miny?Rt.miny:Ht.miny,Ot.maxx=Rt.maxx>Ht.maxx?Rt.maxx:Ht.maxx,Ot.maxy=Rt.maxy>Ht.maxy?Rt.maxy:Ht.maxy;var Ft=vt.height,Dt=zt.height;Ue.height=1+(Ft>Dt?Ft:Dt);var Gt=Ue.height,Ut=wt.height;gt.height=1+(Gt>Ut?Gt:Ut)}Ue=gt}else if(bt<-1){var jt=vt.child1,Wt=vt.child2;if(vt.child1=Ue,vt.parent=Ue.parent,Ue.parent=vt,null!=vt.parent?vt.parent.child1==Ue?vt.parent.child1=vt:vt.parent.child2=vt:De.root=vt,jt.height>Wt.height){vt.child2=jt,Ue.child1=Wt,Wt.parent=Ue;var qt=Ue.aabb,Jt=gt.aabb,$t=Wt.aabb;qt.minx=Jt.minx<$t.minx?Jt.minx:$t.minx,qt.miny=Jt.miny<$t.miny?Jt.miny:$t.miny,qt.maxx=Jt.maxx>$t.maxx?Jt.maxx:$t.maxx,qt.maxy=Jt.maxy>$t.maxy?Jt.maxy:$t.maxy;var Xt=vt.aabb,Yt=Ue.aabb,Kt=jt.aabb;Xt.minx=Yt.minx<Kt.minx?Yt.minx:Kt.minx,Xt.miny=Yt.miny<Kt.miny?Yt.miny:Kt.miny,Xt.maxx=Yt.maxx>Kt.maxx?Yt.maxx:Kt.maxx,Xt.maxy=Yt.maxy>Kt.maxy?Yt.maxy:Kt.maxy;var Qt=gt.height,en=Wt.height;Ue.height=1+(Qt>en?Qt:en);var tn=Ue.height,nn=jt.height;vt.height=1+(tn>nn?tn:nn)}else{vt.child2=Wt,Ue.child1=jt,jt.parent=Ue;var rn=Ue.aabb,on=gt.aabb,an=jt.aabb;rn.minx=on.minx<an.minx?on.minx:an.minx,rn.miny=on.miny<an.miny?on.miny:an.miny,rn.maxx=on.maxx>an.maxx?on.maxx:an.maxx,rn.maxy=on.maxy>an.maxy?on.maxy:an.maxy;var sn=vt.aabb,ln=Ue.aabb,pn=Wt.aabb;sn.minx=ln.minx<pn.minx?ln.minx:pn.minx,sn.miny=ln.miny<pn.miny?ln.miny:pn.miny,sn.maxx=ln.maxx>pn.maxx?ln.maxx:pn.maxx,sn.maxy=ln.maxy>pn.maxy?ln.maxy:pn.maxy;var un=gt.height,hn=jt.height;Ue.height=1+(un>hn?un:hn);var cn=Ue.height,_n=Wt.height;vt.height=1+(cn>_n?cn:_n)}Ue=vt}else Ue=Ue}var dn=Ue.child1,mn=Ue.child2,Pn=dn.height,fn=mn.height;Ue.height=1+(Pn>fn?Pn:fn);var xn=Ue.aabb,yn=dn.aabb,vn=mn.aabb;xn.minx=yn.minx<vn.minx?yn.minx:vn.minx,xn.miny=yn.miny<vn.miny?yn.miny:vn.miny,xn.maxx=yn.maxx>vn.maxx?yn.maxx:vn.maxx,xn.maxy=yn.maxy>vn.maxy?yn.maxy:vn.maxy,Ue=Ue.parent}}r.synced=!1,r=r.snext}for(;null!=this.syncs;){var gn=this.syncs;this.syncs=gn.snext,gn.snext=null;var bn=gn;if(!bn.moved){bn.moved=!1;var zn=bn.shape;if(!zn.body.component.sleeping){var wn=bn.aabb,Zn=null;for(null!=this.dtree.root&&(this.dtree.root.next=Zn,Zn=this.dtree.root);null!=Zn;){var En=Zn;Zn=En.next,En.next=null;var Mn=En;if(Mn!=bn)if(null==Mn.child1){var Sn=Mn.shape;if(Sn.body!=zn.body&&(1!=Sn.body.type||1!=zn.body.type)){var Cn=Mn.aabb;if(Cn.miny<=wn.maxy&&wn.miny<=Cn.maxy&&Cn.minx<=wn.maxx&&wn.minx<=Cn.maxx){var Nn,An;zn.id<Sn.id?(Nn=zn.id,An=Sn.id):(Nn=Sn.id,An=zn.id);for(var Ln=null,Bn=(zn.pairs.length<Sn.pairs.length?zn:Sn).pairs.head;null!=Bn;){var Tn=Bn.elt;if(Tn.id==Nn&&Tn.di==An){Ln=Tn;break}Bn=Bn.next}if(null!=Ln){Ln.sleeping&&(Ln.sleeping=!1,Ln.next=this.pairs,this.pairs=Ln,Ln.first=!0);continue}null==t.space.ZPP_AABBPair.zpp_pool?Ln=new t.space.ZPP_AABBPair:(Ln=t.space.ZPP_AABBPair.zpp_pool,t.space.ZPP_AABBPair.zpp_pool=Ln.next,Ln.next=null),Ln.n1=bn,Ln.n2=Mn,Ln.id=Nn,Ln.di=An,Ln.next=this.pairs,this.pairs=Ln,Ln.first=!0;var Vn,kn=zn.pairs;null==t.util.ZNPNode_ZPP_AABBPair.zpp_pool?Vn=new t.util.ZNPNode_ZPP_AABBPair:(Vn=t.util.ZNPNode_ZPP_AABBPair.zpp_pool,t.util.ZNPNode_ZPP_AABBPair.zpp_pool=Vn.next,Vn.next=null),Vn.elt=Ln;var In=Vn;In.next=kn.head,kn.head=In,kn.modified=!0,kn.length++;var On,Rn=Sn.pairs;null==t.util.ZNPNode_ZPP_AABBPair.zpp_pool?On=new t.util.ZNPNode_ZPP_AABBPair:(On=t.util.ZNPNode_ZPP_AABBPair.zpp_pool,t.util.ZNPNode_ZPP_AABBPair.zpp_pool=On.next,On.next=null),On.elt=Ln;var Hn=On;Hn.next=Rn.head,Rn.head=Hn,Rn.modified=!0,Rn.length++}}}else{var Fn=Mn.aabb;Fn.miny<=wn.maxy&&wn.miny<=Fn.maxy&&Fn.minx<=wn.maxx&&wn.minx<=Fn.maxx&&(null!=Mn.child1&&(Mn.child1.next=Zn,Zn=Mn.child1),null!=Mn.child2&&(Mn.child2.next=Zn,Zn=Mn.child2))}}for(null!=this.stree.root&&(this.stree.root.next=Zn,Zn=this.stree.root);null!=Zn;){var Dn=Zn;Zn=Dn.next,Dn.next=null;var Gn=Dn;if(Gn!=bn)if(null==Gn.child1){var Un=Gn.shape;if(Un.body!=zn.body&&(1!=Un.body.type||1!=zn.body.type)){var jn=Gn.aabb;if(jn.miny<=wn.maxy&&wn.miny<=jn.maxy&&jn.minx<=wn.maxx&&wn.minx<=jn.maxx){var Wn,qn;zn.id<Un.id?(Wn=zn.id,qn=Un.id):(Wn=Un.id,qn=zn.id);for(var Jn=null,$n=(zn.pairs.length<Un.pairs.length?zn:Un).pairs.head;null!=$n;){var Xn=$n.elt;if(Xn.id==Wn&&Xn.di==qn){Jn=Xn;break}$n=$n.next}if(null!=Jn){Jn.sleeping&&(Jn.sleeping=!1,Jn.next=this.pairs,this.pairs=Jn,Jn.first=!0);continue}null==t.space.ZPP_AABBPair.zpp_pool?Jn=new t.space.ZPP_AABBPair:(Jn=t.space.ZPP_AABBPair.zpp_pool,t.space.ZPP_AABBPair.zpp_pool=Jn.next,Jn.next=null),Jn.n1=bn,Jn.n2=Gn,Jn.id=Wn,Jn.di=qn,Jn.next=this.pairs,this.pairs=Jn,Jn.first=!0;var Yn,Kn=zn.pairs;null==t.util.ZNPNode_ZPP_AABBPair.zpp_pool?Yn=new t.util.ZNPNode_ZPP_AABBPair:(Yn=t.util.ZNPNode_ZPP_AABBPair.zpp_pool,t.util.ZNPNode_ZPP_AABBPair.zpp_pool=Yn.next,Yn.next=null),Yn.elt=Jn;var Qn=Yn;Qn.next=Kn.head,Kn.head=Qn,Kn.modified=!0,Kn.length++;var ei,ti=Un.pairs;null==t.util.ZNPNode_ZPP_AABBPair.zpp_pool?ei=new t.util.ZNPNode_ZPP_AABBPair:(ei=t.util.ZNPNode_ZPP_AABBPair.zpp_pool,t.util.ZNPNode_ZPP_AABBPair.zpp_pool=ei.next,ei.next=null),ei.elt=Jn;var ni=ei;ni.next=ti.head,ti.head=ni,ti.modified=!0,ti.length++}}}else{var ii=Gn.aabb;ii.miny<=wn.maxy&&wn.miny<=ii.maxy&&ii.minx<=wn.maxx&&wn.minx<=ii.maxx&&(null!=Gn.child1&&(Gn.child1.next=Zn,Zn=Gn.child1),null!=Gn.child2&&(Gn.child2.next=Zn,Zn=Gn.child2))}}}}}for(;null!=this.moves;){var ri=this.moves;this.moves=ri.mnext,ri.mnext=null;var oi=ri;oi.moved=!1;var ai=oi.shape;if(!ai.body.component.sleeping){var si=oi.aabb,li=null;for(null!=this.dtree.root&&(this.dtree.root.next=li,li=this.dtree.root);null!=li;){var pi=li;li=pi.next,pi.next=null;var ui=pi;if(ui!=oi)if(null==ui.child1){var hi=ui.shape;if(hi.body!=ai.body&&(1!=hi.body.type||1!=ai.body.type)){var ci=ui.aabb;if(ci.miny<=si.maxy&&si.miny<=ci.maxy&&ci.minx<=si.maxx&&si.minx<=ci.maxx){var _i,di;ai.id<hi.id?(_i=ai.id,di=hi.id):(_i=hi.id,di=ai.id);for(var mi=null,Pi=(ai.pairs.length<hi.pairs.length?ai:hi).pairs.head;null!=Pi;){var fi=Pi.elt;if(fi.id==_i&&fi.di==di){mi=fi;break}Pi=Pi.next}if(null!=mi){mi.sleeping&&(mi.sleeping=!1,mi.next=this.pairs,this.pairs=mi,mi.first=!0);continue}null==t.space.ZPP_AABBPair.zpp_pool?mi=new t.space.ZPP_AABBPair:(mi=t.space.ZPP_AABBPair.zpp_pool,t.space.ZPP_AABBPair.zpp_pool=mi.next,mi.next=null),mi.n1=oi,mi.n2=ui,mi.id=_i,mi.di=di,mi.next=this.pairs,this.pairs=mi,mi.first=!0;var xi,yi=ai.pairs;null==t.util.ZNPNode_ZPP_AABBPair.zpp_pool?xi=new t.util.ZNPNode_ZPP_AABBPair:(xi=t.util.ZNPNode_ZPP_AABBPair.zpp_pool,t.util.ZNPNode_ZPP_AABBPair.zpp_pool=xi.next,xi.next=null),xi.elt=mi;var vi=xi;vi.next=yi.head,yi.head=vi,yi.modified=!0,yi.length++;var gi,bi=hi.pairs;null==t.util.ZNPNode_ZPP_AABBPair.zpp_pool?gi=new t.util.ZNPNode_ZPP_AABBPair:(gi=t.util.ZNPNode_ZPP_AABBPair.zpp_pool,t.util.ZNPNode_ZPP_AABBPair.zpp_pool=gi.next,gi.next=null),gi.elt=mi;var zi=gi;zi.next=bi.head,bi.head=zi,bi.modified=!0,bi.length++}}}else{var wi=ui.aabb;wi.miny<=si.maxy&&si.miny<=wi.maxy&&wi.minx<=si.maxx&&si.minx<=wi.maxx&&(null!=ui.child1&&(ui.child1.next=li,li=ui.child1),null!=ui.child2&&(ui.child2.next=li,li=ui.child2))}}for(null!=this.stree.root&&(this.stree.root.next=li,li=this.stree.root);null!=li;){var Zi=li;li=Zi.next,Zi.next=null;var Ei=Zi;if(Ei!=oi)if(null==Ei.child1){var Mi=Ei.shape;if(Mi.body!=ai.body&&(1!=Mi.body.type||1!=ai.body.type)){var Si=Ei.aabb;if(Si.miny<=si.maxy&&si.miny<=Si.maxy&&Si.minx<=si.maxx&&si.minx<=Si.maxx){var Ci,Ni;ai.id<Mi.id?(Ci=ai.id,Ni=Mi.id):(Ci=Mi.id,Ni=ai.id);for(var Ai=null,Li=(ai.pairs.length<Mi.pairs.length?ai:Mi).pairs.head;null!=Li;){var Bi=Li.elt;if(Bi.id==Ci&&Bi.di==Ni){Ai=Bi;break}Li=Li.next}if(null!=Ai){Ai.sleeping&&(Ai.sleeping=!1,Ai.next=this.pairs,this.pairs=Ai,Ai.first=!0);continue}null==t.space.ZPP_AABBPair.zpp_pool?Ai=new t.space.ZPP_AABBPair:(Ai=t.space.ZPP_AABBPair.zpp_pool,t.space.ZPP_AABBPair.zpp_pool=Ai.next,Ai.next=null),Ai.n1=oi,Ai.n2=Ei,Ai.id=Ci,Ai.di=Ni,Ai.next=this.pairs,this.pairs=Ai,Ai.first=!0;var Ti,Vi=ai.pairs;null==t.util.ZNPNode_ZPP_AABBPair.zpp_pool?Ti=new t.util.ZNPNode_ZPP_AABBPair:(Ti=t.util.ZNPNode_ZPP_AABBPair.zpp_pool,t.util.ZNPNode_ZPP_AABBPair.zpp_pool=Ti.next,Ti.next=null),Ti.elt=Ai;var ki=Ti;ki.next=Vi.head,Vi.head=ki,Vi.modified=!0,Vi.length++;var Ii,Oi=Mi.pairs;null==t.util.ZNPNode_ZPP_AABBPair.zpp_pool?Ii=new t.util.ZNPNode_ZPP_AABBPair:(Ii=t.util.ZNPNode_ZPP_AABBPair.zpp_pool,t.util.ZNPNode_ZPP_AABBPair.zpp_pool=Ii.next,Ii.next=null),Ii.elt=Ai;var Ri=Ii;Ri.next=Oi.head,Oi.head=Ri,Oi.modified=!0,Oi.length++}}}else{var Hi=Ei.aabb;Hi.miny<=si.maxy&&si.miny<=Hi.maxy&&Hi.minx<=si.maxx&&si.minx<=Hi.maxx&&(null!=Ei.child1&&(Ei.child1.next=li,li=Ei.child1),null!=Ei.child2&&(Ei.child2.next=li,li=Ei.child2))}}}}for(var Fi=null,Di=this.pairs;null!=Di;){var Gi;if(Di.first)Gi=!1;else{var Ui=Di.n1.aabb,ji=Di.n2.aabb;Gi=!(ji.miny<=Ui.maxy&&Ui.miny<=ji.maxy&&ji.minx<=Ui.maxx&&Ui.minx<=ji.maxx)}if(Gi){null==Fi?this.pairs=Di.next:Fi.next=Di.next;for(var Wi=Di.n1.shape.pairs,qi=null,Ji=Wi.head;null!=Ji;){if(Ji.elt==Di){var $i,Xi;null==qi?(Xi=($i=Wi.head).next,Wi.head=Xi,null==Wi.head&&(Wi.pushmod=!0)):(Xi=($i=qi.next).next,qi.next=Xi,null==Xi&&(Wi.pushmod=!0));var Yi=$i;Yi.elt=null,Yi.next=t.util.ZNPNode_ZPP_AABBPair.zpp_pool,t.util.ZNPNode_ZPP_AABBPair.zpp_pool=Yi,Wi.modified=!0,Wi.length--,Wi.pushmod=!0;break}qi=Ji,Ji=Ji.next}for(var Ki=Di.n2.shape.pairs,Qi=null,er=Ki.head;null!=er;){if(er.elt==Di){var tr,nr;null==Qi?(nr=(tr=Ki.head).next,Ki.head=nr,null==Ki.head&&(Ki.pushmod=!0)):(nr=(tr=Qi.next).next,Qi.next=nr,null==nr&&(Ki.pushmod=!0));var ir=tr;ir.elt=null,ir.next=t.util.ZNPNode_ZPP_AABBPair.zpp_pool,t.util.ZNPNode_ZPP_AABBPair.zpp_pool=ir,Ki.modified=!0,Ki.length--,Ki.pushmod=!0;break}Qi=er,er=er.next}var rr=Di.next;null!=Di.arb&&(Di.arb.pair=null),Di.arb=null;var or=Di;or.n1=or.n2=null,or.sleeping=!1,or.next=t.space.ZPP_AABBPair.zpp_pool,t.space.ZPP_AABBPair.zpp_pool=or,Di=rr}else{var ar=Di.n1.shape,sr=ar.body,lr=Di.n2.shape,pr=lr.body;if(Di.first||!sr.component.sleeping&&1!=sr.type||!pr.component.sleeping&&1!=pr.type){Di.first=!1;var ur=ar.aabb,hr=lr.aabb;if(hr.miny<=ur.maxy&&ur.miny<=hr.maxy&&hr.minx<=ur.maxx&&ur.minx<=hr.maxx){var cr=Di.arb;Di.arb=i?e.narrowPhase(ar,lr,2!=sr.type||2!=pr.type,Di.arb,!1):e.continuousEvent(ar,lr,2!=sr.type||2!=pr.type,Di.arb,!1),null==Di.arb?null!=cr&&(cr.pair=null):Di.arb.pair=Di}Fi=Di,Di=Di.next}else Di.sleeping=!0,null==Fi?this.pairs=Di.next:Fi.next=Di.next,Di=Di.next}}},t.space.ZPP_DynAABBPhase.prototype.clear=function(){for(;null!=this.syncs;){var e=this.syncs.snext;this.syncs.snext=null,this.syncs.first_sync&&(this.syncs.shape.node=null,this.syncs.shape.removedFromSpace(),this.syncs.shape=null),this.syncs=e}for(;null!=this.moves;){var n=this.moves.mnext;this.moves.mnext=null,this.moves.first_sync&&(this.moves.shape.node=null,this.moves.shape.removedFromSpace(),this.moves.shape=null),this.moves=n}for(;null!=this.pairs;){var i=this.pairs.next;null!=this.pairs.arb&&(this.pairs.arb.pair=null),this.pairs.arb=null;for(var r=this.pairs.n1.shape.pairs,o=this.pairs,a=null,s=r.head;null!=s;){if(s.elt==o){var l,p;null==a?(p=(l=r.head).next,r.head=p,null==r.head&&(r.pushmod=!0)):(p=(l=a.next).next,a.next=p,null==p&&(r.pushmod=!0));var u=l;u.elt=null,u.next=t.util.ZNPNode_ZPP_AABBPair.zpp_pool,t.util.ZNPNode_ZPP_AABBPair.zpp_pool=u,r.modified=!0,r.length--,r.pushmod=!0;break}a=s,s=s.next}for(var h=this.pairs.n2.shape.pairs,c=this.pairs,_=null,d=h.head;null!=d;){if(d.elt==c){var m,P;null==_?(P=(m=h.head).next,h.head=P,null==h.head&&(h.pushmod=!0)):(P=(m=_.next).next,_.next=P,null==P&&(h.pushmod=!0));var f=m;f.elt=null,f.next=t.util.ZNPNode_ZPP_AABBPair.zpp_pool,t.util.ZNPNode_ZPP_AABBPair.zpp_pool=f,h.modified=!0,h.length--,h.pushmod=!0;break}_=d,d=d.next}var x=this.pairs;x.n1=x.n2=null,x.sleeping=!1,x.next=t.space.ZPP_AABBPair.zpp_pool,t.space.ZPP_AABBPair.zpp_pool=x,this.pairs=i}this.dtree.clear(),this.stree.clear()},t.space.ZPP_DynAABBPhase.prototype.treeStack=null,t.space.ZPP_DynAABBPhase.prototype.shapesUnderPoint=function(n,i,r,o){var a;this.sync_broadphase(),null==t.geom.ZPP_Vec2.zpp_pool?a=new t.geom.ZPP_Vec2:(a=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=a.next,a.next=null),a.weak=!1,a._immutable=!1,a.x=n,a.y=i;var s=a,l=null==o?new e.shape.ShapeList:o;if(null!=this.stree.root)for(null==this.treeStack&&(this.treeStack=new t.util.ZNPList_ZPP_AABBNode),this.treeStack.add(this.stree.root);null!=this.treeStack.head;){var p=this.treeStack.pop_unsafe(),u=p.aabb;if(s.x>=u.minx&&s.x<=u.maxx&&s.y>=u.miny&&s.y<=u.maxy)if(null==p.child1){var h;if(null!=r){var c=p.shape.filter;h=0!=(c.collisionMask&r.collisionGroup)&&0!=(r.collisionMask&c.collisionGroup)}else h=!0;h&&(0==p.shape.type?t.geom.ZPP_Collide.circleContains(p.shape.circle,s)&&l.push(p.shape.outer):t.geom.ZPP_Collide.polyContains(p.shape.polygon,s)&&l.push(p.shape.outer))}else null!=p.child1&&this.treeStack.add(p.child1),null!=p.child2&&this.treeStack.add(p.child2)}if(null!=this.dtree.root)for(null==this.treeStack&&(this.treeStack=new t.util.ZNPList_ZPP_AABBNode),this.treeStack.add(this.dtree.root);null!=this.treeStack.head;){var _=this.treeStack.pop_unsafe(),d=_.aabb;if(s.x>=d.minx&&s.x<=d.maxx&&s.y>=d.miny&&s.y<=d.maxy)if(null==_.child1){var m;if(null!=r){var P=_.shape.filter;m=0!=(P.collisionMask&r.collisionGroup)&&0!=(r.collisionMask&P.collisionGroup)}else m=!0;m&&(0==_.shape.type?t.geom.ZPP_Collide.circleContains(_.shape.circle,s)&&l.push(_.shape.outer):t.geom.ZPP_Collide.polyContains(_.shape.polygon,s)&&l.push(_.shape.outer))}else null!=_.child1&&this.treeStack.add(_.child1),null!=_.child2&&this.treeStack.add(_.child2)}var f=s;return null!=f.outer&&(f.outer.zpp_inner=null,f.outer=null),f._isimmutable=null,f._validate=null,f._invalidate=null,f.next=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=f,l},t.space.ZPP_DynAABBPhase.prototype.bodiesUnderPoint=function(n,i,r,o){var a;this.sync_broadphase(),null==t.geom.ZPP_Vec2.zpp_pool?a=new t.geom.ZPP_Vec2:(a=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=a.next,a.next=null),a.weak=!1,a._immutable=!1,a.x=n,a.y=i;var s=a,l=null==o?new e.phys.BodyList:o;if(null!=this.stree.root)for(null==this.treeStack&&(this.treeStack=new t.util.ZNPList_ZPP_AABBNode),this.treeStack.add(this.stree.root);null!=this.treeStack.head;){var p=this.treeStack.pop_unsafe(),u=p.aabb;if(s.x>=u.minx&&s.x<=u.maxx&&s.y>=u.miny&&s.y<=u.maxy)if(null==p.child1){var h=p.shape.body.outer;if(!l.has(h)){var c;if(null!=r){var _=p.shape.filter;c=0!=(_.collisionMask&r.collisionGroup)&&0!=(r.collisionMask&_.collisionGroup)}else c=!0;c&&(0==p.shape.type?t.geom.ZPP_Collide.circleContains(p.shape.circle,s)&&l.push(h):t.geom.ZPP_Collide.polyContains(p.shape.polygon,s)&&l.push(h))}}else null!=p.child1&&this.treeStack.add(p.child1),null!=p.child2&&this.treeStack.add(p.child2)}if(null!=this.dtree.root)for(null==this.treeStack&&(this.treeStack=new t.util.ZNPList_ZPP_AABBNode),this.treeStack.add(this.dtree.root);null!=this.treeStack.head;){var d=this.treeStack.pop_unsafe(),m=d.aabb;if(s.x>=m.minx&&s.x<=m.maxx&&s.y>=m.miny&&s.y<=m.maxy)if(null==d.child1){var P=d.shape.body.outer;if(!l.has(P)){var f;if(null!=r){var x=d.shape.filter;f=0!=(x.collisionMask&r.collisionGroup)&&0!=(r.collisionMask&x.collisionGroup)}else f=!0;f&&(0==d.shape.type?t.geom.ZPP_Collide.circleContains(d.shape.circle,s)&&l.push(P):t.geom.ZPP_Collide.polyContains(d.shape.polygon,s)&&l.push(P))}}else null!=d.child1&&this.treeStack.add(d.child1),null!=d.child2&&this.treeStack.add(d.child2)}var y=s;return null!=y.outer&&(y.outer.zpp_inner=null,y.outer=null),y._isimmutable=null,y._validate=null,y._invalidate=null,y.next=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=y,l},t.space.ZPP_DynAABBPhase.prototype.treeStack2=null,t.space.ZPP_DynAABBPhase.prototype.shapesInAABB=function(n,i,r,o,a){this.sync_broadphase(),this.updateAABBShape(n);var s=this.aabbShape.zpp_inner.aabb,l=null==a?new e.shape.ShapeList:a;if(null!=this.stree.root)for(null==this.treeStack&&(this.treeStack=new t.util.ZNPList_ZPP_AABBNode),this.treeStack.add(this.stree.root);null!=this.treeStack.head;){var p=this.treeStack.pop_unsafe(),u=p.aabb;if(u.minx>=s.minx&&u.miny>=s.miny&&u.maxx<=s.maxx&&u.maxy<=s.maxy)if(null==p.child1){var h;if(null!=o){var c=p.shape.filter;h=0!=(c.collisionMask&o.collisionGroup)&&0!=(o.collisionMask&c.collisionGroup)}else h=!0;h&&l.push(p.shape.outer)}else for(null==this.treeStack2&&(this.treeStack2=new t.util.ZNPList_ZPP_AABBNode),this.treeStack2.add(p);null!=this.treeStack2.head;){var _=this.treeStack2.pop_unsafe();if(null==_.child1){var d;if(null!=o){var m=_.shape.filter;d=0!=(m.collisionMask&o.collisionGroup)&&0!=(o.collisionMask&m.collisionGroup)}else d=!0;d&&l.push(_.shape.outer)}else null!=_.child1&&this.treeStack2.add(_.child1),null!=_.child2&&this.treeStack2.add(_.child2)}else{var P=p.aabb;if(s.miny<=P.maxy&&P.miny<=s.maxy&&s.minx<=P.maxx&&P.minx<=s.maxx)if(null==p.child1){var f;if(null!=o){var x=p.shape.filter;f=0!=(x.collisionMask&o.collisionGroup)&&0!=(o.collisionMask&x.collisionGroup)}else f=!0;if(f)if(i)if(r)t.geom.ZPP_Collide.containTest(this.aabbShape.zpp_inner,p.shape)&&l.push(p.shape.outer);else{var y=p.shape.aabb;(y.minx>=s.minx&&y.miny>=s.miny&&y.maxx<=s.maxx&&y.maxy<=s.maxy||t.geom.ZPP_Collide.testCollide_safe(p.shape,this.aabbShape.zpp_inner))&&l.push(p.shape.outer)}else{var v;if(r){var g=p.shape.aabb;v=g.minx>=s.minx&&g.miny>=s.miny&&g.maxx<=s.maxx&&g.maxy<=s.maxy}else v=!0;v&&l.push(p.shape.outer)}}else null!=p.child1&&this.treeStack.add(p.child1),null!=p.child2&&this.treeStack.add(p.child2)}}if(null!=this.dtree.root)for(null==this.treeStack&&(this.treeStack=new t.util.ZNPList_ZPP_AABBNode),this.treeStack.add(this.dtree.root);null!=this.treeStack.head;){var b=this.treeStack.pop_unsafe(),z=b.aabb;if(z.minx>=s.minx&&z.miny>=s.miny&&z.maxx<=s.maxx&&z.maxy<=s.maxy)if(null==b.child1){var w;if(null!=o){var Z=b.shape.filter;w=0!=(Z.collisionMask&o.collisionGroup)&&0!=(o.collisionMask&Z.collisionGroup)}else w=!0;w&&l.push(b.shape.outer)}else for(null==this.treeStack2&&(this.treeStack2=new t.util.ZNPList_ZPP_AABBNode),this.treeStack2.add(b);null!=this.treeStack2.head;){var E=this.treeStack2.pop_unsafe();if(null==E.child1){var M;if(null!=o){var S=E.shape.filter;M=0!=(S.collisionMask&o.collisionGroup)&&0!=(o.collisionMask&S.collisionGroup)}else M=!0;M&&l.push(E.shape.outer)}else null!=E.child1&&this.treeStack2.add(E.child1),null!=E.child2&&this.treeStack2.add(E.child2)}else{var C=b.aabb;if(s.miny<=C.maxy&&C.miny<=s.maxy&&s.minx<=C.maxx&&C.minx<=s.maxx)if(null==b.child1){var N;if(null!=o){var A=b.shape.filter;N=0!=(A.collisionMask&o.collisionGroup)&&0!=(o.collisionMask&A.collisionGroup)}else N=!0;if(N)if(i)if(r)t.geom.ZPP_Collide.containTest(this.aabbShape.zpp_inner,b.shape)&&l.push(b.shape.outer);else{var L=b.shape.aabb;(L.minx>=s.minx&&L.miny>=s.miny&&L.maxx<=s.maxx&&L.maxy<=s.maxy||t.geom.ZPP_Collide.testCollide_safe(b.shape,this.aabbShape.zpp_inner))&&l.push(b.shape.outer)}else{var B;if(r){var T=b.shape.aabb;B=T.minx>=s.minx&&T.miny>=s.miny&&T.maxx<=s.maxx&&T.maxy<=s.maxy}else B=!0;B&&l.push(b.shape.outer)}}else null!=b.child1&&this.treeStack.add(b.child1),null!=b.child2&&this.treeStack.add(b.child2)}}return l},t.space.ZPP_DynAABBPhase.prototype.failed=null,t.space.ZPP_DynAABBPhase.prototype.bodiesInAABB=function(n,i,r,o,a){this.sync_broadphase(),this.updateAABBShape(n);var s=this.aabbShape.zpp_inner.aabb,l=null==a?new e.phys.BodyList:a;if(null==this.failed&&(this.failed=new e.phys.BodyList),null!=this.stree.root)for(null==this.treeStack&&(this.treeStack=new t.util.ZNPList_ZPP_AABBNode),this.treeStack.add(this.stree.root);null!=this.treeStack.head;){var p=this.treeStack.pop_unsafe(),u=p.aabb;if(u.minx>=s.minx&&u.miny>=s.miny&&u.maxx<=s.maxx&&u.maxy<=s.maxy)if(null==p.child1){var h;if(null!=o){var c=p.shape.filter;h=0!=(c.collisionMask&o.collisionGroup)&&0!=(o.collisionMask&c.collisionGroup)}else h=!0;if(h){var _=p.shape.body.outer;l.has(_)||l.push(_)}}else for(null==this.treeStack2&&(this.treeStack2=new t.util.ZNPList_ZPP_AABBNode),this.treeStack2.add(p);null!=this.treeStack2.head;){var d=this.treeStack2.pop_unsafe();if(null==d.child1){var m;if(null!=o){var P=d.shape.filter;m=0!=(P.collisionMask&o.collisionGroup)&&0!=(o.collisionMask&P.collisionGroup)}else m=!0;if(m){var f=d.shape.body.outer;l.has(f)||l.push(f)}}else null!=d.child1&&this.treeStack2.add(d.child1),null!=d.child2&&this.treeStack2.add(d.child2)}else{var x=p.aabb;if(s.miny<=x.maxy&&x.miny<=s.maxy&&s.minx<=x.maxx&&x.minx<=s.maxx)if(null==p.child1){var y,v=p.shape.body.outer;if(null!=o){var g=p.shape.filter;y=0!=(g.collisionMask&o.collisionGroup)&&0!=(o.collisionMask&g.collisionGroup)}else y=!0;if(y)if(i)if(r){if(!this.failed.has(v)){var b=t.geom.ZPP_Collide.containTest(this.aabbShape.zpp_inner,p.shape);!l.has(v)&&b?l.push(v):b||(l.remove(v),this.failed.push(v))}}else!l.has(v)&&t.geom.ZPP_Collide.testCollide_safe(p.shape,this.aabbShape.zpp_inner)&&l.push(v);else if(r){if(!this.failed.has(v)){var z=p.shape.aabb,w=z.minx>=s.minx&&z.miny>=s.miny&&z.maxx<=s.maxx&&z.maxy<=s.maxy;!l.has(v)&&w?l.push(v):w||(l.remove(v),this.failed.push(v))}}else{var Z;if(l.has(v))Z=!1;else{var E=p.shape.aabb;Z=E.minx>=s.minx&&E.miny>=s.miny&&E.maxx<=s.maxx&&E.maxy<=s.maxy}Z&&l.push(v)}}else null!=p.child1&&this.treeStack.add(p.child1),null!=p.child2&&this.treeStack.add(p.child2)}}if(null!=this.dtree.root)for(null==this.treeStack&&(this.treeStack=new t.util.ZNPList_ZPP_AABBNode),this.treeStack.add(this.dtree.root);null!=this.treeStack.head;){var M=this.treeStack.pop_unsafe(),S=M.aabb;if(S.minx>=s.minx&&S.miny>=s.miny&&S.maxx<=s.maxx&&S.maxy<=s.maxy)if(null==M.child1){var C;if(null!=o){var N=M.shape.filter;C=0!=(N.collisionMask&o.collisionGroup)&&0!=(o.collisionMask&N.collisionGroup)}else C=!0;if(C){var A=M.shape.body.outer;l.has(A)||l.push(A)}}else for(null==this.treeStack2&&(this.treeStack2=new t.util.ZNPList_ZPP_AABBNode),this.treeStack2.add(M);null!=this.treeStack2.head;){var L=this.treeStack2.pop_unsafe();if(null==L.child1){var B;if(null!=o){var T=L.shape.filter;B=0!=(T.collisionMask&o.collisionGroup)&&0!=(o.collisionMask&T.collisionGroup)}else B=!0;if(B){var V=L.shape.body.outer;l.has(V)||l.push(V)}}else null!=L.child1&&this.treeStack2.add(L.child1),null!=L.child2&&this.treeStack2.add(L.child2)}else{var k=M.aabb;if(s.miny<=k.maxy&&k.miny<=s.maxy&&s.minx<=k.maxx&&k.minx<=s.maxx)if(null==M.child1){var I,O=M.shape.body.outer;if(null!=o){var R=M.shape.filter;I=0!=(R.collisionMask&o.collisionGroup)&&0!=(o.collisionMask&R.collisionGroup)}else I=!0;if(I)if(i)if(r){if(!this.failed.has(O)){var H=t.geom.ZPP_Collide.containTest(this.aabbShape.zpp_inner,M.shape);!l.has(O)&&H?l.push(O):H||(l.remove(O),this.failed.push(O))}}else!l.has(O)&&t.geom.ZPP_Collide.testCollide_safe(M.shape,this.aabbShape.zpp_inner)&&l.push(O);else if(r){if(!this.failed.has(O)){var F=M.shape.aabb,D=F.minx>=s.minx&&F.miny>=s.miny&&F.maxx<=s.maxx&&F.maxy<=s.maxy;!l.has(O)&&D?l.push(O):D||(l.remove(O),this.failed.push(O))}}else{var G;if(l.has(O))G=!1;else{var U=M.shape.aabb;G=U.minx>=s.minx&&U.miny>=s.miny&&U.maxx<=s.maxx&&U.maxy<=s.maxy}G&&l.push(O)}}else null!=M.child1&&this.treeStack.add(M.child1),null!=M.child2&&this.treeStack.add(M.child2)}}return this.failed.clear(),l},t.space.ZPP_DynAABBPhase.prototype.shapesInCircle=function(n,i,r,o,a,s){this.sync_broadphase(),this.updateCircShape(n,i,r);var l=this.circShape.zpp_inner.aabb,p=null==s?new e.shape.ShapeList:s;if(null!=this.stree.root)for(null==this.treeStack&&(this.treeStack=new t.util.ZNPList_ZPP_AABBNode),this.treeStack.add(this.stree.root);null!=this.treeStack.head;){var u=this.treeStack.pop_unsafe(),h=u.aabb;if(l.miny<=h.maxy&&h.miny<=l.maxy&&l.minx<=h.maxx&&h.minx<=l.maxx)if(null==u.child1){var c;if(null!=a){var _=u.shape.filter;c=0!=(_.collisionMask&a.collisionGroup)&&0!=(a.collisionMask&_.collisionGroup)}else c=!0;c&&(o?t.geom.ZPP_Collide.containTest(this.circShape.zpp_inner,u.shape)&&p.push(u.shape.outer):t.geom.ZPP_Collide.testCollide_safe(u.shape,this.circShape.zpp_inner)&&p.push(u.shape.outer))}else null!=u.child1&&this.treeStack.add(u.child1),null!=u.child2&&this.treeStack.add(u.child2)}if(null!=this.dtree.root)for(null==this.treeStack&&(this.treeStack=new t.util.ZNPList_ZPP_AABBNode),this.treeStack.add(this.dtree.root);null!=this.treeStack.head;){var d=this.treeStack.pop_unsafe(),m=d.aabb;if(l.miny<=m.maxy&&m.miny<=l.maxy&&l.minx<=m.maxx&&m.minx<=l.maxx)if(null==d.child1){var P;if(null!=a){var f=d.shape.filter;P=0!=(f.collisionMask&a.collisionGroup)&&0!=(a.collisionMask&f.collisionGroup)}else P=!0;P&&(o?t.geom.ZPP_Collide.containTest(this.circShape.zpp_inner,d.shape)&&p.push(d.shape.outer):t.geom.ZPP_Collide.testCollide_safe(d.shape,this.circShape.zpp_inner)&&p.push(d.shape.outer))}else null!=d.child1&&this.treeStack.add(d.child1),null!=d.child2&&this.treeStack.add(d.child2)}return p},t.space.ZPP_DynAABBPhase.prototype.bodiesInCircle=function(n,i,r,o,a,s){this.sync_broadphase(),this.updateCircShape(n,i,r);var l=this.circShape.zpp_inner.aabb,p=null==s?new e.phys.BodyList:s;if(null==this.failed&&(this.failed=new e.phys.BodyList),null!=this.stree.root)for(null==this.treeStack&&(this.treeStack=new t.util.ZNPList_ZPP_AABBNode),this.treeStack.add(this.stree.root);null!=this.treeStack.head;){var u=this.treeStack.pop_unsafe(),h=u.aabb;if(l.miny<=h.maxy&&h.miny<=l.maxy&&l.minx<=h.maxx&&h.minx<=l.maxx)if(null==u.child1){var c,_=u.shape.body.outer;if(null!=a){var d=u.shape.filter;c=0!=(d.collisionMask&a.collisionGroup)&&0!=(a.collisionMask&d.collisionGroup)}else c=!0;if(c)if(o){if(!this.failed.has(_)){var m=t.geom.ZPP_Collide.containTest(this.circShape.zpp_inner,u.shape);!p.has(_)&&m?p.push(_):m||(p.remove(_),this.failed.push(_))}}else!p.has(_)&&t.geom.ZPP_Collide.testCollide_safe(u.shape,this.circShape.zpp_inner)&&p.push(_)}else null!=u.child1&&this.treeStack.add(u.child1),null!=u.child2&&this.treeStack.add(u.child2)}if(null!=this.dtree.root)for(null==this.treeStack&&(this.treeStack=new t.util.ZNPList_ZPP_AABBNode),this.treeStack.add(this.dtree.root);null!=this.treeStack.head;){var P=this.treeStack.pop_unsafe(),f=P.aabb;if(l.miny<=f.maxy&&f.miny<=l.maxy&&l.minx<=f.maxx&&f.minx<=l.maxx)if(null==P.child1){var x,y=P.shape.body.outer;if(null!=a){var v=P.shape.filter;x=0!=(v.collisionMask&a.collisionGroup)&&0!=(a.collisionMask&v.collisionGroup)}else x=!0;if(x)if(o){if(!this.failed.has(y)){var g=t.geom.ZPP_Collide.containTest(this.circShape.zpp_inner,P.shape);!p.has(y)&&g?p.push(y):g||(p.remove(y),this.failed.push(y))}}else!p.has(y)&&t.geom.ZPP_Collide.testCollide_safe(P.shape,this.circShape.zpp_inner)&&p.push(y)}else null!=P.child1&&this.treeStack.add(P.child1),null!=P.child2&&this.treeStack.add(P.child2)}return this.failed.clear(),p},t.space.ZPP_DynAABBPhase.prototype.shapesInShape=function(n,i,r,o){this.sync_broadphase(),this.validateShape(n);var a=n.aabb,s=null==o?new e.shape.ShapeList:o;if(null!=this.stree.root)for(null==this.treeStack&&(this.treeStack=new t.util.ZNPList_ZPP_AABBNode),this.treeStack.add(this.stree.root);null!=this.treeStack.head;){var l=this.treeStack.pop_unsafe(),p=l.aabb;if(a.miny<=p.maxy&&p.miny<=a.maxy&&a.minx<=p.maxx&&p.minx<=a.maxx)if(null==l.child1){var u;if(null!=r){var h=l.shape.filter;u=0!=(h.collisionMask&r.collisionGroup)&&0!=(r.collisionMask&h.collisionGroup)}else u=!0;u&&(i?t.geom.ZPP_Collide.containTest(n,l.shape)&&s.push(l.shape.outer):t.geom.ZPP_Collide.testCollide_safe(l.shape,n)&&s.push(l.shape.outer))}else null!=l.child1&&this.treeStack.add(l.child1),null!=l.child2&&this.treeStack.add(l.child2)}if(null!=this.dtree.root)for(null==this.treeStack&&(this.treeStack=new t.util.ZNPList_ZPP_AABBNode),this.treeStack.add(this.dtree.root);null!=this.treeStack.head;){var c=this.treeStack.pop_unsafe(),_=c.aabb;if(a.miny<=_.maxy&&_.miny<=a.maxy&&a.minx<=_.maxx&&_.minx<=a.maxx)if(null==c.child1){var d;if(null!=r){var m=c.shape.filter;d=0!=(m.collisionMask&r.collisionGroup)&&0!=(r.collisionMask&m.collisionGroup)}else d=!0;d&&(i?t.geom.ZPP_Collide.containTest(n,c.shape)&&s.push(c.shape.outer):t.geom.ZPP_Collide.testCollide_safe(c.shape,n)&&s.push(c.shape.outer))}else null!=c.child1&&this.treeStack.add(c.child1),null!=c.child2&&this.treeStack.add(c.child2)}return s},t.space.ZPP_DynAABBPhase.prototype.bodiesInShape=function(n,i,r,o){this.sync_broadphase(),this.validateShape(n);var a=n.aabb,s=null==o?new e.phys.BodyList:o;if(null==this.failed&&(this.failed=new e.phys.BodyList),null!=this.stree.root)for(null==this.treeStack&&(this.treeStack=new t.util.ZNPList_ZPP_AABBNode),this.treeStack.add(this.stree.root);null!=this.treeStack.head;){var l=this.treeStack.pop_unsafe(),p=l.aabb;if(a.miny<=p.maxy&&p.miny<=a.maxy&&a.minx<=p.maxx&&p.minx<=a.maxx)if(null==l.child1){var u,h=l.shape.body.outer;if(null!=r){var c=l.shape.filter;u=0!=(c.collisionMask&r.collisionGroup)&&0!=(r.collisionMask&c.collisionGroup)}else u=!0;if(u)if(i){if(!this.failed.has(h)){var _=t.geom.ZPP_Collide.containTest(n,l.shape);!s.has(h)&&_?s.push(h):_||(s.remove(h),this.failed.push(h))}}else!s.has(h)&&t.geom.ZPP_Collide.testCollide_safe(l.shape,n)&&s.push(h)}else null!=l.child1&&this.treeStack.add(l.child1),null!=l.child2&&this.treeStack.add(l.child2)}if(null!=this.dtree.root)for(null==this.treeStack&&(this.treeStack=new t.util.ZNPList_ZPP_AABBNode),this.treeStack.add(this.dtree.root);null!=this.treeStack.head;){var d=this.treeStack.pop_unsafe(),m=d.aabb;if(a.miny<=m.maxy&&m.miny<=a.maxy&&a.minx<=m.maxx&&m.minx<=a.maxx)if(null==d.child1){var P,f=d.shape.body.outer;if(null!=r){var x=d.shape.filter;P=0!=(x.collisionMask&r.collisionGroup)&&0!=(r.collisionMask&x.collisionGroup)}else P=!0;if(P)if(i){if(!this.failed.has(f)){var y=t.geom.ZPP_Collide.containTest(n,d.shape);!s.has(f)&&y?s.push(f):y||(s.remove(f),this.failed.push(f))}}else!s.has(f)&&t.geom.ZPP_Collide.testCollide_safe(d.shape,n)&&s.push(f)}else null!=d.child1&&this.treeStack.add(d.child1),null!=d.child2&&this.treeStack.add(d.child2)}return this.failed.clear(),s},t.space.ZPP_DynAABBPhase.prototype.openlist=null,t.space.ZPP_DynAABBPhase.prototype.rayCast=function(e,i,r){null==this.openlist&&(this.openlist=new t.util.ZNPList_ZPP_AABBNode),this.sync_broadphase(),e.validate_dir();var o=e.maxdist;if(null!=this.dtree.root&&e.aabbtest(this.dtree.root.aabb)){var a=e.aabbsect(this.dtree.root.aabb);if(a>=0&&a<o){this.dtree.root.rayt=a;for(var s=null,l=this.openlist.head;null!=l;){var p=l.elt;if(this.dtree.root.rayt<p.rayt)break;s=l,l=l.next}var u,h=this.openlist,c=this.dtree.root;null==t.util.ZNPNode_ZPP_AABBNode.zpp_pool?u=new t.util.ZNPNode_ZPP_AABBNode:(u=t.util.ZNPNode_ZPP_AABBNode.zpp_pool,t.util.ZNPNode_ZPP_AABBNode.zpp_pool=u.next,u.next=null),u.elt=c;var _=u;null==s?(_.next=h.head,h.head=_):(_.next=s.next,s.next=_),h.pushmod=h.modified=!0,h.length++}}if(null!=this.stree.root&&e.aabbtest(this.stree.root.aabb)){var d=e.aabbsect(this.stree.root.aabb);if(d>=0&&d<o){this.stree.root.rayt=d;for(var m=null,P=this.openlist.head;null!=P;){var f=P.elt;if(this.stree.root.rayt<f.rayt)break;m=P,P=P.next}var x,y=this.openlist,v=this.stree.root;null==t.util.ZNPNode_ZPP_AABBNode.zpp_pool?x=new t.util.ZNPNode_ZPP_AABBNode:(x=t.util.ZNPNode_ZPP_AABBNode.zpp_pool,t.util.ZNPNode_ZPP_AABBNode.zpp_pool=x.next,x.next=null),x.elt=v;var g=x;null==m?(g.next=y.head,y.head=g):(g.next=m.next,m.next=g),y.pushmod=y.modified=!0,y.length++}}for(var b=null;null!=this.openlist.head;){var z=this.openlist.pop_unsafe();if(z.rayt>=o)break;if(null==z.child1){var w,Z=z.shape;if(null!=r){var E=Z.filter;w=0!=(E.collisionMask&r.collisionGroup)&&0!=(r.collisionMask&E.collisionGroup)}else w=!0;if(w){var M=0==Z.type?e.circlesect(Z.circle,i,o):e.aabbtest(Z.aabb)?e.polysect(Z.polygon,i,o):null;if(null!=M){if(null!=M.zpp_inner.next)throw new n._Boot.HaxeError("Error: This object has been disposed of and cannot be used");if(o=M.zpp_inner.toiDistance,null!=b){if(null!=b.zpp_inner.next)throw new n._Boot.HaxeError("Error: This object has been disposed of and cannot be used");b.zpp_inner.free()}b=M}}}else{if(null!=z.child1&&e.aabbtest(z.child1.aabb)){var S=e.aabbsect(z.child1.aabb);if(S>=0&&S<o){z.child1.rayt=S;for(var C=null,N=this.openlist.head;null!=N;){var A=N.elt;if(z.child1.rayt<A.rayt)break;C=N,N=N.next}var L,B=this.openlist,T=z.child1;null==t.util.ZNPNode_ZPP_AABBNode.zpp_pool?L=new t.util.ZNPNode_ZPP_AABBNode:(L=t.util.ZNPNode_ZPP_AABBNode.zpp_pool,t.util.ZNPNode_ZPP_AABBNode.zpp_pool=L.next,L.next=null),L.elt=T;var V=L;null==C?(V.next=B.head,B.head=V):(V.next=C.next,C.next=V),B.pushmod=B.modified=!0,B.length++}}if(null!=z.child2&&e.aabbtest(z.child2.aabb)){var k=e.aabbsect(z.child2.aabb);if(k>=0&&k<o){z.child2.rayt=k;for(var I=null,O=this.openlist.head;null!=O;){var R=O.elt;if(z.child2.rayt<R.rayt)break;I=O,O=O.next}var H,F=this.openlist,D=z.child2;null==t.util.ZNPNode_ZPP_AABBNode.zpp_pool?H=new t.util.ZNPNode_ZPP_AABBNode:(H=t.util.ZNPNode_ZPP_AABBNode.zpp_pool,t.util.ZNPNode_ZPP_AABBNode.zpp_pool=H.next,H.next=null),H.elt=D;var G=H;null==I?(G.next=F.head,F.head=G):(G.next=I.next,I.next=G),F.pushmod=F.modified=!0,F.length++}}}}return this.openlist.clear(),b},t.space.ZPP_DynAABBPhase.prototype.rayMultiCast=function(n,i,r,o){null==this.openlist&&(this.openlist=new t.util.ZNPList_ZPP_AABBNode),this.sync_broadphase(),n.validate_dir();var a=n.maxdist>=1/0,s=null==o?new e.geom.RayResultList:o;if(null!=this.dtree.root&&n.aabbtest(this.dtree.root.aabb))if(a)this.openlist.add(this.dtree.root);else{var l=n.aabbsect(this.dtree.root.aabb);l>=0&&l<n.maxdist&&this.openlist.add(this.dtree.root)}if(null!=this.stree.root&&n.aabbtest(this.stree.root.aabb))if(a)this.openlist.add(this.stree.root);else{var p=n.aabbsect(this.stree.root.aabb);p>=0&&p<n.maxdist&&this.openlist.add(this.stree.root)}for(;null!=this.openlist.head;){var u=this.openlist.pop_unsafe();if(null==u.child1){var h,c=u.shape;if(null!=r){var _=c.filter;h=0!=(_.collisionMask&r.collisionGroup)&&0!=(r.collisionMask&_.collisionGroup)}else h=!0;h&&(0==c.type?n.circlesect2(c.circle,i,s):n.aabbtest(c.aabb)&&n.polysect2(c.polygon,i,s))}else{if(null!=u.child1&&n.aabbtest(u.child1.aabb))if(a)this.openlist.add(u.child1);else{var d=n.aabbsect(u.child1.aabb);d>=0&&d<n.maxdist&&this.openlist.add(u.child1)}if(null!=u.child2&&n.aabbtest(u.child2.aabb))if(a)this.openlist.add(u.child2);else{var m=n.aabbsect(u.child2.aabb);m>=0&&m<n.maxdist&&this.openlist.add(u.child2)}}}return this.openlist.clear(),s},t.space.ZPP_DynAABBPhase.prototype.__class__=t.space.ZPP_DynAABBPhase,t.space.ZPP_Island=l["zpp_nape.space.ZPP_Island"]=function(){this.waket=0,this.sleep=!1,this.comps=null,this.length=0,this.pushmod=!1,this.modified=!1,this._inuse=!1,this.next=null,this.comps=new t.util.ZNPList_ZPP_Component},t.space.ZPP_Island.__name__=["zpp_nape","space","ZPP_Island"],t.space.ZPP_Island.prototype.next=null,t.space.ZPP_Island.prototype.elem=function(){return this},t.space.ZPP_Island.prototype.begin=function(){return this.next},t.space.ZPP_Island.prototype._inuse=null,t.space.ZPP_Island.prototype.modified=null,t.space.ZPP_Island.prototype.pushmod=null,t.space.ZPP_Island.prototype.length=null,t.space.ZPP_Island.prototype.setbegin=function(e){this.next=e,this.modified=!0,this.pushmod=!0},t.space.ZPP_Island.prototype.add=function(e){e._inuse=!0;var t=e;return t.next=this.next,this.next=t,this.modified=!0,this.length++,e},t.space.ZPP_Island.prototype.inlined_add=function(e){e._inuse=!0;var t=e;return t.next=this.next,this.next=t,this.modified=!0,this.length++,e},t.space.ZPP_Island.prototype.addAll=function(e){for(var t=e.next;null!=t;){var n=t;this.add(n),t=t.next}},t.space.ZPP_Island.prototype.insert=function(e,t){t._inuse=!0;var n=t;return null==e?(n.next=this.next,this.next=n):(n.next=e.next,e.next=n),this.pushmod=this.modified=!0,this.length++,n},t.space.ZPP_Island.prototype.inlined_insert=function(e,t){t._inuse=!0;var n=t;return null==e?(n.next=this.next,this.next=n):(n.next=e.next,e.next=n),this.pushmod=this.modified=!0,this.length++,n},t.space.ZPP_Island.prototype.pop=function(){var e=this.next;this.next=e.next,e._inuse=!1,null==this.next&&(this.pushmod=!0),this.modified=!0,this.length--},t.space.ZPP_Island.prototype.inlined_pop=function(){var e=this.next;this.next=e.next,e._inuse=!1,null==this.next&&(this.pushmod=!0),this.modified=!0,this.length--},t.space.ZPP_Island.prototype.pop_unsafe=function(){var e=this.next;return this.pop(),e},t.space.ZPP_Island.prototype.inlined_pop_unsafe=function(){var e=this.next;return this.pop(),e},t.space.ZPP_Island.prototype.remove=function(e){for(var t=null,n=this.next;null!=n;){if(n==e){var i,r;null==t?(r=(i=this.next).next,this.next=r,null==this.next&&(this.pushmod=!0)):(r=(i=t.next).next,t.next=r,null==r&&(this.pushmod=!0)),i._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0;break}t=n,n=n.next}},t.space.ZPP_Island.prototype.try_remove=function(e){for(var t=null,n=this.next,i=!1;null!=n;){if(n==e){this.erase(t),i=!0;break}t=n,n=n.next}return i},t.space.ZPP_Island.prototype.inlined_remove=function(e){for(var t=null,n=this.next;null!=n;){if(n==e){var i,r;null==t?(r=(i=this.next).next,this.next=r,null==this.next&&(this.pushmod=!0)):(r=(i=t.next).next,t.next=r,null==r&&(this.pushmod=!0)),i._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0;break}t=n,n=n.next}},t.space.ZPP_Island.prototype.inlined_try_remove=function(e){for(var t=null,n=this.next,i=!1;null!=n;){if(n==e){var r,o;null==t?(o=(r=this.next).next,this.next=o,null==this.next&&(this.pushmod=!0)):(o=(r=t.next).next,t.next=o,null==o&&(this.pushmod=!0)),r._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0,i=!0;break}t=n,n=n.next}return i},t.space.ZPP_Island.prototype.erase=function(e){var t,n;return null==e?(n=(t=this.next).next,this.next=n,null==this.next&&(this.pushmod=!0)):(n=(t=e.next).next,e.next=n,null==n&&(this.pushmod=!0)),t._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0,n},t.space.ZPP_Island.prototype.inlined_erase=function(e){var t,n;return null==e?(n=(t=this.next).next,this.next=n,null==this.next&&(this.pushmod=!0)):(n=(t=e.next).next,e.next=n,null==n&&(this.pushmod=!0)),t._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0,n},t.space.ZPP_Island.prototype.splice=function(e,t){for(;t-- >0&&null!=e.next;)this.erase(e);return e.next},t.space.ZPP_Island.prototype.clear=function(){},t.space.ZPP_Island.prototype.inlined_clear=function(){},t.space.ZPP_Island.prototype.reverse=function(){for(var e=this.next,t=null;null!=e;){var n=e.next;e.next=t,this.next=e,t=e,e=n}this.modified=!0,this.pushmod=!0},t.space.ZPP_Island.prototype.empty=function(){return null==this.next},t.space.ZPP_Island.prototype.size=function(){return this.length},t.space.ZPP_Island.prototype.has=function(e){var t;t=!1;for(var n=this.next;null!=n;){if(n==e){t=!0;break}n=n.next}return t},t.space.ZPP_Island.prototype.inlined_has=function(e){var t;t=!1;for(var n=this.next;null!=n;){if(n==e){t=!0;break}n=n.next}return t},t.space.ZPP_Island.prototype.front=function(){return this.next},t.space.ZPP_Island.prototype.back=function(){for(var e=this.next,t=e;null!=t;)e=t,t=t.next;return e},t.space.ZPP_Island.prototype.iterator_at=function(e){for(var t=this.next;e-- >0&&null!=t;)t=t.next;return t},t.space.ZPP_Island.prototype.at=function(e){var t=this.iterator_at(e);return null!=t?t:null},t.space.ZPP_Island.prototype.comps=null,t.space.ZPP_Island.prototype.sleep=null,t.space.ZPP_Island.prototype.waket=null,t.space.ZPP_Island.prototype.free=function(){},t.space.ZPP_Island.prototype.alloc=function(){this.waket=0},t.space.ZPP_Island.prototype.__class__=t.space.ZPP_Island,t.space.ZPP_Component=l["zpp_nape.space.ZPP_Component"]=function(){this.woken=!1,this.waket=0,this.sleeping=!1,this.island=null,this.constraint=null,this.body=null,this.isBody=!1,this.rank=0,this.parent=null,this.next=null,this.sleeping=!1,this.island=null,this.parent=this,this.rank=0,this.woken=!1},t.space.ZPP_Component.__name__=["zpp_nape","space","ZPP_Component"],t.space.ZPP_Component.prototype.next=null,t.space.ZPP_Component.prototype.parent=null,t.space.ZPP_Component.prototype.rank=null,t.space.ZPP_Component.prototype.isBody=null,t.space.ZPP_Component.prototype.body=null,t.space.ZPP_Component.prototype.constraint=null,t.space.ZPP_Component.prototype.island=null,t.space.ZPP_Component.prototype.sleeping=null,t.space.ZPP_Component.prototype.waket=null,t.space.ZPP_Component.prototype.woken=null,t.space.ZPP_Component.prototype.free=function(){this.body=null,this.constraint=null},t.space.ZPP_Component.prototype.alloc=function(){},t.space.ZPP_Component.prototype.reset=function(){this.sleeping=!1,this.island=null,this.parent=this,this.rank=0},t.space.ZPP_Component.prototype.__class__=t.space.ZPP_Component,t.space.ZPP_CallbackSet=l["zpp_nape.space.ZPP_CallbackSet"]=function(){this.lazydel=!1,this.freed=!1,this.length=0,this.pushmod=!1,this.modified=!1,this._inuse=!1,this.next=null,this.int2=null,this.int1=null,this.di=0,this.id=0,this.arbiters=new t.util.ZNPList_ZPP_Arbiter},t.space.ZPP_CallbackSet.__name__=["zpp_nape","space","ZPP_CallbackSet"],t.space.ZPP_CallbackSet.get=function(e,n){var i;return null==t.space.ZPP_CallbackSet.zpp_pool?i=new t.space.ZPP_CallbackSet:(i=t.space.ZPP_CallbackSet.zpp_pool,t.space.ZPP_CallbackSet.zpp_pool=i.next,i.next=null),i.freed=!1,i.lazydel=!1,i.COLLISIONstate=1,i.COLLISIONstamp=0,i.SENSORstate=1,i.SENSORstamp=0,i.FLUIDstate=1,i.FLUIDstamp=0,e.id<n.id?(i.int1=e,i.int2=n):(i.int1=n,i.int2=e),i.id=i.int1.id,i.di=i.int2.id,i},t.space.ZPP_CallbackSet.prototype.id=null,t.space.ZPP_CallbackSet.prototype.di=null,t.space.ZPP_CallbackSet.prototype.int1=null,t.space.ZPP_CallbackSet.prototype.int2=null,t.space.ZPP_CallbackSet.prototype.arbiters=null,t.space.ZPP_CallbackSet.prototype.COLLISIONstate=null,t.space.ZPP_CallbackSet.prototype.COLLISIONstamp=null,t.space.ZPP_CallbackSet.prototype.SENSORstate=null,t.space.ZPP_CallbackSet.prototype.SENSORstamp=null,t.space.ZPP_CallbackSet.prototype.FLUIDstate=null,t.space.ZPP_CallbackSet.prototype.FLUIDstamp=null,t.space.ZPP_CallbackSet.prototype.next=null,t.space.ZPP_CallbackSet.prototype.elem=function(){return this},t.space.ZPP_CallbackSet.prototype.begin=function(){return this.next},t.space.ZPP_CallbackSet.prototype._inuse=null,t.space.ZPP_CallbackSet.prototype.modified=null,t.space.ZPP_CallbackSet.prototype.pushmod=null,t.space.ZPP_CallbackSet.prototype.length=null,t.space.ZPP_CallbackSet.prototype.setbegin=function(e){this.next=e,this.modified=!0,this.pushmod=!0},t.space.ZPP_CallbackSet.prototype.add=function(e){e._inuse=!0;var t=e;return t.next=this.next,this.next=t,this.modified=!0,this.length++,e},t.space.ZPP_CallbackSet.prototype.inlined_add=function(e){e._inuse=!0;var t=e;return t.next=this.next,this.next=t,this.modified=!0,this.length++,e},t.space.ZPP_CallbackSet.prototype.addAll=function(e){for(var t=e.next;null!=t;){var n=t;this.add(n),t=t.next}},t.space.ZPP_CallbackSet.prototype.insert=function(e,t){t._inuse=!0;var n=t;return null==e?(n.next=this.next,this.next=n):(n.next=e.next,e.next=n),this.pushmod=this.modified=!0,this.length++,n},t.space.ZPP_CallbackSet.prototype.inlined_insert=function(e,t){t._inuse=!0;var n=t;return null==e?(n.next=this.next,this.next=n):(n.next=e.next,e.next=n),this.pushmod=this.modified=!0,this.length++,n},t.space.ZPP_CallbackSet.prototype.pop=function(){var e=this.next;this.next=e.next,e._inuse=!1,null==this.next&&(this.pushmod=!0),this.modified=!0,this.length--},t.space.ZPP_CallbackSet.prototype.inlined_pop=function(){var e=this.next;this.next=e.next,e._inuse=!1,null==this.next&&(this.pushmod=!0),this.modified=!0,this.length--},t.space.ZPP_CallbackSet.prototype.pop_unsafe=function(){var e=this.next;return this.pop(),e},t.space.ZPP_CallbackSet.prototype.inlined_pop_unsafe=function(){var e=this.next;return this.pop(),e},t.space.ZPP_CallbackSet.prototype.remove=function(e){for(var t=null,n=this.next;null!=n;){if(n==e){var i,r;null==t?(r=(i=this.next).next,this.next=r,null==this.next&&(this.pushmod=!0)):(r=(i=t.next).next,t.next=r,null==r&&(this.pushmod=!0)),i._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0;break}t=n,n=n.next}},t.space.ZPP_CallbackSet.prototype.try_remove=function(e){for(var t=null,n=this.next,i=!1;null!=n;){if(n==e){this.erase(t),i=!0;break}t=n,n=n.next}return i},t.space.ZPP_CallbackSet.prototype.inlined_remove=function(e){for(var t=null,n=this.next;null!=n;){if(n==e){var i,r;null==t?(r=(i=this.next).next,this.next=r,null==this.next&&(this.pushmod=!0)):(r=(i=t.next).next,t.next=r,null==r&&(this.pushmod=!0)),i._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0;break}t=n,n=n.next}},t.space.ZPP_CallbackSet.prototype.inlined_try_remove=function(e){for(var t=null,n=this.next,i=!1;null!=n;){if(n==e){var r,o;null==t?(o=(r=this.next).next,this.next=o,null==this.next&&(this.pushmod=!0)):(o=(r=t.next).next,t.next=o,null==o&&(this.pushmod=!0)),r._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0,i=!0;break}t=n,n=n.next}return i},t.space.ZPP_CallbackSet.prototype.erase=function(e){var t,n;return null==e?(n=(t=this.next).next,this.next=n,null==this.next&&(this.pushmod=!0)):(n=(t=e.next).next,e.next=n,null==n&&(this.pushmod=!0)),t._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0,n},t.space.ZPP_CallbackSet.prototype.inlined_erase=function(e){var t,n;return null==e?(n=(t=this.next).next,this.next=n,null==this.next&&(this.pushmod=!0)):(n=(t=e.next).next,e.next=n,null==n&&(this.pushmod=!0)),t._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0,n},t.space.ZPP_CallbackSet.prototype.splice=function(e,t){for(;t-- >0&&null!=e.next;)this.erase(e);return e.next},t.space.ZPP_CallbackSet.prototype.clear=function(){},t.space.ZPP_CallbackSet.prototype.inlined_clear=function(){},t.space.ZPP_CallbackSet.prototype.reverse=function(){for(var e=this.next,t=null;null!=e;){var n=e.next;e.next=t,this.next=e,t=e,e=n}this.modified=!0,this.pushmod=!0},t.space.ZPP_CallbackSet.prototype.empty=function(){return null==this.next},t.space.ZPP_CallbackSet.prototype.size=function(){return this.length},t.space.ZPP_CallbackSet.prototype.has=function(e){var t;t=!1;for(var n=this.next;null!=n;){if(n==e){t=!0;break}n=n.next}return t},t.space.ZPP_CallbackSet.prototype.inlined_has=function(e){var t;t=!1;for(var n=this.next;null!=n;){if(n==e){t=!0;break}n=n.next}return t},t.space.ZPP_CallbackSet.prototype.front=function(){return this.next},t.space.ZPP_CallbackSet.prototype.back=function(){for(var e=this.next,t=e;null!=t;)e=t,t=t.next;return e},t.space.ZPP_CallbackSet.prototype.iterator_at=function(e){for(var t=this.next;e-- >0&&null!=t;)t=t.next;return t},t.space.ZPP_CallbackSet.prototype.at=function(e){var t=this.iterator_at(e);return null!=t?t:null},t.space.ZPP_CallbackSet.prototype.freed=null,t.space.ZPP_CallbackSet.prototype.lazydel=null,t.space.ZPP_CallbackSet.prototype.free=function(){this.int1=this.int2=null,this.id=this.di=-1,this.freed=!0},t.space.ZPP_CallbackSet.prototype.alloc=function(){this.freed=!1,this.lazydel=!1,this.COLLISIONstate=1,this.COLLISIONstamp=0,this.SENSORstate=1,this.SENSORstamp=0,this.FLUIDstate=1,this.FLUIDstamp=0},t.space.ZPP_CallbackSet.prototype.add_arb=function(e){var n;n=!1;for(var i=this.arbiters.head;null!=i;){if(i.elt==e){n=!0;break}i=i.next}if(n)return!1;var r,o=this.arbiters;null==t.util.ZNPNode_ZPP_Arbiter.zpp_pool?r=new t.util.ZNPNode_ZPP_Arbiter:(r=t.util.ZNPNode_ZPP_Arbiter.zpp_pool,t.util.ZNPNode_ZPP_Arbiter.zpp_pool=r.next,r.next=null),r.elt=e;var a=r;return a.next=o.head,o.head=a,o.modified=!0,o.length++,!0},t.space.ZPP_CallbackSet.prototype.try_remove_arb=function(e){for(var n=this.arbiters,i=null,r=n.head,o=!1;null!=r;){if(r.elt==e){var a,s;null==i?(s=(a=n.head).next,n.head=s,null==n.head&&(n.pushmod=!0)):(s=(a=i.next).next,i.next=s,null==s&&(n.pushmod=!0));var l=a;l.elt=null,l.next=t.util.ZNPNode_ZPP_Arbiter.zpp_pool,t.util.ZNPNode_ZPP_Arbiter.zpp_pool=l,n.modified=!0,n.length--,n.pushmod=!0,o=!0;break}i=r,r=r.next}return o},t.space.ZPP_CallbackSet.prototype.remove_arb=function(e){for(var n=this.arbiters,i=null,r=n.head;null!=r;){if(r.elt==e){var o,a;null==i?(a=(o=n.head).next,n.head=a,null==n.head&&(n.pushmod=!0)):(a=(o=i.next).next,i.next=a,null==a&&(n.pushmod=!0));var s=o;s.elt=null,s.next=t.util.ZNPNode_ZPP_Arbiter.zpp_pool,t.util.ZNPNode_ZPP_Arbiter.zpp_pool=s,n.modified=!0,n.length--,n.pushmod=!0;break}i=r,r=r.next}},t.space.ZPP_CallbackSet.prototype.empty_arb=function(e){var t;t=!0;for(var n=this.arbiters.head;null!=n;){if(0!=(n.elt.type&e)){t=!1;break}n=n.next}return t},t.space.ZPP_CallbackSet.prototype.really_empty=function(){return null==this.arbiters.head},t.space.ZPP_CallbackSet.prototype.sleeping=function(){var e;e=!0;for(var t=this.arbiters.head;null!=t;){if(!t.elt.sleeping){e=!1;break}t=t.next}return e},t.space.ZPP_CallbackSet.prototype.__class__=t.space.ZPP_CallbackSet,t.space.ZPP_CbSetManager=l["zpp_nape.space.ZPP_CbSetManager"]=function(e){this.space=null,this.cbsets=null,null==t.util.ZPP_Set_ZPP_CbSet.zpp_pool?this.cbsets=new t.util.ZPP_Set_ZPP_CbSet:(this.cbsets=t.util.ZPP_Set_ZPP_CbSet.zpp_pool,t.util.ZPP_Set_ZPP_CbSet.zpp_pool=this.cbsets.next,this.cbsets.next=null),this.cbsets.lt=t.callbacks.ZPP_CbSet.setlt,this.space=e},t.space.ZPP_CbSetManager.__name__=["zpp_nape","space","ZPP_CbSetManager"],t.space.ZPP_CbSetManager.prototype.cbsets=null,t.space.ZPP_CbSetManager.prototype.space=null,t.space.ZPP_CbSetManager.prototype.get=function(e){if(null==e.head)return null;var n;null==t.callbacks.ZPP_CbSet.zpp_pool?n=new t.callbacks.ZPP_CbSet:(n=t.callbacks.ZPP_CbSet.zpp_pool,t.callbacks.ZPP_CbSet.zpp_pool=n.next,n.next=null);var i=n.cbTypes;n.cbTypes=e;var r,o=this.cbsets.find_weak(n);if(null!=o)r=o.data;else{var a=t.callbacks.ZPP_CbSet.get(e);this.cbsets.insert(a),a.manager=this,r=a}n.cbTypes=i;var s=n;for(s.listeners.clear(),s.zip_listeners=!0,s.bodylisteners.clear(),s.zip_bodylisteners=!0,s.conlisteners.clear(),s.zip_conlisteners=!0;null!=s.cbTypes.head;)s.cbTypes.pop_unsafe().cbsets.remove(s);return s.next=t.callbacks.ZPP_CbSet.zpp_pool,t.callbacks.ZPP_CbSet.zpp_pool=s,r},t.space.ZPP_CbSetManager.prototype.remove=function(e){for(this.cbsets.remove(e);null!=e.cbpairs.head;){var n=e.cbpairs.pop_unsafe();n.a!=n.b&&(e==n.a?n.b.cbpairs.remove(n):n.a.cbpairs.remove(n));var i=n;i.a=i.b=null,i.listeners.clear(),i.next=t.callbacks.ZPP_CbSetPair.zpp_pool,t.callbacks.ZPP_CbSetPair.zpp_pool=i}e.manager=null},t.space.ZPP_CbSetManager.prototype.clear=function(){},t.space.ZPP_CbSetManager.prototype.validate=function(){if(!this.cbsets.empty()){for(var e=this.cbsets.parent;null!=e.prev;)e=e.prev;for(;null!=e;)if(e.data.validate(),null!=e.next)for(e=e.next;null!=e.prev;)e=e.prev;else{for(;null!=e.parent&&e==e.parent.next;)e=e.parent;e=e.parent}}},t.space.ZPP_CbSetManager.prototype.pair=function(e,n){for(var i,r=null,o=(e.cbpairs.length<n.cbpairs.length?e.cbpairs:n.cbpairs).head;null!=o;){var a=o.elt;if(a.a==e&&a.b==n||a.a==n&&a.b==e){r=a;break}o=o.next}return null==r&&(null==t.callbacks.ZPP_CbSetPair.zpp_pool?i=new t.callbacks.ZPP_CbSetPair:(i=t.callbacks.ZPP_CbSetPair.zpp_pool,t.callbacks.ZPP_CbSetPair.zpp_pool=i.next,i.next=null),i.zip_listeners=!0,t.callbacks.ZPP_CbSet.setlt(e,n)?(i.a=e,i.b=n):(i.a=n,i.b=e),r=i,e.cbpairs.add(r),n!=e&&n.cbpairs.add(r)),r.zip_listeners&&(r.zip_listeners=!1,r.__validate()),r},t.space.ZPP_CbSetManager.prototype.valid_listener=function(e){return e.space==this.space},t.space.ZPP_CbSetManager.prototype.__class__=t.space.ZPP_CbSetManager,t.space.ZPP_Space=l["zpp_nape.space.ZPP_Space"]=function(n,i){var r;this.prelisteners=null,this.precb=null,this.continuous=!1,this.toiEvents=null,this.pre_dt=0,this.convexShapeList=null,this.cbsets=null,this.callbackset_list=null,this.callbacks=null,this.wrap_listeners=null,this.listeners=null,this.islands=null,this.staticsleep=null,this.wrap_livecon=null,this.live_constraints=null,this.wrap_live=null,this.live=null,this.wrap_arbiters=null,this.s_arbiters=null,this.f_arbiters=null,this.c_arbiters_false=null,this.c_arbiters_true=null,this.sortcontacts=!1,this.time=0,this.midstep=!1,this.stamp=0,this.global_ang_drag=0,this.global_lin_drag=0,this.__static=null,this.bphase=null,this.kinematics=null,this.wrap_constraints=null,this.constraints=null,this.wrap_compounds=null,this.compounds=null,this.wrap_bodies=null,this.bodies=null,this.wrap_gravity=null,this.gravityy=0,this.gravityx=0,this.userData=null,this.outer=null,this.toiEvents=new t.util.ZNPList_ZPP_ToiEvent,this.global_lin_drag=.015,this.global_ang_drag=.015,t.callbacks.ZPP_Callback.internal=!0,this.precb=new e.callbacks.PreCallback,this.precb.zpp_inner=new t.callbacks.ZPP_Callback,t.callbacks.ZPP_Callback.internal=!1,this.sortcontacts=!0,this.pre_dt=0,null!=i?(null==t.util.ZPP_Flags.Broadphase_DYNAMIC_AABB_TREE&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.Broadphase_DYNAMIC_AABB_TREE=new e.space.Broadphase,t.util.ZPP_Flags.internal=!1),r=i==t.util.ZPP_Flags.Broadphase_DYNAMIC_AABB_TREE):r=!0,r?this.bphase=new t.space.ZPP_DynAABBPhase(this):(null==t.util.ZPP_Flags.Broadphase_SWEEP_AND_PRUNE&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.Broadphase_SWEEP_AND_PRUNE=new e.space.Broadphase,t.util.ZPP_Flags.internal=!1),i==t.util.ZPP_Flags.Broadphase_SWEEP_AND_PRUNE&&(this.bphase=new t.space.ZPP_SweepPhase(this))),this.time=0,null!=n?(this.gravityx=n.x,this.gravityy=n.y):(this.gravityx=0,this.gravityy=0),this.bodies=new t.util.ZNPList_ZPP_Body,this.wrap_bodies=t.util.ZPP_BodyList.get(this.bodies),this.wrap_bodies.zpp_inner.adder=p(this,this.bodies_adder),this.wrap_bodies.zpp_inner.subber=p(this,this.bodies_subber),this.wrap_bodies.zpp_inner._modifiable=p(this,this.bodies_modifiable),this.compounds=new t.util.ZNPList_ZPP_Compound,this.wrap_compounds=t.util.ZPP_CompoundList.get(this.compounds),this.wrap_compounds.zpp_inner.adder=p(this,this.compounds_adder),this.wrap_compounds.zpp_inner.subber=p(this,this.compounds_subber),this.wrap_compounds.zpp_inner._modifiable=p(this,this.compounds_modifiable),this.kinematics=new t.util.ZNPList_ZPP_Body,this.c_arbiters_true=new t.util.ZNPList_ZPP_ColArbiter,this.c_arbiters_false=new t.util.ZNPList_ZPP_ColArbiter,this.f_arbiters=new t.util.ZNPList_ZPP_FluidArbiter,this.s_arbiters=new t.util.ZNPList_ZPP_SensorArbiter,this.islands=new t.space.ZPP_Island,this.live=new t.util.ZNPList_ZPP_Body,this.wrap_live=t.util.ZPP_BodyList.get(this.live,!0),this.staticsleep=new t.util.ZNPList_ZPP_Body,this.constraints=new t.util.ZNPList_ZPP_Constraint,this.wrap_constraints=t.util.ZPP_ConstraintList.get(this.constraints),this.wrap_constraints.zpp_inner.adder=p(this,this.constraints_adder),this.wrap_constraints.zpp_inner.subber=p(this,this.constraints_subber),this.wrap_constraints.zpp_inner._modifiable=p(this,this.constraints_modifiable),this.live_constraints=new t.util.ZNPList_ZPP_Constraint,this.wrap_livecon=t.util.ZPP_ConstraintList.get(this.live_constraints,!0),this.__static=t.phys.ZPP_Body.__static(),this.__static.zpp_inner.space=this,this.callbacks=new t.callbacks.ZPP_Callback,this.midstep=!1,this.listeners=new t.util.ZNPList_ZPP_Listener,this.wrap_listeners=t.util.ZPP_ListenerList.get(this.listeners),this.wrap_listeners.zpp_inner.adder=p(this,this.listeners_adder),this.wrap_listeners.zpp_inner.subber=p(this,this.listeners_subber),this.wrap_listeners.zpp_inner._modifiable=p(this,this.listeners_modifiable),this.callbackset_list=new t.space.ZPP_CallbackSet,this.mrca1=new t.util.ZNPList_ZPP_Interactor,this.mrca2=new t.util.ZNPList_ZPP_Interactor,this.prelisteners=new t.util.ZNPList_ZPP_InteractionListener,this.cbsets=new t.space.ZPP_CbSetManager(this)},t.space.ZPP_Space.__name__=["zpp_nape","space","ZPP_Space"],t.space.ZPP_Space.prototype.outer=null,t.space.ZPP_Space.prototype.userData=null,t.space.ZPP_Space.prototype.gravityx=null,t.space.ZPP_Space.prototype.gravityy=null,t.space.ZPP_Space.prototype.wrap_gravity=null,t.space.ZPP_Space.prototype.getgravity=function(){var i,r=this.gravityx,o=this.gravityy;if(null==o&&(o=0),null==r&&(r=0),r!=r||o!=o)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null==t.util.ZPP_PubPool.poolVec2?i=new e.geom.Vec2:(i=t.util.ZPP_PubPool.poolVec2,t.util.ZPP_PubPool.poolVec2=i.zpp_pool,i.zpp_pool=null,i.zpp_disp=!1,i==t.util.ZPP_PubPool.nextVec2&&(t.util.ZPP_PubPool.nextVec2=null)),null==i.zpp_inner){var a;null==t.geom.ZPP_Vec2.zpp_pool?a=new t.geom.ZPP_Vec2:(a=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=a.next,a.next=null),a.weak=!1,a._immutable=!1,a.x=r,a.y=o,i.zpp_inner=a,i.zpp_inner.outer=i}else{if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var s,l=i.zpp_inner;if(l._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=l._isimmutable&&l._isimmutable(),r!=r||o!=o)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var u=i.zpp_inner;if(null!=u._validate&&u._validate(),i.zpp_inner.x==r){if(null!=i&&i.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var h=i.zpp_inner;null!=h._validate&&h._validate(),s=i.zpp_inner.y==o}else s=!1;if(!s){i.zpp_inner.x=r,i.zpp_inner.y=o;var c=i.zpp_inner;null!=c._invalidate&&c._invalidate(c)}}i.zpp_inner.weak=!1,this.wrap_gravity=i,this.wrap_gravity.zpp_inner._inuse=!0,this.wrap_gravity.zpp_inner._invalidate=p(this,this.gravity_invalidate),this.wrap_gravity.zpp_inner._validate=p(this,this.gravity_validate)},t.space.ZPP_Space.prototype.gravity_invalidate=function(e){if(this.midstep)throw new n._Boot.HaxeError("Error: Space::gravity cannot be set during space step");this.gravityx=e.x,this.gravityy=e.y;for(var i=new t.util.ZNPList_ZPP_Compound,r=this.bodies.head;null!=r;){var o=r.elt;o.world||(o.component.waket=this.stamp+(this.midstep?0:1),3==o.type&&(o.kinematicDelaySleep=!0),o.component.sleeping&&this.really_wake(o,!1)),r=r.next}for(var a=this.compounds.head;null!=a;){var s=a.elt;i.add(s),a=a.next}for(;null!=i.head;){for(var l=i.pop_unsafe(),p=l.bodies.head;null!=p;){var u=p.elt;u.world||(u.component.waket=this.stamp+(this.midstep?0:1),3==u.type&&(u.kinematicDelaySleep=!0),u.component.sleeping&&this.really_wake(u,!1)),p=p.next}for(var h=l.compounds.head;null!=h;){var c=h.elt;i.add(c),h=h.next}}},t.space.ZPP_Space.prototype.gravity_validate=function(){this.wrap_gravity.zpp_inner.x=this.gravityx,this.wrap_gravity.zpp_inner.y=this.gravityy},t.space.ZPP_Space.prototype.bodies=null,t.space.ZPP_Space.prototype.wrap_bodies=null,t.space.ZPP_Space.prototype.compounds=null,t.space.ZPP_Space.prototype.wrap_compounds=null,t.space.ZPP_Space.prototype.constraints=null,t.space.ZPP_Space.prototype.wrap_constraints=null,t.space.ZPP_Space.prototype.kinematics=null,t.space.ZPP_Space.prototype.bphase=null,t.space.ZPP_Space.prototype.__static=null,t.space.ZPP_Space.prototype.global_lin_drag=null,t.space.ZPP_Space.prototype.global_ang_drag=null,t.space.ZPP_Space.prototype.stamp=null,t.space.ZPP_Space.prototype.midstep=null,t.space.ZPP_Space.prototype.time=null,t.space.ZPP_Space.prototype.sortcontacts=null,t.space.ZPP_Space.prototype.c_arbiters_true=null,t.space.ZPP_Space.prototype.c_arbiters_false=null,t.space.ZPP_Space.prototype.f_arbiters=null,t.space.ZPP_Space.prototype.s_arbiters=null,t.space.ZPP_Space.prototype.wrap_arbiters=null,t.space.ZPP_Space.prototype.live=null,t.space.ZPP_Space.prototype.wrap_live=null,t.space.ZPP_Space.prototype.live_constraints=null,t.space.ZPP_Space.prototype.wrap_livecon=null,t.space.ZPP_Space.prototype.staticsleep=null,t.space.ZPP_Space.prototype.islands=null,t.space.ZPP_Space.prototype.listeners=null,t.space.ZPP_Space.prototype.wrap_listeners=null,t.space.ZPP_Space.prototype.callbacks=null,t.space.ZPP_Space.prototype.callbackset_list=null,t.space.ZPP_Space.prototype.cbsets=null,t.space.ZPP_Space.prototype.clear=function(){for(;null!=this.listeners.head;){var e=this.listeners.pop_unsafe();this.remListener(e)}for(;null!=this.callbackset_list.next;){var n=this.callbackset_list.pop_unsafe();n.arbiters.clear();var i=n;i.int1=i.int2=null,i.id=i.di=-1,i.freed=!0,i.next=t.space.ZPP_CallbackSet.zpp_pool,t.space.ZPP_CallbackSet.zpp_pool=i}for(;null!=this.c_arbiters_true.head;){var r=this.c_arbiters_true.pop_unsafe();if(!r.cleared){for(var o=r.b1.arbiters,a=null,s=o.head;null!=s;){if(s.elt==r){var l,p;null==a?(p=(l=o.head).next,o.head=p,null==o.head&&(o.pushmod=!0)):(p=(l=a.next).next,a.next=p,null==p&&(o.pushmod=!0));var u=l;u.elt=null,u.next=t.util.ZNPNode_ZPP_Arbiter.zpp_pool,t.util.ZNPNode_ZPP_Arbiter.zpp_pool=u,o.modified=!0,o.length--,o.pushmod=!0;break}a=s,s=s.next}for(var h=r.b2.arbiters,c=null,_=h.head;null!=_;){if(_.elt==r){var d,m;null==c?(m=(d=h.head).next,h.head=m,null==h.head&&(h.pushmod=!0)):(m=(d=c.next).next,c.next=m,null==m&&(h.pushmod=!0));var P=d;P.elt=null,P.next=t.util.ZNPNode_ZPP_Arbiter.zpp_pool,t.util.ZNPNode_ZPP_Arbiter.zpp_pool=P,h.modified=!0,h.length--,h.pushmod=!0;break}c=_,_=_.next}null!=r.pair&&(r.pair.arb=null,r.pair=null)}for(r.b1=r.b2=null,r.active=!1,r.intchange=!1;null!=r.contacts.next;){var f=r.contacts,x=f.next;f.pop();var y=x;y.arbiter=null,y.next=t.dynamics.ZPP_Contact.zpp_pool,t.dynamics.ZPP_Contact.zpp_pool=y;var v=r.innards,g=v.next;v.next=g.next,g._inuse=!1,null==v.next&&(v.pushmod=!0),v.modified=!0,v.length--}var b=r;b.userdef_dyn_fric=!1,b.userdef_stat_fric=!1,b.userdef_restitution=!1,b.userdef_rfric=!1,b.__ref_edge1=b.__ref_edge2=null,b.next=t.dynamics.ZPP_ColArbiter.zpp_pool,t.dynamics.ZPP_ColArbiter.zpp_pool=b,r.pre_dt=-1}for(;null!=this.c_arbiters_false.head;){var z=this.c_arbiters_false.pop_unsafe();if(!z.cleared){for(var w=z.b1.arbiters,Z=null,E=w.head;null!=E;){if(E.elt==z){var M,S;null==Z?(S=(M=w.head).next,w.head=S,null==w.head&&(w.pushmod=!0)):(S=(M=Z.next).next,Z.next=S,null==S&&(w.pushmod=!0));var C=M;C.elt=null,C.next=t.util.ZNPNode_ZPP_Arbiter.zpp_pool,t.util.ZNPNode_ZPP_Arbiter.zpp_pool=C,w.modified=!0,w.length--,w.pushmod=!0;break}Z=E,E=E.next}for(var N=z.b2.arbiters,A=null,L=N.head;null!=L;){if(L.elt==z){var B,T;null==A?(T=(B=N.head).next,N.head=T,null==N.head&&(N.pushmod=!0)):(T=(B=A.next).next,A.next=T,null==T&&(N.pushmod=!0));var V=B;V.elt=null,V.next=t.util.ZNPNode_ZPP_Arbiter.zpp_pool,t.util.ZNPNode_ZPP_Arbiter.zpp_pool=V,N.modified=!0,N.length--,N.pushmod=!0;break}A=L,L=L.next}null!=z.pair&&(z.pair.arb=null,z.pair=null)}for(z.b1=z.b2=null,z.active=!1,z.intchange=!1;null!=z.contacts.next;){var k=z.contacts,I=k.next;k.pop();var O=I;O.arbiter=null,O.next=t.dynamics.ZPP_Contact.zpp_pool,t.dynamics.ZPP_Contact.zpp_pool=O;var R=z.innards,H=R.next;R.next=H.next,H._inuse=!1,null==R.next&&(R.pushmod=!0),R.modified=!0,R.length--}var F=z;F.userdef_dyn_fric=!1,F.userdef_stat_fric=!1,F.userdef_restitution=!1,F.userdef_rfric=!1,F.__ref_edge1=F.__ref_edge2=null,F.next=t.dynamics.ZPP_ColArbiter.zpp_pool,t.dynamics.ZPP_ColArbiter.zpp_pool=F,z.pre_dt=-1}for(;null!=this.s_arbiters.head;){var D=this.s_arbiters.pop_unsafe();if(!D.cleared){for(var G=D.b1.arbiters,U=null,j=G.head;null!=j;){if(j.elt==D){var W,q;null==U?(q=(W=G.head).next,G.head=q,null==G.head&&(G.pushmod=!0)):(q=(W=U.next).next,U.next=q,null==q&&(G.pushmod=!0));var J=W;J.elt=null,J.next=t.util.ZNPNode_ZPP_Arbiter.zpp_pool,t.util.ZNPNode_ZPP_Arbiter.zpp_pool=J,G.modified=!0,G.length--,G.pushmod=!0;break}U=j,j=j.next}for(var $=D.b2.arbiters,X=null,Y=$.head;null!=Y;){if(Y.elt==D){var K,Q;null==X?(Q=(K=$.head).next,$.head=Q,null==$.head&&($.pushmod=!0)):(Q=(K=X.next).next,X.next=Q,null==Q&&($.pushmod=!0));var ee=K;ee.elt=null,ee.next=t.util.ZNPNode_ZPP_Arbiter.zpp_pool,t.util.ZNPNode_ZPP_Arbiter.zpp_pool=ee,$.modified=!0,$.length--,$.pushmod=!0;break}X=Y,Y=Y.next}null!=D.pair&&(D.pair.arb=null,D.pair=null)}D.b1=D.b2=null,D.active=!1,D.intchange=!1;var te=D;te.next=t.dynamics.ZPP_SensorArbiter.zpp_pool,t.dynamics.ZPP_SensorArbiter.zpp_pool=te}for(;null!=this.f_arbiters.head;){var ne=this.f_arbiters.pop_unsafe();if(!ne.cleared){for(var ie=ne.b1.arbiters,re=null,oe=ie.head;null!=oe;){if(oe.elt==ne){var ae,se;null==re?(se=(ae=ie.head).next,ie.head=se,null==ie.head&&(ie.pushmod=!0)):(se=(ae=re.next).next,re.next=se,null==se&&(ie.pushmod=!0));var le=ae;le.elt=null,le.next=t.util.ZNPNode_ZPP_Arbiter.zpp_pool,t.util.ZNPNode_ZPP_Arbiter.zpp_pool=le,ie.modified=!0,ie.length--,ie.pushmod=!0;break}re=oe,oe=oe.next}for(var pe=ne.b2.arbiters,ue=null,he=pe.head;null!=he;){if(he.elt==ne){var ce,_e;null==ue?(_e=(ce=pe.head).next,pe.head=_e,null==pe.head&&(pe.pushmod=!0)):(_e=(ce=ue.next).next,ue.next=_e,null==_e&&(pe.pushmod=!0));var de=ce;de.elt=null,de.next=t.util.ZNPNode_ZPP_Arbiter.zpp_pool,t.util.ZNPNode_ZPP_Arbiter.zpp_pool=de,pe.modified=!0,pe.length--,pe.pushmod=!0;break}ue=he,he=he.next}null!=ne.pair&&(ne.pair.arb=null,ne.pair=null)}ne.b1=ne.b2=null,ne.active=!1,ne.intchange=!1;var me=ne;me.next=t.dynamics.ZPP_FluidArbiter.zpp_pool,t.dynamics.ZPP_FluidArbiter.zpp_pool=me,ne.pre_dt=-1}for(this.bphase.clear();null!=this.bodies.head;){var Pe=this.bodies.pop_unsafe();if(null!=Pe.component){var fe=Pe.component.island;if(null!=fe){for(;null!=fe.comps.head;){var xe=fe.comps.pop_unsafe();xe.sleeping=!1,xe.island=null,xe.parent=xe,xe.rank=0}var ye=fe;ye.next=t.space.ZPP_Island.zpp_pool,t.space.ZPP_Island.zpp_pool=ye}}Pe.removedFromSpace(),Pe.space=null}for(;null!=this.constraints.head;){var ve=this.constraints.pop_unsafe();if(null!=ve.component){var ge=ve.component.island;if(null!=ge){for(;null!=ge.comps.head;){var be=ge.comps.pop_unsafe();be.sleeping=!1,be.island=null,be.parent=be,be.rank=0}var ze=ge;ze.next=t.space.ZPP_Island.zpp_pool,t.space.ZPP_Island.zpp_pool=ze}}ve.removedFromSpace(),ve.space=null}this.kinematics.clear();for(var we=new t.util.ZNPList_ZPP_Compound;null!=this.compounds.head;){var Ze=this.compounds.pop_unsafe();we.add(Ze)}for(;null!=we.head;){var Ee=we.pop_unsafe();Ee.removedFromSpace(),Ee.space=null;for(var Me=Ee.bodies.head;null!=Me;){var Se=Me.elt;if(null!=Se.component){var Ce=Se.component.island;if(null!=Ce){for(;null!=Ce.comps.head;){var Ne=Ce.comps.pop_unsafe();Ne.sleeping=!1,Ne.island=null,Ne.parent=Ne,Ne.rank=0}var Ae=Ce;Ae.next=t.space.ZPP_Island.zpp_pool,t.space.ZPP_Island.zpp_pool=Ae}}Se.removedFromSpace(),Se.space=null,Me=Me.next}for(var Le=Ee.constraints.head;null!=Le;){var Be=Le.elt;if(null!=Be.component){var Te=Be.component.island;if(null!=Te){for(;null!=Te.comps.head;){var Ve=Te.comps.pop_unsafe();Ve.sleeping=!1,Ve.island=null,Ve.parent=Ve,Ve.rank=0}var ke=Te;ke.next=t.space.ZPP_Island.zpp_pool,t.space.ZPP_Island.zpp_pool=ke}}Be.removedFromSpace(),Be.space=null,Le=Le.next}for(var Ie=Ee.compounds.head;null!=Ie;){var Oe=Ie.elt;we.add(Oe),Ie=Ie.next}}this.staticsleep.clear(),this.live.clear(),this.live_constraints.clear(),this.stamp=0,this.time=0,this.mrca1.clear(),this.mrca2.clear(),this.prelisteners.clear(),this.cbsets.clear()},t.space.ZPP_Space.prototype.bodies_adder=function(e){if(null!=e.zpp_inner.compound)throw new n._Boot.HaxeError("Error: Cannot set the space of a Body belonging to a Compound, only the root Compound space can be set");return e.zpp_inner.space!=this&&(null!=e.zpp_inner.space&&e.zpp_inner.space.outer.zpp_inner.wrap_bodies.remove(e),this.addBody(e.zpp_inner),!0)},t.space.ZPP_Space.prototype.bodies_subber=function(e){this.remBody(e.zpp_inner)},t.space.ZPP_Space.prototype.bodies_modifiable=function(){if(this.midstep)throw new n._Boot.HaxeError("Error: Space::bodies cannot be set during space step()")},t.space.ZPP_Space.prototype.compounds_adder=function(e){if(null!=e.zpp_inner.compound)throw new n._Boot.HaxeError("Error: Cannot set the space of an inner Compound, only the root Compound space can be set");return e.zpp_inner.space!=this&&(null!=e.zpp_inner.space&&e.zpp_inner.space.wrap_compounds.remove(e),this.addCompound(e.zpp_inner),!0)},t.space.ZPP_Space.prototype.compounds_subber=function(e){this.remCompound(e.zpp_inner)},t.space.ZPP_Space.prototype.compounds_modifiable=function(){if(this.midstep)throw new n._Boot.HaxeError("Error: Space::compounds cannot be set during space step()")},t.space.ZPP_Space.prototype.constraints_adder=function(e){if(null!=e.zpp_inner.compound)throw new n._Boot.HaxeError("Error: Cannot set the space of a Constraint belonging to a Compound, only the root Compound space can be set");return e.zpp_inner.space!=this&&(null!=e.zpp_inner.space&&e.zpp_inner.space.outer.zpp_inner.wrap_constraints.remove(e),this.addConstraint(e.zpp_inner),!0)},t.space.ZPP_Space.prototype.constraints_subber=function(e){this.remConstraint(e.zpp_inner)},t.space.ZPP_Space.prototype.constraints_modifiable=function(){if(this.midstep)throw new n._Boot.HaxeError("Error: Space::constraints cannot be set during space step()")},t.space.ZPP_Space.prototype.listeners_adder=function(e){return e.zpp_inner.space!=this&&(null!=e.zpp_inner.space&&e.zpp_inner.space.outer.zpp_inner.wrap_listeners.remove(e),this.addListener(e.zpp_inner),!0)},t.space.ZPP_Space.prototype.listeners_subber=function(e){this.remListener(e.zpp_inner)},t.space.ZPP_Space.prototype.listeners_modifiable=function(){if(this.midstep)throw new n._Boot.HaxeError("Error: Space::listeners cannot be set during space step()")},t.space.ZPP_Space.prototype.revoke_listener=function(e){},t.space.ZPP_Space.prototype.unrevoke_listener=function(e){},t.space.ZPP_Space.prototype.addListener=function(e){e.space=this,e.addedToSpace(),e.interaction},t.space.ZPP_Space.prototype.remListener=function(e){e.interaction,e.removedFromSpace(),e.space=null},t.space.ZPP_Space.prototype.add_callbackset=function(e){var n,i=e.int1.cbsets;null==t.util.ZNPNode_ZPP_CallbackSet.zpp_pool?n=new t.util.ZNPNode_ZPP_CallbackSet:(n=t.util.ZNPNode_ZPP_CallbackSet.zpp_pool,t.util.ZNPNode_ZPP_CallbackSet.zpp_pool=n.next,n.next=null),n.elt=e;var r=n;r.next=i.head,i.head=r,i.modified=!0,i.length++;var o,a=e.int2.cbsets;null==t.util.ZNPNode_ZPP_CallbackSet.zpp_pool?o=new t.util.ZNPNode_ZPP_CallbackSet:(o=t.util.ZNPNode_ZPP_CallbackSet.zpp_pool,t.util.ZNPNode_ZPP_CallbackSet.zpp_pool=o.next,o.next=null),o.elt=e;var s=o;s.next=a.head,a.head=s,a.modified=!0,a.length++;var l=this.callbackset_list;e._inuse=!0;var p=e;p.next=l.next,l.next=p,l.modified=!0,l.length++},t.space.ZPP_Space.prototype.remove_callbackset=function(e){e.lazydel=!0;for(var n=e.int1.cbsets,i=null,r=n.head;null!=r;){if(r.elt==e){var o,a;null==i?(a=(o=n.head).next,n.head=a,null==n.head&&(n.pushmod=!0)):(a=(o=i.next).next,i.next=a,null==a&&(n.pushmod=!0));var s=o;s.elt=null,s.next=t.util.ZNPNode_ZPP_CallbackSet.zpp_pool,t.util.ZNPNode_ZPP_CallbackSet.zpp_pool=s,n.modified=!0,n.length--,n.pushmod=!0;break}i=r,r=r.next}for(var l=e.int2.cbsets,p=null,u=l.head;null!=u;){if(u.elt==e){var h,c;null==p?(c=(h=l.head).next,l.head=c,null==l.head&&(l.pushmod=!0)):(c=(h=p.next).next,p.next=c,null==c&&(l.pushmod=!0));var _=h;_.elt=null,_.next=t.util.ZNPNode_ZPP_CallbackSet.zpp_pool,t.util.ZNPNode_ZPP_CallbackSet.zpp_pool=_,l.modified=!0,l.length--,l.pushmod=!0;break}p=u,u=u.next}},t.space.ZPP_Space.prototype.transmitType=function(e,t){var n=e;n.world||(n.component.waket=this.stamp+(this.midstep?0:1),3==n.type&&(n.kinematicDelaySleep=!0),n.component.sleeping&&this.really_wake(n,!1)),2==e.type?this.live.remove(e):3==e.type?(this.kinematics.remove(e),this.staticsleep.remove(e)):1==e.type&&this.staticsleep.remove(e),e.type=t,3==e.type&&this.kinematics.add(e),1==e.type&&this.static_validation(e),e.component.sleeping=!0;var i=e;i.world||(i.component.waket=this.stamp+(this.midstep?0:1),3==i.type&&(i.kinematicDelaySleep=!0),i.component.sleeping&&this.really_wake(i,!0))},t.space.ZPP_Space.prototype.added_shape=function(e,t){if(null==t&&(t=!1),!t){var n=e.body;n.world||(n.component.waket=this.stamp+(this.midstep?0:1),3==n.type&&(n.kinematicDelaySleep=!0),n.component.sleeping&&this.really_wake(n,!1))}this.bphase.insert(e),e.addedToSpace()},t.space.ZPP_Space.prototype.removed_shape=function(e,n){null==n&&(n=!1);var i=e.body;n||i.wake();for(var r=null,o=i.arbiters.head;null!=o;){var a=o.elt;if(a.ws1==e||a.ws2==e){if(0!=a.present){this.MRCA_chains(a.ws1,a.ws2);for(var s=this.mrca1.head;null!=s;){for(var l=s.elt,p=this.mrca2.head;null!=p;){var u=p.elt,h=l.cbSet,c=u.cbSet;h.validate(),c.validate(),h.manager;for(var _,d=null,m=(h.cbpairs.length<c.cbpairs.length?h.cbpairs:c.cbpairs).head;null!=m;){var P=m.elt;if(P.a==h&&P.b==c||P.a==c&&P.b==h){d=P;break}m=m.next}if(null==d&&(null==t.callbacks.ZPP_CbSetPair.zpp_pool?_=new t.callbacks.ZPP_CbSetPair:(_=t.callbacks.ZPP_CbSetPair.zpp_pool,t.callbacks.ZPP_CbSetPair.zpp_pool=_.next,_.next=null),_.zip_listeners=!0,t.callbacks.ZPP_CbSet.setlt(h,c)?(_.a=h,_.b=c):(_.a=c,_.b=h),d=_,h.cbpairs.add(d),c!=h&&c.cbpairs.add(d)),d.zip_listeners&&(d.zip_listeners=!1,d.__validate()),null!=d.listeners.head){var f=t.phys.ZPP_Interactor.get(l,u);f.remove_arb(a),a.present--,h.manager;for(var x,y=null,v=(h.cbpairs.length<c.cbpairs.length?h.cbpairs:c.cbpairs).head;null!=v;){var g=v.elt;if(g.a==h&&g.b==c||g.a==c&&g.b==h){y=g;break}v=v.next}null==y&&(null==t.callbacks.ZPP_CbSetPair.zpp_pool?x=new t.callbacks.ZPP_CbSetPair:(x=t.callbacks.ZPP_CbSetPair.zpp_pool,t.callbacks.ZPP_CbSetPair.zpp_pool=x.next,x.next=null),x.zip_listeners=!0,t.callbacks.ZPP_CbSet.setlt(h,c)?(x.a=h,x.b=c):(x.a=c,x.b=h),y=x,h.cbpairs.add(y),c!=h&&c.cbpairs.add(y)),y.zip_listeners&&(y.zip_listeners=!1,y.__validate());for(var b=y.listeners.head;null!=b;){var z=b.elt;if(1==z.event&&0!=(z.itype&a.type)&&f.empty_arb(z.itype)){var w=this.push_callback(z);w.event=1;var Z,E=f.int1,M=f.int2,S=z.options1,C=E.cbTypes;if(S.nonemptyintersection(C,S.includes)&&!S.nonemptyintersection(C,S.excludes)){var N=z.options2,A=M.cbTypes;Z=N.nonemptyintersection(A,N.includes)&&!N.nonemptyintersection(A,N.excludes)}else Z=!1;Z?(w.int1=E,w.int2=M):(w.int1=M,w.int2=E),w.set=f}b=b.next}null==f.arbiters.head&&this.remove_callbackset(f),p=p.next}else p=p.next}s=s.next}}if(a.b1!=i&&2==a.b1.type){var L=a.b1;L.world||(L.component.waket=this.stamp+(this.midstep?0:1),3==L.type&&(L.kinematicDelaySleep=!0),L.component.sleeping&&this.really_wake(L,!1))}if(a.b2!=i&&2==a.b2.type){var B=a.b2;B.world||(B.component.waket=this.stamp+(this.midstep?0:1),3==B.type&&(B.kinematicDelaySleep=!0),B.component.sleeping&&this.really_wake(B,!1))}if(a.cleared=!0,null==i||a.b2==i)for(var T=a.b1.arbiters,V=null,k=T.head;null!=k;){if(k.elt==a){var I,O;null==V?(O=(I=T.head).next,T.head=O,null==T.head&&(T.pushmod=!0)):(O=(I=V.next).next,V.next=O,null==O&&(T.pushmod=!0));var R=I;R.elt=null,R.next=t.util.ZNPNode_ZPP_Arbiter.zpp_pool,t.util.ZNPNode_ZPP_Arbiter.zpp_pool=R,T.modified=!0,T.length--,T.pushmod=!0;break}V=k,k=k.next}if(null==i||a.b1==i)for(var H=a.b2.arbiters,F=null,D=H.head;null!=D;){if(D.elt==a){var G,U;null==F?(U=(G=H.head).next,H.head=U,null==H.head&&(H.pushmod=!0)):(U=(G=F.next).next,F.next=U,null==U&&(H.pushmod=!0));var j=G;j.elt=null,j.next=t.util.ZNPNode_ZPP_Arbiter.zpp_pool,t.util.ZNPNode_ZPP_Arbiter.zpp_pool=j,H.modified=!0,H.length--,H.pushmod=!0;break}F=D,D=D.next}null!=a.pair&&(a.pair.arb=null,a.pair=null),a.active=!1,this.f_arbiters.modified=!0,o=i.arbiters.erase(r)}else r=o,o=o.next}this.bphase.remove(e),e.removedFromSpace()},t.space.ZPP_Space.prototype.addConstraint=function(e){e.space=this,e.addedToSpace(),e.active&&(e.component.sleeping=!0,this.wake_constraint(e,!0))},t.space.ZPP_Space.prototype.remConstraint=function(e){e.active&&(this.wake_constraint(e,!0),this.live_constraints.remove(e)),e.removedFromSpace(),e.space=null},t.space.ZPP_Space.prototype.addCompound=function(e){e.space=this,e.addedToSpace();for(var t=e.bodies.head;null!=t;){var n=t.elt;this.addBody(n),t=t.next}for(var i=e.constraints.head;null!=i;){var r=i.elt;this.addConstraint(r),i=i.next}for(var o=e.compounds.head;null!=o;){var a=o.elt;this.addCompound(a),o=o.next}},t.space.ZPP_Space.prototype.remCompound=function(e){for(var t=e.bodies.head;null!=t;){var n=t.elt;this.remBody(n),t=t.next}for(var i=e.constraints.head;null!=i;){var r=i.elt;this.remConstraint(r),i=i.next}for(var o=e.compounds.head;null!=o;){var a=o.elt;this.remCompound(a),o=o.next}e.removedFromSpace(),e.space=null},t.space.ZPP_Space.prototype.addBody=function(e,t){null==t&&(t=-1),e.space=this,e.addedToSpace(),e.component.sleeping=!0;var n=e;n.world||(n.component.waket=this.stamp+(this.midstep?0:1),3==n.type&&(n.kinematicDelaySleep=!0),n.component.sleeping&&this.really_wake(n,!0));for(var i=e.shapes.head;null!=i;){var r=i.elt,o=!0;if(null==o&&(o=!1),!o){var a=r.body;a.world||(a.component.waket=this.stamp+(this.midstep?0:1),3==a.type&&(a.kinematicDelaySleep=!0),a.component.sleeping&&this.really_wake(a,!1))}this.bphase.insert(r),r.addedToSpace(),i=i.next}1==e.type?this.static_validation(e):2!=e.type&&3!=t&&this.kinematics.add(e)},t.space.ZPP_Space.prototype.remBody=function(e,t){if(null==t&&(t=-1),1==e.type){var n=e;n.world||(n.component.waket=this.stamp+(this.midstep?0:1),3==n.type&&(n.kinematicDelaySleep=!0),n.component.sleeping&&this.really_wake(n,!0)),this.staticsleep.remove(e)}else if(2==e.type){var i=e;i.world||(i.component.waket=this.stamp+(this.midstep?0:1),3==i.type&&(i.kinematicDelaySleep=!0),i.component.sleeping&&this.really_wake(i,!0)),this.live.remove(e)}else{3!=t&&this.kinematics.remove(e);var r=e;r.world||(r.component.waket=this.stamp+(this.midstep?0:1),3==r.type&&(r.kinematicDelaySleep=!0),r.component.sleeping&&this.really_wake(r,!0)),this.staticsleep.remove(e)}for(var o=e.shapes.head;null!=o;){var a=o.elt;this.removed_shape(a,!0),o=o.next}e.removedFromSpace(),e.space=null},t.space.ZPP_Space.prototype.shapesUnderPoint=function(e,t,n,i){return this.bphase.shapesUnderPoint(e,t,n,i)},t.space.ZPP_Space.prototype.bodiesUnderPoint=function(e,t,n,i){return this.bphase.bodiesUnderPoint(e,t,n,i)},t.space.ZPP_Space.prototype.shapesInAABB=function(e,t,n,i,r){return this.bphase.shapesInAABB(e.zpp_inner,t,n,i,r)},t.space.ZPP_Space.prototype.bodiesInAABB=function(e,t,n,i,r){return this.bphase.bodiesInAABB(e.zpp_inner,t,n,i,r)},t.space.ZPP_Space.prototype.shapesInCircle=function(e,t,i,r,o){var a=this.bphase;if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var s=e.zpp_inner;null!=s._validate&&s._validate();var l=e.zpp_inner.x;if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var p=e.zpp_inner;return null!=p._validate&&p._validate(),a.shapesInCircle(l,e.zpp_inner.y,t,i,r,o)},t.space.ZPP_Space.prototype.bodiesInCircle=function(e,t,i,r,o){var a=this.bphase;if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var s=e.zpp_inner;null!=s._validate&&s._validate();var l=e.zpp_inner.x;if(null!=e&&e.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var p=e.zpp_inner;return null!=p._validate&&p._validate(),a.bodiesInCircle(l,e.zpp_inner.y,t,i,r,o)},t.space.ZPP_Space.prototype.shapesInShape=function(e,t,n,i){return this.bphase.shapesInShape(e,t,n,i)},t.space.ZPP_Space.prototype.bodiesInShape=function(e,t,n,i){return this.bphase.bodiesInShape(e,t,n,i)},t.space.ZPP_Space.prototype.rayCast=function(e,t,n){return this.bphase.rayCast(e.zpp_inner,t,null==n?null:n.zpp_inner)},t.space.ZPP_Space.prototype.rayMultiCast=function(e,t,n,i){return this.bphase.rayMultiCast(e.zpp_inner,t,null==n?null:n.zpp_inner,i)},t.space.ZPP_Space.prototype.convexShapeList=null,t.space.ZPP_Space.prototype.convexCast=function(i,r,o,a){var s;if(null==t.geom.ZPP_ToiEvent.zpp_pool?s=new t.geom.ZPP_ToiEvent:(s=t.geom.ZPP_ToiEvent.zpp_pool,t.geom.ZPP_ToiEvent.zpp_pool=s.next,s.next=null),s.failed=!1,s.s1=s.s2=null,s.arbiter=null,0==i.type){var l=i.circle;if(l.zip_worldCOM&&null!=l.body){if(l.zip_worldCOM=!1,l.zip_localCOM){if(l.zip_localCOM=!1,1==l.type){var p=l.polygon;if(null==p.lverts.next)throw new n._Boot.HaxeError("Error: An empty polygon has no meaningful localCOM");if(null==p.lverts.next.next)p.localCOMx=p.lverts.next.x,p.localCOMy=p.lverts.next.y;else if(null==p.lverts.next.next.next)p.localCOMx=p.lverts.next.x,p.localCOMy=p.lverts.next.y,p.localCOMx+=1*p.lverts.next.next.x,p.localCOMy+=1*p.lverts.next.next.y,p.localCOMx*=.5,p.localCOMy*=.5;else{p.localCOMx=0,p.localCOMy=0;var u=0,h=p.lverts.next,c=h,_=h=h.next;for(h=h.next;null!=h;){var d=h;u+=_.x*(d.y-c.y);var m=d.y*_.x-d.x*_.y;p.localCOMx+=(_.x+d.x)*m,p.localCOMy+=(_.y+d.y)*m,c=_,_=d,h=h.next}var P=h=p.lverts.next;u+=_.x*(P.y-c.y);var f=P.y*_.x-P.x*_.y;p.localCOMx+=(_.x+P.x)*f,p.localCOMy+=(_.y+P.y)*f,c=_,_=P;var x=h=h.next;u+=_.x*(x.y-c.y);var y=x.y*_.x-x.x*_.y;p.localCOMx+=(_.x+x.x)*y,p.localCOMy+=(_.y+x.y)*y;var v=u=1/(3*u);p.localCOMx*=v,p.localCOMy*=v}}null!=l.wrap_localCOM&&(l.wrap_localCOM.zpp_inner.x=l.localCOMx,l.wrap_localCOM.zpp_inner.y=l.localCOMy)}var g=l.body;g.zip_axis&&(g.zip_axis=!1,g.axisx=Math.sin(g.rot),g.axisy=Math.cos(g.rot)),l.worldCOMx=l.body.posx+(l.body.axisy*l.localCOMx-l.body.axisx*l.localCOMy),l.worldCOMy=l.body.posy+(l.localCOMx*l.body.axisx+l.localCOMy*l.body.axisy)}}else{var b=i.polygon;if(b.zip_gaxi&&null!=b.body){b.zip_gaxi=!1,b.validate_laxi();var z=b.body;if(z.zip_axis&&(z.zip_axis=!1,z.axisx=Math.sin(z.rot),z.axisy=Math.cos(z.rot)),b.zip_gverts&&null!=b.body){b.zip_gverts=!1,b.validate_lverts();var w=b.body;w.zip_axis&&(w.zip_axis=!1,w.axisx=Math.sin(w.rot),w.axisy=Math.cos(w.rot));for(var Z=b.lverts.next,E=b.gverts.next;null!=E;){var M=E,S=Z;Z=Z.next,M.x=b.body.posx+(b.body.axisy*S.x-b.body.axisx*S.y),M.y=b.body.posy+(S.x*b.body.axisx+S.y*b.body.axisy),E=E.next}}var C=b.edges.head,N=b.gverts.next,A=N;for(N=N.next;null!=N;){var L=N,B=C.elt;C=C.next,B.gp0=A,B.gp1=L,B.gnormx=b.body.axisy*B.lnormx-b.body.axisx*B.lnormy,B.gnormy=B.lnormx*b.body.axisx+B.lnormy*b.body.axisy,B.gprojection=b.body.posx*B.gnormx+b.body.posy*B.gnormy+B.lprojection,null!=B.wrap_gnorm&&(B.wrap_gnorm.zpp_inner.x=B.gnormx,B.wrap_gnorm.zpp_inner.y=B.gnormy),B.tp0=B.gp0.y*B.gnormx-B.gp0.x*B.gnormy,B.tp1=B.gp1.y*B.gnormx-B.gp1.x*B.gnormy,A=L,N=N.next}var T=b.gverts.next,V=C.elt;C=C.next,V.gp0=A,V.gp1=T,V.gnormx=b.body.axisy*V.lnormx-b.body.axisx*V.lnormy,V.gnormy=V.lnormx*b.body.axisx+V.lnormy*b.body.axisy,V.gprojection=b.body.posx*V.gnormx+b.body.posy*V.gnormy+V.lprojection,null!=V.wrap_gnorm&&(V.wrap_gnorm.zpp_inner.x=V.gnormx,V.wrap_gnorm.zpp_inner.y=V.gnormy),V.tp0=V.gp0.y*V.gnormx-V.gp0.x*V.gnormy,V.tp1=V.gp1.y*V.gnormx-V.gp1.x*V.gnormy}}var k=i.body,I=k.posx,O=k.posy;k.sweepTime=0,k.sweep_angvel=k.angvel;var R=r-k.sweepTime;if(0!=R){k.sweepTime=r;var H=R;if(k.posx+=k.velx*H,k.posy+=k.vely*H,0!=k.angvel){var F=k.sweep_angvel*R;if(k.rot+=F,F*F>1e-4)k.axisx=Math.sin(k.rot),k.axisy=Math.cos(k.rot);else{var D=F*F,G=1-.5*D,U=1-D*D/8,j=(G*k.axisx+F*k.axisy)*U;k.axisy=(G*k.axisy-F*k.axisx)*U,k.axisx=j}}}var W=k.posx,q=k.posy;i.validate_sweepRadius();var J,$=i.sweepRadius;null==t.geom.ZPP_AABB.zpp_pool?J=new t.geom.ZPP_AABB:(J=t.geom.ZPP_AABB.zpp_pool,t.geom.ZPP_AABB.zpp_pool=J.next,J.next=null);var X=I,Y=W;J.minx=(X<Y?X:Y)-$;var K=I,Q=W;J.maxx=(K>Q?K:Q)+$;var ee=O,te=q;J.miny=(ee<te?ee:te)-$;var ne=O,ie=q;J.maxy=(ne>ie?ne:ie)+$;var re=this.convexShapeList=this.bphase.shapesInAABB(J,!1,!1,null==o?null:o.zpp_inner,this.convexShapeList),oe=J;null!=oe.outer&&(oe.outer.zpp_inner=null,oe.outer=null),oe.wrap_min=oe.wrap_max=null,oe._invalidate=null,oe._validate=null,oe.next=t.geom.ZPP_AABB.zpp_pool,t.geom.ZPP_AABB.zpp_pool=oe;var ae=0,se=0;ae=0,se=0;var le=0,pe=0;le=0,pe=0;var ue=null,he=r+1;re.zpp_inner.valmod();for(var ce=e.shape.ShapeIterator.get(re);;){ce.zpp_inner.zpp_inner.valmod();var _e=ce.zpp_inner;_e.zpp_inner.valmod(),_e.zpp_inner.zip_length&&(_e.zpp_inner.zip_length=!1,_e.zpp_inner.user_length=_e.zpp_inner.inner.length);var de,me=_e.zpp_inner.user_length;if(ce.zpp_critical=!0,ce.zpp_i<me?de=!0:(ce.zpp_next=e.shape.ShapeIterator.zpp_pool,e.shape.ShapeIterator.zpp_pool=ce,ce.zpp_inner=null,de=!1),!de)break;ce.zpp_critical=!1;var Pe=ce.zpp_inner.at(ce.zpp_i++);if(Pe!=i.outer&&(null!=Pe.zpp_inner.body?Pe.zpp_inner.body.outer:null)!=k.outer){if(s.s1=i,s.s2=Pe.zpp_inner,a){Pe.zpp_inner.validate_sweepRadius(),(null!=Pe.zpp_inner.body?Pe.zpp_inner.body.outer:null).zpp_inner.sweep_angvel=(null!=Pe.zpp_inner.body?Pe.zpp_inner.body.outer:null).zpp_inner.angvel,(null!=Pe.zpp_inner.body?Pe.zpp_inner.body.outer:null).zpp_inner.sweepTime=0,t.geom.ZPP_SweepDistance.dynamicSweep(s,r,0,0,!0);var fe=(null!=Pe.zpp_inner.body?Pe.zpp_inner.body.outer:null).zpp_inner,xe=0-fe.sweepTime;if(0!=xe){fe.sweepTime=0;var ye=xe;if(fe.posx+=fe.velx*ye,fe.posy+=fe.vely*ye,0!=fe.angvel){var ve=fe.sweep_angvel*xe;if(fe.rot+=ve,ve*ve>1e-4)fe.axisx=Math.sin(fe.rot),fe.axisy=Math.cos(fe.rot);else{var ge=ve*ve,be=1-.5*ge,ze=1-ge*ge/8,we=(be*fe.axisx+ve*fe.axisy)*ze;fe.axisy=(be*fe.axisy-ve*fe.axisx)*ze,fe.axisx=we}}}var Ze=(null!=Pe.zpp_inner.body?Pe.zpp_inner.body.outer:null).zpp_inner,Ee=Pe.zpp_inner;if(0==Ee.type)Ee.worldCOMx=Ze.posx+(Ze.axisy*Ee.localCOMx-Ze.axisx*Ee.localCOMy),Ee.worldCOMy=Ze.posy+(Ee.localCOMx*Ze.axisx+Ee.localCOMy*Ze.axisy);else{for(var Me=Ee.polygon,Se=Me.lverts.next,Ce=Me.gverts.next;null!=Ce;){var Ne=Ce,Ae=Se;Se=Se.next,Ne.x=Ze.posx+(Ze.axisy*Ae.x-Ze.axisx*Ae.y),Ne.y=Ze.posy+(Ae.x*Ze.axisx+Ae.y*Ze.axisy),Ce=Ce.next}var Le=Me.edges.head,Be=Me.gverts.next,Te=Be;for(Be=Be.next;null!=Be;){var Ve=Be,ke=Le.elt;Le=Le.next,ke.gnormx=Ze.axisy*ke.lnormx-Ze.axisx*ke.lnormy,ke.gnormy=ke.lnormx*Ze.axisx+ke.lnormy*Ze.axisy,ke.gprojection=Ze.posx*ke.gnormx+Ze.posy*ke.gnormy+ke.lprojection,ke.tp0=Te.y*ke.gnormx-Te.x*ke.gnormy,ke.tp1=Ve.y*ke.gnormx-Ve.x*ke.gnormy,Te=Ve,Be=Be.next}var Ie=Me.gverts.next,Oe=Le.elt;Le=Le.next,Oe.gnormx=Ze.axisy*Oe.lnormx-Ze.axisx*Oe.lnormy,Oe.gnormy=Oe.lnormx*Ze.axisx+Oe.lnormy*Ze.axisy,Oe.gprojection=Ze.posx*Oe.gnormx+Ze.posy*Oe.gnormy+Oe.lprojection,Oe.tp0=Te.y*Oe.gnormx-Te.x*Oe.gnormy,Oe.tp1=Ie.y*Oe.gnormx-Ie.x*Oe.gnormy}}else t.geom.ZPP_SweepDistance.staticSweep(s,r,0,0);s.toi*=r,s.toi>0&&s.toi<he&&(he=s.toi,ae=s.axis.x,se=s.axis.y,le=s.c2.x,pe=s.c2.y,ue=Pe)}}re.clear();var Re=s;Re.next=t.geom.ZPP_ToiEvent.zpp_pool,t.geom.ZPP_ToiEvent.zpp_pool=Re;var He=0-k.sweepTime;if(0!=He){k.sweepTime=0;var Fe=He;if(k.posx+=k.velx*Fe,k.posy+=k.vely*Fe,0!=k.angvel){var De=k.sweep_angvel*He;if(k.rot+=De,De*De>1e-4)k.axisx=Math.sin(k.rot),k.axisy=Math.cos(k.rot);else{var Ge=De*De,Ue=1-.5*Ge,je=1-Ge*Ge/8,We=(Ue*k.axisx+De*k.axisy)*je;k.axisy=(Ue*k.axisy-De*k.axisx)*je,k.axisx=We}}}if(0==i.type)i.worldCOMx=k.posx+(k.axisy*i.localCOMx-k.axisx*i.localCOMy),i.worldCOMy=k.posy+(i.localCOMx*k.axisx+i.localCOMy*k.axisy);else{for(var qe=i.polygon,Je=qe.lverts.next,$e=qe.gverts.next;null!=$e;){var Xe=$e,Ye=Je;Je=Je.next,Xe.x=k.posx+(k.axisy*Ye.x-k.axisx*Ye.y),Xe.y=k.posy+(Ye.x*k.axisx+Ye.y*k.axisy),$e=$e.next}var Ke=qe.edges.head,Qe=qe.gverts.next,et=Qe;for(Qe=Qe.next;null!=Qe;){var tt=Qe,nt=Ke.elt;Ke=Ke.next,nt.gnormx=k.axisy*nt.lnormx-k.axisx*nt.lnormy,nt.gnormy=nt.lnormx*k.axisx+nt.lnormy*k.axisy,nt.gprojection=k.posx*nt.gnormx+k.posy*nt.gnormy+nt.lprojection,nt.tp0=et.y*nt.gnormx-et.x*nt.gnormy,nt.tp1=tt.y*nt.gnormx-tt.x*nt.gnormy,et=tt,Qe=Qe.next}var it=qe.gverts.next,rt=Ke.elt;Ke=Ke.next,rt.gnormx=k.axisy*rt.lnormx-k.axisx*rt.lnormy,rt.gnormy=rt.lnormx*k.axisx+rt.lnormy*k.axisy,rt.gprojection=k.posx*rt.gnormx+k.posy*rt.gnormy+rt.lprojection,rt.tp0=et.y*rt.gnormx-et.x*rt.gnormy,rt.tp1=it.y*rt.gnormx-it.x*rt.gnormy}if(he<=r){var ot,at=-ae,st=-se;if(null==st&&(st=0),null==at&&(at=0),at!=at||st!=st)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null==t.util.ZPP_PubPool.poolVec2?ot=new e.geom.Vec2:(ot=t.util.ZPP_PubPool.poolVec2,t.util.ZPP_PubPool.poolVec2=ot.zpp_pool,ot.zpp_pool=null,ot.zpp_disp=!1,ot==t.util.ZPP_PubPool.nextVec2&&(t.util.ZPP_PubPool.nextVec2=null)),null==ot.zpp_inner){var lt;null==t.geom.ZPP_Vec2.zpp_pool?lt=new t.geom.ZPP_Vec2:(lt=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=lt.next,lt.next=null),lt.weak=!1,lt._immutable=!1,lt.x=at,lt.y=st,ot.zpp_inner=lt,ot.zpp_inner.outer=ot}else{if(null!=ot&&ot.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var pt,ut=ot.zpp_inner;if(ut._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=ut._isimmutable&&ut._isimmutable(),at!=at||st!=st)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null!=ot&&ot.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var ht=ot.zpp_inner;if(null!=ht._validate&&ht._validate(),ot.zpp_inner.x==at){if(null!=ot&&ot.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var ct=ot.zpp_inner;null!=ct._validate&&ct._validate(),pt=ot.zpp_inner.y==st}else pt=!1;if(!pt){ot.zpp_inner.x=at,ot.zpp_inner.y=st;var _t=ot.zpp_inner;null!=_t._invalidate&&_t._invalidate(_t)}}ot.zpp_inner.weak=!1;var dt,mt=le,Pt=pe;if(null==Pt&&(Pt=0),null==mt&&(mt=0),mt!=mt||Pt!=Pt)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null==t.util.ZPP_PubPool.poolVec2?dt=new e.geom.Vec2:(dt=t.util.ZPP_PubPool.poolVec2,t.util.ZPP_PubPool.poolVec2=dt.zpp_pool,dt.zpp_pool=null,dt.zpp_disp=!1,dt==t.util.ZPP_PubPool.nextVec2&&(t.util.ZPP_PubPool.nextVec2=null)),null==dt.zpp_inner){var ft;null==t.geom.ZPP_Vec2.zpp_pool?ft=new t.geom.ZPP_Vec2:(ft=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=ft.next,ft.next=null),ft.weak=!1,ft._immutable=!1,ft.x=mt,ft.y=Pt,dt.zpp_inner=ft,dt.zpp_inner.outer=dt}else{if(null!=dt&&dt.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var xt,yt=dt.zpp_inner;if(yt._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=yt._isimmutable&&yt._isimmutable(),mt!=mt||Pt!=Pt)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null!=dt&&dt.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var vt=dt.zpp_inner;if(null!=vt._validate&&vt._validate(),dt.zpp_inner.x==mt){if(null!=dt&&dt.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var gt=dt.zpp_inner;null!=gt._validate&&gt._validate(),xt=dt.zpp_inner.y==Pt}else xt=!1;if(!xt){dt.zpp_inner.x=mt,dt.zpp_inner.y=Pt;var bt=dt.zpp_inner;null!=bt._invalidate&&bt._invalidate(bt)}}return dt.zpp_inner.weak=!1,t.geom.ZPP_ConvexRayResult.getConvex(ot,dt,he,ue)}return null},t.space.ZPP_Space.prototype.prepareCast=function(e){if(0==e.type){var t=e.circle;if(t.zip_worldCOM&&null!=t.body){if(t.zip_worldCOM=!1,t.zip_localCOM){if(t.zip_localCOM=!1,1==t.type){var i=t.polygon;if(null==i.lverts.next)throw new n._Boot.HaxeError("Error: An empty polygon has no meaningful localCOM");if(null==i.lverts.next.next)i.localCOMx=i.lverts.next.x,i.localCOMy=i.lverts.next.y;else if(null==i.lverts.next.next.next)i.localCOMx=i.lverts.next.x,i.localCOMy=i.lverts.next.y,i.localCOMx+=1*i.lverts.next.next.x,i.localCOMy+=1*i.lverts.next.next.y,i.localCOMx*=.5,i.localCOMy*=.5;else{i.localCOMx=0,i.localCOMy=0;var r=0,o=i.lverts.next,a=o,s=o=o.next;for(o=o.next;null!=o;){var l=o;r+=s.x*(l.y-a.y);var p=l.y*s.x-l.x*s.y;i.localCOMx+=(s.x+l.x)*p,i.localCOMy+=(s.y+l.y)*p,a=s,s=l,o=o.next}var u=o=i.lverts.next;r+=s.x*(u.y-a.y);var h=u.y*s.x-u.x*s.y;i.localCOMx+=(s.x+u.x)*h,i.localCOMy+=(s.y+u.y)*h,a=s,s=u;var c=o=o.next;r+=s.x*(c.y-a.y);var _=c.y*s.x-c.x*s.y;i.localCOMx+=(s.x+c.x)*_,i.localCOMy+=(s.y+c.y)*_;var d=r=1/(3*r);i.localCOMx*=d,i.localCOMy*=d}}null!=t.wrap_localCOM&&(t.wrap_localCOM.zpp_inner.x=t.localCOMx,t.wrap_localCOM.zpp_inner.y=t.localCOMy)}var m=t.body;m.zip_axis&&(m.zip_axis=!1,m.axisx=Math.sin(m.rot),m.axisy=Math.cos(m.rot)),t.worldCOMx=t.body.posx+(t.body.axisy*t.localCOMx-t.body.axisx*t.localCOMy),t.worldCOMy=t.body.posy+(t.localCOMx*t.body.axisx+t.localCOMy*t.body.axisy)}}else{var P=e.polygon;if(P.zip_gaxi&&null!=P.body){P.zip_gaxi=!1,P.validate_laxi();var f=P.body;if(f.zip_axis&&(f.zip_axis=!1,f.axisx=Math.sin(f.rot),f.axisy=Math.cos(f.rot)),P.zip_gverts&&null!=P.body){P.zip_gverts=!1,P.validate_lverts();var x=P.body;x.zip_axis&&(x.zip_axis=!1,x.axisx=Math.sin(x.rot),x.axisy=Math.cos(x.rot));for(var y=P.lverts.next,v=P.gverts.next;null!=v;){var g=v,b=y;y=y.next,g.x=P.body.posx+(P.body.axisy*b.x-P.body.axisx*b.y),g.y=P.body.posy+(b.x*P.body.axisx+b.y*P.body.axisy),v=v.next}}var z=P.edges.head,w=P.gverts.next,Z=w;for(w=w.next;null!=w;){var E=w,M=z.elt;z=z.next,M.gp0=Z,M.gp1=E,M.gnormx=P.body.axisy*M.lnormx-P.body.axisx*M.lnormy,M.gnormy=M.lnormx*P.body.axisx+M.lnormy*P.body.axisy,M.gprojection=P.body.posx*M.gnormx+P.body.posy*M.gnormy+M.lprojection,null!=M.wrap_gnorm&&(M.wrap_gnorm.zpp_inner.x=M.gnormx,M.wrap_gnorm.zpp_inner.y=M.gnormy),M.tp0=M.gp0.y*M.gnormx-M.gp0.x*M.gnormy,M.tp1=M.gp1.y*M.gnormx-M.gp1.x*M.gnormy,Z=E,w=w.next}var S=P.gverts.next,C=z.elt;z=z.next,C.gp0=Z,C.gp1=S,C.gnormx=P.body.axisy*C.lnormx-P.body.axisx*C.lnormy,C.gnormy=C.lnormx*P.body.axisx+C.lnormy*P.body.axisy,C.gprojection=P.body.posx*C.gnormx+P.body.posy*C.gnormy+C.lprojection,null!=C.wrap_gnorm&&(C.wrap_gnorm.zpp_inner.x=C.gnormx,C.wrap_gnorm.zpp_inner.y=C.gnormy),C.tp0=C.gp0.y*C.gnormx-C.gp0.x*C.gnormy,C.tp1=C.gp1.y*C.gnormx-C.gp1.x*C.gnormy}}},t.space.ZPP_Space.prototype.convexMultiCast=function(i,r,o,a,s){var l;if(null==t.geom.ZPP_ToiEvent.zpp_pool?l=new t.geom.ZPP_ToiEvent:(l=t.geom.ZPP_ToiEvent.zpp_pool,t.geom.ZPP_ToiEvent.zpp_pool=l.next,l.next=null),l.failed=!1,l.s1=l.s2=null,l.arbiter=null,0==i.type){var p=i.circle;if(p.zip_worldCOM&&null!=p.body){if(p.zip_worldCOM=!1,p.zip_localCOM){if(p.zip_localCOM=!1,1==p.type){var u=p.polygon;if(null==u.lverts.next)throw new n._Boot.HaxeError("Error: An empty polygon has no meaningful localCOM");if(null==u.lverts.next.next)u.localCOMx=u.lverts.next.x,u.localCOMy=u.lverts.next.y;else if(null==u.lverts.next.next.next)u.localCOMx=u.lverts.next.x,u.localCOMy=u.lverts.next.y,u.localCOMx+=1*u.lverts.next.next.x,u.localCOMy+=1*u.lverts.next.next.y,u.localCOMx*=.5,u.localCOMy*=.5;else{u.localCOMx=0,u.localCOMy=0;var h=0,c=u.lverts.next,_=c,d=c=c.next;for(c=c.next;null!=c;){var m=c;h+=d.x*(m.y-_.y);var P=m.y*d.x-m.x*d.y;u.localCOMx+=(d.x+m.x)*P,u.localCOMy+=(d.y+m.y)*P,_=d,d=m,c=c.next}var f=c=u.lverts.next;h+=d.x*(f.y-_.y);var x=f.y*d.x-f.x*d.y;u.localCOMx+=(d.x+f.x)*x,u.localCOMy+=(d.y+f.y)*x,_=d,d=f;var y=c=c.next;h+=d.x*(y.y-_.y);var v=y.y*d.x-y.x*d.y;u.localCOMx+=(d.x+y.x)*v,u.localCOMy+=(d.y+y.y)*v;var g=h=1/(3*h);u.localCOMx*=g,u.localCOMy*=g}}null!=p.wrap_localCOM&&(p.wrap_localCOM.zpp_inner.x=p.localCOMx,p.wrap_localCOM.zpp_inner.y=p.localCOMy)}var b=p.body;b.zip_axis&&(b.zip_axis=!1,b.axisx=Math.sin(b.rot),b.axisy=Math.cos(b.rot)),p.worldCOMx=p.body.posx+(p.body.axisy*p.localCOMx-p.body.axisx*p.localCOMy),p.worldCOMy=p.body.posy+(p.localCOMx*p.body.axisx+p.localCOMy*p.body.axisy)}}else{var z=i.polygon;if(z.zip_gaxi&&null!=z.body){z.zip_gaxi=!1,z.validate_laxi();var w=z.body;if(w.zip_axis&&(w.zip_axis=!1,w.axisx=Math.sin(w.rot),w.axisy=Math.cos(w.rot)),z.zip_gverts&&null!=z.body){z.zip_gverts=!1,z.validate_lverts();var Z=z.body;Z.zip_axis&&(Z.zip_axis=!1,Z.axisx=Math.sin(Z.rot),Z.axisy=Math.cos(Z.rot));for(var E=z.lverts.next,M=z.gverts.next;null!=M;){var S=M,C=E;E=E.next,S.x=z.body.posx+(z.body.axisy*C.x-z.body.axisx*C.y),S.y=z.body.posy+(C.x*z.body.axisx+C.y*z.body.axisy),M=M.next}}var N=z.edges.head,A=z.gverts.next,L=A;for(A=A.next;null!=A;){var B=A,T=N.elt;N=N.next,T.gp0=L,T.gp1=B,T.gnormx=z.body.axisy*T.lnormx-z.body.axisx*T.lnormy,T.gnormy=T.lnormx*z.body.axisx+T.lnormy*z.body.axisy,T.gprojection=z.body.posx*T.gnormx+z.body.posy*T.gnormy+T.lprojection,null!=T.wrap_gnorm&&(T.wrap_gnorm.zpp_inner.x=T.gnormx,T.wrap_gnorm.zpp_inner.y=T.gnormy),T.tp0=T.gp0.y*T.gnormx-T.gp0.x*T.gnormy,T.tp1=T.gp1.y*T.gnormx-T.gp1.x*T.gnormy,L=B,A=A.next}var V=z.gverts.next,k=N.elt;N=N.next,k.gp0=L,k.gp1=V,k.gnormx=z.body.axisy*k.lnormx-z.body.axisx*k.lnormy,k.gnormy=k.lnormx*z.body.axisx+k.lnormy*z.body.axisy,k.gprojection=z.body.posx*k.gnormx+z.body.posy*k.gnormy+k.lprojection,null!=k.wrap_gnorm&&(k.wrap_gnorm.zpp_inner.x=k.gnormx,k.wrap_gnorm.zpp_inner.y=k.gnormy),k.tp0=k.gp0.y*k.gnormx-k.gp0.x*k.gnormy,k.tp1=k.gp1.y*k.gnormx-k.gp1.x*k.gnormy}}var I=i.body,O=I.posx,R=I.posy;I.sweepTime=0,I.sweep_angvel=I.angvel;var H=r-I.sweepTime;if(0!=H){I.sweepTime=r;var F=H;if(I.posx+=I.velx*F,I.posy+=I.vely*F,0!=I.angvel){var D=I.sweep_angvel*H;if(I.rot+=D,D*D>1e-4)I.axisx=Math.sin(I.rot),I.axisy=Math.cos(I.rot);else{var G=D*D,U=1-.5*G,j=1-G*G/8,W=(U*I.axisx+D*I.axisy)*j;I.axisy=(U*I.axisy-D*I.axisx)*j,I.axisx=W}}}var q=I.posx,J=I.posy;i.validate_sweepRadius();var $,X=i.sweepRadius;null==t.geom.ZPP_AABB.zpp_pool?$=new t.geom.ZPP_AABB:($=t.geom.ZPP_AABB.zpp_pool,t.geom.ZPP_AABB.zpp_pool=$.next,$.next=null);var Y=O,K=q;$.minx=(Y<K?Y:K)-X;var Q=O,ee=q;$.maxx=(Q>ee?Q:ee)+X;var te=R,ne=J;$.miny=(te<ne?te:ne)-X;var ie=R,re=J;$.maxy=(ie>re?ie:re)+X;var oe=this.convexShapeList=this.bphase.shapesInAABB($,!1,!1,null==o?null:o.zpp_inner,this.convexShapeList),ae=$;null!=ae.outer&&(ae.outer.zpp_inner=null,ae.outer=null),ae.wrap_min=ae.wrap_max=null,ae._invalidate=null,ae._validate=null,ae.next=t.geom.ZPP_AABB.zpp_pool,t.geom.ZPP_AABB.zpp_pool=ae;var se=null==s?new e.geom.ConvexResultList:s;oe.zpp_inner.valmod();for(var le=e.shape.ShapeIterator.get(oe);;){le.zpp_inner.zpp_inner.valmod();var pe=le.zpp_inner;pe.zpp_inner.valmod(),pe.zpp_inner.zip_length&&(pe.zpp_inner.zip_length=!1,pe.zpp_inner.user_length=pe.zpp_inner.inner.length);var ue,he=pe.zpp_inner.user_length;if(le.zpp_critical=!0,le.zpp_i<he?ue=!0:(le.zpp_next=e.shape.ShapeIterator.zpp_pool,e.shape.ShapeIterator.zpp_pool=le,le.zpp_inner=null,ue=!1),!ue)break;le.zpp_critical=!1;var ce=le.zpp_inner.at(le.zpp_i++);if(ce!=i.outer&&(null!=ce.zpp_inner.body?ce.zpp_inner.body.outer:null)!=I.outer){if(l.s1=i,l.s2=ce.zpp_inner,a){ce.zpp_inner.validate_sweepRadius(),(null!=ce.zpp_inner.body?ce.zpp_inner.body.outer:null).zpp_inner.sweep_angvel=(null!=ce.zpp_inner.body?ce.zpp_inner.body.outer:null).zpp_inner.angvel,(null!=ce.zpp_inner.body?ce.zpp_inner.body.outer:null).zpp_inner.sweepTime=0,t.geom.ZPP_SweepDistance.dynamicSweep(l,r,0,0,!0);var _e=(null!=ce.zpp_inner.body?ce.zpp_inner.body.outer:null).zpp_inner,de=0-_e.sweepTime;if(0!=de){_e.sweepTime=0;var me=de;if(_e.posx+=_e.velx*me,_e.posy+=_e.vely*me,0!=_e.angvel){var Pe=_e.sweep_angvel*de;if(_e.rot+=Pe,Pe*Pe>1e-4)_e.axisx=Math.sin(_e.rot),_e.axisy=Math.cos(_e.rot);else{var fe=Pe*Pe,xe=1-.5*fe,ye=1-fe*fe/8,ve=(xe*_e.axisx+Pe*_e.axisy)*ye;_e.axisy=(xe*_e.axisy-Pe*_e.axisx)*ye,_e.axisx=ve}}}var ge=(null!=ce.zpp_inner.body?ce.zpp_inner.body.outer:null).zpp_inner,be=ce.zpp_inner;if(0==be.type)be.worldCOMx=ge.posx+(ge.axisy*be.localCOMx-ge.axisx*be.localCOMy),be.worldCOMy=ge.posy+(be.localCOMx*ge.axisx+be.localCOMy*ge.axisy);else{for(var ze=be.polygon,we=ze.lverts.next,Ze=ze.gverts.next;null!=Ze;){var Ee=Ze,Me=we;we=we.next,Ee.x=ge.posx+(ge.axisy*Me.x-ge.axisx*Me.y),Ee.y=ge.posy+(Me.x*ge.axisx+Me.y*ge.axisy),Ze=Ze.next}var Se=ze.edges.head,Ce=ze.gverts.next,Ne=Ce;for(Ce=Ce.next;null!=Ce;){var Ae=Ce,Le=Se.elt;Se=Se.next,Le.gnormx=ge.axisy*Le.lnormx-ge.axisx*Le.lnormy,Le.gnormy=Le.lnormx*ge.axisx+Le.lnormy*ge.axisy,Le.gprojection=ge.posx*Le.gnormx+ge.posy*Le.gnormy+Le.lprojection,Le.tp0=Ne.y*Le.gnormx-Ne.x*Le.gnormy,Le.tp1=Ae.y*Le.gnormx-Ae.x*Le.gnormy,Ne=Ae,Ce=Ce.next}var Be=ze.gverts.next,Te=Se.elt;Se=Se.next,Te.gnormx=ge.axisy*Te.lnormx-ge.axisx*Te.lnormy,Te.gnormy=Te.lnormx*ge.axisx+Te.lnormy*ge.axisy,Te.gprojection=ge.posx*Te.gnormx+ge.posy*Te.gnormy+Te.lprojection,Te.tp0=Ne.y*Te.gnormx-Ne.x*Te.gnormy,Te.tp1=Be.y*Te.gnormx-Be.x*Te.gnormy}}else t.geom.ZPP_SweepDistance.staticSweep(l,r,0,0);if(l.toi*=r,l.toi>0){var Ve,ke=-l.axis.x,Ie=-l.axis.y;if(null==Ie&&(Ie=0),null==ke&&(ke=0),ke!=ke||Ie!=Ie)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null==t.util.ZPP_PubPool.poolVec2?Ve=new e.geom.Vec2:(Ve=t.util.ZPP_PubPool.poolVec2,t.util.ZPP_PubPool.poolVec2=Ve.zpp_pool,Ve.zpp_pool=null,Ve.zpp_disp=!1,Ve==t.util.ZPP_PubPool.nextVec2&&(t.util.ZPP_PubPool.nextVec2=null)),null==Ve.zpp_inner){var Oe;null==t.geom.ZPP_Vec2.zpp_pool?Oe=new t.geom.ZPP_Vec2:(Oe=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=Oe.next,Oe.next=null),Oe.weak=!1,Oe._immutable=!1,Oe.x=ke,Oe.y=Ie,Ve.zpp_inner=Oe,Ve.zpp_inner.outer=Ve}else{if(null!=Ve&&Ve.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var Re,He=Ve.zpp_inner;if(He._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=He._isimmutable&&He._isimmutable(),ke!=ke||Ie!=Ie)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null!=Ve&&Ve.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var Fe=Ve.zpp_inner;if(null!=Fe._validate&&Fe._validate(),Ve.zpp_inner.x==ke){if(null!=Ve&&Ve.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var De=Ve.zpp_inner;null!=De._validate&&De._validate(),Re=Ve.zpp_inner.y==Ie}else Re=!1;if(!Re){Ve.zpp_inner.x=ke,Ve.zpp_inner.y=Ie;var Ge=Ve.zpp_inner;null!=Ge._invalidate&&Ge._invalidate(Ge)}}Ve.zpp_inner.weak=!1;var Ue,je=l.c2.x,We=l.c2.y;if(null==We&&(We=0),null==je&&(je=0),je!=je||We!=We)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null==t.util.ZPP_PubPool.poolVec2?Ue=new e.geom.Vec2:(Ue=t.util.ZPP_PubPool.poolVec2,t.util.ZPP_PubPool.poolVec2=Ue.zpp_pool,Ue.zpp_pool=null,Ue.zpp_disp=!1,Ue==t.util.ZPP_PubPool.nextVec2&&(t.util.ZPP_PubPool.nextVec2=null)),null==Ue.zpp_inner){var qe;null==t.geom.ZPP_Vec2.zpp_pool?qe=new t.geom.ZPP_Vec2:(qe=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=qe.next,qe.next=null),qe.weak=!1,qe._immutable=!1,qe.x=je,qe.y=We,Ue.zpp_inner=qe,Ue.zpp_inner.outer=Ue}else{if(null!=Ue&&Ue.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var Je,$e=Ue.zpp_inner;if($e._immutable)throw new n._Boot.HaxeError("Error: Vec2 is immutable");if(null!=$e._isimmutable&&$e._isimmutable(),je!=je||We!=We)throw new n._Boot.HaxeError("Error: Vec2 components cannot be NaN");if(null!=Ue&&Ue.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var Xe=Ue.zpp_inner;if(null!=Xe._validate&&Xe._validate(),Ue.zpp_inner.x==je){if(null!=Ue&&Ue.zpp_disp)throw new n._Boot.HaxeError("Error: Vec2 has been disposed and cannot be used!");var Ye=Ue.zpp_inner;null!=Ye._validate&&Ye._validate(),Je=Ue.zpp_inner.y==We}else Je=!1;if(!Je){Ue.zpp_inner.x=je,Ue.zpp_inner.y=We;var Ke=Ue.zpp_inner;null!=Ke._invalidate&&Ke._invalidate(Ke)}}Ue.zpp_inner.weak=!1;for(var Qe=t.geom.ZPP_ConvexRayResult.getConvex(Ve,Ue,l.toi,ce),et=null,tt=se.zpp_inner.inner.head;null!=tt;){var nt=tt.elt;if(null!=Qe.zpp_inner.next)throw new n._Boot.HaxeError("Error: This object has been disposed of and cannot be used");if(null!=nt.zpp_inner.next)throw new n._Boot.HaxeError("Error: This object has been disposed of and cannot be used");if(Qe.zpp_inner.toiDistance<nt.zpp_inner.toiDistance)break;et=tt,tt=tt.next}var it,rt=se.zpp_inner.inner;null==t.util.ZNPNode_ConvexResult.zpp_pool?it=new t.util.ZNPNode_ConvexResult:(it=t.util.ZNPNode_ConvexResult.zpp_pool,t.util.ZNPNode_ConvexResult.zpp_pool=it.next,it.next=null),it.elt=Qe;var ot=it;null==et?(ot.next=rt.head,rt.head=ot):(ot.next=et.next,et.next=ot),rt.pushmod=rt.modified=!0,rt.length++}}}oe.clear();var at=l;at.next=t.geom.ZPP_ToiEvent.zpp_pool,t.geom.ZPP_ToiEvent.zpp_pool=at;var st=0-I.sweepTime;if(0!=st){I.sweepTime=0;var lt=st;if(I.posx+=I.velx*lt,I.posy+=I.vely*lt,0!=I.angvel){var pt=I.sweep_angvel*st;if(I.rot+=pt,pt*pt>1e-4)I.axisx=Math.sin(I.rot),I.axisy=Math.cos(I.rot);else{var ut=pt*pt,ht=1-.5*ut,ct=1-ut*ut/8,_t=(ht*I.axisx+pt*I.axisy)*ct;I.axisy=(ht*I.axisy-pt*I.axisx)*ct,I.axisx=_t}}}if(0==i.type)i.worldCOMx=I.posx+(I.axisy*i.localCOMx-I.axisx*i.localCOMy),i.worldCOMy=I.posy+(i.localCOMx*I.axisx+i.localCOMy*I.axisy);else{for(var dt=i.polygon,mt=dt.lverts.next,Pt=dt.gverts.next;null!=Pt;){var ft=Pt,xt=mt;mt=mt.next,ft.x=I.posx+(I.axisy*xt.x-I.axisx*xt.y),ft.y=I.posy+(xt.x*I.axisx+xt.y*I.axisy),Pt=Pt.next}var yt=dt.edges.head,vt=dt.gverts.next,gt=vt;for(vt=vt.next;null!=vt;){var bt=vt,zt=yt.elt;yt=yt.next,zt.gnormx=I.axisy*zt.lnormx-I.axisx*zt.lnormy,zt.gnormy=zt.lnormx*I.axisx+zt.lnormy*I.axisy,zt.gprojection=I.posx*zt.gnormx+I.posy*zt.gnormy+zt.lprojection,zt.tp0=gt.y*zt.gnormx-gt.x*zt.gnormy,zt.tp1=bt.y*zt.gnormx-bt.x*zt.gnormy,gt=bt,vt=vt.next}var wt=dt.gverts.next,Zt=yt.elt;yt=yt.next,Zt.gnormx=I.axisy*Zt.lnormx-I.axisx*Zt.lnormy,Zt.gnormy=Zt.lnormx*I.axisx+Zt.lnormy*I.axisy,Zt.gprojection=I.posx*Zt.gnormx+I.posy*Zt.gnormy+Zt.lprojection,Zt.tp0=gt.y*Zt.gnormx-gt.x*Zt.gnormy,Zt.tp1=wt.y*Zt.gnormx-wt.x*Zt.gnormy}return se},t.space.ZPP_Space.prototype.push_callback=function(e){var n;return null==t.callbacks.ZPP_Callback.zpp_pool?n=new t.callbacks.ZPP_Callback:(n=t.callbacks.ZPP_Callback.zpp_pool,t.callbacks.ZPP_Callback.zpp_pool=n.next,n.next=null),this.callbacks.push(n),n.listener=e,n},t.space.ZPP_Space.prototype.pre_dt=null,t.space.ZPP_Space.prototype.step=function(e,i,r){if(this.midstep)throw new n._Boot.HaxeError("Error: ... REALLY?? you're going to call space.step() inside of space.step()? COME ON!!");if(this.time+=e,this.pre_dt=e,this.midstep=!0,this.stamp++,this.validation(),this.bphase.broadphase(this,!0),this.prestep(e),this.sortcontacts){var o=this.c_arbiters_false;if(null!=o.head&&null!=o.head.next){for(var a,s,l,p=o.head,u=null,h=null,c=null,_=null,d=1;;){for(a=0,h=p,u=p=null;null!=h;){for(++a,c=h,s=0,l=d;null!=c&&s<d;)++s,c=c.next;for(;s>0||l>0&&null!=c;)0==s?(_=c,c=c.next,--l):0==l||null==c||!h.elt.active||!c.elt.active||h.elt.oc1.dist<c.elt.oc1.dist?(_=h,h=h.next,--s):(_=c,c=c.next,--l),null!=u?u.next=_:p=_,u=_;h=c}if(u.next=null,d<<=1,!(a>1))break}o.head=p,o.modified=!0,o.pushmod=!0}}this.updateVel(e),this.warmStart(),this.iterateVel(i);for(var m=this.kinematics.head;null!=m;){var P=m.elt;P.pre_posx=P.posx,P.pre_posy=P.posy,P.pre_rot=P.rot,m=m.next}for(var f=this.live.head;null!=f;){var x=f.elt;x.pre_posx=x.posx,x.pre_posy=x.posy,x.pre_rot=x.rot,f=f.next}this.updatePos(e),this.continuous=!0,this.continuousCollisions(e),this.continuous=!1,this.iteratePos(r);for(var y=this.kinematics.head;null!=y;){var v=y.elt,g=!(v.posx==v.pre_posx&&v.posy==v.pre_posy),b=v.pre_rot!=v.rot;if(g){for(var z=v.shapes.head;null!=z;){var w=z.elt;1==w.type&&(w.polygon.invalidate_gverts(),w.polygon.invalidate_gaxi()),w.invalidate_worldCOM(),z=z.next}v.zip_worldCOM=!0}if(b){v.zip_axis=!0;for(var Z=v.shapes.head;null!=Z;){var E=Z.elt;1==E.type&&(E.polygon.invalidate_gverts(),E.polygon.invalidate_gaxi()),E.invalidate_worldCOM(),Z=Z.next}v.zip_worldCOM=!0}y=y.next}for(var M=this.live.head;null!=M;){var S=M.elt,C=!(S.posx==S.pre_posx&&S.posy==S.pre_posy),N=S.pre_rot!=S.rot;if(C){for(var A=S.shapes.head;null!=A;){var L=A.elt;1==L.type&&(L.polygon.invalidate_gverts(),L.polygon.invalidate_gaxi()),L.invalidate_worldCOM(),A=A.next}S.zip_worldCOM=!0}if(N){S.zip_axis=!0;for(var B=S.shapes.head;null!=B;){var T=B.elt;1==T.type&&(T.polygon.invalidate_gverts(),T.polygon.invalidate_gaxi()),T.invalidate_worldCOM(),B=B.next}S.zip_worldCOM=!0}M=M.next}for(var V=null,k=this.staticsleep.head;null!=k;){var I=k.elt;if(3!=I.type||0==I.velx&&0==I.vely&&0==I.angvel){if(I.kinematicDelaySleep){I.kinematicDelaySleep=!1,k=k.next;continue}I.component.sleeping=!0;var O,R,H=this.staticsleep;null==V?(R=(O=H.head).next,H.head=R,null==H.head&&(H.pushmod=!0)):(R=(O=V.next).next,V.next=R,null==R&&(H.pushmod=!0));var F=O;F.elt=null,F.next=t.util.ZNPNode_ZPP_Body.zpp_pool,t.util.ZNPNode_ZPP_Body.zpp_pool=F,H.modified=!0,H.length--,H.pushmod=!0,k=R}else V=k,k=k.next}this.doForests(e),this.sleepArbiters(),this.midstep=!1;for(var D=null,G=this.callbackset_list.next;null!=G;){var U=G;if(null!=U.arbiters.head){var j;j=!0;for(var W=U.arbiters.head;null!=W;){if(!W.elt.sleeping){j=!1;break}W=W.next}for(var q,J=j,$=U.int1.cbSet,X=U.int2.cbSet,Y=($.manager,null),K=($.cbpairs.length<X.cbpairs.length?$.cbpairs:X.cbpairs).head;null!=K;){var Q=K.elt;if(Q.a==$&&Q.b==X||Q.a==X&&Q.b==$){Y=Q;break}K=K.next}null==Y&&(null==t.callbacks.ZPP_CbSetPair.zpp_pool?q=new t.callbacks.ZPP_CbSetPair:(q=t.callbacks.ZPP_CbSetPair.zpp_pool,t.callbacks.ZPP_CbSetPair.zpp_pool=q.next,q.next=null),q.zip_listeners=!0,t.callbacks.ZPP_CbSet.setlt($,X)?(q.a=$,q.b=X):(q.a=X,q.b=$),Y=q,$.cbpairs.add(Y),X!=$&&X.cbpairs.add(Y)),Y.zip_listeners&&(Y.zip_listeners=!1,Y.__validate());for(var ee=Y.listeners.head;null!=ee;){var te=ee.elt;if(6==te.event&&(!J||te.allowSleepingCallbacks)&&!U.empty_arb(te.itype)){var ne=this.push_callback(te);ne.event=6;var ie,re=U.int1,oe=U.int2,ae=te.options1,se=re.cbTypes;if(ae.nonemptyintersection(se,ae.includes)&&!ae.nonemptyintersection(se,ae.excludes)){var le=te.options2,pe=oe.cbTypes;ie=le.nonemptyintersection(pe,le.includes)&&!le.nonemptyintersection(pe,le.excludes)}else ie=!1;ie?(ne.int1=re,ne.int2=oe):(ne.int1=oe,ne.int2=re),ne.set=U}ee=ee.next}D=G,G=G.next}else{var ue,he,ce=this.callbackset_list;null==D?(he=(ue=ce.next).next,ce.next=he,null==ce.next&&(ce.pushmod=!0)):(he=(ue=D.next).next,D.next=he,null==he&&(ce.pushmod=!0)),ue._inuse=!1,ce.modified=!0,ce.length--,ce.pushmod=!0,G=he;var _e=U;_e.int1=_e.int2=null,_e.id=_e.di=-1,_e.freed=!0,_e.next=t.space.ZPP_CallbackSet.zpp_pool,t.space.ZPP_CallbackSet.zpp_pool=_e}}for(;!this.callbacks.empty();){var de=this.callbacks.pop();0==de.listener.type?de.listener.body.handler(de.wrapper_body()):1==de.listener.type?de.listener.constraint.handler(de.wrapper_con()):2==de.listener.type&&de.listener.interaction.handleri(de.wrapper_int());var me=de;me.int1=me.int2=null,me.body=null,me.constraint=null,me.listener=null,null!=me.wrap_arbiters&&(me.wrap_arbiters.zpp_inner.inner=null),me.set=null,me.next=t.callbacks.ZPP_Callback.zpp_pool,t.callbacks.ZPP_Callback.zpp_pool=me}},t.space.ZPP_Space.prototype.toiEvents=null,t.space.ZPP_Space.prototype.continuousCollisions=function(n){var i=2*Math.PI/n;this.bphase.broadphase(this,!1);for(var r=0;r<1&&null!=this.toiEvents.head;){for(var o=null,a=2,s=!1,l=null,p=null,u=this.toiEvents.head;null!=u;){var h=u.elt,c=h.s1.body,_=h.s2.body;if(c.sweepFrozen&&_.sweepFrozen){if(0==h.toi||!t.geom.ZPP_Collide.testCollide_safe(h.s1,h.s2)){u=this.toiEvents.erase(p);var d=h;d.next=t.geom.ZPP_ToiEvent.zpp_pool,t.geom.ZPP_ToiEvent.zpp_pool=d;continue}h.toi=0}if(h.frozen1!=c.sweepFrozen||h.frozen2!=_.sweepFrozen){if(h.kinematic){u=this.toiEvents.erase(p);var m=h;m.next=t.geom.ZPP_ToiEvent.zpp_pool,t.geom.ZPP_ToiEvent.zpp_pool=m;continue}if(h.frozen1=c.sweepFrozen,h.frozen2=_.sweepFrozen,h.frozen1){var P=h.s1;h.s1=h.s2,h.s2=P,h.frozen1=!1,h.frozen2=!0}if(t.geom.ZPP_SweepDistance.staticSweep(h,n,0,e.Config.collisionSlopCCD),h.toi<0){u=this.toiEvents.erase(p);var f=h;f.next=t.geom.ZPP_ToiEvent.zpp_pool,t.geom.ZPP_ToiEvent.zpp_pool=f;continue}}h.toi>=0&&(h.toi<a||!s&&h.kinematic)&&(o=h,a=h.toi,s=h.kinematic,l=p),p=u,u=u.next}if(null==o)break;this.toiEvents.erase(l),r=o.toi;var x=o.s1.body,y=o.s2.body;if(!x.sweepFrozen){var v=r*n,g=v-x.sweepTime;if(0!=g){x.sweepTime=v;var b=g;if(x.posx+=x.velx*b,x.posy+=x.vely*b,0!=x.angvel){var z=x.sweep_angvel*g;if(x.rot+=z,z*z>1e-4)x.axisx=Math.sin(x.rot),x.axisy=Math.cos(x.rot);else{var w=z*z,Z=1-.5*w,E=1-w*w/8,M=(Z*x.axisx+z*x.axisy)*E;x.axisy=(Z*x.axisy-z*x.axisx)*E,x.axisx=M}}}var S=o.s1;if(0==S.type)S.worldCOMx=x.posx+(x.axisy*S.localCOMx-x.axisx*S.localCOMy),S.worldCOMy=x.posy+(S.localCOMx*x.axisx+S.localCOMy*x.axisy);else{for(var C=S.polygon,N=C.lverts.next,A=C.gverts.next;null!=A;){var L=A,B=N;N=N.next,L.x=x.posx+(x.axisy*B.x-x.axisx*B.y),L.y=x.posy+(B.x*x.axisx+B.y*x.axisy),A=A.next}var T=C.edges.head,V=C.gverts.next,k=V;for(V=V.next;null!=V;){var I=V,O=T.elt;T=T.next,O.gnormx=x.axisy*O.lnormx-x.axisx*O.lnormy,O.gnormy=O.lnormx*x.axisx+O.lnormy*x.axisy,O.gprojection=x.posx*O.gnormx+x.posy*O.gnormy+O.lprojection,O.tp0=k.y*O.gnormx-k.x*O.gnormy,O.tp1=I.y*O.gnormx-I.x*O.gnormy,k=I,V=V.next}var R=C.gverts.next,H=T.elt;T=T.next,H.gnormx=x.axisy*H.lnormx-x.axisx*H.lnormy,H.gnormy=H.lnormx*x.axisx+H.lnormy*x.axisy,H.gprojection=x.posx*H.gnormx+x.posy*H.gnormy+H.lprojection,H.tp0=k.y*H.gnormx-k.x*H.gnormy,H.tp1=R.y*H.gnormx-R.x*H.gnormy}}if(!y.sweepFrozen){var F=r*n,D=F-y.sweepTime;if(0!=D){y.sweepTime=F;var G=D;if(y.posx+=y.velx*G,y.posy+=y.vely*G,0!=y.angvel){var U=y.sweep_angvel*D;if(y.rot+=U,U*U>1e-4)y.axisx=Math.sin(y.rot),y.axisy=Math.cos(y.rot);else{var j=U*U,W=1-.5*j,q=1-j*j/8,J=(W*y.axisx+U*y.axisy)*q;y.axisy=(W*y.axisy-U*y.axisx)*q,y.axisx=J}}}var $=o.s2;if(0==$.type)$.worldCOMx=y.posx+(y.axisy*$.localCOMx-y.axisx*$.localCOMy),$.worldCOMy=y.posy+($.localCOMx*y.axisx+$.localCOMy*y.axisy);else{for(var X=$.polygon,Y=X.lverts.next,K=X.gverts.next;null!=K;){var Q=K,ee=Y;Y=Y.next,Q.x=y.posx+(y.axisy*ee.x-y.axisx*ee.y),Q.y=y.posy+(ee.x*y.axisx+ee.y*y.axisy),K=K.next}var te=X.edges.head,ne=X.gverts.next,ie=ne;for(ne=ne.next;null!=ne;){var re=ne,oe=te.elt;te=te.next,oe.gnormx=y.axisy*oe.lnormx-y.axisx*oe.lnormy,oe.gnormy=oe.lnormx*y.axisx+oe.lnormy*y.axisy,oe.gprojection=y.posx*oe.gnormx+y.posy*oe.gnormy+oe.lprojection,oe.tp0=ie.y*oe.gnormx-ie.x*oe.gnormy,oe.tp1=re.y*oe.gnormx-re.x*oe.gnormy,ie=re,ne=ne.next}var ae=X.gverts.next,se=te.elt;te=te.next,se.gnormx=y.axisy*se.lnormx-y.axisx*se.lnormy,se.gnormy=se.lnormx*y.axisx+se.lnormy*y.axisy,se.gprojection=y.posx*se.gnormx+y.posy*se.gnormy+se.lprojection,se.tp0=ie.y*se.gnormx-ie.x*se.gnormy,se.tp1=ae.y*se.gnormx-ae.x*se.gnormy}}o.arbiter;var le=this.narrowPhase(o.s1,o.s2,!0,o.arbiter,!0);if(null==le)null!=o.arbiter&&null!=o.arbiter.pair&&(o.arbiter.pair.arb=null,o.arbiter.pair=null);else if(!this.presteparb(le,n,!0)&&le.type==t.dynamics.ZPP_Arbiter.COL&&le.active&&0!=(1&le.immState)){var pe=le.colarb,ue=pe.nx*pe.c1.jnAcc-pe.ny*pe.c1.jtAcc,he=pe.ny*pe.c1.jnAcc+pe.nx*pe.c1.jtAcc,ce=pe.b1.imass;pe.b1.velx-=ue*ce,pe.b1.vely-=he*ce,pe.b1.angvel-=pe.b1.iinertia*(he*pe.c1.r1x-ue*pe.c1.r1y);var _e=pe.b2.imass;if(pe.b2.velx+=ue*_e,pe.b2.vely+=he*_e,pe.b2.angvel+=pe.b2.iinertia*(he*pe.c1.r2x-ue*pe.c1.r2y),pe.hc2){var de=pe.nx*pe.c2.jnAcc-pe.ny*pe.c2.jtAcc,me=pe.ny*pe.c2.jnAcc+pe.nx*pe.c2.jtAcc,Pe=pe.b1.imass;pe.b1.velx-=de*Pe,pe.b1.vely-=me*Pe,pe.b1.angvel-=pe.b1.iinertia*(me*pe.c2.r1x-de*pe.c2.r1y);var fe=pe.b2.imass;pe.b2.velx+=de*fe,pe.b2.vely+=me*fe,pe.b2.angvel+=pe.b2.iinertia*(me*pe.c2.r2x-de*pe.c2.r2y)}pe.b2.angvel+=pe.jrAcc*pe.b2.iinertia,pe.b1.angvel-=pe.jrAcc*pe.b1.iinertia;var xe=le.colarb,ye=xe.k1x+xe.b2.velx-xe.c1.r2y*xe.b2.angvel-(xe.b1.velx-xe.c1.r1y*xe.b1.angvel),ve=xe.k1y+xe.b2.vely+xe.c1.r2x*xe.b2.angvel-(xe.b1.vely+xe.c1.r1x*xe.b1.angvel),ge=(ve*xe.nx-ye*xe.ny+xe.surfacex)*xe.c1.tMass,be=xe.c1.friction*xe.c1.jnAcc,ze=xe.c1.jtAcc,we=ze-ge;we>be?we=be:we<-be&&(we=-be),ge=we-ze,xe.c1.jtAcc=we;var Ze=-xe.ny*ge,Ee=xe.nx*ge;if(xe.b2.velx+=Ze*xe.b2.imass,xe.b2.vely+=Ee*xe.b2.imass,xe.b1.velx-=Ze*xe.b1.imass,xe.b1.vely-=Ee*xe.b1.imass,xe.b2.angvel+=xe.rt1b*ge*xe.b2.iinertia,xe.b1.angvel-=xe.rt1a*ge*xe.b1.iinertia,xe.hc2){var Me=xe.k2x+xe.b2.velx-xe.c2.r2y*xe.b2.angvel-(xe.b1.velx-xe.c2.r1y*xe.b1.angvel),Se=xe.k2y+xe.b2.vely+xe.c2.r2x*xe.b2.angvel-(xe.b1.vely+xe.c2.r1x*xe.b1.angvel);ge=(Se*xe.nx-Me*xe.ny+xe.surfacex)*xe.c2.tMass,be=xe.c2.friction*xe.c2.jnAcc,(we=(ze=xe.c2.jtAcc)-ge)>be?we=be:we<-be&&(we=-be),ge=we-ze,xe.c2.jtAcc=we,Ze=-xe.ny*ge,Ee=xe.nx*ge,xe.b2.velx+=Ze*xe.b2.imass,xe.b2.vely+=Ee*xe.b2.imass,xe.b1.velx-=Ze*xe.b1.imass,xe.b1.vely-=Ee*xe.b1.imass,xe.b2.angvel+=xe.rt2b*ge*xe.b2.iinertia,xe.b1.angvel-=xe.rt2a*ge*xe.b1.iinertia,ye=xe.k1x+xe.b2.velx-xe.c1.r2y*xe.b2.angvel-(xe.b1.velx-xe.c1.r1y*xe.b1.angvel),ve=xe.k1y+xe.b2.vely+xe.c1.r2x*xe.b2.angvel-(xe.b1.vely+xe.c1.r1x*xe.b1.angvel),Me=xe.k2x+xe.b2.velx-xe.c2.r2y*xe.b2.angvel-(xe.b1.velx-xe.c2.r1y*xe.b1.angvel),Se=xe.k2y+xe.b2.vely+xe.c2.r2x*xe.b2.angvel-(xe.b1.vely+xe.c2.r1x*xe.b1.angvel);var Ce=xe.c1.jnAcc,Ne=xe.c2.jnAcc,Ae=ye*xe.nx+ve*xe.ny+xe.surfacey+xe.c1.bounce-(xe.Ka*Ce+xe.Kb*Ne),Le=Me*xe.nx+Se*xe.ny+xe.surfacey+xe.c2.bounce-(xe.Kb*Ce+xe.Kc*Ne),Be=-(xe.kMassa*Ae+xe.kMassb*Le),Te=-(xe.kMassb*Ae+xe.kMassc*Le);Be>=0&&Te>=0?(Ae=Be-Ce,Le=Te-Ne,xe.c1.jnAcc=Be,xe.c2.jnAcc=Te):(Be=-xe.c1.nMass*Ae)>=0&&xe.Kb*Be+Le>=0?(Ae=Be-Ce,Le=-Ne,xe.c1.jnAcc=Be,xe.c2.jnAcc=0):(Te=-xe.c2.nMass*Le)>=0&&xe.Kb*Te+Ae>=0?(Ae=-Ce,Le=Te-Ne,xe.c1.jnAcc=0,xe.c2.jnAcc=Te):Ae>=0&&Le>=0?(Ae=-Ce,Le=-Ne,xe.c1.jnAcc=xe.c2.jnAcc=0):(Ae=0,Le=0),ge=Ae+Le,Ze=xe.nx*ge,Ee=xe.ny*ge,xe.b2.velx+=Ze*xe.b2.imass,xe.b2.vely+=Ee*xe.b2.imass,xe.b1.velx-=Ze*xe.b1.imass,xe.b1.vely-=Ee*xe.b1.imass,xe.b2.angvel+=(xe.rn1b*Ae+xe.rn2b*Le)*xe.b2.iinertia,xe.b1.angvel-=(xe.rn1a*Ae+xe.rn2a*Le)*xe.b1.iinertia}else 0!=xe.radius&&(ge=(xe.b2.angvel-xe.b1.angvel)*xe.rMass,be=xe.rfric*xe.c1.jnAcc,ze=xe.jrAcc,xe.jrAcc-=ge,xe.jrAcc>be?xe.jrAcc=be:xe.jrAcc<-be&&(xe.jrAcc=-be),ge=xe.jrAcc-ze,xe.b2.angvel+=ge*xe.b2.iinertia,xe.b1.angvel-=ge*xe.b1.iinertia),ye=xe.k1x+xe.b2.velx-xe.c1.r2y*xe.b2.angvel-(xe.b1.velx-xe.c1.r1y*xe.b1.angvel),ve=xe.k1y+xe.b2.vely+xe.c1.r2x*xe.b2.angvel-(xe.b1.vely+xe.c1.r1x*xe.b1.angvel),ge=(xe.c1.bounce+(xe.nx*ye+xe.ny*ve)+xe.surfacey)*xe.c1.nMass,(we=(ze=xe.c1.jnAcc)-ge)<0&&(we=0),ge=we-ze,xe.c1.jnAcc=we,Ze=xe.nx*ge,Ee=xe.ny*ge,xe.b2.velx+=Ze*xe.b2.imass,xe.b2.vely+=Ee*xe.b2.imass,xe.b1.velx-=Ze*xe.b1.imass,xe.b1.vely-=Ee*xe.b1.imass,xe.b2.angvel+=xe.rn1b*ge*xe.b2.iinertia,xe.b1.angvel-=xe.rn1a*ge*xe.b1.iinertia;var Ve=le.colarb,ke=Ve.k1x+Ve.b2.velx-Ve.c1.r2y*Ve.b2.angvel-(Ve.b1.velx-Ve.c1.r1y*Ve.b1.angvel),Ie=Ve.k1y+Ve.b2.vely+Ve.c1.r2x*Ve.b2.angvel-(Ve.b1.vely+Ve.c1.r1x*Ve.b1.angvel),Oe=(Ie*Ve.nx-ke*Ve.ny+Ve.surfacex)*Ve.c1.tMass,Re=Ve.c1.friction*Ve.c1.jnAcc,He=Ve.c1.jtAcc,Fe=He-Oe;Fe>Re?Fe=Re:Fe<-Re&&(Fe=-Re),Oe=Fe-He,Ve.c1.jtAcc=Fe;var De=-Ve.ny*Oe,Ge=Ve.nx*Oe;if(Ve.b2.velx+=De*Ve.b2.imass,Ve.b2.vely+=Ge*Ve.b2.imass,Ve.b1.velx-=De*Ve.b1.imass,Ve.b1.vely-=Ge*Ve.b1.imass,Ve.b2.angvel+=Ve.rt1b*Oe*Ve.b2.iinertia,Ve.b1.angvel-=Ve.rt1a*Oe*Ve.b1.iinertia,Ve.hc2){var Ue=Ve.k2x+Ve.b2.velx-Ve.c2.r2y*Ve.b2.angvel-(Ve.b1.velx-Ve.c2.r1y*Ve.b1.angvel),je=Ve.k2y+Ve.b2.vely+Ve.c2.r2x*Ve.b2.angvel-(Ve.b1.vely+Ve.c2.r1x*Ve.b1.angvel);Oe=(je*Ve.nx-Ue*Ve.ny+Ve.surfacex)*Ve.c2.tMass,Re=Ve.c2.friction*Ve.c2.jnAcc,(Fe=(He=Ve.c2.jtAcc)-Oe)>Re?Fe=Re:Fe<-Re&&(Fe=-Re),Oe=Fe-He,Ve.c2.jtAcc=Fe,De=-Ve.ny*Oe,Ge=Ve.nx*Oe,Ve.b2.velx+=De*Ve.b2.imass,Ve.b2.vely+=Ge*Ve.b2.imass,Ve.b1.velx-=De*Ve.b1.imass,Ve.b1.vely-=Ge*Ve.b1.imass,Ve.b2.angvel+=Ve.rt2b*Oe*Ve.b2.iinertia,Ve.b1.angvel-=Ve.rt2a*Oe*Ve.b1.iinertia,ke=Ve.k1x+Ve.b2.velx-Ve.c1.r2y*Ve.b2.angvel-(Ve.b1.velx-Ve.c1.r1y*Ve.b1.angvel),Ie=Ve.k1y+Ve.b2.vely+Ve.c1.r2x*Ve.b2.angvel-(Ve.b1.vely+Ve.c1.r1x*Ve.b1.angvel),Ue=Ve.k2x+Ve.b2.velx-Ve.c2.r2y*Ve.b2.angvel-(Ve.b1.velx-Ve.c2.r1y*Ve.b1.angvel),je=Ve.k2y+Ve.b2.vely+Ve.c2.r2x*Ve.b2.angvel-(Ve.b1.vely+Ve.c2.r1x*Ve.b1.angvel);var We=Ve.c1.jnAcc,qe=Ve.c2.jnAcc,Je=ke*Ve.nx+Ie*Ve.ny+Ve.surfacey+Ve.c1.bounce-(Ve.Ka*We+Ve.Kb*qe),$e=Ue*Ve.nx+je*Ve.ny+Ve.surfacey+Ve.c2.bounce-(Ve.Kb*We+Ve.Kc*qe),Xe=-(Ve.kMassa*Je+Ve.kMassb*$e),Ye=-(Ve.kMassb*Je+Ve.kMassc*$e);Xe>=0&&Ye>=0?(Je=Xe-We,$e=Ye-qe,Ve.c1.jnAcc=Xe,Ve.c2.jnAcc=Ye):(Xe=-Ve.c1.nMass*Je)>=0&&Ve.Kb*Xe+$e>=0?(Je=Xe-We,$e=-qe,Ve.c1.jnAcc=Xe,Ve.c2.jnAcc=0):(Ye=-Ve.c2.nMass*$e)>=0&&Ve.Kb*Ye+Je>=0?(Je=-We,$e=Ye-qe,Ve.c1.jnAcc=0,Ve.c2.jnAcc=Ye):Je>=0&&$e>=0?(Je=-We,$e=-qe,Ve.c1.jnAcc=Ve.c2.jnAcc=0):(Je=0,$e=0),Oe=Je+$e,De=Ve.nx*Oe,Ge=Ve.ny*Oe,Ve.b2.velx+=De*Ve.b2.imass,Ve.b2.vely+=Ge*Ve.b2.imass,Ve.b1.velx-=De*Ve.b1.imass,Ve.b1.vely-=Ge*Ve.b1.imass,Ve.b2.angvel+=(Ve.rn1b*Je+Ve.rn2b*$e)*Ve.b2.iinertia,Ve.b1.angvel-=(Ve.rn1a*Je+Ve.rn2a*$e)*Ve.b1.iinertia}else 0!=Ve.radius&&(Oe=(Ve.b2.angvel-Ve.b1.angvel)*Ve.rMass,Re=Ve.rfric*Ve.c1.jnAcc,He=Ve.jrAcc,Ve.jrAcc-=Oe,Ve.jrAcc>Re?Ve.jrAcc=Re:Ve.jrAcc<-Re&&(Ve.jrAcc=-Re),Oe=Ve.jrAcc-He,Ve.b2.angvel+=Oe*Ve.b2.iinertia,Ve.b1.angvel-=Oe*Ve.b1.iinertia),ke=Ve.k1x+Ve.b2.velx-Ve.c1.r2y*Ve.b2.angvel-(Ve.b1.velx-Ve.c1.r1y*Ve.b1.angvel),Ie=Ve.k1y+Ve.b2.vely+Ve.c1.r2x*Ve.b2.angvel-(Ve.b1.vely+Ve.c1.r1x*Ve.b1.angvel),Oe=(Ve.c1.bounce+(Ve.nx*ke+Ve.ny*Ie)+Ve.surfacey)*Ve.c1.nMass,(Fe=(He=Ve.c1.jnAcc)-Oe)<0&&(Fe=0),Oe=Fe-He,Ve.c1.jnAcc=Fe,De=Ve.nx*Oe,Ge=Ve.ny*Oe,Ve.b2.velx+=De*Ve.b2.imass,Ve.b2.vely+=Ge*Ve.b2.imass,Ve.b1.velx-=De*Ve.b1.imass,Ve.b1.vely-=Ge*Ve.b1.imass,Ve.b2.angvel+=Ve.rn1b*Oe*Ve.b2.iinertia,Ve.b1.angvel-=Ve.rn1a*Oe*Ve.b1.iinertia;var Ke=le.colarb,Qe=Ke.k1x+Ke.b2.velx-Ke.c1.r2y*Ke.b2.angvel-(Ke.b1.velx-Ke.c1.r1y*Ke.b1.angvel),et=Ke.k1y+Ke.b2.vely+Ke.c1.r2x*Ke.b2.angvel-(Ke.b1.vely+Ke.c1.r1x*Ke.b1.angvel),tt=(et*Ke.nx-Qe*Ke.ny+Ke.surfacex)*Ke.c1.tMass,nt=Ke.c1.friction*Ke.c1.jnAcc,it=Ke.c1.jtAcc,rt=it-tt;rt>nt?rt=nt:rt<-nt&&(rt=-nt),tt=rt-it,Ke.c1.jtAcc=rt;var ot=-Ke.ny*tt,at=Ke.nx*tt;if(Ke.b2.velx+=ot*Ke.b2.imass,Ke.b2.vely+=at*Ke.b2.imass,Ke.b1.velx-=ot*Ke.b1.imass,Ke.b1.vely-=at*Ke.b1.imass,Ke.b2.angvel+=Ke.rt1b*tt*Ke.b2.iinertia,Ke.b1.angvel-=Ke.rt1a*tt*Ke.b1.iinertia,Ke.hc2){var st=Ke.k2x+Ke.b2.velx-Ke.c2.r2y*Ke.b2.angvel-(Ke.b1.velx-Ke.c2.r1y*Ke.b1.angvel),lt=Ke.k2y+Ke.b2.vely+Ke.c2.r2x*Ke.b2.angvel-(Ke.b1.vely+Ke.c2.r1x*Ke.b1.angvel);tt=(lt*Ke.nx-st*Ke.ny+Ke.surfacex)*Ke.c2.tMass,nt=Ke.c2.friction*Ke.c2.jnAcc,(rt=(it=Ke.c2.jtAcc)-tt)>nt?rt=nt:rt<-nt&&(rt=-nt),tt=rt-it,Ke.c2.jtAcc=rt,ot=-Ke.ny*tt,at=Ke.nx*tt,Ke.b2.velx+=ot*Ke.b2.imass,Ke.b2.vely+=at*Ke.b2.imass,Ke.b1.velx-=ot*Ke.b1.imass,Ke.b1.vely-=at*Ke.b1.imass,Ke.b2.angvel+=Ke.rt2b*tt*Ke.b2.iinertia,Ke.b1.angvel-=Ke.rt2a*tt*Ke.b1.iinertia,Qe=Ke.k1x+Ke.b2.velx-Ke.c1.r2y*Ke.b2.angvel-(Ke.b1.velx-Ke.c1.r1y*Ke.b1.angvel),et=Ke.k1y+Ke.b2.vely+Ke.c1.r2x*Ke.b2.angvel-(Ke.b1.vely+Ke.c1.r1x*Ke.b1.angvel),st=Ke.k2x+Ke.b2.velx-Ke.c2.r2y*Ke.b2.angvel-(Ke.b1.velx-Ke.c2.r1y*Ke.b1.angvel),lt=Ke.k2y+Ke.b2.vely+Ke.c2.r2x*Ke.b2.angvel-(Ke.b1.vely+Ke.c2.r1x*Ke.b1.angvel);var pt=Ke.c1.jnAcc,ut=Ke.c2.jnAcc,ht=Qe*Ke.nx+et*Ke.ny+Ke.surfacey+Ke.c1.bounce-(Ke.Ka*pt+Ke.Kb*ut),ct=st*Ke.nx+lt*Ke.ny+Ke.surfacey+Ke.c2.bounce-(Ke.Kb*pt+Ke.Kc*ut),_t=-(Ke.kMassa*ht+Ke.kMassb*ct),dt=-(Ke.kMassb*ht+Ke.kMassc*ct);_t>=0&&dt>=0?(ht=_t-pt,ct=dt-ut,Ke.c1.jnAcc=_t,Ke.c2.jnAcc=dt):(_t=-Ke.c1.nMass*ht)>=0&&Ke.Kb*_t+ct>=0?(ht=_t-pt,ct=-ut,Ke.c1.jnAcc=_t,Ke.c2.jnAcc=0):(dt=-Ke.c2.nMass*ct)>=0&&Ke.Kb*dt+ht>=0?(ht=-pt,ct=dt-ut,Ke.c1.jnAcc=0,Ke.c2.jnAcc=dt):ht>=0&&ct>=0?(ht=-pt,ct=-ut,Ke.c1.jnAcc=Ke.c2.jnAcc=0):(ht=0,ct=0),tt=ht+ct,ot=Ke.nx*tt,at=Ke.ny*tt,Ke.b2.velx+=ot*Ke.b2.imass,Ke.b2.vely+=at*Ke.b2.imass,Ke.b1.velx-=ot*Ke.b1.imass,Ke.b1.vely-=at*Ke.b1.imass,Ke.b2.angvel+=(Ke.rn1b*ht+Ke.rn2b*ct)*Ke.b2.iinertia,Ke.b1.angvel-=(Ke.rn1a*ht+Ke.rn2a*ct)*Ke.b1.iinertia}else 0!=Ke.radius&&(tt=(Ke.b2.angvel-Ke.b1.angvel)*Ke.rMass,nt=Ke.rfric*Ke.c1.jnAcc,it=Ke.jrAcc,Ke.jrAcc-=tt,Ke.jrAcc>nt?Ke.jrAcc=nt:Ke.jrAcc<-nt&&(Ke.jrAcc=-nt),tt=Ke.jrAcc-it,Ke.b2.angvel+=tt*Ke.b2.iinertia,Ke.b1.angvel-=tt*Ke.b1.iinertia),Qe=Ke.k1x+Ke.b2.velx-Ke.c1.r2y*Ke.b2.angvel-(Ke.b1.velx-Ke.c1.r1y*Ke.b1.angvel),et=Ke.k1y+Ke.b2.vely+Ke.c1.r2x*Ke.b2.angvel-(Ke.b1.vely+Ke.c1.r1x*Ke.b1.angvel),tt=(Ke.c1.bounce+(Ke.nx*Qe+Ke.ny*et)+Ke.surfacey)*Ke.c1.nMass,(rt=(it=Ke.c1.jnAcc)-tt)<0&&(rt=0),tt=rt-it,Ke.c1.jnAcc=rt,ot=Ke.nx*tt,at=Ke.ny*tt,Ke.b2.velx+=ot*Ke.b2.imass,Ke.b2.vely+=at*Ke.b2.imass,Ke.b1.velx-=ot*Ke.b1.imass,Ke.b1.vely-=at*Ke.b1.imass,Ke.b2.angvel+=Ke.rn1b*tt*Ke.b2.iinertia,Ke.b1.angvel-=Ke.rn1a*tt*Ke.b1.iinertia;var mt=le.colarb,Pt=mt.k1x+mt.b2.velx-mt.c1.r2y*mt.b2.angvel-(mt.b1.velx-mt.c1.r1y*mt.b1.angvel),ft=mt.k1y+mt.b2.vely+mt.c1.r2x*mt.b2.angvel-(mt.b1.vely+mt.c1.r1x*mt.b1.angvel),xt=(ft*mt.nx-Pt*mt.ny+mt.surfacex)*mt.c1.tMass,yt=mt.c1.friction*mt.c1.jnAcc,vt=mt.c1.jtAcc,gt=vt-xt;gt>yt?gt=yt:gt<-yt&&(gt=-yt),xt=gt-vt,mt.c1.jtAcc=gt;var bt=-mt.ny*xt,zt=mt.nx*xt;if(mt.b2.velx+=bt*mt.b2.imass,mt.b2.vely+=zt*mt.b2.imass,mt.b1.velx-=bt*mt.b1.imass,mt.b1.vely-=zt*mt.b1.imass,mt.b2.angvel+=mt.rt1b*xt*mt.b2.iinertia,mt.b1.angvel-=mt.rt1a*xt*mt.b1.iinertia,mt.hc2){var wt=mt.k2x+mt.b2.velx-mt.c2.r2y*mt.b2.angvel-(mt.b1.velx-mt.c2.r1y*mt.b1.angvel),Zt=mt.k2y+mt.b2.vely+mt.c2.r2x*mt.b2.angvel-(mt.b1.vely+mt.c2.r1x*mt.b1.angvel);xt=(Zt*mt.nx-wt*mt.ny+mt.surfacex)*mt.c2.tMass,yt=mt.c2.friction*mt.c2.jnAcc,(gt=(vt=mt.c2.jtAcc)-xt)>yt?gt=yt:gt<-yt&&(gt=-yt),xt=gt-vt,mt.c2.jtAcc=gt,bt=-mt.ny*xt,zt=mt.nx*xt,mt.b2.velx+=bt*mt.b2.imass,mt.b2.vely+=zt*mt.b2.imass,mt.b1.velx-=bt*mt.b1.imass,mt.b1.vely-=zt*mt.b1.imass,mt.b2.angvel+=mt.rt2b*xt*mt.b2.iinertia,mt.b1.angvel-=mt.rt2a*xt*mt.b1.iinertia,Pt=mt.k1x+mt.b2.velx-mt.c1.r2y*mt.b2.angvel-(mt.b1.velx-mt.c1.r1y*mt.b1.angvel),ft=mt.k1y+mt.b2.vely+mt.c1.r2x*mt.b2.angvel-(mt.b1.vely+mt.c1.r1x*mt.b1.angvel),wt=mt.k2x+mt.b2.velx-mt.c2.r2y*mt.b2.angvel-(mt.b1.velx-mt.c2.r1y*mt.b1.angvel),Zt=mt.k2y+mt.b2.vely+mt.c2.r2x*mt.b2.angvel-(mt.b1.vely+mt.c2.r1x*mt.b1.angvel);var Et=mt.c1.jnAcc,Mt=mt.c2.jnAcc,St=Pt*mt.nx+ft*mt.ny+mt.surfacey+mt.c1.bounce-(mt.Ka*Et+mt.Kb*Mt),Ct=wt*mt.nx+Zt*mt.ny+mt.surfacey+mt.c2.bounce-(mt.Kb*Et+mt.Kc*Mt),Nt=-(mt.kMassa*St+mt.kMassb*Ct),At=-(mt.kMassb*St+mt.kMassc*Ct);Nt>=0&&At>=0?(St=Nt-Et,Ct=At-Mt,mt.c1.jnAcc=Nt,mt.c2.jnAcc=At):(Nt=-mt.c1.nMass*St)>=0&&mt.Kb*Nt+Ct>=0?(St=Nt-Et,Ct=-Mt,mt.c1.jnAcc=Nt,mt.c2.jnAcc=0):(At=-mt.c2.nMass*Ct)>=0&&mt.Kb*At+St>=0?(St=-Et,Ct=At-Mt,mt.c1.jnAcc=0,mt.c2.jnAcc=At):St>=0&&Ct>=0?(St=-Et,Ct=-Mt,mt.c1.jnAcc=mt.c2.jnAcc=0):(St=0,Ct=0),xt=St+Ct,bt=mt.nx*xt,zt=mt.ny*xt,mt.b2.velx+=bt*mt.b2.imass,mt.b2.vely+=zt*mt.b2.imass,mt.b1.velx-=bt*mt.b1.imass,mt.b1.vely-=zt*mt.b1.imass,mt.b2.angvel+=(mt.rn1b*St+mt.rn2b*Ct)*mt.b2.iinertia,mt.b1.angvel-=(mt.rn1a*St+mt.rn2a*Ct)*mt.b1.iinertia}else 0!=mt.radius&&(xt=(mt.b2.angvel-mt.b1.angvel)*mt.rMass,yt=mt.rfric*mt.c1.jnAcc,vt=mt.jrAcc,mt.jrAcc-=xt,mt.jrAcc>yt?mt.jrAcc=yt:mt.jrAcc<-yt&&(mt.jrAcc=-yt),xt=mt.jrAcc-vt,mt.b2.angvel+=xt*mt.b2.iinertia,mt.b1.angvel-=xt*mt.b1.iinertia),Pt=mt.k1x+mt.b2.velx-mt.c1.r2y*mt.b2.angvel-(mt.b1.velx-mt.c1.r1y*mt.b1.angvel),ft=mt.k1y+mt.b2.vely+mt.c1.r2x*mt.b2.angvel-(mt.b1.vely+mt.c1.r1x*mt.b1.angvel),xt=(mt.c1.bounce+(mt.nx*Pt+mt.ny*ft)+mt.surfacey)*mt.c1.nMass,(gt=(vt=mt.c1.jnAcc)-xt)<0&&(gt=0),xt=gt-vt,mt.c1.jnAcc=gt,bt=mt.nx*xt,zt=mt.ny*xt,mt.b2.velx+=bt*mt.b2.imass,mt.b2.vely+=zt*mt.b2.imass,mt.b1.velx-=bt*mt.b1.imass,mt.b1.vely-=zt*mt.b1.imass,mt.b2.angvel+=mt.rn1b*xt*mt.b2.iinertia,mt.b1.angvel-=mt.rn1a*xt*mt.b1.iinertia;x.sweep_angvel=x.angvel%i,y.sweep_angvel=y.angvel%i}if(null!=le&&le.active&&0!=(1&le.immState)&&le.type==t.dynamics.ZPP_Arbiter.COL){if(!x.sweepFrozen&&3!=x.type)if(x.sweepFrozen=!0,o.failed)x.angvel=x.sweep_angvel=0;else if(o.slipped){var Lt=x;Lt.sweep_angvel*=e.Config.angularCCDSlipScale,x.angvel=Lt.sweep_angvel}else x.angvel=x.sweep_angvel;if(!y.sweepFrozen&&3!=y.type)if(y.sweepFrozen=!0,o.failed)y.angvel=y.sweep_angvel=0;else if(o.slipped){var Bt=y;Bt.sweep_angvel*=e.Config.angularCCDSlipScale,y.angvel=Bt.sweep_angvel}else y.angvel=y.sweep_angvel}var Tt=o;Tt.next=t.geom.ZPP_ToiEvent.zpp_pool,t.geom.ZPP_ToiEvent.zpp_pool=Tt}for(;null!=this.toiEvents.head;){var Vt=this.toiEvents.pop_unsafe();Vt.next=t.geom.ZPP_ToiEvent.zpp_pool,t.geom.ZPP_ToiEvent.zpp_pool=Vt}for(var kt=this.kinematics.head;null!=kt;){var It=kt.elt,Ot=n-It.sweepTime;if(0!=Ot){It.sweepTime=n;var Rt=Ot;if(It.posx+=It.velx*Rt,It.posy+=It.vely*Rt,0!=It.angvel){var Ht=It.sweep_angvel*Ot;if(It.rot+=Ht,Ht*Ht>1e-4)It.axisx=Math.sin(It.rot),It.axisy=Math.cos(It.rot);else{var Ft=Ht*Ht,Dt=1-.5*Ft,Gt=1-Ft*Ft/8,Ut=(Dt*It.axisx+Ht*It.axisy)*Gt;It.axisy=(Dt*It.axisy-Ht*It.axisx)*Gt,It.axisx=Ut}}}It.sweepTime=0,kt=kt.next}for(var jt=this.live.head;null!=jt;){var Wt=jt.elt;if(!Wt.sweepFrozen){var qt=n-Wt.sweepTime;if(0!=qt){Wt.sweepTime=n;var Jt=qt;if(Wt.posx+=Wt.velx*Jt,Wt.posy+=Wt.vely*Jt,0!=Wt.angvel){var $t=Wt.sweep_angvel*qt;if(Wt.rot+=$t,$t*$t>1e-4)Wt.axisx=Math.sin(Wt.rot),Wt.axisy=Math.cos(Wt.rot);else{var Xt=$t*$t,Yt=1-.5*Xt,Kt=1-Xt*Xt/8,Qt=(Yt*Wt.axisx+$t*Wt.axisy)*Kt;Wt.axisy=(Yt*Wt.axisy-$t*Wt.axisx)*Kt,Wt.axisx=Qt}}}}Wt.sweepTime=0,jt=jt.next}},t.space.ZPP_Space.prototype.continuousEvent=function(n,i,r,o,a){if(n.body.sweepFrozen&&i.body.sweepFrozen)return o;if(n.body.disableCCD||i.body.disableCCD)return o;var s;if(null==o||null!=o.colarb){var l,p=n.body,u=i.body;l=!1;for(var h,c,_=p.constraints.head;null!=_;){var d=_.elt;if(d.ignore&&d.pair_exists(p.id,u.id)){l=!0;break}_=_.next}if(l)c=!1;else{for(var m=n;null!=m&&null==m.group;)m=null!=m.ishape?m.ishape.body:null!=m.icompound?m.icompound.compound:m.ibody.compound;var P,f=null==m?null:m.group;if(null==f)P=!1;else{for(var x=i;null!=x&&null==x.group;)x=null!=x.ishape?x.ishape.body:null!=x.icompound?x.icompound.compound:x.ibody.compound;var y=null==x?null:x.group;if(null==y)P=!1;else{for(var v=!1;null!=f&&null!=y;){if(f==y){v=f.ignore;break}f.depth<y.depth?y=y.group:f=f.group}P=v}}c=!P}if(c){var g;if(n.sensorEnabled||i.sensorEnabled){var b=n.filter,z=i.filter;g=0!=(b.sensorMask&z.sensorGroup)&&0!=(z.sensorMask&b.sensorGroup)}else g=!1;if(g)h=2;else{var w;if(n.fluidEnabled||i.fluidEnabled){var Z=n.filter,E=i.filter;w=0!=(Z.fluidMask&E.fluidGroup)&&0!=(E.fluidMask&Z.fluidGroup)}else w=!1;if(!w||0==p.imass&&0==u.imass&&0==p.iinertia&&0==u.iinertia){var M=n.filter,S=i.filter;h=0==(M.collisionMask&S.collisionGroup)||0==(S.collisionMask&M.collisionGroup)||0==p.imass&&0==u.imass&&0==p.iinertia&&0==u.iinertia?-1:1}else h=0}}else h=-1;s=h<=0}else s=!0;if(s)return o;var C=n.body,N=i.body;if(r||C.bullet||N.bullet){var A;null==t.geom.ZPP_ToiEvent.zpp_pool?A=new t.geom.ZPP_ToiEvent:(A=t.geom.ZPP_ToiEvent.zpp_pool,t.geom.ZPP_ToiEvent.zpp_pool=A.next,A.next=null),A.failed=!1,A.s1=A.s2=null,A.arbiter=null;var L=3==C.type||3==N.type;if(r&&!L)2!=n.body.type?(A.s2=n,A.s1=i):(A.s1=n,A.s2=i),A.kinematic=!1,t.geom.ZPP_SweepDistance.staticSweep(A,this.pre_dt,0,e.Config.collisionSlopCCD);else if(A.s1=n,A.s2=i,A.kinematic=L,A.s1.body.sweepFrozen||A.s2.body.sweepFrozen){if(A.s1.body.sweepFrozen){var B=A.s1;A.s1=A.s2,A.s2=B,A.frozen1=!1,A.frozen2=!0}t.geom.ZPP_SweepDistance.staticSweep(A,this.pre_dt,0,e.Config.collisionSlopCCD)}else t.geom.ZPP_SweepDistance.dynamicSweep(A,this.pre_dt,0,e.Config.collisionSlopCCD);if(r&&A.toi<0||A.failed){var T=A;T.next=t.geom.ZPP_ToiEvent.zpp_pool,t.geom.ZPP_ToiEvent.zpp_pool=T}else this.toiEvents.add(A),A.frozen1=A.s1.body.sweepFrozen,A.frozen2=A.s2.body.sweepFrozen,A.arbiter=null!=o?o.colarb:null}return o},t.space.ZPP_Space.prototype.bodyCbWake=function(e){if(2==e.type&&null!=e.cbSet)if(this.midstep)for(var t=e.cbSet.bodylisteners.head;null!=t;){var n=t.elt;if(2==n.event){var i=this.push_callback(n);i.event=2,i.body=e,t=t.next}else t=t.next}else e.component.woken=!0},t.space.ZPP_Space.prototype.bodyCbSleep=function(e){if(2==e.type&&null!=e.cbSet)for(var t=e.cbSet.bodylisteners.head;null!=t;){var n=t.elt;if(3==n.event){var i=this.push_callback(n);i.event=3,i.body=e,t=t.next}else t=t.next}},t.space.ZPP_Space.prototype.constraintCbWake=function(e){if(null!=e.cbSet)if(this.midstep)for(var t=e.cbSet.conlisteners.head;null!=t;){var n=t.elt;if(2==n.event){var i=this.push_callback(n);i.event=2,i.constraint=e,t=t.next}else t=t.next}else e.component.woken=!0},t.space.ZPP_Space.prototype.constraintCbSleep=function(e){if(null!=e.cbSet)for(var t=e.cbSet.conlisteners.head;null!=t;){var n=t.elt;if(3==n.event){var i=this.push_callback(n);i.event=3,i.constraint=e,t=t.next}else t=t.next}},t.space.ZPP_Space.prototype.constraintCbBreak=function(e){if(null!=e.cbSet)for(var t=e.cbSet.conlisteners.head;null!=t;){var n=t.elt;if(4==n.event){var i=this.push_callback(n);i.event=4,i.constraint=e,t=t.next}else t=t.next}},t.space.ZPP_Space.prototype.nullListenerType=function(e,n){for(var i=new t.util.ZNPList_ZPP_Interactor,r=e.interactors.head;null!=r;){var o=r.elt;i.add(o),r=r.next}if(e!=n)for(var a=n.interactors.head;null!=a;){var s=a.elt;i.add(s),a=a.next}for(;null!=i.head;){var l=i.pop_unsafe();if(null!=l.icompound){for(var p=l.icompound,u=p.bodies.head;null!=u;){var h=u.elt;i.add(h),u=u.next}for(var c=p.compounds.head;null!=c;){var _=c.elt;i.add(_),c=c.next}}else for(var d=null!=l.ibody?l.ibody:l.ishape.body,m=null!=l.ishape?l.ishape:null,P=d.arbiters.head;null!=P;){var f=P.elt;if(0!=f.present)if(null==m||f.ws1==m||f.ws2==m){this.MRCA_chains(f.ws1,f.ws2);for(var x=this.mrca1.head;null!=x;){var y=x.elt;if(y.cbSet==e||y.cbSet==n){for(var v=this.mrca2.head;null!=v;){var g=v.elt;if(y.cbSet==e&&g.cbSet!=n||y.cbSet==n&&g.cbSet!=e)v=v.next;else{var b=t.phys.ZPP_Interactor.get(y,g);if(null!=b){for(;null!=b.arbiters.head;)b.arbiters.pop_unsafe().present--;this.remove_callbackset(b)}v=v.next}}x=x.next}else x=x.next}P=P.next}else P=P.next;else P=P.next}}},t.space.ZPP_Space.prototype.nullInteractorType=function(e,n){if(null==n&&(n=e),null!=e.icompound){for(var i=e.icompound,r=i.bodies.head;null!=r;){var o=r.elt;this.nullInteractorType(o,n),r=r.next}for(var a=i.compounds.head;null!=a;){var s=a.elt;this.nullInteractorType(s,n),a=a.next}}else for(var l=null!=e.ibody?e.ibody:e.ishape.body,p=null!=e.ishape?e.ishape:null,u=l.arbiters.head;null!=u;){var h=u.elt;if(0!=h.present)if(null==p||h.ws1==p||h.ws2==p){this.MRCA_chains(h.ws1,h.ws2);for(var c=this.mrca1.head;null!=c;){for(var _=c.elt,d=this.mrca2.head;null!=d;){var m=d.elt;if(_==n||m==n){var P=t.phys.ZPP_Interactor.get(_,m);null!=P&&(h.present--,P.remove_arb(h),null==P.arbiters.head&&this.remove_callbackset(P)),d=d.next}else d=d.next}c=c.next}u=u.next}else u=u.next;else u=u.next}},t.space.ZPP_Space.prototype.freshListenerType=function(e,n){for(var i=new t.util.ZNPList_ZPP_Interactor,r=e.interactors.head;null!=r;){var o=r.elt;i.add(o),r=r.next}if(e!=n)for(var a=n.interactors.head;null!=a;){var s=a.elt;i.add(s),a=a.next}for(;null!=i.head;){var l=i.pop_unsafe();if(null!=l.icompound){for(var p=l.icompound,u=p.bodies.head;null!=u;){var h=u.elt;i.add(h),u=u.next}for(var c=p.compounds.head;null!=c;){var _=c.elt;i.add(_),c=c.next}}else for(var d=null!=l.ibody?l.ibody:l.ishape.body,m=null!=l.ishape?l.ishape:null,P=d.arbiters.head;null!=P;){var f=P.elt;if(f.presentable)if(null==m||f.ws1==m||f.ws2==m){this.MRCA_chains(f.ws1,f.ws2);for(var x=this.mrca1.head;null!=x;){var y=x.elt;if(y.cbSet==e||y.cbSet==n){for(var v=this.mrca2.head;null!=v;){var g=v.elt;if(y.cbSet==e&&g.cbSet!=n||y.cbSet==n&&g.cbSet!=e)v=v.next;else{var b,z,w=t.phys.ZPP_Interactor.get(y,g);null==w&&(w=t.space.ZPP_CallbackSet.get(y,g),this.add_callbackset(w)),z=!1;for(var Z=w.arbiters.head;null!=Z;){if(Z.elt==f){z=!0;break}Z=Z.next}if(z)b=!1;else{var E,M=w.arbiters;null==t.util.ZNPNode_ZPP_Arbiter.zpp_pool?E=new t.util.ZNPNode_ZPP_Arbiter:(E=t.util.ZNPNode_ZPP_Arbiter.zpp_pool,t.util.ZNPNode_ZPP_Arbiter.zpp_pool=E.next,E.next=null),E.elt=f;var S=E;S.next=M.head,M.head=S,M.modified=!0,M.length++,b=!0}b&&f.present++,v=v.next}}x=x.next}else x=x.next}P=P.next}else P=P.next;else P=P.next}}},t.space.ZPP_Space.prototype.freshInteractorType=function(e,n){if(null==n&&(n=e),null!=e.icompound){for(var i=e.icompound,r=i.bodies.head;null!=r;){var o=r.elt;this.freshInteractorType(o,n),r=r.next}for(var a=i.compounds.head;null!=a;){var s=a.elt;this.freshInteractorType(s,n),a=a.next}}else for(var l=null!=e.ibody?e.ibody:e.ishape.body,p=null!=e.ishape?e.ishape:null,u=l.arbiters.head;null!=u;){var h=u.elt;if(h.presentable)if(null==p||h.ws1==p||h.ws2==p){this.MRCA_chains(h.ws1,h.ws2);for(var c=this.mrca1.head;null!=c;){for(var _=c.elt,d=this.mrca2.head;null!=d;){var m=d.elt;if(_==n||m==n){var P=_.cbSet,f=m.cbSet;P.validate(),f.validate(),P.manager;for(var x,y=null,v=(P.cbpairs.length<f.cbpairs.length?P.cbpairs:f.cbpairs).head;null!=v;){var g=v.elt;if(g.a==P&&g.b==f||g.a==f&&g.b==P){y=g;break}v=v.next}if(null==y&&(null==t.callbacks.ZPP_CbSetPair.zpp_pool?x=new t.callbacks.ZPP_CbSetPair:(x=t.callbacks.ZPP_CbSetPair.zpp_pool,t.callbacks.ZPP_CbSetPair.zpp_pool=x.next,x.next=null),x.zip_listeners=!0,t.callbacks.ZPP_CbSet.setlt(P,f)?(x.a=P,x.b=f):(x.a=f,x.b=P),y=x,P.cbpairs.add(y),f!=P&&f.cbpairs.add(y)),y.zip_listeners&&(y.zip_listeners=!1,y.__validate()),null!=y.listeners.head){var b,z,w=t.phys.ZPP_Interactor.get(_,m);null==w&&(w=t.space.ZPP_CallbackSet.get(_,m),this.add_callbackset(w)),z=!1;for(var Z=w.arbiters.head;null!=Z;){if(Z.elt==h){z=!0;break}Z=Z.next}if(z)b=!1;else{var E,M=w.arbiters;null==t.util.ZNPNode_ZPP_Arbiter.zpp_pool?E=new t.util.ZNPNode_ZPP_Arbiter:(E=t.util.ZNPNode_ZPP_Arbiter.zpp_pool,t.util.ZNPNode_ZPP_Arbiter.zpp_pool=E.next,E.next=null),E.elt=h;var S=E;S.next=M.head,M.head=S,M.modified=!0,M.length++,b=!0}b&&h.present++}d=d.next}else d=d.next}c=c.next}u=u.next}else u=u.next;else u=u.next}},t.space.ZPP_Space.prototype.wakeCompound=function(e){for(var t=e.bodies.head;null!=t;){var n=t.elt;n.world||(n.component.waket=this.stamp+(this.midstep?0:1),3==n.type&&(n.kinematicDelaySleep=!0),n.component.sleeping&&this.really_wake(n,!1)),t=t.next}for(var i=e.constraints.head;null!=i;){var r=i.elt;this.wake_constraint(r),i=i.next}for(var o=e.compounds.head;null!=o;){var a=o.elt;this.wakeCompound(a),o=o.next}},t.space.ZPP_Space.prototype.wakeIsland=function(e){for(;null!=e.comps.head;){var n=e.comps.pop_unsafe();if(n.waket=this.stamp+(this.midstep?0:1),n.isBody){var i=n.body;this.live.add(i);for(var r=i.arbiters.head;null!=r;){var o=r.elt;if(o.sleeping)if(o.sleeping=!1,o.up_stamp+=this.stamp-o.sleep_stamp,o.type==t.dynamics.ZPP_Arbiter.COL){var a=o.colarb;if(a.stat){var s,l=this.c_arbiters_true;null==t.util.ZNPNode_ZPP_ColArbiter.zpp_pool?s=new t.util.ZNPNode_ZPP_ColArbiter:(s=t.util.ZNPNode_ZPP_ColArbiter.zpp_pool,t.util.ZNPNode_ZPP_ColArbiter.zpp_pool=s.next,s.next=null),s.elt=a;var p=s;p.next=l.head,l.head=p,l.modified=!0,l.length++}else{var u,h=this.c_arbiters_false;null==t.util.ZNPNode_ZPP_ColArbiter.zpp_pool?u=new t.util.ZNPNode_ZPP_ColArbiter:(u=t.util.ZNPNode_ZPP_ColArbiter.zpp_pool,t.util.ZNPNode_ZPP_ColArbiter.zpp_pool=u.next,u.next=null),u.elt=a;var c=u;c.next=h.head,h.head=c,h.modified=!0,h.length++}}else if(o.type==t.dynamics.ZPP_Arbiter.FLUID){var _,d=this.f_arbiters,m=o.fluidarb;null==t.util.ZNPNode_ZPP_FluidArbiter.zpp_pool?_=new t.util.ZNPNode_ZPP_FluidArbiter:(_=t.util.ZNPNode_ZPP_FluidArbiter.zpp_pool,t.util.ZNPNode_ZPP_FluidArbiter.zpp_pool=_.next,_.next=null),_.elt=m;var P=_;P.next=d.head,d.head=P,d.modified=!0,d.length++}else{var f,x=this.s_arbiters,y=o.sensorarb;null==t.util.ZNPNode_ZPP_SensorArbiter.zpp_pool?f=new t.util.ZNPNode_ZPP_SensorArbiter:(f=t.util.ZNPNode_ZPP_SensorArbiter.zpp_pool,t.util.ZNPNode_ZPP_SensorArbiter.zpp_pool=f.next,f.next=null),f.elt=y;var v=f;v.next=x.head,x.head=v,x.modified=!0,x.length++}r=r.next}if(this.bodyCbWake(i),n.sleeping=!1,n.island=null,n.parent=n,n.rank=0,1!=i.type)for(var g=i.shapes.head;null!=g;){var b=g.elt;null!=b.node&&this.bphase.sync(b),g=g.next}}else{var z,w=n.constraint,Z=this.live_constraints;null==t.util.ZNPNode_ZPP_Constraint.zpp_pool?z=new t.util.ZNPNode_ZPP_Constraint:(z=t.util.ZNPNode_ZPP_Constraint.zpp_pool,t.util.ZNPNode_ZPP_Constraint.zpp_pool=z.next,z.next=null),z.elt=w;var E=z;E.next=Z.head,Z.head=E,Z.modified=!0,Z.length++,this.constraintCbWake(w),n.sleeping=!1,n.island=null,n.parent=n,n.rank=0}}var M=e;M.next=t.space.ZPP_Island.zpp_pool,t.space.ZPP_Island.zpp_pool=M},t.space.ZPP_Space.prototype.non_inlined_wake=function(e,t){null==t&&(t=!1);var n=e;n.world||(n.component.waket=this.stamp+(this.midstep?0:1),3==n.type&&(n.kinematicDelaySleep=!0),n.component.sleeping&&this.really_wake(n,t))},t.space.ZPP_Space.prototype.really_wake=function(e,n){if(null==n&&(n=!1),null==e.component.island){if(e.component.sleeping=!1,3==e.type||1==e.type){var i,r=this.staticsleep;null==t.util.ZNPNode_ZPP_Body.zpp_pool?i=new t.util.ZNPNode_ZPP_Body:(i=t.util.ZNPNode_ZPP_Body.zpp_pool,t.util.ZNPNode_ZPP_Body.zpp_pool=i.next,i.next=null),i.elt=e;var o=i;o.next=r.head,r.head=o,r.modified=!0,r.length++}else{var a,s=this.live;null==t.util.ZNPNode_ZPP_Body.zpp_pool?a=new t.util.ZNPNode_ZPP_Body:(a=t.util.ZNPNode_ZPP_Body.zpp_pool,t.util.ZNPNode_ZPP_Body.zpp_pool=a.next,a.next=null),a.elt=e;var l=a;l.next=s.head,s.head=l,s.modified=!0,s.length++}for(var p=e.constraints.head;null!=p;){var u=p.elt;u.space==this&&this.wake_constraint(u),p=p.next}for(var h=e.arbiters.head;null!=h;){var c=h.elt;if(c.sleeping)if(c.sleeping=!1,c.up_stamp+=this.stamp+(this.midstep?0:1)-c.sleep_stamp,c.type==t.dynamics.ZPP_Arbiter.COL){var _=c.colarb;if(_.stat){var d,m=this.c_arbiters_true;null==t.util.ZNPNode_ZPP_ColArbiter.zpp_pool?d=new t.util.ZNPNode_ZPP_ColArbiter:(d=t.util.ZNPNode_ZPP_ColArbiter.zpp_pool,t.util.ZNPNode_ZPP_ColArbiter.zpp_pool=d.next,d.next=null),d.elt=_;var P=d;P.next=m.head,m.head=P,m.modified=!0,m.length++}else{var f,x=this.c_arbiters_false;null==t.util.ZNPNode_ZPP_ColArbiter.zpp_pool?f=new t.util.ZNPNode_ZPP_ColArbiter:(f=t.util.ZNPNode_ZPP_ColArbiter.zpp_pool,t.util.ZNPNode_ZPP_ColArbiter.zpp_pool=f.next,f.next=null),f.elt=_;var y=f;y.next=x.head,x.head=y,x.modified=!0,x.length++}}else if(c.type==t.dynamics.ZPP_Arbiter.FLUID){var v,g=this.f_arbiters,b=c.fluidarb;null==t.util.ZNPNode_ZPP_FluidArbiter.zpp_pool?v=new t.util.ZNPNode_ZPP_FluidArbiter:(v=t.util.ZNPNode_ZPP_FluidArbiter.zpp_pool,t.util.ZNPNode_ZPP_FluidArbiter.zpp_pool=v.next,v.next=null),v.elt=b;var z=v;z.next=g.head,g.head=z,g.modified=!0,g.length++}else{var w,Z=this.s_arbiters,E=c.sensorarb;null==t.util.ZNPNode_ZPP_SensorArbiter.zpp_pool?w=new t.util.ZNPNode_ZPP_SensorArbiter:(w=t.util.ZNPNode_ZPP_SensorArbiter.zpp_pool,t.util.ZNPNode_ZPP_SensorArbiter.zpp_pool=w.next,w.next=null),w.elt=E;var M=w;M.next=Z.head,Z.head=M,Z.modified=!0,Z.length++}if(c.type!=t.dynamics.ZPP_Arbiter.SENSOR&&!c.cleared&&c.up_stamp>=this.stamp&&0!=(1&c.immState)){if(2==c.b1.type&&c.b1.component.sleeping){var S=c.b1;S.world||(S.component.waket=this.stamp+(this.midstep?0:1),3==S.type&&(S.kinematicDelaySleep=!0),S.component.sleeping&&this.really_wake(S,!1))}if(2==c.b2.type&&c.b2.component.sleeping){var C=c.b2;C.world||(C.component.waket=this.stamp+(this.midstep?0:1),3==C.type&&(C.kinematicDelaySleep=!0),C.component.sleeping&&this.really_wake(C,!1))}}h=h.next}if(n||2!=e.type||this.bodyCbWake(e),!n&&!this.bphase.is_sweep&&1!=e.type)for(var N=e.shapes.head;null!=N;){var A=N.elt;null!=A.node&&this.bphase.sync(A),N=N.next}}else this.wakeIsland(e.component.island)},t.space.ZPP_Space.prototype.wake_constraint=function(e,n){if(null==n&&(n=!1),e.active){if(e.component.waket=this.stamp+(this.midstep?0:1),e.component.sleeping){if(null==e.component.island){e.component.sleeping=!1;var i,r=this.live_constraints;null==t.util.ZNPNode_ZPP_Constraint.zpp_pool?i=new t.util.ZNPNode_ZPP_Constraint:(i=t.util.ZNPNode_ZPP_Constraint.zpp_pool,t.util.ZNPNode_ZPP_Constraint.zpp_pool=i.next,i.next=null),i.elt=e;var o=i;o.next=r.head,r.head=o,r.modified=!0,r.length++,e.wake_connected(),n||this.constraintCbWake(e)}else this.wakeIsland(e.component.island);return!0}return!1}return!1},t.space.ZPP_Space.prototype.doForests=function(e){for(var n=this.c_arbiters_false.head;null!=n;){var i=n.elt;if(!i.cleared&&i.up_stamp==this.stamp&&0!=(1&i.immState)&&2==i.b1.type&&2==i.b2.type){var r,o;if(i.b1.component==i.b1.component.parent)r=i.b1.component;else{for(var a=i.b1.component,s=null;a!=a.parent;){var l=a.parent;a.parent=s,s=a,a=l}for(;null!=s;){var p=s.parent;s.parent=a,s=p}r=a}if(i.b2.component==i.b2.component.parent)o=i.b2.component;else{for(var u=i.b2.component,h=null;u!=u.parent;){var c=u.parent;u.parent=h,h=u,u=c}for(;null!=h;){var _=h.parent;h.parent=u,h=_}o=u}r!=o&&(r.rank<o.rank?r.parent=o:r.rank>o.rank?o.parent=r:(o.parent=r,r.rank++))}n=n.next}for(var d=this.f_arbiters.head;null!=d;){var m=d.elt;if(!m.cleared&&m.up_stamp==this.stamp&&0!=(1&m.immState)&&2==m.b1.type&&2==m.b2.type){var P,f;if(m.b1.component==m.b1.component.parent)P=m.b1.component;else{for(var x=m.b1.component,y=null;x!=x.parent;){var v=x.parent;x.parent=y,y=x,x=v}for(;null!=y;){var g=y.parent;y.parent=x,y=g}P=x}if(m.b2.component==m.b2.component.parent)f=m.b2.component;else{for(var b=m.b2.component,z=null;b!=b.parent;){var w=b.parent;b.parent=z,z=b,b=w}for(;null!=z;){var Z=z.parent;z.parent=b,z=Z}f=b}P!=f&&(P.rank<f.rank?P.parent=f:P.rank>f.rank?f.parent=P:(f.parent=P,P.rank++))}d=d.next}for(var E=this.live_constraints.head;null!=E;)E.elt.forest(),E=E.next;for(;null!=this.live.head;){var M=this.live,S=M.head.elt;M.pop();var C,N=S,A=N.component;if(A==A.parent)C=A;else{for(var L=A,B=null;L!=L.parent;){var T=L.parent;L.parent=B,B=L,L=T}for(;null!=B;){var V=B.parent;B.parent=L,B=V}C=L}if(null==C.island){null==t.space.ZPP_Island.zpp_pool?C.island=new t.space.ZPP_Island:(C.island=t.space.ZPP_Island.zpp_pool,t.space.ZPP_Island.zpp_pool=C.island.next,C.island.next=null),C.island.waket=0;var k=this.islands,I=C.island;I._inuse=!0;var O=I;O.next=k.next,k.next=O,k.modified=!0,k.length++,C.island.sleep=!0}A.island=C.island;var R,H=A.island.comps;null==t.util.ZNPNode_ZPP_Component.zpp_pool?R=new t.util.ZNPNode_ZPP_Component:(R=t.util.ZNPNode_ZPP_Component.zpp_pool,t.util.ZNPNode_ZPP_Component.zpp_pool=R.next,R.next=null),R.elt=A;var F=R;F.next=H.head,H.head=F,H.modified=!0,H.length++;var D=N.atRest(e);A.island.sleep=A.island.sleep&&D,A.waket>A.island.waket&&(A.island.waket=A.waket)}for(;null!=this.live_constraints.head;){var G=this.live_constraints,U=G.head.elt;G.pop();var j,W=U.component;if(W==W.parent)j=W;else{for(var q=W,J=null;q!=q.parent;){var $=q.parent;q.parent=J,J=q,q=$}for(;null!=J;){var X=J.parent;J.parent=q,J=X}j=q}W.island=j.island;var Y,K=W.island.comps;null==t.util.ZNPNode_ZPP_Component.zpp_pool?Y=new t.util.ZNPNode_ZPP_Component:(Y=t.util.ZNPNode_ZPP_Component.zpp_pool,t.util.ZNPNode_ZPP_Component.zpp_pool=Y.next,Y.next=null),Y.elt=W;var Q=Y;Q.next=K.head,K.head=Q,K.modified=!0,K.length++,W.waket>W.island.waket&&(W.island.waket=W.waket)}for(;null!=this.islands.next;){var ee=this.islands,te=ee.next;ee.pop();var ne=te;if(ne.sleep)for(var ie=ne.comps.head;null!=ie;){var re=ie.elt;if(re.isBody){var oe=re.body;oe.velx=0,oe.vely=0,oe.angvel=0,re.sleeping=!0;for(var ae=oe.shapes.head;null!=ae;){var se=ae.elt;this.bphase.sync(se),ae=ae.next}this.bodyCbSleep(oe)}else{var le=re.constraint;this.constraintCbSleep(le),re.sleeping=!0}ie=ie.next}else{for(;null!=ne.comps.head;){var pe=ne.comps,ue=pe.head.elt;pe.pop();var he=ue;if(he.waket=ne.waket,he.isBody){var ce,_e=this.live,de=he.body;null==t.util.ZNPNode_ZPP_Body.zpp_pool?ce=new t.util.ZNPNode_ZPP_Body:(ce=t.util.ZNPNode_ZPP_Body.zpp_pool,t.util.ZNPNode_ZPP_Body.zpp_pool=ce.next,ce.next=null),ce.elt=de;var me=ce;me.next=_e.head,_e.head=me,_e.modified=!0,_e.length++}else{var Pe,fe=this.live_constraints,xe=he.constraint;null==t.util.ZNPNode_ZPP_Constraint.zpp_pool?Pe=new t.util.ZNPNode_ZPP_Constraint:(Pe=t.util.ZNPNode_ZPP_Constraint.zpp_pool,t.util.ZNPNode_ZPP_Constraint.zpp_pool=Pe.next,Pe.next=null),Pe.elt=xe;var ye=Pe;ye.next=fe.head,fe.head=ye,fe.modified=!0,fe.length++}he.sleeping=!1,he.island=null,he.parent=he,he.rank=0}var ve=ne;ve.next=t.space.ZPP_Island.zpp_pool,t.space.ZPP_Island.zpp_pool=ve}}},t.space.ZPP_Space.prototype.sleepArbiters=function(){var e=null,n=this.c_arbiters_true,i=n.head,r=null!=this.c_arbiters_false;for(r&&null==i&&(r=!1,i=this.c_arbiters_false.head,n=this.c_arbiters_false,e=null);null!=i;){var o=i.elt;if(o.b1.component.sleeping&&o.b2.component.sleeping){var a,s;o.sleep_stamp=this.stamp,o.sleeping=!0,null==e?(s=(a=n.head).next,n.head=s,null==n.head&&(n.pushmod=!0)):(s=(a=e.next).next,e.next=s,null==s&&(n.pushmod=!0));var l=a;l.elt=null,l.next=t.util.ZNPNode_ZPP_ColArbiter.zpp_pool,t.util.ZNPNode_ZPP_ColArbiter.zpp_pool=l,n.modified=!0,n.length--,n.pushmod=!0,i=s,r&&null==i&&(r=!1,i=this.c_arbiters_false.head,n=this.c_arbiters_false,e=null)}else e=i,i=i.next,r&&null==i&&(r=!1,i=this.c_arbiters_false.head,n=this.c_arbiters_false,e=null)}for(var p=null,u=this.f_arbiters,h=u.head;null!=h;){var c=h.elt;if(c.b1.component.sleeping&&c.b2.component.sleeping){var _,d;c.sleep_stamp=this.stamp,c.sleeping=!0,null==p?(d=(_=u.head).next,u.head=d,null==u.head&&(u.pushmod=!0)):(d=(_=p.next).next,p.next=d,null==d&&(u.pushmod=!0));var m=_;m.elt=null,m.next=t.util.ZNPNode_ZPP_FluidArbiter.zpp_pool,t.util.ZNPNode_ZPP_FluidArbiter.zpp_pool=m,u.modified=!0,u.length--,u.pushmod=!0,h=d}else p=h,h=h.next}for(var P=null,f=this.s_arbiters,x=f.head;null!=x;){var y=x.elt;if(y.b1.component.sleeping&&y.b2.component.sleeping){var v,g;y.sleep_stamp=this.stamp,y.sleeping=!0,null==P?(g=(v=f.head).next,f.head=g,null==f.head&&(f.pushmod=!0)):(g=(v=P.next).next,P.next=g,null==g&&(f.pushmod=!0));var b=v;b.elt=null,b.next=t.util.ZNPNode_ZPP_SensorArbiter.zpp_pool,t.util.ZNPNode_ZPP_SensorArbiter.zpp_pool=b,f.modified=!0,f.length--,f.pushmod=!0,x=g}else P=x,x=x.next}},t.space.ZPP_Space.prototype.static_validation=function(i){if(null!=i.shapes.head){if(null==i.shapes.head)throw new n._Boot.HaxeError("Error: Body bounds only makes sense if it contains shapes");if(i.zip_aabb){i.zip_aabb=!1,i.aabb.minx=1/0,i.aabb.miny=1/0,i.aabb.maxx=-1/0,i.aabb.maxy=-1/0;for(var r=i.shapes.head;null!=r;){var o=r.elt;if(o.zip_aabb&&null!=o.body)if(o.zip_aabb=!1,0==o.type){var a=o.circle;if(a.zip_worldCOM&&null!=a.body){if(a.zip_worldCOM=!1,a.zip_localCOM){if(a.zip_localCOM=!1,1==a.type){var s=a.polygon;if(null==s.lverts.next)throw new n._Boot.HaxeError("Error: An empty polygon has no meaningful localCOM");if(null==s.lverts.next.next)s.localCOMx=s.lverts.next.x,s.localCOMy=s.lverts.next.y;else if(null==s.lverts.next.next.next)s.localCOMx=s.lverts.next.x,s.localCOMy=s.lverts.next.y,s.localCOMx+=1*s.lverts.next.next.x,s.localCOMy+=1*s.lverts.next.next.y,s.localCOMx*=.5,s.localCOMy*=.5;else{s.localCOMx=0,s.localCOMy=0;var l=0,p=s.lverts.next,u=p,h=p=p.next;for(p=p.next;null!=p;){var c=p;l+=h.x*(c.y-u.y);var _=c.y*h.x-c.x*h.y;s.localCOMx+=(h.x+c.x)*_,s.localCOMy+=(h.y+c.y)*_,u=h,h=c,p=p.next}var d=p=s.lverts.next;l+=h.x*(d.y-u.y);var m=d.y*h.x-d.x*h.y;s.localCOMx+=(h.x+d.x)*m,s.localCOMy+=(h.y+d.y)*m,u=h,h=d;var P=p=p.next;l+=h.x*(P.y-u.y);var f=P.y*h.x-P.x*h.y;s.localCOMx+=(h.x+P.x)*f,s.localCOMy+=(h.y+P.y)*f;var x=l=1/(3*l);s.localCOMx*=x,s.localCOMy*=x}}null!=a.wrap_localCOM&&(a.wrap_localCOM.zpp_inner.x=a.localCOMx,a.wrap_localCOM.zpp_inner.y=a.localCOMy)}var y=a.body;y.zip_axis&&(y.zip_axis=!1,y.axisx=Math.sin(y.rot),y.axisy=Math.cos(y.rot)),a.worldCOMx=a.body.posx+(a.body.axisy*a.localCOMx-a.body.axisx*a.localCOMy),a.worldCOMy=a.body.posy+(a.localCOMx*a.body.axisx+a.localCOMy*a.body.axisy)}var v=a.radius,g=a.radius;a.aabb.minx=a.worldCOMx-v,a.aabb.miny=a.worldCOMy-g,a.aabb.maxx=a.worldCOMx+v,a.aabb.maxy=a.worldCOMy+g}else{var b=o.polygon;if(b.zip_gverts&&null!=b.body){b.zip_gverts=!1,b.validate_lverts();var z=b.body;z.zip_axis&&(z.zip_axis=!1,z.axisx=Math.sin(z.rot),z.axisy=Math.cos(z.rot));for(var w=b.lverts.next,Z=b.gverts.next;null!=Z;){var E=Z,M=w;w=w.next,E.x=b.body.posx+(b.body.axisy*M.x-b.body.axisx*M.y),E.y=b.body.posy+(M.x*b.body.axisx+M.y*b.body.axisy),Z=Z.next}}if(null==b.lverts.next)throw new n._Boot.HaxeError("Error: An empty polygon has no meaningful bounds");var S=b.gverts.next;b.aabb.minx=S.x,b.aabb.miny=S.y,b.aabb.maxx=S.x,b.aabb.maxy=S.y;for(var C=b.gverts.next.next;null!=C;){var N=C;N.x<b.aabb.minx&&(b.aabb.minx=N.x),N.x>b.aabb.maxx&&(b.aabb.maxx=N.x),N.y<b.aabb.miny&&(b.aabb.miny=N.y),N.y>b.aabb.maxy&&(b.aabb.maxy=N.y),C=C.next}}var A=i.aabb,L=o.aabb;L.minx<A.minx&&(A.minx=L.minx),L.maxx>A.maxx&&(A.maxx=L.maxx),L.miny<A.miny&&(A.miny=L.miny),L.maxy>A.maxy&&(A.maxy=L.maxy),r=r.next}}}if(i.validate_mass(),i.validate_inertia(),0!=i.velx||0!=i.vely||0!=i.angvel)throw new n._Boot.HaxeError("Error: Static body cannot have any real velocity, only kinematic or surface velocities");for(var B=i.shapes.head;null!=B;){var T=B.elt;if(1==T.type){var V=T.polygon;V.zip_sanitation&&(V.zip_sanitation=!1,V.splice_collinear_real());var k=T.polygon.valid();if(null==t.util.ZPP_Flags.ValidationResult_VALID&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.ValidationResult_VALID=new e.shape.ValidationResult,t.util.ZPP_Flags.internal=!1),k!=t.util.ZPP_Flags.ValidationResult_VALID)throw new n._Boot.HaxeError("Error: Cannot simulate with an invalid Polygon : "+T.polygon.outer.toString()+" is invalid : "+k.toString());var I=T.polygon;if(I.zip_gaxi&&null!=I.body){I.zip_gaxi=!1,I.validate_laxi();var O=I.body;if(O.zip_axis&&(O.zip_axis=!1,O.axisx=Math.sin(O.rot),O.axisy=Math.cos(O.rot)),I.zip_gverts&&null!=I.body){I.zip_gverts=!1,I.validate_lverts();var R=I.body;R.zip_axis&&(R.zip_axis=!1,R.axisx=Math.sin(R.rot),R.axisy=Math.cos(R.rot));for(var H=I.lverts.next,F=I.gverts.next;null!=F;){var D=F,G=H;H=H.next,D.x=I.body.posx+(I.body.axisy*G.x-I.body.axisx*G.y),D.y=I.body.posy+(G.x*I.body.axisx+G.y*I.body.axisy),F=F.next}}var U=I.edges.head,j=I.gverts.next,W=j;for(j=j.next;null!=j;){var q=j,J=U.elt;U=U.next,J.gp0=W,J.gp1=q,J.gnormx=I.body.axisy*J.lnormx-I.body.axisx*J.lnormy,J.gnormy=J.lnormx*I.body.axisx+J.lnormy*I.body.axisy,J.gprojection=I.body.posx*J.gnormx+I.body.posy*J.gnormy+J.lprojection,null!=J.wrap_gnorm&&(J.wrap_gnorm.zpp_inner.x=J.gnormx,J.wrap_gnorm.zpp_inner.y=J.gnormy),J.tp0=J.gp0.y*J.gnormx-J.gp0.x*J.gnormy,J.tp1=J.gp1.y*J.gnormx-J.gp1.x*J.gnormy,W=q,j=j.next}var $=I.gverts.next,X=U.elt;U=U.next,X.gp0=W,X.gp1=$,X.gnormx=I.body.axisy*X.lnormx-I.body.axisx*X.lnormy,X.gnormy=X.lnormx*I.body.axisx+X.lnormy*I.body.axisy,X.gprojection=I.body.posx*X.gnormx+I.body.posy*X.gnormy+X.lprojection,null!=X.wrap_gnorm&&(X.wrap_gnorm.zpp_inner.x=X.gnormx,X.wrap_gnorm.zpp_inner.y=X.gnormy),X.tp0=X.gp0.y*X.gnormx-X.gp0.x*X.gnormy,X.tp1=X.gp1.y*X.gnormx-X.gp1.x*X.gnormy}}B=B.next}i.sweepFrozen=!0},t.space.ZPP_Space.prototype.validation=function(){var i=this.cbsets;if(!i.cbsets.empty()){for(var r=i.cbsets.parent;null!=r.prev;)r=r.prev;for(;null!=r;)if(r.data.validate(),null!=r.next)for(r=r.next;null!=r.prev;)r=r.prev;else{for(;null!=r.parent&&r==r.parent.next;)r=r.parent;r=r.parent}}for(var o=this.live.head;null!=o;){var a=o.elt;a.sweepRadius=0;for(var s=a.shapes.head;null!=s;){var l=s.elt;if(1==l.type){var p=l.polygon;p.zip_sanitation&&(p.zip_sanitation=!1,p.splice_collinear_real());var u=l.polygon.valid();if(null==t.util.ZPP_Flags.ValidationResult_VALID&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.ValidationResult_VALID=new e.shape.ValidationResult,t.util.ZPP_Flags.internal=!1),u!=t.util.ZPP_Flags.ValidationResult_VALID)throw new n._Boot.HaxeError("Error: Cannot simulate with an invalid Polygon : "+l.polygon.outer.toString()+" is invalid : "+u.toString());var h=l.polygon;if(h.zip_gaxi&&null!=h.body){h.zip_gaxi=!1,h.validate_laxi();var c=h.body;if(c.zip_axis&&(c.zip_axis=!1,c.axisx=Math.sin(c.rot),c.axisy=Math.cos(c.rot)),h.zip_gverts&&null!=h.body){h.zip_gverts=!1,h.validate_lverts();var _=h.body;_.zip_axis&&(_.zip_axis=!1,_.axisx=Math.sin(_.rot),_.axisy=Math.cos(_.rot));for(var d=h.lverts.next,m=h.gverts.next;null!=m;){var P=m,f=d;d=d.next,P.x=h.body.posx+(h.body.axisy*f.x-h.body.axisx*f.y),P.y=h.body.posy+(f.x*h.body.axisx+f.y*h.body.axisy),m=m.next}}var x=h.edges.head,y=h.gverts.next,v=y;for(y=y.next;null!=y;){var g=y,b=x.elt;x=x.next,b.gp0=v,b.gp1=g,b.gnormx=h.body.axisy*b.lnormx-h.body.axisx*b.lnormy,b.gnormy=b.lnormx*h.body.axisx+b.lnormy*h.body.axisy,b.gprojection=h.body.posx*b.gnormx+h.body.posy*b.gnormy+b.lprojection,null!=b.wrap_gnorm&&(b.wrap_gnorm.zpp_inner.x=b.gnormx,b.wrap_gnorm.zpp_inner.y=b.gnormy),b.tp0=b.gp0.y*b.gnormx-b.gp0.x*b.gnormy,b.tp1=b.gp1.y*b.gnormx-b.gp1.x*b.gnormy,v=g,y=y.next}var z=h.gverts.next,w=x.elt;x=x.next,w.gp0=v,w.gp1=z,w.gnormx=h.body.axisy*w.lnormx-h.body.axisx*w.lnormy,w.gnormy=w.lnormx*h.body.axisx+w.lnormy*h.body.axisy,w.gprojection=h.body.posx*w.gnormx+h.body.posy*w.gnormy+w.lprojection,null!=w.wrap_gnorm&&(w.wrap_gnorm.zpp_inner.x=w.gnormx,w.wrap_gnorm.zpp_inner.y=w.gnormy),w.tp0=w.gp0.y*w.gnormx-w.gp0.x*w.gnormy,w.tp1=w.gp1.y*w.gnormx-w.gp1.x*w.gnormy}}l.validate_sweepRadius(),l.sweepRadius>a.sweepRadius&&(a.sweepRadius=l.sweepRadius),s=s.next}if(a.validate_mass(),a.validate_inertia(),null!=a.shapes.head){if(null==a.shapes.head)throw new n._Boot.HaxeError("Error: Body bounds only makes sense if it contains shapes");if(a.zip_aabb){a.zip_aabb=!1,a.aabb.minx=1/0,a.aabb.miny=1/0,a.aabb.maxx=-1/0,a.aabb.maxy=-1/0;for(var Z=a.shapes.head;null!=Z;){var E=Z.elt;if(E.zip_aabb&&null!=E.body)if(E.zip_aabb=!1,0==E.type){var M=E.circle;if(M.zip_worldCOM&&null!=M.body){if(M.zip_worldCOM=!1,M.zip_localCOM){if(M.zip_localCOM=!1,1==M.type){var S=M.polygon;if(null==S.lverts.next)throw new n._Boot.HaxeError("Error: An empty polygon has no meaningful localCOM");if(null==S.lverts.next.next)S.localCOMx=S.lverts.next.x,S.localCOMy=S.lverts.next.y;else if(null==S.lverts.next.next.next)S.localCOMx=S.lverts.next.x,S.localCOMy=S.lverts.next.y,S.localCOMx+=1*S.lverts.next.next.x,S.localCOMy+=1*S.lverts.next.next.y,S.localCOMx*=.5,S.localCOMy*=.5;else{S.localCOMx=0,S.localCOMy=0;var C=0,N=S.lverts.next,A=N,L=N=N.next;for(N=N.next;null!=N;){var B=N;C+=L.x*(B.y-A.y);var T=B.y*L.x-B.x*L.y;S.localCOMx+=(L.x+B.x)*T,S.localCOMy+=(L.y+B.y)*T,A=L,L=B,N=N.next}var V=N=S.lverts.next;C+=L.x*(V.y-A.y);var k=V.y*L.x-V.x*L.y;S.localCOMx+=(L.x+V.x)*k,S.localCOMy+=(L.y+V.y)*k,A=L,L=V;var I=N=N.next;C+=L.x*(I.y-A.y);var O=I.y*L.x-I.x*L.y;S.localCOMx+=(L.x+I.x)*O,S.localCOMy+=(L.y+I.y)*O;var R=C=1/(3*C);S.localCOMx*=R,S.localCOMy*=R}}null!=M.wrap_localCOM&&(M.wrap_localCOM.zpp_inner.x=M.localCOMx,M.wrap_localCOM.zpp_inner.y=M.localCOMy)}var H=M.body;H.zip_axis&&(H.zip_axis=!1,H.axisx=Math.sin(H.rot),H.axisy=Math.cos(H.rot)),M.worldCOMx=M.body.posx+(M.body.axisy*M.localCOMx-M.body.axisx*M.localCOMy),M.worldCOMy=M.body.posy+(M.localCOMx*M.body.axisx+M.localCOMy*M.body.axisy)}var F=M.radius,D=M.radius;M.aabb.minx=M.worldCOMx-F,M.aabb.miny=M.worldCOMy-D,M.aabb.maxx=M.worldCOMx+F,M.aabb.maxy=M.worldCOMy+D}else{var G=E.polygon;if(G.zip_gverts&&null!=G.body){G.zip_gverts=!1,G.validate_lverts();var U=G.body;U.zip_axis&&(U.zip_axis=!1,U.axisx=Math.sin(U.rot),U.axisy=Math.cos(U.rot));for(var j=G.lverts.next,W=G.gverts.next;null!=W;){var q=W,J=j;j=j.next,q.x=G.body.posx+(G.body.axisy*J.x-G.body.axisx*J.y),q.y=G.body.posy+(J.x*G.body.axisx+J.y*G.body.axisy),W=W.next}}if(null==G.lverts.next)throw new n._Boot.HaxeError("Error: An empty polygon has no meaningful bounds");var $=G.gverts.next;G.aabb.minx=$.x,G.aabb.miny=$.y,G.aabb.maxx=$.x,G.aabb.maxy=$.y;for(var X=G.gverts.next.next;null!=X;){var Y=X;Y.x<G.aabb.minx&&(G.aabb.minx=Y.x),Y.x>G.aabb.maxx&&(G.aabb.maxx=Y.x),Y.y<G.aabb.miny&&(G.aabb.miny=Y.y),Y.y>G.aabb.maxy&&(G.aabb.maxy=Y.y),X=X.next}}var K=a.aabb,Q=E.aabb;Q.minx<K.minx&&(K.minx=Q.minx),Q.maxx>K.maxx&&(K.maxx=Q.maxx),Q.miny<K.miny&&(K.miny=Q.miny),Q.maxy>K.maxy&&(K.maxy=Q.maxy),Z=Z.next}}a.validate_worldCOM()}if(a.validate_gravMass(),a.zip_axis&&(a.zip_axis=!1,a.axisx=Math.sin(a.rot),a.axisy=Math.cos(a.rot)),!a.nomove&&2==a.type&&0==a.mass)throw new n._Boot.HaxeError("Error: Dynamic Body cannot be simulated with 0 mass unless allowMovement is false");if(!a.norotate&&2==a.type&&0==a.inertia)throw new n._Boot.HaxeError("Error: Dynamic Body cannot be simulated with 0 inertia unless allowRotation is false");if(a.component.woken&&null!=a.cbSet)for(var ee=a.cbSet.bodylisteners.head;null!=ee;){var te=ee.elt;if(2==te.event){var ne=this.push_callback(te);ne.event=2,ne.body=a,ee=ee.next}else ee=ee.next}a.component.woken=!1;for(var ie=a.shapes.head;null!=ie;){var re=ie.elt;this.bphase.sync(re),ie=ie.next}o=o.next}for(var oe=this.kinematics.head;null!=oe;){var ae=oe.elt;ae.sweepRadius=0;for(var se=ae.shapes.head;null!=se;){var le=se.elt;if(1==le.type){var pe=le.polygon;pe.zip_sanitation&&(pe.zip_sanitation=!1,pe.splice_collinear_real());var ue=le.polygon.valid();if(null==t.util.ZPP_Flags.ValidationResult_VALID&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.ValidationResult_VALID=new e.shape.ValidationResult,t.util.ZPP_Flags.internal=!1),ue!=t.util.ZPP_Flags.ValidationResult_VALID)throw new n._Boot.HaxeError("Error: Cannot simulate with an invalid Polygon : "+le.polygon.outer.toString()+" is invalid : "+ue.toString());var he=le.polygon;if(he.zip_gaxi&&null!=he.body){he.zip_gaxi=!1,he.validate_laxi();var ce=he.body;if(ce.zip_axis&&(ce.zip_axis=!1,ce.axisx=Math.sin(ce.rot),ce.axisy=Math.cos(ce.rot)),he.zip_gverts&&null!=he.body){he.zip_gverts=!1,he.validate_lverts();var _e=he.body;_e.zip_axis&&(_e.zip_axis=!1,_e.axisx=Math.sin(_e.rot),_e.axisy=Math.cos(_e.rot));for(var de=he.lverts.next,me=he.gverts.next;null!=me;){var Pe=me,fe=de;de=de.next,Pe.x=he.body.posx+(he.body.axisy*fe.x-he.body.axisx*fe.y),Pe.y=he.body.posy+(fe.x*he.body.axisx+fe.y*he.body.axisy),me=me.next}}var xe=he.edges.head,ye=he.gverts.next,ve=ye;for(ye=ye.next;null!=ye;){var ge=ye,be=xe.elt;xe=xe.next,be.gp0=ve,be.gp1=ge,be.gnormx=he.body.axisy*be.lnormx-he.body.axisx*be.lnormy,be.gnormy=be.lnormx*he.body.axisx+be.lnormy*he.body.axisy,be.gprojection=he.body.posx*be.gnormx+he.body.posy*be.gnormy+be.lprojection,null!=be.wrap_gnorm&&(be.wrap_gnorm.zpp_inner.x=be.gnormx,be.wrap_gnorm.zpp_inner.y=be.gnormy),be.tp0=be.gp0.y*be.gnormx-be.gp0.x*be.gnormy,be.tp1=be.gp1.y*be.gnormx-be.gp1.x*be.gnormy,ve=ge,ye=ye.next}var ze=he.gverts.next,we=xe.elt;xe=xe.next,we.gp0=ve,we.gp1=ze,we.gnormx=he.body.axisy*we.lnormx-he.body.axisx*we.lnormy,we.gnormy=we.lnormx*he.body.axisx+we.lnormy*he.body.axisy,we.gprojection=he.body.posx*we.gnormx+he.body.posy*we.gnormy+we.lprojection,null!=we.wrap_gnorm&&(we.wrap_gnorm.zpp_inner.x=we.gnormx,we.wrap_gnorm.zpp_inner.y=we.gnormy),we.tp0=we.gp0.y*we.gnormx-we.gp0.x*we.gnormy,we.tp1=we.gp1.y*we.gnormx-we.gp1.x*we.gnormy}}le.validate_sweepRadius(),le.sweepRadius>ae.sweepRadius&&(ae.sweepRadius=le.sweepRadius),se=se.next}if(ae.validate_mass(),ae.validate_inertia(),null!=ae.shapes.head){if(null==ae.shapes.head)throw new n._Boot.HaxeError("Error: Body bounds only makes sense if it contains shapes");if(ae.zip_aabb){ae.zip_aabb=!1,ae.aabb.minx=1/0,ae.aabb.miny=1/0,ae.aabb.maxx=-1/0,ae.aabb.maxy=-1/0;for(var Ze=ae.shapes.head;null!=Ze;){var Ee=Ze.elt;if(Ee.zip_aabb&&null!=Ee.body)if(Ee.zip_aabb=!1,0==Ee.type){var Me=Ee.circle;if(Me.zip_worldCOM&&null!=Me.body){if(Me.zip_worldCOM=!1,Me.zip_localCOM){if(Me.zip_localCOM=!1,1==Me.type){var Se=Me.polygon;if(null==Se.lverts.next)throw new n._Boot.HaxeError("Error: An empty polygon has no meaningful localCOM");if(null==Se.lverts.next.next)Se.localCOMx=Se.lverts.next.x,Se.localCOMy=Se.lverts.next.y;else if(null==Se.lverts.next.next.next)Se.localCOMx=Se.lverts.next.x,Se.localCOMy=Se.lverts.next.y,Se.localCOMx+=1*Se.lverts.next.next.x,Se.localCOMy+=1*Se.lverts.next.next.y,Se.localCOMx*=.5,Se.localCOMy*=.5;else{Se.localCOMx=0,Se.localCOMy=0;var Ce=0,Ne=Se.lverts.next,Ae=Ne,Le=Ne=Ne.next;for(Ne=Ne.next;null!=Ne;){var Be=Ne;Ce+=Le.x*(Be.y-Ae.y);var Te=Be.y*Le.x-Be.x*Le.y;Se.localCOMx+=(Le.x+Be.x)*Te,Se.localCOMy+=(Le.y+Be.y)*Te,Ae=Le,Le=Be,Ne=Ne.next}var Ve=Ne=Se.lverts.next;Ce+=Le.x*(Ve.y-Ae.y);var ke=Ve.y*Le.x-Ve.x*Le.y;Se.localCOMx+=(Le.x+Ve.x)*ke,Se.localCOMy+=(Le.y+Ve.y)*ke,Ae=Le,Le=Ve;var Ie=Ne=Ne.next;Ce+=Le.x*(Ie.y-Ae.y);var Oe=Ie.y*Le.x-Ie.x*Le.y;Se.localCOMx+=(Le.x+Ie.x)*Oe,Se.localCOMy+=(Le.y+Ie.y)*Oe;var Re=Ce=1/(3*Ce);Se.localCOMx*=Re,Se.localCOMy*=Re}}null!=Me.wrap_localCOM&&(Me.wrap_localCOM.zpp_inner.x=Me.localCOMx,Me.wrap_localCOM.zpp_inner.y=Me.localCOMy)}var He=Me.body;He.zip_axis&&(He.zip_axis=!1,He.axisx=Math.sin(He.rot),He.axisy=Math.cos(He.rot)),Me.worldCOMx=Me.body.posx+(Me.body.axisy*Me.localCOMx-Me.body.axisx*Me.localCOMy),Me.worldCOMy=Me.body.posy+(Me.localCOMx*Me.body.axisx+Me.localCOMy*Me.body.axisy)}var Fe=Me.radius,De=Me.radius;Me.aabb.minx=Me.worldCOMx-Fe,Me.aabb.miny=Me.worldCOMy-De,Me.aabb.maxx=Me.worldCOMx+Fe,Me.aabb.maxy=Me.worldCOMy+De}else{var Ge=Ee.polygon;if(Ge.zip_gverts&&null!=Ge.body){Ge.zip_gverts=!1,Ge.validate_lverts();var Ue=Ge.body;Ue.zip_axis&&(Ue.zip_axis=!1,Ue.axisx=Math.sin(Ue.rot),Ue.axisy=Math.cos(Ue.rot));for(var je=Ge.lverts.next,We=Ge.gverts.next;null!=We;){var qe=We,Je=je;je=je.next,qe.x=Ge.body.posx+(Ge.body.axisy*Je.x-Ge.body.axisx*Je.y),qe.y=Ge.body.posy+(Je.x*Ge.body.axisx+Je.y*Ge.body.axisy),We=We.next}}if(null==Ge.lverts.next)throw new n._Boot.HaxeError("Error: An empty polygon has no meaningful bounds");var $e=Ge.gverts.next;Ge.aabb.minx=$e.x,Ge.aabb.miny=$e.y,Ge.aabb.maxx=$e.x,Ge.aabb.maxy=$e.y;for(var Xe=Ge.gverts.next.next;null!=Xe;){var Ye=Xe;Ye.x<Ge.aabb.minx&&(Ge.aabb.minx=Ye.x),Ye.x>Ge.aabb.maxx&&(Ge.aabb.maxx=Ye.x),Ye.y<Ge.aabb.miny&&(Ge.aabb.miny=Ye.y),Ye.y>Ge.aabb.maxy&&(Ge.aabb.maxy=Ye.y),Xe=Xe.next}}var Ke=ae.aabb,Qe=Ee.aabb;Qe.minx<Ke.minx&&(Ke.minx=Qe.minx),Qe.maxx>Ke.maxx&&(Ke.maxx=Qe.maxx),Qe.miny<Ke.miny&&(Ke.miny=Qe.miny),Qe.maxy>Ke.maxy&&(Ke.maxy=Qe.maxy),Ze=Ze.next}}ae.validate_worldCOM()}if(ae.validate_gravMass(),ae.zip_axis&&(ae.zip_axis=!1,ae.axisx=Math.sin(ae.rot),ae.axisy=Math.cos(ae.rot)),!ae.nomove&&2==ae.type&&0==ae.mass)throw new n._Boot.HaxeError("Error: Dynamic Body cannot be simulated with 0 mass unless allowMovement is false");if(!ae.norotate&&2==ae.type&&0==ae.inertia)throw new n._Boot.HaxeError("Error: Dynamic Body cannot be simulated with 0 inertia unless allowRotation is false");for(var et=ae.shapes.head;null!=et;){var tt=et.elt;this.bphase.sync(tt),et=et.next}oe=oe.next}for(var nt=this.live_constraints.head;null!=nt;){var it=nt.elt;if(it.active){if(it.validate(),it.component.woken&&null!=it.cbSet)for(var rt=it.cbSet.conlisteners.head;null!=rt;){var ot=rt.elt;if(2==ot.event){var at=this.push_callback(ot);at.event=2,at.constraint=it,rt=rt.next}else rt=rt.next}it.component.woken=!1}nt=nt.next}},t.space.ZPP_Space.prototype.updateVel=function(e){for(var t=1-e*this.global_lin_drag,n=1-e*this.global_ang_drag,i=this.live.head;null!=i;){var r=i.elt;if(0!=r.smass){var o=e*r.imass;r.velx=t*r.velx+(r.forcex+this.gravityx*r.gravMass)*o,r.vely=t*r.vely+(r.forcey+this.gravityy*r.gravMass)*o}if(0!=r.sinertia){var a,s;a=r.worldCOMx-r.posx,s=r.worldCOMy-r.posy;var l=r.torque+(this.gravityy*a-this.gravityx*s)*r.gravMass;r.angvel=n*r.angvel+l*e*r.iinertia}i=i.next}},t.space.ZPP_Space.prototype.updatePos=function(t){for(var n=2*Math.PI/t,i=this.live.head;null!=i;){var r=i.elt;r.pre_posx=r.posx,r.pre_posy=r.posy,r.pre_rot=r.rot,r.sweepTime=0,r.sweep_angvel=r.angvel%n;var o=t-r.sweepTime;if(0!=o){r.sweepTime=t;var a=o;if(r.posx+=r.velx*a,r.posy+=r.vely*a,0!=r.angvel){var s=r.sweep_angvel*o;if(r.rot+=s,s*s>1e-4)r.axisx=Math.sin(r.rot),r.axisy=Math.cos(r.rot);else{var l=s*s,p=1-.5*l,u=1-l*l/8,h=(p*r.axisx+s*r.axisy)*u;r.axisy=(p*r.axisy-s*r.axisx)*u,r.axisx=h}}}if(r.disableCCD)r.sweepFrozen=!0,r.bullet=!1;else{var c=e.Config.staticCCDLinearThreshold*r.sweepRadius,_=e.Config.staticCCDAngularThreshold;if((r.velx*r.velx+r.vely*r.vely)*t*t>c*c||r.angvel*r.angvel*t*t>_*_||3==r.type){var d=r.sweep_angvel;d<0&&(d=-d);for(var m=1/d,P=r.shapes.head;null!=P;){var f=P.elt,x=f.aabb,y=x.minx,v=x.miny,g=x.maxx,b=x.maxy,z=d*t*f.sweepCoef*.008333333333333333|0;z>8&&(z=8);var w=d*t/z,Z=t-r.sweepTime;if(0!=Z){r.sweepTime=t;var E=Z;if(r.posx+=r.velx*E,r.posy+=r.vely*E,0!=r.angvel){var M=r.sweep_angvel*Z;if(r.rot+=M,M*M>1e-4)r.axisx=Math.sin(r.rot),r.axisy=Math.cos(r.rot);else{var S=M*M,C=1-.5*S,N=1-S*S/8,A=(C*r.axisx+M*r.axisy)*N;r.axisy=(C*r.axisy-M*r.axisx)*N,r.axisx=A}}}if(0==f.type){var L=f.circle;L.worldCOMx=L.body.posx+(L.body.axisy*L.localCOMx-L.body.axisx*L.localCOMy),L.worldCOMy=L.body.posy+(L.localCOMx*L.body.axisx+L.localCOMy*L.body.axisy),L.aabb.minx=L.worldCOMx-L.radius,L.aabb.miny=L.worldCOMy-L.radius,L.aabb.maxx=L.worldCOMx+L.radius,L.aabb.maxy=L.worldCOMy+L.radius}else{var B=f.polygon,T=B.lverts.next,V=B.gverts.next,k=T;T=T.next,V.x=B.body.posx+(B.body.axisy*k.x-B.body.axisx*k.y),V.y=B.body.posy+(k.x*B.body.axisx+k.y*B.body.axisy),B.aabb.minx=V.x,B.aabb.miny=V.y,B.aabb.maxx=V.x,B.aabb.maxy=V.y;for(var I=B.gverts.next.next;null!=I;){var O=I,R=T;T=T.next,O.x=B.body.posx+(B.body.axisy*R.x-B.body.axisx*R.y),O.y=B.body.posy+(R.x*B.body.axisx+R.y*B.body.axisy),O.x<B.aabb.minx&&(B.aabb.minx=O.x),O.x>B.aabb.maxx&&(B.aabb.maxx=O.x),O.y<B.aabb.miny&&(B.aabb.miny=O.y),O.y>B.aabb.maxy&&(B.aabb.maxy=O.y),I=I.next}}y<x.minx?x.minx=y:y=x.minx,v<x.miny?x.miny=v:v=x.miny,g>x.maxx?x.maxx=g:g=x.maxx,b>x.maxy?x.maxy=b:b=x.maxy;for(var H=1,F=z;H<F;){var D=w*H++*m,G=D-r.sweepTime;if(0!=G){r.sweepTime=D;var U=G;if(r.posx+=r.velx*U,r.posy+=r.vely*U,0!=r.angvel){var j=r.sweep_angvel*G;if(r.rot+=j,j*j>1e-4)r.axisx=Math.sin(r.rot),r.axisy=Math.cos(r.rot);else{var W=j*j,q=1-.5*W,J=1-W*W/8,$=(q*r.axisx+j*r.axisy)*J;r.axisy=(q*r.axisy-j*r.axisx)*J,r.axisx=$}}}if(0==f.type){var X=f.circle;X.worldCOMx=X.body.posx+(X.body.axisy*X.localCOMx-X.body.axisx*X.localCOMy),X.worldCOMy=X.body.posy+(X.localCOMx*X.body.axisx+X.localCOMy*X.body.axisy),X.aabb.minx=X.worldCOMx-X.radius,X.aabb.miny=X.worldCOMy-X.radius,X.aabb.maxx=X.worldCOMx+X.radius,X.aabb.maxy=X.worldCOMy+X.radius}else{var Y=f.polygon,K=Y.lverts.next,Q=Y.gverts.next,ee=K;K=K.next,Q.x=Y.body.posx+(Y.body.axisy*ee.x-Y.body.axisx*ee.y),Q.y=Y.body.posy+(ee.x*Y.body.axisx+ee.y*Y.body.axisy),Y.aabb.minx=Q.x,Y.aabb.miny=Q.y,Y.aabb.maxx=Q.x,Y.aabb.maxy=Q.y;for(var te=Y.gverts.next.next;null!=te;){var ne=te,ie=K;K=K.next,ne.x=Y.body.posx+(Y.body.axisy*ie.x-Y.body.axisx*ie.y),ne.y=Y.body.posy+(ie.x*Y.body.axisx+ie.y*Y.body.axisy),ne.x<Y.aabb.minx&&(Y.aabb.minx=ne.x),ne.x>Y.aabb.maxx&&(Y.aabb.maxx=ne.x),ne.y<Y.aabb.miny&&(Y.aabb.miny=ne.y),ne.y>Y.aabb.maxy&&(Y.aabb.maxy=ne.y),te=te.next}}y<x.minx?x.minx=y:y=x.minx,v<x.miny?x.miny=v:v=x.miny,g>x.maxx?x.maxx=g:g=x.maxx,b>x.maxy?x.maxy=b:b=x.maxy}this.bphase.sync(f),P=P.next}if(r.sweepFrozen=!1,2==r.type&&r.bulletEnabled){var re=e.Config.bulletCCDLinearThreshold*r.sweepRadius,oe=e.Config.bulletCCDAngularThreshold;((r.velx*r.velx+r.vely*r.vely)*t*t>re*re||r.angvel*r.angvel*t*t>oe*oe)&&(r.bullet=!0)}}else r.sweepFrozen=!0,r.bullet=!1}i=i.next}for(var ae=this.kinematics.head;null!=ae;){var se=ae.elt;se.pre_posx=se.posx,se.pre_posy=se.posy,se.pre_rot=se.rot,se.sweepTime=0,se.sweep_angvel=se.angvel%n;var le=t-se.sweepTime;if(0!=le){se.sweepTime=t;var pe=le;if(se.posx+=se.velx*pe,se.posy+=se.vely*pe,0!=se.angvel){var ue=se.sweep_angvel*le;if(se.rot+=ue,ue*ue>1e-4)se.axisx=Math.sin(se.rot),se.axisy=Math.cos(se.rot);else{var he=ue*ue,ce=1-.5*he,_e=1-he*he/8,de=(ce*se.axisx+ue*se.axisy)*_e;se.axisy=(ce*se.axisy-ue*se.axisx)*_e,se.axisx=de}}}if(se.disableCCD)se.sweepFrozen=!0,se.bullet=!1;else{var me=e.Config.staticCCDLinearThreshold*se.sweepRadius,Pe=e.Config.staticCCDAngularThreshold;if((se.velx*se.velx+se.vely*se.vely)*t*t>me*me||se.angvel*se.angvel*t*t>Pe*Pe||3==se.type){var fe=se.sweep_angvel;fe<0&&(fe=-fe);for(var xe=1/fe,ye=se.shapes.head;null!=ye;){var ve=ye.elt,ge=ve.aabb,be=ge.minx,ze=ge.miny,we=ge.maxx,Ze=ge.maxy,Ee=fe*t*ve.sweepCoef*.008333333333333333|0;Ee>8&&(Ee=8);var Me=fe*t/Ee,Se=t-se.sweepTime;if(0!=Se){se.sweepTime=t;var Ce=Se;if(se.posx+=se.velx*Ce,se.posy+=se.vely*Ce,0!=se.angvel){var Ne=se.sweep_angvel*Se;if(se.rot+=Ne,Ne*Ne>1e-4)se.axisx=Math.sin(se.rot),se.axisy=Math.cos(se.rot);else{var Ae=Ne*Ne,Le=1-.5*Ae,Be=1-Ae*Ae/8,Te=(Le*se.axisx+Ne*se.axisy)*Be;se.axisy=(Le*se.axisy-Ne*se.axisx)*Be,se.axisx=Te}}}if(0==ve.type){var Ve=ve.circle;Ve.worldCOMx=Ve.body.posx+(Ve.body.axisy*Ve.localCOMx-Ve.body.axisx*Ve.localCOMy),Ve.worldCOMy=Ve.body.posy+(Ve.localCOMx*Ve.body.axisx+Ve.localCOMy*Ve.body.axisy),Ve.aabb.minx=Ve.worldCOMx-Ve.radius,Ve.aabb.miny=Ve.worldCOMy-Ve.radius,Ve.aabb.maxx=Ve.worldCOMx+Ve.radius,Ve.aabb.maxy=Ve.worldCOMy+Ve.radius}else{var ke=ve.polygon,Ie=ke.lverts.next,Oe=ke.gverts.next,Re=Ie;Ie=Ie.next,Oe.x=ke.body.posx+(ke.body.axisy*Re.x-ke.body.axisx*Re.y),Oe.y=ke.body.posy+(Re.x*ke.body.axisx+Re.y*ke.body.axisy),ke.aabb.minx=Oe.x,ke.aabb.miny=Oe.y,ke.aabb.maxx=Oe.x,ke.aabb.maxy=Oe.y;for(var He=ke.gverts.next.next;null!=He;){var Fe=He,De=Ie;Ie=Ie.next,Fe.x=ke.body.posx+(ke.body.axisy*De.x-ke.body.axisx*De.y),Fe.y=ke.body.posy+(De.x*ke.body.axisx+De.y*ke.body.axisy),Fe.x<ke.aabb.minx&&(ke.aabb.minx=Fe.x),Fe.x>ke.aabb.maxx&&(ke.aabb.maxx=Fe.x),Fe.y<ke.aabb.miny&&(ke.aabb.miny=Fe.y),Fe.y>ke.aabb.maxy&&(ke.aabb.maxy=Fe.y),He=He.next}}be<ge.minx?ge.minx=be:be=ge.minx,ze<ge.miny?ge.miny=ze:ze=ge.miny,we>ge.maxx?ge.maxx=we:we=ge.maxx,Ze>ge.maxy?ge.maxy=Ze:Ze=ge.maxy;for(var Ge=1,Ue=Ee;Ge<Ue;){var je=Me*Ge++*xe,We=je-se.sweepTime;if(0!=We){se.sweepTime=je;var qe=We;if(se.posx+=se.velx*qe,se.posy+=se.vely*qe,0!=se.angvel){var Je=se.sweep_angvel*We;if(se.rot+=Je,Je*Je>1e-4)se.axisx=Math.sin(se.rot),se.axisy=Math.cos(se.rot);else{var $e=Je*Je,Xe=1-.5*$e,Ye=1-$e*$e/8,Ke=(Xe*se.axisx+Je*se.axisy)*Ye;se.axisy=(Xe*se.axisy-Je*se.axisx)*Ye,se.axisx=Ke}}}if(0==ve.type){var Qe=ve.circle;Qe.worldCOMx=Qe.body.posx+(Qe.body.axisy*Qe.localCOMx-Qe.body.axisx*Qe.localCOMy),Qe.worldCOMy=Qe.body.posy+(Qe.localCOMx*Qe.body.axisx+Qe.localCOMy*Qe.body.axisy),Qe.aabb.minx=Qe.worldCOMx-Qe.radius,Qe.aabb.miny=Qe.worldCOMy-Qe.radius,Qe.aabb.maxx=Qe.worldCOMx+Qe.radius,Qe.aabb.maxy=Qe.worldCOMy+Qe.radius}else{var et=ve.polygon,tt=et.lverts.next,nt=et.gverts.next,it=tt;tt=tt.next,nt.x=et.body.posx+(et.body.axisy*it.x-et.body.axisx*it.y),nt.y=et.body.posy+(it.x*et.body.axisx+it.y*et.body.axisy),et.aabb.minx=nt.x,et.aabb.miny=nt.y,et.aabb.maxx=nt.x,et.aabb.maxy=nt.y;for(var rt=et.gverts.next.next;null!=rt;){var ot=rt,at=tt;tt=tt.next,ot.x=et.body.posx+(et.body.axisy*at.x-et.body.axisx*at.y),ot.y=et.body.posy+(at.x*et.body.axisx+at.y*et.body.axisy),ot.x<et.aabb.minx&&(et.aabb.minx=ot.x),ot.x>et.aabb.maxx&&(et.aabb.maxx=ot.x),ot.y<et.aabb.miny&&(et.aabb.miny=ot.y),ot.y>et.aabb.maxy&&(et.aabb.maxy=ot.y),rt=rt.next}}be<ge.minx?ge.minx=be:be=ge.minx,ze<ge.miny?ge.miny=ze:ze=ge.miny,we>ge.maxx?ge.maxx=we:we=ge.maxx,Ze>ge.maxy?ge.maxy=Ze:Ze=ge.maxy}this.bphase.sync(ve),ye=ye.next}if(se.sweepFrozen=!1,2==se.type&&se.bulletEnabled){var st=e.Config.bulletCCDLinearThreshold*se.sweepRadius,lt=e.Config.bulletCCDAngularThreshold;((se.velx*se.velx+se.vely*se.vely)*t*t>st*st||se.angvel*se.angvel*t*t>lt*lt)&&(se.bullet=!0)}}else se.sweepFrozen=!0,se.bullet=!1}ae=ae.next}},t.space.ZPP_Space.prototype.continuous=null,t.space.ZPP_Space.prototype.presteparb=function(n,i,r){if(null==r&&(r=!1),!n.cleared&&n.b1.component.sleeping&&n.b2.component.sleeping)return n.sleep_stamp=this.stamp,n.sleeping=!0,!0;if(!n.cleared||0!=n.present||n.intchange){var o=!r&&n.up_stamp==this.stamp-1&&!n.cleared&&!n.intchange,a=n.fresh&&!n.cleared&&!n.intchange;if(o&&(n.endGenerated=this.stamp),a||o||n.cleared||n.intchange){for(var s=n.ws1,l=n.ws2,p=this.mrca1;null!=p.head;){var u=p.head;p.head=u.next;var h=u;h.elt=null,h.next=t.util.ZNPNode_ZPP_Interactor.zpp_pool,t.util.ZNPNode_ZPP_Interactor.zpp_pool=h,null==p.head&&(p.pushmod=!0),p.modified=!0,p.length--}p.pushmod=!0;for(var c=this.mrca2;null!=c.head;){var _=c.head;c.head=_.next;var d=_;d.elt=null,d.next=t.util.ZNPNode_ZPP_Interactor.zpp_pool,t.util.ZNPNode_ZPP_Interactor.zpp_pool=d,null==c.head&&(c.pushmod=!0),c.modified=!0,c.length--}if(c.pushmod=!0,null!=s.cbSet){var m,P=this.mrca1;null==t.util.ZNPNode_ZPP_Interactor.zpp_pool?m=new t.util.ZNPNode_ZPP_Interactor:(m=t.util.ZNPNode_ZPP_Interactor.zpp_pool,t.util.ZNPNode_ZPP_Interactor.zpp_pool=m.next,m.next=null),m.elt=s;var f=m;f.next=P.head,P.head=f,P.modified=!0,P.length++}if(null!=s.body.cbSet){var x,y=this.mrca1,v=s.body;null==t.util.ZNPNode_ZPP_Interactor.zpp_pool?x=new t.util.ZNPNode_ZPP_Interactor:(x=t.util.ZNPNode_ZPP_Interactor.zpp_pool,t.util.ZNPNode_ZPP_Interactor.zpp_pool=x.next,x.next=null),x.elt=v;var g=x;g.next=y.head,y.head=g,y.modified=!0,y.length++}if(null!=l.cbSet){var b,z=this.mrca2;null==t.util.ZNPNode_ZPP_Interactor.zpp_pool?b=new t.util.ZNPNode_ZPP_Interactor:(b=t.util.ZNPNode_ZPP_Interactor.zpp_pool,t.util.ZNPNode_ZPP_Interactor.zpp_pool=b.next,b.next=null),b.elt=l;var w=b;w.next=z.head,z.head=w,z.modified=!0,z.length++}if(null!=l.body.cbSet){var Z,E=this.mrca2,M=l.body;null==t.util.ZNPNode_ZPP_Interactor.zpp_pool?Z=new t.util.ZNPNode_ZPP_Interactor:(Z=t.util.ZNPNode_ZPP_Interactor.zpp_pool,t.util.ZNPNode_ZPP_Interactor.zpp_pool=Z.next,Z.next=null),Z.elt=M;var S=Z;S.next=E.head,E.head=S,E.modified=!0,E.length++}for(var C=s.body.compound,N=l.body.compound;C!=N;)if((null==C?0:C.depth)<(null==N?0:N.depth)){if(null!=N.cbSet){var A,L=this.mrca2;null==t.util.ZNPNode_ZPP_Interactor.zpp_pool?A=new t.util.ZNPNode_ZPP_Interactor:(A=t.util.ZNPNode_ZPP_Interactor.zpp_pool,t.util.ZNPNode_ZPP_Interactor.zpp_pool=A.next,A.next=null),A.elt=N;var B=A;B.next=L.head,L.head=B,L.modified=!0,L.length++}N=N.compound}else{if(null!=C.cbSet){var T,V=this.mrca1;null==t.util.ZNPNode_ZPP_Interactor.zpp_pool?T=new t.util.ZNPNode_ZPP_Interactor:(T=t.util.ZNPNode_ZPP_Interactor.zpp_pool,t.util.ZNPNode_ZPP_Interactor.zpp_pool=T.next,T.next=null),T.elt=C;var k=T;k.next=V.head,V.head=k,V.modified=!0,V.length++}C=C.compound}for(var I=this.mrca1.head;null!=I;){for(var O=I.elt,R=this.mrca2.head;null!=R;){for(var H,F=R.elt,D=O.cbSet,G=F.cbSet,U=(D.manager,null),j=(D.cbpairs.length<G.cbpairs.length?D.cbpairs:G.cbpairs).head;null!=j;){var W=j.elt;if(W.a==D&&W.b==G||W.a==G&&W.b==D){U=W;break}j=j.next}if(null==U&&(null==t.callbacks.ZPP_CbSetPair.zpp_pool?H=new t.callbacks.ZPP_CbSetPair:(H=t.callbacks.ZPP_CbSetPair.zpp_pool,t.callbacks.ZPP_CbSetPair.zpp_pool=H.next,H.next=null),H.zip_listeners=!0,t.callbacks.ZPP_CbSet.setlt(D,G)?(H.a=D,H.b=G):(H.a=G,H.b=D),U=H,D.cbpairs.add(U),G!=D&&G.cbpairs.add(U)),U.zip_listeners&&(U.zip_listeners=!1,U.__validate()),null!=U.listeners.head){var q=t.phys.ZPP_Interactor.get(O,F);if(a||n.intchange){null==q&&(q=t.space.ZPP_CallbackSet.get(O,F),this.add_callbackset(q)),D.manager;for(var J,$=null,X=(D.cbpairs.length<G.cbpairs.length?D.cbpairs:G.cbpairs).head;null!=X;){var Y=X.elt;if(Y.a==D&&Y.b==G||Y.a==G&&Y.b==D){$=Y;break}X=X.next}null==$&&(null==t.callbacks.ZPP_CbSetPair.zpp_pool?J=new t.callbacks.ZPP_CbSetPair:(J=t.callbacks.ZPP_CbSetPair.zpp_pool,t.callbacks.ZPP_CbSetPair.zpp_pool=J.next,J.next=null),J.zip_listeners=!0,t.callbacks.ZPP_CbSet.setlt(D,G)?(J.a=D,J.b=G):(J.a=G,J.b=D),$=J,D.cbpairs.add($),G!=D&&G.cbpairs.add($)),$.zip_listeners&&($.zip_listeners=!1,$.__validate());for(var K,Q,ee=$.listeners.head;null!=ee;){var te=ee.elt;if(0==te.event&&0!=(te.itype&n.type)&&q.empty_arb(te.itype)){var ne=this.push_callback(te);ne.event=0;var ie,re=q.int1,oe=q.int2,ae=te.options1,se=re.cbTypes;if(ae.nonemptyintersection(se,ae.includes)&&!ae.nonemptyintersection(se,ae.excludes)){var le=te.options2,pe=oe.cbTypes;ie=le.nonemptyintersection(pe,le.includes)&&!le.nonemptyintersection(pe,le.excludes)}else ie=!1;ie?(ne.int1=re,ne.int2=oe):(ne.int1=oe,ne.int2=re),ne.set=q}ee=ee.next}Q=!1;for(var ue=q.arbiters.head;null!=ue;){if(ue.elt==n){Q=!0;break}ue=ue.next}if(Q)K=!1;else{var he,ce=q.arbiters;null==t.util.ZNPNode_ZPP_Arbiter.zpp_pool?he=new t.util.ZNPNode_ZPP_Arbiter:(he=t.util.ZNPNode_ZPP_Arbiter.zpp_pool,t.util.ZNPNode_ZPP_Arbiter.zpp_pool=he.next,he.next=null),he.elt=n;var _e=he;_e.next=ce.head,ce.head=_e,ce.modified=!0,ce.length++,K=!0}K&&n.present++}else{n.present--,q.remove_arb(n),D.manager;for(var de,me=null,Pe=(D.cbpairs.length<G.cbpairs.length?D.cbpairs:G.cbpairs).head;null!=Pe;){var fe=Pe.elt;if(fe.a==D&&fe.b==G||fe.a==G&&fe.b==D){me=fe;break}Pe=Pe.next}null==me&&(null==t.callbacks.ZPP_CbSetPair.zpp_pool?de=new t.callbacks.ZPP_CbSetPair:(de=t.callbacks.ZPP_CbSetPair.zpp_pool,t.callbacks.ZPP_CbSetPair.zpp_pool=de.next,de.next=null),de.zip_listeners=!0,t.callbacks.ZPP_CbSet.setlt(D,G)?(de.a=D,de.b=G):(de.a=G,de.b=D),me=de,D.cbpairs.add(me),G!=D&&G.cbpairs.add(me)),me.zip_listeners&&(me.zip_listeners=!1,me.__validate());for(var xe=me.listeners.head;null!=xe;){var ye=xe.elt;if(1==ye.event&&0!=(ye.itype&n.type)&&q.empty_arb(ye.itype)){var ve=this.push_callback(ye);ve.event=1;var ge,be=q.int1,ze=q.int2,we=ye.options1,Ze=be.cbTypes;if(we.nonemptyintersection(Ze,we.includes)&&!we.nonemptyintersection(Ze,we.excludes)){var Ee=ye.options2,Me=ze.cbTypes;ge=Ee.nonemptyintersection(Me,Ee.includes)&&!Ee.nonemptyintersection(Me,Ee.excludes)}else ge=!1;ge?(ve.int1=be,ve.int2=ze):(ve.int1=ze,ve.int2=be),ve.set=q}xe=xe.next}null==q.arbiters.head&&this.remove_callbackset(q)}R=R.next}else R=R.next}I=I.next}}n.fresh=!1,n.intchange=!1}if(n.cleared||n.up_stamp+(n.type==t.dynamics.ZPP_Arbiter.COL?e.Config.arbiterExpirationDelay:0)<this.stamp){if(n.type==t.dynamics.ZPP_Arbiter.SENSOR){var Se=n.sensorarb;if(!Se.cleared){for(var Ce=Se.b1.arbiters,Ne=null,Ae=Ce.head;null!=Ae;){if(Ae.elt==Se){var Le,Be;null==Ne?(Be=(Le=Ce.head).next,Ce.head=Be,null==Ce.head&&(Ce.pushmod=!0)):(Be=(Le=Ne.next).next,Ne.next=Be,null==Be&&(Ce.pushmod=!0));var Te=Le;Te.elt=null,Te.next=t.util.ZNPNode_ZPP_Arbiter.zpp_pool,t.util.ZNPNode_ZPP_Arbiter.zpp_pool=Te,Ce.modified=!0,Ce.length--,Ce.pushmod=!0;break}Ne=Ae,Ae=Ae.next}for(var Ve=Se.b2.arbiters,ke=null,Ie=Ve.head;null!=Ie;){if(Ie.elt==Se){var Oe,Re;null==ke?(Re=(Oe=Ve.head).next,Ve.head=Re,null==Ve.head&&(Ve.pushmod=!0)):(Re=(Oe=ke.next).next,ke.next=Re,null==Re&&(Ve.pushmod=!0));var He=Oe;He.elt=null,He.next=t.util.ZNPNode_ZPP_Arbiter.zpp_pool,t.util.ZNPNode_ZPP_Arbiter.zpp_pool=He,Ve.modified=!0,Ve.length--,Ve.pushmod=!0;break}ke=Ie,Ie=Ie.next}null!=Se.pair&&(Se.pair.arb=null,Se.pair=null)}Se.b1=Se.b2=null,Se.active=!1,Se.intchange=!1;var Fe=Se;Fe.next=t.dynamics.ZPP_SensorArbiter.zpp_pool,t.dynamics.ZPP_SensorArbiter.zpp_pool=Fe}else if(n.type==t.dynamics.ZPP_Arbiter.FLUID){var De=n.fluidarb;if(!De.cleared){for(var Ge=De.b1.arbiters,Ue=null,je=Ge.head;null!=je;){if(je.elt==De){var We,qe;null==Ue?(qe=(We=Ge.head).next,Ge.head=qe,null==Ge.head&&(Ge.pushmod=!0)):(qe=(We=Ue.next).next,Ue.next=qe,null==qe&&(Ge.pushmod=!0));var Je=We;Je.elt=null,Je.next=t.util.ZNPNode_ZPP_Arbiter.zpp_pool,t.util.ZNPNode_ZPP_Arbiter.zpp_pool=Je,Ge.modified=!0,Ge.length--,Ge.pushmod=!0;break}Ue=je,je=je.next}for(var $e=De.b2.arbiters,Xe=null,Ye=$e.head;null!=Ye;){if(Ye.elt==De){var Ke,Qe;null==Xe?(Qe=(Ke=$e.head).next,$e.head=Qe,null==$e.head&&($e.pushmod=!0)):(Qe=(Ke=Xe.next).next,Xe.next=Qe,null==Qe&&($e.pushmod=!0));var et=Ke;et.elt=null,et.next=t.util.ZNPNode_ZPP_Arbiter.zpp_pool,t.util.ZNPNode_ZPP_Arbiter.zpp_pool=et,$e.modified=!0,$e.length--,$e.pushmod=!0;break}Xe=Ye,Ye=Ye.next}null!=De.pair&&(De.pair.arb=null,De.pair=null)}De.b1=De.b2=null,De.active=!1,De.intchange=!1;var tt=De;tt.next=t.dynamics.ZPP_FluidArbiter.zpp_pool,t.dynamics.ZPP_FluidArbiter.zpp_pool=tt,De.pre_dt=-1}else{var nt=n.colarb;if(!nt.cleared){for(var it=nt.b1.arbiters,rt=null,ot=it.head;null!=ot;){if(ot.elt==nt){var at,st;null==rt?(st=(at=it.head).next,it.head=st,null==it.head&&(it.pushmod=!0)):(st=(at=rt.next).next,rt.next=st,null==st&&(it.pushmod=!0));var lt=at;lt.elt=null,lt.next=t.util.ZNPNode_ZPP_Arbiter.zpp_pool,t.util.ZNPNode_ZPP_Arbiter.zpp_pool=lt,it.modified=!0,it.length--,it.pushmod=!0;break}rt=ot,ot=ot.next}for(var pt=nt.b2.arbiters,ut=null,ht=pt.head;null!=ht;){if(ht.elt==nt){var ct,_t;null==ut?(_t=(ct=pt.head).next,pt.head=_t,null==pt.head&&(pt.pushmod=!0)):(_t=(ct=ut.next).next,ut.next=_t,null==_t&&(pt.pushmod=!0));var dt=ct;dt.elt=null,dt.next=t.util.ZNPNode_ZPP_Arbiter.zpp_pool,t.util.ZNPNode_ZPP_Arbiter.zpp_pool=dt,pt.modified=!0,pt.length--,pt.pushmod=!0;break}ut=ht,ht=ht.next}null!=nt.pair&&(nt.pair.arb=null,nt.pair=null)}for(nt.b1=nt.b2=null,nt.active=!1,nt.intchange=!1;null!=nt.contacts.next;){var mt=nt.contacts,Pt=mt.next;mt.pop();var ft=Pt;ft.arbiter=null,ft.next=t.dynamics.ZPP_Contact.zpp_pool,t.dynamics.ZPP_Contact.zpp_pool=ft;var xt=nt.innards,yt=xt.next;xt.next=yt.next,yt._inuse=!1,null==xt.next&&(xt.pushmod=!0),xt.modified=!0,xt.length--}var vt=nt;vt.userdef_dyn_fric=!1,vt.userdef_stat_fric=!1,vt.userdef_restitution=!1,vt.userdef_rfric=!1,vt.__ref_edge1=vt.__ref_edge2=null,vt.next=t.dynamics.ZPP_ColArbiter.zpp_pool,t.dynamics.ZPP_ColArbiter.zpp_pool=vt,nt.pre_dt=-1}return!0}var gt=n.active;if(n.active=n.presentable=n.up_stamp==this.stamp,0!=(1&n.immState)){if(n.active&&n.type!=t.dynamics.ZPP_Arbiter.SENSOR)if(null!=n.colarb){var bt=n.colarb;bt.invalidated&&(bt.invalidated=!1,bt.userdef_restitution||(bt.s1.material.elasticity<=-1/0||bt.s2.material.elasticity<=-1/0?bt.restitution=0:bt.s1.material.elasticity>=1/0||bt.s2.material.elasticity>=1/0?bt.restitution=1:bt.restitution=(bt.s1.material.elasticity+bt.s2.material.elasticity)/2,bt.restitution<0&&(bt.restitution=0),bt.restitution>1&&(bt.restitution=1)),bt.userdef_dyn_fric||(bt.dyn_fric=Math.sqrt(bt.s1.material.dynamicFriction*bt.s2.material.dynamicFriction)),bt.userdef_stat_fric||(bt.stat_fric=Math.sqrt(bt.s1.material.staticFriction*bt.s2.material.staticFriction)),bt.userdef_rfric||(bt.rfric=Math.sqrt(bt.s1.material.rollingFriction*bt.s2.material.rollingFriction))),-1==bt.pre_dt&&(bt.pre_dt=i);var zt=i/bt.pre_dt;bt.pre_dt=i;var wt=bt.b1.smass+bt.b2.smass;bt.hc2=!1;var Zt=!0,Et=2!=bt.b1.type||2!=bt.b2.type?bt.continuous?e.Config.contactContinuousStaticBiasCoef:e.Config.contactStaticBiasCoef:bt.continuous?e.Config.contactContinuousBiasCoef:e.Config.contactBiasCoef;bt.biasCoef=Et,bt.continuous=!1;for(var Mt=null,St=null,Ct=bt.innards.next,Nt=bt.contacts.next;null!=Nt;){var At=Nt;if(At.stamp+e.Config.arbiterExpirationDelay<bt.stamp){var Lt,Bt,Tt=bt.contacts;null==Mt?(Bt=(Lt=Tt.next).next,Tt.next=Bt,null==Tt.next&&(Tt.pushmod=!0)):(Bt=(Lt=Mt.next).next,Mt.next=Bt,null==Bt&&(Tt.pushmod=!0)),Lt._inuse=!1,Tt.modified=!0,Tt.length--,Tt.pushmod=!0,Nt=Bt;var Vt,kt,It=bt.innards;null==St?(kt=(Vt=It.next).next,It.next=kt,null==It.next&&(It.pushmod=!0)):(kt=(Vt=St.next).next,St.next=kt,null==kt&&(It.pushmod=!0)),Vt._inuse=!1,It.modified=!0,It.length--,It.pushmod=!0,Ct=kt;var Ot=At;Ot.arbiter=null,Ot.next=t.dynamics.ZPP_Contact.zpp_pool,t.dynamics.ZPP_Contact.zpp_pool=Ot}else{var Rt=At.inner,Ht=At.active;if(At.active=At.stamp==bt.stamp,At.active){Zt?(Zt=!1,bt.c1=Rt,bt.oc1=At):(bt.hc2=!0,bt.c2=Rt,bt.oc2=At),Rt.r2x=At.px-bt.b2.posx,Rt.r2y=At.py-bt.b2.posy,Rt.r1x=At.px-bt.b1.posx,Rt.r1y=At.py-bt.b1.posy;var Ft=Rt.r2x*bt.nx+Rt.r2y*bt.ny,Dt=wt+bt.b2.sinertia*(Ft*Ft),Gt=Rt.r1x*bt.nx+Rt.r1y*bt.ny;Dt+=bt.b1.sinertia*(Gt*Gt),Rt.tMass=Dt<e.Config.epsilon*e.Config.epsilon?0:1/Dt;var Ut=bt.ny*Rt.r2x-bt.nx*Rt.r2y,jt=wt+bt.b2.sinertia*(Ut*Ut),Wt=bt.ny*Rt.r1x-bt.nx*Rt.r1y;jt+=bt.b1.sinertia*(Wt*Wt),Rt.nMass=jt<e.Config.epsilon*e.Config.epsilon?0:1/jt;var qt=0,Jt=0,$t=bt.b2.angvel+bt.b2.kinangvel;qt=bt.b2.velx+bt.b2.kinvelx-Rt.r2y*$t,Jt=bt.b2.vely+bt.b2.kinvely+Rt.r2x*$t,$t=bt.b1.angvel+bt.b1.kinangvel,qt-=bt.b1.velx+bt.b1.kinvelx-Rt.r1y*$t,Jt-=bt.b1.vely+bt.b1.kinvely+Rt.r1x*$t;var Xt=bt.nx*qt+bt.ny*Jt;At.elasticity=bt.restitution,Rt.bounce=Xt*At.elasticity,Rt.bounce>-e.Config.elasticThreshold&&(Rt.bounce=0),Xt=Jt*bt.nx-qt*bt.ny;var Yt=e.Config.staticFrictionThreshold;Rt.friction=Xt*Xt>Yt*Yt?bt.dyn_fric:bt.stat_fric,Rt.jnAcc*=zt,Rt.jtAcc*=zt}Ht!=At.active&&(bt.contacts.modified=!0),Mt=Nt,St=Ct,Ct=Ct.next,Nt=Nt.next}}if(bt.hc2){if(bt.hpc2=!0,bt.oc1.posOnly){var Kt=bt.c1;bt.c1=bt.c2,bt.c2=Kt;var Qt=bt.oc1;bt.oc1=bt.oc2,bt.oc2=Qt,bt.hc2=!1}else bt.oc2.posOnly&&(bt.hc2=!1);bt.oc1.posOnly&&(Zt=!0)}else bt.hpc2=!1;if(bt.jrAcc*=zt,Zt||(bt.rn1a=bt.ny*bt.c1.r1x-bt.nx*bt.c1.r1y,bt.rt1a=bt.c1.r1x*bt.nx+bt.c1.r1y*bt.ny,bt.rn1b=bt.ny*bt.c1.r2x-bt.nx*bt.c1.r2y,bt.rt1b=bt.c1.r2x*bt.nx+bt.c1.r2y*bt.ny,bt.k1x=bt.b2.kinvelx-bt.c1.r2y*bt.b2.kinangvel-(bt.b1.kinvelx-bt.c1.r1y*bt.b1.kinangvel),bt.k1y=bt.b2.kinvely+bt.c1.r2x*bt.b2.kinangvel-(bt.b1.kinvely+bt.c1.r1x*bt.b1.kinangvel)),bt.hc2)if(bt.rn2a=bt.ny*bt.c2.r1x-bt.nx*bt.c2.r1y,bt.rt2a=bt.c2.r1x*bt.nx+bt.c2.r1y*bt.ny,bt.rn2b=bt.ny*bt.c2.r2x-bt.nx*bt.c2.r2y,bt.rt2b=bt.c2.r2x*bt.nx+bt.c2.r2y*bt.ny,bt.k2x=bt.b2.kinvelx-bt.c2.r2y*bt.b2.kinangvel-(bt.b1.kinvelx-bt.c2.r1y*bt.b1.kinangvel),bt.k2y=bt.b2.kinvely+bt.c2.r2x*bt.b2.kinangvel-(bt.b1.kinvely+bt.c2.r1x*bt.b1.kinangvel),bt.kMassa=wt+bt.b1.sinertia*bt.rn1a*bt.rn1a+bt.b2.sinertia*bt.rn1b*bt.rn1b,bt.kMassb=wt+bt.b1.sinertia*bt.rn1a*bt.rn2a+bt.b2.sinertia*bt.rn1b*bt.rn2b,bt.kMassc=wt+bt.b1.sinertia*bt.rn2a*bt.rn2a+bt.b2.sinertia*bt.rn2b*bt.rn2b,bt.kMassa*bt.kMassa+2*bt.kMassb*bt.kMassb+bt.kMassc*bt.kMassc<e.Config.illConditionedThreshold*(bt.kMassa*bt.kMassc-bt.kMassb*bt.kMassb)){bt.Ka=bt.kMassa,bt.Kb=bt.kMassb,bt.Kc=bt.kMassc;var en=bt.kMassa*bt.kMassc-bt.kMassb*bt.kMassb;if(en!=en)bt.kMassa=bt.kMassb=bt.kMassc=0;else if(0==en)0!=bt.kMassa?bt.kMassa=1/bt.kMassa:bt.kMassa=0,0!=bt.kMassc?bt.kMassc=1/bt.kMassc:bt.kMassc=0,bt.kMassb=0;else{en=1/en;var tn=bt.kMassc*en;bt.kMassc=bt.kMassa*en,bt.kMassa=tn,bt.kMassb*=-en}}else{if(bt.hc2=!1,bt.oc2.dist<bt.oc1.dist){var nn=bt.c1;bt.c1=bt.c2,bt.c2=nn}bt.oc2.active=!1,bt.contacts.modified=!0}bt.surfacex=bt.b2.svelx,bt.surfacey=bt.b2.svely,bt.surfacex+=1*bt.b1.svelx,bt.surfacey+=1*bt.b1.svely,bt.surfacex=-bt.surfacex,bt.surfacey=-bt.surfacey,bt.rMass=bt.b1.sinertia+bt.b2.sinertia,0!=bt.rMass&&(bt.rMass=1/bt.rMass),Zt&&(n.active=!1)}else{var rn=n.fluidarb;-1==rn.pre_dt&&(rn.pre_dt=i);var on=i/rn.pre_dt;rn.pre_dt=i,rn.r1x=rn.centroidx-rn.b1.posx,rn.r1y=rn.centroidy-rn.b1.posy,rn.r2x=rn.centroidx-rn.b2.posx,rn.r2y=rn.centroidy-rn.b2.posy;var an=0,sn=0;rn.ws1.fluidEnabled&&null!=rn.ws1.fluidProperties.wrap_gravity?(an=rn.ws1.fluidProperties.gravityx,sn=rn.ws1.fluidProperties.gravityy):(an=this.gravityx,sn=this.gravityy);var ln=0,pn=0;rn.ws2.fluidEnabled&&null!=rn.ws2.fluidProperties.wrap_gravity?(ln=rn.ws2.fluidProperties.gravityx,pn=rn.ws2.fluidProperties.gravityy):(ln=this.gravityx,pn=this.gravityy);var un=0,hn=0;if(rn.ws1.fluidEnabled&&rn.ws2.fluidEnabled){var cn=rn.overlap*rn.ws1.fluidProperties.density,_n=rn.overlap*rn.ws2.fluidProperties.density;if(cn>_n){var dn=cn+_n;un-=an*dn,hn-=sn*dn}else if(cn<_n){var mn=cn+_n;un+=ln*mn,hn+=pn*mn}else{var Pn=0,fn=0;if(Pn=an+ln,fn=sn+pn,Pn*=.5,fn*=.5,rn.ws1.worldCOMx*Pn+rn.ws1.worldCOMy*fn>rn.ws2.worldCOMx*Pn+rn.ws2.worldCOMy*fn){var xn=cn+_n;un-=Pn*xn,hn-=fn*xn}else{var yn=cn+_n;un+=Pn*yn,hn+=fn*yn}}}else if(rn.ws1.fluidEnabled){var vn=rn.overlap*rn.ws1.fluidProperties.density;un-=an*vn,hn-=sn*vn}else if(rn.ws2.fluidEnabled){var gn=rn.overlap*rn.ws2.fluidProperties.density;un+=ln*gn,hn+=pn*gn}if(un*=i,hn*=i,rn.buoyx=un,rn.buoyy=hn,2==rn.b1.type){var bn=rn.b1.imass;rn.b1.velx-=un*bn,rn.b1.vely-=hn*bn,rn.b1.angvel-=(hn*rn.r1x-un*rn.r1y)*rn.b1.iinertia}if(2==rn.b2.type){var zn=rn.b2.imass;rn.b2.velx+=un*zn,rn.b2.vely+=hn*zn,rn.b2.angvel+=(hn*rn.r2x-un*rn.r2y)*rn.b2.iinertia}if(rn.ws1.fluidEnabled&&0!=rn.ws1.fluidProperties.viscosity||rn.ws2.fluidEnabled&&0!=rn.ws2.fluidProperties.viscosity){rn.nodrag=!1;var wn=0;if(rn.ws1.fluidEnabled&&(rn.ws2.validate_angDrag(),wn+=rn.ws1.fluidProperties.viscosity*rn.ws2.angDrag*rn.overlap/rn.ws2.area),rn.ws2.fluidEnabled&&(rn.ws1.validate_angDrag(),wn+=rn.ws2.fluidProperties.viscosity*rn.ws1.angDrag*rn.overlap/rn.ws1.area),0!=wn){var Zn=rn.b1.sinertia+rn.b2.sinertia;rn.wMass=0!=Zn?1/Zn:0,wn*=4e-4;var En=2*Math.PI*wn;rn.agamma=1/(i*En*(2+En*i));var Mn=1/(1+rn.agamma);rn.agamma,rn.agamma*=Mn,rn.wMass*=Mn}else rn.wMass=0,rn.agamma=0;var Sn=rn.b2.velx+rn.b2.kinvelx-rn.r2y*(rn.b2.angvel+rn.b2.kinangvel)-(rn.b1.velx+rn.b1.kinvelx-rn.r1y*(rn.b2.angvel+rn.b2.kinangvel)),Cn=rn.b2.vely+rn.b2.kinvely+rn.r2x*(rn.b2.angvel+rn.b2.kinangvel)-(rn.b1.vely+rn.b1.kinvely+rn.r1x*(rn.b1.angvel+rn.b1.kinangvel));if(!(Sn*Sn+Cn*Cn<e.Config.epsilon*e.Config.epsilon)){var Nn=Sn*Sn+Cn*Cn,An=1/Math.sqrt(Nn);Sn*=An,Cn*=An,rn.nx=Sn,rn.ny=Cn}var Ln=0;if(rn.ws1.fluidEnabled){var Bn=-rn.ws1.fluidProperties.viscosity*rn.overlap/rn.ws2.area;if(0==rn.ws2.type)Ln-=Bn*rn.ws2.circle.radius*e.Config.fluidLinearDrag/(2*rn.ws2.circle.radius*Math.PI);else{for(var Tn=0,Vn=0,kn=rn.ws2.polygon.edges.head;null!=kn;){var In=kn.elt;Tn+=In.length;var On=Bn*In.length*(In.gnormx*rn.nx+In.gnormy*rn.ny);On>0&&(On=On*=-e.Config.fluidVacuumDrag),Vn-=.5*On*e.Config.fluidLinearDrag,kn=kn.next}Ln+=Vn/Tn}}if(rn.ws2.fluidEnabled){var Rn=-rn.ws2.fluidProperties.viscosity*rn.overlap/rn.ws1.area;if(0==rn.ws1.type)Ln-=Rn*rn.ws1.circle.radius*e.Config.fluidLinearDrag/(2*rn.ws1.circle.radius*Math.PI);else{for(var Hn=0,Fn=0,Dn=rn.ws1.polygon.edges.head;null!=Dn;){var Gn=Dn.elt;Hn+=Gn.length;var Un=Rn*Gn.length*(Gn.gnormx*rn.nx+Gn.gnormy*rn.ny);Un>0&&(Un=Un*=-e.Config.fluidVacuumDrag),Fn-=.5*Un*e.Config.fluidLinearDrag,Dn=Dn.next}Ln+=Fn/Hn}}if(0!=Ln){var jn=rn.b1.smass+rn.b2.smass,Wn=0,qn=0,Jn=0;if(Wn=jn,qn=0,Jn=jn,0!=rn.b1.sinertia){var $n=rn.r1x*rn.b1.sinertia,Xn=rn.r1y*rn.b1.sinertia;Wn+=Xn*rn.r1y,qn+=-Xn*rn.r1x,Jn+=$n*rn.r1x}if(0!=rn.b2.sinertia){var Yn=rn.r2x*rn.b2.sinertia,Kn=rn.r2y*rn.b2.sinertia;Wn+=Kn*rn.r2y,qn+=-Kn*rn.r2x,Jn+=Yn*rn.r2x}var Qn=Wn*Jn-qn*qn;if(Qn!=Qn)Wn=qn=Jn=0;else if(0==Qn)0!=Wn?Wn=1/Wn:Wn=0,0!=Jn?Jn=1/Jn:Jn=0,qn=0;else{var ei=Jn*(Qn=1/Qn);Jn=Wn*Qn,Wn=ei,qn*=-Qn}rn.vMassa=Wn,rn.vMassb=qn,rn.vMassc=Jn;var ti=2*Math.PI*Ln;rn.lgamma=1/(i*ti*(2+ti*i));var ni=1/(1+rn.lgamma);rn.lgamma,rn.lgamma*=ni;var ii=ni;rn.vMassa*=ii,rn.vMassb*=ii,rn.vMassc*=ii}else rn.vMassa=0,rn.vMassb=0,rn.vMassc=0,rn.lgamma=0}else rn.nodrag=!0,rn.dampx=0,rn.dampy=0,rn.adamp=0;var ri=on;rn.dampx*=ri,rn.dampy*=ri,rn.adamp*=on}}else if(null!=n.colarb){var oi=n.colarb,ai=!0,si=null,li=null,pi=oi.innards.next;oi.hc2=!1;for(var ui=oi.contacts.next;null!=ui;){var hi=ui;if(hi.stamp+e.Config.arbiterExpirationDelay<oi.stamp){var ci,_i,di=oi.contacts;null==si?(_i=(ci=di.next).next,di.next=_i,null==di.next&&(di.pushmod=!0)):(_i=(ci=si.next).next,si.next=_i,null==_i&&(di.pushmod=!0)),ci._inuse=!1,di.modified=!0,di.length--,di.pushmod=!0,ui=_i;var mi,Pi,fi=oi.innards;null==li?(Pi=(mi=fi.next).next,fi.next=Pi,null==fi.next&&(fi.pushmod=!0)):(Pi=(mi=li.next).next,li.next=Pi,null==Pi&&(fi.pushmod=!0)),mi._inuse=!1,fi.modified=!0,fi.length--,fi.pushmod=!0,pi=Pi;var xi=hi;xi.arbiter=null,xi.next=t.dynamics.ZPP_Contact.zpp_pool,t.dynamics.ZPP_Contact.zpp_pool=xi}else{var yi=hi.inner,vi=hi.active;hi.active=hi.stamp==oi.stamp,hi.active&&(ai?(ai=!1,oi.c1=yi,oi.oc1=hi):(oi.hc2=!0,oi.c2=yi,oi.oc2=hi)),vi!=hi.active&&(oi.contacts.modified=!0),si=ui,li=pi,pi=pi.next,ui=ui.next}}if(oi.hc2){if(oi.hpc2=!0,oi.oc1.posOnly){var gi=oi.c1;oi.c1=oi.c2,oi.c2=gi;var bi=oi.oc1;oi.oc1=oi.oc2,oi.oc2=bi,oi.hc2=!1}else oi.oc2.posOnly&&(oi.hc2=!1);oi.oc1.posOnly&&(ai=!0)}else oi.hpc2=!1;ai&&(n.active=!1)}return gt!=n.active&&(n.b1.arbiters.modified=!0,n.b2.arbiters.modified=!0,this.c_arbiters_true.modified=this.c_arbiters_false.modified=!0,this.s_arbiters.modified=this.f_arbiters.modified=!0),!1},t.space.ZPP_Space.prototype.prestep=function(e){for(var n=null,i=this.live_constraints.head;null!=i;){var r=i.elt;r.preStep(e)?(i=this.live_constraints.erase(n),r.broken(),this.constraintCbBreak(r),r.removeOnBreak?(r.component.sleeping=!0,this.midstep=!1,null!=r.compound?r.compound.wrap_constraints.remove(r.outer):this.wrap_constraints.remove(r.outer),this.midstep=!0):r.active=!1,r.clearcache()):(n=i,i=i.next)}var o=null,a=this.c_arbiters_true,s=a.head,l=null!=this.c_arbiters_false;for(l&&null==s&&(l=!1,s=this.c_arbiters_false.head,a=this.c_arbiters_false,o=null);null!=s;){var p=s.elt;if(this.presteparb(p,e)){var u,h;null==o?(h=(u=a.head).next,a.head=h,null==a.head&&(a.pushmod=!0)):(h=(u=o.next).next,o.next=h,null==h&&(a.pushmod=!0));var c=u;c.elt=null,c.next=t.util.ZNPNode_ZPP_ColArbiter.zpp_pool,t.util.ZNPNode_ZPP_ColArbiter.zpp_pool=c,a.modified=!0,a.length--,a.pushmod=!0,s=h,l&&null==s&&(l=!1,s=this.c_arbiters_false.head,a=this.c_arbiters_false,o=null)}else o=s,s=s.next,l&&null==s&&(l=!1,s=this.c_arbiters_false.head,a=this.c_arbiters_false,o=null)}for(var _=null,d=this.f_arbiters,m=d.head;null!=m;){var P=m.elt;if(this.presteparb(P,e)){var f,x;null==_?(x=(f=d.head).next,d.head=x,null==d.head&&(d.pushmod=!0)):(x=(f=_.next).next,_.next=x,null==x&&(d.pushmod=!0));var y=f;y.elt=null,y.next=t.util.ZNPNode_ZPP_FluidArbiter.zpp_pool,t.util.ZNPNode_ZPP_FluidArbiter.zpp_pool=y,d.modified=!0,d.length--,d.pushmod=!0,m=x}else _=m,m=m.next}for(var v=null,g=this.s_arbiters,b=g.head;null!=b;){var z=b.elt;if(this.presteparb(z,e)){var w,Z;null==v?(Z=(w=g.head).next,g.head=Z,null==g.head&&(g.pushmod=!0)):(Z=(w=v.next).next,v.next=Z,null==Z&&(g.pushmod=!0));var E=w;E.elt=null,E.next=t.util.ZNPNode_ZPP_SensorArbiter.zpp_pool,t.util.ZNPNode_ZPP_SensorArbiter.zpp_pool=E,g.modified=!0,g.length--,g.pushmod=!0,b=Z}else v=b,b=b.next}},t.space.ZPP_Space.prototype.warmStart=function(){for(var e=this.f_arbiters.head;null!=e;){var t=e.elt;if(t.active&&0!=(1&t.immState)){var n=t.b1.imass;t.b1.velx-=t.dampx*n,t.b1.vely-=t.dampy*n;var i=t.b2.imass;t.b2.velx+=t.dampx*i,t.b2.vely+=t.dampy*i,t.b1.angvel-=t.b1.iinertia*(t.dampy*t.r1x-t.dampx*t.r1y),t.b2.angvel+=t.b2.iinertia*(t.dampy*t.r2x-t.dampx*t.r2y),t.b1.angvel-=t.adamp*t.b1.iinertia,t.b2.angvel+=t.adamp*t.b2.iinertia}e=e.next}var r=this.c_arbiters_false.head,o=!0;for(null==r&&(r=this.c_arbiters_true.head,o=!1);null!=r;){var a=r.elt;if(a.active&&0!=(1&a.immState)){var s=a.nx*a.c1.jnAcc-a.ny*a.c1.jtAcc,l=a.ny*a.c1.jnAcc+a.nx*a.c1.jtAcc,p=a.b1.imass;a.b1.velx-=s*p,a.b1.vely-=l*p,a.b1.angvel-=a.b1.iinertia*(l*a.c1.r1x-s*a.c1.r1y);var u=a.b2.imass;if(a.b2.velx+=s*u,a.b2.vely+=l*u,a.b2.angvel+=a.b2.iinertia*(l*a.c1.r2x-s*a.c1.r2y),a.hc2){var h=a.nx*a.c2.jnAcc-a.ny*a.c2.jtAcc,c=a.ny*a.c2.jnAcc+a.nx*a.c2.jtAcc,_=a.b1.imass;a.b1.velx-=h*_,a.b1.vely-=c*_,a.b1.angvel-=a.b1.iinertia*(c*a.c2.r1x-h*a.c2.r1y);var d=a.b2.imass;a.b2.velx+=h*d,a.b2.vely+=c*d,a.b2.angvel+=a.b2.iinertia*(c*a.c2.r2x-h*a.c2.r2y)}a.b2.angvel+=a.jrAcc*a.b2.iinertia,a.b1.angvel-=a.jrAcc*a.b1.iinertia}r=r.next,o&&null==r&&(r=this.c_arbiters_true.head,o=!1)}for(var m=this.live_constraints.head;null!=m;)m.elt.warmStart(),m=m.next},t.space.ZPP_Space.prototype.iterateVel=function(e){for(var t=0,n=e;t<n;){t++;for(var i=this.f_arbiters.head;null!=i;){var r=i.elt;if(r.active&&0!=(1&r.immState)&&!r.nodrag){var o=r.b1.angvel+r.b1.kinangvel,a=r.b2.angvel+r.b2.kinangvel,s=r.b1.velx+r.b1.kinvelx-r.r1y*o-(r.b2.velx+r.b2.kinvelx-r.r2y*a),l=r.b1.vely+r.b1.kinvely+r.r1x*o-(r.b2.vely+r.b2.kinvely+r.r2x*a),p=r.vMassa*s+r.vMassb*l;l=r.vMassb*s+r.vMassc*l,s=p;var u=r.lgamma;s-=r.dampx*u,l-=r.dampy*u,r.dampx+=1*s,r.dampy+=1*l;var h=r.b1.imass;r.b1.velx-=s*h,r.b1.vely-=l*h;var c=r.b2.imass;r.b2.velx+=s*c,r.b2.vely+=l*c,r.b1.angvel-=r.b1.iinertia*(l*r.r1x-s*r.r1y),r.b2.angvel+=r.b2.iinertia*(l*r.r2x-s*r.r2y);var _=(o-a)*r.wMass-r.adamp*r.agamma;r.adamp+=_,r.b1.angvel-=_*r.b1.iinertia,r.b2.angvel+=_*r.b2.iinertia}i=i.next}for(var d=null,m=this.live_constraints.head;null!=m;){var P=m.elt;P.applyImpulseVel()?(m=this.live_constraints.erase(d),P.broken(),this.constraintCbBreak(P),P.removeOnBreak?(P.component.sleeping=!0,this.midstep=!1,null!=P.compound?P.compound.wrap_constraints.remove(P.outer):this.wrap_constraints.remove(P.outer),this.midstep=!0):P.active=!1,P.clearcache()):(d=m,m=m.next)}var f=this.c_arbiters_false.head,x=!0;for(null==f&&(f=this.c_arbiters_true.head,x=!1);null!=f;){var y=f.elt;if(y.active&&0!=(1&y.immState)){var v=y.k1x+y.b2.velx-y.c1.r2y*y.b2.angvel-(y.b1.velx-y.c1.r1y*y.b1.angvel),g=y.k1y+y.b2.vely+y.c1.r2x*y.b2.angvel-(y.b1.vely+y.c1.r1x*y.b1.angvel),b=(g*y.nx-v*y.ny+y.surfacex)*y.c1.tMass,z=y.c1.friction*y.c1.jnAcc,w=y.c1.jtAcc,Z=w-b;Z>z?Z=z:Z<-z&&(Z=-z),b=Z-w,y.c1.jtAcc=Z;var E=-y.ny*b,M=y.nx*b;if(y.b2.velx+=E*y.b2.imass,y.b2.vely+=M*y.b2.imass,y.b1.velx-=E*y.b1.imass,y.b1.vely-=M*y.b1.imass,y.b2.angvel+=y.rt1b*b*y.b2.iinertia,y.b1.angvel-=y.rt1a*b*y.b1.iinertia,y.hc2){var S=y.k2x+y.b2.velx-y.c2.r2y*y.b2.angvel-(y.b1.velx-y.c2.r1y*y.b1.angvel),C=y.k2y+y.b2.vely+y.c2.r2x*y.b2.angvel-(y.b1.vely+y.c2.r1x*y.b1.angvel);b=(C*y.nx-S*y.ny+y.surfacex)*y.c2.tMass,z=y.c2.friction*y.c2.jnAcc,(Z=(w=y.c2.jtAcc)-b)>z?Z=z:Z<-z&&(Z=-z),b=Z-w,y.c2.jtAcc=Z,E=-y.ny*b,M=y.nx*b,y.b2.velx+=E*y.b2.imass,y.b2.vely+=M*y.b2.imass,y.b1.velx-=E*y.b1.imass,y.b1.vely-=M*y.b1.imass,y.b2.angvel+=y.rt2b*b*y.b2.iinertia,y.b1.angvel-=y.rt2a*b*y.b1.iinertia,v=y.k1x+y.b2.velx-y.c1.r2y*y.b2.angvel-(y.b1.velx-y.c1.r1y*y.b1.angvel),g=y.k1y+y.b2.vely+y.c1.r2x*y.b2.angvel-(y.b1.vely+y.c1.r1x*y.b1.angvel),S=y.k2x+y.b2.velx-y.c2.r2y*y.b2.angvel-(y.b1.velx-y.c2.r1y*y.b1.angvel),C=y.k2y+y.b2.vely+y.c2.r2x*y.b2.angvel-(y.b1.vely+y.c2.r1x*y.b1.angvel);var N=y.c1.jnAcc,A=y.c2.jnAcc,L=v*y.nx+g*y.ny+y.surfacey+y.c1.bounce-(y.Ka*N+y.Kb*A),B=S*y.nx+C*y.ny+y.surfacey+y.c2.bounce-(y.Kb*N+y.Kc*A),T=-(y.kMassa*L+y.kMassb*B),V=-(y.kMassb*L+y.kMassc*B);T>=0&&V>=0?(L=T-N,B=V-A,y.c1.jnAcc=T,y.c2.jnAcc=V):(T=-y.c1.nMass*L)>=0&&y.Kb*T+B>=0?(L=T-N,B=-A,y.c1.jnAcc=T,y.c2.jnAcc=0):(V=-y.c2.nMass*B)>=0&&y.Kb*V+L>=0?(L=-N,B=V-A,y.c1.jnAcc=0,y.c2.jnAcc=V):L>=0&&B>=0?(L=-N,B=-A,y.c1.jnAcc=y.c2.jnAcc=0):(L=0,B=0),b=L+B,E=y.nx*b,M=y.ny*b,y.b2.velx+=E*y.b2.imass,y.b2.vely+=M*y.b2.imass,y.b1.velx-=E*y.b1.imass,y.b1.vely-=M*y.b1.imass,y.b2.angvel+=(y.rn1b*L+y.rn2b*B)*y.b2.iinertia,y.b1.angvel-=(y.rn1a*L+y.rn2a*B)*y.b1.iinertia}else 0!=y.radius&&(b=(y.b2.angvel-y.b1.angvel)*y.rMass,z=y.rfric*y.c1.jnAcc,w=y.jrAcc,y.jrAcc-=b,y.jrAcc>z?y.jrAcc=z:y.jrAcc<-z&&(y.jrAcc=-z),b=y.jrAcc-w,y.b2.angvel+=b*y.b2.iinertia,y.b1.angvel-=b*y.b1.iinertia),v=y.k1x+y.b2.velx-y.c1.r2y*y.b2.angvel-(y.b1.velx-y.c1.r1y*y.b1.angvel),g=y.k1y+y.b2.vely+y.c1.r2x*y.b2.angvel-(y.b1.vely+y.c1.r1x*y.b1.angvel),b=(y.c1.bounce+(y.nx*v+y.ny*g)+y.surfacey)*y.c1.nMass,(Z=(w=y.c1.jnAcc)-b)<0&&(Z=0),b=Z-w,y.c1.jnAcc=Z,E=y.nx*b,M=y.ny*b,y.b2.velx+=E*y.b2.imass,y.b2.vely+=M*y.b2.imass,y.b1.velx-=E*y.b1.imass,y.b1.vely-=M*y.b1.imass,y.b2.angvel+=y.rn1b*b*y.b2.iinertia,y.b1.angvel-=y.rn1a*b*y.b1.iinertia}f=f.next,x&&null==f&&(f=this.c_arbiters_true.head,x=!1)}}},t.space.ZPP_Space.prototype.iteratePos=function(t){for(var n=0,i=t;n<i;){n++;for(var r=null,o=this.live_constraints.head;null!=o;){var a=o.elt;!a.__velocity&&a.stiff&&a.applyImpulsePos()?(o=this.live_constraints.erase(r),a.broken(),this.constraintCbBreak(a),a.removeOnBreak?(a.component.sleeping=!0,this.midstep=!1,null!=a.compound?a.compound.wrap_constraints.remove(a.outer):this.wrap_constraints.remove(a.outer),this.midstep=!0):a.active=!1,a.clearcache()):(r=o,o=o.next)}var s=this.c_arbiters_false.head,l=!0;for(null==s&&(s=this.c_arbiters_true.head,l=!1);null!=s;){var p=s.elt;if(p.active&&0!=(1&p.immState))if(2==p.ptype){var u=p.c1,h=0,c=0;h=p.b2.axisy*u.lr2x-p.b2.axisx*u.lr2y,c=u.lr2x*p.b2.axisx+u.lr2y*p.b2.axisy,h+=1*p.b2.posx,c+=1*p.b2.posy;var _=0,d=0;_=p.b1.axisy*u.lr1x-p.b1.axisx*u.lr1y,d=u.lr1x*p.b1.axisx+u.lr1y*p.b1.axisy;var m=0,P=0;m=h-(_+=1*p.b1.posx),P=c-(d+=1*p.b1.posy);var f=Math.sqrt(m*m+P*P),x=p.radius-e.Config.collisionSlop,y=f-x;if(m*p.nx+P*p.ny<0&&(m=-m,P=-P,y-=p.radius),y<0)if(f<e.Config.epsilon)0!=p.b1.smass?p.b1.posx+=10*e.Config.epsilon:p.b2.posx+=10*e.Config.epsilon;else{var v=1/f;m*=v;var g=.5*(_+h),b=.5*(d+c),z=f-x,w=(P*=v)*(_=g-p.b1.posx)-m*(d=b-p.b1.posy),Z=P*(h=g-p.b2.posx)-m*(c=b-p.b2.posy),E=p.b2.smass+Z*Z*p.b2.sinertia+p.b1.smass+w*w*p.b1.sinertia;if(0!=E){var M,S,C=-p.biasCoef*z/E;M=m*C,S=P*C;var N=p.b1.imass;p.b1.posx-=M*N,p.b1.posy-=S*N;var A=p.b1,L=-w*p.b1.iinertia*C;if(A.rot+=L,L*L>1e-4)A.axisx=Math.sin(A.rot),A.axisy=Math.cos(A.rot);else{var B=L*L,T=1-.5*B,V=1-B*B/8,k=(T*A.axisx+L*A.axisy)*V;A.axisy=(T*A.axisy-L*A.axisx)*V,A.axisx=k}var I=p.b2.imass;p.b2.posx+=M*I,p.b2.posy+=S*I;var O=p.b2,R=Z*p.b2.iinertia*C;if(O.rot+=R,R*R>1e-4)O.axisx=Math.sin(O.rot),O.axisy=Math.cos(O.rot);else{var H=R*R,F=1-.5*H,D=1-H*H/8,G=(F*O.axisx+R*O.axisy)*D;O.axisy=(F*O.axisy-R*O.axisx)*D,O.axisx=G}}}}else{var U,j=0,W=0,q=0,J=0,$=0,X=0;0==p.ptype?(j=p.b1.axisy*p.lnormx-p.b1.axisx*p.lnormy,W=p.lnormx*p.b1.axisx+p.lnormy*p.b1.axisy,U=p.lproj+(j*p.b1.posx+W*p.b1.posy),q=p.b2.axisy*p.c1.lr1x-p.b2.axisx*p.c1.lr1y,J=p.c1.lr1x*p.b2.axisx+p.c1.lr1y*p.b2.axisy,q+=1*p.b2.posx,J+=1*p.b2.posy,p.hpc2&&($=p.b2.axisy*p.c2.lr1x-p.b2.axisx*p.c2.lr1y,X=p.c2.lr1x*p.b2.axisx+p.c2.lr1y*p.b2.axisy,$+=1*p.b2.posx,X+=1*p.b2.posy)):(j=p.b2.axisy*p.lnormx-p.b2.axisx*p.lnormy,W=p.lnormx*p.b2.axisx+p.lnormy*p.b2.axisy,U=p.lproj+(j*p.b2.posx+W*p.b2.posy),q=p.b1.axisy*p.c1.lr1x-p.b1.axisx*p.c1.lr1y,J=p.c1.lr1x*p.b1.axisx+p.c1.lr1y*p.b1.axisy,q+=1*p.b1.posx,J+=1*p.b1.posy,p.hpc2&&($=p.b1.axisy*p.c2.lr1x-p.b1.axisx*p.c2.lr1y,X=p.c2.lr1x*p.b1.axisx+p.c2.lr1y*p.b1.axisy,$+=1*p.b1.posx,X+=1*p.b1.posy));var Y=q*j+J*W-U-p.radius;Y+=e.Config.collisionSlop;var K,Q,ee,te,ne=0;if(p.hpc2&&(ne=$*j+X*W-U-p.radius,ne+=e.Config.collisionSlop),Y<0||ne<0)if(p.rev&&(j=-j,W=-W),K=q-p.b1.posx,Q=J-p.b1.posy,ee=q-p.b2.posx,te=J-p.b2.posy,p.hpc2){var ie,re,oe,ae=W*K-j*Q,se=W*ee-j*te,le=W*($-p.b1.posx)-j*(X-p.b1.posy),pe=W*($-p.b2.posx)-j*(X-p.b2.posy),ue=p.b1.smass+p.b2.smass;p.kMassa=ue+p.b1.sinertia*ae*ae+p.b2.sinertia*se*se,p.kMassb=ue+p.b1.sinertia*ae*le+p.b2.sinertia*se*pe,p.kMassc=ue+p.b1.sinertia*le*le+p.b2.sinertia*pe*pe,ie=p.kMassa,re=p.kMassb,oe=p.kMassc;for(var he=Y*p.biasCoef,ce=ne*p.biasCoef;;){var _e=0,de=0;_e=-(_e=he),de=-(de=ce);var me=p.kMassa*p.kMassc-p.kMassb*p.kMassb;if(me!=me)_e=de=0;else if(0==me)0!=p.kMassa?_e/=p.kMassa:_e=0,0!=p.kMassc?de/=p.kMassc:de=0;else{var Pe=(me=1/me)*(p.kMassc*_e-p.kMassb*de);de=me*(p.kMassa*de-p.kMassb*_e),_e=Pe}if(_e>=0&&de>=0){var fe=(_e+de)*p.b1.imass;p.b1.posx-=j*fe,p.b1.posy-=W*fe;var xe=p.b1,ye=-p.b1.iinertia*(ae*_e+le*de);if(xe.rot+=ye,ye*ye>1e-4)xe.axisx=Math.sin(xe.rot),xe.axisy=Math.cos(xe.rot);else{var ve=ye*ye,ge=1-.5*ve,be=1-ve*ve/8,ze=(ge*xe.axisx+ye*xe.axisy)*be;xe.axisy=(ge*xe.axisy-ye*xe.axisx)*be,xe.axisx=ze}var we=(_e+de)*p.b2.imass;p.b2.posx+=j*we,p.b2.posy+=W*we;var Ze=p.b2,Ee=p.b2.iinertia*(se*_e+pe*de);if(Ze.rot+=Ee,Ee*Ee>1e-4)Ze.axisx=Math.sin(Ze.rot),Ze.axisy=Math.cos(Ze.rot);else{var Me=Ee*Ee,Se=1-.5*Me,Ce=1-Me*Me/8,Ne=(Se*Ze.axisx+Ee*Ze.axisy)*Ce;Ze.axisy=(Se*Ze.axisy-Ee*Ze.axisx)*Ce,Ze.axisx=Ne}break}if(de=0,(_e=-he/ie)>=0&&re*_e+ce>=0){var Ae=(_e+de)*p.b1.imass;p.b1.posx-=j*Ae,p.b1.posy-=W*Ae;var Le=p.b1,Be=-p.b1.iinertia*(ae*_e+le*de);if(Le.rot+=Be,Be*Be>1e-4)Le.axisx=Math.sin(Le.rot),Le.axisy=Math.cos(Le.rot);else{var Te=Be*Be,Ve=1-.5*Te,ke=1-Te*Te/8,Ie=(Ve*Le.axisx+Be*Le.axisy)*ke;Le.axisy=(Ve*Le.axisy-Be*Le.axisx)*ke,Le.axisx=Ie}var Oe=(_e+de)*p.b2.imass;p.b2.posx+=j*Oe,p.b2.posy+=W*Oe;var Re=p.b2,He=p.b2.iinertia*(se*_e+pe*de);if(Re.rot+=He,He*He>1e-4)Re.axisx=Math.sin(Re.rot),Re.axisy=Math.cos(Re.rot);else{var Fe=He*He,De=1-.5*Fe,Ge=1-Fe*Fe/8,Ue=(De*Re.axisx+He*Re.axisy)*Ge;Re.axisy=(De*Re.axisy-He*Re.axisx)*Ge,Re.axisx=Ue}break}if(_e=0,(de=-ce/oe)>=0&&re*de+he>=0){var je=(_e+de)*p.b1.imass;p.b1.posx-=j*je,p.b1.posy-=W*je;var We=p.b1,qe=-p.b1.iinertia*(ae*_e+le*de);if(We.rot+=qe,qe*qe>1e-4)We.axisx=Math.sin(We.rot),We.axisy=Math.cos(We.rot);else{var Je=qe*qe,$e=1-.5*Je,Xe=1-Je*Je/8,Ye=($e*We.axisx+qe*We.axisy)*Xe;We.axisy=($e*We.axisy-qe*We.axisx)*Xe,We.axisx=Ye}var Ke=(_e+de)*p.b2.imass;p.b2.posx+=j*Ke,p.b2.posy+=W*Ke;var Qe=p.b2,et=p.b2.iinertia*(se*_e+pe*de);if(Qe.rot+=et,et*et>1e-4)Qe.axisx=Math.sin(Qe.rot),Qe.axisy=Math.cos(Qe.rot);else{var tt=et*et,nt=1-.5*tt,it=1-tt*tt/8,rt=(nt*Qe.axisx+et*Qe.axisy)*it;Qe.axisy=(nt*Qe.axisy-et*Qe.axisx)*it,Qe.axisx=rt}break}break}}else{var ot=W*K-j*Q,at=W*ee-j*te,st=p.b2.smass+at*at*p.b2.sinertia+p.b1.smass+ot*ot*p.b1.sinertia;if(0!=st){var lt,pt,ut=-p.biasCoef*Y/st;lt=j*ut,pt=W*ut;var ht=p.b1.imass;p.b1.posx-=lt*ht,p.b1.posy-=pt*ht;var ct=p.b1,_t=-ot*p.b1.iinertia*ut;if(ct.rot+=_t,_t*_t>1e-4)ct.axisx=Math.sin(ct.rot),ct.axisy=Math.cos(ct.rot);else{var dt=_t*_t,mt=1-.5*dt,Pt=1-dt*dt/8,ft=(mt*ct.axisx+_t*ct.axisy)*Pt;ct.axisy=(mt*ct.axisy-_t*ct.axisx)*Pt,ct.axisx=ft}var xt=p.b2.imass;p.b2.posx+=lt*xt,p.b2.posy+=pt*xt;var yt=p.b2,vt=at*p.b2.iinertia*ut;if(yt.rot+=vt,vt*vt>1e-4)yt.axisx=Math.sin(yt.rot),yt.axisy=Math.cos(yt.rot);else{var gt=vt*vt,bt=1-.5*gt,zt=1-gt*gt/8,wt=(bt*yt.axisx+vt*yt.axisy)*zt;yt.axisy=(bt*yt.axisy-vt*yt.axisx)*zt,yt.axisx=wt}}}}s=s.next,l&&null==s&&(s=this.c_arbiters_true.head,l=!1)}}},t.space.ZPP_Space.prototype.group_ignore=function(e,t){for(var n=e;null!=n&&null==n.group;)n=null!=n.ishape?n.ishape.body:null!=n.icompound?n.icompound.compound:n.ibody.compound;var i=null==n?null:n.group;if(null==i)return!1;for(var r=t;null!=r&&null==r.group;)r=null!=r.ishape?r.ishape.body:null!=r.icompound?r.icompound.compound:r.ibody.compound;var o=null==r?null:r.group;if(null==o)return!1;for(var a=!1;null!=i&&null!=o;){if(i==o){a=i.ignore;break}i.depth<o.depth?o=o.group:i=i.group}return a},t.space.ZPP_Space.prototype.interactionType=function(e,t,n,i){var r;r=!1;for(var o,a=n.constraints.head;null!=a;){var s=a.elt;if(s.ignore&&s.pair_exists(n.id,i.id)){r=!0;break}a=a.next}if(r)o=!1;else{for(var l=e;null!=l&&null==l.group;)l=null!=l.ishape?l.ishape.body:null!=l.icompound?l.icompound.compound:l.ibody.compound;var p,u=null==l?null:l.group;if(null==u)p=!1;else{for(var h=t;null!=h&&null==h.group;)h=null!=h.ishape?h.ishape.body:null!=h.icompound?h.icompound.compound:h.ibody.compound;var c=null==h?null:h.group;if(null==c)p=!1;else{for(var _=!1;null!=u&&null!=c;){if(u==c){_=u.ignore;break}u.depth<c.depth?c=c.group:u=u.group}p=_}}o=!p}if(o){var d,m;if(e.sensorEnabled||t.sensorEnabled){var P=e.filter,f=t.filter;d=0!=(P.sensorMask&f.sensorGroup)&&0!=(f.sensorMask&P.sensorGroup)}else d=!1;if(d)return 2;if(e.fluidEnabled||t.fluidEnabled){var x=e.filter,y=t.filter;m=0!=(x.fluidMask&y.fluidGroup)&&0!=(y.fluidMask&x.fluidGroup)}else m=!1;if(!m||0==n.imass&&0==i.imass&&0==n.iinertia&&0==i.iinertia){var v=e.filter,g=t.filter;return 0==(v.collisionMask&g.collisionGroup)||0==(g.collisionMask&v.collisionGroup)||0==n.imass&&0==i.imass&&0==n.iinertia&&0==i.iinertia?-1:1}return 0}return-1},t.space.ZPP_Space.prototype.precb=null,t.space.ZPP_Space.prototype.prelisteners=null,t.space.ZPP_Space.prototype.narrowPhase=function(n,i,r,o,a){var s,l=null,p=n.body,u=i.body;s=!1;for(var h,c,_=p.constraints.head;null!=_;){var d=_.elt;if(d.ignore&&d.pair_exists(p.id,u.id)){s=!0;break}_=_.next}if(s)c=!1;else{for(var m=n;null!=m&&null==m.group;)m=null!=m.ishape?m.ishape.body:null!=m.icompound?m.icompound.compound:m.ibody.compound;var P,f=null==m?null:m.group;if(null==f)P=!1;else{for(var x=i;null!=x&&null==x.group;)x=null!=x.ishape?x.ishape.body:null!=x.icompound?x.icompound.compound:x.ibody.compound;var y=null==x?null:x.group;if(null==y)P=!1;else{for(var v=!1;null!=f&&null!=y;){if(f==y){v=f.ignore;break}f.depth<y.depth?y=y.group:f=f.group}P=v}}c=!P}if(c){var g;if(n.sensorEnabled||i.sensorEnabled){var b=n.filter,z=i.filter;g=0!=(b.sensorMask&z.sensorGroup)&&0!=(z.sensorMask&b.sensorGroup)}else g=!1;if(g)h=2;else{var w;if(n.fluidEnabled||i.fluidEnabled){var Z=n.filter,E=i.filter;w=0!=(Z.fluidMask&E.fluidGroup)&&0!=(E.fluidMask&Z.fluidGroup)}else w=!1;if(!w||0==p.imass&&0==u.imass&&0==p.iinertia&&0==u.iinertia){var M=n.filter,S=i.filter;h=0==(M.collisionMask&S.collisionGroup)||0==(S.collisionMask&M.collisionGroup)||0==p.imass&&0==u.imass&&0==p.iinertia&&0==u.iinertia?-1:1}else h=0}}else h=-1;if(-1!=h){var C,N;n.type>i.type?(C=i,N=n):n.type==i.type?n.id<i.id?(C=n,N=i):(N=n,C=i):(C=n,N=i);var A=C==i;if(0==h){var L;if(null==o){for(var B=null,T=(p.arbiters.length<u.arbiters.length?p:u).arbiters.head;null!=T;){var V=T.elt;if(V.id==C.id&&V.di==N.id){B=V;break}T=T.next}L=B}else L=o;var k,I=null==L,O=!1;if(I)null==t.dynamics.ZPP_FluidArbiter.zpp_pool?k=new t.dynamics.ZPP_FluidArbiter:(k=t.dynamics.ZPP_FluidArbiter.zpp_pool,t.dynamics.ZPP_FluidArbiter.zpp_pool=k.next,k.next=null);else if(null==L.fluidarb){L.cleared=!0;for(var R=L.b1.arbiters,H=null,F=R.head;null!=F;){if(F.elt==L){var D,G;null==H?(G=(D=R.head).next,R.head=G,null==R.head&&(R.pushmod=!0)):(G=(D=H.next).next,H.next=G,null==G&&(R.pushmod=!0));var U=D;U.elt=null,U.next=t.util.ZNPNode_ZPP_Arbiter.zpp_pool,t.util.ZNPNode_ZPP_Arbiter.zpp_pool=U,R.modified=!0,R.length--,R.pushmod=!0;break}H=F,F=F.next}for(var j=L.b2.arbiters,W=null,q=j.head;null!=q;){if(q.elt==L){var J,$;null==W?($=(J=j.head).next,j.head=$,null==j.head&&(j.pushmod=!0)):($=(J=W.next).next,W.next=$,null==$&&(j.pushmod=!0));var X=J;X.elt=null,X.next=t.util.ZNPNode_ZPP_Arbiter.zpp_pool,t.util.ZNPNode_ZPP_Arbiter.zpp_pool=X,j.modified=!0,j.length--,j.pushmod=!0;break}W=q,q=q.next}null!=L.pair&&(L.pair.arb=null,L.pair=null),L.active=!1,this.f_arbiters.modified=!0,null==t.dynamics.ZPP_FluidArbiter.zpp_pool?k=new t.dynamics.ZPP_FluidArbiter:(k=t.dynamics.ZPP_FluidArbiter.zpp_pool,t.dynamics.ZPP_FluidArbiter.zpp_pool=k.next,k.next=null),k.intchange=!0,I=!0,O=!0}else k=L.fluidarb;if(I||k.stamp!=this.stamp||a)if(k.stamp=this.stamp,t.geom.ZPP_Collide.flowCollide(C,N,k)){if(I){var Y=N.id;k.b1=n.body,k.ws1=n,k.b2=i.body,k.ws2=i,k.id=C.id,k.di=Y;var K,Q=k.b1.arbiters;null==t.util.ZNPNode_ZPP_Arbiter.zpp_pool?K=new t.util.ZNPNode_ZPP_Arbiter:(K=t.util.ZNPNode_ZPP_Arbiter.zpp_pool,t.util.ZNPNode_ZPP_Arbiter.zpp_pool=K.next,K.next=null),K.elt=k;var ee=K;ee.next=Q.head,Q.head=ee,Q.modified=!0,Q.length++;var te,ne=k.b2.arbiters;null==t.util.ZNPNode_ZPP_Arbiter.zpp_pool?te=new t.util.ZNPNode_ZPP_Arbiter:(te=t.util.ZNPNode_ZPP_Arbiter.zpp_pool,t.util.ZNPNode_ZPP_Arbiter.zpp_pool=te.next,te.next=null),te.elt=k;var ie=te;ie.next=ne.head,ne.head=ie,ne.modified=!0,ne.length++,k.active=!0,k.present=0,k.cleared=!1,k.sleeping=!1,k.fresh=!1,k.presentable=!1,k.nx=0,k.ny=1,k.dampx=0,k.dampy=0,k.adamp=0;var re,oe=this.f_arbiters;null==t.util.ZNPNode_ZPP_FluidArbiter.zpp_pool?re=new t.util.ZNPNode_ZPP_FluidArbiter:(re=t.util.ZNPNode_ZPP_FluidArbiter.zpp_pool,t.util.ZNPNode_ZPP_FluidArbiter.zpp_pool=re.next,re.next=null),re.elt=k;var ae=re;ae.next=oe.head,oe.head=ae,oe.modified=!0,oe.length++,k.fresh=!O}else k.fresh=k.up_stamp<this.stamp-1||k.endGenerated==this.stamp&&a;if(k.up_stamp=k.stamp,k.fresh||0==(4&k.immState)){k.immState=1;for(var se=!1,le=k.ws1.id>k.ws2.id?k.ws2:k.ws1,pe=k.ws1.id>k.ws2.id?k.ws1:k.ws2,ue=this.mrca1;null!=ue.head;){var he=ue.head;ue.head=he.next;var ce=he;ce.elt=null,ce.next=t.util.ZNPNode_ZPP_Interactor.zpp_pool,t.util.ZNPNode_ZPP_Interactor.zpp_pool=ce,null==ue.head&&(ue.pushmod=!0),ue.modified=!0,ue.length--}ue.pushmod=!0;for(var _e=this.mrca2;null!=_e.head;){var de=_e.head;_e.head=de.next;var me=de;me.elt=null,me.next=t.util.ZNPNode_ZPP_Interactor.zpp_pool,t.util.ZNPNode_ZPP_Interactor.zpp_pool=me,null==_e.head&&(_e.pushmod=!0),_e.modified=!0,_e.length--}if(_e.pushmod=!0,null!=le.cbSet){var Pe,fe=this.mrca1;null==t.util.ZNPNode_ZPP_Interactor.zpp_pool?Pe=new t.util.ZNPNode_ZPP_Interactor:(Pe=t.util.ZNPNode_ZPP_Interactor.zpp_pool,t.util.ZNPNode_ZPP_Interactor.zpp_pool=Pe.next,Pe.next=null),Pe.elt=le;var xe=Pe;xe.next=fe.head,fe.head=xe,fe.modified=!0,fe.length++}if(null!=le.body.cbSet){var ye,ve=this.mrca1,ge=le.body;null==t.util.ZNPNode_ZPP_Interactor.zpp_pool?ye=new t.util.ZNPNode_ZPP_Interactor:(ye=t.util.ZNPNode_ZPP_Interactor.zpp_pool,t.util.ZNPNode_ZPP_Interactor.zpp_pool=ye.next,ye.next=null),ye.elt=ge;var be=ye;be.next=ve.head,ve.head=be,ve.modified=!0,ve.length++}if(null!=pe.cbSet){var ze,we=this.mrca2;null==t.util.ZNPNode_ZPP_Interactor.zpp_pool?ze=new t.util.ZNPNode_ZPP_Interactor:(ze=t.util.ZNPNode_ZPP_Interactor.zpp_pool,t.util.ZNPNode_ZPP_Interactor.zpp_pool=ze.next,ze.next=null),ze.elt=pe;var Ze=ze;Ze.next=we.head,we.head=Ze,we.modified=!0,we.length++}if(null!=pe.body.cbSet){var Ee,Me=this.mrca2,Se=pe.body;null==t.util.ZNPNode_ZPP_Interactor.zpp_pool?Ee=new t.util.ZNPNode_ZPP_Interactor:(Ee=t.util.ZNPNode_ZPP_Interactor.zpp_pool,t.util.ZNPNode_ZPP_Interactor.zpp_pool=Ee.next,Ee.next=null),Ee.elt=Se;var Ce=Ee;Ce.next=Me.head,Me.head=Ce,Me.modified=!0,Me.length++}for(var Ne=le.body.compound,Ae=pe.body.compound;Ne!=Ae;)if((null==Ne?0:Ne.depth)<(null==Ae?0:Ae.depth)){if(null!=Ae.cbSet){var Le,Be=this.mrca2;null==t.util.ZNPNode_ZPP_Interactor.zpp_pool?Le=new t.util.ZNPNode_ZPP_Interactor:(Le=t.util.ZNPNode_ZPP_Interactor.zpp_pool,t.util.ZNPNode_ZPP_Interactor.zpp_pool=Le.next,Le.next=null),Le.elt=Ae;var Te=Le;Te.next=Be.head,Be.head=Te,Be.modified=!0,Be.length++}Ae=Ae.compound}else{if(null!=Ne.cbSet){var Ve,ke=this.mrca1;null==t.util.ZNPNode_ZPP_Interactor.zpp_pool?Ve=new t.util.ZNPNode_ZPP_Interactor:(Ve=t.util.ZNPNode_ZPP_Interactor.zpp_pool,t.util.ZNPNode_ZPP_Interactor.zpp_pool=Ve.next,Ve.next=null),Ve.elt=Ne;var Ie=Ve;Ie.next=ke.head,ke.head=Ie,ke.modified=!0,ke.length++}Ne=Ne.compound}for(var Oe=this.mrca1.head;null!=Oe;){for(var Re=Oe.elt,He=this.mrca2.head;null!=He;){for(var Fe,De=He.elt,Ge=Re.cbSet,Ue=De.cbSet,je=(Ge.manager,null),We=(Ge.cbpairs.length<Ue.cbpairs.length?Ge.cbpairs:Ue.cbpairs).head;null!=We;){var qe=We.elt;if(qe.a==Ge&&qe.b==Ue||qe.a==Ue&&qe.b==Ge){je=qe;break}We=We.next}if(null==je&&(null==t.callbacks.ZPP_CbSetPair.zpp_pool?Fe=new t.callbacks.ZPP_CbSetPair:(Fe=t.callbacks.ZPP_CbSetPair.zpp_pool,t.callbacks.ZPP_CbSetPair.zpp_pool=Fe.next,Fe.next=null),Fe.zip_listeners=!0,t.callbacks.ZPP_CbSet.setlt(Ge,Ue)?(Fe.a=Ge,Fe.b=Ue):(Fe.a=Ue,Fe.b=Ge),je=Fe,Ge.cbpairs.add(je),Ue!=Ge&&Ue.cbpairs.add(je)),je.zip_listeners&&(je.zip_listeners=!1,je.__validate()),null!=je.listeners.head){for(var Je=null,$e=null,Xe=this.prelisteners;null!=Xe.head;){var Ye=Xe.head;Xe.head=Ye.next;var Ke=Ye;Ke.elt=null,Ke.next=t.util.ZNPNode_ZPP_InteractionListener.zpp_pool,t.util.ZNPNode_ZPP_InteractionListener.zpp_pool=Ke,null==Xe.head&&(Xe.pushmod=!0),Xe.modified=!0,Xe.length--}Xe.pushmod=!0;for(var Qe,et=null,tt=(Ge.manager,null),nt=(Ge.cbpairs.length<Ue.cbpairs.length?Ge.cbpairs:Ue.cbpairs).head;null!=nt;){var it=nt.elt;if(it.a==Ge&&it.b==Ue||it.a==Ue&&it.b==Ge){tt=it;break}nt=nt.next}null==tt&&(null==t.callbacks.ZPP_CbSetPair.zpp_pool?Qe=new t.callbacks.ZPP_CbSetPair:(Qe=t.callbacks.ZPP_CbSetPair.zpp_pool,t.callbacks.ZPP_CbSetPair.zpp_pool=Qe.next,Qe.next=null),Qe.zip_listeners=!0,t.callbacks.ZPP_CbSet.setlt(Ge,Ue)?(Qe.a=Ge,Qe.b=Ue):(Qe.a=Ue,Qe.b=Ge),tt=Qe,Ge.cbpairs.add(tt),Ue!=Ge&&Ue.cbpairs.add(tt)),tt.zip_listeners&&(tt.zip_listeners=!1,tt.__validate());for(var rt=tt.listeners.head;null!=rt;){var ot=rt.elt;if(5==ot.event&&0!=(4&ot.itype)){var at,st=this.prelisteners;null==t.util.ZNPNode_ZPP_InteractionListener.zpp_pool?at=new t.util.ZNPNode_ZPP_InteractionListener:(at=t.util.ZNPNode_ZPP_InteractionListener.zpp_pool,t.util.ZNPNode_ZPP_InteractionListener.zpp_pool=at.next,at.next=null),at.elt=ot;var lt=at;null==et?(lt.next=st.head,st.head=lt):(lt.next=et.next,et.next=lt),st.pushmod=st.modified=!0,st.length++,et=lt,se=se||!ot.pure}rt=rt.next}if(null!=this.prelisteners.head){if(null==(Je=t.phys.ZPP_Interactor.get(Re,De))&&($e=t.space.ZPP_CallbackSet.get(Re,De),this.add_callbackset($e)),null==Je||(Je.FLUIDstamp!=this.stamp||a)&&0==(4&Je.FLUIDstate)){if(null!=$e&&(Je=$e),null!=Je)for(var pt=this.prelisteners.head;null!=pt;)7==pt.elt.itype?(Je.COLLISIONstamp=this.stamp,Je.SENSORstamp=this.stamp,Je.FLUIDstamp=this.stamp):Je.FLUIDstamp=this.stamp,pt=pt.next;k.mutable=!0,null!=k.wrap_position&&(k.wrap_position.zpp_inner._immutable=!1);var ut=k.active;k.active=!0,this.precb.zpp_inner.pre_arbiter=k,this.precb.zpp_inner.set=Je;for(var ht=this.prelisteners.head;null!=ht;){var ct=ht.elt;this.precb.zpp_inner.listener=ct;var _t,dt=this.precb.zpp_inner,mt=Je.int1,Pt=Je.int2,ft=ct.options1,xt=mt.cbTypes;if(ft.nonemptyintersection(xt,ft.includes)&&!ft.nonemptyintersection(xt,ft.excludes)){var yt=ct.options2,vt=Pt.cbTypes;_t=yt.nonemptyintersection(vt,yt.includes)&&!yt.nonemptyintersection(vt,yt.excludes)}else _t=!1;_t?(dt.int1=mt,dt.int2=Pt):(dt.int1=Pt,dt.int2=mt),this.precb.zpp_inner.pre_swapped=Re!=this.precb.zpp_inner.int1;var gt,bt=ct.handlerp(this.precb);null!=bt&&(null==t.util.ZPP_Flags.PreFlag_ACCEPT&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.PreFlag_ACCEPT=new e.callbacks.PreFlag,t.util.ZPP_Flags.internal=!1),bt==t.util.ZPP_Flags.PreFlag_ACCEPT?gt=5:(null==t.util.ZPP_Flags.PreFlag_ACCEPT_ONCE&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.PreFlag_ACCEPT_ONCE=new e.callbacks.PreFlag,t.util.ZPP_Flags.internal=!1),bt==t.util.ZPP_Flags.PreFlag_ACCEPT_ONCE?gt=1:(null==t.util.ZPP_Flags.PreFlag_IGNORE&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.PreFlag_IGNORE=new e.callbacks.PreFlag,t.util.ZPP_Flags.internal=!1),gt=bt==t.util.ZPP_Flags.PreFlag_IGNORE?6:2)),k.immState=gt),ht=ht.next}if(k.mutable=!1,null!=k.wrap_position&&(k.wrap_position.zpp_inner._immutable=!0),k.active=ut,null!=Je)for(var zt=this.prelisteners.head;null!=zt;)7==zt.elt.itype?(Je.COLLISIONstate=k.immState,Je.SENSORstate=k.immState,Je.FLUIDstate=k.immState):Je.FLUIDstate=k.immState,zt=zt.next}else null==Je?0==(4&k.immState)&&(k.immState=1):k.immState=Je.FLUIDstate;He=He.next}else He=He.next}else He=He.next}Oe=Oe.next}if(se&&0==(4&k.immState)){if(2==k.b1.type){var wt=k.b1;wt.world||(wt.component.waket=this.stamp+(this.midstep?0:1),3==wt.type&&(wt.kinematicDelaySleep=!0),wt.component.sleeping&&this.really_wake(wt,!1))}if(2==k.b1.type){var Zt=k.b2;Zt.world||(Zt.component.waket=this.stamp+(this.midstep?0:1),3==Zt.type&&(Zt.kinematicDelaySleep=!0),Zt.component.sleeping&&this.really_wake(Zt,!1))}}}if(0!=(1&k.immState)){if(2==k.b1.type&&k.b1.component.sleeping){var Et=k.b1;Et.world||(Et.component.waket=this.stamp+(this.midstep?0:1),3==Et.type&&(Et.kinematicDelaySleep=!0),Et.component.sleeping&&this.really_wake(Et,!1))}if(2==k.b2.type&&k.b2.component.sleeping){var Mt=k.b2;Mt.world||(Mt.component.waket=this.stamp+(this.midstep?0:1),3==Mt.type&&(Mt.kinematicDelaySleep=!0),Mt.component.sleeping&&this.really_wake(Mt,!1))}}if(k.sleeping){k.sleeping=!1;var St,Ct=this.f_arbiters;null==t.util.ZNPNode_ZPP_FluidArbiter.zpp_pool?St=new t.util.ZNPNode_ZPP_FluidArbiter:(St=t.util.ZNPNode_ZPP_FluidArbiter.zpp_pool,t.util.ZNPNode_ZPP_FluidArbiter.zpp_pool=St.next,St.next=null),St.elt=k;var Nt=St;Nt.next=Ct.head,Ct.head=Nt,Ct.modified=!0,Ct.length++}l=k}else if(I){var At=k;At.next=t.dynamics.ZPP_FluidArbiter.zpp_pool,t.dynamics.ZPP_FluidArbiter.zpp_pool=At,l=null}else l=k;else l=k}else if(1==h){var Lt,Bt=r?this.c_arbiters_true:this.c_arbiters_false;if(null==o){for(var Tt=null,Vt=(p.arbiters.length<u.arbiters.length?p:u).arbiters.head;null!=Vt;){var kt=Vt.elt;if(kt.id==C.id&&kt.di==N.id){Tt=kt;break}Vt=Vt.next}Lt=Tt}else Lt=o;var It,Ot=null==Lt,Rt=!1;if(Ot)null==t.dynamics.ZPP_ColArbiter.zpp_pool?It=new t.dynamics.ZPP_ColArbiter:(It=t.dynamics.ZPP_ColArbiter.zpp_pool,t.dynamics.ZPP_ColArbiter.zpp_pool=It.next,It.next=null),It.stat=r;else if(null==Lt.colarb){Lt.cleared=!0;for(var Ht=Lt.b1.arbiters,Ft=null,Dt=Ht.head;null!=Dt;){if(Dt.elt==Lt){var Gt,Ut;null==Ft?(Ut=(Gt=Ht.head).next,Ht.head=Ut,null==Ht.head&&(Ht.pushmod=!0)):(Ut=(Gt=Ft.next).next,Ft.next=Ut,null==Ut&&(Ht.pushmod=!0));var jt=Gt;jt.elt=null,jt.next=t.util.ZNPNode_ZPP_Arbiter.zpp_pool,t.util.ZNPNode_ZPP_Arbiter.zpp_pool=jt,Ht.modified=!0,Ht.length--,Ht.pushmod=!0;break}Ft=Dt,Dt=Dt.next}for(var Wt=Lt.b2.arbiters,qt=null,Jt=Wt.head;null!=Jt;){if(Jt.elt==Lt){var $t,Xt;null==qt?(Xt=($t=Wt.head).next,Wt.head=Xt,null==Wt.head&&(Wt.pushmod=!0)):(Xt=($t=qt.next).next,qt.next=Xt,null==Xt&&(Wt.pushmod=!0));var Yt=$t;Yt.elt=null,Yt.next=t.util.ZNPNode_ZPP_Arbiter.zpp_pool,t.util.ZNPNode_ZPP_Arbiter.zpp_pool=Yt,Wt.modified=!0,Wt.length--,Wt.pushmod=!0;break}qt=Jt,Jt=Jt.next}null!=Lt.pair&&(Lt.pair.arb=null,Lt.pair=null),Lt.active=!1,this.f_arbiters.modified=!0,null==t.dynamics.ZPP_ColArbiter.zpp_pool?It=new t.dynamics.ZPP_ColArbiter:(It=t.dynamics.ZPP_ColArbiter.zpp_pool,t.dynamics.ZPP_ColArbiter.zpp_pool=It.next,It.next=null),It.intchange=!0,It.stat=r,Ot=!0,Rt=!0}else A=C!=(It=Lt.colarb).s1,It.stat!=r&&(It.stat=r,It.sleeping||((r?this.c_arbiters_false:this.c_arbiters_true).remove(It),Bt.add(It)));if(Ot||It.stamp!=this.stamp||a)if(It.stamp=this.stamp,t.geom.ZPP_Collide.contactCollide(C,N,It,A)){if(Ot){var Kt=N.id;It.b1=n.body,It.ws1=n,It.b2=i.body,It.ws2=i,It.id=C.id,It.di=Kt;var Qt,en=It.b1.arbiters;null==t.util.ZNPNode_ZPP_Arbiter.zpp_pool?Qt=new t.util.ZNPNode_ZPP_Arbiter:(Qt=t.util.ZNPNode_ZPP_Arbiter.zpp_pool,t.util.ZNPNode_ZPP_Arbiter.zpp_pool=Qt.next,Qt.next=null),Qt.elt=It;var tn=Qt;tn.next=en.head,en.head=tn,en.modified=!0,en.length++;var nn,rn=It.b2.arbiters;null==t.util.ZNPNode_ZPP_Arbiter.zpp_pool?nn=new t.util.ZNPNode_ZPP_Arbiter:(nn=t.util.ZNPNode_ZPP_Arbiter.zpp_pool,t.util.ZNPNode_ZPP_Arbiter.zpp_pool=nn.next,nn.next=null),nn.elt=It;var on,an=nn;an.next=rn.head,rn.head=an,rn.modified=!0,rn.length++,It.active=!0,It.present=0,It.cleared=!1,It.sleeping=!1,It.fresh=!1,It.presentable=!1,It.s1=n,It.s2=i,It.userdef_restitution||(It.s1.material.elasticity<=-1/0||It.s2.material.elasticity<=-1/0?It.restitution=0:It.s1.material.elasticity>=1/0||It.s2.material.elasticity>=1/0?It.restitution=1:It.restitution=(It.s1.material.elasticity+It.s2.material.elasticity)/2,It.restitution<0&&(It.restitution=0),It.restitution>1&&(It.restitution=1)),It.userdef_dyn_fric||(It.dyn_fric=Math.sqrt(It.s1.material.dynamicFriction*It.s2.material.dynamicFriction)),It.userdef_stat_fric||(It.stat_fric=Math.sqrt(It.s1.material.staticFriction*It.s2.material.staticFriction)),It.userdef_rfric||(It.rfric=Math.sqrt(It.s1.material.rollingFriction*It.s2.material.rollingFriction)),null==t.util.ZNPNode_ZPP_ColArbiter.zpp_pool?on=new t.util.ZNPNode_ZPP_ColArbiter:(on=t.util.ZNPNode_ZPP_ColArbiter.zpp_pool,t.util.ZNPNode_ZPP_ColArbiter.zpp_pool=on.next,on.next=null),on.elt=It;var sn=on;sn.next=Bt.head,Bt.head=sn,Bt.modified=!0,Bt.length++,It.fresh=!Rt}else It.fresh=It.up_stamp<this.stamp-1||It.endGenerated==this.stamp&&a;if(It.up_stamp=It.stamp,It.fresh||0==(4&It.immState)){It.immState=1;for(var ln=!1,pn=It.ws1.id>It.ws2.id?It.ws2:It.ws1,un=It.ws1.id>It.ws2.id?It.ws1:It.ws2,hn=this.mrca1;null!=hn.head;){var cn=hn.head;hn.head=cn.next;var _n=cn;_n.elt=null,_n.next=t.util.ZNPNode_ZPP_Interactor.zpp_pool,t.util.ZNPNode_ZPP_Interactor.zpp_pool=_n,null==hn.head&&(hn.pushmod=!0),hn.modified=!0,hn.length--}hn.pushmod=!0;for(var dn=this.mrca2;null!=dn.head;){var mn=dn.head;dn.head=mn.next;var Pn=mn;Pn.elt=null,Pn.next=t.util.ZNPNode_ZPP_Interactor.zpp_pool,t.util.ZNPNode_ZPP_Interactor.zpp_pool=Pn,null==dn.head&&(dn.pushmod=!0),dn.modified=!0,dn.length--}if(dn.pushmod=!0,null!=pn.cbSet){var fn,xn=this.mrca1;null==t.util.ZNPNode_ZPP_Interactor.zpp_pool?fn=new t.util.ZNPNode_ZPP_Interactor:(fn=t.util.ZNPNode_ZPP_Interactor.zpp_pool,t.util.ZNPNode_ZPP_Interactor.zpp_pool=fn.next,fn.next=null),fn.elt=pn;var yn=fn;yn.next=xn.head,xn.head=yn,xn.modified=!0,xn.length++}if(null!=pn.body.cbSet){var vn,gn=this.mrca1,bn=pn.body;null==t.util.ZNPNode_ZPP_Interactor.zpp_pool?vn=new t.util.ZNPNode_ZPP_Interactor:(vn=t.util.ZNPNode_ZPP_Interactor.zpp_pool,t.util.ZNPNode_ZPP_Interactor.zpp_pool=vn.next,vn.next=null),vn.elt=bn;var zn=vn;zn.next=gn.head,gn.head=zn,gn.modified=!0,gn.length++}if(null!=un.cbSet){var wn,Zn=this.mrca2;null==t.util.ZNPNode_ZPP_Interactor.zpp_pool?wn=new t.util.ZNPNode_ZPP_Interactor:(wn=t.util.ZNPNode_ZPP_Interactor.zpp_pool,t.util.ZNPNode_ZPP_Interactor.zpp_pool=wn.next,wn.next=null),wn.elt=un;var En=wn;En.next=Zn.head,Zn.head=En,Zn.modified=!0,Zn.length++}if(null!=un.body.cbSet){var Mn,Sn=this.mrca2,Cn=un.body;null==t.util.ZNPNode_ZPP_Interactor.zpp_pool?Mn=new t.util.ZNPNode_ZPP_Interactor:(Mn=t.util.ZNPNode_ZPP_Interactor.zpp_pool,t.util.ZNPNode_ZPP_Interactor.zpp_pool=Mn.next,Mn.next=null),Mn.elt=Cn;var Nn=Mn;Nn.next=Sn.head,Sn.head=Nn,Sn.modified=!0,Sn.length++}for(var An=pn.body.compound,Ln=un.body.compound;An!=Ln;)if((null==An?0:An.depth)<(null==Ln?0:Ln.depth)){if(null!=Ln.cbSet){var Bn,Tn=this.mrca2;null==t.util.ZNPNode_ZPP_Interactor.zpp_pool?Bn=new t.util.ZNPNode_ZPP_Interactor:(Bn=t.util.ZNPNode_ZPP_Interactor.zpp_pool,t.util.ZNPNode_ZPP_Interactor.zpp_pool=Bn.next,Bn.next=null),Bn.elt=Ln;var Vn=Bn;Vn.next=Tn.head,Tn.head=Vn,Tn.modified=!0,Tn.length++}Ln=Ln.compound}else{if(null!=An.cbSet){var kn,In=this.mrca1;null==t.util.ZNPNode_ZPP_Interactor.zpp_pool?kn=new t.util.ZNPNode_ZPP_Interactor:(kn=t.util.ZNPNode_ZPP_Interactor.zpp_pool,t.util.ZNPNode_ZPP_Interactor.zpp_pool=kn.next,kn.next=null),kn.elt=An;var On=kn;On.next=In.head,In.head=On,In.modified=!0,In.length++}An=An.compound}for(var Rn=this.mrca1.head;null!=Rn;){for(var Hn=Rn.elt,Fn=this.mrca2.head;null!=Fn;){for(var Dn,Gn=Fn.elt,Un=Hn.cbSet,jn=Gn.cbSet,Wn=(Un.manager,null),qn=(Un.cbpairs.length<jn.cbpairs.length?Un.cbpairs:jn.cbpairs).head;null!=qn;){var Jn=qn.elt;if(Jn.a==Un&&Jn.b==jn||Jn.a==jn&&Jn.b==Un){Wn=Jn;break}qn=qn.next}if(null==Wn&&(null==t.callbacks.ZPP_CbSetPair.zpp_pool?Dn=new t.callbacks.ZPP_CbSetPair:(Dn=t.callbacks.ZPP_CbSetPair.zpp_pool,t.callbacks.ZPP_CbSetPair.zpp_pool=Dn.next,Dn.next=null),Dn.zip_listeners=!0,t.callbacks.ZPP_CbSet.setlt(Un,jn)?(Dn.a=Un,Dn.b=jn):(Dn.a=jn,Dn.b=Un),Wn=Dn,Un.cbpairs.add(Wn),jn!=Un&&jn.cbpairs.add(Wn)),Wn.zip_listeners&&(Wn.zip_listeners=!1,Wn.__validate()),null!=Wn.listeners.head){for(var $n=null,Xn=null,Yn=this.prelisteners;null!=Yn.head;){var Kn=Yn.head;Yn.head=Kn.next;var Qn=Kn;Qn.elt=null,Qn.next=t.util.ZNPNode_ZPP_InteractionListener.zpp_pool,t.util.ZNPNode_ZPP_InteractionListener.zpp_pool=Qn,null==Yn.head&&(Yn.pushmod=!0),Yn.modified=!0,Yn.length--}Yn.pushmod=!0;for(var ei,ti=null,ni=(Un.manager,null),ii=(Un.cbpairs.length<jn.cbpairs.length?Un.cbpairs:jn.cbpairs).head;null!=ii;){var ri=ii.elt;if(ri.a==Un&&ri.b==jn||ri.a==jn&&ri.b==Un){ni=ri;break}ii=ii.next}null==ni&&(null==t.callbacks.ZPP_CbSetPair.zpp_pool?ei=new t.callbacks.ZPP_CbSetPair:(ei=t.callbacks.ZPP_CbSetPair.zpp_pool,t.callbacks.ZPP_CbSetPair.zpp_pool=ei.next,ei.next=null),ei.zip_listeners=!0,t.callbacks.ZPP_CbSet.setlt(Un,jn)?(ei.a=Un,ei.b=jn):(ei.a=jn,ei.b=Un),ni=ei,Un.cbpairs.add(ni),jn!=Un&&jn.cbpairs.add(ni)),ni.zip_listeners&&(ni.zip_listeners=!1,ni.__validate());for(var oi=ni.listeners.head;null!=oi;){var ai=oi.elt;if(5==ai.event&&0!=(1&ai.itype)){var si,li=this.prelisteners;null==t.util.ZNPNode_ZPP_InteractionListener.zpp_pool?si=new t.util.ZNPNode_ZPP_InteractionListener:(si=t.util.ZNPNode_ZPP_InteractionListener.zpp_pool,t.util.ZNPNode_ZPP_InteractionListener.zpp_pool=si.next,si.next=null),si.elt=ai;var pi=si;null==ti?(pi.next=li.head,li.head=pi):(pi.next=ti.next,ti.next=pi),li.pushmod=li.modified=!0,li.length++,ti=pi,ln=ln||!ai.pure}oi=oi.next}if(null!=this.prelisteners.head){if(null==($n=t.phys.ZPP_Interactor.get(Hn,Gn))&&(Xn=t.space.ZPP_CallbackSet.get(Hn,Gn),this.add_callbackset(Xn)),null==$n||($n.COLLISIONstamp!=this.stamp||a)&&0==(4&$n.COLLISIONstate)){if(null!=Xn&&($n=Xn),null!=$n)for(var ui=this.prelisteners.head;null!=ui;)7==ui.elt.itype?($n.COLLISIONstamp=this.stamp,$n.SENSORstamp=this.stamp,$n.FLUIDstamp=this.stamp):$n.COLLISIONstamp=this.stamp,ui=ui.next;It.mutable=!0,null!=It.wrap_normal&&(It.wrap_normal.zpp_inner._immutable=!1),null!=It.wrap_contacts&&(It.wrap_contacts.zpp_inner.immutable=!1);var hi=It.active;It.active=!0;var ci=!0,_i=null,di=null,mi=It.innards.next;It.hc2=!1;for(var Pi=It.contacts.next;null!=Pi;){var fi=Pi;if(fi.stamp+e.Config.arbiterExpirationDelay<It.stamp){var xi,yi,vi=It.contacts;null==_i?(yi=(xi=vi.next).next,vi.next=yi,null==vi.next&&(vi.pushmod=!0)):(yi=(xi=_i.next).next,_i.next=yi,null==yi&&(vi.pushmod=!0)),xi._inuse=!1,vi.modified=!0,vi.length--,vi.pushmod=!0,Pi=yi;var gi,bi,zi=It.innards;null==di?(bi=(gi=zi.next).next,zi.next=bi,null==zi.next&&(zi.pushmod=!0)):(bi=(gi=di.next).next,di.next=bi,null==bi&&(zi.pushmod=!0)),gi._inuse=!1,zi.modified=!0,zi.length--,zi.pushmod=!0,mi=bi;var wi=fi;wi.arbiter=null,wi.next=t.dynamics.ZPP_Contact.zpp_pool,t.dynamics.ZPP_Contact.zpp_pool=wi}else{var Zi=fi.inner,Ei=fi.active;fi.active=fi.stamp==It.stamp,fi.active&&(ci?(ci=!1,It.c1=Zi,It.oc1=fi):(It.hc2=!0,It.c2=Zi,It.oc2=fi)),Ei!=fi.active&&(It.contacts.modified=!0),_i=Pi,di=mi,mi=mi.next,Pi=Pi.next}}if(It.hc2){if(It.hpc2=!0,It.oc1.posOnly){var Mi=It.c1;It.c1=It.c2,It.c2=Mi;var Si=It.oc1;It.oc1=It.oc2,It.oc2=Si,It.hc2=!1}else It.oc2.posOnly&&(It.hc2=!1);It.oc1.posOnly&&(ci=!0)}else It.hpc2=!1;this.precb.zpp_inner.pre_arbiter=It,this.precb.zpp_inner.set=$n;for(var Ci=this.prelisteners.head;null!=Ci;){var Ni=Ci.elt;this.precb.zpp_inner.listener=Ni;var Ai,Li=this.precb.zpp_inner,Bi=$n.int1,Ti=$n.int2,Vi=Ni.options1,ki=Bi.cbTypes;if(Vi.nonemptyintersection(ki,Vi.includes)&&!Vi.nonemptyintersection(ki,Vi.excludes)){var Ii=Ni.options2,Oi=Ti.cbTypes;Ai=Ii.nonemptyintersection(Oi,Ii.includes)&&!Ii.nonemptyintersection(Oi,Ii.excludes)}else Ai=!1;Ai?(Li.int1=Bi,Li.int2=Ti):(Li.int1=Ti,Li.int2=Bi),this.precb.zpp_inner.pre_swapped=Hn!=this.precb.zpp_inner.int1;var Ri,Hi=Ni.handlerp(this.precb);null!=Hi&&(null==t.util.ZPP_Flags.PreFlag_ACCEPT&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.PreFlag_ACCEPT=new e.callbacks.PreFlag,t.util.ZPP_Flags.internal=!1),Hi==t.util.ZPP_Flags.PreFlag_ACCEPT?Ri=5:(null==t.util.ZPP_Flags.PreFlag_ACCEPT_ONCE&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.PreFlag_ACCEPT_ONCE=new e.callbacks.PreFlag,t.util.ZPP_Flags.internal=!1),Hi==t.util.ZPP_Flags.PreFlag_ACCEPT_ONCE?Ri=1:(null==t.util.ZPP_Flags.PreFlag_IGNORE&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.PreFlag_IGNORE=new e.callbacks.PreFlag,t.util.ZPP_Flags.internal=!1),Ri=Hi==t.util.ZPP_Flags.PreFlag_IGNORE?6:2)),It.immState=Ri),Ci=Ci.next}if(It.mutable=!1,null!=It.wrap_normal&&(It.wrap_normal.zpp_inner._immutable=!0),null!=It.wrap_contacts&&(It.wrap_contacts.zpp_inner.immutable=!0),It.active=hi,null!=$n)for(var Fi=this.prelisteners.head;null!=Fi;)7==Fi.elt.itype?($n.COLLISIONstate=It.immState,$n.SENSORstate=It.immState,$n.FLUIDstate=It.immState):$n.COLLISIONstate=It.immState,Fi=Fi.next}else null==$n?0==(4&It.immState)&&(It.immState=1):It.immState=$n.COLLISIONstate;Fn=Fn.next}else Fn=Fn.next}else Fn=Fn.next}Rn=Rn.next}if(ln&&0==(4&It.immState)){if(2==It.b1.type){var Di=It.b1;Di.world||(Di.component.waket=this.stamp+(this.midstep?0:1),3==Di.type&&(Di.kinematicDelaySleep=!0),Di.component.sleeping&&this.really_wake(Di,!1))}if(2==It.b1.type){var Gi=It.b2;Gi.world||(Gi.component.waket=this.stamp+(this.midstep?0:1),3==Gi.type&&(Gi.kinematicDelaySleep=!0),Gi.component.sleeping&&this.really_wake(Gi,!1))}}}if(0!=(1&It.immState)){if(2==It.b1.type&&It.b1.component.sleeping){var Ui=It.b1;Ui.world||(Ui.component.waket=this.stamp+(this.midstep?0:1),3==Ui.type&&(Ui.kinematicDelaySleep=!0),Ui.component.sleeping&&this.really_wake(Ui,!1))}if(2==It.b2.type&&It.b2.component.sleeping){var ji=It.b2;ji.world||(ji.component.waket=this.stamp+(this.midstep?0:1),3==ji.type&&(ji.kinematicDelaySleep=!0),ji.component.sleeping&&this.really_wake(ji,!1))}}if(It.sleeping){var Wi;It.sleeping=!1,null==t.util.ZNPNode_ZPP_ColArbiter.zpp_pool?Wi=new t.util.ZNPNode_ZPP_ColArbiter:(Wi=t.util.ZNPNode_ZPP_ColArbiter.zpp_pool,t.util.ZNPNode_ZPP_ColArbiter.zpp_pool=Wi.next,Wi.next=null),Wi.elt=It;var qi=Wi;qi.next=Bt.head,Bt.head=qi,Bt.modified=!0,Bt.length++}l=It}else if(Ot){var Ji=It;Ji.userdef_dyn_fric=!1,Ji.userdef_stat_fric=!1,Ji.userdef_restitution=!1,Ji.userdef_rfric=!1,Ji.__ref_edge1=Ji.__ref_edge2=null,Ji.next=t.dynamics.ZPP_ColArbiter.zpp_pool,t.dynamics.ZPP_ColArbiter.zpp_pool=Ji,l=null}else l=It;else l=It}else{var $i;if(null==o){for(var Xi=null,Yi=(p.arbiters.length<u.arbiters.length?p:u).arbiters.head;null!=Yi;){var Ki=Yi.elt;if(Ki.id==C.id&&Ki.di==N.id){Xi=Ki;break}Yi=Yi.next}$i=Xi}else $i=o;var Qi,er=null==$i,tr=!1;if(er)null==t.dynamics.ZPP_SensorArbiter.zpp_pool?Qi=new t.dynamics.ZPP_SensorArbiter:(Qi=t.dynamics.ZPP_SensorArbiter.zpp_pool,t.dynamics.ZPP_SensorArbiter.zpp_pool=Qi.next,Qi.next=null);else if(null==$i.sensorarb){$i.cleared=!0;for(var nr=$i.b1.arbiters,ir=null,rr=nr.head;null!=rr;){if(rr.elt==$i){var or,ar;null==ir?(ar=(or=nr.head).next,nr.head=ar,null==nr.head&&(nr.pushmod=!0)):(ar=(or=ir.next).next,ir.next=ar,null==ar&&(nr.pushmod=!0));var sr=or;sr.elt=null,sr.next=t.util.ZNPNode_ZPP_Arbiter.zpp_pool,t.util.ZNPNode_ZPP_Arbiter.zpp_pool=sr,nr.modified=!0,nr.length--,nr.pushmod=!0;break}ir=rr,rr=rr.next}for(var lr=$i.b2.arbiters,pr=null,ur=lr.head;null!=ur;){if(ur.elt==$i){var hr,cr;null==pr?(cr=(hr=lr.head).next,lr.head=cr,null==lr.head&&(lr.pushmod=!0)):(cr=(hr=pr.next).next,pr.next=cr,null==cr&&(lr.pushmod=!0));var _r=hr;_r.elt=null,_r.next=t.util.ZNPNode_ZPP_Arbiter.zpp_pool,t.util.ZNPNode_ZPP_Arbiter.zpp_pool=_r,lr.modified=!0,lr.length--,lr.pushmod=!0;break}pr=ur,ur=ur.next}null!=$i.pair&&($i.pair.arb=null,$i.pair=null),$i.active=!1,this.f_arbiters.modified=!0,null==t.dynamics.ZPP_SensorArbiter.zpp_pool?Qi=new t.dynamics.ZPP_SensorArbiter:(Qi=t.dynamics.ZPP_SensorArbiter.zpp_pool,t.dynamics.ZPP_SensorArbiter.zpp_pool=Qi.next,Qi.next=null),Qi.intchange=!0,er=!0,tr=!0}else Qi=$i.sensorarb;if(er||Qi.stamp!=this.stamp||a)if(Qi.stamp=this.stamp,t.geom.ZPP_Collide.testCollide(C,N)){if(er){var dr=N.id;Qi.b1=n.body,Qi.ws1=n,Qi.b2=i.body,Qi.ws2=i,Qi.id=C.id,Qi.di=dr;var mr,Pr=Qi.b1.arbiters;null==t.util.ZNPNode_ZPP_Arbiter.zpp_pool?mr=new t.util.ZNPNode_ZPP_Arbiter:(mr=t.util.ZNPNode_ZPP_Arbiter.zpp_pool,t.util.ZNPNode_ZPP_Arbiter.zpp_pool=mr.next,mr.next=null),mr.elt=Qi;var fr=mr;fr.next=Pr.head,Pr.head=fr,Pr.modified=!0,Pr.length++;var xr,yr=Qi.b2.arbiters;null==t.util.ZNPNode_ZPP_Arbiter.zpp_pool?xr=new t.util.ZNPNode_ZPP_Arbiter:(xr=t.util.ZNPNode_ZPP_Arbiter.zpp_pool,t.util.ZNPNode_ZPP_Arbiter.zpp_pool=xr.next,xr.next=null),xr.elt=Qi;var vr=xr;vr.next=yr.head,yr.head=vr,yr.modified=!0,yr.length++,Qi.active=!0,Qi.present=0,Qi.cleared=!1,Qi.sleeping=!1,Qi.fresh=!1,Qi.presentable=!1;var gr,br=this.s_arbiters;null==t.util.ZNPNode_ZPP_SensorArbiter.zpp_pool?gr=new t.util.ZNPNode_ZPP_SensorArbiter:(gr=t.util.ZNPNode_ZPP_SensorArbiter.zpp_pool,t.util.ZNPNode_ZPP_SensorArbiter.zpp_pool=gr.next,gr.next=null),gr.elt=Qi;var zr=gr;zr.next=br.head,br.head=zr,br.modified=!0,br.length++,Qi.fresh=!tr}else Qi.fresh=Qi.up_stamp<this.stamp-1||Qi.endGenerated==this.stamp&&a;if(Qi.up_stamp=Qi.stamp,Qi.fresh||0==(4&Qi.immState)){Qi.immState=1;for(var wr=!1,Zr=Qi.ws1.id>Qi.ws2.id?Qi.ws2:Qi.ws1,Er=Qi.ws1.id>Qi.ws2.id?Qi.ws1:Qi.ws2,Mr=this.mrca1;null!=Mr.head;){var Sr=Mr.head;Mr.head=Sr.next;var Cr=Sr;Cr.elt=null,Cr.next=t.util.ZNPNode_ZPP_Interactor.zpp_pool,t.util.ZNPNode_ZPP_Interactor.zpp_pool=Cr,null==Mr.head&&(Mr.pushmod=!0),Mr.modified=!0,Mr.length--}Mr.pushmod=!0;for(var Nr=this.mrca2;null!=Nr.head;){var Ar=Nr.head;Nr.head=Ar.next;var Lr=Ar;Lr.elt=null,Lr.next=t.util.ZNPNode_ZPP_Interactor.zpp_pool,t.util.ZNPNode_ZPP_Interactor.zpp_pool=Lr,null==Nr.head&&(Nr.pushmod=!0),Nr.modified=!0,Nr.length--}if(Nr.pushmod=!0,null!=Zr.cbSet){var Br,Tr=this.mrca1;null==t.util.ZNPNode_ZPP_Interactor.zpp_pool?Br=new t.util.ZNPNode_ZPP_Interactor:(Br=t.util.ZNPNode_ZPP_Interactor.zpp_pool,t.util.ZNPNode_ZPP_Interactor.zpp_pool=Br.next,Br.next=null),Br.elt=Zr;var Vr=Br;Vr.next=Tr.head,Tr.head=Vr,Tr.modified=!0,Tr.length++}if(null!=Zr.body.cbSet){var kr,Ir=this.mrca1,Or=Zr.body;null==t.util.ZNPNode_ZPP_Interactor.zpp_pool?kr=new t.util.ZNPNode_ZPP_Interactor:(kr=t.util.ZNPNode_ZPP_Interactor.zpp_pool,t.util.ZNPNode_ZPP_Interactor.zpp_pool=kr.next,kr.next=null),kr.elt=Or;var Rr=kr;Rr.next=Ir.head,Ir.head=Rr,Ir.modified=!0,Ir.length++}if(null!=Er.cbSet){var Hr,Fr=this.mrca2;null==t.util.ZNPNode_ZPP_Interactor.zpp_pool?Hr=new t.util.ZNPNode_ZPP_Interactor:(Hr=t.util.ZNPNode_ZPP_Interactor.zpp_pool,t.util.ZNPNode_ZPP_Interactor.zpp_pool=Hr.next,Hr.next=null),Hr.elt=Er;var Dr=Hr;Dr.next=Fr.head,Fr.head=Dr,Fr.modified=!0,Fr.length++}if(null!=Er.body.cbSet){var Gr,Ur=this.mrca2,jr=Er.body;null==t.util.ZNPNode_ZPP_Interactor.zpp_pool?Gr=new t.util.ZNPNode_ZPP_Interactor:(Gr=t.util.ZNPNode_ZPP_Interactor.zpp_pool,t.util.ZNPNode_ZPP_Interactor.zpp_pool=Gr.next,Gr.next=null),Gr.elt=jr;var Wr=Gr;Wr.next=Ur.head,Ur.head=Wr,Ur.modified=!0,Ur.length++}for(var qr=Zr.body.compound,Jr=Er.body.compound;qr!=Jr;)if((null==qr?0:qr.depth)<(null==Jr?0:Jr.depth)){if(null!=Jr.cbSet){var $r,Xr=this.mrca2;null==t.util.ZNPNode_ZPP_Interactor.zpp_pool?$r=new t.util.ZNPNode_ZPP_Interactor:($r=t.util.ZNPNode_ZPP_Interactor.zpp_pool,t.util.ZNPNode_ZPP_Interactor.zpp_pool=$r.next,$r.next=null),$r.elt=Jr;var Yr=$r;Yr.next=Xr.head,Xr.head=Yr,Xr.modified=!0,Xr.length++}Jr=Jr.compound}else{if(null!=qr.cbSet){var Kr,Qr=this.mrca1;null==t.util.ZNPNode_ZPP_Interactor.zpp_pool?Kr=new t.util.ZNPNode_ZPP_Interactor:(Kr=t.util.ZNPNode_ZPP_Interactor.zpp_pool,t.util.ZNPNode_ZPP_Interactor.zpp_pool=Kr.next,Kr.next=null),Kr.elt=qr;var eo=Kr;eo.next=Qr.head,Qr.head=eo,Qr.modified=!0,Qr.length++}qr=qr.compound}for(var to=this.mrca1.head;null!=to;){for(var no=to.elt,io=this.mrca2.head;null!=io;){for(var ro,oo=io.elt,ao=no.cbSet,so=oo.cbSet,lo=(ao.manager,null),po=(ao.cbpairs.length<so.cbpairs.length?ao.cbpairs:so.cbpairs).head;null!=po;){var uo=po.elt;if(uo.a==ao&&uo.b==so||uo.a==so&&uo.b==ao){lo=uo;break}po=po.next}if(null==lo&&(null==t.callbacks.ZPP_CbSetPair.zpp_pool?ro=new t.callbacks.ZPP_CbSetPair:(ro=t.callbacks.ZPP_CbSetPair.zpp_pool,t.callbacks.ZPP_CbSetPair.zpp_pool=ro.next,ro.next=null),ro.zip_listeners=!0,t.callbacks.ZPP_CbSet.setlt(ao,so)?(ro.a=ao,ro.b=so):(ro.a=so,ro.b=ao),lo=ro,ao.cbpairs.add(lo),so!=ao&&so.cbpairs.add(lo)),lo.zip_listeners&&(lo.zip_listeners=!1,lo.__validate()),null!=lo.listeners.head){for(var ho=null,co=null,_o=this.prelisteners;null!=_o.head;){var mo=_o.head;_o.head=mo.next;var Po=mo;Po.elt=null,Po.next=t.util.ZNPNode_ZPP_InteractionListener.zpp_pool,t.util.ZNPNode_ZPP_InteractionListener.zpp_pool=Po,null==_o.head&&(_o.pushmod=!0),_o.modified=!0,_o.length--}_o.pushmod=!0;for(var fo,xo=null,yo=(ao.manager,null),vo=(ao.cbpairs.length<so.cbpairs.length?ao.cbpairs:so.cbpairs).head;null!=vo;){var go=vo.elt;if(go.a==ao&&go.b==so||go.a==so&&go.b==ao){yo=go;break}vo=vo.next}null==yo&&(null==t.callbacks.ZPP_CbSetPair.zpp_pool?fo=new t.callbacks.ZPP_CbSetPair:(fo=t.callbacks.ZPP_CbSetPair.zpp_pool,t.callbacks.ZPP_CbSetPair.zpp_pool=fo.next,fo.next=null),fo.zip_listeners=!0,t.callbacks.ZPP_CbSet.setlt(ao,so)?(fo.a=ao,fo.b=so):(fo.a=so,fo.b=ao),yo=fo,ao.cbpairs.add(yo),so!=ao&&so.cbpairs.add(yo)),yo.zip_listeners&&(yo.zip_listeners=!1,yo.__validate());for(var bo=yo.listeners.head;null!=bo;){var zo=bo.elt;if(5==zo.event&&0!=(2&zo.itype)){var wo,Zo=this.prelisteners;null==t.util.ZNPNode_ZPP_InteractionListener.zpp_pool?wo=new t.util.ZNPNode_ZPP_InteractionListener:(wo=t.util.ZNPNode_ZPP_InteractionListener.zpp_pool,t.util.ZNPNode_ZPP_InteractionListener.zpp_pool=wo.next,wo.next=null),wo.elt=zo;var Eo=wo;null==xo?(Eo.next=Zo.head,Zo.head=Eo):(Eo.next=xo.next,xo.next=Eo),Zo.pushmod=Zo.modified=!0,Zo.length++,xo=Eo,wr=wr||!zo.pure}bo=bo.next}if(null!=this.prelisteners.head){if(null==(ho=t.phys.ZPP_Interactor.get(no,oo))&&(co=t.space.ZPP_CallbackSet.get(no,oo),this.add_callbackset(co)),null==ho||(ho.SENSORstamp!=this.stamp||a)&&0==(4&ho.SENSORstate)){if(null!=co&&(ho=co),null!=ho)for(var Mo=this.prelisteners.head;null!=Mo;)7==Mo.elt.itype?(ho.COLLISIONstamp=this.stamp,ho.SENSORstamp=this.stamp,ho.FLUIDstamp=this.stamp):ho.SENSORstamp=this.stamp,Mo=Mo.next;var So=Qi.active;Qi.active=!0,this.precb.zpp_inner.pre_arbiter=Qi,this.precb.zpp_inner.set=ho;for(var Co=this.prelisteners.head;null!=Co;){var No=Co.elt;this.precb.zpp_inner.listener=No;var Ao,Lo=this.precb.zpp_inner,Bo=ho.int1,To=ho.int2,Vo=No.options1,ko=Bo.cbTypes;if(Vo.nonemptyintersection(ko,Vo.includes)&&!Vo.nonemptyintersection(ko,Vo.excludes)){var Io=No.options2,Oo=To.cbTypes;Ao=Io.nonemptyintersection(Oo,Io.includes)&&!Io.nonemptyintersection(Oo,Io.excludes)}else Ao=!1;Ao?(Lo.int1=Bo,Lo.int2=To):(Lo.int1=To,Lo.int2=Bo),this.precb.zpp_inner.pre_swapped=no!=this.precb.zpp_inner.int1;var Ro,Ho=No.handlerp(this.precb);null!=Ho&&(null==t.util.ZPP_Flags.PreFlag_ACCEPT&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.PreFlag_ACCEPT=new e.callbacks.PreFlag,t.util.ZPP_Flags.internal=!1),Ho==t.util.ZPP_Flags.PreFlag_ACCEPT?Ro=5:(null==t.util.ZPP_Flags.PreFlag_ACCEPT_ONCE&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.PreFlag_ACCEPT_ONCE=new e.callbacks.PreFlag,t.util.ZPP_Flags.internal=!1),Ho==t.util.ZPP_Flags.PreFlag_ACCEPT_ONCE?Ro=1:(null==t.util.ZPP_Flags.PreFlag_IGNORE&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.PreFlag_IGNORE=new e.callbacks.PreFlag,t.util.ZPP_Flags.internal=!1),Ro=Ho==t.util.ZPP_Flags.PreFlag_IGNORE?6:2)),Qi.immState=Ro),Co=Co.next}if(Qi.active=So,null!=ho)for(var Fo=this.prelisteners.head;null!=Fo;)7==Fo.elt.itype?(ho.COLLISIONstate=Qi.immState,ho.SENSORstate=Qi.immState,ho.FLUIDstate=Qi.immState):ho.SENSORstate=Qi.immState,Fo=Fo.next}else null==ho?0==(4&Qi.immState)&&(Qi.immState=1):Qi.immState=ho.SENSORstate;io=io.next}else io=io.next}else io=io.next}to=to.next}if(wr&&0==(4&Qi.immState)){if(1!=Qi.b1.type){var Do=Qi.b1;Do.world||(Do.component.waket=this.stamp+(this.midstep?0:1),3==Do.type&&(Do.kinematicDelaySleep=!0),Do.component.sleeping&&this.really_wake(Do,!1))}if(1!=Qi.b2.type){var Go=Qi.b2;Go.world||(Go.component.waket=this.stamp+(this.midstep?0:1),3==Go.type&&(Go.kinematicDelaySleep=!0),Go.component.sleeping&&this.really_wake(Go,!1))}}}if(Qi.sleeping){Qi.sleeping=!1;var Uo,jo=this.s_arbiters;null==t.util.ZNPNode_ZPP_SensorArbiter.zpp_pool?Uo=new t.util.ZNPNode_ZPP_SensorArbiter:(Uo=t.util.ZNPNode_ZPP_SensorArbiter.zpp_pool,t.util.ZNPNode_ZPP_SensorArbiter.zpp_pool=Uo.next,Uo.next=null),Uo.elt=Qi;var Wo=Uo;Wo.next=jo.head,jo.head=Wo,jo.modified=!0,jo.length++}l=Qi}else if(er){var qo=Qi;qo.next=t.dynamics.ZPP_SensorArbiter.zpp_pool,t.dynamics.ZPP_SensorArbiter.zpp_pool=qo,l=null}else l=Qi;else l=Qi}}return l},t.space.ZPP_Space.prototype.mrca1=null,t.space.ZPP_Space.prototype.mrca2=null,t.space.ZPP_Space.prototype.MRCA_chains=function(e,n){for(var i=this.mrca1;null!=i.head;){var r=i.head;i.head=r.next;var o=r;o.elt=null,o.next=t.util.ZNPNode_ZPP_Interactor.zpp_pool,t.util.ZNPNode_ZPP_Interactor.zpp_pool=o,null==i.head&&(i.pushmod=!0),i.modified=!0,i.length--}i.pushmod=!0;for(var a=this.mrca2;null!=a.head;){var s=a.head;a.head=s.next;var l=s;l.elt=null,l.next=t.util.ZNPNode_ZPP_Interactor.zpp_pool,t.util.ZNPNode_ZPP_Interactor.zpp_pool=l,null==a.head&&(a.pushmod=!0),a.modified=!0,a.length--}if(a.pushmod=!0,null!=e.cbSet){var p,u=this.mrca1;null==t.util.ZNPNode_ZPP_Interactor.zpp_pool?p=new t.util.ZNPNode_ZPP_Interactor:(p=t.util.ZNPNode_ZPP_Interactor.zpp_pool,t.util.ZNPNode_ZPP_Interactor.zpp_pool=p.next,p.next=null),p.elt=e;var h=p;h.next=u.head,u.head=h,u.modified=!0,u.length++}if(null!=e.body.cbSet){var c,_=this.mrca1,d=e.body;null==t.util.ZNPNode_ZPP_Interactor.zpp_pool?c=new t.util.ZNPNode_ZPP_Interactor:(c=t.util.ZNPNode_ZPP_Interactor.zpp_pool,t.util.ZNPNode_ZPP_Interactor.zpp_pool=c.next,c.next=null),c.elt=d;var m=c;m.next=_.head,_.head=m,_.modified=!0,_.length++}if(null!=n.cbSet){var P,f=this.mrca2;null==t.util.ZNPNode_ZPP_Interactor.zpp_pool?P=new t.util.ZNPNode_ZPP_Interactor:(P=t.util.ZNPNode_ZPP_Interactor.zpp_pool,t.util.ZNPNode_ZPP_Interactor.zpp_pool=P.next,P.next=null),P.elt=n;var x=P;x.next=f.head,f.head=x,f.modified=!0,f.length++}if(null!=n.body.cbSet){var y,v=this.mrca2,g=n.body;null==t.util.ZNPNode_ZPP_Interactor.zpp_pool?y=new t.util.ZNPNode_ZPP_Interactor:(y=t.util.ZNPNode_ZPP_Interactor.zpp_pool,t.util.ZNPNode_ZPP_Interactor.zpp_pool=y.next,y.next=null),y.elt=g;var b=y;b.next=v.head,v.head=b,v.modified=!0,v.length++}for(var z=e.body.compound,w=n.body.compound;z!=w;)if((null==z?0:z.depth)<(null==w?0:w.depth)){if(null!=w.cbSet){var Z,E=this.mrca2;null==t.util.ZNPNode_ZPP_Interactor.zpp_pool?Z=new t.util.ZNPNode_ZPP_Interactor:(Z=t.util.ZNPNode_ZPP_Interactor.zpp_pool,t.util.ZNPNode_ZPP_Interactor.zpp_pool=Z.next,Z.next=null),Z.elt=w;var M=Z;M.next=E.head,E.head=M,E.modified=!0,E.length++}w=w.compound}else{if(null!=z.cbSet){var S,C=this.mrca1;null==t.util.ZNPNode_ZPP_Interactor.zpp_pool?S=new t.util.ZNPNode_ZPP_Interactor:(S=t.util.ZNPNode_ZPP_Interactor.zpp_pool,t.util.ZNPNode_ZPP_Interactor.zpp_pool=S.next,S.next=null),S.elt=z;var N=S;N.next=C.head,C.head=N,C.modified=!0,C.length++}z=z.compound}},t.space.ZPP_Space.prototype.inlined_MRCA_chains=function(e,n){for(var i=this.mrca1;null!=i.head;){var r=i.head;i.head=r.next;var o=r;o.elt=null,o.next=t.util.ZNPNode_ZPP_Interactor.zpp_pool,t.util.ZNPNode_ZPP_Interactor.zpp_pool=o,null==i.head&&(i.pushmod=!0),i.modified=!0,i.length--}i.pushmod=!0;for(var a=this.mrca2;null!=a.head;){var s=a.head;a.head=s.next;var l=s;l.elt=null,l.next=t.util.ZNPNode_ZPP_Interactor.zpp_pool,t.util.ZNPNode_ZPP_Interactor.zpp_pool=l,null==a.head&&(a.pushmod=!0),a.modified=!0,a.length--}if(a.pushmod=!0,null!=e.cbSet){var p,u=this.mrca1;null==t.util.ZNPNode_ZPP_Interactor.zpp_pool?p=new t.util.ZNPNode_ZPP_Interactor:(p=t.util.ZNPNode_ZPP_Interactor.zpp_pool,t.util.ZNPNode_ZPP_Interactor.zpp_pool=p.next,p.next=null),p.elt=e;var h=p;h.next=u.head,u.head=h,u.modified=!0,u.length++}if(null!=e.body.cbSet){var c,_=this.mrca1,d=e.body;null==t.util.ZNPNode_ZPP_Interactor.zpp_pool?c=new t.util.ZNPNode_ZPP_Interactor:(c=t.util.ZNPNode_ZPP_Interactor.zpp_pool,t.util.ZNPNode_ZPP_Interactor.zpp_pool=c.next,c.next=null),c.elt=d;var m=c;m.next=_.head,_.head=m,_.modified=!0,_.length++}if(null!=n.cbSet){var P,f=this.mrca2;null==t.util.ZNPNode_ZPP_Interactor.zpp_pool?P=new t.util.ZNPNode_ZPP_Interactor:(P=t.util.ZNPNode_ZPP_Interactor.zpp_pool,t.util.ZNPNode_ZPP_Interactor.zpp_pool=P.next,P.next=null),P.elt=n;var x=P;x.next=f.head,f.head=x,f.modified=!0,f.length++}if(null!=n.body.cbSet){var y,v=this.mrca2,g=n.body;null==t.util.ZNPNode_ZPP_Interactor.zpp_pool?y=new t.util.ZNPNode_ZPP_Interactor:(y=t.util.ZNPNode_ZPP_Interactor.zpp_pool,t.util.ZNPNode_ZPP_Interactor.zpp_pool=y.next,y.next=null),y.elt=g;var b=y;b.next=v.head,v.head=b,v.modified=!0,v.length++}for(var z=e.body.compound,w=n.body.compound;z!=w;)if((null==z?0:z.depth)<(null==w?0:w.depth)){if(null!=w.cbSet){var Z,E=this.mrca2;null==t.util.ZNPNode_ZPP_Interactor.zpp_pool?Z=new t.util.ZNPNode_ZPP_Interactor:(Z=t.util.ZNPNode_ZPP_Interactor.zpp_pool,t.util.ZNPNode_ZPP_Interactor.zpp_pool=Z.next,Z.next=null),Z.elt=w;var M=Z;M.next=E.head,E.head=M,E.modified=!0,E.length++}w=w.compound}else{if(null!=z.cbSet){var S,C=this.mrca1;null==t.util.ZNPNode_ZPP_Interactor.zpp_pool?S=new t.util.ZNPNode_ZPP_Interactor:(S=t.util.ZNPNode_ZPP_Interactor.zpp_pool,t.util.ZNPNode_ZPP_Interactor.zpp_pool=S.next,S.next=null),S.elt=z;var N=S;N.next=C.head,C.head=N,C.modified=!0,C.length++}z=z.compound}},t.space.ZPP_Space.prototype.__class__=t.space.ZPP_Space,t.space.ZPP_SweepData=l["zpp_nape.space.ZPP_SweepData"]=function(){this.aabb=null,this.shape=null,this.prev=null,this.next=null},t.space.ZPP_SweepData.__name__=["zpp_nape","space","ZPP_SweepData"],t.space.ZPP_SweepData.prototype.next=null,t.space.ZPP_SweepData.prototype.prev=null,t.space.ZPP_SweepData.prototype.shape=null,t.space.ZPP_SweepData.prototype.aabb=null,t.space.ZPP_SweepData.prototype.free=function(){this.prev=null,this.shape=null,this.aabb=null},t.space.ZPP_SweepData.prototype.alloc=function(){},t.space.ZPP_SweepData.prototype.gt=function(e){return this.aabb.minx>e.aabb.minx},t.space.ZPP_SweepData.prototype.__class__=t.space.ZPP_SweepData,t.space.ZPP_SweepPhase=l["zpp_nape.space.ZPP_SweepPhase"]=function(e){this.failed=null,this.list=null,t.space.ZPP_Broadphase.call(this),this.space=e,this.is_sweep=!0,this.sweep=this},t.space.ZPP_SweepPhase.__name__=["zpp_nape","space","ZPP_SweepPhase"],t.space.ZPP_SweepPhase.__super__=t.space.ZPP_Broadphase,t.space.ZPP_Broadphase.prototype)t.space.ZPP_SweepPhase.prototype[u]=t.space.ZPP_Broadphase.prototype[u];for(var u in t.space.ZPP_SweepPhase.prototype.list=null,t.space.ZPP_SweepPhase.prototype.__insert=function(e){var n;null==t.space.ZPP_SweepData.zpp_pool?n=new t.space.ZPP_SweepData:(n=t.space.ZPP_SweepData.zpp_pool,t.space.ZPP_SweepData.zpp_pool=n.next,n.next=null),e.sweep=n,n.shape=e,n.aabb=e.aabb,n.next=this.list,null!=this.list&&(this.list.prev=n),this.list=n},t.space.ZPP_SweepPhase.prototype.__remove=function(e){var n=e.sweep;null==n.prev?this.list=n.next:n.prev.next=n.next,null!=n.next&&(n.next.prev=n.prev),e.sweep=null;var i=n;i.prev=null,i.shape=null,i.aabb=null,i.next=t.space.ZPP_SweepData.zpp_pool,t.space.ZPP_SweepData.zpp_pool=i},t.space.ZPP_SweepPhase.prototype.__sync=function(e){if(!this.space.continuous&&e.zip_aabb&&null!=e.body)if(e.zip_aabb=!1,0==e.type){var t=e.circle;if(t.zip_worldCOM&&null!=t.body){if(t.zip_worldCOM=!1,t.zip_localCOM){if(t.zip_localCOM=!1,1==t.type){var i=t.polygon;if(null==i.lverts.next)throw new n._Boot.HaxeError("Error: An empty polygon has no meaningful localCOM");if(null==i.lverts.next.next)i.localCOMx=i.lverts.next.x,i.localCOMy=i.lverts.next.y;else if(null==i.lverts.next.next.next)i.localCOMx=i.lverts.next.x,i.localCOMy=i.lverts.next.y,i.localCOMx+=1*i.lverts.next.next.x,i.localCOMy+=1*i.lverts.next.next.y,i.localCOMx*=.5,i.localCOMy*=.5;else{i.localCOMx=0,i.localCOMy=0;var r=0,o=i.lverts.next,a=o,s=o=o.next;for(o=o.next;null!=o;){var l=o;r+=s.x*(l.y-a.y);var p=l.y*s.x-l.x*s.y;i.localCOMx+=(s.x+l.x)*p,i.localCOMy+=(s.y+l.y)*p,a=s,s=l,o=o.next}var u=o=i.lverts.next;r+=s.x*(u.y-a.y);var h=u.y*s.x-u.x*s.y;i.localCOMx+=(s.x+u.x)*h,i.localCOMy+=(s.y+u.y)*h,a=s,s=u;var c=o=o.next;r+=s.x*(c.y-a.y);var _=c.y*s.x-c.x*s.y;i.localCOMx+=(s.x+c.x)*_,i.localCOMy+=(s.y+c.y)*_;var d=r=1/(3*r);i.localCOMx*=d,i.localCOMy*=d}}null!=t.wrap_localCOM&&(t.wrap_localCOM.zpp_inner.x=t.localCOMx,t.wrap_localCOM.zpp_inner.y=t.localCOMy)}var m=t.body;m.zip_axis&&(m.zip_axis=!1,m.axisx=Math.sin(m.rot),m.axisy=Math.cos(m.rot)),t.worldCOMx=t.body.posx+(t.body.axisy*t.localCOMx-t.body.axisx*t.localCOMy),t.worldCOMy=t.body.posy+(t.localCOMx*t.body.axisx+t.localCOMy*t.body.axisy)}var P=t.radius,f=t.radius;t.aabb.minx=t.worldCOMx-P,t.aabb.miny=t.worldCOMy-f,t.aabb.maxx=t.worldCOMx+P,t.aabb.maxy=t.worldCOMy+f}else{var x=e.polygon;if(x.zip_gverts&&null!=x.body){x.zip_gverts=!1,x.validate_lverts();var y=x.body;y.zip_axis&&(y.zip_axis=!1,y.axisx=Math.sin(y.rot),y.axisy=Math.cos(y.rot));for(var v=x.lverts.next,g=x.gverts.next;null!=g;){var b=g,z=v;v=v.next,b.x=x.body.posx+(x.body.axisy*z.x-x.body.axisx*z.y),b.y=x.body.posy+(z.x*x.body.axisx+z.y*x.body.axisy),g=g.next}}if(null==x.lverts.next)throw new n._Boot.HaxeError("Error: An empty polygon has no meaningful bounds");var w=x.gverts.next;x.aabb.minx=w.x,x.aabb.miny=w.y,x.aabb.maxx=w.x,x.aabb.maxy=w.y;for(var Z=x.gverts.next.next;null!=Z;){var E=Z;E.x<x.aabb.minx&&(x.aabb.minx=E.x),E.x>x.aabb.maxx&&(x.aabb.maxx=E.x),E.y<x.aabb.miny&&(x.aabb.miny=E.y),E.y>x.aabb.maxy&&(x.aabb.maxy=E.y),Z=Z.next}}},t.space.ZPP_SweepPhase.prototype.sync_broadphase=function(){if(this.space.validation(),null!=this.list)for(var e=this.list.next;null!=e;){var t=e.next,n=e.prev;if(e.aabb.minx>n.aabb.minx)e=t;else{for(;null!=n.prev&&n.prev.aabb.minx>e.aabb.minx;)n=n.prev;var i=e.prev;i.next=e.next,null!=e.next&&(e.next.prev=i),null==n.prev?(e.prev=null,this.list=e,e.next=n,n.prev=e):(e.prev=n.prev,n.prev=e,e.prev.next=e,e.next=n),e=t}}},t.space.ZPP_SweepPhase.prototype.sync_broadphase_fast=function(){for(var e=this.list.next;null!=e;){var t=e.next,n=e.prev;if(e.aabb.minx>n.aabb.minx)e=t;else{for(;null!=n.prev&&n.prev.aabb.minx>e.aabb.minx;)n=n.prev;var i=e.prev;i.next=e.next,null!=e.next&&(e.next.prev=i),null==n.prev?(e.prev=null,this.list=e,e.next=n,n.prev=e):(e.prev=n.prev,n.prev=e,e.prev.next=e,e.next=n),e=t}}},t.space.ZPP_SweepPhase.prototype.broadphase=function(e,t){if(null!=this.list){for(var n=this.list.next;null!=n;){var i=n.next,r=n.prev;if(n.aabb.minx>r.aabb.minx)n=i;else{for(;null!=r.prev&&r.prev.aabb.minx>n.aabb.minx;)r=r.prev;var o=n.prev;o.next=n.next,null!=n.next&&(n.next.prev=o),null==r.prev?(n.prev=null,this.list=n,n.next=r,r.prev=n):(n.prev=r.prev,r.prev=n,n.prev.next=n,n.next=r),n=i}}for(var a=this.list;null!=a;){for(var s=a.next,l=a.shape,p=l.body,u=a.aabb.maxx;null!=s&&!(s.aabb.minx>u);){var h=s.shape,c=h.body;if(c!=p)if(1!=p.type||1!=c.type)if(p.component.sleeping&&c.component.sleeping)s=s.next;else{var _=l.aabb,d=h.aabb;d.miny>_.maxy||_.miny>d.maxy||(t?e.narrowPhase(l,h,2!=p.type||2!=c.type,null,!1):e.continuousEvent(l,h,2!=p.type||2!=c.type,null,!1)),s=s.next}else s=s.next;else s=s.next}a=a.next}}},t.space.ZPP_SweepPhase.prototype.clear=function(){for(;null!=this.list;)this.list.shape.removedFromSpace(),this.__remove(this.list.shape)},t.space.ZPP_SweepPhase.prototype.shapesUnderPoint=function(n,i,r,o){var a;this.sync_broadphase(),null==t.geom.ZPP_Vec2.zpp_pool?a=new t.geom.ZPP_Vec2:(a=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=a.next,a.next=null),a.weak=!1,a._immutable=!1,a.x=n,a.y=i;for(var s=a,l=null==o?new e.shape.ShapeList:o,p=this.list;null!=p&&p.aabb.minx>n;)p=p.next;for(;null!=p&&p.aabb.minx<=n;){if(p.aabb.maxx>=n&&p.aabb.miny<=i&&p.aabb.maxy>=i){var u,h=p.shape;if(null!=r){var c=h.filter;u=0!=(c.collisionMask&r.collisionGroup)&&0!=(r.collisionMask&c.collisionGroup)}else u=!0;u&&(0==h.type?t.geom.ZPP_Collide.circleContains(h.circle,s)&&l.push(h.outer):t.geom.ZPP_Collide.polyContains(h.polygon,s)&&l.push(h.outer))}p=p.next}var _=s;return null!=_.outer&&(_.outer.zpp_inner=null,_.outer=null),_._isimmutable=null,_._validate=null,_._invalidate=null,_.next=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=_,l},t.space.ZPP_SweepPhase.prototype.bodiesUnderPoint=function(n,i,r,o){var a;this.sync_broadphase(),null==t.geom.ZPP_Vec2.zpp_pool?a=new t.geom.ZPP_Vec2:(a=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=a.next,a.next=null),a.weak=!1,a._immutable=!1,a.x=n,a.y=i;for(var s=a,l=null==o?new e.phys.BodyList:o,p=this.list;null!=p&&p.aabb.minx>n;)p=p.next;for(;null!=p&&p.aabb.minx<=n;){if(p.aabb.maxx>=n&&p.aabb.miny<=i&&p.aabb.maxy>=i){var u=p.shape,h=u.body.outer;if(!l.has(h)){var c;if(null!=r){var _=u.filter;c=0!=(_.collisionMask&r.collisionGroup)&&0!=(r.collisionMask&_.collisionGroup)}else c=!0;c&&(0==u.type?t.geom.ZPP_Collide.circleContains(u.circle,s)&&l.push(h):t.geom.ZPP_Collide.polyContains(u.polygon,s)&&l.push(h))}}p=p.next}var d=s;return null!=d.outer&&(d.outer.zpp_inner=null,d.outer=null),d._isimmutable=null,d._validate=null,d._invalidate=null,d.next=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=d,l},t.space.ZPP_SweepPhase.prototype.shapesInAABB=function(n,i,r,o,a){this.sync_broadphase(),this.updateAABBShape(n);for(var s=this.aabbShape.zpp_inner.aabb,l=null==a?new e.shape.ShapeList:a,p=this.list;null!=p&&p.aabb.maxx<s.minx;)p=p.next;for(;null!=p&&p.aabb.minx<=s.maxx;){var u,h=p.shape;if(null!=o){var c=h.filter;u=0!=(c.collisionMask&o.collisionGroup)&&0!=(o.collisionMask&c.collisionGroup)}else u=!0;if(u)if(i)if(r)t.geom.ZPP_Collide.containTest(this.aabbShape.zpp_inner,h)&&l.push(h.outer);else{var _=p.aabb;if(_.minx>=s.minx&&_.miny>=s.miny&&_.maxx<=s.maxx&&_.maxy<=s.maxy)l.push(h.outer);else{var d=p.aabb;s.miny<=d.maxy&&d.miny<=s.maxy&&s.minx<=d.maxx&&d.minx<=s.maxx&&t.geom.ZPP_Collide.testCollide_safe(h,this.aabbShape.zpp_inner)&&l.push(h.outer)}}else{var m;if(r){var P=p.aabb;m=P.minx>=s.minx&&P.miny>=s.miny&&P.maxx<=s.maxx&&P.maxy<=s.maxy}else{var f=p.aabb;m=s.miny<=f.maxy&&f.miny<=s.maxy&&s.minx<=f.maxx&&f.minx<=s.maxx}m&&l.push(h.outer)}p=p.next}return l},t.space.ZPP_SweepPhase.prototype.failed=null,t.space.ZPP_SweepPhase.prototype.bodiesInAABB=function(n,i,r,o,a){this.sync_broadphase(),this.updateAABBShape(n);var s=this.aabbShape.zpp_inner.aabb,l=null==a?new e.phys.BodyList:a;null==this.failed&&(this.failed=new e.phys.BodyList);for(var p=this.list;null!=p&&p.aabb.maxx<s.minx;)p=p.next;for(;null!=p&&p.aabb.minx<=s.maxx;){var u=p.shape,h=u.body.outer,c=p.aabb;if(s.miny<=c.maxy&&c.miny<=s.maxy&&s.minx<=c.maxx&&c.minx<=s.maxx){var _;if(null!=o){var d=u.filter;_=0!=(d.collisionMask&o.collisionGroup)&&0!=(o.collisionMask&d.collisionGroup)}else _=!0;if(_)if(i)if(r){if(!this.failed.has(h)){var m=t.geom.ZPP_Collide.containTest(this.aabbShape.zpp_inner,u);!l.has(h)&&m?l.push(h):m||(l.remove(h),this.failed.push(h))}}else!l.has(h)&&t.geom.ZPP_Collide.testCollide_safe(u,this.aabbShape.zpp_inner)&&l.push(h);else if(r){if(!this.failed.has(h)){var P=u.aabb,f=P.minx>=s.minx&&P.miny>=s.miny&&P.maxx<=s.maxx&&P.maxy<=s.maxy;!l.has(h)&&f?l.push(h):f||(l.remove(h),this.failed.push(h))}}else{var x;if(l.has(h))x=!1;else{var y=u.aabb;x=y.minx>=s.minx&&y.miny>=s.miny&&y.maxx<=s.maxx&&y.maxy<=s.maxy}x&&l.push(h)}}p=p.next}return this.failed.clear(),l},t.space.ZPP_SweepPhase.prototype.shapesInCircle=function(n,i,r,o,a,s){this.sync_broadphase(),this.updateCircShape(n,i,r);for(var l=this.circShape.zpp_inner.aabb,p=null==s?new e.shape.ShapeList:s,u=this.list;null!=u&&u.aabb.maxx<l.minx;)u=u.next;for(;null!=u&&u.aabb.minx<=l.maxx;){var h=u.aabb;if(l.miny<=h.maxy&&h.miny<=l.maxy&&l.minx<=h.maxx&&h.minx<=l.maxx){var c,_=u.shape;if(null!=a){var d=_.filter;c=0!=(d.collisionMask&a.collisionGroup)&&0!=(a.collisionMask&d.collisionGroup)}else c=!0;c&&(o?t.geom.ZPP_Collide.containTest(this.circShape.zpp_inner,_)&&p.push(_.outer):t.geom.ZPP_Collide.testCollide_safe(_,this.circShape.zpp_inner)&&p.push(_.outer))}u=u.next}return p},t.space.ZPP_SweepPhase.prototype.bodiesInCircle=function(n,i,r,o,a,s){this.sync_broadphase(),this.updateCircShape(n,i,r);var l=this.circShape.zpp_inner.aabb,p=null==s?new e.phys.BodyList:s;null==this.failed&&(this.failed=new e.phys.BodyList);for(var u=this.list;null!=u&&u.aabb.maxx<l.minx;)u=u.next;for(;null!=u&&u.aabb.minx<=l.maxx;){var h=u.aabb;if(l.miny<=h.maxy&&h.miny<=l.maxy&&l.minx<=h.maxx&&h.minx<=l.maxx){var c,_=u.shape,d=_.body.outer;if(null!=a){var m=_.filter;c=0!=(m.collisionMask&a.collisionGroup)&&0!=(a.collisionMask&m.collisionGroup)}else c=!0;if(c)if(o){if(!this.failed.has(d)){var P=t.geom.ZPP_Collide.containTest(this.circShape.zpp_inner,_);!p.has(d)&&P?p.push(d):P||(p.remove(d),this.failed.push(d))}}else!p.has(d)&&t.geom.ZPP_Collide.testCollide_safe(_,this.circShape.zpp_inner)&&p.push(d)}u=u.next}return this.failed.clear(),p},t.space.ZPP_SweepPhase.prototype.shapesInShape=function(n,i,r,o){this.sync_broadphase(),this.validateShape(n);for(var a=n.aabb,s=null==o?new e.shape.ShapeList:o,l=this.list;null!=l&&l.aabb.maxx<a.minx;)l=l.next;for(;null!=l&&l.aabb.minx<=a.maxx;){var p=l.aabb;if(a.miny<=p.maxy&&p.miny<=a.maxy&&a.minx<=p.maxx&&p.minx<=a.maxx){var u,h=l.shape;if(null!=r){var c=h.filter;u=0!=(c.collisionMask&r.collisionGroup)&&0!=(r.collisionMask&c.collisionGroup)}else u=!0;u&&(i?t.geom.ZPP_Collide.containTest(n,h)&&s.push(h.outer):t.geom.ZPP_Collide.testCollide_safe(h,n)&&s.push(h.outer))}l=l.next}return s},t.space.ZPP_SweepPhase.prototype.bodiesInShape=function(n,i,r,o){this.sync_broadphase(),this.validateShape(n);var a=n.aabb,s=null==o?new e.phys.BodyList:o;null==this.failed&&(this.failed=new e.phys.BodyList);for(var l=this.list;null!=l&&l.aabb.maxx<a.minx;)l=l.next;for(;null!=l&&l.aabb.minx<=a.maxx;){var p=l.aabb;if(a.miny<=p.maxy&&p.miny<=a.maxy&&a.minx<=p.maxx&&p.minx<=a.maxx){var u,h=l.shape,c=h.body.outer;if(null!=r){var _=h.filter;u=0!=(_.collisionMask&r.collisionGroup)&&0!=(r.collisionMask&_.collisionGroup)}else u=!0;if(u)if(i){if(!this.failed.has(c)){var d=t.geom.ZPP_Collide.containTest(n,h);!s.has(c)&&d?s.push(c):d||(s.remove(c),this.failed.push(c))}}else!s.has(c)&&t.geom.ZPP_Collide.testCollide_safe(n,h)&&s.push(c)}l=l.next}return this.failed.clear(),s},t.space.ZPP_SweepPhase.prototype.rayCast=function(e,i,r){this.sync_broadphase(),e.validate_dir();var o=e.rayAABB(),a=e.maxdist,s=null;if(0==e.dirx)for(var l=this.list;null!=l&&l.aabb.minx<=o.minx;){var p,u=l.aabb;if(o.miny<=u.maxy&&u.miny<=o.maxy&&o.minx<=u.maxx&&u.minx<=o.maxx)if(null!=r){var h=l.shape.filter;p=0!=(h.collisionMask&r.collisionGroup)&&0!=(r.collisionMask&h.collisionGroup)}else p=!0;else p=!1;if(p){var c=e.aabbsect(l.aabb);if(c>=0&&c<a){var _=0==l.shape.type?e.circlesect(l.shape.circle,i,a):e.polysect(l.shape.polygon,i,a);if(null!=_){if(null!=_.zpp_inner.next)throw new n._Boot.HaxeError("Error: This object has been disposed of and cannot be used");if(a=_.zpp_inner.toiDistance,null!=s){if(null!=s.zpp_inner.next)throw new n._Boot.HaxeError("Error: This object has been disposed of and cannot be used");s.zpp_inner.free()}s=_}}}l=l.next}else if(e.dirx<0){for(var d=this.list,m=null;null!=d&&d.aabb.minx<=o.maxx;)m=d,d=d.next;for(d=m;null!=d;){var P,f=d.aabb;if(o.miny<=f.maxy&&f.miny<=o.maxy&&o.minx<=f.maxx&&f.minx<=o.maxx)if(null!=r){var x=d.shape.filter;P=0!=(x.collisionMask&r.collisionGroup)&&0!=(r.collisionMask&x.collisionGroup)}else P=!0;else P=!1;if(P){var y=e.aabbsect(d.aabb);if(y>=0&&y<a){var v=0==d.shape.type?e.circlesect(d.shape.circle,i,a):e.polysect(d.shape.polygon,i,a);if(null!=v){if(null!=v.zpp_inner.next)throw new n._Boot.HaxeError("Error: This object has been disposed of and cannot be used");if(a=v.zpp_inner.toiDistance,null!=s){if(null!=s.zpp_inner.next)throw new n._Boot.HaxeError("Error: This object has been disposed of and cannot be used");s.zpp_inner.free()}s=v}}}d=d.prev}}else for(var g=this.list;null!=g&&g.aabb.minx<=o.maxx&&g.aabb.minx<e.originx+e.dirx*a;){var b,z=g.aabb;if(o.miny<=z.maxy&&z.miny<=o.maxy&&o.minx<=z.maxx&&z.minx<=o.maxx)if(null!=r){var w=g.shape.filter;b=0!=(w.collisionMask&r.collisionGroup)&&0!=(r.collisionMask&w.collisionGroup)}else b=!0;else b=!1;if(b){var Z=e.aabbsect(g.aabb);if(Z>=0&&Z<a){var E=0==g.shape.type?e.circlesect(g.shape.circle,i,a):e.polysect(g.shape.polygon,i,a);if(null!=E){if(null!=E.zpp_inner.next)throw new n._Boot.HaxeError("Error: This object has been disposed of and cannot be used");if(a=E.zpp_inner.toiDistance,null!=s){if(null!=s.zpp_inner.next)throw new n._Boot.HaxeError("Error: This object has been disposed of and cannot be used");s.zpp_inner.free()}s=E}}}g=g.next}var M=o;return null!=M.outer&&(M.outer.zpp_inner=null,M.outer=null),M.wrap_min=M.wrap_max=null,M._invalidate=null,M._validate=null,M.next=t.geom.ZPP_AABB.zpp_pool,t.geom.ZPP_AABB.zpp_pool=M,s},t.space.ZPP_SweepPhase.prototype.rayMultiCast=function(n,i,r,o){this.sync_broadphase(),n.validate_dir();var a=n.rayAABB(),s=null==o?new e.geom.RayResultList:o;if(0==n.dirx)for(var l=this.list;null!=l&&l.aabb.minx<=a.minx;){var p,u=l.aabb;if(a.miny<=u.maxy&&u.miny<=a.maxy&&a.minx<=u.maxx&&u.minx<=a.maxx)if(null!=r){var h=l.shape.filter;p=0!=(h.collisionMask&r.collisionGroup)&&0!=(r.collisionMask&h.collisionGroup)}else p=!0;else p=!1;p&&n.aabbsect(l.aabb)>=0&&(0==l.shape.type?n.circlesect2(l.shape.circle,i,s):n.polysect2(l.shape.polygon,i,s)),l=l.next}else if(n.dirx<0){for(var c=this.list,_=null;null!=c&&c.aabb.minx<=a.maxx;)_=c,c=c.next;for(c=_;null!=c;){var d,m=c.aabb;if(a.miny<=m.maxy&&m.miny<=a.maxy&&a.minx<=m.maxx&&m.minx<=a.maxx)if(null!=r){var P=c.shape.filter;d=0!=(P.collisionMask&r.collisionGroup)&&0!=(r.collisionMask&P.collisionGroup)}else d=!0;else d=!1;d&&n.aabbsect(c.aabb)>=0&&(0==c.shape.type?n.circlesect2(c.shape.circle,i,s):n.polysect2(c.shape.polygon,i,s)),c=c.prev}}else for(var f=this.list;null!=f&&f.aabb.minx<=a.maxx;){var x,y=f.aabb;if(a.miny<=y.maxy&&y.miny<=a.maxy&&a.minx<=y.maxx&&y.minx<=a.maxx)if(null!=r){var v=f.shape.filter;x=0!=(v.collisionMask&r.collisionGroup)&&0!=(r.collisionMask&v.collisionGroup)}else x=!0;else x=!1;x&&n.aabbsect(f.aabb)>=0&&(0==f.shape.type?n.circlesect2(f.shape.circle,i,s):n.polysect2(f.shape.polygon,i,s)),f=f.next}var g=a;return null!=g.outer&&(g.outer.zpp_inner=null,g.outer=null),g.wrap_min=g.wrap_max=null,g._invalidate=null,g._validate=null,g.next=t.geom.ZPP_AABB.zpp_pool,t.geom.ZPP_AABB.zpp_pool=g,s},t.space.ZPP_SweepPhase.prototype.__class__=t.space.ZPP_SweepPhase,t.util.ZNPArray2_Float=l["zpp_nape.util.ZNPArray2_Float"]=function(e,t){this.width=0,this.list=null,this.width=e,this.list=[]},t.util.ZNPArray2_Float.__name__=["zpp_nape","util","ZNPArray2_Float"],t.util.ZNPArray2_Float.prototype.list=null,t.util.ZNPArray2_Float.prototype.width=null,t.util.ZNPArray2_Float.prototype.resize=function(e,t,n){this.width=e;for(var i=0,r=e*t;i<r;){var o=i++;this.list[o]=n}},t.util.ZNPArray2_Float.prototype.get=function(e,t){return this.list[t*this.width+e]},t.util.ZNPArray2_Float.prototype.set=function(e,t,n){return this.list[t*this.width+e]=n},t.util.ZNPArray2_Float.prototype.__class__=t.util.ZNPArray2_Float,t.util.ZNPArray2_ZPP_GeomVert=l["zpp_nape.util.ZNPArray2_ZPP_GeomVert"]=function(e,t){this.width=0,this.list=null,this.width=e,this.list=[]},t.util.ZNPArray2_ZPP_GeomVert.__name__=["zpp_nape","util","ZNPArray2_ZPP_GeomVert"],t.util.ZNPArray2_ZPP_GeomVert.prototype.list=null,t.util.ZNPArray2_ZPP_GeomVert.prototype.width=null,t.util.ZNPArray2_ZPP_GeomVert.prototype.resize=function(e,t,n){this.width=e;for(var i=0,r=e*t;i<r;){var o=i++;this.list[o]=n}},t.util.ZNPArray2_ZPP_GeomVert.prototype.get=function(e,t){return this.list[t*this.width+e]},t.util.ZNPArray2_ZPP_GeomVert.prototype.set=function(e,t,n){return this.list[t*this.width+e]=n},t.util.ZNPArray2_ZPP_GeomVert.prototype.__class__=t.util.ZNPArray2_ZPP_GeomVert,t.util.ZNPArray2_ZPP_MarchPair=l["zpp_nape.util.ZNPArray2_ZPP_MarchPair"]=function(e,t){this.width=0,this.list=null,this.width=e,this.list=[]},t.util.ZNPArray2_ZPP_MarchPair.__name__=["zpp_nape","util","ZNPArray2_ZPP_MarchPair"],t.util.ZNPArray2_ZPP_MarchPair.prototype.list=null,t.util.ZNPArray2_ZPP_MarchPair.prototype.width=null,t.util.ZNPArray2_ZPP_MarchPair.prototype.resize=function(e,t,n){this.width=e;for(var i=0,r=e*t;i<r;){var o=i++;this.list[o]=n}},t.util.ZNPArray2_ZPP_MarchPair.prototype.get=function(e,t){return this.list[t*this.width+e]},t.util.ZNPArray2_ZPP_MarchPair.prototype.set=function(e,t,n){return this.list[t*this.width+e]=n},t.util.ZNPArray2_ZPP_MarchPair.prototype.__class__=t.util.ZNPArray2_ZPP_MarchPair,t.util.Hashable2_Boolfalse=l["zpp_nape.util.Hashable2_Boolfalse"]=function(){this.di=0,this.id=0,this.hnext=null,this.next=null,this.value=!1},t.util.Hashable2_Boolfalse.__name__=["zpp_nape","util","Hashable2_Boolfalse"],t.util.Hashable2_Boolfalse.get=function(e,n,i){var r;null==t.util.Hashable2_Boolfalse.zpp_pool?r=new t.util.Hashable2_Boolfalse:(r=t.util.Hashable2_Boolfalse.zpp_pool,t.util.Hashable2_Boolfalse.zpp_pool=r.next,r.next=null),r.id=e,r.di=n;var o=r;return o.value=i,o},t.util.Hashable2_Boolfalse.getpersist=function(e,n){var i;return null==t.util.Hashable2_Boolfalse.zpp_pool?i=new t.util.Hashable2_Boolfalse:(i=t.util.Hashable2_Boolfalse.zpp_pool,t.util.Hashable2_Boolfalse.zpp_pool=i.next,i.next=null),i.id=e,i.di=n,i},t.util.Hashable2_Boolfalse.ordered_get=function(e,n,i){if(e<=n){var r;null==t.util.Hashable2_Boolfalse.zpp_pool?r=new t.util.Hashable2_Boolfalse:(r=t.util.Hashable2_Boolfalse.zpp_pool,t.util.Hashable2_Boolfalse.zpp_pool=r.next,r.next=null),r.id=e,r.di=n;var o=r;return o.value=i,o}var a;null==t.util.Hashable2_Boolfalse.zpp_pool?a=new t.util.Hashable2_Boolfalse:(a=t.util.Hashable2_Boolfalse.zpp_pool,t.util.Hashable2_Boolfalse.zpp_pool=a.next,a.next=null),a.id=n,a.di=e;var s=a;return s.value=i,s},t.util.Hashable2_Boolfalse.ordered_get_persist=function(e,n){var i,r;return e<=n?(null==t.util.Hashable2_Boolfalse.zpp_pool?i=new t.util.Hashable2_Boolfalse:(i=t.util.Hashable2_Boolfalse.zpp_pool,t.util.Hashable2_Boolfalse.zpp_pool=i.next,i.next=null),i.id=e,i.di=n,i):(null==t.util.Hashable2_Boolfalse.zpp_pool?r=new t.util.Hashable2_Boolfalse:(r=t.util.Hashable2_Boolfalse.zpp_pool,t.util.Hashable2_Boolfalse.zpp_pool=r.next,r.next=null),r.id=n,r.di=e,r)},t.util.Hashable2_Boolfalse.prototype.value=null,t.util.Hashable2_Boolfalse.prototype.next=null,t.util.Hashable2_Boolfalse.prototype.hnext=null,t.util.Hashable2_Boolfalse.prototype.id=null,t.util.Hashable2_Boolfalse.prototype.di=null,t.util.Hashable2_Boolfalse.prototype.free=function(){},t.util.Hashable2_Boolfalse.prototype.alloc=function(){},t.util.Hashable2_Boolfalse.prototype.__class__=t.util.Hashable2_Boolfalse,t.util.FastHash2_Hashable2_Boolfalse=l["zpp_nape.util.FastHash2_Hashable2_Boolfalse"]=function(){this.cnt=0,this.table=null,this.cnt=0,this.table=[];for(var e=0;e<1048576;)e++,this.table.push(null)},t.util.FastHash2_Hashable2_Boolfalse.__name__=["zpp_nape","util","FastHash2_Hashable2_Boolfalse"],t.util.FastHash2_Hashable2_Boolfalse.prototype.table=null,t.util.FastHash2_Hashable2_Boolfalse.prototype.cnt=null,t.util.FastHash2_Hashable2_Boolfalse.prototype.empty=function(){return 0==this.cnt},t.util.FastHash2_Hashable2_Boolfalse.prototype.clear=function(){for(var e=0,t=this.table.length;e<t;){var n=e++,i=this.table[n];if(null!=i){for(;null!=i;){var r=i.hnext;i.hnext=null,i=r}this.table[n]=null}}},t.util.FastHash2_Hashable2_Boolfalse.prototype.get=function(e,t){var n=this.table[106039*e+t&1048575];if(null==n)return null;if(n.id==e&&n.di==t)return n;for(;null!=(n=n.hnext)&&(n.id!=e||n.di!=t););return n},t.util.FastHash2_Hashable2_Boolfalse.prototype.ordered_get=function(e,t){if(e>t){var n=e;e=t,t=n}var i=this.table[106039*e+t&1048575];if(null==i)return null;if(i.id==e&&i.di==t)return i;for(;null!=(i=i.hnext)&&(i.id!=e||i.di!=t););return i},t.util.FastHash2_Hashable2_Boolfalse.prototype.has=function(e,t){var n=this.table[106039*e+t&1048575];if(null==n)return!1;if(n.id==e&&n.di==t)return!0;for(;null!=(n=n.hnext)&&(n.id!=e||n.di!=t););return null!=n},t.util.FastHash2_Hashable2_Boolfalse.prototype.maybeAdd=function(e){var t=106039*e.id+e.di&1048575,n=this.table[t];null==n?(this.table[t]=e,e.hnext=null):(e.hnext=n.hnext,n.hnext=e),this.cnt++},t.util.FastHash2_Hashable2_Boolfalse.prototype.add=function(e){var t=106039*e.id+e.di&1048575,n=this.table[t];null==n?(this.table[t]=e,e.hnext=null):(e.hnext=n.hnext,n.hnext=e),this.cnt++},t.util.FastHash2_Hashable2_Boolfalse.prototype.remove=function(e){var t=106039*e.id+e.di&1048575,n=this.table[t];if(n==e)this.table[t]=n.hnext;else if(null!=n){for(var i;i=n,null!=(n=n.hnext)&&n!=e;);i.hnext=n.hnext}e.hnext=null,this.cnt--},t.util.FastHash2_Hashable2_Boolfalse.prototype.hash=function(e,t){return 106039*e+t&1048575},t.util.FastHash2_Hashable2_Boolfalse.prototype.__class__=t.util.FastHash2_Hashable2_Boolfalse,t.util.ZNPList_ZPP_CallbackSet=l["zpp_nape.util.ZNPList_ZPP_CallbackSet"]=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null},t.util.ZNPList_ZPP_CallbackSet.__name__=["zpp_nape","util","ZNPList_ZPP_CallbackSet"],t.util.ZNPList_ZPP_CallbackSet.prototype.head=null,t.util.ZNPList_ZPP_CallbackSet.prototype.begin=function(){return this.head},t.util.ZNPList_ZPP_CallbackSet.prototype.modified=null,t.util.ZNPList_ZPP_CallbackSet.prototype.pushmod=null,t.util.ZNPList_ZPP_CallbackSet.prototype.length=null,t.util.ZNPList_ZPP_CallbackSet.prototype.setbegin=function(e){this.head=e,this.modified=!0,this.pushmod=!0},t.util.ZNPList_ZPP_CallbackSet.prototype.add=function(e){var n;null==t.util.ZNPNode_ZPP_CallbackSet.zpp_pool?n=new t.util.ZNPNode_ZPP_CallbackSet:(n=t.util.ZNPNode_ZPP_CallbackSet.zpp_pool,t.util.ZNPNode_ZPP_CallbackSet.zpp_pool=n.next,n.next=null),n.elt=e;var i=n;return i.next=this.head,this.head=i,this.modified=!0,this.length++,e},t.util.ZNPList_ZPP_CallbackSet.prototype.inlined_add=function(e){var n;null==t.util.ZNPNode_ZPP_CallbackSet.zpp_pool?n=new t.util.ZNPNode_ZPP_CallbackSet:(n=t.util.ZNPNode_ZPP_CallbackSet.zpp_pool,t.util.ZNPNode_ZPP_CallbackSet.zpp_pool=n.next,n.next=null),n.elt=e;var i=n;return i.next=this.head,this.head=i,this.modified=!0,this.length++,e},t.util.ZNPList_ZPP_CallbackSet.prototype.addAll=function(e){for(var t=e.head;null!=t;){var n=t.elt;this.add(n),t=t.next}},t.util.ZNPList_ZPP_CallbackSet.prototype.insert=function(e,n){var i;null==t.util.ZNPNode_ZPP_CallbackSet.zpp_pool?i=new t.util.ZNPNode_ZPP_CallbackSet:(i=t.util.ZNPNode_ZPP_CallbackSet.zpp_pool,t.util.ZNPNode_ZPP_CallbackSet.zpp_pool=i.next,i.next=null),i.elt=n;var r=i;return null==e?(r.next=this.head,this.head=r):(r.next=e.next,e.next=r),this.pushmod=this.modified=!0,this.length++,r},t.util.ZNPList_ZPP_CallbackSet.prototype.inlined_insert=function(e,n){var i;null==t.util.ZNPNode_ZPP_CallbackSet.zpp_pool?i=new t.util.ZNPNode_ZPP_CallbackSet:(i=t.util.ZNPNode_ZPP_CallbackSet.zpp_pool,t.util.ZNPNode_ZPP_CallbackSet.zpp_pool=i.next,i.next=null),i.elt=n;var r=i;return null==e?(r.next=this.head,this.head=r):(r.next=e.next,e.next=r),this.pushmod=this.modified=!0,this.length++,r},t.util.ZNPList_ZPP_CallbackSet.prototype.pop=function(){var e=this.head;this.head=e.next;var n=e;n.elt=null,n.next=t.util.ZNPNode_ZPP_CallbackSet.zpp_pool,t.util.ZNPNode_ZPP_CallbackSet.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},t.util.ZNPList_ZPP_CallbackSet.prototype.inlined_pop=function(){var e=this.head;this.head=e.next;var n=e;n.elt=null,n.next=t.util.ZNPNode_ZPP_CallbackSet.zpp_pool,t.util.ZNPNode_ZPP_CallbackSet.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},t.util.ZNPList_ZPP_CallbackSet.prototype.pop_unsafe=function(){var e=this.head.elt;return this.pop(),e},t.util.ZNPList_ZPP_CallbackSet.prototype.inlined_pop_unsafe=function(){var e=this.head.elt;return this.pop(),e},t.util.ZNPList_ZPP_CallbackSet.prototype.remove=function(e){for(var n=null,i=this.head;null!=i;){if(i.elt==e){var r,o;null==n?(o=(r=this.head).next,this.head=o,null==this.head&&(this.pushmod=!0)):(o=(r=n.next).next,n.next=o,null==o&&(this.pushmod=!0));var a=r;a.elt=null,a.next=t.util.ZNPNode_ZPP_CallbackSet.zpp_pool,t.util.ZNPNode_ZPP_CallbackSet.zpp_pool=a,this.modified=!0,this.length--,this.pushmod=!0;break}n=i,i=i.next}},t.util.ZNPList_ZPP_CallbackSet.prototype.try_remove=function(e){for(var t=null,n=this.head,i=!1;null!=n;){if(n.elt==e){this.erase(t),i=!0;break}t=n,n=n.next}return i},t.util.ZNPList_ZPP_CallbackSet.prototype.inlined_remove=function(e){for(var n=null,i=this.head;null!=i;){if(i.elt==e){var r,o;null==n?(o=(r=this.head).next,this.head=o,null==this.head&&(this.pushmod=!0)):(o=(r=n.next).next,n.next=o,null==o&&(this.pushmod=!0));var a=r;a.elt=null,a.next=t.util.ZNPNode_ZPP_CallbackSet.zpp_pool,t.util.ZNPNode_ZPP_CallbackSet.zpp_pool=a,this.modified=!0,this.length--,this.pushmod=!0;break}n=i,i=i.next}},t.util.ZNPList_ZPP_CallbackSet.prototype.inlined_try_remove=function(e){for(var n=null,i=this.head,r=!1;null!=i;){if(i.elt==e){var o,a;null==n?(a=(o=this.head).next,this.head=a,null==this.head&&(this.pushmod=!0)):(a=(o=n.next).next,n.next=a,null==a&&(this.pushmod=!0));var s=o;s.elt=null,s.next=t.util.ZNPNode_ZPP_CallbackSet.zpp_pool,t.util.ZNPNode_ZPP_CallbackSet.zpp_pool=s,this.modified=!0,this.length--,this.pushmod=!0,r=!0;break}n=i,i=i.next}return r},t.util.ZNPList_ZPP_CallbackSet.prototype.erase=function(e){var n,i;null==e?(i=(n=this.head).next,this.head=i,null==this.head&&(this.pushmod=!0)):(i=(n=e.next).next,e.next=i,null==i&&(this.pushmod=!0));var r=n;return r.elt=null,r.next=t.util.ZNPNode_ZPP_CallbackSet.zpp_pool,t.util.ZNPNode_ZPP_CallbackSet.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,i},t.util.ZNPList_ZPP_CallbackSet.prototype.inlined_erase=function(e){var n,i;null==e?(i=(n=this.head).next,this.head=i,null==this.head&&(this.pushmod=!0)):(i=(n=e.next).next,e.next=i,null==i&&(this.pushmod=!0));var r=n;return r.elt=null,r.next=t.util.ZNPNode_ZPP_CallbackSet.zpp_pool,t.util.ZNPNode_ZPP_CallbackSet.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,i},t.util.ZNPList_ZPP_CallbackSet.prototype.splice=function(e,t){for(;t-- >0&&null!=e.next;)this.erase(e);return e.next},t.util.ZNPList_ZPP_CallbackSet.prototype.clear=function(){for(;null!=this.head;){var e=this.head;this.head=e.next;var n=e;n.elt=null,n.next=t.util.ZNPNode_ZPP_CallbackSet.zpp_pool,t.util.ZNPNode_ZPP_CallbackSet.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},t.util.ZNPList_ZPP_CallbackSet.prototype.inlined_clear=function(){for(;null!=this.head;){var e=this.head;this.head=e.next;var n=e;n.elt=null,n.next=t.util.ZNPNode_ZPP_CallbackSet.zpp_pool,t.util.ZNPNode_ZPP_CallbackSet.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},t.util.ZNPList_ZPP_CallbackSet.prototype.reverse=function(){for(var e=this.head,t=null;null!=e;){var n=e.next;e.next=t,this.head=e,t=e,e=n}this.modified=!0,this.pushmod=!0},t.util.ZNPList_ZPP_CallbackSet.prototype.empty=function(){return null==this.head},t.util.ZNPList_ZPP_CallbackSet.prototype.size=function(){return this.length},t.util.ZNPList_ZPP_CallbackSet.prototype.has=function(e){var t;t=!1;for(var n=this.head;null!=n;){if(n.elt==e){t=!0;break}n=n.next}return t},t.util.ZNPList_ZPP_CallbackSet.prototype.inlined_has=function(e){var t;t=!1;for(var n=this.head;null!=n;){if(n.elt==e){t=!0;break}n=n.next}return t},t.util.ZNPList_ZPP_CallbackSet.prototype.front=function(){return this.head.elt},t.util.ZNPList_ZPP_CallbackSet.prototype.back=function(){for(var e=this.head,t=e;null!=t;)e=t,t=t.next;return e.elt},t.util.ZNPList_ZPP_CallbackSet.prototype.iterator_at=function(e){for(var t=this.head;e-- >0&&null!=t;)t=t.next;return t},t.util.ZNPList_ZPP_CallbackSet.prototype.at=function(e){var t=this.iterator_at(e);return null!=t?t.elt:null},t.util.ZNPList_ZPP_CallbackSet.prototype.__class__=t.util.ZNPList_ZPP_CallbackSet,t.util.ZNPList_ZPP_Shape=l["zpp_nape.util.ZNPList_ZPP_Shape"]=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null},t.util.ZNPList_ZPP_Shape.__name__=["zpp_nape","util","ZNPList_ZPP_Shape"],t.util.ZNPList_ZPP_Shape.prototype.head=null,t.util.ZNPList_ZPP_Shape.prototype.begin=function(){return this.head},t.util.ZNPList_ZPP_Shape.prototype.modified=null,t.util.ZNPList_ZPP_Shape.prototype.pushmod=null,t.util.ZNPList_ZPP_Shape.prototype.length=null,t.util.ZNPList_ZPP_Shape.prototype.setbegin=function(e){this.head=e,this.modified=!0,this.pushmod=!0},t.util.ZNPList_ZPP_Shape.prototype.add=function(e){var n;null==t.util.ZNPNode_ZPP_Shape.zpp_pool?n=new t.util.ZNPNode_ZPP_Shape:(n=t.util.ZNPNode_ZPP_Shape.zpp_pool,t.util.ZNPNode_ZPP_Shape.zpp_pool=n.next,n.next=null),n.elt=e;var i=n;return i.next=this.head,this.head=i,this.modified=!0,this.length++,e},t.util.ZNPList_ZPP_Shape.prototype.inlined_add=function(e){var n;null==t.util.ZNPNode_ZPP_Shape.zpp_pool?n=new t.util.ZNPNode_ZPP_Shape:(n=t.util.ZNPNode_ZPP_Shape.zpp_pool,t.util.ZNPNode_ZPP_Shape.zpp_pool=n.next,n.next=null),n.elt=e;var i=n;return i.next=this.head,this.head=i,this.modified=!0,this.length++,e},t.util.ZNPList_ZPP_Shape.prototype.addAll=function(e){for(var t=e.head;null!=t;){var n=t.elt;this.add(n),t=t.next}},t.util.ZNPList_ZPP_Shape.prototype.insert=function(e,n){var i;null==t.util.ZNPNode_ZPP_Shape.zpp_pool?i=new t.util.ZNPNode_ZPP_Shape:(i=t.util.ZNPNode_ZPP_Shape.zpp_pool,t.util.ZNPNode_ZPP_Shape.zpp_pool=i.next,i.next=null),i.elt=n;var r=i;return null==e?(r.next=this.head,this.head=r):(r.next=e.next,e.next=r),this.pushmod=this.modified=!0,this.length++,r},t.util.ZNPList_ZPP_Shape.prototype.inlined_insert=function(e,n){var i;null==t.util.ZNPNode_ZPP_Shape.zpp_pool?i=new t.util.ZNPNode_ZPP_Shape:(i=t.util.ZNPNode_ZPP_Shape.zpp_pool,t.util.ZNPNode_ZPP_Shape.zpp_pool=i.next,i.next=null),i.elt=n;var r=i;return null==e?(r.next=this.head,this.head=r):(r.next=e.next,e.next=r),this.pushmod=this.modified=!0,this.length++,r},t.util.ZNPList_ZPP_Shape.prototype.pop=function(){var e=this.head;this.head=e.next;var n=e;n.elt=null,n.next=t.util.ZNPNode_ZPP_Shape.zpp_pool,t.util.ZNPNode_ZPP_Shape.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},t.util.ZNPList_ZPP_Shape.prototype.inlined_pop=function(){var e=this.head;this.head=e.next;var n=e;n.elt=null,n.next=t.util.ZNPNode_ZPP_Shape.zpp_pool,t.util.ZNPNode_ZPP_Shape.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},t.util.ZNPList_ZPP_Shape.prototype.pop_unsafe=function(){var e=this.head.elt;return this.pop(),e},t.util.ZNPList_ZPP_Shape.prototype.inlined_pop_unsafe=function(){var e=this.head.elt;return this.pop(),e},t.util.ZNPList_ZPP_Shape.prototype.remove=function(e){for(var n=null,i=this.head;null!=i;){if(i.elt==e){var r,o;null==n?(o=(r=this.head).next,this.head=o,null==this.head&&(this.pushmod=!0)):(o=(r=n.next).next,n.next=o,null==o&&(this.pushmod=!0));var a=r;a.elt=null,a.next=t.util.ZNPNode_ZPP_Shape.zpp_pool,t.util.ZNPNode_ZPP_Shape.zpp_pool=a,this.modified=!0,this.length--,this.pushmod=!0;break}n=i,i=i.next}},t.util.ZNPList_ZPP_Shape.prototype.try_remove=function(e){for(var t=null,n=this.head,i=!1;null!=n;){if(n.elt==e){this.erase(t),i=!0;break}t=n,n=n.next}return i},t.util.ZNPList_ZPP_Shape.prototype.inlined_remove=function(e){for(var n=null,i=this.head;null!=i;){if(i.elt==e){var r,o;null==n?(o=(r=this.head).next,this.head=o,null==this.head&&(this.pushmod=!0)):(o=(r=n.next).next,n.next=o,null==o&&(this.pushmod=!0));var a=r;a.elt=null,a.next=t.util.ZNPNode_ZPP_Shape.zpp_pool,t.util.ZNPNode_ZPP_Shape.zpp_pool=a,this.modified=!0,this.length--,this.pushmod=!0;break}n=i,i=i.next}},t.util.ZNPList_ZPP_Shape.prototype.inlined_try_remove=function(e){for(var n=null,i=this.head,r=!1;null!=i;){if(i.elt==e){var o,a;null==n?(a=(o=this.head).next,this.head=a,null==this.head&&(this.pushmod=!0)):(a=(o=n.next).next,n.next=a,null==a&&(this.pushmod=!0));var s=o;s.elt=null,s.next=t.util.ZNPNode_ZPP_Shape.zpp_pool,t.util.ZNPNode_ZPP_Shape.zpp_pool=s,this.modified=!0,this.length--,this.pushmod=!0,r=!0;break}n=i,i=i.next}return r},t.util.ZNPList_ZPP_Shape.prototype.erase=function(e){var n,i;null==e?(i=(n=this.head).next,this.head=i,null==this.head&&(this.pushmod=!0)):(i=(n=e.next).next,e.next=i,null==i&&(this.pushmod=!0));var r=n;return r.elt=null,r.next=t.util.ZNPNode_ZPP_Shape.zpp_pool,t.util.ZNPNode_ZPP_Shape.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,i},t.util.ZNPList_ZPP_Shape.prototype.inlined_erase=function(e){var n,i;null==e?(i=(n=this.head).next,this.head=i,null==this.head&&(this.pushmod=!0)):(i=(n=e.next).next,e.next=i,null==i&&(this.pushmod=!0));var r=n;return r.elt=null,r.next=t.util.ZNPNode_ZPP_Shape.zpp_pool,t.util.ZNPNode_ZPP_Shape.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,i},t.util.ZNPList_ZPP_Shape.prototype.splice=function(e,t){for(;t-- >0&&null!=e.next;)this.erase(e);return e.next},t.util.ZNPList_ZPP_Shape.prototype.clear=function(){for(;null!=this.head;){var e=this.head;this.head=e.next;var n=e;n.elt=null,n.next=t.util.ZNPNode_ZPP_Shape.zpp_pool,t.util.ZNPNode_ZPP_Shape.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},t.util.ZNPList_ZPP_Shape.prototype.inlined_clear=function(){for(;null!=this.head;){var e=this.head;this.head=e.next;var n=e;n.elt=null,n.next=t.util.ZNPNode_ZPP_Shape.zpp_pool,t.util.ZNPNode_ZPP_Shape.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},t.util.ZNPList_ZPP_Shape.prototype.reverse=function(){for(var e=this.head,t=null;null!=e;){var n=e.next;e.next=t,this.head=e,t=e,e=n}this.modified=!0,this.pushmod=!0},t.util.ZNPList_ZPP_Shape.prototype.empty=function(){return null==this.head},t.util.ZNPList_ZPP_Shape.prototype.size=function(){return this.length},t.util.ZNPList_ZPP_Shape.prototype.has=function(e){var t;t=!1;for(var n=this.head;null!=n;){if(n.elt==e){t=!0;break}n=n.next}return t},t.util.ZNPList_ZPP_Shape.prototype.inlined_has=function(e){var t;t=!1;for(var n=this.head;null!=n;){if(n.elt==e){t=!0;break}n=n.next}return t},t.util.ZNPList_ZPP_Shape.prototype.front=function(){return this.head.elt},t.util.ZNPList_ZPP_Shape.prototype.back=function(){for(var e=this.head,t=e;null!=t;)e=t,t=t.next;return e.elt},t.util.ZNPList_ZPP_Shape.prototype.iterator_at=function(e){for(var t=this.head;e-- >0&&null!=t;)t=t.next;return t},t.util.ZNPList_ZPP_Shape.prototype.at=function(e){var t=this.iterator_at(e);return null!=t?t.elt:null},t.util.ZNPList_ZPP_Shape.prototype.__class__=t.util.ZNPList_ZPP_Shape,t.util.ZNPList_ZPP_Body=l["zpp_nape.util.ZNPList_ZPP_Body"]=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null},t.util.ZNPList_ZPP_Body.__name__=["zpp_nape","util","ZNPList_ZPP_Body"],t.util.ZNPList_ZPP_Body.prototype.head=null,t.util.ZNPList_ZPP_Body.prototype.begin=function(){return this.head},t.util.ZNPList_ZPP_Body.prototype.modified=null,t.util.ZNPList_ZPP_Body.prototype.pushmod=null,t.util.ZNPList_ZPP_Body.prototype.length=null,t.util.ZNPList_ZPP_Body.prototype.setbegin=function(e){this.head=e,this.modified=!0,this.pushmod=!0},t.util.ZNPList_ZPP_Body.prototype.add=function(e){var n;null==t.util.ZNPNode_ZPP_Body.zpp_pool?n=new t.util.ZNPNode_ZPP_Body:(n=t.util.ZNPNode_ZPP_Body.zpp_pool,t.util.ZNPNode_ZPP_Body.zpp_pool=n.next,n.next=null),n.elt=e;var i=n;return i.next=this.head,this.head=i,this.modified=!0,this.length++,e},t.util.ZNPList_ZPP_Body.prototype.inlined_add=function(e){var n;null==t.util.ZNPNode_ZPP_Body.zpp_pool?n=new t.util.ZNPNode_ZPP_Body:(n=t.util.ZNPNode_ZPP_Body.zpp_pool,t.util.ZNPNode_ZPP_Body.zpp_pool=n.next,n.next=null),n.elt=e;var i=n;return i.next=this.head,this.head=i,this.modified=!0,this.length++,e},t.util.ZNPList_ZPP_Body.prototype.addAll=function(e){for(var t=e.head;null!=t;){var n=t.elt;this.add(n),t=t.next}},t.util.ZNPList_ZPP_Body.prototype.insert=function(e,n){var i;null==t.util.ZNPNode_ZPP_Body.zpp_pool?i=new t.util.ZNPNode_ZPP_Body:(i=t.util.ZNPNode_ZPP_Body.zpp_pool,t.util.ZNPNode_ZPP_Body.zpp_pool=i.next,i.next=null),i.elt=n;var r=i;return null==e?(r.next=this.head,this.head=r):(r.next=e.next,e.next=r),this.pushmod=this.modified=!0,this.length++,r},t.util.ZNPList_ZPP_Body.prototype.inlined_insert=function(e,n){var i;null==t.util.ZNPNode_ZPP_Body.zpp_pool?i=new t.util.ZNPNode_ZPP_Body:(i=t.util.ZNPNode_ZPP_Body.zpp_pool,t.util.ZNPNode_ZPP_Body.zpp_pool=i.next,i.next=null),i.elt=n;var r=i;return null==e?(r.next=this.head,this.head=r):(r.next=e.next,e.next=r),this.pushmod=this.modified=!0,this.length++,r},t.util.ZNPList_ZPP_Body.prototype.pop=function(){var e=this.head;this.head=e.next;var n=e;n.elt=null,n.next=t.util.ZNPNode_ZPP_Body.zpp_pool,t.util.ZNPNode_ZPP_Body.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},t.util.ZNPList_ZPP_Body.prototype.inlined_pop=function(){var e=this.head;this.head=e.next;var n=e;n.elt=null,n.next=t.util.ZNPNode_ZPP_Body.zpp_pool,t.util.ZNPNode_ZPP_Body.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},t.util.ZNPList_ZPP_Body.prototype.pop_unsafe=function(){var e=this.head.elt;return this.pop(),e},t.util.ZNPList_ZPP_Body.prototype.inlined_pop_unsafe=function(){var e=this.head.elt;return this.pop(),e},t.util.ZNPList_ZPP_Body.prototype.remove=function(e){for(var n=null,i=this.head;null!=i;){if(i.elt==e){var r,o;null==n?(o=(r=this.head).next,this.head=o,null==this.head&&(this.pushmod=!0)):(o=(r=n.next).next,n.next=o,null==o&&(this.pushmod=!0));var a=r;a.elt=null,a.next=t.util.ZNPNode_ZPP_Body.zpp_pool,t.util.ZNPNode_ZPP_Body.zpp_pool=a,this.modified=!0,this.length--,this.pushmod=!0;break}n=i,i=i.next}},t.util.ZNPList_ZPP_Body.prototype.try_remove=function(e){for(var t=null,n=this.head,i=!1;null!=n;){if(n.elt==e){this.erase(t),i=!0;break}t=n,n=n.next}return i},t.util.ZNPList_ZPP_Body.prototype.inlined_remove=function(e){for(var n=null,i=this.head;null!=i;){if(i.elt==e){var r,o;null==n?(o=(r=this.head).next,this.head=o,null==this.head&&(this.pushmod=!0)):(o=(r=n.next).next,n.next=o,null==o&&(this.pushmod=!0));var a=r;a.elt=null,a.next=t.util.ZNPNode_ZPP_Body.zpp_pool,t.util.ZNPNode_ZPP_Body.zpp_pool=a,this.modified=!0,this.length--,this.pushmod=!0;break}n=i,i=i.next}},t.util.ZNPList_ZPP_Body.prototype.inlined_try_remove=function(e){for(var n=null,i=this.head,r=!1;null!=i;){if(i.elt==e){var o,a;null==n?(a=(o=this.head).next,this.head=a,null==this.head&&(this.pushmod=!0)):(a=(o=n.next).next,n.next=a,null==a&&(this.pushmod=!0));var s=o;s.elt=null,s.next=t.util.ZNPNode_ZPP_Body.zpp_pool,t.util.ZNPNode_ZPP_Body.zpp_pool=s,this.modified=!0,this.length--,this.pushmod=!0,r=!0;break}n=i,i=i.next}return r},t.util.ZNPList_ZPP_Body.prototype.erase=function(e){var n,i;null==e?(i=(n=this.head).next,this.head=i,null==this.head&&(this.pushmod=!0)):(i=(n=e.next).next,e.next=i,null==i&&(this.pushmod=!0));var r=n;return r.elt=null,r.next=t.util.ZNPNode_ZPP_Body.zpp_pool,t.util.ZNPNode_ZPP_Body.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,i},t.util.ZNPList_ZPP_Body.prototype.inlined_erase=function(e){var n,i;null==e?(i=(n=this.head).next,this.head=i,null==this.head&&(this.pushmod=!0)):(i=(n=e.next).next,e.next=i,null==i&&(this.pushmod=!0));var r=n;return r.elt=null,r.next=t.util.ZNPNode_ZPP_Body.zpp_pool,t.util.ZNPNode_ZPP_Body.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,i},t.util.ZNPList_ZPP_Body.prototype.splice=function(e,t){for(;t-- >0&&null!=e.next;)this.erase(e);return e.next},t.util.ZNPList_ZPP_Body.prototype.clear=function(){for(;null!=this.head;){var e=this.head;this.head=e.next;var n=e;n.elt=null,n.next=t.util.ZNPNode_ZPP_Body.zpp_pool,t.util.ZNPNode_ZPP_Body.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},t.util.ZNPList_ZPP_Body.prototype.inlined_clear=function(){for(;null!=this.head;){var e=this.head;this.head=e.next;var n=e;n.elt=null,n.next=t.util.ZNPNode_ZPP_Body.zpp_pool,t.util.ZNPNode_ZPP_Body.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},t.util.ZNPList_ZPP_Body.prototype.reverse=function(){for(var e=this.head,t=null;null!=e;){var n=e.next;e.next=t,this.head=e,t=e,e=n}this.modified=!0,this.pushmod=!0},t.util.ZNPList_ZPP_Body.prototype.empty=function(){return null==this.head},t.util.ZNPList_ZPP_Body.prototype.size=function(){return this.length},t.util.ZNPList_ZPP_Body.prototype.has=function(e){var t;t=!1;for(var n=this.head;null!=n;){if(n.elt==e){t=!0;break}n=n.next}return t},t.util.ZNPList_ZPP_Body.prototype.inlined_has=function(e){var t;t=!1;for(var n=this.head;null!=n;){if(n.elt==e){t=!0;break}n=n.next}return t},t.util.ZNPList_ZPP_Body.prototype.front=function(){return this.head.elt},t.util.ZNPList_ZPP_Body.prototype.back=function(){for(var e=this.head,t=e;null!=t;)e=t,t=t.next;return e.elt},t.util.ZNPList_ZPP_Body.prototype.iterator_at=function(e){for(var t=this.head;e-- >0&&null!=t;)t=t.next;return t},t.util.ZNPList_ZPP_Body.prototype.at=function(e){var t=this.iterator_at(e);return null!=t?t.elt:null},t.util.ZNPList_ZPP_Body.prototype.__class__=t.util.ZNPList_ZPP_Body,t.util.ZNPList_ZPP_Compound=l["zpp_nape.util.ZNPList_ZPP_Compound"]=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null},t.util.ZNPList_ZPP_Compound.__name__=["zpp_nape","util","ZNPList_ZPP_Compound"],t.util.ZNPList_ZPP_Compound.prototype.head=null,t.util.ZNPList_ZPP_Compound.prototype.begin=function(){return this.head},t.util.ZNPList_ZPP_Compound.prototype.modified=null,t.util.ZNPList_ZPP_Compound.prototype.pushmod=null,t.util.ZNPList_ZPP_Compound.prototype.length=null,t.util.ZNPList_ZPP_Compound.prototype.setbegin=function(e){this.head=e,this.modified=!0,this.pushmod=!0},t.util.ZNPList_ZPP_Compound.prototype.add=function(e){var n;null==t.util.ZNPNode_ZPP_Compound.zpp_pool?n=new t.util.ZNPNode_ZPP_Compound:(n=t.util.ZNPNode_ZPP_Compound.zpp_pool,t.util.ZNPNode_ZPP_Compound.zpp_pool=n.next,n.next=null),n.elt=e;var i=n;return i.next=this.head,this.head=i,this.modified=!0,this.length++,e},t.util.ZNPList_ZPP_Compound.prototype.inlined_add=function(e){var n;null==t.util.ZNPNode_ZPP_Compound.zpp_pool?n=new t.util.ZNPNode_ZPP_Compound:(n=t.util.ZNPNode_ZPP_Compound.zpp_pool,t.util.ZNPNode_ZPP_Compound.zpp_pool=n.next,n.next=null),n.elt=e;var i=n;return i.next=this.head,this.head=i,this.modified=!0,this.length++,e},t.util.ZNPList_ZPP_Compound.prototype.addAll=function(e){for(var t=e.head;null!=t;){var n=t.elt;this.add(n),t=t.next}},t.util.ZNPList_ZPP_Compound.prototype.insert=function(e,n){var i;null==t.util.ZNPNode_ZPP_Compound.zpp_pool?i=new t.util.ZNPNode_ZPP_Compound:(i=t.util.ZNPNode_ZPP_Compound.zpp_pool,t.util.ZNPNode_ZPP_Compound.zpp_pool=i.next,i.next=null),i.elt=n;var r=i;return null==e?(r.next=this.head,this.head=r):(r.next=e.next,e.next=r),this.pushmod=this.modified=!0,this.length++,r},t.util.ZNPList_ZPP_Compound.prototype.inlined_insert=function(e,n){var i;null==t.util.ZNPNode_ZPP_Compound.zpp_pool?i=new t.util.ZNPNode_ZPP_Compound:(i=t.util.ZNPNode_ZPP_Compound.zpp_pool,t.util.ZNPNode_ZPP_Compound.zpp_pool=i.next,i.next=null),i.elt=n;var r=i;return null==e?(r.next=this.head,this.head=r):(r.next=e.next,e.next=r),this.pushmod=this.modified=!0,this.length++,r},t.util.ZNPList_ZPP_Compound.prototype.pop=function(){var e=this.head;this.head=e.next;var n=e;n.elt=null,n.next=t.util.ZNPNode_ZPP_Compound.zpp_pool,t.util.ZNPNode_ZPP_Compound.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},t.util.ZNPList_ZPP_Compound.prototype.inlined_pop=function(){var e=this.head;this.head=e.next;var n=e;n.elt=null,n.next=t.util.ZNPNode_ZPP_Compound.zpp_pool,t.util.ZNPNode_ZPP_Compound.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},t.util.ZNPList_ZPP_Compound.prototype.pop_unsafe=function(){var e=this.head.elt;return this.pop(),e},t.util.ZNPList_ZPP_Compound.prototype.inlined_pop_unsafe=function(){var e=this.head.elt;return this.pop(),e},t.util.ZNPList_ZPP_Compound.prototype.remove=function(e){for(var n=null,i=this.head;null!=i;){if(i.elt==e){var r,o;null==n?(o=(r=this.head).next,this.head=o,null==this.head&&(this.pushmod=!0)):(o=(r=n.next).next,n.next=o,null==o&&(this.pushmod=!0));var a=r;a.elt=null,a.next=t.util.ZNPNode_ZPP_Compound.zpp_pool,t.util.ZNPNode_ZPP_Compound.zpp_pool=a,this.modified=!0,this.length--,this.pushmod=!0;break}n=i,i=i.next}},t.util.ZNPList_ZPP_Compound.prototype.try_remove=function(e){for(var t=null,n=this.head,i=!1;null!=n;){if(n.elt==e){this.erase(t),i=!0;break}t=n,n=n.next}return i},t.util.ZNPList_ZPP_Compound.prototype.inlined_remove=function(e){for(var n=null,i=this.head;null!=i;){if(i.elt==e){var r,o;null==n?(o=(r=this.head).next,this.head=o,null==this.head&&(this.pushmod=!0)):(o=(r=n.next).next,n.next=o,null==o&&(this.pushmod=!0));var a=r;a.elt=null,a.next=t.util.ZNPNode_ZPP_Compound.zpp_pool,t.util.ZNPNode_ZPP_Compound.zpp_pool=a,this.modified=!0,this.length--,this.pushmod=!0;break}n=i,i=i.next}},t.util.ZNPList_ZPP_Compound.prototype.inlined_try_remove=function(e){for(var n=null,i=this.head,r=!1;null!=i;){if(i.elt==e){var o,a;null==n?(a=(o=this.head).next,this.head=a,null==this.head&&(this.pushmod=!0)):(a=(o=n.next).next,n.next=a,null==a&&(this.pushmod=!0));var s=o;s.elt=null,s.next=t.util.ZNPNode_ZPP_Compound.zpp_pool,t.util.ZNPNode_ZPP_Compound.zpp_pool=s,this.modified=!0,this.length--,this.pushmod=!0,r=!0;break}n=i,i=i.next}return r},t.util.ZNPList_ZPP_Compound.prototype.erase=function(e){var n,i;null==e?(i=(n=this.head).next,this.head=i,null==this.head&&(this.pushmod=!0)):(i=(n=e.next).next,e.next=i,null==i&&(this.pushmod=!0));var r=n;return r.elt=null,r.next=t.util.ZNPNode_ZPP_Compound.zpp_pool,t.util.ZNPNode_ZPP_Compound.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,i},t.util.ZNPList_ZPP_Compound.prototype.inlined_erase=function(e){var n,i;null==e?(i=(n=this.head).next,this.head=i,null==this.head&&(this.pushmod=!0)):(i=(n=e.next).next,e.next=i,null==i&&(this.pushmod=!0));var r=n;return r.elt=null,r.next=t.util.ZNPNode_ZPP_Compound.zpp_pool,t.util.ZNPNode_ZPP_Compound.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,i},t.util.ZNPList_ZPP_Compound.prototype.splice=function(e,t){for(;t-- >0&&null!=e.next;)this.erase(e);return e.next},t.util.ZNPList_ZPP_Compound.prototype.clear=function(){for(;null!=this.head;){var e=this.head;this.head=e.next;var n=e;n.elt=null,n.next=t.util.ZNPNode_ZPP_Compound.zpp_pool,t.util.ZNPNode_ZPP_Compound.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},t.util.ZNPList_ZPP_Compound.prototype.inlined_clear=function(){for(;null!=this.head;){var e=this.head;this.head=e.next;var n=e;n.elt=null,n.next=t.util.ZNPNode_ZPP_Compound.zpp_pool,t.util.ZNPNode_ZPP_Compound.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},t.util.ZNPList_ZPP_Compound.prototype.reverse=function(){for(var e=this.head,t=null;null!=e;){var n=e.next;e.next=t,this.head=e,t=e,e=n}this.modified=!0,this.pushmod=!0},t.util.ZNPList_ZPP_Compound.prototype.empty=function(){return null==this.head},t.util.ZNPList_ZPP_Compound.prototype.size=function(){return this.length},t.util.ZNPList_ZPP_Compound.prototype.has=function(e){var t;t=!1;for(var n=this.head;null!=n;){if(n.elt==e){t=!0;break}n=n.next}return t},t.util.ZNPList_ZPP_Compound.prototype.inlined_has=function(e){var t;t=!1;for(var n=this.head;null!=n;){if(n.elt==e){t=!0;break}n=n.next}return t},t.util.ZNPList_ZPP_Compound.prototype.front=function(){return this.head.elt},t.util.ZNPList_ZPP_Compound.prototype.back=function(){for(var e=this.head,t=e;null!=t;)e=t,t=t.next;return e.elt},t.util.ZNPList_ZPP_Compound.prototype.iterator_at=function(e){for(var t=this.head;e-- >0&&null!=t;)t=t.next;return t},t.util.ZNPList_ZPP_Compound.prototype.at=function(e){var t=this.iterator_at(e);return null!=t?t.elt:null},t.util.ZNPList_ZPP_Compound.prototype.__class__=t.util.ZNPList_ZPP_Compound,t.util.ZNPList_ZPP_Arbiter=l["zpp_nape.util.ZNPList_ZPP_Arbiter"]=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null},t.util.ZNPList_ZPP_Arbiter.__name__=["zpp_nape","util","ZNPList_ZPP_Arbiter"],t.util.ZNPList_ZPP_Arbiter.prototype.head=null,t.util.ZNPList_ZPP_Arbiter.prototype.begin=function(){return this.head},t.util.ZNPList_ZPP_Arbiter.prototype.modified=null,t.util.ZNPList_ZPP_Arbiter.prototype.pushmod=null,t.util.ZNPList_ZPP_Arbiter.prototype.length=null,t.util.ZNPList_ZPP_Arbiter.prototype.setbegin=function(e){this.head=e,this.modified=!0,this.pushmod=!0},t.util.ZNPList_ZPP_Arbiter.prototype.add=function(e){var n;null==t.util.ZNPNode_ZPP_Arbiter.zpp_pool?n=new t.util.ZNPNode_ZPP_Arbiter:(n=t.util.ZNPNode_ZPP_Arbiter.zpp_pool,t.util.ZNPNode_ZPP_Arbiter.zpp_pool=n.next,n.next=null),n.elt=e;var i=n;return i.next=this.head,this.head=i,this.modified=!0,this.length++,e},t.util.ZNPList_ZPP_Arbiter.prototype.inlined_add=function(e){var n;null==t.util.ZNPNode_ZPP_Arbiter.zpp_pool?n=new t.util.ZNPNode_ZPP_Arbiter:(n=t.util.ZNPNode_ZPP_Arbiter.zpp_pool,t.util.ZNPNode_ZPP_Arbiter.zpp_pool=n.next,n.next=null),n.elt=e;var i=n;return i.next=this.head,this.head=i,this.modified=!0,this.length++,e},t.util.ZNPList_ZPP_Arbiter.prototype.addAll=function(e){for(var t=e.head;null!=t;){var n=t.elt;this.add(n),t=t.next}},t.util.ZNPList_ZPP_Arbiter.prototype.insert=function(e,n){var i;null==t.util.ZNPNode_ZPP_Arbiter.zpp_pool?i=new t.util.ZNPNode_ZPP_Arbiter:(i=t.util.ZNPNode_ZPP_Arbiter.zpp_pool,t.util.ZNPNode_ZPP_Arbiter.zpp_pool=i.next,i.next=null),i.elt=n;var r=i;return null==e?(r.next=this.head,this.head=r):(r.next=e.next,e.next=r),this.pushmod=this.modified=!0,this.length++,r},t.util.ZNPList_ZPP_Arbiter.prototype.inlined_insert=function(e,n){var i;null==t.util.ZNPNode_ZPP_Arbiter.zpp_pool?i=new t.util.ZNPNode_ZPP_Arbiter:(i=t.util.ZNPNode_ZPP_Arbiter.zpp_pool,t.util.ZNPNode_ZPP_Arbiter.zpp_pool=i.next,i.next=null),i.elt=n;var r=i;return null==e?(r.next=this.head,this.head=r):(r.next=e.next,e.next=r),this.pushmod=this.modified=!0,this.length++,r},t.util.ZNPList_ZPP_Arbiter.prototype.pop=function(){var e=this.head;this.head=e.next;var n=e;n.elt=null,n.next=t.util.ZNPNode_ZPP_Arbiter.zpp_pool,t.util.ZNPNode_ZPP_Arbiter.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},t.util.ZNPList_ZPP_Arbiter.prototype.inlined_pop=function(){var e=this.head;this.head=e.next;var n=e;n.elt=null,n.next=t.util.ZNPNode_ZPP_Arbiter.zpp_pool,t.util.ZNPNode_ZPP_Arbiter.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},t.util.ZNPList_ZPP_Arbiter.prototype.pop_unsafe=function(){var e=this.head.elt;return this.pop(),e},t.util.ZNPList_ZPP_Arbiter.prototype.inlined_pop_unsafe=function(){var e=this.head.elt;return this.pop(),e},t.util.ZNPList_ZPP_Arbiter.prototype.remove=function(e){for(var n=null,i=this.head;null!=i;){if(i.elt==e){var r,o;null==n?(o=(r=this.head).next,this.head=o,null==this.head&&(this.pushmod=!0)):(o=(r=n.next).next,n.next=o,null==o&&(this.pushmod=!0));var a=r;a.elt=null,a.next=t.util.ZNPNode_ZPP_Arbiter.zpp_pool,t.util.ZNPNode_ZPP_Arbiter.zpp_pool=a,this.modified=!0,this.length--,this.pushmod=!0;break}n=i,i=i.next}},t.util.ZNPList_ZPP_Arbiter.prototype.try_remove=function(e){for(var t=null,n=this.head,i=!1;null!=n;){if(n.elt==e){this.erase(t),i=!0;break}t=n,n=n.next}return i},t.util.ZNPList_ZPP_Arbiter.prototype.inlined_remove=function(e){for(var n=null,i=this.head;null!=i;){if(i.elt==e){var r,o;null==n?(o=(r=this.head).next,this.head=o,null==this.head&&(this.pushmod=!0)):(o=(r=n.next).next,n.next=o,null==o&&(this.pushmod=!0));var a=r;a.elt=null,a.next=t.util.ZNPNode_ZPP_Arbiter.zpp_pool,t.util.ZNPNode_ZPP_Arbiter.zpp_pool=a,this.modified=!0,this.length--,this.pushmod=!0;break}n=i,i=i.next}},t.util.ZNPList_ZPP_Arbiter.prototype.inlined_try_remove=function(e){for(var n=null,i=this.head,r=!1;null!=i;){if(i.elt==e){var o,a;null==n?(a=(o=this.head).next,this.head=a,null==this.head&&(this.pushmod=!0)):(a=(o=n.next).next,n.next=a,null==a&&(this.pushmod=!0));var s=o;s.elt=null,s.next=t.util.ZNPNode_ZPP_Arbiter.zpp_pool,t.util.ZNPNode_ZPP_Arbiter.zpp_pool=s,this.modified=!0,this.length--,this.pushmod=!0,r=!0;break}n=i,i=i.next}return r},t.util.ZNPList_ZPP_Arbiter.prototype.erase=function(e){var n,i;null==e?(i=(n=this.head).next,this.head=i,null==this.head&&(this.pushmod=!0)):(i=(n=e.next).next,e.next=i,null==i&&(this.pushmod=!0));var r=n;return r.elt=null,r.next=t.util.ZNPNode_ZPP_Arbiter.zpp_pool,t.util.ZNPNode_ZPP_Arbiter.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,i},t.util.ZNPList_ZPP_Arbiter.prototype.inlined_erase=function(e){var n,i;null==e?(i=(n=this.head).next,this.head=i,null==this.head&&(this.pushmod=!0)):(i=(n=e.next).next,e.next=i,null==i&&(this.pushmod=!0));var r=n;return r.elt=null,r.next=t.util.ZNPNode_ZPP_Arbiter.zpp_pool,t.util.ZNPNode_ZPP_Arbiter.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,i},t.util.ZNPList_ZPP_Arbiter.prototype.splice=function(e,t){for(;t-- >0&&null!=e.next;)this.erase(e);return e.next},t.util.ZNPList_ZPP_Arbiter.prototype.clear=function(){for(;null!=this.head;){var e=this.head;this.head=e.next;var n=e;n.elt=null,n.next=t.util.ZNPNode_ZPP_Arbiter.zpp_pool,t.util.ZNPNode_ZPP_Arbiter.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},t.util.ZNPList_ZPP_Arbiter.prototype.inlined_clear=function(){for(;null!=this.head;){var e=this.head;this.head=e.next;var n=e;n.elt=null,n.next=t.util.ZNPNode_ZPP_Arbiter.zpp_pool,t.util.ZNPNode_ZPP_Arbiter.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},t.util.ZNPList_ZPP_Arbiter.prototype.reverse=function(){for(var e=this.head,t=null;null!=e;){var n=e.next;e.next=t,this.head=e,t=e,e=n}this.modified=!0,this.pushmod=!0},t.util.ZNPList_ZPP_Arbiter.prototype.empty=function(){return null==this.head},t.util.ZNPList_ZPP_Arbiter.prototype.size=function(){return this.length},t.util.ZNPList_ZPP_Arbiter.prototype.has=function(e){var t;t=!1;for(var n=this.head;null!=n;){if(n.elt==e){t=!0;break}n=n.next}return t},t.util.ZNPList_ZPP_Arbiter.prototype.inlined_has=function(e){var t;t=!1;for(var n=this.head;null!=n;){if(n.elt==e){t=!0;break}n=n.next}return t},t.util.ZNPList_ZPP_Arbiter.prototype.front=function(){return this.head.elt},t.util.ZNPList_ZPP_Arbiter.prototype.back=function(){for(var e=this.head,t=e;null!=t;)e=t,t=t.next;return e.elt},t.util.ZNPList_ZPP_Arbiter.prototype.iterator_at=function(e){for(var t=this.head;e-- >0&&null!=t;)t=t.next;return t},t.util.ZNPList_ZPP_Arbiter.prototype.at=function(e){var t=this.iterator_at(e);return null!=t?t.elt:null},t.util.ZNPList_ZPP_Arbiter.prototype.__class__=t.util.ZNPList_ZPP_Arbiter,t.util.ZNPList_ZPP_CbSetPair=l["zpp_nape.util.ZNPList_ZPP_CbSetPair"]=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null},t.util.ZNPList_ZPP_CbSetPair.__name__=["zpp_nape","util","ZNPList_ZPP_CbSetPair"],t.util.ZNPList_ZPP_CbSetPair.prototype.head=null,t.util.ZNPList_ZPP_CbSetPair.prototype.begin=function(){return this.head},t.util.ZNPList_ZPP_CbSetPair.prototype.modified=null,t.util.ZNPList_ZPP_CbSetPair.prototype.pushmod=null,t.util.ZNPList_ZPP_CbSetPair.prototype.length=null,t.util.ZNPList_ZPP_CbSetPair.prototype.setbegin=function(e){this.head=e,this.modified=!0,this.pushmod=!0},t.util.ZNPList_ZPP_CbSetPair.prototype.add=function(e){var n;null==t.util.ZNPNode_ZPP_CbSetPair.zpp_pool?n=new t.util.ZNPNode_ZPP_CbSetPair:(n=t.util.ZNPNode_ZPP_CbSetPair.zpp_pool,t.util.ZNPNode_ZPP_CbSetPair.zpp_pool=n.next,n.next=null),n.elt=e;var i=n;return i.next=this.head,this.head=i,this.modified=!0,this.length++,e},t.util.ZNPList_ZPP_CbSetPair.prototype.inlined_add=function(e){var n;null==t.util.ZNPNode_ZPP_CbSetPair.zpp_pool?n=new t.util.ZNPNode_ZPP_CbSetPair:(n=t.util.ZNPNode_ZPP_CbSetPair.zpp_pool,t.util.ZNPNode_ZPP_CbSetPair.zpp_pool=n.next,n.next=null),n.elt=e;var i=n;return i.next=this.head,this.head=i,this.modified=!0,this.length++,e},t.util.ZNPList_ZPP_CbSetPair.prototype.addAll=function(e){for(var t=e.head;null!=t;){var n=t.elt;this.add(n),t=t.next}},t.util.ZNPList_ZPP_CbSetPair.prototype.insert=function(e,n){var i;null==t.util.ZNPNode_ZPP_CbSetPair.zpp_pool?i=new t.util.ZNPNode_ZPP_CbSetPair:(i=t.util.ZNPNode_ZPP_CbSetPair.zpp_pool,t.util.ZNPNode_ZPP_CbSetPair.zpp_pool=i.next,i.next=null),i.elt=n;var r=i;return null==e?(r.next=this.head,this.head=r):(r.next=e.next,e.next=r),this.pushmod=this.modified=!0,this.length++,r},t.util.ZNPList_ZPP_CbSetPair.prototype.inlined_insert=function(e,n){var i;null==t.util.ZNPNode_ZPP_CbSetPair.zpp_pool?i=new t.util.ZNPNode_ZPP_CbSetPair:(i=t.util.ZNPNode_ZPP_CbSetPair.zpp_pool,t.util.ZNPNode_ZPP_CbSetPair.zpp_pool=i.next,i.next=null),i.elt=n;var r=i;return null==e?(r.next=this.head,this.head=r):(r.next=e.next,e.next=r),this.pushmod=this.modified=!0,this.length++,r},t.util.ZNPList_ZPP_CbSetPair.prototype.pop=function(){var e=this.head;this.head=e.next;var n=e;n.elt=null,n.next=t.util.ZNPNode_ZPP_CbSetPair.zpp_pool,t.util.ZNPNode_ZPP_CbSetPair.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},t.util.ZNPList_ZPP_CbSetPair.prototype.inlined_pop=function(){var e=this.head;this.head=e.next;var n=e;n.elt=null,n.next=t.util.ZNPNode_ZPP_CbSetPair.zpp_pool,t.util.ZNPNode_ZPP_CbSetPair.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},t.util.ZNPList_ZPP_CbSetPair.prototype.pop_unsafe=function(){var e=this.head.elt;return this.pop(),e},t.util.ZNPList_ZPP_CbSetPair.prototype.inlined_pop_unsafe=function(){var e=this.head.elt;return this.pop(),e},t.util.ZNPList_ZPP_CbSetPair.prototype.remove=function(e){for(var n=null,i=this.head;null!=i;){if(i.elt==e){var r,o;null==n?(o=(r=this.head).next,this.head=o,null==this.head&&(this.pushmod=!0)):(o=(r=n.next).next,n.next=o,null==o&&(this.pushmod=!0));var a=r;a.elt=null,a.next=t.util.ZNPNode_ZPP_CbSetPair.zpp_pool,t.util.ZNPNode_ZPP_CbSetPair.zpp_pool=a,this.modified=!0,this.length--,this.pushmod=!0;break}n=i,i=i.next}},t.util.ZNPList_ZPP_CbSetPair.prototype.try_remove=function(e){for(var t=null,n=this.head,i=!1;null!=n;){if(n.elt==e){this.erase(t),i=!0;break}t=n,n=n.next}return i},t.util.ZNPList_ZPP_CbSetPair.prototype.inlined_remove=function(e){for(var n=null,i=this.head;null!=i;){if(i.elt==e){var r,o;null==n?(o=(r=this.head).next,this.head=o,null==this.head&&(this.pushmod=!0)):(o=(r=n.next).next,n.next=o,null==o&&(this.pushmod=!0));var a=r;a.elt=null,a.next=t.util.ZNPNode_ZPP_CbSetPair.zpp_pool,t.util.ZNPNode_ZPP_CbSetPair.zpp_pool=a,this.modified=!0,this.length--,this.pushmod=!0;break}n=i,i=i.next}},t.util.ZNPList_ZPP_CbSetPair.prototype.inlined_try_remove=function(e){for(var n=null,i=this.head,r=!1;null!=i;){if(i.elt==e){var o,a;null==n?(a=(o=this.head).next,this.head=a,null==this.head&&(this.pushmod=!0)):(a=(o=n.next).next,n.next=a,null==a&&(this.pushmod=!0));var s=o;s.elt=null,s.next=t.util.ZNPNode_ZPP_CbSetPair.zpp_pool,t.util.ZNPNode_ZPP_CbSetPair.zpp_pool=s,this.modified=!0,this.length--,this.pushmod=!0,r=!0;break}n=i,i=i.next}return r},t.util.ZNPList_ZPP_CbSetPair.prototype.erase=function(e){var n,i;null==e?(i=(n=this.head).next,this.head=i,null==this.head&&(this.pushmod=!0)):(i=(n=e.next).next,e.next=i,null==i&&(this.pushmod=!0));var r=n;return r.elt=null,r.next=t.util.ZNPNode_ZPP_CbSetPair.zpp_pool,t.util.ZNPNode_ZPP_CbSetPair.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,i},t.util.ZNPList_ZPP_CbSetPair.prototype.inlined_erase=function(e){var n,i;null==e?(i=(n=this.head).next,this.head=i,null==this.head&&(this.pushmod=!0)):(i=(n=e.next).next,e.next=i,null==i&&(this.pushmod=!0));var r=n;return r.elt=null,r.next=t.util.ZNPNode_ZPP_CbSetPair.zpp_pool,t.util.ZNPNode_ZPP_CbSetPair.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,i},t.util.ZNPList_ZPP_CbSetPair.prototype.splice=function(e,t){for(;t-- >0&&null!=e.next;)this.erase(e);return e.next},t.util.ZNPList_ZPP_CbSetPair.prototype.clear=function(){for(;null!=this.head;){var e=this.head;this.head=e.next;var n=e;n.elt=null,n.next=t.util.ZNPNode_ZPP_CbSetPair.zpp_pool,t.util.ZNPNode_ZPP_CbSetPair.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},t.util.ZNPList_ZPP_CbSetPair.prototype.inlined_clear=function(){for(;null!=this.head;){var e=this.head;this.head=e.next;var n=e;n.elt=null,n.next=t.util.ZNPNode_ZPP_CbSetPair.zpp_pool,t.util.ZNPNode_ZPP_CbSetPair.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},t.util.ZNPList_ZPP_CbSetPair.prototype.reverse=function(){for(var e=this.head,t=null;null!=e;){var n=e.next;e.next=t,this.head=e,t=e,e=n}this.modified=!0,this.pushmod=!0},t.util.ZNPList_ZPP_CbSetPair.prototype.empty=function(){return null==this.head},t.util.ZNPList_ZPP_CbSetPair.prototype.size=function(){return this.length},t.util.ZNPList_ZPP_CbSetPair.prototype.has=function(e){var t;t=!1;for(var n=this.head;null!=n;){if(n.elt==e){t=!0;break}n=n.next}return t},t.util.ZNPList_ZPP_CbSetPair.prototype.inlined_has=function(e){var t;t=!1;for(var n=this.head;null!=n;){if(n.elt==e){t=!0;break}n=n.next}return t},t.util.ZNPList_ZPP_CbSetPair.prototype.front=function(){return this.head.elt},t.util.ZNPList_ZPP_CbSetPair.prototype.back=function(){for(var e=this.head,t=e;null!=t;)e=t,t=t.next;return e.elt},t.util.ZNPList_ZPP_CbSetPair.prototype.iterator_at=function(e){for(var t=this.head;e-- >0&&null!=t;)t=t.next;return t},t.util.ZNPList_ZPP_CbSetPair.prototype.at=function(e){var t=this.iterator_at(e);return null!=t?t.elt:null},t.util.ZNPList_ZPP_CbSetPair.prototype.__class__=t.util.ZNPList_ZPP_CbSetPair,t.util.ZNPList_ZPP_CutInt=l["zpp_nape.util.ZNPList_ZPP_CutInt"]=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null},t.util.ZNPList_ZPP_CutInt.__name__=["zpp_nape","util","ZNPList_ZPP_CutInt"],t.util.ZNPList_ZPP_CutInt.prototype.head=null,t.util.ZNPList_ZPP_CutInt.prototype.begin=function(){return this.head},t.util.ZNPList_ZPP_CutInt.prototype.modified=null,t.util.ZNPList_ZPP_CutInt.prototype.pushmod=null,t.util.ZNPList_ZPP_CutInt.prototype.length=null,t.util.ZNPList_ZPP_CutInt.prototype.setbegin=function(e){this.head=e,this.modified=!0,this.pushmod=!0},t.util.ZNPList_ZPP_CutInt.prototype.add=function(e){var n;null==t.util.ZNPNode_ZPP_CutInt.zpp_pool?n=new t.util.ZNPNode_ZPP_CutInt:(n=t.util.ZNPNode_ZPP_CutInt.zpp_pool,t.util.ZNPNode_ZPP_CutInt.zpp_pool=n.next,n.next=null),n.elt=e;var i=n;return i.next=this.head,this.head=i,this.modified=!0,this.length++,e},t.util.ZNPList_ZPP_CutInt.prototype.inlined_add=function(e){var n;null==t.util.ZNPNode_ZPP_CutInt.zpp_pool?n=new t.util.ZNPNode_ZPP_CutInt:(n=t.util.ZNPNode_ZPP_CutInt.zpp_pool,t.util.ZNPNode_ZPP_CutInt.zpp_pool=n.next,n.next=null),n.elt=e;var i=n;return i.next=this.head,this.head=i,this.modified=!0,this.length++,e},t.util.ZNPList_ZPP_CutInt.prototype.addAll=function(e){for(var t=e.head;null!=t;){var n=t.elt;this.add(n),t=t.next}},t.util.ZNPList_ZPP_CutInt.prototype.insert=function(e,n){var i;null==t.util.ZNPNode_ZPP_CutInt.zpp_pool?i=new t.util.ZNPNode_ZPP_CutInt:(i=t.util.ZNPNode_ZPP_CutInt.zpp_pool,t.util.ZNPNode_ZPP_CutInt.zpp_pool=i.next,i.next=null),i.elt=n;var r=i;return null==e?(r.next=this.head,this.head=r):(r.next=e.next,e.next=r),this.pushmod=this.modified=!0,this.length++,r},t.util.ZNPList_ZPP_CutInt.prototype.inlined_insert=function(e,n){var i;null==t.util.ZNPNode_ZPP_CutInt.zpp_pool?i=new t.util.ZNPNode_ZPP_CutInt:(i=t.util.ZNPNode_ZPP_CutInt.zpp_pool,t.util.ZNPNode_ZPP_CutInt.zpp_pool=i.next,i.next=null),i.elt=n;var r=i;return null==e?(r.next=this.head,this.head=r):(r.next=e.next,e.next=r),this.pushmod=this.modified=!0,this.length++,r},t.util.ZNPList_ZPP_CutInt.prototype.pop=function(){var e=this.head;this.head=e.next;var n=e;n.elt=null,n.next=t.util.ZNPNode_ZPP_CutInt.zpp_pool,t.util.ZNPNode_ZPP_CutInt.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},t.util.ZNPList_ZPP_CutInt.prototype.inlined_pop=function(){var e=this.head;this.head=e.next;var n=e;n.elt=null,n.next=t.util.ZNPNode_ZPP_CutInt.zpp_pool,t.util.ZNPNode_ZPP_CutInt.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},t.util.ZNPList_ZPP_CutInt.prototype.pop_unsafe=function(){var e=this.head.elt;return this.pop(),e},t.util.ZNPList_ZPP_CutInt.prototype.inlined_pop_unsafe=function(){var e=this.head.elt;return this.pop(),e},t.util.ZNPList_ZPP_CutInt.prototype.remove=function(e){for(var n=null,i=this.head;null!=i;){if(i.elt==e){var r,o;null==n?(o=(r=this.head).next,this.head=o,null==this.head&&(this.pushmod=!0)):(o=(r=n.next).next,n.next=o,null==o&&(this.pushmod=!0));var a=r;a.elt=null,a.next=t.util.ZNPNode_ZPP_CutInt.zpp_pool,t.util.ZNPNode_ZPP_CutInt.zpp_pool=a,this.modified=!0,this.length--,this.pushmod=!0;break}n=i,i=i.next}},t.util.ZNPList_ZPP_CutInt.prototype.try_remove=function(e){for(var t=null,n=this.head,i=!1;null!=n;){if(n.elt==e){this.erase(t),i=!0;break}t=n,n=n.next}return i},t.util.ZNPList_ZPP_CutInt.prototype.inlined_remove=function(e){for(var n=null,i=this.head;null!=i;){if(i.elt==e){var r,o;null==n?(o=(r=this.head).next,this.head=o,null==this.head&&(this.pushmod=!0)):(o=(r=n.next).next,n.next=o,null==o&&(this.pushmod=!0));var a=r;a.elt=null,a.next=t.util.ZNPNode_ZPP_CutInt.zpp_pool,t.util.ZNPNode_ZPP_CutInt.zpp_pool=a,this.modified=!0,this.length--,this.pushmod=!0;break}n=i,i=i.next}},t.util.ZNPList_ZPP_CutInt.prototype.inlined_try_remove=function(e){for(var n=null,i=this.head,r=!1;null!=i;){if(i.elt==e){var o,a;null==n?(a=(o=this.head).next,this.head=a,null==this.head&&(this.pushmod=!0)):(a=(o=n.next).next,n.next=a,null==a&&(this.pushmod=!0));var s=o;s.elt=null,s.next=t.util.ZNPNode_ZPP_CutInt.zpp_pool,t.util.ZNPNode_ZPP_CutInt.zpp_pool=s,this.modified=!0,this.length--,this.pushmod=!0,r=!0;break}n=i,i=i.next}return r},t.util.ZNPList_ZPP_CutInt.prototype.erase=function(e){var n,i;null==e?(i=(n=this.head).next,this.head=i,null==this.head&&(this.pushmod=!0)):(i=(n=e.next).next,e.next=i,null==i&&(this.pushmod=!0));var r=n;return r.elt=null,r.next=t.util.ZNPNode_ZPP_CutInt.zpp_pool,t.util.ZNPNode_ZPP_CutInt.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,i},t.util.ZNPList_ZPP_CutInt.prototype.inlined_erase=function(e){var n,i;null==e?(i=(n=this.head).next,this.head=i,null==this.head&&(this.pushmod=!0)):(i=(n=e.next).next,e.next=i,null==i&&(this.pushmod=!0));var r=n;return r.elt=null,r.next=t.util.ZNPNode_ZPP_CutInt.zpp_pool,t.util.ZNPNode_ZPP_CutInt.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,i},t.util.ZNPList_ZPP_CutInt.prototype.splice=function(e,t){for(;t-- >0&&null!=e.next;)this.erase(e);return e.next},t.util.ZNPList_ZPP_CutInt.prototype.clear=function(){for(;null!=this.head;){var e=this.head;this.head=e.next;var n=e;n.elt=null,n.next=t.util.ZNPNode_ZPP_CutInt.zpp_pool,t.util.ZNPNode_ZPP_CutInt.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},t.util.ZNPList_ZPP_CutInt.prototype.inlined_clear=function(){for(;null!=this.head;){var e=this.head;this.head=e.next;var n=e;n.elt=null,n.next=t.util.ZNPNode_ZPP_CutInt.zpp_pool,t.util.ZNPNode_ZPP_CutInt.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},t.util.ZNPList_ZPP_CutInt.prototype.reverse=function(){for(var e=this.head,t=null;null!=e;){var n=e.next;e.next=t,this.head=e,t=e,e=n}this.modified=!0,this.pushmod=!0},t.util.ZNPList_ZPP_CutInt.prototype.empty=function(){return null==this.head},t.util.ZNPList_ZPP_CutInt.prototype.size=function(){return this.length},t.util.ZNPList_ZPP_CutInt.prototype.has=function(e){var t;t=!1;for(var n=this.head;null!=n;){if(n.elt==e){t=!0;break}n=n.next}return t},t.util.ZNPList_ZPP_CutInt.prototype.inlined_has=function(e){var t;t=!1;for(var n=this.head;null!=n;){if(n.elt==e){t=!0;break}n=n.next}return t},t.util.ZNPList_ZPP_CutInt.prototype.front=function(){return this.head.elt},t.util.ZNPList_ZPP_CutInt.prototype.back=function(){for(var e=this.head,t=e;null!=t;)e=t,t=t.next;return e.elt},t.util.ZNPList_ZPP_CutInt.prototype.iterator_at=function(e){for(var t=this.head;e-- >0&&null!=t;)t=t.next;return t},t.util.ZNPList_ZPP_CutInt.prototype.at=function(e){var t=this.iterator_at(e);return null!=t?t.elt:null},t.util.ZNPList_ZPP_CutInt.prototype.__class__=t.util.ZNPList_ZPP_CutInt,t.util.ZNPList_ZPP_CutVert=l["zpp_nape.util.ZNPList_ZPP_CutVert"]=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null},t.util.ZNPList_ZPP_CutVert.__name__=["zpp_nape","util","ZNPList_ZPP_CutVert"],t.util.ZNPList_ZPP_CutVert.prototype.head=null,t.util.ZNPList_ZPP_CutVert.prototype.begin=function(){return this.head},t.util.ZNPList_ZPP_CutVert.prototype.modified=null,t.util.ZNPList_ZPP_CutVert.prototype.pushmod=null,t.util.ZNPList_ZPP_CutVert.prototype.length=null,t.util.ZNPList_ZPP_CutVert.prototype.setbegin=function(e){this.head=e,this.modified=!0,this.pushmod=!0},t.util.ZNPList_ZPP_CutVert.prototype.add=function(e){var n;null==t.util.ZNPNode_ZPP_CutVert.zpp_pool?n=new t.util.ZNPNode_ZPP_CutVert:(n=t.util.ZNPNode_ZPP_CutVert.zpp_pool,t.util.ZNPNode_ZPP_CutVert.zpp_pool=n.next,n.next=null),n.elt=e;var i=n;return i.next=this.head,this.head=i,this.modified=!0,this.length++,e},t.util.ZNPList_ZPP_CutVert.prototype.inlined_add=function(e){var n;null==t.util.ZNPNode_ZPP_CutVert.zpp_pool?n=new t.util.ZNPNode_ZPP_CutVert:(n=t.util.ZNPNode_ZPP_CutVert.zpp_pool,t.util.ZNPNode_ZPP_CutVert.zpp_pool=n.next,n.next=null),n.elt=e;var i=n;return i.next=this.head,this.head=i,this.modified=!0,this.length++,e},t.util.ZNPList_ZPP_CutVert.prototype.addAll=function(e){for(var t=e.head;null!=t;){var n=t.elt;this.add(n),t=t.next}},t.util.ZNPList_ZPP_CutVert.prototype.insert=function(e,n){var i;null==t.util.ZNPNode_ZPP_CutVert.zpp_pool?i=new t.util.ZNPNode_ZPP_CutVert:(i=t.util.ZNPNode_ZPP_CutVert.zpp_pool,t.util.ZNPNode_ZPP_CutVert.zpp_pool=i.next,i.next=null),i.elt=n;var r=i;return null==e?(r.next=this.head,this.head=r):(r.next=e.next,e.next=r),this.pushmod=this.modified=!0,this.length++,r},t.util.ZNPList_ZPP_CutVert.prototype.inlined_insert=function(e,n){var i;null==t.util.ZNPNode_ZPP_CutVert.zpp_pool?i=new t.util.ZNPNode_ZPP_CutVert:(i=t.util.ZNPNode_ZPP_CutVert.zpp_pool,t.util.ZNPNode_ZPP_CutVert.zpp_pool=i.next,i.next=null),i.elt=n;var r=i;return null==e?(r.next=this.head,this.head=r):(r.next=e.next,e.next=r),this.pushmod=this.modified=!0,this.length++,r},t.util.ZNPList_ZPP_CutVert.prototype.pop=function(){var e=this.head;this.head=e.next;var n=e;n.elt=null,n.next=t.util.ZNPNode_ZPP_CutVert.zpp_pool,t.util.ZNPNode_ZPP_CutVert.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},t.util.ZNPList_ZPP_CutVert.prototype.inlined_pop=function(){var e=this.head;this.head=e.next;var n=e;n.elt=null,n.next=t.util.ZNPNode_ZPP_CutVert.zpp_pool,t.util.ZNPNode_ZPP_CutVert.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},t.util.ZNPList_ZPP_CutVert.prototype.pop_unsafe=function(){var e=this.head.elt;return this.pop(),e},t.util.ZNPList_ZPP_CutVert.prototype.inlined_pop_unsafe=function(){var e=this.head.elt;return this.pop(),e},t.util.ZNPList_ZPP_CutVert.prototype.remove=function(e){for(var n=null,i=this.head;null!=i;){if(i.elt==e){var r,o;null==n?(o=(r=this.head).next,this.head=o,null==this.head&&(this.pushmod=!0)):(o=(r=n.next).next,n.next=o,null==o&&(this.pushmod=!0));var a=r;a.elt=null,a.next=t.util.ZNPNode_ZPP_CutVert.zpp_pool,t.util.ZNPNode_ZPP_CutVert.zpp_pool=a,this.modified=!0,this.length--,this.pushmod=!0;break}n=i,i=i.next}},t.util.ZNPList_ZPP_CutVert.prototype.try_remove=function(e){for(var t=null,n=this.head,i=!1;null!=n;){if(n.elt==e){this.erase(t),i=!0;break}t=n,n=n.next}return i},t.util.ZNPList_ZPP_CutVert.prototype.inlined_remove=function(e){for(var n=null,i=this.head;null!=i;){if(i.elt==e){var r,o;null==n?(o=(r=this.head).next,this.head=o,null==this.head&&(this.pushmod=!0)):(o=(r=n.next).next,n.next=o,null==o&&(this.pushmod=!0));var a=r;a.elt=null,a.next=t.util.ZNPNode_ZPP_CutVert.zpp_pool,t.util.ZNPNode_ZPP_CutVert.zpp_pool=a,this.modified=!0,this.length--,this.pushmod=!0;break}n=i,i=i.next}},t.util.ZNPList_ZPP_CutVert.prototype.inlined_try_remove=function(e){for(var n=null,i=this.head,r=!1;null!=i;){if(i.elt==e){var o,a;null==n?(a=(o=this.head).next,this.head=a,null==this.head&&(this.pushmod=!0)):(a=(o=n.next).next,n.next=a,null==a&&(this.pushmod=!0));var s=o;s.elt=null,s.next=t.util.ZNPNode_ZPP_CutVert.zpp_pool,t.util.ZNPNode_ZPP_CutVert.zpp_pool=s,this.modified=!0,this.length--,this.pushmod=!0,r=!0;break}n=i,i=i.next}return r},t.util.ZNPList_ZPP_CutVert.prototype.erase=function(e){var n,i;null==e?(i=(n=this.head).next,this.head=i,null==this.head&&(this.pushmod=!0)):(i=(n=e.next).next,e.next=i,null==i&&(this.pushmod=!0));var r=n;return r.elt=null,r.next=t.util.ZNPNode_ZPP_CutVert.zpp_pool,t.util.ZNPNode_ZPP_CutVert.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,i},t.util.ZNPList_ZPP_CutVert.prototype.inlined_erase=function(e){var n,i;null==e?(i=(n=this.head).next,this.head=i,null==this.head&&(this.pushmod=!0)):(i=(n=e.next).next,e.next=i,null==i&&(this.pushmod=!0));var r=n;return r.elt=null,r.next=t.util.ZNPNode_ZPP_CutVert.zpp_pool,t.util.ZNPNode_ZPP_CutVert.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,i},t.util.ZNPList_ZPP_CutVert.prototype.splice=function(e,t){for(;t-- >0&&null!=e.next;)this.erase(e);return e.next},t.util.ZNPList_ZPP_CutVert.prototype.clear=function(){for(;null!=this.head;){var e=this.head;this.head=e.next;var n=e;n.elt=null,n.next=t.util.ZNPNode_ZPP_CutVert.zpp_pool,t.util.ZNPNode_ZPP_CutVert.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},t.util.ZNPList_ZPP_CutVert.prototype.inlined_clear=function(){for(;null!=this.head;){var e=this.head;this.head=e.next;var n=e;n.elt=null,n.next=t.util.ZNPNode_ZPP_CutVert.zpp_pool,t.util.ZNPNode_ZPP_CutVert.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},t.util.ZNPList_ZPP_CutVert.prototype.reverse=function(){for(var e=this.head,t=null;null!=e;){var n=e.next;e.next=t,this.head=e,t=e,e=n}this.modified=!0,this.pushmod=!0},t.util.ZNPList_ZPP_CutVert.prototype.empty=function(){return null==this.head},t.util.ZNPList_ZPP_CutVert.prototype.size=function(){return this.length},t.util.ZNPList_ZPP_CutVert.prototype.has=function(e){var t;t=!1;for(var n=this.head;null!=n;){if(n.elt==e){t=!0;break}n=n.next}return t},t.util.ZNPList_ZPP_CutVert.prototype.inlined_has=function(e){var t;t=!1;for(var n=this.head;null!=n;){if(n.elt==e){t=!0;break}n=n.next}return t},t.util.ZNPList_ZPP_CutVert.prototype.front=function(){return this.head.elt},t.util.ZNPList_ZPP_CutVert.prototype.back=function(){for(var e=this.head,t=e;null!=t;)e=t,t=t.next;return e.elt},t.util.ZNPList_ZPP_CutVert.prototype.iterator_at=function(e){for(var t=this.head;e-- >0&&null!=t;)t=t.next;return t},t.util.ZNPList_ZPP_CutVert.prototype.at=function(e){var t=this.iterator_at(e);return null!=t?t.elt:null},t.util.ZNPList_ZPP_CutVert.prototype.__class__=t.util.ZNPList_ZPP_CutVert,t.util.ZNPList_ZPP_PartitionVertex=l["zpp_nape.util.ZNPList_ZPP_PartitionVertex"]=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null},t.util.ZNPList_ZPP_PartitionVertex.__name__=["zpp_nape","util","ZNPList_ZPP_PartitionVertex"],t.util.ZNPList_ZPP_PartitionVertex.prototype.head=null,t.util.ZNPList_ZPP_PartitionVertex.prototype.begin=function(){return this.head},t.util.ZNPList_ZPP_PartitionVertex.prototype.modified=null,t.util.ZNPList_ZPP_PartitionVertex.prototype.pushmod=null,t.util.ZNPList_ZPP_PartitionVertex.prototype.length=null,t.util.ZNPList_ZPP_PartitionVertex.prototype.setbegin=function(e){this.head=e,this.modified=!0,this.pushmod=!0},t.util.ZNPList_ZPP_PartitionVertex.prototype.add=function(e){var n;null==t.util.ZNPNode_ZPP_PartitionVertex.zpp_pool?n=new t.util.ZNPNode_ZPP_PartitionVertex:(n=t.util.ZNPNode_ZPP_PartitionVertex.zpp_pool,t.util.ZNPNode_ZPP_PartitionVertex.zpp_pool=n.next,n.next=null),n.elt=e;var i=n;return i.next=this.head,this.head=i,this.modified=!0,this.length++,e},t.util.ZNPList_ZPP_PartitionVertex.prototype.inlined_add=function(e){var n;null==t.util.ZNPNode_ZPP_PartitionVertex.zpp_pool?n=new t.util.ZNPNode_ZPP_PartitionVertex:(n=t.util.ZNPNode_ZPP_PartitionVertex.zpp_pool,t.util.ZNPNode_ZPP_PartitionVertex.zpp_pool=n.next,n.next=null),n.elt=e;var i=n;return i.next=this.head,this.head=i,this.modified=!0,this.length++,e},t.util.ZNPList_ZPP_PartitionVertex.prototype.addAll=function(e){for(var t=e.head;null!=t;){var n=t.elt;this.add(n),t=t.next}},t.util.ZNPList_ZPP_PartitionVertex.prototype.insert=function(e,n){var i;null==t.util.ZNPNode_ZPP_PartitionVertex.zpp_pool?i=new t.util.ZNPNode_ZPP_PartitionVertex:(i=t.util.ZNPNode_ZPP_PartitionVertex.zpp_pool,t.util.ZNPNode_ZPP_PartitionVertex.zpp_pool=i.next,i.next=null),i.elt=n;var r=i;return null==e?(r.next=this.head,this.head=r):(r.next=e.next,e.next=r),this.pushmod=this.modified=!0,this.length++,r},t.util.ZNPList_ZPP_PartitionVertex.prototype.inlined_insert=function(e,n){var i;null==t.util.ZNPNode_ZPP_PartitionVertex.zpp_pool?i=new t.util.ZNPNode_ZPP_PartitionVertex:(i=t.util.ZNPNode_ZPP_PartitionVertex.zpp_pool,t.util.ZNPNode_ZPP_PartitionVertex.zpp_pool=i.next,i.next=null),i.elt=n;var r=i;return null==e?(r.next=this.head,this.head=r):(r.next=e.next,e.next=r),this.pushmod=this.modified=!0,this.length++,r},t.util.ZNPList_ZPP_PartitionVertex.prototype.pop=function(){var e=this.head;this.head=e.next;var n=e;n.elt=null,n.next=t.util.ZNPNode_ZPP_PartitionVertex.zpp_pool,t.util.ZNPNode_ZPP_PartitionVertex.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},t.util.ZNPList_ZPP_PartitionVertex.prototype.inlined_pop=function(){var e=this.head;this.head=e.next;var n=e;n.elt=null,n.next=t.util.ZNPNode_ZPP_PartitionVertex.zpp_pool,t.util.ZNPNode_ZPP_PartitionVertex.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},t.util.ZNPList_ZPP_PartitionVertex.prototype.pop_unsafe=function(){var e=this.head.elt;return this.pop(),e},t.util.ZNPList_ZPP_PartitionVertex.prototype.inlined_pop_unsafe=function(){var e=this.head.elt;return this.pop(),e},t.util.ZNPList_ZPP_PartitionVertex.prototype.remove=function(e){for(var n=null,i=this.head;null!=i;){if(i.elt==e){var r,o;null==n?(o=(r=this.head).next,this.head=o,null==this.head&&(this.pushmod=!0)):(o=(r=n.next).next,n.next=o,null==o&&(this.pushmod=!0));var a=r;a.elt=null,a.next=t.util.ZNPNode_ZPP_PartitionVertex.zpp_pool,t.util.ZNPNode_ZPP_PartitionVertex.zpp_pool=a,this.modified=!0,this.length--,this.pushmod=!0;break}n=i,i=i.next}},t.util.ZNPList_ZPP_PartitionVertex.prototype.try_remove=function(e){for(var t=null,n=this.head,i=!1;null!=n;){if(n.elt==e){this.erase(t),i=!0;break}t=n,n=n.next}return i},t.util.ZNPList_ZPP_PartitionVertex.prototype.inlined_remove=function(e){for(var n=null,i=this.head;null!=i;){if(i.elt==e){var r,o;null==n?(o=(r=this.head).next,this.head=o,null==this.head&&(this.pushmod=!0)):(o=(r=n.next).next,n.next=o,null==o&&(this.pushmod=!0));var a=r;a.elt=null,a.next=t.util.ZNPNode_ZPP_PartitionVertex.zpp_pool,t.util.ZNPNode_ZPP_PartitionVertex.zpp_pool=a,this.modified=!0,this.length--,this.pushmod=!0;break}n=i,i=i.next}},t.util.ZNPList_ZPP_PartitionVertex.prototype.inlined_try_remove=function(e){for(var n=null,i=this.head,r=!1;null!=i;){if(i.elt==e){var o,a;null==n?(a=(o=this.head).next,this.head=a,null==this.head&&(this.pushmod=!0)):(a=(o=n.next).next,n.next=a,null==a&&(this.pushmod=!0));var s=o;s.elt=null,s.next=t.util.ZNPNode_ZPP_PartitionVertex.zpp_pool,t.util.ZNPNode_ZPP_PartitionVertex.zpp_pool=s,this.modified=!0,this.length--,this.pushmod=!0,r=!0;break}n=i,i=i.next}return r},t.util.ZNPList_ZPP_PartitionVertex.prototype.erase=function(e){var n,i;null==e?(i=(n=this.head).next,this.head=i,null==this.head&&(this.pushmod=!0)):(i=(n=e.next).next,e.next=i,null==i&&(this.pushmod=!0));var r=n;return r.elt=null,r.next=t.util.ZNPNode_ZPP_PartitionVertex.zpp_pool,t.util.ZNPNode_ZPP_PartitionVertex.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,i},t.util.ZNPList_ZPP_PartitionVertex.prototype.inlined_erase=function(e){var n,i;null==e?(i=(n=this.head).next,this.head=i,null==this.head&&(this.pushmod=!0)):(i=(n=e.next).next,e.next=i,null==i&&(this.pushmod=!0));var r=n;return r.elt=null,r.next=t.util.ZNPNode_ZPP_PartitionVertex.zpp_pool,t.util.ZNPNode_ZPP_PartitionVertex.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,i},t.util.ZNPList_ZPP_PartitionVertex.prototype.splice=function(e,t){for(;t-- >0&&null!=e.next;)this.erase(e);return e.next},t.util.ZNPList_ZPP_PartitionVertex.prototype.clear=function(){for(;null!=this.head;){var e=this.head;this.head=e.next;var n=e;n.elt=null,n.next=t.util.ZNPNode_ZPP_PartitionVertex.zpp_pool,t.util.ZNPNode_ZPP_PartitionVertex.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},t.util.ZNPList_ZPP_PartitionVertex.prototype.inlined_clear=function(){for(;null!=this.head;){var e=this.head;this.head=e.next;var n=e;n.elt=null,n.next=t.util.ZNPNode_ZPP_PartitionVertex.zpp_pool,t.util.ZNPNode_ZPP_PartitionVertex.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},t.util.ZNPList_ZPP_PartitionVertex.prototype.reverse=function(){for(var e=this.head,t=null;null!=e;){var n=e.next;e.next=t,this.head=e,t=e,e=n}this.modified=!0,this.pushmod=!0},t.util.ZNPList_ZPP_PartitionVertex.prototype.empty=function(){return null==this.head},t.util.ZNPList_ZPP_PartitionVertex.prototype.size=function(){return this.length},t.util.ZNPList_ZPP_PartitionVertex.prototype.has=function(e){var t;t=!1;for(var n=this.head;null!=n;){if(n.elt==e){t=!0;break}n=n.next}return t},t.util.ZNPList_ZPP_PartitionVertex.prototype.inlined_has=function(e){var t;t=!1;for(var n=this.head;null!=n;){if(n.elt==e){t=!0;break}n=n.next}return t},t.util.ZNPList_ZPP_PartitionVertex.prototype.front=function(){return this.head.elt},t.util.ZNPList_ZPP_PartitionVertex.prototype.back=function(){for(var e=this.head,t=e;null!=t;)e=t,t=t.next;return e.elt},t.util.ZNPList_ZPP_PartitionVertex.prototype.iterator_at=function(e){for(var t=this.head;e-- >0&&null!=t;)t=t.next;return t},t.util.ZNPList_ZPP_PartitionVertex.prototype.at=function(e){var t=this.iterator_at(e);return null!=t?t.elt:null},t.util.ZNPList_ZPP_PartitionVertex.prototype.__class__=t.util.ZNPList_ZPP_PartitionVertex,t.util.ZNPList_ZPP_SimplifyP=l["zpp_nape.util.ZNPList_ZPP_SimplifyP"]=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null},t.util.ZNPList_ZPP_SimplifyP.__name__=["zpp_nape","util","ZNPList_ZPP_SimplifyP"],t.util.ZNPList_ZPP_SimplifyP.prototype.head=null,t.util.ZNPList_ZPP_SimplifyP.prototype.begin=function(){return this.head},t.util.ZNPList_ZPP_SimplifyP.prototype.modified=null,t.util.ZNPList_ZPP_SimplifyP.prototype.pushmod=null,t.util.ZNPList_ZPP_SimplifyP.prototype.length=null,t.util.ZNPList_ZPP_SimplifyP.prototype.setbegin=function(e){this.head=e,this.modified=!0,this.pushmod=!0},t.util.ZNPList_ZPP_SimplifyP.prototype.add=function(e){var n;null==t.util.ZNPNode_ZPP_SimplifyP.zpp_pool?n=new t.util.ZNPNode_ZPP_SimplifyP:(n=t.util.ZNPNode_ZPP_SimplifyP.zpp_pool,t.util.ZNPNode_ZPP_SimplifyP.zpp_pool=n.next,n.next=null),n.elt=e;var i=n;return i.next=this.head,this.head=i,this.modified=!0,this.length++,e},t.util.ZNPList_ZPP_SimplifyP.prototype.inlined_add=function(e){var n;null==t.util.ZNPNode_ZPP_SimplifyP.zpp_pool?n=new t.util.ZNPNode_ZPP_SimplifyP:(n=t.util.ZNPNode_ZPP_SimplifyP.zpp_pool,t.util.ZNPNode_ZPP_SimplifyP.zpp_pool=n.next,n.next=null),n.elt=e;var i=n;return i.next=this.head,this.head=i,this.modified=!0,this.length++,e},t.util.ZNPList_ZPP_SimplifyP.prototype.addAll=function(e){for(var t=e.head;null!=t;){var n=t.elt;this.add(n),t=t.next}},t.util.ZNPList_ZPP_SimplifyP.prototype.insert=function(e,n){var i;null==t.util.ZNPNode_ZPP_SimplifyP.zpp_pool?i=new t.util.ZNPNode_ZPP_SimplifyP:(i=t.util.ZNPNode_ZPP_SimplifyP.zpp_pool,t.util.ZNPNode_ZPP_SimplifyP.zpp_pool=i.next,i.next=null),i.elt=n;var r=i;return null==e?(r.next=this.head,this.head=r):(r.next=e.next,e.next=r),this.pushmod=this.modified=!0,this.length++,r},t.util.ZNPList_ZPP_SimplifyP.prototype.inlined_insert=function(e,n){var i;null==t.util.ZNPNode_ZPP_SimplifyP.zpp_pool?i=new t.util.ZNPNode_ZPP_SimplifyP:(i=t.util.ZNPNode_ZPP_SimplifyP.zpp_pool,t.util.ZNPNode_ZPP_SimplifyP.zpp_pool=i.next,i.next=null),i.elt=n;var r=i;return null==e?(r.next=this.head,this.head=r):(r.next=e.next,e.next=r),this.pushmod=this.modified=!0,this.length++,r},t.util.ZNPList_ZPP_SimplifyP.prototype.pop=function(){var e=this.head;this.head=e.next;var n=e;n.elt=null,n.next=t.util.ZNPNode_ZPP_SimplifyP.zpp_pool,t.util.ZNPNode_ZPP_SimplifyP.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},t.util.ZNPList_ZPP_SimplifyP.prototype.inlined_pop=function(){var e=this.head;this.head=e.next;var n=e;n.elt=null,n.next=t.util.ZNPNode_ZPP_SimplifyP.zpp_pool,t.util.ZNPNode_ZPP_SimplifyP.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},t.util.ZNPList_ZPP_SimplifyP.prototype.pop_unsafe=function(){var e=this.head.elt;return this.pop(),e},t.util.ZNPList_ZPP_SimplifyP.prototype.inlined_pop_unsafe=function(){var e=this.head.elt;return this.pop(),e},t.util.ZNPList_ZPP_SimplifyP.prototype.remove=function(e){for(var n=null,i=this.head;null!=i;){if(i.elt==e){var r,o;null==n?(o=(r=this.head).next,this.head=o,null==this.head&&(this.pushmod=!0)):(o=(r=n.next).next,n.next=o,null==o&&(this.pushmod=!0));var a=r;a.elt=null,a.next=t.util.ZNPNode_ZPP_SimplifyP.zpp_pool,t.util.ZNPNode_ZPP_SimplifyP.zpp_pool=a,this.modified=!0,this.length--,this.pushmod=!0;break}n=i,i=i.next}},t.util.ZNPList_ZPP_SimplifyP.prototype.try_remove=function(e){for(var t=null,n=this.head,i=!1;null!=n;){if(n.elt==e){this.erase(t),i=!0;break}t=n,n=n.next}return i},t.util.ZNPList_ZPP_SimplifyP.prototype.inlined_remove=function(e){for(var n=null,i=this.head;null!=i;){if(i.elt==e){var r,o;null==n?(o=(r=this.head).next,this.head=o,null==this.head&&(this.pushmod=!0)):(o=(r=n.next).next,n.next=o,null==o&&(this.pushmod=!0));var a=r;a.elt=null,a.next=t.util.ZNPNode_ZPP_SimplifyP.zpp_pool,t.util.ZNPNode_ZPP_SimplifyP.zpp_pool=a,this.modified=!0,this.length--,this.pushmod=!0;break}n=i,i=i.next}},t.util.ZNPList_ZPP_SimplifyP.prototype.inlined_try_remove=function(e){for(var n=null,i=this.head,r=!1;null!=i;){if(i.elt==e){var o,a;null==n?(a=(o=this.head).next,this.head=a,null==this.head&&(this.pushmod=!0)):(a=(o=n.next).next,n.next=a,null==a&&(this.pushmod=!0));var s=o;s.elt=null,s.next=t.util.ZNPNode_ZPP_SimplifyP.zpp_pool,t.util.ZNPNode_ZPP_SimplifyP.zpp_pool=s,this.modified=!0,this.length--,this.pushmod=!0,r=!0;break}n=i,i=i.next}return r},t.util.ZNPList_ZPP_SimplifyP.prototype.erase=function(e){var n,i;null==e?(i=(n=this.head).next,this.head=i,null==this.head&&(this.pushmod=!0)):(i=(n=e.next).next,e.next=i,null==i&&(this.pushmod=!0));var r=n;return r.elt=null,r.next=t.util.ZNPNode_ZPP_SimplifyP.zpp_pool,t.util.ZNPNode_ZPP_SimplifyP.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,i},t.util.ZNPList_ZPP_SimplifyP.prototype.inlined_erase=function(e){var n,i;null==e?(i=(n=this.head).next,this.head=i,null==this.head&&(this.pushmod=!0)):(i=(n=e.next).next,e.next=i,null==i&&(this.pushmod=!0));var r=n;return r.elt=null,r.next=t.util.ZNPNode_ZPP_SimplifyP.zpp_pool,t.util.ZNPNode_ZPP_SimplifyP.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,i},t.util.ZNPList_ZPP_SimplifyP.prototype.splice=function(e,t){for(;t-- >0&&null!=e.next;)this.erase(e);return e.next},t.util.ZNPList_ZPP_SimplifyP.prototype.clear=function(){for(;null!=this.head;){var e=this.head;this.head=e.next;var n=e;n.elt=null,n.next=t.util.ZNPNode_ZPP_SimplifyP.zpp_pool,t.util.ZNPNode_ZPP_SimplifyP.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},t.util.ZNPList_ZPP_SimplifyP.prototype.inlined_clear=function(){for(;null!=this.head;){var e=this.head;this.head=e.next;var n=e;n.elt=null,n.next=t.util.ZNPNode_ZPP_SimplifyP.zpp_pool,t.util.ZNPNode_ZPP_SimplifyP.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},t.util.ZNPList_ZPP_SimplifyP.prototype.reverse=function(){for(var e=this.head,t=null;null!=e;){var n=e.next;e.next=t,this.head=e,t=e,e=n}this.modified=!0,this.pushmod=!0},t.util.ZNPList_ZPP_SimplifyP.prototype.empty=function(){return null==this.head},t.util.ZNPList_ZPP_SimplifyP.prototype.size=function(){return this.length},t.util.ZNPList_ZPP_SimplifyP.prototype.has=function(e){var t;t=!1;for(var n=this.head;null!=n;){if(n.elt==e){t=!0;break}n=n.next}return t},t.util.ZNPList_ZPP_SimplifyP.prototype.inlined_has=function(e){var t;t=!1;for(var n=this.head;null!=n;){if(n.elt==e){t=!0;break}n=n.next}return t},t.util.ZNPList_ZPP_SimplifyP.prototype.front=function(){return this.head.elt},t.util.ZNPList_ZPP_SimplifyP.prototype.back=function(){for(var e=this.head,t=e;null!=t;)e=t,t=t.next;return e.elt},t.util.ZNPList_ZPP_SimplifyP.prototype.iterator_at=function(e){for(var t=this.head;e-- >0&&null!=t;)t=t.next;return t},t.util.ZNPList_ZPP_SimplifyP.prototype.at=function(e){var t=this.iterator_at(e);return null!=t?t.elt:null},t.util.ZNPList_ZPP_SimplifyP.prototype.__class__=t.util.ZNPList_ZPP_SimplifyP,t.util.ZNPList_ZPP_PartitionedPoly=l["zpp_nape.util.ZNPList_ZPP_PartitionedPoly"]=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null},t.util.ZNPList_ZPP_PartitionedPoly.__name__=["zpp_nape","util","ZNPList_ZPP_PartitionedPoly"],t.util.ZNPList_ZPP_PartitionedPoly.prototype.head=null,t.util.ZNPList_ZPP_PartitionedPoly.prototype.begin=function(){return this.head},t.util.ZNPList_ZPP_PartitionedPoly.prototype.modified=null,t.util.ZNPList_ZPP_PartitionedPoly.prototype.pushmod=null,t.util.ZNPList_ZPP_PartitionedPoly.prototype.length=null,t.util.ZNPList_ZPP_PartitionedPoly.prototype.setbegin=function(e){this.head=e,this.modified=!0,this.pushmod=!0},t.util.ZNPList_ZPP_PartitionedPoly.prototype.add=function(e){var n;null==t.util.ZNPNode_ZPP_PartitionedPoly.zpp_pool?n=new t.util.ZNPNode_ZPP_PartitionedPoly:(n=t.util.ZNPNode_ZPP_PartitionedPoly.zpp_pool,t.util.ZNPNode_ZPP_PartitionedPoly.zpp_pool=n.next,n.next=null),n.elt=e;var i=n;return i.next=this.head,this.head=i,this.modified=!0,this.length++,e},t.util.ZNPList_ZPP_PartitionedPoly.prototype.inlined_add=function(e){var n;null==t.util.ZNPNode_ZPP_PartitionedPoly.zpp_pool?n=new t.util.ZNPNode_ZPP_PartitionedPoly:(n=t.util.ZNPNode_ZPP_PartitionedPoly.zpp_pool,t.util.ZNPNode_ZPP_PartitionedPoly.zpp_pool=n.next,n.next=null),n.elt=e;var i=n;return i.next=this.head,this.head=i,this.modified=!0,this.length++,e},t.util.ZNPList_ZPP_PartitionedPoly.prototype.addAll=function(e){for(var t=e.head;null!=t;){var n=t.elt;this.add(n),t=t.next}},t.util.ZNPList_ZPP_PartitionedPoly.prototype.insert=function(e,n){var i;null==t.util.ZNPNode_ZPP_PartitionedPoly.zpp_pool?i=new t.util.ZNPNode_ZPP_PartitionedPoly:(i=t.util.ZNPNode_ZPP_PartitionedPoly.zpp_pool,t.util.ZNPNode_ZPP_PartitionedPoly.zpp_pool=i.next,i.next=null),i.elt=n;var r=i;return null==e?(r.next=this.head,this.head=r):(r.next=e.next,e.next=r),this.pushmod=this.modified=!0,this.length++,r},t.util.ZNPList_ZPP_PartitionedPoly.prototype.inlined_insert=function(e,n){var i;null==t.util.ZNPNode_ZPP_PartitionedPoly.zpp_pool?i=new t.util.ZNPNode_ZPP_PartitionedPoly:(i=t.util.ZNPNode_ZPP_PartitionedPoly.zpp_pool,t.util.ZNPNode_ZPP_PartitionedPoly.zpp_pool=i.next,i.next=null),i.elt=n;var r=i;return null==e?(r.next=this.head,this.head=r):(r.next=e.next,e.next=r),this.pushmod=this.modified=!0,this.length++,r},t.util.ZNPList_ZPP_PartitionedPoly.prototype.pop=function(){var e=this.head;this.head=e.next;var n=e;n.elt=null,n.next=t.util.ZNPNode_ZPP_PartitionedPoly.zpp_pool,t.util.ZNPNode_ZPP_PartitionedPoly.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},t.util.ZNPList_ZPP_PartitionedPoly.prototype.inlined_pop=function(){var e=this.head;this.head=e.next;var n=e;n.elt=null,n.next=t.util.ZNPNode_ZPP_PartitionedPoly.zpp_pool,t.util.ZNPNode_ZPP_PartitionedPoly.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},t.util.ZNPList_ZPP_PartitionedPoly.prototype.pop_unsafe=function(){var e=this.head.elt;return this.pop(),e},t.util.ZNPList_ZPP_PartitionedPoly.prototype.inlined_pop_unsafe=function(){var e=this.head.elt;return this.pop(),e},t.util.ZNPList_ZPP_PartitionedPoly.prototype.remove=function(e){for(var n=null,i=this.head;null!=i;){if(i.elt==e){var r,o;null==n?(o=(r=this.head).next,this.head=o,null==this.head&&(this.pushmod=!0)):(o=(r=n.next).next,n.next=o,null==o&&(this.pushmod=!0));var a=r;a.elt=null,a.next=t.util.ZNPNode_ZPP_PartitionedPoly.zpp_pool,t.util.ZNPNode_ZPP_PartitionedPoly.zpp_pool=a,this.modified=!0,this.length--,this.pushmod=!0;break}n=i,i=i.next}},t.util.ZNPList_ZPP_PartitionedPoly.prototype.try_remove=function(e){for(var t=null,n=this.head,i=!1;null!=n;){if(n.elt==e){this.erase(t),i=!0;break}t=n,n=n.next}return i},t.util.ZNPList_ZPP_PartitionedPoly.prototype.inlined_remove=function(e){for(var n=null,i=this.head;null!=i;){if(i.elt==e){var r,o;null==n?(o=(r=this.head).next,this.head=o,null==this.head&&(this.pushmod=!0)):(o=(r=n.next).next,n.next=o,null==o&&(this.pushmod=!0));var a=r;a.elt=null,a.next=t.util.ZNPNode_ZPP_PartitionedPoly.zpp_pool,t.util.ZNPNode_ZPP_PartitionedPoly.zpp_pool=a,this.modified=!0,this.length--,this.pushmod=!0;break}n=i,i=i.next}},t.util.ZNPList_ZPP_PartitionedPoly.prototype.inlined_try_remove=function(e){for(var n=null,i=this.head,r=!1;null!=i;){if(i.elt==e){var o,a;null==n?(a=(o=this.head).next,this.head=a,null==this.head&&(this.pushmod=!0)):(a=(o=n.next).next,n.next=a,null==a&&(this.pushmod=!0));var s=o;s.elt=null,s.next=t.util.ZNPNode_ZPP_PartitionedPoly.zpp_pool,t.util.ZNPNode_ZPP_PartitionedPoly.zpp_pool=s,this.modified=!0,this.length--,this.pushmod=!0,r=!0;break}n=i,i=i.next}return r},t.util.ZNPList_ZPP_PartitionedPoly.prototype.erase=function(e){var n,i;null==e?(i=(n=this.head).next,this.head=i,null==this.head&&(this.pushmod=!0)):(i=(n=e.next).next,e.next=i,null==i&&(this.pushmod=!0));var r=n;return r.elt=null,r.next=t.util.ZNPNode_ZPP_PartitionedPoly.zpp_pool,t.util.ZNPNode_ZPP_PartitionedPoly.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,i},t.util.ZNPList_ZPP_PartitionedPoly.prototype.inlined_erase=function(e){var n,i;null==e?(i=(n=this.head).next,this.head=i,null==this.head&&(this.pushmod=!0)):(i=(n=e.next).next,e.next=i,null==i&&(this.pushmod=!0));var r=n;return r.elt=null,r.next=t.util.ZNPNode_ZPP_PartitionedPoly.zpp_pool,t.util.ZNPNode_ZPP_PartitionedPoly.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,i},t.util.ZNPList_ZPP_PartitionedPoly.prototype.splice=function(e,t){for(;t-- >0&&null!=e.next;)this.erase(e);return e.next},t.util.ZNPList_ZPP_PartitionedPoly.prototype.clear=function(){for(;null!=this.head;){var e=this.head;this.head=e.next;var n=e;n.elt=null,n.next=t.util.ZNPNode_ZPP_PartitionedPoly.zpp_pool,t.util.ZNPNode_ZPP_PartitionedPoly.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},t.util.ZNPList_ZPP_PartitionedPoly.prototype.inlined_clear=function(){for(;null!=this.head;){var e=this.head;this.head=e.next;var n=e;n.elt=null,n.next=t.util.ZNPNode_ZPP_PartitionedPoly.zpp_pool,t.util.ZNPNode_ZPP_PartitionedPoly.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},t.util.ZNPList_ZPP_PartitionedPoly.prototype.reverse=function(){for(var e=this.head,t=null;null!=e;){var n=e.next;e.next=t,this.head=e,t=e,e=n}this.modified=!0,this.pushmod=!0},t.util.ZNPList_ZPP_PartitionedPoly.prototype.empty=function(){return null==this.head},t.util.ZNPList_ZPP_PartitionedPoly.prototype.size=function(){return this.length},t.util.ZNPList_ZPP_PartitionedPoly.prototype.has=function(e){var t;t=!1;for(var n=this.head;null!=n;){if(n.elt==e){t=!0;break}n=n.next}return t},t.util.ZNPList_ZPP_PartitionedPoly.prototype.inlined_has=function(e){var t;t=!1;for(var n=this.head;null!=n;){if(n.elt==e){t=!0;break}n=n.next}return t},t.util.ZNPList_ZPP_PartitionedPoly.prototype.front=function(){return this.head.elt},t.util.ZNPList_ZPP_PartitionedPoly.prototype.back=function(){for(var e=this.head,t=e;null!=t;)e=t,t=t.next;return e.elt},t.util.ZNPList_ZPP_PartitionedPoly.prototype.iterator_at=function(e){for(var t=this.head;e-- >0&&null!=t;)t=t.next;return t},t.util.ZNPList_ZPP_PartitionedPoly.prototype.at=function(e){var t=this.iterator_at(e);return null!=t?t.elt:null},t.util.ZNPList_ZPP_PartitionedPoly.prototype.__class__=t.util.ZNPList_ZPP_PartitionedPoly,t.util.ZNPList_ZPP_GeomVert=l["zpp_nape.util.ZNPList_ZPP_GeomVert"]=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null},t.util.ZNPList_ZPP_GeomVert.__name__=["zpp_nape","util","ZNPList_ZPP_GeomVert"],t.util.ZNPList_ZPP_GeomVert.prototype.head=null,t.util.ZNPList_ZPP_GeomVert.prototype.begin=function(){return this.head},t.util.ZNPList_ZPP_GeomVert.prototype.modified=null,t.util.ZNPList_ZPP_GeomVert.prototype.pushmod=null,t.util.ZNPList_ZPP_GeomVert.prototype.length=null,t.util.ZNPList_ZPP_GeomVert.prototype.setbegin=function(e){this.head=e,this.modified=!0,this.pushmod=!0},t.util.ZNPList_ZPP_GeomVert.prototype.add=function(e){var n;null==t.util.ZNPNode_ZPP_GeomVert.zpp_pool?n=new t.util.ZNPNode_ZPP_GeomVert:(n=t.util.ZNPNode_ZPP_GeomVert.zpp_pool,t.util.ZNPNode_ZPP_GeomVert.zpp_pool=n.next,n.next=null),n.elt=e;var i=n;return i.next=this.head,this.head=i,this.modified=!0,this.length++,e},t.util.ZNPList_ZPP_GeomVert.prototype.inlined_add=function(e){var n;null==t.util.ZNPNode_ZPP_GeomVert.zpp_pool?n=new t.util.ZNPNode_ZPP_GeomVert:(n=t.util.ZNPNode_ZPP_GeomVert.zpp_pool,t.util.ZNPNode_ZPP_GeomVert.zpp_pool=n.next,n.next=null),n.elt=e;var i=n;return i.next=this.head,this.head=i,this.modified=!0,this.length++,e},t.util.ZNPList_ZPP_GeomVert.prototype.addAll=function(e){for(var t=e.head;null!=t;){var n=t.elt;this.add(n),t=t.next}},t.util.ZNPList_ZPP_GeomVert.prototype.insert=function(e,n){var i;null==t.util.ZNPNode_ZPP_GeomVert.zpp_pool?i=new t.util.ZNPNode_ZPP_GeomVert:(i=t.util.ZNPNode_ZPP_GeomVert.zpp_pool,t.util.ZNPNode_ZPP_GeomVert.zpp_pool=i.next,i.next=null),i.elt=n;var r=i;return null==e?(r.next=this.head,this.head=r):(r.next=e.next,e.next=r),this.pushmod=this.modified=!0,this.length++,r},t.util.ZNPList_ZPP_GeomVert.prototype.inlined_insert=function(e,n){var i;null==t.util.ZNPNode_ZPP_GeomVert.zpp_pool?i=new t.util.ZNPNode_ZPP_GeomVert:(i=t.util.ZNPNode_ZPP_GeomVert.zpp_pool,t.util.ZNPNode_ZPP_GeomVert.zpp_pool=i.next,i.next=null),i.elt=n;var r=i;return null==e?(r.next=this.head,this.head=r):(r.next=e.next,e.next=r),this.pushmod=this.modified=!0,this.length++,r},t.util.ZNPList_ZPP_GeomVert.prototype.pop=function(){var e=this.head;this.head=e.next;var n=e;n.elt=null,n.next=t.util.ZNPNode_ZPP_GeomVert.zpp_pool,t.util.ZNPNode_ZPP_GeomVert.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},t.util.ZNPList_ZPP_GeomVert.prototype.inlined_pop=function(){var e=this.head;this.head=e.next;var n=e;n.elt=null,n.next=t.util.ZNPNode_ZPP_GeomVert.zpp_pool,t.util.ZNPNode_ZPP_GeomVert.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},t.util.ZNPList_ZPP_GeomVert.prototype.pop_unsafe=function(){var e=this.head.elt;return this.pop(),e},t.util.ZNPList_ZPP_GeomVert.prototype.inlined_pop_unsafe=function(){var e=this.head.elt;return this.pop(),e},t.util.ZNPList_ZPP_GeomVert.prototype.remove=function(e){for(var n=null,i=this.head;null!=i;){if(i.elt==e){var r,o;null==n?(o=(r=this.head).next,this.head=o,null==this.head&&(this.pushmod=!0)):(o=(r=n.next).next,n.next=o,null==o&&(this.pushmod=!0));var a=r;a.elt=null,a.next=t.util.ZNPNode_ZPP_GeomVert.zpp_pool,t.util.ZNPNode_ZPP_GeomVert.zpp_pool=a,this.modified=!0,this.length--,this.pushmod=!0;break}n=i,i=i.next}},t.util.ZNPList_ZPP_GeomVert.prototype.try_remove=function(e){for(var t=null,n=this.head,i=!1;null!=n;){if(n.elt==e){this.erase(t),i=!0;break}t=n,n=n.next}return i},t.util.ZNPList_ZPP_GeomVert.prototype.inlined_remove=function(e){for(var n=null,i=this.head;null!=i;){if(i.elt==e){var r,o;null==n?(o=(r=this.head).next,this.head=o,null==this.head&&(this.pushmod=!0)):(o=(r=n.next).next,n.next=o,null==o&&(this.pushmod=!0));var a=r;a.elt=null,a.next=t.util.ZNPNode_ZPP_GeomVert.zpp_pool,t.util.ZNPNode_ZPP_GeomVert.zpp_pool=a,this.modified=!0,this.length--,this.pushmod=!0;break}n=i,i=i.next}},t.util.ZNPList_ZPP_GeomVert.prototype.inlined_try_remove=function(e){for(var n=null,i=this.head,r=!1;null!=i;){if(i.elt==e){var o,a;null==n?(a=(o=this.head).next,this.head=a,null==this.head&&(this.pushmod=!0)):(a=(o=n.next).next,n.next=a,null==a&&(this.pushmod=!0));var s=o;s.elt=null,s.next=t.util.ZNPNode_ZPP_GeomVert.zpp_pool,t.util.ZNPNode_ZPP_GeomVert.zpp_pool=s,this.modified=!0,this.length--,this.pushmod=!0,r=!0;break}n=i,i=i.next}return r},t.util.ZNPList_ZPP_GeomVert.prototype.erase=function(e){var n,i;null==e?(i=(n=this.head).next,this.head=i,null==this.head&&(this.pushmod=!0)):(i=(n=e.next).next,e.next=i,null==i&&(this.pushmod=!0));var r=n;return r.elt=null,r.next=t.util.ZNPNode_ZPP_GeomVert.zpp_pool,t.util.ZNPNode_ZPP_GeomVert.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,i},t.util.ZNPList_ZPP_GeomVert.prototype.inlined_erase=function(e){var n,i;null==e?(i=(n=this.head).next,this.head=i,null==this.head&&(this.pushmod=!0)):(i=(n=e.next).next,e.next=i,null==i&&(this.pushmod=!0));var r=n;return r.elt=null,r.next=t.util.ZNPNode_ZPP_GeomVert.zpp_pool,t.util.ZNPNode_ZPP_GeomVert.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,i},t.util.ZNPList_ZPP_GeomVert.prototype.splice=function(e,t){for(;t-- >0&&null!=e.next;)this.erase(e);return e.next},t.util.ZNPList_ZPP_GeomVert.prototype.clear=function(){for(;null!=this.head;){var e=this.head;this.head=e.next;var n=e;n.elt=null,n.next=t.util.ZNPNode_ZPP_GeomVert.zpp_pool,t.util.ZNPNode_ZPP_GeomVert.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},t.util.ZNPList_ZPP_GeomVert.prototype.inlined_clear=function(){for(;null!=this.head;){var e=this.head;this.head=e.next;var n=e;n.elt=null,n.next=t.util.ZNPNode_ZPP_GeomVert.zpp_pool,t.util.ZNPNode_ZPP_GeomVert.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},t.util.ZNPList_ZPP_GeomVert.prototype.reverse=function(){for(var e=this.head,t=null;null!=e;){var n=e.next;e.next=t,this.head=e,t=e,e=n}this.modified=!0,this.pushmod=!0},t.util.ZNPList_ZPP_GeomVert.prototype.empty=function(){return null==this.head},t.util.ZNPList_ZPP_GeomVert.prototype.size=function(){return this.length},t.util.ZNPList_ZPP_GeomVert.prototype.has=function(e){var t;t=!1;for(var n=this.head;null!=n;){if(n.elt==e){t=!0;break}n=n.next}return t},t.util.ZNPList_ZPP_GeomVert.prototype.inlined_has=function(e){var t;t=!1;for(var n=this.head;null!=n;){if(n.elt==e){t=!0;break}n=n.next}return t},t.util.ZNPList_ZPP_GeomVert.prototype.front=function(){return this.head.elt},t.util.ZNPList_ZPP_GeomVert.prototype.back=function(){for(var e=this.head,t=e;null!=t;)e=t,t=t.next;return e.elt},t.util.ZNPList_ZPP_GeomVert.prototype.iterator_at=function(e){for(var t=this.head;e-- >0&&null!=t;)t=t.next;return t},t.util.ZNPList_ZPP_GeomVert.prototype.at=function(e){var t=this.iterator_at(e);return null!=t?t.elt:null},t.util.ZNPList_ZPP_GeomVert.prototype.__class__=t.util.ZNPList_ZPP_GeomVert,t.util.ZNPList_ZPP_SimpleVert=l["zpp_nape.util.ZNPList_ZPP_SimpleVert"]=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null},t.util.ZNPList_ZPP_SimpleVert.__name__=["zpp_nape","util","ZNPList_ZPP_SimpleVert"],t.util.ZNPList_ZPP_SimpleVert.prototype.head=null,t.util.ZNPList_ZPP_SimpleVert.prototype.begin=function(){return this.head},t.util.ZNPList_ZPP_SimpleVert.prototype.modified=null,t.util.ZNPList_ZPP_SimpleVert.prototype.pushmod=null,t.util.ZNPList_ZPP_SimpleVert.prototype.length=null,t.util.ZNPList_ZPP_SimpleVert.prototype.setbegin=function(e){this.head=e,this.modified=!0,this.pushmod=!0},t.util.ZNPList_ZPP_SimpleVert.prototype.add=function(e){var n;null==t.util.ZNPNode_ZPP_SimpleVert.zpp_pool?n=new t.util.ZNPNode_ZPP_SimpleVert:(n=t.util.ZNPNode_ZPP_SimpleVert.zpp_pool,t.util.ZNPNode_ZPP_SimpleVert.zpp_pool=n.next,n.next=null),n.elt=e;var i=n;return i.next=this.head,this.head=i,this.modified=!0,this.length++,e},t.util.ZNPList_ZPP_SimpleVert.prototype.inlined_add=function(e){var n;null==t.util.ZNPNode_ZPP_SimpleVert.zpp_pool?n=new t.util.ZNPNode_ZPP_SimpleVert:(n=t.util.ZNPNode_ZPP_SimpleVert.zpp_pool,t.util.ZNPNode_ZPP_SimpleVert.zpp_pool=n.next,n.next=null),n.elt=e;var i=n;return i.next=this.head,this.head=i,this.modified=!0,this.length++,e},t.util.ZNPList_ZPP_SimpleVert.prototype.addAll=function(e){for(var t=e.head;null!=t;){var n=t.elt;this.add(n),t=t.next}},t.util.ZNPList_ZPP_SimpleVert.prototype.insert=function(e,n){var i;null==t.util.ZNPNode_ZPP_SimpleVert.zpp_pool?i=new t.util.ZNPNode_ZPP_SimpleVert:(i=t.util.ZNPNode_ZPP_SimpleVert.zpp_pool,t.util.ZNPNode_ZPP_SimpleVert.zpp_pool=i.next,i.next=null),i.elt=n;var r=i;return null==e?(r.next=this.head,this.head=r):(r.next=e.next,e.next=r),this.pushmod=this.modified=!0,this.length++,r},t.util.ZNPList_ZPP_SimpleVert.prototype.inlined_insert=function(e,n){var i;null==t.util.ZNPNode_ZPP_SimpleVert.zpp_pool?i=new t.util.ZNPNode_ZPP_SimpleVert:(i=t.util.ZNPNode_ZPP_SimpleVert.zpp_pool,t.util.ZNPNode_ZPP_SimpleVert.zpp_pool=i.next,i.next=null),i.elt=n;var r=i;return null==e?(r.next=this.head,this.head=r):(r.next=e.next,e.next=r),this.pushmod=this.modified=!0,this.length++,r},t.util.ZNPList_ZPP_SimpleVert.prototype.pop=function(){var e=this.head;this.head=e.next;var n=e;n.elt=null,n.next=t.util.ZNPNode_ZPP_SimpleVert.zpp_pool,t.util.ZNPNode_ZPP_SimpleVert.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},t.util.ZNPList_ZPP_SimpleVert.prototype.inlined_pop=function(){var e=this.head;this.head=e.next;var n=e;n.elt=null,n.next=t.util.ZNPNode_ZPP_SimpleVert.zpp_pool,t.util.ZNPNode_ZPP_SimpleVert.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},t.util.ZNPList_ZPP_SimpleVert.prototype.pop_unsafe=function(){var e=this.head.elt;return this.pop(),e},t.util.ZNPList_ZPP_SimpleVert.prototype.inlined_pop_unsafe=function(){var e=this.head.elt;return this.pop(),e},t.util.ZNPList_ZPP_SimpleVert.prototype.remove=function(e){for(var n=null,i=this.head;null!=i;){if(i.elt==e){var r,o;null==n?(o=(r=this.head).next,this.head=o,null==this.head&&(this.pushmod=!0)):(o=(r=n.next).next,n.next=o,null==o&&(this.pushmod=!0));var a=r;a.elt=null,a.next=t.util.ZNPNode_ZPP_SimpleVert.zpp_pool,t.util.ZNPNode_ZPP_SimpleVert.zpp_pool=a,this.modified=!0,this.length--,this.pushmod=!0;break}n=i,i=i.next}},t.util.ZNPList_ZPP_SimpleVert.prototype.try_remove=function(e){for(var t=null,n=this.head,i=!1;null!=n;){if(n.elt==e){this.erase(t),i=!0;break}t=n,n=n.next}return i},t.util.ZNPList_ZPP_SimpleVert.prototype.inlined_remove=function(e){for(var n=null,i=this.head;null!=i;){if(i.elt==e){var r,o;null==n?(o=(r=this.head).next,this.head=o,null==this.head&&(this.pushmod=!0)):(o=(r=n.next).next,n.next=o,null==o&&(this.pushmod=!0));var a=r;a.elt=null,a.next=t.util.ZNPNode_ZPP_SimpleVert.zpp_pool,t.util.ZNPNode_ZPP_SimpleVert.zpp_pool=a,this.modified=!0,this.length--,this.pushmod=!0;break}n=i,i=i.next}},t.util.ZNPList_ZPP_SimpleVert.prototype.inlined_try_remove=function(e){for(var n=null,i=this.head,r=!1;null!=i;){if(i.elt==e){var o,a;null==n?(a=(o=this.head).next,this.head=a,null==this.head&&(this.pushmod=!0)):(a=(o=n.next).next,n.next=a,null==a&&(this.pushmod=!0));var s=o;s.elt=null,s.next=t.util.ZNPNode_ZPP_SimpleVert.zpp_pool,t.util.ZNPNode_ZPP_SimpleVert.zpp_pool=s,this.modified=!0,this.length--,this.pushmod=!0,r=!0;break}n=i,i=i.next}return r},t.util.ZNPList_ZPP_SimpleVert.prototype.erase=function(e){var n,i;null==e?(i=(n=this.head).next,this.head=i,null==this.head&&(this.pushmod=!0)):(i=(n=e.next).next,e.next=i,null==i&&(this.pushmod=!0));var r=n;return r.elt=null,r.next=t.util.ZNPNode_ZPP_SimpleVert.zpp_pool,t.util.ZNPNode_ZPP_SimpleVert.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,i},t.util.ZNPList_ZPP_SimpleVert.prototype.inlined_erase=function(e){var n,i;null==e?(i=(n=this.head).next,this.head=i,null==this.head&&(this.pushmod=!0)):(i=(n=e.next).next,e.next=i,null==i&&(this.pushmod=!0));var r=n;return r.elt=null,r.next=t.util.ZNPNode_ZPP_SimpleVert.zpp_pool,t.util.ZNPNode_ZPP_SimpleVert.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,i},t.util.ZNPList_ZPP_SimpleVert.prototype.splice=function(e,t){for(;t-- >0&&null!=e.next;)this.erase(e);return e.next},t.util.ZNPList_ZPP_SimpleVert.prototype.clear=function(){for(;null!=this.head;){var e=this.head;this.head=e.next;var n=e;n.elt=null,n.next=t.util.ZNPNode_ZPP_SimpleVert.zpp_pool,t.util.ZNPNode_ZPP_SimpleVert.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},t.util.ZNPList_ZPP_SimpleVert.prototype.inlined_clear=function(){for(;null!=this.head;){var e=this.head;this.head=e.next;var n=e;n.elt=null,n.next=t.util.ZNPNode_ZPP_SimpleVert.zpp_pool,t.util.ZNPNode_ZPP_SimpleVert.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},t.util.ZNPList_ZPP_SimpleVert.prototype.reverse=function(){for(var e=this.head,t=null;null!=e;){var n=e.next;e.next=t,this.head=e,t=e,e=n}this.modified=!0,this.pushmod=!0},t.util.ZNPList_ZPP_SimpleVert.prototype.empty=function(){return null==this.head},t.util.ZNPList_ZPP_SimpleVert.prototype.size=function(){return this.length},t.util.ZNPList_ZPP_SimpleVert.prototype.has=function(e){var t;t=!1;for(var n=this.head;null!=n;){if(n.elt==e){t=!0;break}n=n.next}return t},t.util.ZNPList_ZPP_SimpleVert.prototype.inlined_has=function(e){var t;t=!1;for(var n=this.head;null!=n;){if(n.elt==e){t=!0;break}n=n.next}return t},t.util.ZNPList_ZPP_SimpleVert.prototype.front=function(){return this.head.elt},t.util.ZNPList_ZPP_SimpleVert.prototype.back=function(){for(var e=this.head,t=e;null!=t;)e=t,t=t.next;return e.elt},t.util.ZNPList_ZPP_SimpleVert.prototype.iterator_at=function(e){for(var t=this.head;e-- >0&&null!=t;)t=t.next;return t},t.util.ZNPList_ZPP_SimpleVert.prototype.at=function(e){var t=this.iterator_at(e);return null!=t?t.elt:null},t.util.ZNPList_ZPP_SimpleVert.prototype.__class__=t.util.ZNPList_ZPP_SimpleVert,t.util.ZNPList_ZPP_SimpleEvent=l["zpp_nape.util.ZNPList_ZPP_SimpleEvent"]=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null},t.util.ZNPList_ZPP_SimpleEvent.__name__=["zpp_nape","util","ZNPList_ZPP_SimpleEvent"],t.util.ZNPList_ZPP_SimpleEvent.prototype.head=null,t.util.ZNPList_ZPP_SimpleEvent.prototype.begin=function(){return this.head},t.util.ZNPList_ZPP_SimpleEvent.prototype.modified=null,t.util.ZNPList_ZPP_SimpleEvent.prototype.pushmod=null,t.util.ZNPList_ZPP_SimpleEvent.prototype.length=null,t.util.ZNPList_ZPP_SimpleEvent.prototype.setbegin=function(e){this.head=e,this.modified=!0,this.pushmod=!0},t.util.ZNPList_ZPP_SimpleEvent.prototype.add=function(e){var n;null==t.util.ZNPNode_ZPP_SimpleEvent.zpp_pool?n=new t.util.ZNPNode_ZPP_SimpleEvent:(n=t.util.ZNPNode_ZPP_SimpleEvent.zpp_pool,t.util.ZNPNode_ZPP_SimpleEvent.zpp_pool=n.next,n.next=null),n.elt=e;var i=n;return i.next=this.head,this.head=i,this.modified=!0,this.length++,e},t.util.ZNPList_ZPP_SimpleEvent.prototype.inlined_add=function(e){var n;null==t.util.ZNPNode_ZPP_SimpleEvent.zpp_pool?n=new t.util.ZNPNode_ZPP_SimpleEvent:(n=t.util.ZNPNode_ZPP_SimpleEvent.zpp_pool,t.util.ZNPNode_ZPP_SimpleEvent.zpp_pool=n.next,n.next=null),n.elt=e;var i=n;return i.next=this.head,this.head=i,this.modified=!0,this.length++,e},t.util.ZNPList_ZPP_SimpleEvent.prototype.addAll=function(e){for(var t=e.head;null!=t;){var n=t.elt;this.add(n),t=t.next}},t.util.ZNPList_ZPP_SimpleEvent.prototype.insert=function(e,n){var i;null==t.util.ZNPNode_ZPP_SimpleEvent.zpp_pool?i=new t.util.ZNPNode_ZPP_SimpleEvent:(i=t.util.ZNPNode_ZPP_SimpleEvent.zpp_pool,t.util.ZNPNode_ZPP_SimpleEvent.zpp_pool=i.next,i.next=null),i.elt=n;var r=i;return null==e?(r.next=this.head,this.head=r):(r.next=e.next,e.next=r),this.pushmod=this.modified=!0,this.length++,r},t.util.ZNPList_ZPP_SimpleEvent.prototype.inlined_insert=function(e,n){var i;null==t.util.ZNPNode_ZPP_SimpleEvent.zpp_pool?i=new t.util.ZNPNode_ZPP_SimpleEvent:(i=t.util.ZNPNode_ZPP_SimpleEvent.zpp_pool,t.util.ZNPNode_ZPP_SimpleEvent.zpp_pool=i.next,i.next=null),i.elt=n;var r=i;return null==e?(r.next=this.head,this.head=r):(r.next=e.next,e.next=r),this.pushmod=this.modified=!0,this.length++,r},t.util.ZNPList_ZPP_SimpleEvent.prototype.pop=function(){var e=this.head;this.head=e.next;var n=e;n.elt=null,n.next=t.util.ZNPNode_ZPP_SimpleEvent.zpp_pool,t.util.ZNPNode_ZPP_SimpleEvent.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},t.util.ZNPList_ZPP_SimpleEvent.prototype.inlined_pop=function(){var e=this.head;this.head=e.next;var n=e;n.elt=null,n.next=t.util.ZNPNode_ZPP_SimpleEvent.zpp_pool,t.util.ZNPNode_ZPP_SimpleEvent.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},t.util.ZNPList_ZPP_SimpleEvent.prototype.pop_unsafe=function(){var e=this.head.elt;return this.pop(),e},t.util.ZNPList_ZPP_SimpleEvent.prototype.inlined_pop_unsafe=function(){var e=this.head.elt;return this.pop(),e},t.util.ZNPList_ZPP_SimpleEvent.prototype.remove=function(e){for(var n=null,i=this.head;null!=i;){if(i.elt==e){var r,o;null==n?(o=(r=this.head).next,this.head=o,null==this.head&&(this.pushmod=!0)):(o=(r=n.next).next,n.next=o,null==o&&(this.pushmod=!0));var a=r;a.elt=null,a.next=t.util.ZNPNode_ZPP_SimpleEvent.zpp_pool,t.util.ZNPNode_ZPP_SimpleEvent.zpp_pool=a,this.modified=!0,this.length--,this.pushmod=!0;break}n=i,i=i.next}},t.util.ZNPList_ZPP_SimpleEvent.prototype.try_remove=function(e){for(var t=null,n=this.head,i=!1;null!=n;){if(n.elt==e){this.erase(t),i=!0;break}t=n,n=n.next}return i},t.util.ZNPList_ZPP_SimpleEvent.prototype.inlined_remove=function(e){for(var n=null,i=this.head;null!=i;){if(i.elt==e){var r,o;null==n?(o=(r=this.head).next,this.head=o,null==this.head&&(this.pushmod=!0)):(o=(r=n.next).next,n.next=o,null==o&&(this.pushmod=!0));var a=r;a.elt=null,a.next=t.util.ZNPNode_ZPP_SimpleEvent.zpp_pool,t.util.ZNPNode_ZPP_SimpleEvent.zpp_pool=a,this.modified=!0,this.length--,this.pushmod=!0;break}n=i,i=i.next}},t.util.ZNPList_ZPP_SimpleEvent.prototype.inlined_try_remove=function(e){for(var n=null,i=this.head,r=!1;null!=i;){if(i.elt==e){var o,a;null==n?(a=(o=this.head).next,this.head=a,null==this.head&&(this.pushmod=!0)):(a=(o=n.next).next,n.next=a,null==a&&(this.pushmod=!0));var s=o;s.elt=null,s.next=t.util.ZNPNode_ZPP_SimpleEvent.zpp_pool,t.util.ZNPNode_ZPP_SimpleEvent.zpp_pool=s,this.modified=!0,this.length--,this.pushmod=!0,r=!0;break}n=i,i=i.next}return r},t.util.ZNPList_ZPP_SimpleEvent.prototype.erase=function(e){var n,i;null==e?(i=(n=this.head).next,this.head=i,null==this.head&&(this.pushmod=!0)):(i=(n=e.next).next,e.next=i,null==i&&(this.pushmod=!0));var r=n;return r.elt=null,r.next=t.util.ZNPNode_ZPP_SimpleEvent.zpp_pool,t.util.ZNPNode_ZPP_SimpleEvent.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,i},t.util.ZNPList_ZPP_SimpleEvent.prototype.inlined_erase=function(e){var n,i;null==e?(i=(n=this.head).next,this.head=i,null==this.head&&(this.pushmod=!0)):(i=(n=e.next).next,e.next=i,null==i&&(this.pushmod=!0));var r=n;return r.elt=null,r.next=t.util.ZNPNode_ZPP_SimpleEvent.zpp_pool,t.util.ZNPNode_ZPP_SimpleEvent.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,i},t.util.ZNPList_ZPP_SimpleEvent.prototype.splice=function(e,t){for(;t-- >0&&null!=e.next;)this.erase(e);return e.next},t.util.ZNPList_ZPP_SimpleEvent.prototype.clear=function(){for(;null!=this.head;){var e=this.head;this.head=e.next;var n=e;n.elt=null,n.next=t.util.ZNPNode_ZPP_SimpleEvent.zpp_pool,t.util.ZNPNode_ZPP_SimpleEvent.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},t.util.ZNPList_ZPP_SimpleEvent.prototype.inlined_clear=function(){for(;null!=this.head;){var e=this.head;this.head=e.next;var n=e;n.elt=null,n.next=t.util.ZNPNode_ZPP_SimpleEvent.zpp_pool,t.util.ZNPNode_ZPP_SimpleEvent.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},t.util.ZNPList_ZPP_SimpleEvent.prototype.reverse=function(){for(var e=this.head,t=null;null!=e;){var n=e.next;e.next=t,this.head=e,t=e,e=n}this.modified=!0,this.pushmod=!0},t.util.ZNPList_ZPP_SimpleEvent.prototype.empty=function(){return null==this.head},t.util.ZNPList_ZPP_SimpleEvent.prototype.size=function(){return this.length},t.util.ZNPList_ZPP_SimpleEvent.prototype.has=function(e){var t;t=!1;for(var n=this.head;null!=n;){if(n.elt==e){t=!0;break}n=n.next}return t},t.util.ZNPList_ZPP_SimpleEvent.prototype.inlined_has=function(e){var t;t=!1;for(var n=this.head;null!=n;){if(n.elt==e){t=!0;break}n=n.next}return t},t.util.ZNPList_ZPP_SimpleEvent.prototype.front=function(){return this.head.elt},t.util.ZNPList_ZPP_SimpleEvent.prototype.back=function(){for(var e=this.head,t=e;null!=t;)e=t,t=t.next;return e.elt},t.util.ZNPList_ZPP_SimpleEvent.prototype.iterator_at=function(e){for(var t=this.head;e-- >0&&null!=t;)t=t.next;return t},t.util.ZNPList_ZPP_SimpleEvent.prototype.at=function(e){var t=this.iterator_at(e);return null!=t?t.elt:null},t.util.ZNPList_ZPP_SimpleEvent.prototype.__class__=t.util.ZNPList_ZPP_SimpleEvent,t.util.ZNPList_ZPP_AABBPair=l["zpp_nape.util.ZNPList_ZPP_AABBPair"]=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null},t.util.ZNPList_ZPP_AABBPair.__name__=["zpp_nape","util","ZNPList_ZPP_AABBPair"],t.util.ZNPList_ZPP_AABBPair.prototype.head=null,t.util.ZNPList_ZPP_AABBPair.prototype.begin=function(){return this.head},t.util.ZNPList_ZPP_AABBPair.prototype.modified=null,t.util.ZNPList_ZPP_AABBPair.prototype.pushmod=null,t.util.ZNPList_ZPP_AABBPair.prototype.length=null,t.util.ZNPList_ZPP_AABBPair.prototype.setbegin=function(e){this.head=e,this.modified=!0,this.pushmod=!0},t.util.ZNPList_ZPP_AABBPair.prototype.add=function(e){var n;null==t.util.ZNPNode_ZPP_AABBPair.zpp_pool?n=new t.util.ZNPNode_ZPP_AABBPair:(n=t.util.ZNPNode_ZPP_AABBPair.zpp_pool,t.util.ZNPNode_ZPP_AABBPair.zpp_pool=n.next,n.next=null),n.elt=e;var i=n;return i.next=this.head,this.head=i,this.modified=!0,this.length++,e},t.util.ZNPList_ZPP_AABBPair.prototype.inlined_add=function(e){var n;null==t.util.ZNPNode_ZPP_AABBPair.zpp_pool?n=new t.util.ZNPNode_ZPP_AABBPair:(n=t.util.ZNPNode_ZPP_AABBPair.zpp_pool,t.util.ZNPNode_ZPP_AABBPair.zpp_pool=n.next,n.next=null),n.elt=e;var i=n;return i.next=this.head,this.head=i,this.modified=!0,this.length++,e},t.util.ZNPList_ZPP_AABBPair.prototype.addAll=function(e){for(var t=e.head;null!=t;){var n=t.elt;this.add(n),t=t.next}},t.util.ZNPList_ZPP_AABBPair.prototype.insert=function(e,n){var i;null==t.util.ZNPNode_ZPP_AABBPair.zpp_pool?i=new t.util.ZNPNode_ZPP_AABBPair:(i=t.util.ZNPNode_ZPP_AABBPair.zpp_pool,t.util.ZNPNode_ZPP_AABBPair.zpp_pool=i.next,i.next=null),i.elt=n;var r=i;return null==e?(r.next=this.head,this.head=r):(r.next=e.next,e.next=r),this.pushmod=this.modified=!0,this.length++,r},t.util.ZNPList_ZPP_AABBPair.prototype.inlined_insert=function(e,n){var i;null==t.util.ZNPNode_ZPP_AABBPair.zpp_pool?i=new t.util.ZNPNode_ZPP_AABBPair:(i=t.util.ZNPNode_ZPP_AABBPair.zpp_pool,t.util.ZNPNode_ZPP_AABBPair.zpp_pool=i.next,i.next=null),i.elt=n;var r=i;return null==e?(r.next=this.head,this.head=r):(r.next=e.next,e.next=r),this.pushmod=this.modified=!0,this.length++,r},t.util.ZNPList_ZPP_AABBPair.prototype.pop=function(){var e=this.head;this.head=e.next;var n=e;n.elt=null,n.next=t.util.ZNPNode_ZPP_AABBPair.zpp_pool,t.util.ZNPNode_ZPP_AABBPair.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},t.util.ZNPList_ZPP_AABBPair.prototype.inlined_pop=function(){var e=this.head;this.head=e.next;var n=e;n.elt=null,n.next=t.util.ZNPNode_ZPP_AABBPair.zpp_pool,t.util.ZNPNode_ZPP_AABBPair.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},t.util.ZNPList_ZPP_AABBPair.prototype.pop_unsafe=function(){var e=this.head.elt;return this.pop(),e},t.util.ZNPList_ZPP_AABBPair.prototype.inlined_pop_unsafe=function(){var e=this.head.elt;return this.pop(),e},t.util.ZNPList_ZPP_AABBPair.prototype.remove=function(e){for(var n=null,i=this.head;null!=i;){if(i.elt==e){var r,o;null==n?(o=(r=this.head).next,this.head=o,null==this.head&&(this.pushmod=!0)):(o=(r=n.next).next,n.next=o,null==o&&(this.pushmod=!0));var a=r;a.elt=null,a.next=t.util.ZNPNode_ZPP_AABBPair.zpp_pool,t.util.ZNPNode_ZPP_AABBPair.zpp_pool=a,this.modified=!0,this.length--,this.pushmod=!0;break}n=i,i=i.next}},t.util.ZNPList_ZPP_AABBPair.prototype.try_remove=function(e){for(var t=null,n=this.head,i=!1;null!=n;){if(n.elt==e){this.erase(t),i=!0;break}t=n,n=n.next}return i},t.util.ZNPList_ZPP_AABBPair.prototype.inlined_remove=function(e){for(var n=null,i=this.head;null!=i;){if(i.elt==e){var r,o;null==n?(o=(r=this.head).next,this.head=o,null==this.head&&(this.pushmod=!0)):(o=(r=n.next).next,n.next=o,null==o&&(this.pushmod=!0));var a=r;a.elt=null,a.next=t.util.ZNPNode_ZPP_AABBPair.zpp_pool,t.util.ZNPNode_ZPP_AABBPair.zpp_pool=a,this.modified=!0,this.length--,this.pushmod=!0;break}n=i,i=i.next}},t.util.ZNPList_ZPP_AABBPair.prototype.inlined_try_remove=function(e){for(var n=null,i=this.head,r=!1;null!=i;){if(i.elt==e){var o,a;null==n?(a=(o=this.head).next,this.head=a,null==this.head&&(this.pushmod=!0)):(a=(o=n.next).next,n.next=a,null==a&&(this.pushmod=!0));var s=o;s.elt=null,s.next=t.util.ZNPNode_ZPP_AABBPair.zpp_pool,t.util.ZNPNode_ZPP_AABBPair.zpp_pool=s,this.modified=!0,this.length--,this.pushmod=!0,r=!0;break}n=i,i=i.next}return r},t.util.ZNPList_ZPP_AABBPair.prototype.erase=function(e){var n,i;null==e?(i=(n=this.head).next,this.head=i,null==this.head&&(this.pushmod=!0)):(i=(n=e.next).next,e.next=i,null==i&&(this.pushmod=!0));var r=n;return r.elt=null,r.next=t.util.ZNPNode_ZPP_AABBPair.zpp_pool,t.util.ZNPNode_ZPP_AABBPair.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,i},t.util.ZNPList_ZPP_AABBPair.prototype.inlined_erase=function(e){var n,i;null==e?(i=(n=this.head).next,this.head=i,null==this.head&&(this.pushmod=!0)):(i=(n=e.next).next,e.next=i,null==i&&(this.pushmod=!0));var r=n;return r.elt=null,r.next=t.util.ZNPNode_ZPP_AABBPair.zpp_pool,t.util.ZNPNode_ZPP_AABBPair.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,i},t.util.ZNPList_ZPP_AABBPair.prototype.splice=function(e,t){for(;t-- >0&&null!=e.next;)this.erase(e);return e.next},t.util.ZNPList_ZPP_AABBPair.prototype.clear=function(){for(;null!=this.head;){var e=this.head;this.head=e.next;var n=e;n.elt=null,n.next=t.util.ZNPNode_ZPP_AABBPair.zpp_pool,t.util.ZNPNode_ZPP_AABBPair.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},t.util.ZNPList_ZPP_AABBPair.prototype.inlined_clear=function(){for(;null!=this.head;){var e=this.head;this.head=e.next;var n=e;n.elt=null,n.next=t.util.ZNPNode_ZPP_AABBPair.zpp_pool,t.util.ZNPNode_ZPP_AABBPair.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},t.util.ZNPList_ZPP_AABBPair.prototype.reverse=function(){for(var e=this.head,t=null;null!=e;){var n=e.next;e.next=t,this.head=e,t=e,e=n}this.modified=!0,this.pushmod=!0},t.util.ZNPList_ZPP_AABBPair.prototype.empty=function(){return null==this.head},t.util.ZNPList_ZPP_AABBPair.prototype.size=function(){return this.length},t.util.ZNPList_ZPP_AABBPair.prototype.has=function(e){var t;t=!1;for(var n=this.head;null!=n;){if(n.elt==e){t=!0;break}n=n.next}return t},t.util.ZNPList_ZPP_AABBPair.prototype.inlined_has=function(e){var t;t=!1;for(var n=this.head;null!=n;){if(n.elt==e){t=!0;break}n=n.next}return t},t.util.ZNPList_ZPP_AABBPair.prototype.front=function(){return this.head.elt},t.util.ZNPList_ZPP_AABBPair.prototype.back=function(){for(var e=this.head,t=e;null!=t;)e=t,t=t.next;return e.elt},t.util.ZNPList_ZPP_AABBPair.prototype.iterator_at=function(e){for(var t=this.head;e-- >0&&null!=t;)t=t.next;return t},t.util.ZNPList_ZPP_AABBPair.prototype.at=function(e){var t=this.iterator_at(e);return null!=t?t.elt:null},t.util.ZNPList_ZPP_AABBPair.prototype.__class__=t.util.ZNPList_ZPP_AABBPair,t.util.ZNPList_ZPP_Edge=l["zpp_nape.util.ZNPList_ZPP_Edge"]=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null},t.util.ZNPList_ZPP_Edge.__name__=["zpp_nape","util","ZNPList_ZPP_Edge"],t.util.ZNPList_ZPP_Edge.prototype.head=null,t.util.ZNPList_ZPP_Edge.prototype.begin=function(){return this.head},t.util.ZNPList_ZPP_Edge.prototype.modified=null,t.util.ZNPList_ZPP_Edge.prototype.pushmod=null,t.util.ZNPList_ZPP_Edge.prototype.length=null,t.util.ZNPList_ZPP_Edge.prototype.setbegin=function(e){this.head=e,this.modified=!0,this.pushmod=!0},t.util.ZNPList_ZPP_Edge.prototype.add=function(e){var n;null==t.util.ZNPNode_ZPP_Edge.zpp_pool?n=new t.util.ZNPNode_ZPP_Edge:(n=t.util.ZNPNode_ZPP_Edge.zpp_pool,t.util.ZNPNode_ZPP_Edge.zpp_pool=n.next,n.next=null),n.elt=e;var i=n;return i.next=this.head,this.head=i,this.modified=!0,this.length++,e},t.util.ZNPList_ZPP_Edge.prototype.inlined_add=function(e){var n;null==t.util.ZNPNode_ZPP_Edge.zpp_pool?n=new t.util.ZNPNode_ZPP_Edge:(n=t.util.ZNPNode_ZPP_Edge.zpp_pool,t.util.ZNPNode_ZPP_Edge.zpp_pool=n.next,n.next=null),n.elt=e;var i=n;return i.next=this.head,this.head=i,this.modified=!0,this.length++,e},t.util.ZNPList_ZPP_Edge.prototype.addAll=function(e){for(var t=e.head;null!=t;){var n=t.elt;this.add(n),t=t.next}},t.util.ZNPList_ZPP_Edge.prototype.insert=function(e,n){var i;null==t.util.ZNPNode_ZPP_Edge.zpp_pool?i=new t.util.ZNPNode_ZPP_Edge:(i=t.util.ZNPNode_ZPP_Edge.zpp_pool,t.util.ZNPNode_ZPP_Edge.zpp_pool=i.next,i.next=null),i.elt=n;var r=i;return null==e?(r.next=this.head,this.head=r):(r.next=e.next,e.next=r),this.pushmod=this.modified=!0,this.length++,r},t.util.ZNPList_ZPP_Edge.prototype.inlined_insert=function(e,n){var i;null==t.util.ZNPNode_ZPP_Edge.zpp_pool?i=new t.util.ZNPNode_ZPP_Edge:(i=t.util.ZNPNode_ZPP_Edge.zpp_pool,t.util.ZNPNode_ZPP_Edge.zpp_pool=i.next,i.next=null),i.elt=n;var r=i;return null==e?(r.next=this.head,this.head=r):(r.next=e.next,e.next=r),this.pushmod=this.modified=!0,this.length++,r},t.util.ZNPList_ZPP_Edge.prototype.pop=function(){var e=this.head;this.head=e.next;var n=e;n.elt=null,n.next=t.util.ZNPNode_ZPP_Edge.zpp_pool,t.util.ZNPNode_ZPP_Edge.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},t.util.ZNPList_ZPP_Edge.prototype.inlined_pop=function(){var e=this.head;this.head=e.next;var n=e;n.elt=null,n.next=t.util.ZNPNode_ZPP_Edge.zpp_pool,t.util.ZNPNode_ZPP_Edge.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},t.util.ZNPList_ZPP_Edge.prototype.pop_unsafe=function(){var e=this.head.elt;return this.pop(),e},t.util.ZNPList_ZPP_Edge.prototype.inlined_pop_unsafe=function(){var e=this.head.elt;return this.pop(),e},t.util.ZNPList_ZPP_Edge.prototype.remove=function(e){for(var n=null,i=this.head;null!=i;){if(i.elt==e){var r,o;null==n?(o=(r=this.head).next,this.head=o,null==this.head&&(this.pushmod=!0)):(o=(r=n.next).next,n.next=o,null==o&&(this.pushmod=!0));var a=r;a.elt=null,a.next=t.util.ZNPNode_ZPP_Edge.zpp_pool,t.util.ZNPNode_ZPP_Edge.zpp_pool=a,this.modified=!0,this.length--,this.pushmod=!0;break}n=i,i=i.next}},t.util.ZNPList_ZPP_Edge.prototype.try_remove=function(e){for(var t=null,n=this.head,i=!1;null!=n;){if(n.elt==e){this.erase(t),i=!0;break}t=n,n=n.next}return i},t.util.ZNPList_ZPP_Edge.prototype.inlined_remove=function(e){for(var n=null,i=this.head;null!=i;){if(i.elt==e){var r,o;null==n?(o=(r=this.head).next,this.head=o,null==this.head&&(this.pushmod=!0)):(o=(r=n.next).next,n.next=o,null==o&&(this.pushmod=!0));var a=r;a.elt=null,a.next=t.util.ZNPNode_ZPP_Edge.zpp_pool,t.util.ZNPNode_ZPP_Edge.zpp_pool=a,this.modified=!0,this.length--,this.pushmod=!0;break}n=i,i=i.next}},t.util.ZNPList_ZPP_Edge.prototype.inlined_try_remove=function(e){for(var n=null,i=this.head,r=!1;null!=i;){if(i.elt==e){var o,a;null==n?(a=(o=this.head).next,this.head=a,null==this.head&&(this.pushmod=!0)):(a=(o=n.next).next,n.next=a,null==a&&(this.pushmod=!0));var s=o;s.elt=null,s.next=t.util.ZNPNode_ZPP_Edge.zpp_pool,t.util.ZNPNode_ZPP_Edge.zpp_pool=s,this.modified=!0,this.length--,this.pushmod=!0,r=!0;break}n=i,i=i.next}return r},t.util.ZNPList_ZPP_Edge.prototype.erase=function(e){var n,i;null==e?(i=(n=this.head).next,this.head=i,null==this.head&&(this.pushmod=!0)):(i=(n=e.next).next,e.next=i,null==i&&(this.pushmod=!0));var r=n;return r.elt=null,r.next=t.util.ZNPNode_ZPP_Edge.zpp_pool,t.util.ZNPNode_ZPP_Edge.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,i},t.util.ZNPList_ZPP_Edge.prototype.inlined_erase=function(e){var n,i;null==e?(i=(n=this.head).next,this.head=i,null==this.head&&(this.pushmod=!0)):(i=(n=e.next).next,e.next=i,null==i&&(this.pushmod=!0));var r=n;return r.elt=null,r.next=t.util.ZNPNode_ZPP_Edge.zpp_pool,t.util.ZNPNode_ZPP_Edge.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,i},t.util.ZNPList_ZPP_Edge.prototype.splice=function(e,t){for(;t-- >0&&null!=e.next;)this.erase(e);return e.next},t.util.ZNPList_ZPP_Edge.prototype.clear=function(){for(;null!=this.head;){var e=this.head;this.head=e.next;var n=e;n.elt=null,n.next=t.util.ZNPNode_ZPP_Edge.zpp_pool,t.util.ZNPNode_ZPP_Edge.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},t.util.ZNPList_ZPP_Edge.prototype.inlined_clear=function(){for(;null!=this.head;){var e=this.head;this.head=e.next;var n=e;n.elt=null,n.next=t.util.ZNPNode_ZPP_Edge.zpp_pool,t.util.ZNPNode_ZPP_Edge.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},t.util.ZNPList_ZPP_Edge.prototype.reverse=function(){for(var e=this.head,t=null;null!=e;){var n=e.next;e.next=t,this.head=e,t=e,e=n}this.modified=!0,this.pushmod=!0},t.util.ZNPList_ZPP_Edge.prototype.empty=function(){return null==this.head},t.util.ZNPList_ZPP_Edge.prototype.size=function(){return this.length},t.util.ZNPList_ZPP_Edge.prototype.has=function(e){var t;t=!1;for(var n=this.head;null!=n;){if(n.elt==e){t=!0;break}n=n.next}return t},t.util.ZNPList_ZPP_Edge.prototype.inlined_has=function(e){var t;t=!1;for(var n=this.head;null!=n;){if(n.elt==e){t=!0;break}n=n.next}return t},t.util.ZNPList_ZPP_Edge.prototype.front=function(){return this.head.elt},t.util.ZNPList_ZPP_Edge.prototype.back=function(){for(var e=this.head,t=e;null!=t;)e=t,t=t.next;return e.elt},t.util.ZNPList_ZPP_Edge.prototype.iterator_at=function(e){for(var t=this.head;e-- >0&&null!=t;)t=t.next;return t},t.util.ZNPList_ZPP_Edge.prototype.at=function(e){var t=this.iterator_at(e);return null!=t?t.elt:null},t.util.ZNPList_ZPP_Edge.prototype.__class__=t.util.ZNPList_ZPP_Edge,t.util.ZNPList_ZPP_AABBNode=l["zpp_nape.util.ZNPList_ZPP_AABBNode"]=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null},t.util.ZNPList_ZPP_AABBNode.__name__=["zpp_nape","util","ZNPList_ZPP_AABBNode"],t.util.ZNPList_ZPP_AABBNode.prototype.head=null,t.util.ZNPList_ZPP_AABBNode.prototype.begin=function(){return this.head},t.util.ZNPList_ZPP_AABBNode.prototype.modified=null,t.util.ZNPList_ZPP_AABBNode.prototype.pushmod=null,t.util.ZNPList_ZPP_AABBNode.prototype.length=null,t.util.ZNPList_ZPP_AABBNode.prototype.setbegin=function(e){this.head=e,this.modified=!0,this.pushmod=!0},t.util.ZNPList_ZPP_AABBNode.prototype.add=function(e){var n;null==t.util.ZNPNode_ZPP_AABBNode.zpp_pool?n=new t.util.ZNPNode_ZPP_AABBNode:(n=t.util.ZNPNode_ZPP_AABBNode.zpp_pool,t.util.ZNPNode_ZPP_AABBNode.zpp_pool=n.next,n.next=null),n.elt=e;var i=n;return i.next=this.head,this.head=i,this.modified=!0,this.length++,e},t.util.ZNPList_ZPP_AABBNode.prototype.inlined_add=function(e){var n;null==t.util.ZNPNode_ZPP_AABBNode.zpp_pool?n=new t.util.ZNPNode_ZPP_AABBNode:(n=t.util.ZNPNode_ZPP_AABBNode.zpp_pool,t.util.ZNPNode_ZPP_AABBNode.zpp_pool=n.next,n.next=null),n.elt=e;var i=n;return i.next=this.head,this.head=i,this.modified=!0,this.length++,e},t.util.ZNPList_ZPP_AABBNode.prototype.addAll=function(e){for(var t=e.head;null!=t;){var n=t.elt;this.add(n),t=t.next}},t.util.ZNPList_ZPP_AABBNode.prototype.insert=function(e,n){var i;null==t.util.ZNPNode_ZPP_AABBNode.zpp_pool?i=new t.util.ZNPNode_ZPP_AABBNode:(i=t.util.ZNPNode_ZPP_AABBNode.zpp_pool,t.util.ZNPNode_ZPP_AABBNode.zpp_pool=i.next,i.next=null),i.elt=n;var r=i;return null==e?(r.next=this.head,this.head=r):(r.next=e.next,e.next=r),this.pushmod=this.modified=!0,this.length++,r},t.util.ZNPList_ZPP_AABBNode.prototype.inlined_insert=function(e,n){var i;null==t.util.ZNPNode_ZPP_AABBNode.zpp_pool?i=new t.util.ZNPNode_ZPP_AABBNode:(i=t.util.ZNPNode_ZPP_AABBNode.zpp_pool,t.util.ZNPNode_ZPP_AABBNode.zpp_pool=i.next,i.next=null),i.elt=n;var r=i;return null==e?(r.next=this.head,this.head=r):(r.next=e.next,e.next=r),this.pushmod=this.modified=!0,this.length++,r},t.util.ZNPList_ZPP_AABBNode.prototype.pop=function(){var e=this.head;this.head=e.next;var n=e;n.elt=null,n.next=t.util.ZNPNode_ZPP_AABBNode.zpp_pool,t.util.ZNPNode_ZPP_AABBNode.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},t.util.ZNPList_ZPP_AABBNode.prototype.inlined_pop=function(){var e=this.head;this.head=e.next;var n=e;n.elt=null,n.next=t.util.ZNPNode_ZPP_AABBNode.zpp_pool,t.util.ZNPNode_ZPP_AABBNode.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},t.util.ZNPList_ZPP_AABBNode.prototype.pop_unsafe=function(){var e=this.head.elt;return this.pop(),e},t.util.ZNPList_ZPP_AABBNode.prototype.inlined_pop_unsafe=function(){var e=this.head.elt;return this.pop(),e},t.util.ZNPList_ZPP_AABBNode.prototype.remove=function(e){for(var n=null,i=this.head;null!=i;){if(i.elt==e){var r,o;null==n?(o=(r=this.head).next,this.head=o,null==this.head&&(this.pushmod=!0)):(o=(r=n.next).next,n.next=o,null==o&&(this.pushmod=!0));var a=r;a.elt=null,a.next=t.util.ZNPNode_ZPP_AABBNode.zpp_pool,t.util.ZNPNode_ZPP_AABBNode.zpp_pool=a,this.modified=!0,this.length--,this.pushmod=!0;break}n=i,i=i.next}},t.util.ZNPList_ZPP_AABBNode.prototype.try_remove=function(e){for(var t=null,n=this.head,i=!1;null!=n;){if(n.elt==e){this.erase(t),i=!0;break}t=n,n=n.next}return i},t.util.ZNPList_ZPP_AABBNode.prototype.inlined_remove=function(e){for(var n=null,i=this.head;null!=i;){if(i.elt==e){var r,o;null==n?(o=(r=this.head).next,this.head=o,null==this.head&&(this.pushmod=!0)):(o=(r=n.next).next,n.next=o,null==o&&(this.pushmod=!0));var a=r;a.elt=null,a.next=t.util.ZNPNode_ZPP_AABBNode.zpp_pool,t.util.ZNPNode_ZPP_AABBNode.zpp_pool=a,this.modified=!0,this.length--,this.pushmod=!0;break}n=i,i=i.next}},t.util.ZNPList_ZPP_AABBNode.prototype.inlined_try_remove=function(e){for(var n=null,i=this.head,r=!1;null!=i;){if(i.elt==e){var o,a;null==n?(a=(o=this.head).next,this.head=a,null==this.head&&(this.pushmod=!0)):(a=(o=n.next).next,n.next=a,null==a&&(this.pushmod=!0));var s=o;s.elt=null,s.next=t.util.ZNPNode_ZPP_AABBNode.zpp_pool,t.util.ZNPNode_ZPP_AABBNode.zpp_pool=s,this.modified=!0,this.length--,this.pushmod=!0,r=!0;break}n=i,i=i.next}return r},t.util.ZNPList_ZPP_AABBNode.prototype.erase=function(e){var n,i;null==e?(i=(n=this.head).next,this.head=i,null==this.head&&(this.pushmod=!0)):(i=(n=e.next).next,e.next=i,null==i&&(this.pushmod=!0));var r=n;return r.elt=null,r.next=t.util.ZNPNode_ZPP_AABBNode.zpp_pool,t.util.ZNPNode_ZPP_AABBNode.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,i},t.util.ZNPList_ZPP_AABBNode.prototype.inlined_erase=function(e){var n,i;null==e?(i=(n=this.head).next,this.head=i,null==this.head&&(this.pushmod=!0)):(i=(n=e.next).next,e.next=i,null==i&&(this.pushmod=!0));var r=n;return r.elt=null,r.next=t.util.ZNPNode_ZPP_AABBNode.zpp_pool,t.util.ZNPNode_ZPP_AABBNode.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,i},t.util.ZNPList_ZPP_AABBNode.prototype.splice=function(e,t){for(;t-- >0&&null!=e.next;)this.erase(e);return e.next},t.util.ZNPList_ZPP_AABBNode.prototype.clear=function(){for(;null!=this.head;){var e=this.head;this.head=e.next;var n=e;n.elt=null,n.next=t.util.ZNPNode_ZPP_AABBNode.zpp_pool,t.util.ZNPNode_ZPP_AABBNode.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},t.util.ZNPList_ZPP_AABBNode.prototype.inlined_clear=function(){for(;null!=this.head;){var e=this.head;this.head=e.next;var n=e;n.elt=null,n.next=t.util.ZNPNode_ZPP_AABBNode.zpp_pool,t.util.ZNPNode_ZPP_AABBNode.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},t.util.ZNPList_ZPP_AABBNode.prototype.reverse=function(){for(var e=this.head,t=null;null!=e;){var n=e.next;e.next=t,this.head=e,t=e,e=n}this.modified=!0,this.pushmod=!0},t.util.ZNPList_ZPP_AABBNode.prototype.empty=function(){return null==this.head},t.util.ZNPList_ZPP_AABBNode.prototype.size=function(){return this.length},t.util.ZNPList_ZPP_AABBNode.prototype.has=function(e){var t;t=!1;for(var n=this.head;null!=n;){if(n.elt==e){t=!0;break}n=n.next}return t},t.util.ZNPList_ZPP_AABBNode.prototype.inlined_has=function(e){var t;t=!1;for(var n=this.head;null!=n;){if(n.elt==e){t=!0;break}n=n.next}return t},t.util.ZNPList_ZPP_AABBNode.prototype.front=function(){return this.head.elt},t.util.ZNPList_ZPP_AABBNode.prototype.back=function(){for(var e=this.head,t=e;null!=t;)e=t,t=t.next;return e.elt},t.util.ZNPList_ZPP_AABBNode.prototype.iterator_at=function(e){for(var t=this.head;e-- >0&&null!=t;)t=t.next;return t},t.util.ZNPList_ZPP_AABBNode.prototype.at=function(e){var t=this.iterator_at(e);return null!=t?t.elt:null},t.util.ZNPList_ZPP_AABBNode.prototype.__class__=t.util.ZNPList_ZPP_AABBNode,t.util.ZNPList_ZPP_Component=l["zpp_nape.util.ZNPList_ZPP_Component"]=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null},t.util.ZNPList_ZPP_Component.__name__=["zpp_nape","util","ZNPList_ZPP_Component"],t.util.ZNPList_ZPP_Component.prototype.head=null,t.util.ZNPList_ZPP_Component.prototype.begin=function(){return this.head},t.util.ZNPList_ZPP_Component.prototype.modified=null,t.util.ZNPList_ZPP_Component.prototype.pushmod=null,t.util.ZNPList_ZPP_Component.prototype.length=null,t.util.ZNPList_ZPP_Component.prototype.setbegin=function(e){this.head=e,this.modified=!0,this.pushmod=!0},t.util.ZNPList_ZPP_Component.prototype.add=function(e){var n;null==t.util.ZNPNode_ZPP_Component.zpp_pool?n=new t.util.ZNPNode_ZPP_Component:(n=t.util.ZNPNode_ZPP_Component.zpp_pool,t.util.ZNPNode_ZPP_Component.zpp_pool=n.next,n.next=null),n.elt=e;var i=n;return i.next=this.head,this.head=i,this.modified=!0,this.length++,e},t.util.ZNPList_ZPP_Component.prototype.inlined_add=function(e){var n;null==t.util.ZNPNode_ZPP_Component.zpp_pool?n=new t.util.ZNPNode_ZPP_Component:(n=t.util.ZNPNode_ZPP_Component.zpp_pool,t.util.ZNPNode_ZPP_Component.zpp_pool=n.next,n.next=null),n.elt=e;var i=n;return i.next=this.head,this.head=i,this.modified=!0,this.length++,e},t.util.ZNPList_ZPP_Component.prototype.addAll=function(e){for(var t=e.head;null!=t;){var n=t.elt;this.add(n),t=t.next}},t.util.ZNPList_ZPP_Component.prototype.insert=function(e,n){var i;null==t.util.ZNPNode_ZPP_Component.zpp_pool?i=new t.util.ZNPNode_ZPP_Component:(i=t.util.ZNPNode_ZPP_Component.zpp_pool,t.util.ZNPNode_ZPP_Component.zpp_pool=i.next,i.next=null),i.elt=n;var r=i;return null==e?(r.next=this.head,this.head=r):(r.next=e.next,e.next=r),this.pushmod=this.modified=!0,this.length++,r},t.util.ZNPList_ZPP_Component.prototype.inlined_insert=function(e,n){var i;null==t.util.ZNPNode_ZPP_Component.zpp_pool?i=new t.util.ZNPNode_ZPP_Component:(i=t.util.ZNPNode_ZPP_Component.zpp_pool,t.util.ZNPNode_ZPP_Component.zpp_pool=i.next,i.next=null),i.elt=n;var r=i;return null==e?(r.next=this.head,this.head=r):(r.next=e.next,e.next=r),this.pushmod=this.modified=!0,this.length++,r},t.util.ZNPList_ZPP_Component.prototype.pop=function(){var e=this.head;this.head=e.next;var n=e;n.elt=null,n.next=t.util.ZNPNode_ZPP_Component.zpp_pool,t.util.ZNPNode_ZPP_Component.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},t.util.ZNPList_ZPP_Component.prototype.inlined_pop=function(){var e=this.head;this.head=e.next;var n=e;n.elt=null,n.next=t.util.ZNPNode_ZPP_Component.zpp_pool,t.util.ZNPNode_ZPP_Component.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},t.util.ZNPList_ZPP_Component.prototype.pop_unsafe=function(){var e=this.head.elt;return this.pop(),e},t.util.ZNPList_ZPP_Component.prototype.inlined_pop_unsafe=function(){var e=this.head.elt;return this.pop(),e},t.util.ZNPList_ZPP_Component.prototype.remove=function(e){for(var n=null,i=this.head;null!=i;){if(i.elt==e){var r,o;null==n?(o=(r=this.head).next,this.head=o,null==this.head&&(this.pushmod=!0)):(o=(r=n.next).next,n.next=o,null==o&&(this.pushmod=!0));var a=r;a.elt=null,a.next=t.util.ZNPNode_ZPP_Component.zpp_pool,t.util.ZNPNode_ZPP_Component.zpp_pool=a,this.modified=!0,this.length--,this.pushmod=!0;break}n=i,i=i.next}},t.util.ZNPList_ZPP_Component.prototype.try_remove=function(e){for(var t=null,n=this.head,i=!1;null!=n;){if(n.elt==e){this.erase(t),i=!0;break}t=n,n=n.next}return i},t.util.ZNPList_ZPP_Component.prototype.inlined_remove=function(e){for(var n=null,i=this.head;null!=i;){if(i.elt==e){var r,o;null==n?(o=(r=this.head).next,this.head=o,null==this.head&&(this.pushmod=!0)):(o=(r=n.next).next,n.next=o,null==o&&(this.pushmod=!0));var a=r;a.elt=null,a.next=t.util.ZNPNode_ZPP_Component.zpp_pool,t.util.ZNPNode_ZPP_Component.zpp_pool=a,this.modified=!0,this.length--,this.pushmod=!0;break}n=i,i=i.next}},t.util.ZNPList_ZPP_Component.prototype.inlined_try_remove=function(e){for(var n=null,i=this.head,r=!1;null!=i;){if(i.elt==e){var o,a;null==n?(a=(o=this.head).next,this.head=a,null==this.head&&(this.pushmod=!0)):(a=(o=n.next).next,n.next=a,null==a&&(this.pushmod=!0));var s=o;s.elt=null,s.next=t.util.ZNPNode_ZPP_Component.zpp_pool,t.util.ZNPNode_ZPP_Component.zpp_pool=s,this.modified=!0,this.length--,this.pushmod=!0,r=!0;break}n=i,i=i.next}return r},t.util.ZNPList_ZPP_Component.prototype.erase=function(e){var n,i;null==e?(i=(n=this.head).next,this.head=i,null==this.head&&(this.pushmod=!0)):(i=(n=e.next).next,e.next=i,null==i&&(this.pushmod=!0));var r=n;return r.elt=null,r.next=t.util.ZNPNode_ZPP_Component.zpp_pool,t.util.ZNPNode_ZPP_Component.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,i},t.util.ZNPList_ZPP_Component.prototype.inlined_erase=function(e){var n,i;null==e?(i=(n=this.head).next,this.head=i,null==this.head&&(this.pushmod=!0)):(i=(n=e.next).next,e.next=i,null==i&&(this.pushmod=!0));var r=n;return r.elt=null,r.next=t.util.ZNPNode_ZPP_Component.zpp_pool,t.util.ZNPNode_ZPP_Component.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,i},t.util.ZNPList_ZPP_Component.prototype.splice=function(e,t){for(;t-- >0&&null!=e.next;)this.erase(e);return e.next},t.util.ZNPList_ZPP_Component.prototype.clear=function(){for(;null!=this.head;){var e=this.head;this.head=e.next;var n=e;n.elt=null,n.next=t.util.ZNPNode_ZPP_Component.zpp_pool,t.util.ZNPNode_ZPP_Component.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},t.util.ZNPList_ZPP_Component.prototype.inlined_clear=function(){for(;null!=this.head;){var e=this.head;this.head=e.next;var n=e;n.elt=null,n.next=t.util.ZNPNode_ZPP_Component.zpp_pool,t.util.ZNPNode_ZPP_Component.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},t.util.ZNPList_ZPP_Component.prototype.reverse=function(){for(var e=this.head,t=null;null!=e;){var n=e.next;e.next=t,this.head=e,t=e,e=n}this.modified=!0,this.pushmod=!0},t.util.ZNPList_ZPP_Component.prototype.empty=function(){return null==this.head},t.util.ZNPList_ZPP_Component.prototype.size=function(){return this.length},t.util.ZNPList_ZPP_Component.prototype.has=function(e){var t;t=!1;for(var n=this.head;null!=n;){if(n.elt==e){t=!0;break}n=n.next}return t},t.util.ZNPList_ZPP_Component.prototype.inlined_has=function(e){var t;t=!1;for(var n=this.head;null!=n;){if(n.elt==e){t=!0;break}n=n.next}return t},t.util.ZNPList_ZPP_Component.prototype.front=function(){return this.head.elt},t.util.ZNPList_ZPP_Component.prototype.back=function(){for(var e=this.head,t=e;null!=t;)e=t,t=t.next;return e.elt},t.util.ZNPList_ZPP_Component.prototype.iterator_at=function(e){for(var t=this.head;e-- >0&&null!=t;)t=t.next;return t},t.util.ZNPList_ZPP_Component.prototype.at=function(e){var t=this.iterator_at(e);return null!=t?t.elt:null},t.util.ZNPList_ZPP_Component.prototype.__class__=t.util.ZNPList_ZPP_Component,t.util.ZNPList_ZPP_FluidArbiter=l["zpp_nape.util.ZNPList_ZPP_FluidArbiter"]=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null},t.util.ZNPList_ZPP_FluidArbiter.__name__=["zpp_nape","util","ZNPList_ZPP_FluidArbiter"],t.util.ZNPList_ZPP_FluidArbiter.prototype.head=null,t.util.ZNPList_ZPP_FluidArbiter.prototype.begin=function(){return this.head},t.util.ZNPList_ZPP_FluidArbiter.prototype.modified=null,t.util.ZNPList_ZPP_FluidArbiter.prototype.pushmod=null,t.util.ZNPList_ZPP_FluidArbiter.prototype.length=null,t.util.ZNPList_ZPP_FluidArbiter.prototype.setbegin=function(e){this.head=e,this.modified=!0,this.pushmod=!0},t.util.ZNPList_ZPP_FluidArbiter.prototype.add=function(e){var n;null==t.util.ZNPNode_ZPP_FluidArbiter.zpp_pool?n=new t.util.ZNPNode_ZPP_FluidArbiter:(n=t.util.ZNPNode_ZPP_FluidArbiter.zpp_pool,t.util.ZNPNode_ZPP_FluidArbiter.zpp_pool=n.next,n.next=null),n.elt=e;var i=n;return i.next=this.head,this.head=i,this.modified=!0,this.length++,e},t.util.ZNPList_ZPP_FluidArbiter.prototype.inlined_add=function(e){var n;null==t.util.ZNPNode_ZPP_FluidArbiter.zpp_pool?n=new t.util.ZNPNode_ZPP_FluidArbiter:(n=t.util.ZNPNode_ZPP_FluidArbiter.zpp_pool,t.util.ZNPNode_ZPP_FluidArbiter.zpp_pool=n.next,n.next=null),n.elt=e;var i=n;return i.next=this.head,this.head=i,this.modified=!0,this.length++,e},t.util.ZNPList_ZPP_FluidArbiter.prototype.addAll=function(e){for(var t=e.head;null!=t;){var n=t.elt;this.add(n),t=t.next}},t.util.ZNPList_ZPP_FluidArbiter.prototype.insert=function(e,n){var i;null==t.util.ZNPNode_ZPP_FluidArbiter.zpp_pool?i=new t.util.ZNPNode_ZPP_FluidArbiter:(i=t.util.ZNPNode_ZPP_FluidArbiter.zpp_pool,t.util.ZNPNode_ZPP_FluidArbiter.zpp_pool=i.next,i.next=null),i.elt=n;var r=i;return null==e?(r.next=this.head,this.head=r):(r.next=e.next,e.next=r),this.pushmod=this.modified=!0,this.length++,r},t.util.ZNPList_ZPP_FluidArbiter.prototype.inlined_insert=function(e,n){var i;null==t.util.ZNPNode_ZPP_FluidArbiter.zpp_pool?i=new t.util.ZNPNode_ZPP_FluidArbiter:(i=t.util.ZNPNode_ZPP_FluidArbiter.zpp_pool,t.util.ZNPNode_ZPP_FluidArbiter.zpp_pool=i.next,i.next=null),i.elt=n;var r=i;return null==e?(r.next=this.head,this.head=r):(r.next=e.next,e.next=r),this.pushmod=this.modified=!0,this.length++,r},t.util.ZNPList_ZPP_FluidArbiter.prototype.pop=function(){var e=this.head;this.head=e.next;var n=e;n.elt=null,n.next=t.util.ZNPNode_ZPP_FluidArbiter.zpp_pool,t.util.ZNPNode_ZPP_FluidArbiter.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},t.util.ZNPList_ZPP_FluidArbiter.prototype.inlined_pop=function(){var e=this.head;this.head=e.next;var n=e;n.elt=null,n.next=t.util.ZNPNode_ZPP_FluidArbiter.zpp_pool,t.util.ZNPNode_ZPP_FluidArbiter.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},t.util.ZNPList_ZPP_FluidArbiter.prototype.pop_unsafe=function(){var e=this.head.elt;return this.pop(),e},t.util.ZNPList_ZPP_FluidArbiter.prototype.inlined_pop_unsafe=function(){var e=this.head.elt;return this.pop(),e},t.util.ZNPList_ZPP_FluidArbiter.prototype.remove=function(e){for(var n=null,i=this.head;null!=i;){if(i.elt==e){var r,o;null==n?(o=(r=this.head).next,this.head=o,null==this.head&&(this.pushmod=!0)):(o=(r=n.next).next,n.next=o,null==o&&(this.pushmod=!0));var a=r;a.elt=null,a.next=t.util.ZNPNode_ZPP_FluidArbiter.zpp_pool,t.util.ZNPNode_ZPP_FluidArbiter.zpp_pool=a,this.modified=!0,this.length--,this.pushmod=!0;break}n=i,i=i.next}},t.util.ZNPList_ZPP_FluidArbiter.prototype.try_remove=function(e){for(var t=null,n=this.head,i=!1;null!=n;){if(n.elt==e){this.erase(t),i=!0;break}t=n,n=n.next}return i},t.util.ZNPList_ZPP_FluidArbiter.prototype.inlined_remove=function(e){for(var n=null,i=this.head;null!=i;){if(i.elt==e){var r,o;null==n?(o=(r=this.head).next,this.head=o,null==this.head&&(this.pushmod=!0)):(o=(r=n.next).next,n.next=o,null==o&&(this.pushmod=!0));var a=r;a.elt=null,a.next=t.util.ZNPNode_ZPP_FluidArbiter.zpp_pool,t.util.ZNPNode_ZPP_FluidArbiter.zpp_pool=a,this.modified=!0,this.length--,this.pushmod=!0;break}n=i,i=i.next}},t.util.ZNPList_ZPP_FluidArbiter.prototype.inlined_try_remove=function(e){for(var n=null,i=this.head,r=!1;null!=i;){if(i.elt==e){var o,a;null==n?(a=(o=this.head).next,this.head=a,null==this.head&&(this.pushmod=!0)):(a=(o=n.next).next,n.next=a,null==a&&(this.pushmod=!0));var s=o;s.elt=null,s.next=t.util.ZNPNode_ZPP_FluidArbiter.zpp_pool,t.util.ZNPNode_ZPP_FluidArbiter.zpp_pool=s,this.modified=!0,this.length--,this.pushmod=!0,r=!0;break}n=i,i=i.next}return r},t.util.ZNPList_ZPP_FluidArbiter.prototype.erase=function(e){var n,i;null==e?(i=(n=this.head).next,this.head=i,null==this.head&&(this.pushmod=!0)):(i=(n=e.next).next,e.next=i,null==i&&(this.pushmod=!0));var r=n;return r.elt=null,r.next=t.util.ZNPNode_ZPP_FluidArbiter.zpp_pool,t.util.ZNPNode_ZPP_FluidArbiter.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,i},t.util.ZNPList_ZPP_FluidArbiter.prototype.inlined_erase=function(e){var n,i;null==e?(i=(n=this.head).next,this.head=i,null==this.head&&(this.pushmod=!0)):(i=(n=e.next).next,e.next=i,null==i&&(this.pushmod=!0));var r=n;return r.elt=null,r.next=t.util.ZNPNode_ZPP_FluidArbiter.zpp_pool,t.util.ZNPNode_ZPP_FluidArbiter.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,i},t.util.ZNPList_ZPP_FluidArbiter.prototype.splice=function(e,t){for(;t-- >0&&null!=e.next;)this.erase(e);return e.next},t.util.ZNPList_ZPP_FluidArbiter.prototype.clear=function(){for(;null!=this.head;){var e=this.head;this.head=e.next;var n=e;n.elt=null,n.next=t.util.ZNPNode_ZPP_FluidArbiter.zpp_pool,t.util.ZNPNode_ZPP_FluidArbiter.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},t.util.ZNPList_ZPP_FluidArbiter.prototype.inlined_clear=function(){for(;null!=this.head;){var e=this.head;this.head=e.next;var n=e;n.elt=null,n.next=t.util.ZNPNode_ZPP_FluidArbiter.zpp_pool,t.util.ZNPNode_ZPP_FluidArbiter.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},t.util.ZNPList_ZPP_FluidArbiter.prototype.reverse=function(){for(var e=this.head,t=null;null!=e;){var n=e.next;e.next=t,this.head=e,t=e,e=n}this.modified=!0,this.pushmod=!0},t.util.ZNPList_ZPP_FluidArbiter.prototype.empty=function(){return null==this.head},t.util.ZNPList_ZPP_FluidArbiter.prototype.size=function(){return this.length},t.util.ZNPList_ZPP_FluidArbiter.prototype.has=function(e){var t;t=!1;for(var n=this.head;null!=n;){if(n.elt==e){t=!0;break}n=n.next}return t},t.util.ZNPList_ZPP_FluidArbiter.prototype.inlined_has=function(e){var t;t=!1;for(var n=this.head;null!=n;){if(n.elt==e){t=!0;break}n=n.next}return t},t.util.ZNPList_ZPP_FluidArbiter.prototype.front=function(){return this.head.elt},t.util.ZNPList_ZPP_FluidArbiter.prototype.back=function(){for(var e=this.head,t=e;null!=t;)e=t,t=t.next;return e.elt},t.util.ZNPList_ZPP_FluidArbiter.prototype.iterator_at=function(e){for(var t=this.head;e-- >0&&null!=t;)t=t.next;return t},t.util.ZNPList_ZPP_FluidArbiter.prototype.at=function(e){var t=this.iterator_at(e);return null!=t?t.elt:null},t.util.ZNPList_ZPP_FluidArbiter.prototype.__class__=t.util.ZNPList_ZPP_FluidArbiter,t.util.ZNPList_ZPP_SensorArbiter=l["zpp_nape.util.ZNPList_ZPP_SensorArbiter"]=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null},t.util.ZNPList_ZPP_SensorArbiter.__name__=["zpp_nape","util","ZNPList_ZPP_SensorArbiter"],t.util.ZNPList_ZPP_SensorArbiter.prototype.head=null,t.util.ZNPList_ZPP_SensorArbiter.prototype.begin=function(){return this.head},t.util.ZNPList_ZPP_SensorArbiter.prototype.modified=null,t.util.ZNPList_ZPP_SensorArbiter.prototype.pushmod=null,t.util.ZNPList_ZPP_SensorArbiter.prototype.length=null,t.util.ZNPList_ZPP_SensorArbiter.prototype.setbegin=function(e){this.head=e,this.modified=!0,this.pushmod=!0},t.util.ZNPList_ZPP_SensorArbiter.prototype.add=function(e){var n;null==t.util.ZNPNode_ZPP_SensorArbiter.zpp_pool?n=new t.util.ZNPNode_ZPP_SensorArbiter:(n=t.util.ZNPNode_ZPP_SensorArbiter.zpp_pool,t.util.ZNPNode_ZPP_SensorArbiter.zpp_pool=n.next,n.next=null),n.elt=e;var i=n;return i.next=this.head,this.head=i,this.modified=!0,this.length++,e},t.util.ZNPList_ZPP_SensorArbiter.prototype.inlined_add=function(e){var n;null==t.util.ZNPNode_ZPP_SensorArbiter.zpp_pool?n=new t.util.ZNPNode_ZPP_SensorArbiter:(n=t.util.ZNPNode_ZPP_SensorArbiter.zpp_pool,t.util.ZNPNode_ZPP_SensorArbiter.zpp_pool=n.next,n.next=null),n.elt=e;var i=n;return i.next=this.head,this.head=i,this.modified=!0,this.length++,e},t.util.ZNPList_ZPP_SensorArbiter.prototype.addAll=function(e){for(var t=e.head;null!=t;){var n=t.elt;this.add(n),t=t.next}},t.util.ZNPList_ZPP_SensorArbiter.prototype.insert=function(e,n){var i;null==t.util.ZNPNode_ZPP_SensorArbiter.zpp_pool?i=new t.util.ZNPNode_ZPP_SensorArbiter:(i=t.util.ZNPNode_ZPP_SensorArbiter.zpp_pool,t.util.ZNPNode_ZPP_SensorArbiter.zpp_pool=i.next,i.next=null),i.elt=n;var r=i;return null==e?(r.next=this.head,this.head=r):(r.next=e.next,e.next=r),this.pushmod=this.modified=!0,this.length++,r},t.util.ZNPList_ZPP_SensorArbiter.prototype.inlined_insert=function(e,n){var i;null==t.util.ZNPNode_ZPP_SensorArbiter.zpp_pool?i=new t.util.ZNPNode_ZPP_SensorArbiter:(i=t.util.ZNPNode_ZPP_SensorArbiter.zpp_pool,t.util.ZNPNode_ZPP_SensorArbiter.zpp_pool=i.next,i.next=null),i.elt=n;var r=i;return null==e?(r.next=this.head,this.head=r):(r.next=e.next,e.next=r),this.pushmod=this.modified=!0,this.length++,r},t.util.ZNPList_ZPP_SensorArbiter.prototype.pop=function(){var e=this.head;this.head=e.next;var n=e;n.elt=null,n.next=t.util.ZNPNode_ZPP_SensorArbiter.zpp_pool,t.util.ZNPNode_ZPP_SensorArbiter.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},t.util.ZNPList_ZPP_SensorArbiter.prototype.inlined_pop=function(){var e=this.head;this.head=e.next;var n=e;n.elt=null,n.next=t.util.ZNPNode_ZPP_SensorArbiter.zpp_pool,t.util.ZNPNode_ZPP_SensorArbiter.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},t.util.ZNPList_ZPP_SensorArbiter.prototype.pop_unsafe=function(){var e=this.head.elt;return this.pop(),e},t.util.ZNPList_ZPP_SensorArbiter.prototype.inlined_pop_unsafe=function(){var e=this.head.elt;return this.pop(),e},t.util.ZNPList_ZPP_SensorArbiter.prototype.remove=function(e){for(var n=null,i=this.head;null!=i;){if(i.elt==e){var r,o;null==n?(o=(r=this.head).next,this.head=o,null==this.head&&(this.pushmod=!0)):(o=(r=n.next).next,n.next=o,null==o&&(this.pushmod=!0));var a=r;a.elt=null,a.next=t.util.ZNPNode_ZPP_SensorArbiter.zpp_pool,t.util.ZNPNode_ZPP_SensorArbiter.zpp_pool=a,this.modified=!0,this.length--,this.pushmod=!0;break}n=i,i=i.next}},t.util.ZNPList_ZPP_SensorArbiter.prototype.try_remove=function(e){for(var t=null,n=this.head,i=!1;null!=n;){if(n.elt==e){this.erase(t),i=!0;break}t=n,n=n.next}return i},t.util.ZNPList_ZPP_SensorArbiter.prototype.inlined_remove=function(e){for(var n=null,i=this.head;null!=i;){if(i.elt==e){var r,o;null==n?(o=(r=this.head).next,this.head=o,null==this.head&&(this.pushmod=!0)):(o=(r=n.next).next,n.next=o,null==o&&(this.pushmod=!0));var a=r;a.elt=null,a.next=t.util.ZNPNode_ZPP_SensorArbiter.zpp_pool,t.util.ZNPNode_ZPP_SensorArbiter.zpp_pool=a,this.modified=!0,this.length--,this.pushmod=!0;break}n=i,i=i.next}},t.util.ZNPList_ZPP_SensorArbiter.prototype.inlined_try_remove=function(e){for(var n=null,i=this.head,r=!1;null!=i;){if(i.elt==e){var o,a;null==n?(a=(o=this.head).next,this.head=a,null==this.head&&(this.pushmod=!0)):(a=(o=n.next).next,n.next=a,null==a&&(this.pushmod=!0));var s=o;s.elt=null,s.next=t.util.ZNPNode_ZPP_SensorArbiter.zpp_pool,t.util.ZNPNode_ZPP_SensorArbiter.zpp_pool=s,this.modified=!0,this.length--,this.pushmod=!0,r=!0;break}n=i,i=i.next}return r},t.util.ZNPList_ZPP_SensorArbiter.prototype.erase=function(e){var n,i;null==e?(i=(n=this.head).next,this.head=i,null==this.head&&(this.pushmod=!0)):(i=(n=e.next).next,e.next=i,null==i&&(this.pushmod=!0));var r=n;return r.elt=null,r.next=t.util.ZNPNode_ZPP_SensorArbiter.zpp_pool,t.util.ZNPNode_ZPP_SensorArbiter.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,i},t.util.ZNPList_ZPP_SensorArbiter.prototype.inlined_erase=function(e){var n,i;null==e?(i=(n=this.head).next,this.head=i,null==this.head&&(this.pushmod=!0)):(i=(n=e.next).next,e.next=i,null==i&&(this.pushmod=!0));var r=n;return r.elt=null,r.next=t.util.ZNPNode_ZPP_SensorArbiter.zpp_pool,t.util.ZNPNode_ZPP_SensorArbiter.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,i},t.util.ZNPList_ZPP_SensorArbiter.prototype.splice=function(e,t){for(;t-- >0&&null!=e.next;)this.erase(e);return e.next},t.util.ZNPList_ZPP_SensorArbiter.prototype.clear=function(){for(;null!=this.head;){var e=this.head;this.head=e.next;var n=e;n.elt=null,n.next=t.util.ZNPNode_ZPP_SensorArbiter.zpp_pool,t.util.ZNPNode_ZPP_SensorArbiter.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},t.util.ZNPList_ZPP_SensorArbiter.prototype.inlined_clear=function(){for(;null!=this.head;){var e=this.head;this.head=e.next;var n=e;n.elt=null,n.next=t.util.ZNPNode_ZPP_SensorArbiter.zpp_pool,t.util.ZNPNode_ZPP_SensorArbiter.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},t.util.ZNPList_ZPP_SensorArbiter.prototype.reverse=function(){for(var e=this.head,t=null;null!=e;){var n=e.next;e.next=t,this.head=e,t=e,e=n}this.modified=!0,this.pushmod=!0},t.util.ZNPList_ZPP_SensorArbiter.prototype.empty=function(){return null==this.head},t.util.ZNPList_ZPP_SensorArbiter.prototype.size=function(){return this.length},t.util.ZNPList_ZPP_SensorArbiter.prototype.has=function(e){var t;t=!1;for(var n=this.head;null!=n;){if(n.elt==e){t=!0;break}n=n.next}return t},t.util.ZNPList_ZPP_SensorArbiter.prototype.inlined_has=function(e){var t;t=!1;for(var n=this.head;null!=n;){if(n.elt==e){t=!0;break}n=n.next}return t},t.util.ZNPList_ZPP_SensorArbiter.prototype.front=function(){return this.head.elt},t.util.ZNPList_ZPP_SensorArbiter.prototype.back=function(){for(var e=this.head,t=e;null!=t;)e=t,t=t.next;return e.elt},t.util.ZNPList_ZPP_SensorArbiter.prototype.iterator_at=function(e){for(var t=this.head;e-- >0&&null!=t;)t=t.next;return t},t.util.ZNPList_ZPP_SensorArbiter.prototype.at=function(e){var t=this.iterator_at(e);return null!=t?t.elt:null},t.util.ZNPList_ZPP_SensorArbiter.prototype.__class__=t.util.ZNPList_ZPP_SensorArbiter,t.util.ZNPList_ZPP_Listener=l["zpp_nape.util.ZNPList_ZPP_Listener"]=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null},t.util.ZNPList_ZPP_Listener.__name__=["zpp_nape","util","ZNPList_ZPP_Listener"],t.util.ZNPList_ZPP_Listener.prototype.head=null,t.util.ZNPList_ZPP_Listener.prototype.begin=function(){return this.head},t.util.ZNPList_ZPP_Listener.prototype.modified=null,t.util.ZNPList_ZPP_Listener.prototype.pushmod=null,t.util.ZNPList_ZPP_Listener.prototype.length=null,t.util.ZNPList_ZPP_Listener.prototype.setbegin=function(e){this.head=e,this.modified=!0,this.pushmod=!0},t.util.ZNPList_ZPP_Listener.prototype.add=function(e){var n;null==t.util.ZNPNode_ZPP_Listener.zpp_pool?n=new t.util.ZNPNode_ZPP_Listener:(n=t.util.ZNPNode_ZPP_Listener.zpp_pool,t.util.ZNPNode_ZPP_Listener.zpp_pool=n.next,n.next=null),n.elt=e;var i=n;return i.next=this.head,this.head=i,this.modified=!0,this.length++,e},t.util.ZNPList_ZPP_Listener.prototype.inlined_add=function(e){var n;null==t.util.ZNPNode_ZPP_Listener.zpp_pool?n=new t.util.ZNPNode_ZPP_Listener:(n=t.util.ZNPNode_ZPP_Listener.zpp_pool,t.util.ZNPNode_ZPP_Listener.zpp_pool=n.next,n.next=null),n.elt=e;var i=n;return i.next=this.head,this.head=i,this.modified=!0,this.length++,e},t.util.ZNPList_ZPP_Listener.prototype.addAll=function(e){for(var t=e.head;null!=t;){var n=t.elt;this.add(n),t=t.next}},t.util.ZNPList_ZPP_Listener.prototype.insert=function(e,n){var i;null==t.util.ZNPNode_ZPP_Listener.zpp_pool?i=new t.util.ZNPNode_ZPP_Listener:(i=t.util.ZNPNode_ZPP_Listener.zpp_pool,t.util.ZNPNode_ZPP_Listener.zpp_pool=i.next,i.next=null),i.elt=n;var r=i;return null==e?(r.next=this.head,this.head=r):(r.next=e.next,e.next=r),this.pushmod=this.modified=!0,this.length++,r},t.util.ZNPList_ZPP_Listener.prototype.inlined_insert=function(e,n){var i;null==t.util.ZNPNode_ZPP_Listener.zpp_pool?i=new t.util.ZNPNode_ZPP_Listener:(i=t.util.ZNPNode_ZPP_Listener.zpp_pool,t.util.ZNPNode_ZPP_Listener.zpp_pool=i.next,i.next=null),i.elt=n;var r=i;return null==e?(r.next=this.head,this.head=r):(r.next=e.next,e.next=r),this.pushmod=this.modified=!0,this.length++,r},t.util.ZNPList_ZPP_Listener.prototype.pop=function(){var e=this.head;this.head=e.next;var n=e;n.elt=null,n.next=t.util.ZNPNode_ZPP_Listener.zpp_pool,t.util.ZNPNode_ZPP_Listener.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},t.util.ZNPList_ZPP_Listener.prototype.inlined_pop=function(){var e=this.head;this.head=e.next;var n=e;n.elt=null,n.next=t.util.ZNPNode_ZPP_Listener.zpp_pool,t.util.ZNPNode_ZPP_Listener.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},t.util.ZNPList_ZPP_Listener.prototype.pop_unsafe=function(){var e=this.head.elt;return this.pop(),e},t.util.ZNPList_ZPP_Listener.prototype.inlined_pop_unsafe=function(){var e=this.head.elt;return this.pop(),e},t.util.ZNPList_ZPP_Listener.prototype.remove=function(e){for(var n=null,i=this.head;null!=i;){if(i.elt==e){var r,o;null==n?(o=(r=this.head).next,this.head=o,null==this.head&&(this.pushmod=!0)):(o=(r=n.next).next,n.next=o,null==o&&(this.pushmod=!0));var a=r;a.elt=null,a.next=t.util.ZNPNode_ZPP_Listener.zpp_pool,t.util.ZNPNode_ZPP_Listener.zpp_pool=a,this.modified=!0,this.length--,this.pushmod=!0;break}n=i,i=i.next}},t.util.ZNPList_ZPP_Listener.prototype.try_remove=function(e){for(var t=null,n=this.head,i=!1;null!=n;){if(n.elt==e){this.erase(t),i=!0;break}t=n,n=n.next}return i},t.util.ZNPList_ZPP_Listener.prototype.inlined_remove=function(e){for(var n=null,i=this.head;null!=i;){if(i.elt==e){var r,o;null==n?(o=(r=this.head).next,this.head=o,null==this.head&&(this.pushmod=!0)):(o=(r=n.next).next,n.next=o,null==o&&(this.pushmod=!0));var a=r;a.elt=null,a.next=t.util.ZNPNode_ZPP_Listener.zpp_pool,t.util.ZNPNode_ZPP_Listener.zpp_pool=a,this.modified=!0,this.length--,this.pushmod=!0;break}n=i,i=i.next}},t.util.ZNPList_ZPP_Listener.prototype.inlined_try_remove=function(e){for(var n=null,i=this.head,r=!1;null!=i;){if(i.elt==e){var o,a;null==n?(a=(o=this.head).next,this.head=a,null==this.head&&(this.pushmod=!0)):(a=(o=n.next).next,n.next=a,null==a&&(this.pushmod=!0));var s=o;s.elt=null,s.next=t.util.ZNPNode_ZPP_Listener.zpp_pool,t.util.ZNPNode_ZPP_Listener.zpp_pool=s,this.modified=!0,this.length--,this.pushmod=!0,r=!0;break}n=i,i=i.next}return r},t.util.ZNPList_ZPP_Listener.prototype.erase=function(e){var n,i;null==e?(i=(n=this.head).next,this.head=i,null==this.head&&(this.pushmod=!0)):(i=(n=e.next).next,e.next=i,null==i&&(this.pushmod=!0));var r=n;return r.elt=null,r.next=t.util.ZNPNode_ZPP_Listener.zpp_pool,t.util.ZNPNode_ZPP_Listener.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,i},t.util.ZNPList_ZPP_Listener.prototype.inlined_erase=function(e){var n,i;null==e?(i=(n=this.head).next,this.head=i,null==this.head&&(this.pushmod=!0)):(i=(n=e.next).next,e.next=i,null==i&&(this.pushmod=!0));var r=n;return r.elt=null,r.next=t.util.ZNPNode_ZPP_Listener.zpp_pool,t.util.ZNPNode_ZPP_Listener.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,i},t.util.ZNPList_ZPP_Listener.prototype.splice=function(e,t){for(;t-- >0&&null!=e.next;)this.erase(e);return e.next},t.util.ZNPList_ZPP_Listener.prototype.clear=function(){for(;null!=this.head;){var e=this.head;this.head=e.next;var n=e;n.elt=null,n.next=t.util.ZNPNode_ZPP_Listener.zpp_pool,t.util.ZNPNode_ZPP_Listener.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},t.util.ZNPList_ZPP_Listener.prototype.inlined_clear=function(){for(;null!=this.head;){var e=this.head;this.head=e.next;var n=e;n.elt=null,n.next=t.util.ZNPNode_ZPP_Listener.zpp_pool,t.util.ZNPNode_ZPP_Listener.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},t.util.ZNPList_ZPP_Listener.prototype.reverse=function(){for(var e=this.head,t=null;null!=e;){var n=e.next;e.next=t,this.head=e,t=e,e=n}this.modified=!0,this.pushmod=!0},t.util.ZNPList_ZPP_Listener.prototype.empty=function(){return null==this.head},t.util.ZNPList_ZPP_Listener.prototype.size=function(){return this.length},t.util.ZNPList_ZPP_Listener.prototype.has=function(e){var t;t=!1;for(var n=this.head;null!=n;){if(n.elt==e){t=!0;break}n=n.next}return t},t.util.ZNPList_ZPP_Listener.prototype.inlined_has=function(e){var t;t=!1;for(var n=this.head;null!=n;){if(n.elt==e){t=!0;break}n=n.next}return t},t.util.ZNPList_ZPP_Listener.prototype.front=function(){return this.head.elt},t.util.ZNPList_ZPP_Listener.prototype.back=function(){for(var e=this.head,t=e;null!=t;)e=t,t=t.next;return e.elt},t.util.ZNPList_ZPP_Listener.prototype.iterator_at=function(e){for(var t=this.head;e-- >0&&null!=t;)t=t.next;return t},t.util.ZNPList_ZPP_Listener.prototype.at=function(e){var t=this.iterator_at(e);return null!=t?t.elt:null},t.util.ZNPList_ZPP_Listener.prototype.__class__=t.util.ZNPList_ZPP_Listener,t.util.ZNPList_ZPP_ColArbiter=l["zpp_nape.util.ZNPList_ZPP_ColArbiter"]=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null},t.util.ZNPList_ZPP_ColArbiter.__name__=["zpp_nape","util","ZNPList_ZPP_ColArbiter"],t.util.ZNPList_ZPP_ColArbiter.prototype.head=null,t.util.ZNPList_ZPP_ColArbiter.prototype.begin=function(){return this.head},t.util.ZNPList_ZPP_ColArbiter.prototype.modified=null,t.util.ZNPList_ZPP_ColArbiter.prototype.pushmod=null,t.util.ZNPList_ZPP_ColArbiter.prototype.length=null,t.util.ZNPList_ZPP_ColArbiter.prototype.setbegin=function(e){this.head=e,this.modified=!0,this.pushmod=!0},t.util.ZNPList_ZPP_ColArbiter.prototype.add=function(e){var n;null==t.util.ZNPNode_ZPP_ColArbiter.zpp_pool?n=new t.util.ZNPNode_ZPP_ColArbiter:(n=t.util.ZNPNode_ZPP_ColArbiter.zpp_pool,t.util.ZNPNode_ZPP_ColArbiter.zpp_pool=n.next,n.next=null),n.elt=e;var i=n;return i.next=this.head,this.head=i,this.modified=!0,this.length++,e},t.util.ZNPList_ZPP_ColArbiter.prototype.inlined_add=function(e){var n;null==t.util.ZNPNode_ZPP_ColArbiter.zpp_pool?n=new t.util.ZNPNode_ZPP_ColArbiter:(n=t.util.ZNPNode_ZPP_ColArbiter.zpp_pool,t.util.ZNPNode_ZPP_ColArbiter.zpp_pool=n.next,n.next=null),n.elt=e;var i=n;return i.next=this.head,this.head=i,this.modified=!0,this.length++,e},t.util.ZNPList_ZPP_ColArbiter.prototype.addAll=function(e){for(var t=e.head;null!=t;){var n=t.elt;this.add(n),t=t.next}},t.util.ZNPList_ZPP_ColArbiter.prototype.insert=function(e,n){var i;null==t.util.ZNPNode_ZPP_ColArbiter.zpp_pool?i=new t.util.ZNPNode_ZPP_ColArbiter:(i=t.util.ZNPNode_ZPP_ColArbiter.zpp_pool,t.util.ZNPNode_ZPP_ColArbiter.zpp_pool=i.next,i.next=null),i.elt=n;var r=i;return null==e?(r.next=this.head,this.head=r):(r.next=e.next,e.next=r),this.pushmod=this.modified=!0,this.length++,r},t.util.ZNPList_ZPP_ColArbiter.prototype.inlined_insert=function(e,n){var i;null==t.util.ZNPNode_ZPP_ColArbiter.zpp_pool?i=new t.util.ZNPNode_ZPP_ColArbiter:(i=t.util.ZNPNode_ZPP_ColArbiter.zpp_pool,t.util.ZNPNode_ZPP_ColArbiter.zpp_pool=i.next,i.next=null),i.elt=n;var r=i;return null==e?(r.next=this.head,this.head=r):(r.next=e.next,e.next=r),this.pushmod=this.modified=!0,this.length++,r},t.util.ZNPList_ZPP_ColArbiter.prototype.pop=function(){var e=this.head;this.head=e.next;var n=e;n.elt=null,n.next=t.util.ZNPNode_ZPP_ColArbiter.zpp_pool,t.util.ZNPNode_ZPP_ColArbiter.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},t.util.ZNPList_ZPP_ColArbiter.prototype.inlined_pop=function(){var e=this.head;this.head=e.next;var n=e;n.elt=null,n.next=t.util.ZNPNode_ZPP_ColArbiter.zpp_pool,t.util.ZNPNode_ZPP_ColArbiter.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},t.util.ZNPList_ZPP_ColArbiter.prototype.pop_unsafe=function(){var e=this.head.elt;return this.pop(),e},t.util.ZNPList_ZPP_ColArbiter.prototype.inlined_pop_unsafe=function(){var e=this.head.elt;return this.pop(),e},t.util.ZNPList_ZPP_ColArbiter.prototype.remove=function(e){for(var n=null,i=this.head;null!=i;){if(i.elt==e){var r,o;null==n?(o=(r=this.head).next,this.head=o,null==this.head&&(this.pushmod=!0)):(o=(r=n.next).next,n.next=o,null==o&&(this.pushmod=!0));var a=r;a.elt=null,a.next=t.util.ZNPNode_ZPP_ColArbiter.zpp_pool,t.util.ZNPNode_ZPP_ColArbiter.zpp_pool=a,this.modified=!0,this.length--,this.pushmod=!0;break}n=i,i=i.next}},t.util.ZNPList_ZPP_ColArbiter.prototype.try_remove=function(e){for(var t=null,n=this.head,i=!1;null!=n;){if(n.elt==e){this.erase(t),i=!0;break}t=n,n=n.next}return i},t.util.ZNPList_ZPP_ColArbiter.prototype.inlined_remove=function(e){for(var n=null,i=this.head;null!=i;){if(i.elt==e){var r,o;null==n?(o=(r=this.head).next,this.head=o,null==this.head&&(this.pushmod=!0)):(o=(r=n.next).next,n.next=o,null==o&&(this.pushmod=!0));var a=r;a.elt=null,a.next=t.util.ZNPNode_ZPP_ColArbiter.zpp_pool,t.util.ZNPNode_ZPP_ColArbiter.zpp_pool=a,this.modified=!0,this.length--,this.pushmod=!0;break}n=i,i=i.next}},t.util.ZNPList_ZPP_ColArbiter.prototype.inlined_try_remove=function(e){for(var n=null,i=this.head,r=!1;null!=i;){if(i.elt==e){var o,a;null==n?(a=(o=this.head).next,this.head=a,null==this.head&&(this.pushmod=!0)):(a=(o=n.next).next,n.next=a,null==a&&(this.pushmod=!0));var s=o;s.elt=null,s.next=t.util.ZNPNode_ZPP_ColArbiter.zpp_pool,t.util.ZNPNode_ZPP_ColArbiter.zpp_pool=s,this.modified=!0,this.length--,this.pushmod=!0,r=!0;break}n=i,i=i.next}return r},t.util.ZNPList_ZPP_ColArbiter.prototype.erase=function(e){var n,i;null==e?(i=(n=this.head).next,this.head=i,null==this.head&&(this.pushmod=!0)):(i=(n=e.next).next,e.next=i,null==i&&(this.pushmod=!0));var r=n;return r.elt=null,r.next=t.util.ZNPNode_ZPP_ColArbiter.zpp_pool,t.util.ZNPNode_ZPP_ColArbiter.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,i},t.util.ZNPList_ZPP_ColArbiter.prototype.inlined_erase=function(e){var n,i;null==e?(i=(n=this.head).next,this.head=i,null==this.head&&(this.pushmod=!0)):(i=(n=e.next).next,e.next=i,null==i&&(this.pushmod=!0));var r=n;return r.elt=null,r.next=t.util.ZNPNode_ZPP_ColArbiter.zpp_pool,t.util.ZNPNode_ZPP_ColArbiter.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,i},t.util.ZNPList_ZPP_ColArbiter.prototype.splice=function(e,t){for(;t-- >0&&null!=e.next;)this.erase(e);return e.next},t.util.ZNPList_ZPP_ColArbiter.prototype.clear=function(){for(;null!=this.head;){var e=this.head;this.head=e.next;var n=e;n.elt=null,n.next=t.util.ZNPNode_ZPP_ColArbiter.zpp_pool,t.util.ZNPNode_ZPP_ColArbiter.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},t.util.ZNPList_ZPP_ColArbiter.prototype.inlined_clear=function(){for(;null!=this.head;){var e=this.head;this.head=e.next;var n=e;n.elt=null,n.next=t.util.ZNPNode_ZPP_ColArbiter.zpp_pool,t.util.ZNPNode_ZPP_ColArbiter.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},t.util.ZNPList_ZPP_ColArbiter.prototype.reverse=function(){for(var e=this.head,t=null;null!=e;){var n=e.next;e.next=t,this.head=e,t=e,e=n}this.modified=!0,this.pushmod=!0},t.util.ZNPList_ZPP_ColArbiter.prototype.empty=function(){return null==this.head},t.util.ZNPList_ZPP_ColArbiter.prototype.size=function(){return this.length},t.util.ZNPList_ZPP_ColArbiter.prototype.has=function(e){var t;t=!1;for(var n=this.head;null!=n;){if(n.elt==e){t=!0;break}n=n.next}return t},t.util.ZNPList_ZPP_ColArbiter.prototype.inlined_has=function(e){var t;t=!1;for(var n=this.head;null!=n;){if(n.elt==e){t=!0;break}n=n.next}return t},t.util.ZNPList_ZPP_ColArbiter.prototype.front=function(){return this.head.elt},t.util.ZNPList_ZPP_ColArbiter.prototype.back=function(){for(var e=this.head,t=e;null!=t;)e=t,t=t.next;return e.elt},t.util.ZNPList_ZPP_ColArbiter.prototype.iterator_at=function(e){for(var t=this.head;e-- >0&&null!=t;)t=t.next;return t},t.util.ZNPList_ZPP_ColArbiter.prototype.at=function(e){var t=this.iterator_at(e);return null!=t?t.elt:null},t.util.ZNPList_ZPP_ColArbiter.prototype.__class__=t.util.ZNPList_ZPP_ColArbiter,t.util.ZNPList_ZPP_InteractionGroup=l["zpp_nape.util.ZNPList_ZPP_InteractionGroup"]=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null},t.util.ZNPList_ZPP_InteractionGroup.__name__=["zpp_nape","util","ZNPList_ZPP_InteractionGroup"],t.util.ZNPList_ZPP_InteractionGroup.prototype.head=null,t.util.ZNPList_ZPP_InteractionGroup.prototype.begin=function(){return this.head},t.util.ZNPList_ZPP_InteractionGroup.prototype.modified=null,t.util.ZNPList_ZPP_InteractionGroup.prototype.pushmod=null,t.util.ZNPList_ZPP_InteractionGroup.prototype.length=null,t.util.ZNPList_ZPP_InteractionGroup.prototype.setbegin=function(e){this.head=e,this.modified=!0,this.pushmod=!0},t.util.ZNPList_ZPP_InteractionGroup.prototype.add=function(e){var n;null==t.util.ZNPNode_ZPP_InteractionGroup.zpp_pool?n=new t.util.ZNPNode_ZPP_InteractionGroup:(n=t.util.ZNPNode_ZPP_InteractionGroup.zpp_pool,t.util.ZNPNode_ZPP_InteractionGroup.zpp_pool=n.next,n.next=null),n.elt=e;var i=n;return i.next=this.head,this.head=i,this.modified=!0,this.length++,e},t.util.ZNPList_ZPP_InteractionGroup.prototype.inlined_add=function(e){var n;null==t.util.ZNPNode_ZPP_InteractionGroup.zpp_pool?n=new t.util.ZNPNode_ZPP_InteractionGroup:(n=t.util.ZNPNode_ZPP_InteractionGroup.zpp_pool,t.util.ZNPNode_ZPP_InteractionGroup.zpp_pool=n.next,n.next=null),n.elt=e;var i=n;return i.next=this.head,this.head=i,this.modified=!0,this.length++,e},t.util.ZNPList_ZPP_InteractionGroup.prototype.addAll=function(e){for(var t=e.head;null!=t;){var n=t.elt;this.add(n),t=t.next}},t.util.ZNPList_ZPP_InteractionGroup.prototype.insert=function(e,n){var i;null==t.util.ZNPNode_ZPP_InteractionGroup.zpp_pool?i=new t.util.ZNPNode_ZPP_InteractionGroup:(i=t.util.ZNPNode_ZPP_InteractionGroup.zpp_pool,t.util.ZNPNode_ZPP_InteractionGroup.zpp_pool=i.next,i.next=null),i.elt=n;var r=i;return null==e?(r.next=this.head,this.head=r):(r.next=e.next,e.next=r),this.pushmod=this.modified=!0,this.length++,r},t.util.ZNPList_ZPP_InteractionGroup.prototype.inlined_insert=function(e,n){var i;null==t.util.ZNPNode_ZPP_InteractionGroup.zpp_pool?i=new t.util.ZNPNode_ZPP_InteractionGroup:(i=t.util.ZNPNode_ZPP_InteractionGroup.zpp_pool,t.util.ZNPNode_ZPP_InteractionGroup.zpp_pool=i.next,i.next=null),i.elt=n;var r=i;return null==e?(r.next=this.head,this.head=r):(r.next=e.next,e.next=r),this.pushmod=this.modified=!0,this.length++,r},t.util.ZNPList_ZPP_InteractionGroup.prototype.pop=function(){var e=this.head;this.head=e.next;var n=e;n.elt=null,n.next=t.util.ZNPNode_ZPP_InteractionGroup.zpp_pool,t.util.ZNPNode_ZPP_InteractionGroup.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},t.util.ZNPList_ZPP_InteractionGroup.prototype.inlined_pop=function(){var e=this.head;this.head=e.next;var n=e;n.elt=null,n.next=t.util.ZNPNode_ZPP_InteractionGroup.zpp_pool,t.util.ZNPNode_ZPP_InteractionGroup.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},t.util.ZNPList_ZPP_InteractionGroup.prototype.pop_unsafe=function(){var e=this.head.elt;return this.pop(),e},t.util.ZNPList_ZPP_InteractionGroup.prototype.inlined_pop_unsafe=function(){var e=this.head.elt;return this.pop(),e},t.util.ZNPList_ZPP_InteractionGroup.prototype.remove=function(e){for(var n=null,i=this.head;null!=i;){if(i.elt==e){var r,o;null==n?(o=(r=this.head).next,this.head=o,null==this.head&&(this.pushmod=!0)):(o=(r=n.next).next,n.next=o,null==o&&(this.pushmod=!0));var a=r;a.elt=null,a.next=t.util.ZNPNode_ZPP_InteractionGroup.zpp_pool,t.util.ZNPNode_ZPP_InteractionGroup.zpp_pool=a,this.modified=!0,this.length--,this.pushmod=!0;break}n=i,i=i.next}},t.util.ZNPList_ZPP_InteractionGroup.prototype.try_remove=function(e){for(var t=null,n=this.head,i=!1;null!=n;){if(n.elt==e){this.erase(t),i=!0;break}t=n,n=n.next}return i},t.util.ZNPList_ZPP_InteractionGroup.prototype.inlined_remove=function(e){for(var n=null,i=this.head;null!=i;){if(i.elt==e){var r,o;null==n?(o=(r=this.head).next,this.head=o,null==this.head&&(this.pushmod=!0)):(o=(r=n.next).next,n.next=o,null==o&&(this.pushmod=!0));var a=r;a.elt=null,a.next=t.util.ZNPNode_ZPP_InteractionGroup.zpp_pool,t.util.ZNPNode_ZPP_InteractionGroup.zpp_pool=a,this.modified=!0,this.length--,this.pushmod=!0;break}n=i,i=i.next}},t.util.ZNPList_ZPP_InteractionGroup.prototype.inlined_try_remove=function(e){for(var n=null,i=this.head,r=!1;null!=i;){if(i.elt==e){var o,a;null==n?(a=(o=this.head).next,this.head=a,null==this.head&&(this.pushmod=!0)):(a=(o=n.next).next,n.next=a,null==a&&(this.pushmod=!0));var s=o;s.elt=null,s.next=t.util.ZNPNode_ZPP_InteractionGroup.zpp_pool,t.util.ZNPNode_ZPP_InteractionGroup.zpp_pool=s,this.modified=!0,this.length--,this.pushmod=!0,r=!0;break}n=i,i=i.next}return r},t.util.ZNPList_ZPP_InteractionGroup.prototype.erase=function(e){var n,i;null==e?(i=(n=this.head).next,this.head=i,null==this.head&&(this.pushmod=!0)):(i=(n=e.next).next,e.next=i,null==i&&(this.pushmod=!0));var r=n;return r.elt=null,r.next=t.util.ZNPNode_ZPP_InteractionGroup.zpp_pool,t.util.ZNPNode_ZPP_InteractionGroup.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,i},t.util.ZNPList_ZPP_InteractionGroup.prototype.inlined_erase=function(e){var n,i;null==e?(i=(n=this.head).next,this.head=i,null==this.head&&(this.pushmod=!0)):(i=(n=e.next).next,e.next=i,null==i&&(this.pushmod=!0));var r=n;return r.elt=null,r.next=t.util.ZNPNode_ZPP_InteractionGroup.zpp_pool,t.util.ZNPNode_ZPP_InteractionGroup.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,i},t.util.ZNPList_ZPP_InteractionGroup.prototype.splice=function(e,t){for(;t-- >0&&null!=e.next;)this.erase(e);return e.next},t.util.ZNPList_ZPP_InteractionGroup.prototype.clear=function(){for(;null!=this.head;){var e=this.head;this.head=e.next;var n=e;n.elt=null,n.next=t.util.ZNPNode_ZPP_InteractionGroup.zpp_pool,t.util.ZNPNode_ZPP_InteractionGroup.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},t.util.ZNPList_ZPP_InteractionGroup.prototype.inlined_clear=function(){for(;null!=this.head;){var e=this.head;this.head=e.next;var n=e;n.elt=null,n.next=t.util.ZNPNode_ZPP_InteractionGroup.zpp_pool,t.util.ZNPNode_ZPP_InteractionGroup.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},t.util.ZNPList_ZPP_InteractionGroup.prototype.reverse=function(){for(var e=this.head,t=null;null!=e;){var n=e.next;e.next=t,this.head=e,t=e,e=n}this.modified=!0,this.pushmod=!0},t.util.ZNPList_ZPP_InteractionGroup.prototype.empty=function(){return null==this.head},t.util.ZNPList_ZPP_InteractionGroup.prototype.size=function(){return this.length},t.util.ZNPList_ZPP_InteractionGroup.prototype.has=function(e){var t;t=!1;for(var n=this.head;null!=n;){if(n.elt==e){t=!0;break}n=n.next}return t},t.util.ZNPList_ZPP_InteractionGroup.prototype.inlined_has=function(e){var t;t=!1;for(var n=this.head;null!=n;){if(n.elt==e){t=!0;break}n=n.next}return t},t.util.ZNPList_ZPP_InteractionGroup.prototype.front=function(){return this.head.elt},t.util.ZNPList_ZPP_InteractionGroup.prototype.back=function(){for(var e=this.head,t=e;null!=t;)e=t,t=t.next;return e.elt},t.util.ZNPList_ZPP_InteractionGroup.prototype.iterator_at=function(e){for(var t=this.head;e-- >0&&null!=t;)t=t.next;return t},t.util.ZNPList_ZPP_InteractionGroup.prototype.at=function(e){var t=this.iterator_at(e);return null!=t?t.elt:null},t.util.ZNPList_ZPP_InteractionGroup.prototype.__class__=t.util.ZNPList_ZPP_InteractionGroup,t.util.ZNPList_ZPP_ToiEvent=l["zpp_nape.util.ZNPList_ZPP_ToiEvent"]=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null},t.util.ZNPList_ZPP_ToiEvent.__name__=["zpp_nape","util","ZNPList_ZPP_ToiEvent"],t.util.ZNPList_ZPP_ToiEvent.prototype.head=null,t.util.ZNPList_ZPP_ToiEvent.prototype.begin=function(){return this.head},t.util.ZNPList_ZPP_ToiEvent.prototype.modified=null,t.util.ZNPList_ZPP_ToiEvent.prototype.pushmod=null,t.util.ZNPList_ZPP_ToiEvent.prototype.length=null,t.util.ZNPList_ZPP_ToiEvent.prototype.setbegin=function(e){this.head=e,this.modified=!0,this.pushmod=!0},t.util.ZNPList_ZPP_ToiEvent.prototype.add=function(e){var n;null==t.util.ZNPNode_ZPP_ToiEvent.zpp_pool?n=new t.util.ZNPNode_ZPP_ToiEvent:(n=t.util.ZNPNode_ZPP_ToiEvent.zpp_pool,t.util.ZNPNode_ZPP_ToiEvent.zpp_pool=n.next,n.next=null),n.elt=e;var i=n;return i.next=this.head,this.head=i,this.modified=!0,this.length++,e},t.util.ZNPList_ZPP_ToiEvent.prototype.inlined_add=function(e){var n;null==t.util.ZNPNode_ZPP_ToiEvent.zpp_pool?n=new t.util.ZNPNode_ZPP_ToiEvent:(n=t.util.ZNPNode_ZPP_ToiEvent.zpp_pool,t.util.ZNPNode_ZPP_ToiEvent.zpp_pool=n.next,n.next=null),n.elt=e;var i=n;return i.next=this.head,this.head=i,this.modified=!0,this.length++,e},t.util.ZNPList_ZPP_ToiEvent.prototype.addAll=function(e){for(var t=e.head;null!=t;){var n=t.elt;this.add(n),t=t.next}},t.util.ZNPList_ZPP_ToiEvent.prototype.insert=function(e,n){var i;null==t.util.ZNPNode_ZPP_ToiEvent.zpp_pool?i=new t.util.ZNPNode_ZPP_ToiEvent:(i=t.util.ZNPNode_ZPP_ToiEvent.zpp_pool,t.util.ZNPNode_ZPP_ToiEvent.zpp_pool=i.next,i.next=null),i.elt=n;var r=i;return null==e?(r.next=this.head,this.head=r):(r.next=e.next,e.next=r),this.pushmod=this.modified=!0,this.length++,r},t.util.ZNPList_ZPP_ToiEvent.prototype.inlined_insert=function(e,n){var i;null==t.util.ZNPNode_ZPP_ToiEvent.zpp_pool?i=new t.util.ZNPNode_ZPP_ToiEvent:(i=t.util.ZNPNode_ZPP_ToiEvent.zpp_pool,t.util.ZNPNode_ZPP_ToiEvent.zpp_pool=i.next,i.next=null),i.elt=n;var r=i;return null==e?(r.next=this.head,this.head=r):(r.next=e.next,e.next=r),this.pushmod=this.modified=!0,this.length++,r},t.util.ZNPList_ZPP_ToiEvent.prototype.pop=function(){var e=this.head;this.head=e.next;var n=e;n.elt=null,n.next=t.util.ZNPNode_ZPP_ToiEvent.zpp_pool,t.util.ZNPNode_ZPP_ToiEvent.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},t.util.ZNPList_ZPP_ToiEvent.prototype.inlined_pop=function(){var e=this.head;this.head=e.next;var n=e;n.elt=null,n.next=t.util.ZNPNode_ZPP_ToiEvent.zpp_pool,t.util.ZNPNode_ZPP_ToiEvent.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},t.util.ZNPList_ZPP_ToiEvent.prototype.pop_unsafe=function(){var e=this.head.elt;return this.pop(),e},t.util.ZNPList_ZPP_ToiEvent.prototype.inlined_pop_unsafe=function(){var e=this.head.elt;return this.pop(),e},t.util.ZNPList_ZPP_ToiEvent.prototype.remove=function(e){for(var n=null,i=this.head;null!=i;){if(i.elt==e){var r,o;null==n?(o=(r=this.head).next,this.head=o,null==this.head&&(this.pushmod=!0)):(o=(r=n.next).next,n.next=o,null==o&&(this.pushmod=!0));var a=r;a.elt=null,a.next=t.util.ZNPNode_ZPP_ToiEvent.zpp_pool,t.util.ZNPNode_ZPP_ToiEvent.zpp_pool=a,this.modified=!0,this.length--,this.pushmod=!0;break}n=i,i=i.next}},t.util.ZNPList_ZPP_ToiEvent.prototype.try_remove=function(e){for(var t=null,n=this.head,i=!1;null!=n;){if(n.elt==e){this.erase(t),i=!0;break}t=n,n=n.next}return i},t.util.ZNPList_ZPP_ToiEvent.prototype.inlined_remove=function(e){for(var n=null,i=this.head;null!=i;){if(i.elt==e){var r,o;null==n?(o=(r=this.head).next,this.head=o,null==this.head&&(this.pushmod=!0)):(o=(r=n.next).next,n.next=o,null==o&&(this.pushmod=!0));var a=r;a.elt=null,a.next=t.util.ZNPNode_ZPP_ToiEvent.zpp_pool,t.util.ZNPNode_ZPP_ToiEvent.zpp_pool=a,this.modified=!0,this.length--,this.pushmod=!0;break}n=i,i=i.next}},t.util.ZNPList_ZPP_ToiEvent.prototype.inlined_try_remove=function(e){for(var n=null,i=this.head,r=!1;null!=i;){if(i.elt==e){var o,a;null==n?(a=(o=this.head).next,this.head=a,null==this.head&&(this.pushmod=!0)):(a=(o=n.next).next,n.next=a,null==a&&(this.pushmod=!0));var s=o;s.elt=null,s.next=t.util.ZNPNode_ZPP_ToiEvent.zpp_pool,t.util.ZNPNode_ZPP_ToiEvent.zpp_pool=s,this.modified=!0,this.length--,this.pushmod=!0,r=!0;break}n=i,i=i.next}return r},t.util.ZNPList_ZPP_ToiEvent.prototype.erase=function(e){var n,i;null==e?(i=(n=this.head).next,this.head=i,null==this.head&&(this.pushmod=!0)):(i=(n=e.next).next,e.next=i,null==i&&(this.pushmod=!0));var r=n;return r.elt=null,r.next=t.util.ZNPNode_ZPP_ToiEvent.zpp_pool,t.util.ZNPNode_ZPP_ToiEvent.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,i},t.util.ZNPList_ZPP_ToiEvent.prototype.inlined_erase=function(e){var n,i;null==e?(i=(n=this.head).next,this.head=i,null==this.head&&(this.pushmod=!0)):(i=(n=e.next).next,e.next=i,null==i&&(this.pushmod=!0));var r=n;return r.elt=null,r.next=t.util.ZNPNode_ZPP_ToiEvent.zpp_pool,t.util.ZNPNode_ZPP_ToiEvent.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,i},t.util.ZNPList_ZPP_ToiEvent.prototype.splice=function(e,t){for(;t-- >0&&null!=e.next;)this.erase(e);return e.next},t.util.ZNPList_ZPP_ToiEvent.prototype.clear=function(){for(;null!=this.head;){var e=this.head;this.head=e.next;var n=e;n.elt=null,n.next=t.util.ZNPNode_ZPP_ToiEvent.zpp_pool,t.util.ZNPNode_ZPP_ToiEvent.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},t.util.ZNPList_ZPP_ToiEvent.prototype.inlined_clear=function(){for(;null!=this.head;){var e=this.head;this.head=e.next;var n=e;n.elt=null,n.next=t.util.ZNPNode_ZPP_ToiEvent.zpp_pool,t.util.ZNPNode_ZPP_ToiEvent.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},t.util.ZNPList_ZPP_ToiEvent.prototype.reverse=function(){for(var e=this.head,t=null;null!=e;){var n=e.next;e.next=t,this.head=e,t=e,e=n}this.modified=!0,this.pushmod=!0},t.util.ZNPList_ZPP_ToiEvent.prototype.empty=function(){return null==this.head},t.util.ZNPList_ZPP_ToiEvent.prototype.size=function(){return this.length},t.util.ZNPList_ZPP_ToiEvent.prototype.has=function(e){var t;t=!1;for(var n=this.head;null!=n;){if(n.elt==e){t=!0;break}n=n.next}return t},t.util.ZNPList_ZPP_ToiEvent.prototype.inlined_has=function(e){var t;t=!1;for(var n=this.head;null!=n;){if(n.elt==e){t=!0;break}n=n.next}return t},t.util.ZNPList_ZPP_ToiEvent.prototype.front=function(){return this.head.elt},t.util.ZNPList_ZPP_ToiEvent.prototype.back=function(){for(var e=this.head,t=e;null!=t;)e=t,t=t.next;return e.elt},t.util.ZNPList_ZPP_ToiEvent.prototype.iterator_at=function(e){for(var t=this.head;e-- >0&&null!=t;)t=t.next;return t},t.util.ZNPList_ZPP_ToiEvent.prototype.at=function(e){var t=this.iterator_at(e);return null!=t?t.elt:null},t.util.ZNPList_ZPP_ToiEvent.prototype.__class__=t.util.ZNPList_ZPP_ToiEvent,t.util.ZNPList_ConvexResult=l["zpp_nape.util.ZNPList_ConvexResult"]=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null},t.util.ZNPList_ConvexResult.__name__=["zpp_nape","util","ZNPList_ConvexResult"],t.util.ZNPList_ConvexResult.prototype.head=null,t.util.ZNPList_ConvexResult.prototype.begin=function(){return this.head},t.util.ZNPList_ConvexResult.prototype.modified=null,t.util.ZNPList_ConvexResult.prototype.pushmod=null,t.util.ZNPList_ConvexResult.prototype.length=null,t.util.ZNPList_ConvexResult.prototype.setbegin=function(e){this.head=e,this.modified=!0,this.pushmod=!0},t.util.ZNPList_ConvexResult.prototype.add=function(e){var n;null==t.util.ZNPNode_ConvexResult.zpp_pool?n=new t.util.ZNPNode_ConvexResult:(n=t.util.ZNPNode_ConvexResult.zpp_pool,t.util.ZNPNode_ConvexResult.zpp_pool=n.next,n.next=null),n.elt=e;var i=n;return i.next=this.head,this.head=i,this.modified=!0,this.length++,e},t.util.ZNPList_ConvexResult.prototype.inlined_add=function(e){var n;null==t.util.ZNPNode_ConvexResult.zpp_pool?n=new t.util.ZNPNode_ConvexResult:(n=t.util.ZNPNode_ConvexResult.zpp_pool,t.util.ZNPNode_ConvexResult.zpp_pool=n.next,n.next=null),n.elt=e;var i=n;return i.next=this.head,this.head=i,this.modified=!0,this.length++,e},t.util.ZNPList_ConvexResult.prototype.addAll=function(e){for(var t=e.head;null!=t;){var n=t.elt;this.add(n),t=t.next}},t.util.ZNPList_ConvexResult.prototype.insert=function(e,n){var i;null==t.util.ZNPNode_ConvexResult.zpp_pool?i=new t.util.ZNPNode_ConvexResult:(i=t.util.ZNPNode_ConvexResult.zpp_pool,t.util.ZNPNode_ConvexResult.zpp_pool=i.next,i.next=null),i.elt=n;var r=i;return null==e?(r.next=this.head,this.head=r):(r.next=e.next,e.next=r),this.pushmod=this.modified=!0,this.length++,r},t.util.ZNPList_ConvexResult.prototype.inlined_insert=function(e,n){var i;null==t.util.ZNPNode_ConvexResult.zpp_pool?i=new t.util.ZNPNode_ConvexResult:(i=t.util.ZNPNode_ConvexResult.zpp_pool,t.util.ZNPNode_ConvexResult.zpp_pool=i.next,i.next=null),i.elt=n;var r=i;return null==e?(r.next=this.head,this.head=r):(r.next=e.next,e.next=r),this.pushmod=this.modified=!0,this.length++,r},t.util.ZNPList_ConvexResult.prototype.pop=function(){var e=this.head;this.head=e.next;var n=e;n.elt=null,n.next=t.util.ZNPNode_ConvexResult.zpp_pool,t.util.ZNPNode_ConvexResult.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},t.util.ZNPList_ConvexResult.prototype.inlined_pop=function(){var e=this.head;this.head=e.next;var n=e;n.elt=null,n.next=t.util.ZNPNode_ConvexResult.zpp_pool,t.util.ZNPNode_ConvexResult.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},t.util.ZNPList_ConvexResult.prototype.pop_unsafe=function(){var e=this.head.elt;return this.pop(),e},t.util.ZNPList_ConvexResult.prototype.inlined_pop_unsafe=function(){var e=this.head.elt;return this.pop(),e},t.util.ZNPList_ConvexResult.prototype.remove=function(e){for(var n=null,i=this.head;null!=i;){if(i.elt==e){var r,o;null==n?(o=(r=this.head).next,this.head=o,null==this.head&&(this.pushmod=!0)):(o=(r=n.next).next,n.next=o,null==o&&(this.pushmod=!0));var a=r;a.elt=null,a.next=t.util.ZNPNode_ConvexResult.zpp_pool,t.util.ZNPNode_ConvexResult.zpp_pool=a,this.modified=!0,this.length--,this.pushmod=!0;break}n=i,i=i.next}},t.util.ZNPList_ConvexResult.prototype.try_remove=function(e){for(var t=null,n=this.head,i=!1;null!=n;){if(n.elt==e){this.erase(t),i=!0;break}t=n,n=n.next}return i},t.util.ZNPList_ConvexResult.prototype.inlined_remove=function(e){for(var n=null,i=this.head;null!=i;){if(i.elt==e){var r,o;null==n?(o=(r=this.head).next,this.head=o,null==this.head&&(this.pushmod=!0)):(o=(r=n.next).next,n.next=o,null==o&&(this.pushmod=!0));var a=r;a.elt=null,a.next=t.util.ZNPNode_ConvexResult.zpp_pool,t.util.ZNPNode_ConvexResult.zpp_pool=a,this.modified=!0,this.length--,this.pushmod=!0;break}n=i,i=i.next}},t.util.ZNPList_ConvexResult.prototype.inlined_try_remove=function(e){for(var n=null,i=this.head,r=!1;null!=i;){if(i.elt==e){var o,a;null==n?(a=(o=this.head).next,this.head=a,null==this.head&&(this.pushmod=!0)):(a=(o=n.next).next,n.next=a,null==a&&(this.pushmod=!0));var s=o;s.elt=null,s.next=t.util.ZNPNode_ConvexResult.zpp_pool,t.util.ZNPNode_ConvexResult.zpp_pool=s,this.modified=!0,this.length--,this.pushmod=!0,r=!0;break}n=i,i=i.next}return r},t.util.ZNPList_ConvexResult.prototype.erase=function(e){var n,i;null==e?(i=(n=this.head).next,this.head=i,null==this.head&&(this.pushmod=!0)):(i=(n=e.next).next,e.next=i,null==i&&(this.pushmod=!0));var r=n;return r.elt=null,r.next=t.util.ZNPNode_ConvexResult.zpp_pool,t.util.ZNPNode_ConvexResult.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,i},t.util.ZNPList_ConvexResult.prototype.inlined_erase=function(e){var n,i;null==e?(i=(n=this.head).next,this.head=i,null==this.head&&(this.pushmod=!0)):(i=(n=e.next).next,e.next=i,null==i&&(this.pushmod=!0));var r=n;return r.elt=null,r.next=t.util.ZNPNode_ConvexResult.zpp_pool,t.util.ZNPNode_ConvexResult.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,i},t.util.ZNPList_ConvexResult.prototype.splice=function(e,t){for(;t-- >0&&null!=e.next;)this.erase(e);return e.next},t.util.ZNPList_ConvexResult.prototype.clear=function(){for(;null!=this.head;){var e=this.head;this.head=e.next;var n=e;n.elt=null,n.next=t.util.ZNPNode_ConvexResult.zpp_pool,t.util.ZNPNode_ConvexResult.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},t.util.ZNPList_ConvexResult.prototype.inlined_clear=function(){for(;null!=this.head;){var e=this.head;this.head=e.next;var n=e;n.elt=null,n.next=t.util.ZNPNode_ConvexResult.zpp_pool,t.util.ZNPNode_ConvexResult.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},t.util.ZNPList_ConvexResult.prototype.reverse=function(){for(var e=this.head,t=null;null!=e;){var n=e.next;e.next=t,this.head=e,t=e,e=n}this.modified=!0,this.pushmod=!0},t.util.ZNPList_ConvexResult.prototype.empty=function(){return null==this.head},t.util.ZNPList_ConvexResult.prototype.size=function(){return this.length},t.util.ZNPList_ConvexResult.prototype.has=function(e){var t;t=!1;for(var n=this.head;null!=n;){if(n.elt==e){t=!0;break}n=n.next}return t},t.util.ZNPList_ConvexResult.prototype.inlined_has=function(e){var t;t=!1;for(var n=this.head;null!=n;){if(n.elt==e){t=!0;break}n=n.next}return t},t.util.ZNPList_ConvexResult.prototype.front=function(){return this.head.elt},t.util.ZNPList_ConvexResult.prototype.back=function(){for(var e=this.head,t=e;null!=t;)e=t,t=t.next;return e.elt},t.util.ZNPList_ConvexResult.prototype.iterator_at=function(e){for(var t=this.head;e-- >0&&null!=t;)t=t.next;return t},t.util.ZNPList_ConvexResult.prototype.at=function(e){var t=this.iterator_at(e);return null!=t?t.elt:null},t.util.ZNPList_ConvexResult.prototype.__class__=t.util.ZNPList_ConvexResult,t.util.ZNPList_ZPP_GeomPoly=l["zpp_nape.util.ZNPList_ZPP_GeomPoly"]=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null},t.util.ZNPList_ZPP_GeomPoly.__name__=["zpp_nape","util","ZNPList_ZPP_GeomPoly"],t.util.ZNPList_ZPP_GeomPoly.prototype.head=null,t.util.ZNPList_ZPP_GeomPoly.prototype.begin=function(){return this.head},t.util.ZNPList_ZPP_GeomPoly.prototype.modified=null,t.util.ZNPList_ZPP_GeomPoly.prototype.pushmod=null,t.util.ZNPList_ZPP_GeomPoly.prototype.length=null,t.util.ZNPList_ZPP_GeomPoly.prototype.setbegin=function(e){this.head=e,this.modified=!0,this.pushmod=!0},t.util.ZNPList_ZPP_GeomPoly.prototype.add=function(e){var n;null==t.util.ZNPNode_ZPP_GeomPoly.zpp_pool?n=new t.util.ZNPNode_ZPP_GeomPoly:(n=t.util.ZNPNode_ZPP_GeomPoly.zpp_pool,t.util.ZNPNode_ZPP_GeomPoly.zpp_pool=n.next,n.next=null),n.elt=e;var i=n;return i.next=this.head,this.head=i,this.modified=!0,this.length++,e},t.util.ZNPList_ZPP_GeomPoly.prototype.inlined_add=function(e){var n;null==t.util.ZNPNode_ZPP_GeomPoly.zpp_pool?n=new t.util.ZNPNode_ZPP_GeomPoly:(n=t.util.ZNPNode_ZPP_GeomPoly.zpp_pool,t.util.ZNPNode_ZPP_GeomPoly.zpp_pool=n.next,n.next=null),n.elt=e;var i=n;return i.next=this.head,this.head=i,this.modified=!0,this.length++,e},t.util.ZNPList_ZPP_GeomPoly.prototype.addAll=function(e){for(var t=e.head;null!=t;){var n=t.elt;this.add(n),t=t.next}},t.util.ZNPList_ZPP_GeomPoly.prototype.insert=function(e,n){var i;null==t.util.ZNPNode_ZPP_GeomPoly.zpp_pool?i=new t.util.ZNPNode_ZPP_GeomPoly:(i=t.util.ZNPNode_ZPP_GeomPoly.zpp_pool,t.util.ZNPNode_ZPP_GeomPoly.zpp_pool=i.next,i.next=null),i.elt=n;var r=i;return null==e?(r.next=this.head,this.head=r):(r.next=e.next,e.next=r),this.pushmod=this.modified=!0,this.length++,r},t.util.ZNPList_ZPP_GeomPoly.prototype.inlined_insert=function(e,n){var i;null==t.util.ZNPNode_ZPP_GeomPoly.zpp_pool?i=new t.util.ZNPNode_ZPP_GeomPoly:(i=t.util.ZNPNode_ZPP_GeomPoly.zpp_pool,t.util.ZNPNode_ZPP_GeomPoly.zpp_pool=i.next,i.next=null),i.elt=n;var r=i;return null==e?(r.next=this.head,this.head=r):(r.next=e.next,e.next=r),this.pushmod=this.modified=!0,this.length++,r},t.util.ZNPList_ZPP_GeomPoly.prototype.pop=function(){var e=this.head;this.head=e.next;var n=e;n.elt=null,n.next=t.util.ZNPNode_ZPP_GeomPoly.zpp_pool,t.util.ZNPNode_ZPP_GeomPoly.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},t.util.ZNPList_ZPP_GeomPoly.prototype.inlined_pop=function(){var e=this.head;this.head=e.next;var n=e;n.elt=null,n.next=t.util.ZNPNode_ZPP_GeomPoly.zpp_pool,t.util.ZNPNode_ZPP_GeomPoly.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},t.util.ZNPList_ZPP_GeomPoly.prototype.pop_unsafe=function(){var e=this.head.elt;return this.pop(),e},t.util.ZNPList_ZPP_GeomPoly.prototype.inlined_pop_unsafe=function(){var e=this.head.elt;return this.pop(),e},t.util.ZNPList_ZPP_GeomPoly.prototype.remove=function(e){for(var n=null,i=this.head;null!=i;){if(i.elt==e){var r,o;null==n?(o=(r=this.head).next,this.head=o,null==this.head&&(this.pushmod=!0)):(o=(r=n.next).next,n.next=o,null==o&&(this.pushmod=!0));var a=r;a.elt=null,a.next=t.util.ZNPNode_ZPP_GeomPoly.zpp_pool,t.util.ZNPNode_ZPP_GeomPoly.zpp_pool=a,this.modified=!0,this.length--,this.pushmod=!0;break}n=i,i=i.next}},t.util.ZNPList_ZPP_GeomPoly.prototype.try_remove=function(e){for(var t=null,n=this.head,i=!1;null!=n;){if(n.elt==e){this.erase(t),i=!0;break}t=n,n=n.next}return i},t.util.ZNPList_ZPP_GeomPoly.prototype.inlined_remove=function(e){for(var n=null,i=this.head;null!=i;){if(i.elt==e){var r,o;null==n?(o=(r=this.head).next,this.head=o,null==this.head&&(this.pushmod=!0)):(o=(r=n.next).next,n.next=o,null==o&&(this.pushmod=!0));var a=r;a.elt=null,a.next=t.util.ZNPNode_ZPP_GeomPoly.zpp_pool,t.util.ZNPNode_ZPP_GeomPoly.zpp_pool=a,this.modified=!0,this.length--,this.pushmod=!0;break}n=i,i=i.next}},t.util.ZNPList_ZPP_GeomPoly.prototype.inlined_try_remove=function(e){for(var n=null,i=this.head,r=!1;null!=i;){if(i.elt==e){var o,a;null==n?(a=(o=this.head).next,this.head=a,null==this.head&&(this.pushmod=!0)):(a=(o=n.next).next,n.next=a,null==a&&(this.pushmod=!0));var s=o;s.elt=null,s.next=t.util.ZNPNode_ZPP_GeomPoly.zpp_pool,t.util.ZNPNode_ZPP_GeomPoly.zpp_pool=s,this.modified=!0,this.length--,this.pushmod=!0,r=!0;break}n=i,i=i.next}return r},t.util.ZNPList_ZPP_GeomPoly.prototype.erase=function(e){var n,i;null==e?(i=(n=this.head).next,this.head=i,null==this.head&&(this.pushmod=!0)):(i=(n=e.next).next,e.next=i,null==i&&(this.pushmod=!0));var r=n;return r.elt=null,r.next=t.util.ZNPNode_ZPP_GeomPoly.zpp_pool,t.util.ZNPNode_ZPP_GeomPoly.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,i},t.util.ZNPList_ZPP_GeomPoly.prototype.inlined_erase=function(e){var n,i;null==e?(i=(n=this.head).next,this.head=i,null==this.head&&(this.pushmod=!0)):(i=(n=e.next).next,e.next=i,null==i&&(this.pushmod=!0));var r=n;return r.elt=null,r.next=t.util.ZNPNode_ZPP_GeomPoly.zpp_pool,t.util.ZNPNode_ZPP_GeomPoly.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,i},t.util.ZNPList_ZPP_GeomPoly.prototype.splice=function(e,t){for(;t-- >0&&null!=e.next;)this.erase(e);return e.next},t.util.ZNPList_ZPP_GeomPoly.prototype.clear=function(){for(;null!=this.head;){var e=this.head;this.head=e.next;var n=e;n.elt=null,n.next=t.util.ZNPNode_ZPP_GeomPoly.zpp_pool,t.util.ZNPNode_ZPP_GeomPoly.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},t.util.ZNPList_ZPP_GeomPoly.prototype.inlined_clear=function(){for(;null!=this.head;){var e=this.head;this.head=e.next;var n=e;n.elt=null,n.next=t.util.ZNPNode_ZPP_GeomPoly.zpp_pool,t.util.ZNPNode_ZPP_GeomPoly.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},t.util.ZNPList_ZPP_GeomPoly.prototype.reverse=function(){for(var e=this.head,t=null;null!=e;){var n=e.next;e.next=t,this.head=e,t=e,e=n}this.modified=!0,this.pushmod=!0},t.util.ZNPList_ZPP_GeomPoly.prototype.empty=function(){return null==this.head},t.util.ZNPList_ZPP_GeomPoly.prototype.size=function(){return this.length},t.util.ZNPList_ZPP_GeomPoly.prototype.has=function(e){var t;t=!1;for(var n=this.head;null!=n;){if(n.elt==e){t=!0;break}n=n.next}return t},t.util.ZNPList_ZPP_GeomPoly.prototype.inlined_has=function(e){var t;t=!1;for(var n=this.head;null!=n;){if(n.elt==e){t=!0;break}n=n.next}return t},t.util.ZNPList_ZPP_GeomPoly.prototype.front=function(){return this.head.elt},t.util.ZNPList_ZPP_GeomPoly.prototype.back=function(){for(var e=this.head,t=e;null!=t;)e=t,t=t.next;return e.elt},t.util.ZNPList_ZPP_GeomPoly.prototype.iterator_at=function(e){for(var t=this.head;e-- >0&&null!=t;)t=t.next;return t},t.util.ZNPList_ZPP_GeomPoly.prototype.at=function(e){var t=this.iterator_at(e);return null!=t?t.elt:null},t.util.ZNPList_ZPP_GeomPoly.prototype.__class__=t.util.ZNPList_ZPP_GeomPoly,t.util.ZNPList_RayResult=l["zpp_nape.util.ZNPList_RayResult"]=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null},t.util.ZNPList_RayResult.__name__=["zpp_nape","util","ZNPList_RayResult"],t.util.ZNPList_RayResult.prototype.head=null,t.util.ZNPList_RayResult.prototype.begin=function(){return this.head},t.util.ZNPList_RayResult.prototype.modified=null,t.util.ZNPList_RayResult.prototype.pushmod=null,t.util.ZNPList_RayResult.prototype.length=null,t.util.ZNPList_RayResult.prototype.setbegin=function(e){this.head=e,this.modified=!0,this.pushmod=!0},t.util.ZNPList_RayResult.prototype.add=function(e){var n;null==t.util.ZNPNode_RayResult.zpp_pool?n=new t.util.ZNPNode_RayResult:(n=t.util.ZNPNode_RayResult.zpp_pool,t.util.ZNPNode_RayResult.zpp_pool=n.next,n.next=null),n.elt=e;var i=n;return i.next=this.head,this.head=i,this.modified=!0,this.length++,e},t.util.ZNPList_RayResult.prototype.inlined_add=function(e){var n;null==t.util.ZNPNode_RayResult.zpp_pool?n=new t.util.ZNPNode_RayResult:(n=t.util.ZNPNode_RayResult.zpp_pool,t.util.ZNPNode_RayResult.zpp_pool=n.next,n.next=null),n.elt=e;var i=n;return i.next=this.head,this.head=i,this.modified=!0,this.length++,e},t.util.ZNPList_RayResult.prototype.addAll=function(e){for(var t=e.head;null!=t;){var n=t.elt;this.add(n),t=t.next}},t.util.ZNPList_RayResult.prototype.insert=function(e,n){var i;null==t.util.ZNPNode_RayResult.zpp_pool?i=new t.util.ZNPNode_RayResult:(i=t.util.ZNPNode_RayResult.zpp_pool,t.util.ZNPNode_RayResult.zpp_pool=i.next,i.next=null),i.elt=n;var r=i;return null==e?(r.next=this.head,this.head=r):(r.next=e.next,e.next=r),this.pushmod=this.modified=!0,this.length++,r},t.util.ZNPList_RayResult.prototype.inlined_insert=function(e,n){var i;null==t.util.ZNPNode_RayResult.zpp_pool?i=new t.util.ZNPNode_RayResult:(i=t.util.ZNPNode_RayResult.zpp_pool,t.util.ZNPNode_RayResult.zpp_pool=i.next,i.next=null),i.elt=n;var r=i;return null==e?(r.next=this.head,this.head=r):(r.next=e.next,e.next=r),this.pushmod=this.modified=!0,this.length++,r},t.util.ZNPList_RayResult.prototype.pop=function(){var e=this.head;this.head=e.next;var n=e;n.elt=null,n.next=t.util.ZNPNode_RayResult.zpp_pool,t.util.ZNPNode_RayResult.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},t.util.ZNPList_RayResult.prototype.inlined_pop=function(){var e=this.head;this.head=e.next;var n=e;n.elt=null,n.next=t.util.ZNPNode_RayResult.zpp_pool,t.util.ZNPNode_RayResult.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},t.util.ZNPList_RayResult.prototype.pop_unsafe=function(){var e=this.head.elt;return this.pop(),e},t.util.ZNPList_RayResult.prototype.inlined_pop_unsafe=function(){var e=this.head.elt;return this.pop(),e},t.util.ZNPList_RayResult.prototype.remove=function(e){for(var n=null,i=this.head;null!=i;){if(i.elt==e){var r,o;null==n?(o=(r=this.head).next,this.head=o,null==this.head&&(this.pushmod=!0)):(o=(r=n.next).next,n.next=o,null==o&&(this.pushmod=!0));var a=r;a.elt=null,a.next=t.util.ZNPNode_RayResult.zpp_pool,t.util.ZNPNode_RayResult.zpp_pool=a,this.modified=!0,this.length--,this.pushmod=!0;break}n=i,i=i.next}},t.util.ZNPList_RayResult.prototype.try_remove=function(e){for(var t=null,n=this.head,i=!1;null!=n;){if(n.elt==e){this.erase(t),i=!0;break}t=n,n=n.next}return i},t.util.ZNPList_RayResult.prototype.inlined_remove=function(e){for(var n=null,i=this.head;null!=i;){if(i.elt==e){var r,o;null==n?(o=(r=this.head).next,this.head=o,null==this.head&&(this.pushmod=!0)):(o=(r=n.next).next,n.next=o,null==o&&(this.pushmod=!0));var a=r;a.elt=null,a.next=t.util.ZNPNode_RayResult.zpp_pool,t.util.ZNPNode_RayResult.zpp_pool=a,this.modified=!0,this.length--,this.pushmod=!0;break}n=i,i=i.next}},t.util.ZNPList_RayResult.prototype.inlined_try_remove=function(e){for(var n=null,i=this.head,r=!1;null!=i;){if(i.elt==e){var o,a;null==n?(a=(o=this.head).next,this.head=a,null==this.head&&(this.pushmod=!0)):(a=(o=n.next).next,n.next=a,null==a&&(this.pushmod=!0));var s=o;s.elt=null,s.next=t.util.ZNPNode_RayResult.zpp_pool,t.util.ZNPNode_RayResult.zpp_pool=s,this.modified=!0,this.length--,this.pushmod=!0,r=!0;break}n=i,i=i.next}return r},t.util.ZNPList_RayResult.prototype.erase=function(e){var n,i;null==e?(i=(n=this.head).next,this.head=i,null==this.head&&(this.pushmod=!0)):(i=(n=e.next).next,e.next=i,null==i&&(this.pushmod=!0));var r=n;return r.elt=null,r.next=t.util.ZNPNode_RayResult.zpp_pool,t.util.ZNPNode_RayResult.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,i},t.util.ZNPList_RayResult.prototype.inlined_erase=function(e){var n,i;null==e?(i=(n=this.head).next,this.head=i,null==this.head&&(this.pushmod=!0)):(i=(n=e.next).next,e.next=i,null==i&&(this.pushmod=!0));var r=n;return r.elt=null,r.next=t.util.ZNPNode_RayResult.zpp_pool,t.util.ZNPNode_RayResult.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,i},t.util.ZNPList_RayResult.prototype.splice=function(e,t){for(;t-- >0&&null!=e.next;)this.erase(e);return e.next},t.util.ZNPList_RayResult.prototype.clear=function(){for(;null!=this.head;){var e=this.head;this.head=e.next;var n=e;n.elt=null,n.next=t.util.ZNPNode_RayResult.zpp_pool,t.util.ZNPNode_RayResult.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},t.util.ZNPList_RayResult.prototype.inlined_clear=function(){for(;null!=this.head;){var e=this.head;this.head=e.next;var n=e;n.elt=null,n.next=t.util.ZNPNode_RayResult.zpp_pool,t.util.ZNPNode_RayResult.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},t.util.ZNPList_RayResult.prototype.reverse=function(){for(var e=this.head,t=null;null!=e;){var n=e.next;e.next=t,this.head=e,t=e,e=n}this.modified=!0,this.pushmod=!0},t.util.ZNPList_RayResult.prototype.empty=function(){return null==this.head},t.util.ZNPList_RayResult.prototype.size=function(){return this.length},t.util.ZNPList_RayResult.prototype.has=function(e){var t;t=!1;for(var n=this.head;null!=n;){if(n.elt==e){t=!0;break}n=n.next}return t},t.util.ZNPList_RayResult.prototype.inlined_has=function(e){var t;t=!1;for(var n=this.head;null!=n;){if(n.elt==e){t=!0;break}n=n.next}return t},t.util.ZNPList_RayResult.prototype.front=function(){return this.head.elt},t.util.ZNPList_RayResult.prototype.back=function(){for(var e=this.head,t=e;null!=t;)e=t,t=t.next;return e.elt},t.util.ZNPList_RayResult.prototype.iterator_at=function(e){for(var t=this.head;e-- >0&&null!=t;)t=t.next;return t},t.util.ZNPList_RayResult.prototype.at=function(e){var t=this.iterator_at(e);return null!=t?t.elt:null},t.util.ZNPList_RayResult.prototype.__class__=t.util.ZNPList_RayResult,t.util.ZNPNode_ZPP_CbType=l["zpp_nape.util.ZNPNode_ZPP_CbType"]=function(){this.elt=null,this.next=null},t.util.ZNPNode_ZPP_CbType.__name__=["zpp_nape","util","ZNPNode_ZPP_CbType"],t.util.ZNPNode_ZPP_CbType.prototype.next=null,t.util.ZNPNode_ZPP_CbType.prototype.alloc=function(){},t.util.ZNPNode_ZPP_CbType.prototype.free=function(){this.elt=null},t.util.ZNPNode_ZPP_CbType.prototype.elt=null,t.util.ZNPNode_ZPP_CbType.prototype.elem=function(){return this.elt},t.util.ZNPNode_ZPP_CbType.prototype.__class__=t.util.ZNPNode_ZPP_CbType,t.util.ZNPNode_ZPP_CallbackSet=l["zpp_nape.util.ZNPNode_ZPP_CallbackSet"]=function(){this.elt=null,this.next=null},t.util.ZNPNode_ZPP_CallbackSet.__name__=["zpp_nape","util","ZNPNode_ZPP_CallbackSet"],t.util.ZNPNode_ZPP_CallbackSet.prototype.next=null,t.util.ZNPNode_ZPP_CallbackSet.prototype.alloc=function(){},t.util.ZNPNode_ZPP_CallbackSet.prototype.free=function(){this.elt=null},t.util.ZNPNode_ZPP_CallbackSet.prototype.elt=null,t.util.ZNPNode_ZPP_CallbackSet.prototype.elem=function(){return this.elt},t.util.ZNPNode_ZPP_CallbackSet.prototype.__class__=t.util.ZNPNode_ZPP_CallbackSet,t.util.ZNPNode_ZPP_Shape=l["zpp_nape.util.ZNPNode_ZPP_Shape"]=function(){this.elt=null,this.next=null},t.util.ZNPNode_ZPP_Shape.__name__=["zpp_nape","util","ZNPNode_ZPP_Shape"],t.util.ZNPNode_ZPP_Shape.prototype.next=null,t.util.ZNPNode_ZPP_Shape.prototype.alloc=function(){},t.util.ZNPNode_ZPP_Shape.prototype.free=function(){this.elt=null},t.util.ZNPNode_ZPP_Shape.prototype.elt=null,t.util.ZNPNode_ZPP_Shape.prototype.elem=function(){return this.elt},t.util.ZNPNode_ZPP_Shape.prototype.__class__=t.util.ZNPNode_ZPP_Shape,t.util.ZNPNode_ZPP_Body=l["zpp_nape.util.ZNPNode_ZPP_Body"]=function(){this.elt=null,this.next=null},t.util.ZNPNode_ZPP_Body.__name__=["zpp_nape","util","ZNPNode_ZPP_Body"],t.util.ZNPNode_ZPP_Body.prototype.next=null,t.util.ZNPNode_ZPP_Body.prototype.alloc=function(){},t.util.ZNPNode_ZPP_Body.prototype.free=function(){this.elt=null},t.util.ZNPNode_ZPP_Body.prototype.elt=null,t.util.ZNPNode_ZPP_Body.prototype.elem=function(){return this.elt},t.util.ZNPNode_ZPP_Body.prototype.__class__=t.util.ZNPNode_ZPP_Body,t.util.ZNPNode_ZPP_Constraint=l["zpp_nape.util.ZNPNode_ZPP_Constraint"]=function(){this.elt=null,this.next=null},t.util.ZNPNode_ZPP_Constraint.__name__=["zpp_nape","util","ZNPNode_ZPP_Constraint"],t.util.ZNPNode_ZPP_Constraint.prototype.next=null,t.util.ZNPNode_ZPP_Constraint.prototype.alloc=function(){},t.util.ZNPNode_ZPP_Constraint.prototype.free=function(){this.elt=null},t.util.ZNPNode_ZPP_Constraint.prototype.elt=null,t.util.ZNPNode_ZPP_Constraint.prototype.elem=function(){return this.elt},t.util.ZNPNode_ZPP_Constraint.prototype.__class__=t.util.ZNPNode_ZPP_Constraint,t.util.ZNPNode_ZPP_Compound=l["zpp_nape.util.ZNPNode_ZPP_Compound"]=function(){this.elt=null,this.next=null},t.util.ZNPNode_ZPP_Compound.__name__=["zpp_nape","util","ZNPNode_ZPP_Compound"],t.util.ZNPNode_ZPP_Compound.prototype.next=null,t.util.ZNPNode_ZPP_Compound.prototype.alloc=function(){},t.util.ZNPNode_ZPP_Compound.prototype.free=function(){this.elt=null},t.util.ZNPNode_ZPP_Compound.prototype.elt=null,t.util.ZNPNode_ZPP_Compound.prototype.elem=function(){return this.elt},t.util.ZNPNode_ZPP_Compound.prototype.__class__=t.util.ZNPNode_ZPP_Compound,t.util.ZNPNode_ZPP_Arbiter=l["zpp_nape.util.ZNPNode_ZPP_Arbiter"]=function(){this.elt=null,this.next=null},t.util.ZNPNode_ZPP_Arbiter.__name__=["zpp_nape","util","ZNPNode_ZPP_Arbiter"],t.util.ZNPNode_ZPP_Arbiter.prototype.next=null,t.util.ZNPNode_ZPP_Arbiter.prototype.alloc=function(){},t.util.ZNPNode_ZPP_Arbiter.prototype.free=function(){this.elt=null},t.util.ZNPNode_ZPP_Arbiter.prototype.elt=null,t.util.ZNPNode_ZPP_Arbiter.prototype.elem=function(){return this.elt},t.util.ZNPNode_ZPP_Arbiter.prototype.__class__=t.util.ZNPNode_ZPP_Arbiter,t.util.ZNPNode_ZPP_InteractionListener=l["zpp_nape.util.ZNPNode_ZPP_InteractionListener"]=function(){this.elt=null,this.next=null},t.util.ZNPNode_ZPP_InteractionListener.__name__=["zpp_nape","util","ZNPNode_ZPP_InteractionListener"],t.util.ZNPNode_ZPP_InteractionListener.prototype.next=null,t.util.ZNPNode_ZPP_InteractionListener.prototype.alloc=function(){},t.util.ZNPNode_ZPP_InteractionListener.prototype.free=function(){this.elt=null},t.util.ZNPNode_ZPP_InteractionListener.prototype.elt=null,t.util.ZNPNode_ZPP_InteractionListener.prototype.elem=function(){return this.elt},t.util.ZNPNode_ZPP_InteractionListener.prototype.__class__=t.util.ZNPNode_ZPP_InteractionListener,t.util.ZNPNode_ZPP_CbSet=l["zpp_nape.util.ZNPNode_ZPP_CbSet"]=function(){this.elt=null,this.next=null},t.util.ZNPNode_ZPP_CbSet.__name__=["zpp_nape","util","ZNPNode_ZPP_CbSet"],t.util.ZNPNode_ZPP_CbSet.prototype.next=null,t.util.ZNPNode_ZPP_CbSet.prototype.alloc=function(){},t.util.ZNPNode_ZPP_CbSet.prototype.free=function(){this.elt=null},t.util.ZNPNode_ZPP_CbSet.prototype.elt=null,t.util.ZNPNode_ZPP_CbSet.prototype.elem=function(){return this.elt},t.util.ZNPNode_ZPP_CbSet.prototype.__class__=t.util.ZNPNode_ZPP_CbSet,t.util.ZNPNode_ZPP_Interactor=l["zpp_nape.util.ZNPNode_ZPP_Interactor"]=function(){this.elt=null,this.next=null},t.util.ZNPNode_ZPP_Interactor.__name__=["zpp_nape","util","ZNPNode_ZPP_Interactor"],t.util.ZNPNode_ZPP_Interactor.prototype.next=null,t.util.ZNPNode_ZPP_Interactor.prototype.alloc=function(){},t.util.ZNPNode_ZPP_Interactor.prototype.free=function(){this.elt=null},t.util.ZNPNode_ZPP_Interactor.prototype.elt=null,t.util.ZNPNode_ZPP_Interactor.prototype.elem=function(){return this.elt},t.util.ZNPNode_ZPP_Interactor.prototype.__class__=t.util.ZNPNode_ZPP_Interactor,t.util.ZNPNode_ZPP_BodyListener=l["zpp_nape.util.ZNPNode_ZPP_BodyListener"]=function(){this.elt=null,this.next=null},t.util.ZNPNode_ZPP_BodyListener.__name__=["zpp_nape","util","ZNPNode_ZPP_BodyListener"],t.util.ZNPNode_ZPP_BodyListener.prototype.next=null,t.util.ZNPNode_ZPP_BodyListener.prototype.alloc=function(){},t.util.ZNPNode_ZPP_BodyListener.prototype.free=function(){this.elt=null},t.util.ZNPNode_ZPP_BodyListener.prototype.elt=null,t.util.ZNPNode_ZPP_BodyListener.prototype.elem=function(){return this.elt},t.util.ZNPNode_ZPP_BodyListener.prototype.__class__=t.util.ZNPNode_ZPP_BodyListener,t.util.ZNPNode_ZPP_CbSetPair=l["zpp_nape.util.ZNPNode_ZPP_CbSetPair"]=function(){this.elt=null,this.next=null},t.util.ZNPNode_ZPP_CbSetPair.__name__=["zpp_nape","util","ZNPNode_ZPP_CbSetPair"],t.util.ZNPNode_ZPP_CbSetPair.prototype.next=null,t.util.ZNPNode_ZPP_CbSetPair.prototype.alloc=function(){},t.util.ZNPNode_ZPP_CbSetPair.prototype.free=function(){this.elt=null},t.util.ZNPNode_ZPP_CbSetPair.prototype.elt=null,t.util.ZNPNode_ZPP_CbSetPair.prototype.elem=function(){return this.elt},t.util.ZNPNode_ZPP_CbSetPair.prototype.__class__=t.util.ZNPNode_ZPP_CbSetPair,t.util.ZNPNode_ZPP_ConstraintListener=l["zpp_nape.util.ZNPNode_ZPP_ConstraintListener"]=function(){this.elt=null,this.next=null},t.util.ZNPNode_ZPP_ConstraintListener.__name__=["zpp_nape","util","ZNPNode_ZPP_ConstraintListener"],t.util.ZNPNode_ZPP_ConstraintListener.prototype.next=null,t.util.ZNPNode_ZPP_ConstraintListener.prototype.alloc=function(){},t.util.ZNPNode_ZPP_ConstraintListener.prototype.free=function(){this.elt=null},t.util.ZNPNode_ZPP_ConstraintListener.prototype.elt=null,t.util.ZNPNode_ZPP_ConstraintListener.prototype.elem=function(){return this.elt},t.util.ZNPNode_ZPP_ConstraintListener.prototype.__class__=t.util.ZNPNode_ZPP_ConstraintListener,t.util.ZNPNode_ZPP_CutInt=l["zpp_nape.util.ZNPNode_ZPP_CutInt"]=function(){this.elt=null,this.next=null},t.util.ZNPNode_ZPP_CutInt.__name__=["zpp_nape","util","ZNPNode_ZPP_CutInt"],t.util.ZNPNode_ZPP_CutInt.prototype.next=null,t.util.ZNPNode_ZPP_CutInt.prototype.alloc=function(){},t.util.ZNPNode_ZPP_CutInt.prototype.free=function(){this.elt=null},t.util.ZNPNode_ZPP_CutInt.prototype.elt=null,t.util.ZNPNode_ZPP_CutInt.prototype.elem=function(){return this.elt},t.util.ZNPNode_ZPP_CutInt.prototype.__class__=t.util.ZNPNode_ZPP_CutInt,t.util.ZNPNode_ZPP_CutVert=l["zpp_nape.util.ZNPNode_ZPP_CutVert"]=function(){this.elt=null,this.next=null},t.util.ZNPNode_ZPP_CutVert.__name__=["zpp_nape","util","ZNPNode_ZPP_CutVert"],t.util.ZNPNode_ZPP_CutVert.prototype.next=null,t.util.ZNPNode_ZPP_CutVert.prototype.alloc=function(){},t.util.ZNPNode_ZPP_CutVert.prototype.free=function(){this.elt=null},t.util.ZNPNode_ZPP_CutVert.prototype.elt=null,t.util.ZNPNode_ZPP_CutVert.prototype.elem=function(){return this.elt},t.util.ZNPNode_ZPP_CutVert.prototype.__class__=t.util.ZNPNode_ZPP_CutVert,t.util.ZNPNode_ZPP_PartitionVertex=l["zpp_nape.util.ZNPNode_ZPP_PartitionVertex"]=function(){this.elt=null,this.next=null},t.util.ZNPNode_ZPP_PartitionVertex.__name__=["zpp_nape","util","ZNPNode_ZPP_PartitionVertex"],t.util.ZNPNode_ZPP_PartitionVertex.prototype.next=null,t.util.ZNPNode_ZPP_PartitionVertex.prototype.alloc=function(){},t.util.ZNPNode_ZPP_PartitionVertex.prototype.free=function(){this.elt=null},t.util.ZNPNode_ZPP_PartitionVertex.prototype.elt=null,t.util.ZNPNode_ZPP_PartitionVertex.prototype.elem=function(){return this.elt},t.util.ZNPNode_ZPP_PartitionVertex.prototype.__class__=t.util.ZNPNode_ZPP_PartitionVertex,t.util.ZNPNode_ZPP_SimplifyP=l["zpp_nape.util.ZNPNode_ZPP_SimplifyP"]=function(){this.elt=null,this.next=null},t.util.ZNPNode_ZPP_SimplifyP.__name__=["zpp_nape","util","ZNPNode_ZPP_SimplifyP"],t.util.ZNPNode_ZPP_SimplifyP.prototype.next=null,t.util.ZNPNode_ZPP_SimplifyP.prototype.alloc=function(){},t.util.ZNPNode_ZPP_SimplifyP.prototype.free=function(){this.elt=null},t.util.ZNPNode_ZPP_SimplifyP.prototype.elt=null,t.util.ZNPNode_ZPP_SimplifyP.prototype.elem=function(){return this.elt},t.util.ZNPNode_ZPP_SimplifyP.prototype.__class__=t.util.ZNPNode_ZPP_SimplifyP,t.util.ZNPNode_ZPP_PartitionedPoly=l["zpp_nape.util.ZNPNode_ZPP_PartitionedPoly"]=function(){this.elt=null,this.next=null},t.util.ZNPNode_ZPP_PartitionedPoly.__name__=["zpp_nape","util","ZNPNode_ZPP_PartitionedPoly"],t.util.ZNPNode_ZPP_PartitionedPoly.prototype.next=null,t.util.ZNPNode_ZPP_PartitionedPoly.prototype.alloc=function(){},t.util.ZNPNode_ZPP_PartitionedPoly.prototype.free=function(){this.elt=null},t.util.ZNPNode_ZPP_PartitionedPoly.prototype.elt=null,t.util.ZNPNode_ZPP_PartitionedPoly.prototype.elem=function(){return this.elt},t.util.ZNPNode_ZPP_PartitionedPoly.prototype.__class__=t.util.ZNPNode_ZPP_PartitionedPoly,t.util.ZNPNode_ZPP_GeomVert=l["zpp_nape.util.ZNPNode_ZPP_GeomVert"]=function(){this.elt=null,this.next=null},t.util.ZNPNode_ZPP_GeomVert.__name__=["zpp_nape","util","ZNPNode_ZPP_GeomVert"],t.util.ZNPNode_ZPP_GeomVert.prototype.next=null,t.util.ZNPNode_ZPP_GeomVert.prototype.alloc=function(){},t.util.ZNPNode_ZPP_GeomVert.prototype.free=function(){this.elt=null},t.util.ZNPNode_ZPP_GeomVert.prototype.elt=null,t.util.ZNPNode_ZPP_GeomVert.prototype.elem=function(){return this.elt},t.util.ZNPNode_ZPP_GeomVert.prototype.__class__=t.util.ZNPNode_ZPP_GeomVert,t.util.ZNPNode_ZPP_SimpleVert=l["zpp_nape.util.ZNPNode_ZPP_SimpleVert"]=function(){this.elt=null,this.next=null},t.util.ZNPNode_ZPP_SimpleVert.__name__=["zpp_nape","util","ZNPNode_ZPP_SimpleVert"],t.util.ZNPNode_ZPP_SimpleVert.prototype.next=null,t.util.ZNPNode_ZPP_SimpleVert.prototype.alloc=function(){},t.util.ZNPNode_ZPP_SimpleVert.prototype.free=function(){this.elt=null},t.util.ZNPNode_ZPP_SimpleVert.prototype.elt=null,t.util.ZNPNode_ZPP_SimpleVert.prototype.elem=function(){return this.elt},t.util.ZNPNode_ZPP_SimpleVert.prototype.__class__=t.util.ZNPNode_ZPP_SimpleVert,t.util.ZNPNode_ZPP_SimpleEvent=l["zpp_nape.util.ZNPNode_ZPP_SimpleEvent"]=function(){this.elt=null,this.next=null},t.util.ZNPNode_ZPP_SimpleEvent.__name__=["zpp_nape","util","ZNPNode_ZPP_SimpleEvent"],t.util.ZNPNode_ZPP_SimpleEvent.prototype.next=null,t.util.ZNPNode_ZPP_SimpleEvent.prototype.alloc=function(){},t.util.ZNPNode_ZPP_SimpleEvent.prototype.free=function(){this.elt=null},t.util.ZNPNode_ZPP_SimpleEvent.prototype.elt=null,t.util.ZNPNode_ZPP_SimpleEvent.prototype.elem=function(){return this.elt},t.util.ZNPNode_ZPP_SimpleEvent.prototype.__class__=t.util.ZNPNode_ZPP_SimpleEvent,t.util.ZNPNode_ZPP_Vec2=l["zpp_nape.util.ZNPNode_ZPP_Vec2"]=function(){this.elt=null,this.next=null},t.util.ZNPNode_ZPP_Vec2.__name__=["zpp_nape","util","ZNPNode_ZPP_Vec2"],t.util.ZNPNode_ZPP_Vec2.prototype.next=null,t.util.ZNPNode_ZPP_Vec2.prototype.alloc=function(){},t.util.ZNPNode_ZPP_Vec2.prototype.free=function(){this.elt=null},t.util.ZNPNode_ZPP_Vec2.prototype.elt=null,t.util.ZNPNode_ZPP_Vec2.prototype.elem=function(){return this.elt},t.util.ZNPNode_ZPP_Vec2.prototype.__class__=t.util.ZNPNode_ZPP_Vec2,t.util.ZNPNode_ZPP_AABBPair=l["zpp_nape.util.ZNPNode_ZPP_AABBPair"]=function(){this.elt=null,this.next=null},t.util.ZNPNode_ZPP_AABBPair.__name__=["zpp_nape","util","ZNPNode_ZPP_AABBPair"],t.util.ZNPNode_ZPP_AABBPair.prototype.next=null,t.util.ZNPNode_ZPP_AABBPair.prototype.alloc=function(){},t.util.ZNPNode_ZPP_AABBPair.prototype.free=function(){this.elt=null},t.util.ZNPNode_ZPP_AABBPair.prototype.elt=null,t.util.ZNPNode_ZPP_AABBPair.prototype.elem=function(){return this.elt},t.util.ZNPNode_ZPP_AABBPair.prototype.__class__=t.util.ZNPNode_ZPP_AABBPair,t.util.ZNPNode_ZPP_Edge=l["zpp_nape.util.ZNPNode_ZPP_Edge"]=function(){this.elt=null,this.next=null},t.util.ZNPNode_ZPP_Edge.__name__=["zpp_nape","util","ZNPNode_ZPP_Edge"],t.util.ZNPNode_ZPP_Edge.prototype.next=null,t.util.ZNPNode_ZPP_Edge.prototype.alloc=function(){},t.util.ZNPNode_ZPP_Edge.prototype.free=function(){this.elt=null},t.util.ZNPNode_ZPP_Edge.prototype.elt=null,t.util.ZNPNode_ZPP_Edge.prototype.elem=function(){return this.elt},t.util.ZNPNode_ZPP_Edge.prototype.__class__=t.util.ZNPNode_ZPP_Edge,t.util.ZNPNode_ZPP_AABBNode=l["zpp_nape.util.ZNPNode_ZPP_AABBNode"]=function(){this.elt=null,this.next=null},t.util.ZNPNode_ZPP_AABBNode.__name__=["zpp_nape","util","ZNPNode_ZPP_AABBNode"],t.util.ZNPNode_ZPP_AABBNode.prototype.next=null,t.util.ZNPNode_ZPP_AABBNode.prototype.alloc=function(){},t.util.ZNPNode_ZPP_AABBNode.prototype.free=function(){this.elt=null},t.util.ZNPNode_ZPP_AABBNode.prototype.elt=null,t.util.ZNPNode_ZPP_AABBNode.prototype.elem=function(){return this.elt},t.util.ZNPNode_ZPP_AABBNode.prototype.__class__=t.util.ZNPNode_ZPP_AABBNode,t.util.ZNPNode_ZPP_Component=l["zpp_nape.util.ZNPNode_ZPP_Component"]=function(){this.elt=null,this.next=null},t.util.ZNPNode_ZPP_Component.__name__=["zpp_nape","util","ZNPNode_ZPP_Component"],t.util.ZNPNode_ZPP_Component.prototype.next=null,t.util.ZNPNode_ZPP_Component.prototype.alloc=function(){},t.util.ZNPNode_ZPP_Component.prototype.free=function(){this.elt=null},t.util.ZNPNode_ZPP_Component.prototype.elt=null,t.util.ZNPNode_ZPP_Component.prototype.elem=function(){return this.elt},t.util.ZNPNode_ZPP_Component.prototype.__class__=t.util.ZNPNode_ZPP_Component,t.util.ZNPNode_ZPP_FluidArbiter=l["zpp_nape.util.ZNPNode_ZPP_FluidArbiter"]=function(){this.elt=null,this.next=null},t.util.ZNPNode_ZPP_FluidArbiter.__name__=["zpp_nape","util","ZNPNode_ZPP_FluidArbiter"],t.util.ZNPNode_ZPP_FluidArbiter.prototype.next=null,t.util.ZNPNode_ZPP_FluidArbiter.prototype.alloc=function(){},t.util.ZNPNode_ZPP_FluidArbiter.prototype.free=function(){this.elt=null},t.util.ZNPNode_ZPP_FluidArbiter.prototype.elt=null,t.util.ZNPNode_ZPP_FluidArbiter.prototype.elem=function(){return this.elt},t.util.ZNPNode_ZPP_FluidArbiter.prototype.__class__=t.util.ZNPNode_ZPP_FluidArbiter,t.util.ZNPNode_ZPP_SensorArbiter=l["zpp_nape.util.ZNPNode_ZPP_SensorArbiter"]=function(){this.elt=null,this.next=null},t.util.ZNPNode_ZPP_SensorArbiter.__name__=["zpp_nape","util","ZNPNode_ZPP_SensorArbiter"],t.util.ZNPNode_ZPP_SensorArbiter.prototype.next=null,t.util.ZNPNode_ZPP_SensorArbiter.prototype.alloc=function(){},t.util.ZNPNode_ZPP_SensorArbiter.prototype.free=function(){this.elt=null},t.util.ZNPNode_ZPP_SensorArbiter.prototype.elt=null,t.util.ZNPNode_ZPP_SensorArbiter.prototype.elem=function(){return this.elt},t.util.ZNPNode_ZPP_SensorArbiter.prototype.__class__=t.util.ZNPNode_ZPP_SensorArbiter,t.util.ZNPNode_ZPP_Listener=l["zpp_nape.util.ZNPNode_ZPP_Listener"]=function(){this.elt=null,this.next=null},t.util.ZNPNode_ZPP_Listener.__name__=["zpp_nape","util","ZNPNode_ZPP_Listener"],t.util.ZNPNode_ZPP_Listener.prototype.next=null,t.util.ZNPNode_ZPP_Listener.prototype.alloc=function(){},t.util.ZNPNode_ZPP_Listener.prototype.free=function(){this.elt=null},t.util.ZNPNode_ZPP_Listener.prototype.elt=null,t.util.ZNPNode_ZPP_Listener.prototype.elem=function(){return this.elt},t.util.ZNPNode_ZPP_Listener.prototype.__class__=t.util.ZNPNode_ZPP_Listener,t.util.ZNPNode_ZPP_ColArbiter=l["zpp_nape.util.ZNPNode_ZPP_ColArbiter"]=function(){this.elt=null,this.next=null},t.util.ZNPNode_ZPP_ColArbiter.__name__=["zpp_nape","util","ZNPNode_ZPP_ColArbiter"],t.util.ZNPNode_ZPP_ColArbiter.prototype.next=null,t.util.ZNPNode_ZPP_ColArbiter.prototype.alloc=function(){},t.util.ZNPNode_ZPP_ColArbiter.prototype.free=function(){this.elt=null},t.util.ZNPNode_ZPP_ColArbiter.prototype.elt=null,t.util.ZNPNode_ZPP_ColArbiter.prototype.elem=function(){return this.elt},t.util.ZNPNode_ZPP_ColArbiter.prototype.__class__=t.util.ZNPNode_ZPP_ColArbiter,t.util.ZNPNode_ZPP_InteractionGroup=l["zpp_nape.util.ZNPNode_ZPP_InteractionGroup"]=function(){this.elt=null,this.next=null},t.util.ZNPNode_ZPP_InteractionGroup.__name__=["zpp_nape","util","ZNPNode_ZPP_InteractionGroup"],t.util.ZNPNode_ZPP_InteractionGroup.prototype.next=null,t.util.ZNPNode_ZPP_InteractionGroup.prototype.alloc=function(){},t.util.ZNPNode_ZPP_InteractionGroup.prototype.free=function(){this.elt=null},t.util.ZNPNode_ZPP_InteractionGroup.prototype.elt=null,t.util.ZNPNode_ZPP_InteractionGroup.prototype.elem=function(){return this.elt},t.util.ZNPNode_ZPP_InteractionGroup.prototype.__class__=t.util.ZNPNode_ZPP_InteractionGroup,t.util.ZNPNode_ZPP_ToiEvent=l["zpp_nape.util.ZNPNode_ZPP_ToiEvent"]=function(){this.elt=null,this.next=null},t.util.ZNPNode_ZPP_ToiEvent.__name__=["zpp_nape","util","ZNPNode_ZPP_ToiEvent"],t.util.ZNPNode_ZPP_ToiEvent.prototype.next=null,t.util.ZNPNode_ZPP_ToiEvent.prototype.alloc=function(){},t.util.ZNPNode_ZPP_ToiEvent.prototype.free=function(){this.elt=null},t.util.ZNPNode_ZPP_ToiEvent.prototype.elt=null,t.util.ZNPNode_ZPP_ToiEvent.prototype.elem=function(){return this.elt},t.util.ZNPNode_ZPP_ToiEvent.prototype.__class__=t.util.ZNPNode_ZPP_ToiEvent,t.util.ZNPNode_ConvexResult=l["zpp_nape.util.ZNPNode_ConvexResult"]=function(){this.elt=null,this.next=null},t.util.ZNPNode_ConvexResult.__name__=["zpp_nape","util","ZNPNode_ConvexResult"],t.util.ZNPNode_ConvexResult.prototype.next=null,t.util.ZNPNode_ConvexResult.prototype.alloc=function(){},t.util.ZNPNode_ConvexResult.prototype.free=function(){this.elt=null},t.util.ZNPNode_ConvexResult.prototype.elt=null,t.util.ZNPNode_ConvexResult.prototype.elem=function(){return this.elt},t.util.ZNPNode_ConvexResult.prototype.__class__=t.util.ZNPNode_ConvexResult,t.util.ZNPNode_ZPP_GeomPoly=l["zpp_nape.util.ZNPNode_ZPP_GeomPoly"]=function(){this.elt=null,this.next=null},t.util.ZNPNode_ZPP_GeomPoly.__name__=["zpp_nape","util","ZNPNode_ZPP_GeomPoly"],t.util.ZNPNode_ZPP_GeomPoly.prototype.next=null,t.util.ZNPNode_ZPP_GeomPoly.prototype.alloc=function(){},t.util.ZNPNode_ZPP_GeomPoly.prototype.free=function(){this.elt=null},t.util.ZNPNode_ZPP_GeomPoly.prototype.elt=null,t.util.ZNPNode_ZPP_GeomPoly.prototype.elem=function(){return this.elt},t.util.ZNPNode_ZPP_GeomPoly.prototype.__class__=t.util.ZNPNode_ZPP_GeomPoly,t.util.ZNPNode_RayResult=l["zpp_nape.util.ZNPNode_RayResult"]=function(){this.elt=null,this.next=null},t.util.ZNPNode_RayResult.__name__=["zpp_nape","util","ZNPNode_RayResult"],t.util.ZNPNode_RayResult.prototype.next=null,t.util.ZNPNode_RayResult.prototype.alloc=function(){},t.util.ZNPNode_RayResult.prototype.free=function(){this.elt=null},t.util.ZNPNode_RayResult.prototype.elt=null,t.util.ZNPNode_RayResult.prototype.elem=function(){return this.elt},t.util.ZNPNode_RayResult.prototype.__class__=t.util.ZNPNode_RayResult,t.util.ZPP_MixVec2List=l["zpp_nape.util.ZPP_MixVec2List"]=function(){this.at_index=0,this.at_ite=null,this.zip_length=!1,this._length=0,this.inner=null,e.geom.Vec2List.call(this),this.at_ite=null,this.at_index=0,this.zip_length=!0,this._length=0},t.util.ZPP_MixVec2List.__name__=["zpp_nape","util","ZPP_MixVec2List"],t.util.ZPP_MixVec2List.__super__=e.geom.Vec2List,e.geom.Vec2List.prototype)t.util.ZPP_MixVec2List.prototype[u]=e.geom.Vec2List.prototype[u];return t.util.ZPP_MixVec2List.get=function(e,n){null==n&&(n=!1);var i=new t.util.ZPP_MixVec2List;return i.inner=e,i.zpp_inner.immutable=n,i},t.util.ZPP_MixVec2List.prototype.inner=null,t.util.ZPP_MixVec2List.prototype._length=null,t.util.ZPP_MixVec2List.prototype.zip_length=null,t.util.ZPP_MixVec2List.prototype.at_ite=null,t.util.ZPP_MixVec2List.prototype.at_index=null,t.util.ZPP_MixVec2List.prototype.zpp_gl=function(){if(this.zpp_vm(),this.zip_length){this._length=0;for(var e=this.inner.next;null!=e;)this._length++,e=e.next;this.zip_length=!1}return this._length},t.util.ZPP_MixVec2List.prototype.zpp_vm=function(){this.zpp_inner.validate(),this.inner.modified&&(this.zip_length=!0,this._length=0,this.at_ite=null)},t.util.ZPP_MixVec2List.prototype.at=function(i){if(this.zpp_vm(),i<0||i>=this.zpp_gl())throw new n._Boot.HaxeError("Error: Index out of bounds");if(this.zpp_inner.reverse_flag&&(i=this.zpp_gl()-1-i),i<this.at_index||null==this.at_ite)for(this.at_index=0,this.at_ite=this.inner.next;;){this.at_ite;break}for(;this.at_index!=i;)for(this.at_index++,this.at_ite=this.at_ite.next;;){this.at_ite;break}var r=this.at_ite;if(null==r.outer){r.outer=new e.geom.Vec2;var o=r.outer.zpp_inner;null!=o.outer&&(o.outer.zpp_inner=null,o.outer=null),o._isimmutable=null,o._validate=null,o._invalidate=null,o.next=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=o,r.outer.zpp_inner=r}return r.outer},t.util.ZPP_MixVec2List.prototype.push=function(e){if(this.zpp_inner.immutable)throw new n._Boot.HaxeError("Error: Vec2List is immutable");if(this.zpp_inner.modify_test(),this.zpp_vm(),e.zpp_inner._inuse)throw new n._Boot.HaxeError("Error: Vec2 is already in use");var t=null==this.zpp_inner.adder||this.zpp_inner.adder(e);if(t){if(this.zpp_inner.reverse_flag)this.inner.add(e.zpp_inner);else{var i=this.inner.iterator_at(this.zpp_gl()-1);this.inner.insert(i,e.zpp_inner)}this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(e)}return t},t.util.ZPP_MixVec2List.prototype.unshift=function(e){if(this.zpp_inner.immutable)throw new n._Boot.HaxeError("Error: Vec2List is immutable");if(this.zpp_inner.modify_test(),this.zpp_vm(),e.zpp_inner._inuse)throw new n._Boot.HaxeError("Error: Vec2 is already in use");var t=null==this.zpp_inner.adder||this.zpp_inner.adder(e);if(t){if(this.zpp_inner.reverse_flag){var i=this.inner.iterator_at(this.zpp_gl()-1);this.inner.insert(i,e.zpp_inner)}else this.inner.add(e.zpp_inner);this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(e)}return t},t.util.ZPP_MixVec2List.prototype.pop=function(){if(this.zpp_inner.immutable)throw new n._Boot.HaxeError("Error: Vec2List is immutable");if(this.zpp_inner.modify_test(),this.empty())throw new n._Boot.HaxeError("Error: Cannot remove from empty list");this.zpp_vm();var i=null;if(this.zpp_inner.reverse_flag){if(null==(i=this.inner.next).outer){i.outer=new e.geom.Vec2;var r=i.outer.zpp_inner;null!=r.outer&&(r.outer.zpp_inner=null,r.outer=null),r._isimmutable=null,r._validate=null,r._invalidate=null,r.next=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=r,i.outer.zpp_inner=i}var o=i.outer;null!=this.zpp_inner.subber&&this.zpp_inner.subber(o),this.zpp_inner.dontremove||this.inner.pop()}else{null!=this.at_ite&&null==this.at_ite.next&&(this.at_ite=null);var a=1==this.zpp_gl()?null:this.inner.iterator_at(this.zpp_gl()-2);if(null==(i=null==a?this.inner.next:a.next).outer){i.outer=new e.geom.Vec2;var s=i.outer.zpp_inner;null!=s.outer&&(s.outer.zpp_inner=null,s.outer=null),s._isimmutable=null,s._validate=null,s._invalidate=null,s.next=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=s,i.outer.zpp_inner=i}var l=i.outer;null!=this.zpp_inner.subber&&this.zpp_inner.subber(l),this.zpp_inner.dontremove||this.inner.erase(a)}if(this.zpp_inner.invalidate(),null==i.outer){i.outer=new e.geom.Vec2;var p=i.outer.zpp_inner;null!=p.outer&&(p.outer.zpp_inner=null,p.outer=null),p._isimmutable=null,p._validate=null,p._invalidate=null,p.next=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=p,i.outer.zpp_inner=i}return i.outer},t.util.ZPP_MixVec2List.prototype.shift=function(){if(this.zpp_inner.immutable)throw new n._Boot.HaxeError("Error: Vec2List is immutable");if(this.zpp_inner.modify_test(),this.empty())throw new n._Boot.HaxeError("Error: Cannot remove from empty list");this.zpp_vm();var i=null;if(this.zpp_inner.reverse_flag){null!=this.at_ite&&null==this.at_ite.next&&(this.at_ite=null);var r=1==this.zpp_gl()?null:this.inner.iterator_at(this.zpp_gl()-2);if(null==(i=null==r?this.inner.next:r.next).outer){i.outer=new e.geom.Vec2;var o=i.outer.zpp_inner;null!=o.outer&&(o.outer.zpp_inner=null,o.outer=null),o._isimmutable=null,o._validate=null,o._invalidate=null,o.next=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=o,i.outer.zpp_inner=i}var a=i.outer;null!=this.zpp_inner.subber&&this.zpp_inner.subber(a),this.zpp_inner.dontremove||this.inner.erase(r)}else{if(null==(i=this.inner.next).outer){i.outer=new e.geom.Vec2;var s=i.outer.zpp_inner;null!=s.outer&&(s.outer.zpp_inner=null,s.outer=null),s._isimmutable=null,s._validate=null,s._invalidate=null,s.next=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=s,i.outer.zpp_inner=i}var l=i.outer;null!=this.zpp_inner.subber&&this.zpp_inner.subber(l),this.zpp_inner.dontremove||this.inner.pop()}if(this.zpp_inner.invalidate(),null==i.outer){i.outer=new e.geom.Vec2;var p=i.outer.zpp_inner;null!=p.outer&&(p.outer.zpp_inner=null,p.outer=null),p._isimmutable=null,p._validate=null,p._invalidate=null,p.next=t.geom.ZPP_Vec2.zpp_pool,t.geom.ZPP_Vec2.zpp_pool=p,i.outer.zpp_inner=i}return i.outer},t.util.ZPP_MixVec2List.prototype.remove=function(e){if(this.zpp_inner.immutable)throw new n._Boot.HaxeError("Error: Vec2List is immutable");var t;this.zpp_inner.modify_test(),this.zpp_vm(),t=!1;for(var i=this.inner.next;null!=i;){var r=i;if(e.zpp_inner==r){t=!0;break}i=i.next}return t&&(null!=this.zpp_inner.subber&&this.zpp_inner.subber(e),this.zpp_inner.dontremove||this.inner.remove(e.zpp_inner),this.zpp_inner.invalidate()),t},t.util.ZPP_MixVec2List.prototype.clear=function(){if(this.zpp_inner.immutable)throw new n._Boot.HaxeError("Error: Vec2List is immutable");if(this.zpp_inner.reverse_flag)for(;!this.empty();)this.pop();else for(;!this.empty();)this.shift()},t.util.ZPP_MixVec2List.prototype.__class__=t.util.ZPP_MixVec2List,t.util.ZPP_ConstraintList=l["zpp_nape.util.ZPP_ConstraintList"]=function(){this.user_length=0,this.zip_length=!1,this.push_ite=null,this.at_ite=null,this.at_index=0,this.reverse_flag=!1,this.dontremove=!1,this.subber=null,this.post_adder=null,this.adder=null,this._modifiable=null,this._validate=null,this._invalidate=null,this._invalidated=!1,this.immutable=!1,this.inner=null,this.outer=null,this.inner=new t.util.ZNPList_ZPP_Constraint,this._invalidated=!0},t.util.ZPP_ConstraintList.__name__=["zpp_nape","util","ZPP_ConstraintList"],t.util.ZPP_ConstraintList.get=function(t,n){null==n&&(n=!1);var i=new e.constraint.ConstraintList;return i.zpp_inner.inner=t,n&&(i.zpp_inner.immutable=!0),i.zpp_inner.zip_length=!0,i},t.util.ZPP_ConstraintList.prototype.outer=null,t.util.ZPP_ConstraintList.prototype.inner=null,t.util.ZPP_ConstraintList.prototype.immutable=null,t.util.ZPP_ConstraintList.prototype._invalidated=null,t.util.ZPP_ConstraintList.prototype._invalidate=null,t.util.ZPP_ConstraintList.prototype._validate=null,t.util.ZPP_ConstraintList.prototype._modifiable=null,t.util.ZPP_ConstraintList.prototype.adder=null,t.util.ZPP_ConstraintList.prototype.post_adder=null,t.util.ZPP_ConstraintList.prototype.subber=null,t.util.ZPP_ConstraintList.prototype.dontremove=null,t.util.ZPP_ConstraintList.prototype.reverse_flag=null,t.util.ZPP_ConstraintList.prototype.valmod=function(){this.validate(),this.inner.modified&&(this.inner.pushmod&&(this.push_ite=null),this.at_ite=null,this.inner.modified=!1,this.inner.pushmod=!1,this.zip_length=!0)},t.util.ZPP_ConstraintList.prototype.modified=function(){this.zip_length=!0,this.at_ite=null,this.push_ite=null},t.util.ZPP_ConstraintList.prototype.modify_test=function(){null!=this._modifiable&&this._modifiable()},t.util.ZPP_ConstraintList.prototype.validate=function(){this._invalidated&&(this._invalidated=!1,null!=this._validate&&this._validate())},t.util.ZPP_ConstraintList.prototype.invalidate=function(){this._invalidated=!0,null!=this._invalidate&&this._invalidate(this)},t.util.ZPP_ConstraintList.prototype.at_index=null,t.util.ZPP_ConstraintList.prototype.at_ite=null,t.util.ZPP_ConstraintList.prototype.push_ite=null,t.util.ZPP_ConstraintList.prototype.zip_length=null,t.util.ZPP_ConstraintList.prototype.user_length=null,t.util.ZPP_ConstraintList.prototype.__class__=t.util.ZPP_ConstraintList,t.util.ZPP_BodyList=l["zpp_nape.util.ZPP_BodyList"]=function(){this.user_length=0,this.zip_length=!1,this.push_ite=null,this.at_ite=null,this.at_index=0,this.reverse_flag=!1,this.dontremove=!1,this.subber=null,this.post_adder=null,this.adder=null,this._modifiable=null,this._validate=null,this._invalidate=null,this._invalidated=!1,this.immutable=!1,this.inner=null,this.outer=null,this.inner=new t.util.ZNPList_ZPP_Body,this._invalidated=!0},t.util.ZPP_BodyList.__name__=["zpp_nape","util","ZPP_BodyList"],t.util.ZPP_BodyList.get=function(t,n){null==n&&(n=!1);var i=new e.phys.BodyList;return i.zpp_inner.inner=t,n&&(i.zpp_inner.immutable=!0),i.zpp_inner.zip_length=!0,i},t.util.ZPP_BodyList.prototype.outer=null,t.util.ZPP_BodyList.prototype.inner=null,t.util.ZPP_BodyList.prototype.immutable=null,t.util.ZPP_BodyList.prototype._invalidated=null,t.util.ZPP_BodyList.prototype._invalidate=null,t.util.ZPP_BodyList.prototype._validate=null,t.util.ZPP_BodyList.prototype._modifiable=null,t.util.ZPP_BodyList.prototype.adder=null,t.util.ZPP_BodyList.prototype.post_adder=null,t.util.ZPP_BodyList.prototype.subber=null,t.util.ZPP_BodyList.prototype.dontremove=null,t.util.ZPP_BodyList.prototype.reverse_flag=null,t.util.ZPP_BodyList.prototype.valmod=function(){this.validate(),this.inner.modified&&(this.inner.pushmod&&(this.push_ite=null),this.at_ite=null,this.inner.modified=!1,this.inner.pushmod=!1,this.zip_length=!0)},t.util.ZPP_BodyList.prototype.modified=function(){this.zip_length=!0,this.at_ite=null,this.push_ite=null},t.util.ZPP_BodyList.prototype.modify_test=function(){null!=this._modifiable&&this._modifiable()},t.util.ZPP_BodyList.prototype.validate=function(){this._invalidated&&(this._invalidated=!1,null!=this._validate&&this._validate())},t.util.ZPP_BodyList.prototype.invalidate=function(){this._invalidated=!0,null!=this._invalidate&&this._invalidate(this)},t.util.ZPP_BodyList.prototype.at_index=null,t.util.ZPP_BodyList.prototype.at_ite=null,t.util.ZPP_BodyList.prototype.push_ite=null,t.util.ZPP_BodyList.prototype.zip_length=null,t.util.ZPP_BodyList.prototype.user_length=null,t.util.ZPP_BodyList.prototype.__class__=t.util.ZPP_BodyList,t.util.ZPP_InteractorList=l["zpp_nape.util.ZPP_InteractorList"]=function(){this.user_length=0,this.zip_length=!1,this.push_ite=null,this.at_ite=null,this.at_index=0,this.reverse_flag=!1,this.dontremove=!1,this.subber=null,this.post_adder=null,this.adder=null,this._modifiable=null,this._validate=null,this._invalidate=null,this._invalidated=!1,this.immutable=!1,this.inner=null,this.outer=null,this.inner=new t.util.ZNPList_ZPP_Interactor,this._invalidated=!0},t.util.ZPP_InteractorList.__name__=["zpp_nape","util","ZPP_InteractorList"],t.util.ZPP_InteractorList.get=function(t,n){null==n&&(n=!1);var i=new e.phys.InteractorList;return i.zpp_inner.inner=t,n&&(i.zpp_inner.immutable=!0),i.zpp_inner.zip_length=!0,i},t.util.ZPP_InteractorList.prototype.outer=null,t.util.ZPP_InteractorList.prototype.inner=null,t.util.ZPP_InteractorList.prototype.immutable=null,t.util.ZPP_InteractorList.prototype._invalidated=null,t.util.ZPP_InteractorList.prototype._invalidate=null,t.util.ZPP_InteractorList.prototype._validate=null,t.util.ZPP_InteractorList.prototype._modifiable=null,t.util.ZPP_InteractorList.prototype.adder=null,t.util.ZPP_InteractorList.prototype.post_adder=null,t.util.ZPP_InteractorList.prototype.subber=null,t.util.ZPP_InteractorList.prototype.dontremove=null,t.util.ZPP_InteractorList.prototype.reverse_flag=null,t.util.ZPP_InteractorList.prototype.valmod=function(){this.validate(),this.inner.modified&&(this.inner.pushmod&&(this.push_ite=null),this.at_ite=null,this.inner.modified=!1,this.inner.pushmod=!1,this.zip_length=!0)},t.util.ZPP_InteractorList.prototype.modified=function(){this.zip_length=!0,this.at_ite=null,this.push_ite=null},t.util.ZPP_InteractorList.prototype.modify_test=function(){null!=this._modifiable&&this._modifiable()},t.util.ZPP_InteractorList.prototype.validate=function(){this._invalidated&&(this._invalidated=!1,null!=this._validate&&this._validate())},t.util.ZPP_InteractorList.prototype.invalidate=function(){this._invalidated=!0,null!=this._invalidate&&this._invalidate(this)},t.util.ZPP_InteractorList.prototype.at_index=null,t.util.ZPP_InteractorList.prototype.at_ite=null,t.util.ZPP_InteractorList.prototype.push_ite=null,t.util.ZPP_InteractorList.prototype.zip_length=null,t.util.ZPP_InteractorList.prototype.user_length=null,t.util.ZPP_InteractorList.prototype.__class__=t.util.ZPP_InteractorList,t.util.ZPP_CompoundList=l["zpp_nape.util.ZPP_CompoundList"]=function(){this.user_length=0,this.zip_length=!1,this.push_ite=null,this.at_ite=null,this.at_index=0,this.reverse_flag=!1,this.dontremove=!1,this.subber=null,this.post_adder=null,this.adder=null,this._modifiable=null,this._validate=null,this._invalidate=null,this._invalidated=!1,this.immutable=!1,this.inner=null,this.outer=null,this.inner=new t.util.ZNPList_ZPP_Compound,this._invalidated=!0},t.util.ZPP_CompoundList.__name__=["zpp_nape","util","ZPP_CompoundList"],t.util.ZPP_CompoundList.get=function(t,n){null==n&&(n=!1);var i=new e.phys.CompoundList;return i.zpp_inner.inner=t,n&&(i.zpp_inner.immutable=!0),i.zpp_inner.zip_length=!0,i},t.util.ZPP_CompoundList.prototype.outer=null,t.util.ZPP_CompoundList.prototype.inner=null,t.util.ZPP_CompoundList.prototype.immutable=null,t.util.ZPP_CompoundList.prototype._invalidated=null,t.util.ZPP_CompoundList.prototype._invalidate=null,t.util.ZPP_CompoundList.prototype._validate=null,t.util.ZPP_CompoundList.prototype._modifiable=null,t.util.ZPP_CompoundList.prototype.adder=null,t.util.ZPP_CompoundList.prototype.post_adder=null,t.util.ZPP_CompoundList.prototype.subber=null,t.util.ZPP_CompoundList.prototype.dontremove=null,t.util.ZPP_CompoundList.prototype.reverse_flag=null,t.util.ZPP_CompoundList.prototype.valmod=function(){this.validate(),this.inner.modified&&(this.inner.pushmod&&(this.push_ite=null),this.at_ite=null,this.inner.modified=!1,this.inner.pushmod=!1,this.zip_length=!0)},t.util.ZPP_CompoundList.prototype.modified=function(){this.zip_length=!0,this.at_ite=null,this.push_ite=null},t.util.ZPP_CompoundList.prototype.modify_test=function(){null!=this._modifiable&&this._modifiable()},t.util.ZPP_CompoundList.prototype.validate=function(){this._invalidated&&(this._invalidated=!1,null!=this._validate&&this._validate())},t.util.ZPP_CompoundList.prototype.invalidate=function(){this._invalidated=!0,null!=this._invalidate&&this._invalidate(this)},t.util.ZPP_CompoundList.prototype.at_index=null,t.util.ZPP_CompoundList.prototype.at_ite=null,t.util.ZPP_CompoundList.prototype.push_ite=null,t.util.ZPP_CompoundList.prototype.zip_length=null,t.util.ZPP_CompoundList.prototype.user_length=null,t.util.ZPP_CompoundList.prototype.__class__=t.util.ZPP_CompoundList,t.util.ZPP_ListenerList=l["zpp_nape.util.ZPP_ListenerList"]=function(){this.user_length=0,this.zip_length=!1,this.push_ite=null,this.at_ite=null,this.at_index=0,this.reverse_flag=!1,this.dontremove=!1,this.subber=null,this.post_adder=null,this.adder=null,this._modifiable=null,this._validate=null,this._invalidate=null,this._invalidated=!1,this.immutable=!1,this.inner=null,this.outer=null,this.inner=new t.util.ZNPList_ZPP_Listener,this._invalidated=!0},t.util.ZPP_ListenerList.__name__=["zpp_nape","util","ZPP_ListenerList"],t.util.ZPP_ListenerList.get=function(t,n){null==n&&(n=!1);var i=new e.callbacks.ListenerList;return i.zpp_inner.inner=t,n&&(i.zpp_inner.immutable=!0),i.zpp_inner.zip_length=!0,i},t.util.ZPP_ListenerList.prototype.outer=null,t.util.ZPP_ListenerList.prototype.inner=null,t.util.ZPP_ListenerList.prototype.immutable=null,t.util.ZPP_ListenerList.prototype._invalidated=null,t.util.ZPP_ListenerList.prototype._invalidate=null,t.util.ZPP_ListenerList.prototype._validate=null,t.util.ZPP_ListenerList.prototype._modifiable=null,t.util.ZPP_ListenerList.prototype.adder=null,t.util.ZPP_ListenerList.prototype.post_adder=null,t.util.ZPP_ListenerList.prototype.subber=null,t.util.ZPP_ListenerList.prototype.dontremove=null,t.util.ZPP_ListenerList.prototype.reverse_flag=null,t.util.ZPP_ListenerList.prototype.valmod=function(){this.validate(),this.inner.modified&&(this.inner.pushmod&&(this.push_ite=null),this.at_ite=null,this.inner.modified=!1,this.inner.pushmod=!1,this.zip_length=!0)},t.util.ZPP_ListenerList.prototype.modified=function(){this.zip_length=!0,this.at_ite=null,this.push_ite=null},t.util.ZPP_ListenerList.prototype.modify_test=function(){null!=this._modifiable&&this._modifiable()},t.util.ZPP_ListenerList.prototype.validate=function(){this._invalidated&&(this._invalidated=!1,null!=this._validate&&this._validate())},t.util.ZPP_ListenerList.prototype.invalidate=function(){this._invalidated=!0,null!=this._invalidate&&this._invalidate(this)},t.util.ZPP_ListenerList.prototype.at_index=null,t.util.ZPP_ListenerList.prototype.at_ite=null,t.util.ZPP_ListenerList.prototype.push_ite=null,t.util.ZPP_ListenerList.prototype.zip_length=null,t.util.ZPP_ListenerList.prototype.user_length=null,t.util.ZPP_ListenerList.prototype.__class__=t.util.ZPP_ListenerList,t.util.ZPP_CbTypeList=l["zpp_nape.util.ZPP_CbTypeList"]=function(){this.user_length=0,this.zip_length=!1,this.push_ite=null,this.at_ite=null,this.at_index=0,this.reverse_flag=!1,this.dontremove=!1,this.subber=null,this.post_adder=null,this.adder=null,this._modifiable=null,this._validate=null,this._invalidate=null,this._invalidated=!1,this.immutable=!1,this.inner=null,this.outer=null,this.inner=new t.util.ZNPList_ZPP_CbType,this._invalidated=!0},t.util.ZPP_CbTypeList.__name__=["zpp_nape","util","ZPP_CbTypeList"],t.util.ZPP_CbTypeList.get=function(t,n){null==n&&(n=!1);var i=new e.callbacks.CbTypeList;return i.zpp_inner.inner=t,n&&(i.zpp_inner.immutable=!0),i.zpp_inner.zip_length=!0,i},t.util.ZPP_CbTypeList.prototype.outer=null,t.util.ZPP_CbTypeList.prototype.inner=null,t.util.ZPP_CbTypeList.prototype.immutable=null,t.util.ZPP_CbTypeList.prototype._invalidated=null,t.util.ZPP_CbTypeList.prototype._invalidate=null,t.util.ZPP_CbTypeList.prototype._validate=null,t.util.ZPP_CbTypeList.prototype._modifiable=null,t.util.ZPP_CbTypeList.prototype.adder=null,t.util.ZPP_CbTypeList.prototype.post_adder=null,t.util.ZPP_CbTypeList.prototype.subber=null,t.util.ZPP_CbTypeList.prototype.dontremove=null,t.util.ZPP_CbTypeList.prototype.reverse_flag=null,t.util.ZPP_CbTypeList.prototype.valmod=function(){this.validate(),this.inner.modified&&(this.inner.pushmod&&(this.push_ite=null),this.at_ite=null,this.inner.modified=!1,this.inner.pushmod=!1,this.zip_length=!0)},t.util.ZPP_CbTypeList.prototype.modified=function(){this.zip_length=!0,this.at_ite=null,this.push_ite=null},t.util.ZPP_CbTypeList.prototype.modify_test=function(){null!=this._modifiable&&this._modifiable()},t.util.ZPP_CbTypeList.prototype.validate=function(){this._invalidated&&(this._invalidated=!1,null!=this._validate&&this._validate())},t.util.ZPP_CbTypeList.prototype.invalidate=function(){this._invalidated=!0,null!=this._invalidate&&this._invalidate(this)},t.util.ZPP_CbTypeList.prototype.at_index=null,t.util.ZPP_CbTypeList.prototype.at_ite=null,t.util.ZPP_CbTypeList.prototype.push_ite=null,t.util.ZPP_CbTypeList.prototype.zip_length=null,t.util.ZPP_CbTypeList.prototype.user_length=null,t.util.ZPP_CbTypeList.prototype.__class__=t.util.ZPP_CbTypeList,t.util.ZPP_Vec2List=l["zpp_nape.util.ZPP_Vec2List"]=function(){this.user_length=0,this.zip_length=!1,this.push_ite=null,this.at_ite=null,this.at_index=0,this.reverse_flag=!1,this.dontremove=!1,this.subber=null,this.post_adder=null,this.adder=null,this._modifiable=null,this._validate=null,this._invalidate=null,this._invalidated=!1,this.immutable=!1,this.inner=null,this.outer=null,this.inner=new t.util.ZNPList_ZPP_Vec2,this._invalidated=!0},t.util.ZPP_Vec2List.__name__=["zpp_nape","util","ZPP_Vec2List"],t.util.ZPP_Vec2List.get=function(t,n){null==n&&(n=!1);var i=new e.geom.Vec2List;return i.zpp_inner.inner=t,n&&(i.zpp_inner.immutable=!0),i.zpp_inner.zip_length=!0,i},t.util.ZPP_Vec2List.prototype.outer=null,t.util.ZPP_Vec2List.prototype.inner=null,t.util.ZPP_Vec2List.prototype.immutable=null,t.util.ZPP_Vec2List.prototype._invalidated=null,t.util.ZPP_Vec2List.prototype._invalidate=null,t.util.ZPP_Vec2List.prototype._validate=null,t.util.ZPP_Vec2List.prototype._modifiable=null,t.util.ZPP_Vec2List.prototype.adder=null,t.util.ZPP_Vec2List.prototype.post_adder=null,t.util.ZPP_Vec2List.prototype.subber=null,t.util.ZPP_Vec2List.prototype.dontremove=null,t.util.ZPP_Vec2List.prototype.reverse_flag=null,t.util.ZPP_Vec2List.prototype.valmod=function(){this.validate(),this.inner.modified&&(this.inner.pushmod&&(this.push_ite=null),this.at_ite=null,this.inner.modified=!1,this.inner.pushmod=!1,this.zip_length=!0)},t.util.ZPP_Vec2List.prototype.modified=function(){this.zip_length=!0,this.at_ite=null,this.push_ite=null},t.util.ZPP_Vec2List.prototype.modify_test=function(){null!=this._modifiable&&this._modifiable()},t.util.ZPP_Vec2List.prototype.validate=function(){this._invalidated&&(this._invalidated=!1,null!=this._validate&&this._validate())},t.util.ZPP_Vec2List.prototype.invalidate=function(){this._invalidated=!0,null!=this._invalidate&&this._invalidate(this)},t.util.ZPP_Vec2List.prototype.at_index=null,t.util.ZPP_Vec2List.prototype.at_ite=null,t.util.ZPP_Vec2List.prototype.push_ite=null,t.util.ZPP_Vec2List.prototype.zip_length=null,t.util.ZPP_Vec2List.prototype.user_length=null,t.util.ZPP_Vec2List.prototype.__class__=t.util.ZPP_Vec2List,t.util.ZPP_GeomPolyList=l["zpp_nape.util.ZPP_GeomPolyList"]=function(){this.user_length=0,this.zip_length=!1,this.push_ite=null,this.at_ite=null,this.at_index=0,this.reverse_flag=!1,this.dontremove=!1,this.subber=null,this.post_adder=null,this.adder=null,this._modifiable=null,this._validate=null,this._invalidate=null,this._invalidated=!1,this.immutable=!1,this.inner=null,this.outer=null,this.inner=new t.util.ZNPList_ZPP_GeomPoly,this._invalidated=!0},t.util.ZPP_GeomPolyList.__name__=["zpp_nape","util","ZPP_GeomPolyList"],t.util.ZPP_GeomPolyList.get=function(t,n){null==n&&(n=!1);var i=new e.geom.GeomPolyList;return i.zpp_inner.inner=t,n&&(i.zpp_inner.immutable=!0),i.zpp_inner.zip_length=!0,i},t.util.ZPP_GeomPolyList.prototype.outer=null,t.util.ZPP_GeomPolyList.prototype.inner=null,t.util.ZPP_GeomPolyList.prototype.immutable=null,t.util.ZPP_GeomPolyList.prototype._invalidated=null,t.util.ZPP_GeomPolyList.prototype._invalidate=null,t.util.ZPP_GeomPolyList.prototype._validate=null,t.util.ZPP_GeomPolyList.prototype._modifiable=null,t.util.ZPP_GeomPolyList.prototype.adder=null,t.util.ZPP_GeomPolyList.prototype.post_adder=null,t.util.ZPP_GeomPolyList.prototype.subber=null,t.util.ZPP_GeomPolyList.prototype.dontremove=null,t.util.ZPP_GeomPolyList.prototype.reverse_flag=null,t.util.ZPP_GeomPolyList.prototype.valmod=function(){this.validate(),this.inner.modified&&(this.inner.pushmod&&(this.push_ite=null),this.at_ite=null,this.inner.modified=!1,this.inner.pushmod=!1,this.zip_length=!0)},t.util.ZPP_GeomPolyList.prototype.modified=function(){this.zip_length=!0,this.at_ite=null,this.push_ite=null},t.util.ZPP_GeomPolyList.prototype.modify_test=function(){null!=this._modifiable&&this._modifiable()},t.util.ZPP_GeomPolyList.prototype.validate=function(){this._invalidated&&(this._invalidated=!1,null!=this._validate&&this._validate())},t.util.ZPP_GeomPolyList.prototype.invalidate=function(){this._invalidated=!0,null!=this._invalidate&&this._invalidate(this)},t.util.ZPP_GeomPolyList.prototype.at_index=null,t.util.ZPP_GeomPolyList.prototype.at_ite=null,t.util.ZPP_GeomPolyList.prototype.push_ite=null,t.util.ZPP_GeomPolyList.prototype.zip_length=null,t.util.ZPP_GeomPolyList.prototype.user_length=null,t.util.ZPP_GeomPolyList.prototype.__class__=t.util.ZPP_GeomPolyList,t.util.ZPP_RayResultList=l["zpp_nape.util.ZPP_RayResultList"]=function(){this.user_length=0,this.zip_length=!1,this.push_ite=null,this.at_ite=null,this.at_index=0,this.reverse_flag=!1,this.dontremove=!1,this.subber=null,this.post_adder=null,this.adder=null,this._modifiable=null,this._validate=null,this._invalidate=null,this._invalidated=!1,this.immutable=!1,this.inner=null,this.outer=null,this.inner=new t.util.ZNPList_RayResult,this._invalidated=!0},t.util.ZPP_RayResultList.__name__=["zpp_nape","util","ZPP_RayResultList"],t.util.ZPP_RayResultList.get=function(t,n){null==n&&(n=!1);var i=new e.geom.RayResultList;return i.zpp_inner.inner=t,n&&(i.zpp_inner.immutable=!0),i.zpp_inner.zip_length=!0,i},t.util.ZPP_RayResultList.prototype.outer=null,t.util.ZPP_RayResultList.prototype.inner=null,t.util.ZPP_RayResultList.prototype.immutable=null,t.util.ZPP_RayResultList.prototype._invalidated=null,t.util.ZPP_RayResultList.prototype._invalidate=null,t.util.ZPP_RayResultList.prototype._validate=null,t.util.ZPP_RayResultList.prototype._modifiable=null,t.util.ZPP_RayResultList.prototype.adder=null,t.util.ZPP_RayResultList.prototype.post_adder=null,t.util.ZPP_RayResultList.prototype.subber=null,t.util.ZPP_RayResultList.prototype.dontremove=null,t.util.ZPP_RayResultList.prototype.reverse_flag=null,t.util.ZPP_RayResultList.prototype.valmod=function(){this.validate(),this.inner.modified&&(this.inner.pushmod&&(this.push_ite=null),this.at_ite=null,this.inner.modified=!1,this.inner.pushmod=!1,this.zip_length=!0)},t.util.ZPP_RayResultList.prototype.modified=function(){this.zip_length=!0,this.at_ite=null,this.push_ite=null},t.util.ZPP_RayResultList.prototype.modify_test=function(){null!=this._modifiable&&this._modifiable()},t.util.ZPP_RayResultList.prototype.validate=function(){this._invalidated&&(this._invalidated=!1,null!=this._validate&&this._validate())},t.util.ZPP_RayResultList.prototype.invalidate=function(){this._invalidated=!0,null!=this._invalidate&&this._invalidate(this)},t.util.ZPP_RayResultList.prototype.at_index=null,t.util.ZPP_RayResultList.prototype.at_ite=null,t.util.ZPP_RayResultList.prototype.push_ite=null,t.util.ZPP_RayResultList.prototype.zip_length=null,t.util.ZPP_RayResultList.prototype.user_length=null,t.util.ZPP_RayResultList.prototype.__class__=t.util.ZPP_RayResultList,t.util.ZPP_ConvexResultList=l["zpp_nape.util.ZPP_ConvexResultList"]=function(){this.user_length=0,this.zip_length=!1,this.push_ite=null,this.at_ite=null,this.at_index=0,this.reverse_flag=!1,this.dontremove=!1,this.subber=null,this.post_adder=null,this.adder=null,this._modifiable=null,this._validate=null,this._invalidate=null,this._invalidated=!1,this.immutable=!1,this.inner=null,this.outer=null,this.inner=new t.util.ZNPList_ConvexResult,this._invalidated=!0},t.util.ZPP_ConvexResultList.__name__=["zpp_nape","util","ZPP_ConvexResultList"],t.util.ZPP_ConvexResultList.get=function(t,n){null==n&&(n=!1);var i=new e.geom.ConvexResultList;return i.zpp_inner.inner=t,n&&(i.zpp_inner.immutable=!0),i.zpp_inner.zip_length=!0,i},t.util.ZPP_ConvexResultList.prototype.outer=null,t.util.ZPP_ConvexResultList.prototype.inner=null,t.util.ZPP_ConvexResultList.prototype.immutable=null,t.util.ZPP_ConvexResultList.prototype._invalidated=null,t.util.ZPP_ConvexResultList.prototype._invalidate=null,t.util.ZPP_ConvexResultList.prototype._validate=null,t.util.ZPP_ConvexResultList.prototype._modifiable=null,t.util.ZPP_ConvexResultList.prototype.adder=null,t.util.ZPP_ConvexResultList.prototype.post_adder=null,t.util.ZPP_ConvexResultList.prototype.subber=null,t.util.ZPP_ConvexResultList.prototype.dontremove=null,t.util.ZPP_ConvexResultList.prototype.reverse_flag=null,t.util.ZPP_ConvexResultList.prototype.valmod=function(){this.validate(),this.inner.modified&&(this.inner.pushmod&&(this.push_ite=null),this.at_ite=null,this.inner.modified=!1,this.inner.pushmod=!1,this.zip_length=!0)},t.util.ZPP_ConvexResultList.prototype.modified=function(){this.zip_length=!0,this.at_ite=null,this.push_ite=null},t.util.ZPP_ConvexResultList.prototype.modify_test=function(){null!=this._modifiable&&this._modifiable()},t.util.ZPP_ConvexResultList.prototype.validate=function(){this._invalidated&&(this._invalidated=!1,null!=this._validate&&this._validate())},t.util.ZPP_ConvexResultList.prototype.invalidate=function(){this._invalidated=!0,null!=this._invalidate&&this._invalidate(this)},t.util.ZPP_ConvexResultList.prototype.at_index=null,t.util.ZPP_ConvexResultList.prototype.at_ite=null,t.util.ZPP_ConvexResultList.prototype.push_ite=null,t.util.ZPP_ConvexResultList.prototype.zip_length=null,t.util.ZPP_ConvexResultList.prototype.user_length=null,t.util.ZPP_ConvexResultList.prototype.__class__=t.util.ZPP_ConvexResultList,t.util.ZPP_EdgeList=l["zpp_nape.util.ZPP_EdgeList"]=function(){this.user_length=0,this.zip_length=!1,this.push_ite=null,this.at_ite=null,this.at_index=0,this.reverse_flag=!1,this.dontremove=!1,this.subber=null,this.post_adder=null,this.adder=null,this._modifiable=null,this._validate=null,this._invalidate=null,this._invalidated=!1,this.immutable=!1,this.inner=null,this.outer=null,this.inner=new t.util.ZNPList_ZPP_Edge,this._invalidated=!0},t.util.ZPP_EdgeList.__name__=["zpp_nape","util","ZPP_EdgeList"],t.util.ZPP_EdgeList.get=function(t,n){null==n&&(n=!1);var i=new e.shape.EdgeList;return i.zpp_inner.inner=t,n&&(i.zpp_inner.immutable=!0),i.zpp_inner.zip_length=!0,i},t.util.ZPP_EdgeList.prototype.outer=null,t.util.ZPP_EdgeList.prototype.inner=null,t.util.ZPP_EdgeList.prototype.immutable=null,t.util.ZPP_EdgeList.prototype._invalidated=null,t.util.ZPP_EdgeList.prototype._invalidate=null,t.util.ZPP_EdgeList.prototype._validate=null,t.util.ZPP_EdgeList.prototype._modifiable=null,t.util.ZPP_EdgeList.prototype.adder=null,t.util.ZPP_EdgeList.prototype.post_adder=null,t.util.ZPP_EdgeList.prototype.subber=null,t.util.ZPP_EdgeList.prototype.dontremove=null,t.util.ZPP_EdgeList.prototype.reverse_flag=null,t.util.ZPP_EdgeList.prototype.valmod=function(){this.validate(),this.inner.modified&&(this.inner.pushmod&&(this.push_ite=null),this.at_ite=null,this.inner.modified=!1,this.inner.pushmod=!1,this.zip_length=!0)},t.util.ZPP_EdgeList.prototype.modified=function(){this.zip_length=!0,this.at_ite=null,this.push_ite=null},t.util.ZPP_EdgeList.prototype.modify_test=function(){null!=this._modifiable&&this._modifiable()},t.util.ZPP_EdgeList.prototype.validate=function(){this._invalidated&&(this._invalidated=!1,null!=this._validate&&this._validate())},t.util.ZPP_EdgeList.prototype.invalidate=function(){this._invalidated=!0,null!=this._invalidate&&this._invalidate(this)},t.util.ZPP_EdgeList.prototype.at_index=null,t.util.ZPP_EdgeList.prototype.at_ite=null,t.util.ZPP_EdgeList.prototype.push_ite=null,t.util.ZPP_EdgeList.prototype.zip_length=null,t.util.ZPP_EdgeList.prototype.user_length=null,t.util.ZPP_EdgeList.prototype.__class__=t.util.ZPP_EdgeList,t.util.ZPP_ShapeList=l["zpp_nape.util.ZPP_ShapeList"]=function(){this.user_length=0,this.zip_length=!1,this.push_ite=null,this.at_ite=null,this.at_index=0,this.reverse_flag=!1,this.dontremove=!1,this.subber=null,this.post_adder=null,this.adder=null,this._modifiable=null,this._validate=null,this._invalidate=null,this._invalidated=!1,this.immutable=!1,this.inner=null,this.outer=null,this.inner=new t.util.ZNPList_ZPP_Shape,this._invalidated=!0},t.util.ZPP_ShapeList.__name__=["zpp_nape","util","ZPP_ShapeList"],t.util.ZPP_ShapeList.get=function(t,n){null==n&&(n=!1);var i=new e.shape.ShapeList;return i.zpp_inner.inner=t,n&&(i.zpp_inner.immutable=!0),i.zpp_inner.zip_length=!0,i},t.util.ZPP_ShapeList.prototype.outer=null,t.util.ZPP_ShapeList.prototype.inner=null,t.util.ZPP_ShapeList.prototype.immutable=null,t.util.ZPP_ShapeList.prototype._invalidated=null,t.util.ZPP_ShapeList.prototype._invalidate=null,t.util.ZPP_ShapeList.prototype._validate=null,t.util.ZPP_ShapeList.prototype._modifiable=null,t.util.ZPP_ShapeList.prototype.adder=null,t.util.ZPP_ShapeList.prototype.post_adder=null,t.util.ZPP_ShapeList.prototype.subber=null,t.util.ZPP_ShapeList.prototype.dontremove=null,t.util.ZPP_ShapeList.prototype.reverse_flag=null,t.util.ZPP_ShapeList.prototype.valmod=function(){this.validate(),this.inner.modified&&(this.inner.pushmod&&(this.push_ite=null),this.at_ite=null,this.inner.modified=!1,this.inner.pushmod=!1,this.zip_length=!0)},t.util.ZPP_ShapeList.prototype.modified=function(){this.zip_length=!0,this.at_ite=null,this.push_ite=null},t.util.ZPP_ShapeList.prototype.modify_test=function(){null!=this._modifiable&&this._modifiable()},t.util.ZPP_ShapeList.prototype.validate=function(){this._invalidated&&(this._invalidated=!1,null!=this._validate&&this._validate())},t.util.ZPP_ShapeList.prototype.invalidate=function(){this._invalidated=!0,null!=this._invalidate&&this._invalidate(this)},t.util.ZPP_ShapeList.prototype.at_index=null,t.util.ZPP_ShapeList.prototype.at_ite=null,t.util.ZPP_ShapeList.prototype.push_ite=null,t.util.ZPP_ShapeList.prototype.zip_length=null,t.util.ZPP_ShapeList.prototype.user_length=null,t.util.ZPP_ShapeList.prototype.__class__=t.util.ZPP_ShapeList,t.util.ZPP_InteractionGroupList=l["zpp_nape.util.ZPP_InteractionGroupList"]=function(){this.user_length=0,this.zip_length=!1,this.push_ite=null,this.at_ite=null,this.at_index=0,this.reverse_flag=!1,this.dontremove=!1,this.subber=null,this.post_adder=null,this.adder=null,this._modifiable=null,this._validate=null,this._invalidate=null,this._invalidated=!1,this.immutable=!1,this.inner=null,this.outer=null,this.inner=new t.util.ZNPList_ZPP_InteractionGroup,this._invalidated=!0},t.util.ZPP_InteractionGroupList.__name__=["zpp_nape","util","ZPP_InteractionGroupList"],t.util.ZPP_InteractionGroupList.get=function(t,n){null==n&&(n=!1);var i=new e.dynamics.InteractionGroupList;return i.zpp_inner.inner=t,n&&(i.zpp_inner.immutable=!0),i.zpp_inner.zip_length=!0,i},t.util.ZPP_InteractionGroupList.prototype.outer=null,t.util.ZPP_InteractionGroupList.prototype.inner=null,t.util.ZPP_InteractionGroupList.prototype.immutable=null,t.util.ZPP_InteractionGroupList.prototype._invalidated=null,t.util.ZPP_InteractionGroupList.prototype._invalidate=null,t.util.ZPP_InteractionGroupList.prototype._validate=null,t.util.ZPP_InteractionGroupList.prototype._modifiable=null,t.util.ZPP_InteractionGroupList.prototype.adder=null,t.util.ZPP_InteractionGroupList.prototype.post_adder=null,t.util.ZPP_InteractionGroupList.prototype.subber=null,t.util.ZPP_InteractionGroupList.prototype.dontremove=null,t.util.ZPP_InteractionGroupList.prototype.reverse_flag=null,t.util.ZPP_InteractionGroupList.prototype.valmod=function(){this.validate(),this.inner.modified&&(this.inner.pushmod&&(this.push_ite=null),this.at_ite=null,this.inner.modified=!1,this.inner.pushmod=!1,this.zip_length=!0)},t.util.ZPP_InteractionGroupList.prototype.modified=function(){this.zip_length=!0,this.at_ite=null,this.push_ite=null},t.util.ZPP_InteractionGroupList.prototype.modify_test=function(){null!=this._modifiable&&this._modifiable()},t.util.ZPP_InteractionGroupList.prototype.validate=function(){this._invalidated&&(this._invalidated=!1,null!=this._validate&&this._validate())},t.util.ZPP_InteractionGroupList.prototype.invalidate=function(){this._invalidated=!0,null!=this._invalidate&&this._invalidate(this)},t.util.ZPP_InteractionGroupList.prototype.at_index=null,t.util.ZPP_InteractionGroupList.prototype.at_ite=null,t.util.ZPP_InteractionGroupList.prototype.push_ite=null,t.util.ZPP_InteractionGroupList.prototype.zip_length=null,t.util.ZPP_InteractionGroupList.prototype.user_length=null,t.util.ZPP_InteractionGroupList.prototype.__class__=t.util.ZPP_InteractionGroupList,t.util.ZPP_ArbiterList=l["zpp_nape.util.ZPP_ArbiterList"]=function(){this.user_length=0,this.zip_length=!1,this.push_ite=null,this.at_ite=null,this.at_index=0,this.reverse_flag=!1,this.dontremove=!1,this.subber=null,this.post_adder=null,this.adder=null,this._modifiable=null,this._validate=null,this._invalidate=null,this._invalidated=!1,this.immutable=!1,this.inner=null,this.outer=null,this.inner=new t.util.ZNPList_ZPP_Arbiter,this._invalidated=!0},t.util.ZPP_ArbiterList.__name__=["zpp_nape","util","ZPP_ArbiterList"],t.util.ZPP_ArbiterList.get=function(t,n){null==n&&(n=!1);var i=new e.dynamics.ArbiterList;return i.zpp_inner.inner=t,n&&(i.zpp_inner.immutable=!0),i.zpp_inner.zip_length=!0,i},t.util.ZPP_ArbiterList.prototype.outer=null,t.util.ZPP_ArbiterList.prototype.inner=null,t.util.ZPP_ArbiterList.prototype.immutable=null,t.util.ZPP_ArbiterList.prototype._invalidated=null,t.util.ZPP_ArbiterList.prototype._invalidate=null,t.util.ZPP_ArbiterList.prototype._validate=null,t.util.ZPP_ArbiterList.prototype._modifiable=null,t.util.ZPP_ArbiterList.prototype.adder=null,t.util.ZPP_ArbiterList.prototype.post_adder=null,t.util.ZPP_ArbiterList.prototype.subber=null,t.util.ZPP_ArbiterList.prototype.dontremove=null,t.util.ZPP_ArbiterList.prototype.reverse_flag=null,t.util.ZPP_ArbiterList.prototype.valmod=function(){this.validate(),this.inner.modified&&(this.inner.pushmod&&(this.push_ite=null),this.at_ite=null,this.inner.modified=!1,this.inner.pushmod=!1,this.zip_length=!0)},t.util.ZPP_ArbiterList.prototype.modified=function(){this.zip_length=!0,this.at_ite=null,this.push_ite=null},t.util.ZPP_ArbiterList.prototype.modify_test=function(){null!=this._modifiable&&this._modifiable()},t.util.ZPP_ArbiterList.prototype.validate=function(){this._invalidated&&(this._invalidated=!1,null!=this._validate&&this._validate())},t.util.ZPP_ArbiterList.prototype.invalidate=function(){this._invalidated=!0,null!=this._invalidate&&this._invalidate(this)},t.util.ZPP_ArbiterList.prototype.at_index=null,t.util.ZPP_ArbiterList.prototype.at_ite=null,t.util.ZPP_ArbiterList.prototype.push_ite=null,t.util.ZPP_ArbiterList.prototype.zip_length=null,t.util.ZPP_ArbiterList.prototype.user_length=null,t.util.ZPP_ArbiterList.prototype.__class__=t.util.ZPP_ArbiterList,t.util.ZPP_ContactList=l["zpp_nape.util.ZPP_ContactList"]=function(){this.user_length=0,this.zip_length=!1,this.push_ite=null,this.at_ite=null,this.at_index=0,this.reverse_flag=!1,this.dontremove=!1,this.subber=null,this.post_adder=null,this.adder=null,this._modifiable=null,this._validate=null,this._invalidate=null,this._invalidated=!1,this.immutable=!1,this.inner=null,this.outer=null,this.inner=new t.dynamics.ZPP_Contact,this._invalidated=!0},t.util.ZPP_ContactList.__name__=["zpp_nape","util","ZPP_ContactList"],t.util.ZPP_ContactList.get=function(t,n){null==n&&(n=!1);var i=new e.dynamics.ContactList;return i.zpp_inner.inner=t,n&&(i.zpp_inner.immutable=!0),i.zpp_inner.zip_length=!0,i},t.util.ZPP_ContactList.prototype.outer=null,t.util.ZPP_ContactList.prototype.inner=null,t.util.ZPP_ContactList.prototype.immutable=null,t.util.ZPP_ContactList.prototype._invalidated=null,t.util.ZPP_ContactList.prototype._invalidate=null,t.util.ZPP_ContactList.prototype._validate=null,t.util.ZPP_ContactList.prototype._modifiable=null,t.util.ZPP_ContactList.prototype.adder=null,t.util.ZPP_ContactList.prototype.post_adder=null,t.util.ZPP_ContactList.prototype.subber=null,t.util.ZPP_ContactList.prototype.dontremove=null,t.util.ZPP_ContactList.prototype.reverse_flag=null,t.util.ZPP_ContactList.prototype.valmod=function(){this.validate(),this.inner.modified&&(this.inner.pushmod&&(this.push_ite=null),this.at_ite=null,this.inner.modified=!1,this.inner.pushmod=!1,this.zip_length=!0)},t.util.ZPP_ContactList.prototype.modified=function(){this.zip_length=!0,this.at_ite=null,this.push_ite=null},t.util.ZPP_ContactList.prototype.modify_test=function(){null!=this._modifiable&&this._modifiable()},t.util.ZPP_ContactList.prototype.validate=function(){this._invalidated&&(this._invalidated=!1,null!=this._validate&&this._validate())},t.util.ZPP_ContactList.prototype.invalidate=function(){this._invalidated=!0,null!=this._invalidate&&this._invalidate(this)},t.util.ZPP_ContactList.prototype.at_index=null,t.util.ZPP_ContactList.prototype.at_ite=null,t.util.ZPP_ContactList.prototype.push_ite=null,t.util.ZPP_ContactList.prototype.zip_length=null,t.util.ZPP_ContactList.prototype.user_length=null,t.util.ZPP_ContactList.prototype.__class__=t.util.ZPP_ContactList,t.util.ZPP_Math=l["zpp_nape.util.ZPP_Math"]=function(){},t.util.ZPP_Math.__name__=["zpp_nape","util","ZPP_Math"],t.util.ZPP_Math.sqrt=function(e){return Math.sqrt(e)},t.util.ZPP_Math.invsqrt=function(e){return 1/Math.sqrt(e)},t.util.ZPP_Math.sqr=function(e){return e*e},t.util.ZPP_Math.clamp2=function(e,t){var n=-t;return e<n?n:e>t?t:e},t.util.ZPP_Math.clamp=function(e,t,n){return e<t?t:e>n?n:e},t.util.ZPP_Math.prototype.__class__=t.util.ZPP_Math,t.util.ZPP_PubPool=l["zpp_nape.util.ZPP_PubPool"]=function(){},t.util.ZPP_PubPool.__name__=["zpp_nape","util","ZPP_PubPool"],t.util.ZPP_PubPool.prototype.__class__=t.util.ZPP_PubPool,t.util.ZPP_Set_ZPP_Body=l["zpp_nape.util.ZPP_Set_ZPP_Body"]=function(){this.colour=0,this.parent=null,this.next=null,this.prev=null,this.data=null,this.swapped=null,this.lt=null},t.util.ZPP_Set_ZPP_Body.__name__=["zpp_nape","util","ZPP_Set_ZPP_Body"],t.util.ZPP_Set_ZPP_Body.prototype.free=function(){this.data=null,this.lt=null,this.swapped=null},t.util.ZPP_Set_ZPP_Body.prototype.alloc=function(){},t.util.ZPP_Set_ZPP_Body.prototype.lt=null,t.util.ZPP_Set_ZPP_Body.prototype.swapped=null,t.util.ZPP_Set_ZPP_Body.prototype.data=null,t.util.ZPP_Set_ZPP_Body.prototype.prev=null,t.util.ZPP_Set_ZPP_Body.prototype.next=null,t.util.ZPP_Set_ZPP_Body.prototype.parent=null,t.util.ZPP_Set_ZPP_Body.prototype.colour=null,t.util.ZPP_Set_ZPP_Body.prototype.verify=function(){if(!this.empty()){for(var e=this.parent;null!=e.prev;)e=e.prev;for(;null!=e;){var t=e.data,n=!0;if(!this.empty()){for(var i=this.parent;null!=i.prev;)i=i.prev;for(;null!=i;){var r=i.data;if(n){if(t==r)n=!1;else if(!this.lt(r,t)&&this.lt(t,r))return!1}else if(!this.lt(t,r)&&this.lt(r,t))return!1;if(null!=i.next)for(i=i.next;null!=i.prev;)i=i.prev;else{for(;null!=i.parent&&i==i.parent.next;)i=i.parent;i=i.parent}}}if(null!=e.next)for(e=e.next;null!=e.prev;)e=e.prev;else{for(;null!=e.parent&&e==e.parent.next;)e=e.parent;e=e.parent}}}return!0},t.util.ZPP_Set_ZPP_Body.prototype.empty=function(){return null==this.parent},t.util.ZPP_Set_ZPP_Body.prototype.singular=function(){return null!=this.parent&&null==this.parent.prev&&null==this.parent.next},t.util.ZPP_Set_ZPP_Body.prototype.size=function(){var e=0;if(!this.empty()){for(var t=this.parent;null!=t.prev;)t=t.prev;for(;null!=t;)if(t.data,++e,null!=t.next)for(t=t.next;null!=t.prev;)t=t.prev;else{for(;null!=t.parent&&t==t.parent.next;)t=t.parent;t=t.parent}}return e},t.util.ZPP_Set_ZPP_Body.prototype.has=function(e){return null!=this.find(e)},t.util.ZPP_Set_ZPP_Body.prototype.find=function(e){for(var t=this.parent;null!=t&&t.data!=e;)t=this.lt(e,t.data)?t.prev:t.next;return t},t.util.ZPP_Set_ZPP_Body.prototype.has_weak=function(e){return null!=this.find_weak(e)},t.util.ZPP_Set_ZPP_Body.prototype.find_weak=function(e){for(var t=this.parent;null!=t;)if(this.lt(e,t.data))t=t.prev;else{if(!this.lt(t.data,e))break;t=t.next}return t},t.util.ZPP_Set_ZPP_Body.prototype.lower_bound=function(e){var t=null;if(!this.empty()){for(var n=this.parent;null!=n.prev;)n=n.prev;for(;null!=n;){var i=n.data;if(!this.lt(i,e)){t=i;break}if(null!=n.next)for(n=n.next;null!=n.prev;)n=n.prev;else{for(;null!=n.parent&&n==n.parent.next;)n=n.parent;n=n.parent}}}return t},t.util.ZPP_Set_ZPP_Body.prototype.first=function(){for(var e=this.parent;null!=e.prev;)e=e.prev;return e.data},t.util.ZPP_Set_ZPP_Body.prototype.pop_front=function(){for(var e=this.parent;null!=e.prev;)e=e.prev;var t=e.data;return this.remove_node(e),t},t.util.ZPP_Set_ZPP_Body.prototype.remove=function(e){var t=this.find(e);this.remove_node(t)},t.util.ZPP_Set_ZPP_Body.prototype.successor_node=function(e){if(null!=e.next)for(e=e.next;null!=e.prev;)e=e.prev;else{var t=e;for(e=e.parent;null!=e&&e.prev!=t;)t=e,e=e.parent}return e},t.util.ZPP_Set_ZPP_Body.prototype.predecessor_node=function(e){if(null!=e.prev)for(e=e.prev;null!=e.next;)e=e.next;else{var t=e;for(e=e.parent;null!=e&&e.next!=t;)t=e,e=e.parent}return e},t.util.ZPP_Set_ZPP_Body.prototype.successor=function(e){var t=this.successor_node(this.find(e));return null==t?null:t.data},t.util.ZPP_Set_ZPP_Body.prototype.predecessor=function(e){var t=this.predecessor_node(this.find(e));return null==t?null:t.data},t.util.ZPP_Set_ZPP_Body.prototype.remove_node=function(e){if(null!=e.next&&null!=e.prev){for(var n=e.next;null!=n.prev;)n=n.prev;var i=e.data;e.data=n.data,n.data=i,null!=this.swapped&&this.swapped(e.data,n.data),e=n}var r=null==e.prev?e.next:e.prev;if(1==e.colour)if(null!=e.prev||null!=e.next)r.colour=1;else if(null!=e.parent)for(var o=e.parent;;){o.colour++,o.prev.colour--,o.next.colour--;var a=o.prev;if(-1==a.colour){this.__fix_neg_red(a);break}if(0==a.colour){if(null!=a.prev&&0==a.prev.colour){this.__fix_dbl_red(a.prev);break}if(null!=a.next&&0==a.next.colour){this.__fix_dbl_red(a.next);break}}var s=o.next;if(-1==s.colour){this.__fix_neg_red(s);break}if(0==s.colour){if(null!=s.prev&&0==s.prev.colour){this.__fix_dbl_red(s.prev);break}if(null!=s.next&&0==s.next.colour){this.__fix_dbl_red(s.next);break}}if(2==o.colour){if(null!=o.parent){o=o.parent;continue}o.colour=1}break}var l=e.parent;null==l?this.parent=r:l.prev==e?l.prev=r:l.next=r,null!=r&&(r.parent=l),e.parent=e.prev=e.next=null;var p=e;p.data=null,p.lt=null,p.swapped=null,p.next=t.util.ZPP_Set_ZPP_Body.zpp_pool,t.util.ZPP_Set_ZPP_Body.zpp_pool=p},t.util.ZPP_Set_ZPP_Body.prototype.clear=function(){if(null!=this.parent){for(var e=this.parent;null!=e;)if(null!=e.prev)e=e.prev;else if(null!=e.next)e=e.next;else{var n=e.parent;null!=n&&(e==n.prev?n.prev=null:n.next=null,e.parent=null);var i=e;i.data=null,i.lt=null,i.swapped=null,i.next=t.util.ZPP_Set_ZPP_Body.zpp_pool,t.util.ZPP_Set_ZPP_Body.zpp_pool=i,e=n}this.parent=null}},t.util.ZPP_Set_ZPP_Body.prototype.clear_with=function(e){if(null!=this.parent){for(var n=this.parent;null!=n;)if(null!=n.prev)n=n.prev;else if(null!=n.next)n=n.next;else{e(n.data);var i=n.parent;null!=i&&(n==i.prev?i.prev=null:i.next=null,n.parent=null);var r=n;r.data=null,r.lt=null,r.swapped=null,r.next=t.util.ZPP_Set_ZPP_Body.zpp_pool,t.util.ZPP_Set_ZPP_Body.zpp_pool=r,n=i}this.parent=null}},t.util.ZPP_Set_ZPP_Body.prototype.clear_node=function(e,n){n(e.data);var i=e.parent;null!=i&&(e==i.prev?i.prev=null:i.next=null,e.parent=null);var r=e;return r.data=null,r.lt=null,r.swapped=null,r.next=t.util.ZPP_Set_ZPP_Body.zpp_pool,t.util.ZPP_Set_ZPP_Body.zpp_pool=r,i},t.util.ZPP_Set_ZPP_Body.prototype.__fix_neg_red=function(e){var t,n=e.parent;if(n.prev==e){var i=e.prev,r=e.next,o=r.prev,a=r.next;i.colour=0,e.colour=n.colour=1,e.next=o,null!=o&&(o.parent=e);var s=n.data;n.data=r.data,r.data=s,null!=this.swapped&&this.swapped(n.data,r.data),r.prev=a,null!=a&&(a.parent=r),r.next=n.next,null!=n.next&&(n.next.parent=r),n.next=r,null!=r&&(r.parent=n),t=i}else{var l=e.next,p=e.prev,u=p.next,h=p.prev;l.colour=0,e.colour=n.colour=1,e.prev=u,null!=u&&(u.parent=e);var c=n.data;n.data=p.data,p.data=c,null!=this.swapped&&this.swapped(n.data,p.data),p.next=h,null!=h&&(h.parent=p),p.prev=n.prev,null!=n.prev&&(n.prev.parent=p),n.prev=p,null!=p&&(p.parent=n),t=l}null!=t.prev&&0==t.prev.colour?this.__fix_dbl_red(t.prev):null!=t.next&&0==t.next.colour&&this.__fix_dbl_red(t.next)},t.util.ZPP_Set_ZPP_Body.prototype.__fix_dbl_red=function(e){for(;;){var t,n,i,r,o,a,s,l=e.parent,p=l.parent;if(null==p){l.colour=1;break}l==p.prev?(i=p,s=p.next,e==l.prev?(t=e,n=l,r=e.prev,o=e.next,a=l.next):(t=l,n=e,r=l.prev,o=e.prev,a=e.next)):(t=p,r=p.prev,e==l.prev?(n=e,i=l,o=e.prev,a=e.next,s=l.next):(n=l,i=e,o=l.prev,a=e.prev,s=e.next));var u=p.parent;if(null==u?this.parent=n:u.prev==p?u.prev=n:u.next=n,null!=n&&(n.parent=u),t.prev=r,null!=r&&(r.parent=t),t.next=o,null!=o&&(o.parent=t),n.prev=t,null!=t&&(t.parent=n),n.next=i,null!=i&&(i.parent=n),i.prev=a,null!=a&&(a.parent=i),i.next=s,null!=s&&(s.parent=i),n.colour=p.colour-1,t.colour=1,i.colour=1,n==this.parent)this.parent.colour=1;else if(0==n.colour&&0==n.parent.colour){e=n;continue}break}},t.util.ZPP_Set_ZPP_Body.prototype.try_insert_bool=function(e){var n=null,i=null;if(null==this.parent)null==t.util.ZPP_Set_ZPP_Body.zpp_pool?n=new t.util.ZPP_Set_ZPP_Body:(n=t.util.ZPP_Set_ZPP_Body.zpp_pool,t.util.ZPP_Set_ZPP_Body.zpp_pool=n.next,n.next=null),n.data=e,this.parent=n;else for(i=this.parent;;)if(this.lt(e,i.data)){if(null==i.prev){null==t.util.ZPP_Set_ZPP_Body.zpp_pool?n=new t.util.ZPP_Set_ZPP_Body:(n=t.util.ZPP_Set_ZPP_Body.zpp_pool,t.util.ZPP_Set_ZPP_Body.zpp_pool=n.next,n.next=null),n.data=e,i.prev=n,n.parent=i;break}i=i.prev}else{if(!this.lt(i.data,e))break;if(null==i.next){null==t.util.ZPP_Set_ZPP_Body.zpp_pool?n=new t.util.ZPP_Set_ZPP_Body:(n=t.util.ZPP_Set_ZPP_Body.zpp_pool,t.util.ZPP_Set_ZPP_Body.zpp_pool=n.next,n.next=null),n.data=e,i.next=n,n.parent=i;break}i=i.next}return null!=n&&(null==n.parent?n.colour=1:(n.colour=0,0==n.parent.colour&&this.__fix_dbl_red(n)),!0)},t.util.ZPP_Set_ZPP_Body.prototype.try_insert=function(e){var n=null,i=null;if(null==this.parent)null==t.util.ZPP_Set_ZPP_Body.zpp_pool?n=new t.util.ZPP_Set_ZPP_Body:(n=t.util.ZPP_Set_ZPP_Body.zpp_pool,t.util.ZPP_Set_ZPP_Body.zpp_pool=n.next,n.next=null),n.data=e,this.parent=n;else for(i=this.parent;;)if(this.lt(e,i.data)){if(null==i.prev){null==t.util.ZPP_Set_ZPP_Body.zpp_pool?n=new t.util.ZPP_Set_ZPP_Body:(n=t.util.ZPP_Set_ZPP_Body.zpp_pool,t.util.ZPP_Set_ZPP_Body.zpp_pool=n.next,n.next=null),n.data=e,i.prev=n,n.parent=i;break}i=i.prev}else{if(!this.lt(i.data,e))break;if(null==i.next){null==t.util.ZPP_Set_ZPP_Body.zpp_pool?n=new t.util.ZPP_Set_ZPP_Body:(n=t.util.ZPP_Set_ZPP_Body.zpp_pool,t.util.ZPP_Set_ZPP_Body.zpp_pool=n.next,n.next=null),n.data=e,i.next=n,n.parent=i;break}i=i.next}return null==n?i:(null==n.parent?n.colour=1:(n.colour=0,0==n.parent.colour&&this.__fix_dbl_red(n)),n)},t.util.ZPP_Set_ZPP_Body.prototype.insert=function(e){var n;if(null==t.util.ZPP_Set_ZPP_Body.zpp_pool?n=new t.util.ZPP_Set_ZPP_Body:(n=t.util.ZPP_Set_ZPP_Body.zpp_pool,t.util.ZPP_Set_ZPP_Body.zpp_pool=n.next,n.next=null),n.data=e,null==this.parent)this.parent=n;else for(var i=this.parent;;)if(this.lt(n.data,i.data)){if(null==i.prev){i.prev=n,n.parent=i;break}i=i.prev}else{if(null==i.next){i.next=n,n.parent=i;break}i=i.next}return null==n.parent?n.colour=1:(n.colour=0,0==n.parent.colour&&this.__fix_dbl_red(n)),n},t.util.ZPP_Set_ZPP_Body.prototype.__class__=t.util.ZPP_Set_ZPP_Body,t.util.ZPP_Set_ZPP_CbSetPair=l["zpp_nape.util.ZPP_Set_ZPP_CbSetPair"]=function(){this.colour=0,this.parent=null,this.next=null,this.prev=null,this.data=null,this.swapped=null,this.lt=null},t.util.ZPP_Set_ZPP_CbSetPair.__name__=["zpp_nape","util","ZPP_Set_ZPP_CbSetPair"],t.util.ZPP_Set_ZPP_CbSetPair.prototype.free=function(){this.data=null,this.lt=null,this.swapped=null},t.util.ZPP_Set_ZPP_CbSetPair.prototype.alloc=function(){},t.util.ZPP_Set_ZPP_CbSetPair.prototype.lt=null,t.util.ZPP_Set_ZPP_CbSetPair.prototype.swapped=null,t.util.ZPP_Set_ZPP_CbSetPair.prototype.data=null,t.util.ZPP_Set_ZPP_CbSetPair.prototype.prev=null,t.util.ZPP_Set_ZPP_CbSetPair.prototype.next=null,t.util.ZPP_Set_ZPP_CbSetPair.prototype.parent=null,t.util.ZPP_Set_ZPP_CbSetPair.prototype.colour=null,t.util.ZPP_Set_ZPP_CbSetPair.prototype.verify=function(){if(!this.empty()){for(var e=this.parent;null!=e.prev;)e=e.prev;for(;null!=e;){var t=e.data,n=!0;if(!this.empty()){for(var i=this.parent;null!=i.prev;)i=i.prev;for(;null!=i;){var r=i.data;if(n){if(t==r)n=!1;else if(!this.lt(r,t)&&this.lt(t,r))return!1}else if(!this.lt(t,r)&&this.lt(r,t))return!1;if(null!=i.next)for(i=i.next;null!=i.prev;)i=i.prev;else{for(;null!=i.parent&&i==i.parent.next;)i=i.parent;i=i.parent}}}if(null!=e.next)for(e=e.next;null!=e.prev;)e=e.prev;else{for(;null!=e.parent&&e==e.parent.next;)e=e.parent;e=e.parent}}}return!0},t.util.ZPP_Set_ZPP_CbSetPair.prototype.empty=function(){return null==this.parent},t.util.ZPP_Set_ZPP_CbSetPair.prototype.singular=function(){return null!=this.parent&&null==this.parent.prev&&null==this.parent.next},t.util.ZPP_Set_ZPP_CbSetPair.prototype.size=function(){var e=0;if(!this.empty()){for(var t=this.parent;null!=t.prev;)t=t.prev;for(;null!=t;)if(t.data,++e,null!=t.next)for(t=t.next;null!=t.prev;)t=t.prev;else{for(;null!=t.parent&&t==t.parent.next;)t=t.parent;t=t.parent}}return e},t.util.ZPP_Set_ZPP_CbSetPair.prototype.has=function(e){return null!=this.find(e)},t.util.ZPP_Set_ZPP_CbSetPair.prototype.find=function(e){for(var t=this.parent;null!=t&&t.data!=e;)t=this.lt(e,t.data)?t.prev:t.next;return t},t.util.ZPP_Set_ZPP_CbSetPair.prototype.has_weak=function(e){return null!=this.find_weak(e)},t.util.ZPP_Set_ZPP_CbSetPair.prototype.find_weak=function(e){for(var t=this.parent;null!=t;)if(this.lt(e,t.data))t=t.prev;else{if(!this.lt(t.data,e))break;t=t.next}return t},t.util.ZPP_Set_ZPP_CbSetPair.prototype.lower_bound=function(e){var t=null;if(!this.empty()){for(var n=this.parent;null!=n.prev;)n=n.prev;for(;null!=n;){var i=n.data;if(!this.lt(i,e)){t=i;break}if(null!=n.next)for(n=n.next;null!=n.prev;)n=n.prev;else{for(;null!=n.parent&&n==n.parent.next;)n=n.parent;n=n.parent}}}return t},t.util.ZPP_Set_ZPP_CbSetPair.prototype.first=function(){for(var e=this.parent;null!=e.prev;)e=e.prev;return e.data},t.util.ZPP_Set_ZPP_CbSetPair.prototype.pop_front=function(){for(var e=this.parent;null!=e.prev;)e=e.prev;var t=e.data;return this.remove_node(e),t},t.util.ZPP_Set_ZPP_CbSetPair.prototype.remove=function(e){var t=this.find(e);this.remove_node(t)},t.util.ZPP_Set_ZPP_CbSetPair.prototype.successor_node=function(e){if(null!=e.next)for(e=e.next;null!=e.prev;)e=e.prev;else{var t=e;for(e=e.parent;null!=e&&e.prev!=t;)t=e,e=e.parent}return e},t.util.ZPP_Set_ZPP_CbSetPair.prototype.predecessor_node=function(e){if(null!=e.prev)for(e=e.prev;null!=e.next;)e=e.next;else{var t=e;for(e=e.parent;null!=e&&e.next!=t;)t=e,e=e.parent}return e},t.util.ZPP_Set_ZPP_CbSetPair.prototype.successor=function(e){var t=this.successor_node(this.find(e));return null==t?null:t.data},t.util.ZPP_Set_ZPP_CbSetPair.prototype.predecessor=function(e){var t=this.predecessor_node(this.find(e));return null==t?null:t.data},t.util.ZPP_Set_ZPP_CbSetPair.prototype.remove_node=function(e){if(null!=e.next&&null!=e.prev){for(var n=e.next;null!=n.prev;)n=n.prev;var i=e.data;e.data=n.data,n.data=i,null!=this.swapped&&this.swapped(e.data,n.data),e=n}var r=null==e.prev?e.next:e.prev;if(1==e.colour)if(null!=e.prev||null!=e.next)r.colour=1;else if(null!=e.parent)for(var o=e.parent;;){o.colour++,o.prev.colour--,o.next.colour--;var a=o.prev;if(-1==a.colour){this.__fix_neg_red(a);break}if(0==a.colour){if(null!=a.prev&&0==a.prev.colour){this.__fix_dbl_red(a.prev);break}if(null!=a.next&&0==a.next.colour){this.__fix_dbl_red(a.next);break}}var s=o.next;if(-1==s.colour){this.__fix_neg_red(s);break}if(0==s.colour){if(null!=s.prev&&0==s.prev.colour){this.__fix_dbl_red(s.prev);break}if(null!=s.next&&0==s.next.colour){this.__fix_dbl_red(s.next);break}}if(2==o.colour){if(null!=o.parent){o=o.parent;continue}o.colour=1}break}var l=e.parent;null==l?this.parent=r:l.prev==e?l.prev=r:l.next=r,null!=r&&(r.parent=l),e.parent=e.prev=e.next=null;var p=e;p.data=null,p.lt=null,p.swapped=null,p.next=t.util.ZPP_Set_ZPP_CbSetPair.zpp_pool,t.util.ZPP_Set_ZPP_CbSetPair.zpp_pool=p},t.util.ZPP_Set_ZPP_CbSetPair.prototype.clear=function(){if(null!=this.parent){for(var e=this.parent;null!=e;)if(null!=e.prev)e=e.prev;else if(null!=e.next)e=e.next;else{var n=e.parent;null!=n&&(e==n.prev?n.prev=null:n.next=null,e.parent=null);var i=e;i.data=null,i.lt=null,i.swapped=null,i.next=t.util.ZPP_Set_ZPP_CbSetPair.zpp_pool,t.util.ZPP_Set_ZPP_CbSetPair.zpp_pool=i,e=n}this.parent=null}},t.util.ZPP_Set_ZPP_CbSetPair.prototype.clear_with=function(e){if(null!=this.parent){for(var n=this.parent;null!=n;)if(null!=n.prev)n=n.prev;else if(null!=n.next)n=n.next;else{e(n.data);var i=n.parent;null!=i&&(n==i.prev?i.prev=null:i.next=null,n.parent=null);var r=n;r.data=null,r.lt=null,r.swapped=null,r.next=t.util.ZPP_Set_ZPP_CbSetPair.zpp_pool,t.util.ZPP_Set_ZPP_CbSetPair.zpp_pool=r,n=i}this.parent=null}},t.util.ZPP_Set_ZPP_CbSetPair.prototype.clear_node=function(e,n){n(e.data);var i=e.parent;null!=i&&(e==i.prev?i.prev=null:i.next=null,e.parent=null);var r=e;return r.data=null,r.lt=null,r.swapped=null,r.next=t.util.ZPP_Set_ZPP_CbSetPair.zpp_pool,t.util.ZPP_Set_ZPP_CbSetPair.zpp_pool=r,i},t.util.ZPP_Set_ZPP_CbSetPair.prototype.__fix_neg_red=function(e){var t,n=e.parent;if(n.prev==e){var i=e.prev,r=e.next,o=r.prev,a=r.next;i.colour=0,e.colour=n.colour=1,e.next=o,null!=o&&(o.parent=e);var s=n.data;n.data=r.data,r.data=s,null!=this.swapped&&this.swapped(n.data,r.data),r.prev=a,null!=a&&(a.parent=r),r.next=n.next,null!=n.next&&(n.next.parent=r),n.next=r,null!=r&&(r.parent=n),t=i}else{var l=e.next,p=e.prev,u=p.next,h=p.prev;l.colour=0,e.colour=n.colour=1,e.prev=u,null!=u&&(u.parent=e);var c=n.data;n.data=p.data,p.data=c,null!=this.swapped&&this.swapped(n.data,p.data),p.next=h,null!=h&&(h.parent=p),p.prev=n.prev,null!=n.prev&&(n.prev.parent=p),n.prev=p,null!=p&&(p.parent=n),t=l}null!=t.prev&&0==t.prev.colour?this.__fix_dbl_red(t.prev):null!=t.next&&0==t.next.colour&&this.__fix_dbl_red(t.next)},t.util.ZPP_Set_ZPP_CbSetPair.prototype.__fix_dbl_red=function(e){for(;;){var t,n,i,r,o,a,s,l=e.parent,p=l.parent;if(null==p){l.colour=1;break}l==p.prev?(i=p,s=p.next,e==l.prev?(t=e,n=l,r=e.prev,o=e.next,a=l.next):(t=l,n=e,r=l.prev,o=e.prev,a=e.next)):(t=p,r=p.prev,e==l.prev?(n=e,i=l,o=e.prev,a=e.next,s=l.next):(n=l,i=e,o=l.prev,a=e.prev,s=e.next));var u=p.parent;if(null==u?this.parent=n:u.prev==p?u.prev=n:u.next=n,null!=n&&(n.parent=u),t.prev=r,null!=r&&(r.parent=t),t.next=o,null!=o&&(o.parent=t),n.prev=t,null!=t&&(t.parent=n),n.next=i,null!=i&&(i.parent=n),i.prev=a,null!=a&&(a.parent=i),i.next=s,null!=s&&(s.parent=i),n.colour=p.colour-1,t.colour=1,i.colour=1,n==this.parent)this.parent.colour=1;else if(0==n.colour&&0==n.parent.colour){e=n;continue}break}},t.util.ZPP_Set_ZPP_CbSetPair.prototype.try_insert_bool=function(e){var n=null,i=null;if(null==this.parent)null==t.util.ZPP_Set_ZPP_CbSetPair.zpp_pool?n=new t.util.ZPP_Set_ZPP_CbSetPair:(n=t.util.ZPP_Set_ZPP_CbSetPair.zpp_pool,t.util.ZPP_Set_ZPP_CbSetPair.zpp_pool=n.next,n.next=null),n.data=e,this.parent=n;else for(i=this.parent;;)if(this.lt(e,i.data)){if(null==i.prev){null==t.util.ZPP_Set_ZPP_CbSetPair.zpp_pool?n=new t.util.ZPP_Set_ZPP_CbSetPair:(n=t.util.ZPP_Set_ZPP_CbSetPair.zpp_pool,t.util.ZPP_Set_ZPP_CbSetPair.zpp_pool=n.next,n.next=null),n.data=e,i.prev=n,n.parent=i;break}i=i.prev}else{if(!this.lt(i.data,e))break;if(null==i.next){null==t.util.ZPP_Set_ZPP_CbSetPair.zpp_pool?n=new t.util.ZPP_Set_ZPP_CbSetPair:(n=t.util.ZPP_Set_ZPP_CbSetPair.zpp_pool,t.util.ZPP_Set_ZPP_CbSetPair.zpp_pool=n.next,n.next=null),n.data=e,i.next=n,n.parent=i;break}i=i.next}return null!=n&&(null==n.parent?n.colour=1:(n.colour=0,0==n.parent.colour&&this.__fix_dbl_red(n)),!0)},t.util.ZPP_Set_ZPP_CbSetPair.prototype.try_insert=function(e){var n=null,i=null;if(null==this.parent)null==t.util.ZPP_Set_ZPP_CbSetPair.zpp_pool?n=new t.util.ZPP_Set_ZPP_CbSetPair:(n=t.util.ZPP_Set_ZPP_CbSetPair.zpp_pool,t.util.ZPP_Set_ZPP_CbSetPair.zpp_pool=n.next,n.next=null),n.data=e,this.parent=n;else for(i=this.parent;;)if(this.lt(e,i.data)){if(null==i.prev){null==t.util.ZPP_Set_ZPP_CbSetPair.zpp_pool?n=new t.util.ZPP_Set_ZPP_CbSetPair:(n=t.util.ZPP_Set_ZPP_CbSetPair.zpp_pool,t.util.ZPP_Set_ZPP_CbSetPair.zpp_pool=n.next,n.next=null),n.data=e,i.prev=n,n.parent=i;break}i=i.prev}else{if(!this.lt(i.data,e))break;if(null==i.next){null==t.util.ZPP_Set_ZPP_CbSetPair.zpp_pool?n=new t.util.ZPP_Set_ZPP_CbSetPair:(n=t.util.ZPP_Set_ZPP_CbSetPair.zpp_pool,t.util.ZPP_Set_ZPP_CbSetPair.zpp_pool=n.next,n.next=null),n.data=e,i.next=n,n.parent=i;break}i=i.next}return null==n?i:(null==n.parent?n.colour=1:(n.colour=0,0==n.parent.colour&&this.__fix_dbl_red(n)),n)},t.util.ZPP_Set_ZPP_CbSetPair.prototype.insert=function(e){var n;if(null==t.util.ZPP_Set_ZPP_CbSetPair.zpp_pool?n=new t.util.ZPP_Set_ZPP_CbSetPair:(n=t.util.ZPP_Set_ZPP_CbSetPair.zpp_pool,t.util.ZPP_Set_ZPP_CbSetPair.zpp_pool=n.next,n.next=null),n.data=e,null==this.parent)this.parent=n;else for(var i=this.parent;;)if(this.lt(n.data,i.data)){if(null==i.prev){i.prev=n,n.parent=i;break}i=i.prev}else{if(null==i.next){i.next=n,n.parent=i;break}i=i.next}return null==n.parent?n.colour=1:(n.colour=0,0==n.parent.colour&&this.__fix_dbl_red(n)),n},t.util.ZPP_Set_ZPP_CbSetPair.prototype.__class__=t.util.ZPP_Set_ZPP_CbSetPair,t.util.ZPP_Set_ZPP_PartitionVertex=l["zpp_nape.util.ZPP_Set_ZPP_PartitionVertex"]=function(){this.colour=0,this.parent=null,this.next=null,this.prev=null,this.data=null,this.swapped=null,this.lt=null},t.util.ZPP_Set_ZPP_PartitionVertex.__name__=["zpp_nape","util","ZPP_Set_ZPP_PartitionVertex"],t.util.ZPP_Set_ZPP_PartitionVertex.prototype.free=function(){this.data=null,this.lt=null,this.swapped=null},t.util.ZPP_Set_ZPP_PartitionVertex.prototype.alloc=function(){},t.util.ZPP_Set_ZPP_PartitionVertex.prototype.lt=null,t.util.ZPP_Set_ZPP_PartitionVertex.prototype.swapped=null,t.util.ZPP_Set_ZPP_PartitionVertex.prototype.data=null,t.util.ZPP_Set_ZPP_PartitionVertex.prototype.prev=null,t.util.ZPP_Set_ZPP_PartitionVertex.prototype.next=null,t.util.ZPP_Set_ZPP_PartitionVertex.prototype.parent=null,t.util.ZPP_Set_ZPP_PartitionVertex.prototype.colour=null,t.util.ZPP_Set_ZPP_PartitionVertex.prototype.verify=function(){if(!this.empty()){for(var e=this.parent;null!=e.prev;)e=e.prev;for(;null!=e;){var t=e.data,n=!0;if(!this.empty()){for(var i=this.parent;null!=i.prev;)i=i.prev;for(;null!=i;){var r=i.data;if(n){if(t==r)n=!1;else if(!this.lt(r,t)&&this.lt(t,r))return!1}else if(!this.lt(t,r)&&this.lt(r,t))return!1;if(null!=i.next)for(i=i.next;null!=i.prev;)i=i.prev;else{for(;null!=i.parent&&i==i.parent.next;)i=i.parent;i=i.parent}}}if(null!=e.next)for(e=e.next;null!=e.prev;)e=e.prev;else{for(;null!=e.parent&&e==e.parent.next;)e=e.parent;e=e.parent}}}return!0},t.util.ZPP_Set_ZPP_PartitionVertex.prototype.empty=function(){return null==this.parent},t.util.ZPP_Set_ZPP_PartitionVertex.prototype.singular=function(){return null!=this.parent&&null==this.parent.prev&&null==this.parent.next},t.util.ZPP_Set_ZPP_PartitionVertex.prototype.size=function(){var e=0;if(!this.empty()){for(var t=this.parent;null!=t.prev;)t=t.prev;for(;null!=t;)if(t.data,++e,null!=t.next)for(t=t.next;null!=t.prev;)t=t.prev;else{for(;null!=t.parent&&t==t.parent.next;)t=t.parent;t=t.parent}}return e},t.util.ZPP_Set_ZPP_PartitionVertex.prototype.has=function(e){return null!=this.find(e)},t.util.ZPP_Set_ZPP_PartitionVertex.prototype.find=function(e){for(var t=this.parent;null!=t&&t.data!=e;)t=this.lt(e,t.data)?t.prev:t.next;return t},t.util.ZPP_Set_ZPP_PartitionVertex.prototype.has_weak=function(e){return null!=this.find_weak(e)},t.util.ZPP_Set_ZPP_PartitionVertex.prototype.find_weak=function(e){for(var t=this.parent;null!=t;)if(this.lt(e,t.data))t=t.prev;else{if(!this.lt(t.data,e))break;t=t.next}return t},t.util.ZPP_Set_ZPP_PartitionVertex.prototype.lower_bound=function(e){var t=null;if(!this.empty()){for(var n=this.parent;null!=n.prev;)n=n.prev;for(;null!=n;){var i=n.data;if(!this.lt(i,e)){t=i;break}if(null!=n.next)for(n=n.next;null!=n.prev;)n=n.prev;else{for(;null!=n.parent&&n==n.parent.next;)n=n.parent;n=n.parent}}}return t},t.util.ZPP_Set_ZPP_PartitionVertex.prototype.first=function(){for(var e=this.parent;null!=e.prev;)e=e.prev;return e.data},t.util.ZPP_Set_ZPP_PartitionVertex.prototype.pop_front=function(){for(var e=this.parent;null!=e.prev;)e=e.prev;var t=e.data;return this.remove_node(e),t},t.util.ZPP_Set_ZPP_PartitionVertex.prototype.remove=function(e){var t=this.find(e);this.remove_node(t)},t.util.ZPP_Set_ZPP_PartitionVertex.prototype.successor_node=function(e){if(null!=e.next)for(e=e.next;null!=e.prev;)e=e.prev;else{var t=e;for(e=e.parent;null!=e&&e.prev!=t;)t=e,e=e.parent}return e},t.util.ZPP_Set_ZPP_PartitionVertex.prototype.predecessor_node=function(e){if(null!=e.prev)for(e=e.prev;null!=e.next;)e=e.next;else{var t=e;for(e=e.parent;null!=e&&e.next!=t;)t=e,e=e.parent}return e},t.util.ZPP_Set_ZPP_PartitionVertex.prototype.successor=function(e){var t=this.successor_node(this.find(e));return null==t?null:t.data},t.util.ZPP_Set_ZPP_PartitionVertex.prototype.predecessor=function(e){var t=this.predecessor_node(this.find(e));return null==t?null:t.data},t.util.ZPP_Set_ZPP_PartitionVertex.prototype.remove_node=function(e){if(null!=e.next&&null!=e.prev){for(var n=e.next;null!=n.prev;)n=n.prev;var i=e.data;e.data=n.data,n.data=i,null!=this.swapped&&this.swapped(e.data,n.data),e=n}var r=null==e.prev?e.next:e.prev;if(1==e.colour)if(null!=e.prev||null!=e.next)r.colour=1;else if(null!=e.parent)for(var o=e.parent;;){o.colour++,o.prev.colour--,o.next.colour--;var a=o.prev;if(-1==a.colour){this.__fix_neg_red(a);break}if(0==a.colour){if(null!=a.prev&&0==a.prev.colour){this.__fix_dbl_red(a.prev);break}if(null!=a.next&&0==a.next.colour){this.__fix_dbl_red(a.next);break}}var s=o.next;if(-1==s.colour){this.__fix_neg_red(s);break}if(0==s.colour){if(null!=s.prev&&0==s.prev.colour){this.__fix_dbl_red(s.prev);break}if(null!=s.next&&0==s.next.colour){this.__fix_dbl_red(s.next);break}}if(2==o.colour){if(null!=o.parent){o=o.parent;continue}o.colour=1}break}var l=e.parent;null==l?this.parent=r:l.prev==e?l.prev=r:l.next=r,null!=r&&(r.parent=l),e.parent=e.prev=e.next=null;var p=e;p.data=null,p.lt=null,p.swapped=null,p.next=t.util.ZPP_Set_ZPP_PartitionVertex.zpp_pool,t.util.ZPP_Set_ZPP_PartitionVertex.zpp_pool=p},t.util.ZPP_Set_ZPP_PartitionVertex.prototype.clear=function(){if(null!=this.parent){for(var e=this.parent;null!=e;)if(null!=e.prev)e=e.prev;else if(null!=e.next)e=e.next;else{var n=e.parent;null!=n&&(e==n.prev?n.prev=null:n.next=null,e.parent=null);var i=e;i.data=null,i.lt=null,i.swapped=null,i.next=t.util.ZPP_Set_ZPP_PartitionVertex.zpp_pool,t.util.ZPP_Set_ZPP_PartitionVertex.zpp_pool=i,e=n}this.parent=null}},t.util.ZPP_Set_ZPP_PartitionVertex.prototype.clear_with=function(e){if(null!=this.parent){for(var n=this.parent;null!=n;)if(null!=n.prev)n=n.prev;else if(null!=n.next)n=n.next;else{e(n.data);var i=n.parent;null!=i&&(n==i.prev?i.prev=null:i.next=null,n.parent=null);var r=n;r.data=null,r.lt=null,r.swapped=null,r.next=t.util.ZPP_Set_ZPP_PartitionVertex.zpp_pool,t.util.ZPP_Set_ZPP_PartitionVertex.zpp_pool=r,n=i}this.parent=null}},t.util.ZPP_Set_ZPP_PartitionVertex.prototype.clear_node=function(e,n){n(e.data);var i=e.parent;null!=i&&(e==i.prev?i.prev=null:i.next=null,e.parent=null);var r=e;return r.data=null,r.lt=null,r.swapped=null,r.next=t.util.ZPP_Set_ZPP_PartitionVertex.zpp_pool,t.util.ZPP_Set_ZPP_PartitionVertex.zpp_pool=r,i},t.util.ZPP_Set_ZPP_PartitionVertex.prototype.__fix_neg_red=function(e){var t,n=e.parent;if(n.prev==e){var i=e.prev,r=e.next,o=r.prev,a=r.next;i.colour=0,e.colour=n.colour=1,e.next=o,null!=o&&(o.parent=e);var s=n.data;n.data=r.data,r.data=s,null!=this.swapped&&this.swapped(n.data,r.data),r.prev=a,null!=a&&(a.parent=r),r.next=n.next,null!=n.next&&(n.next.parent=r),n.next=r,null!=r&&(r.parent=n),t=i}else{var l=e.next,p=e.prev,u=p.next,h=p.prev;l.colour=0,e.colour=n.colour=1,e.prev=u,null!=u&&(u.parent=e);var c=n.data;n.data=p.data,p.data=c,null!=this.swapped&&this.swapped(n.data,p.data),p.next=h,null!=h&&(h.parent=p),p.prev=n.prev,null!=n.prev&&(n.prev.parent=p),n.prev=p,null!=p&&(p.parent=n),t=l}null!=t.prev&&0==t.prev.colour?this.__fix_dbl_red(t.prev):null!=t.next&&0==t.next.colour&&this.__fix_dbl_red(t.next)},t.util.ZPP_Set_ZPP_PartitionVertex.prototype.__fix_dbl_red=function(e){for(;;){var t,n,i,r,o,a,s,l=e.parent,p=l.parent;if(null==p){l.colour=1;break}l==p.prev?(i=p,s=p.next,e==l.prev?(t=e,n=l,r=e.prev,o=e.next,a=l.next):(t=l,n=e,r=l.prev,o=e.prev,a=e.next)):(t=p,r=p.prev,e==l.prev?(n=e,i=l,o=e.prev,a=e.next,s=l.next):(n=l,i=e,o=l.prev,a=e.prev,s=e.next));var u=p.parent;if(null==u?this.parent=n:u.prev==p?u.prev=n:u.next=n,null!=n&&(n.parent=u),t.prev=r,null!=r&&(r.parent=t),t.next=o,null!=o&&(o.parent=t),n.prev=t,null!=t&&(t.parent=n),n.next=i,null!=i&&(i.parent=n),i.prev=a,null!=a&&(a.parent=i),i.next=s,null!=s&&(s.parent=i),n.colour=p.colour-1,t.colour=1,i.colour=1,n==this.parent)this.parent.colour=1;else if(0==n.colour&&0==n.parent.colour){e=n;continue}break}},t.util.ZPP_Set_ZPP_PartitionVertex.prototype.try_insert_bool=function(e){var n=null,i=null;if(null==this.parent)null==t.util.ZPP_Set_ZPP_PartitionVertex.zpp_pool?n=new t.util.ZPP_Set_ZPP_PartitionVertex:(n=t.util.ZPP_Set_ZPP_PartitionVertex.zpp_pool,t.util.ZPP_Set_ZPP_PartitionVertex.zpp_pool=n.next,n.next=null),n.data=e,this.parent=n;else for(i=this.parent;;)if(this.lt(e,i.data)){if(null==i.prev){null==t.util.ZPP_Set_ZPP_PartitionVertex.zpp_pool?n=new t.util.ZPP_Set_ZPP_PartitionVertex:(n=t.util.ZPP_Set_ZPP_PartitionVertex.zpp_pool,t.util.ZPP_Set_ZPP_PartitionVertex.zpp_pool=n.next,n.next=null),n.data=e,i.prev=n,n.parent=i;break}i=i.prev}else{if(!this.lt(i.data,e))break;if(null==i.next){null==t.util.ZPP_Set_ZPP_PartitionVertex.zpp_pool?n=new t.util.ZPP_Set_ZPP_PartitionVertex:(n=t.util.ZPP_Set_ZPP_PartitionVertex.zpp_pool,t.util.ZPP_Set_ZPP_PartitionVertex.zpp_pool=n.next,n.next=null),n.data=e,i.next=n,n.parent=i;break}i=i.next}return null!=n&&(null==n.parent?n.colour=1:(n.colour=0,0==n.parent.colour&&this.__fix_dbl_red(n)),!0)},t.util.ZPP_Set_ZPP_PartitionVertex.prototype.try_insert=function(e){var n=null,i=null;if(null==this.parent)null==t.util.ZPP_Set_ZPP_PartitionVertex.zpp_pool?n=new t.util.ZPP_Set_ZPP_PartitionVertex:(n=t.util.ZPP_Set_ZPP_PartitionVertex.zpp_pool,t.util.ZPP_Set_ZPP_PartitionVertex.zpp_pool=n.next,n.next=null),n.data=e,this.parent=n;else for(i=this.parent;;)if(this.lt(e,i.data)){if(null==i.prev){null==t.util.ZPP_Set_ZPP_PartitionVertex.zpp_pool?n=new t.util.ZPP_Set_ZPP_PartitionVertex:(n=t.util.ZPP_Set_ZPP_PartitionVertex.zpp_pool,t.util.ZPP_Set_ZPP_PartitionVertex.zpp_pool=n.next,n.next=null),n.data=e,i.prev=n,n.parent=i;break}i=i.prev}else{if(!this.lt(i.data,e))break;if(null==i.next){null==t.util.ZPP_Set_ZPP_PartitionVertex.zpp_pool?n=new t.util.ZPP_Set_ZPP_PartitionVertex:(n=t.util.ZPP_Set_ZPP_PartitionVertex.zpp_pool,t.util.ZPP_Set_ZPP_PartitionVertex.zpp_pool=n.next,n.next=null),n.data=e,i.next=n,n.parent=i;break}i=i.next}return null==n?i:(null==n.parent?n.colour=1:(n.colour=0,0==n.parent.colour&&this.__fix_dbl_red(n)),n)},t.util.ZPP_Set_ZPP_PartitionVertex.prototype.insert=function(e){var n;if(null==t.util.ZPP_Set_ZPP_PartitionVertex.zpp_pool?n=new t.util.ZPP_Set_ZPP_PartitionVertex:(n=t.util.ZPP_Set_ZPP_PartitionVertex.zpp_pool,t.util.ZPP_Set_ZPP_PartitionVertex.zpp_pool=n.next,n.next=null),n.data=e,null==this.parent)this.parent=n;else for(var i=this.parent;;)if(this.lt(n.data,i.data)){if(null==i.prev){i.prev=n,n.parent=i;break}i=i.prev}else{if(null==i.next){i.next=n,n.parent=i;break}i=i.next}return null==n.parent?n.colour=1:(n.colour=0,0==n.parent.colour&&this.__fix_dbl_red(n)),n},t.util.ZPP_Set_ZPP_PartitionVertex.prototype.__class__=t.util.ZPP_Set_ZPP_PartitionVertex,t.util.ZPP_Set_ZPP_PartitionPair=l["zpp_nape.util.ZPP_Set_ZPP_PartitionPair"]=function(){this.colour=0,this.parent=null,this.next=null,this.prev=null,this.data=null,this.swapped=null,this.lt=null},t.util.ZPP_Set_ZPP_PartitionPair.__name__=["zpp_nape","util","ZPP_Set_ZPP_PartitionPair"],t.util.ZPP_Set_ZPP_PartitionPair.prototype.free=function(){this.data=null,this.lt=null,this.swapped=null},t.util.ZPP_Set_ZPP_PartitionPair.prototype.alloc=function(){},t.util.ZPP_Set_ZPP_PartitionPair.prototype.lt=null,t.util.ZPP_Set_ZPP_PartitionPair.prototype.swapped=null,t.util.ZPP_Set_ZPP_PartitionPair.prototype.data=null,t.util.ZPP_Set_ZPP_PartitionPair.prototype.prev=null,t.util.ZPP_Set_ZPP_PartitionPair.prototype.next=null,t.util.ZPP_Set_ZPP_PartitionPair.prototype.parent=null,t.util.ZPP_Set_ZPP_PartitionPair.prototype.colour=null,t.util.ZPP_Set_ZPP_PartitionPair.prototype.verify=function(){if(!this.empty()){for(var e=this.parent;null!=e.prev;)e=e.prev;for(;null!=e;){var t=e.data,n=!0;if(!this.empty()){for(var i=this.parent;null!=i.prev;)i=i.prev;for(;null!=i;){var r=i.data;if(n){if(t==r)n=!1;else if(!this.lt(r,t)&&this.lt(t,r))return!1}else if(!this.lt(t,r)&&this.lt(r,t))return!1;if(null!=i.next)for(i=i.next;null!=i.prev;)i=i.prev;else{for(;null!=i.parent&&i==i.parent.next;)i=i.parent;i=i.parent}}}if(null!=e.next)for(e=e.next;null!=e.prev;)e=e.prev;else{for(;null!=e.parent&&e==e.parent.next;)e=e.parent;e=e.parent}}}return!0},t.util.ZPP_Set_ZPP_PartitionPair.prototype.empty=function(){return null==this.parent},t.util.ZPP_Set_ZPP_PartitionPair.prototype.singular=function(){return null!=this.parent&&null==this.parent.prev&&null==this.parent.next},t.util.ZPP_Set_ZPP_PartitionPair.prototype.size=function(){var e=0;if(!this.empty()){for(var t=this.parent;null!=t.prev;)t=t.prev;for(;null!=t;)if(t.data,++e,null!=t.next)for(t=t.next;null!=t.prev;)t=t.prev;else{for(;null!=t.parent&&t==t.parent.next;)t=t.parent;t=t.parent}}return e},t.util.ZPP_Set_ZPP_PartitionPair.prototype.has=function(e){return null!=this.find(e)},t.util.ZPP_Set_ZPP_PartitionPair.prototype.find=function(e){for(var t=this.parent;null!=t&&t.data!=e;)t=this.lt(e,t.data)?t.prev:t.next;return t},t.util.ZPP_Set_ZPP_PartitionPair.prototype.has_weak=function(e){return null!=this.find_weak(e)},t.util.ZPP_Set_ZPP_PartitionPair.prototype.find_weak=function(e){for(var t=this.parent;null!=t;)if(this.lt(e,t.data))t=t.prev;else{if(!this.lt(t.data,e))break;t=t.next}return t},t.util.ZPP_Set_ZPP_PartitionPair.prototype.lower_bound=function(e){var t=null;if(!this.empty()){for(var n=this.parent;null!=n.prev;)n=n.prev;for(;null!=n;){var i=n.data;if(!this.lt(i,e)){t=i;break}if(null!=n.next)for(n=n.next;null!=n.prev;)n=n.prev;else{for(;null!=n.parent&&n==n.parent.next;)n=n.parent;n=n.parent}}}return t},t.util.ZPP_Set_ZPP_PartitionPair.prototype.first=function(){for(var e=this.parent;null!=e.prev;)e=e.prev;return e.data},t.util.ZPP_Set_ZPP_PartitionPair.prototype.pop_front=function(){for(var e=this.parent;null!=e.prev;)e=e.prev;var t=e.data;return this.remove_node(e),t},t.util.ZPP_Set_ZPP_PartitionPair.prototype.remove=function(e){var t=this.find(e);this.remove_node(t)},t.util.ZPP_Set_ZPP_PartitionPair.prototype.successor_node=function(e){if(null!=e.next)for(e=e.next;null!=e.prev;)e=e.prev;else{var t=e;for(e=e.parent;null!=e&&e.prev!=t;)t=e,e=e.parent}return e},t.util.ZPP_Set_ZPP_PartitionPair.prototype.predecessor_node=function(e){if(null!=e.prev)for(e=e.prev;null!=e.next;)e=e.next;else{var t=e;for(e=e.parent;null!=e&&e.next!=t;)t=e,e=e.parent}return e},t.util.ZPP_Set_ZPP_PartitionPair.prototype.successor=function(e){var t=this.successor_node(this.find(e));return null==t?null:t.data},t.util.ZPP_Set_ZPP_PartitionPair.prototype.predecessor=function(e){var t=this.predecessor_node(this.find(e));return null==t?null:t.data},t.util.ZPP_Set_ZPP_PartitionPair.prototype.remove_node=function(e){if(null!=e.next&&null!=e.prev){for(var n=e.next;null!=n.prev;)n=n.prev;var i=e.data;e.data=n.data,n.data=i,null!=this.swapped&&this.swapped(e.data,n.data),e=n}var r=null==e.prev?e.next:e.prev;if(1==e.colour)if(null!=e.prev||null!=e.next)r.colour=1;else if(null!=e.parent)for(var o=e.parent;;){o.colour++,o.prev.colour--,o.next.colour--;var a=o.prev;if(-1==a.colour){this.__fix_neg_red(a);break}if(0==a.colour){if(null!=a.prev&&0==a.prev.colour){this.__fix_dbl_red(a.prev);break}if(null!=a.next&&0==a.next.colour){this.__fix_dbl_red(a.next);break}}var s=o.next;if(-1==s.colour){this.__fix_neg_red(s);break}if(0==s.colour){if(null!=s.prev&&0==s.prev.colour){this.__fix_dbl_red(s.prev);break}if(null!=s.next&&0==s.next.colour){this.__fix_dbl_red(s.next);break}}if(2==o.colour){if(null!=o.parent){o=o.parent;continue}o.colour=1}break}var l=e.parent;null==l?this.parent=r:l.prev==e?l.prev=r:l.next=r,null!=r&&(r.parent=l),e.parent=e.prev=e.next=null;var p=e;p.data=null,p.lt=null,p.swapped=null,p.next=t.util.ZPP_Set_ZPP_PartitionPair.zpp_pool,t.util.ZPP_Set_ZPP_PartitionPair.zpp_pool=p},t.util.ZPP_Set_ZPP_PartitionPair.prototype.clear=function(){if(null!=this.parent){for(var e=this.parent;null!=e;)if(null!=e.prev)e=e.prev;else if(null!=e.next)e=e.next;else{var n=e.parent;null!=n&&(e==n.prev?n.prev=null:n.next=null,e.parent=null);var i=e;i.data=null,i.lt=null,i.swapped=null,i.next=t.util.ZPP_Set_ZPP_PartitionPair.zpp_pool,t.util.ZPP_Set_ZPP_PartitionPair.zpp_pool=i,e=n}this.parent=null}},t.util.ZPP_Set_ZPP_PartitionPair.prototype.clear_with=function(e){if(null!=this.parent){for(var n=this.parent;null!=n;)if(null!=n.prev)n=n.prev;else if(null!=n.next)n=n.next;else{e(n.data);var i=n.parent;null!=i&&(n==i.prev?i.prev=null:i.next=null,n.parent=null);var r=n;r.data=null,r.lt=null,r.swapped=null,r.next=t.util.ZPP_Set_ZPP_PartitionPair.zpp_pool,t.util.ZPP_Set_ZPP_PartitionPair.zpp_pool=r,n=i}this.parent=null}},t.util.ZPP_Set_ZPP_PartitionPair.prototype.clear_node=function(e,n){n(e.data);var i=e.parent;null!=i&&(e==i.prev?i.prev=null:i.next=null,e.parent=null);var r=e;return r.data=null,r.lt=null,r.swapped=null,r.next=t.util.ZPP_Set_ZPP_PartitionPair.zpp_pool,t.util.ZPP_Set_ZPP_PartitionPair.zpp_pool=r,i},t.util.ZPP_Set_ZPP_PartitionPair.prototype.__fix_neg_red=function(e){var t,n=e.parent;if(n.prev==e){var i=e.prev,r=e.next,o=r.prev,a=r.next;i.colour=0,e.colour=n.colour=1,e.next=o,null!=o&&(o.parent=e);var s=n.data;n.data=r.data,r.data=s,null!=this.swapped&&this.swapped(n.data,r.data),r.prev=a,null!=a&&(a.parent=r),r.next=n.next,null!=n.next&&(n.next.parent=r),n.next=r,null!=r&&(r.parent=n),t=i}else{var l=e.next,p=e.prev,u=p.next,h=p.prev;l.colour=0,e.colour=n.colour=1,e.prev=u,null!=u&&(u.parent=e);var c=n.data;n.data=p.data,p.data=c,null!=this.swapped&&this.swapped(n.data,p.data),p.next=h,null!=h&&(h.parent=p),p.prev=n.prev,null!=n.prev&&(n.prev.parent=p),n.prev=p,null!=p&&(p.parent=n),t=l}null!=t.prev&&0==t.prev.colour?this.__fix_dbl_red(t.prev):null!=t.next&&0==t.next.colour&&this.__fix_dbl_red(t.next)},t.util.ZPP_Set_ZPP_PartitionPair.prototype.__fix_dbl_red=function(e){for(;;){var t,n,i,r,o,a,s,l=e.parent,p=l.parent;if(null==p){l.colour=1;break}l==p.prev?(i=p,s=p.next,e==l.prev?(t=e,n=l,r=e.prev,o=e.next,a=l.next):(t=l,n=e,r=l.prev,o=e.prev,a=e.next)):(t=p,r=p.prev,e==l.prev?(n=e,i=l,o=e.prev,a=e.next,s=l.next):(n=l,i=e,o=l.prev,a=e.prev,s=e.next));var u=p.parent;if(null==u?this.parent=n:u.prev==p?u.prev=n:u.next=n,null!=n&&(n.parent=u),t.prev=r,null!=r&&(r.parent=t),t.next=o,null!=o&&(o.parent=t),n.prev=t,null!=t&&(t.parent=n),n.next=i,null!=i&&(i.parent=n),i.prev=a,null!=a&&(a.parent=i),i.next=s,null!=s&&(s.parent=i),n.colour=p.colour-1,t.colour=1,i.colour=1,n==this.parent)this.parent.colour=1;else if(0==n.colour&&0==n.parent.colour){e=n;continue}break}},t.util.ZPP_Set_ZPP_PartitionPair.prototype.try_insert_bool=function(e){var n=null,i=null;if(null==this.parent)null==t.util.ZPP_Set_ZPP_PartitionPair.zpp_pool?n=new t.util.ZPP_Set_ZPP_PartitionPair:(n=t.util.ZPP_Set_ZPP_PartitionPair.zpp_pool,t.util.ZPP_Set_ZPP_PartitionPair.zpp_pool=n.next,n.next=null),n.data=e,this.parent=n;else for(i=this.parent;;)if(this.lt(e,i.data)){if(null==i.prev){null==t.util.ZPP_Set_ZPP_PartitionPair.zpp_pool?n=new t.util.ZPP_Set_ZPP_PartitionPair:(n=t.util.ZPP_Set_ZPP_PartitionPair.zpp_pool,t.util.ZPP_Set_ZPP_PartitionPair.zpp_pool=n.next,n.next=null),n.data=e,i.prev=n,n.parent=i;break}i=i.prev}else{if(!this.lt(i.data,e))break;if(null==i.next){null==t.util.ZPP_Set_ZPP_PartitionPair.zpp_pool?n=new t.util.ZPP_Set_ZPP_PartitionPair:(n=t.util.ZPP_Set_ZPP_PartitionPair.zpp_pool,t.util.ZPP_Set_ZPP_PartitionPair.zpp_pool=n.next,n.next=null),n.data=e,i.next=n,n.parent=i;break}i=i.next}return null!=n&&(null==n.parent?n.colour=1:(n.colour=0,0==n.parent.colour&&this.__fix_dbl_red(n)),!0)},t.util.ZPP_Set_ZPP_PartitionPair.prototype.try_insert=function(e){var n=null,i=null;if(null==this.parent)null==t.util.ZPP_Set_ZPP_PartitionPair.zpp_pool?n=new t.util.ZPP_Set_ZPP_PartitionPair:(n=t.util.ZPP_Set_ZPP_PartitionPair.zpp_pool,t.util.ZPP_Set_ZPP_PartitionPair.zpp_pool=n.next,n.next=null),n.data=e,this.parent=n;else for(i=this.parent;;)if(this.lt(e,i.data)){if(null==i.prev){null==t.util.ZPP_Set_ZPP_PartitionPair.zpp_pool?n=new t.util.ZPP_Set_ZPP_PartitionPair:(n=t.util.ZPP_Set_ZPP_PartitionPair.zpp_pool,t.util.ZPP_Set_ZPP_PartitionPair.zpp_pool=n.next,n.next=null),n.data=e,i.prev=n,n.parent=i;break}i=i.prev}else{if(!this.lt(i.data,e))break;if(null==i.next){null==t.util.ZPP_Set_ZPP_PartitionPair.zpp_pool?n=new t.util.ZPP_Set_ZPP_PartitionPair:(n=t.util.ZPP_Set_ZPP_PartitionPair.zpp_pool,t.util.ZPP_Set_ZPP_PartitionPair.zpp_pool=n.next,n.next=null),n.data=e,i.next=n,n.parent=i;break}i=i.next}return null==n?i:(null==n.parent?n.colour=1:(n.colour=0,0==n.parent.colour&&this.__fix_dbl_red(n)),n)},t.util.ZPP_Set_ZPP_PartitionPair.prototype.insert=function(e){var n;if(null==t.util.ZPP_Set_ZPP_PartitionPair.zpp_pool?n=new t.util.ZPP_Set_ZPP_PartitionPair:(n=t.util.ZPP_Set_ZPP_PartitionPair.zpp_pool,t.util.ZPP_Set_ZPP_PartitionPair.zpp_pool=n.next,n.next=null),n.data=e,null==this.parent)this.parent=n;else for(var i=this.parent;;)if(this.lt(n.data,i.data)){if(null==i.prev){i.prev=n,n.parent=i;break}i=i.prev}else{if(null==i.next){i.next=n,n.parent=i;break}i=i.next}return null==n.parent?n.colour=1:(n.colour=0,0==n.parent.colour&&this.__fix_dbl_red(n)),n},t.util.ZPP_Set_ZPP_PartitionPair.prototype.__class__=t.util.ZPP_Set_ZPP_PartitionPair,t.util.ZPP_Set_ZPP_SimpleVert=l["zpp_nape.util.ZPP_Set_ZPP_SimpleVert"]=function(){this.colour=0,this.parent=null,this.next=null,this.prev=null,this.data=null,this.swapped=null,this.lt=null},t.util.ZPP_Set_ZPP_SimpleVert.__name__=["zpp_nape","util","ZPP_Set_ZPP_SimpleVert"],t.util.ZPP_Set_ZPP_SimpleVert.prototype.free=function(){this.data=null,this.lt=null,this.swapped=null},t.util.ZPP_Set_ZPP_SimpleVert.prototype.alloc=function(){},t.util.ZPP_Set_ZPP_SimpleVert.prototype.lt=null,t.util.ZPP_Set_ZPP_SimpleVert.prototype.swapped=null,t.util.ZPP_Set_ZPP_SimpleVert.prototype.data=null,t.util.ZPP_Set_ZPP_SimpleVert.prototype.prev=null,t.util.ZPP_Set_ZPP_SimpleVert.prototype.next=null,t.util.ZPP_Set_ZPP_SimpleVert.prototype.parent=null,t.util.ZPP_Set_ZPP_SimpleVert.prototype.colour=null,t.util.ZPP_Set_ZPP_SimpleVert.prototype.verify=function(){if(!this.empty()){for(var e=this.parent;null!=e.prev;)e=e.prev;for(;null!=e;){var t=e.data,n=!0;if(!this.empty()){for(var i=this.parent;null!=i.prev;)i=i.prev;for(;null!=i;){var r=i.data;if(n){if(t==r)n=!1;else if(!this.lt(r,t)&&this.lt(t,r))return!1}else if(!this.lt(t,r)&&this.lt(r,t))return!1;if(null!=i.next)for(i=i.next;null!=i.prev;)i=i.prev;else{for(;null!=i.parent&&i==i.parent.next;)i=i.parent;i=i.parent}}}if(null!=e.next)for(e=e.next;null!=e.prev;)e=e.prev;else{for(;null!=e.parent&&e==e.parent.next;)e=e.parent;e=e.parent}}}return!0},t.util.ZPP_Set_ZPP_SimpleVert.prototype.empty=function(){return null==this.parent},t.util.ZPP_Set_ZPP_SimpleVert.prototype.singular=function(){return null!=this.parent&&null==this.parent.prev&&null==this.parent.next},t.util.ZPP_Set_ZPP_SimpleVert.prototype.size=function(){var e=0;if(!this.empty()){for(var t=this.parent;null!=t.prev;)t=t.prev;for(;null!=t;)if(t.data,++e,null!=t.next)for(t=t.next;null!=t.prev;)t=t.prev;else{for(;null!=t.parent&&t==t.parent.next;)t=t.parent;t=t.parent}}return e},t.util.ZPP_Set_ZPP_SimpleVert.prototype.has=function(e){return null!=this.find(e)},t.util.ZPP_Set_ZPP_SimpleVert.prototype.find=function(e){for(var t=this.parent;null!=t&&t.data!=e;)t=this.lt(e,t.data)?t.prev:t.next;return t},t.util.ZPP_Set_ZPP_SimpleVert.prototype.has_weak=function(e){return null!=this.find_weak(e)},t.util.ZPP_Set_ZPP_SimpleVert.prototype.find_weak=function(e){for(var t=this.parent;null!=t;)if(this.lt(e,t.data))t=t.prev;else{if(!this.lt(t.data,e))break;t=t.next}return t},t.util.ZPP_Set_ZPP_SimpleVert.prototype.lower_bound=function(e){var t=null;if(!this.empty()){for(var n=this.parent;null!=n.prev;)n=n.prev;for(;null!=n;){var i=n.data;if(!this.lt(i,e)){t=i;break}if(null!=n.next)for(n=n.next;null!=n.prev;)n=n.prev;else{for(;null!=n.parent&&n==n.parent.next;)n=n.parent;n=n.parent}}}return t},t.util.ZPP_Set_ZPP_SimpleVert.prototype.first=function(){for(var e=this.parent;null!=e.prev;)e=e.prev;return e.data},t.util.ZPP_Set_ZPP_SimpleVert.prototype.pop_front=function(){for(var e=this.parent;null!=e.prev;)e=e.prev;var t=e.data;return this.remove_node(e),t},t.util.ZPP_Set_ZPP_SimpleVert.prototype.remove=function(e){var t=this.find(e);this.remove_node(t)},t.util.ZPP_Set_ZPP_SimpleVert.prototype.successor_node=function(e){if(null!=e.next)for(e=e.next;null!=e.prev;)e=e.prev;else{var t=e;for(e=e.parent;null!=e&&e.prev!=t;)t=e,e=e.parent}return e},t.util.ZPP_Set_ZPP_SimpleVert.prototype.predecessor_node=function(e){if(null!=e.prev)for(e=e.prev;null!=e.next;)e=e.next;else{var t=e;for(e=e.parent;null!=e&&e.next!=t;)t=e,e=e.parent}return e},t.util.ZPP_Set_ZPP_SimpleVert.prototype.successor=function(e){var t=this.successor_node(this.find(e));return null==t?null:t.data},t.util.ZPP_Set_ZPP_SimpleVert.prototype.predecessor=function(e){var t=this.predecessor_node(this.find(e));return null==t?null:t.data},t.util.ZPP_Set_ZPP_SimpleVert.prototype.remove_node=function(e){if(null!=e.next&&null!=e.prev){for(var n=e.next;null!=n.prev;)n=n.prev;var i=e.data;e.data=n.data,n.data=i,null!=this.swapped&&this.swapped(e.data,n.data),e=n}var r=null==e.prev?e.next:e.prev;if(1==e.colour)if(null!=e.prev||null!=e.next)r.colour=1;else if(null!=e.parent)for(var o=e.parent;;){o.colour++,o.prev.colour--,o.next.colour--;var a=o.prev;if(-1==a.colour){this.__fix_neg_red(a);break}if(0==a.colour){if(null!=a.prev&&0==a.prev.colour){this.__fix_dbl_red(a.prev);break}if(null!=a.next&&0==a.next.colour){this.__fix_dbl_red(a.next);break}}var s=o.next;if(-1==s.colour){this.__fix_neg_red(s);break}if(0==s.colour){if(null!=s.prev&&0==s.prev.colour){this.__fix_dbl_red(s.prev);break}if(null!=s.next&&0==s.next.colour){this.__fix_dbl_red(s.next);break}}if(2==o.colour){if(null!=o.parent){o=o.parent;continue}o.colour=1}break}var l=e.parent;null==l?this.parent=r:l.prev==e?l.prev=r:l.next=r,null!=r&&(r.parent=l),e.parent=e.prev=e.next=null;var p=e;p.data=null,p.lt=null,p.swapped=null,p.next=t.util.ZPP_Set_ZPP_SimpleVert.zpp_pool,t.util.ZPP_Set_ZPP_SimpleVert.zpp_pool=p},t.util.ZPP_Set_ZPP_SimpleVert.prototype.clear=function(){if(null!=this.parent){for(var e=this.parent;null!=e;)if(null!=e.prev)e=e.prev;else if(null!=e.next)e=e.next;else{var n=e.parent;null!=n&&(e==n.prev?n.prev=null:n.next=null,e.parent=null);var i=e;i.data=null,i.lt=null,i.swapped=null,i.next=t.util.ZPP_Set_ZPP_SimpleVert.zpp_pool,t.util.ZPP_Set_ZPP_SimpleVert.zpp_pool=i,e=n}this.parent=null}},t.util.ZPP_Set_ZPP_SimpleVert.prototype.clear_with=function(e){if(null!=this.parent){for(var n=this.parent;null!=n;)if(null!=n.prev)n=n.prev;else if(null!=n.next)n=n.next;else{e(n.data);var i=n.parent;null!=i&&(n==i.prev?i.prev=null:i.next=null,n.parent=null);var r=n;r.data=null,r.lt=null,r.swapped=null,r.next=t.util.ZPP_Set_ZPP_SimpleVert.zpp_pool,t.util.ZPP_Set_ZPP_SimpleVert.zpp_pool=r,n=i}this.parent=null}},t.util.ZPP_Set_ZPP_SimpleVert.prototype.clear_node=function(e,n){n(e.data);var i=e.parent;null!=i&&(e==i.prev?i.prev=null:i.next=null,e.parent=null);var r=e;return r.data=null,r.lt=null,r.swapped=null,r.next=t.util.ZPP_Set_ZPP_SimpleVert.zpp_pool,t.util.ZPP_Set_ZPP_SimpleVert.zpp_pool=r,i},t.util.ZPP_Set_ZPP_SimpleVert.prototype.__fix_neg_red=function(e){var t,n=e.parent;if(n.prev==e){var i=e.prev,r=e.next,o=r.prev,a=r.next;i.colour=0,e.colour=n.colour=1,e.next=o,null!=o&&(o.parent=e);var s=n.data;n.data=r.data,r.data=s,null!=this.swapped&&this.swapped(n.data,r.data),r.prev=a,null!=a&&(a.parent=r),r.next=n.next,null!=n.next&&(n.next.parent=r),n.next=r,null!=r&&(r.parent=n),t=i}else{var l=e.next,p=e.prev,u=p.next,h=p.prev;l.colour=0,e.colour=n.colour=1,e.prev=u,null!=u&&(u.parent=e);var c=n.data;n.data=p.data,p.data=c,null!=this.swapped&&this.swapped(n.data,p.data),p.next=h,null!=h&&(h.parent=p),p.prev=n.prev,null!=n.prev&&(n.prev.parent=p),n.prev=p,null!=p&&(p.parent=n),t=l}null!=t.prev&&0==t.prev.colour?this.__fix_dbl_red(t.prev):null!=t.next&&0==t.next.colour&&this.__fix_dbl_red(t.next)},t.util.ZPP_Set_ZPP_SimpleVert.prototype.__fix_dbl_red=function(e){for(;;){var t,n,i,r,o,a,s,l=e.parent,p=l.parent;if(null==p){l.colour=1;break}l==p.prev?(i=p,s=p.next,e==l.prev?(t=e,n=l,r=e.prev,o=e.next,a=l.next):(t=l,n=e,r=l.prev,o=e.prev,a=e.next)):(t=p,r=p.prev,e==l.prev?(n=e,i=l,o=e.prev,a=e.next,s=l.next):(n=l,i=e,o=l.prev,a=e.prev,s=e.next));var u=p.parent;if(null==u?this.parent=n:u.prev==p?u.prev=n:u.next=n,null!=n&&(n.parent=u),t.prev=r,null!=r&&(r.parent=t),t.next=o,null!=o&&(o.parent=t),n.prev=t,null!=t&&(t.parent=n),n.next=i,null!=i&&(i.parent=n),i.prev=a,null!=a&&(a.parent=i),i.next=s,null!=s&&(s.parent=i),n.colour=p.colour-1,t.colour=1,i.colour=1,n==this.parent)this.parent.colour=1;else if(0==n.colour&&0==n.parent.colour){e=n;continue}break}},t.util.ZPP_Set_ZPP_SimpleVert.prototype.try_insert_bool=function(e){var n=null,i=null;if(null==this.parent)null==t.util.ZPP_Set_ZPP_SimpleVert.zpp_pool?n=new t.util.ZPP_Set_ZPP_SimpleVert:(n=t.util.ZPP_Set_ZPP_SimpleVert.zpp_pool,t.util.ZPP_Set_ZPP_SimpleVert.zpp_pool=n.next,n.next=null),n.data=e,this.parent=n;else for(i=this.parent;;)if(this.lt(e,i.data)){if(null==i.prev){null==t.util.ZPP_Set_ZPP_SimpleVert.zpp_pool?n=new t.util.ZPP_Set_ZPP_SimpleVert:(n=t.util.ZPP_Set_ZPP_SimpleVert.zpp_pool,t.util.ZPP_Set_ZPP_SimpleVert.zpp_pool=n.next,n.next=null),n.data=e,i.prev=n,n.parent=i;break}i=i.prev}else{if(!this.lt(i.data,e))break;if(null==i.next){null==t.util.ZPP_Set_ZPP_SimpleVert.zpp_pool?n=new t.util.ZPP_Set_ZPP_SimpleVert:(n=t.util.ZPP_Set_ZPP_SimpleVert.zpp_pool,t.util.ZPP_Set_ZPP_SimpleVert.zpp_pool=n.next,n.next=null),n.data=e,i.next=n,n.parent=i;break}i=i.next}return null!=n&&(null==n.parent?n.colour=1:(n.colour=0,0==n.parent.colour&&this.__fix_dbl_red(n)),!0)},t.util.ZPP_Set_ZPP_SimpleVert.prototype.try_insert=function(e){var n=null,i=null;if(null==this.parent)null==t.util.ZPP_Set_ZPP_SimpleVert.zpp_pool?n=new t.util.ZPP_Set_ZPP_SimpleVert:(n=t.util.ZPP_Set_ZPP_SimpleVert.zpp_pool,t.util.ZPP_Set_ZPP_SimpleVert.zpp_pool=n.next,n.next=null),n.data=e,this.parent=n;else for(i=this.parent;;)if(this.lt(e,i.data)){if(null==i.prev){null==t.util.ZPP_Set_ZPP_SimpleVert.zpp_pool?n=new t.util.ZPP_Set_ZPP_SimpleVert:(n=t.util.ZPP_Set_ZPP_SimpleVert.zpp_pool,t.util.ZPP_Set_ZPP_SimpleVert.zpp_pool=n.next,n.next=null),n.data=e,i.prev=n,n.parent=i;break}i=i.prev}else{if(!this.lt(i.data,e))break;if(null==i.next){null==t.util.ZPP_Set_ZPP_SimpleVert.zpp_pool?n=new t.util.ZPP_Set_ZPP_SimpleVert:(n=t.util.ZPP_Set_ZPP_SimpleVert.zpp_pool,t.util.ZPP_Set_ZPP_SimpleVert.zpp_pool=n.next,n.next=null),n.data=e,i.next=n,n.parent=i;break}i=i.next}return null==n?i:(null==n.parent?n.colour=1:(n.colour=0,0==n.parent.colour&&this.__fix_dbl_red(n)),n)},t.util.ZPP_Set_ZPP_SimpleVert.prototype.insert=function(e){var n;if(null==t.util.ZPP_Set_ZPP_SimpleVert.zpp_pool?n=new t.util.ZPP_Set_ZPP_SimpleVert:(n=t.util.ZPP_Set_ZPP_SimpleVert.zpp_pool,t.util.ZPP_Set_ZPP_SimpleVert.zpp_pool=n.next,n.next=null),n.data=e,null==this.parent)this.parent=n;else for(var i=this.parent;;)if(this.lt(n.data,i.data)){if(null==i.prev){i.prev=n,n.parent=i;break}i=i.prev}else{if(null==i.next){i.next=n,n.parent=i;break}i=i.next}return null==n.parent?n.colour=1:(n.colour=0,0==n.parent.colour&&this.__fix_dbl_red(n)),n},t.util.ZPP_Set_ZPP_SimpleVert.prototype.__class__=t.util.ZPP_Set_ZPP_SimpleVert,t.util.ZPP_Set_ZPP_SimpleSeg=l["zpp_nape.util.ZPP_Set_ZPP_SimpleSeg"]=function(){this.colour=0,this.parent=null,this.next=null,this.prev=null,this.data=null,this.swapped=null,this.lt=null},t.util.ZPP_Set_ZPP_SimpleSeg.__name__=["zpp_nape","util","ZPP_Set_ZPP_SimpleSeg"],t.util.ZPP_Set_ZPP_SimpleSeg.prototype.free=function(){this.data=null,this.lt=null,this.swapped=null},t.util.ZPP_Set_ZPP_SimpleSeg.prototype.alloc=function(){},t.util.ZPP_Set_ZPP_SimpleSeg.prototype.lt=null,t.util.ZPP_Set_ZPP_SimpleSeg.prototype.swapped=null,t.util.ZPP_Set_ZPP_SimpleSeg.prototype.data=null,t.util.ZPP_Set_ZPP_SimpleSeg.prototype.prev=null,t.util.ZPP_Set_ZPP_SimpleSeg.prototype.next=null,t.util.ZPP_Set_ZPP_SimpleSeg.prototype.parent=null,t.util.ZPP_Set_ZPP_SimpleSeg.prototype.colour=null,t.util.ZPP_Set_ZPP_SimpleSeg.prototype.verify=function(){if(!this.empty()){for(var e=this.parent;null!=e.prev;)e=e.prev;for(;null!=e;){var t=e.data,n=!0;if(!this.empty()){for(var i=this.parent;null!=i.prev;)i=i.prev;for(;null!=i;){var r=i.data;if(n){if(t==r)n=!1;else if(!this.lt(r,t)&&this.lt(t,r))return!1}else if(!this.lt(t,r)&&this.lt(r,t))return!1;if(null!=i.next)for(i=i.next;null!=i.prev;)i=i.prev;else{for(;null!=i.parent&&i==i.parent.next;)i=i.parent;i=i.parent}}}if(null!=e.next)for(e=e.next;null!=e.prev;)e=e.prev;else{for(;null!=e.parent&&e==e.parent.next;)e=e.parent;e=e.parent}}}return!0},t.util.ZPP_Set_ZPP_SimpleSeg.prototype.empty=function(){return null==this.parent},t.util.ZPP_Set_ZPP_SimpleSeg.prototype.singular=function(){return null!=this.parent&&null==this.parent.prev&&null==this.parent.next},t.util.ZPP_Set_ZPP_SimpleSeg.prototype.size=function(){var e=0;if(!this.empty()){for(var t=this.parent;null!=t.prev;)t=t.prev;for(;null!=t;)if(t.data,++e,null!=t.next)for(t=t.next;null!=t.prev;)t=t.prev;else{for(;null!=t.parent&&t==t.parent.next;)t=t.parent;t=t.parent}}return e},t.util.ZPP_Set_ZPP_SimpleSeg.prototype.has=function(e){return null!=this.find(e)},t.util.ZPP_Set_ZPP_SimpleSeg.prototype.find=function(e){for(var t=this.parent;null!=t&&t.data!=e;)t=this.lt(e,t.data)?t.prev:t.next;return t},t.util.ZPP_Set_ZPP_SimpleSeg.prototype.has_weak=function(e){return null!=this.find_weak(e)},t.util.ZPP_Set_ZPP_SimpleSeg.prototype.find_weak=function(e){for(var t=this.parent;null!=t;)if(this.lt(e,t.data))t=t.prev;else{if(!this.lt(t.data,e))break;t=t.next}return t},t.util.ZPP_Set_ZPP_SimpleSeg.prototype.lower_bound=function(e){var t=null;if(!this.empty()){for(var n=this.parent;null!=n.prev;)n=n.prev;for(;null!=n;){var i=n.data;if(!this.lt(i,e)){t=i;break}if(null!=n.next)for(n=n.next;null!=n.prev;)n=n.prev;else{for(;null!=n.parent&&n==n.parent.next;)n=n.parent;n=n.parent}}}return t},t.util.ZPP_Set_ZPP_SimpleSeg.prototype.first=function(){for(var e=this.parent;null!=e.prev;)e=e.prev;return e.data},t.util.ZPP_Set_ZPP_SimpleSeg.prototype.pop_front=function(){for(var e=this.parent;null!=e.prev;)e=e.prev;var t=e.data;return this.remove_node(e),t},t.util.ZPP_Set_ZPP_SimpleSeg.prototype.remove=function(e){var t=this.find(e);this.remove_node(t)},t.util.ZPP_Set_ZPP_SimpleSeg.prototype.successor_node=function(e){if(null!=e.next)for(e=e.next;null!=e.prev;)e=e.prev;else{var t=e;for(e=e.parent;null!=e&&e.prev!=t;)t=e,e=e.parent}return e},t.util.ZPP_Set_ZPP_SimpleSeg.prototype.predecessor_node=function(e){if(null!=e.prev)for(e=e.prev;null!=e.next;)e=e.next;else{var t=e;for(e=e.parent;null!=e&&e.next!=t;)t=e,e=e.parent}return e},t.util.ZPP_Set_ZPP_SimpleSeg.prototype.successor=function(e){var t=this.successor_node(this.find(e));return null==t?null:t.data},t.util.ZPP_Set_ZPP_SimpleSeg.prototype.predecessor=function(e){var t=this.predecessor_node(this.find(e));return null==t?null:t.data},t.util.ZPP_Set_ZPP_SimpleSeg.prototype.remove_node=function(e){if(null!=e.next&&null!=e.prev){for(var n=e.next;null!=n.prev;)n=n.prev;var i=e.data;e.data=n.data,n.data=i,null!=this.swapped&&this.swapped(e.data,n.data),e=n}var r=null==e.prev?e.next:e.prev;if(1==e.colour)if(null!=e.prev||null!=e.next)r.colour=1;else if(null!=e.parent)for(var o=e.parent;;){o.colour++,o.prev.colour--,o.next.colour--;var a=o.prev;if(-1==a.colour){this.__fix_neg_red(a);break}if(0==a.colour){if(null!=a.prev&&0==a.prev.colour){this.__fix_dbl_red(a.prev);break}if(null!=a.next&&0==a.next.colour){this.__fix_dbl_red(a.next);break}}var s=o.next;if(-1==s.colour){this.__fix_neg_red(s);break}if(0==s.colour){if(null!=s.prev&&0==s.prev.colour){this.__fix_dbl_red(s.prev);break}if(null!=s.next&&0==s.next.colour){this.__fix_dbl_red(s.next);break}}if(2==o.colour){if(null!=o.parent){o=o.parent;continue}o.colour=1}break}var l=e.parent;null==l?this.parent=r:l.prev==e?l.prev=r:l.next=r,null!=r&&(r.parent=l),e.parent=e.prev=e.next=null;var p=e;p.data=null,p.lt=null,p.swapped=null,p.next=t.util.ZPP_Set_ZPP_SimpleSeg.zpp_pool,t.util.ZPP_Set_ZPP_SimpleSeg.zpp_pool=p},t.util.ZPP_Set_ZPP_SimpleSeg.prototype.clear=function(){if(null!=this.parent){for(var e=this.parent;null!=e;)if(null!=e.prev)e=e.prev;else if(null!=e.next)e=e.next;else{var n=e.parent;null!=n&&(e==n.prev?n.prev=null:n.next=null,e.parent=null);var i=e;i.data=null,i.lt=null,i.swapped=null,i.next=t.util.ZPP_Set_ZPP_SimpleSeg.zpp_pool,t.util.ZPP_Set_ZPP_SimpleSeg.zpp_pool=i,e=n}this.parent=null}},t.util.ZPP_Set_ZPP_SimpleSeg.prototype.clear_with=function(e){if(null!=this.parent){for(var n=this.parent;null!=n;)if(null!=n.prev)n=n.prev;else if(null!=n.next)n=n.next;else{e(n.data);var i=n.parent;null!=i&&(n==i.prev?i.prev=null:i.next=null,n.parent=null);var r=n;r.data=null,r.lt=null,r.swapped=null,r.next=t.util.ZPP_Set_ZPP_SimpleSeg.zpp_pool,t.util.ZPP_Set_ZPP_SimpleSeg.zpp_pool=r,n=i}this.parent=null}},t.util.ZPP_Set_ZPP_SimpleSeg.prototype.clear_node=function(e,n){n(e.data);var i=e.parent;null!=i&&(e==i.prev?i.prev=null:i.next=null,e.parent=null);var r=e;return r.data=null,r.lt=null,r.swapped=null,r.next=t.util.ZPP_Set_ZPP_SimpleSeg.zpp_pool,t.util.ZPP_Set_ZPP_SimpleSeg.zpp_pool=r,i},t.util.ZPP_Set_ZPP_SimpleSeg.prototype.__fix_neg_red=function(e){var t,n=e.parent;if(n.prev==e){var i=e.prev,r=e.next,o=r.prev,a=r.next;i.colour=0,e.colour=n.colour=1,e.next=o,null!=o&&(o.parent=e);var s=n.data;n.data=r.data,r.data=s,null!=this.swapped&&this.swapped(n.data,r.data),r.prev=a,null!=a&&(a.parent=r),r.next=n.next,null!=n.next&&(n.next.parent=r),n.next=r,null!=r&&(r.parent=n),t=i}else{var l=e.next,p=e.prev,u=p.next,h=p.prev;l.colour=0,e.colour=n.colour=1,e.prev=u,null!=u&&(u.parent=e);var c=n.data;n.data=p.data,p.data=c,null!=this.swapped&&this.swapped(n.data,p.data),p.next=h,null!=h&&(h.parent=p),p.prev=n.prev,null!=n.prev&&(n.prev.parent=p),n.prev=p,null!=p&&(p.parent=n),t=l}null!=t.prev&&0==t.prev.colour?this.__fix_dbl_red(t.prev):null!=t.next&&0==t.next.colour&&this.__fix_dbl_red(t.next)},t.util.ZPP_Set_ZPP_SimpleSeg.prototype.__fix_dbl_red=function(e){for(;;){var t,n,i,r,o,a,s,l=e.parent,p=l.parent;if(null==p){l.colour=1;break}l==p.prev?(i=p,s=p.next,e==l.prev?(t=e,n=l,r=e.prev,o=e.next,a=l.next):(t=l,n=e,r=l.prev,o=e.prev,a=e.next)):(t=p,r=p.prev,e==l.prev?(n=e,i=l,o=e.prev,a=e.next,s=l.next):(n=l,i=e,o=l.prev,a=e.prev,s=e.next));var u=p.parent;if(null==u?this.parent=n:u.prev==p?u.prev=n:u.next=n,null!=n&&(n.parent=u),t.prev=r,null!=r&&(r.parent=t),t.next=o,null!=o&&(o.parent=t),n.prev=t,null!=t&&(t.parent=n),n.next=i,null!=i&&(i.parent=n),i.prev=a,null!=a&&(a.parent=i),i.next=s,null!=s&&(s.parent=i),n.colour=p.colour-1,t.colour=1,i.colour=1,n==this.parent)this.parent.colour=1;else if(0==n.colour&&0==n.parent.colour){e=n;continue}break}},t.util.ZPP_Set_ZPP_SimpleSeg.prototype.try_insert_bool=function(e){var n=null,i=null;if(null==this.parent)null==t.util.ZPP_Set_ZPP_SimpleSeg.zpp_pool?n=new t.util.ZPP_Set_ZPP_SimpleSeg:(n=t.util.ZPP_Set_ZPP_SimpleSeg.zpp_pool,t.util.ZPP_Set_ZPP_SimpleSeg.zpp_pool=n.next,n.next=null),n.data=e,this.parent=n;else for(i=this.parent;;)if(this.lt(e,i.data)){if(null==i.prev){null==t.util.ZPP_Set_ZPP_SimpleSeg.zpp_pool?n=new t.util.ZPP_Set_ZPP_SimpleSeg:(n=t.util.ZPP_Set_ZPP_SimpleSeg.zpp_pool,t.util.ZPP_Set_ZPP_SimpleSeg.zpp_pool=n.next,n.next=null),n.data=e,i.prev=n,n.parent=i;break}i=i.prev}else{if(!this.lt(i.data,e))break;if(null==i.next){null==t.util.ZPP_Set_ZPP_SimpleSeg.zpp_pool?n=new t.util.ZPP_Set_ZPP_SimpleSeg:(n=t.util.ZPP_Set_ZPP_SimpleSeg.zpp_pool,t.util.ZPP_Set_ZPP_SimpleSeg.zpp_pool=n.next,n.next=null),n.data=e,i.next=n,n.parent=i;break}i=i.next}return null!=n&&(null==n.parent?n.colour=1:(n.colour=0,0==n.parent.colour&&this.__fix_dbl_red(n)),!0)},t.util.ZPP_Set_ZPP_SimpleSeg.prototype.try_insert=function(e){var n=null,i=null;if(null==this.parent)null==t.util.ZPP_Set_ZPP_SimpleSeg.zpp_pool?n=new t.util.ZPP_Set_ZPP_SimpleSeg:(n=t.util.ZPP_Set_ZPP_SimpleSeg.zpp_pool,t.util.ZPP_Set_ZPP_SimpleSeg.zpp_pool=n.next,n.next=null),n.data=e,this.parent=n;else for(i=this.parent;;)if(this.lt(e,i.data)){if(null==i.prev){null==t.util.ZPP_Set_ZPP_SimpleSeg.zpp_pool?n=new t.util.ZPP_Set_ZPP_SimpleSeg:(n=t.util.ZPP_Set_ZPP_SimpleSeg.zpp_pool,t.util.ZPP_Set_ZPP_SimpleSeg.zpp_pool=n.next,n.next=null),n.data=e,i.prev=n,n.parent=i;break}i=i.prev}else{if(!this.lt(i.data,e))break;if(null==i.next){null==t.util.ZPP_Set_ZPP_SimpleSeg.zpp_pool?n=new t.util.ZPP_Set_ZPP_SimpleSeg:(n=t.util.ZPP_Set_ZPP_SimpleSeg.zpp_pool,t.util.ZPP_Set_ZPP_SimpleSeg.zpp_pool=n.next,n.next=null),n.data=e,i.next=n,n.parent=i;break}i=i.next}return null==n?i:(null==n.parent?n.colour=1:(n.colour=0,0==n.parent.colour&&this.__fix_dbl_red(n)),n)},t.util.ZPP_Set_ZPP_SimpleSeg.prototype.insert=function(e){var n;if(null==t.util.ZPP_Set_ZPP_SimpleSeg.zpp_pool?n=new t.util.ZPP_Set_ZPP_SimpleSeg:(n=t.util.ZPP_Set_ZPP_SimpleSeg.zpp_pool,t.util.ZPP_Set_ZPP_SimpleSeg.zpp_pool=n.next,n.next=null),n.data=e,null==this.parent)this.parent=n;else for(var i=this.parent;;)if(this.lt(n.data,i.data)){if(null==i.prev){i.prev=n,n.parent=i;break}i=i.prev}else{if(null==i.next){i.next=n,n.parent=i;break}i=i.next}return null==n.parent?n.colour=1:(n.colour=0,0==n.parent.colour&&this.__fix_dbl_red(n)),n},t.util.ZPP_Set_ZPP_SimpleSeg.prototype.__class__=t.util.ZPP_Set_ZPP_SimpleSeg,t.util.ZPP_Set_ZPP_SimpleEvent=l["zpp_nape.util.ZPP_Set_ZPP_SimpleEvent"]=function(){this.colour=0,this.parent=null,this.next=null,this.prev=null,this.data=null,this.swapped=null,this.lt=null},t.util.ZPP_Set_ZPP_SimpleEvent.__name__=["zpp_nape","util","ZPP_Set_ZPP_SimpleEvent"],t.util.ZPP_Set_ZPP_SimpleEvent.prototype.free=function(){this.data=null,this.lt=null,this.swapped=null},t.util.ZPP_Set_ZPP_SimpleEvent.prototype.alloc=function(){},t.util.ZPP_Set_ZPP_SimpleEvent.prototype.lt=null,t.util.ZPP_Set_ZPP_SimpleEvent.prototype.swapped=null,t.util.ZPP_Set_ZPP_SimpleEvent.prototype.data=null,t.util.ZPP_Set_ZPP_SimpleEvent.prototype.prev=null,t.util.ZPP_Set_ZPP_SimpleEvent.prototype.next=null,t.util.ZPP_Set_ZPP_SimpleEvent.prototype.parent=null,t.util.ZPP_Set_ZPP_SimpleEvent.prototype.colour=null,t.util.ZPP_Set_ZPP_SimpleEvent.prototype.verify=function(){if(!this.empty()){for(var e=this.parent;null!=e.prev;)e=e.prev;for(;null!=e;){var t=e.data,n=!0;if(!this.empty()){for(var i=this.parent;null!=i.prev;)i=i.prev;for(;null!=i;){var r=i.data;if(n){if(t==r)n=!1;else if(!this.lt(r,t)&&this.lt(t,r))return!1}else if(!this.lt(t,r)&&this.lt(r,t))return!1;if(null!=i.next)for(i=i.next;null!=i.prev;)i=i.prev;else{for(;null!=i.parent&&i==i.parent.next;)i=i.parent;i=i.parent}}}if(null!=e.next)for(e=e.next;null!=e.prev;)e=e.prev;else{for(;null!=e.parent&&e==e.parent.next;)e=e.parent;e=e.parent}}}return!0},t.util.ZPP_Set_ZPP_SimpleEvent.prototype.empty=function(){return null==this.parent},t.util.ZPP_Set_ZPP_SimpleEvent.prototype.singular=function(){return null!=this.parent&&null==this.parent.prev&&null==this.parent.next},t.util.ZPP_Set_ZPP_SimpleEvent.prototype.size=function(){var e=0;if(!this.empty()){for(var t=this.parent;null!=t.prev;)t=t.prev;for(;null!=t;)if(t.data,++e,null!=t.next)for(t=t.next;null!=t.prev;)t=t.prev;else{for(;null!=t.parent&&t==t.parent.next;)t=t.parent;t=t.parent}}return e},t.util.ZPP_Set_ZPP_SimpleEvent.prototype.has=function(e){return null!=this.find(e)},t.util.ZPP_Set_ZPP_SimpleEvent.prototype.find=function(e){for(var t=this.parent;null!=t&&t.data!=e;)t=this.lt(e,t.data)?t.prev:t.next;return t},t.util.ZPP_Set_ZPP_SimpleEvent.prototype.has_weak=function(e){return null!=this.find_weak(e)},t.util.ZPP_Set_ZPP_SimpleEvent.prototype.find_weak=function(e){for(var t=this.parent;null!=t;)if(this.lt(e,t.data))t=t.prev;else{if(!this.lt(t.data,e))break;t=t.next}return t},t.util.ZPP_Set_ZPP_SimpleEvent.prototype.lower_bound=function(e){var t=null;if(!this.empty()){for(var n=this.parent;null!=n.prev;)n=n.prev;for(;null!=n;){var i=n.data;if(!this.lt(i,e)){t=i;break}if(null!=n.next)for(n=n.next;null!=n.prev;)n=n.prev;else{for(;null!=n.parent&&n==n.parent.next;)n=n.parent;n=n.parent}}}return t},t.util.ZPP_Set_ZPP_SimpleEvent.prototype.first=function(){for(var e=this.parent;null!=e.prev;)e=e.prev;return e.data},t.util.ZPP_Set_ZPP_SimpleEvent.prototype.pop_front=function(){for(var e=this.parent;null!=e.prev;)e=e.prev;var t=e.data;return this.remove_node(e),t},t.util.ZPP_Set_ZPP_SimpleEvent.prototype.remove=function(e){var t=this.find(e);this.remove_node(t)},t.util.ZPP_Set_ZPP_SimpleEvent.prototype.successor_node=function(e){if(null!=e.next)for(e=e.next;null!=e.prev;)e=e.prev;else{var t=e;for(e=e.parent;null!=e&&e.prev!=t;)t=e,e=e.parent}return e},t.util.ZPP_Set_ZPP_SimpleEvent.prototype.predecessor_node=function(e){if(null!=e.prev)for(e=e.prev;null!=e.next;)e=e.next;else{var t=e;for(e=e.parent;null!=e&&e.next!=t;)t=e,e=e.parent}return e},t.util.ZPP_Set_ZPP_SimpleEvent.prototype.successor=function(e){var t=this.successor_node(this.find(e));return null==t?null:t.data},t.util.ZPP_Set_ZPP_SimpleEvent.prototype.predecessor=function(e){var t=this.predecessor_node(this.find(e));return null==t?null:t.data},t.util.ZPP_Set_ZPP_SimpleEvent.prototype.remove_node=function(e){if(null!=e.next&&null!=e.prev){for(var n=e.next;null!=n.prev;)n=n.prev;var i=e.data;e.data=n.data,n.data=i,null!=this.swapped&&this.swapped(e.data,n.data),e=n}var r=null==e.prev?e.next:e.prev;if(1==e.colour)if(null!=e.prev||null!=e.next)r.colour=1;else if(null!=e.parent)for(var o=e.parent;;){o.colour++,o.prev.colour--,o.next.colour--;var a=o.prev;if(-1==a.colour){this.__fix_neg_red(a);break}if(0==a.colour){if(null!=a.prev&&0==a.prev.colour){this.__fix_dbl_red(a.prev);break}if(null!=a.next&&0==a.next.colour){this.__fix_dbl_red(a.next);break}}var s=o.next;if(-1==s.colour){this.__fix_neg_red(s);break}if(0==s.colour){if(null!=s.prev&&0==s.prev.colour){this.__fix_dbl_red(s.prev);break}if(null!=s.next&&0==s.next.colour){this.__fix_dbl_red(s.next);break}}if(2==o.colour){if(null!=o.parent){o=o.parent;continue}o.colour=1}break}var l=e.parent;null==l?this.parent=r:l.prev==e?l.prev=r:l.next=r,null!=r&&(r.parent=l),e.parent=e.prev=e.next=null;var p=e;p.data=null,p.lt=null,p.swapped=null,p.next=t.util.ZPP_Set_ZPP_SimpleEvent.zpp_pool,t.util.ZPP_Set_ZPP_SimpleEvent.zpp_pool=p},t.util.ZPP_Set_ZPP_SimpleEvent.prototype.clear=function(){if(null!=this.parent){for(var e=this.parent;null!=e;)if(null!=e.prev)e=e.prev;else if(null!=e.next)e=e.next;else{var n=e.parent;null!=n&&(e==n.prev?n.prev=null:n.next=null,e.parent=null);var i=e;i.data=null,i.lt=null,i.swapped=null,i.next=t.util.ZPP_Set_ZPP_SimpleEvent.zpp_pool,t.util.ZPP_Set_ZPP_SimpleEvent.zpp_pool=i,e=n}this.parent=null}},t.util.ZPP_Set_ZPP_SimpleEvent.prototype.clear_with=function(e){if(null!=this.parent){for(var n=this.parent;null!=n;)if(null!=n.prev)n=n.prev;else if(null!=n.next)n=n.next;else{e(n.data);var i=n.parent;null!=i&&(n==i.prev?i.prev=null:i.next=null,n.parent=null);var r=n;r.data=null,r.lt=null,r.swapped=null,r.next=t.util.ZPP_Set_ZPP_SimpleEvent.zpp_pool,t.util.ZPP_Set_ZPP_SimpleEvent.zpp_pool=r,n=i}this.parent=null}},t.util.ZPP_Set_ZPP_SimpleEvent.prototype.clear_node=function(e,n){n(e.data);var i=e.parent;null!=i&&(e==i.prev?i.prev=null:i.next=null,e.parent=null);var r=e;return r.data=null,r.lt=null,r.swapped=null,r.next=t.util.ZPP_Set_ZPP_SimpleEvent.zpp_pool,t.util.ZPP_Set_ZPP_SimpleEvent.zpp_pool=r,i},t.util.ZPP_Set_ZPP_SimpleEvent.prototype.__fix_neg_red=function(e){var t,n=e.parent;if(n.prev==e){var i=e.prev,r=e.next,o=r.prev,a=r.next;i.colour=0,e.colour=n.colour=1,e.next=o,null!=o&&(o.parent=e);var s=n.data;n.data=r.data,r.data=s,null!=this.swapped&&this.swapped(n.data,r.data),r.prev=a,null!=a&&(a.parent=r),r.next=n.next,null!=n.next&&(n.next.parent=r),n.next=r,null!=r&&(r.parent=n),t=i}else{var l=e.next,p=e.prev,u=p.next,h=p.prev;l.colour=0,e.colour=n.colour=1,e.prev=u,null!=u&&(u.parent=e);var c=n.data;n.data=p.data,p.data=c,null!=this.swapped&&this.swapped(n.data,p.data),p.next=h,null!=h&&(h.parent=p),p.prev=n.prev,null!=n.prev&&(n.prev.parent=p),n.prev=p,null!=p&&(p.parent=n),t=l}null!=t.prev&&0==t.prev.colour?this.__fix_dbl_red(t.prev):null!=t.next&&0==t.next.colour&&this.__fix_dbl_red(t.next)},t.util.ZPP_Set_ZPP_SimpleEvent.prototype.__fix_dbl_red=function(e){for(;;){var t,n,i,r,o,a,s,l=e.parent,p=l.parent;if(null==p){l.colour=1;break}l==p.prev?(i=p,s=p.next,e==l.prev?(t=e,n=l,r=e.prev,o=e.next,a=l.next):(t=l,n=e,r=l.prev,o=e.prev,a=e.next)):(t=p,r=p.prev,e==l.prev?(n=e,i=l,o=e.prev,a=e.next,s=l.next):(n=l,i=e,o=l.prev,a=e.prev,s=e.next));var u=p.parent;if(null==u?this.parent=n:u.prev==p?u.prev=n:u.next=n,null!=n&&(n.parent=u),t.prev=r,null!=r&&(r.parent=t),t.next=o,null!=o&&(o.parent=t),n.prev=t,null!=t&&(t.parent=n),n.next=i,null!=i&&(i.parent=n),i.prev=a,null!=a&&(a.parent=i),i.next=s,null!=s&&(s.parent=i),n.colour=p.colour-1,t.colour=1,i.colour=1,n==this.parent)this.parent.colour=1;else if(0==n.colour&&0==n.parent.colour){e=n;continue}break}},t.util.ZPP_Set_ZPP_SimpleEvent.prototype.try_insert_bool=function(e){var n=null,i=null;if(null==this.parent)null==t.util.ZPP_Set_ZPP_SimpleEvent.zpp_pool?n=new t.util.ZPP_Set_ZPP_SimpleEvent:(n=t.util.ZPP_Set_ZPP_SimpleEvent.zpp_pool,t.util.ZPP_Set_ZPP_SimpleEvent.zpp_pool=n.next,n.next=null),n.data=e,this.parent=n;else for(i=this.parent;;)if(this.lt(e,i.data)){if(null==i.prev){null==t.util.ZPP_Set_ZPP_SimpleEvent.zpp_pool?n=new t.util.ZPP_Set_ZPP_SimpleEvent:(n=t.util.ZPP_Set_ZPP_SimpleEvent.zpp_pool,t.util.ZPP_Set_ZPP_SimpleEvent.zpp_pool=n.next,n.next=null),n.data=e,i.prev=n,n.parent=i;break}i=i.prev}else{if(!this.lt(i.data,e))break;if(null==i.next){null==t.util.ZPP_Set_ZPP_SimpleEvent.zpp_pool?n=new t.util.ZPP_Set_ZPP_SimpleEvent:(n=t.util.ZPP_Set_ZPP_SimpleEvent.zpp_pool,t.util.ZPP_Set_ZPP_SimpleEvent.zpp_pool=n.next,n.next=null),n.data=e,i.next=n,n.parent=i;break}i=i.next}return null!=n&&(null==n.parent?n.colour=1:(n.colour=0,0==n.parent.colour&&this.__fix_dbl_red(n)),!0)},t.util.ZPP_Set_ZPP_SimpleEvent.prototype.try_insert=function(e){var n=null,i=null;if(null==this.parent)null==t.util.ZPP_Set_ZPP_SimpleEvent.zpp_pool?n=new t.util.ZPP_Set_ZPP_SimpleEvent:(n=t.util.ZPP_Set_ZPP_SimpleEvent.zpp_pool,t.util.ZPP_Set_ZPP_SimpleEvent.zpp_pool=n.next,n.next=null),n.data=e,this.parent=n;else for(i=this.parent;;)if(this.lt(e,i.data)){if(null==i.prev){null==t.util.ZPP_Set_ZPP_SimpleEvent.zpp_pool?n=new t.util.ZPP_Set_ZPP_SimpleEvent:(n=t.util.ZPP_Set_ZPP_SimpleEvent.zpp_pool,t.util.ZPP_Set_ZPP_SimpleEvent.zpp_pool=n.next,n.next=null),n.data=e,i.prev=n,n.parent=i;break}i=i.prev}else{if(!this.lt(i.data,e))break;if(null==i.next){null==t.util.ZPP_Set_ZPP_SimpleEvent.zpp_pool?n=new t.util.ZPP_Set_ZPP_SimpleEvent:(n=t.util.ZPP_Set_ZPP_SimpleEvent.zpp_pool,t.util.ZPP_Set_ZPP_SimpleEvent.zpp_pool=n.next,n.next=null),n.data=e,i.next=n,n.parent=i;break}i=i.next}return null==n?i:(null==n.parent?n.colour=1:(n.colour=0,0==n.parent.colour&&this.__fix_dbl_red(n)),n)},t.util.ZPP_Set_ZPP_SimpleEvent.prototype.insert=function(e){var n;if(null==t.util.ZPP_Set_ZPP_SimpleEvent.zpp_pool?n=new t.util.ZPP_Set_ZPP_SimpleEvent:(n=t.util.ZPP_Set_ZPP_SimpleEvent.zpp_pool,t.util.ZPP_Set_ZPP_SimpleEvent.zpp_pool=n.next,n.next=null),n.data=e,null==this.parent)this.parent=n;else for(var i=this.parent;;)if(this.lt(n.data,i.data)){if(null==i.prev){i.prev=n,n.parent=i;break}i=i.prev}else{if(null==i.next){i.next=n,n.parent=i;break}i=i.next}return null==n.parent?n.colour=1:(n.colour=0,0==n.parent.colour&&this.__fix_dbl_red(n)),n},t.util.ZPP_Set_ZPP_SimpleEvent.prototype.__class__=t.util.ZPP_Set_ZPP_SimpleEvent,t.util.ZPP_Set_ZPP_CbSet=l["zpp_nape.util.ZPP_Set_ZPP_CbSet"]=function(){this.colour=0,this.parent=null,this.next=null,this.prev=null,this.data=null,this.swapped=null,this.lt=null},t.util.ZPP_Set_ZPP_CbSet.__name__=["zpp_nape","util","ZPP_Set_ZPP_CbSet"],t.util.ZPP_Set_ZPP_CbSet.prototype.free=function(){this.data=null,this.lt=null,this.swapped=null},t.util.ZPP_Set_ZPP_CbSet.prototype.alloc=function(){},t.util.ZPP_Set_ZPP_CbSet.prototype.lt=null,t.util.ZPP_Set_ZPP_CbSet.prototype.swapped=null,t.util.ZPP_Set_ZPP_CbSet.prototype.data=null,t.util.ZPP_Set_ZPP_CbSet.prototype.prev=null,t.util.ZPP_Set_ZPP_CbSet.prototype.next=null,t.util.ZPP_Set_ZPP_CbSet.prototype.parent=null,t.util.ZPP_Set_ZPP_CbSet.prototype.colour=null,t.util.ZPP_Set_ZPP_CbSet.prototype.verify=function(){if(!this.empty()){for(var e=this.parent;null!=e.prev;)e=e.prev;for(;null!=e;){var t=e.data,n=!0;if(!this.empty()){for(var i=this.parent;null!=i.prev;)i=i.prev;for(;null!=i;){var r=i.data;if(n){if(t==r)n=!1;else if(!this.lt(r,t)&&this.lt(t,r))return!1}else if(!this.lt(t,r)&&this.lt(r,t))return!1;if(null!=i.next)for(i=i.next;null!=i.prev;)i=i.prev;else{for(;null!=i.parent&&i==i.parent.next;)i=i.parent;i=i.parent}}}if(null!=e.next)for(e=e.next;null!=e.prev;)e=e.prev;else{for(;null!=e.parent&&e==e.parent.next;)e=e.parent;e=e.parent}}}return!0},t.util.ZPP_Set_ZPP_CbSet.prototype.empty=function(){return null==this.parent},t.util.ZPP_Set_ZPP_CbSet.prototype.singular=function(){return null!=this.parent&&null==this.parent.prev&&null==this.parent.next},t.util.ZPP_Set_ZPP_CbSet.prototype.size=function(){var e=0;if(!this.empty()){for(var t=this.parent;null!=t.prev;)t=t.prev;for(;null!=t;)if(t.data,++e,null!=t.next)for(t=t.next;null!=t.prev;)t=t.prev;else{for(;null!=t.parent&&t==t.parent.next;)t=t.parent;t=t.parent}}return e},t.util.ZPP_Set_ZPP_CbSet.prototype.has=function(e){return null!=this.find(e)},t.util.ZPP_Set_ZPP_CbSet.prototype.find=function(e){for(var t=this.parent;null!=t&&t.data!=e;)t=this.lt(e,t.data)?t.prev:t.next;return t},t.util.ZPP_Set_ZPP_CbSet.prototype.has_weak=function(e){return null!=this.find_weak(e)},t.util.ZPP_Set_ZPP_CbSet.prototype.find_weak=function(e){for(var t=this.parent;null!=t;)if(this.lt(e,t.data))t=t.prev;else{if(!this.lt(t.data,e))break;t=t.next}return t},t.util.ZPP_Set_ZPP_CbSet.prototype.lower_bound=function(e){var t=null;if(!this.empty()){for(var n=this.parent;null!=n.prev;)n=n.prev;for(;null!=n;){var i=n.data;if(!this.lt(i,e)){t=i;break}if(null!=n.next)for(n=n.next;null!=n.prev;)n=n.prev;else{for(;null!=n.parent&&n==n.parent.next;)n=n.parent;n=n.parent}}}return t},t.util.ZPP_Set_ZPP_CbSet.prototype.first=function(){for(var e=this.parent;null!=e.prev;)e=e.prev;return e.data},t.util.ZPP_Set_ZPP_CbSet.prototype.pop_front=function(){for(var e=this.parent;null!=e.prev;)e=e.prev;var t=e.data;return this.remove_node(e),t},t.util.ZPP_Set_ZPP_CbSet.prototype.remove=function(e){var t=this.find(e);this.remove_node(t)},t.util.ZPP_Set_ZPP_CbSet.prototype.successor_node=function(e){if(null!=e.next)for(e=e.next;null!=e.prev;)e=e.prev;else{var t=e;for(e=e.parent;null!=e&&e.prev!=t;)t=e,e=e.parent}return e},t.util.ZPP_Set_ZPP_CbSet.prototype.predecessor_node=function(e){if(null!=e.prev)for(e=e.prev;null!=e.next;)e=e.next;else{var t=e;for(e=e.parent;null!=e&&e.next!=t;)t=e,e=e.parent}return e},t.util.ZPP_Set_ZPP_CbSet.prototype.successor=function(e){var t=this.successor_node(this.find(e));return null==t?null:t.data},t.util.ZPP_Set_ZPP_CbSet.prototype.predecessor=function(e){var t=this.predecessor_node(this.find(e));return null==t?null:t.data},t.util.ZPP_Set_ZPP_CbSet.prototype.remove_node=function(e){if(null!=e.next&&null!=e.prev){for(var n=e.next;null!=n.prev;)n=n.prev;var i=e.data;e.data=n.data,n.data=i,null!=this.swapped&&this.swapped(e.data,n.data),e=n}var r=null==e.prev?e.next:e.prev;if(1==e.colour)if(null!=e.prev||null!=e.next)r.colour=1;else if(null!=e.parent)for(var o=e.parent;;){o.colour++,o.prev.colour--,o.next.colour--;var a=o.prev;if(-1==a.colour){this.__fix_neg_red(a);break}if(0==a.colour){if(null!=a.prev&&0==a.prev.colour){this.__fix_dbl_red(a.prev);break}if(null!=a.next&&0==a.next.colour){this.__fix_dbl_red(a.next);break}}var s=o.next;if(-1==s.colour){this.__fix_neg_red(s);break}if(0==s.colour){if(null!=s.prev&&0==s.prev.colour){this.__fix_dbl_red(s.prev);break}if(null!=s.next&&0==s.next.colour){this.__fix_dbl_red(s.next);break}}if(2==o.colour){if(null!=o.parent){o=o.parent;continue}o.colour=1}break}var l=e.parent;null==l?this.parent=r:l.prev==e?l.prev=r:l.next=r,null!=r&&(r.parent=l),e.parent=e.prev=e.next=null;var p=e;p.data=null,p.lt=null,p.swapped=null,p.next=t.util.ZPP_Set_ZPP_CbSet.zpp_pool,t.util.ZPP_Set_ZPP_CbSet.zpp_pool=p},t.util.ZPP_Set_ZPP_CbSet.prototype.clear=function(){if(null!=this.parent){for(var e=this.parent;null!=e;)if(null!=e.prev)e=e.prev;else if(null!=e.next)e=e.next;else{var n=e.parent;null!=n&&(e==n.prev?n.prev=null:n.next=null,e.parent=null);var i=e;i.data=null,i.lt=null,i.swapped=null,i.next=t.util.ZPP_Set_ZPP_CbSet.zpp_pool,t.util.ZPP_Set_ZPP_CbSet.zpp_pool=i,e=n}this.parent=null}},t.util.ZPP_Set_ZPP_CbSet.prototype.clear_with=function(e){if(null!=this.parent){for(var n=this.parent;null!=n;)if(null!=n.prev)n=n.prev;else if(null!=n.next)n=n.next;else{e(n.data);var i=n.parent;null!=i&&(n==i.prev?i.prev=null:i.next=null,n.parent=null);var r=n;r.data=null,r.lt=null,r.swapped=null,r.next=t.util.ZPP_Set_ZPP_CbSet.zpp_pool,t.util.ZPP_Set_ZPP_CbSet.zpp_pool=r,n=i}this.parent=null}},t.util.ZPP_Set_ZPP_CbSet.prototype.clear_node=function(e,n){n(e.data);var i=e.parent;null!=i&&(e==i.prev?i.prev=null:i.next=null,e.parent=null);var r=e;return r.data=null,r.lt=null,r.swapped=null,r.next=t.util.ZPP_Set_ZPP_CbSet.zpp_pool,t.util.ZPP_Set_ZPP_CbSet.zpp_pool=r,i},t.util.ZPP_Set_ZPP_CbSet.prototype.__fix_neg_red=function(e){var t,n=e.parent;if(n.prev==e){var i=e.prev,r=e.next,o=r.prev,a=r.next;i.colour=0,e.colour=n.colour=1,e.next=o,null!=o&&(o.parent=e);var s=n.data;n.data=r.data,r.data=s,null!=this.swapped&&this.swapped(n.data,r.data),r.prev=a,null!=a&&(a.parent=r),r.next=n.next,null!=n.next&&(n.next.parent=r),n.next=r,null!=r&&(r.parent=n),t=i}else{var l=e.next,p=e.prev,u=p.next,h=p.prev;l.colour=0,e.colour=n.colour=1,e.prev=u,null!=u&&(u.parent=e);var c=n.data;n.data=p.data,p.data=c,null!=this.swapped&&this.swapped(n.data,p.data),p.next=h,null!=h&&(h.parent=p),p.prev=n.prev,null!=n.prev&&(n.prev.parent=p),n.prev=p,null!=p&&(p.parent=n),t=l}null!=t.prev&&0==t.prev.colour?this.__fix_dbl_red(t.prev):null!=t.next&&0==t.next.colour&&this.__fix_dbl_red(t.next)},t.util.ZPP_Set_ZPP_CbSet.prototype.__fix_dbl_red=function(e){for(;;){var t,n,i,r,o,a,s,l=e.parent,p=l.parent;if(null==p){l.colour=1;break}l==p.prev?(i=p,s=p.next,e==l.prev?(t=e,n=l,r=e.prev,o=e.next,a=l.next):(t=l,n=e,r=l.prev,o=e.prev,a=e.next)):(t=p,r=p.prev,e==l.prev?(n=e,i=l,o=e.prev,a=e.next,s=l.next):(n=l,i=e,o=l.prev,a=e.prev,s=e.next));var u=p.parent;if(null==u?this.parent=n:u.prev==p?u.prev=n:u.next=n,null!=n&&(n.parent=u),t.prev=r,null!=r&&(r.parent=t),t.next=o,null!=o&&(o.parent=t),n.prev=t,null!=t&&(t.parent=n),n.next=i,null!=i&&(i.parent=n),i.prev=a,null!=a&&(a.parent=i),i.next=s,null!=s&&(s.parent=i),n.colour=p.colour-1,t.colour=1,i.colour=1,n==this.parent)this.parent.colour=1;else if(0==n.colour&&0==n.parent.colour){e=n;continue}break}},t.util.ZPP_Set_ZPP_CbSet.prototype.try_insert_bool=function(e){var n=null,i=null;if(null==this.parent)null==t.util.ZPP_Set_ZPP_CbSet.zpp_pool?n=new t.util.ZPP_Set_ZPP_CbSet:(n=t.util.ZPP_Set_ZPP_CbSet.zpp_pool,t.util.ZPP_Set_ZPP_CbSet.zpp_pool=n.next,n.next=null),n.data=e,this.parent=n;else for(i=this.parent;;)if(this.lt(e,i.data)){if(null==i.prev){null==t.util.ZPP_Set_ZPP_CbSet.zpp_pool?n=new t.util.ZPP_Set_ZPP_CbSet:(n=t.util.ZPP_Set_ZPP_CbSet.zpp_pool,t.util.ZPP_Set_ZPP_CbSet.zpp_pool=n.next,n.next=null),n.data=e,i.prev=n,n.parent=i;break}i=i.prev}else{if(!this.lt(i.data,e))break;if(null==i.next){null==t.util.ZPP_Set_ZPP_CbSet.zpp_pool?n=new t.util.ZPP_Set_ZPP_CbSet:(n=t.util.ZPP_Set_ZPP_CbSet.zpp_pool,t.util.ZPP_Set_ZPP_CbSet.zpp_pool=n.next,n.next=null),n.data=e,i.next=n,n.parent=i;break}i=i.next}return null!=n&&(null==n.parent?n.colour=1:(n.colour=0,0==n.parent.colour&&this.__fix_dbl_red(n)),!0)},t.util.ZPP_Set_ZPP_CbSet.prototype.try_insert=function(e){var n=null,i=null;if(null==this.parent)null==t.util.ZPP_Set_ZPP_CbSet.zpp_pool?n=new t.util.ZPP_Set_ZPP_CbSet:(n=t.util.ZPP_Set_ZPP_CbSet.zpp_pool,t.util.ZPP_Set_ZPP_CbSet.zpp_pool=n.next,n.next=null),n.data=e,this.parent=n;else for(i=this.parent;;)if(this.lt(e,i.data)){if(null==i.prev){null==t.util.ZPP_Set_ZPP_CbSet.zpp_pool?n=new t.util.ZPP_Set_ZPP_CbSet:(n=t.util.ZPP_Set_ZPP_CbSet.zpp_pool,t.util.ZPP_Set_ZPP_CbSet.zpp_pool=n.next,n.next=null),n.data=e,i.prev=n,n.parent=i;break}i=i.prev}else{if(!this.lt(i.data,e))break;if(null==i.next){null==t.util.ZPP_Set_ZPP_CbSet.zpp_pool?n=new t.util.ZPP_Set_ZPP_CbSet:(n=t.util.ZPP_Set_ZPP_CbSet.zpp_pool,t.util.ZPP_Set_ZPP_CbSet.zpp_pool=n.next,n.next=null),n.data=e,i.next=n,n.parent=i;break}i=i.next}return null==n?i:(null==n.parent?n.colour=1:(n.colour=0,0==n.parent.colour&&this.__fix_dbl_red(n)),n)},t.util.ZPP_Set_ZPP_CbSet.prototype.insert=function(e){var n;if(null==t.util.ZPP_Set_ZPP_CbSet.zpp_pool?n=new t.util.ZPP_Set_ZPP_CbSet:(n=t.util.ZPP_Set_ZPP_CbSet.zpp_pool,t.util.ZPP_Set_ZPP_CbSet.zpp_pool=n.next,n.next=null),n.data=e,null==this.parent)this.parent=n;else for(var i=this.parent;;)if(this.lt(n.data,i.data)){if(null==i.prev){i.prev=n,n.parent=i;break}i=i.prev}else{if(null==i.next){i.next=n,n.parent=i;break}i=i.next}return null==n.parent?n.colour=1:(n.colour=0,0==n.parent.colour&&this.__fix_dbl_red(n)),n},t.util.ZPP_Set_ZPP_CbSet.prototype.__class__=t.util.ZPP_Set_ZPP_CbSet,String.__name__=!0,Array.__name__=!0,Object.defineProperty(n._Boot.HaxeError.prototype,"message",{get:function(){return String(this.val)}}),n.Boot.__toStr={}.toString,e.Config.epsilon=1e-8,e.Config.fluidAngularDragFriction=2.5,e.Config.fluidAngularDrag=100,e.Config.fluidVacuumDrag=.5,e.Config.fluidLinearDrag=.5,e.Config.collisionSlop=.2,e.Config.collisionSlopCCD=.5,e.Config.distanceThresholdCCD=.05,e.Config.staticCCDLinearThreshold=.05,e.Config.staticCCDAngularThreshold=.005,e.Config.bulletCCDLinearThreshold=.125,e.Config.bulletCCDAngularThreshold=.0125,e.Config.dynamicSweepLinearThreshold=17,e.Config.dynamicSweepAngularThreshold=.6,e.Config.angularCCDSlipScale=.75,e.Config.arbiterExpirationDelay=6,e.Config.staticFrictionThreshold=2,e.Config.elasticThreshold=20,e.Config.sleepDelay=60,e.Config.linearSleepThreshold=.2,e.Config.angularSleepThreshold=.4,e.Config.contactBiasCoef=.3,e.Config.contactStaticBiasCoef=.6,e.Config.contactContinuousBiasCoef=.4,e.Config.contactContinuousStaticBiasCoef=.5,e.Config.constraintLinearSlop=.1,e.Config.constraintAngularSlop=.001,e.Config.illConditionedThreshold=2e8,e.callbacks.CbTypeIterator.zpp_pool=null,e.callbacks.ListenerIterator.zpp_pool=null,e.constraint.Constraint.zpp_internalAlloc=!1,e.constraint.ConstraintIterator.zpp_pool=null,e.dynamics.ArbiterIterator.zpp_pool=null,e.dynamics.ContactIterator.zpp_pool=null,e.dynamics.InteractionGroupIterator.zpp_pool=null,e.geom.ConvexResultIterator.zpp_pool=null,e.geom.GeomPolyIterator.zpp_pool=null,e.geom.RayResultIterator.zpp_pool=null,e.geom.Vec2Iterator.zpp_pool=null,e.phys.Interactor.zpp_internalAlloc=!1,e.phys.BodyIterator.zpp_pool=null,e.phys.CompoundIterator.zpp_pool=null,e.phys.InteractorIterator.zpp_pool=null,e.shape.Shape.zpp_internalAlloc=!1,e.shape.EdgeIterator.zpp_pool=null,e.shape.ShapeIterator.zpp_pool=null,t.ZPP_Const.FMAX=1e100,t.ZPP_ID._Constraint=0,t.ZPP_ID._Interactor=0,t.ZPP_ID._CbType=0,t.ZPP_ID._CbSet=0,t.ZPP_ID._Listener=0,t.ZPP_ID._ZPP_SimpleVert=0,t.ZPP_ID._ZPP_SimpleSeg=0,t.ZPP_ID._Space=0,t.ZPP_ID._InteractionGroup=0,t.callbacks.ZPP_Callback.internal=!1,t.callbacks.ZPP_Callback.zpp_pool=null,t.callbacks.ZPP_CbSet.zpp_pool=null,t.callbacks.ZPP_CbSetPair.zpp_pool=null,t.callbacks.ZPP_CbType.ANY_SHAPE=new e.callbacks.CbType,t.callbacks.ZPP_CbType.ANY_BODY=new e.callbacks.CbType,t.callbacks.ZPP_CbType.ANY_COMPOUND=new e.callbacks.CbType,t.callbacks.ZPP_CbType.ANY_CONSTRAINT=new e.callbacks.CbType,t.util.ZPP_Flags.internal=!1,t.util.ZPP_Flags.id_ImmState_ACCEPT=1,t.util.ZPP_Flags.id_ImmState_IGNORE=2,t.util.ZPP_Flags.id_ImmState_ALWAYS=4,t.util.ZPP_Flags.id_GravMassMode_DEFAULT=0,t.util.ZPP_Flags.id_GravMassMode_FIXED=1,t.util.ZPP_Flags.id_GravMassMode_SCALED=2,t.util.ZPP_Flags.id_InertiaMode_DEFAULT=0,t.util.ZPP_Flags.id_InertiaMode_FIXED=1,t.util.ZPP_Flags.id_MassMode_DEFAULT=0,t.util.ZPP_Flags.id_MassMode_FIXED=1,t.util.ZPP_Flags.id_BodyType_STATIC=1,t.util.ZPP_Flags.id_BodyType_DYNAMIC=2,t.util.ZPP_Flags.id_BodyType_KINEMATIC=3,t.util.ZPP_Flags.id_ListenerType_BODY=0,t.util.ZPP_Flags.id_PreFlag_ACCEPT=1,t.util.ZPP_Flags.id_ListenerType_CONSTRAINT=1,t.util.ZPP_Flags.id_PreFlag_IGNORE=2,t.util.ZPP_Flags.id_ListenerType_INTERACTION=2,t.util.ZPP_Flags.id_PreFlag_ACCEPT_ONCE=3,t.util.ZPP_Flags.id_ListenerType_PRE=3,t.util.ZPP_Flags.id_PreFlag_IGNORE_ONCE=4,t.util.ZPP_Flags.id_CbEvent_BEGIN=0,t.util.ZPP_Flags.id_InteractionType_COLLISION=1,t.util.ZPP_Flags.id_CbEvent_ONGOING=6,t.util.ZPP_Flags.id_InteractionType_SENSOR=2,t.util.ZPP_Flags.id_CbEvent_END=1,t.util.ZPP_Flags.id_InteractionType_FLUID=4,t.util.ZPP_Flags.id_CbEvent_WAKE=2,t.util.ZPP_Flags.id_InteractionType_ANY=7,t.util.ZPP_Flags.id_CbEvent_SLEEP=3,t.util.ZPP_Flags.id_CbEvent_BREAK=4,t.util.ZPP_Flags.id_CbEvent_PRE=5,t.util.ZPP_Flags.id_Winding_UNDEFINED=0,t.util.ZPP_Flags.id_Winding_CLOCKWISE=1,t.util.ZPP_Flags.id_Winding_ANTICLOCKWISE=2,t.util.ZPP_Flags.id_ValidationResult_VALID=0,t.util.ZPP_Flags.id_ValidationResult_DEGENERATE=1,t.util.ZPP_Flags.id_ValidationResult_CONCAVE=2,t.util.ZPP_Flags.id_ValidationResult_SELF_INTERSECTING=3,t.util.ZPP_Flags.id_ShapeType_CIRCLE=0,t.util.ZPP_Flags.id_ShapeType_POLYGON=1,t.util.ZPP_Flags.id_Broadphase_DYNAMIC_AABB_TREE=0,t.util.ZPP_Flags.id_Broadphase_SWEEP_AND_PRUNE=1,t.util.ZPP_Flags.id_ArbiterType_COLLISION=1,t.util.ZPP_Flags.id_ArbiterType_SENSOR=2,t.util.ZPP_Flags.id_ArbiterType_FLUID=4,t.callbacks.ZPP_Listener.internal=!1,t.callbacks.ZPP_Listener.types=function(n){null==t.util.ZPP_Flags.ListenerType_BODY&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.ListenerType_BODY=new e.callbacks.ListenerType,t.util.ZPP_Flags.internal=!1);var i=t.util.ZPP_Flags.ListenerType_BODY;null==t.util.ZPP_Flags.ListenerType_CONSTRAINT&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.ListenerType_CONSTRAINT=new e.callbacks.ListenerType,t.util.ZPP_Flags.internal=!1);var r=t.util.ZPP_Flags.ListenerType_CONSTRAINT;null==t.util.ZPP_Flags.ListenerType_INTERACTION&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.ListenerType_INTERACTION=new e.callbacks.ListenerType,t.util.ZPP_Flags.internal=!1);var o=t.util.ZPP_Flags.ListenerType_INTERACTION;return null==t.util.ZPP_Flags.ListenerType_PRE&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.ListenerType_PRE=new e.callbacks.ListenerType,t.util.ZPP_Flags.internal=!1),[i,r,o,t.util.ZPP_Flags.ListenerType_PRE]}(),t.callbacks.ZPP_Listener.events=function(n){null==t.util.ZPP_Flags.CbEvent_BEGIN&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.CbEvent_BEGIN=new e.callbacks.CbEvent,t.util.ZPP_Flags.internal=!1);var i=t.util.ZPP_Flags.CbEvent_BEGIN;null==t.util.ZPP_Flags.CbEvent_END&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.CbEvent_END=new e.callbacks.CbEvent,t.util.ZPP_Flags.internal=!1);var r=t.util.ZPP_Flags.CbEvent_END;null==t.util.ZPP_Flags.CbEvent_WAKE&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.CbEvent_WAKE=new e.callbacks.CbEvent,t.util.ZPP_Flags.internal=!1);var o=t.util.ZPP_Flags.CbEvent_WAKE;null==t.util.ZPP_Flags.CbEvent_SLEEP&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.CbEvent_SLEEP=new e.callbacks.CbEvent,t.util.ZPP_Flags.internal=!1);var a=t.util.ZPP_Flags.CbEvent_SLEEP;null==t.util.ZPP_Flags.CbEvent_BREAK&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.CbEvent_BREAK=new e.callbacks.CbEvent,t.util.ZPP_Flags.internal=!1);var s=t.util.ZPP_Flags.CbEvent_BREAK;null==t.util.ZPP_Flags.CbEvent_PRE&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.CbEvent_PRE=new e.callbacks.CbEvent,t.util.ZPP_Flags.internal=!1);var l=t.util.ZPP_Flags.CbEvent_PRE;return null==t.util.ZPP_Flags.CbEvent_ONGOING&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.CbEvent_ONGOING=new e.callbacks.CbEvent,t.util.ZPP_Flags.internal=!1),[i,r,o,a,s,l,t.util.ZPP_Flags.CbEvent_ONGOING]}(),t.callbacks.ZPP_InteractionListener.UCbSet=new t.util.ZNPList_ZPP_CbSet,t.callbacks.ZPP_InteractionListener.VCbSet=new t.util.ZNPList_ZPP_CbSet,t.callbacks.ZPP_InteractionListener.WCbSet=new t.util.ZNPList_ZPP_CbSet,t.callbacks.ZPP_InteractionListener.UCbType=new t.util.ZNPList_ZPP_CbType,t.callbacks.ZPP_InteractionListener.VCbType=new t.util.ZNPList_ZPP_CbType,t.callbacks.ZPP_InteractionListener.WCbType=new t.util.ZNPList_ZPP_CbType,t.dynamics.ZPP_Arbiter.internal=!1,t.dynamics.ZPP_Arbiter.COL=1,t.dynamics.ZPP_Arbiter.FLUID=4,t.dynamics.ZPP_Arbiter.SENSOR=2,t.dynamics.ZPP_Arbiter.types=function(n){null==t.util.ZPP_Flags.ArbiterType_COLLISION&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.ArbiterType_COLLISION=new e.dynamics.ArbiterType,t.util.ZPP_Flags.internal=!1);var i=t.util.ZPP_Flags.ArbiterType_COLLISION;null==t.util.ZPP_Flags.ArbiterType_SENSOR&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.ArbiterType_SENSOR=new e.dynamics.ArbiterType,t.util.ZPP_Flags.internal=!1);var r=t.util.ZPP_Flags.ArbiterType_SENSOR;return null==t.util.ZPP_Flags.ArbiterType_FLUID&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.ArbiterType_FLUID=new e.dynamics.ArbiterType,t.util.ZPP_Flags.internal=!1),[null,i,r,null,t.util.ZPP_Flags.ArbiterType_FLUID]}(),t.dynamics.ZPP_SensorArbiter.zpp_pool=null,t.dynamics.ZPP_FluidArbiter.zpp_pool=null,t.dynamics.ZPP_ColArbiter.FACE1=0,t.dynamics.ZPP_ColArbiter.FACE2=1,t.dynamics.ZPP_ColArbiter.CIRCLE=2,t.dynamics.ZPP_ColArbiter.zpp_pool=null,t.dynamics.ZPP_Contact.internal=!1,t.dynamics.ZPP_Contact.zpp_pool=null,t.dynamics.ZPP_InteractionFilter.zpp_pool=null,t.dynamics.ZPP_InteractionGroup.SHAPE=1,t.dynamics.ZPP_InteractionGroup.BODY=2,t.geom.ZPP_AABB.zpp_pool=null,t.geom.ZPP_Collide.flowpoly=new t.util.ZNPList_ZPP_Vec2,t.geom.ZPP_Collide.flowsegs=new t.util.ZNPList_ZPP_Vec2,t.geom.ZPP_ConvexRayResult.convexPool=null,t.geom.ZPP_ConvexRayResult.rayPool=null,t.geom.ZPP_ConvexRayResult.internal=!1,t.geom.ZPP_CutVert.zpp_pool=null,t.geom.ZPP_CutInt.zpp_pool=null,t.geom.ZPP_Cutter.ints=null,t.geom.ZPP_Cutter.paths=null,t.geom.ZPP_GeomVert.zpp_pool=null,t.geom.ZPP_GeomVertexIterator.zpp_pool=null,t.geom.ZPP_GeomVertexIterator.internal=!1,t.geom.ZPP_MarchSpan.zpp_pool=null,t.geom.ZPP_MarchPair.zpp_pool=null,t.geom.ZPP_MarchingSquares.me=new t.geom.ZPP_MarchingSquares,t.geom.ZPP_MarchingSquares.look_march=[-1,224,56,216,14,-1,54,214,131,99,-1,91,141,109,181,85],t.geom.ZPP_Mat23.zpp_pool=null,t.geom.ZPP_Monotone.queue=null,t.geom.ZPP_Monotone.edges=null,t.geom.ZPP_PartitionVertex.nextId=0,t.geom.ZPP_PartitionVertex.zpp_pool=null,t.geom.ZPP_PartitionedPoly.zpp_pool=null,t.geom.ZPP_Ray.internal=!1,t.geom.ZPP_SimpleVert.zpp_pool=null,t.geom.ZPP_SimpleSeg.zpp_pool=null,t.geom.ZPP_SimpleEvent.zpp_pool=null,t.geom.ZPP_Simple.sweep=null,t.geom.ZPP_Simple.inthash=null,t.geom.ZPP_Simple.vertices=null,t.geom.ZPP_Simple.queue=null,t.geom.ZPP_Simple.ints=null,t.geom.ZPP_Simple.list_vertices=null,t.geom.ZPP_Simple.list_queue=null,t.geom.ZPP_SimplifyV.zpp_pool=null,t.geom.ZPP_SimplifyP.zpp_pool=null,t.geom.ZPP_Simplify.stack=null,t.geom.ZPP_ToiEvent.zpp_pool=null,t.geom.ZPP_PartitionPair.zpp_pool=null,t.geom.ZPP_Triangular.queue=null,t.geom.ZPP_Triangular.stack=null,t.geom.ZPP_Triangular.edgeSet=null,t.geom.ZPP_Vec2.zpp_pool=null,t.phys.ZPP_Body.types=function(n){null==t.util.ZPP_Flags.BodyType_STATIC&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.BodyType_STATIC=new e.phys.BodyType,t.util.ZPP_Flags.internal=!1);var i=t.util.ZPP_Flags.BodyType_STATIC;null==t.util.ZPP_Flags.BodyType_DYNAMIC&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.BodyType_DYNAMIC=new e.phys.BodyType,t.util.ZPP_Flags.internal=!1);var r=t.util.ZPP_Flags.BodyType_DYNAMIC;return null==t.util.ZPP_Flags.BodyType_KINEMATIC&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.BodyType_KINEMATIC=new e.phys.BodyType,t.util.ZPP_Flags.internal=!1),[null,i,r,t.util.ZPP_Flags.BodyType_KINEMATIC]}(),t.phys.ZPP_Body.bodystack=null,t.phys.ZPP_Body.bodyset=null,t.phys.ZPP_Body.cur_graph_depth=0,t.phys.ZPP_FluidProperties.zpp_pool=null,t.phys.ZPP_Material.zpp_pool=null,t.phys.ZPP_Material.WAKE=1,t.phys.ZPP_Material.PROPS=2,t.phys.ZPP_Material.ANGDRAG=4,t.phys.ZPP_Material.ARBITERS=8,t.shape.ZPP_Shape.types=function(n){null==t.util.ZPP_Flags.ShapeType_CIRCLE&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.ShapeType_CIRCLE=new e.shape.ShapeType,t.util.ZPP_Flags.internal=!1);var i=t.util.ZPP_Flags.ShapeType_CIRCLE;return null==t.util.ZPP_Flags.ShapeType_POLYGON&&(t.util.ZPP_Flags.internal=!0,t.util.ZPP_Flags.ShapeType_POLYGON=new e.shape.ShapeType,t.util.ZPP_Flags.internal=!1),[i,t.util.ZPP_Flags.ShapeType_POLYGON]}(),t.shape.ZPP_Edge.zpp_pool=null,t.shape.ZPP_Edge.internal=!1,t.space.ZPP_AABBNode.zpp_pool=null,t.space.ZPP_AABBPair.zpp_pool=null,t.space.ZPP_AABBTree.tmpaabb=new t.geom.ZPP_AABB,t.space.ZPP_DynAABBPhase.FATTEN=3,t.space.ZPP_DynAABBPhase.VEL_STEPS=2,t.space.ZPP_Island.zpp_pool=null,t.space.ZPP_Component.zpp_pool=null,t.space.ZPP_CallbackSet.zpp_pool=null,t.space.ZPP_SweepData.zpp_pool=null,t.util.Hashable2_Boolfalse.zpp_pool=null,t.util.ZNPNode_ZPP_CbType.zpp_pool=null,t.util.ZNPNode_ZPP_CallbackSet.zpp_pool=null,t.util.ZNPNode_ZPP_Shape.zpp_pool=null,t.util.ZNPNode_ZPP_Body.zpp_pool=null,t.util.ZNPNode_ZPP_Constraint.zpp_pool=null,t.util.ZNPNode_ZPP_Compound.zpp_pool=null,t.util.ZNPNode_ZPP_Arbiter.zpp_pool=null,t.util.ZNPNode_ZPP_InteractionListener.zpp_pool=null,t.util.ZNPNode_ZPP_CbSet.zpp_pool=null,t.util.ZNPNode_ZPP_Interactor.zpp_pool=null,t.util.ZNPNode_ZPP_BodyListener.zpp_pool=null,t.util.ZNPNode_ZPP_CbSetPair.zpp_pool=null,t.util.ZNPNode_ZPP_ConstraintListener.zpp_pool=null,t.util.ZNPNode_ZPP_CutInt.zpp_pool=null,t.util.ZNPNode_ZPP_CutVert.zpp_pool=null,t.util.ZNPNode_ZPP_PartitionVertex.zpp_pool=null,t.util.ZNPNode_ZPP_SimplifyP.zpp_pool=null,t.util.ZNPNode_ZPP_PartitionedPoly.zpp_pool=null,t.util.ZNPNode_ZPP_GeomVert.zpp_pool=null,t.util.ZNPNode_ZPP_SimpleVert.zpp_pool=null,t.util.ZNPNode_ZPP_SimpleEvent.zpp_pool=null,t.util.ZNPNode_ZPP_Vec2.zpp_pool=null,t.util.ZNPNode_ZPP_AABBPair.zpp_pool=null,t.util.ZNPNode_ZPP_Edge.zpp_pool=null,t.util.ZNPNode_ZPP_AABBNode.zpp_pool=null,t.util.ZNPNode_ZPP_Component.zpp_pool=null,t.util.ZNPNode_ZPP_FluidArbiter.zpp_pool=null,t.util.ZNPNode_ZPP_SensorArbiter.zpp_pool=null,t.util.ZNPNode_ZPP_Listener.zpp_pool=null,t.util.ZNPNode_ZPP_ColArbiter.zpp_pool=null,t.util.ZNPNode_ZPP_InteractionGroup.zpp_pool=null,t.util.ZNPNode_ZPP_ToiEvent.zpp_pool=null,t.util.ZNPNode_ConvexResult.zpp_pool=null,t.util.ZNPNode_ZPP_GeomPoly.zpp_pool=null,t.util.ZNPNode_RayResult.zpp_pool=null,t.util.ZPP_ConstraintList.internal=!1,t.util.ZPP_BodyList.internal=!1,t.util.ZPP_InteractorList.internal=!1,t.util.ZPP_CompoundList.internal=!1,t.util.ZPP_ListenerList.internal=!1,t.util.ZPP_CbTypeList.internal=!1,t.util.ZPP_Vec2List.internal=!1,t.util.ZPP_GeomPolyList.internal=!1,t.util.ZPP_RayResultList.internal=!1,t.util.ZPP_ConvexResultList.internal=!1,t.util.ZPP_EdgeList.internal=!1,t.util.ZPP_ShapeList.internal=!1,t.util.ZPP_InteractionGroupList.internal=!1,t.util.ZPP_ArbiterList.internal=!1,t.util.ZPP_ContactList.internal=!1,t.util.ZPP_PubPool.poolGeomPoly=null,t.util.ZPP_PubPool.nextGeomPoly=null,t.util.ZPP_PubPool.poolVec2=null,t.util.ZPP_PubPool.nextVec2=null,t.util.ZPP_PubPool.poolVec3=null,t.util.ZPP_PubPool.nextVec3=null,t.util.ZPP_Set_ZPP_Body.zpp_pool=null,t.util.ZPP_Set_ZPP_CbSetPair.zpp_pool=null,t.util.ZPP_Set_ZPP_PartitionVertex.zpp_pool=null,t.util.ZPP_Set_ZPP_PartitionPair.zpp_pool=null,t.util.ZPP_Set_ZPP_SimpleVert.zpp_pool=null,t.util.ZPP_Set_ZPP_SimpleSeg.zpp_pool=null,t.util.ZPP_Set_ZPP_SimpleEvent.zpp_pool=null,t.util.ZPP_Set_ZPP_CbSet.zpp_pool=null,a.Main.main(),e}))},DD={id:Nk,create:({config:{wind:e,gravity:t,pixelRatio:n}})=>{window.nape||FD();const i=new nape.space.Space(new nape.geom.Vec2(e,t));let r;return{space:i,createStaticBodiesFromModel:({model:e,filter:t={group:1,mask:2}})=>{r||(r=new nape.dynamics.InteractionFilter,r.set_collisionGroup(t.group),r.set_collisionMask(t.mask)),e.traverse((e=>{if(e.isMesh){const o=(e.geometry.boundingBox.max.x-e.geometry.boundingBox.min.x)*n*e.scale.x,a=(e.geometry.boundingBox.max.y-e.geometry.boundingBox.min.y)*n*e.scale.y;var t=new nape.phys.Body(nape.phys.BodyType.get_STATIC());t.get_shapes().add(new nape.shape.Polygon(nape.shape.Polygon.box(o,a))),t.setShapeMaterials(nape.phys.Material.wood()),t.setShapeFilters(r),t.get_position().set_x(e.position.x*n),t.get_position().set_y(e.position.y*-n),t.set_rotation(2*Math.PI-e.rotation.z),t.set_space(i)}}))},update:({isPaused:e,delta:t})=>{e||i.step(t)},dispose:()=>{i.get_bodies().empty(),i.clear()}}},config:{wind:0,gravity:350,pixelRatio:17,debug:!1,callLimit:Kx.CALL_60_PER_SECONDS,forceCallCount:!0}},GD=ey(yy(),{assetsConfig:AD,renderer:{pixelRatio:window.devicePixelRatio>1.4?1.4:1},entities:()=>{const e=new _b(16777215,.2);return e.position.set(0,20,-10),e.castShadow=!0,e.shadow.mapSize.width=1024,e.shadow.mapSize.height=1024,e.shadow.radius=.5,e.shadow.bias=-3e-4,e.shadow.camera.top=50,e.shadow.camera.bottom=-50,e.shadow.camera.left=-50,e.shadow.camera.right=50,e.shadow.camera.near=.1,e.shadow.camera.far=100,[new lb(4491451,8772,.4),e]},modules:[{...oD,config:kD},DD,HD,HF,ey(sD,{config:{callLimit:Kx.CALL_60_PER_SECONDS,yBoundaries:{min:2*-Math.PI,max:2*Math.PI},maxDistance:20,lerp:{position:{normal:20},targetRotation:1}}})],skybox:{size:1500,textures:[yD,vD,gD,bD,zD,wD]},onProgress:e=>{document.documentElement.style.setProperty("--preloader-progress-ratio",100*e+"%")},onLoaded:e=>{const{on:t,scene:n,getModule:i}=e;Be.world=e,t.pause((()=>IF.globalTimeline.pause())),t.resume((()=>IF.globalTimeline.resume())),setTimeout((()=>{const r=i(Ck);e.setCamera(r.instance),e.userData.tpsCamera=r,r.instance.far=1500,r.instance.updateProjectionMatrix();const o=i(Nk),a=i(Ak),s=(({scene:e,thirdPersonCamera:t,napeModule:n,napeCar:i})=>{const r=i.createCar({position:new ev(0,-100,0),config:OD});[r.body.model,r.wheels.frontA.model,r.wheels.frontB.model,r.wheels.rearA.model,r.wheels.rearB.model].forEach((e=>{e.traverse((e=>{e.isMesh&&(e.material.map.flipY=!1)}))})),[r.wheels.frontA,r.wheels.frontB,r.wheels.rearA,r.wheels.rearB].forEach((e=>{e.effect=bT(fz[_z]),e.model.add(e.effect.instance)})),Be.world.getModule(zk).addCollector(r);const o=kh(MD).scene;e.add(o),o.traverse((e=>{e.isMesh&&(ze.update((e=>e+1)),((e,t)=>{const n=Be.world.getModule(zk),{model:i}=n.addCollectible({...e,collisionObject:t});IF.to(i.rotation,{y:2*Math.PI,ease:"linear",duration:3,repeat:-1})})(ID.collectible,e))}));const a=kh(ED).scene;e.add(a),n.createStaticBodiesFromModel({model:a});const s=e.children[1];return s.target=r.body.model,t.setTarget(r.body.model),{update:()=>{s.position.x=r.body.model.position.x+20,s.position.y=r.body.model.position.y+20,r.wheels.frontA.onAir?(r.wheels.frontA.effect.pauseEmitter(),r.wheels.frontB.effect.pauseEmitter()):(r.wheels.frontA.effect.resumeEmitter(),r.wheels.frontB.effect.resumeEmitter()),r.wheels.rearA.onAir?(r.wheels.rearA.effect.pauseEmitter(),r.wheels.rearB.effect.pauseEmitter()):(r.wheels.rearA.effect.resumeEmitter(),r.wheels.rearB.effect.resumeEmitter())},dispose:()=>{r.wheels.frontA.effect.dispose(),r.wheels.frontB.effect.dispose(),r.wheels.rearA.effect.dispose(),r.wheels.rearB.effect.dispose(),i.dispose(),n.dispose()},control:{accelerate:e=>{r.isAccelerating=e},reverse:e=>{r.isReversing=e},leanBack:e=>{r.isLeaningBack=e},leanForward:e=>{r.isLeaningForward=e}}}})({scene:n,thirdPersonCamera:r,napeModule:o,napeCar:a});i(Sk).setTarget(s),VD(e),t.update(s.update),t.dispose((()=>{Le.set([]),ze.set(0),we.set(0),s.dispose()}))}))}}),UD="SKYBOX_1",jD="SKYBOX_2",WD="SKYBOX_3",qD="SKYBOX_4",JD="SKYBOX_5",$D="SKYBOX_6",XD="GREEN_SNAKE",YD="BLUE_RACER",KD="GREEN_GROUND",QD="FOREST_OBSTACLES",eG="APPLE",tG="ORANGE",nG="PEAR",iG="FROG_GREEN",rG="GREEN_SNAKE_HEAD",oG="GREEN_SNAKE_BODY",aG="GREEN_SNAKE_TAIL",sG="BLUE_RACER_HEAD",lG="BLUE_RACER_BODY",pG="BLUE_RACER_TAIL",uG="APPLE",hG="ORANGE",cG="PEAR",_G="FROG_GREEN",dG="TREE_1X1",mG="GROUND_1X1",PG="BUSH_1X1",fG={textures:[{id:UD,url:"./assets/textures/skybox/left.webp"},{id:jD,url:"./assets/textures/skybox/right.webp"},{id:WD,url:"./assets/textures/skybox/up.webp"},{id:qD,url:"./assets/textures/skybox/down.webp"},{id:JD,url:"./assets/textures/skybox/front.webp"},{id:$D,url:"./assets/textures/skybox/back.webp"},{id:"POINT",url:"./assets/textures/effects/point.webp"},{id:XD,url:"./assets/textures/green-snake.webp"},{id:YD,url:"./assets/textures/blue-racer.webp"},{id:KD,url:"./assets/textures/green-ground.png"},{id:QD,url:"./assets/textures/forest-obstacles.webp"},{id:eG,url:"./assets/textures/apple.webp"},{id:tG,url:"./assets/textures/orange.webp"},{id:nG,url:"./assets/textures/pear.webp"},{id:iG,url:"./assets/textures/frog-green.webp"}],fbxModels:[{id:rG,url:"./assets/models/snakes/green/green-snake-head.fbx",material:{materialType:ab,texture:{id:XD}}},{id:oG,url:"./assets/models/snakes/green/green-snake-body.fbx",material:{materialType:ab,texture:{id:XD}}},{id:aG,url:"./assets/models/snakes/green/green-snake-tail.fbx",material:{materialType:ab,texture:{id:XD}}},{id:sG,url:"./assets/models/snakes/blue/blue-racer-head.fbx",material:{materialType:ab,texture:{id:YD}}},{id:lG,url:"./assets/models/snakes/blue/blue-racer-body.fbx",material:{materialType:ab,texture:{id:YD}}},{id:pG,url:"./assets/models/snakes/blue/blue-racer-tail.fbx",material:{materialType:ab,texture:{id:YD}}}],gltfModels:[{id:uG,url:"./assets/models/collectibles/apple.glb",material:{materialType:ab,texture:{id:eG}}},{id:hG,url:"./assets/models/collectibles/orange.glb",material:{materialType:ab,texture:{id:tG}}},{id:cG,url:"./assets/models/collectibles/pear.glb",material:{materialType:ab,texture:{id:nG}}},{id:_G,url:"./assets/models/collectibles/frog.glb",material:{materialType:ab,texture:{id:iG}}},{id:dG,url:"./assets/models/obstacles/tree-1x1.glb",material:{materialType:ab,texture:{id:QD}}},{id:mG,url:"./assets/models/obstacles/ground-1x1.glb",material:{materialType:ab,texture:{id:QD}}},{id:PG,url:"./assets/models/obstacles/bush-1x1.glb",material:{materialType:ab,texture:{id:QD}}}],audio:[{id:"GAME_BACKGROUND",url:"./assets/audio/music/game-theme.ogg"}]},xG="LEFT",yG="RIGHT",vG="UP",gG="DOWN",bG={LEFT:new ev(-1,0,0),RIGHT:new ev(1,0,0),UP:new ev(0,0,-1),DOWN:new ev(0,0,1)},zG={[xG]:bG.LEFT,[yG]:bG.RIGHT,[vG]:bG.UP,[gG]:bG.DOWN},wG={[xG]:bG.RIGHT,[yG]:bG.LEFT,[vG]:bG.DOWN,[gG]:bG.UP},ZG="BLUE",EG="GREEN",MG={[EG]:{head:rG,body:oG,tail:aG},[ZG]:{head:sG,body:lG,tail:pG}},SG=new ev(80,0,52),CG=new ev,NG=[{name:"You",parts:Array.from({length:4}).map(((e,t)=>new ev(5-t,0,SG.z/2))),direction:bG.RIGHT,type:Math.random()>.5?EG:ZG,hasAi:!1},{name:"Comp-1",parts:Array.from({length:4}).map(((e,t)=>new ev(SG.x-5+t,0,SG.z/2))),direction:bG.LEFT,type:Math.random()>.5?EG:ZG,hasAi:!0},{name:"Comp-2",parts:Array.from({length:4}).map(((e,t)=>new ev(SG.x/2,0,5-t))),direction:bG.UP,type:Math.random()>.5?EG:ZG,hasAi:!0},{name:"Comp-3",parts:Array.from({length:4}).map(((e,t)=>new ev(SG.x/2,0,SG.z-5+t))),direction:bG.DOWN,type:Math.random()>.5?EG:ZG,hasAi:!0}];let AG=NG.map((({name:e},t)=>({name:e,value:0,isActive:!0,selected:0===t})));Ae.set(AG);const LG="CHANGE_CAMERA_DISTANCE";let BG=0;const TG=[{maxCameraDistance:15,rotation:{x:-Math.PI,y:Math.PI-Math.PI/16},positionOffset:{x:0,y:0,z:0},useTargetRotation:!1},{maxCameraDistance:25,rotation:{x:-Math.PI,y:Math.PI-Math.PI/8},positionOffset:{x:0,y:0,z:0},useTargetRotation:!1},{maxCameraDistance:5,rotation:{x:-Math.PI,y:Math.PI-Math.PI/3},positionOffset:{x:0,y:3,z:0},useTargetRotation:!0}],VG=e=>{e.userData.tpsCamera&&(e.userData.tpsCamera.setUseTargetRotation(TG[BG].useTargetRotation),e.userData.tpsCamera.setMaxDistance(TG[BG].maxCameraDistance),e.userData.tpsCamera.setRotation(TG[BG].rotation),e.userData.tpsCamera.setPositionOffset(TG[BG].positionOffset))},kG={actionConfig:[...tI.actionConfig,{actionId:eI.FORWARD,listenForDeactivation:!1,keys:[Qk.W,Qk.ARROW_UP],gamepadButtons:[Yk.Up],axis:Yk.LeftAxisY,axisValidator:e=>e<-.1,axisValueModifier:e=>-1*e},{actionId:eI.BACKWARD,listenForDeactivation:!1,keys:[Qk.S,Qk.ARROW_DOWN],gamepadButtons:[Yk.Down],axis:Yk.LeftAxisY,axisValidator:e=>e>.1},{actionId:eI.LEFT,listenForDeactivation:!1,keys:[Qk.A,Qk.ARROW_LEFT],gamepadButtons:[Yk.Left],axis:Yk.LeftAxisX,axisValidator:e=>e<-.1,axisValueModifier:e=>-1*e},{actionId:eI.RIGHT,listenForDeactivation:!1,keys:[Qk.D,Qk.ARROW_RIGHT],gamepadButtons:[Yk.Right],axis:Yk.LeftAxisX,axisValidator:e=>e>.1},{actionId:LG,keys:[Qk.C]}],handlers:[...tI.handlers,{actionId:eI.FORWARD,callback:({world:e,target:t})=>{e.userData.tpsCamera&&e.userData.tpsCamera.getUseTargetRotation()||t.setDirection(vG)}},{actionId:eI.BACKWARD,callback:({world:e,target:t})=>{e.userData.tpsCamera&&e.userData.tpsCamera.getUseTargetRotation()||t.setDirection(gG)}},{actionId:eI.LEFT,callback:({world:e,target:t})=>{if(e.userData.tpsCamera)if(e.userData.tpsCamera.getUseTargetRotation()){const e=t.player.direction;t.setDirection(e===bG.UP?xG:e===bG.DOWN?yG:e===bG.LEFT?gG:vG)}else t.setDirection(xG)}},{actionId:eI.RIGHT,callback:({world:e,target:t})=>{if(e.userData.tpsCamera)if(e.userData.tpsCamera.getUseTargetRotation()){const e=t.player.direction;t.setDirection(e===bG.UP?yG:e===bG.DOWN?xG:e===bG.LEFT?vG:gG)}else t.setDirection(yG)}},{actionId:LG,callback:({world:e})=>{BG++,BG===TG.length&&(BG=0),VG(e)}}]},IG=ey(yy(),{assetsConfig:fG,renderer:{pixelRatio:window.devicePixelRatio>1.4?1.4:1},entities:()=>{const e=new _b(16777215,.3);e.position.set(90,35,26),e.castShadow=!0;const t=100;return e.shadow.mapSize.width=1024,e.shadow.mapSize.height=1024,e.shadow.radius=1,e.shadow.bias=-6e-5,e.shadow.camera.top=t,e.shadow.camera.bottom=-t,e.shadow.camera.left=-t,e.shadow.camera.right=t,e.shadow.camera.near=.1,e.shadow.camera.far=500,[new lb(4491451,8772,.5),e]},modules:[{...oD,config:kG},ey(sD,{config:{callLimit:Kx.NO_LIMIT,yBoundaries:{min:2*-Math.PI,max:2*Math.PI},maxDistance:20,lerp:{position:{normal:2},targetRotation:1}}})],skybox:{textures:[UD,jD,WD,qD,JD,$D]},onProgress:e=>{document.documentElement.style.setProperty("--preloader-progress-ratio",100*e+"%")},onLoaded:e=>{const{on:t,scene:n,getModule:i}=e;Be.world=e,t.pause((()=>IF.globalTimeline.pause())),t.resume((()=>IF.globalTimeline.resume())),setTimeout((()=>{const r=i(Ck);e.setCamera(r.instance),e.userData.tpsCamera=r;const o=(({scene:e,thirdPersonCamera:t})=>{const n=.012;let i,r=[],o=[],a=[],s=300,l=0,p=!1;const u=new ib(SG.x,SG.z),h=new ab({map:Oh(KD)});h.map.repeat.set(SG.x/5,SG.z/5);const c=new qg(u,h);c.receiveShadow=!0,c.position.x=SG.x/2-.6,c.position.z=SG.z/2-.5,c.rotation.x=-Math.PI/2,e.add(c);const _=bT(fz[pz],Be.cycleData.now).instance;_.position.x=SG.x/2-.6,_.position.z=SG.z/2-.5,e.add(_);const d=e=>{const t=Bh(e);return t.scale.set(n,n,n),t.castShadow=!0,t};NG.forEach((t=>{const i=((e,{parts:t,type:i,hasAi:r,direction:o,name:a})=>{let s=[];const l=Bh(MG[i].head);l.scale.set(n,n,n),l.castShadow=!0;const p=Bh(MG[i].tail);p.scale.set(n,n,n),p.castShadow=!0,t.forEach(((n,r)=>{const o=0===r?l:r===t.length-1?p:d(MG[i].body);o.position.copy(n),s.push(o),e.add(o)}));const u=s.map((e=>e.position.clone()));return{name:a,meshes:s,positions:u,nextDirection:o,direction:o,grow:()=>{const t=d(MG[i].body);t.position.copy(s[s.length-1].position),t.visible=!1,e.add(t),s.pop(),s.push(t),s.push(p),u.push(new ev)},hasAi:r}})(e,t);r.push(i)}));const m=e=>e.x<1||e.x>SG.x-2||e.z<1||e.z>SG.z-2||r.some((t=>t.positions.some((t=>e!==t&&Math.abs(t.x-e.x)<.4&&Math.abs(t.z-e.z)<.4))))||a.some((({position:t})=>e!==t&&Math.abs(t.x-e.x)<.4&&Math.abs(t.z-e.z)<.4)),P=new ev,f=()=>{let e=100;for(;m(P)||e-- >0;)P.x=Math.floor(Math.random()*SG.x),P.z=Math.floor(Math.random()*SG.z);return P},x=[dG,mG,PG];for(let t=0;t<SG.x;t++){const t=Math.floor(Math.random()*x.length),n=kh(x[t]).scene.clone();n.castShadow=!0,n.position.copy(f()),e.add(n),a.push(n)}for(let t=0;t<SG.x;t++)for(let n=0;n<SG.z;n++){if(0!==t&&0!==n&&t!==SG.x-1&&n!==SG.z-1)continue;const i=kh(mG).scene.clone();i.castShadow=!0,i.position.set(t,0,n),e.add(i),a.push(i)}const y=[uG,hG,cG,_G];o=Array.from({length:20},(()=>{const t=Math.floor(Math.random()*y.length),n=kh(y[t]).scene.clone();n.castShadow=!0,n.position.copy(f()),e.add(n);const i=bT(fz[uz],Be.cycleData.now).instance;return i.position.y=.05,n.add(i),n}));const v=(e,t,n)=>{IF.to(e.position,{x:e.position.x+t.x,y:e.position.y+t.y,z:e.position.z+t.z,duration:n,ease:"linear"});let i=Math.atan2(t.x,t.z);Math.abs(i-e.rotation.y)>.1&&(e.rotation.y>0&&i<0?e.rotation.y-=2*Math.PI:e.rotation.y<0&&i>0&&(e.rotation.y+=2*Math.PI),IF.killTweensOf(e.rotation),IF.to(e.rotation,{y:i,duration:n,ease:"linear"}))},g=(e,t,n)=>{let i=Math.atan2(t.x,t.z);Math.abs(i-e.rotation.y)>.1&&(e.rotation.y>0&&i<0?e.rotation.y-=2*Math.PI:e.rotation.y<0&&i>0&&(e.rotation.y+=2*Math.PI),IF.to(e.rotation,{y:i,duration:n/2,ease:"linear"}))};return i=r[0],t.setTarget(i.meshes[0]),{update:({now:n})=>{if(!p&&(0===l&&(l=n),n-l>=s)){const a=[],u=s/1e3;l+=n-l,r.forEach((e=>{m(e.positions[0])&&(a.push(e),AG=AG.map((t=>t.name===e.name?{...t,isActive:!1}:t)),Ae.set(AG))})),r=r.filter((e=>!a.includes(e))),a.forEach((t=>t.meshes.forEach(((t,n)=>{IF.delayedCall(.1*n,(()=>{const n=bT(fz[cz],Be.cycleData.now);n.instance.position.copy(t.position),n.instance.position.y=1,e.add(n.instance),IF.delayedCall(3,n.dispose),e.remove(t)}))})))),r.length>0&&a.length>0&&a.some((({meshes:e})=>e[0]===t.getTarget()))&&(t.setTarget(null),IF.delayedCall(.1*i.positions.length+1,(()=>t.setTarget(r[0].meshes[0])))),r.length<2&&(p=!0),r.forEach((t=>{t.hasAi&&(e=>{const t=e.positions[0];let n=o[0].position.distanceTo(t);const i=o.reduce(((e,i)=>{const r=i.position.distanceTo(t);return r<n?(n=r,i):e}),o[0]),r=t.clone().add(bG.LEFT),a=t.clone().add(bG.RIGHT),s=t.clone().add(bG.UP),l=t.clone().add(bG.DOWN);i&&(t.x<i.position.x&&!m(a)?e.nextDirection=bG.RIGHT:t.x>i.position.x&&!m(r)?e.nextDirection=bG.LEFT:t.z>i.position.z&&!m(s)?e.nextDirection=bG.UP:t.z<i.position.z&&!m(l)?e.nextDirection=bG.DOWN:m(a)?m(r)?m(s)?m(l)||(e.nextDirection=bG.DOWN):e.nextDirection=bG.UP:e.nextDirection=bG.LEFT:e.nextDirection=bG.RIGHT)})(t);const{meshes:n,nextDirection:i}=t;for(let e=n.length-1;e>0;e--)t.positions[e].copy(n[e-1].position),t.positions[e].round(),CG.copy(n[e-1].position).sub(n[e].position),v(n[e],CG,u),e>1&&(CG.copy(n[e-2].position).sub(n[e].position),g(n[e],CG,u)),e>1&&!n[e].position.equals(n[n.length-1].position)&&(n[e].visible=!0);t.direction=i,v(n[0],i,u),t.positions[0].add(i),t.positions[0].round();const r=t.positions[0];o.forEach((n=>{if(n.position.distanceTo(r)<.4){const i=bT(fz[hz],Be.cycleData.now);i.instance.position.copy(n.position),i.instance.position.y=1,e.add(i.instance),IF.delayedCall(3,i.dispose),n.position.copy(f()),t.grow(),s=Math.max(120,s-2),AG=AG.map((e=>e.name===t.name?{...e,value:e.value+1}:e)),Ae.set(AG)}}))}))}},player:i,setDirection:e=>{wG[e]!==i.direction&&(i.nextDirection=zG[e])}}})({scene:n,thirdPersonCamera:r});i(Sk).setTarget(o),VG(e),t.update(o.update)}))}}),OG="SKYBOX_1",RG="SKYBOX_2",HG="SKYBOX_3",FG="SKYBOX_4",DG="SKYBOX_5",GG="SKYBOX_6",UG="ARCADE_CAR_YELLOW",jG="ARCADE_CAR_RED",WG="ARCADE_CAR_LIGHT_BLUE",qG="ARCADE_CAR_BLUE",JG="ARCADE_CAR_GRAY",$G="ARCADE_CAR",XG="LEVEL_GRAPHIC",YG="LEVEL_COLLISION",KG={textures:[{id:OG,url:"./assets/textures/skybox/left.webp"},{id:RG,url:"./assets/textures/skybox/right.webp"},{id:HG,url:"./assets/textures/skybox/up.webp"},{id:FG,url:"./assets/textures/skybox/down.webp"},{id:DG,url:"./assets/textures/skybox/front.webp"},{id:GG,url:"./assets/textures/skybox/back.webp"},{id:"SMOKE",url:"./assets/textures/effects/smoke.webp"},{id:UG,url:"./assets/textures/arcade-racing-car-tex-yellow.png"},{id:jG,url:"./assets/textures/arcade-racing-car-tex-red.png"},{id:WG,url:"./assets/textures/arcade-racing-car-tex-light-blue.png"},{id:qG,url:"./assets/textures/arcade-racing-car-tex-blue.png"},{id:JG,url:"./assets/textures/arcade-racing-car-tex-gray.png"}],fbxModels:[{id:$G,url:"./assets/models/vehicles/arcade-racing-car.fbx",material:{materialType:ab,texture:{id:UG}}}],fbxSkeletonAnimations:[],gltfModels:[{id:XG,url:"./assets/models/world/drift-graphic.glb"},{id:YG,url:"./assets/models/world/drift-collision.glb"}],audio:[{id:"GAME_BACKGROUND",url:"./assets/audio/music/game-theme.ogg"}]},QG="CHANGE_CAMERA_DISTANCE",eU="CHANGE_CAR_COLOR";let tU=0;const nU=[6,10,4];let iU=0;const rU=[UG,jG,WG,qG,JG],oU={actionConfig:[...nI.actionConfig,{actionId:QG,keys:[Qk.C]},{actionId:eU,keys:[Qk.V]}],handlers:[...nI.handlers,{actionId:QG,callback:({world:e})=>{tU++,tU===nU.length&&(tU=0),e.userData.maxCameraDistance=nU[tU],e.userData.tpsCamera&&e.userData.tpsCamera.setMaxDistance(e.userData.maxCameraDistance)}},{actionId:eU,callback:({target:e})=>{iU++,iU===rU.length&&(iU=0),e.model.children[0].material.map=Oh(rU[iU])}}]};let aU={};const sU=Array.from({length:4}).reduce(((e,t,n)=>({...e,[`checkpoint-${n+1}-enter`]:`checkpoint-${n+1}-leave`,[`checkpoint-${n+1}-leave`]:`checkpoint-${3===n?1:n+2}-enter`})),{}),lU="checkpoint-1-enter";let pU=lU,uU=0,hU=0;const cU={body:{model:{},width:1.6,height:1.5,length:2.72,offset:new p_},wheel:{radius:.4,mass:1},speedReductionByCollision:.85,maxSpeed:60,maxReverseSpeed:40,accelerationForward:.3,accelerationBackward:.12,breakRatio:.95,damping:.985,friction:.99,minAcceleration:1,steeringResetSpeed:3,maxSteeringSpeed:5,maxWheelAngle:Math.PI/3,frontWheelSpeedMultiplier:1,rearWheelSpeedMultiplier:.65},_U=ty(cU,{body:{model:{fbx:{id:$G},scale:new ev(.0085,.0085,.0085)},offset:new ev(-.05,-.4,0)}}),dU={id:Ek,create:({world:{scene:e,getModule:t},config:{debug:n}})=>{let i=[];const r=new p_,o=new p_;return{createCar:({id:r,position:o=new p_,config:a})=>{const s=t(Zk),{createSphere:l}=t(gk),{body:{width:p,height:u,length:h},wheel:{radius:c,mass:_}}=a,d=l({radius:c,position:new p_(o.x+h/2,o.y+2*c,o.z+-p/2+c),mass:_}),m=l({radius:c,position:new p_(o.x+h/2,o.y+2*c,o.z+p/2-c),mass:_}),P=l({radius:c,position:new p_(o.x+-h/2,o.y+2*c,o.z+-p/2+c),mass:_}),f=l({radius:c,position:new p_(o.x+-h/2,o.y+2*c,o.z+p/2-c),mass:_});n&&[d,m,P,f].forEach((t=>{t.mesh.material.transparent=!0,t.mesh.material.opacity=.5,e.add(t.mesh)})),s.createConstraintGroup({constraints:[{pointA:d.collider.center,pointB:P.collider.center},{pointA:m.collider.center,pointB:f.collider.center},{pointA:d.collider.center,pointB:m.collider.center},{pointA:P.collider.center,pointB:f.collider.center},{pointA:d.collider.center,pointB:f.collider.center},{pointA:m.collider.center,pointB:P.collider.center}],config:{useAutoDistances:!0}});const x=RF(a.body.model);e.add(x);const y=new c_(new p_(o.x+-h/2,o.y+-u/2,o.z+-p/2),new p_(o.x+h/2,o.y+u/2,o.z+p/2));if(n){var v=new Xx(y);e.add(v)}const g=e=>x.children.find((t=>{const n=t.name.toLowerCase();return!e.some((e=>!n.includes(e)))})),b=g(["front","left"]),z=g(["front","right"]),w=g(["rear","left"]),Z=g(["rear","right"]),E=new hd;b.parent.add(E),E.add(b),E.position.copy(b.position),b.position.set(0,0,0);const M=new hd;z.parent.add(M),M.add(z),M.position.copy(z.position),z.position.set(0,0,0);const S={id:r??sy(),model:x,box:y,config:a,wheels:{frontLeftWheel:{octreeSphere:d,mesh:E,defaultRotation:b.rotation.x},frontRightWheel:{octreeSphere:m,mesh:M,defaultRotation:z.rotation.x},rearLeftWheel:{octreeSphere:P,mesh:w,defaultRotation:w.rotation.x},rearRightWheel:{octreeSphere:f,mesh:Z,defaultRotation:Z.rotation.x}},wheelDirection:0,currentSpeed:0,realSpeed:0,isAccelerating:!1,isReversing:!1,isRotatingToLeft:!1,isRotatingToRight:!1};return d.on.collision((e=>{(Math.abs(e.normal.x)>.01||Math.abs(e.normal.z)>.01)&&(S.currentSpeed*=a.speedReductionByCollision)})),m.on.collision((e=>{(Math.abs(e.normal.x)>.01||Math.abs(e.normal.z)>.01)&&(S.currentSpeed*=a.speedReductionByCollision)})),ty(S,{accelerate:()=>S.isAccelerating=!S.isAccelerating,reverse:()=>S.isReversing=!S.isReversing,rotateLeft:()=>S.isRotatingToLeft=!S.isRotatingToLeft,rotateRight:()=>S.isRotatingToRight=!S.isRotatingToRight},{applyToFirstObject:!0}),i.push(S),S},update:({isPaused:e,delta:t})=>{e||i.length&&i.forEach((e=>{const{isAccelerating:n,isReversing:i,isRotatingToLeft:a,isRotatingToRight:s,model:l,box:p,config:u,wheels:{frontLeftWheel:h,frontRightWheel:c,rearLeftWheel:_,rearRightWheel:d}}=e;l.position.set(h.octreeSphere.mesh.position.x+(d.octreeSphere.mesh.position.x-h.octreeSphere.mesh.position.x)/2,h.octreeSphere.mesh.position.y+(d.octreeSphere.mesh.position.y-h.octreeSphere.mesh.position.y)/2,h.octreeSphere.mesh.position.z+(d.octreeSphere.mesh.position.z-h.octreeSphere.mesh.position.z)/2).add(u.body.offset),_.octreeSphere.mesh.position.z<d.octreeSphere.mesh.position.z?(r.copy(h.octreeSphere.mesh.position),r.y=h.octreeSphere.mesh.position.y>c.octreeSphere.mesh.position.y?h.octreeSphere.mesh.position.y:c.octreeSphere.mesh.position.y,_.octreeSphere.mesh.lookAt(r),l.quaternion.copy(_.octreeSphere.mesh.quaternion)):(r.copy(c.octreeSphere.mesh.position),r.y=h.octreeSphere.mesh.position.y<c.octreeSphere.mesh.position.y?h.octreeSphere.mesh.position.y:c.octreeSphere.mesh.position.y,d.octreeSphere.mesh.lookAt(r),l.quaternion.slerp(d.octreeSphere.mesh.quaternion,5*t),l.quaternion.copy(d.octreeSphere.mesh.quaternion));const{maxSpeed:m,maxReverseSpeed:P,accelerationForward:f,accelerationBackward:x,breakRatio:y,damping:v,friction:g,minAcceleration:b,steeringResetSpeed:z,maxSteeringSpeed:w,maxWheelAngle:Z,frontWheelSpeedMultiplier:E,rearWheelSpeedMultiplier:M}=u;let S=e.currentSpeed;e.realSpeed=h.octreeSphere.velocity.length();const C=w*Math.log10(1-S/m+1.5);a?e.wheelDirection-=C*t:s&&(e.wheelDirection+=C*t),a||s||(e.wheelDirection=Ic.lerp(e.wheelDirection,0,z*t)),e.wheelDirection=Math.max(-Z,Math.min(Z,e.wheelDirection)),_.mesh.rotation.x+=Math.min(.4,55*S*t*Math.PI/180),d.mesh.rotation.x=_.mesh.rotation.x,h.mesh.children[0].rotation.x=_.mesh.rotation.x,c.mesh.children[0].rotation.x=d.mesh.rotation.x,h.mesh.rotation.y=h.defaultRotation-e.wheelDirection,c.mesh.rotation.y=c.defaultRotation-e.wheelDirection,n||i?(n&&(S<b&&S>-b?S=b:S<0?S*=y:S+=(1-Math.log(1+S/m))*f,e.currentSpeed=Math.min(S,m)),i&&(S<b&&S>-b?S=-b:S>0?S*=y:S-=(1-Math.log(1+S/P))*x,e.currentSpeed=Math.max(S,-P))):e.currentSpeed*=v,o.set(0,0,0),h.mesh.getWorldDirection(o),o.multiplyScalar(e.currentSpeed*t*E),h.octreeSphere.velocity.multiplyScalar(g),h.octreeSphere.isColliding&&h.octreeSphere.velocity.add(o),c.octreeSphere.velocity.multiplyScalar(g),c.octreeSphere.isColliding&&c.octreeSphere.velocity.add(o),o.set(0,0,0),l.getWorldDirection(o),o.multiplyScalar(e.currentSpeed*t*M),_.octreeSphere.velocity.multiplyScalar(g),_.octreeSphere.isColliding&&_.octreeSphere.velocity.add(o),d.octreeSphere.velocity.multiplyScalar(g),d.octreeSphere.isColliding&&d.octreeSphere.velocity.add(o);const{width:N,height:A,length:L}=u.body;p.min.set(-L/2+l.position.x,0+l.position.y,-N/2+l.position.z),p.max.set(L/2+l.position.x,A+l.position.y,N/2+l.position.z)}))},dispose:()=>{i.forEach((e=>Ah(e.model))),i=[]}}},config:{debug:!1,callLimit:Kx.CALL_30_PER_SECONDS,forceCallCount:!0}},mU={id:Zk,create:({config:{}})=>{let e=[];const t=new p_;return{createConstraintGroup:({constraints:t,config:{useAutoDistances:n}})=>{const i=t.map((({pointA:e,pointB:t,distance:i})=>({pointA:e,pointB:t,distance:n?e.distanceTo(t):i??0})));e.push(i)},update:()=>{e.forEach((e=>{e.forEach((e=>(({pointA:e,pointB:n,distance:i})=>{t.subVectors(n,e);var r=t.length();if(0!==r){var o=t.multiplyScalar(1-i/r).multiplyScalar(.5);e.add(o),n.sub(o)}})(e)))}))},dispose:()=>{e=[]}}},config:{debug:!1,callLimit:Kx.CALL_60_PER_SECONDS,forceCallCount:!0}},PU=ey(yy(),{assetsConfig:KG,renderer:{pixelRatio:window.devicePixelRatio>1.4?1.4:1},fog:new ob(8965358,0,300),entities:()=>{const e=new _b(16777215,.8);e.position.set(100,40,150),e.castShadow=!0;const t=200;return e.shadow.mapSize.width=2048,e.shadow.mapSize.height=2048,e.shadow.radius=1,e.shadow.bias=-6e-5,e.shadow.camera.top=t,e.shadow.camera.bottom=-t,e.shadow.camera.left=-t,e.shadow.camera.right=t,e.shadow.camera.near=.1,e.shadow.camera.far=500,[new lb(4491451,8772,.5),e]},modules:[ey(sD,{config:{yBoundaries:{min:1.2,max:2.7},maxDistance:nU[0]}}),rD,{...aD,config:{debug:!1}},HF,mU,ey(dU,{config:{debug:!1}}),{...oD,config:oU}],skybox:{size:1e3,textures:[OG,RG,HG,FG,DG,GG]},staticModels:[{id:"level-graphic",modelId:XG},{id:"level-collision",modelId:YG}],onProgress:e=>{document.documentElement.style.setProperty("--preloader-progress-ratio",100*e+"%")},onLoaded:e=>{const{on:t,getModule:n,getStaticModel:i}=e;Be.world=e,t.pause((()=>IF.globalTimeline.pause())),t.resume((()=>IF.globalTimeline.resume()));const r=i("level-collision").scene;r.visible=!1;const o=n(gk).worldOctree;o.fromGraphNode(r);const a=i("level-graphic").scene,s=n(Ck);e.setCamera(s.instance),e.userData.tpsCamera=s,s.setWorldOctree(o);a.traverse((e=>{e.isMesh&&(e.material.map&&(e.material.map.anisotropy=4),"spawn-01"===e.name&&(e=>{e.visible=!1;const i=n(Ek).createCar({position:e.position.clone(),config:_U});Be.playersUnit=i,setTimeout((()=>{const e=1/i.model.scale.x,t=bT(fz[lz]).instance;t.scale.set(e,e,e),t.rotation.y=Math.PI,t.position.x=.5*e,t.position.y=.3*e,t.position.z=-2*e,i.model.add(t);const n=bT(fz[lz]).instance;n.scale.set(e,e,e),n.rotation.y=Math.PI,n.position.x=-.5*e,n.position.y=.3*e,n.position.z=-2*e,i.model.add(n)})),n(Sk).setTarget(i),t.update((({delta:e})=>{Ce.set(Math.floor(i.realSpeed*e*(3600/e)/1e3))})),t.dispose((()=>{aU={},pU=lU,uU=0,hU=0,Se.set([]),Ce.set(0),Ne.set(0)})),s.setTarget(i.model),s.setPositionOffset(new ev(0,1.6,0)),s.setRotation({x:e.rotation.y,y:2}),s.setUseTargetRotation(!0)})(e),e.name.includes("checkpoint")&&(e=>{e.visible=!1;const t=Be.world.getModule(wk),{name:n}=e;if(aU[n]=e,n.includes("enter")){const i=hU;hU++,Se.update((e=>e.concat([{currentTime:0,lastTime:0}]))),t.createRegion({id:n,area:e}).on.enter(Be.playersUnit.box,(()=>{if(n===pU){pU=sU[n];const e=Be.cycleData.now;Se.update((t=>{t[i]={currentTime:uU&&e-uU,lastTime:t[i].currentTime,startTime:null};const n=i<t.length-1?i+1:0;return t[n]={...t[n],startTime:e},t})),uU=e,n===lU&&Ne.update((e=>e+1))}}))}else t.createRegion({id:n,area:e}).on.enter(Be.playersUnit.box,(()=>{n===pU&&(pU=sU[n])}))})(e))}))}});function fU(e,t,n){const i=e.slice();return i[7]=t[n].currentTime,i[8]=t[n].lastTime,i[9]=t[n].startTime,i[11]=n,i}function xU(e){let t,n,i,r,o=e[7]>e[8]?"+":"-",a=oy(Math.abs(e[8]-e[7]),iy)+"";return{c(){t=M("div"),n=C(o),i=C(a),B(t,"class",r=v("lastTime "+(e[7]>e[8]?"positiveTime":"negativeTime"))+" svelte-q19ew2")},m(e,r){w(e,t,r),z(t,n),z(t,i)},p(e,s){1&s&&o!==(o=e[7]>e[8]?"+":"-")&&k(n,o),1&s&&a!==(a=oy(Math.abs(e[8]-e[7]),iy)+"")&&k(i,a),1&s&&r!==(r=v("lastTime "+(e[7]>e[8]?"positiveTime":"negativeTime"))+" svelte-q19ew2")&&B(t,"class",r)},d(e){e&&Z(t)}}}function yU(e){let t,n,i=oy(e[7],iy)+"";return{c(){t=M("div"),n=C(i),B(t,"class","lastTime svelte-q19ew2")},m(e,i){w(e,t,i),z(t,n)},p(e,t){1&t&&i!==(i=oy(e[7],iy)+"")&&k(n,i)},d(e){e&&Z(t)}}}function vU(e){let t,n,i,r,o,a,s,l,p,u,h=e[11]+1+"",c=oy(e[9]?e[5]-e[9]:e[7],iy)+"";function _(e,t){return e[9]&&e[7]?yU:e[8]?xU:void 0}let d=_(e),m=d&&d(e);return{c(){t=M("div"),n=M("div"),i=C("Checkpoint "),r=C(h),o=N(),a=M("div"),s=M("div"),l=C(c),p=N(),m&&m.c(),u=N(),B(n,"class","label svelte-q19ew2"),B(s,"class","currentTime svelte-q19ew2"),B(a,"class","entryContent svelte-q19ew2"),B(t,"class","entry svelte-q19ew2")},m(e,h){w(e,t,h),z(t,n),z(n,i),z(n,r),z(t,o),z(t,a),z(a,s),z(s,l),z(a,p),m&&m.m(a,null),z(t,u)},p(e,t){33&t&&c!==(c=oy(e[9]?e[5]-e[9]:e[7],iy)+"")&&k(l,c),d===(d=_(e))&&m?m.p(e,t):(m&&m.d(1),m=d&&d(e),m&&(m.c(),m.m(a,null)))},d(e){e&&Z(t),m&&m.d()}}}function gU(e){let t,n=e[0],i=[];for(let t=0;t<n.length;t+=1)i[t]=vU(fU(e,n,t));return{c(){t=M("div");for(let e=0;e<i.length;e+=1)i[e].c();B(t,"class","content svelte-q19ew2")},m(e,n){w(e,t,n);for(let e=0;e<i.length;e+=1)i[e].m(t,null)},p(e,r){if(33&r){let o;for(n=e[0],o=0;o<n.length;o+=1){const a=fU(e,n,o);i[o]?i[o].p(a,r):(i[o]=vU(a),i[o].c(),i[o].m(t,null))}for(;o<i.length;o+=1)i[o].d(1);i.length=n.length}},d(e){e&&Z(t),E(i,e)}}}function bU(e){let t,n,i,r,o=e[3]>0?"+":"-",a=oy(Math.abs(e[3]),iy)+"";return{c(){t=M("div"),n=C(o),i=C(a),B(t,"class",r=v("lastTime "+(e[3]>0?"positiveTime":"negativeTime"))+" svelte-q19ew2")},m(e,r){w(e,t,r),z(t,n),z(t,i)},p(e,s){8&s&&o!==(o=e[3]>0?"+":"-")&&k(n,o),8&s&&a!==(a=oy(Math.abs(e[3]),iy)+"")&&k(i,a),8&s&&r!==(r=v("lastTime "+(e[3]>0?"positiveTime":"negativeTime"))+" svelte-q19ew2")&&B(t,"class",r)},d(e){e&&Z(t)}}}function zU(e){let t,n,i,r,o,a,s,l,p,u,h,c,_,d,m,P=oy(e[2],iy)+"",f=oy(e[4],iy)+"",x=e[1]>0&&0!==e[3]&&bU(e);return{c(){t=M("div"),n=M("div"),i=M("div"),i.textContent="TOTAL TIME",r=N(),o=M("div"),a=M("div"),s=C(P),l=N(),x&&x.c(),p=N(),u=M("div"),h=M("div"),h.textContent="BEST TIME",c=N(),_=M("div"),d=M("div"),m=C(f),B(i,"class","label svelte-q19ew2"),B(a,"class","currentTime svelte-q19ew2"),B(o,"class","entryContent svelte-q19ew2"),B(n,"class","entry svelte-q19ew2"),B(h,"class","label svelte-q19ew2"),B(d,"class","currentTime svelte-q19ew2"),B(_,"class","entryContent svelte-q19ew2"),B(u,"class","entry svelte-q19ew2"),B(t,"class","content svelte-q19ew2")},m(e,P){w(e,t,P),z(t,n),z(n,i),z(n,r),z(n,o),z(o,a),z(a,s),z(o,l),x&&x.m(o,null),z(t,p),z(t,u),z(u,h),z(u,c),z(u,_),z(_,d),z(d,m)},p(e,t){4&t&&P!==(P=oy(e[2],iy)+"")&&k(s,P),e[1]>0&&0!==e[3]?x?x.p(e,t):(x=bU(e),x.c(),x.m(o,null)):x&&(x.d(1),x=null),16&t&&f!==(f=oy(e[4],iy)+"")&&k(m,f)},d(e){e&&Z(t),x&&x.d()}}}function wU(e){let t,n,i,r,o;return n=new LT({props:{$$slots:{default:[gU]},$$scope:{ctx:e}}}),r=new LT({props:{$$slots:{default:[zU]},$$scope:{ctx:e}}}),{c(){t=M("div"),ce(n.$$.fragment),i=N(),ce(r.$$.fragment),B(t,"class","wrapper svelte-q19ew2")},m(e,a){w(e,t,a),_e(n,t,null),z(t,i),_e(r,t,null),o=!0},p(e,[t]){const i={};4129&t&&(i.$$scope={dirty:t,ctx:e}),n.$set(i);const o={};4126&t&&(o.$$scope={dirty:t,ctx:e}),r.$set(o)},i(e){o||(oe(n.$$.fragment,e),oe(r.$$.fragment,e),o=!0)},o(e){ae(n.$$.fragment,e),ae(r.$$.fragment,e),o=!1},d(e){e&&Z(t),de(n),de(r)}}}function ZU(e,t,n){let i,r,o=0,a=0,s=0,l=JSON.parse(localStorage.getItem("three-tps-drift"))?.bestTime||0,p=0;return Se.subscribe((e=>{n(0,i=e),i.length>0&&n(0,i=i.slice(1).concat(i[0]))})),Ne.subscribe((e=>{n(1,r=e),n(2,o=i.reduce(((e,t)=>e+t.currentTime),0)),0!==a&&n(3,s=o-a),a=o,(o>0&&o<l||0===l)&&(n(4,l=o),localStorage.setItem("three-tps-drift",JSON.stringify({bestTime:l})))})),H((()=>{const e=setInterval((()=>{Be.cycleData.isPaused||n(5,p=Be.cycleData.now)}),30);return()=>{clearInterval(e)}})),[i,r,o,s,l,p]}function EU(e){let t,n,i,r,o,a,s,l;return{c(){t=M("div"),n=M("img"),r=N(),o=M("div"),a=C(e[0]),s=C(" / "),l=C(e[1]),B(n,"alt","coin"),p(n.src,i="./assets/images/coin.webp")||B(n,"src","./assets/images/coin.webp"),B(n,"class","svelte-5rwjjl"),B(o,"class","info svelte-5rwjjl"),B(t,"class","wrapper svelte-5rwjjl")},m(e,i){w(e,t,i),z(t,n),z(t,r),z(t,o),z(o,a),z(o,s),z(o,l)},p(e,t){1&t&&k(a,e[0]),2&t&&k(l,e[1])},d(e){e&&Z(t)}}}function MU(e){let t,n;return t=new LT({props:{$$slots:{default:[EU]},$$scope:{ctx:e}}}),{c(){ce(t.$$.fragment)},m(e,i){_e(t,e,i),n=!0},p(e,[n]){const i={};7&n&&(i.$$scope={dirty:n,ctx:e}),t.$set(i)},i(e){n||(oe(t.$$.fragment,e),n=!0)},o(e){ae(t.$$.fragment,e),n=!1},d(e){de(t,e)}}}function SU(e,t,n){let i,r;return we.subscribe((e=>{n(0,i=e)})),ze.subscribe((e=>{n(1,r=e)})),[i,r]}class CU extends Pe{constructor(e){super(),me(this,e,SU,MU,a,{})}}function NU(e){let t,n,i,r,o;return{c(){t=M("img"),i=N(),r=M("div"),o=C(e[2]),B(t,"alt",e[0]),p(t.src,n=e[1])||B(t,"src",n),B(t,"class","svelte-ywi4e9"),B(r,"class","key svelte-ywi4e9")},m(e,n){w(e,t,n),w(e,i,n),w(e,r,n),z(r,o)},p(e,i){1&i&&B(t,"alt",e[0]),2&i&&!p(t.src,n=e[1])&&B(t,"src",n),4&i&&k(o,e[2])},d(e){e&&Z(t),e&&Z(i),e&&Z(r)}}}function AU(e){let t,n,i;return n=new LT({props:{$$slots:{default:[NU]},$$scope:{ctx:e}}}),{c(){t=M("div"),ce(n.$$.fragment),B(t,"class","tool svelte-ywi4e9")},m(e,r){w(e,t,r),_e(n,t,null),i=!0},p(e,[t]){const i={};15&t&&(i.$$scope={dirty:t,ctx:e}),n.$set(i)},i(e){i||(oe(n.$$.fragment,e),i=!0)},o(e){ae(n.$$.fragment,e),i=!1},d(e){e&&Z(t),de(n)}}}function LU(e,t,n){let{name:i}=t,{img:r}=t,{key:o}=t;return e.$$set=e=>{"name"in e&&n(0,i=e.name),"img"in e&&n(1,r=e.img),"key"in e&&n(2,o=e.key)},[i,r,o]}class BU extends Pe{constructor(e){super(),me(this,e,LU,AU,a,{name:0,img:1,key:2})}}function TU(e,t,n){const i=e.slice();return i[1]=t[n],i}function VU(e,n){let i,r,o;const a=[n[1]];let s={};for(let e=0;e<a.length;e+=1)s=t(s,a[e]);return r=new BU({props:s}),{key:e,first:null,c(){i=A(),ce(r.$$.fragment),this.first=i},m(e,t){w(e,i,t),_e(r,e,t),o=!0},p(e,t){n=e;const i=1&t?ue(a,[he(n[1])]):{};r.$set(i)},i(e){o||(oe(r.$$.fragment,e),o=!0)},o(e){ae(r.$$.fragment,e),o=!1},d(e){e&&Z(i),de(r,e)}}}function kU(e){let t,n,i=[],r=new Map,o=e[0];const a=e=>e[1].name;for(let t=0;t<o.length;t+=1){let n=TU(e,o,t),s=a(n);r.set(s,i[t]=VU(s,n))}return{c(){for(let e=0;e<i.length;e+=1)i[e].c();t=A()},m(e,r){for(let t=0;t<i.length;t+=1)i[t].m(e,r);w(e,t,r),n=!0},p(e,[n]){1&n&&(o=e[0],ie(),i=pe(i,n,a,1,e,o,r,t.parentNode,le,VU,t,TU),re())},i(e){if(!n){for(let e=0;e<o.length;e+=1)oe(i[e]);n=!0}},o(e){for(let e=0;e<i.length;e+=1)ae(i[e]);n=!1},d(e){for(let t=0;t<i.length;t+=1)i[t].d(e);e&&Z(t)}}}function IU(e){return[[{name:"Hand",img:"./assets/images/tools/hand.png",key:"1"},{name:"Water Pistol",img:"./assets/images/tools/water-pistol.png",key:"2"},{name:"Water Gun",img:"./assets/images/tools/water-gun.png",key:"3"},{name:"Water Laser",img:"./assets/images/tools/water-laser.png",key:"4"}]]}function OU(e){let t,n,i,r;return{c(){t=M("div"),n=M("div"),i=C(e[0]),r=C(" km/h"),B(n,"class","info svelte-1lqvwgt"),B(t,"class","content svelte-1lqvwgt")},m(e,o){w(e,t,o),z(t,n),z(n,i),z(n,r)},p(e,t){1&t&&k(i,e[0])},d(e){e&&Z(t)}}}function RU(e){let t,n,i;return n=new LT({props:{$$slots:{default:[OU]},$$scope:{ctx:e}}}),{c(){t=M("div"),ce(n.$$.fragment),B(t,"class","wrapper svelte-1lqvwgt")},m(e,r){w(e,t,r),_e(n,t,null),i=!0},p(e,[t]){const i={};3&t&&(i.$$scope={dirty:t,ctx:e}),n.$set(i)},i(e){i||(oe(n.$$.fragment,e),i=!0)},o(e){ae(n.$$.fragment,e),i=!1},d(e){e&&Z(t),de(n)}}}function HU(e,t,n){let i;return Ce.subscribe((e=>{n(0,i=e)})),[i]}const FU="CHARACTERS_VICTORY",DU="CHARACTERS_DASH",GU="MALE_CHARACTER",UU={[qV]:yb,[JV]:vb,[$V]:gb,[XV]:bb,[YV]:zb,[KV]:wb,[ek]:Zb,[QV]:Eb,[nk]:Mb,[tk]:Sb,[ik]:Cb,[rk]:Nb,[ok]:Ab,[ak]:Lb,[sk]:Bb,[lk]:Tb,[uk]:Vb,[pk]:kb,[hk]:Ib,[ck]:Ob,[_k]:Rb,[dk]:Hb,[mk]:Fb,[fk]:Db,[Pk]:Gb,[FU]:Ub,[DU]:jb},jU=ty(vk,{modules:[Hk,{...Vk,config:uV}],model:{fbx:{id:mb},scale:new ev(.0095,.0095,.0095),debug:{showSockets:!1}},animationConfig:{rules:[{condition:({userData:e})=>e?.showVictoryAnimation,animation:FU,transitionTime:.2,loop:!1},{condition:({userData:e})=>e?.isDashInProgress,animation:DU,transitionTime:.2,loop:!1},...vk.animationConfig.rules]},animations:UU,speed:25,speedModifier:e=>(e.onGround?e.config.speed:8)*(e.userData.useSprint?2:1)}),WU={[GU]:ey(jU,{name:"male-character",model:{traverseCallback:e=>{e.isMesh&&e.name.includes("Female")&&(e.visible=!1)}}}),FEMALE_CHARACTER:ey(jU,{name:"female-character",model:{traverseCallback:e=>{e.isMesh&&e.name.includes("Male")&&(e.visible=!1)}}})},qU={socketId:Rk,model:{rotation:new ev(Math.PI/2,Math.PI,Math.PI),position:new ev(3,13,0)},on:{activate:({world:e,position:t,direction:n})=>{e.getModule(bk).shoot({startPosition:t,direction:n,scene:e.scene,config:{speed:40,lifeTime:5e3,on:{shoot:({mesh:t})=>{const n=bT(fz[Kb],e.cycleData.now).instance;n.name="bulletEffect",t.add(n)},destroy:({mesh:e})=>{IF.delayedCall(.1,(()=>gT(e.children.find((e=>"bulletEffect"===e.name)))))},collision:({position:t})=>{const n=bT(fz[Qb],e.cycleData.now).instance;n.position.copy(t),e.scene.add(n),IF.delayedCall(1.5,(()=>gT(n)))}}}});const i=bT(fz[Xb],e.cycleData.now);i.instance.position.copy(t);var r=(new Nv).lookAt(n,new ev(0,0,0),new ev(0,1,0));i.instance.frustumCulled=!1,i.instance.quaternion.setFromRotationMatrix(r),e.scene.add(i.instance),IF.delayedCall(1,i.dispose)}}},JU="WATER_PISTOL_01",$U="WATER_GUN_01",XU="WATER_GUN_02",YU=[ty(qU,{id:JU,type:xk,ability:oV,model:{fbx:{id:xb}}}),ty(qU,{id:$U,type:yk,ability:aV,model:{fbx:{id:Pb}}}),ty(qU,{id:XU,type:yk,ability:sV,model:{fbx:{id:fb}}})],KU="DASH",QU="CHANGE_CAMERA_DISTANCE";let ej=null;const tj=e=>{const t=e.getSelectedTool();t&&e.getModule(Bk).deactivate(t.ability)};let nj=0;const ij=[3,4,15,2];let rj=null;const oj=(e,t)=>{tj(e),e.chooseTool(t);let n=new ev;switch(t){case $U:n.set(15,28,0);break;case XU:n.set(15,40,0);break;case JU:n.set(0,0,0)}e.getModule(Lk).setLeftHandOffset(n)},aj={actionConfig:[...uI.actionConfig,{actionId:eI.SPRINT,listenForDeactivation:!0,keys:[Qk.SHIFT],gamepadButtons:[Yk.LeftAxisButton]},{actionId:KU,keys:[Qk.Q],gamepadButtons:[Yk.ActionRight]},{actionId:eI.TOOL_ACTION,listenForDeactivation:!0,mouse:[iI],gamepadButtons:[Yk.RightTrigger]},{actionId:eI.CHOOSE_NEXT_TOOL,mouse:[aI],gamepadButtons:[Yk.Up]},{actionId:eI.CHOOSE_PREV_TOOL,mouse:[sI],gamepadButtons:[Yk.Down]},...Array.from({length:4}).map(((e,t)=>({actionId:eI[`CHOOSE_TOOL_${t+1}`],keys:[Qk[t+1]]}))),{actionId:QU,keys:[Qk.C]}],handlers:[...uI.handlers,{actionId:eI.SPRINT,callback:({target:e,value:t})=>{e.userData.useSprint=t}},{actionId:KU,callback:({target:e,value:t})=>{const n=e.getModule(Bk);1===t&&n.activate(lV)}},{actionId:pI,callback:({target:e,world:t})=>{(ej||(ej=document.querySelector(".crosshair")),ej).style.visibility=e.userData.useAim?"visible":"hidden",!e.userData.useAim&&t.userData.tpsCamera&&(t.userData.tpsCamera.setMaxDistance(t.userData.maxCameraDistance||ij[0]),tj(e))}},{actionId:eI.TOOL_ACTION,callback:({target:e,value:t})=>{if(e.userData.useAim){const n=e.getSelectedTool();if(!n)return;const i=e.getModule(Bk);1===t?i.activate(n.ability):i.deactivate(n.ability)}}},{actionId:eI.CHOOSE_NEXT_TOOL,callback:({target:e})=>{rj++,rj>YU.length&&(rj=0),oj(e,YU[rj]?.id)}},{actionId:eI.CHOOSE_PREV_TOOL,callback:({target:e})=>{rj--,rj<-1&&(rj=YU.length-1),oj(e,YU[rj]?.id)}},...Array.from({length:4}).map(((e,t)=>({actionId:eI[`CHOOSE_TOOL_${t+1}`],callback:({target:e})=>{rj===t-1?(rj=null,oj(e,rj)):(rj=t-1,oj(e,YU[rj]?.id))}}))),{actionId:QU,callback:({world:e,target:t})=>{nj++,nj===ij.length&&(nj=0),e.userData.maxCameraDistance=ij[nj],!t.userData.useAim&&e.userData.tpsCamera&&e.userData.tpsCamera.setMaxDistance(e.userData.maxCameraDistance)}}]},sj=Array.from({length:6}).reduce(((e,t,n)=>({...e,[`collectible-${n}`]:{type:n<4?0:1,reactivationTime:n<4?5:30,initialActivationDelay:n<4?0:20,interactionRadius:.5,isUserInteractionNeeded:!1,model:{gltf:{id:Jb},scale:new ev(.0095,.0095,.0095)},on:{activate:({model:e})=>{const t=bT(fz[iz],Be.cycleData.now);t.instance.position.copy(e.position),Be.world.scene.add(t.instance),IF.delayedCall(1,t.dispose),e.scale.set(0,0,0),IF.to(e.scale,{x:1,y:1,z:1,duration:1})},collect:({collectible:{model:e}})=>{const t=bT(fz[rz],Be.cycleData.now);t.instance.position.copy(e.position),Be.world.scene.add(t.instance),IF.delayedCall(1,t.dispose)}}}})),{}),lj={id:bk,create:({world:{scene:e,cycleData:t},config:n})=>{let i=n.collisionDetectors||[];const r=new cx(.02,8,8),o=new dx({color:255});let a=[],s=0;const l=new p_;return{update:({delta:n})=>{const r=[];a.forEach((({mesh:e,collider:t,direction:o,config:a,userData:s})=>{const p=2*n;l.copy(o);let u=l.setLength(p),h=a.speed*n,c=0;for(;c<h&&!i.some((e=>e({collider:t,userData:s})));)c+=p,t.center.add(u);t.center.sub(u),c<h&&(r.push(e),a?.on?.collision({mesh:e,position:t.center,userData:s})),e.position.copy(t.center)})),a=a.filter((({mesh:n,bornTime:i,config:o,userData:a})=>{const s=t.now-i>o.lifeTime,l=r.includes(n);return(s||l)&&(o?.on?.destroy({mesh:n,userData:a}),e.remove(n)),!s&&!l}))},shoot:({startPosition:e=null,direction:n,scene:i,mesh:l,config:p,userData:u=null})=>{const h=l||new im(r,o);l||(h.castShadow=!0,h.receiveShadow=!1),e&&h.position.copy(e),i&&i.add(h);const c=new A_(h.position.clone(),.02);p?.on?.shoot({mesh:h}),a.push({id:s++,bornTime:t.now,mesh:h,collider:c,direction:n,config:p,userData:u})},addCollisionDetector:e=>i.push(e),removeCollisionDetector:e=>i=i.filter((t=>t!==e)),dispose:()=>{a.forEach((({mesh:t})=>{t.dispose(),t.material.dispose(),t.geometry.dispose(),e.remove(t)})),i=null,r.dispose(),o.dispose()}}},config:{callLimit:Kx.CALL_30_PER_SECONDS,forceCallCount:!0,collisionDetectors:[]}},pj=ey(yy(),{assetsConfig:$b,renderer:{pixelRatio:window.devicePixelRatio>1.4?1.4:1},fog:new ob(8965358,0,100),entities:()=>{const e=new _b(16777215,.8);return e.position.set(0,15,25),e.castShadow=!0,e.shadow.mapSize.width=1024,e.shadow.mapSize.height=1024,e.shadow.radius=1,e.shadow.bias=-6e-5,e.shadow.camera.top=50,e.shadow.camera.bottom=-50,e.shadow.camera.left=-50,e.shadow.camera.right=50,e.shadow.camera.near=.1,e.shadow.camera.far=500,[new lb(4491451,8772,.5),e]},modules:[fD,ey(sD,{callLimit:Kx.NO_LIMIT,config:{yBoundaries:{min:1.2,max:2.7},maxDistance:ij[0]}}),rD,lj,HF,{...oD,config:aj}],skybox:{textures:[db.SKYBOX_1,db.SKYBOX_2,db.SKYBOX_3,db.SKYBOX_4,db.SKYBOX_5,db.SKYBOX_6]},staticModels:[{id:"level-graphic",modelId:Wb},{id:"level-collision",modelId:qb}],onProgress:e=>{document.documentElement.style.setProperty("--preloader-progress-ratio",100*e+"%")},onLoaded:e=>{const{on:t,getModule:n,getStaticModel:i}=e;Be.world=e,t.pause((()=>IF.globalTimeline.pause())),t.resume((()=>IF.globalTimeline.resume()));const{createUnit:r,getUnit:o}=n(Mk);for(let e=0;e<4;e++)r({id:`player-${e}`,config:WU[GU]});const a=i("level-collision").scene;a.visible=!1;const s=n(gk).worldOctree;s.fromGraphNode(a);const l=i("level-graphic").scene,{addCollisionDetector:p}=n(bk);p((({collider:e})=>s.sphereIntersect(e)));const u=n(Ck);e.setCamera(u.instance),e.userData.tpsCamera=u,u.setWorldOctree(s);const h=Array.from({length:4}).reduce(((e,t,n)=>({...e,[`p${n}`]:{unitId:`player-${n}`,color:n<2?16711680:255}})),{}),c=(t,i)=>{i.visible=!1;const r=o(t.unitId);if("p0"===i.name){n(Sk).setTarget(r),r.addModules([lD]);const t=new tg;t.position.y=55,t.position.x=3,t.position.z=-8,r.registerObjectIntoSocket({id:"projectileStart",object:t,socketId:Rk}),t.visible=!0,u.setTarget(r.model),u.setPositionOffset(new ev(0,1.6,0)),u.setRotation({x:i.rotation.z,y:2}),e.getModule(zk).addCollector(r)}var a,s;a=r.model,s=t.color,a.traverse((e=>{e.isMesh&&e.visible&&e.material&&(e.material=e.material.clone(),e.material.color=new Wy(s))})),r.registerTools(YU.map((e=>{const t=Bh(e.model.fbx.id);return t.rotation.set(Math.PI/2,Math.PI,Math.PI),t.position.copy(e.model.position),{...e,object:t}}))),r.teleportTo(i.position),r.setRotation(i.rotation.z)};l.traverse((e=>{if(e.isMesh){e.material.map&&(e.material.map.anisotropy=4);const t=h[e.name];if(t)c(t,e);else{const t=sj[e.name];t&&((e,t)=>{const n=Be.world.getModule(zk),{model:i}=n.addCollectible({...e,collisionObject:t});1===e.type&&i.children[0].scale.set(.012,.009,.012),IF.to(i.rotation,{y:2*Math.PI,ease:"linear",duration:3,repeat:-1})})(t,e)}}}))}}),uj={SKYBOX_1:"SKYBOX_1",SKYBOX_2:"SKYBOX_2",SKYBOX_3:"SKYBOX_3",SKYBOX_4:"SKYBOX_4",SKYBOX_5:"SKYBOX_5",SKYBOX_6:"SKYBOX_6",POINT:"POINT",CUBE_WORLD:"CUBE_WORLD",AURYN_SKY_BLUE:"AURYN_SKY_BLUE",AURYN_SKY_RED:"AURYN_SKY_RED",CTF_TANK_BASE_COLOR_R:"CTF_TANK_BASE_COLOR_R",CTF_TANK_BASE_COLOR_G:"CTF_TANK_BASE_COLOR_G",CTF_TANK_BASE_COLOR_B:"CTF_TANK_BASE_COLOR_B",CTF_TANK_BASE_COLOR_Y:"CTF_TANK_BASE_COLOR_Y",POWERUP_PALETTE:"POWERUP_PALETTE"},hj="BRICK_BLACK",cj="BRICK_BROWN",_j="BLOCK_GROUND",dj="CTF_TANK",mj="MISSILE",Pj="ITEM_DAMAGE",fj="ITEM_HEALTH",xj="ITEM_MULTIATTACK",yj="ITEM_SPEED",vj={textures:[{id:uj.SKYBOX_1,url:"./assets/textures/skybox/left.webp"},{id:uj.SKYBOX_2,url:"./assets/textures/skybox/right.webp"},{id:uj.SKYBOX_3,url:"./assets/textures/skybox/up.webp"},{id:uj.SKYBOX_4,url:"./assets/textures/skybox/down.webp"},{id:uj.SKYBOX_5,url:"./assets/textures/skybox/front.webp"},{id:uj.SKYBOX_6,url:"./assets/textures/skybox/back.webp"},{id:uj.POINT,url:"./assets/textures/effects/point.webp"},{id:uj.CUBE_WORLD,url:"./assets/textures/cubeworld-tex.png"},{id:uj.AURYN_SKY_BLUE,url:"./assets/textures/auryn-sky-color-palette-blue.png"},{id:uj.AURYN_SKY_RED,url:"./assets/textures/auryn-sky-color-palette-red.png"},{id:uj.CTF_TANK_BASE_COLOR_R,url:"./assets/textures/ctf-tank-base-color-r.png"},{id:uj.CTF_TANK_BASE_COLOR_G,url:"./assets/textures/ctf-tank-base-color-g.png"},{id:uj.CTF_TANK_BASE_COLOR_B,url:"./assets/textures/ctf-tank-base-color-b.png"},{id:uj.CTF_TANK_BASE_COLOR_Y,url:"./assets/textures/ctf-tank-base-color-y.png"},{id:uj.POWERUP_PALETTE,url:"./assets/textures/powerup-palette.png"}],fbxModels:[],gltfModels:[{id:"WORLD",url:"./assets/models/world/tank-battle-level.glb",material:{materialType:ab,texture:{id:uj.BLUE_TEXTURE}}},{id:hj,url:"./assets/models/obstacles/brick-black-1.glb"},{id:cj,url:"./assets/models/obstacles/brick-brown-1.glb"},{id:_j,url:"./assets/models/world/block-ground.glb",material:{materialType:ab,texture:{id:uj.AURYN_SKY_BLUE}}},{id:dj,url:"./assets/models/vehicles/ctf-tank.glb"},{id:mj,url:"./assets/models/projectiles/missile.glb"},{id:Pj,url:"./assets/models/collectibles/damage.glb",material:{materialType:ab,texture:{id:uj.POWERUP_PALETTE}}},{id:fj,url:"./assets/models/collectibles/health.glb",material:{materialType:ab,texture:{id:uj.POWERUP_PALETTE}}},{id:xj,url:"./assets/models/collectibles/multiattack.glb",material:{materialType:ab,texture:{id:uj.POWERUP_PALETTE}}},{id:yj,url:"./assets/models/collectibles/speed.glb",material:{materialType:ab,texture:{id:uj.POWERUP_PALETTE}}}],audio:[{id:"GAME_BACKGROUND",url:"./assets/audio/music/game-theme.ogg"}]},gj="SHOOT",bj="AI_SHOOT",zj=new ev,wj=new ev,Zj=({world:e,caster:t})=>{const n=t.bulletSocket.getWorldPosition(zj),i=t.bulletSocket.getWorldDirection(new ev);wj.copy(i);const r=((o=wj).x=Math.abs(o.x),o.y=Math.abs(o.y),o.z=Math.abs(o.z),o);var o;i.x=r.y>r.x||r.z>r.x?0:i.x,i.y=r.x>r.y||r.z>r.y?0:i.y,i.z=r.x>r.z||r.y>r.z?0:i.z;const a=kh(mj).scene.clone();a.traverse((e=>{if(e.isMesh&&!e.name.includes("_1")){const n=new ab({map:Oh(t.bulletMaterialId)});e.material=n,e.material.map.flipY=!1}})),a.rotation.copy(t.mesh.rotation),e.scene.add(a),e.getModule(bk).shoot({startPosition:n,direction:i,mesh:a,userData:{caster:t},config:{speed:5,lifeTime:1e4,on:{shoot:()=>{const i=bT(fz[Yb],e.cycleData.now);i.instance.name="bulletEffect",i.instance.position.copy(n),i.instance.rotation.copy(t.mesh.rotation),i.instance.rotation.y+=Math.PI,e.scene.add(i.instance),IF.delayedCall(1,i.dispose),IF.getTweensOf(t.body.rotation).length||(IF.to(t.body.rotation,{x:-Math.PI/20,yoyo:!0,repeat:1,duration:.2,onUpdate:()=>t.shadow.turret.rotation.x=t.shadow.body.rotation.x=t.turret.rotation.x=t.body.rotation.x}),IF.to(t.barrel.position,{z:-.3,yoyo:!0,repeat:1,duration:.2,onUpdate:()=>t.shadow.barrel.position.z=t.barrel.position.z}))},destroy:()=>{},collision:({position:t})=>{const n=bT(fz[ez],e.cycleData.now);n.instance.position.copy(t),e.scene.add(n.instance);const i=bT(fz[tz],e.cycleData.now);i.instance.position.copy(t),e.scene.add(i.instance),IF.delayedCall(3,(()=>{n.dispose(),i.dispose()}))}}}})},Ej=e=>{Zj(e),e.caster.abilities.multiattack&&IF.delayedCall(.2,Zj,[e])},Mj={[gj]:{isReactivationNeeded:!1,castingTime:0,cooldownTime:1e3,on:{cast:Ej}},[bj]:{isReactivationNeeded:!1,castingTime:0,cooldownTime:1500,on:{cast:Ej}}},Sj=({collector:e,collectible:t})=>t.model.position.distanceTo(e.mesh.position)<.6,Cj=e=>{const t=bT(fz[rz],Be.cycleData.now);t.instance.position.copy(e.position),Be.world.scene.add(t.instance),IF.delayedCall(1,t.dispose),we.update((e=>e+1))},Nj={speed:{type:0,reactivationTime:20,initialActivationDelay:0,interactionRadius:.5,isUserInteractionNeeded:!1,collisionAlgorithm:Sj,model:{gltf:{id:yj}},on:{activate:({model:e})=>{e.position.copy(Be.getRandomAvailablePoint()),Cj(e)},collect:({collectible:{model:e},collector:t})=>{t.activateDoubleSpeed(),Cj(e)}}},damage:{type:1,reactivationTime:60,initialActivationDelay:0,interactionRadius:.5,isUserInteractionNeeded:!1,collisionAlgorithm:Sj,model:{gltf:{id:Pj}},on:{activate:({model:e})=>{e.position.copy(Be.getRandomAvailablePoint()),Cj(e)},collect:({collectible:{model:e},collector:t})=>{t.activateDoubleDamage(),Cj(e)}}},health:{type:2,reactivationTime:30,initialActivationDelay:0,interactionRadius:.5,isUserInteractionNeeded:!1,collisionAlgorithm:Sj,model:{gltf:{id:fj}},on:{activate:({model:e})=>{e.position.copy(Be.getRandomAvailablePoint()),Cj(e)},collect:({collectible:{model:e},collector:t})=>{t.heal(),Cj(e)}}},multiattack:{type:3,reactivationTime:120,initialActivationDelay:0,interactionRadius:.5,isUserInteractionNeeded:!1,collisionAlgorithm:Sj,model:{gltf:{id:xj}},on:{activate:({model:e})=>{e.position.copy(Be.getRandomAvailablePoint()),Cj(e)},collect:({collectible:{model:e},collector:t})=>{t.activateMultiattack(),Cj(e)}}}},Aj=(e,t)=>{const n=Be.world.getModule(zk),{model:i}=n.addCollectible({...e,collisionObject:t});IF.to(i.position,{startAt:{y:.3},y:.5,yoyo:!0,duration:.5,repeat:-1})},Lj="PLAYER_1",Bj="PLAYER_2",Tj={LEFT:"LEFT",RIGHT:"RIGHT",UP:"UP",DOWN:"DOWN"},Vj={[Tj.LEFT]:new ev(-1,0,0),[Tj.RIGHT]:new ev(1,0,0),[Tj.UP]:new ev(0,0,-1),[Tj.DOWN]:new ev(0,0,1)},kj={[Tj.LEFT]:Vj.LEFT,[Tj.RIGHT]:Vj.RIGHT,[Tj.UP]:Vj.UP,[Tj.DOWN]:Vj.DOWN},Ij="X",Oj={[Ij]:new ev(1,0,0),Y:new ev(0,1,0),Z:new ev(0,0,1)},Rj=new ev,Hj="CHANGE_CAMERA_DISTANCE",Fj="CHANGE_TANK_COLOR",Dj="SHOOT";let Gj=0;const Uj=[{maxCameraDistance:7,rotation:{x:-Math.PI,y:Math.PI-Math.PI/8},positionOffset:{x:0,y:0,z:0},useTargetRotation:!1},{maxCameraDistance:9,rotation:{x:-Math.PI,y:Math.PI-Math.PI/8},positionOffset:{x:0,y:0,z:0},useTargetRotation:!1},{maxCameraDistance:18,rotation:{x:-Math.PI,y:Math.PI-Math.PI/8},positionOffset:{x:0,y:0,z:0},useTargetRotation:!1},{maxCameraDistance:1.25,rotation:{x:0,y:Math.PI-Math.PI/3.25},positionOffset:{x:.5,y:.75,z:0},useTargetRotation:!0,targetQuaternionOffset:(new Qy).setFromAxisAngle(new ev(0,1,0),Math.PI)}],jj=e=>{e.userData.tpsCamera&&(e.userData.tpsCamera.setUseTargetRotation(Uj[Gj].useTargetRotation),e.userData.tpsCamera.setMaxDistance(Uj[Gj].maxCameraDistance),e.userData.tpsCamera.setRotation(Uj[Gj].rotation),e.userData.tpsCamera.setPositionOffset(Uj[Gj].positionOffset),e.userData.tpsCamera.setTargetQuaternionOffset(Uj[Gj].targetQuaternionOffset))},Wj={actionConfig:[...tI.actionConfig,{actionId:eI.FORWARD,listenForDeactivation:!0,keys:[Qk.W,Qk.ARROW_UP],gamepadButtons:[Yk.Up],axis:Yk.LeftAxisY,axisValidator:e=>e<-.1,axisValueModifier:e=>-1*e},{actionId:eI.BACKWARD,listenForDeactivation:!0,keys:[Qk.S,Qk.ARROW_DOWN],gamepadButtons:[Yk.Down],axis:Yk.LeftAxisY,axisValidator:e=>e>.1},{actionId:eI.LEFT,listenForDeactivation:!0,keys:[Qk.A,Qk.ARROW_LEFT],gamepadButtons:[Yk.Left],axis:Yk.LeftAxisX,axisValidator:e=>e<-.1,axisValueModifier:e=>-1*e},{actionId:eI.RIGHT,listenForDeactivation:!0,keys:[Qk.D,Qk.ARROW_RIGHT],gamepadButtons:[Yk.Right],axis:Yk.LeftAxisX,axisValidator:e=>e>.1},{actionId:Dj,listenForDeactivation:!0,keys:[Qk.SPACE],gamepadButtons:[Yk.ActionBottom]},{actionId:Hj,gamepadButtons:[Yk.ActionTop],keys:[Qk.C]},{actionId:Fj,gamepadButtons:[Yk.ActionLeft],keys:[Qk.V]}],handlers:[...tI.handlers,{actionId:eI.FORWARD,callback:({world:e,target:t,value:n})=>{if(e.userData.tpsCamera)if(e.userData.tpsCamera.getUseTargetRotation()){const e=t.player.lastDirection;t.resetDirections(),t.setDirection(e===Vj.UP?Tj.UP:e===Vj.DOWN?Tj.DOWN:e===Vj.LEFT?Tj.LEFT:Tj.RIGHT,n)}else t.setDirection(Tj.UP,n)}},{actionId:eI.BACKWARD,callback:({world:e,target:t,value:n})=>{if(e.userData.tpsCamera)if(e.userData.tpsCamera.getUseTargetRotation()){const e=t.player.lastDirection;t.resetDirections(),t.setDirection(e===Vj.UP?Tj.DOWN:e===Vj.DOWN?Tj.UP:e===Vj.LEFT?Tj.RIGHT:Tj.LEFT,n)}else t.setDirection(Tj.DOWN,n)}},{actionId:eI.LEFT,callback:({world:e,target:t,value:n})=>{if(e.userData.tpsCamera)if(e.userData.tpsCamera.getUseTargetRotation()){const e=t.player.lastDirection;t.resetDirections(),t.setDirection(e===Vj.UP?Tj.LEFT:e===Vj.DOWN?Tj.RIGHT:e===Vj.LEFT?Tj.DOWN:Tj.UP,n)}else t.setDirection(Tj.LEFT,n)}},{actionId:eI.RIGHT,callback:({world:e,target:t,value:n})=>{if(e.userData.tpsCamera)if(e.userData.tpsCamera.getUseTargetRotation()){const e=t.player.lastDirection;t.resetDirections(),t.setDirection(e===Vj.UP?Tj.RIGHT:e===Vj.DOWN?Tj.LEFT:e===Vj.LEFT?Tj.UP:Tj.DOWN,n)}else t.setDirection(Tj.RIGHT,n)}},{actionId:Hj,callback:({world:e})=>{Gj++,Gj===Uj.length&&(Gj=0),jj(e)}},{actionId:Fj,callback:({target:e})=>{e.changeColor()}},{actionId:Dj,callback:({target:e,value:t})=>{e.shoot(t)}}]},qj=ey(yy(),{assetsConfig:vj,renderer:{pixelRatio:window.devicePixelRatio>1.4?1.4:1},entities:()=>{const e=new _b(16777215,.3);return e.position.set(50,40,26),e.castShadow=!0,e.shadow.mapSize.width=2048,e.shadow.mapSize.height=2048,e.shadow.radius=2,e.shadow.bias=-6e-5,e.shadow.camera.top=50,e.shadow.camera.bottom=-50,e.shadow.camera.left=-50,e.shadow.camera.right=50,e.shadow.camera.near=.1,e.shadow.camera.far=500,[new lb(4491451,8772,.5),e]},modules:[rD,{...lj,config:{callLimit:Kx.CALL_45_PER_SECONDS}},{...oD,config:Wj},HF,ey(sD,{config:{callLimit:Kx.NO_LIMIT,yBoundaries:{min:2*-Math.PI,max:2*Math.PI},maxDistance:20,lerp:{position:{normal:2},targetRotation:2}}})],skybox:{textures:[uj.SKYBOX_1,uj.SKYBOX_2,uj.SKYBOX_3,uj.SKYBOX_4,uj.SKYBOX_5,uj.SKYBOX_6]},onProgress:e=>{document.documentElement.style.setProperty("--preloader-progress-ratio",100*e+"%")},onLoaded:e=>{const{on:t,scene:n,getModule:i}=e;Be.world=e,t.pause((()=>IF.globalTimeline.pause())),t.resume((()=>IF.globalTimeline.resume())),setTimeout((()=>{const r=i(Ck);e.setCamera(r.instance),e.userData.tpsCamera=r;const o=(({world:e,scene:t,thirdPersonCamera:n})=>{let i,r=[],o=[];const a=[[0,0,5,0,0,0,0,0,0,5,0,0,0,0,0,0,5,0,0],[0,1,0,1,0,1,0,1,0,0,0,1,0,1,0,1,0,1,0],[0,0,0,2,0,1,0,0,1,0,1,0,0,1,0,2,0,0,0],[0,0,0,2,2,1,0,1,1,2,1,1,0,1,2,2,0,0,0],[0,0,0,0,0,0,0,2,2,1,2,2,0,0,0,0,0,0,0],[1,2,2,0,2,0,0,0,5,0,5,0,0,0,2,0,2,2,1],[0,0,1,1,2,0,1,1,1,2,1,1,1,0,2,1,1,0,0],[2,0,1,0,0,0,0,0,0,2,0,0,0,0,0,0,1,0,2],[0,1,0,0,2,2,2,0,0,2,0,0,2,2,2,0,0,1,0],[0,0,0,0,0,2,0,0,0,1,0,0,0,2,0,0,0,0,0],[2,2,0,1,1,5,0,1,1,1,1,1,0,5,1,1,0,2,2],[1,0,0,0,2,1,2,2,0,1,0,2,2,1,2,0,0,0,1],[1,1,2,0,1,1,1,0,0,0,0,0,1,1,1,0,2,1,1],[0,0,0,0,0,0,0,0,2,5,2,0,0,0,0,0,0,0,0],[0,2,2,1,0,2,0,2,2,2,2,2,0,2,0,1,2,2,0],[0,1,5,1,0,1,0,0,1,2,1,0,0,1,0,1,5,1,0],[0,0,0,1,0,1,0,0,0,2,0,0,0,1,0,1,0,0,0],[2,2,0,0,0,0,0,1,0,2,0,1,0,0,0,0,0,2,2],[0,0,0,2,0,1,0,0,0,0,0,0,0,1,0,2,0,0,0],[1,0,1,0,1,1,1,1,1,1,1,1,1,1,1,0,1,0,1],[0,0,1,0,0,1,5,1,0,0,0,1,5,1,0,0,1,0,0],[0,0,0,1,0,0,0,0,1,2,1,0,0,0,0,1,0,0,0],[2,0,2,0,2,0,2,0,0,2,0,0,2,0,2,0,2,0,2],[0,0,2,0,2,0,1,0,2,1,2,0,1,0,2,0,2,0,0],[0,2,0,0,0,0,0,2,0,5,0,2,0,0,0,0,0,2,0],[2,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,2],[0,0,0,1,0,2,0,0,0,1,0,0,0,2,0,1,0,0,0],[2,1,1,1,0,0,1,1,1,2,1,1,1,0,0,1,1,1,2],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,1,0,2,1,0,2,1,0,1,0,1,2,0,1,2,0,1,0],[1,0,0,0,1,0,0,2,0,1,0,2,0,0,1,0,0,0,1],[0,5,2,0,0,1,0,0,2,2,2,0,0,1,0,0,2,5,0],[0,2,0,0,1,4,0,1,0,1,0,1,0,4,1,0,0,2,0],[0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0],[0,2,1,2,0,1,1,0,1,2,1,0,1,1,0,2,1,2,0],[0,1,0,1,0,1,0,0,0,0,0,0,0,1,0,1,0,1,0],[0,0,0,0,0,0,0,1,0,3,0,1,0,0,0,0,0,0,0],[2,0,2,0,2,0,1,2,2,2,2,2,1,0,2,0,2,0,2],[0,1,0,0,1,0,0,0,4,2,4,0,0,0,1,0,0,1,0],[1,0,0,1,1,0,1,2,1,1,1,2,1,0,1,1,0,0,1]];Rj.set(a[0].length,0,a.length);const{addCollisionDetector:s}=e.getModule(bk);s((({collider:s,userData:l})=>{const p=Math.round(s.center.x),u=Math.round(s.center.z);if(p<-1||p>a[0].length||u<-1||u>a.length)return!0;const h=new ev(p,0,u),c=o.find((({position:e})=>e.x===p&&e.z===u));if(c)return((n,{abilities:i})=>{if(n.life-=i.doubleDamage?2:1,n.life=Math.max(n.life,0),0===n.life){o=o.filter((e=>e!==n)),n.models.forEach((e=>{IF.to(e.position,{y:-1,duration:.7,delay:.3*Math.random(),ease:"back.in(1.7)"})})),n.damageEffect&&n.damageEffect.dispose();const i=bT(fz[ez]);t.add(i.instance),i.instance.position.set(n.position.x,.2,n.position.z);const r=bT(fz[tz],e.cycleData.now);r.instance.position.copy(i.instance.position),e.scene.add(r.instance),IF.delayedCall(3,(()=>{i.dispose(),r.dispose(),n.models.forEach((e=>e.removeFromParent()))}))}else n.models.forEach((e=>{e.rotateOnAxis(Oj.X,.2*Math.random()-.1),e.rotateOnAxis(Oj.Y,.2*Math.random()-.1),e.rotateOnAxis(Oj.Z,.2*Math.random()-.1)})),!n.damageEffect&&n.life<n.maxLife/2&&(n.damageEffect=bT(fz[mz]),t.add(n.damageEffect.instance),n.damageEffect.instance.position.set(n.position.x,.2,n.position.z))})(c,l.caster),!0;const _=r.find((e=>l.caster.owner!==e.owner&&e.mesh.position.clone().round().distanceTo(h)<.5));return _?(((o,{abilities:a})=>{if(o.life.current-=a.doubleDamage?2:1,o.life.current=Math.max(o.life.current,0),o===i&&Me.set(o.life.current),0===o.life.current){o===i&&Object.values(Tj).forEach((e=>{i.control[e]=!1})),o.owner===Lj?Ze.update((e=>e-1)):Ee.update((e=>e-1)),o.moduleHandler.getModule(Bk).deactivate(gj),r=r.filter((e=>e!==o)),o===i&&r.length&&n.setTarget(r[0].mesh),IF.killTweensOf(o.mesh.position),IF.to(o.mesh.position,{y:-1,duration:.7,delay:.3*Math.random(),ease:"back.in(1.7)"});const a=bT(fz[ez]);t.add(a.instance),a.instance.position.set(o.mesh.position.x,.2,o.mesh.position.z);const s=bT(fz[tz],e.cycleData.now);s.instance.position.copy(a.instance.position),e.scene.add(s.instance),IF.delayedCall(3,(()=>{a.dispose(),s.dispose(),o.dispose()}))}else!o.effects.damage&&o.life.current<o.life.max/2?(o.effects.damage=bT(fz[Pz]),o.effects.damage.instance.rotation.x=Math.PI/2,o.effects.damage.instance.position.y=.5,o.mesh.add(o.effects.damage.instance)):o.effects.damage&&o.life.current<o.life.max/2&&o.effects.damage.resumeEmitter()})(_,l.caster),!0):void 0}));const l={0:uj.CTF_TANK_BASE_COLOR_R,1:uj.CTF_TANK_BASE_COLOR_G,2:uj.CTF_TANK_BASE_COLOR_B,3:uj.CTF_TANK_BASE_COLOR_Y},p=[l[0],l[2],l[3]];let u=0;const h={1:cj,2:hj},c=new ab({map:Oh(uj.CUBE_WORLD)});a.forEach(((n,a)=>n.forEach(((n,s)=>{const _=kh(_j).scene.clone();if(_.position.set(s,0,a),t.add(_),n)if(n>2){const o=(({startPosition:n,type:i,hasAi:o,name:a,owner:s})=>{const h=new tg,c=kh(dj).scene.clone(),_={damage:null,wheel:[]},d=[],m={wheels:[]};let P,f,x;const y=new tg;c.add(y),y.rotation.x=Math.PI,y.position.set(0,.65,-.6),c.traverse((e=>{if(e.isMesh)if(e.name.includes("_1"))e.name.includes("Mesh002")?m.turret=e:e.name.includes("Mesh001")?m.barrel=e:e.name.includes("Mesh")&&!m.body&&(m.body=e),["Mesh003_1","Mesh004_1","Mesh005_1","Mesh006_1"].includes(e.name)&&m.wheels.push(e);else{const t=new ab({map:Oh(s===Bj?l[i]:p[u])});e.material=t,e.material.map.flipY=!1,["Mesh003","Mesh004","Mesh005","Mesh006"].includes(e.name)&&d.push(e),e.name.includes("Mesh002")?f=e:e.name.includes("Mesh001")?x=e:e.name.includes("Mesh")&&!P&&(P=e)}})),[{x:-.3,z:-.3},{x:-.3,z:.3},{x:.3,z:-.3},{x:.3,z:.3}].forEach((e=>{const t=bT(fz[dz]);c.add(t.instance),t.instance.position.set(e.x,.2,e.z),_.wheel.push(t)})),h.position.copy(n),h.add(c),t.add(h),h.updateMatrixWorld(!0);const v=[{...Vk,config:Mj}],g=ly(v),b={current:3,max:3},z={multiattack:!1,doubleDamage:!1,doubleSpeed:!1};let w,Z,E;const M={modules:v,moduleHandler:g,mesh:h,wheels:d,body:P,bulletSocket:y,bulletMaterialId:l[i],turret:f,barrel:x,shadow:m,effects:_,abilities:z,name:a,control:{[Tj.UP]:0,[Tj.DOWN]:0,[Tj.LEFT]:0,[Tj.RIGHT]:0},direction:null,lastDirection:null,rotation:0,hasAi:o,speed:.6,rotationSpeed:.5,lastAction:null,owner:s,life:b,heal:()=>{b.current=Math.min(b.current+1,b.max),s!==Lj||o||Me.set(b.current),M.effects.damage&&b.current>=b.max/2&&M.effects.damage.pauseEmitter()},activateMultiattack:()=>{z.multiattack=!0,w&&w.kill(),w=IF.delayedCall(15,(()=>z.multiattack=!1))},activateDoubleDamage:()=>{z.doubleDamage=!0,Z&&Z.kill(),Z=IF.delayedCall(10,(()=>z.doubleDamage=!1))},activateDoubleSpeed:()=>{z.doubleSpeed=!0,E&&E.kill(),E=IF.delayedCall(5,(()=>z.doubleSpeed=!1))},changeColor:()=>{u++,u===p.length&&(u=0),c.traverse((e=>{e.isMesh&&(e.name.includes("_1")||(e.material.map=Oh(p[u]),e.material.map.flipY=!1))}))},onUpdate:e=>{g.update(e)},dispose:()=>{c.removeFromParent(),g.dispose(),M.effects.damage?.dispose(),M.effects.wheel.forEach((e=>e.dispose()))}};return r.push(M),g.init({world:e,unit:M}),o&&g.getModule(Bk).activate(bj),M})({name:3===n?"Player":"Comp",startPosition:new ev(s,0,a),direction:null,type:n>4?1:0,owner:n>4?Bj:Lj,hasAi:n>3});Be.world.getModule(zk).addCollector(o),n>4?Ee.update((e=>e+1)):Ze.update((e=>e+1)),3===n&&(i=o)}else{const e=[],i=[{x:-.25,y:0,z:-.25},{x:.25,y:0,z:-.25},{x:.25,y:0,z:.25},{x:-.25,y:0,z:.25},{x:-.25,y:-.25,z:-.25},{x:.25,y:-.25,z:-.25},{x:.25,y:-.25,z:.25},{x:-.25,y:-.25,z:.25}];for(let r=0;r<8;r++){const o=kh(h[n]).scene.clone();o.traverse((e=>{e.material=c})),o.position.set(s+i[r].x,.55+i[r].y,a+i[r].z),o.scale.set(.5,.5,.5),o.rotation.set(Math.floor(4*Math.random())*Math.PI/2,Math.floor(4*Math.random())*Math.PI/2,Math.floor(4*Math.random())*Math.PI/2),e.push(o),t.add(o)}const r=1===n?5:20;o.push({models:e,position:{x:s,z:a},type:n,life:r,maxLife:r})}})))),Me.set(i.life.max);const _=e=>e.x<0||e.x>Rj.x-1||e.z<0||e.z>Rj.z-1||r.some((({mesh:{position:t}})=>e!==t&&Math.abs(t.x-e.x)<1&&Math.abs(t.z-e.z)<1))||o.some((({position:t})=>e!==t&&Math.abs(t.x-e.x)<.4&&Math.abs(t.z-e.z)<.4)),d=new ev,m=()=>{let e=100;for(;_(d)||e-- >0;)d.x=Math.floor(Math.random()*Rj.x),d.z=Math.floor(Math.random()*Rj.z);return d};Be.getRandomAvailablePoint=m,Object.entries({speed:10,damage:8,health:8,multiattack:4}).forEach((([e,n])=>{for(let i=0;i<n;i++){const n=new tg;n.position.copy(m()),n.position.y=.2,t.add(n),Aj(Nj[e],n)}}));const P=Object.keys(Tj).map((e=>e)),f=e=>P.forEach((t=>e[t]=!1));return n.setTarget(i.mesh),n.jumpToTarget(i.mesh),{update:e=>{r.forEach((t=>{if(t.isMovementInProgress)return;t.hasAi&&(e=>{const t=e.direction,n=e.mesh.position;if(!t||_(n.clone().add(t))||Math.random()>.8){f(e.control);const t=P.reduce(((e,t)=>{const i=n.clone().add(Vj[t]);return _(i)||e.push(t),e}),[]).sort((()=>Math.random()-.5))?.[0];e.control[t]=!0}})(t),t.onUpdate(e);const{mesh:n,control:i}=t;t.direction=(e=>{const t=P.find((t=>e[t]));return kj[t]})(i),t.direction&&(t.lastDirection=t.direction,t.isMovementInProgress=!0,t.rotation=Math.atan2(t.direction.x,t.direction.z)+Math.PI,Math.abs(t.rotation-n.rotation.y)>.1?((e=>{const{mesh:t,rotation:n,rotationSpeed:i,wheels:r}=e;n-t.rotation.y>Math.PI?t.rotation.y+=2*Math.PI:t.rotation.y-n>Math.PI&&(t.rotation.y-=2*Math.PI);const o=Math.abs((n-t.rotation.y)/Math.PI)*(e.abilities.doubleSpeed?i/2:i);IF.killTweensOf(t.rotation),IF.to(t.rotation,{y:n,duration:o,ease:"linear",onComplete:()=>{e.isMovementInProgress=!1,e.isRotating=!1,e.lastAction="rotating"},onUpdate:()=>{r.forEach((e=>{e.rotateOnAxis(Oj.X,o/10)}))}})})(t),t.isRotating=!0):_(t.mesh.position.clone().add(t.direction))?(t.isMovementInProgress=!1,t.lastAction=null):((e=>{const{mesh:t,direction:n,speed:i,wheels:r,body:o,turret:a,shadow:s}=e;IF.to(t.position,{x:t.position.x+n.x,y:t.position.y+n.y,z:t.position.z+n.z,duration:e.abilities.doubleSpeed?i/2:i,ease:"linear",onComplete:()=>{e.isMovementInProgress=!1,e.isMoving=!1,e.lastAction="moving"},onUpdate:()=>{r.forEach((e=>{e.rotateOnAxis(Oj.X,Math.PI/30)})),s.wheels.forEach((e=>{e.rotateOnAxis(Oj.X,Math.PI/30)}))}}),"moving"===e.lastAction||IF.getTweensOf(o.rotation).length||IF.to(o.rotation,{x:-Math.PI/20,yoyo:!0,repeat:1,duration:.2,onUpdate:()=>s.turret.rotation.x=s.body.rotation.x=a.rotation.x=o.rotation.x})})(t),t.isMoving=!0));const r=t.moduleHandler.getModule(Bk);t.isRotating?r.disableAbility(gj):r.enableAbility(gj)}))},resetDirections:()=>{i.life.current<=0||f(i.control)},setDirection:(e,t)=>{i.life.current<=0||(i.control[e]=t)},shoot:e=>{if(i.life.current<=0)return;const t=i.moduleHandler.getModule(Bk);0===e?t.deactivate(gj):t.activate(gj)},player:i,changeColor:i.changeColor}})({world:e,scene:n,thirdPersonCamera:r});i(Sk).setTarget(o),jj(e),t.update(o.update)}))}}),Jj=[{name:"Arena",description:"This is a simple shooter demo where 2 teams are trying to beat each others.",preview:"./assets/demo-previews/arena.webp",worldConfig:pj,isPointerLockNeeded:!0,components:[class extends Pe{constructor(e){super(),me(this,e,IU,kU,a,{})}},zV],controls:[{keys:["w","a","s","d"],name:"Movements"},{keys:["keyboard_arrow_up","keyboard_arrow_left","keyboard_arrow_down","keyboard_arrow_right"],name:"Movements (2)"},{keys:["space"],name:"Jump"},{keys:["Shift"],name:"Sprint"},{keys:["q"],name:"Dash"},{keys:["1","2","3","4"],name:"Change Weapon"},{keys:["Mouse scroll"],name:"Change Weapon (2)"},{keys:["c"],name:"Change Camera"},{keys:["Left Click"],name:"Fire"},{keys:["Right Click"],name:"Aim"}]},{name:"The Collector",description:"A game where you should collect all of the coins as fast as possible.",preview:"./assets/demo-previews/the-collector.webp",worldConfig:xD,isPointerLockNeeded:!0,components:[CU,zV,rV],controls:[{keys:["w","a","s","d"],name:"Movements"},{keys:["keyboard_arrow_up","keyboard_arrow_left","keyboard_arrow_down","keyboard_arrow_right"],name:"Movements (2)"},{keys:["Shift"],name:"Sprint"},{keys:["space"],name:"Jump"},{keys:["q"],name:"Dash"},{keys:["c"],name:"Change Camera"},{keys:["Right Click"],name:"Aim"}]},{name:"Drift",description:"This is an Octree-Car demo, press the gas pedal and beat the bends.",preview:"./assets/demo-previews/drift.webp",worldConfig:PU,isPointerLockNeeded:!1,components:[class extends Pe{constructor(e){super(),me(this,e,HU,RU,a,{})}},class extends Pe{constructor(e){super(),me(this,e,ZU,wU,a,{})}}],controls:[{keys:["w","keyboard_arrow_up"],name:"Throttle"},{keys:["s","keyboard_arrow_down"],name:"Brake"},{keys:["a","keyboard_arrow_left"],name:"Steer Left"},{keys:["d","keyboard_arrow_right"],name:"Steer Right"},{keys:["c"],name:"Change Camera"},{keys:["v"],name:"Change Car Color"}]},{name:"Snake VS",description:"A classic game in 3D and with enemies. A simple example how can you combine your own game logic with this engine.",preview:"./assets/demo-previews/snake-vs.webp",worldConfig:IG,isPointerLockNeeded:!1,components:[rV,class extends Pe{constructor(e){super(),me(this,e,eV,QT,a,{})}}],controls:[{keys:["w","a","s","d"],name:"Movements"},{keys:["keyboard_arrow_up","keyboard_arrow_left","keyboard_arrow_down","keyboard_arrow_right"],name:"Movements (2)"},{keys:["c"],name:"Change Camera"}]},{name:"Monster Truck 2D",description:"A 2D physics based car game. It's using the Nape physics, compiled from Haxe to Javascript.",preview:"./assets/demo-previews/monster-truck-2d.webp",worldConfig:GD,isPointerLockNeeded:!1,components:[rV,CU,class extends Pe{constructor(e){super(),me(this,e,$T,JT,a,{})}}],controls:[{keys:["w","a","s","d"],name:"Movements"},{keys:["keyboard_arrow_up","keyboard_arrow_left","keyboard_arrow_down","keyboard_arrow_right"],name:"Movements (2)"},{keys:["c"],name:"Change Camera"}]},{name:"Tank Battle",description:"A demo game inspired by the classic Battle City. Red vs Green! It presents how can you add your custom collision detection for the projectiles module.",preview:"./assets/demo-previews/tank-battle.webp",worldConfig:qj,isPointerLockNeeded:!1,components:[rV,class extends Pe{constructor(e){super(),me(this,e,GT,DT,a,{})}},class extends Pe{constructor(e){super(),me(this,e,HT,RT,a,{})}},class extends Pe{constructor(e){super(),me(this,e,OT,IT,a,{})}}],controls:[{keys:["w","a","s","d"],name:"Movements"},{keys:["keyboard_arrow_up","keyboard_arrow_left","keyboard_arrow_down","keyboard_arrow_right"],name:"Movements (2)"},{keys:["space"],name:"Shooting"},{keys:["c"],name:"Change Camera"},{keys:["v"],name:"Change Tank Color"}]}];function $j(e){let n,i,a,s,l,p;const u=e[9].default,h=_(u,e,e[8],null);let c=[{class:i=ot({[e[1]]:!0,"mdc-card":!0,"mdc-card--outlined":"outlined"===e[2],"smui-card--padded":e[3]})},e[6]],d={};for(let e=0;e<c.length;e+=1)d=t(d,c[e]);return{c(){n=M("div"),h&&h.c(),T(n,d)},m(t,i){w(t,n,i),h&&h.m(n,null),e[10](n),s=!0,l||(p=[b(a=ct.call(null,n,e[0])),b(e[5].call(null,n))],l=!0)},p(e,[t]){h&&h.p&&(!s||256&t)&&P(h,u,e,e[8],s?m(u,e[8],t,null):f(e[8]),null),T(n,d=ue(c,[(!s||14&t&&i!==(i=ot({[e[1]]:!0,"mdc-card":!0,"mdc-card--outlined":"outlined"===e[2],"smui-card--padded":e[3]})))&&{class:i},64&t&&e[6]])),a&&o(a.update)&&1&t&&a.update.call(null,e[0])},i(e){s||(oe(h,e),s=!0)},o(e){ae(h,e),s=!1},d(t){t&&Z(n),h&&h.d(t),e[10](null),l=!1,r(p)}}}function Xj(e,n,i){const r=["use","class","variant","padded","getElement"];let o=y(n,r),{$$slots:a={},$$scope:s}=n;const l=ut(R());let p,{use:u=[]}=n,{class:h=""}=n,{variant:c="raised"}=n,{padded:_=!1}=n;return e.$$set=e=>{n=t(t({},n),x(e)),i(6,o=y(n,r)),"use"in e&&i(0,u=e.use),"class"in e&&i(1,h=e.class),"variant"in e&&i(2,c=e.variant),"padded"in e&&i(3,_=e.padded),"$$scope"in e&&i(8,s=e.$$scope)},[u,h,c,_,p,l,o,function(){return p},s,a,function(e){j[e?"unshift":"push"]((()=>{p=e,i(4,p)}))}]}class Yj extends Pe{constructor(e){super(),me(this,e,Xj,$j,a,{use:0,class:1,variant:2,padded:3,getElement:7})}get getElement(){return this.$$.ctx[7]}}var Kj=Nt({class:"smui-card__content",component:Jt});function Qj(e){let n,i,a,s,l,p,u,h,c,d;const x=e[17].default,y=_(x,e,e[16],null);let v=[{class:s=ot({[e[1]]:!0,"mdc-card__primary-action":!0,"smui-card__primary-action--padded":e[5],...e[8]})},{style:l=Object.entries(e[9]).map(eW).concat([e[2]]).join(" ")},{tabindex:e[6]},e[14]],g={};for(let e=0;e<v.length;e+=1)g=t(g,v[e]);return{c(){n=M("div"),i=M("div"),a=N(),y&&y.c(),B(i,"class","mdc-card__ripple"),T(n,g)},m(t,r){w(t,n,r),z(n,i),z(n,a),y&&y.m(n,null),e[18](n),h=!0,c||(d=[b(p=ct.call(null,n,e[0])),b(e[10].call(null,n)),b(u=Qt.call(null,n,{ripple:e[3],unbounded:!1,color:e[4],addClass:e[11],removeClass:e[12],addStyle:e[13]}))],c=!0)},p(e,[t]){y&&y.p&&(!h||65536&t)&&P(y,x,e,e[16],h?m(x,e[16],t,null):f(e[16]),null),T(n,g=ue(v,[(!h||290&t&&s!==(s=ot({[e[1]]:!0,"mdc-card__primary-action":!0,"smui-card__primary-action--padded":e[5],...e[8]})))&&{class:s},(!h||516&t&&l!==(l=Object.entries(e[9]).map(eW).concat([e[2]]).join(" ")))&&{style:l},(!h||64&t)&&{tabindex:e[6]},16384&t&&e[14]])),p&&o(p.update)&&1&t&&p.update.call(null,e[0]),u&&o(u.update)&&24&t&&u.update.call(null,{ripple:e[3],unbounded:!1,color:e[4],addClass:e[11],removeClass:e[12],addStyle:e[13]})},i(e){h||(oe(y,e),h=!0)},o(e){ae(y,e),h=!1},d(t){t&&Z(n),y&&y.d(t),e[18](null),c=!1,r(d)}}}const eW=([e,t])=>`${e}: ${t};`;function tW(e,n,i){const r=["use","class","style","ripple","color","padded","tabindex","getElement"];let o=y(n,r),{$$slots:a={},$$scope:s}=n;const l=ut(R());let p,{use:u=[]}=n,{class:h=""}=n,{style:c=""}=n,{ripple:_=!0}=n,{color:d}=n,{padded:m=!1}=n,{tabindex:P=0}=n,f={},v={};return e.$$set=e=>{n=t(t({},n),x(e)),i(14,o=y(n,r)),"use"in e&&i(0,u=e.use),"class"in e&&i(1,h=e.class),"style"in e&&i(2,c=e.style),"ripple"in e&&i(3,_=e.ripple),"color"in e&&i(4,d=e.color),"padded"in e&&i(5,m=e.padded),"tabindex"in e&&i(6,P=e.tabindex),"$$scope"in e&&i(16,s=e.$$scope)},[u,h,c,_,d,m,P,p,f,v,l,function(e){f[e]||i(8,f[e]=!0,f)},function(e){e in f&&!f[e]||i(8,f[e]=!1,f)},function(e,t){v[e]!=t&&(""===t||null==t?(delete v[e],i(9,v)):i(9,v[e]=t,v))},o,function(){return p},s,a,function(e){j[e?"unshift":"push"]((()=>{p=e,i(7,p)}))}]}function nW(e){let n,i,a,s,l,p;const u=e[8].default,h=_(u,e,e[7],null);let c=[{class:i=ot({[e[1]]:!0,"mdc-card__media":!0,"mdc-card__media--square":"square"===e[2],"mdc-card__media--16-9":"16x9"===e[2]})},e[5]],d={};for(let e=0;e<c.length;e+=1)d=t(d,c[e]);return{c(){n=M("div"),h&&h.c(),T(n,d)},m(t,i){w(t,n,i),h&&h.m(n,null),e[9](n),s=!0,l||(p=[b(a=ct.call(null,n,e[0])),b(e[4].call(null,n))],l=!0)},p(e,[t]){h&&h.p&&(!s||128&t)&&P(h,u,e,e[7],s?m(u,e[7],t,null):f(e[7]),null),T(n,d=ue(c,[(!s||6&t&&i!==(i=ot({[e[1]]:!0,"mdc-card__media":!0,"mdc-card__media--square":"square"===e[2],"mdc-card__media--16-9":"16x9"===e[2]})))&&{class:i},32&t&&e[5]])),a&&o(a.update)&&1&t&&a.update.call(null,e[0])},i(e){s||(oe(h,e),s=!0)},o(e){ae(h,e),s=!1},d(t){t&&Z(n),h&&h.d(t),e[9](null),l=!1,r(p)}}}function iW(e,n,i){const r=["use","class","aspectRatio","getElement"];let o=y(n,r),{$$slots:a={},$$scope:s}=n;const l=ut(R());let p,{use:u=[]}=n,{class:h=""}=n,{aspectRatio:c}=n;return e.$$set=e=>{n=t(t({},n),x(e)),i(5,o=y(n,r)),"use"in e&&i(0,u=e.use),"class"in e&&i(1,h=e.class),"aspectRatio"in e&&i(2,c=e.aspectRatio),"$$scope"in e&&i(7,s=e.$$scope)},[u,h,c,p,l,o,function(){return p},s,a,function(e){j[e?"unshift":"push"]((()=>{p=e,i(3,p)}))}]}Nt({class:"mdc-card__media-content",component:Jt}),Nt({class:"mdc-card__action-buttons",component:Jt}),Nt({class:"mdc-card__action-icons",component:Jt});const rW=class extends Pe{constructor(e){super(),me(this,e,tW,Qj,a,{use:0,class:1,style:2,ripple:3,color:4,padded:5,tabindex:6,getElement:15})}get getElement(){return this.$$.ctx[15]}},oW=class extends Pe{constructor(e){super(),me(this,e,iW,nW,a,{use:0,class:1,aspectRatio:2,getElement:6})}get getElement(){return this.$$.ctx[6]}};function aW(e){let t,n;const i=e[1].default,r=_(i,e,e[0],null);return{c(){t=M("div"),r&&r.c(),B(t,"class","wrapper svelte-bicm0l")},m(e,i){w(e,t,i),r&&r.m(t,null),n=!0},p(e,[t]){r&&r.p&&(!n||1&t)&&P(r,i,e,e[0],n?m(i,e[0],t,null):f(e[0]),null)},i(e){n||(oe(r,e),n=!0)},o(e){ae(r,e),n=!1},d(e){e&&Z(t),r&&r.d(e)}}}function sW(e,t,n){let{$$slots:i={},$$scope:r}=t;return e.$$set=e=>{"$$scope"in e&&n(0,r=e.$$scope)},[r,i]}class lW extends Pe{constructor(e){super(),me(this,e,sW,aW,a,{})}}function pW(e,t,n){const i=e.slice();return i[6]=t[n],i}function uW(e,t,n){const i=e.slice();return i[9]=t[n],i}function hW(t){let n;return{c(){n=C(t[1])},m(e,t){w(e,n,t)},p:e,d(e){e&&Z(n)}}}function cW(t){let n,i=t[9]+"";return{c(){n=C(i)},m(e,t){w(e,n,t)},p:e,i:e,o:e,d(e){e&&Z(n)}}}function _W(e){let t,n;return t=new dn({props:{class:"material-icons",$$slots:{default:[dW]},$$scope:{ctx:e}}}),{c(){ce(t.$$.fragment)},m(e,i){_e(t,e,i),n=!0},p(e,n){const i={};4096&n&&(i.$$scope={dirty:n,ctx:e}),t.$set(i)},i(e){n||(oe(t.$$.fragment,e),n=!0)},o(e){ae(t.$$.fragment,e),n=!1},d(e){de(t,e)}}}function dW(t){let n,i=t[9]+"";return{c(){n=C(i)},m(e,t){w(e,n,t)},p:e,d(e){e&&Z(n)}}}function mW(e){let t,n,i,r;const o=[_W,cW],a=[];return t=function(e,t){return e[9].includes("keyboard_")?0:1}(e),n=a[t]=o[t](e),{c(){n.c(),i=A()},m(e,n){a[t].m(e,n),w(e,i,n),r=!0},p(e,t){n.p(e,t)},i(e){r||(oe(n),r=!0)},o(e){ae(n),r=!1},d(e){a[t].d(e),e&&Z(i)}}}function PW(e,t){let n,i,r;return i=new lW({props:{$$slots:{default:[mW]},$$scope:{ctx:t}}}),{key:e,first:null,c(){n=A(),ce(i.$$.fragment),this.first=n},m(e,t){w(e,n,t),_e(i,e,t),r=!0},p(e,n){t=e;const r={};4096&n&&(r.$$scope={dirty:n,ctx:t}),i.$set(r)},i(e){r||(oe(i.$$.fragment,e),r=!0)},o(e){ae(i.$$.fragment,e),r=!1},d(e){e&&Z(n),de(i,e)}}}function fW(e,t){let n,i,r,o,a,s,l=[],p=new Map,u=t[6].name+"",h=t[6].keys;const c=e=>e[9];for(let e=0;e<h.length;e+=1){let n=uW(t,h,e),i=c(n);p.set(i,l[e]=PW(i,n))}return{key:e,first:null,c(){n=M("div");for(let e=0;e<l.length;e+=1)l[e].c();i=N(),r=M("div"),o=C(u),a=N(),B(n,"class","row svelte-161uk5w"),this.first=n},m(e,t){w(e,n,t);for(let e=0;e<l.length;e+=1)l[e].m(n,null);z(n,i),z(n,r),z(r,o),z(n,a),s=!0},p(e,r){t=e,4&r&&(h=t[6].keys,ie(),l=pe(l,r,c,1,t,h,p,n,le,PW,i,uW),re())},i(e){if(!s){for(let e=0;e<h.length;e+=1)oe(l[e]);s=!0}},o(e){for(let e=0;e<l.length;e+=1)ae(l[e]);s=!1},d(e){e&&Z(n);for(let e=0;e<l.length;e+=1)l[e].d()}}}function xW(e){let t,n,i,r,o,a,s,l,p,u=[],h=new Map;r=new oW({props:{class:"card-media-16x9",aspectRatio:"16x9",style:`background-image: url(${e[3]})`}}),a=new Kj({props:{class:"mdc-typography--body2",$$slots:{default:[hW]},$$scope:{ctx:e}}});let c=e[2];const _=e=>e[6].name;for(let t=0;t<c.length;t+=1){let n=pW(e,c,t),i=_(n);h.set(i,u[t]=fW(i,n))}return{c(){t=M("div"),n=M("h2"),n.textContent=`${e[0]}`,i=N(),ce(r.$$.fragment),o=N(),ce(a.$$.fragment),s=N(),l=M("div");for(let e=0;e<u.length;e+=1)u[e].c();B(n,"class","mdc-typography--headline6"),I(n,"margin","0"),I(t,"padding","1rem"),B(l,"class","controlInfo svelte-161uk5w")},m(e,h){w(e,t,h),z(t,n),w(e,i,h),_e(r,e,h),w(e,o,h),_e(a,e,h),w(e,s,h),w(e,l,h);for(let e=0;e<u.length;e+=1)u[e].m(l,null);p=!0},p(e,t){const n={};4096&t&&(n.$$scope={dirty:t,ctx:e}),a.$set(n),4&t&&(c=e[2],ie(),u=pe(u,t,_,1,e,c,h,l,le,fW,null,pW),re())},i(e){if(!p){oe(r.$$.fragment,e),oe(a.$$.fragment,e);for(let e=0;e<c.length;e+=1)oe(u[e]);p=!0}},o(e){ae(r.$$.fragment,e),ae(a.$$.fragment,e);for(let e=0;e<u.length;e+=1)ae(u[e]);p=!1},d(e){e&&Z(t),e&&Z(i),de(r,e),e&&Z(o),de(a,e),e&&Z(s),e&&Z(l);for(let e=0;e<u.length;e+=1)u[e].d()}}}function yW(e){let t,n;return t=new rW({props:{$$slots:{default:[xW]},$$scope:{ctx:e}}}),t.$on("click",e[4]),{c(){ce(t.$$.fragment)},m(e,i){_e(t,e,i),n=!0},p(e,n){const i={};4096&n&&(i.$$scope={dirty:n,ctx:e}),t.$set(i)},i(e){n||(oe(t.$$.fragment,e),n=!0)},o(e){ae(t.$$.fragment,e),n=!1},d(e){de(t,e)}}}function vW(e){let t,n,i;return n=new Yj({props:{$$slots:{default:[yW]},$$scope:{ctx:e}}}),{c(){t=M("div"),ce(n.$$.fragment),B(t,"class","wrapper svelte-161uk5w")},m(e,r){w(e,t,r),_e(n,t,null),i=!0},p(e,[t]){const i={};4096&t&&(i.$$scope={dirty:t,ctx:e}),n.$set(i)},i(e){i||(oe(n.$$.fragment,e),i=!0)},o(e){ae(n.$$.fragment,e),i=!1},d(e){e&&Z(t),de(n)}}}function gW(e,t,n){let{config:i}=t;const{name:r,description:o,controls:a,preview:s}=i;return e.$$set=e=>{"config"in e&&n(5,i=e.config)},[r,o,a,s,()=>{be.set(i),ge.set(xe)},i]}class bW extends Pe{constructor(e){super(),me(this,e,gW,vW,a,{config:5})}}function zW(e,t,n){const i=e.slice();return i[1]=t[n],i}function wW(e,t){let n,i,r;return i=new bW({props:{config:t[1]}}),{key:e,first:null,c(){n=A(),ce(i.$$.fragment),this.first=n},m(e,t){w(e,n,t),_e(i,e,t),r=!0},p(e,n){t=e},i(e){r||(oe(i.$$.fragment,e),r=!0)},o(e){ae(i.$$.fragment,e),r=!1},d(e){e&&Z(n),de(i,e)}}}function ZW(e){let t,n,i,r,o,a,s,l,p,u=[],h=new Map,c=e[0];const _=e=>e[1].name;for(let t=0;t<c.length;t+=1){let n=zW(e,c,t),i=_(n);h.set(i,u[t]=wW(i,n))}return{c(){t=M("div"),n=M("div"),i=C("THREE Game Demo Projects\r\n    "),r=M("div"),r.textContent=`version: ${EW}`,o=N(),a=M("div");for(let e=0;e<u.length;e+=1)u[e].c();s=N(),l=M("div"),B(n,"class","frame svelte-11uc6b9"),B(a,"class","content svelte-11uc6b9"),B(l,"class","frame svelte-11uc6b9"),B(t,"class","wrapper svelte-11uc6b9")},m(e,h){w(e,t,h),z(t,n),z(n,i),z(n,r),z(t,o),z(t,a);for(let e=0;e<u.length;e+=1)u[e].m(a,null);z(t,s),z(t,l),p=!0},p(e,[t]){1&t&&(c=e[0],ie(),u=pe(u,t,_,1,e,c,h,a,le,wW,null,zW),re())},i(e){if(!p){for(let e=0;e<c.length;e+=1)oe(u[e]);p=!0}},o(e){for(let e=0;e<u.length;e+=1)ae(u[e]);p=!1},d(e){e&&Z(t);for(let e=0;e<u.length;e+=1)u[e].d()}}}const EW="0.11.0";function MW(e){const t=[...Jj];return t.reverse(),[t]}class SW extends Pe{constructor(e){super(),me(this,e,MW,ZW,a,{})}}function CW(e){let t,n,i;var r=e[0];return r&&(t=new r({})),{c(){t&&ce(t.$$.fragment),n=A()},m(e,r){t&&_e(t,e,r),w(e,n,r),i=!0},p(e,[i]){if(r!==(r=e[0])){if(t){ie();const e=t;ae(e.$$.fragment,1,0,(()=>{de(e,1)})),re()}r?(t=new r({}),ce(t.$$.fragment),oe(t.$$.fragment,1),_e(t,n.parentNode,n)):t=null}},i(e){i||(t&&oe(t.$$.fragment,e),i=!0)},o(e){t&&ae(t.$$.fragment,e),i=!1},d(e){e&&Z(n),t&&de(t,e)}}}function NW(e,t,n){let i;const r={[fe]:SW,[xe]:CT};let o;return ge.subscribe((e=>n(1,o=e))),e.$$.update=()=>{2&e.$$.dirty&&n(0,i=r[o])},[i,o]}return new class extends Pe{constructor(e){super(),me(this,e,NW,CW,a,{})}}({target:document.body})}();
//# sourceMappingURL=bundle.js.map
